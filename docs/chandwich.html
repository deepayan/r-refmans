<!DOCTYPE html><html lang="en"><head><title>Help for package chandwich</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {chandwich}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#chandwich-package'><p>chandwich: Chandler-Bate Sandwich Loglikelihood Adjustment</p></a></li>
<li><a href='#adjust_loglik'><p>Loglikelihood adjustment using the sandwich estimator</p></a></li>
<li><a href='#anova.chandwich'><p>Comparison of nested models</p></a></li>
<li><a href='#coef.chandwich'><p>Extract model coefficients method for objects of class &quot;chandwich&quot;</p></a></li>
<li><a href='#compare_models'><p>Comparison of nested models</p></a></li>
<li><a href='#conf_intervals'><p>Confidence intervals</p></a></li>
<li><a href='#conf_region'><p>Two-dimensional confidence regions</p></a></li>
<li><a href='#confint.chandwich'><p>Confidence intervals for model parameters</p></a></li>
<li><a href='#log_gev'><p>The Generalised Extreme Value Log-Density Function</p></a></li>
<li><a href='#logLik.chandwich'><p>Extract log-likelihood for objects of class &quot;chandwich&quot;</p></a></li>
<li><a href='#owtemps'><p>Oxford and Worthing annual maximum temperatures</p></a></li>
<li><a href='#plot.chandwich'><p>Plot diagnostics for a chandwich object</p></a></li>
<li><a href='#plot.confint'><p>Plot diagnostics for a confint object</p></a></li>
<li><a href='#plot.confreg'><p>Plot diagnostics for a confreg object</p></a></li>
<li><a href='#print.chandwich'><p>Print method for objects of class &quot;chandwich&quot;</p></a></li>
<li><a href='#print.compmod'><p>Print method for objects of class &quot;compmod&quot;</p></a></li>
<li><a href='#print.confint'><p>Print method for objects of class &quot;confint&quot;</p></a></li>
<li><a href='#print.summary.chandwich'><p>Print method for objects of class &quot;summary.chandwich&quot;</p></a></li>
<li><a href='#profile_loglik'><p>Profile loglikelihood</p></a></li>
<li><a href='#rats'><p>Rat tumor data</p></a></li>
<li><a href='#summary.chandwich'><p>Summarizing adjusted loglikelihoods</p></a></li>
<li><a href='#vcov.chandwich'><p>Calculate the variance-covariance matrix for an object of class &quot;chandwich&quot;</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Chandler-Bate Sandwich Loglikelihood Adjustment</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.6</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-08-25</td>
</tr>
<tr>
<td>Description:</td>
<td>Performs adjustments of a user-supplied independence loglikelihood 
    function using a robust sandwich estimator of the parameter covariance 
    matrix, based on the methodology in Chandler and Bate (2007) 
    &lt;<a href="https://doi.org/10.1093%2Fbiomet%2Fasm015">doi:10.1093/biomet/asm015</a>&gt;.  This can be used for cluster correlated data 
    when interest lies in the parameters of the marginal distributions or for 
    performing inferences that are robust to certain types of model 
    misspecification.  Functions for profiling the adjusted loglikelihoods are 
    also provided, as are functions for calculating and plotting confidence 
    intervals, for single model parameters, and confidence regions, for pairs 
    of model parameters.  Nested models can be compared using an adjusted 
    likelihood ratio test.</td>
</tr>
<tr>
<td>Imports:</td>
<td>graphics, methods, numDeriv, stats, utils</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>LazyData:</td>
<td>TRUE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.3.0)</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, sandwich, testthat</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://paulnorthrop.github.io/chandwich/">https://paulnorthrop.github.io/chandwich/</a>,
<a href="https://github.com/paulnorthrop/chandwich">https://github.com/paulnorthrop/chandwich</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/paulnorthrop/chandwich/issues">https://github.com/paulnorthrop/chandwich/issues</a></td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-08-25 21:16:15 UTC; paul</td>
</tr>
<tr>
<td>Author:</td>
<td>Paul J. Northrop [aut, cre, cph],
  Richard E. Chandler [aut, cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Paul J. Northrop &lt;p.northrop@ucl.ac.uk&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-08-25 21:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='chandwich-package'>chandwich: Chandler-Bate Sandwich Loglikelihood Adjustment</h2><span id='topic+chandwich-package'></span><span id='topic+_PACKAGE'></span><span id='topic+chandwich'></span>

<h3>Description</h3>

<p>Performs adjustments of an independence loglikelihood using
a robust sandwich estimator of the parameter covariance matrix, based on
the methodology in Chandler and Bate (2007).  This can be used for cluster
correlated data when interest lies in the parameters of the marginal
distributions. Functions for profiling the adjusted loglikelihoods are also
provided, as are functions for calculating and plotting confidence
intervals, for single model parameters, and confidence regions, for pairs of
model parameters.
</p>


<h3>Details</h3>

<p>The main function in the chandwich package is <code>adjust_loglik</code>.  It
finds the maximum likelihood estimate (MLE) of model parameters based on
an independence loglikelihood in which cluster dependence in the data is
ignored.  The independence loglikelihood is adjusted in a way that ensures
that the Hessian of the adjusted loglikelihood coincides with a robust
sandwich estimate of the parameter covariance at the MLE.  Three
adjustments are available: one in which the independence loglikelihood
itself is scaled (vertical scaling) and two others where the scaling
is in the parameter vector (horizontal scaling).
</p>
<p>See Chandler and Bate (2007) for full details and
<code>vignette("chandwich-vignette", package = "chandwich")</code> for an
overview of the package.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Paul J. Northrop <a href="mailto:p.northrop@ucl.ac.uk">p.northrop@ucl.ac.uk</a> [copyright holder]
</p>
<p>Authors:
</p>

<ul>
<li><p> Richard E. Chandler [copyright holder]
</p>
</li></ul>



<h3>References</h3>

<p>Chandler, R. E. and Bate, S. (2007). Inference for clustered
data using the independence loglikelihood. <em>Biometrika</em>,
<strong>94</strong>(1), 167-183. <a href="https://doi.org/10.1093/biomet/asm015">doi:10.1093/biomet/asm015</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+adjust_loglik">adjust_loglik</a></code> to adjust a user-supplied
loglikelihood.
</p>
<p><code><a href="#topic+compare_models">compare_models</a></code> to compare nested models using an
adjusted loglikelihood ratio test.  See also the S3 method
<code><a href="#topic+anova.chandwich">anova.chandwich</a></code>.
</p>
<p><code><a href="#topic+conf_intervals">conf_intervals</a></code> to calculate confidence intervals
for individual model parameters.  See also the S3 method
<code><a href="#topic+confint.chandwich">confint.chandwich</a></code>.
</p>
<p><code><a href="#topic+conf_region">conf_region</a></code> to calculate a confidence region
for a pair of model parameters.
</p>

<hr>
<h2 id='adjust_loglik'>Loglikelihood adjustment using the sandwich estimator</h2><span id='topic+adjust_loglik'></span>

<h3>Description</h3>

<p>Performs adjustments of a user-supplied independence loglikelihood for the
presence of cluster dependence, following Chandler and Bate (2007).
The user provides a function that returns a vector of observation-specific
loglikelihood contributions and a vector that indicates cluster membership.
The loglikelihood of a sub-model can be adjusted by fixing a set of
parameters at particular values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>adjust_loglik(
  loglik = NULL,
  ...,
  cluster = NULL,
  p = NULL,
  init = NULL,
  par_names = NULL,
  fixed_pars = NULL,
  fixed_at = 0,
  name = NULL,
  larger = NULL,
  alg_deriv = NULL,
  alg_hess = NULL,
  mle = NULL,
  H = NULL,
  V = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="adjust_loglik_+3A_loglik">loglik</code></td>
<td>
<p>A named function.  Returns a vector of the
loglikelihood contributions of individual observations.  The first
argument must be the vector of model parameter(s). If any of the model
parameters are out-of-bounds then <code>loglik</code> should return either
<code>-Inf</code> or a vector with at least one element equal to <code>-Inf</code>.
The number of parameters in the <strong>full</strong> model must be specified
using (at least) one of the arguments <code>p</code>, <code>init</code> or
<code>par_names</code>.</p>
</td></tr>
<tr><td><code id="adjust_loglik_+3A_...">...</code></td>
<td>
<p>Further arguments to be passed either to <code>loglik</code>
(and to <code>alg_deriv</code> and <code>alg_hess</code> if these are supplied) or
to <code><a href="stats.html#topic+optim">optim</a></code>.  The latter may include <code>gr</code>,
<code>method</code>, <code>lower</code>, <code>upper</code> or <code>control</code>.
In the call to <code><a href="stats.html#topic+optim">optim</a></code>, <code>hessian = TRUE</code>
will be used regardless of any value supplied.
The function <code>loglik</code> must <em>not</em> have arguments with names
that match any of these arguments to <code><a href="stats.html#topic+optim">optim</a></code>.</p>
</td></tr>
<tr><td><code id="adjust_loglik_+3A_cluster">cluster</code></td>
<td>
<p>A vector or factor indicating from which cluster the
respective loglikelihood contributions from <code>loglik</code> originate.
Must have the same length as the vector returned by <code>loglik</code>.
If <code>cluster</code> is not supplied then it is set inside
<code>adjust_loglik</code> under the assumption that each observation forms
its own cluster.</p>
</td></tr>
<tr><td><code id="adjust_loglik_+3A_p">p</code></td>
<td>
<p>A numeric scalar.  The dimension of the <strong>full</strong> parameter
vector, i.e. the number of parameters in the full model.  Must be
consistent with the lengths of <code>init</code> and <code>par_names</code>,
if these are also supplied.</p>
</td></tr>
<tr><td><code id="adjust_loglik_+3A_init">init</code></td>
<td>
<p>A numeric vector of initial values.  Must have length equal
to the number of parameters in the <strong>full</strong> model.  If <code>init</code>
is supplied then <code>p</code> is set to <code>length(init)</code>, provided that
this is consistent with the the value given by <code>p</code> or implied
by <code>length(par_names)</code>.
If <code>fixed_pars</code> is not <code>NULL</code> then <code>init[-fixed_pars]</code>
is used in the search for the MLE.
If <code>init</code> is not supplied then <code>rep(0.1, p)</code> is used.</p>
</td></tr>
<tr><td><code id="adjust_loglik_+3A_par_names">par_names</code></td>
<td>
<p>A character vector.  Names of the <code>p</code> parameters
in the <strong>full</strong> model.  Must be consistent with the lengths of
<code>init</code> and <code>p</code>, if these are also supplied.</p>
</td></tr>
<tr><td><code id="adjust_loglik_+3A_fixed_pars">fixed_pars</code></td>
<td>
<p>A vector specifying which parameters are to be restricted
to be equal to the value(s) in <code>fixed_at</code>.  Can be either a numeric
vector, specifying indices of the components of the <strong>full</strong> parameter
vector, or a character vector of parameter names, which must be a subset
of those supplied in <code>par_names</code> or stored in the object
<code>larger</code>.</p>
</td></tr>
<tr><td><code id="adjust_loglik_+3A_fixed_at">fixed_at</code></td>
<td>
<p>A numeric vector of length 1 or <code>length(fixed_pars)</code>.
If <code>length(fixed_at) = 1</code> then the components <code>fixed_pars</code>
of the parameter vector are all fixed at <code>fixed_at</code>.
If <code>length(fixed_at) = length(fixed_pars)</code> then the component
<code>fixed_pars[i]</code> is fixed at <code>fixed_at[i]</code> for each <code>i</code>.</p>
</td></tr>
<tr><td><code id="adjust_loglik_+3A_name">name</code></td>
<td>
<p>A character scalar.  A name for the model that gives rise
to <code>loglik</code>.  If this is not supplied then the name in
<code>larger</code> is used, if this has been supplied, and the name of
the function <code>loglik</code> otherwise.</p>
</td></tr>
<tr><td><code id="adjust_loglik_+3A_larger">larger</code></td>
<td>
<p>Only relevant if <code>fixed_pars</code> is not <code>NULL</code>.
If <code>larger</code> is supplied but <code>fixed_pars</code> is not then an error
will result.  if <code>larger</code> is supplied then information about the
model in <code>larger</code>, e.g. about <code>p</code> and <code>par_names</code> will
override any attempt to set these arguments in the call to
<code>adjust_loglik</code>.
</p>
<p>An object of class <code>"chandwich"</code> returned by <code>adjust_loglik</code>,
corresponding to a model in which the smaller model implied by
<code>fixed_pars</code> is nested.  If <code>larger</code> is supplied then
all the arguments to <code>adjust_loglik</code> apart from
<code>fixed_pars</code> and <code>fixed_at</code> are extracted from <code>larger</code>.
If <code>init</code> is not supplied in the current call to
<code>adjust_loglik</code> then <code>init</code> is set to
<code>attr(larger, "MLE")</code>, with the elements in <code>fixed_pars</code>
set to <code>fixed_at</code>.</p>
</td></tr>
<tr><td><code id="adjust_loglik_+3A_alg_deriv">alg_deriv</code></td>
<td>
<p>A function with the vector of model parameter(s) as its
first argument.  Returns a <code>length(cluster)</code> by <code>p</code> numeric
matrix. Column i contains the derivatives of each of the loglikelihood
contributions in <code>loglik</code> with respect to model parameter i.</p>
</td></tr>
<tr><td><code id="adjust_loglik_+3A_alg_hess">alg_hess</code></td>
<td>
<p>A function with the vector of model parameter(s) as its
first argument.  Returns a <code>p</code> by <code>p</code> numeric matrix equal to
the Hessian of <code>loglik</code>, i.e. the matrix of second derivatives of
the function <code>loglik</code>.
</p>
<p>Supplying both <code>V</code> and <code>alg_deriv</code> or both <code>H</code> and
<code>alg_hess</code> will produce an error.</p>
</td></tr>
<tr><td><code id="adjust_loglik_+3A_mle">mle</code></td>
<td>
<p>A numeric vector.  Can only be used if <code>fixed_pars = NULL</code>.
Provides the maximum likelihood estimate of the model parameters,
that is, the value of the parameter vector
at which the independence loglikelihood <code>loglik</code> is maximized.
Must have length equal to the number of parameters in the
<strong>full</strong> model.  If <code>mle</code> is supplied then <code>p</code> is set
to <code>length(mle)</code>, provided that this is consistent with the the
value given by <code>p</code> or implied by <code>length(par_names)</code>.
If <code>mle</code> is supplied then it overrides <code>init</code>.</p>
</td></tr>
<tr><td><code id="adjust_loglik_+3A_h">H</code>, <code id="adjust_loglik_+3A_v">V</code></td>
<td>
<p>p by p numeric matrices.  Only used if <code>mle</code> is supplied.
Provide estimates of the Hessian of the
independence loglikelihood (H) and the variance of the vector
of cluster-specific contributions to the score vector (first
derivatives with respect to the parameters) of the independence
loglikelihood, each evaluated at the MLE <code>mle</code>.  See the
<em>Introducing chandwich</em> vignette and/or Chandler and Bate (2007).
</p>
<p>Supplying both <code>V</code> and <code>alg_deriv</code> or both <code>H</code> and
<code>alg_hess</code> will produce an error.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Three adjustments to the independence loglikelihood described in
Chandler and Bate (2007) are available.  The vertical adjustment is
described in Section 6 and two horizontal adjustments are described
in Sections 3.2 to 3.4.  See the descriptions of <code>type</code> and, for the
horizontal adjustments, the descriptions of <code>C_cholesky</code> and
<code>C_spectral</code>, in <strong>Value</strong>.
</p>
<p>The adjustments involve first and second derivatives of the loglikelihood
with respect to the model parameters.  These are estimated using
<code><a href="numDeriv.html#topic+jacobian">jacobian</a></code> and <code><a href="stats.html#topic+optim">optimHess</a></code>
unless <code>alg_deriv</code> and/or <code>alg_hess</code> are supplied.
</p>


<h3>Value</h3>

<p>A function of class <code>"chandwich"</code> to evaluate an adjusted
loglikelihood, or the independence loglikelihood, at one or more sets
of model parameters, with arguments
</p>
<table role = "presentation">
<tr><td><code>x</code></td>
<td>
<p>A numeric vector or matrix giving values of the <code>p_current</code>
(see below) parameters in the model to which the returned adjusted
loglikelihood applies.
If <code>p_current = 1</code> this may be a numeric vector or a matrix
with 1 column.
If <code>p_current &gt; 1</code> this may be a numeric vector of length <code>p</code>
(one set of model parameters) or a numeric matrix with <code>p</code>
columns (<code>nrow(x)</code> sets of model parameters), one set in each row
of <code>x</code>.</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>A character scalar.  The type of adjustment to use.
One of <code>"vertical"</code>, <code>"cholesky"</code>, <code>"spectral"</code> or
<code>"none"</code>.</p>
</td></tr></table>
<p>  The latter results in the evaluation of the
(unadjusted) independence loglikelihood.
The function has (additional) attributes
</p>
<table role = "presentation">
<tr><td><code>p_full</code>, <code>p_current</code></td>
<td>
<p>The number of parameters in the full model and
current models, respectively.</p>
</td></tr>
<tr><td><code>free_pars</code></td>
<td>
<p>A numeric vector giving the indices of the free
parameters in the current model, with names inferred from
<code>par_names</code> if this was supplied.</p>
</td></tr>
<tr><td><code>MLE</code>, <code>res_MLE</code></td>
<td>
<p>Numeric vectors, with names inferred from
<code>par_names</code> if this was supplied.  Maximum likelihood estimates
of free parameters under the current model (<code>mle</code>) and all
parameters in the full model, including any parameters with fixed
values (<code>res_MLE</code>).</p>
</td></tr>
<tr><td><code>SE</code>, <code>adjSE</code></td>
<td>
<p>The unadjusted and adjusted estimated standard errors,
of the free parameters, respectively.</p>
</td></tr>
<tr><td><code>VC</code>, <code>adjVC</code></td>
<td>
<p>The unadjusted and adjusted estimated
variance-covariance matrix of the free parameters, respectively.</p>
</td></tr>
<tr><td><code>HI</code>, <code>HA</code></td>
<td>
<p>The Hessians of the independence and adjusted loglikelihood,
respectively.</p>
</td></tr>
<tr><td><code>C_cholesky</code>, <code>C_spectral</code></td>
<td>
<p>The matrix C in equation (14) of Chandler and
Bate (2007), calculated using Cholesky decomposition and spectral
decomposition, respectively.</p>
</td></tr>
<tr><td><code>full_par_names</code>, <code>par_names</code></td>
<td>
<p>The names of the parameters in the full
and current models, respectively, if these were supplied in
this call or a previous call.</p>
</td></tr>
<tr><td><code>max_loglik</code></td>
<td>
<p>The common maximised value of the independence and
adjusted loglikelihoods.</p>
</td></tr>
<tr><td><code>loglik</code>, <code>cluster</code></td>
<td>
<p>The arguments <code>loglik</code> and <code>cluster</code>
supplied in this call, or a previous call.</p>
</td></tr>
<tr><td><code>loglik_args</code></td>
<td>
<p>A list containing the further arguments passed to
<code>loglik</code> via ... in this call, or a previous call.</p>
</td></tr>
<tr><td><code>loglikVecMLE</code></td>
<td>
<p>a vector containing the contributions of individual
observations to the independence log-likelihood evaluated at the MLE.</p>
</td></tr>
<tr><td><code>name</code></td>
<td>
<p>The argument <code>name</code>, or the name of the function
<code>loglik</code> if <code>name</code> isn't supplied.</p>
</td></tr>
<tr><td><code>nobs</code></td>
<td>
<p>The number of observations.</p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p>The call to <code>adjust_loglik</code>.</p>
</td></tr>
</table>
<p>If <code>fixed_pars</code> is not <code>NULL</code> then there are further attributes
</p>
<table role = "presentation">
<tr><td><code>fixed_pars</code></td>
<td>
<p>The argument <code>fixed_pars</code>, with names inferred from
<code>par_names</code> if this was supplied.</p>
</td></tr>
<tr><td><code>fixed_at</code></td>
<td>
<p>The argument <code>fixed_at</code>, with names inferred from
<code>par_names</code> if this was supplied.</p>
</td></tr>
</table>
<p>If <code>alg_deriv</code> and/or <code>alg_hess</code> were supplied then these are
returned as further attributes.
</p>
<p>To view an individual attribute called <code>att_name</code> use
<code>attr(x, "att_name")</code> or <code>attributes(x)$att_name</code>.
</p>


<h3>References</h3>

<p>Chandler, R. E. and Bate, S. (2007). Inference for clustered
data using the independence loglikelihood. <em>Biometrika</em>,
<strong>94</strong>(1), 167-183. <a href="https://doi.org/10.1093/biomet/asm015">doi:10.1093/biomet/asm015</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+summary.chandwich">summary.chandwich</a></code> for maximum likelihood estimates
and unadjusted and adjusted standard errors.
</p>
<p><code><a href="#topic+plot.chandwich">plot.chandwich</a></code> for plots of one-dimensional adjusted
loglikelihoods.
</p>
<p><code><a href="#topic+confint.chandwich">confint.chandwich</a></code>, <code><a href="#topic+anova.chandwich">anova.chandwich</a></code>,
<code><a href="#topic+coef.chandwich">coef.chandwich</a></code>, <code><a href="#topic+vcov.chandwich">vcov.chandwich</a></code>
and <code><a href="#topic+logLik.chandwich">logLik.chandwich</a></code> for other <code>chandwich</code> methods.
</p>
<p><code><a href="#topic+conf_intervals">conf_intervals</a></code> for confidence intervals for
individual parameters.
</p>
<p><code><a href="#topic+conf_region">conf_region</a></code> for a confidence region for
a pair of parameters.
</p>
<p><code><a href="#topic+compare_models">compare_models</a></code> to compare nested models using an
(adjusted) likelihood ratio test.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># ------------------------- Binomial model, rats data ----------------------

# Contributions to the independence loglikelihood
binom_loglik &lt;- function(prob, data) {
  if (prob &lt; 0 || prob &gt; 1) {
    return(-Inf)
  }
  return(dbinom(data[, "y"], data[, "n"], prob, log = TRUE))
}
rat_res &lt;- adjust_loglik(loglik = binom_loglik, data = rats, par_names = "p")

# Plot the loglikelihoods
plot(rat_res, type = 1:4, legend_pos = "bottom", lwd = 2, col = 1:4)
# MLE, SEs and adjusted SEs
summary(rat_res)

# -------------------------- GEV model, owtemps data -----------------------
# ------------ following Section 5.2 of Chandler and Bate (2007) -----------

# Contributions to the independence loglikelihood
gev_loglik &lt;- function(pars, data) {
  o_pars &lt;- pars[c(1, 3, 5)] + pars[c(2, 4, 6)]
  w_pars &lt;- pars[c(1, 3, 5)] - pars[c(2, 4, 6)]
  if (isTRUE(o_pars[2] &lt;= 0 | w_pars[2] &lt;= 0)) return(-Inf)
  o_data &lt;- data[, "Oxford"]
  w_data &lt;- data[, "Worthing"]
  check &lt;- 1 + o_pars[3] * (o_data - o_pars[1]) / o_pars[2]
  if (isTRUE(any(check &lt;= 0))) return(-Inf)
  check &lt;- 1 + w_pars[3] * (w_data - w_pars[1]) / w_pars[2]
  if (isTRUE(any(check &lt;= 0))) return(-Inf)
  o_loglik &lt;- log_gev(o_data, o_pars[1], o_pars[2], o_pars[3])
  w_loglik &lt;- log_gev(w_data, w_pars[1], w_pars[2], w_pars[3])
  return(o_loglik + w_loglik)
}

# Initial estimates (method of moments for the Gumbel case)
sigma &lt;- as.numeric(sqrt(6 * diag(var(owtemps))) / pi)
mu &lt;- as.numeric(colMeans(owtemps) - 0.57722 * sigma)
init &lt;- c(mean(mu), -diff(mu) / 2, mean(sigma), -diff(sigma) / 2, 0, 0)

# Loglikelihood adjustment for the full model
par_names &lt;- c("mu[0]", "mu[1]", "sigma[0]", "sigma[1]", "xi[0]", "xi[1]")
large &lt;- adjust_loglik(gev_loglik, data = owtemps, init = init,
                       par_names = par_names)
# Rows 1, 3 and 4 of Table 2 of Chandler and Bate (2007)
t(summary(large))

# Loglikelihood adjustment of some smaller models: xi[1] = 0 etc

# Starting from a larger model
medium &lt;- adjust_loglik(larger = large, fixed_pars = "xi[1]")
small &lt;- adjust_loglik(larger = large, fixed_pars = c("sigma[1]", "xi[1]"))
small &lt;- adjust_loglik(larger = medium, fixed_pars = c("sigma[1]", "xi[1]"))

# Starting from scratch
medium &lt;- adjust_loglik(gev_loglik, data = owtemps, init = init,
          par_names = par_names, fixed_pars = "xi[1]")
small &lt;- adjust_loglik(gev_loglik, data = owtemps, init = init,
         par_names = par_names, fixed_pars = c("sigma[1]", "xi[1]"))

# --------- Misspecified Poisson model for negative binomial data ----------

# ... following Section 5.1 of the "Object-Oriented Computation of Sandwich
# Estimators" vignette of the sandwich package
# https://cran.r-project.org/web/packages/sandwich/vignettes/sandwich-OOP.pdf

# Simulate data
set.seed(123)
x &lt;- rnorm(250)
y &lt;- rnbinom(250, mu = exp(1 + x), size = 1)
# Fit misspecified Poisson model
fm_pois &lt;- glm(y ~ x + I(x^2), family = poisson)
summary(fm_pois)$coefficients

# Contributions to the independence loglikelihood
pois_glm_loglik &lt;- function(pars, y, x) {
  log_mu &lt;- pars[1] + pars[2] * x + pars[3] * x ^ 2
  return(dpois(y, lambda = exp(log_mu), log = TRUE))
}
pars &lt;- c("alpha", "beta", "gamma")
pois_quad &lt;- adjust_loglik(pois_glm_loglik, y = y, x = x, par_names = pars)
summary(pois_quad)

# Providing algebraic derivatives and Hessian
pois_alg_deriv &lt;- function(pars, y, x) {
  mu &lt;- exp(pars[1] + pars[2] * x + pars[3] * x ^ 2)
  return(cbind(y - mu, x * (y - mu), x ^2 * (y - mu)))
}
pois_alg_hess &lt;- function(pars, y, x) {
  mu &lt;- exp(pars[1] + pars[2] * x + pars[3] * x ^ 2)
  alg_hess &lt;- matrix(0, 3, 3)
  alg_hess[1, ] &lt;- -c(sum(mu), sum(x * mu), sum(x ^ 2 * mu))
  alg_hess[2, ] &lt;- -c(sum(x * mu), sum(x ^ 2 * mu), sum(x ^ 3 * mu))
  alg_hess[3, ] &lt;- -c(sum(x ^ 2 * mu), sum(x ^ 3 * mu), sum(x ^ 4 * mu))
  return(alg_hess)
}
pois_quad &lt;- adjust_loglik(pois_glm_loglik, y = y, x = x, p = 3,
                           alg_deriv = pois_alg_deriv, alg_hess = pois_alg_hess)
summary(pois_quad)

got_sandwich &lt;- requireNamespace("sandwich", quietly = TRUE)
if (got_sandwich) {
  # Providing MLE, H and V
  # H and V calculated using bread() and meat() from sandwich package
  n_obs &lt;- stats::nobs(fm_pois)
  pois_quad &lt;- adjust_loglik(pois_glm_loglik, y = y, x = x, p = 3,
                             mle = fm_pois$coefficients,
                             H = -solve(sandwich::bread(fm_pois) / n_obs),
                             V = sandwich::meat(fm_pois) * n_obs)
}
</code></pre>

<hr>
<h2 id='anova.chandwich'>Comparison of nested models</h2><span id='topic+anova.chandwich'></span>

<h3>Description</h3>

<p><code>anova</code> method for objects of class <code>"chandwich"</code>.
Compares two or more nested models using the adjusted likelihood ratio
test statistic (ALRTS) described in Section 3.5 of Chandler and Bate (2007).
The nesting must result from the simple constraint that a subset of the
parameters of the larger model is held fixed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'chandwich'
anova(object, object2, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="anova.chandwich_+3A_object">object</code></td>
<td>
<p>An object of class <code>"chandwich"</code>, returned by
<code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.</p>
</td></tr>
<tr><td><code id="anova.chandwich_+3A_object2">object2</code></td>
<td>
<p>An object of class <code>"chandwich"</code>, returned by
<code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.</p>
</td></tr>
<tr><td><code id="anova.chandwich_+3A_...">...</code></td>
<td>
<p>Further objects of class <code>"chandwich"</code> and/or arguments
to be passed to <code><a href="#topic+compare_models">compare_models</a></code>.  The name of any object
of class <code>"chandwich"</code> passed via ... must not match any argument of
<code><a href="#topic+compare_models">compare_models</a></code> or any argument of
<code><a href="stats.html#topic+optim">optim</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For details the adjusted likelihood ratio test see
<code><a href="#topic+compare_models">compare_models</a></code> and Chandler and Bate (2007).
</p>
<p>The objects of class <code>"chandwich"</code> need not be provided in nested
order: they will be ordered inside <code>anova.chandwich</code> based on the
values of <code>attr(., "p_current")</code>.
</p>


<h3>Value</h3>

<p>An object of class <code>"anova"</code> inheriting from class
<code>"data.frame"</code>, with four columns:
</p>
<table role = "presentation">
<tr><td><code>Model.Df</code></td>
<td>
<p>The number of parameters in the model</p>
</td></tr>
<tr><td><code>Df</code></td>
<td>
<p>The decrease in the number of parameter compared the model
in the previous row</p>
</td></tr>
<tr><td><code>ALRTS</code></td>
<td>
<p>The adjusted likelihood ratio test statistic</p>
</td></tr>
<tr><td><code>Pr(&gt;ALRTS)</code></td>
<td>
<p>The p-value associated with the test that the
model is a valid simplification of the model in the previous row.</p>
</td></tr>
</table>
<p>The row names are the names of the model objects.
</p>


<h3>References</h3>

<p>Chandler, R. E. and Bate, S. (2007). Inference for clustered
data using the independence loglikelihood. <em>Biometrika</em>,
<strong>94</strong>(1), 167-183. <a href="https://doi.org/10.1093/biomet/asm015">doi:10.1093/biomet/asm015</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+compare_models">compare_models</a></code> for an adjusted likelihood ratio test
of two models.
</p>
<p><code><a href="#topic+adjust_loglik">adjust_loglik</a></code> to adjust a user-supplied
loglikelihood function.
</p>
<p><code><a href="#topic+conf_intervals">conf_intervals</a></code> for confidence intervals for
individual parameters.
</p>
<p><code><a href="#topic+conf_region">conf_region</a></code> for a confidence region for
pairs of parameters.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># -------------------------- GEV model, owtemps data -----------------------
# ------------ following Section 5.2 of Chandler and Bate (2007) -----------

gev_loglik &lt;- function(pars, data) {
  o_pars &lt;- pars[c(1, 3, 5)] + pars[c(2, 4, 6)]
  w_pars &lt;- pars[c(1, 3, 5)] - pars[c(2, 4, 6)]
  if (isTRUE(o_pars[2] &lt;= 0 | w_pars[2] &lt;= 0)) return(-Inf)
  o_data &lt;- data[, "Oxford"]
  w_data &lt;- data[, "Worthing"]
  check &lt;- 1 + o_pars[3] * (o_data - o_pars[1]) / o_pars[2]
  if (isTRUE(any(check &lt;= 0))) return(-Inf)
  check &lt;- 1 + w_pars[3] * (w_data - w_pars[1]) / w_pars[2]
  if (isTRUE(any(check &lt;= 0))) return(-Inf)
  o_loglik &lt;- log_gev(o_data, o_pars[1], o_pars[2], o_pars[3])
  w_loglik &lt;- log_gev(w_data, w_pars[1], w_pars[2], w_pars[3])
  return(o_loglik + w_loglik)
}

# Initial estimates (method of moments for the Gumbel case)
sigma &lt;- as.numeric(sqrt(6 * diag(var(owtemps))) / pi)
mu &lt;- as.numeric(colMeans(owtemps) - 0.57722 * sigma)
init &lt;- c(mean(mu), -diff(mu) / 2, mean(sigma), -diff(sigma) / 2, 0, 0)

# Log-likelihood adjustment of the full model
par_names &lt;- c("mu[0]", "mu[1]", "sigma[0]", "sigma[1]", "xi[0]", "xi[1]")
large &lt;- adjust_loglik(gev_loglik, data = owtemps, init = init,
         par_names = par_names)

# Log-likelihood adjustment of some smaller models: xi[1] = 0 etc

medium &lt;- adjust_loglik(larger = large, fixed_pars = "xi[1]")
small &lt;- adjust_loglik(larger = medium, fixed_pars = c("sigma[1]", "xi[1]"))
tiny &lt;- adjust_loglik(larger = small,
                      fixed_pars = c("mu[1]", "sigma[1]", "xi[1]"))

anova(large, medium, small, tiny)
</code></pre>

<hr>
<h2 id='coef.chandwich'>Extract model coefficients method for objects of class &quot;chandwich&quot;</h2><span id='topic+coef.chandwich'></span>

<h3>Description</h3>

<p><code>coef</code> method for class &quot;chandwich&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'chandwich'
coef(object, complete = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="coef.chandwich_+3A_object">object</code></td>
<td>
<p>an object of class &quot;chandwich&quot;, a result of a call to
<code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.</p>
</td></tr>
<tr><td><code id="coef.chandwich_+3A_complete">complete</code></td>
<td>
<p>A logical scalar.  If <code>complete = TRUE</code> then the
full vector of parameter estimates is returned, including any fixed
using <code>fixed_pars</code> and <code>fixed_at</code> in the call to
<code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.  Otherwise, only the vector of estimates
of free parameters is returned.
</p>
<p>The default is <code>complete = FALSE</code>, which is in sync with
<code><a href="#topic+vcov.chandwich">vcov.chandwich</a></code>.</p>
</td></tr>
<tr><td><code id="coef.chandwich_+3A_...">...</code></td>
<td>
<p>Additional optional arguments. At present no optional
arguments are used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The full vector of estimates is taken from
<code>attributes(object)$res_MLE</code> and the reduced vector from
<code>attributes(object)$MLE</code>.
</p>


<h3>Value</h3>

<p>A numeric vector of estimated parameters, which will be
named if names were provided in the call to
<code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vcov.chandwich">vcov.chandwich</a></code>: <code>vcov</code> method for
class &quot;chandwich&quot;.
</p>
<p><code><a href="#topic+summary.chandwich">summary.chandwich</a></code>: <code>summary</code> method for
class &quot;chandwich&quot;.
</p>
<p><code><a href="#topic+adjust_loglik">adjust_loglik</a></code> to adjust a user-supplied
loglikelihood.
</p>

<hr>
<h2 id='compare_models'>Comparison of nested models</h2><span id='topic+compare_models'></span>

<h3>Description</h3>

<p>Compares nested models using the adjusted likelihood ratio test statistic
(ALRTS) described in Section 3.5 of Chandler and Bate (2007). The nesting
must result from the simple constraint that a subset of the parameters of
the larger model is held fixed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compare_models(
  larger,
  smaller = NULL,
  approx = FALSE,
  type = c("vertical", "cholesky", "spectral", "none"),
  fixed_pars = NULL,
  fixed_at = rep_len(0, length(fixed_pars)),
  init = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compare_models_+3A_larger">larger</code></td>
<td>
<p>An object of class <code>"chandwich"</code> returned by
<code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.  The larger of the two models.</p>
</td></tr>
<tr><td><code id="compare_models_+3A_smaller">smaller</code></td>
<td>
<p>An object of class <code>"chandwich"</code> returned by
<code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.  The smaller of the two models.
</p>
<p>If <code>smaller</code> is supplied then the arguments <code>fixed_pars</code> and
<code>fixed_at</code> described below are ignored.</p>
</td></tr>
<tr><td><code id="compare_models_+3A_approx">approx</code></td>
<td>
<p>A logical scalar.  If <code>approx = TRUE</code> then the
approximation detailed by equations (18)-(20) of Chandler and Bate (2007)
is used.  This option is available only if <code>smaller</code> is supplied.
If <code>smaller</code> is not supplied then <code>approx = TRUE</code> is used,
with no warning.
</p>
<p>The approximation doesn't make sense if <code>type = "none"</code>.  If
<code>type = "none"</code> and <code>approx = TRUE</code> then <code>approx</code> is
set to <code>FALSE</code> with no warning.
</p>
<p>If <code>approx = FALSE</code> then the adjusted likelihood is
maximised under the restriction imposed by <code>delta</code>, that is,
equation (17) of Chandler and Bate (2007) is used.</p>
</td></tr>
<tr><td><code id="compare_models_+3A_type">type</code></td>
<td>
<p>A character scalar.  The argument <code>type</code> to the function
returned by <code><a href="#topic+adjust_loglik">adjust_loglik</a></code>, that is, the type of adjustment
made to the independence loglikelihood function.</p>
</td></tr>
<tr><td><code id="compare_models_+3A_fixed_pars">fixed_pars</code></td>
<td>
<p>A numeric vector.  Indices of the components of the
<strong>full</strong> parameter vector that are restricted to be equal to the
value(s) in <code>fixed_at</code>.</p>
</td></tr>
<tr><td><code id="compare_models_+3A_fixed_at">fixed_at</code></td>
<td>
<p>A numeric vector of length 1 or <code>length(fixed_pars)</code>.
If <code>length(fixed_at) = 1</code> then the components <code>fixed_pars</code>
of the parameter vector are all fixed at <code>fixed_at</code>.
If <code>length(fixed_at) = length(fixed_pars)</code> then the component
<code>fixed_pars[i]</code> is fixed at <code>fixed_at[i]</code> for each <code>i</code>.</p>
</td></tr>
<tr><td><code id="compare_models_+3A_init">init</code></td>
<td>
<p>(Only relevant if <code>approx = FALSE</code>).
A numeric vector of initial values for use in the search for
the MLE under the smaller model.  Must have length equal to the number
of parameters in the smaller of the two models being compared.  If
<code>init</code> is not supplied, or it is of the wrong length, then
<code>attr(smaller, "MLE")</code> is used if <code>smaller</code> is supplied and
<code>attr(larger, "MLE")[-fixed_pars]</code> otherwise.</p>
</td></tr>
<tr><td><code id="compare_models_+3A_...">...</code></td>
<td>
<p>Further arguments to be passed to <code><a href="stats.html#topic+optim">optim</a></code>.
These may include <code>gr</code>, <code>method</code>, <code>lower</code>, <code>upper</code>
or <code>control</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The smaller of the two models is specified either by supplying
<code>smaller</code> or <code>fixed_pars</code>.  If both are supplied then
<code>smaller</code> takes precedence.
</p>
<p>For full details see Section 3.5 of Chandler and Bate (2007).
If <code>approx = FALSE</code> then the a likelihood ratio test of the null
hypothesis that the smaller model is a valid simplification of the larger
model is carried out directly using equation (17) of Chandler and Bate
(2007) based on the adjusted loglikelihood under the larger model,
returned by <code>adjust_loglik</code>.  This adjusted loglikelihood is
maximised subject to the constraint that a subset of the parameters
in the larger model are fixed.  If <code>smaller</code> is supplied
then this maximisation can be avoided using an approximation
detailed by equations (18)-(20) of Chandler and Bate (2007), which uses
the MLE under the smaller model.  The same null distribution (chi-squared
with degrees of freedom equal to the number of parameters that are fixed)
is used in both cases.
</p>


<h3>Value</h3>

<p>An object of class &quot;compmod&quot;, a list with components
</p>
<table role = "presentation">
<tr><td><code>alrts</code></td>
<td>
<p>the adjusted likelihood ratio test statistic.</p>
</td></tr>
<tr><td><code>df</code></td>
<td>
<p>under the null hypothesis that the smaller model is a valid
simplification of the larger model the adjusted likelihood ratio
test statistic has a chi-squared distribution with <code>df</code>
degrees of freedom.</p>
</td></tr>
<tr><td><code>p_value</code></td>
<td>
<p>the p-value associated with the test of the null
hypothesis.</p>
</td></tr>
<tr><td><code>larger_mle</code></td>
<td>
<p>the MLE of the parameters under the larger model.</p>
</td></tr>
<tr><td><code>smaller_mle</code></td>
<td>
<p>the MLE of the parameters under the smaller model.</p>
</td></tr>
<tr><td><code>larger_fixed_pars</code>, <code>smaller_fixed_pars</code></td>
<td>
<p>Numeric vectors of the
indices of parameters fixed in the larger and smaller models,
respectively.</p>
</td></tr>
<tr><td><code>larger_fixed_at</code>, <code>smaller_fixed_at</code></td>
<td>
<p>Numeric vectors of the
values at which the parameters in <code>larger_fixed_pars</code> and
<code>smaller_fixed_pars</code> are fixed.</p>
</td></tr>
<tr><td><code>approx</code></td>
<td>
<p>the argument <code>approx</code>.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Chandler, R. E. and Bate, S. (2007). Inference for clustered
data using the independence loglikelihood. <em>Biometrika</em>,
<strong>94</strong>(1), 167-183. <a href="https://doi.org/10.1093/biomet/asm015">doi:10.1093/biomet/asm015</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+adjust_loglik">adjust_loglik</a></code> to adjust a user-supplied
loglikelihood function.
</p>
<p><code><a href="#topic+conf_intervals">conf_intervals</a></code> for confidence intervals for
individual parameters.
</p>
<p><code><a href="#topic+conf_region">conf_region</a></code> for a confidence region for
pairs of parameters.
</p>
<p><code><a href="#topic+print.compmod">print.compmod</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># -------------------------- GEV model, owtemps data -----------------------
# ------------ following Section 5.2 of Chandler and Bate (2007) -----------

gev_loglik &lt;- function(pars, data) {
  o_pars &lt;- pars[c(1, 3, 5)] + pars[c(2, 4, 6)]
  w_pars &lt;- pars[c(1, 3, 5)] - pars[c(2, 4, 6)]
  if (isTRUE(o_pars[2] &lt;= 0 | w_pars[2] &lt;= 0)) return(-Inf)
  o_data &lt;- data[, "Oxford"]
  w_data &lt;- data[, "Worthing"]
  check &lt;- 1 + o_pars[3] * (o_data - o_pars[1]) / o_pars[2]
  if (isTRUE(any(check &lt;= 0))) return(-Inf)
  check &lt;- 1 + w_pars[3] * (w_data - w_pars[1]) / w_pars[2]
  if (isTRUE(any(check &lt;= 0))) return(-Inf)
  o_loglik &lt;- log_gev(o_data, o_pars[1], o_pars[2], o_pars[3])
  w_loglik &lt;- log_gev(w_data, w_pars[1], w_pars[2], w_pars[3])
  return(o_loglik + w_loglik)
}

# Initial estimates (method of moments for the Gumbel case)
sigma &lt;- as.numeric(sqrt(6 * diag(var(owtemps))) / pi)
mu &lt;- as.numeric(colMeans(owtemps) - 0.57722 * sigma)
init &lt;- c(mean(mu), -diff(mu) / 2, mean(sigma), -diff(sigma) / 2, 0, 0)

# Log-likelihood adjustment of the full model
par_names &lt;- c("mu[0]", "mu[1]", "sigma[0]", "sigma[1]", "xi[0]", "xi[1]")
large &lt;- adjust_loglik(gev_loglik, data = owtemps, init = init,
         par_names = par_names)

# Log-likelihood adjustment of some smaller models: xi[1] = 0 etc

medium &lt;- adjust_loglik(larger = large, fixed_pars = "xi[1]")
small &lt;- adjust_loglik(larger = medium, fixed_pars = c("sigma[1]", "xi[1]"))

# Tests

# Test xi1 = 0 (2 equivalent ways), vertical adjustment
compare_models(large, fixed_pars = "xi[1]")
compare_models(large, medium)
# Test xi1 = 0, using approximation
compare_models(large, medium, approx = TRUE)

# Horizontal adjustments
compare_models(large, medium, type = "cholesky")$p_value
compare_models(large, medium, type = "spectral")$p_value
# No adjustment (independence loglikelihood)
compare_models(large, medium, type = "none")$p_value

# Test sigma1 = 0 for model with xi1 = 0
compare_models(medium, small)
# Test sigma1 = xi1 = 0
compare_models(large, small)

# --------- Misspecified Poisson model for negative binomial data ----------

# ... following Section 5.1 of the "Object-Oriented Computation of Sandwich
# Estimators" vignette of the sandwich package
# https://cran.r-project.org/web/packages/sandwich/vignettes/sandwich-OOP.pdf

# Simulate data
set.seed(123)
x &lt;- rnorm(250)
y &lt;- rnbinom(250, mu = exp(1 + x), size = 1)
# Fit misspecified Poisson model
fm_pois &lt;- glm(y ~ x + I(x^2), family = poisson)
summary(fm_pois)$coefficients

# Contributions to the independence loglikelihood
pois_glm_loglik &lt;- function(pars, y, x) {
  log_mu &lt;- pars[1] + pars[2] * x + pars[3] * x ^ 2
  return(dpois(y, lambda = exp(log_mu), log = TRUE))
}
pars &lt;- c("alpha", "beta", "gamma")
pois_quad &lt;- adjust_loglik(pois_glm_loglik, y = y, x = x, par_names = pars)
summary(pois_quad)

pois_lin &lt;- adjust_loglik(larger = pois_quad, fixed_pars = "gamma")

# Test the significance of the quadratic term
compare_models(pois_quad, pois_lin)$p_value
compare_models(pois_quad, pois_lin, approx = TRUE)$p_value
</code></pre>

<hr>
<h2 id='conf_intervals'>Confidence intervals</h2><span id='topic+conf_intervals'></span>

<h3>Description</h3>

<p>Calculates confidence intervals for individual parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>conf_intervals(
  object,
  which_pars = NULL,
  init = NULL,
  conf = 95,
  mult = 1.5,
  num = 10,
  type = c("vertical", "cholesky", "spectral", "none"),
  profile = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="conf_intervals_+3A_object">object</code></td>
<td>
<p>An object of class <code>"chandwich"</code> returned by
<code>adjust_loglik</code>.</p>
</td></tr>
<tr><td><code id="conf_intervals_+3A_which_pars">which_pars</code></td>
<td>
<p>A vector specifying the (unfixed) parameters for which
confidence intervals are required.  Can be either a numeric vector,
specifying indices of the components of the <strong>full</strong> parameter
vector, or a character vector of parameter names, which must be a subset
of those supplied in <code>par_names</code> in the call to
<code><a href="#topic+adjust_loglik">adjust_loglik</a></code> that produced <code>object</code>.
</p>
<p><code>which_pars</code> must not have any parameters in common with
<code>attr(object, "fixed_pars")</code>.  <code>which_pars</code> must not contain
all of the unfixed parameters, i.e. there is no point in profiling over
all the unfixed parameters.
</p>
<p>If missing, all parameters are included.</p>
</td></tr>
<tr><td><code id="conf_intervals_+3A_init">init</code></td>
<td>
<p>A numeric vector of initial estimates of the values of the
parameters that are not fixed and are not in <code>which_pars</code>.
Should have length <code>attr(object, "p_current") - length(which_pars)</code>.
If <code>init</code> is <code>NULL</code> or is of the wrong length then the
relevant components from the MLE stored in <code>object</code> are used.</p>
</td></tr>
<tr><td><code id="conf_intervals_+3A_conf">conf</code></td>
<td>
<p>A numeric scalar in (0, 100). Confidence level for the
intervals.</p>
</td></tr>
<tr><td><code id="conf_intervals_+3A_mult">mult</code></td>
<td>
<p>A numeric vector of length 1 or the same length as
<code>which_pars</code>.
The search for the profile loglikelihood-based confidence limits is
conducted over the corresponding symmetric confidence intervals
(based on approximate normal theory), extended
by a factor of the corresponding component of <code>mult</code>.</p>
</td></tr>
<tr><td><code id="conf_intervals_+3A_num">num</code></td>
<td>
<p>A numeric scalar.  The number of values at which to evaluate the
profile loglikelihood either side of the MLE.  Increasing <code>num</code>
increases the accuracy of the confidence limits, but the code will take
longer to run.</p>
</td></tr>
<tr><td><code id="conf_intervals_+3A_type">type</code></td>
<td>
<p>A character scalar.  The argument <code>type</code> to the function
returned by <code><a href="#topic+adjust_loglik">adjust_loglik</a></code>, that is, the type of adjustment
made to the independence loglikelihood function.</p>
</td></tr>
<tr><td><code id="conf_intervals_+3A_profile">profile</code></td>
<td>
<p>A logical scalar.  If <code>FALSE</code> then only intervals based
on approximate large sample normal theory, which are symmetric about the
MLE, are returned (in <code>sym_CI</code>) and <code>prof_CI</code> in the returned
object will contain <code>NA</code>s.</p>
</td></tr>
<tr><td><code id="conf_intervals_+3A_...">...</code></td>
<td>
<p>Further arguments to be passed to <code><a href="stats.html#topic+optim">optim</a></code>.
These may include <code>gr</code>, <code>method</code>, <code>lower</code>, <code>upper</code>
or <code>control</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Calculates (profile, if necessary) likelihood-based confidence
intervals for individual parameters, and also provides symmetric intervals
based on a normal approximation to the sampling distribution of the
estimator.  See also the S3 confint method
<code><a href="#topic+confint.chandwich">confint.chandwich</a></code>.
</p>


<h3>Value</h3>

<p>An object of class &quot;confint&quot;, a list with components
</p>
<table role = "presentation">
<tr><td><code>conf</code></td>
<td>
<p>The argument <code>conf</code>.</p>
</td></tr>
<tr><td><code>cutoff</code></td>
<td>
<p>A numeric scalar.  For values inside the
confidence interval the profile loglikelihood lies above
<code>cutoff</code>.</p>
</td></tr>
<tr><td><code>parameter_vals</code>, <code>prof_loglik_vals</code></td>
<td>
<p><code>2 * num + 1</code> by
<code>length(which_pars)</code> numeric matrices.
Column i of <code>parameter_vals</code> contains the profiled values of
parameter <code>which_par[i]</code>.  Column i of <code>prof_loglik_vals</code>
contains the corresponding values of the profile loglikelihood.</p>
</td></tr>
<tr><td><code>sym_CI</code>, <code>prof_CI</code></td>
<td>
<p><code>length(which_pars)</code>
by 2 numeric matrices.  Row i of <code>sym_CI</code> (<code>prof_CI</code>)
contains the symmetric (profile loglikelihood-based) confidence
intervals for parameter <code>which_pars[i]</code>.</p>
</td></tr></table>
<p>  If a value in
<code>prof_CI</code> is <code>NA</code> then this means that the search for the
confidence limit did no extend far enough.  A remedy is to increase
the value of <code>mult</code>, or the relevant component of <code>mult</code>,
and perhaps also increase <code>num</code>.
</p>
<table role = "presentation">
<tr><td><code>max_loglik</code></td>
<td>
<p>The value of the adjusted loglikelihood
at its maximum, stored in <code>object$max_loglik</code>.</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>The argument <code>type</code> supplied in the call
to <code>conf_intervals</code>, i.e. the type of loglikelihood adjustment.</p>
</td></tr>
<tr><td><code>which_pars</code></td>
<td>
<p>The argument <code>which_pars</code>.</p>
</td></tr>
<tr><td><code>name</code></td>
<td>
<p>A character scalar. The name of the model,
stored in <code>attr(object, "name")</code>.</p>
</td></tr>
<tr><td><code>p_current</code></td>
<td>
<p>The number of free parameters in the current model.</p>
</td></tr>
<tr><td><code>fixed_pars</code>, <code>fixed_at</code></td>
<td>
<p><code>attr(object, "fixed_pars")</code> and
<code>attr(object, "fixed_at")</code>, the arguments <code>fixed_pars</code> and
<code>fixed_at</code> to <code><a href="#topic+adjust_loglik">adjust_loglik</a></code>, if these were
supplied.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+confint.chandwich">confint.chandwich</a></code> S3 confint method for objects
of class <code>"chandwich"</code> returned from <code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.
</p>
<p><code><a href="#topic+adjust_loglik">adjust_loglik</a></code> to adjust a user-supplied
loglikelihood function.
</p>
<p><code><a href="#topic+summary.chandwich">summary.chandwich</a></code> for maximum likelihood estimates
and unadjusted and adjusted standard errors.
</p>
<p><code><a href="#topic+plot.chandwich">plot.chandwich</a></code> for plots of one-dimensional adjusted
loglikelihoods.
</p>
<p><code><a href="#topic+conf_region">conf_region</a></code> for a confidence region for
a pair of parameters.
</p>
<p><code><a href="#topic+compare_models">compare_models</a></code> to compare nested models using an
(adjusted) likelihood ratio test.
</p>
<p><code><a href="#topic+plot.confint">plot.confint</a></code>, <code><a href="#topic+print.confint">print.confint</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># ------------------------- Binomial model, rats data ----------------------

# Contributions to the independence loglikelihood
binom_loglik &lt;- function(prob, data) {
  if (prob &lt; 0 || prob &gt; 1) {
    return(-Inf)
  }
  return(dbinom(data[, "y"], data[, "n"], prob, log = TRUE))
}
rat_res &lt;- adjust_loglik(loglik = binom_loglik, data = rats, par_names = "p")

# 95% likelihood-based confidence intervals, vertically adjusted
ci &lt;- conf_intervals(rat_res)
plot(ci)
# Unadjusted
conf_intervals(rat_res, type = "none")

# -------------------------- GEV model, owtemps data -----------------------
# ------------ following Section 5.2 of Chandler and Bate (2007) -----------

gev_loglik &lt;- function(pars, data) {
  o_pars &lt;- pars[c(1, 3, 5)] + pars[c(2, 4, 6)]
  w_pars &lt;- pars[c(1, 3, 5)] - pars[c(2, 4, 6)]
  if (isTRUE(o_pars[2] &lt;= 0 | w_pars[2] &lt;= 0)) return(-Inf)
  o_data &lt;- data[, "Oxford"]
  w_data &lt;- data[, "Worthing"]
  check &lt;- 1 + o_pars[3] * (o_data - o_pars[1]) / o_pars[2]
  if (isTRUE(any(check &lt;= 0))) return(-Inf)
  check &lt;- 1 + w_pars[3] * (w_data - w_pars[1]) / w_pars[2]
  if (isTRUE(any(check &lt;= 0))) return(-Inf)
  o_loglik &lt;- log_gev(o_data, o_pars[1], o_pars[2], o_pars[3])
  w_loglik &lt;- log_gev(w_data, w_pars[1], w_pars[2], w_pars[3])
  return(o_loglik + w_loglik)
}

# Initial estimates (method of moments for the Gumbel case)
sigma &lt;- as.numeric(sqrt(6 * diag(var(owtemps))) / pi)
mu &lt;- as.numeric(colMeans(owtemps) - 0.57722 * sigma)
init &lt;- c(mean(mu), -diff(mu) / 2, mean(sigma), -diff(sigma) / 2, 0, 0)

# Log-likelihood adjustment of the full model
par_names &lt;- c("mu[0]", "mu[1]", "sigma[0]", "sigma[1]", "xi[0]", "xi[1]")
large &lt;- adjust_loglik(gev_loglik, data = owtemps, init = init,
                       par_names = par_names)

# 95% likelihood-based confidence intervals, vertically adjusted
large_v &lt;- conf_intervals(large, which_pars = c("xi[0]", "xi[1]"))
large_v
plot(large_v)
plot(large_v, which_par = "xi[1]")

# Unadjusted
large_none &lt;- conf_intervals(large, which_pars = c("xi[0]", "xi[1]"),
                             type = "none")
large_none
plot(large_v, large_none)
plot(large_v, large_none, which_par = "xi[1]")


# --------- Misspecified Poisson model for negative binomial data ----------

# ... following Section 5.1 of the "Object-Oriented Computation of Sandwich
# Estimators" vignette of the sandwich package
# https://cran.r-project.org/web/packages/sandwich/vignettes/sandwich-OOP.pdf

# Simulate data
set.seed(123)
x &lt;- rnorm(250)
y &lt;- rnbinom(250, mu = exp(1 + x), size = 1)
# Fit misspecified Poisson model
fm_pois &lt;- glm(y ~ x + I(x^2), family = poisson)
summary(fm_pois)$coefficients

# Contributions to the independence loglikelihood
pois_glm_loglik &lt;- function(pars, y, x) {
  log_mu &lt;- pars[1] + pars[2] * x + pars[3] * x ^ 2
  return(dpois(y, lambda = exp(log_mu), log = TRUE))
}
pars &lt;- c("alpha", "beta", "gamma")
pois_quad &lt;- adjust_loglik(pois_glm_loglik, y = y, x = x, par_names = pars)
conf_intervals(pois_quad)
</code></pre>

<hr>
<h2 id='conf_region'>Two-dimensional confidence regions</h2><span id='topic+conf_region'></span>

<h3>Description</h3>

<p>Calculates the (profile, if necessary) loglikelihood for a pair of
parameters from which confidence regions can be plotted using
<code><a href="#topic+plot.confreg">plot.confreg</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>conf_region(
  object,
  which_pars = NULL,
  range1 = c(NA, NA),
  range2 = c(NA, NA),
  conf = 95,
  mult = 2,
  num = c(10, 10),
  type = c("vertical", "cholesky", "spectral", "none"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="conf_region_+3A_object">object</code></td>
<td>
<p>An object of class <code>"chandwich"</code> returned by
<code>adjust_loglik</code>.</p>
</td></tr>
<tr><td><code id="conf_region_+3A_which_pars">which_pars</code></td>
<td>
<p>A vector of length 2 specifying the 2 (unfixed)
parameters for which confidence region is required.
Can be either a numeric vector, specifying indices of the components
of the <strong>full</strong> parameter vector, or a character vector of
parameter names, which must be a subset of those supplied in
<code>par_names</code> in the call to <code><a href="#topic+adjust_loglik">adjust_loglik</a></code> that
produced <code>object</code>.
</p>
<p><code>which_pars</code> must not have any parameters in common with
<code>attr(object, "fixed_pars")</code>.  <code>which_pars</code> must not contain
all of the unfixed parameters, i.e. there is no point in profiling over
all the unfixed parameters.
</p>
<p>If <code>which_pars</code> is not supplied but the current model has exactly
two free parameters, i.e. <code>attr(object, "p_current") = 2</code> then
<code>which_pars</code> is set to <code>attr(object, "free_pars") = 2</code>.</p>
</td></tr>
<tr><td><code id="conf_region_+3A_range1">range1</code>, <code id="conf_region_+3A_range2">range2</code></td>
<td>
<p>Numeric vectors of length 2.  Respective ranges (of
the form <code>c(lower, upper)</code>) of values of <code>which_pars[1]</code> and
<code>which_pars[2]</code> over which to profile.
Missing values in <code>range1</code> and/or <code>range2</code> are
filled in using <code>conf</code> and <code>mult</code>.  See below for details.</p>
</td></tr>
<tr><td><code id="conf_region_+3A_conf">conf</code></td>
<td>
<p>A numeric scalar in (0, 100).  The highest confidence level
of interest. This is only relevant if <code>range1</code> and/or <code>range2</code>
are not completely specified.  In that event <code>conf</code> is used,
in combination with <code>mult</code>, to try to set up the grid of parameter
values to include the largest confidence region of interest.</p>
</td></tr>
<tr><td><code id="conf_region_+3A_mult">mult</code></td>
<td>
<p>A numeric vector of length 1 or the same length as
<code>which_pars</code>.
The search for the profile loglikelihood-based confidence limits is
conducted over the corresponding symmetric confidence intervals
(based on approximate normal theory), extended
by a factor of the corresponding component of <code>mult</code>.</p>
</td></tr>
<tr><td><code id="conf_region_+3A_num">num</code></td>
<td>
<p>A numeric vector of length 1 or 2.  The numbers of values at which
to evaluate the profile loglikelihood either side of the MLE.
<code>num[i]</code> relates to <code>which_pars[i]</code>.  If <code>num</code> has length
1 then <code>num</code> is replicated to have length 2.</p>
</td></tr>
<tr><td><code id="conf_region_+3A_type">type</code></td>
<td>
<p>A character scalar.  The argument <code>type</code> to the function
returned by <code><a href="#topic+adjust_loglik">adjust_loglik</a></code>, that is, the type of adjustment
made to the independence loglikelihood function.</p>
</td></tr>
<tr><td><code id="conf_region_+3A_...">...</code></td>
<td>
<p>Further arguments to be passed to <code><a href="stats.html#topic+optim">optim</a></code>.
These may include <code>gr</code>, <code>method</code>, <code>lower</code>, <code>upper</code>
or <code>control</code>.  Any arguments that are not appropriate for
<code><a href="stats.html#topic+optim">optim</a></code>, i.e. not in
<code>methods::formalArgs(stats::optim)</code>,
will be removed without warning.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class &quot;confreg&quot;, a list with components
</p>
<table role = "presentation">
<tr><td><code>grid1</code>, <code>grid2</code></td>
<td>
<p>Numeric vectors.   Respective values of
<code>which_pars[1]</code> and <code>which_pars[2]</code> in the grid over which
the (profile) loglikelihood is evaluated. </p>
</td></tr>
<tr><td><code>max_loglik</code></td>
<td>
<p>A numeric scalar.  The value value of
the loglikelihood at its maximum.</p>
</td></tr>
<tr><td><code>prof_loglik</code></td>
<td>
<p>An 2 <code>num</code> + 1 by 2 <code>num</code> + 1
numeric matrix containing the values of the (profile) loglikelihood.</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>A character scalar. The input <code>type</code>.</p>
</td></tr>
<tr><td><code>which_pars</code></td>
<td>
<p>A numeric or character vector.  The input
<code>which_pars</code>.  If the <code>which_pars</code> was numeric then
it is supplemented by the parameter names, if these are available
in <code>object</code>.</p>
</td></tr>
<tr><td><code>name</code></td>
<td>
<p>A character scalar. The name of the model,
stored in <code>attr(object, "name")</code>.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+adjust_loglik">adjust_loglik</a></code> to adjust a user-supplied
loglikelihood function.
</p>
<p><code><a href="#topic+conf_intervals">conf_intervals</a></code> for confidence intervals for
individual parameters.
</p>
<p><code><a href="#topic+compare_models">compare_models</a></code> to compare nested models using an
(adjusted) likelihood ratio test.
</p>
<p><code><a href="#topic+plot.confreg">plot.confreg</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># -------------------------- GEV model, owtemps data -----------------------
# ------------ following Section 5.2 of Chandler and Bate (2007) -----------

gev_loglik &lt;- function(pars, data) {
  o_pars &lt;- pars[c(1, 3, 5)] + pars[c(2, 4, 6)]
  w_pars &lt;- pars[c(1, 3, 5)] - pars[c(2, 4, 6)]
  if (isTRUE(o_pars[2] &lt;= 0 | w_pars[2] &lt;= 0)) return(-Inf)
  o_data &lt;- data[, "Oxford"]
  w_data &lt;- data[, "Worthing"]
  check &lt;- 1 + o_pars[3] * (o_data - o_pars[1]) / o_pars[2]
  if (isTRUE(any(check &lt;= 0))) return(-Inf)
  check &lt;- 1 + w_pars[3] * (w_data - w_pars[1]) / w_pars[2]
  if (isTRUE(any(check &lt;= 0))) return(-Inf)
  o_loglik &lt;- log_gev(o_data, o_pars[1], o_pars[2], o_pars[3])
  w_loglik &lt;- log_gev(w_data, w_pars[1], w_pars[2], w_pars[3])
  return(o_loglik + w_loglik)
}

# Initial estimates (method of moments for the Gumbel case)
sigma &lt;- as.numeric(sqrt(6 * diag(var(owtemps))) / pi)
mu &lt;- as.numeric(colMeans(owtemps) - 0.57722 * sigma)
init &lt;- c(mean(mu), -diff(mu) / 2, mean(sigma), -diff(sigma) / 2, 0, 0)

# Log-likelihood adjustment of the full model
par_names &lt;- c("mu[0]", "mu[1]", "sigma[0]", "sigma[1]", "xi[0]", "xi[1]")
large &lt;- adjust_loglik(gev_loglik, data = owtemps, init = init,
                       par_names = par_names)


# Plots like those in Figure 4 of Chandler and Bate (2007)
# (a)
which_pars &lt;- c("mu[0]", "mu[1]")
reg_1 &lt;- conf_region(large, which_pars = which_pars)
reg_none_1 &lt;- conf_region(large, which_pars = which_pars, type = "none")
plot(reg_1, reg_none_1)
# (b)
which_pars &lt;- c("sigma[0]", "sigma[1]")
reg_2 &lt;- conf_region(large, which_pars = which_pars)
reg_none_2 &lt;- conf_region(large, which_pars = which_pars, type = "none")
plot(reg_2, reg_none_2)
# (c)
# Note: the naive and bivariate model contours are the reversed in the paper
which_pars &lt;- c("sigma[0]", "xi[0]")
reg_3 &lt;- conf_region(large, which_pars = which_pars)
reg_none_3 &lt;- conf_region(large, which_pars = which_pars, type = "none")
plot(reg_3, reg_none_3)


# --------- Misspecified Poisson model for negative binomial data ----------

# ... following Section 5.1 of the "Object-Oriented Computation of Sandwich
# Estimators" vignette of the sandwich package
# https://cran.r-project.org/web/packages/sandwich/vignettes/sandwich-OOP.pdf

# Simulate data
set.seed(123)
x &lt;- rnorm(250)
y &lt;- rnbinom(250, mu = exp(1 + x), size = 1)
# Fit misspecified Poisson model
fm_pois &lt;- glm(y ~ x + I(x^2), family = poisson)
summary(fm_pois)$coefficients

# Contributions to the independence loglikelihood
pois_glm_loglik &lt;- function(pars, y, x) {
  log_mu &lt;- pars[1] + pars[2] * x + pars[3] * x ^ 2
  return(dpois(y, lambda = exp(log_mu), log = TRUE))
}
pars &lt;- c("alpha", "beta", "gamma")
# Linear model (gamma fixed at 0)
pois_lin &lt;- adjust_loglik(pois_glm_loglik, y = y, x = x, par_names = pars,
                          fixed_pars = "gamma")
pois_vertical &lt;- conf_region(pois_lin)
pois_none &lt;- conf_region(pois_lin, type = "none")
plot(pois_none, pois_vertical, conf = c(50, 75, 95, 99), col = 2:1, lwd = 2,
     lty = 1)
</code></pre>

<hr>
<h2 id='confint.chandwich'>Confidence intervals for model parameters</h2><span id='topic+confint.chandwich'></span>

<h3>Description</h3>

<p><code>confint</code> method for objects of class <code>"chandwich"</code>.
Computes confidence intervals for one or more model parameters based
on an object returned from <code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'chandwich'
confint(
  object,
  parm,
  level = 0.95,
  type = c("vertical", "cholesky", "spectral", "none"),
  profile = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="confint.chandwich_+3A_object">object</code></td>
<td>
<p>An object of class <code>"chandwich"</code>, returned by
<code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.</p>
</td></tr>
<tr><td><code id="confint.chandwich_+3A_parm">parm</code></td>
<td>
<p>A vector specifying the (unfixed) parameters for which
confidence intervals are required.
If missing, all parameters are included.
</p>
<p>Can be either a numeric vector,
specifying indices of the components of the <strong>full</strong> parameter
vector, or a character vector of parameter names, which must be a subset
of those supplied in <code>par_names</code> in the call to
<code><a href="#topic+adjust_loglik">adjust_loglik</a></code> that produced <code>object</code>.
</p>
<p><code>parm</code> must not have any parameters in common with
<code>attr(object, "fixed_pars")</code>.  <code>parm</code> must not contain
all of the unfixed parameters, i.e. there is no point in profiling over
all the unfixed parameters.</p>
</td></tr>
<tr><td><code id="confint.chandwich_+3A_level">level</code></td>
<td>
<p>The confidence level required.  A numeric scalar in (0, 1).</p>
</td></tr>
<tr><td><code id="confint.chandwich_+3A_type">type</code></td>
<td>
<p>A character scalar.  The argument <code>type</code> to the function
returned by <code><a href="#topic+adjust_loglik">adjust_loglik</a></code>, that is, the type of adjustment
made to the independence loglikelihood function.</p>
</td></tr>
<tr><td><code id="confint.chandwich_+3A_profile">profile</code></td>
<td>
<p>A logical scalar. If <code>TRUE</code> then confidence intervals
based on an (adjusted) profile loglikelihood are returned.  If
<code>FALSE</code> then intervals based on approximate large sample normal
theory, which are symmetric about the MLE, are returned.</p>
</td></tr>
<tr><td><code id="confint.chandwich_+3A_...">...</code></td>
<td>
<p>Further arguments to be passed to <code><a href="#topic+conf_intervals">conf_intervals</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For details see the documentation for the function
<code><a href="#topic+conf_intervals">conf_intervals</a></code>, on which <code>confint.chandwich</code> is based.
</p>


<h3>Value</h3>

<p>A matrix with columns giving lower and upper confidence limits for
each parameter. These will be labelled as (1 - level)/2 and
1 - (1 - level)/2 in % (by default 2.5% and 97.5%).
The row names are the names of the model parameters,
if these are available.
</p>


<h3>See Also</h3>

<p>The underlying function <code><a href="#topic+conf_intervals">conf_intervals</a></code>.  If you would
like to plot the profile loglikelihood function for a parameter then call
<code><a href="#topic+conf_intervals">conf_intervals</a></code> directly and then use the associated plot
method.  Note that in <code>conf_intervals()</code> a parameter choice is
specified using an argument called <code>which_pars</code>, not <code>parm</code>.
</p>
<p><code><a href="#topic+conf_region">conf_region</a></code> for a confidence region for
pairs of parameters.
</p>
<p><code><a href="#topic+compare_models">compare_models</a></code> for an adjusted likelihood ratio test
of two models.
</p>
<p><code><a href="#topic+adjust_loglik">adjust_loglik</a></code> to adjust a user-supplied
loglikelihood function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># -------------------------- GEV model, owtemps data -----------------------
# ------------ following Section 5.2 of Chandler and Bate (2007) -----------

gev_loglik &lt;- function(pars, data) {
  o_pars &lt;- pars[c(1, 3, 5)] + pars[c(2, 4, 6)]
  w_pars &lt;- pars[c(1, 3, 5)] - pars[c(2, 4, 6)]
  if (isTRUE(o_pars[2] &lt;= 0 | w_pars[2] &lt;= 0)) return(-Inf)
  o_data &lt;- data[, "Oxford"]
  w_data &lt;- data[, "Worthing"]
  check &lt;- 1 + o_pars[3] * (o_data - o_pars[1]) / o_pars[2]
  if (isTRUE(any(check &lt;= 0))) return(-Inf)
  check &lt;- 1 + w_pars[3] * (w_data - w_pars[1]) / w_pars[2]
  if (isTRUE(any(check &lt;= 0))) return(-Inf)
  o_loglik &lt;- log_gev(o_data, o_pars[1], o_pars[2], o_pars[3])
  w_loglik &lt;- log_gev(w_data, w_pars[1], w_pars[2], w_pars[3])
  return(o_loglik + w_loglik)
}

# Initial estimates (method of moments for the Gumbel case)
sigma &lt;- as.numeric(sqrt(6 * diag(var(owtemps))) / pi)
mu &lt;- as.numeric(colMeans(owtemps) - 0.57722 * sigma)
init &lt;- c(mean(mu), -diff(mu) / 2, mean(sigma), -diff(sigma) / 2, 0, 0)

# Log-likelihood adjustment of the full model
par_names &lt;- c("mu[0]", "mu[1]", "sigma[0]", "sigma[1]", "xi[0]", "xi[1]")
large &lt;- adjust_loglik(gev_loglik, data = owtemps, init = init,
                       par_names = par_names)
confint(large)
confint(large, profile = FALSE)
</code></pre>

<hr>
<h2 id='log_gev'>The Generalised Extreme Value Log-Density Function</h2><span id='topic+log_gev'></span>

<h3>Description</h3>

<p>Log-Density function of the generalised extreme value (GEV) distribution
</p>


<h3>Usage</h3>

<pre><code class='language-R'>log_gev(x, loc = 0, scale = 1, shape = 0)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="log_gev_+3A_x">x</code></td>
<td>
<p>Numeric vectors of quantiles.</p>
</td></tr>
<tr><td><code id="log_gev_+3A_loc">loc</code>, <code id="log_gev_+3A_scale">scale</code>, <code id="log_gev_+3A_shape">shape</code></td>
<td>
<p>Numeric scalars.
Location, scale and shape parameters.
<code>scale</code> must be positive.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>It is assumed that <code>x</code>, <code>loc</code> = <code class="reqn">\mu</code>,
<code>scale</code> = <code class="reqn">\sigma</code> and <code>shape</code> = <code class="reqn">\xi</code> are such that
the GEV density is non-zero, i.e. that
<code class="reqn">1 + \xi (x - \mu) / \sigma &gt; 0</code>. No check of this, or that
<code>scale</code> &gt; 0 is performed in this function.</strong>
</p>
<p>The distribution function of a GEV distribution with parameters
<code>loc</code> = <code class="reqn">\mu</code>, <code>scale</code> = <code class="reqn">\sigma</code> (&gt;0) and
<code>shape</code> = <code class="reqn">\xi</code> is
</p>
<p style="text-align: center;"><code class="reqn">F(x) = exp { - [1 + \xi (x - \mu) / \sigma] ^ (-1/\xi)} </code>
</p>

<p>for <code class="reqn">1 + \xi (x - \mu) / \sigma &gt; 0</code>.  If <code class="reqn">\xi = 0</code> the
distribution function is defined as the limit as <code class="reqn">\xi</code> tends to zero.
The support of the distribution depends on <code class="reqn">\xi</code>: it is
<code class="reqn">x &lt;= \mu - \sigma / \xi</code> for <code class="reqn">\xi &lt; 0</code>;
<code class="reqn">x &gt;= \mu - \sigma / \xi</code> for <code class="reqn">\xi &gt; 0</code>;
and <code class="reqn">x</code> is unbounded for <code class="reqn">\xi = 0</code>.
Note that if <code class="reqn">\xi &lt; -1</code> the GEV density function becomes infinite
as <code class="reqn">x</code> approaches <code class="reqn">\mu -\sigma / \xi</code> from below.
</p>
<p>See
<a href="https://en.wikipedia.org/wiki/Generalized_extreme_value_distribution">https://en.wikipedia.org/wiki/Generalized_extreme_value_distribution</a>
for further information.
</p>


<h3>Value</h3>

<p>A numeric vector of value(s) of the log-density of the GEV distribution.
</p>


<h3>References</h3>

<p>Jenkinson, A. F. (1955) The frequency distribution of the
annual maximum (or minimum) of meteorological elements.
<em>Quart. J. R. Met. Soc.</em>, <strong>81</strong>, 158-171.
Chapter 3: <a href="https://doi.org/10.1002/qj.49708134804">doi:10.1002/qj.49708134804</a>
</p>
<p>Coles, S. G. (2001) <em>An Introduction to Statistical
Modeling of Extreme Values</em>, Springer-Verlag, London.
<a href="https://doi.org/10.1007/978-1-4471-3675-0_3">doi:10.1007/978-1-4471-3675-0_3</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>log_gev(1:4, 1, 0.5, 0.8)
log_gev(1:3, 1, 0.5, -0.2)
</code></pre>

<hr>
<h2 id='logLik.chandwich'>Extract log-likelihood for objects of class &quot;chandwich&quot;</h2><span id='topic+logLik.chandwich'></span>

<h3>Description</h3>

<p><code>logLik</code> method for class &quot;chandwich&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'chandwich'
logLik(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="logLik.chandwich_+3A_object">object</code></td>
<td>
<p>an object of class &quot;chandwich&quot;, a result of a call to
<code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.</p>
</td></tr>
<tr><td><code id="logLik.chandwich_+3A_...">...</code></td>
<td>
<p>Additional optional arguments. At present no optional
arguments are used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The value of the maximised (independence) loglikelihood
is extracted from <code>attr(object, "max_loglik")</code>.  It is also equal
to <code>object(attr(object, "MLE"))</code>.
</p>


<h3>Value</h3>

<p>An object of class <code>"logLik"</code>: a numeric scalar with
value equal to the maximised (independence) loglikelihood, that is,
the value of the independence loglikelihood at the MLE, and the
attribute <code>"df"</code>, which gives the number of free parameters estimated.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+coef.chandwich">coef.chandwich</a></code>: <code>coef</code> method for
class &quot;chandwich&quot;.
</p>
<p><code><a href="#topic+vcov.chandwich">vcov.chandwich</a></code>: <code>vcov</code> method for
class &quot;chandwich&quot;.
</p>
<p><code><a href="#topic+summary.chandwich">summary.chandwich</a></code>: <code>summary</code> method for
class &quot;chandwich&quot;.
</p>
<p><code><a href="#topic+adjust_loglik">adjust_loglik</a></code> to adjust a user-supplied
loglikelihood.
</p>

<hr>
<h2 id='owtemps'>Oxford and Worthing annual maximum temperatures</h2><span id='topic+owtemps'></span>

<h3>Description</h3>

<p>Annual maximum temperatures, in degrees Fahrenheit, at Oxford and
Worthing (England), for the period 1901 to 1980.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>owtemps
</code></pre>


<h3>Format</h3>

<p>A dataframe with 80 rows and 2 columns, named Oxford and Worthing.
</p>


<h3>Source</h3>

<p>Tabony, R. C. (1983) Extreme value analysis in meteorology.
<em>The Meteorological Magazine</em>, <strong>112</strong>, 77-98.
</p>


<h3>References</h3>

<p>Chandler, R. E. and Bate, S. (2007). Inference for clustered
data using the independence loglikelihood. <em>Biometrika</em>,
<strong>94</strong>(1), 167-183. <a href="https://doi.org/10.1093/biomet/asm015">doi:10.1093/biomet/asm015</a>
</p>

<hr>
<h2 id='plot.chandwich'>Plot diagnostics for a chandwich object</h2><span id='topic+plot.chandwich'></span>

<h3>Description</h3>

<p><code>plot</code> method for class &quot;chandwich&quot;.  Only applicable to an object
<code>x</code> for which <code>attr(x, "p_current") = 1</code>, i.e. a model with
one free parameter.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'chandwich'
plot(x, y, type = 1, legend = length(type) &gt; 1, legend_pos = "topleft", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.chandwich_+3A_x">x</code></td>
<td>
<p>an object of class &quot;chandwich&quot;, a result of a call to
<code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.</p>
</td></tr>
<tr><td><code id="plot.chandwich_+3A_y">y</code></td>
<td>
<p>Not used.</p>
</td></tr>
<tr><td><code id="plot.chandwich_+3A_type">type</code></td>
<td>
<p>An integer vector, a subset of the numbers <code>1:4</code>.
Indicates which loglikelihoods to plot: <code>1</code> for <code>"vertical"</code>
adjustment; <code>2</code> for <code>"cholesky"</code> (horizontal adjustment);
<code>3</code> for <code>"spectral"</code> (horizontal adjustment); <code>4</code>
for no adjustment, i.e. based on the independence loglikelihood.</p>
</td></tr>
<tr><td><code id="plot.chandwich_+3A_legend">legend</code></td>
<td>
<p>A logical scalar or a character vector.  If this is
supplied then a legend is added to the plot.  If <code>legend</code> is a
character vector then it is used as the argument <code>legend</code>
to <code><a href="graphics.html#topic+legend">legend</a></code>.  Otherwise, i.e. if
<code>legend = TRUE</code> then the argument <code>type</code> is used.</p>
</td></tr>
<tr><td><code id="plot.chandwich_+3A_legend_pos">legend_pos</code></td>
<td>
<p>The position of the legend (if required) specified using
the argument <code>x</code> in <code><a href="graphics.html#topic+legend">legend</a></code>.</p>
</td></tr>
<tr><td><code id="plot.chandwich_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="graphics.html#topic+matplot">matplot</a></code>
or <code><a href="graphics.html#topic+legend">legend</a></code>.  The arguments <code>col</code>, <code>lty</code>
and <code>lwd</code> will be used (in a consistent way) by both
<code><a href="graphics.html#topic+matplot">matplot</a></code> and <code><a href="graphics.html#topic+legend">legend</a></code>.
</p>
<p>If the argument <code>xlim</code> to <code><a href="graphics.html#topic+matplot">matplot</a></code> is not
supplied then the MLE minus (for <code>lower</code>) or plus (for <code>upper</code>)
standard errors is used.  If <code>type</code> does not include 4 then adjusted
standard errors are used.  Otherwise, the larger of the adjusted and
unadjusted standard errors are used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing is returned.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+adjust_loglik">adjust_loglik</a></code> to adjust a user-supplied
loglikelihood function.
</p>
<p><code><a href="#topic+summary.chandwich">summary.chandwich</a></code> for maximum likelihood estimates
and unadjusted and adjusted standard errors.
</p>
<p><code><a href="#topic+conf_intervals">conf_intervals</a></code> and <code><a href="#topic+plot.confint">plot.confint</a></code> to
plot confidence intervals for individual parameters.
</p>
<p><code><a href="#topic+conf_region">conf_region</a></code> and <code><a href="#topic+plot.confreg">plot.confreg</a></code> to
plot a confidence region for a pair of parameters.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># ------------------------- Binomial model, rats data ----------------------

# Contributions to the independence loglikelihood
binom_loglik &lt;- function(prob, data) {
  if (prob &lt; 0 || prob &gt; 1) {
    return(-Inf)
  }
  return(dbinom(data[, "y"], data[, "n"], prob, log = TRUE))
}
rat_res &lt;- adjust_loglik(loglik = binom_loglik, data = rats, par_names = "p")

# Vertically adjusted loglikelihood only
plot(rat_res)
# Three adjusted loglikelihoods and the independence loglikelihood
plot(rat_res, type = 1:4)
# Plot over (0,1) and reposition the legend
plot(rat_res, type = 1:4, xlim = c(0, 1), legend_pos = "bottom")
</code></pre>

<hr>
<h2 id='plot.confint'>Plot diagnostics for a confint object</h2><span id='topic+plot.confint'></span>

<h3>Description</h3>

<p><code>plot</code> method for class &quot;confint&quot;.
Plots the (profile) loglikelihood for a parameter using the values
calculated by <code><a href="#topic+conf_intervals">conf_intervals</a></code>.
Up to 4 different types of loglikelihood (see the argument <code>type</code>
to the function returned by <code><a href="#topic+adjust_loglik">adjust_loglik</a></code>)
may be superimposed on the same plot.
By default (<code>add_lines = TRUE</code>) the confidence limits calculated
in <code><a href="#topic+conf_intervals">conf_intervals</a></code> are indicated on the plot .
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'confint'
plot(
  x,
  y = NULL,
  y2 = NULL,
  y3 = NULL,
  which_par = x$which_pars[1],
  conf = x$conf,
  add_lines = TRUE,
  legend = any(c(!is.null(y), !is.null(y2), !is.null(y3))),
  legend_pos = "topleft",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.confint_+3A_x">x</code>, <code id="plot.confint_+3A_y">y</code>, <code id="plot.confint_+3A_y2">y2</code>, <code id="plot.confint_+3A_y3">y3</code></td>
<td>
<p>objects of class <code>"confint"</code>, results of calls to
<code><a href="#topic+conf_intervals">conf_intervals</a></code> for a common model.  A (profile)
loglikelihood will be plotted for each object.</p>
</td></tr>
<tr><td><code id="plot.confint_+3A_which_par">which_par</code></td>
<td>
<p>A scalar specifying the parameter for which the plot
is produced.  Can be either a numeric scalar, specifying index of the
component of the <strong>full</strong> parameter vector, or a character scalar
parameter name.  The former must be in <code>x$which_pars</code>, the latter
must be in <code>names(x$which_pars)</code>.</p>
</td></tr>
<tr><td><code id="plot.confint_+3A_conf">conf</code></td>
<td>
<p>A numeric vector of values in (0, 100).  If
<code>add_lines = TRUE</code> then a horizontal line is added for each
value in <code>conf</code>.  If <code>conf</code> is not supplied then the
value stored in <code>x$conf</code> is used.</p>
</td></tr>
<tr><td><code id="plot.confint_+3A_add_lines">add_lines</code></td>
<td>
<p>A logical scalar.  Whether or not to add horizontal lines
to the plot to identify the confidence limits.  If there is only one
input <code>"confint"</code> object then the values of the confidence limits
will be added to the horizontal axis.</p>
</td></tr>
<tr><td><code id="plot.confint_+3A_legend">legend</code></td>
<td>
<p>A logical scalar or a character vector.  If this is
supplied then a legend is added to the plot.  If <code>legend</code> is a
character vector then it is used as the argument <code>legend</code>
to <code><a href="graphics.html#topic+legend">legend</a></code>.  Otherwise, i.e. if
<code>legend = TRUE</code> then the component <code>type</code> of the input
object(s) <code>x, y, y2, y3</code> are used.</p>
</td></tr>
<tr><td><code id="plot.confint_+3A_legend_pos">legend_pos</code></td>
<td>
<p>The position of the legend (if required) specified using
the argument <code>x</code> in <code><a href="graphics.html#topic+legend">legend</a></code>.</p>
</td></tr>
<tr><td><code id="plot.confint_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="graphics.html#topic+matplot">matplot</a></code>
or <code><a href="graphics.html#topic+legend">legend</a></code>.  The arguments <code>col</code>, <code>lty</code>
and <code>lwd</code> will be used (in a consistent way) by both
<code><a href="graphics.html#topic+matplot">matplot</a></code> and <code><a href="graphics.html#topic+legend">legend</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing is returned.
</p>


<h3>Examples</h3>

<p>See the examples in <code><a href="#topic+conf_intervals">conf_intervals</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+adjust_loglik">adjust_loglik</a></code> to adjust a user-supplied
loglikelihood function.
</p>
<p><code><a href="#topic+conf_intervals">conf_intervals</a></code> for confidence intervals for
individual parameters.
</p>
<p><code><a href="#topic+conf_region">conf_region</a></code> and <code><a href="#topic+plot.confreg">plot.confreg</a></code> to
plot a confidence region for a pair of parameters.
</p>

<hr>
<h2 id='plot.confreg'>Plot diagnostics for a confreg object</h2><span id='topic+plot.confreg'></span>

<h3>Description</h3>

<p><code>plot</code> method for class &quot;confreg&quot;.
Plots confidence regions for pairs of parameters using the profile
loglikelihood values calculated by <code><a href="#topic+conf_region">conf_region</a></code>.
Up to 4 different types of loglikelihood (see the argument <code>type</code>
to the function returned by <code><a href="#topic+adjust_loglik">adjust_loglik</a></code>)
may be superimposed on the same plot.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'confreg'
plot(
  x,
  y = NULL,
  y2 = NULL,
  y3 = NULL,
  conf = 95,
  legend = any(c(!is.null(y), !is.null(y2), !is.null(y3))),
  legend_pos = "topleft",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.confreg_+3A_x">x</code>, <code id="plot.confreg_+3A_y">y</code>, <code id="plot.confreg_+3A_y2">y2</code>, <code id="plot.confreg_+3A_y3">y3</code></td>
<td>
<p>objects of class &quot;confreg&quot;, results of calls to
<code><a href="#topic+conf_region">conf_region</a></code> for a common model and a common value of
<code>which_pars</code>.  Contours are plotted for each object.</p>
</td></tr>
<tr><td><code id="plot.confreg_+3A_conf">conf</code></td>
<td>
<p>A numeric vector of confidence levels, i.e. numbers in
(0, 100).  A confidence region contour is plotted for each value in
<code>conf</code>.</p>
</td></tr>
<tr><td><code id="plot.confreg_+3A_legend">legend</code></td>
<td>
<p>A logical scalar or a character vector.  If this is
supplied then a legend is added to the plot.  If <code>legend</code> is a
character vector then it is used as the argument <code>legend</code>
to <code><a href="graphics.html#topic+legend">legend</a></code>.  Otherwise, i.e. if
<code>legend = TRUE</code> then the component <code>type</code> of the input
object(s) <code>x, y, y2, y3</code> are used.</p>
</td></tr>
<tr><td><code id="plot.confreg_+3A_legend_pos">legend_pos</code></td>
<td>
<p>The position of the legend (if required) specified using
the argument <code>x</code> in <code><a href="graphics.html#topic+legend">legend</a></code>.</p>
</td></tr>
<tr><td><code id="plot.confreg_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="graphics.html#topic+contour">contour</a></code>
or <code><a href="graphics.html#topic+legend">legend</a></code>.  The arguments <code>col</code>, <code>lty</code>
and <code>lwd</code> will be used (in a consistent way) by both
<code><a href="graphics.html#topic+contour">contour</a></code> and <code><a href="graphics.html#topic+legend">legend</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing is returned.
</p>


<h3>Examples</h3>

<p>See the examples in <code><a href="#topic+conf_region">conf_region</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+adjust_loglik">adjust_loglik</a></code> to adjust a user-supplied
loglikelihood function.
</p>
<p><code><a href="#topic+conf_region">conf_region</a></code> for a confidence region for
a pair of parameters.
</p>
<p><code><a href="#topic+conf_intervals">conf_intervals</a></code> and <code><a href="#topic+plot.confint">plot.confint</a></code> to
plot confidence intervals for individual parameters.
</p>

<hr>
<h2 id='print.chandwich'>Print method for objects of class &quot;chandwich&quot;</h2><span id='topic+print.chandwich'></span>

<h3>Description</h3>

<p><code>print</code> method for class &quot;chandwich&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'chandwich'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.chandwich_+3A_x">x</code></td>
<td>
<p>an object of class &quot;chandwich&quot;, a result of a call to
<code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.</p>
</td></tr>
<tr><td><code id="print.chandwich_+3A_...">...</code></td>
<td>
<p>Additional optional arguments. At present no optional
arguments are used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Just prints the original call to <code><a href="#topic+adjust_loglik">adjust_loglik</a></code>
and a character vector giving the names of the attributes
(produced using <code>ls(attributes(x))</code>) to the function returned
from <code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.
To view an individual attribute called <code>att_name</code> use
<code>attr(x, "att_name")</code> or <code>attributes(x)$att_name</code>.
</p>


<h3>Value</h3>

<p>The argument <code>x</code>, invisibly, as for all
<code><a href="base.html#topic+print">print</a></code> methods.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+summary.chandwich">summary.chandwich</a></code>: <code>summary</code> method for
class &quot;chandwich&quot;.
</p>
<p><code><a href="#topic+adjust_loglik">adjust_loglik</a></code> to adjust a user-supplied
loglikelihood.
</p>

<hr>
<h2 id='print.compmod'>Print method for objects of class &quot;compmod&quot;</h2><span id='topic+print.compmod'></span>

<h3>Description</h3>

<p><code>print</code> method for class &quot;compmod&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'compmod'
print(x, digits = max(3L, getOption("digits") - 3L), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.compmod_+3A_x">x</code></td>
<td>
<p>an object of class &quot;compmod&quot;, a result of a call to
<code><a href="#topic+compare_models">compare_models</a></code>.</p>
</td></tr>
<tr><td><code id="print.compmod_+3A_digits">digits</code></td>
<td>
<p>An integer. The argument <code>digits</code> to
<code><a href="base.html#topic+Round">signif</a></code>.</p>
</td></tr>
<tr><td><code id="print.compmod_+3A_...">...</code></td>
<td>
<p>Additional optional arguments. At present no optional
arguments are used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Prints the name of the model, the null (H0) and alternative
hypotheses (HA), the test statistic, degrees of freedom and the p-value.
If the test is based on the approximation detailed by equations (18)-(20)
of Chandler and Bate (2007), rather than equation (17), then this stated.
</p>


<h3>Value</h3>

<p>The argument <code>x</code>, invisibly, as for all
<code><a href="base.html#topic+print">print</a></code> methods.
</p>


<h3>Examples</h3>

<p>See the examples in <code><a href="#topic+compare_models">compare_models</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+adjust_loglik">adjust_loglik</a></code> to adjust a user-supplied
loglikelihood function.
</p>
<p><code><a href="#topic+compare_models">compare_models</a></code> to compare nested models using an
(adjusted) likelihood ratio test.
</p>

<hr>
<h2 id='print.confint'>Print method for objects of class &quot;confint&quot;</h2><span id='topic+print.confint'></span>

<h3>Description</h3>

<p><code>print</code> method for class &quot;confint&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'confint'
print(x, digits = max(3L, getOption("digits") - 3L), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.confint_+3A_x">x</code></td>
<td>
<p>an object of class &quot;confint&quot;, a result of a call to
<code><a href="#topic+conf_intervals">conf_intervals</a></code>.</p>
</td></tr>
<tr><td><code id="print.confint_+3A_digits">digits</code></td>
<td>
<p>An integer. The argument <code>digits</code> to
<code><a href="base.html#topic+print.default">print.default</a></code>.</p>
</td></tr>
<tr><td><code id="print.confint_+3A_...">...</code></td>
<td>
<p>Additional optional arguments. At present no optional
arguments are used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Prints the name of the model, details of any fixed parameters,
the confidence level of the interval(s) and whether or not
the loglikelihood has been adjusted, and symmetric and (profile) likelihood
based intervals.
</p>


<h3>Value</h3>

<p>The argument <code>x</code>, invisibly, as for all
<code><a href="base.html#topic+print">print</a></code> methods.
</p>


<h3>Examples</h3>

<p>See the examples in <code><a href="#topic+conf_intervals">conf_intervals</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+adjust_loglik">adjust_loglik</a></code> to adjust a user-supplied
loglikelihood function.
</p>
<p><code><a href="#topic+conf_intervals">conf_intervals</a></code> for confidence intervals for
individual parameters.
</p>

<hr>
<h2 id='print.summary.chandwich'>Print method for objects of class &quot;summary.chandwich&quot;</h2><span id='topic+print.summary.chandwich'></span>

<h3>Description</h3>

<p><code>print</code> method for an object <code>x</code> of class &quot;summary.chandwich&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'summary.chandwich'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.summary.chandwich_+3A_x">x</code></td>
<td>
<p>An object of class &quot;summary.chandwich&quot;, a result of a call to
<code><a href="#topic+summary.chandwich">summary.chandwich</a></code>.</p>
</td></tr>
<tr><td><code id="print.summary.chandwich_+3A_...">...</code></td>
<td>
<p>Additional arguments passed on to <code>print</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Prints a numeric matrix with 3 columns and the number of rows
equal to the number of parameters in the current model, i.e.
<code>attr(object, "p_current")</code>.
The columns contain: the maximum likelihood estimates (MLE), unadjusted
standard errors (SE) and adjusted standard errors (adjSE).
</p>


<h3>Examples</h3>

<p>See the examples in <code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+adjust_loglik">adjust_loglik</a></code> to adjust a user-supplied
loglikelihood.
</p>
<p><code><a href="#topic+summary.chandwich">summary.chandwich</a></code> for a diagnostic plot.
</p>

<hr>
<h2 id='profile_loglik'>Profile loglikelihood</h2><span id='topic+profile_loglik'></span>

<h3>Description</h3>

<p>Calculates the profile loglikelihood for a subset of the model parameters.
This function is provided primarily so that it can be called by
<code><a href="#topic+conf_intervals">conf_intervals</a></code> and <code><a href="#topic+conf_region">conf_region</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>profile_loglik(
  object,
  prof_pars = NULL,
  prof_vals = NULL,
  init = NULL,
  type = c("vertical", "cholesky", "spectral", "none"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="profile_loglik_+3A_object">object</code></td>
<td>
<p>An object of class <code>"chandwich"</code> returned by
<code>adjust_loglik</code>.</p>
</td></tr>
<tr><td><code id="profile_loglik_+3A_prof_pars">prof_pars</code></td>
<td>
<p>A vector specifying the subset of the (unfixed) parameters
over which to profile. Can be either a numeric vector, specifying indices
of the components of the <strong>full</strong> parameter vector, or a character
vector of parameter names, which must be a subset of those supplied in
<code>par_names</code> in the call to <code><a href="#topic+adjust_loglik">adjust_loglik</a></code> that produced
<code>object</code>.
</p>
<p><code>prof_pars</code> must not have any parameters in common with
<code>attr(object, "fixed_pars")</code>.  <code>prof_pars</code> must not contain
all of the unfixed parameters, i.e. there is no point in profiling over
all of the unfixed parameters.</p>
</td></tr>
<tr><td><code id="profile_loglik_+3A_prof_vals">prof_vals</code></td>
<td>
<p>A numeric vector.  Values of the parameters in
<code>prof_pars</code>.  If <code>prof_vals = NULL</code> then the MLEs stored
in <code>object</code> of the parameters <code>prof_pars</code> are used.</p>
</td></tr>
<tr><td><code id="profile_loglik_+3A_init">init</code></td>
<td>
<p>A numeric vector of initial estimates of the values of the
parameters that are not fixed and are not in <code>prof_pars</code>.
Should have length <code>attr(object, "p_current") - length(prof_pars)</code>.
If <code>init</code> is <code>NULL</code> or is of the wrong length then the
relevant components from the MLE stored in <code>object</code> are used.</p>
</td></tr>
<tr><td><code id="profile_loglik_+3A_type">type</code></td>
<td>
<p>A character scalar.  The argument <code>type</code> to the function
returned by <code><a href="#topic+adjust_loglik">adjust_loglik</a></code>, that is, the type of adjustment
made to the independence loglikelihood function.</p>
</td></tr>
<tr><td><code id="profile_loglik_+3A_...">...</code></td>
<td>
<p>Further arguments to be passed to <code><a href="stats.html#topic+optim">optim</a></code>.
These may include <code>gr</code>, <code>method</code>, <code>lower</code>, <code>upper</code>
or <code>control</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector of length 1.  The value of the profile
loglikelihood.  The returned object has the attribute <code>"free_pars"</code>
giving the optimal values of the parameters that remain after the
parameters <code>prof_pars</code> and <code>attr(object, "fixed_pars")</code> have
been removed from the full parameter vector.  If there are no such
parameters, which happens if an attempt is made to profile over
<em>all</em> non-fixed parameters, then this attribute is not present and
the value returned is calculated using the function <code>object</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+adjust_loglik">adjust_loglik</a></code> to adjust a user-supplied
loglikelihood function.
</p>
<p><code><a href="#topic+conf_intervals">conf_intervals</a></code> for confidence intervals for
individual parameters.
</p>
<p><code><a href="#topic+conf_region">conf_region</a></code> for a confidence region for
a pair of parameters.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># -------------------------- GEV model, owtemps data -----------------------
# ------------ following Section 5.2 of Chandler and Bate (2007) -----------

gev_loglik &lt;- function(pars, data) {
  o_pars &lt;- pars[c(1, 3, 5)] + pars[c(2, 4, 6)]
  w_pars &lt;- pars[c(1, 3, 5)] - pars[c(2, 4, 6)]
  if (isTRUE(o_pars[2] &lt;= 0 | w_pars[2] &lt;= 0)) return(-Inf)
  o_data &lt;- data[, "Oxford"]
  w_data &lt;- data[, "Worthing"]
  check &lt;- 1 + o_pars[3] * (o_data - o_pars[1]) / o_pars[2]
  if (isTRUE(any(check &lt;= 0))) return(-Inf)
  check &lt;- 1 + w_pars[3] * (w_data - w_pars[1]) / w_pars[2]
  if (isTRUE(any(check &lt;= 0))) return(-Inf)
  o_loglik &lt;- log_gev(o_data, o_pars[1], o_pars[2], o_pars[3])
  w_loglik &lt;- log_gev(w_data, w_pars[1], w_pars[2], w_pars[3])
  return(o_loglik + w_loglik)
}

# Initial estimates (method of moments for the Gumbel case)
sigma &lt;- as.numeric(sqrt(6 * diag(var(owtemps))) / pi)
mu &lt;- as.numeric(colMeans(owtemps) - 0.57722 * sigma)
init &lt;- c(mean(mu), -diff(mu) / 2, mean(sigma), -diff(sigma) / 2, 0, 0)

# Log-likelihood adjustment of the full model
par_names &lt;- c("mu[0]", "mu[1]", "sigma[0]", "sigma[1]", "xi[0]", "xi[1]")
large &lt;- adjust_loglik(gev_loglik, data = owtemps, init = init,
                       par_names = par_names)

# Profile loglikelihood for xi1, evaluated at xi1 = 0
profile_loglik(large, prof_pars = "xi[1]", prof_vals = 0)

# Model with xi1 fixed at 0
medium &lt;- adjust_loglik(larger = large, fixed_pars = "xi[1]")
# Profile loglikelihood for xi0, evaluated at xi0 = -0.1
profile_loglik(medium, prof_pars = "xi[0]", prof_vals = -0.1)
</code></pre>

<hr>
<h2 id='rats'>Rat tumor data</h2><span id='topic+rats'></span>

<h3>Description</h3>

<p>Tumor incidence in 71 groups of rate from Tarone (1982).
The matrix <code>rat</code> has 71 rows and 2 columns.
Each row relates to a different group of rats.
The first column (<code>y</code>) contains the number of rats with tumors.
The second column (<code>n</code>) contains the total number of rats.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rats
</code></pre>


<h3>Format</h3>

<p>A matrix with 71 rows and 2 columns.
</p>


<h3>Source</h3>

<p>Table 5.1 of Gelman, A., Carlin, J. B., Stern, H. S. Dunson, D. B.,
Vehtari, A. and Rubin, D. B. (2013) <em>Bayesian Data Analysis</em>,
Chapman &amp; Hall / CRC.
<a href="http://www.stat.columbia.edu/~gelman/book/data/rats.asc">http://www.stat.columbia.edu/~gelman/book/data/rats.asc</a>
</p>


<h3>References</h3>

<p>Tarone, R. E. (1982) The use of historical information in
testing for a trend in proportions. <em>Biometrics</em>, <strong>38</strong>,
215-220.
</p>

<hr>
<h2 id='summary.chandwich'>Summarizing adjusted loglikelihoods</h2><span id='topic+summary.chandwich'></span>

<h3>Description</h3>

<p><code>summary</code> method for class &quot;chandwich&quot;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'chandwich'
summary(object, digits = max(3, getOption("digits") - 3L), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.chandwich_+3A_object">object</code></td>
<td>
<p>an object of class &quot;chandwich&quot;, a result of a call to
<code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.</p>
</td></tr>
<tr><td><code id="summary.chandwich_+3A_digits">digits</code></td>
<td>
<p>An integer. Used for number formatting with
<code><a href="base.html#topic+Round">signif</a></code>.</p>
</td></tr>
<tr><td><code id="summary.chandwich_+3A_...">...</code></td>
<td>
<p>Additional optional arguments. At present no optional
arguments are used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a numeric matrix with 3 columns and the number of rows
equal to the number of parameters in the current model, i.e.
<code>attr(object, "p_current")</code>.
The columns contain: the maximum likelihood estimates (MLE), unadjusted
standard errors (SE) and adjusted standard errors (adjSE).
</p>


<h3>Examples</h3>

<p>See the examples in <code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+adjust_loglik">adjust_loglik</a></code> to adjust a user-supplied
loglikelihood function.
</p>
<p><code><a href="#topic+plot.chandwich">plot.chandwich</a></code> for plots of one-dimensional adjusted
loglikelihoods.
</p>

<hr>
<h2 id='vcov.chandwich'>Calculate the variance-covariance matrix for an object of class &quot;chandwich&quot;</h2><span id='topic+vcov.chandwich'></span>

<h3>Description</h3>

<p><code>vcov</code> method for class &quot;chandwich&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'chandwich'
vcov(object, complete = FALSE, adjusted = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vcov.chandwich_+3A_object">object</code></td>
<td>
<p>an object of class &quot;chandwich&quot;, a result of a call to
<code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.</p>
</td></tr>
<tr><td><code id="vcov.chandwich_+3A_complete">complete</code></td>
<td>
<p>A logical scalar.  If <code>complete = TRUE</code> then the
full variance-covariance matrix is returned, including any fixed
using <code>fixed_pars</code> and <code>fixed_at</code> in the call to
<code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.  In this instance the corresponding
elements of the matrix are <code>NA</code>. Otherwise, the variance-covariance
matrix of only the free parameters is returned.
</p>
<p>The default is <code>complete = FALSE</code>, which is in sync with
<code><a href="#topic+coef.chandwich">coef.chandwich</a></code>.</p>
</td></tr>
<tr><td><code id="vcov.chandwich_+3A_adjusted">adjusted</code></td>
<td>
<p>A logical scalar.  If <code>adjusted = TRUE</code> then the
variance-covariance matrix is estimated using a sandwich estimator.
Otherwise, the inverse of the observed information at the MLE is used.</p>
</td></tr>
<tr><td><code id="vcov.chandwich_+3A_...">...</code></td>
<td>
<p>Additional optional arguments. At present no optional
arguments are used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The variance-covariance matrix is based on
<code>attributes(object)$adjVC</code> for <code>adjusted = TRUE</code> and
<code>attributes(object)$VC</code> for <code>adjusted = FALSE</code>.
These return the estimate variance-covariance matrix of only the
free parameters.
</p>


<h3>Value</h3>

<p>A numeric matrix.  The dimensions will be named if names were
provided in the call to <code><a href="#topic+adjust_loglik">adjust_loglik</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+coef.chandwich">coef.chandwich</a></code>: <code>coef</code> method for
class &quot;chandwich&quot;.
</p>
<p><code><a href="#topic+summary.chandwich">summary.chandwich</a></code>: <code>summary</code> method for
class &quot;chandwich&quot;.
</p>
<p><code><a href="#topic+adjust_loglik">adjust_loglik</a></code> to adjust a user-supplied
loglikelihood.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
