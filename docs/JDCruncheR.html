<!DOCTYPE html><html lang="en"><head><title>Help for package JDCruncheR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {JDCruncheR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#JDCruncheR-package'><p>JDCruncheR: Interface Between the 'JDemetra+' Cruncher and R, and Quality Report Generator</p></a></li>
<li><a href='#add_indicator'><p>Adding an indicator in QR_matrix objects</p></a></li>
<li><a href='#compute_score'><p>Score calculation</p></a></li>
<li><a href='#export_xlsx'><p>Exporting QR_matrix or mQR_matrix objects in an Excel file</p></a></li>
<li><a href='#export_xlsx.mQR_matrix'><p>Exporting mQR_matrix objects in Excel files</p></a></li>
<li><a href='#export_xlsx.QR_matrix'><p>Exporting QR_matrix objects in an Excel file</p></a></li>
<li><a href='#extract_QR'><p>Extraction of a quality report</p></a></li>
<li><a href='#extract_score'><p>Score extraction</p></a></li>
<li><a href='#fr-add_indicator'><p>Ajout d'un indicateur dans les objets QR_matrix</p></a></li>
<li><a href='#fr-compute_score'><p>Calcul d'un score global</p></a></li>
<li><a href='#fr-export_xlsx.mQR_matrix'><p>Export des objets mQR_matrix dans des fichiers Excel</p></a></li>
<li><a href='#fr-export_xlsx.QR_matrix'><p>Export des objets QR_matrix dans un fichier Excel</p></a></li>
<li><a href='#fr-extract_QR'><p>Extraction d'un bilan qualité</p></a></li>
<li><a href='#fr-extract_score'><p>Extraction du score</p></a></li>
<li><a href='#fr-print.QR_matrix'><p>Affichage des objets QR_matrix et mQR_matrix</p></a></li>
<li><a href='#fr-QR_matrix'><p>Objets bilan qualité</p></a></li>
<li><a href='#fr-rbind.QR_matrix'><p>Combiner par ligne des objets QR_matrix</p></a></li>
<li><a href='#fr-recode_indicator_num'><p>Ré-encodage en modalités des variables</p></a></li>
<li><a href='#fr-remove_indicators'><p>Manipulation de la liste des indicateurs</p></a></li>
<li><a href='#fr-sort.QR_matrix'><p>Tri des objets QR_matrix et mQR_matrix</p></a></li>
<li><a href='#fr-weighted_score'><p>Calcul d'un score pondéré pour chaque observation</p></a></li>
<li><a href='#get_thresholds'><p>Get all (default) thresholds</p></a></li>
<li><a href='#print.QR_matrix'><p>Printing QR_matrix and mQR_matrix objects</p></a></li>
<li><a href='#QR_matrix'><p>Quality report objects</p></a></li>
<li><a href='#QR_var_manipulation'><p>Editing the indicators list</p></a></li>
<li><a href='#rbind.QR_matrix'><p>Combining QR_matrix objects</p></a></li>
<li><a href='#recode_indicator_num'><p>Converting &quot;values variables&quot; into &quot;modalities variables&quot;</p></a></li>
<li><a href='#set_thresholds'><p>Set values for thresholds</p></a></li>
<li><a href='#sort'><p>QR_matrix and mQR_matrix sorting</p></a></li>
<li><a href='#weighted_score'><p>Weighted score calculation</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Interface Between the 'JDemetra+' Cruncher and R, and Quality
Report Generator</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.3</td>
</tr>
<tr>
<td>Description:</td>
<td>Tool for generating quality reports from cruncher outputs (and calculating series scores). The latest version of the cruncher can be downloaded here: <a href="https://github.com/jdemetra/jwsacruncher/releases">https://github.com/jdemetra/jwsacruncher/releases</a>.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/InseeFr/JDCruncheR">https://github.com/InseeFr/JDCruncheR</a>,
<a href="https://inseefr.github.io/JDCruncheR/">https://inseefr.github.io/JDCruncheR/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/InseeFr/JDCruncheR/issues">https://github.com/InseeFr/JDCruncheR/issues</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>openxlsx, stats, tools, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, kableExtra, pkgdown, rmarkdown</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://joinup.ec.europa.eu/software/page/eupl">EUPL version 1.1</a> | <a href="https://joinup.ec.europa.eu/software/page/eupl">EUPL version 1.2</a> [expanded from: EUPL]</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-02-19 17:01:44 UTC; UTZK0M</td>
</tr>
<tr>
<td>Author:</td>
<td>Tanguy Barthelemy [aut, cre, art],
  Alain Quartier-la-Tente
    <a href="https://orcid.org/0000-0001-7890-3857"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Institut national de la statistique et des études économiques [cph]
    (https://www.insee.fr/),
  Anna Smyk [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Tanguy Barthelemy &lt;tanguy.barthelemy@insee.fr&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-02-23 15:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='JDCruncheR-package'>JDCruncheR: Interface Between the 'JDemetra+' Cruncher and R, and Quality Report Generator</h2><span id='topic+JDCruncheR'></span><span id='topic+JDCruncheR-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Tool for generating quality reports from cruncher outputs (and calculating series scores). The latest version of the cruncher can be downloaded here: <a href="https://github.com/jdemetra/jwsacruncher/releases">https://github.com/jdemetra/jwsacruncher/releases</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Tanguy Barthelemy <a href="mailto:tanguy.barthelemy@insee.fr">tanguy.barthelemy@insee.fr</a> [artist]
</p>
<p>Authors:
</p>

<ul>
<li><p> Alain Quartier-la-Tente <a href="mailto:alain.quartier-la-tente@insee.fr">alain.quartier-la-tente@insee.fr</a> (<a href="https://orcid.org/0000-0001-7890-3857">ORCID</a>)
</p>
</li>
<li><p> Anna Smyk <a href="mailto:anna.smyk@insee.fr">anna.smyk@insee.fr</a>
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p>  Institut national de la statistique et des études économiques (https://www.insee.fr/) [copyright holder]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/InseeFr/JDCruncheR">https://github.com/InseeFr/JDCruncheR</a>
</p>
</li>
<li> <p><a href="https://inseefr.github.io/JDCruncheR/">https://inseefr.github.io/JDCruncheR/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/InseeFr/JDCruncheR/issues">https://github.com/InseeFr/JDCruncheR/issues</a>
</p>
</li></ul>


<hr>
<h2 id='add_indicator'>Adding an indicator in QR_matrix objects</h2><span id='topic+add_indicator'></span>

<h3>Description</h3>

<p>Function to add indicators in <code><a href="#topic+QR_matrix">QR_matrix</a></code> objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_indicator(x, indicator, variable_name, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_indicator_+3A_x">x</code></td>
<td>
<p>a <code><a href="#topic+QR_matrix">QR_matrix</a></code> or <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> object</p>
</td></tr>
<tr><td><code id="add_indicator_+3A_indicator">indicator</code></td>
<td>
<p>a <code>vector</code> or a <code>data.frame</code> (cf. details).</p>
</td></tr>
<tr><td><code id="add_indicator_+3A_variable_name">variable_name</code></td>
<td>
<p>a string containing the name of the variables to add.</p>
</td></tr>
<tr><td><code id="add_indicator_+3A_...">...</code></td>
<td>
<p>other parameters of the function <code><a href="base.html#topic+merge">merge</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function <code>add_indicator()</code> adds the chosen indicator to the
values matrix of a quality report. Therefore, because said indicator isn't
added in the modalities matrix, it cannot be used to calculate a score
(except for weighting). Before using the added variable for score
calculation, it will have to be coded with the function
<code><a href="#topic+recode_indicator_num">recode_indicator_num</a></code>.
</p>
<p>The new indicator can be a <code>vector</code> or a <code>data.frame</code>. In both
cases, its format must allow for pairing:
</p>

<ul>
<li><p> a <code>vector</code>'s elements must be named and these names must match those
of the quality report (variable &quot;series&quot;);
</p>
</li>
<li><p> a <code>data.frame</code> must contain a &quot;series&quot; column that matches with the
quality report's series.
</p>
</li></ul>



<h3>Value</h3>

<p>This function returns the same object, enhanced with the chosen
indicator. So if the input <code>x</code> is a QR_matrix, an object of class
<code>QR_matrix</code> is returned. If the input <code>x</code> is a mQR_matrix, an
object of class <code>mQR_matrix</code> is returned.
</p>


<h3>See Also</h3>

<p><a href="#topic+fr-add_indicator">Traduction française</a>
</p>
<p>Other var QR_matrix manipulation: 
<code><a href="#topic+QR_var_manipulation">QR_var_manipulation</a></code>,
<code><a href="#topic+recode_indicator_num">recode_indicator_num</a>()</code>
</p>

<hr>
<h2 id='compute_score'>Score calculation</h2><span id='topic+compute_score'></span><span id='topic+compute_score.QR_matrix'></span><span id='topic+compute_score.mQR_matrix'></span>

<h3>Description</h3>

<p>To calculate a score for each series from a quality report
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'QR_matrix'
compute_score(
  x,
  score_pond = c(qs_residual_sa_on_sa = 30L, f_residual_sa_on_sa = 30L,
    qs_residual_sa_on_i = 20L, f_residual_sa_on_i = 20L, f_residual_td_on_sa = 30L,
    f_residual_td_on_i = 20L, oos_mean = 15L, oos_mse = 10L, residuals_independency =
    15L, residuals_homoskedasticity = 5L, residuals_skewness = 5L, m7 = 5L, q_m2 = 5L),
  modalities = c("Good", "Uncertain", "", "Bad", "Severe"),
  normalize_score_value,
  na.rm = FALSE,
  n_contrib_score,
  conditional_indicator,
  thresholds = getOption("jdc_thresholds"),
  ...
)

## S3 method for class 'mQR_matrix'
compute_score(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compute_score_+3A_x">x</code></td>
<td>
<p>a <code><a href="#topic+QR_matrix">QR_matrix</a></code> or <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> object.</p>
</td></tr>
<tr><td><code id="compute_score_+3A_score_pond">score_pond</code></td>
<td>
<p>the formula used to calculate the series score.</p>
</td></tr>
<tr><td><code id="compute_score_+3A_modalities">modalities</code></td>
<td>
<p>modalities ordered by importance in the score calculation
(cf. details).</p>
</td></tr>
<tr><td><code id="compute_score_+3A_normalize_score_value">normalize_score_value</code></td>
<td>
<p>integer indicating the reference value for
weights normalisation. If missing, weights will not be normalised.</p>
</td></tr>
<tr><td><code id="compute_score_+3A_na.rm">na.rm</code></td>
<td>
<p>logical indicating whether missing values must be ignored when
calculating the score.</p>
</td></tr>
<tr><td><code id="compute_score_+3A_n_contrib_score">n_contrib_score</code></td>
<td>
<p>integer indicating the number of variables to create
in the quality report's values matrix to store the <code>n_contrib_score</code>
greatest contributions to the score (cf. details). If not specified, no
variable is created.</p>
</td></tr>
<tr><td><code id="compute_score_+3A_conditional_indicator">conditional_indicator</code></td>
<td>
<p>a <code>list</code> containing 3-elements sub-lists:
&quot;indicator&quot;, &quot;conditions&quot; and &quot;condition_modalities&quot;. To reduce down to 1 the
weight of chosen indicators depending on other variables' values (cf.
details).</p>
</td></tr>
<tr><td><code id="compute_score_+3A_thresholds">thresholds</code></td>
<td>
<p><code>list</code> of numerical vectors. Thresholds applied to the
various tests in order to classify into modalities <code>Good</code>,
<code>Uncertain</code>, <code>Bad</code> and <code>Severe</code>.
By default, the value of the <code>"jdc_threshold"</code> option is used.
You can call the <code><a href="#topic+get_thresholds">get_thresholds</a></code> function to see what the
<code>thresholds</code> object should look like.</p>
</td></tr>
<tr><td><code id="compute_score_+3A_...">...</code></td>
<td>
<p>other unused parameters.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function <code>compute_score</code> calculates a score from the
modalities of a quality report: to each modality corresponds a weight that
depends on the parameter <code>modalities</code>. The default parameter is
<code>c("Good", "Uncertain", "Bad","Severe")</code>, and the associated weights are
respectively 0, 1, 2 and 3.
</p>
<p>The score calculation is based on the <code>score_pond</code> parameter, which is a
named integer vector containing the weights to apply to the (modalities
matrix) variables. For example, with
<code>score_pond = c(qs_residual_sa_on_sa = 10, f_residual_td_on_sa = 5)</code>,
the score will be based on the variables <code>qs_residual_sa_on_sa</code> and
<code>f_residual_td_on_sa</code>. The <code>qs_residual_sa_on_sa</code> grades will be
multiplied by 10 and the <code>f_residual_td_on_sa grades</code>, by 5. To ignore
the missing values when calculating a score, use the parameter
<code>na.rm = TRUE</code>.
</p>
<p>The parameter <code>normalize_score_value</code> can be used to normalise the
scores. For example, to have all scores between 0 and 20, specify
<code>normalize_score_value = 20</code>.
</p>
<p>When using parameter <code>n_contrib_score</code>, <code>n_contrib_score</code> new
variables are added to the quality report's values matrix. These new
variables store the names of the variables that contribute the most to the
series score. For example, <code>n_contrib_score = 3</code> will add to the values
matrix the three variables that contribute the most to the score. The new
variables' names are <em>i</em>_highest_score, with <em>i</em> being the rank in terms of
contribution to the score (1_highest_score contains the name of the greatest
contributor, 2_highest_score the second greatest, etc). Only the variables
that have a non-zero contribution to the score are taken into account: if a
series score is 0, all <em>i</em>_highest_score variables will be empty. And if a
series score is positive only because of the m7 statistic, 1_highest_score
will have a value of &quot;m7&quot; for this series and the other <em>i</em>_highest_score
will be empty.
</p>
<p>Some indicators are only relevant under certain conditions. For example, the
homoscedasticity test is only valid when the residuals are independant, and
the normality tests, only when the residuals are both independant and
homoscedastic. In these cases, the parameter <code>conditional_indicator</code> can
be of use since it reduces the weight of some variables down to 1 when some
conditions are met. <code>conditional_indicator</code> is a <code>list</code> of
3-elements sub-lists:
</p>

<ul>
<li><p> &quot;indicator&quot;: the variable whose weight will be conditionally changed
</p>
</li>
<li><p> &quot;conditions&quot;: the variables used to define the conditions
</p>
</li>
<li><p> &quot;conditions_modalities&quot;: modalities that must be verified to induce the
weight change For example,
<code>conditional_indicator = list(list(indicator = "residuals_skewness",
  conditions = c("residuals_independency", "residuals_homoskedasticity"),
  conditions_modalities = c("Bad","Severe")))</code>, reduces down to 1 the weight
of the variable &quot;residuals_skewness&quot; when the modalities of the
independancy test (&quot;residuals_independency&quot;) or the homoscedasticity test
(&quot;residuals_homoskedasticity&quot;) are &quot;Bad&quot; or &quot;Severe&quot;.
</p>
</li></ul>



<h3>Value</h3>

<p>a <code><a href="#topic+QR_matrix">QR_matrix</a></code> or <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> object.
</p>


<h3>See Also</h3>

<p><a href="#topic+fr-compute_score">Traduction française</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Path of matrix demetra_m
demetra_path &lt;- file.path(
    system.file("extdata", package = "JDCruncheR"),
    "WS/ws_ipi/Output/SAProcessing-1",
    "demetra_m.csv"
)

# Extract the quality report from the demetra_m file
QR &lt;- extract_QR(demetra_path)

# Calculer le score
QR &lt;- compute_score(QR, n_contrib_score = 2)
print(QR)

# Extract the modalities matrix:
QR[["modalities"]][["score"]]

</code></pre>

<hr>
<h2 id='export_xlsx'>Exporting QR_matrix or mQR_matrix objects in an Excel file</h2><span id='topic+export_xlsx'></span>

<h3>Description</h3>

<p>Exporting QR_matrix or mQR_matrix objects in an Excel file
</p>


<h3>Usage</h3>

<pre><code class='language-R'>export_xlsx(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="export_xlsx_+3A_x">x</code></td>
<td>
<p>a <code><a href="#topic+QR_matrix">QR_matrix</a></code> or <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> object.</p>
</td></tr>
<tr><td><code id="export_xlsx_+3A_...">...</code></td>
<td>
<p>other parameters of the function
<code><a href="#topic+export_xlsx.QR_matrix">export_xlsx.QR_matrix</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>x</code> is a <code><a href="#topic+mQR_matrix">mQR_matrix</a></code>, the function returns invisibly
(via <code>invisible(x)</code>) the same <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> object as
<code>x</code>.
Else if <code>x</code> is a <code><a href="#topic+QR_matrix">QR_matrix</a></code>, the function returns
invisibly (via <code>invisible(x)</code>) a workbook object created by
<code>XLConnect::loadWorkbook()</code> for further manipulation.
</p>


<h3>See Also</h3>

<p>Other QR_matrix functions: 
<code><a href="#topic+export_xlsx.QR_matrix">export_xlsx.QR_matrix</a>()</code>,
<code><a href="#topic+export_xlsx.mQR_matrix">export_xlsx.mQR_matrix</a>()</code>,
<code><a href="#topic+extract_QR">extract_QR</a>()</code>,
<code><a href="#topic+rbind.QR_matrix">rbind.QR_matrix</a>()</code>,
<code><a href="#topic+sort">sort</a>()</code>,
<code><a href="#topic+weighted_score">weighted_score</a>()</code>
</p>

<hr>
<h2 id='export_xlsx.mQR_matrix'>Exporting mQR_matrix objects in Excel files</h2><span id='topic+export_xlsx.mQR_matrix'></span>

<h3>Description</h3>

<p>To export several quality reports in Excel files
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mQR_matrix'
export_xlsx(
  x,
  export_dir,
  layout_file = c("ByComponent", "ByQRMatrix", "AllTogether"),
  auto_format = TRUE,
  overwrite = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="export_xlsx.mQR_matrix_+3A_x">x</code></td>
<td>
<p>a <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> object to export.</p>
</td></tr>
<tr><td><code id="export_xlsx.mQR_matrix_+3A_export_dir">export_dir</code></td>
<td>
<p>export directory.</p>
</td></tr>
<tr><td><code id="export_xlsx.mQR_matrix_+3A_layout_file">layout_file</code></td>
<td>
<p>export parameter. By default,
(<code>layout_file = "ByComponent"</code>) and an Excel file is exported for each
part of the quality report matrix (modalities and values matrices). To group
both modalities and values reports/sheets into a single Excel file, use the
option <code>layout_file = "ByQRMatrix"</code>.</p>
</td></tr>
<tr><td><code id="export_xlsx.mQR_matrix_+3A_auto_format">auto_format</code></td>
<td>
<p>logical indicating whether to format the output
(<code>auto_format = TRUE</code> by default).</p>
</td></tr>
<tr><td><code id="export_xlsx.mQR_matrix_+3A_overwrite">overwrite</code></td>
<td>
<p>logical indicating whether to create an Excel file if it
doesn't exist yet (<code>create = TRUE</code> by default)</p>
</td></tr>
<tr><td><code id="export_xlsx.mQR_matrix_+3A_...">...</code></td>
<td>
<p>other unused arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns invisibly (via <code>invisible(x)</code>) the same
<code><a href="#topic+mQR_matrix">mQR_matrix</a></code> object as <code>x</code>.
</p>


<h3>See Also</h3>

<p><a href="#topic+fr-export_xlsx.mQR_matrix">Traduction française</a>
</p>
<p>Other QR_matrix functions: 
<code><a href="#topic+export_xlsx">export_xlsx</a>()</code>,
<code><a href="#topic+export_xlsx.QR_matrix">export_xlsx.QR_matrix</a>()</code>,
<code><a href="#topic+extract_QR">extract_QR</a>()</code>,
<code><a href="#topic+rbind.QR_matrix">rbind.QR_matrix</a>()</code>,
<code><a href="#topic+sort">sort</a>()</code>,
<code><a href="#topic+weighted_score">weighted_score</a>()</code>
</p>

<hr>
<h2 id='export_xlsx.QR_matrix'>Exporting QR_matrix objects in an Excel file</h2><span id='topic+export_xlsx.QR_matrix'></span>

<h3>Description</h3>

<p>To export a quality report in an Excel file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'QR_matrix'
export_xlsx(x, file, auto_format = TRUE, overwrite = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="export_xlsx.QR_matrix_+3A_x">x</code></td>
<td>
<p>a <code><a href="#topic+QR_matrix">QR_matrix</a></code> object.</p>
</td></tr>
<tr><td><code id="export_xlsx.QR_matrix_+3A_file">file</code></td>
<td>
<p>a <code>character</code> object with the path to the file to export
que l'on veut créer</p>
</td></tr>
<tr><td><code id="export_xlsx.QR_matrix_+3A_auto_format">auto_format</code></td>
<td>
<p>logical indicating whether to format the output
(<code>auto_format = TRUE</code> by default).</p>
</td></tr>
<tr><td><code id="export_xlsx.QR_matrix_+3A_overwrite">overwrite</code></td>
<td>
<p>logical indicating whether to create an Excel file if it
doesn't exist yet (<code>create = TRUE</code> by default)</p>
</td></tr>
<tr><td><code id="export_xlsx.QR_matrix_+3A_...">...</code></td>
<td>
<p>other unused arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns invisibly (via <code>invisible(x)</code>) a workbook object
created by <code>XLConnect::loadWorkbook()</code> for further manipulation.
</p>


<h3>See Also</h3>

<p><a href="#topic+fr-export_xlsx.QR_matrix">Traduction française</a>
</p>
<p>Other QR_matrix functions: 
<code><a href="#topic+export_xlsx">export_xlsx</a>()</code>,
<code><a href="#topic+export_xlsx.mQR_matrix">export_xlsx.mQR_matrix</a>()</code>,
<code><a href="#topic+extract_QR">extract_QR</a>()</code>,
<code><a href="#topic+rbind.QR_matrix">rbind.QR_matrix</a>()</code>,
<code><a href="#topic+sort">sort</a>()</code>,
<code><a href="#topic+weighted_score">weighted_score</a>()</code>
</p>

<hr>
<h2 id='extract_QR'>Extraction of a quality report</h2><span id='topic+extract_QR'></span>

<h3>Description</h3>

<p>To extract a quality report from the csv file containing the diagnostics
matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_QR(
  file,
  x,
  matrix_output_file,
  sep = ";",
  dec = ",",
  thresholds = getOption("jdc_thresholds")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extract_QR_+3A_file">file</code></td>
<td>
<p>the csv file containing the diagnostics matrix. This argument
supersedes the argument <code>matrix_output_file</code>.</p>
</td></tr>
<tr><td><code id="extract_QR_+3A_x">x</code></td>
<td>
<p>data.frame containing the diagnostics matrix.</p>
</td></tr>
<tr><td><code id="extract_QR_+3A_matrix_output_file">matrix_output_file</code></td>
<td>
<p>the csv file containing the diagnostics matrix.</p>
</td></tr>
<tr><td><code id="extract_QR_+3A_sep">sep</code></td>
<td>
<p>the separator used in the csv file (by default, <code>sep = ";"</code>)</p>
</td></tr>
<tr><td><code id="extract_QR_+3A_dec">dec</code></td>
<td>
<p>the decimal separator used in the csv file (by default,
<code>dec = ","</code>)</p>
</td></tr>
<tr><td><code id="extract_QR_+3A_thresholds">thresholds</code></td>
<td>
<p><code>list</code> of numerical vectors. Thresholds applied to the
various tests in order to classify into modalities <code>Good</code>,
<code>Uncertain</code>, <code>Bad</code> and <code>Severe</code>.
By default, the value of the <code>"jdc_threshold"</code> option is used.
You can call the <code><a href="#topic+get_thresholds">get_thresholds</a></code> function to see what the
<code>thresholds</code> object should look like.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function generates a quality report from a csv file containing
diagnostics (usually from the file <em>demetra_m.csv</em>).
The <em>demetra_m.csv</em> file can be generated by launching the cruncher
(functions <code><a href="rjwsacruncher.html#topic+cruncher">cruncher</a></code> or
<code><a href="rjwsacruncher.html#topic+cruncher_and_param">cruncher_and_param</a></code>) with the default export
parameters, having used the default option <code>csv_layout = "vtable"</code> to
format the output tables of the functions
<code><a href="rjwsacruncher.html#topic+cruncher_and_param">cruncher_and_param</a></code> and
<code><a href="rjwsacruncher.html#topic+create_param_file">create_param_file</a></code> when creating the parameters
file.
</p>
<p>This function returns a <code><a href="#topic+QR_matrix">QR_matrix</a></code> object, which is a list of 3
objects:
</p>

<ul>
<li> <p><code>modalities</code>, a <code>data.frame</code> containing several indicators and
their categorical quality (Good, Uncertain, Bad, Severe).
</p>
</li>
<li> <p><code>values</code>, a <code>data.frame</code> containing the same indicators and the
values that lead to their quality category (i.e.: p-values, statistics,
etc.) as well as additional variables that don't have a modality/quality
(series frequency and arima model).
</p>
</li>
<li> <p><code>score_formula</code> that will store the formula used to calculate the
score (when relevant). Its initial value is <code>NULL</code>.
</p>
</li></ul>

<p>If <code>x</code> is supplied, the <code>file</code> and <code>matrix_output_file</code>
arguments are ignored. The <code>file</code> argument also designates the path to
the file containing the diagnostic matrix (which can be imported into R in
parallel and used with the <code>x</code> argument).
</p>


<h3>Value</h3>

<p>a <code><a href="#topic+QR_matrix">QR_matrix</a></code> object.
</p>


<h3>See Also</h3>

<p><a href="#topic+fr-extract_QR">Traduction française</a>
</p>
<p>Other QR_matrix functions: 
<code><a href="#topic+export_xlsx">export_xlsx</a>()</code>,
<code><a href="#topic+export_xlsx.QR_matrix">export_xlsx.QR_matrix</a>()</code>,
<code><a href="#topic+export_xlsx.mQR_matrix">export_xlsx.mQR_matrix</a>()</code>,
<code><a href="#topic+rbind.QR_matrix">rbind.QR_matrix</a>()</code>,
<code><a href="#topic+sort">sort</a>()</code>,
<code><a href="#topic+weighted_score">weighted_score</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Path of matrix demetra_m
demetra_path &lt;- file.path(
    system.file("extdata", package = "JDCruncheR"),
    "WS/ws_ipi/Output/SAProcessing-1",
    "demetra_m.csv"
)

# Extract the quality report from the demetra_m file
QR &lt;- extract_QR(file = demetra_path)

print(QR)

# Extract the modalities matrix:
QR[["modalities"]]
# Or:
QR[["modalities"]]

</code></pre>

<hr>
<h2 id='extract_score'>Score extraction</h2><span id='topic+extract_score'></span>

<h3>Description</h3>

<p>To extract score variables from <code><a href="#topic+QR_matrix">QR_matrix</a></code> or
<code><a href="#topic+mQR_matrix">mQR_matrix</a></code> objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_score(
  x,
  format_output = c("data.frame", "vector"),
  weighted_score = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extract_score_+3A_x">x</code></td>
<td>
<p>a <code><a href="#topic+QR_matrix">QR_matrix</a></code> or <code><a href="#topic+mQR_matrix">mQR_matrix</a></code>.</p>
</td></tr>
<tr><td><code id="extract_score_+3A_format_output">format_output</code></td>
<td>
<p>string of characters indicating the output format:
either a <code>data.frame</code> or a <code>vector</code>.</p>
</td></tr>
<tr><td><code id="extract_score_+3A_weighted_score">weighted_score</code></td>
<td>
<p>logical indicating whether to extract the weighted
score (if previously calculated) or the unweighted one.
By default, the unweighted score is extracted.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For <code><a href="#topic+QR_matrix">QR_matrix</a></code> objects, the output is a vector or the
object <code>NULL</code> if no score was previously calculated.
For <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> objects, it is a list of scores (<code>NULL</code>
elements or vectors).
</p>


<h3>Value</h3>

<p><code>extract_score()</code> returns a data.frame with two column: the
series name and their score.
</p>


<h3>See Also</h3>

<p><a href="#topic+fr-extract_score">Traduction française</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Path of matrix demetra_m
demetra_path &lt;- file.path(
    system.file("extdata", package = "JDCruncheR"),
    "WS/ws_ipi/Output/SAProcessing-1",
    "demetra_m.csv"
)

# Extract the quality report from the demetra_m file
QR &lt;- extract_QR(demetra_path)

# Compute the score
QR1 &lt;- compute_score(x = QR, n_contrib_score = 5)
QR2 &lt;- compute_score(
    x = QR,
    score_pond = c(qs_residual_sa_on_sa = 5, qs_residual_sa_on_i = 30,
                   f_residual_td_on_sa = 10, f_residual_td_on_i = 40,
                   oos_mean = 30, residuals_skewness = 15, m7 = 25)
)
mQR &lt;- mQR_matrix(list(a = QR1, b = QR2))

# Extract score
extract_score(QR1)
extract_score(mQR)

</code></pre>

<hr>
<h2 id='fr-add_indicator'>Ajout d'un indicateur dans les objets QR_matrix</h2><span id='topic+fr-add_indicator'></span>

<h3>Description</h3>

<p>Permet d'ajouter un indicateur dans les objets <code><a href="#topic+QR_matrix">QR_matrix</a></code>.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fr-add_indicator_+3A_x">x</code></td>
<td>
<p>objet de type <code><a href="#topic+QR_matrix">QR_matrix</a></code> ou <code><a href="#topic+mQR_matrix">mQR_matrix</a></code>.</p>
</td></tr>
<tr><td><code id="fr-add_indicator_+3A_indicator">indicator</code></td>
<td>
<p>un <code>vector</code> ou un <code>data.frame</code> (voir détails).</p>
</td></tr>
<tr><td><code id="fr-add_indicator_+3A_variable_name">variable_name</code></td>
<td>
<p>chaîne de caractères contenant les noms des nouvelles
variables.</p>
</td></tr>
<tr><td><code id="fr-add_indicator_+3A_...">...</code></td>
<td>
<p>autres paramètres de la fonction <code><a href="base.html#topic+merge">merge</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>La fonction <code>add_indicator()</code> permet d'ajouter un indicateur
dans la matrice des valeurs du bilan qualité. L'indicateur n'est donc pas
ajouté dans la matrice des modalités et ne peut être utilisé dans le calcul
du score (sauf pour le pondérer). Pour l'utiliser dans le calcul du score, il
faudra d'abord le recoder avec la fonction
<code><a href="#topic+recode_indicator_num">recode_indicator_num</a></code>.
</p>
<p>L'indicateur à ajouter peut être sous deux formats : <code>vector</code> ou
<code>data.frame</code>. Dans les deux cas, il faut que les valeurs à ajouter
puissent être associées aux bonnes séries dans la matrice du bilan qualité :
</p>

<ul>
<li><p> dans le cas d'un <code>vector</code>, les éléments devront être nommés et les
noms doivent correspondre à ceux présents dans le bilan qualité (variable
&quot;series&quot;) ;
</p>
</li>
<li><p> dans le cas d'un <code>data.frame</code>, il devra contenir une colonne &quot;series&quot;
avec les noms des séries correspondantes.
</p>
</li></ul>



<h3>Value</h3>

<p>Cette fonction renvoie le même objet, enrichi de l'indicateur
choisi. Ainsi, si l'entrée <code>x</code> est une matrice QR, un objet de la classe
<code>QR_matrix</code> est renvoyé. Si le code d'entrée <code>x</code> est une matrice
mQR, un objet de la classe <code>mQR_matrix</code> est renvoyé.
</p>

<hr>
<h2 id='fr-compute_score'>Calcul d'un score global</h2><span id='topic+fr-compute_score'></span>

<h3>Description</h3>

<p>Permet de calculer un score global à partir d'un bilan qualité
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fr-compute_score_+3A_x">x</code></td>
<td>
<p>Objet de type <code><a href="#topic+QR_matrix">QR_matrix</a></code> ou <code><a href="#topic+mQR_matrix">mQR_matrix</a></code>.</p>
</td></tr>
<tr><td><code id="fr-compute_score_+3A_score_pond">score_pond</code></td>
<td>
<p>formule utilisée pour calculer le score global.</p>
</td></tr>
<tr><td><code id="fr-compute_score_+3A_modalities">modalities</code></td>
<td>
<p>modalités triées par ordre d'importance dans le calcul du
score (voir détails).</p>
</td></tr>
<tr><td><code id="fr-compute_score_+3A_normalize_score_value">normalize_score_value</code></td>
<td>
<p>Chiffre indiquant la valeur de référence pour la
normalisation des pondérations utilisées lors du calcul du score. Si le
paramètre n'est pas renseigné, les poids ne seront pas normalisés.</p>
</td></tr>
<tr><td><code id="fr-compute_score_+3A_na.rm">na.rm</code></td>
<td>
<p>Booléen indiquant si les valeurs manquantes doivent être
enlevées pour le calcul du score.</p>
</td></tr>
<tr><td><code id="fr-compute_score_+3A_n_contrib_score">n_contrib_score</code></td>
<td>
<p>Entier indiquant le nombre de variables à créer dans
la matrice des valeurs du bilan qualité contenant les <code>n_contrib_score</code>
plus grandes contributrices au score (voir détails). S'il n'est pas spécifié,
aucune variable n'est créée.</p>
</td></tr>
<tr><td><code id="fr-compute_score_+3A_conditional_indicator">conditional_indicator</code></td>
<td>
<p><code>list</code> contenant des listes ayant 3
éléments : &quot;indicator&quot;, &quot;conditions&quot; et &quot;condition_modalities&quot;. Permet de
réduire à 1 le poids de certains indicateurs en fonction des valeurs d'autres
variables (voir détails).</p>
</td></tr>
<tr><td><code id="fr-compute_score_+3A_thresholds">thresholds</code></td>
<td>
<p><code>list</code> de vecteurs numériques. Seuils appliqués aux
différents tests afin de classer en modalités <code>Good</code>, <code>Uncertain</code>,
<code>Bad</code> et <code>Severe</code>.
Par défault, la valeur de l'option <code>"jdc_threshold"</code> est utilisée.
Vous pouvez appeler la fonction <code><a href="#topic+get_thresholds">get_thresholds</a></code> pour voir à quoi
doit ressemble l'objet <code>thresholds</code>.</p>
</td></tr>
<tr><td><code id="fr-compute_score_+3A_...">...</code></td>
<td>
<p>Autres paramètres non utilisés.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>La fonction <code>compute_score</code> permet de calculer un score à
partir des modalités d'un bilan qualité. Pour cela, chaque modalité est
associée à un poids défini par le paramètre <code>modalities</code>. Ainsi, le
paramètre par défaut étant <code>c("Good", "Uncertain", "Bad","Severe")</code>,
la valeur <code>"Good"</code> sera associée à la note 0, la valeur
<code>"Uncertain"</code> sera associée à la note 1, la valeur <code>"Bad"</code> sera
associée à la note 2 et la valeur <code>"Bad"</code> sera associée à la note 3.
Le calcul du score se fait grâce au paramètre <code>score_pond</code>, qui est un
vecteur numérique nommé contenant des poids et dont les noms correspondent
aux variables de la matrice des modalités à utiliser dans le score. Ainsi,
avec le paramètre
<code>score_pond = c(qs_residual_sa_on_sa = 10, f_residual_td_on_sa = 5)</code>
le score sera calculé à partir des deux variables <code>qs_residual_sa_on_sa</code>
et <code>f_residual_td_on_sa</code>. Les notes associées aux modalités de la
variable <code>qs_residual_sa_on_sa</code> seront multipliées par 10 et celles
associées à la variable <code>f_residual_td_on_sa</code> seront multipliées par 5.
Dans le calcul du score, certaines variables peuvent être manquantes: pour ne
pas prendre en compte ces valeurs dans le calcul, il suffit d'utiliser le
paramètre <code>na.rm = TRUE</code>. Le paramètre <code>normalize_score_value</code>
permet de normaliser les scores.
Par exemple, si l'on souhaite avoir des notes entre 0 et 20, il suffit
d'utiliser le paramètre <code>normalize_score_value = 20</code>. Le paramètre
<code>n_contrib_score</code> permet d'ajouter de nouvelles variables à la matrice
des valeurs du bilan qualité dont les valeurs correspondent aux noms des
variables qui contribuent le plus au score de la série.
<code>n_contrib_score</code> est un entier égal au nombre de variables
contributrices que l'on souhaite exporter. Par exemple, pour
<code>n_contrib_score = 3</code>, trois colonnes seront créées et elles
contiendront les trois plus grandes contributrices au score. Les noms des
nouvelles variables sont <em>i</em>_highest_score, <em>i</em> correspondant au rang en
terme de contribution au score (1_highest_score contiendra les noms des plus
grandes contributrices, 2_highest_score des deuxièmes plus grandes
contributrices, etc). Seules les variables qui ont une contribution non nulle
au score sont prises en compte. Ainsi, si une série a un score nul, toutes
les colonnes <em>i</em>_highest_score associées à cette série seront vides. Et si
une série a un score positif uniquement du fait de la variable &quot;m7&quot;, alors la
valeur correspondante à la variable 1_highest_score sera égale à &quot;m7&quot; et
celle des autres variables <em>i</em>_highest_score seront vides. Certains
indicateurs peuvent n'avoir de sens que sous certaines conditions.
Par exemple, le test d'homoscédasticité n'est valide que si les résidus sont
indépendants et les tests de normalité, que si les résidus sont indépendants
et homoscédastiques. Le paramètre <code>conditional_indicator</code> permet de
prendre cela en compte en réduisant, sous certaines conditions, à 1 le poids
de certains variables. C'est une <code>list</code> contenant des listes ayant 3
éléments :
</p>

<ul>
<li><p> &quot;indicator&quot; : nom de la variable pour laquelle on veut ajouter des
conditions
</p>
</li>
<li><p> &quot;conditions&quot; : nom des variables que l'on utilise pour conditionner
</p>
</li>
<li><p> &quot;conditions_modalities&quot; : modalités qui doivent être vérifiées pour
modifier le poids Ainsi, avec le paramètre
<code>conditional_indicator = list(list(indicator = "residuals_skewness",
  conditions = c("residuals_independency", "residuals_homoskedasticity"),
  conditions_modalities = c("Bad","Severe")))</code>, on réduit à 1 le poids de la
variable &quot;residuals_skewness&quot; lorsque les modalités du test d'indépendance
(&quot;residuals_independency&quot;) ou du test d'homoscédasticité
(&quot;residuals_homoskedasticity&quot;) valent &quot;Bad&quot; ou &quot;Severe&quot;.
</p>
</li></ul>



<h3>Value</h3>

<p>Un objet de type <code><a href="#topic+QR_matrix">QR_matrix</a></code> ou <code><a href="#topic+mQR_matrix">mQR_matrix</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Chemin menant au fichier demetra_m.csv
demetra_path &lt;- file.path(
    system.file("extdata", package = "JDCruncheR"),
    "WS/ws_ipi/Output/SAProcessing-1",
    "demetra_m.csv"
)

# Extraire le bilan qualité à partir du fichier demetra_m.csv
QR &lt;- extract_QR(demetra_path)

# Compute the score
QR &lt;- compute_score(QR, n_contrib_score = 2)
print(QR)

# Extraire les modalités de la matrice
QR[["modalities"]][["score"]]

</code></pre>

<hr>
<h2 id='fr-export_xlsx.mQR_matrix'>Export des objets mQR_matrix dans des fichiers Excel</h2><span id='topic+fr-export_xlsx.mQR_matrix'></span>

<h3>Description</h3>

<p>Permet d'exporter dans des fichiers Excel une liste de bilan qualité
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fr-export_xlsx.mQR_matrix_+3A_x">x</code></td>
<td>
<p>objet de type <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> à exporter.</p>
</td></tr>
<tr><td><code id="fr-export_xlsx.mQR_matrix_+3A_export_dir">export_dir</code></td>
<td>
<p>dossier d'export des résultats.</p>
</td></tr>
<tr><td><code id="fr-export_xlsx.mQR_matrix_+3A_layout_file">layout_file</code></td>
<td>
<p>paramètre d'export. Par défaut,
(<code>layout_file = "ByComponent"</code>) et un fichier Excel est exporté par
composante de la matrice bilan qualité (matrice des modalités ou des
valeurs), dont chaque feuille correspond à un bilan qualité. Pour avoir un
fichier par bilan qualité dont chaque feuille correspond à la composante
exportée, utiliser <code>layout_file = "ByQRMatrix"</code>.
La modalité <code>layout_file = "AllTogether"</code> correspond à la création d'un
fichier avec 2 feuilles par bilan qualité (<code>Values</code> et
<code>Modalities</code>).</p>
</td></tr>
<tr><td><code id="fr-export_xlsx.mQR_matrix_+3A_auto_format">auto_format</code></td>
<td>
<p>booléen indiquant s'il faut formatter la sortie
(<code>auto_format = TRUE</code> par défaut).</p>
</td></tr>
<tr><td><code id="fr-export_xlsx.mQR_matrix_+3A_overwrite">overwrite</code></td>
<td>
<p>booléen indiquant s'il faut ré-écrire créer le fichier Excel
s'il existe déjà (<code>create = TRUE</code> par défaut)</p>
</td></tr>
<tr><td><code id="fr-export_xlsx.mQR_matrix_+3A_...">...</code></td>
<td>
<p>autres argument non utilisés</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Renvoie de manière invisible (via <code>invisible(x)</code>) le même objet
<code><a href="#topic+mQR_matrix">mQR_matrix</a></code> que <code>x</code>.
</p>

<hr>
<h2 id='fr-export_xlsx.QR_matrix'>Export des objets QR_matrix dans un fichier Excel</h2><span id='topic+fr-export_xlsx.QR_matrix'></span>

<h3>Description</h3>

<p>Permet d'exporter un bilan qualité dans un fichier Excel.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fr-export_xlsx.QR_matrix_+3A_x">x</code></td>
<td>
<p>objet de type <code><a href="#topic+QR_matrix">QR_matrix</a></code>.</p>
</td></tr>
<tr><td><code id="fr-export_xlsx.QR_matrix_+3A_file">file</code></td>
<td>
<p>un objet de type <code>character</code> contenant le chemin menant au
fichier que l'on veut créer</p>
</td></tr>
<tr><td><code id="fr-export_xlsx.QR_matrix_+3A_auto_format">auto_format</code></td>
<td>
<p>booléen indiquant s'il faut formatter la sortie
(<code>auto_format = TRUE</code> par défaut).</p>
</td></tr>
<tr><td><code id="fr-export_xlsx.QR_matrix_+3A_overwrite">overwrite</code></td>
<td>
<p>booléen indiquant s'il faut ré-écrire créer le fichier Excel
s'il existe déjà (<code>create = TRUE</code> par défaut)</p>
</td></tr>
<tr><td><code id="fr-export_xlsx.QR_matrix_+3A_...">...</code></td>
<td>
<p>autres argument non utilisés</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Renvoie de manière invisible (via <code>invisible(x)</code>) un objet de
classeur créé par <code>XLConnect::loadWorkbook()</code> pour une manipulation
ultérieure.
</p>

<hr>
<h2 id='fr-extract_QR'>Extraction d'un bilan qualité</h2><span id='topic+fr-extract_QR'></span>

<h3>Description</h3>

<p>Permet d'extraire un bilan qualité à partir du fichier CSV contenant la
matrice des diagnostics.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fr-extract_QR_+3A_matrix_output_file">matrix_output_file</code></td>
<td>
<p>Chaîne de caracère. Chemin vers le fichier CSV
contenant la matrice des diagnostics.</p>
</td></tr>
<tr><td><code id="fr-extract_QR_+3A_file">file</code></td>
<td>
<p>Chaîne de caracère. Chemin vers le fichier CSV contenant la
matrice des diagnostics. Cet argument remplace l'argument
<code>matrix_output_file</code>.</p>
</td></tr>
<tr><td><code id="fr-extract_QR_+3A_sep">sep</code></td>
<td>
<p>séparateur de caractères utilisé dans le fichier csv (par défaut
<code>sep = ";"</code>)</p>
</td></tr>
<tr><td><code id="fr-extract_QR_+3A_dec">dec</code></td>
<td>
<p>séparateur décimal utilisé dans le fichier csv (par défaut
<code>dec = ","</code>)</p>
</td></tr>
<tr><td><code id="fr-extract_QR_+3A_thresholds">thresholds</code></td>
<td>
<p><code>list</code> de vecteurs numériques. Seuils appliqués aux
différents tests afin de classer en modalités <code>Good</code>, <code>Uncertain</code>,
<code>Bad</code> et <code>Severe</code>.
Par défault, la valeur de l'option <code>"jdc_threshold"</code> est utilisée.
Vous pouvez appeler la fonction <code><a href="#topic+get_thresholds">get_thresholds</a></code> pour voir à quoi
doit ressemble l'objet <code>thresholds</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>La fonction permet d'extraire un bilan qualité à partir d'un
fichier csv contenant l'ensemble des
diagnostics (généralement fichier <em>demetra_m.csv</em>).
</p>
<p>Ce fichier peut être obtenu en lançant le cruncher
(<code><a href="rjwsacruncher.html#topic+cruncher">cruncher</a></code> ou
<code><a href="rjwsacruncher.html#topic+cruncher_and_param">cruncher_and_param</a></code>) avec l'ensemble des
paramètres de base pour les paramètres à exporter et l'option
<code>csv_layout = "vtable"</code> (par défaut) pour le format de sortie des
fichiers csv (option de <code><a href="rjwsacruncher.html#topic+cruncher_and_param">cruncher_and_param</a></code> ou de
<code><a href="rjwsacruncher.html#topic+create_param_file">create_param_file</a></code> lors de la création du fichier
de paramètres).
</p>
<p>Le résultat de cette fonction est un objet <code><a href="#topic+QR_matrix">QR_matrix</a></code> qui est
une liste de trois paramètres :
</p>

<ul>
<li><p> le paramètre <code>modalities</code> est un <code>data.frame</code> contenant un
ensemble de variables sous forme catégorielle (Good, Uncertain, Bad,
Severe).
</p>
</li>
<li><p> le paramètre <code>values</code> est un <code>data.frame</code> contenant les valeurs
associées aux indicateurs présents dans <code>modalities</code> (i.e. :
p-valeurs, statistiques, etc.) ainsi que des variables qui n'ont pas de
modalité (fréquence de la série et modèle ARIMA).
</p>
</li>
<li><p> le paramètre <code>score_formula</code> est initié à <code>NULL</code> : il contiendra
la formule utilisée pour calculer le score (si le calcul est fait).
</p>
</li></ul>

<p>Si <code>x</code> est fourni, les arguments <code>fichier</code> et
<code>matrix_output_file</code> sont ignorés. L'argument <code>fichier</code> désigne
également le chemin vers le fichier qui contient la matrice de diagnostic
(qui peut être importée en parallèle dans R et utilisée avec l'argument
<code>x</code>).
</p>


<h3>Value</h3>

<p>Un objet de type <code><a href="#topic+QR_matrix">QR_matrix</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Chemin menant au fichier demetra_m.csv
demetra_path &lt;- file.path(
    system.file("extdata", package = "JDCruncheR"),
    "WS/ws_ipi/Output/SAProcessing-1",
    "demetra_m.csv"
)

# Extraire le bilan qualité à partir du fichier demetra_m.csv
QR &lt;- extract_QR(file = demetra_path)

print(QR)

# Extraire les modalités de la matrice
QR[["modalities"]]
# Or:
QR[["modalities"]]

</code></pre>

<hr>
<h2 id='fr-extract_score'>Extraction du score</h2><span id='topic+fr-extract_score'></span>

<h3>Description</h3>

<p>Permet d'extraire le score des objets <code><a href="#topic+QR_matrix">QR_matrix</a></code> ou
<code><a href="#topic+mQR_matrix">mQR_matrix</a></code>.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fr-extract_score_+3A_x">x</code></td>
<td>
<p>objet de type <code><a href="#topic+QR_matrix">QR_matrix</a></code> ou <code><a href="#topic+mQR_matrix">mQR_matrix</a></code>.</p>
</td></tr>
<tr><td><code id="fr-extract_score_+3A_format_output">format_output</code></td>
<td>
<p>chaîne de caractères indiquant le format de l'objet en
sortie :
soit un <code>data.frame</code> soit un <code>vector</code>.</p>
</td></tr>
<tr><td><code id="fr-extract_score_+3A_weighted_score">weighted_score</code></td>
<td>
<p>booléen indiquant s'il faut extraire le score pondéré
(s'il existe) ou le score non pondéré.
Par défaut, c'est le score non pondéré qui est extrait.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Pour les objets <code><a href="#topic+QR_matrix">QR_matrix</a></code>, le score renvoyé est soit
l'objet <code>NULL</code> si aucun score n'a été calculé, soit un vecteur.
Pour les objets <code><a href="#topic+mQR_matrix">mQR_matrix</a></code>, c'est une liste de scores
(<code>NULL</code> ou un vecteur).
</p>


<h3>Value</h3>

<p><code>extract_score()</code> renvoie un data.frame avec deux colonnes : le
nom de la série et son score.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Chemin menant au fichier demetra_m.csv
demetra_path &lt;- file.path(
    system.file("extdata", package = "JDCruncheR"),
    "WS/ws_ipi/Output/SAProcessing-1",
    "demetra_m.csv"
)

# Extraire le bilan qualité à partir du fichier demetra_m.csv
QR &lt;- extract_QR(demetra_path)

# Calculer le score
QR1 &lt;- compute_score(x = QR, n_contrib_score = 5)
QR2 &lt;- compute_score(
    x = QR,
    score_pond = c(qs_residual_sa_on_sa = 5, qs_residual_sa_on_i = 30,
                   f_residual_td_on_sa = 10, f_residual_td_on_i = 40,
                   oos_mean = 30, residuals_skewness = 15, m7 = 25)
)
mQR &lt;- mQR_matrix(list(a = QR1, b = QR2))

# Extraire les scores
extract_score(QR1)
extract_score(mQR)

</code></pre>

<hr>
<h2 id='fr-print.QR_matrix'>Affichage des objets QR_matrix et mQR_matrix</h2><span id='topic+fr-print.QR_matrix'></span>

<h3>Description</h3>

<p>Pour afficher un objet QR_matrix ou mQR_matrix.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fr-print.QR_matrix_+3A_x">x</code></td>
<td>
<p>objet de type <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> ou <code><a href="#topic+mQR_matrix">mQR_matrix</a></code>.</p>
</td></tr>
<tr><td><code id="fr-print.QR_matrix_+3A_print_variables">print_variables</code></td>
<td>
<p>booléen pour imprimer ou non les noms des indicateurs
(supplémentaire inclus).</p>
</td></tr>
<tr><td><code id="fr-print.QR_matrix_+3A_print_score_formula">print_score_formula</code></td>
<td>
<p>booléen pour imprimer ou non la formule qui a
servi à calculer le score (le cas échéant).</p>
</td></tr>
<tr><td><code id="fr-print.QR_matrix_+3A_score_statistics">score_statistics</code></td>
<td>
<p>booléen pour imprimer ou non des statistiques sur les
scores de la <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> (le cas échéant).</p>
</td></tr>
<tr><td><code id="fr-print.QR_matrix_+3A_...">...</code></td>
<td>
<p>autres arguments non utilisés.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>la méthode <code>print</code> imprime un objet <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> ou
<code><a href="#topic+mQR_matrix">mQR_matrix</a></code> et le renvoie de manière invisible (via
<code>invisible(x)</code>).
</p>

<hr>
<h2 id='fr-QR_matrix'>Objets bilan qualité</h2><span id='topic+fr-QR_matrix'></span>

<h3>Description</h3>

<p><code>QR_matrix()</code> permet de créer un objet de type <code><a href="#topic+QR_matrix">QR_matrix</a></code>
contenant un bilan qualité.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fr-QR_matrix_+3A_modalities">modalities</code></td>
<td>
<p>un <code>data.frame</code> contenant les modalités (Good, Bad,
etc.) associées aux variables.</p>
</td></tr>
<tr><td><code id="fr-QR_matrix_+3A_values">values</code></td>
<td>
<p>un <code>data.frame</code> contenant les valeurs (p-valeurs des
tests, statistiques, etc.) associées aux variables. Peut donc contenir plus
de variables que le data.frame <code>modalities</code>.</p>
</td></tr>
<tr><td><code id="fr-QR_matrix_+3A_score_formula">score_formula</code></td>
<td>
<p>formule utilisée pour calculer le score global (s'il
existe).</p>
</td></tr>
<tr><td><code id="fr-QR_matrix_+3A_x">x</code></td>
<td>
<p>un objet de type <code><a href="#topic+QR_matrix">QR_matrix</a></code>, <code><a href="#topic+mQR_matrix">mQR_matrix</a></code>
ou une liste d'objets <code><a href="#topic+QR_matrix">QR_matrix</a></code>.</p>
</td></tr>
<tr><td><code id="fr-QR_matrix_+3A_...">...</code></td>
<td>
<p>des objets du même type que <code>x</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>mQR_matrix()</code> permet de créer un objet de type <code><a href="#topic+mQR_matrix">mQR_matrix</a></code>
qui est une liste de bilans qualité (donc d'objets <code><a href="#topic+QR_matrix">QR_matrix</a></code>).
</p>
<p><code>is.QR_matrix()</code> et <code>is.mQR_matrix()</code> permettent de tester si un
objet est un bilan qualité ou une liste de bilans qualité.
</p>
<p>Un objet  de type <code><a href="#topic+QR_matrix">QR_matrix</a></code> est une liste de trois
paramètres :
</p>

<ul>
<li><p> le paramètre <code>modalities</code> est un <code>data.frame</code> contenant un
ensemble de variables sous forme catégorielle (par défaut : Good,
Uncertain, Bad, Severe).
</p>
</li>
<li><p> le paramètre <code>values</code>  est un <code>data.frame</code> contenant les valeurs
associées aux indicateurs présents dans <code>modalities</code> (i.e. :
p-valeurs, statistiques, etc.), ainsi que des variables qui n'ont pas de
modalité (i.e. : fréquence de la série, modèle ARIMA, etc).
</p>
</li>
<li><p> le paramètre <code>score_formula</code> contient la formule utilisée pour
calculer le score (une fois le calcul réalisé).
</p>
</li></ul>



<h3>Value</h3>

<p><code>QR_matrix()</code> crée et renvoie un objet <code><a href="#topic+QR_matrix">QR_matrix</a></code>.
<code>mQR_matrix()</code> crée et renvoie un objet <code><a href="#topic+mQR_matrix">mQR_matrix</a></code>
(c'est-à-dire une liste d'objets <code><a href="#topic+QR_matrix">QR_matrix</a></code>).
<code>is.QR_matrix()</code> et <code>is.mQR_matrix()</code> renvoient des valeurs
booléennes (<code>TRUE</code> ou <code>FALSE</code>).
</p>

<hr>
<h2 id='fr-rbind.QR_matrix'>Combiner par ligne des objets QR_matrix</h2><span id='topic+fr-rbind.QR_matrix'></span>

<h3>Description</h3>

<p>Permet de combiner plusieurs objets <code><a href="#topic+QR_matrix">QR_matrix</a></code> en combinant par
ligne les paramètres <code>modalities</code> et <code>values</code>.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fr-rbind.QR_matrix_+3A_...">...</code></td>
<td>
<p>objets <code><a href="#topic+QR_matrix">QR_matrix</a></code> à combiner.</p>
</td></tr>
<tr><td><code id="fr-rbind.QR_matrix_+3A_check_formula">check_formula</code></td>
<td>
<p>booléen indiquant s'il faut vérifier la cohérence dans
les formules de calcul du score.
Par défaut, <code>check_formula = TRUE</code> : la fonction renvoie une erreur si
des scores sont calculés avec des formules différentes. Si
<code>check_formula = FALSE</code>, alors il n'y a pas de vérification et le
paramètre <code>score_formula</code> de l'objet en sortie est <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>rbind.QR_matrix()</code> renvoie un objet <code><a href="#topic+QR_matrix">QR_matrix</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Chemin menant au fichier demetra_m.csv
demetra_path &lt;- file.path(
    system.file("extdata", package = "JDCruncheR"),
    "WS/ws_ipi/Output/SAProcessing-1",
    "demetra_m.csv"
)

# Extraire le bilan qualité à partir du fichier demetra_m.csv
QR &lt;- extract_QR(demetra_path)

# Calculer differents scores
QR1 &lt;- compute_score(QR, score_pond = c(m7 = 2, q = 3, qs_residual_sa_on_sa = 5))
QR2 &lt;- compute_score(QR, score_pond = c(m7 = 2, qs_residual_sa_on_sa = 5))

# Fusionner 2 bilans qualité
try(rbind(QR1, QR2)) # Une erreur est renvoyée
rbind(QR1, QR2, check_formula = FALSE)

</code></pre>

<hr>
<h2 id='fr-recode_indicator_num'>Ré-encodage en modalités des variables</h2><span id='topic+fr-recode_indicator_num'></span>

<h3>Description</h3>

<p>Permet d'encoder des variables présentes dans la matrice des valeurs en
modalités ajoutables à la matrice des modalités.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fr-recode_indicator_num_+3A_x">x</code></td>
<td>
<p>objet de type <code><a href="#topic+QR_matrix">QR_matrix</a></code> ou <code><a href="#topic+mQR_matrix">mQR_matrix</a></code>.</p>
</td></tr>
<tr><td><code id="fr-recode_indicator_num_+3A_variable_name">variable_name</code></td>
<td>
<p>vecteur de chaînes de caractères contenant les noms des
variables à recoder.</p>
</td></tr>
<tr><td><code id="fr-recode_indicator_num_+3A_breaks">breaks</code></td>
<td>
<p>voir l'argument éponyme de la fonction <code><a href="base.html#topic+cut">cut</a></code>.</p>
</td></tr>
<tr><td><code id="fr-recode_indicator_num_+3A_labels">labels</code></td>
<td>
<p>voir l'argument éponyme de la fonction <code><a href="base.html#topic+cut">cut</a></code>.</p>
</td></tr>
<tr><td><code id="fr-recode_indicator_num_+3A_...">...</code></td>
<td>
<p>autres paramètres de la fonction <code><a href="base.html#topic+cut">cut</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>La fonction <code>recode_indicator_num()</code> renvoie le même objet,
enrichi de l'indicateur choisi. Ainsi, si l'entrée <code>x</code> est une matrice
QR_matrix, un objet de classe <code>QR_matrix</code> est renvoyé. Si le code
d'entrée <code>x</code> est une matrice mQR, un objet de la classe
<code>mQR_matrix</code> est renvoyé.
</p>

<hr>
<h2 id='fr-remove_indicators'>Manipulation de la liste des indicateurs</h2><span id='topic+fr-remove_indicators'></span>

<h3>Description</h3>

<p>Permet de retirer des indicateurs (fonction <code>remove_indicators()</code>) ou de
n'en retenir que certains (fonction <code>retain_indicators()</code>) d'objets
<code><a href="#topic+QR_matrix">QR_matrix</a></code> ou <code><a href="#topic+mQR_matrix">mQR_matrix</a></code>. Le nom des séries
(colonne &quot;series&quot;) ne peut être enlevé.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fr-remove_indicators_+3A_x">x</code></td>
<td>
<p>objet de type <code><a href="#topic+QR_matrix">QR_matrix</a></code> ou <code><a href="#topic+mQR_matrix">mQR_matrix</a></code>.</p>
</td></tr>
<tr><td><code id="fr-remove_indicators_+3A_...">...</code></td>
<td>
<p>noms des variables à retirer (ou conserver).</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>remove_indicators()</code> renvoie le même objet <code>x</code> réduit par
les drapeaux et les variables utilisés comme arguments ... Donc si l'entrée
<code>x</code> est une matrice QR_matrix, un objet de la classe QR_matrix est
renvoyé. Si le code d'entrée <code>x</code> est une matrice mQR, un objet de la
classe mQR_matrix est renvoyé.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Chemin menant au fichier demetra_m.csv
demetra_path &lt;- file.path(
    system.file("extdata", package = "JDCruncheR"),
    "WS/ws_ipi/Output/SAProcessing-1",
    "demetra_m.csv"
)

# Extraire le bilan qualité à partir du fichier demetra_m.csv
QR &lt;- extract_QR(demetra_path)

# Calculer le score
QR &lt;- compute_score(x = QR, n_contrib_score = 5)

# Retenir certains indicateurs
retain_indicators(QR, "score", "m7") # Retiens les indicateurs "score" et "m7"
retain_indicators(QR, c("score", "m7")) # Pareil

# Retirer des indicateurs
QR &lt;- remove_indicators(QR, "score") # removing "score"

extract_score(QR) # est NULL car l'indicateur "score a été retiré

</code></pre>

<hr>
<h2 id='fr-sort.QR_matrix'>Tri des objets QR_matrix et mQR_matrix</h2><span id='topic+fr-sort.QR_matrix'></span>

<h3>Description</h3>

<p>Permet de trier les bilans qualité en fonction d'une ou plusieurs variables.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fr-sort.QR_matrix_+3A_x">x</code></td>
<td>
<p>objet de type <code><a href="#topic+QR_matrix">QR_matrix</a></code> ou <code><a href="#topic+mQR_matrix">mQR_matrix</a></code>.</p>
</td></tr>
<tr><td><code id="fr-sort.QR_matrix_+3A_decreasing">decreasing</code></td>
<td>
<p>booléen indiquant si les bilans qualité doivent être triés
par ordre croissant ou décroissant.
Par défaut, le tri est effectué par ordre croissant.</p>
</td></tr>
<tr><td><code id="fr-sort.QR_matrix_+3A_sort_variables">sort_variables</code></td>
<td>
<p>variables à utiliser pour le tri. Elles doivent être
présentes dans les tables de modalités.</p>
</td></tr>
<tr><td><code id="fr-sort.QR_matrix_+3A_...">...</code></td>
<td>
<p>autres paramètres de la fonction <code><a href="base.html#topic+order">order</a></code> (non
utilisés pour l'instant).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>L'objet en entrée avec les tables de bilan qualité triées.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Chemin menant au fichier demetra_m.csv
demetra_path &lt;- file.path(
    system.file("extdata", package = "JDCruncheR"),
    "WS/ws_ipi/Output/SAProcessing-1",
    "demetra_m.csv"
)

# Extraire le bilan qualité à partir du fichier demetra_m.csv
QR &lt;- extract_QR(demetra_path)

# Calculer le score
QR &lt;- compute_score(QR, n_contrib_score = 2)
print(QR[["modalities"]][["score"]])

# Trier les scores

# Pour trier par ordre croissant sur le score
QR &lt;- sort(QR, sort_variables = "score")
print(QR[["modalities"]][["score"]])

</code></pre>

<hr>
<h2 id='fr-weighted_score'>Calcul d'un score pondéré pour chaque observation</h2><span id='topic+fr-weighted_score'></span>

<h3>Description</h3>

<p>Permet de pondérer un score déjà calculé en fonction de variables.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fr-weighted_score_+3A_x">x</code></td>
<td>
<p>objet de type <code><a href="#topic+QR_matrix">QR_matrix</a></code> ou <code><a href="#topic+mQR_matrix">mQR_matrix</a></code>.</p>
</td></tr>
<tr><td><code id="fr-weighted_score_+3A_pond">pond</code></td>
<td>
<p>pondération à appliquer au score. Il peut s'agir d'un nombre,
d'un vecteur de nombres, du nom d'une des variables du bilan qualité ou d'une
liste de pondérations pour les objets <code><a href="#topic+mQR_matrix">mQR_matrix</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>L'objet en entrée avec le score recalculé
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Chemin menant au fichier demetra_m.csv
demetra_path &lt;- file.path(
    system.file("extdata", package = "JDCruncheR"),
    "WS/ws_ipi/Output/SAProcessing-1",
    "demetra_m.csv"
)

# Extraire le bilan qualité à partir du fichier demetra_m.csv
QR &lt;- extract_QR(demetra_path)

# Calculer le score
QR &lt;- compute_score(QR, n_contrib_score = 2)
print(QR)

# Pondérer le score
QR &lt;- weighted_score(QR, 2)
print(QR)

# Extraire le score pondéré
QR[["modalities"]][["score_pond"]]

</code></pre>

<hr>
<h2 id='get_thresholds'>Get all (default) thresholds</h2><span id='topic+get_thresholds'></span>

<h3>Description</h3>

<p>Get all (default) thresholds
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_thresholds(test_name, default = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_thresholds_+3A_test_name">test_name</code></td>
<td>
<p>String. The name of the test to get.</p>
</td></tr>
<tr><td><code id="get_thresholds_+3A_default">default</code></td>
<td>
<p>Boolean. (default is TRUE)
If TRUE, the default threshold will be returned.
If FALSE the current used thresholds.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>test_name</code> is missing, all threshold will be returned.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Get all default thresholds
get_thresholds(default = TRUE)

# Get all current thresholds
get_thresholds(default = FALSE)

# Get all current thresholds
get_thresholds(test_name = "oos_mean", default = FALSE)

</code></pre>

<hr>
<h2 id='print.QR_matrix'>Printing QR_matrix and mQR_matrix objects</h2><span id='topic+print.QR_matrix'></span><span id='topic+print.mQR_matrix'></span>

<h3>Description</h3>

<p>To print information on a QR_matrix or mQR_matrix object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'QR_matrix'
print(x, print_variables = TRUE, print_score_formula = TRUE, ...)

## S3 method for class 'mQR_matrix'
print(x, score_statistics = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.QR_matrix_+3A_x">x</code></td>
<td>
<p>a <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> or <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> object.</p>
</td></tr>
<tr><td><code id="print.QR_matrix_+3A_print_variables">print_variables</code></td>
<td>
<p>logical indicating whether to print the indicators'
name (including additionnal variables).</p>
</td></tr>
<tr><td><code id="print.QR_matrix_+3A_print_score_formula">print_score_formula</code></td>
<td>
<p>logical indicating whether to print the formula
with which the score was calculated (when calculated).</p>
</td></tr>
<tr><td><code id="print.QR_matrix_+3A_...">...</code></td>
<td>
<p>other unused arguments.</p>
</td></tr>
<tr><td><code id="print.QR_matrix_+3A_score_statistics">score_statistics</code></td>
<td>
<p>logical indicating whether to print the statistics
in the <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> scores (when calculated).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the <code>print</code> method prints a <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> or
<code><a href="#topic+mQR_matrix">mQR_matrix</a></code> object and returns it invisibly (via
<code>invisible(x)</code>).
</p>


<h3>See Also</h3>

<p><a href="#topic+fr-print.QR_matrix">Traduction française</a>
</p>

<hr>
<h2 id='QR_matrix'>Quality report objects</h2><span id='topic+QR_matrix'></span><span id='topic+mQR_matrix'></span><span id='topic+is.QR_matrix'></span><span id='topic+is.mQR_matrix'></span>

<h3>Description</h3>

<p><code>mQR_matrix()</code> and <code>QR_matrix()</code> are creating one (or several)
quality report. The function
<code>is.QR_matrix()</code> and <code>is.mQR_matrix()</code> are functions to test
whether an object is a quality report or a list of quality reports.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>QR_matrix(modalities = NULL, values = NULL, score_formula = NULL)

mQR_matrix(x = list(), ...)

is.QR_matrix(x)

is.mQR_matrix(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="QR_matrix_+3A_modalities">modalities</code></td>
<td>
<p>a <code>data.frame</code> containing the output variables'
modalities (Good, Bad, etc.)</p>
</td></tr>
<tr><td><code id="QR_matrix_+3A_values">values</code></td>
<td>
<p>a <code>data.frame</code> containing the output variables' values
(test p-values, test statistics, etc.) Therefore, the values data frame can
contain more variables than the data frame <code>modalities</code>.</p>
</td></tr>
<tr><td><code id="QR_matrix_+3A_score_formula">score_formula</code></td>
<td>
<p>the formula used to calculate the series score (if
defined).</p>
</td></tr>
<tr><td><code id="QR_matrix_+3A_x">x</code></td>
<td>
<p>a <code><a href="#topic+QR_matrix">QR_matrix</a></code> object, a <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> object
or a list of <code><a href="#topic+QR_matrix">QR_matrix</a></code> objects.</p>
</td></tr>
<tr><td><code id="QR_matrix_+3A_...">...</code></td>
<td>
<p>objects of the same type as <code>x</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A<code><a href="#topic+QR_matrix">QR_matrix</a></code> object is a list of three items:
</p>

<ul>
<li> <p><code>modalities</code>, a <code>data.frame</code> containing a set of categorical
variables (by default: Good, Uncertain, Bad, Severe).
</p>
</li>
<li> <p><code>values</code>, a <code>data.frame</code> containing the values corresponding to
the <code>modalities</code> indicators (i.e. p-values, statistics, etc.), as well
as variables for which a modality cannot be defined (e.g. the series
frequency, the ARIMA model, etc).
</p>
</li>
<li> <p><code>score_formula</code> contains the formula used to calculate the series
score (once the calculus is done).
</p>
</li></ul>



<h3>Value</h3>

<p><code>QR_matrix()</code> creates and returns a <code><a href="#topic+QR_matrix">QR_matrix</a></code> object.
<code>mQR_matrix()</code> creates and returns a <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> object
(ie. a list of <code><a href="#topic+QR_matrix">QR_matrix</a></code> objects). <code>is.QR_matrix()</code> and
<code>is.mQR_matrix()</code> return Boolean values (<code>TRUE</code> or <code>FALSE</code>).
</p>


<h3>See Also</h3>

<p><a href="#topic+fr-QR_matrix">Traduction française</a>
</p>

<hr>
<h2 id='QR_var_manipulation'>Editing the indicators list</h2><span id='topic+QR_var_manipulation'></span><span id='topic+remove_indicators'></span><span id='topic+retain_indicators'></span>

<h3>Description</h3>

<p>Functions to remove indicators (<code>remove_indicators()</code>) or retrain some
indicators only (<code>retain_indicators()</code>) from <code><a href="#topic+QR_matrix">QR_matrix</a></code> or
<code><a href="#topic+mQR_matrix">mQR_matrix</a></code> objects. The series names (column &quot;series&quot;) cannot
be removed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>remove_indicators(x, ...)

retain_indicators(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="QR_var_manipulation_+3A_x">x</code></td>
<td>
<p>a <code><a href="#topic+QR_matrix">QR_matrix</a></code> or <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> object.</p>
</td></tr>
<tr><td><code id="QR_var_manipulation_+3A_...">...</code></td>
<td>
<p>names of the variable to remove (or keep)</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>remove_indicators()</code> returns the same object <code>x</code> reduced
by the flags and variables used as arguments ... So if the input <code>x</code>
is a QR_matrix, an object of class QR_matrix is returned. If the input
<code>x</code> is a mQR_matrix, an object of class mQR_matrix is returned.
</p>


<h3>See Also</h3>

<p><a href="#topic+fr-remove_indicators">Traduction française</a>
</p>
<p>Other var QR_matrix manipulation: 
<code><a href="#topic+add_indicator">add_indicator</a>()</code>,
<code><a href="#topic+recode_indicator_num">recode_indicator_num</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Path of matrix demetra_m
demetra_path &lt;- file.path(
    system.file("extdata", package = "JDCruncheR"),
    "WS/ws_ipi/Output/SAProcessing-1",
    "demetra_m.csv"
)

# Extract the quality report from the demetra_m file
QR &lt;- extract_QR(demetra_path)

# Compute the score
QR &lt;- compute_score(QR, n_contrib_score = 2)

# Retain indicators
retain_indicators(QR, "score", "m7") # retaining "score" and "m7"
retain_indicators(QR, c("score", "m7")) # Same

# Remove indicators
QR &lt;- remove_indicators(QR, "score") # removing "score"

extract_score(QR) # is NULL because we removed the score indicator

</code></pre>

<hr>
<h2 id='rbind.QR_matrix'>Combining QR_matrix objects</h2><span id='topic+rbind.QR_matrix'></span>

<h3>Description</h3>

<p>Function to combine multiple <code><a href="#topic+QR_matrix">QR_matrix</a></code> objects: line by line,
both for the <code>modalities</code> and the <code>values</code> table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'QR_matrix'
rbind(..., check_formula = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rbind.QR_matrix_+3A_...">...</code></td>
<td>
<p><code><a href="#topic+QR_matrix">QR_matrix</a></code> objects to combine.</p>
</td></tr>
<tr><td><code id="rbind.QR_matrix_+3A_check_formula">check_formula</code></td>
<td>
<p>logical indicating whether to check the score formulas'
coherency.
By default, <code>check_formula = TRUE</code>: an error is returned if the scores
were calculated with different formulas. If <code>check_formula = FALSE</code>, no
check is performed and the <code>score_formula</code> of the output is <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>rbind.QR_matrix()</code> returns a <code><a href="#topic+QR_matrix">QR_matrix</a></code> object.
</p>


<h3>See Also</h3>

<p><a href="#topic+fr-rbind.QR_matrix">Traduction française</a>
</p>
<p>Other QR_matrix functions: 
<code><a href="#topic+export_xlsx">export_xlsx</a>()</code>,
<code><a href="#topic+export_xlsx.QR_matrix">export_xlsx.QR_matrix</a>()</code>,
<code><a href="#topic+export_xlsx.mQR_matrix">export_xlsx.mQR_matrix</a>()</code>,
<code><a href="#topic+extract_QR">extract_QR</a>()</code>,
<code><a href="#topic+sort">sort</a>()</code>,
<code><a href="#topic+weighted_score">weighted_score</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Path of matrix demetra_m
demetra_path &lt;- file.path(
    system.file("extdata", package = "JDCruncheR"),
    "WS/ws_ipi/Output/SAProcessing-1",
    "demetra_m.csv"
)

# Extract the quality report from the demetra_m file
QR &lt;- extract_QR(demetra_path)

# Compute differents scores
QR1 &lt;- compute_score(QR, score_pond = c(m7 = 2, q = 3, qs_residual_sa_on_sa = 5))
QR2 &lt;- compute_score(QR, score_pond = c(m7 = 2, qs_residual_sa_on_sa = 5))

# Merge two quality report
try(rbind(QR1, QR2)) # Une erreur est renvoyée
rbind(QR1, QR2, check_formula = FALSE)

</code></pre>

<hr>
<h2 id='recode_indicator_num'>Converting &quot;values variables&quot; into &quot;modalities variables&quot;</h2><span id='topic+recode_indicator_num'></span>

<h3>Description</h3>

<p>To transform variables from the values matrix into categorical variables
that can be added into the modalities matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>recode_indicator_num(
  x,
  variable_name,
  breaks = c(0, 0.01, 0.05, 0.1, 1),
  labels = c("Good", "Uncertain", "Bad", "Severe"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="recode_indicator_num_+3A_x">x</code></td>
<td>
<p>a <code><a href="#topic+QR_matrix">QR_matrix</a></code> or <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> object.</p>
</td></tr>
<tr><td><code id="recode_indicator_num_+3A_variable_name">variable_name</code></td>
<td>
<p>a vector of strings containing the names of the
variables to convert.</p>
</td></tr>
<tr><td><code id="recode_indicator_num_+3A_breaks">breaks</code></td>
<td>
<p>see function <code><a href="base.html#topic+cut">cut</a></code>.</p>
</td></tr>
<tr><td><code id="recode_indicator_num_+3A_labels">labels</code></td>
<td>
<p>see function <code><a href="base.html#topic+cut">cut</a></code>.</p>
</td></tr>
<tr><td><code id="recode_indicator_num_+3A_...">...</code></td>
<td>
<p>other parameters of the <code><a href="base.html#topic+cut">cut</a></code> function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The function <code>recode_indicator_num()</code> returns the same object,
enhanced with the chosen indicator. So if the input <code>x</code> is a QR_matrix,
an object of class <code>QR_matrix</code> is returned. If the input <code>x</code> is a
mQR_matrix, an object of class <code>mQR_matrix</code> is returned.
</p>


<h3>See Also</h3>

<p><a href="#topic+fr-recode_indicator_num">Traduction française</a>
</p>
<p>Other var QR_matrix manipulation: 
<code><a href="#topic+QR_var_manipulation">QR_var_manipulation</a></code>,
<code><a href="#topic+add_indicator">add_indicator</a>()</code>
</p>

<hr>
<h2 id='set_thresholds'>Set values for thresholds</h2><span id='topic+set_thresholds'></span>

<h3>Description</h3>

<p>Set values for thresholds
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_thresholds(test_name, thresholds)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_thresholds_+3A_test_name">test_name</code></td>
<td>
<p>String. The name of the test to update.</p>
</td></tr>
<tr><td><code id="set_thresholds_+3A_thresholds">thresholds</code></td>
<td>
<p>Named vector of numerics. The upper values of
each break of a threshold.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>test_name</code> is missing, the argument <code>thresholds</code> is not used
and all thresholds will be updated to their default values.
</p>
<p>If <code>test_name</code> is not missing, but if the argument <code>thresholds</code> is
missing then only the thresholds of the test <code>test_name</code> will be updated
to its default values.
</p>
<p>Finally, if <code>test_name</code> and <code>thresholds</code> are not missing, then only
the thresholds of the test <code>test_name</code> are updated with the value
<code>thresholds</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Set "m7"
set_thresholds(
    test_name = "m7",
    thresholds = c(Good = 0.8, Bad = 1.4, Severe = Inf)
)

# Set "oos_mean" to default
set_thresholds(test_name = "oos_mean")

# Set all thresholds to default
set_thresholds()

</code></pre>

<hr>
<h2 id='sort'>QR_matrix and mQR_matrix sorting</h2><span id='topic+sort'></span><span id='topic+sort.QR_matrix'></span><span id='topic+sort.mQR_matrix'></span>

<h3>Description</h3>

<p>To sort the quality reports on one or several variables
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'QR_matrix'
sort(x, decreasing = FALSE, sort_variables = "score", ...)

## S3 method for class 'mQR_matrix'
sort(x, decreasing = FALSE, sort_variables = "score", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sort_+3A_x">x</code></td>
<td>
<p>a <code><a href="#topic+QR_matrix">QR_matrix</a></code> or <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> object</p>
</td></tr>
<tr><td><code id="sort_+3A_decreasing">decreasing</code></td>
<td>
<p>logical indicating whether the quality reports must be
sorted in ascending or decreasing order.
By default, the sorting is done in ascending order.</p>
</td></tr>
<tr><td><code id="sort_+3A_sort_variables">sort_variables</code></td>
<td>
<p>They must be present in the modalities table.</p>
</td></tr>
<tr><td><code id="sort_+3A_...">...</code></td>
<td>
<p>other parameters of the function <code><a href="base.html#topic+order">order</a></code> (unused
for now)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the input with sorted quality reports
</p>


<h3>See Also</h3>

<p><a href="#topic+fr-sort.QR_matrix">Traduction française</a>
</p>
<p>Other QR_matrix functions: 
<code><a href="#topic+export_xlsx">export_xlsx</a>()</code>,
<code><a href="#topic+export_xlsx.QR_matrix">export_xlsx.QR_matrix</a>()</code>,
<code><a href="#topic+export_xlsx.mQR_matrix">export_xlsx.mQR_matrix</a>()</code>,
<code><a href="#topic+extract_QR">extract_QR</a>()</code>,
<code><a href="#topic+rbind.QR_matrix">rbind.QR_matrix</a>()</code>,
<code><a href="#topic+weighted_score">weighted_score</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Path of matrix demetra_m
demetra_path &lt;- file.path(
    system.file("extdata", package = "JDCruncheR"),
    "WS/ws_ipi/Output/SAProcessing-1",
    "demetra_m.csv"
)

# Extract the quality report from the demetra_m file
QR &lt;- extract_QR(demetra_path)

# Compute the score
QR &lt;- compute_score(QR, n_contrib_score = 2)
print(QR[["modalities"]][["score"]])

# Sort the scores

# To sort by ascending scores
QR &lt;- sort(QR, sort_variables = "score")
print(QR[["modalities"]][["score"]])

</code></pre>

<hr>
<h2 id='weighted_score'>Weighted score calculation</h2><span id='topic+weighted_score'></span>

<h3>Description</h3>

<p>Function to weight a pre-calculated score
</p>


<h3>Usage</h3>

<pre><code class='language-R'>weighted_score(x, pond = 1L)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="weighted_score_+3A_x">x</code></td>
<td>
<p>a <code><a href="#topic+QR_matrix">QR_matrix</a></code> or <code><a href="#topic+mQR_matrix">mQR_matrix</a></code> object</p>
</td></tr>
<tr><td><code id="weighted_score_+3A_pond">pond</code></td>
<td>
<p>the weights to use. Can be an integer, a vector of integers, the
name of one of the quality report variables or a list of weights for the
<code><a href="#topic+mQR_matrix">mQR_matrix</a></code> objects.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the input with an additionnal weighted score
</p>


<h3>See Also</h3>

<p><a href="#topic+fr-weighted_score">Traduction française</a>
</p>
<p>Other QR_matrix functions: 
<code><a href="#topic+export_xlsx">export_xlsx</a>()</code>,
<code><a href="#topic+export_xlsx.QR_matrix">export_xlsx.QR_matrix</a>()</code>,
<code><a href="#topic+export_xlsx.mQR_matrix">export_xlsx.mQR_matrix</a>()</code>,
<code><a href="#topic+extract_QR">extract_QR</a>()</code>,
<code><a href="#topic+rbind.QR_matrix">rbind.QR_matrix</a>()</code>,
<code><a href="#topic+sort">sort</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Path of matrix demetra_m
demetra_path &lt;- file.path(
    system.file("extdata", package = "JDCruncheR"),
    "WS/ws_ipi/Output/SAProcessing-1",
    "demetra_m.csv"
)

# Extract the quality report from the demetra_m file
QR &lt;- extract_QR(demetra_path)

# Compute the score
QR &lt;- compute_score(QR, n_contrib_score = 2)

# Weighted score
QR &lt;- weighted_score(QR, 2)
print(QR)

# Extract the weighted score
QR[["modalities"]][["score_pond"]]

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
