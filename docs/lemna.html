<!DOCTYPE html><html lang="en"><head><title>Help for package lemna</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {lemna}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#effect'><p>Effects on biomass</p></a></li>
<li><a href='#focusd1'><p>A Lemna scenario using FOCUS D1 Ditch environmental conditions</p></a></li>
<li><a href='#focusd2'><p>A Lemna scenario using FOCUS D2 Ditch environmental conditions</p></a></li>
<li><a href='#focusr3'><p>A Lemna scenario using FOCUS R3 Stream environmental conditions</p></a></li>
<li><a href='#hommen212'><p>Observed frond numbers reported by Hommen <em>et al.</em> (2015)</p></a></li>
<li><a href='#lemna'><p>Simulate a Lemna scenario</p></a></li>
<li><a href='#lemna_desolve'><p>Access to the ODE solver</p></a></li>
<li><a href='#metsulfuron'><p>A Lemna scenario fitted to metsulfuron-methyl effect data</p></a></li>
<li><a href='#new_lemna_scenario'><p>Lemna scenario constructor</p></a></li>
<li><a href='#param_defaults'><p>Default parameters</p></a></li>
<li><a href='#plot.lemna_result'><p>Plot a Lemna scenario result</p></a></li>
<li><a href='#schmitt77'><p>Observed frond numbers reported by Schmitt <em>et al.</em> (2013)</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Lemna Ecotox Effect Model</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.1</td>
</tr>
<tr>
<td>Description:</td>
<td>The reference implementation of model equations and default
    parameters for the toxicokinetic-toxicodynamic (TKTD) model of the Lemna
    (duckweed) aquatic plant. Lemna is a standard test macrophyte used in ecotox
    effect studies. The model was described and published by the SETAC Europe
    Interest Group Effect Modeling. It is a refined description of the Lemna
    TKTD model published by Schmitt et al. (2013)
    &lt;<a href="https://doi.org/10.1016%2Fj.ecolmodel.2013.01.017">doi:10.1016/j.ecolmodel.2013.01.017</a>&gt;.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/nkehrein/lemna">https://github.com/nkehrein/lemna</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/nkehrein/lemna/issues">https://github.com/nkehrein/lemna/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat (&ge; 3.0.0), dplyr, tidyr, future,
furrr, RColorBrewer, microbenchmark</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Imports:</td>
<td>deSolve, ggplot2, gridExtra</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.60)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-04-22 15:57:20 UTC; Nils</td>
</tr>
<tr>
<td>Author:</td>
<td>Nils Kehrein [aut, cre],
  SETAC Europe IG Effect Modeling [ccp]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Nils Kehrein &lt;nils.kehrein@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-04-22 21:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='effect'>Effects on biomass</h2><span id='topic+effect'></span><span id='topic+effect.default'></span><span id='topic+effect.lemna_scenario'></span>

<h3>Description</h3>

<p>Two endpoints are calculated which describe the effects on biomass:
</p>

<ul>
<li> <p><code>BM</code>, percent effect on biomass at the last time step of the simulation
</p>
</li>
<li> <p><code>r</code>, percent effect on the average growth rate of biomass
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>effect(...)

## Default S3 method:
effect(init, times, param, envir, duration, ...)

## S3 method for class 'lemna_scenario'
effect(x, init, times, param, envir, duration, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="effect_+3A_...">...</code></td>
<td>
<p>additional parameters passed on to <code><a href="#topic+lemna">lemna()</a></code> and <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code></p>
</td></tr>
<tr><td><code id="effect_+3A_init">init</code></td>
<td>
<p>initial state of the model variables</p>
</td></tr>
<tr><td><code id="effect_+3A_times">times</code></td>
<td>
<p>numeric vector, output times for which model results are returned</p>
</td></tr>
<tr><td><code id="effect_+3A_param">param</code></td>
<td>
<p>named list, Lemna model parameters</p>
</td></tr>
<tr><td><code id="effect_+3A_envir">envir</code></td>
<td>
<p>named list, contains time series data for each of the five
environmental variables</p>
</td></tr>
<tr><td><code id="effect_+3A_duration">duration</code></td>
<td>
<p>optional <code>numeric</code>, length of the simulated period to consider
for effect calculation, period starts at the beginning of the simulation</p>
</td></tr>
<tr><td><code id="effect_+3A_x">x</code></td>
<td>
<p>a <code>lemna_scenario</code> object</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>numeric</code>, effect on biomass in percent (%) [0,100]
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>effect(default)</code>: All scenario parameters supplied as arguments
</p>
</li>
<li> <p><code>effect(lemna_scenario)</code>: Scenario parameters supplied as a <code>lemna_scenario</code> object
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'># effects in sample scenario
effect(metsulfuron)

# effects with modified environmental data
myenvir &lt;- metsulfuron$envir
myenvir$tmp &lt;- 20   # increase to 20°C
myenvir$conc &lt;- 0.3  # constant exposure of 0.3 ug/L
effect(metsulfuron, envir=myenvir)

# calculate effects for the first seven days
effect(metsulfuron, duration=7)
</code></pre>

<hr>
<h2 id='focusd1'>A Lemna scenario using FOCUS D1 Ditch environmental conditions</h2><span id='topic+focusd1'></span>

<h3>Description</h3>

<p>The dataset consists of a named <code>list</code> which contains vectors describing
initial state, parameters, output times, and environmental variables of the
Lemna model. The scenario represents conditions of the FOCUS D1 Ditch
exposure scenario.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>focusd1
</code></pre>


<h3>Format</h3>

<p>An object of class <code>lemna_scenario</code> of length 4.
</p>


<h3>Details</h3>

<p>The scenario will simulate a period of 365 days with hourly outputs, a start
population of 80 g/m² dry weight, variable environmental conditions, and a
complex, time-varying exposure pattern.
</p>
<p>The scenario setup was published by Hommen <em>et al</em>. (2015). Exposure pattern
and substance specific parameters are of exemplary character
and represent the herbicide <em>metsulfuron-methyl</em>.
</p>


<h3>References</h3>

<p>Hommen U., Schmitt W., Heine S., Brock Theo C.M., Duquesne S., Manson P., Meregalli G.,
Ochoa-Acuña H., van Vliet P., Arts G., 2015: How TK-TD and Population Models for
Aquatic Macrophytes Could Support the Risk Assessment for Plant Protection
Products. Integr Environ Assess Manag 12(1), pp. 82-95. <a href="https://doi.org/10.1002/ieam.1715">doi:10.1002/ieam.1715</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate the example scenario
lemna(focusd1)
</code></pre>

<hr>
<h2 id='focusd2'>A Lemna scenario using FOCUS D2 Ditch environmental conditions</h2><span id='topic+focusd2'></span>

<h3>Description</h3>

<p>The dataset consists of a named <code>list</code> which contains vectors describing
initial state, parameters, output times, and environmental variables of the
Lemna model. The scenario represents conditions of the FOCUS D2 Ditch
exposure scenario.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>focusd2
</code></pre>


<h3>Format</h3>

<p>An object of class <code>lemna_scenario</code> of length 4.
</p>


<h3>Details</h3>

<p>The scenario will simulate a period of 365 days with hourly outputs, a start
population of 100 g/m² dry weight, variable environmental conditions, and a
complex, time-varying exposure pattern.
</p>
<p>The scenario setup was published by Hommen <em>et al</em>. (2015). Exposure pattern
and substance specific parameters are of exemplary character
and represent the herbicide <em>metsulfuron-methyl</em>.
</p>


<h3>References</h3>

<p>Hommen U., Schmitt W., Heine S., Brock Theo C.M., Duquesne S., Manson P., Meregalli G.,
Ochoa-Acuña H., van Vliet P., Arts G., 2015: How TK-TD and Population Models for
Aquatic Macrophytes Could Support the Risk Assessment for Plant Protection
Products. Integr Environ Assess Manag 12(1), pp. 82-95. <a href="https://doi.org/10.1002/ieam.1715">doi:10.1002/ieam.1715</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate the example scenario
lemna(focusd2)
</code></pre>

<hr>
<h2 id='focusr3'>A Lemna scenario using FOCUS R3 Stream environmental conditions</h2><span id='topic+focusr3'></span>

<h3>Description</h3>

<p>The dataset consists of a named <code>list</code> which contains vectors describing
initial state, parameters, output times, and environmental variables of the
Lemna model. The scenario represents conditions of the FOCUS R3 Stream
exposure scenario.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>focusr3
</code></pre>


<h3>Format</h3>

<p>An object of class <code>lemna_scenario</code> of length 4.
</p>


<h3>Details</h3>

<p>The scenario will simulate a period of 365 days with hourly outputs, a start
population of 100 g/m² dry weight, variable environmental conditions, and a
complex, time-varying exposure pattern.
</p>
<p>The scenario setup was published by Hommen <em>et al</em>. (2015). Exposure pattern
and substance specific parameters are of exemplary character
and represent the herbicide <em>metsulfuron-methyl</em>.
</p>


<h3>References</h3>

<p>Hommen U., Schmitt W., Heine S., Brock Theo C.M., Duquesne S., Manson P., Meregalli G.,
Ochoa-Acuña H., van Vliet P., Arts G., 2015: How TK-TD and Population Models for
Aquatic Macrophytes Could Support the Risk Assessment for Plant Protection
Products. Integr Environ Assess Manag 12(1), pp. 82-95. <a href="https://doi.org/10.1002/ieam.1715">doi:10.1002/ieam.1715</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate the example scenario
lemna(focusr3)
</code></pre>

<hr>
<h2 id='hommen212'>Observed frond numbers reported by Hommen <em>et al.</em> (2015)</h2><span id='topic+hommen212'></span>

<h3>Description</h3>

<p>The data consists of observed frond numbers from experimental studies for
various time points and exposure concentrations. The <em>Lemna</em> population
was exposed to constant concentrations of <em>metsulfuron-methyl</em> for two days,
followed by twelve days of recovery.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hommen212
</code></pre>


<h3>Format</h3>

<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 25 rows and 3 columns.
</p>


<h3>Details</h3>

<p>The dataset was presented in Hommen <em>et al.</em> (2015)],
cf. Figure 3, and was included in this package by courtesy of the authors.
</p>


<h3>References</h3>

<p>Hommen U., Schmitt W., Heine S., Brock Theo C.M., Duquesne S., Manson P., Meregalli G.,
Ochoa-Acuña H., van Vliet P., Arts G., 2015: How TK-TD and Population Models for
Aquatic Macrophytes Could Support the Risk Assessment for Plant Protection
Products. Integr Environ Assess Manag 12(1), pp. 82-95. <a href="https://doi.org/10.1002/ieam.1715">doi:10.1002/ieam.1715</a>
</p>

<hr>
<h2 id='lemna'>Simulate a Lemna scenario</h2><span id='topic+lemna'></span><span id='topic+lemna.default'></span><span id='topic+lemna.lemna_scenario'></span>

<h3>Description</h3>

<p>The function numerically integrates the Lemna model using the supplied
parameters, environmental factor time series, output time points, and other
settings. Numerical integration is handled by <code><a href="deSolve.html#topic+lsoda">deSolve::lsoda()</a></code> by default
which is well suited to handle stiff and non-stiff numerical problems.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lemna(...)

## Default S3 method:
lemna(
  init = c(BM = 0, M_int = 0),
  times,
  param,
  envir,
  ode_mode = c("r", "c"),
  nout = 2,
  ...
)

## S3 method for class 'lemna_scenario'
lemna(x, init, times, param, envir, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lemna_+3A_...">...</code></td>
<td>
<p>additional parameters passed on to <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code></p>
</td></tr>
<tr><td><code id="lemna_+3A_init">init</code></td>
<td>
<p>initial state of the model variables</p>
</td></tr>
<tr><td><code id="lemna_+3A_times">times</code></td>
<td>
<p>numeric vector, output times for which model results are returned</p>
</td></tr>
<tr><td><code id="lemna_+3A_param">param</code></td>
<td>
<p>named list, Lemna model parameters</p>
</td></tr>
<tr><td><code id="lemna_+3A_envir">envir</code></td>
<td>
<p>named list, contains time series data for each of the five
environmental variables</p>
</td></tr>
<tr><td><code id="lemna_+3A_ode_mode">ode_mode</code></td>
<td>
<p>character, switch controls if ODE functions implemented in R or
C are used, defaults to R</p>
</td></tr>
<tr><td><code id="lemna_+3A_nout">nout</code></td>
<td>
<p>numeric, controls the number of additional output variables of the
model, such as <code>C_int</code> (internal concentration) or <code>FrondNo</code> (the number
of fronds), see e.g. <code><a href="deSolve.html#topic+lsoda">deSolve::lsoda()</a></code> for details. Defaults to <code>2</code></p>
</td></tr>
<tr><td><code id="lemna_+3A_x">x</code></td>
<td>
<p>a <code>lemna_scenario</code> object</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>data.frame</code> with simulation results
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>lemna(default)</code>: All scenario parameters supplied as arguments
</p>
</li>
<li> <p><code>lemna(lemna_scenario)</code>: Scenario parameters supplied as a <code>lemna_scenario</code> object
</p>
</li></ul>


<h3>State variables</h3>

<p>The model has two state variables:
</p>

<ul>
<li> <p><code>BM</code>, Biomass  (g dw m-2)
</p>
</li>
<li> <p><code>M_int</code>, Mass of toxicant in plant population  (mass per m2, e.g. ug m-2)
</p>
</li></ul>



<h3>Output times</h3>

<p>The function will only return results for the requested time points. The solver
may make additional time steps which are not returned, depending on the
solver settings such as numerical tolerance. The number of output times and
the distance between them can have influence on the numerical precision of
results. Please refer to the manual of the <a href="deSolve.html#topic+deSolve">deSolve</a> package for more
information on that topic.
</p>


<h3>Parameters</h3>

<p>The list of available model parameters, their units, and suggested default
values is documented in <code><a href="#topic+param_defaults">param_defaults()</a></code>.
</p>


<h3>Environmental variables</h3>

<p>The model requires a time series for each of the five environmental variables
For ease of use, a time series can be represented by either a constant
numeric value, a <code>data.frame</code> containing a time series, a character
string with a path to a CSV file containing a time series, or a function
returning a value for a certain time point.
</p>
<p>The five environmental variables are as follows:
</p>

<ul>
<li> <p><code>conc</code>, Exposure concentration (mass per volume, e.g ug L-1)
</p>
</li>
<li> <p><code>tmp</code>, Temperature (deg C)
</p>
</li>
<li> <p><code>irr</code>, Irradiance (kJ m-2 d-1)
</p>
</li>
<li> <p><code>P</code>, Phosphorus concentration  (mg P L-1)
</p>
</li>
<li> <p><code>N</code>, Nitrogen concentration  (mg N L-1)
</p>
</li></ul>

<p>A <code>data.frame</code> containing a time series must consist of exactly two columns:
The first column contains the time in days, the second column the environmental
factor in question. The <code>data.frame</code> must contain at least one row. Time
points are not required to coincide with the solver's output times but
the user should take care that the solver's time step length is sufficiently
small so that it can consider the relevant dynamics of the time series.
This problem can be avoided by calling the model ODEs implemented in C, see
argument <code>ode_mode</code>.
</p>
<p>If a string is passed as an environmental factor, the function will interpret
the string as a file path and will try to load the contents of a CSV file.
The same requirements as for a <code>data.frame</code> apply to a time series loaded
from a file.
</p>
<p>When using the pure R code ODE, it is also possible to pass a function as
an environmental factor. The function must accept exactly one argument which
represents time and must return a single scalar value. Using a function
in combination with the compiled code solver will raise an error.
</p>


<h3>R vs. compiled code</h3>

<p>The model can be simulated using pure <em>R</em> code (the default) or an implementation
that uses the compiled code feature of <a href="deSolve.html#topic+deSolve">deSolve</a>. Compiled code is almost
always significantly faster than pure <em>R</em>. The solver for compiled ODEs also
handles environmental variables better than the pure <em>R</em> version. For optimal
performance, the time series of environmental variables should always be as
short as possible and as long as needed.
</p>
<p>To use the compiled code feature, set the argument <code>ode_mode = "c"</code>.
</p>


<h3>Simulation output</h3>

<p>For reasons of convenience, the return value contains by default two additional
variables derived from simulation results: the internal concentration <code>C_int</code>
as well as the number of fronds <code>FrondNo</code>. These can be disabled by setting
the argument <code>nout = 0</code>.
</p>
<p>The compiled code model can return up to 18 additional variables which
represent intermediary variables, environmental variables, and derivatives
calculated within the model equations. Please refer to the model description
of <em>Klein et al.</em> for more information on these variables and how they
influence model behavior.
</p>
<p>The available output levels are as follows:
</p>

<ul>
<li> <p><code>nout &gt;= 1</code>
</p>

<ul>
<li> <p><code>C_int</code>, internal concentration (mass per volume)
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 2</code>
</p>

<ul>
<li> <p><code>FrondNo</code>, frond number (-)
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 4</code>
</p>

<ul>
<li> <p><code>f_loss</code>, respiration dependency function (-)
</p>
</li>
<li> <p><code>f_photo</code>, photosynthesis dependency function (-)
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 10</code>
</p>

<ul>
<li> <p><code>fT_photo</code>, temperature response of photosynthesis (-)
</p>
</li>
<li> <p><code>fI_photo</code>, irradiance response of photosynthesis (-)
</p>
</li>
<li> <p><code>fP_photo</code>, phosphorus response of photosynthesis (-)
</p>
</li>
<li> <p><code>fN_photo</code>, nitrogen response of photosynthesis (-)
</p>
</li>
<li> <p><code>fBM_photo</code>, density response of photosynthesis (-)
</p>
</li>
<li> <p><code>fCint_photo</code>, concentration response of photosynthesis (-)
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 16</code>
</p>

<ul>
<li> <p><code>C_int_unb</code>, unbound internal concentration (mass per volume)
</p>
</li>
<li> <p><code>C_ext</code>, external concentration (mass per volume)
</p>
</li>
<li> <p><code>Tmp</code>, temperature (deg C)
</p>
</li>
<li> <p><code>Irr</code>, irradiance (kJ m-2 d-1)
</p>
</li>
<li> <p><code>Phs</code>, Phosphorus concentration (mg P L-1)
</p>
</li>
<li> <p><code>Ntr</code>, Nitrogen concentration (mg N L-1)
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 18</code>
</p>

<ul>
<li> <p><code>dBM</code>, biomass derivative (g dw m-2 d-1)
</p>
</li>
<li> <p><code>dM_int</code>, mass of toxicant in plants derivative (mass per m2 d-1)
</p>
</li></ul>

</li></ul>



<h3>References</h3>

<p>Klein J., Cedergreen N., Heine S., Kehrein N., Reichenberger S., Rendal C.,
Schmitt W., Hommen U., 2022: Refined description of the <em>Lemna</em> TKTD growth model
based on <em>Schmitt et al.</em> (2013) – equation system and default parameters,
implementation in R.
Report of the working group <em>Lemna</em> of the SETAC Europe Interest Group Effect
Modeling. Version 1.1, uploaded on 09 May 2022.
<a href="https://www.setac.org/group/SEIGEffectModeling">https://www.setac.org/group/SEIGEffectModeling</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate the metsulfuron example scenario
lemna(metsulfuron)

# Create a simple plot of the number of fronds
lemna(metsulfuron) -&gt; result
plot(result$time, result$FrondNo)

# Create a nicer plot using a dedicated plotting routine
plot(result)

# Simulate the example scenario for a period of 30 days
lemna(metsulfuron, times=0:30) -&gt; result30
plot(result30)

##
## Create a custom Lemna scenario from scratch
##

# Initial state: 12 fronds, no toxicant mass
myinit &lt;- c(BM=0.0012, M_int=0)

# Output times: simulate 7 days with a ~2 hour time step
mytime &lt;- seq(0, 7, 0.1)

# Default model parameters + TKTD parameters of a hypothetical substance
myparam &lt;- param_defaults(list(
  EC50_int = 0.1, # 50% effect level (ug L-1)
  b = 0.7,        # slope parameter (-)
  P = 0.01        # permeability (cm d-1)
))

# Custom environmental variables
myenvir &lt;- list(
  # exposure step function:
  # 3 days no exposure, followed by 4 days of 10 ug L-1
  conc = data.frame(t=c(0,3,4,7), conc=c(0,0,10,10)),
  tmp = 18,    # constant temperature of 18 °C
  irr = 15000, # constant irradiance of 15,000 kJ m-2 d-1
  N = 0.6,     # constant Nitrogen concentration of 0.6 mg L-1
  P = 0.3      # constant Phosphorus concentration of 0.3 mg L-1
)

# Simulate the custom scenario and plot results
lemna(init=myinit, times=mytime, param=myparam, envir=myenvir) -&gt; result_custom
plot(result_custom)

# Simulate again, forcing the solver to use smaller time steps of hmax=0.001.
# The resulting curves are almost identical for this example.
lemna(init=myinit, times=mytime, param=myparam, envir=myenvir, hmax=0.001) -&gt; result_custom2
library(ggplot2)
ggplot(result_custom, aes(time, FrondNo)) +
  geom_line() +
  geom_line(data=result_custom2, color="red", style="dashed")

# Combine all settings into a scenario object and simulate it
scenario &lt;- new_lemna_scenario(
 init = myinit,
 param = myparam,
 times = mytime,
 envir = myenvir
)
lemna(scenario)
</code></pre>

<hr>
<h2 id='lemna_desolve'>Access to the ODE solver</h2><span id='topic+lemna_desolve'></span>

<h3>Description</h3>

<p>This function can be used by external packages to access the ODE implemented
in C without the surrounding sanity checks and data loading procedures.
All parameters will be passed on to the solver.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lemna_desolve(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lemna_desolve_+3A_...">...</code></td>
<td>
<p>parameters passed on to <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>result from <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code>
</p>

<hr>
<h2 id='metsulfuron'>A Lemna scenario fitted to metsulfuron-methyl effect data</h2><span id='topic+metsulfuron'></span>

<h3>Description</h3>

<p>The dataset consists of a named <code>list</code> which contains vectors describing
initial state, parameters, output times, and environmental variables of the
<em>Lemna</em> model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>metsulfuron
</code></pre>


<h3>Format</h3>

<p>An object of class <code>lemna_scenario</code> of length 4.
</p>


<h3>Details</h3>

<p>The scenario will simulate a period of 14 days with daily outputs, a start
population of 12 fronds, unlimited growth conditions, and an exposure pattern
represented by a step-function.
</p>
<p>The scenario setup was published by Schmitt <em>et al.</em> (2013).
A mechanistic combined toxicokinetic-toxicodynamic (TK/TD) and growth
model for the aquatic macrophytes <em>Lemna spp.</em> was parameterized by the authors
based on literature data. TK/TD parameters were determined by calibrating the
model using substance specific effect data of metsulfuron-methyl.
</p>


<h3>References</h3>

<p>Schmitt W., Bruns E., Dollinger M., Sowig P., 2013: Mechanistic TK/TD-model
simulating the effect of growth inhibitors on <em>Lemna</em> populations. Ecol Model
255, pp. 1-10. <a href="https://doi.org/10.1016/j.ecolmodel.2013.01.017">doi:10.1016/j.ecolmodel.2013.01.017</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate the example scenario
lemna(metsulfuron)

# Simulate a longer time period of 21 days
lemna(metsulfuron, times=0:21)

# Print the scenario's exposure series
metsulfuron$envir$conc

# Print all environmental variables
metsulfuron$envir
</code></pre>

<hr>
<h2 id='new_lemna_scenario'>Lemna scenario constructor</h2><span id='topic+new_lemna_scenario'></span>

<h3>Description</h3>

<p>Lemna scenario constructor
</p>


<h3>Usage</h3>

<pre><code class='language-R'>new_lemna_scenario(
  init = c(BM = 0, M_int = 0),
  times = c(),
  param = list(),
  envir = list()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="new_lemna_scenario_+3A_init">init</code></td>
<td>
<p>initial state of the model variables</p>
</td></tr>
<tr><td><code id="new_lemna_scenario_+3A_times">times</code></td>
<td>
<p>numeric vector, output times for which model results are returned</p>
</td></tr>
<tr><td><code id="new_lemna_scenario_+3A_param">param</code></td>
<td>
<p>named list, Lemna model parameters</p>
</td></tr>
<tr><td><code id="new_lemna_scenario_+3A_envir">envir</code></td>
<td>
<p>named list, contains time series data for each of the five
environmental variables</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>lemna_scenario</code> object
</p>

<hr>
<h2 id='param_defaults'>Default parameters</h2><span id='topic+param_defaults'></span><span id='topic+param_new'></span>

<h3>Description</h3>

<p>Returns the default Lemna model parameters as reported by Klein <em>et al.</em> (2022).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>param_defaults(values)

param_new(values)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="param_defaults_+3A_values">values</code></td>
<td>
<p>optional named numeric <code>vector</code>, values will override any
defaults</p>
</td></tr>
</table>


<h3>Details</h3>



<h4>Model parameters</h4>



<h5>Growth model</h5>


<ul>
<li> <p><code>k_photo_fixed</code>, Model switch for unlimited growth conditions (TRUE/FALSE)
</p>
</li>
<li> <p><code>k_photo_max</code>, Maximum photosynthesis rate (d-1)
</p>
</li>
<li> <p><code>k_loss</code>, Reference loss rate (d-1)
</p>
</li>
<li> <p><code>BM_min</code>, Threshold density for setting dBM/dt to zero (g dw m-2)
</p>
</li></ul>




<h5>Temperature response of photosynthesis</h5>


<ul>
<li> <p><code>T_opt</code>, Optimum growth temperature (deg C)
</p>
</li>
<li> <p><code>T_min</code>, Minimum growth temperature (deg C)
</p>
</li>
<li> <p><code>T_max</code>, Maximum growth temperature (deg C)
</p>
</li></ul>




<h5>Temperature response of biomass loss rate</h5>


<ul>
<li> <p><code>Q10</code>, Temperature coefficient (-)
</p>
</li>
<li> <p><code>T_ref</code>, Reference temperature for response=1 (°C)
</p>
</li></ul>




<h5>Irradiance reponse of photosynthesis</h5>


<ul>
<li> <p><code>alpha</code>, Slope of irradiance response (m2 d kJ-1)
</p>
</li>
<li> <p><code>beta</code>, Intercept of irradiance response (-)
</p>
</li></ul>




<h5>Nutrient response of photosynthesis</h5>


<ul>
<li> <p><code>N_50</code>, Half-saturation constant of Nitrogen (mg N L-1)
</p>
</li>
<li> <p><code>P_50</code>, Half-saturation constant of Phosphorus (mg P L-1)
</p>
</li></ul>




<h5>Density dependence of photosynthesis</h5>


<ul>
<li> <p><code>BM_L</code>, Carrying capacity (g dw m-2)
</p>
</li></ul>




<h5>Concentration response (Toxicodynamics)</h5>


<ul>
<li> <p><code>EC50_int</code>, Internal concentration resulting in 50% effect (mass per volume)
</p>
</li>
<li> <p><code>E_max</code>, Maximum inhibition (-)
</p>
</li>
<li> <p><code>b</code>, Slope parameter (-)
</p>
</li></ul>




<h5>Internal concentration (Toxicokinetics)</h5>


<ul>
<li> <p><code>P</code>, Permeability (cm d-1)
</p>
</li>
<li> <p><code>r_A_DW</code>, Area per dry-weight ratio (cm2 g-1)
</p>
</li>
<li> <p><code>r_FW_DW</code>, Fresh weight per dry weight ratio (-)
</p>
</li>
<li> <p><code>r_FW_V</code>, Fresh weight density (g cm-3)
</p>
</li>
<li> <p><code>r_DW_FN</code> Dry weight per frond ratio (g dw)
</p>
</li>
<li> <p><code>K_pw</code>, Partitioning coefficient plant:water (-)
</p>
</li>
<li> <p><code>k_met</code>, Metabolisation rate (d-1)
</p>
</li></ul>





<h3>Value</h3>

<p>named <code>list</code>
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>param_new()</code>: A parameter set without default values
</p>
</li></ul>


<h3>References</h3>

<p>Klein J., Cedergreen N., Heine S., Kehrein N., Reichenberger S., Rendal C.,
Schmitt W., Hommen U., 2022: Refined description of the <em>Lemna</em> TKTD growth model
based on <em>Schmitt et al.</em> (2013) – equation system and default parameters,
implementation in R.
Report of the working group <em>Lemna</em> of the SETAC Europe Interest Group Effect
Modeling. Version 1.1, uploaded on 09 May 2022.
<a href="https://www.setac.org/group/SEIGEffectModeling">https://www.setac.org/group/SEIGEffectModeling</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Returns default model parameters, some parameters are not defined (NA)
param_defaults()

# Overwrite one of the default parameters
param_defaults(list(k_photo_max = 0.42))

# Provide values for substance specific TKTD parameters
param_defaults(list(
  EC50_int = 23, # 50% effect level (mass per volume)
  b = 1,         # slope parameter (-)
  P = 0.42       # permeability (cm d-1)
))

# Returns a list of required model parameters with all values set to NA
param_new()
</code></pre>

<hr>
<h2 id='plot.lemna_result'>Plot a Lemna scenario result</h2><span id='topic+plot.lemna_result'></span>

<h3>Description</h3>

<p>Creates up to four plots in a gridded layout depicting
</p>

<ol>
<li><p> Exposure (i.e. external) concentration, as well as damage (internal concentration, <code>C_int</code>)
if available
</p>
</li>
<li><p> Internal toxicant mass (<code>M_int</code>)
</p>
</li>
<li><p> Population size as biomass (<code>BM</code>)
</p>
</li>
<li><p> Population size as number of fronds (<code>FrondNo</code>) if available
</p>
</li></ol>



<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'lemna_result'
plot(x, y, munit = "ug/m2", cunit = "ug/L", legend = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.lemna_result_+3A_x">x</code></td>
<td>
<p><code>lemna_result</code> object</p>
</td></tr>
<tr><td><code id="plot.lemna_result_+3A_y">y</code></td>
<td>
<p>unused parameter</p>
</td></tr>
<tr><td><code id="plot.lemna_result_+3A_munit">munit</code></td>
<td>
<p>character, unit of internal mass, defaults to <code>ug/m2</code></p>
</td></tr>
<tr><td><code id="plot.lemna_result_+3A_cunit">cunit</code></td>
<td>
<p>character, unit of exposure, defaults to <code>ug/L</code></p>
</td></tr>
<tr><td><code id="plot.lemna_result_+3A_legend">legend</code></td>
<td>
<p>logical, if <code>TRUE</code> then a legend is displayed, set to <code>FALSE</code>
to hide legend, defaults to <code>TRUE</code></p>
</td></tr>
<tr><td><code id="plot.lemna_result_+3A_...">...</code></td>
<td>
<p>unused parameter</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a gridded plot
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate a sample scenario and plot results
result &lt;- lemna(metsulfuron)
plot(result)

# Hide the legend of the concentration plot
plot(result, legend=FALSE)

# Simulate and plot a scenario with changing environmental conditions
plot(lemna(focusd1))
</code></pre>

<hr>
<h2 id='schmitt77'>Observed frond numbers reported by Schmitt <em>et al.</em> (2013)</h2><span id='topic+schmitt77'></span>

<h3>Description</h3>

<p>The data consists of observed frond numbers from experimental studies for
various time points and exposure concentrations. The <em>Lemna</em> population
was exposed to constant concentrations of <em>metsulfuron-methyl</em> for seven days,
followed by seven days of recovery.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>schmitt77
</code></pre>


<h3>Format</h3>

<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 49 rows and 3 columns.
</p>


<h3>Details</h3>

<p>The dataset was presented in Schmitt <em>et al.</em> (2013),
cf. Figure 2, and was included in this package by courtesy of the authors.
</p>


<h3>References</h3>

<p>Schmitt W., Bruns E., Dollinger M., Sowig P., 2013: Mechanistic TK/TD-model
simulating the effect of growth inhibitors on <em>Lemna</em> populations. Ecol Model
255, pp. 1-10. <a href="https://doi.org/10.1016/j.ecolmodel.2013.01.017">doi:10.1016/j.ecolmodel.2013.01.017</a>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
