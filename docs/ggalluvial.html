<!DOCTYPE html><html><head><title>Help for package ggalluvial</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ggalluvial}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#alluvial-data'><p>Check for alluvial structure and convert between alluvial formats</p></a></li>
<li><a href='#geom_alluvium'><p>Alluvia across strata</p></a></li>
<li><a href='#geom_flow'><p>Flows between lodes or strata</p></a></li>
<li><a href='#geom_lode'><p>Lodes at intersections of alluvia and strata</p></a></li>
<li><a href='#geom_stratum'><p>Strata at axes</p></a></li>
<li><a href='#GeomAlluvium'><p>Base ggproto classes for ggalluvial</p></a></li>
<li><a href='#ggalluvial-deprecated'><p>Deprecated functions</p></a></li>
<li><a href='#ggalluvial-package'><p>ggalluvial: Alluvial Plots in 'ggplot2'</p></a></li>
<li><a href='#lode-guidance-functions'><p>Lode guidance functions</p></a></li>
<li><a href='#majors'><p>Students' declared majors across several semesters</p></a></li>
<li><a href='#self-adjoin'><p>Adjoin a dataset to itself</p></a></li>
<li><a href='#stat_alluvium'><p>Alluvial positions</p></a></li>
<li><a href='#stat_flow'><p>Flow positions</p></a></li>
<li><a href='#stat_stratum'><p>Stratum positions</p></a></li>
<li><a href='#vaccinations'><p>Influenza vaccination survey responses</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Alluvial Plots in 'ggplot2'</td>
</tr>
<tr>
<td>Version:</td>
<td>0.12.5</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jason Cory Brunson &lt;cornelioid@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Alluvial plots use variable-width ribbons and stacked bar plots to
    represent multi-dimensional or repeated-measures data with categorical or
    ordinal variables; see Riehmann, Hanfler, and Froehlich (2005)
    &lt;<a href="https://doi.org/10.1109%2FINFVIS.2005.1532152">doi:10.1109/INFVIS.2005.1532152</a>&gt; and Rosvall and Bergstrom (2010)
    &lt;<a href="https://doi.org/10.1371%2Fjournal.pone.0008694">doi:10.1371/journal.pone.0008694</a>&gt;.
    Alluvial plots are statistical graphics in the sense of Wilkinson (2006)
    &lt;<a href="https://doi.org/10.1007%2F0-387-28695-0">doi:10.1007/0-387-28695-0</a>&gt;; they share elements with Sankey diagrams and
    parallel sets plots but are uniquely determined from the data and a small
    set of parameters. This package extends Wickham's (2010)
    &lt;<a href="https://doi.org/10.1198%2Fjcgs.2009.07098">doi:10.1198/jcgs.2009.07098</a>&gt; layered grammar of graphics to generate
    alluvial plots from tidy data.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6), ggplot2 (&ge; 2.2)</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats, dplyr (&ge; 0.7), tidyr (&ge; 0.7), lazyeval, rlang,
tidyselect</td>
</tr>
<tr>
<td>Suggests:</td>
<td>grid, alluvial, testthat, knitr, rmarkdown, babynames,
sessioninfo, ggrepel, shiny (&ge; 1.4.0.2), htmltools, sp (&ge;
1.4-0), ggfittext (&ge; 0.6), vdiffr (&ge; 0.2)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="http://corybrunson.github.io/ggalluvial/">http://corybrunson.github.io/ggalluvial/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/corybrunson/ggalluvial/issues">https://github.com/corybrunson/ggalluvial/issues</a></td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-02-13 15:44:19 UTC; jason.brunson</td>
</tr>
<tr>
<td>Author:</td>
<td>Jason Cory Brunson [aut, cre],
  Quentin D. Read [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-02-22 09:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='alluvial-data'>Check for alluvial structure and convert between alluvial formats</h2><span id='topic+alluvial-data'></span><span id='topic+is_lodes_form'></span><span id='topic+is_alluvia_form'></span><span id='topic+to_lodes_form'></span><span id='topic+to_alluvia_form'></span>

<h3>Description</h3>

<p>Alluvial plots consist of multiple horizontally-distributed columns (axes)
representing factor variables, vertical divisions (strata) of these axes
representing these variables' values; and splines (alluvial flows) connecting
vertical subdivisions (lodes) within strata of adjacent axes representing
subsets or amounts of observations that take the corresponding values of the
corresponding variables. This function checks a data frame for either of two
types of alluvial structure:
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_lodes_form(
  data,
  key,
  value,
  id,
  weight = NULL,
  site = NULL,
  logical = TRUE,
  silent = FALSE
)

is_alluvia_form(
  data,
  ...,
  axes = NULL,
  weight = NULL,
  logical = TRUE,
  silent = FALSE
)

to_lodes_form(
  data,
  ...,
  axes = NULL,
  key = "x",
  value = "stratum",
  id = "alluvium",
  diffuse = FALSE,
  discern = FALSE
)

to_alluvia_form(data, key, value, id, distill = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="alluvial-data_+3A_data">data</code></td>
<td>
<p>A data frame.</p>
</td></tr>
<tr><td><code id="alluvial-data_+3A_key">key</code>, <code id="alluvial-data_+3A_value">value</code>, <code id="alluvial-data_+3A_id">id</code></td>
<td>
<p>In <code>to_lodes_form</code>, handled as in
<code><a href="tidyr.html#topic+gather">tidyr::gather()</a></code> and used to name the new axis (key), stratum
(value), and alluvium (identifying) variables. In <code>to_alluvia_form</code>,
handled as in <code><a href="tidyr.html#topic+spread">tidyr::spread()</a></code> and used to identify the fields
of <code>data</code> to be used as the axis (key), stratum (value), and alluvium
(identifying) variables.</p>
</td></tr>
<tr><td><code id="alluvial-data_+3A_weight">weight</code></td>
<td>
<p>Optional field of <code>data</code>, handled using
<code><a href="rlang.html#topic+topic-defuse">rlang::enquo()</a></code>, to be used as heights or depths of
the alluvia or lodes.</p>
</td></tr>
<tr><td><code id="alluvial-data_+3A_site">site</code></td>
<td>
<p>Optional vector of fields of <code>data</code>, handled using
<code><a href="rlang.html#topic+topic-defuse">rlang::enquos()</a></code>, to be used to group rows before
testing for duplicate and missing id-axis pairings. Variables intended for
faceting should be passed to <code>site</code>.</p>
</td></tr>
<tr><td><code id="alluvial-data_+3A_logical">logical</code></td>
<td>
<p>Defunct. Whether to return a logical value or a character
string indicating the type of alluvial structure (&quot;none&quot;, &quot;lodes&quot;, or
&quot;alluvia&quot;).</p>
</td></tr>
<tr><td><code id="alluvial-data_+3A_silent">silent</code></td>
<td>
<p>Whether to print messages.</p>
</td></tr>
<tr><td><code id="alluvial-data_+3A_...">...</code></td>
<td>
<p>Used in <code>is_alluvia_form</code> and <code>to_lodes_form</code> as in
<code><a href="dplyr.html#topic+select">dplyr::select()</a></code> to determine axis variables, as an alternative
to <code>axes</code>. Ignored when <code>axes</code> is provided.</p>
</td></tr>
<tr><td><code id="alluvial-data_+3A_axes">axes</code></td>
<td>
<p>In <code style="white-space: pre;">&#8288;*_alluvia_form&#8288;</code>, handled as in
<code><a href="dplyr.html#topic+select">dplyr::select()</a></code> and used to identify the field(s) of
<code>data</code> to be used as axes.</p>
</td></tr>
<tr><td><code id="alluvial-data_+3A_diffuse">diffuse</code></td>
<td>
<p>Fields of <code>data</code>, handled using
<code><a href="tidyselect.html#topic+vars_select">tidyselect::vars_select()</a></code>, to merge into the reshapen data by
<code>id</code>. They must be a subset of the axis variables. Alternatively, a
logical value indicating whether to merge all (<code>TRUE</code>) or none
(<code>FALSE</code>) of the axis variables.</p>
</td></tr>
<tr><td><code id="alluvial-data_+3A_discern">discern</code></td>
<td>
<p>Logical value indicating whether to suffix values of the
variables used as axes that appear at more than one variable in order to
distinguish their factor levels. This forces the levels of the combined
factor variable <code>value</code> to be in the order of the axes.</p>
</td></tr>
<tr><td><code id="alluvial-data_+3A_distill">distill</code></td>
<td>
<p>A logical value indicating whether to include variables, other
than those passed to <code>key</code> and <code>value</code>, that vary within values
of <code>id</code>. Alternatively, a function (or its name) to be used to distill
each such variable to a single value. In addition to existing functions,
<code>distill</code> accepts the character values <code>"first"</code> (used if
<code>distill</code> is <code>TRUE</code>), <code>"last"</code>, and <code>"most"</code> (which
returns the first modal value).</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li><p> One row per <strong>lode</strong>, wherein each row encodes a subset or amount of
observations having a specific profile of axis values, a <code>key</code> field
encodes the axis, a <code>value</code> field encodes the value within each axis, and a
<code>id</code> column identifies multiple lodes corresponding to the same subset or
amount of observations. <code>is_lodes_form</code> tests for this structure.
</p>
</li>
<li><p> One row per <strong>alluvium</strong>, wherein each row encodes a subset or amount of
observations having a specific profile of axis values and a set <code>axes</code> of
fields encodes its values at each axis variable. <code>is_alluvia_form</code> tests
for this structure.
</p>
</li></ul>

<p><code>to_lodes_form</code> takes a data frame with several designated variables to
be used as axes in an alluvial plot, and reshapes the data frame so that
the axis variable names constitute a new factor variable and their values
comprise another. Other variables' values will be repeated, and a
row-grouping variable can be introduced. This function invokes
<code><a href="tidyr.html#topic+gather">tidyr::gather()</a></code>.
</p>
<p><code>to_alluvia_form</code> takes a data frame with axis and axis value variables
to be used in an alluvial plot, and reshape the data frame so that the
axes constitute separate variables whose values are given by the value
variable. This function invokes <code><a href="tidyr.html#topic+spread">tidyr::spread()</a></code>.
</p>


<h3>See Also</h3>

<p>Other alluvial data manipulation: 
<code><a href="#topic+self-adjoin">self-adjoin</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Titanic data in alluvia format
titanic_alluvia &lt;- as.data.frame(Titanic)
head(titanic_alluvia)
is_alluvia_form(titanic_alluvia,
                weight = "Freq")
# Titanic data in lodes format
titanic_lodes &lt;- to_lodes_form(titanic_alluvia,
                               key = "x", value = "stratum", id = "alluvium",
                               axes = 1:4)
head(titanic_lodes)
is_lodes_form(titanic_lodes,
              key = "x", value = "stratum", id = "alluvium",
              weight = "Freq")
# again in lodes format, this time diffusing the `Class` variable
titanic_lodes2 &lt;- to_lodes_form(titanic_alluvia,
                                key = variable, value = value,
                                id = cohort,
                                1:3, diffuse = Class)
head(titanic_lodes2)
is_lodes_form(titanic_lodes2,
              key = variable, value = value, id = cohort,
              weight = Freq)
# use `site` to separate data before lode testing
is_lodes_form(titanic_lodes2,
              key = variable, value = value, id = Class,
              weight = Freq)
is_lodes_form(titanic_lodes2,
              key = variable, value = value, id = Class,
              weight = Freq, site = cohort)

# curriculum data in lodes format
data(majors)
head(majors)
is_lodes_form(majors,
              key = "semester", value = "curriculum", id = "student")
# curriculum data in alluvia format
majors_alluvia &lt;- to_alluvia_form(majors,
                                  key = "semester", value = "curriculum",
                                  id = "student")
head(majors_alluvia)
is_alluvia_form(majors_alluvia, tidyselect::starts_with("CURR"))

# distill variables that vary within `id` values
set.seed(1)
majors$hypo_grade &lt;- LETTERS[sample(5, size = nrow(majors), replace = TRUE)]
majors_alluvia2 &lt;- to_alluvia_form(majors,
                                   key = "semester", value = "curriculum",
                                   id = "student",
                                   distill = "most")
head(majors_alluvia2)

# options to distinguish strata at different axes
gg &lt;- ggplot(majors_alluvia,
             aes(axis1 = CURR1, axis2 = CURR7, axis3 = CURR13))
gg +
  geom_alluvium(aes(fill = as.factor(student)), width = 2/5, discern = TRUE) +
  geom_stratum(width = 2/5, discern = TRUE) +
  geom_text(stat = "stratum", discern = TRUE, aes(label = after_stat(stratum)))
gg +
  geom_alluvium(aes(fill = as.factor(student)), width = 2/5, discern = FALSE) +
  geom_stratum(width = 2/5, discern = FALSE) +
  geom_text(stat = "stratum", discern = FALSE, aes(label = after_stat(stratum)))
# warning when inappropriate
ggplot(majors[majors$semester %in% paste0("CURR", c(1, 7, 13)), ],
       aes(x = semester, stratum = curriculum, alluvium = student,
           label = curriculum)) +
  geom_alluvium(aes(fill = as.factor(student)), width = 2/5, discern = TRUE) +
  geom_stratum(width = 2/5, discern = TRUE) +
  geom_text(stat = "stratum", discern = TRUE)
</code></pre>

<hr>
<h2 id='geom_alluvium'>Alluvia across strata</h2><span id='topic+geom_alluvium'></span><span id='topic+data_to_alluvium'></span>

<h3>Description</h3>

<p><code>geom_alluvium</code> receives a dataset of the horizontal (<code>x</code>) and vertical (<code>y</code>,
<code>ymin</code>, <code>ymax</code>) positions of the <strong>lodes</strong> of an alluvial plot, the
intersections of the alluvia with the strata. It plots both the lodes
themselves, using <code><a href="#topic+geom_lode">geom_lode()</a></code>, and the flows between them, using
<code><a href="#topic+geom_flow">geom_flow()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>geom_alluvium(
  mapping = NULL,
  data = NULL,
  stat = "alluvium",
  position = "identity",
  width = 1/3,
  knot.pos = 1/4,
  knot.prop = TRUE,
  curve_type = NULL,
  curve_range = NULL,
  segments = NULL,
  na.rm = FALSE,
  show.legend = NA,
  inherit.aes = TRUE,
  ...
)

data_to_alluvium(
  data,
  knot.prop = TRUE,
  curve_type = "spline",
  curve_range = NULL,
  segments = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="geom_alluvium_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code>. If specified and
<code>inherit.aes = TRUE</code> (the default), it is combined with the default mapping
at the top level of the plot. You must supply <code>mapping</code> if there is no plot
mapping.</p>
</td></tr>
<tr><td><code id="geom_alluvium_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame</code>, and
will be used as the layer data. A <code>function</code> can be created
from a <code>formula</code> (e.g. <code>~ head(.x, 10)</code>).</p>
</td></tr>
<tr><td><code id="geom_alluvium_+3A_stat">stat</code></td>
<td>
<p>The statistical transformation to use on the data;
override the default.</p>
</td></tr>
<tr><td><code id="geom_alluvium_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string naming the adjustment
(e.g. <code>"jitter"</code> to use <code>position_jitter</code>), or the result of a call to a
position adjustment function. Use the latter if you need to change the
settings of the adjustment.</p>
</td></tr>
<tr><td><code id="geom_alluvium_+3A_width">width</code></td>
<td>
<p>Numeric; the width of each stratum, as a proportion of the
distance between axes. Defaults to 1/3.</p>
</td></tr>
<tr><td><code id="geom_alluvium_+3A_knot.pos">knot.pos</code></td>
<td>
<p>The horizontal distance of x-spline knots from each stratum
(<code>width/2</code> from its axis), either (if <code>knot.prop = TRUE</code>, the default) as a
proportion of the length of the x-spline, i.e. of the gap between adjacent
strata, or (if <code>knot.prop = FALSE</code>) on the scale of the <code>x</code> direction.</p>
</td></tr>
<tr><td><code id="geom_alluvium_+3A_knot.prop">knot.prop</code></td>
<td>
<p>Logical; whether to interpret <code>knot.pos</code> as a proportion of
the length of each flow (the default), rather than on the <code>x</code> scale.</p>
</td></tr>
<tr><td><code id="geom_alluvium_+3A_curve_type">curve_type</code></td>
<td>
<p>Character; the type of curve used to produce flows.
Defaults to <code>"xspline"</code> and can be alternatively set to one of <code>"linear"</code>,
<code>"cubic"</code>, <code>"quintic"</code>, <code>"sine"</code>, <code>"arctangent"</code>, and <code>"sigmoid"</code>.
<code>"xspline"</code> produces approximation splines using 4 points per curve; the
alternatives produce interpolation splines between points along the graphs
of functions of the associated type. See the <strong>Curves</strong> section.</p>
</td></tr>
<tr><td><code id="geom_alluvium_+3A_curve_range">curve_range</code></td>
<td>
<p>For alternative <code>curve_type</code>s based on asymptotic
functions, the value along the asymptote at which to truncate the function
to obtain the shape that will be scaled to fit between strata. See the
<strong>Curves</strong> section.</p>
</td></tr>
<tr><td><code id="geom_alluvium_+3A_segments">segments</code></td>
<td>
<p>The number of segments to be used in drawing each alternative
curve (each curved boundary of each flow). If less than 3, will be silently
changed to 3.</p>
</td></tr>
<tr><td><code id="geom_alluvium_+3A_na.rm">na.rm</code></td>
<td>
<p>Logical:
if <code>FALSE</code>, the default, <code>NA</code> lodes are not included;
if <code>TRUE</code>, <code>NA</code> lodes constitute a separate category,
plotted in grey (regardless of the color scheme).</p>
</td></tr>
<tr><td><code id="geom_alluvium_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="geom_alluvium_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</td></tr>
<tr><td><code id="geom_alluvium_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The helper function <code>data_to_alluvium()</code> takes internal <strong>ggplot2</strong> data
(mapped aesthetics) and curve parameters for a single alluvium as input and
returns a data frame of <code>x</code>, <code>y</code>, and <code>shape</code> used by <code><a href="grid.html#topic+grid.xspline">grid::xsplineGrob()</a></code>
to render the alluvium.
</p>


<h3>Aesthetics</h3>

<p><code>geom_alluvium</code>, <code>geom_flow</code>, <code>geom_lode</code>, and <code>geom_stratum</code> understand the
following aesthetics (required aesthetics are in bold):
</p>

<ul>
<li> <p><strong><code>x</code></strong>
</p>
</li>
<li> <p><strong><code>y</code></strong>
</p>
</li>
<li> <p><strong><code>ymin</code></strong>
</p>
</li>
<li> <p><strong><code>ymax</code></strong>
</p>
</li>
<li> <p><code>alpha</code>
</p>
</li>
<li> <p><code>colour</code>
</p>
</li>
<li> <p><code>fill</code>
</p>
</li>
<li> <p><code>linetype</code>
</p>
</li>
<li> <p><code>size</code>
</p>
</li>
<li> <p><code>group</code>
</p>
</li></ul>

<p><code>group</code> is used internally; arguments are ignored.
</p>


<h3>Curves</h3>

<p>By default, <code>geom_alluvium()</code> and <code>geom_flow()</code> render flows between lodes as
filled regions between parallel x-splines. These graphical elements,
generated using <code><a href="grid.html#topic+grid.xspline">grid::xsplineGrob()</a></code>, are
parameterized by the relative location of the knot (<code>knot.pos</code>). They are
quick to render and clear to read, but users may prefer plots that use
differently-shaped ribbons.
</p>
<p>A variety of such options are documented at, e.g., <a href="https://easings.net/">this easing functions cheat sheet</a> and <a href="https://www.dataplusscience.com/Sigmoid.html">this blog post by Jeffrey Shaffer</a>. Easing functions are
not (yet) used in ggalluvial, but several alternative curves are available.
Each is encoded as a continuous, increasing, bijective function from the unit
interval <code class="reqn">[0,1]</code> to itself, and each is rescaled so that its endpoints
meet the corresponding lodes. They are rendered piecewise-linearly, by
default using <code>segments = 48</code>. Summon each curve type by passing one of the
following strings to <code>curve_type</code>:
</p>

<ul>
<li> <p><code>"linear"</code>:     <code class="reqn">f(x)=x</code>, the unique degree-1 polynomial that takes
0 to 0 and 1 to 1
</p>
</li>
<li> <p><code>"cubic"</code>:      <code class="reqn">f(x)=3x^{2}-2x^{3}</code>, the unique
degree-3 polynomial that also is flat at both endpoints
</p>
</li>
<li> <p><code>"quintic"</code>:    <code class="reqn">f(x)=10x^{3}-15x^{4}+6x^{5}</code>,
the unique degree-5 polynomial that also has zero curvature
at both endpoints
</p>
</li>
<li> <p><code>"sine"</code>:       the unique sinusoidal function that is flat at both
endpoints
</p>
</li>
<li> <p><code>"arctangent"</code>: the inverse tangent function, scaled and re-centered to the
unit interval from the interval centered at zero with
radius <code>curve_range</code>
</p>
</li>
<li> <p><code>"sigmoid"</code>:    the sigmoid function, scaled and re-centered to the unit
interval from the interval centered at zero with radius
<code>curve_range</code>
</p>
</li></ul>

<p>Only the (default) <code>"xspline"</code> option uses the <code style="white-space: pre;">&#8288;knot.*&#8288;</code> parameters, while
only the alternative curves use the <code>segments</code> parameter, and only
<code>"arctangent"</code> and <code>"sigmoid"</code> use the <code>curve_range</code> parameter. (Both are
ignored if not needed.) Larger values of <code>curve_range</code> result in greater
compression and steeper slopes. The <code>NULL</code> default will be changed to
<code>2+sqrt(3)</code> for <code>"arctangent"</code> and to <code>6</code> for <code>"sigmoid"</code>.
</p>
<p>These package-specific options set global values for <code>curve_type</code>,
<code>curve_range</code>, and <code>segments</code> that will be defaulted to when not manually
set:
</p>

<ul>
<li> <p><code>ggalluvial.curve_type</code>: defaults to <code>"xspline"</code>.
</p>
</li>
<li> <p><code>ggalluvial.curve_range</code>: defaults to <code>NA</code>, which triggers the
curve-specific default values.
</p>
</li>
<li> <p><code>ggalluvial.segments</code>: defaults to <code>48L</code>.
</p>
</li></ul>

<p>See <code><a href="base.html#topic+options">base::options()</a></code> for how to use options.
</p>


<h3>Defunct parameters</h3>

<p>The previously defunct parameters <code>axis_width</code> and <code>ribbon_bend</code> have been
discontinued. Use <code>width</code> and <code>knot.pos</code> instead.
</p>


<h3>See Also</h3>

<p><code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code> for additional arguments and
<code><a href="#topic+stat_alluvium">stat_alluvium()</a></code> and
<code><a href="#topic+stat_flow">stat_flow()</a></code> for the corresponding stats.
</p>
<p>Other alluvial geom layers: 
<code><a href="#topic+geom_flow">geom_flow</a>()</code>,
<code><a href="#topic+geom_lode">geom_lode</a>()</code>,
<code><a href="#topic+geom_stratum">geom_stratum</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># basic
ggplot(as.data.frame(Titanic),
       aes(y = Freq,
           axis1 = Class, axis2 = Sex, axis3 = Age,
           fill = Survived)) +
  geom_alluvium() +
  scale_x_discrete(limits = c("Class", "Sex", "Age"))

gg &lt;- ggplot(alluvial::Refugees,
             aes(y = refugees, x = year, alluvium = country))
# time series bump chart (quintic flows)
gg + geom_alluvium(aes(fill = country, colour = country),
                   width = 1/4, alpha = 2/3, decreasing = FALSE,
                   curve_type = "sigmoid")
# time series line plot of refugees data, sorted by country
gg + geom_alluvium(aes(fill = country, colour = country),
                   decreasing = NA, width = 0, knot.pos = 0)


# irregular spacing between axes of a continuous variable
refugees_sub &lt;- subset(alluvial::Refugees, year %in% c(2003, 2005, 2010, 2013))
gg &lt;- ggplot(data = refugees_sub,
             aes(x = year, y = refugees, alluvium = country)) +
  theme_bw() +
  scale_fill_brewer(type = "qual", palette = "Set3")
# proportional knot positioning (default)
gg +
  geom_alluvium(aes(fill = country),
                alpha = .75, decreasing = FALSE, width = 1/2) +
  geom_stratum(aes(stratum = country), decreasing = FALSE, width = 1/2)
# constant knot positioning
gg +
  geom_alluvium(aes(fill = country),
                alpha = .75, decreasing = FALSE, width = 1/2,
                knot.pos = 1, knot.prop = FALSE) +
  geom_stratum(aes(stratum = country), decreasing = FALSE, width = 1/2)
# coarsely-segmented curves
gg +
  geom_alluvium(aes(fill = country),
                alpha = .75, decreasing = FALSE, width = 1/2,
                curve_type = "arctan", segments = 6) +
  geom_stratum(aes(stratum = country), decreasing = FALSE, width = 1/2)
# custom-ranged curves
gg +
  geom_alluvium(aes(fill = country),
                alpha = .75, decreasing = FALSE, width = 1/2,
                curve_type = "arctan", curve_range = 1) +
  geom_stratum(aes(stratum = country), decreasing = FALSE, width = 1/2)

</code></pre>

<hr>
<h2 id='geom_flow'>Flows between lodes or strata</h2><span id='topic+geom_flow'></span><span id='topic+positions_to_flow'></span>

<h3>Description</h3>

<p><code>geom_flow</code> receives a dataset of the horizontal (<code>x</code>) and vertical (<code>y</code>,
<code>ymin</code>, <code>ymax</code>) positions of the <strong>lodes</strong> of an alluvial plot, the
intersections of the alluvia with the strata. It reconfigures these into
alluvial segments connecting pairs of corresponding lodes in adjacent strata
and plots filled x-splines between each such pair, using a provided knot
position parameter <code>knot.pos</code>, and filled rectangles at either end, using a
provided <code>width</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>geom_flow(
  mapping = NULL,
  data = NULL,
  stat = "flow",
  position = "identity",
  width = 1/3,
  knot.pos = 1/4,
  knot.prop = TRUE,
  curve_type = NULL,
  curve_range = NULL,
  segments = NULL,
  aes.flow = "forward",
  na.rm = FALSE,
  show.legend = NA,
  inherit.aes = TRUE,
  ...
)

positions_to_flow(
  x0,
  x1,
  ymin0,
  ymax0,
  ymin1,
  ymax1,
  kp0,
  kp1,
  knot.prop,
  curve_type,
  curve_range,
  segments
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="geom_flow_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code>. If specified and
<code>inherit.aes = TRUE</code> (the default), it is combined with the default mapping
at the top level of the plot. You must supply <code>mapping</code> if there is no plot
mapping.</p>
</td></tr>
<tr><td><code id="geom_flow_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame</code>, and
will be used as the layer data. A <code>function</code> can be created
from a <code>formula</code> (e.g. <code>~ head(.x, 10)</code>).</p>
</td></tr>
<tr><td><code id="geom_flow_+3A_stat">stat</code></td>
<td>
<p>The statistical transformation to use on the data;
override the default.</p>
</td></tr>
<tr><td><code id="geom_flow_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string naming the adjustment
(e.g. <code>"jitter"</code> to use <code>position_jitter</code>), or the result of a call to a
position adjustment function. Use the latter if you need to change the
settings of the adjustment.</p>
</td></tr>
<tr><td><code id="geom_flow_+3A_width">width</code></td>
<td>
<p>Numeric; the width of each stratum, as a proportion of the
distance between axes. Defaults to 1/3.</p>
</td></tr>
<tr><td><code id="geom_flow_+3A_knot.pos">knot.pos</code></td>
<td>
<p>The horizontal distance of x-spline knots from each stratum
(<code>width/2</code> from its axis), either (if <code>knot.prop = TRUE</code>, the default) as a
proportion of the length of the x-spline, i.e. of the gap between adjacent
strata, or (if <code>knot.prop = FALSE</code>) on the scale of the <code>x</code> direction.</p>
</td></tr>
<tr><td><code id="geom_flow_+3A_knot.prop">knot.prop</code></td>
<td>
<p>Logical; whether to interpret <code>knot.pos</code> as a proportion of
the length of each flow (the default), rather than on the <code>x</code> scale.</p>
</td></tr>
<tr><td><code id="geom_flow_+3A_curve_type">curve_type</code></td>
<td>
<p>Character; the type of curve used to produce flows.
Defaults to <code>"xspline"</code> and can be alternatively set to one of <code>"linear"</code>,
<code>"cubic"</code>, <code>"quintic"</code>, <code>"sine"</code>, <code>"arctangent"</code>, and <code>"sigmoid"</code>.
<code>"xspline"</code> produces approximation splines using 4 points per curve; the
alternatives produce interpolation splines between points along the graphs
of functions of the associated type. See the <strong>Curves</strong> section.</p>
</td></tr>
<tr><td><code id="geom_flow_+3A_curve_range">curve_range</code></td>
<td>
<p>For alternative <code>curve_type</code>s based on asymptotic
functions, the value along the asymptote at which to truncate the function
to obtain the shape that will be scaled to fit between strata. See the
<strong>Curves</strong> section.</p>
</td></tr>
<tr><td><code id="geom_flow_+3A_segments">segments</code></td>
<td>
<p>The number of segments to be used in drawing each alternative
curve (each curved boundary of each flow). If less than 3, will be silently
changed to 3.</p>
</td></tr>
<tr><td><code id="geom_flow_+3A_aes.flow">aes.flow</code></td>
<td>
<p>Character; how inter-lode flows assume aesthetics from lodes.
Options are &quot;forward&quot; and &quot;backward&quot;.</p>
</td></tr>
<tr><td><code id="geom_flow_+3A_na.rm">na.rm</code></td>
<td>
<p>Logical:
if <code>FALSE</code>, the default, <code>NA</code> lodes are not included;
if <code>TRUE</code>, <code>NA</code> lodes constitute a separate category,
plotted in grey (regardless of the color scheme).</p>
</td></tr>
<tr><td><code id="geom_flow_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="geom_flow_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</td></tr>
<tr><td><code id="geom_flow_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code>.</p>
</td></tr>
<tr><td><code id="geom_flow_+3A_x0">x0</code>, <code id="geom_flow_+3A_x1">x1</code>, <code id="geom_flow_+3A_ymin0">ymin0</code>, <code id="geom_flow_+3A_ymax0">ymax0</code>, <code id="geom_flow_+3A_ymin1">ymin1</code>, <code id="geom_flow_+3A_ymax1">ymax1</code>, <code id="geom_flow_+3A_kp0">kp0</code>, <code id="geom_flow_+3A_kp1">kp1</code></td>
<td>
<p>Numeric corner and knot position
data for the ribbon of a single flow.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The helper function <code>positions_toflow()</code> takes the corner and knot positions
and curve parameters for a single flow as input and returns a data frame of
<code>x</code>, <code>y</code>, and <code>shape</code> used by <code><a href="grid.html#topic+grid.xspline">grid::xsplineGrob()</a></code> to render the flow.
</p>


<h3>Aesthetics</h3>

<p><code>geom_alluvium</code>, <code>geom_flow</code>, <code>geom_lode</code>, and <code>geom_stratum</code> understand the
following aesthetics (required aesthetics are in bold):
</p>

<ul>
<li> <p><strong><code>x</code></strong>
</p>
</li>
<li> <p><strong><code>y</code></strong>
</p>
</li>
<li> <p><strong><code>ymin</code></strong>
</p>
</li>
<li> <p><strong><code>ymax</code></strong>
</p>
</li>
<li> <p><code>alpha</code>
</p>
</li>
<li> <p><code>colour</code>
</p>
</li>
<li> <p><code>fill</code>
</p>
</li>
<li> <p><code>linetype</code>
</p>
</li>
<li> <p><code>size</code>
</p>
</li>
<li> <p><code>group</code>
</p>
</li></ul>

<p><code>group</code> is used internally; arguments are ignored.
</p>


<h3>Curves</h3>

<p>By default, <code>geom_alluvium()</code> and <code>geom_flow()</code> render flows between lodes as
filled regions between parallel x-splines. These graphical elements,
generated using <code><a href="grid.html#topic+grid.xspline">grid::xsplineGrob()</a></code>, are
parameterized by the relative location of the knot (<code>knot.pos</code>). They are
quick to render and clear to read, but users may prefer plots that use
differently-shaped ribbons.
</p>
<p>A variety of such options are documented at, e.g., <a href="https://easings.net/">this easing functions cheat sheet</a> and <a href="https://www.dataplusscience.com/Sigmoid.html">this blog post by Jeffrey Shaffer</a>. Easing functions are
not (yet) used in ggalluvial, but several alternative curves are available.
Each is encoded as a continuous, increasing, bijective function from the unit
interval <code class="reqn">[0,1]</code> to itself, and each is rescaled so that its endpoints
meet the corresponding lodes. They are rendered piecewise-linearly, by
default using <code>segments = 48</code>. Summon each curve type by passing one of the
following strings to <code>curve_type</code>:
</p>

<ul>
<li> <p><code>"linear"</code>:     <code class="reqn">f(x)=x</code>, the unique degree-1 polynomial that takes
0 to 0 and 1 to 1
</p>
</li>
<li> <p><code>"cubic"</code>:      <code class="reqn">f(x)=3x^{2}-2x^{3}</code>, the unique
degree-3 polynomial that also is flat at both endpoints
</p>
</li>
<li> <p><code>"quintic"</code>:    <code class="reqn">f(x)=10x^{3}-15x^{4}+6x^{5}</code>,
the unique degree-5 polynomial that also has zero curvature
at both endpoints
</p>
</li>
<li> <p><code>"sine"</code>:       the unique sinusoidal function that is flat at both
endpoints
</p>
</li>
<li> <p><code>"arctangent"</code>: the inverse tangent function, scaled and re-centered to the
unit interval from the interval centered at zero with
radius <code>curve_range</code>
</p>
</li>
<li> <p><code>"sigmoid"</code>:    the sigmoid function, scaled and re-centered to the unit
interval from the interval centered at zero with radius
<code>curve_range</code>
</p>
</li></ul>

<p>Only the (default) <code>"xspline"</code> option uses the <code style="white-space: pre;">&#8288;knot.*&#8288;</code> parameters, while
only the alternative curves use the <code>segments</code> parameter, and only
<code>"arctangent"</code> and <code>"sigmoid"</code> use the <code>curve_range</code> parameter. (Both are
ignored if not needed.) Larger values of <code>curve_range</code> result in greater
compression and steeper slopes. The <code>NULL</code> default will be changed to
<code>2+sqrt(3)</code> for <code>"arctangent"</code> and to <code>6</code> for <code>"sigmoid"</code>.
</p>
<p>These package-specific options set global values for <code>curve_type</code>,
<code>curve_range</code>, and <code>segments</code> that will be defaulted to when not manually
set:
</p>

<ul>
<li> <p><code>ggalluvial.curve_type</code>: defaults to <code>"xspline"</code>.
</p>
</li>
<li> <p><code>ggalluvial.curve_range</code>: defaults to <code>NA</code>, which triggers the
curve-specific default values.
</p>
</li>
<li> <p><code>ggalluvial.segments</code>: defaults to <code>48L</code>.
</p>
</li></ul>

<p>See <code><a href="base.html#topic+options">base::options()</a></code> for how to use options.
</p>


<h3>Defunct parameters</h3>

<p>The previously defunct parameters <code>axis_width</code> and <code>ribbon_bend</code> have been
discontinued. Use <code>width</code> and <code>knot.pos</code> instead.
</p>


<h3>See Also</h3>

<p><code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code> for additional arguments and
<code><a href="#topic+stat_alluvium">stat_alluvium()</a></code> and
<code><a href="#topic+stat_flow">stat_flow()</a></code> for the corresponding stats.
</p>
<p>Other alluvial geom layers: 
<code><a href="#topic+geom_alluvium">geom_alluvium</a>()</code>,
<code><a href="#topic+geom_lode">geom_lode</a>()</code>,
<code><a href="#topic+geom_stratum">geom_stratum</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># use of strata and labels
ggplot(as.data.frame(Titanic),
       aes(y = Freq,
           axis1 = Class, axis2 = Sex, axis3 = Age)) +
  geom_flow() +
  scale_x_discrete(limits = c("Class", "Sex", "Age")) +
  geom_stratum() +
  geom_text(stat = "stratum", aes(label = after_stat(stratum))) +
  ggtitle("Alluvial plot of Titanic passenger demographic data")

# use of facets, with sigmoid flows
ggplot(as.data.frame(Titanic),
       aes(y = Freq,
           axis1 = Class, axis2 = Sex)) +
  geom_flow(aes(fill = Age), width = .4, curve_type = "quintic") +
  geom_stratum(width = .4) +
  geom_text(stat = "stratum", aes(label = after_stat(stratum)), size = 3) +
  scale_x_discrete(limits = c("Class", "Sex")) +
  facet_wrap(~ Survived, scales = "fixed")

# time series alluvia of WorldPhones data
wph &lt;- as.data.frame(as.table(WorldPhones))
names(wph) &lt;- c("Year", "Region", "Telephones")
ggplot(wph,
       aes(x = Year, alluvium = Region, y = Telephones)) +
  geom_flow(aes(fill = Region, colour = Region), width = 0)
# treat 'Year' as a number rather than as a factor
wph$Year &lt;- as.integer(as.character(wph$Year))
ggplot(wph,
       aes(x = Year, alluvium = Region, y = Telephones)) +
  geom_flow(aes(fill = Region, colour = Region), width = 0)
# hold the knot positions fixed
ggplot(wph,
       aes(x = Year, alluvium = Region, y = Telephones)) +
  geom_flow(aes(fill = Region, colour = Region), width = 0, knot.prop = FALSE)


# rightward flow aesthetics for vaccine survey data, with cubic flows
data(vaccinations)
vaccinations$response &lt;- factor(vaccinations$response,
                                rev(levels(vaccinations$response)))
# annotate with proportional counts
ggplot(vaccinations,
       aes(x = survey, stratum = response, alluvium = subject,
           y = freq, fill = response)) +
  geom_lode() + geom_flow(curve_type = "cubic") +
  geom_stratum(alpha = 0) +
  geom_text(stat = "stratum", aes(label = round(after_stat(prop), 3)))
# annotate fixed-width ribbons with counts
ggplot(vaccinations,
       aes(x = survey, stratum = response, alluvium = subject,
           weight = freq, fill = response)) +
  geom_lode() + geom_flow(curve_type = "cubic") +
  geom_stratum(alpha = 0) +
  geom_text(stat = "flow",
            aes(label = after_stat(n),
                hjust = (after_stat(flow) == "to")))

</code></pre>

<hr>
<h2 id='geom_lode'>Lodes at intersections of alluvia and strata</h2><span id='topic+geom_lode'></span>

<h3>Description</h3>

<p><code>geom_alluvium</code> receives a dataset of the horizontal (<code>x</code>) and vertical (<code>y</code>,
<code>ymin</code>, <code>ymax</code>) positions of the <strong>lodes</strong> of an alluvial plot, the
intersections of the alluvia with the strata. It plots rectangles for these
lodes of a provided <code>width</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>geom_lode(
  mapping = NULL,
  data = NULL,
  stat = "alluvium",
  position = "identity",
  width = 1/3,
  na.rm = FALSE,
  show.legend = NA,
  inherit.aes = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="geom_lode_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code>. If specified and
<code>inherit.aes = TRUE</code> (the default), it is combined with the default mapping
at the top level of the plot. You must supply <code>mapping</code> if there is no plot
mapping.</p>
</td></tr>
<tr><td><code id="geom_lode_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame</code>, and
will be used as the layer data. A <code>function</code> can be created
from a <code>formula</code> (e.g. <code>~ head(.x, 10)</code>).</p>
</td></tr>
<tr><td><code id="geom_lode_+3A_stat">stat</code></td>
<td>
<p>The statistical transformation to use on the data;
override the default.</p>
</td></tr>
<tr><td><code id="geom_lode_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string naming the adjustment
(e.g. <code>"jitter"</code> to use <code>position_jitter</code>), or the result of a call to a
position adjustment function. Use the latter if you need to change the
settings of the adjustment.</p>
</td></tr>
<tr><td><code id="geom_lode_+3A_width">width</code></td>
<td>
<p>Numeric; the width of each stratum, as a proportion of the
distance between axes. Defaults to 1/3.</p>
</td></tr>
<tr><td><code id="geom_lode_+3A_na.rm">na.rm</code></td>
<td>
<p>Logical:
if <code>FALSE</code>, the default, <code>NA</code> lodes are not included;
if <code>TRUE</code>, <code>NA</code> lodes constitute a separate category,
plotted in grey (regardless of the color scheme).</p>
</td></tr>
<tr><td><code id="geom_lode_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="geom_lode_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</td></tr>
<tr><td><code id="geom_lode_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code>.</p>
</td></tr>
</table>


<h3>Aesthetics</h3>

<p><code>geom_alluvium</code>, <code>geom_flow</code>, <code>geom_lode</code>, and <code>geom_stratum</code> understand the
following aesthetics (required aesthetics are in bold):
</p>

<ul>
<li> <p><strong><code>x</code></strong>
</p>
</li>
<li> <p><strong><code>y</code></strong>
</p>
</li>
<li> <p><strong><code>ymin</code></strong>
</p>
</li>
<li> <p><strong><code>ymax</code></strong>
</p>
</li>
<li> <p><code>alpha</code>
</p>
</li>
<li> <p><code>colour</code>
</p>
</li>
<li> <p><code>fill</code>
</p>
</li>
<li> <p><code>linetype</code>
</p>
</li>
<li> <p><code>size</code>
</p>
</li>
<li> <p><code>group</code>
</p>
</li></ul>

<p><code>group</code> is used internally; arguments are ignored.
</p>


<h3>Defunct parameters</h3>

<p>The previously defunct parameters <code>axis_width</code> and <code>ribbon_bend</code> have been
discontinued. Use <code>width</code> and <code>knot.pos</code> instead.
</p>


<h3>See Also</h3>

<p><code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code> for additional arguments and
<code><a href="#topic+stat_alluvium">stat_alluvium()</a></code> and
<code><a href="#topic+stat_stratum">stat_stratum()</a></code> for the corresponding stats.
</p>
<p>Other alluvial geom layers: 
<code><a href="#topic+geom_alluvium">geom_alluvium</a>()</code>,
<code><a href="#topic+geom_flow">geom_flow</a>()</code>,
<code><a href="#topic+geom_stratum">geom_stratum</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># one axis
ggplot(as.data.frame(Titanic),
       aes(y = Freq,
           axis = Class)) +
  geom_lode(aes(fill = Class, alpha = Survived)) +
  scale_x_discrete(limits = c("Class")) +
  scale_alpha_manual(values = c(.25, .75))

gg &lt;- ggplot(as.data.frame(Titanic),
             aes(y = Freq,
                 axis1 = Class, axis2 = Sex, axis3 = Age,
                 fill = Survived))
# alluvia and lodes
gg + geom_alluvium() + geom_lode()
# lodes as strata
gg + geom_alluvium() +
  geom_stratum(stat = "alluvium")
</code></pre>

<hr>
<h2 id='geom_stratum'>Strata at axes</h2><span id='topic+geom_stratum'></span>

<h3>Description</h3>

<p><code>geom_stratum</code> receives a dataset of the horizontal (<code>x</code>) and vertical (<code>y</code>,
<code>ymin</code>, <code>ymax</code>) positions of the strata of an alluvial plot. It plots
rectangles for these strata of a provided <code>width</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>geom_stratum(
  mapping = NULL,
  data = NULL,
  stat = "stratum",
  position = "identity",
  show.legend = NA,
  inherit.aes = TRUE,
  width = 1/3,
  na.rm = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="geom_stratum_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code>. If specified and
<code>inherit.aes = TRUE</code> (the default), it is combined with the default mapping
at the top level of the plot. You must supply <code>mapping</code> if there is no plot
mapping.</p>
</td></tr>
<tr><td><code id="geom_stratum_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame</code>, and
will be used as the layer data. A <code>function</code> can be created
from a <code>formula</code> (e.g. <code>~ head(.x, 10)</code>).</p>
</td></tr>
<tr><td><code id="geom_stratum_+3A_stat">stat</code></td>
<td>
<p>The statistical transformation to use on the data;
override the default.</p>
</td></tr>
<tr><td><code id="geom_stratum_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string naming the adjustment
(e.g. <code>"jitter"</code> to use <code>position_jitter</code>), or the result of a call to a
position adjustment function. Use the latter if you need to change the
settings of the adjustment.</p>
</td></tr>
<tr><td><code id="geom_stratum_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="geom_stratum_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</td></tr>
<tr><td><code id="geom_stratum_+3A_width">width</code></td>
<td>
<p>Numeric; the width of each stratum, as a proportion of the
distance between axes. Defaults to 1/3.</p>
</td></tr>
<tr><td><code id="geom_stratum_+3A_na.rm">na.rm</code></td>
<td>
<p>Logical:
if <code>FALSE</code>, the default, <code>NA</code> lodes are not included;
if <code>TRUE</code>, <code>NA</code> lodes constitute a separate category,
plotted in grey (regardless of the color scheme).</p>
</td></tr>
<tr><td><code id="geom_stratum_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code>.</p>
</td></tr>
</table>


<h3>Aesthetics</h3>

<p><code>geom_alluvium</code>, <code>geom_flow</code>, <code>geom_lode</code>, and <code>geom_stratum</code> understand the
following aesthetics (required aesthetics are in bold):
</p>

<ul>
<li> <p><strong><code>x</code></strong>
</p>
</li>
<li> <p><strong><code>y</code></strong>
</p>
</li>
<li> <p><strong><code>ymin</code></strong>
</p>
</li>
<li> <p><strong><code>ymax</code></strong>
</p>
</li>
<li> <p><code>alpha</code>
</p>
</li>
<li> <p><code>colour</code>
</p>
</li>
<li> <p><code>fill</code>
</p>
</li>
<li> <p><code>linetype</code>
</p>
</li>
<li> <p><code>size</code>
</p>
</li>
<li> <p><code>group</code>
</p>
</li></ul>

<p><code>group</code> is used internally; arguments are ignored.
</p>


<h3>Defunct parameters</h3>

<p>The previously defunct parameters <code>axis_width</code> and <code>ribbon_bend</code> have been
discontinued. Use <code>width</code> and <code>knot.pos</code> instead.
</p>


<h3>See Also</h3>

<p><code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code> for additional arguments and
<code><a href="#topic+stat_stratum">stat_stratum()</a></code> for the corresponding stat.
</p>
<p>Other alluvial geom layers: 
<code><a href="#topic+geom_alluvium">geom_alluvium</a>()</code>,
<code><a href="#topic+geom_flow">geom_flow</a>()</code>,
<code><a href="#topic+geom_lode">geom_lode</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># full axis width
ggplot(as.data.frame(Titanic),
       aes(y = Freq,
           axis1 = Class, axis2 = Sex, axis3 = Age, axis4 = Survived)) +
  geom_stratum(width = 1) +
  geom_text(stat = "stratum", aes(label = after_stat(stratum))) +
  scale_x_discrete(limits = c("Class", "Sex", "Age", "Survived"))
  
# use of facets
ggplot(as.data.frame(Titanic),
       aes(y = Freq,
           axis1 = Class, axis2 = Sex)) +
  geom_flow(aes(fill = Survived)) +
  geom_stratum() +
  geom_text(stat = "stratum", aes(label = after_stat(stratum))) +
  scale_x_discrete(limits = c("Class", "Sex")) +
  facet_wrap(~ Age, scales = "free_y")
</code></pre>

<hr>
<h2 id='GeomAlluvium'>Base ggproto classes for ggalluvial</h2><span id='topic+GeomAlluvium'></span><span id='topic+GeomFlow'></span><span id='topic+GeomLode'></span><span id='topic+GeomStratum'></span><span id='topic+ggalluvial-ggproto'></span><span id='topic+StatAlluvium'></span><span id='topic+StatFlow'></span><span id='topic+StatStratum'></span>

<h3>Description</h3>

<p>Base ggproto classes for ggalluvial
</p>


<h3>Format</h3>

<p>An object of class <code>GeomAlluvium</code> (inherits from <code>Geom</code>, <code>ggproto</code>, <code>gg</code>) of length 8.
</p>
<p>An object of class <code>GeomFlow</code> (inherits from <code>Geom</code>, <code>ggproto</code>, <code>gg</code>) of length 8.
</p>
<p>An object of class <code>GeomLode</code> (inherits from <code>Geom</code>, <code>ggproto</code>, <code>gg</code>) of length 6.
</p>
<p>An object of class <code>GeomStratum</code> (inherits from <code>GeomRect</code>, <code>Geom</code>, <code>ggproto</code>, <code>gg</code>) of length 6.
</p>
<p>An object of class <code>StatAlluvium</code> (inherits from <code>Stat</code>, <code>ggproto</code>, <code>gg</code>) of length 6.
</p>
<p>An object of class <code>StatFlow</code> (inherits from <code>Stat</code>, <code>ggproto</code>, <code>gg</code>) of length 7.
</p>
<p>An object of class <code>StatStratum</code> (inherits from <code>Stat</code>, <code>ggproto</code>, <code>gg</code>) of length 5.
</p>


<h3>See Also</h3>

<p><code><a href="ggplot2.html#topic+ggplot2-ggproto">ggplot2::ggplot2-ggproto</a></code>
</p>

<hr>
<h2 id='ggalluvial-deprecated'>Deprecated functions</h2><span id='topic+ggalluvial-deprecated'></span><span id='topic+is_alluvial'></span><span id='topic+is_alluvial_lodes'></span><span id='topic+is_alluvial_alluvia'></span><span id='topic+to_lodes'></span><span id='topic+to_alluvia'></span>

<h3>Description</h3>

<p>These functions are deprecated in the current version and may be removed in a
future version.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_alluvial(data, ..., silent = FALSE)

is_alluvial_lodes(...)

is_alluvial_alluvia(...)

to_lodes(...)

to_alluvia(...)
</code></pre>


<h3>Details</h3>

<p>Use <code style="white-space: pre;">&#8288;is_*_form&#8288;</code> instead of <code>is_alluvial</code> and <code style="white-space: pre;">&#8288;is_alluvial_*&#8288;</code>.
Use <code style="white-space: pre;">&#8288;to_*_form&#8288;</code> instead of <code style="white-space: pre;">&#8288;to_*&#8288;</code>.
</p>

<hr>
<h2 id='ggalluvial-package'>ggalluvial: Alluvial Plots in 'ggplot2'</h2><span id='topic+ggalluvial'></span><span id='topic+ggalluvial-package'></span>

<h3>Description</h3>

<p>Alluvial plots use variable-width ribbons and stacked bar plots to represent multi-dimensional or repeated-measures data with categorical or ordinal variables; see Riehmann, Hanfler, and Froehlich (2005) <a href="https://doi.org/10.1109/INFVIS.2005.1532152">doi:10.1109/INFVIS.2005.1532152</a> and Rosvall and Bergstrom (2010) <a href="https://doi.org/10.1371/journal.pone.0008694">doi:10.1371/journal.pone.0008694</a>. Alluvial plots are statistical graphics in the sense of Wilkinson (2006) <a href="https://doi.org/10.1007/0-387-28695-0">doi:10.1007/0-387-28695-0</a>; they share elements with Sankey diagrams and parallel sets plots but are uniquely determined from the data and a small set of parameters. This package extends Wickham's (2010) <a href="https://doi.org/10.1198/jcgs.2009.07098">doi:10.1198/jcgs.2009.07098</a> layered grammar of graphics to generate alluvial plots from tidy data.
</p>


<h3>Acknowledgments</h3>

<p>Many users identified problems and suggested improvements via email and the
GitHub issue tracker.
</p>
<p>Development benefitted from the use of equipment and the support of
colleagues at <a href="https://health.uconn.edu/">UConn Health</a> and at <a href="https://ufhealth.org/">UF Health</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Jason Cory Brunson <a href="mailto:cornelioid@gmail.com">cornelioid@gmail.com</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Quentin D. Read
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="http://corybrunson.github.io/ggalluvial/">http://corybrunson.github.io/ggalluvial/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/corybrunson/ggalluvial/issues">https://github.com/corybrunson/ggalluvial/issues</a>
</p>
</li></ul>


<hr>
<h2 id='lode-guidance-functions'>Lode guidance functions</h2><span id='topic+lode-guidance-functions'></span><span id='topic+lode_zigzag'></span><span id='topic+lode_zagzig'></span><span id='topic+lode_forward'></span><span id='topic+lode_rightward'></span><span id='topic+lode_backward'></span><span id='topic+lode_leftward'></span><span id='topic+lode_frontback'></span><span id='topic+lode_rightleft'></span><span id='topic+lode_backfront'></span><span id='topic+lode_leftright'></span>

<h3>Description</h3>

<p>These functions control the order of lodes within strata in an alluvial
diagram. They are invoked by <code><a href="#topic+stat_alluvium">stat_alluvium()</a></code> and can be passed to
the <code>lode.guidance</code> parameter.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lode_zigzag(n, i)

lode_zagzig(n, i)

lode_forward(n, i)

lode_rightward(n, i)

lode_backward(n, i)

lode_leftward(n, i)

lode_frontback(n, i)

lode_rightleft(n, i)

lode_backfront(n, i)

lode_leftright(n, i)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lode-guidance-functions_+3A_n">n</code></td>
<td>
<p>Numeric, a positive integer</p>
</td></tr>
<tr><td><code id="lode-guidance-functions_+3A_i">i</code></td>
<td>
<p>Numeric, a positive integer at most <code>n</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Each function orders the numbers 1 through <code>n</code>, starting at index
<code>i</code>. The choice of function made in <code><a href="#topic+stat_alluvium">stat_alluvium()</a></code>
determines the order in which the other axes contribute to the sorting of
lodes within each index axis. After starting at <code>i</code>, the functions order
the remaining axes as follows:
</p>

<ul>
<li> <p><code>zigzag</code>: Zigzag outward from <code>i</code>, starting in the outward direction
</p>
</li>
<li> <p><code>zigzag</code>: Zigzag outward from <code>i</code>, starting in the inward direction
</p>
</li>
<li> <p><code>forward</code>: Increasing order (alias <code>rightward</code>)
</p>
</li>
<li> <p><code>backward</code>: Decreasing order (alias <code>leftward</code>)
</p>
</li>
<li> <p><code>frontback</code>: Proceed forward from <code>i</code> to <code>n</code>, then backward to 1
(alias <code>rightleft</code>)
</p>
</li>
<li> <p><code>backfront</code>: Proceed backward from <code>i</code> to 1, then forward to <code>n</code>
(alias <code>leftright</code>)
</p>
</li></ul>

<p>An extended discussion of how strata and lodes are arranged in alluvial
plots, including the effects of different lode guidance functions, can be
found in the vignette &quot;The Order of the Rectangles&quot; via
<code>vignette("order-rectangles", package = "ggalluvial")</code>.
</p>

<hr>
<h2 id='majors'>Students' declared majors across several semesters</h2><span id='topic+majors'></span>

<h3>Description</h3>

<p>This data set follows the major curricula of 10 students across 8 academic
semesters. Missing values indicate undeclared majors. The data were kindly
contributed by Dario Bonaretti.
</p>


<h3>Format</h3>

<p>A data frame with 80 rows and 3 variables:
</p>

<dl>
<dt><code>student</code></dt><dd><p>student identifier</p>
</dd>
<dt><code>semester</code></dt><dd><p>character tag for odd-numbered semesters</p>
</dd>
<dt><code>curriculum</code></dt><dd><p>declared major program</p>
</dd>
</dl>


<hr>
<h2 id='self-adjoin'>Adjoin a dataset to itself</h2><span id='topic+self-adjoin'></span><span id='topic+self_adjoin'></span>

<h3>Description</h3>

<p>This function binds a dataset to itself along adjacent pairs of a <code>key</code>
variable. It is invoked by <code><a href="#topic+geom_flow">geom_flow()</a></code> to convert data in lodes
form to something similar to alluvia form.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>self_adjoin(
  data,
  key,
  by = NULL,
  link = NULL,
  keep.x = NULL,
  keep.y = NULL,
  suffix = c(".x", ".y")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="self-adjoin_+3A_data">data</code></td>
<td>
<p>A data frame in lodes form (repeated measures data; see
<code><a href="#topic+alluvial-data">alluvial-data</a></code>).</p>
</td></tr>
<tr><td><code id="self-adjoin_+3A_key">key</code></td>
<td>
<p>Column of <code>data</code> indicating sequential collection; handled as in
<code><a href="tidyr.html#topic+spread">tidyr::spread()</a></code>.</p>
</td></tr>
<tr><td><code id="self-adjoin_+3A_by">by</code></td>
<td>
<p>Character vector of variables to self-adjoin by; passed to
<code><a href="dplyr.html#topic+mutate-joins">dplyr::mutate-joins</a></code> functions.</p>
</td></tr>
<tr><td><code id="self-adjoin_+3A_link">link</code></td>
<td>
<p>Character vector of variables to adjoin. Will be replaced by
pairs of variables suffixed by <code>suffix</code>.</p>
</td></tr>
<tr><td><code id="self-adjoin_+3A_keep.x">keep.x</code>, <code id="self-adjoin_+3A_keep.y">keep.y</code></td>
<td>
<p>Character vector of variables to associate with the
first (respectively, second) copy of <code>data</code> after adjoining. These
variables can overlap with each other but cannot overlap with <code>by</code> or
<code>link</code>.</p>
</td></tr>
<tr><td><code id="self-adjoin_+3A_suffix">suffix</code></td>
<td>
<p>Suffixes to add to the adjoined <code>link</code> variables; passed to
<code><a href="dplyr.html#topic+mutate-joins">dplyr::mutate-joins</a></code> functions.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>self_adjoin</code> invokes <code><a href="dplyr.html#topic+mutate-joins">dplyr::mutate-joins</a></code> functions in order to convert
a dataset with measures along a discrete <code>key</code> variable into a dataset
consisting of column bindings of these measures (by any <code>by</code> variables) along
adjacent values of <code>key</code>.
</p>


<h3>See Also</h3>

<p>Other alluvial data manipulation: 
<code><a href="#topic+alluvial-data">alluvial-data</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># self-adjoin `majors` data
data(majors)
major_changes &lt;- self_adjoin(majors, key = semester,
                             by = "student", link = c("semester", "curriculum"))
major_changes$change &lt;- major_changes$curriculum.x == major_changes$curriculum.y
head(major_changes)

# self-adjoin `vaccinations` data
data(vaccinations)
vaccination_steps &lt;- self_adjoin(vaccinations, key = survey, by = "subject",
                                 link = c("survey", "response"),
                                 keep.x = c("freq"))
head(vaccination_steps)
vaccination_steps &lt;- self_adjoin(vaccinations, key = survey, by = "subject",
                                 link = c("survey", "response"),
                                 keep.x = c("freq"),
                                 keep.y = c("start_date", "end_date"))
head(vaccination_steps)
</code></pre>

<hr>
<h2 id='stat_alluvium'>Alluvial positions</h2><span id='topic+stat_alluvium'></span>

<h3>Description</h3>

<p>Given a dataset with alluvial structure, <code>stat_alluvium</code> calculates the
centroids (<code>x</code> and <code>y</code>) and heights (<code>ymin</code> and <code>ymax</code>) of the lodes, the
intersections of the alluvia with the strata. It leverages the <code>group</code>
aesthetic for plotting purposes (for now).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stat_alluvium(
  mapping = NULL,
  data = NULL,
  geom = "alluvium",
  position = "identity",
  decreasing = NULL,
  reverse = NULL,
  absolute = NULL,
  discern = FALSE,
  negate.strata = NULL,
  aggregate.y = NULL,
  cement.alluvia = NULL,
  lode.guidance = NULL,
  lode.ordering = NULL,
  aes.bind = NULL,
  infer.label = FALSE,
  min.y = NULL,
  max.y = NULL,
  na.rm = FALSE,
  show.legend = NA,
  inherit.aes = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stat_alluvium_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code>. If specified and
<code>inherit.aes = TRUE</code> (the default), it is combined with the default mapping
at the top level of the plot. You must supply <code>mapping</code> if there is no plot
mapping.</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame</code>, and
will be used as the layer data. A <code>function</code> can be created
from a <code>formula</code> (e.g. <code>~ head(.x, 10)</code>).</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_geom">geom</code></td>
<td>
<p>The geometric object to use display the data; override the
default.</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string naming the adjustment
(e.g. <code>"jitter"</code> to use <code>position_jitter</code>), or the result of a call to a
position adjustment function. Use the latter if you need to change the
settings of the adjustment.</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_decreasing">decreasing</code></td>
<td>
<p>Logical; whether to arrange the strata at each axis in the
order of the variable values (<code>NA</code>, the default), in ascending order of
totals (largest on top, <code>FALSE</code>), or in descending order of totals (largest
on bottom, <code>TRUE</code>).</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_reverse">reverse</code></td>
<td>
<p>Logical; if <code>decreasing</code> is <code>NA</code>, whether to arrange the
strata at each axis in the reverse order of the variable values, so that
they match the order of the values in the legend. Ignored if <code>decreasing</code>
is not <code>NA</code>. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_absolute">absolute</code></td>
<td>
<p>Logical; if some cases or strata are negative, whether to
arrange them (respecting <code>decreasing</code> and <code>reverse</code>) using negative or
absolute values of <code>y</code>.</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_discern">discern</code></td>
<td>
<p>Passed to <code><a href="#topic+to_lodes_form">to_lodes_form()</a></code> if <code>data</code> is in alluvia format.</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_negate.strata">negate.strata</code></td>
<td>
<p>A vector of values of the <code>stratum</code> aesthetic to be
treated as negative (will ignore missing values with a warning).</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_aggregate.y">aggregate.y</code></td>
<td>
<p>Deprecated alias for <code>cement.alluvia</code>.</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_cement.alluvia">cement.alluvia</code></td>
<td>
<p>Logical value indicating whether to aggregate <code>y</code>
values over equivalent alluvia before computing lode and flow positions.</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_lode.guidance">lode.guidance</code></td>
<td>
<p>The function to prioritize the axis variables for
ordering the lodes within each stratum, or else a character string
identifying the function. Character options are &quot;zigzag&quot;, &quot;frontback&quot;,
&quot;backfront&quot;, &quot;forward&quot;, and &quot;backward&quot; (see <code><a href="#topic+lode-guidance-functions">lode-guidance-functions</a></code>).</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_lode.ordering">lode.ordering</code></td>
<td>
<p><strong>Deprecated in favor of the <code>order</code> aesthetic.</strong> A list
(of length the number of axes) of integer vectors (each of length the
number of rows of <code>data</code>) or NULL entries (indicating no imposed ordering),
or else a numeric matrix of corresponding dimensions, giving the preferred
ordering of alluvia at each axis. This will be used to order the lodes
within each stratum by sorting the lodes first by stratum, then by the
provided vectors, and lastly by remaining factors (if the vectors contain
duplicate entries and therefore do not completely determine the lode
orderings).</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_aes.bind">aes.bind</code></td>
<td>
<p>At what grouping level, if any, to prioritize differentiation
aesthetics when ordering the lodes within each stratum. Defaults to
<code>"none"</code> (no aesthetic binding) with intermediate option <code>"flows"</code> to bind
aesthetics after stratifying by axes linked to the index axis (the one
adjacent axis in <code>stat_flow()</code>; all remaining axes in <code>stat_alluvium()</code>)
and strongest option <code>"alluvia"</code> to bind aesthetics after stratifying by
the index axis but before stratifying by linked axes (only available for
<code>stat_alluvium()</code>). Stratification by any axis is done with respect to the
strata at that axis, after separating positive and negative strata,
consistent with the values of <code>decreasing</code>, <code>reverse</code>, and <code>absolute</code>.
Thus, if <code>"none"</code>, then lode orderings will not depend on aesthetic
variables. All aesthetic variables are used, in the order in which they are
specified in <code>aes()</code>.</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_infer.label">infer.label</code></td>
<td>
<p>Logical; whether to assign the <code>stratum</code> or <code>alluvium</code>
variable to the <code>label</code> aesthetic. Defaults to <code>FALSE</code>, and requires that
no <code>label</code> aesthetic is assigned. This parameter is intended for use only
with data in alluva form, which are converted to lode form before the
statistical transformation. Deprecated; use
<code><a href="ggplot2.html#topic+aes_eval">ggplot2::after_stat()</a></code> instead.</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_min.y">min.y</code>, <code id="stat_alluvium_+3A_max.y">max.y</code></td>
<td>
<p>Numeric; bounds on the heights of the strata to be
rendered. Use these bounds to exclude strata outside a certain range, for
example when labeling strata using <code><a href="ggplot2.html#topic+geom_text">ggplot2::geom_text()</a></code>.</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_na.rm">na.rm</code></td>
<td>
<p>Logical:
if <code>FALSE</code>, the default, <code>NA</code> lodes are not included;
if <code>TRUE</code>, <code>NA</code> lodes constitute a separate category,
plotted in grey (regardless of the color scheme).</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</td></tr>
<tr><td><code id="stat_alluvium_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code>.</p>
</td></tr>
</table>


<h3>Aesthetics</h3>

<p><code>stat_alluvium</code>, <code>stat_flow</code>, and <code>stat_stratum</code> require one
of two sets of aesthetics:
</p>

<ul>
<li> <p><strong><code>x</code></strong> and at least one of <strong><code>alluvium</code></strong> and <strong><code>stratum</code></strong>
</p>
</li>
<li><p> any number of <strong><code style="white-space: pre;">&#8288;axis[0-9]*&#8288;</code></strong> (<code>axis1</code>, <code>axis2</code>, etc.)
</p>
</li></ul>

<p>Use <code>x</code>, <code>alluvium</code>, and/or <code>stratum</code> for data in lodes format
and <code style="white-space: pre;">&#8288;axis[0-9]*&#8288;</code> for data in alluvia format (see <code><a href="#topic+alluvial-data">alluvial-data</a></code>).
Arguments to parameters inconsistent with the format will be ignored.
Additionally, each <code style="white-space: pre;">&#8288;stat_*()&#8288;</code> accepts the following optional
aesthetics:
</p>

<ul>
<li> <p><code>y</code>
</p>
</li>
<li> <p><code>weight</code>
</p>
</li>
<li> <p><code>order</code>
</p>
</li>
<li> <p><code>group</code>
</p>
</li>
<li> <p><code>label</code>
</p>
</li></ul>

<p><code>y</code> controls the heights of the alluvia,
and may be aggregated across equivalent observations.
<code>weight</code> applies to the computed variables (see that section below)
but does not affect the positional aesthetics.
<code>order</code>, recognized by <code>stat_alluvium()</code> and <code>stat_flow()</code>, is used to
arrange the lodes within each stratum. It tolerates duplicates and takes
precedence over the differentiation aesthetics (when <code>aes.bind</code> is not
<code>"none"</code>) and lode guidance with respect to the remaining axes. (It replaces
the deprecated parameter <code>lode.ordering</code>.)
<code>group</code> is used internally; arguments are ignored.
<code>label</code> is used to label the strata or lodes and must take a unique value
across the observations within each stratum or lode.
</p>
<p>These and any other aesthetics are aggregated as follows:
Numeric aesthetics, including <code>y</code>, are summed.
Character and factor aesthetics, including <code>label</code>,
are assigned to strata or lodes provided they take unique values across the
observations within each (and are otherwise assigned <code>NA</code>).
</p>


<h3>Computed variables</h3>

<p>These can be used with
<code><a href="ggplot2.html#topic+aes_eval">ggplot2::after_stat()</a></code> to <a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">control aesthetic evaluation</a>.
</p>

<dl>
<dt><code>n</code></dt><dd><p>number of cases in lode</p>
</dd>
<dt><code>count</code></dt><dd><p>cumulative weight of lode</p>
</dd>
<dt><code>prop</code></dt><dd><p>weighted proportion of lode</p>
</dd>
<dt><code>stratum</code></dt><dd><p>value of variable used to define strata</p>
</dd>
<dt><code>deposit</code></dt><dd><p>order in which (signed) strata are deposited</p>
</dd>
<dt><code>lode</code></dt><dd><p>lode label distilled from alluvia
(<code>stat_alluvium()</code> and <code>stat_flow()</code> only)</p>
</dd>
<dt><code>flow</code></dt><dd><p>direction of flow <code>"to"</code> or <code>"from"</code> from its axis
(<code>stat_flow()</code> only)</p>
</dd>
</dl>

<p>The numerical variables <code>n</code>, <code>count</code>, and <code>prop</code> are calculated after the
data are grouped by <code>x</code> and weighted by <code>weight</code> (in addition to <code>y</code>).
The integer variable <code>deposit</code> is used internally to sort the data before
calculating heights. The character variable <code>lode</code> is obtained from
<code>alluvium</code> according to <code>distill</code>.
</p>


<h3>Package options</h3>

<p><code>stat_stratum</code>, <code>stat_alluvium</code>, and <code>stat_flow</code> order strata and lodes
according to the values of several parameters, which must be held fixed
across every layer in an alluvial plot. These package-specific options set
global values for these parameters that will be defaulted to when not
manually set:
</p>

<ul>
<li> <p><code>ggalluvial.decreasing</code> (each <code style="white-space: pre;">&#8288;stat_*&#8288;</code>): defaults to <code>NA</code>.
</p>
</li>
<li> <p><code>ggalluvial.reverse</code> (each <code style="white-space: pre;">&#8288;stat_*&#8288;</code>): defaults to <code>TRUE</code>.
</p>
</li>
<li> <p><code>ggalluvial.absolute</code> (each <code style="white-space: pre;">&#8288;stat_*&#8288;</code>): defaults to <code>TRUE</code>.
</p>
</li>
<li> <p><code>ggalluvial.cement.alluvia</code> (<code>stat_alluvium</code>): defaults to <code>FALSE</code>.
</p>
</li>
<li> <p><code>ggalluvial.lode.guidance</code> (<code>stat_alluvium</code>): defaults to <code>"zigzag"</code>.
</p>
</li>
<li> <p><code>ggalluvial.aes.bind</code> (<code>stat_alluvium</code> and <code>stat_flow</code>): defaults to
<code>"none"</code>.
</p>
</li></ul>

<p>See <code><a href="base.html#topic+options">base::options()</a></code> for how to use options.
</p>


<h3>Defunct parameters</h3>

<p>The previously defunct parameters <code>weight</code> and <code>aggregate.wts</code> have been
discontinued. Use <code>y</code> and <code>cement.alluvia</code> instead.
</p>


<h3>See Also</h3>

<p><code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code> for additional arguments and <code><a href="#topic+geom_alluvium">geom_alluvium()</a></code>,
<code><a href="#topic+geom_lode">geom_lode()</a></code>, and <code><a href="#topic+geom_flow">geom_flow()</a></code> for the corresponding geoms.
</p>
<p>Other alluvial stat layers: 
<code><a href="#topic+stat_flow">stat_flow</a>()</code>,
<code><a href="#topic+stat_stratum">stat_stratum</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># illustrate positioning
ggplot(as.data.frame(Titanic),
       aes(y = Freq,
           axis1 = Class, axis2 = Sex, axis3 = Age,
           color = Survived)) +
  stat_stratum(geom = "errorbar") +
  geom_line(stat = "alluvium") +
  stat_alluvium(geom = "pointrange") +
  geom_text(stat = "stratum", aes(label = after_stat(stratum))) +
  scale_x_discrete(limits = c("Class", "Sex", "Age"))

# lode ordering examples
gg &lt;- ggplot(as.data.frame(Titanic),
             aes(y = Freq,
                 axis1 = Class, axis2 = Sex, axis3 = Age)) +
  geom_stratum() +
  geom_text(stat = "stratum", aes(label = after_stat(stratum))) +
  scale_x_discrete(limits = c("Class", "Sex", "Age"))
# use of lode controls
gg + geom_flow(aes(fill = Survived, alpha = Sex), stat = "alluvium",
               lode.guidance = "forward")
# prioritize aesthetic binding
gg + geom_flow(aes(fill = Survived, alpha = Sex), stat = "alluvium",
               aes.bind = "alluvia", lode.guidance = "forward")
# use of custom lode order
gg + geom_flow(aes(fill = Survived, alpha = Sex, order = sample(x = 32)),
               stat = "alluvium")
# use of custom luide guidance function
lode_custom &lt;- function(n, i) {
  stopifnot(n == 3)
  switch(
    i,
    `1` = 1:3,
    `2` = c(2, 3, 1),
    `3` = 3:1
  )
}
gg + geom_flow(aes(fill = Survived, alpha = Sex), stat = "alluvium",
               aes.bind = "flow", lode.guidance = lode_custom)

# omit missing elements &amp; reverse the `y` axis
ggplot(ggalluvial::majors,
       aes(x = semester, stratum = curriculum, alluvium = student, y = 1)) +
  geom_alluvium(fill = "darkgrey", na.rm = TRUE) +
  geom_stratum(aes(fill = curriculum), color = NA, na.rm = TRUE) +
  theme_bw() +
  scale_y_reverse()


# alluvium cementation examples
gg &lt;- ggplot(ggalluvial::majors,
             aes(x = semester, stratum = curriculum, alluvium = student,
                 fill = curriculum)) +
  geom_stratum()
# diagram with outlined alluvia and labels
gg + geom_flow(stat = "alluvium", color = "black") +
  geom_text(aes(label = after_stat(lode)), stat = "alluvium")
# cemented diagram with default distillation (first most common alluvium)
gg +
  geom_flow(stat = "alluvium", color = "black", cement.alluvia = TRUE) +
  geom_text(aes(label = after_stat(lode)), stat = "alluvium",
            cement.alluvia = TRUE)
# cemented diagram with custom label distillation
gg +
  geom_flow(stat = "alluvium", color = "black", cement.alluvia = TRUE) +
  geom_text(aes(label = after_stat(lode)), stat = "alluvium",
            cement.alluvia = TRUE,
            distill = function(x) paste(x, collapse = "; "))



data(babynames, package = "babynames")
# a discontiguous alluvium
bn &lt;- subset(babynames, prop &gt;= .01 &amp; sex == "F" &amp; year &gt; 1962 &amp; year &lt; 1968)
ggplot(data = bn,
       aes(x = year, alluvium = name, y = prop)) +
  geom_alluvium(aes(fill = name, color = name == "Tammy"),
                decreasing = TRUE, show.legend = FALSE) +
  scale_color_manual(values = c("#00000000", "#000000"))
# expanded to include missing values
bn2 &lt;- merge(bn,
             expand.grid(year = unique(bn$year), name = unique(bn$name)),
             all = TRUE)
ggplot(data = bn2,
       aes(x = year, alluvium = name, y = prop)) +
  geom_alluvium(aes(fill = name, color = name == "Tammy"),
                decreasing = TRUE, show.legend = FALSE) +
  scale_color_manual(values = c("#00000000", "#000000"))
# with missing values filled in with zeros
bn2$prop[is.na(bn2$prop)] &lt;- 0
ggplot(data = bn2,
       aes(x = year, alluvium = name, y = prop)) +
  geom_alluvium(aes(fill = name, color = name == "Tammy"),
                decreasing = TRUE, show.legend = FALSE) +
  scale_color_manual(values = c("#00000000", "#000000"))


# use negative y values to encode deaths versus survivals
titanic &lt;- as.data.frame(Titanic)
titanic &lt;- transform(titanic, Lives = Freq * (-1) ^ (Survived == "No"))
ggplot(subset(titanic, Class != "Crew"),
       aes(axis1 = Class, axis2 = Sex, axis3 = Age, y = Lives)) +
  geom_alluvium(aes(alpha = Survived, fill = Class), absolute = FALSE) +
  geom_stratum(absolute = FALSE) +
  geom_text(stat = "stratum", aes(label = after_stat(stratum)),
            absolute = FALSE) +
  scale_x_discrete(limits = c("Class", "Sex", "Age"), expand = c(.1, .05)) +
  scale_alpha_discrete(range = c(.25, .75), guide = "none")

# faceting with common alluvia
ggplot(titanic, aes(y = Freq, axis1 = Class, axis2 = Sex, axis3 = Age)) +
  facet_wrap(~ Survived) +
  geom_alluvium() +
  geom_stratum() +
  geom_text(stat = "stratum", aes(label = after_stat(stratum)))
ggplot(transform(alluvial::Refugees, id = 1),
       aes(y = refugees, x = year, alluvium = id)) +
  facet_wrap(~ country) +
  geom_alluvium(alpha = .75, color = "darkgrey") +
  scale_x_continuous(breaks = seq(2004, 2012, 4))
</code></pre>

<hr>
<h2 id='stat_flow'>Flow positions</h2><span id='topic+stat_flow'></span>

<h3>Description</h3>

<p>Given a dataset with alluvial structure, <code>stat_flow</code> calculates the centroids
(<code>x</code> and <code>y</code>) and heights (<code>ymin</code> and <code>ymax</code>) of the flows between each pair
of adjacent axes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stat_flow(
  mapping = NULL,
  data = NULL,
  geom = "flow",
  position = "identity",
  decreasing = NULL,
  reverse = NULL,
  absolute = NULL,
  discern = FALSE,
  negate.strata = NULL,
  aes.bind = NULL,
  infer.label = FALSE,
  min.y = NULL,
  max.y = NULL,
  na.rm = FALSE,
  show.legend = NA,
  inherit.aes = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stat_flow_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code>. If specified and
<code>inherit.aes = TRUE</code> (the default), it is combined with the default mapping
at the top level of the plot. You must supply <code>mapping</code> if there is no plot
mapping.</p>
</td></tr>
<tr><td><code id="stat_flow_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame</code>, and
will be used as the layer data. A <code>function</code> can be created
from a <code>formula</code> (e.g. <code>~ head(.x, 10)</code>).</p>
</td></tr>
<tr><td><code id="stat_flow_+3A_geom">geom</code></td>
<td>
<p>The geometric object to use display the data; override the
default.</p>
</td></tr>
<tr><td><code id="stat_flow_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string naming the adjustment
(e.g. <code>"jitter"</code> to use <code>position_jitter</code>), or the result of a call to a
position adjustment function. Use the latter if you need to change the
settings of the adjustment.</p>
</td></tr>
<tr><td><code id="stat_flow_+3A_decreasing">decreasing</code></td>
<td>
<p>Logical; whether to arrange the strata at each axis in the
order of the variable values (<code>NA</code>, the default), in ascending order of
totals (largest on top, <code>FALSE</code>), or in descending order of totals (largest
on bottom, <code>TRUE</code>).</p>
</td></tr>
<tr><td><code id="stat_flow_+3A_reverse">reverse</code></td>
<td>
<p>Logical; if <code>decreasing</code> is <code>NA</code>, whether to arrange the
strata at each axis in the reverse order of the variable values, so that
they match the order of the values in the legend. Ignored if <code>decreasing</code>
is not <code>NA</code>. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="stat_flow_+3A_absolute">absolute</code></td>
<td>
<p>Logical; if some cases or strata are negative, whether to
arrange them (respecting <code>decreasing</code> and <code>reverse</code>) using negative or
absolute values of <code>y</code>.</p>
</td></tr>
<tr><td><code id="stat_flow_+3A_discern">discern</code></td>
<td>
<p>Passed to <code><a href="#topic+to_lodes_form">to_lodes_form()</a></code> if <code>data</code> is in alluvia format.</p>
</td></tr>
<tr><td><code id="stat_flow_+3A_negate.strata">negate.strata</code></td>
<td>
<p>A vector of values of the <code>stratum</code> aesthetic to be
treated as negative (will ignore missing values with a warning).</p>
</td></tr>
<tr><td><code id="stat_flow_+3A_aes.bind">aes.bind</code></td>
<td>
<p>At what grouping level, if any, to prioritize differentiation
aesthetics when ordering the lodes within each stratum. Defaults to
<code>"none"</code> (no aesthetic binding) with intermediate option <code>"flows"</code> to bind
aesthetics after stratifying by axes linked to the index axis (the one
adjacent axis in <code>stat_flow()</code>; all remaining axes in <code>stat_alluvium()</code>)
and strongest option <code>"alluvia"</code> to bind aesthetics after stratifying by
the index axis but before stratifying by linked axes (only available for
<code>stat_alluvium()</code>). Stratification by any axis is done with respect to the
strata at that axis, after separating positive and negative strata,
consistent with the values of <code>decreasing</code>, <code>reverse</code>, and <code>absolute</code>.
Thus, if <code>"none"</code>, then lode orderings will not depend on aesthetic
variables. All aesthetic variables are used, in the order in which they are
specified in <code>aes()</code>.</p>
</td></tr>
<tr><td><code id="stat_flow_+3A_infer.label">infer.label</code></td>
<td>
<p>Logical; whether to assign the <code>stratum</code> or <code>alluvium</code>
variable to the <code>label</code> aesthetic. Defaults to <code>FALSE</code>, and requires that
no <code>label</code> aesthetic is assigned. This parameter is intended for use only
with data in alluva form, which are converted to lode form before the
statistical transformation. Deprecated; use
<code><a href="ggplot2.html#topic+aes_eval">ggplot2::after_stat()</a></code> instead.</p>
</td></tr>
<tr><td><code id="stat_flow_+3A_min.y">min.y</code>, <code id="stat_flow_+3A_max.y">max.y</code></td>
<td>
<p>Numeric; bounds on the heights of the strata to be
rendered. Use these bounds to exclude strata outside a certain range, for
example when labeling strata using <code><a href="ggplot2.html#topic+geom_text">ggplot2::geom_text()</a></code>.</p>
</td></tr>
<tr><td><code id="stat_flow_+3A_na.rm">na.rm</code></td>
<td>
<p>Logical:
if <code>FALSE</code>, the default, <code>NA</code> lodes are not included;
if <code>TRUE</code>, <code>NA</code> lodes constitute a separate category,
plotted in grey (regardless of the color scheme).</p>
</td></tr>
<tr><td><code id="stat_flow_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="stat_flow_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</td></tr>
<tr><td><code id="stat_flow_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code>.</p>
</td></tr>
</table>


<h3>Aesthetics</h3>

<p><code>stat_alluvium</code>, <code>stat_flow</code>, and <code>stat_stratum</code> require one
of two sets of aesthetics:
</p>

<ul>
<li> <p><strong><code>x</code></strong> and at least one of <strong><code>alluvium</code></strong> and <strong><code>stratum</code></strong>
</p>
</li>
<li><p> any number of <strong><code style="white-space: pre;">&#8288;axis[0-9]*&#8288;</code></strong> (<code>axis1</code>, <code>axis2</code>, etc.)
</p>
</li></ul>

<p>Use <code>x</code>, <code>alluvium</code>, and/or <code>stratum</code> for data in lodes format
and <code style="white-space: pre;">&#8288;axis[0-9]*&#8288;</code> for data in alluvia format (see <code><a href="#topic+alluvial-data">alluvial-data</a></code>).
Arguments to parameters inconsistent with the format will be ignored.
Additionally, each <code style="white-space: pre;">&#8288;stat_*()&#8288;</code> accepts the following optional
aesthetics:
</p>

<ul>
<li> <p><code>y</code>
</p>
</li>
<li> <p><code>weight</code>
</p>
</li>
<li> <p><code>order</code>
</p>
</li>
<li> <p><code>group</code>
</p>
</li>
<li> <p><code>label</code>
</p>
</li></ul>

<p><code>y</code> controls the heights of the alluvia,
and may be aggregated across equivalent observations.
<code>weight</code> applies to the computed variables (see that section below)
but does not affect the positional aesthetics.
<code>order</code>, recognized by <code>stat_alluvium()</code> and <code>stat_flow()</code>, is used to
arrange the lodes within each stratum. It tolerates duplicates and takes
precedence over the differentiation aesthetics (when <code>aes.bind</code> is not
<code>"none"</code>) and lode guidance with respect to the remaining axes. (It replaces
the deprecated parameter <code>lode.ordering</code>.)
<code>group</code> is used internally; arguments are ignored.
<code>label</code> is used to label the strata or lodes and must take a unique value
across the observations within each stratum or lode.
</p>
<p>These and any other aesthetics are aggregated as follows:
Numeric aesthetics, including <code>y</code>, are summed.
Character and factor aesthetics, including <code>label</code>,
are assigned to strata or lodes provided they take unique values across the
observations within each (and are otherwise assigned <code>NA</code>).
</p>


<h3>Computed variables</h3>

<p>These can be used with
<code><a href="ggplot2.html#topic+aes_eval">ggplot2::after_stat()</a></code> to <a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">control aesthetic evaluation</a>.
</p>

<dl>
<dt><code>n</code></dt><dd><p>number of cases in lode</p>
</dd>
<dt><code>count</code></dt><dd><p>cumulative weight of lode</p>
</dd>
<dt><code>prop</code></dt><dd><p>weighted proportion of lode</p>
</dd>
<dt><code>stratum</code></dt><dd><p>value of variable used to define strata</p>
</dd>
<dt><code>deposit</code></dt><dd><p>order in which (signed) strata are deposited</p>
</dd>
<dt><code>lode</code></dt><dd><p>lode label distilled from alluvia
(<code>stat_alluvium()</code> and <code>stat_flow()</code> only)</p>
</dd>
<dt><code>flow</code></dt><dd><p>direction of flow <code>"to"</code> or <code>"from"</code> from its axis
(<code>stat_flow()</code> only)</p>
</dd>
</dl>

<p>The numerical variables <code>n</code>, <code>count</code>, and <code>prop</code> are calculated after the
data are grouped by <code>x</code> and weighted by <code>weight</code> (in addition to <code>y</code>).
The integer variable <code>deposit</code> is used internally to sort the data before
calculating heights. The character variable <code>lode</code> is obtained from
<code>alluvium</code> according to <code>distill</code>.
</p>


<h3>Package options</h3>

<p><code>stat_stratum</code>, <code>stat_alluvium</code>, and <code>stat_flow</code> order strata and lodes
according to the values of several parameters, which must be held fixed
across every layer in an alluvial plot. These package-specific options set
global values for these parameters that will be defaulted to when not
manually set:
</p>

<ul>
<li> <p><code>ggalluvial.decreasing</code> (each <code style="white-space: pre;">&#8288;stat_*&#8288;</code>): defaults to <code>NA</code>.
</p>
</li>
<li> <p><code>ggalluvial.reverse</code> (each <code style="white-space: pre;">&#8288;stat_*&#8288;</code>): defaults to <code>TRUE</code>.
</p>
</li>
<li> <p><code>ggalluvial.absolute</code> (each <code style="white-space: pre;">&#8288;stat_*&#8288;</code>): defaults to <code>TRUE</code>.
</p>
</li>
<li> <p><code>ggalluvial.cement.alluvia</code> (<code>stat_alluvium</code>): defaults to <code>FALSE</code>.
</p>
</li>
<li> <p><code>ggalluvial.lode.guidance</code> (<code>stat_alluvium</code>): defaults to <code>"zigzag"</code>.
</p>
</li>
<li> <p><code>ggalluvial.aes.bind</code> (<code>stat_alluvium</code> and <code>stat_flow</code>): defaults to
<code>"none"</code>.
</p>
</li></ul>

<p>See <code><a href="base.html#topic+options">base::options()</a></code> for how to use options.
</p>


<h3>Defunct parameters</h3>

<p>The previously defunct parameters <code>weight</code> and <code>aggregate.wts</code> have been
discontinued. Use <code>y</code> and <code>cement.alluvia</code> instead.
</p>


<h3>See Also</h3>

<p><code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code> for additional arguments and
<code><a href="#topic+geom_alluvium">geom_alluvium()</a></code> and
<code><a href="#topic+geom_flow">geom_flow()</a></code> for the corresponding geoms.
</p>
<p>Other alluvial stat layers: 
<code><a href="#topic+stat_alluvium">stat_alluvium</a>()</code>,
<code><a href="#topic+stat_stratum">stat_stratum</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># illustrate positioning
ggplot(as.data.frame(Titanic),
       aes(y = Freq,
           axis1 = Class, axis2 = Sex, axis3 = Age,
           color = Survived)) +
  stat_stratum(geom = "errorbar") +
  geom_line(stat = "flow") +
  stat_flow(geom = "pointrange") +
  geom_text(stat = "stratum", aes(label = after_stat(stratum))) +
  scale_x_discrete(limits = c("Class", "Sex", "Age"))

# alluvium--flow comparison
data(vaccinations)
gg &lt;- ggplot(vaccinations,
             aes(x = survey, stratum = response, alluvium = subject,
                 y = freq, fill = response)) +
  geom_stratum(alpha = .5) +
  geom_text(aes(label = response), stat = "stratum")
# rightward alluvial aesthetics for vaccine survey data
gg + geom_flow(stat = "alluvium", lode.guidance = "forward")
# memoryless flows for vaccine survey data
gg + geom_flow()

# size filter examples
gg &lt;- ggplot(vaccinations,
       aes(y = freq,
           x = survey, stratum = response, alluvium = subject,
           fill = response, label = response)) +
  stat_stratum(alpha = .5) +
  geom_text(stat = "stratum")
# omit small flows
gg + geom_flow(min.y = 50)
# omit large flows
gg + geom_flow(max.y = 100)

# negate missing entries
ggplot(vaccinations,
       aes(y = freq,
           x = survey, stratum = response, alluvium = subject,
           fill = response, label = response,
           alpha = response != "Missing")) +
  stat_stratum(negate.strata = "Missing") +
  geom_flow(negate.strata = "Missing") +
  geom_text(stat = "stratum", alpha = 1, negate.strata = "Missing") +
  scale_alpha_discrete(range = c(.2, .6)) +
  guides(alpha = "none")


# aesthetics that vary betwween and within strata
data(vaccinations)
vaccinations$subgroup &lt;- LETTERS[1:2][rbinom(
  n = length(unique(vaccinations$subject)), size = 1, prob = .5
) + 1][vaccinations$subject]
ggplot(vaccinations,
       aes(x = survey, stratum = response, alluvium = subject,
           y = freq, fill = response, label = response)) +
  geom_flow(aes(alpha = subgroup)) +
  scale_alpha_discrete(range = c(1/3, 2/3)) +
  geom_stratum(alpha = .5) +
  geom_text(stat = "stratum")
# can even set aesthetics that vary both ways
ggplot(vaccinations,
       aes(x = survey, stratum = response, alluvium = subject,
           y = freq, label = response)) +
  geom_flow(aes(fill = interaction(response, subgroup)), aes.bind = "flows") +
  scale_alpha_discrete(range = c(1/3, 2/3)) +
  geom_stratum(alpha = .5) +
  geom_text(stat = "stratum")

</code></pre>

<hr>
<h2 id='stat_stratum'>Stratum positions</h2><span id='topic+stat_stratum'></span>

<h3>Description</h3>

<p>Given a dataset with alluvial structure, <code>stat_stratum</code> calculates the
centroids (<code>x</code> and <code>y</code>) and heights (<code>ymin</code> and <code>ymax</code>) of the strata at each
axis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stat_stratum(
  mapping = NULL,
  data = NULL,
  geom = "stratum",
  position = "identity",
  decreasing = NULL,
  reverse = NULL,
  absolute = NULL,
  discern = FALSE,
  distill = "first",
  negate.strata = NULL,
  infer.label = FALSE,
  label.strata = NULL,
  min.y = NULL,
  max.y = NULL,
  min.height = NULL,
  max.height = NULL,
  na.rm = FALSE,
  show.legend = NA,
  inherit.aes = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stat_stratum_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code>. If specified and
<code>inherit.aes = TRUE</code> (the default), it is combined with the default mapping
at the top level of the plot. You must supply <code>mapping</code> if there is no plot
mapping.</p>
</td></tr>
<tr><td><code id="stat_stratum_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame</code>, and
will be used as the layer data. A <code>function</code> can be created
from a <code>formula</code> (e.g. <code>~ head(.x, 10)</code>).</p>
</td></tr>
<tr><td><code id="stat_stratum_+3A_geom">geom</code></td>
<td>
<p>The geometric object to use display the data; override the
default.</p>
</td></tr>
<tr><td><code id="stat_stratum_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string naming the adjustment
(e.g. <code>"jitter"</code> to use <code>position_jitter</code>), or the result of a call to a
position adjustment function. Use the latter if you need to change the
settings of the adjustment.</p>
</td></tr>
<tr><td><code id="stat_stratum_+3A_decreasing">decreasing</code></td>
<td>
<p>Logical; whether to arrange the strata at each axis in the
order of the variable values (<code>NA</code>, the default), in ascending order of
totals (largest on top, <code>FALSE</code>), or in descending order of totals (largest
on bottom, <code>TRUE</code>).</p>
</td></tr>
<tr><td><code id="stat_stratum_+3A_reverse">reverse</code></td>
<td>
<p>Logical; if <code>decreasing</code> is <code>NA</code>, whether to arrange the
strata at each axis in the reverse order of the variable values, so that
they match the order of the values in the legend. Ignored if <code>decreasing</code>
is not <code>NA</code>. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="stat_stratum_+3A_absolute">absolute</code></td>
<td>
<p>Logical; if some cases or strata are negative, whether to
arrange them (respecting <code>decreasing</code> and <code>reverse</code>) using negative or
absolute values of <code>y</code>.</p>
</td></tr>
<tr><td><code id="stat_stratum_+3A_discern">discern</code></td>
<td>
<p>Passed to <code><a href="#topic+to_lodes_form">to_lodes_form()</a></code> if <code>data</code> is in alluvia format.</p>
</td></tr>
<tr><td><code id="stat_stratum_+3A_distill">distill</code></td>
<td>
<p>A function (or its name) to be used to distill alluvium values
to a single lode label, accessible via
<code><a href="ggplot2.html#topic+aes_eval">ggplot2::after_stat()</a></code> (similar to its behavior in
<code><a href="#topic+to_alluvia_form">to_alluvia_form()</a></code>). It recognizes three character values: <code>"first"</code> (the
default) and <code>"last"</code> <a href="dplyr.html#topic+nth">as defined</a> in <strong>dplyr</strong>; and <code>"most"</code>
(which returns the first modal value).</p>
</td></tr>
<tr><td><code id="stat_stratum_+3A_negate.strata">negate.strata</code></td>
<td>
<p>A vector of values of the <code>stratum</code> aesthetic to be
treated as negative (will ignore missing values with a warning).</p>
</td></tr>
<tr><td><code id="stat_stratum_+3A_infer.label">infer.label</code></td>
<td>
<p>Logical; whether to assign the <code>stratum</code> or <code>alluvium</code>
variable to the <code>label</code> aesthetic. Defaults to <code>FALSE</code>, and requires that
no <code>label</code> aesthetic is assigned. This parameter is intended for use only
with data in alluva form, which are converted to lode form before the
statistical transformation. Deprecated; use
<code><a href="ggplot2.html#topic+aes_eval">ggplot2::after_stat()</a></code> instead.</p>
</td></tr>
<tr><td><code id="stat_stratum_+3A_label.strata">label.strata</code></td>
<td>
<p>Defunct; alias for <code>infer.label</code>.</p>
</td></tr>
<tr><td><code id="stat_stratum_+3A_min.y">min.y</code>, <code id="stat_stratum_+3A_max.y">max.y</code></td>
<td>
<p>Numeric; bounds on the heights of the strata to be
rendered. Use these bounds to exclude strata outside a certain range, for
example when labeling strata using <code><a href="ggplot2.html#topic+geom_text">ggplot2::geom_text()</a></code>.</p>
</td></tr>
<tr><td><code id="stat_stratum_+3A_min.height">min.height</code>, <code id="stat_stratum_+3A_max.height">max.height</code></td>
<td>
<p>Deprecated aliases for <code>min.y</code> and <code>max.y</code>.</p>
</td></tr>
<tr><td><code id="stat_stratum_+3A_na.rm">na.rm</code></td>
<td>
<p>Logical:
if <code>FALSE</code>, the default, <code>NA</code> lodes are not included;
if <code>TRUE</code>, <code>NA</code> lodes constitute a separate category,
plotted in grey (regardless of the color scheme).</p>
</td></tr>
<tr><td><code id="stat_stratum_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="stat_stratum_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</td></tr>
<tr><td><code id="stat_stratum_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code>.</p>
</td></tr>
</table>


<h3>Aesthetics</h3>

<p><code>stat_alluvium</code>, <code>stat_flow</code>, and <code>stat_stratum</code> require one
of two sets of aesthetics:
</p>

<ul>
<li> <p><strong><code>x</code></strong> and at least one of <strong><code>alluvium</code></strong> and <strong><code>stratum</code></strong>
</p>
</li>
<li><p> any number of <strong><code style="white-space: pre;">&#8288;axis[0-9]*&#8288;</code></strong> (<code>axis1</code>, <code>axis2</code>, etc.)
</p>
</li></ul>

<p>Use <code>x</code>, <code>alluvium</code>, and/or <code>stratum</code> for data in lodes format
and <code style="white-space: pre;">&#8288;axis[0-9]*&#8288;</code> for data in alluvia format (see <code><a href="#topic+alluvial-data">alluvial-data</a></code>).
Arguments to parameters inconsistent with the format will be ignored.
Additionally, each <code style="white-space: pre;">&#8288;stat_*()&#8288;</code> accepts the following optional
aesthetics:
</p>

<ul>
<li> <p><code>y</code>
</p>
</li>
<li> <p><code>weight</code>
</p>
</li>
<li> <p><code>order</code>
</p>
</li>
<li> <p><code>group</code>
</p>
</li>
<li> <p><code>label</code>
</p>
</li></ul>

<p><code>y</code> controls the heights of the alluvia,
and may be aggregated across equivalent observations.
<code>weight</code> applies to the computed variables (see that section below)
but does not affect the positional aesthetics.
<code>order</code>, recognized by <code>stat_alluvium()</code> and <code>stat_flow()</code>, is used to
arrange the lodes within each stratum. It tolerates duplicates and takes
precedence over the differentiation aesthetics (when <code>aes.bind</code> is not
<code>"none"</code>) and lode guidance with respect to the remaining axes. (It replaces
the deprecated parameter <code>lode.ordering</code>.)
<code>group</code> is used internally; arguments are ignored.
<code>label</code> is used to label the strata or lodes and must take a unique value
across the observations within each stratum or lode.
</p>
<p>These and any other aesthetics are aggregated as follows:
Numeric aesthetics, including <code>y</code>, are summed.
Character and factor aesthetics, including <code>label</code>,
are assigned to strata or lodes provided they take unique values across the
observations within each (and are otherwise assigned <code>NA</code>).
</p>


<h3>Computed variables</h3>

<p>These can be used with
<code><a href="ggplot2.html#topic+aes_eval">ggplot2::after_stat()</a></code> to <a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">control aesthetic evaluation</a>.
</p>

<dl>
<dt><code>n</code></dt><dd><p>number of cases in lode</p>
</dd>
<dt><code>count</code></dt><dd><p>cumulative weight of lode</p>
</dd>
<dt><code>prop</code></dt><dd><p>weighted proportion of lode</p>
</dd>
<dt><code>stratum</code></dt><dd><p>value of variable used to define strata</p>
</dd>
<dt><code>deposit</code></dt><dd><p>order in which (signed) strata are deposited</p>
</dd>
<dt><code>lode</code></dt><dd><p>lode label distilled from alluvia
(<code>stat_alluvium()</code> and <code>stat_flow()</code> only)</p>
</dd>
<dt><code>flow</code></dt><dd><p>direction of flow <code>"to"</code> or <code>"from"</code> from its axis
(<code>stat_flow()</code> only)</p>
</dd>
</dl>

<p>The numerical variables <code>n</code>, <code>count</code>, and <code>prop</code> are calculated after the
data are grouped by <code>x</code> and weighted by <code>weight</code> (in addition to <code>y</code>).
The integer variable <code>deposit</code> is used internally to sort the data before
calculating heights. The character variable <code>lode</code> is obtained from
<code>alluvium</code> according to <code>distill</code>.
</p>


<h3>Package options</h3>

<p><code>stat_stratum</code>, <code>stat_alluvium</code>, and <code>stat_flow</code> order strata and lodes
according to the values of several parameters, which must be held fixed
across every layer in an alluvial plot. These package-specific options set
global values for these parameters that will be defaulted to when not
manually set:
</p>

<ul>
<li> <p><code>ggalluvial.decreasing</code> (each <code style="white-space: pre;">&#8288;stat_*&#8288;</code>): defaults to <code>NA</code>.
</p>
</li>
<li> <p><code>ggalluvial.reverse</code> (each <code style="white-space: pre;">&#8288;stat_*&#8288;</code>): defaults to <code>TRUE</code>.
</p>
</li>
<li> <p><code>ggalluvial.absolute</code> (each <code style="white-space: pre;">&#8288;stat_*&#8288;</code>): defaults to <code>TRUE</code>.
</p>
</li>
<li> <p><code>ggalluvial.cement.alluvia</code> (<code>stat_alluvium</code>): defaults to <code>FALSE</code>.
</p>
</li>
<li> <p><code>ggalluvial.lode.guidance</code> (<code>stat_alluvium</code>): defaults to <code>"zigzag"</code>.
</p>
</li>
<li> <p><code>ggalluvial.aes.bind</code> (<code>stat_alluvium</code> and <code>stat_flow</code>): defaults to
<code>"none"</code>.
</p>
</li></ul>

<p>See <code><a href="base.html#topic+options">base::options()</a></code> for how to use options.
</p>


<h3>Defunct parameters</h3>

<p>The previously defunct parameters <code>weight</code> and <code>aggregate.wts</code> have been
discontinued. Use <code>y</code> and <code>cement.alluvia</code> instead.
</p>


<h3>See Also</h3>

<p><code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code> for additional arguments and <code><a href="#topic+geom_stratum">geom_stratum()</a></code> for
the corresponding geom.
</p>
<p>Other alluvial stat layers: 
<code><a href="#topic+stat_alluvium">stat_alluvium</a>()</code>,
<code><a href="#topic+stat_flow">stat_flow</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(vaccinations)
# only `stratum` assignment is necessary to generate strata
ggplot(vaccinations,
       aes(y = freq,
           x = survey, stratum = response,
           fill = response)) +
  stat_stratum(width = .5)

# lode data, positioning with y labels
ggplot(vaccinations,
       aes(y = freq,
           x = survey, stratum = response, alluvium = subject,
           label = after_stat(count))) +
  stat_stratum(geom = "errorbar") +
  geom_text(stat = "stratum")
# alluvium data, positioning with stratum labels
ggplot(as.data.frame(Titanic),
       aes(y = Freq,
           axis1 = Class, axis2 = Sex, axis3 = Age, axis4 = Survived)) +
  geom_text(stat = "stratum", aes(label = after_stat(stratum))) +
  stat_stratum(geom = "errorbar") +
  scale_x_discrete(limits = c("Class", "Sex", "Age", "Survived"))

# omit labels for strata outside a y range
ggplot(vaccinations,
       aes(y = freq,
           x = survey, stratum = response,
           fill = response, label = response)) +
  stat_stratum(width = .5) +
  geom_text(stat = "stratum", min.y = 100)

# date-valued axis variables
ggplot(vaccinations,
       aes(x = end_date, y = freq, stratum = response, alluvium = subject,
           fill = response)) +
  stat_alluvium(geom = "flow", lode.guidance = "forward",
                width = 30) +
  stat_stratum(width = 30) +
  labs(x = "Survey date", y = "Number of respondents")

admissions &lt;- as.data.frame(UCBAdmissions)
admissions &lt;- transform(admissions, Count = Freq * (-1) ^ (Admit == "Rejected"))
# use negative y values to encode rejection versus acceptance
ggplot(admissions,
       aes(y = Count, axis1 = Dept, axis2 = Gender)) +
  geom_alluvium(aes(fill = Dept), width = 1/12) +
  geom_stratum(width = 1/12, fill = "black", color = "grey") +
  geom_label(stat = "stratum", aes(label = after_stat(stratum)), min.y = 200) +
  scale_x_discrete(limits = c("Department", "Gender"), expand = c(.05, .05))
# computed variable 'deposit' indicates order of each signed stratum
ggplot(admissions,
       aes(y = Count, axis1 = Dept, axis2 = Gender)) +
  geom_alluvium(aes(fill = Dept), width = 1/12) +
  geom_stratum(width = 1/12, fill = "black", color = "grey") +
  geom_text(stat = "stratum", aes(label = after_stat(deposit)),
            color = "white") +
  scale_x_discrete(limits = c("Department", "Gender"), expand = c(.05, .05))
# fixed-width strata with acceptance and rejection totals
ggplot(admissions,
       aes(y = sign(Count), weight = Count, axis1 = Dept, axis2 = Gender)) +
  geom_alluvium(aes(fill = Dept), width = 1/8) +
  geom_stratum(width = 1/8, fill = "black", color = "grey") +
  geom_text(stat = "stratum",
            aes(label = paste0(stratum,
                               ifelse(nchar(as.character(stratum)) == 1L,
                                      ": ", "\n"),
                               after_stat(n))),
            color = "white", size = 3) +
  scale_x_discrete(limits = c("Department", "Gender"), expand = c(.05, .05))
</code></pre>

<hr>
<h2 id='vaccinations'>Influenza vaccination survey responses</h2><span id='topic+vaccinations'></span>

<h3>Description</h3>

<p>This data set is aggregated from three RAND American Life Panel (ALP) surveys
that asked respondents their probability of vaccinating for influenza. Their
responses were discretized to &quot;Never&quot; (0%), &quot;Always&quot; (100%), or &quot;Sometimes&quot;
(any other value). After merging, missing responses were coded as &quot;Missing&quot;
and respondents were grouped and counted by all three coded responses. The
pre-processed data were kindly contributed by Raffaele Vardavas, and the
complete surveys are freely available at the ALP website.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vaccinations
</code></pre>


<h3>Format</h3>

<p>A data frame with 117 rows and 5 variables:
</p>

<dl>
<dt><code>freq</code></dt><dd><p>number of respondents represented in each row</p>
</dd>
<dt><code>subject</code></dt><dd><p>identifier linking respondents across surveys</p>
</dd>
<dt><code>survey</code></dt><dd><p>survey designation from the ALP website</p>
</dd>
<dt><code>start_date</code></dt><dd><p>start date of survey</p>
</dd>
<dt><code>end_date</code></dt><dd><p>end date of survey</p>
</dd>
<dt><code>response</code></dt><dd><p>discretized probability of vaccinating for influenza</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://alpdata.rand.org/">https://alpdata.rand.org/</a>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
