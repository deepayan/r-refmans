<!DOCTYPE html><html><head><title>Help for package RealVAMS</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {RealVAMS}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#example.outcome.data'>
<p>Simulated Data</p></a></li>
<li><a href='#example.score.data'>
<p>Simulated Data</p></a></li>
<li><a href='#plot'>
<p>Plot method for RealVAMS</p></a></li>
<li><a href='#print'>
<p>Print</p></a></li>
<li><a href='#R_mstep2'>
<p>Internal function</p></a></li>
<li><a href='#RealVAMS'>
<p>Multivariate VAM Fitting</p></a></li>
<li><a href='#RealVAMS-package'>
<p>Multivariate VAM Fitting</p></a></li>
<li><a href='#REML_Rm'>
<p>Internal function</p></a></li>
<li><a href='#summary'>
<p>Summary</p></a></li>
<li><a href='#vp_cp'>
<p>Internal function</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Multivariate VAM Fitting</td>
</tr>
<tr>
<td>Version:</td>
<td>0.4-5</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-01-06</td>
</tr>
<tr>
<td>Description:</td>
<td>Fits a multivariate value-added model (VAM), see Broatch, Green, and Karl (2018) &lt;<a href="https://doi.org/10.32614%2FRJ-2018-033">doi:10.32614/RJ-2018-033</a>&gt; and Broatch and Lohr (2012) &lt;<a href="https://doi.org/10.3102%2F1076998610396900">doi:10.3102/1076998610396900</a>&gt;, with normally distributed test scores and a binary outcome indicator. A pseudo-likelihood approach, Wolfinger (1993) &lt;<a href="https://doi.org/10.1080%2F00949659308811554">doi:10.1080/00949659308811554</a>&gt;, is used for the estimation of this joint generalized linear mixed model.  The inner loop of the pseudo-likelihood routine (estimation of a linear mixed model) occurs in the framework of the EM algorithm presented by Karl, Yang, and Lohr (2013) &lt;<a href="https://doi.org/10.1016%2Fj.csda.2012.10.004">doi:10.1016/j.csda.2012.10.004</a>&gt;. This material is based upon work supported by the National Science Foundation under grants DRL-1336027 and DRL-1336265.  </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.0.0), Matrix</td>
</tr>
<tr>
<td>Imports:</td>
<td>numDeriv, Rcpp (&ge; 0.11.2), methods, stats, utils, grDevices,
graphics</td>
</tr>
<tr>
<td>LazyData:</td>
<td>yes</td>
</tr>
<tr>
<td>ByteCompile:</td>
<td>yes</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-01-07 03:08:33 UTC; andre</td>
</tr>
<tr>
<td>Author:</td>
<td>Andrew Karl <a href="https://orcid.org/0000-0002-5933-8706"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [cre,
    aut],
  Jennifer Broatch [aut],
  Jennifer Green [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Andrew Karl &lt;akarl@asu.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-01-07 03:40:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='example.outcome.data'>
Simulated Data
</h2><span id='topic+example.outcome.data'></span>

<h3>Description</h3>

<p>A simulated data set used to illustrate the functionality of the package. This data set represents binary outcome measurements on 625 students (with one missing).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(example.outcome.data)</code></pre>


<h3>Format</h3>

<p>A data frame with 624 observations. The data set contains the following 2 variables.
</p>

<dl>
<dt><code>r</code></dt><dd><p>a numeric vector composed of 0's and 1's representing a binary outcome measured on students.</p>
</dd>
<dt><code>student</code></dt><dd><p>a numeric vector</p>
</dd>
</dl>



<h3>Details</h3>

<p>The data set may be reproduced with the following code.
</p>
<pre>
set.seed(0)                                                                                                                                                         
library(MASS)
#number of years: fixed at 3 for this code block
years&lt;-3   
#teacher in each year
teachers&lt;-25
#students in each class
students&lt;-25
alpha&lt;-.5
eta.stu.j &lt;- 
mvrnorm(n=teachers*students,mu=c(0,0),Sigma=cbind(c(5,.2),c(.2,.1)))
eta.stu&lt;-eta.stu.j[,1]
eta.stu.r&lt;-  eta.stu.j[,2]
z1&lt;-rep(1:teachers,each=students)
z2&lt;-sample(rep(1:teachers,each=students))
z3&lt;-sample(rep(1:teachers,each=students))
cont_var1&lt;-rnorm(students*teachers,0,.5)
cont_var2&lt;-rnorm(students*teachers,0,.5)
cont_var3&lt;-rnorm(students*teachers,0,.5)
gam &lt;- mvrnorm(n=teachers*years,mu=c(0,0),Sigma=cbind(c(5,.6),c(.6,.6)))
eps1&lt;- rnorm(students*teachers,0,sqrt(5))
eps2&lt;- rnorm(students*teachers,0,sqrt(5))
eps3&lt;- rnorm(students*teachers,0,sqrt(5))
gam1&lt;-gam[seq(1,teachers),1]
gam2&lt;-gam[seq((teachers+1),(2*teachers)),1]
gam3&lt;-gam[seq((2*teachers+1),(3*teachers)),1]
gam1.r&lt;-gam[seq(1,teachers),2]
gam2.r&lt;-gam[seq((teachers+1),(2*teachers)),2]
gam3.r&lt;-gam[seq((2*teachers+1),(3*teachers)),2]
y1&lt;-50+ eta.stu+gam1[z1]+cont_var1+eps1
y2&lt;-eta.stu+gam1[z1]*alpha+gam2[z2]+cont_var2+eps2
y3&lt;-100+eta.stu+gam1[z1]*alpha+gam2[z2]*alpha+gam3[z3]+cont_var3+eps3
r1&lt;-rbinom(students*teachers,1,
           pnorm(.1+eta.stu.r+gam1.r[z1]+gam2.r[z2]+gam3.r[z3]))
student&lt;-1:(students*teachers)
teacher&lt;-c(z1,z2,z3)
cont_var&lt;-c(cont_var1,cont_var2,cont_var3)
year&lt;-c(rep(1:3,each=students*teachers))
y&lt;-c(y1,y2,y3)
vam_data2&lt;-as.data.frame(cbind(student,teacher,year,y,cont_var))
vam_data2&lt;-vam_data2[order(vam_data2$student,vam_data2$year),]
example.score.data&lt;-vam_data2
vam_data2.r&lt;-as.data.frame(cbind(student,r=r1))
example.outcome.data&lt;-vam_data2.r
</pre>


<h3>Examples</h3>

<pre><code class='language-R'>data(example.outcome.data)
print(example.outcome.data[1,])
</code></pre>

<hr>
<h2 id='example.score.data'>
Simulated Data
</h2><span id='topic+example.score.data'></span>

<h3>Description</h3>

<p>A simulated data set used to illustrate the functionality of the package. The data are simulated according to the VP model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(example.score.data)</code></pre>


<h3>Format</h3>

<p>A data frame with 1874 observations on 625 students over 3 years, with 25 teachers in each year. The data set contains the following 5 variables.
</p>

<dl>
<dt><code>y</code></dt><dd><p>a numeric vector representing the student score</p>
</dd>
<dt><code>student</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>year</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>teacher</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>cont_var</code></dt><dd><p>a numeric vector representing a continuous covariate</p>
</dd>
</dl>



<h3>Details</h3>

<p>The data set may be reproduced with the following code.
</p>
<pre>
set.seed(0)                                                                                                                                                 
library(MASS)
#number of years: fixed at 3 for this code block
years&lt;-3   
#teacher in each year
teachers&lt;-25
#students in each class
students&lt;-25
alpha&lt;-.5
eta.stu.j &lt;-
mvrnorm(n=teachers*students,mu=c(0,0),Sigma=cbind(c(5,.2),c(.2,.1)))
eta.stu&lt;-eta.stu.j[,1]
eta.stu.r&lt;-  eta.stu.j[,2]
z1&lt;-rep(1:teachers,each=students)
z2&lt;-sample(rep(1:teachers,each=students))
z3&lt;-sample(rep(1:teachers,each=students))
cont_var1&lt;-rnorm(students*teachers,0,.5)
cont_var2&lt;-rnorm(students*teachers,0,.5)
cont_var3&lt;-rnorm(students*teachers,0,.5)
gam &lt;- mvrnorm(n=teachers*years,mu=c(0,0),Sigma=cbind(c(5,.6),c(.6,.6)))
eps1&lt;- rnorm(students*teachers,0,sqrt(5))
eps2&lt;- rnorm(students*teachers,0,sqrt(5))
eps3&lt;- rnorm(students*teachers,0,sqrt(5))
gam1&lt;-gam[seq(1,teachers),1]
gam2&lt;-gam[seq((teachers+1),(2*teachers)),1]
gam3&lt;-gam[seq((2*teachers+1),(3*teachers)),1]
gam1.r&lt;-gam[seq(1,teachers),2]
gam2.r&lt;-gam[seq((teachers+1),(2*teachers)),2]
gam3.r&lt;-gam[seq((2*teachers+1),(3*teachers)),2]
y1&lt;-50+ eta.stu+gam1[z1]+cont_var1+eps1
y2&lt;-eta.stu+gam1[z1]*alpha+gam2[z2]+cont_var2+eps2
y3&lt;-100+eta.stu+gam1[z1]*alpha+gam2[z2]*alpha+gam3[z3]+cont_var3+eps3
r1&lt;-rbinom(students*teachers,1,
           pnorm(.1+eta.stu.r+gam1.r[z1]+gam2.r[z2]+gam3.r[z3]))
student&lt;-1:(students*teachers)
teacher&lt;-c(z1,z2,z3)
cont_var&lt;-c(cont_var1,cont_var2,cont_var3)
year&lt;-c(rep(1:3,each=students*teachers))
y&lt;-c(y1,y2,y3)
vam_data2&lt;-as.data.frame(cbind(student,teacher,year,y,cont_var))
vam_data2&lt;-vam_data2[order(vam_data2$student,vam_data2$year),]
example.score.data&lt;-vam_data2
vam_data2.r&lt;-as.data.frame(cbind(student,r=r1))
example.outcome.data&lt;-vam_data2.r
</pre>


<h3>Examples</h3>

<pre><code class='language-R'>data(example.score.data)
print(example.score.data[1,])
</code></pre>

<hr>
<h2 id='plot'>
Plot method for RealVAMS
</h2><span id='topic+plot.RealVAMS'></span>

<h3>Description</h3>

<p>Plot teacher effects and residuals.  The caterpillar plots use a modified version of the plotCI function from R package gplots. According to that package, &quot;Original version [of plotCI] by Bill Venables wvenable@attunga.stats.adelaide.edu.au posted to r-help on Sep. 20, 1997. Enhanced version posted to r-help by Ben Bolker ben@zoo.ufl.edu on Apr. 16, 2001. This version was modified and extended by Gregory R. Warnes greg@warnes.net. Additional changes suggested by Martin Maechler maechler@stat.math.ethz.ch integrated on July 29, 2004.&quot;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'RealVAMS'
plot(x, ..., alpha)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_+3A_x">x</code></td>
<td>

<p>an object of class RealVAMS
</p>
</td></tr>
<tr><td><code id="plot_+3A_...">...</code></td>
<td>

<p>other arguments
</p>
</td></tr>
<tr><td><code id="plot_+3A_alpha">alpha</code></td>
<td>

<p>the significance level for the caterpillar plots
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Requires user to click window or press &quot;enter&quot; to progress through plots. Returns caterpillar plots (via the package gplots) and residual plots. 
</p>


<h3>Author(s)</h3>

<p>Andrew Karl <a href="mailto:akarl@asu.edu">akarl@asu.edu</a>, Jennifer Broatch, Jennifer Green, Other authors as listed above for the caterpillar plots.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+summary.RealVAMS">summary.RealVAMS</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(example.score.data)
data(example.outcome.data)

res&lt;-RealVAMS(example.score.data,example.outcome.data)
plot(res)

</code></pre>

<hr>
<h2 id='print'>
Print
</h2><span id='topic+print.RealVAMS'></span><span id='topic+print.summary.RealVAMS'></span>

<h3>Description</h3>

<p>Prints names of elements in RealVAMS object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'RealVAMS'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print_+3A_x">x</code></td>
<td>

<p>object of class RealVAMS
</p>
</td></tr>
<tr><td><code id="print_+3A_...">...</code></td>
<td>

<p>other arguments to be passed to summary
</p>
</td></tr>
</table>

<hr>
<h2 id='R_mstep2'>
Internal function
</h2><span id='topic+R_mstep2'></span>

<h3>Description</h3>

<p>An internal function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>R_mstep2(invsqrtW_,JYp_,loopsize_, patternlength_,rownumber_,ybetas_,etahat_,
tempmatR_,JXpi_,JXpp_,JXpx_,JXpdim_,JZpi_,JZpp_,JZpx_,JZpdim_)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="R_mstep2_+3A_invsqrtw_">invsqrtW_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="R_mstep2_+3A_jyp_">JYp_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="R_mstep2_+3A_loopsize_">loopsize_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="R_mstep2_+3A_patternlength_">patternlength_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="R_mstep2_+3A_rownumber_">rownumber_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="R_mstep2_+3A_ybetas_">ybetas_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="R_mstep2_+3A_etahat_">etahat_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="R_mstep2_+3A_tempmatr_">tempmatR_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="R_mstep2_+3A_jxpi_">JXpi_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="R_mstep2_+3A_jxpp_">JXpp_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="R_mstep2_+3A_jxpx_">JXpx_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="R_mstep2_+3A_jxpdim_">JXpdim_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="R_mstep2_+3A_jzpi_">JZpi_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="R_mstep2_+3A_jzpp_">JZpp_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="R_mstep2_+3A_jzpx_">JZpx_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="R_mstep2_+3A_jzpdim_">JZpdim_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
</table>

<hr>
<h2 id='RealVAMS'>
Multivariate VAM Fitting
</h2><span id='topic+RealVAMS'></span>

<h3>Description</h3>

<p>Fits a multivariate value-added model (VAM), see Broatch, Green, and Karl (2018) <br /> &lt;doi:10.32614/RJ-2018-033&gt;, and Broatch and Lohr (2012) <br /> &lt;doi:10.3102/1076998610396900&gt;, with normally distributed test scores and a binary outcome indicator. A pseudo-likelihood approach, Wolfinger and O'Connell (1993) <br /> &lt;doi:10.1080/00949659308811554&gt;, is used for the estimation of this joint generalized linear mixed model.  The inner loop of the pseudo-likelihood routine (estimation of a linear mixed model) occurs in the framework of the EM algorithm presented by <br /> Karl, Yang, and Lohr (2013) &lt;DOI:10.1016/j.csda.2012.10.004&gt;. This material is based upon work supported by the National Science Foundation under grants DRL-1336027 and DRL-1336265.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RealVAMS(score.data, outcome.data, persistence = "CP",school.effects = FALSE, 
REML = TRUE, score.fixed.effects = formula(~as.factor(year) + 0), 
outcome.fixed.effects = formula(~1), max.iter.EM = 10,
outcome.family = binomial(link = "probit"), tol1 = 1e-07, max.PQL.it = 30, 
pconv = .Machine$double.eps*1e9, var.parm.hessian = TRUE, verbose = TRUE,
independent.responses = FALSE,cpp.benchmark=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="RealVAMS_+3A_score.data">score.data</code></td>
<td>

<p>a data frame that contains at least a column &quot;y&quot; containing the student scores, 
a column &quot;student&quot; containing unique student ID's, a column &quot;teacher&quot; containing 
the teacher ID's, and a column &quot;year&quot; which contains the year (or semester, etc.) 
of the time period. The &quot;y&quot; and &quot;year&quot; variables needs to be numeric. If other 
variables are to be included as fixed effects in the score model, they should also be included in 
score.data. See 'Note' for further discussion.
</p>
</td></tr>
<tr><td><code id="RealVAMS_+3A_outcome.data">outcome.data</code></td>
<td>

<p>a data frame that contains at least a column &quot;r&quot; containing the binary student outcomes (coded 0/1),
and a column &quot;student&quot; containing unique student ID's. The student ID's should match those in <code>score.data</code>.
If other variables are to be included as fixed effects in the outcome model, they should also be included in 
outcome.data.
</p>
</td></tr>
<tr><td><code id="RealVAMS_+3A_persistence">persistence</code></td>
<td>

<p>a character object. Choices are &quot;CP&quot; or &quot;VP&quot;, for complete and variable persistence of the teacher score effects, respectively. 
The teacher outcome effects are modeled with complete persistence, regardless of the selection here.
</p>
</td></tr>
<tr><td><code id="RealVAMS_+3A_school.effects">school.effects</code></td>
<td>

<p>logical. If TRUE, correlated random school-level effects are fitted in the score and outcome response models. For both responses, the
school effects are fit with zero-persistence (a student's score in each year is associated with the current school attended, and their outcome is associated with the last school the student attended). The school ID should be included
as a column <code>schoolID</code> in the score.data data frame. 
</p>
</td></tr>
<tr><td><code id="RealVAMS_+3A_reml">REML</code></td>
<td>

<p>logical. If TRUE, the pseudo-response is fit using REML. If FALSE, ML is used.
</p>
</td></tr>
<tr><td><code id="RealVAMS_+3A_score.fixed.effects">score.fixed.effects</code></td>
<td>

<p>an object of class formula describing the structure of the fixed effects for the student scores. Categorical variables should be wrapped in an as.factor statement.
</p>
</td></tr>
<tr><td><code id="RealVAMS_+3A_outcome.fixed.effects">outcome.fixed.effects</code></td>
<td>

<p>an object of class formula describing the structure of the fixed effects for the student outcomes. Categorical variables should be wrapped in an as.factor statement.
</p>
</td></tr>
<tr><td><code id="RealVAMS_+3A_max.iter.em">max.iter.EM</code></td>
<td>

<p>numeric. The maximum number of EM iterations during each pseudo-likelihood iteration
</p>
</td></tr>
<tr><td><code id="RealVAMS_+3A_outcome.family">outcome.family</code></td>
<td>

<p>an object of class family describing the assumed distribution of the response. <code>binomial</code> is required, but any link function may be used.
</p>
</td></tr>
<tr><td><code id="RealVAMS_+3A_tol1">tol1</code></td>
<td>

<p>numeric. Convergence tolerance for EM algorithm during each interior pseduo-likelihood iteration. The convergence criterion is specified under 'Details'.
</p>
</td></tr>
<tr><td><code id="RealVAMS_+3A_max.pql.it">max.PQL.it</code></td>
<td>

<p>numeric. Maximum number of outer pseudo-likelihood iterations.
</p>
</td></tr>
<tr><td><code id="RealVAMS_+3A_pconv">pconv</code></td>
<td>

<p>numeric. Convergence criterion for outer pseudo-likelihood iterations. Compare to the PCONV option of SAS PROC GLIMMIX.
</p>
</td></tr>
<tr><td><code id="RealVAMS_+3A_var.parm.hessian">var.parm.hessian</code></td>
<td>

<p>logical. If TRUE, the Hessian of the parameters in the error and random effects covariance matrices
is calculated, providing standard errors for those parameters. Setting this option to FALSE will reduce the
run time of the program: only standard errors for the fixed effects will be returned.
</p>
</td></tr>
<tr><td><code id="RealVAMS_+3A_verbose">verbose</code></td>
<td>

<p>logical. If TRUE, model information will be printed at each iteration.
</p>
</td></tr>
<tr><td><code id="RealVAMS_+3A_independent.responses">independent.responses</code></td>
<td>

<p>logical. If TRUE, this option will model the responses independently by fixing the covariances in G at 0 as well as the 
covariances in the last row/column of R. The resulting estimates are the same as those that would be obtained by modelling 
the test scores in package GPvam (with REML=FALSE) and modelling the binary respones in SAS GLIMMIX (with link=probit) 
RealVAMS has been validated against these programs.
</p>
</td></tr>                                                  
<tr><td><code id="RealVAMS_+3A_cpp.benchmark">cpp.benchmark</code></td>
<td>

<p>logical. If TRUE, this option will perform the calculations shown in equation (16) of 
Karl, Yang, Lohr (2013) using both R and the embedded C++ code to demonstrate the time savings of using C++. 
A summary table is printed at the end.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>*The <code>persistence</code> option determines the type of persistence effects that are modeled. 
The variable persistence model (&quot;VP&quot;) assumes that teacher effects in future years are multiples of their effect in the current year (Lockwood et al. 2007). 
The multipliers in the VP model are called persistence parameters, and are estimated. By contrast, the complete persistence (&quot;CP&quot;) model fixes the persistence 
parameters at 1 and 0 (Lockwood et al. 2007). 
</p>
<p>*Convergence is declared for each interior iteration when <code class="reqn">(l_k-l_{k-1})/l_k &lt; \code{tol1}</code>, where <code class="reqn">l_k</code> is the log-likelihood 
at iteration <code class="reqn">k</code>.
</p>
<p>*The model is linearized using a pseudo-likelihood approach (Wolfinger 1993) and the resulting multiple membership linear mixed model is estimated 
via an EM algorithm (Karl et al. 2012). 
</p>


<h3>Value</h3>

<p>RealVAMS returns an object of class <code>RealVAMS</code>
</p>
<table>
<tr><td><code>loglik</code></td>
<td>
<p>the maximized log-likelihood at convergence of the EM algorithm. Warning: Likelihood-ratio tests are not valid with results from a PQL estimation routine.</p>
</td></tr>
<tr><td><code>teach.effects</code></td>
<td>
<p>a data frame containing the predicted teacher effects and standard errors</p>
</td></tr>
<tr><td><code>school.effects</code></td>
<td>
<p>if <code>school.effects=TRUE</code>, a data frame containing the predicted school effects and standard errors. Otherwise, NULL.</p>
</td></tr>
<tr><td><code>parameters</code></td>
<td>
<p>a matrix of estimated model parameters and standard errors. Wald p-values and 95% confidence intervals are provided for convenience, but these calculations assume infinite degrees of freedom. If working with a &quot;small&quot; data set, re-calculate these using the appropriate degrees of freedom.</p>
</td></tr>
<tr><td><code>Hessian</code></td>
<td>
<p>the Hessian of the variance parameters. <code>var.parm.hessian</code> must be set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code>R_i</code></td>
<td>
<p>a matrix containing the error covariance matrix of a student's test scores and outcome (assuming a complete response vector with no missing test scores or outcome indicator). The bottom-right component corresponds to the variance of the binary response, and is fixed at 1.</p>
</td></tr>
<tr><td><code>teach.cov</code></td>
<td>
<p>a list containing the unique blocks of the covariance matrix of teacher effects (the G matrix).</p>
</td></tr>
<tr><td><code>mresid</code></td>
<td>
<p>a vector of the raw marginal residuals. Can be reproduced with <br /><code>y.combined-X%*%fixed.effects</code>. </p>
</td></tr>
<tr><td><code>cresid</code></td>
<td>
<p>a vector of the raw conditional residuals. Can be reproduced with <br /><code>y.combined-X%*%fixed.effects-Z%*%eblup[,2]</code>.</p>
</td></tr>
<tr><td><code>y.combined</code></td>
<td>
<p>a vector of the pseudo-responses from the final PQL iteration, with score and outcome responses interleaved (see the notes below). The test scores will be the same as those given as an input, but the 0/1 responses for the binary distribution will be the pseudo-responses. The vector y.response.type indicates which response each component corresponds to. For components corresponding to the binary response,
the original response can be obtained from <br /><code>joined.table$y.combined.original</code>.</p>
</td></tr>
<tr><td><code>y.combined.hat</code></td>
<td>
<p>a vector of the predicted values. This vector can be reconstructed with other variables returned in this object as <code>X%*%fixed.effects+Z%*%eblup[,2]</code>. The values corresponding to the binary outcome responses can be converted to probabilities (of a 1 response) via the inverse link function <code>outcome.family$linkinv()</code>. The covariance matrix for this vector of predictions is <code>Z%*%G%*%t(Z)+R.full</code>.</p>
</td></tr>
<tr><td><code>y.response.type</code></td>
<td>
<p>a vector indicating the type of response in each component of <code>y.combined</code></p>
</td></tr>
<tr><td><code>y.year</code></td>
<td>
<p>a vector indicating the year in which each component of <code>y.combined</code> was recorded</p>
</td></tr>
<tr><td><code>num.obs</code></td>
<td>
<p>total number of observations (test scores and binary responses)</p>
</td></tr>
<tr><td><code>num.student</code></td>
<td>
<p>total number of students included in the data</p>
</td></tr>
<tr><td><code>num.year</code></td>
<td>
<p>number of years over which test scores were modeled</p>
</td></tr>
<tr><td><code>num.teach</code></td>
<td>
<p>a vector listing the number of teachers in each year</p>
</td></tr>
<tr><td><code>persistence</code></td>
<td>
<p>a character vector indicating the persistence structure (VP or CP) used to model the teacher test-score effects</p>
</td></tr>   
<tr><td><code>persistence_parameters</code></td>
<td>
<p>a matrix of the persistence parameters. The (i,j)-th component gives the persistence parameter for year-j teachers on year-i scores.</p>
</td></tr>
<tr><td><code>X</code></td>
<td>
<p>the fixed effects design matrix of the interleaved score and outcome responses</p>
</td></tr>
<tr><td><code>Z</code></td>
<td>
<p>the random effects design matrix of the interleaved score and outcome responses</p>
</td></tr>
<tr><td><code>G</code></td>
<td>
<p>the random effects covariance matrix. This matrix is block diagonal and contains the teacher variance components and, if included, school-level variance components.</p>
</td></tr>
<tr><td><code>C</code></td>
<td>
<p>the joint covariance matrix of the fixed effect estimates and the predicted random effects, that is, for c(fixed.effects,eblup[,1]). See Henderson (1975) for details. This can be used to estimate the variance of an estimable/predictable function.</p>
</td></tr>
<tr><td><code>R</code></td>
<td>
<p>the error covariance matrix, with the variance of the outcome pseudo-responses restricted to 1. See the description for <code>R.full</code>. In most cases, <code>R.full</code> should be used instead of <code>R</code> when analyzing the results of <b>RealVAMS</b>.</p>
</td></tr>
<tr><td><code>R.full</code></td>
<td>
<p>the error covariance matrix, which is formed as the product <br />
<code>diag(sqrt.w)%*%R%*%diag(sqrt.w)</code>. The matrix R assumes a variance of 1 for all of the binomial responses, while R.full includes the variance from the binomial distribution (in Wolfinger (1993), diag(sqrt.w) is called R_mu).</p>
</td></tr>
<tr><td><code>sqrt.W</code></td>
<td>
<p>vector of weights for the error covariance matrix. See the description for R.full above</p>
</td></tr>
<tr><td><code>eblup</code></td>
<td>
<p>a matrix containing the complete random effects vector and associated standard errors. When <code>school.effects=FALSE</code>, this matrix is identical to the one returned by <br /> <code>teach.effects</code>. When <code>school.effects=TRUE</code>, this matrix is equal to<br /> <code>rbind(teach.effects,school.effects)</code>. Thus, <code>Z%*%eblup[,2]</code> may be used to return the subject-specific portion of the predictions.</p>
</td></tr>
<tr><td><code>fixed.effects</code></td>
<td>
<p>a vector containing the fixed effect estimates. This is a subset of <code>parameters</code>, and provided for compatibility with <code>X</code>. That is, <code>X%*%fixed.effects</code> will yield the marginal means.</p>
</td></tr>
<tr><td><code>joined.table</code></td>
<td>
<p>a data frame containing the interleaved score and outcome data sets. See the notes below.</p>
</td></tr>
<tr><td><code>outcome.family</code></td>
<td>
<p>returns information about the distribution and link function used for the outcomes.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The first few iterations of the EM algorithm will take longer than subsequent iterations. This is a result of the hybrid gradient-ascent/Newton-Raphson method used in the M-step for the R matrix in the first two iterations (Karl et al. 2012).
</p>
<p>The model assumes that each teacher teaches only one year. If, for example, a teacher teaches in years 1 and 2, his/her first year performance is modeled independently of the second year performance.
To keep these effects separate, the program appends &quot;(year i)&quot; to each teacher name, where i is the year in which the teacher taught.
</p>
<p>To fit the model and allow correlation between test scores and outcomes (at both the student and teacher levels), the score and outcome response vectors are interleaved into a single response vector. For example, if there are three years of test scores modeled with a binary outcome indicator, the binary indicator for a student is inserted immediately after that student's test scores. The <code>joined.table</code> that is returned by RealVAMS shows how this was done for a particular data set. Row <em>i</em> of <code>joined.table</code> corresponds to row <em>i</em> of <code>X</code>, <code>Z</code>, <code>R.full</code>, <code>y.combined</code>, <code>y.combined.hat</code>, and <code>eblup</code>.
</p>
<p>The <code>fixed.effects</code> arguments of <code>RealVAMS</code> utilizes the functionality of R's <code>formula</code> class. In the statement <br /><code>score.fixed.effects=formula(~as.factor(year)+cont_var+0))</code>, <code>as.factor(year)</code><br /> identifies <code>year</code> as a categorical variable. <code>+0</code> indicates that no intercept is to be fitted, and <code>+cont_var</code> indicates that a separate effect is to be fitted for the continuous variable &quot;cont_var.&quot; An interaction between &quot;year&quot; and &quot;cont_var&quot; could be specified by <code>~as.factor(year)*cont_var+0</code>, or equivalently, <code>~as.factor(year)+cont_var+as.factor(year):cont_var+0</code>. See <code><a href="stats.html#topic+formula">formula</a></code> for more details.
</p>


<h3>Author(s)</h3>

<p>Andrew Karl <a href="mailto:akarl@asu.edu">akarl@asu.edu</a>, Jennifer Broatch, Jennifer Green
</p>


<h3>References</h3>

<p>Broatch, J. and Lohr, S. (2012) &lt;DOI:10.3102/1076998610396900&gt; Multidimensional Assessment of Value Added by Teachers to Real-World Outcomes. <em>Journal of Educational and Behavioral Statistics</em> <b>37</b>, 256&ndash;277.
</p>
<p>Broatch, J., Green, J., Karl, A. (2018) &lt;DOI:10.32614/RJ-2018-033&gt; RealVAMS: An R Package for Fitting a Multivariate Value-added Model (VAM). <em>The R Journal</em> 10/1, 22&ndash;30.
</p>
<p>Karl, A., Yang, Y. and Lohr, S. (2013) &lt;DOI:10.1016/j.csda.2012.10.004&gt; Efficient Maximum Likelihood Estimation of Multiple Membership Linear Mixed Models, with an Application to Educational Value-Added Assessments. <em>Computational Statistics &amp; Data Analysis</em> <b>59</b>, 13&ndash;27.  
</p>
<p>Karl, A., Yang, Y. and Lohr, S. (2013) &lt;DOI:10.3102/1076998613494819&gt; A Correlated Random Effects Model for Nonignorable Missing Data in Value-Added Assessment of Teacher Effects. <em>Journal of Educational and Behavioral Statistics</em> <b>38</b>, 577&ndash;603.
</p>
<p>Karl, A., Yang, Y. and Lohr, S. (2014) &lt;DOI:10.1016/j.csda.2013.11.019&gt; Computation of Maximum Likelihood Estimates for Multiresponse Generalized Linear Mixed Models with Non-nested, Correlated Random Effects. <em>Computational Statistics &amp; Data Analysis</em> <b>73</b>, 146&ndash;162.
</p>
<p>Henderson, C.R. (1975) Best linear unbiased estimation and prediction under a selection model. <em>Biometrics</em> <b>31(2)</b>, 423-447.
</p>
<p>Lockwood, J., McCaffrey, D., Mariano, L., Setodji, C. (2007) &lt;DOI:10.3102/1076998606298039&gt; Bayesian Methods for Scalable Multivariate Value-Added Assessment. <em>Journal of Educational and Behavioral Statistics</em> <b>32</b>, 125&ndash;150.
</p>
<p>Wolfinger, R. (1993) &lt;DOI:10.1080/00949659308811554&gt; Generalized linear mixed models a pseudo-likelihood approach. <em>Journal of Statistical Computation and Simulation</em> <b>48</b> 233&ndash;243.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(example.score.data)
data(example.outcome.data)
#The next line exists to show that the function can run and that the package
#installed correctly
RealVAMS(example.score.data,example.outcome.data,max.PQL.it=1,max.iter.EM=2,
var.parm.hessian=FALSE)


res&lt;-RealVAMS(example.score.data,example.outcome.data)
</code></pre>

<hr>
<h2 id='RealVAMS-package'>
Multivariate VAM Fitting
</h2><span id='topic+RealVAMS-package'></span>

<h3>Description</h3>

<p>Fits a multivariate value-added model (VAM), see Broatch, Green, and Karl (2018) <br /> &lt;doi:10.32614/RJ-2018-033&gt;, and Broatch and Lohr (2012) <br /> &lt;doi:10.3102/1076998610396900&gt;, with normally distributed test scores and a binary outcome indicator. A pseudo-likelihood approach, Wolfinger and O'Connell (1993) <br /> &lt;doi:10.1080/00949659308811554&gt;, is used for the estimation of this joint generalized linear mixed model.  The inner loop of the pseudo-likelihood routine (estimation of a linear mixed model) occurs in the framework of the EM algorithm presented by <br /> Karl, Yang, and Lohr (2013) &lt;DOI:10.1016/j.csda.2012.10.004&gt;. This material is based upon work supported by the National Science Foundation under grants DRL-1336027 and DRL-1336265.  
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> RealVAMS</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 0.4-5</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2023-01-06</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL-2</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Authors: Andrew T. Karl, Jennifer Broatch, and Jennifer Green
</p>
<p>Maintainer: Andrew Karl &lt;akarl@asu.edu&gt;
</p>


<h3>References</h3>

<p>Broatch, J. and Lohr, S. (2012) &lt;DOI:10.3102/1076998610396900&gt; Multidimensional Assessment of Value Added by Teachers to Real-World Outcomes. <em>Journal of Educational and Behavioral Statistics</em> <b>37</b>, 256&ndash;277.
</p>
<p>Broatch, J., Green, J., Karl, A. (2018) &lt;DOI:10.32614/RJ-2018-033&gt; RealVAMS: An R Package for Fitting a Multivariate Value-added Model (VAM). <em>The R Journal</em> 10/1, 22&ndash;30.
</p>
<p>Karl, A., Yang, Y. and Lohr, S. (2013) &lt;DOI:10.1016/j.csda.2012.10.004&gt; Efficient Maximum Likelihood Estimation of Multiple Membership Linear Mixed Models, with an Application to Educational Value-Added Assessments. <em>Computational Statistics &amp; Data Analysis</em> <b>59</b>, 13&ndash;27.  
</p>
<p>Karl, A., Yang, Y. and Lohr, S. (2013) &lt;DOI:10.3102/1076998613494819&gt; A Correlated Random Effects Model for Nonignorable Missing Data in Value-Added Assessment of Teacher Effects. <em>Journal of Educational and Behavioral Statistics</em> <b>38</b>, 577&ndash;603.
</p>
<p>Karl, A., Yang, Y. and Lohr, S. (2014) &lt;DOI:10.1016/j.csda.2013.11.019&gt; Computation of Maximum Likelihood Estimates for Multiresponse Generalized Linear Mixed Models with Non-nested, Correlated Random Effects. <em>Computational Statistics &amp; Data Analysis</em> <b>73</b>, 146&ndash;162.
</p>
<p>Lockwood, J., McCaffrey, D., Mariano, L., Setodji, C. (2007) &lt;DOI:10.3102/1076998606298039&gt; Bayesian Methods for Scalable Multivariate Value-Added Assessment. <em>Journal of Educational and Behavioral Statistics</em> <b>32</b>, 125&ndash;150.
</p>
<p>Wolfinger, R. (1993) &lt;DOI:10.1080/00949659308811554&gt; Generalized linear mixed models a pseudo-likelihood approach. <em>Journal of Statistical Computation and Simulation</em> <b>48</b> 233&ndash;243.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(example.score.data)
data(example.outcome.data)
#The next line exists to show that the function can run and that the package
#installed correctly. This is a CRAN requirement to ensure that the package
#works in future version of R
RealVAMS(example.score.data,example.outcome.data,max.PQL.it=1,max.iter.EM=2,
var.parm.hessian=FALSE)


res&lt;-RealVAMS(example.score.data,example.outcome.data)
</code></pre>

<hr>
<h2 id='REML_Rm'>
Internal function
</h2><span id='topic+REML_Rm'></span>

<h3>Description</h3>

<p>An internal function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>REML_Rm(invsqrtW_,JYp_,loopsize_, patternlength_,rownumber_,ybetas_,etahat_,
tempmatR_,JXpi_,JXpp_,JXpx_,JXpdim_,JZpi_,JZpp_,JZpx_,JZpdim_,betacov_,C12_)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="REML_Rm_+3A_invsqrtw_">invsqrtW_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="REML_Rm_+3A_jyp_">JYp_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="REML_Rm_+3A_loopsize_">loopsize_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="REML_Rm_+3A_patternlength_">patternlength_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="REML_Rm_+3A_rownumber_">rownumber_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="REML_Rm_+3A_ybetas_">ybetas_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="REML_Rm_+3A_etahat_">etahat_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="REML_Rm_+3A_tempmatr_">tempmatR_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="REML_Rm_+3A_jxpi_">JXpi_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="REML_Rm_+3A_jxpp_">JXpp_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="REML_Rm_+3A_jxpx_">JXpx_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="REML_Rm_+3A_jxpdim_">JXpdim_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="REML_Rm_+3A_jzpi_">JZpi_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="REML_Rm_+3A_jzpp_">JZpp_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="REML_Rm_+3A_jzpx_">JZpx_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="REML_Rm_+3A_jzpdim_">JZpdim_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="REML_Rm_+3A_betacov_">betacov_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
<tr><td><code id="REML_Rm_+3A_c12_">C12_</code></td>
<td>

<p>an internal variable
</p>
</td></tr>
</table>

<hr>
<h2 id='summary'>
Summary
</h2><span id='topic+summary.RealVAMS'></span>

<h3>Description</h3>

<p>Prints summary information for object of class RealVAMS
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'RealVAMS'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary_+3A_object">object</code></td>
<td>

<p>object of class RealVAMS
</p>
</td></tr>
<tr><td><code id="summary_+3A_...">...</code></td>
<td>

<p>other arguments to be passed to summary
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Andrew Karl <a href="mailto:akarl@asu.edu">akarl@asu.edu</a>, Jennifer Broatch, Jennifer Green
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.RealVAMS">plot.RealVAMS</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
res&lt;-RealVAMS(example.score.data,example.outcome.data)
summary(res)

## End(Not run)
</code></pre>

<hr>
<h2 id='vp_cp'>
Internal function
</h2><span id='topic+vp_cp'></span>

<h3>Description</h3>

<p>An internal function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vp_cp(Z_mat, B.mat, control)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vp_cp_+3A_z_mat">Z_mat</code></td>
<td>

<p>data frame
</p>
</td></tr>
<tr><td><code id="vp_cp_+3A_b.mat">B.mat</code></td>
<td>

<p>data frame
</p>
</td></tr>
<tr><td><code id="vp_cp_+3A_control">control</code></td>
<td>

<p>a list
</p>
</td></tr>
</table>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
