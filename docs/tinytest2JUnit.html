<!DOCTYPE html><html><head><title>Help for package tinytest2JUnit</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {tinytest2JUnit}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#+5B.tinytests2JUnit'><p>tinytestJUnit test results</p></a></li>
<li><a href='#charVecToSingleLength'><p>Convert any will character vector to a single length character vector</p></a></li>
<li><a href='#classnameTestcase'><p>Helper function specifying the 'classname' attribute of the testcase tag.</p></a></li>
<li><a href='#constructFailureDescription'><p>Helper function generating the body of a failure description tag!</p></a></li>
<li><a href='#constructTestcaseTag'><p>Construct JUnit <code style="white-space: pre;">&#8288;&lt;/testcase&gt;&#8288;</code> tag</p></a></li>
<li><a href='#constructTestsuitesTag'><p>Construct the JUnit <code style="white-space: pre;">&#8288;&lt;/testsuites&gt;&#8288;</code> tag</p></a></li>
<li><a href='#constructTestsuiteTag'><p>Construct JUnit <code style="white-space: pre;">&#8288;&lt;/testsuite&gt;&#8288;</code> tag</p></a></li>
<li><a href='#errorTestcaseTag'><p>Construct a testcase-tag for an error test.</p></a></li>
<li><a href='#escapeXml'><p>Escape xml</p></a></li>
<li><a href='#escapeXmlText'><p>Escape xml text</p></a></li>
<li><a href='#failureTestcaseTag'><p>Construct a testcase-tag for a failed test.</p></a></li>
<li><a href='#format.XMLtag'><p>Format method for XMLtag class</p></a></li>
<li><a href='#formattedFrame'><p>Help function to generate the formatted string for a single stack frame.</p></a></li>
<li><a href='#getFormattedStacktrace'><p>Get formatted stack trace for an uncaught error from a tinytest test file.</p></a></li>
<li><a href='#isSingleLengthCharNonNA'><p>Test if single length character non NA.</p></a></li>
<li><a href='#nameTestcase'><p>Helper function to construct the name of a testcase</p></a></li>
<li><a href='#passedTestcaseTag'><p>Construct a testcase-tag for a passed test.</p></a></li>
<li><a href='#print.XMLtag'><p>Print method for XMLtag class.</p></a></li>
<li><a href='#runTestDir'><p>Run all the test files in a directory</p></a></li>
<li><a href='#runTestFile'><p>Internal wrapper arround tinytest::run_test_file</p></a></li>
<li><a href='#sideeffectTestcaseTag'><p>Construct a testcase-tag for a side-effect test.</p></a></li>
<li><a href='#tag'><p>XML tag</p></a></li>
<li><a href='#testPackage'><p>Test an R package and report the results in JUnit</p></a></li>
<li><a href='#writeJUnit'><p>Write the results of a <code>tinytests</code>-object into JUnit xml report.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Convert 'tinytest' Output to JUnit XML</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.2</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Lennart Tuijnder &lt;lennart.tuijnder@openanalytics.eu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Unit testing is a solid component of automated CI/CD pipelines. 
	'tinytest' - a lightweight, zero-dependency  alternative to 'testthat' was developed.
	To be able to integrate 'tinytests' results into common CI/CD systems the test results from 
	tinytest need to be caputred and converted to JUnit XML format. 
	'tinytest2JUnit' enables this conversion while staying also lightweight 
	and only have 'tinytest' as its dependency.</td>
</tr>
<tr>
<td>Imports:</td>
<td>tools, parallel, utils, tinytest</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/openanalytics/tinytest2JUnit">https://github.com/openanalytics/tinytest2JUnit</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/openanalytics/tinytest2JUnit/issues">https://github.com/openanalytics/tinytest2JUnit/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Copyright:</td>
<td>Open Analytics NV, 2024</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-05-30 06:11:43 UTC; root</td>
</tr>
<tr>
<td>Author:</td>
<td>Anne-Katrin Hess [aut],
  Lennart Tuijnder [aut, cre]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-05-30 07:00:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='+5B.tinytests2JUnit'>tinytestJUnit test results</h2><span id='topic++5B.tinytests2JUnit'></span><span id='topic+tinytests2JUnit'></span>

<h3>Description</h3>

<p>An object of class <code>tinytests2JUnit</code>. Note the plurar. A subclass of <code><a href="tinytest.html#topic+tinytests">tinytest::tinytests()</a></code>
containing extra info recordings that are used in the export to JUnit.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'tinytests2JUnit'
x[i]
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="+2B5B.tinytests2JUnit_+3A_x">x</code></td>
<td>
<p><code>tinytests2JUnit</code> object to subset.</p>
</td></tr>
<tr><td><code id="+2B5B.tinytests2JUnit_+3A_i">i</code></td>
<td>
<p>object to subset the <code>x</code> with.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Following details are recorded when running the tests files and stored as additional attributes
to the object:
</p>

<ul>
<li> <p><strong>fileDurations</strong>: <code>named-numeric(n)</code>. Names = filename of tests files, value = duration
in seconds on how long the test file took to run.
</p>
</li>
<li> <p><strong>fileTimestamps</strong>: <code>named-character(n)</code>. Names = filename of tests files, value = timestamp
when the test was invoked.
</p>
</li>
<li> <p><strong>fileHostnames</strong>: <code>named-character(n)</code>. Names = filename of tests files, value = The hostname
of the system that ran the tests. (Usefull in combination with clusters).
</p>
</li>
<li> <p><strong>disabled</strong>: <code>character</code>. A character vector of filenames where no tests were ran.
They are flagged as disabled tests.
</p>
</li></ul>


<hr>
<h2 id='charVecToSingleLength'>Convert any will character vector to a single length character vector</h2><span id='topic+charVecToSingleLength'></span>

<h3>Description</h3>

<p>Convert any will character vector to a single length character vector
</p>


<h3>Usage</h3>

<pre><code class='language-R'>charVecToSingleLength(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="charVecToSingleLength_+3A_x">x</code></td>
<td>
<p>a <code>character</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>x a single-length character vector Non-NA
</p>


<h3>Examples</h3>

<pre><code class='language-R'>tinytest2JUnit:::charVecToSingleLength(c("Hello", "World")) # -&gt; "HelloWorld"
tinytest2JUnit:::charVecToSingleLength(c("Hello", NA_character_)) # -&gt; "HelloNA"
tinytest2JUnit:::charVecToSingleLength(character(0L)) # -&gt; ""
</code></pre>

<hr>
<h2 id='classnameTestcase'>Helper function specifying the 'classname' attribute of the testcase tag.</h2><span id='topic+classnameTestcase'></span>

<h3>Description</h3>

<p>Helper function specifying the 'classname' attribute of the testcase tag.
Currently equal to the fileName. The classname is already xml escaped.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>classnameTestcase(tinytest)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="classnameTestcase_+3A_tinytest">tinytest</code></td>
<td>
<p>a <code>tinytest</code>-object representing an individual test case.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>character(1)</code> being the 'classname'
</p>

<hr>
<h2 id='constructFailureDescription'>Helper function generating the body of a failure description tag!</h2><span id='topic+constructFailureDescription'></span>

<h3>Description</h3>

<p>Helper function generating the body of a failure description tag! Attempts to mimic the print
behaviour of a tinytest object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>constructFailureDescription(tinytest)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="constructFailureDescription_+3A_tinytest">tinytest</code></td>
<td>
<p>A <code>tinytest</code> objec that is considered failed!.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>character(1)</code> being the failure tag description body. This string is already propery
xml escaped.
</p>

<hr>
<h2 id='constructTestcaseTag'>Construct JUnit <code style="white-space: pre;">&#8288;&lt;/testcase&gt;&#8288;</code> tag</h2><span id='topic+constructTestcaseTag'></span>

<h3>Description</h3>

<p>Construct JUnit <code style="white-space: pre;">&#8288;&lt;/testcase&gt;&#8288;</code> tag based on a single <code>tinytest</code> result.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>constructTestcaseTag(tinytest)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="constructTestcaseTag_+3A_tinytest">tinytest</code></td>
<td>
<p>a <code>tinytest</code>-object representing an individual test case.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>XMLtag</code>: with tag-name = <code>tinytest</code> and contains the test result per test.
</p>

<hr>
<h2 id='constructTestsuitesTag'>Construct the JUnit <code style="white-space: pre;">&#8288;&lt;/testsuites&gt;&#8288;</code> tag</h2><span id='topic+constructTestsuitesTag'></span>

<h3>Description</h3>

<p>Convert the <code>tinytests2Junit</code> or <code>tinytests</code>-object containing test across
possibly multiple files into a JUnit <code style="white-space: pre;">&#8288;&lt;/testsuites&gt;&#8288;</code> tag. More details are reported to the
JUnit if a <code>tinytests2JUnit</code> object compared to the native <code>tinytests</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>constructTestsuitesTag(testResults)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="constructTestsuitesTag_+3A_testresults">testResults</code></td>
<td>
<p><code style="white-space: pre;">&#8288;tinytests2Junit | &#8288;</code>tinytests<code style="white-space: pre;">&#8288;object to convert into a JUnit XML object  Usually the result of [runTestDir()] for a&#8288;</code>tinytests2JUnit<code style="white-space: pre;">&#8288;object or native&#8288;</code>tinytests'
produced by <code><a href="tinytest.html#topic+test_package">tinytest::test_package()</a></code> or <code><a href="tinytest.html#topic+run_test_dir">tinytest::run_test_dir()</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Reference for JUnit XML format: https://llg.cubic.org/docs/junit/
</p>
<p>See details <code><a href="#topic+runTestDir">runTestDir()</a></code> which additional info is recorded.
</p>


<h3>Value</h3>

<p><code>XMLtag</code>: with tag-name = <code style="white-space: pre;">&#8288;&lt;/testsuites&gt;&#8288;</code>. This is the root of the JUnit XML document.
</p>

<hr>
<h2 id='constructTestsuiteTag'>Construct JUnit <code style="white-space: pre;">&#8288;&lt;/testsuite&gt;&#8288;</code> tag</h2><span id='topic+constructTestsuiteTag'></span>

<h3>Description</h3>

<p>Construct the <code style="white-space: pre;">&#8288;&lt;/testsuite&gt;&#8288;</code> tag of a <code>tinytest</code>, given all the <code>tinytest</code> results
from a single test file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>constructTestsuiteTag(testsFile, id)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="constructTestsuiteTag_+3A_testsfile">testsFile</code></td>
<td>
<p><code>tinytests2JUnit | tinytests</code> -object with all test
results of a specified test file. At least a single test is expected.</p>
</td></tr>
<tr><td><code id="constructTestsuiteTag_+3A_id">id</code></td>
<td>
<p><code>integer(1)</code> testsuite id.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In case a <code>tinytest2JUnit</code> is provided following additional info can be reported:
</p>

<ul>
<li><p> testsuite duration.
</p>
</li>
<li><p> timestamp when the testsuite was performed.
</p>
</li>
<li><p> hostname where the testsuite was ran.
</p>
</li></ul>



<h3>Value</h3>

<p><code>XMLtag</code>: with tag-name = <code style="white-space: pre;">&#8288;&lt;/testsuite&gt;&#8288;</code>
that contains all the test results per test file.
</p>

<hr>
<h2 id='errorTestcaseTag'>Construct a testcase-tag for an error test.</h2><span id='topic+errorTestcaseTag'></span>

<h3>Description</h3>

<p>Construct a testcase-tag for an error test.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>errorTestcaseTag(tinytest)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="errorTestcaseTag_+3A_tinytest">tinytest</code></td>
<td>
<p>a <code>tinytest</code> object already validated to be a &quot;ERROR&quot; test.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>testase</code> <code>XMLtag</code>
</p>

<hr>
<h2 id='escapeXml'>Escape xml</h2><span id='topic+escapeXml'></span>

<h3>Description</h3>

<p>Escape the characters <code>&amp;</code>,<code style="white-space: pre;">&#8288;"&#8288;</code>,<code style="white-space: pre;">&#8288;'&#8288;</code>,<code>&lt;</code>,<code>&gt;</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>escapeXml(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="escapeXml_+3A_x">x</code></td>
<td>
<p>a <code>character</code> vector meant to be xml</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The same <code>character</code> vector x but xml escaped.
</p>


<h3>See Also</h3>

<p>https://stackoverflow.com/a/1091953/10415129
</p>

<hr>
<h2 id='escapeXmlText'>Escape xml text</h2><span id='topic+escapeXmlText'></span>

<h3>Description</h3>

<p>Escape the characters '&lt;' and <code>&amp;</code> in a character vector meant to be xml-text content.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>escapeXmlText(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="escapeXmlText_+3A_x">x</code></td>
<td>
<p>a <code>character</code> vector meant to be xml-text content.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The same <code>character</code> vector x but xml text escaped.
</p>

<hr>
<h2 id='failureTestcaseTag'>Construct a testcase-tag for a failed test.</h2><span id='topic+failureTestcaseTag'></span>

<h3>Description</h3>

<p>Construct a testcase-tag for a failed test.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>failureTestcaseTag(tinytest)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="failureTestcaseTag_+3A_tinytest">tinytest</code></td>
<td>
<p>a <code>tinytest</code> object already validated to be a &quot;FAILURE&quot; test.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>testase</code> <code>XMLtag</code>
</p>

<hr>
<h2 id='format.XMLtag'>Format method for XMLtag class</h2><span id='topic+format.XMLtag'></span>

<h3>Description</h3>

<p>Format S3 method for the <code>XMLtag</code>-class
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'XMLtag'
format(x, level = 0, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="format.XMLtag_+3A_x">x</code></td>
<td>
<p>an <code>XMLtag</code>-object</p>
</td></tr>
<tr><td><code id="format.XMLtag_+3A_level">level</code></td>
<td>
<p>print depth level. For each level 2 spaces are added to the left. The content of a
tag is automatically indented with 1 level. Except for text-content (see details).</p>
</td></tr>
<tr><td><code id="format.XMLtag_+3A_...">...</code></td>
<td>
<p>to ignore</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note, text content does not get indented or put on a new line, since whites space characters
are of relevance.
</p>


<h3>Value</h3>

<p><code>character(1)</code> vector of the formatted XML tag.
</p>

<hr>
<h2 id='formattedFrame'>Help function to generate the formatted string for a single stack frame.</h2><span id='topic+formattedFrame'></span>

<h3>Description</h3>

<p>Help function to generate the formatted string for a single stack frame.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>formattedFrame(framecall, frameN, hasSrcInfo, dirName, fileName, lineNr)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="formattedFrame_+3A_framecall">framecall</code></td>
<td>
<p><code>character(n)</code>: deparsed call for the given stack. Each element corresponds to
a line.</p>
</td></tr>
<tr><td><code id="formattedFrame_+3A_framen">frameN</code></td>
<td>
<p><code>integer(1)</code>: frame nummer.</p>
</td></tr>
<tr><td><code id="formattedFrame_+3A_hassrcinfo">hasSrcInfo</code></td>
<td>
<p><code>logical(1)</code>: Does the call have any source info?</p>
</td></tr>
<tr><td><code id="formattedFrame_+3A_dirname">dirName</code></td>
<td>
<p><code>character(1)</code>: the directory name of the source file.</p>
</td></tr>
<tr><td><code id="formattedFrame_+3A_filename">fileName</code></td>
<td>
<p><code>character(1)</code>: filename of the source. Value ignored if hasSrcInfo=TRUE.</p>
</td></tr>
<tr><td><code id="formattedFrame_+3A_linenr">lineNr</code></td>
<td>
<p><code>character(1)</code>: linenr in the source where the call occured..
Value ignored if hasSrcInfo=TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For a given frame in the stack the string is formatted as follows (substitute the arguments
between the curly braces)
<code>
{frameN}| {call[1]}
{frameN}| {call[2]}
{frameN}| {call[3]}
{frameN}| {call[3]}
---&gt; at File={dirName/fileName} Line={line}:
</code>
</p>
<p>For example for only a single line error:
<code>
1: stop("This is a crash")
---&gt; at File=R/my_r_code_file.R Line=234
</code>
</p>
<p>Currently all call lines are printed for a given stack.
The last line with source file info only printed if hasSrcInfo=TRUE. Else it is ommited.
</p>


<h3>Value</h3>

<p><code>characer(1)</code> the formatted character string containing info of a single frame in the
stackstrace
</p>

<hr>
<h2 id='getFormattedStacktrace'>Get formatted stack trace for an uncaught error from a tinytest test file.</h2><span id='topic+getFormattedStacktrace'></span>

<h3>Description</h3>

<p>getFormattedStacktrace is a helper function that formats stacktrace for uncaught errors from a
tinytest run file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getFormattedStacktrace()
</code></pre>


<h3>Details</h3>

<p>This function assumes that it directly called from a withCallingHandler
error handling function! This fact is then used to remove the calling handler info from the
stack such that stack directly starts from where the error was thrown.
</p>
<p>The function also removes the calls from the stack that involve
executing the <code>test_file</code>. The internals of runTestDir and tinytest are not of intererst.
And the highest level of the stack to consider is the top level of the test_file.
</p>
<p>Note, this does mean that errors that occur on the top-level of the test file will not have a
a stacktrace!
For example: &quot;Error: object 'x' not found&quot; where x is attempted to be resolved
at the root levels
</p>


<h3>Value</h3>

<p><code>character(1)</code> a single length character string suitable to be printed to the end-user.
In case of no stakctrace (eg the error occured at root level of the script) NA_character_
is returned!
</p>

<hr>
<h2 id='isSingleLengthCharNonNA'>Test if single length character non NA.</h2><span id='topic+isSingleLengthCharNonNA'></span>

<h3>Description</h3>

<p>Test if single length character non NA.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>isSingleLengthCharNonNA(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="isSingleLengthCharNonNA_+3A_x">x</code></td>
<td>
<p>object to test.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>logical(1)</code>
</p>


<h3>Author(s)</h3>

<p>ltuijnder
</p>

<hr>
<h2 id='nameTestcase'>Helper function to construct the name of a testcase</h2><span id='topic+nameTestcase'></span>

<h3>Description</h3>

<p>Helper function to construct the name of a testcase. Note, the charater is already xml escaped.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nameTestcase(tinytest)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nameTestcase_+3A_tinytest">tinytest</code></td>
<td>
<p>a <code>tinytest</code> object. (does not matter what result)</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>character(1)</code> the testcase name to use for this tinytest object.
</p>

<hr>
<h2 id='passedTestcaseTag'>Construct a testcase-tag for a passed test.</h2><span id='topic+passedTestcaseTag'></span>

<h3>Description</h3>

<p>Construct a testcase-tag for a passed test.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>passedTestcaseTag(tinytest)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="passedTestcaseTag_+3A_tinytest">tinytest</code></td>
<td>
<p>a <code>tinytest</code> object already validated to be a &quot;PASSED&quot; test.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>testase</code> <code>XMLtag</code>
</p>

<hr>
<h2 id='print.XMLtag'>Print method for XMLtag class.</h2><span id='topic+print.XMLtag'></span>

<h3>Description</h3>

<p>Print method for XMLtag class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'XMLtag'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.XMLtag_+3A_x">x</code></td>
<td>
<p>a <code>XMLtag</code>-object</p>
</td></tr>
<tr><td><code id="print.XMLtag_+3A_...">...</code></td>
<td>
<p>to be ignored</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>invisibly</code> the string that was printed to stdout.
</p>

<hr>
<h2 id='runTestDir'>Run all the test files in a directory</h2><span id='topic+runTestDir'></span>

<h3>Description</h3>

<p><code><a href="#topic+runTestDir">runTestDir()</a></code> is a drop in replacement for <code><a href="tinytest.html#topic+run_test_dir">tinytest::run_test_dir()</a></code> with the key
difference that errors thrown from within a test file are caught and get reported with a
a stacktrace in the JUnit report. In addition, some extra metrics are recored for the JUnit
report, such as: timestamp, test duration, hostname and if tests are disabled (see details for
more info).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>runTestDir(
  dir = "inst/tinytest",
  at_home = FALSE,
  pattern = "^test.*\\.[rR]$",
  cluster = NULL,
  lc_collate = getOption("tt.collate", NA),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="runTestDir_+3A_dir">dir</code></td>
<td>
<p><code>character(1)</code> path to directory</p>
</td></tr>
<tr><td><code id="runTestDir_+3A_at_home">at_home</code></td>
<td>
<p><code>logical(1)</code> should local tests be run? By default FALSE. Unlike
<code><a href="tinytest.html#topic+run_test_dir">tinytest::run_test_dir()</a></code> which is meant to be called in a local interactive context. This
function is meant to be called in a non-interactive CI environment, where we want to mimic the
behaviour of how tests would get run by R CMD Check.
See also <code>at_home</code> documentation in tinytest package.</p>
</td></tr>
<tr><td><code id="runTestDir_+3A_pattern">pattern</code></td>
<td>
<p><code>character(1)</code> A regular expression that is used to find
scripts in <code>dir</code> containing tests (by default <code>.R</code> or <code>.r</code>
files starting with <code>test</code>).</p>
</td></tr>
<tr><td><code id="runTestDir_+3A_cluster">cluster</code></td>
<td>
<p>A <code>cluster</code> object to run the test files on. Note, it is
expected that the clusters has already been prepared. Most notable, the package to test
should already been loaded. <code>runTestDir</code> will load the package
&quot;tinytest&quot; for you into the clusters. See <code><a href="tinytest.html#topic+run_test_dir">tinytest::run_test_dir()</a></code> for more details.</p>
</td></tr>
<tr><td><code id="runTestDir_+3A_lc_collate">lc_collate</code></td>
<td>
<p>See <code><a href="tinytest.html#topic+run_test_dir">tinytest::run_test_dir()</a></code>.</p>
</td></tr>
<tr><td><code id="runTestDir_+3A_...">...</code></td>
<td>
<p>Arguments passed on to <code><a href="tinytest.html#topic+run_test_file">tinytest::run_test_file()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p><code><a href="#topic+runTestDir">runTestDir()</a></code> is meant as a CI-friendly alternative to the native <code><a href="tinytest.html#topic+run_test_dir">tinytest::run_test_dir()</a></code>.
It catches errors that are raised in the tests files and adds them as a &quot;failed&quot; <code>tinytest</code>
in the output.
</p>
<p><code><a href="tinytest.html#topic+run_test_dir">tinytest::run_test_dir()</a></code> would have let the error bubble up, stop the testing process and
not report any failures from other tests. One is then also forced to look into the
logs of the CI to see what the error was. The output of <code><a href="#topic+runTestDir">runTestDir()</a></code> in combination with
<code><a href="#topic+writeJUnit">writeJUnit()</a></code> will present you the error in the JUnit togheter with a stack trace. Next to the
test results of the other files that ran without a problem.
</p>
<p>If you prefer the behaviour of <code><a href="tinytest.html#topic+run_test_dir">tinytest::run_test_dir()</a></code> you can still use it in combination
<code><a href="#topic+writeJUnit">writeJUnit()</a></code>.
</p>
<p>Caught errors are returned in the output as as sub-class of <code>tinytest</code> object. This is however
considred implemenation detail and can be subject to change.
</p>
<p>Note, function arguments explicilty listed in <code><a href="tinytest.html#topic+run_test_dir">tinytest::run_test_dir()</a></code> but not here can still
still be provided via <code>...</code>
</p>


<h3>Value</h3>

<p>A <code>tinytests2Junit</code> object to be provided to the <code><a href="#topic+writeJUnit">writeJUnit()</a></code> function.
</p>


<h3>tinytests2JUnit</h3>

<p>The returned object is a <code>tinytests2JUnit</code> object (note the plural). This object
contains additional info compared to a <code>tinytests</code> object that is used in the JUnit report.
</p>
<p>The following additional info will get reported:
</p>

<ul>
<li><p> The timestamp per test file on when it got invoked.
</p>
</li>
<li><p> The test duration per test file.
</p>
</li>
<li><p> The system hostname per test file on where it got invoked. This is mainly of interests for
different <code>clusters</code>.
</p>
</li>
<li><p> If a test file is disabled. A test file is considered disabled if no tests
occur with in the file.
It is then assumed that at the top of file some conditional statement
made the test file exist early.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="tinytest.html#topic+run_test_dir">tinytest::run_test_dir()</a></code> for how the function is inteded to behave.
</p>
</li>
<li> <p><code><a href="#topic+writeJUnit">writeJUnit()</a></code> where it is expected that the output of this function to be provided to.
</p>
</li>
<li> <p><code><a href="#topic+testPackage">testPackage()</a></code> for an higher-level function to simply test a package.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Run tests with `tinytest`
dirWithTests &lt;- system.file("example_tests/multiple_files",package = "tinytest2JUnit")
testresults &lt;- runTestDir(dirWithTests)

writeJUnit(testresults) # Writes content to stdout
</code></pre>

<hr>
<h2 id='runTestFile'>Internal wrapper arround tinytest::run_test_file</h2><span id='topic+runTestFile'></span>

<h3>Description</h3>

<p>Internal wrapper arround <code><a href="tinytest.html#topic+run_test_file">tinytest::run_test_file()</a></code> that records the test duration and
catches uncaught errors and logs the stacktrace of where the error occured.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>runTestFile(file, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="runTestFile_+3A_file">file</code></td>
<td>
<p><code>character(1)</code> test file to run.</p>
</td></tr>
<tr><td><code id="runTestFile_+3A_...">...</code></td>
<td>
<p>arguments passed on to <code><a href="tinytest.html#topic+run_test_file">tinytest::run_test_file()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The response is a subclass of the <code>tinytests</code> object called: <code>tinytests2Junit</code>
object which captures additional info for the reporting to JUnit:
</p>

<ul>
<li><p> Duration to run the file.
</p>
</li>
<li><p> Timestamp when the test was run.
</p>
</li>
<li><p> hostname of the computer where it was ran on.
</p>
</li></ul>

<p>The caught error is turned into a subclass uncaught-error of tinytest. This is implementation
detail and only to be understood by constructJUnitTag.
</p>
<p>If an error occured it is captured and <code>uncaught-error</code> object (subclass of <code>tinytest</code>) is
returned in the <code>tinytests</code> object.
This tinytest object represents a &quot;failed&quot; tests that will get reported as an Error in the
JUnit. Various aspects of the error are also captured like the the stacktrace.
</p>


<h3>Value</h3>

<p>a <code>tinytests2JUnit</code> object (being a subclass of <code>tinytest</code> object).
</p>

<hr>
<h2 id='sideeffectTestcaseTag'>Construct a testcase-tag for a side-effect test.</h2><span id='topic+sideeffectTestcaseTag'></span>

<h3>Description</h3>

<p>Construct a testcase-tag for a side-effect test.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sideeffectTestcaseTag(tinytest)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sideeffectTestcaseTag_+3A_tinytest">tinytest</code></td>
<td>
<p>a <code>tinytest</code> object already validated to be a &quot;SIDE-EFFECT&quot; test.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>testase</code> <code>XMLtag</code>
</p>

<hr>
<h2 id='tag'>XML tag</h2><span id='topic+tag'></span>

<h3>Description</h3>

<p>Create a list object that roughly mimics the behaviour of a simplistic XML tag element.
Supported are XML tag-name, tag-attributes and tag-content.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tag(name, attributes = list(), content = list())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tag_+3A_name">name</code></td>
<td>
<p><code>character(1)</code> specifying the name of the tag.</p>
</td></tr>
<tr><td><code id="tag_+3A_attributes">attributes</code></td>
<td>
<p><code>named-list</code> being the XML attributes.
Names = attribute names, Values = attribute value.</p>
</td></tr>
<tr><td><code id="tag_+3A_content">content</code></td>
<td>
<p><code>unnamed-list</code> being the content XML-tag. Either child <code>XMLtag</code> or only
a single character vector being the xml text content. Currently no mixed-content is allowed.
See details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If a character vector is in the content it is converted to a single-length character vector.
See <code><a href="#topic+charVecToSingleLength">charVecToSingleLength()</a></code>
</p>
<p>Mixed content eg. a text string and a child xml tag next to each other is syntaxtically allows.
In practices it does not occur for XML that is schema formatted with XSD (like JUnit).
So for simplicity it is not supported here.
</p>


<h3>Value</h3>

<p>a <code>XMLtag</code>-object.
</p>

<hr>
<h2 id='testPackage'>Test an R package and report the results in JUnit</h2><span id='topic+testPackage'></span>

<h3>Description</h3>

<p>Run all tests of a package and report the results as JUnit xml. This function
can be seen as a drop in replacement for <code><a href="tinytest.html#topic+test_package">tinytest::test_package()</a></code> but with a
key difference that uncaught errors will be catched and reported JUnit!
This function is intended to be used in a test stage of a CI build.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>testPackage(
  pkgname,
  file = stdout(),
  errorOnFailure = TRUE,
  testdir = "tinytest",
  lib.loc = NULL,
  at_home = FALSE,
  ncpu = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="testPackage_+3A_pkgname">pkgname</code></td>
<td>
<p><code>character(1)</code>. Name of the package to tests.</p>
</td></tr>
<tr><td><code id="testPackage_+3A_file">file</code></td>
<td>
<p><code>character(1) | connection</code>: Full file path or connection object to write the
JUnit xml content to. By default <code>stdout()</code> connection is used.
<strong>Warning</strong> if the file already exist it will be overwritten!</p>
</td></tr>
<tr><td><code id="testPackage_+3A_erroronfailure">errorOnFailure</code></td>
<td>
<p><code>logical(1)</code> Should an error be raised (after writing the JUnit) when a
at least one test failed? By default TRUE. This is done as a
convenience to have the CI fail at the test stage on failure.</p>
</td></tr>
<tr><td><code id="testPackage_+3A_testdir">testdir</code></td>
<td>
<p><code>character(1)</code> testing directory of the package. See ?<code><a href="tinytest.html#topic+test_package">tinytest::test_package()</a></code>
for more details.</p>
</td></tr>
<tr><td><code id="testPackage_+3A_lib.loc">lib.loc</code></td>
<td>
<p><code>character(1) | NULL</code> Library location where the package is installed.
By default: <code>NULL</code> meaning the package is searched on the standard .libPaths().</p>
</td></tr>
<tr><td><code id="testPackage_+3A_at_home">at_home</code></td>
<td>
<p><code>logical(1)</code> should local test be run? By default FALSE as we want to as closely
mimic the environement of how tests would get ran in CRAN.
See for more details <code><a href="tinytest.html#topic+test_package">tinytest::test_package()</a></code>.</p>
</td></tr>
<tr><td><code id="testPackage_+3A_ncpu">ncpu</code></td>
<td>
<p><code style="white-space: pre;">&#8288;postive integer(1) | clutser&#8288;</code> Either an integer specifying the amount of cpu's
to parralize the testing over or a <code>cluster</code> object to run the tests in.</p>
</td></tr>
<tr><td><code id="testPackage_+3A_...">...</code></td>
<td>
<p>Extra arguments passed on to <code><a href="#topic+runTestDir">runTestDir()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p><code><a href="#topic+testPackage">testPackage()</a></code> is meant as a CI-friendly alternative to the native <code><a href="tinytest.html#topic+test_package">tinytest::test_package()</a></code>.
Next to directly reporting the tests results in a JUnit xml format, it also catches errors that
are raised in the tests files and reports them as &quot;error&quot; in the JUnit.
</p>
<p><code><a href="tinytest.html#topic+test_package">tinytest::test_package()</a></code> would have let the error bubble up, stop the testing
process and not report any failures from other test files. One is then also forced
to look into the logs of the CI to see what the error was. <code><a href="#topic+testPackage">testPackage()</a></code> presents you that
error in the JUnit with a stacktrace. Next to all the test results of the other files that
ran without a problem.
</p>
<p>If you prefer the behaviour from <code><a href="tinytest.html#topic+test_package">tinytest::test_package()</a></code>, you can still use it in
combination with <code><a href="#topic+writeJUnit">writeJUnit()</a></code> if all tests results pass.
</p>
<p>Just like <code><a href="tinytest.html#topic+test_package">tinytest::test_package()</a></code> an error is raised if at least one failure occured during
testing. Obviously catched errors are also seen as failures. This error is raised
<strong>after</strong> the test results have been written away to the file, such that your CI can still pick
it up and report the failure.
The error raising is done as a convenience to stop the CI from continue if test-failure occured.
You can opt-out of this behaviour by setting the <code>errorOnFailure</code> parameter to FALSE. Then a
case <code>tinytests2JUnit</code> object is returned (a sub-class of <code>tinytests</code> object containing addition
info for the JUnit).
Caught errors are also captured in this object as <code>tinytest</code>-objects. They
actually have a special sub-class but this is considered an internal implemenation detail.
</p>
<p><code><a href="#topic+testPackage">testPackage()</a></code> is NOT meant to be called from within your <code>tests/tinytests.R</code> file! Tests
invoked by R CMD Check or on CRAN should still make use of <code><a href="tinytest.html#topic+test_package">tinytest::test_package()</a></code>.
This function is only meant to be called from within a testing step in your CI to
report the test results in an JUnit xml format.
</p>


<h3>Value</h3>

<p>If <code>errorOnFailure</code> = FALSE, a <code>tinytests2JUnit</code> object (a subclass of <code>tinytests</code>
object that captures more info for export to JUnit). Else, an error is raised if at least
on failure occurs. Meant as convenience to automatically stop the CI build.
</p>


<h3>Side-effects</h3>

<p>Side effects are registered as 'passed' tests in the JUnit output and have been given a status
&quot;SIDE-EFFECT&quot;. The call and diff is also returned in the standard-output of the testcase tag.
</p>
<p>They are not considred failures and would thus not stop a pipeline.
</p>


<h3>tinytests to JUnit</h3>

<p>To comply the the JUnit specification the tests results are adapted as follows:
</p>

<ul>
<li><p> A single test run <code>tinytests</code> is mapped to a <code style="white-space: pre;">&#8288;&lt;testsuites&gt;&#8288;</code> tag.
</p>
</li>
<li><p> All <code>tinytest</code> results from a single file are mapped to a single <code style="white-space: pre;">&#8288;&lt;testsuite&gt;&#8288;</code> tag.
</p>

<ul>
<li><p> The name of the testsuite is equal to the test file name (without the file suffix)
</p>
</li></ul>

</li>
<li><p> An individual <code>tinytest</code> object (eg. a single <code style="white-space: pre;">&#8288;except_*&#8288;</code> exception test) is mapped to a
<code style="white-space: pre;">&#8288;&lt;testcase&gt;&#8288;</code> tag.
</p>

<ul>
<li><p> The name of the testcase is equal to the fileName + Line specification of where the expect
statement is performed + the info.
</p>
</li></ul>

</li></ul>

<p>For reference: <a href="https://llg.cubic.org/docs/junit/">https://llg.cubic.org/docs/junit/</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+runTestDir">runTestDir()</a></code> and <code><a href="tinytest.html#topic+test_package">tinytest::test_package()</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>tmpFile &lt;- tempfile(fileext = ".xml")
testPackage("tinytest", file = tmpFile, verbose = 0)
</code></pre>

<hr>
<h2 id='writeJUnit'>Write the results of a <code>tinytests</code>-object into JUnit xml report.</h2><span id='topic+writeJUnit'></span>

<h3>Description</h3>

<p>Write the <code>tinytests</code>-object to a JUnit XML reporting file. If a <code>tinytests2JUnit</code> is provided
(returned by <code><a href="#topic+runTestDir">runTestDir()</a></code>) more info will get reported.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>writeJUnit(tinytests, file = stdout(), overwrite = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="writeJUnit_+3A_tinytests">tinytests</code></td>
<td>
<p><code>tinytests</code>-object to convert to JUnit xml.</p>
</td></tr>
<tr><td><code id="writeJUnit_+3A_file">file</code></td>
<td>
<p><code>character(1) | connection</code>: Full file path or connection object to write the
JUnit xml content to. By default <code>stdout()</code> connection is used.</p>
</td></tr>
<tr><td><code id="writeJUnit_+3A_overwrite">overwrite</code></td>
<td>
<p><code>logical(1)</code>: should the file be overwritten if it already exist?
By default TRUE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>invisible(TRUE)</code> Might get another use in the future.
</p>


<h3>Errors</h3>

<p>In case of overwrite = FALSE and the file already exists an error is thrown.
</p>


<h3>Side-effects</h3>

<p>Side effects are registered as 'passed' tests in the JUnit output and have been given a status
&quot;SIDE-EFFECT&quot;. The call and diff is also returned in the standard-output of the testcase tag.
</p>
<p>They are not considred failures and would thus not stop a pipeline.
</p>


<h3>tinytests to JUnit</h3>

<p>To comply the the JUnit specification the tests results are adapted as follows:
</p>

<ul>
<li><p> A single test run <code>tinytests</code> is mapped to a <code style="white-space: pre;">&#8288;&lt;testsuites&gt;&#8288;</code> tag.
</p>
</li>
<li><p> All <code>tinytest</code> results from a single file are mapped to a single <code style="white-space: pre;">&#8288;&lt;testsuite&gt;&#8288;</code> tag.
</p>

<ul>
<li><p> The name of the testsuite is equal to the test file name (without the file suffix)
</p>
</li></ul>

</li>
<li><p> An individual <code>tinytest</code> object (eg. a single <code style="white-space: pre;">&#8288;except_*&#8288;</code> exception test) is mapped to a
<code style="white-space: pre;">&#8288;&lt;testcase&gt;&#8288;</code> tag.
</p>

<ul>
<li><p> The name of the testcase is equal to the fileName + Line specification of where the expect
statement is performed + the info.
</p>
</li></ul>

</li></ul>

<p>For reference: <a href="https://llg.cubic.org/docs/junit/">https://llg.cubic.org/docs/junit/</a>
</p>


<h3>See Also</h3>

<p>The JUnit XML report format:  <a href="https://llg.cubic.org/docs/junit/">https://llg.cubic.org/docs/junit/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Run tests with `tinytest`
dirWithTests &lt;- system.file("example_tests/multiple_files",package = "tinytest2JUnit")
testresults &lt;- runTestDir(dirWithTests)

writeJUnit(testresults) # Writes content to stdout

tmpFile &lt;- tempfile(fileext = ".xml")
writeJUnit(tinytests = testresults, file = tmpFile)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
