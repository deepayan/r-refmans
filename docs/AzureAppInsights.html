<!DOCTYPE html><html><head><title>Help for package AzureAppInsights</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {AzureAppInsights}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#AzureAppInsights-package'><p>Azure Application Insights for web pages</p></a></li>
<li><a href='#config'><p>Configure Azure Application Insights</p></a></li>
<li><a href='#demo'><p>Demonstration of Application Insights</p></a></li>
<li><a href='#is_instrumentation_key'><p>Check if string matches pattern for an instrumentation key.</p></a></li>
<li><a href='#startAzureAppInsights'><p>Include and run Azure Application Insights for web pages</p></a></li>
<li><a href='#trackEvent'><p>Sends an event or set of metrics to Application Insights</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Include Azure Application Insights in Shiny Apps</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Imports Azure Application Insights for web pages into Shiny apps
    via Microsoft's JavaScript snippet. 
    Allows app developers to submit page tracking and submit events.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/stefanedwards/AzureAppInsights/issues">https://github.com/stefanedwards/AzureAppInsights/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>shiny (&ge; 1.5.0), rlang (&ge; 0.4.11), assertthat (&ge; 0.2.0),
jsonlite (&ge; 1.7.2), lubridate (&ge; 1.7)</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, here</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Collate:</td>
<td>'0aux.R' 'AzureAppInsights-package.R' 'cfg.R' 'demo.R'
'include_snippet.R' 'tracking.R'</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-06-13 11:45:33 UTC; smhe</td>
</tr>
<tr>
<td>Author:</td>
<td>Stefan McKinnon Edwards [aut, cre],
  Kamstrup A/S [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Stefan McKinnon Edwards &lt;smhe@kamstrup.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-06-13 14:40:08 UTC</td>
</tr>
</table>
<hr>
<h2 id='AzureAppInsights-package'>Azure Application Insights for web pages</h2><span id='topic+AzureAppInsights'></span><span id='topic+AzureAppInsights-package'></span>

<h3>Description</h3>

<p>Add Azure Application Insights tracking to a Shiny App.
<em>Requires an active Azure subscription and Application Insights instrumentation key!</em>
Based on <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/javascript">https://docs.microsoft.com/en-us/azure/azure-monitor/app/javascript</a> /
<a href="https://github.com/microsoft/ApplicationInsights-JS">https://github.com/microsoft/ApplicationInsights-JS</a>.
</p>


<h3>Details</h3>

<p>Documentation in this page will be limited, as most is explained on the main page.
</p>
<p>Supports so far only
<code>pageViews</code> (automatically sent),
<code>autoTrackPageVisitTime</code> (when configured with <code><a href="#topic+config">config</a></code>),
<code>customEvents</code> (see <code><a href="#topic+trackEvent">trackEvent</a></code>).
</p>


<h3>Author(s)</h3>

<p>Stefan McKinnon Edwards &lt;smhe@kamstrup.dk&gt;
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li><p> Report bugs at <a href="https://github.com/stefanedwards/AzureAppInsights/issues">https://github.com/stefanedwards/AzureAppInsights/issues</a>
</p>
</li></ul>


<hr>
<h2 id='config'>Configure Azure Application Insights</h2><span id='topic+config'></span>

<h3>Description</h3>

<p>Ensures an instrumentationKey/connectionString and appId is provided.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>config(
  appId,
  instrumentationKey,
  connectionString,
  autoTrackPageVisitTime = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="config_+3A_appid">appId</code></td>
<td>
<p>String for identifying your app, if you use same Application Insights for multiple apps.</p>
</td></tr>
<tr><td><code id="config_+3A_instrumentationkey">instrumentationKey</code>, <code id="config_+3A_connectionstring">connectionString</code></td>
<td>
<p>Credentials for sending to Application Insights.
<code>connectionString</code> is preferred for newer accounts and must contain both <code>InstrumentationKey</code> and <code>IngestionEndpoint</code>.</p>
</td></tr>
<tr><td><code id="config_+3A_autotrackpagevisittime">autoTrackPageVisitTime</code></td>
<td>
<p>Submits how long time a user spent on the *previous* page (see website for more information).</p>
</td></tr>
<tr><td><code id="config_+3A_...">...</code></td>
<td>
<p>Additional options, as given in <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/javascript#configuration">https://docs.microsoft.com/en-us/azure/azure-monitor/app/javascript#configuration</a>.
No checks performed here.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See https://docs.microsoft.com/en-us/azure/azure-monitor/app/javascript#configuration
for explanation of options.
</p>
<p>If jsonlite is playing tricks on the arguments given, wrap the value with <code>I</code>.
E.g. if you want to force an atomic vector of length 1 to be parsed as an array, use
<code>I(3.14)</code>.
</p>


<h3>Value</h3>

<p>List.
</p>

<hr>
<h2 id='demo'>Demonstration of Application Insights</h2><span id='topic+demo'></span>

<h3>Description</h3>

<p>Launches a simple demonstration of using Application Insights for Shiny apps.
Requires that you have a Microsoft Azure Application Insights resource to
send to; demonstration will still work &ndash; your metrics will just be sent to oblivion.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>demo(
  connectionString,
  debug = TRUE,
  appId = "Test AzureAppInsights",
  launch.browser = FALSE,
  instrumentationKey
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="demo_+3A_connectionstring">connectionString</code>, <code id="demo_+3A_instrumentationkey">instrumentationKey</code></td>
<td>
<p>Credentials for sending to Application Insights.
See arguments for <code><a href="#topic+config">config</a></code>.</p>
</td></tr>
<tr><td><code id="demo_+3A_debug">debug</code></td>
<td>
<p>Logical, see <code><a href="#topic+startAzureAppInsights">startAzureAppInsights</a></code>.</p>
</td></tr>
<tr><td><code id="demo_+3A_appid">appId</code></td>
<td>
<p>A id for this particular application.</p>
</td></tr>
<tr><td><code id="demo_+3A_launch.browser">launch.browser</code></td>
<td>
<p>Logical, see <code><a href="shiny.html#topic+runApp">runApp</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It may take some minutes before the values sent to Application Insights are
visible in the logs on portal.azure.com.
</p>
<p>If neither <code>connectionString</code> nor <code>instrumentationKey</code> is provided,
a connection string is found in the environment variable <code>AAI_CONNSTR</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>connstr &lt;- paste0(
  'InstrumentationKey=00000000-0000-0000-0000-000000000000;',
  'IngestionEndpoint=https://northeurope-0.in.applicationinsights.azure.com/;',
  'LiveEndpoint=https://northeurope.livediagnostics.monitor.azure.com/')
## Not run: 
 demo(connstr)

## End(Not run)
</code></pre>

<hr>
<h2 id='is_instrumentation_key'>Check if string matches pattern for an instrumentation key.</h2><span id='topic+is_instrumentation_key'></span>

<h3>Description</h3>

<p>Check if string matches pattern for an instrumentation key.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_instrumentation_key(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is_instrumentation_key_+3A_x">x</code></td>
<td>
<p>A string containing nothing else but an instrumentation key.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Logical value.
</p>

<hr>
<h2 id='startAzureAppInsights'>Include and run Azure Application Insights for web pages</h2><span id='topic+startAzureAppInsights'></span><span id='topic+includeAzureAppInsights'></span>

<h3>Description</h3>

<p>Include the JS snippet in your <code>ui</code>-function with <code>includeAzureAppInsights</code>
and start the tracking with <code>startAzureAppInsights</code> in your <code>server</code>-function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>startAzureAppInsights(
  session,
  cfg,
  instance.name = "appInsights",
  ld = 0,
  useXhr = TRUE,
  crossOrigin = "anonymous",
  onInit = NULL,
  heartbeat = 3e+05,
  extras = list(),
  include.ip = FALSE,
  cookie.user = FALSE,
  debug = FALSE
)

includeAzureAppInsights(version = c("2.8.14", "2.7.0"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="startAzureAppInsights_+3A_session">session</code></td>
<td>
<p>The <code>session</code> object passed to function given to <code>shinyServer</code>.</p>
</td></tr>
<tr><td><code id="startAzureAppInsights_+3A_cfg">cfg</code></td>
<td>
<p>List-object from <code><a href="#topic+config">config</a></code>.</p>
</td></tr>
<tr><td><code id="startAzureAppInsights_+3A_instance.name">instance.name</code></td>
<td>
<p>Global JavaScript Instance name defaults to &quot;appInsights&quot; when not supplied. <em>NOT</em> the app's name. Used for accessing the instance from other JavaScript routines.</p>
</td></tr>
<tr><td><code id="startAzureAppInsights_+3A_ld">ld</code></td>
<td>
<p>Defines the load delay (in ms) before attempting to load the sdk. -1 = block page load and add to head. (default) = 0ms load after timeout,</p>
</td></tr>
<tr><td><code id="startAzureAppInsights_+3A_usexhr">useXhr</code></td>
<td>
<p>Logical, use XHR instead of fetch to report failures (if available).</p>
</td></tr>
<tr><td><code id="startAzureAppInsights_+3A_crossorigin">crossOrigin</code></td>
<td>
<p>When supplied this will add the provided value as the cross origin attribute on the script tag.</p>
</td></tr>
<tr><td><code id="startAzureAppInsights_+3A_oninit">onInit</code></td>
<td>
<p>Once the application insights instance has loaded and initialized this callback function will be called with 1 argument &ndash; the sdk instance</p>
</td></tr>
<tr><td><code id="startAzureAppInsights_+3A_heartbeat">heartbeat</code></td>
<td>
<p>Integer, how often should the heartbeat beat &ndash; or set to <code>FALSE</code> to disable.</p>
</td></tr>
<tr><td><code id="startAzureAppInsights_+3A_extras">extras</code></td>
<td>
<p>(Named) list of values to add to any tracking.</p>
</td></tr>
<tr><td><code id="startAzureAppInsights_+3A_include.ip">include.ip</code></td>
<td>
<p>Logical, adds <code>ip</code> to all tracking's <code>customDimension</code>. See note.</p>
</td></tr>
<tr><td><code id="startAzureAppInsights_+3A_cookie.user">cookie.user</code></td>
<td>
<p>Logical, when <code>TRUE</code> sets a cookie with a random string and submits this
along with any tracking with the key <code>userid</code>.</p>
</td></tr>
<tr><td><code id="startAzureAppInsights_+3A_debug">debug</code></td>
<td>
<p>Logical, JS loader uses <code>console.log</code>.</p>
</td></tr>
<tr><td><code id="startAzureAppInsights_+3A_version">version</code></td>
<td>
<p>Version of the Application Insights JavaScript SDK to load.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Methods sends data to client's browser; returns the sent list, invisibly.
</p>


<h3>Tracking users' ip-address</h3>

<p>Generally, Azure's Application Insight does not collect the users' ip-address,
due to it being somewhat sensitive data (<a href="https://learn.microsoft.com/en-us/azure/azure-monitor/app/ip-collection?tabs=net">link</a>).
</p>
<p><code><a href="#topic+startAzureAppInsights">startAzureAppInsights</a></code> however has the argument 'include.ip' which,
when set to <code>TRUE</code>, will add the entry <code>ip</code> to all trackings.
The tracked ip-address is taken from <code>session$request$REMOTE_ADDR</code>,
which is an un-documented feature and may or may not be the users ip-address.
</p>


<h3>References</h3>

<p>https://docs.microsoft.com/en-us/azure/azure-monitor/app/javascript
and
https://github.com/microsoft/ApplicationInsights-JS
and
https://learn.microsoft.com/en-us/azure/azure-monitor/app/ip-collection?tabs=net
</p>

<hr>
<h2 id='trackEvent'>Sends an event or set of metrics to Application Insights</h2><span id='topic+trackEvent'></span><span id='topic+trackMetric'></span>

<h3>Description</h3>

<p>Use <code>trackEvent</code> for tracking a single event together with any extra properties.
</p>
<p>Use <code>trackMetric</code> to track a summary of some measured metrics.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trackEvent(session, name, properties)

trackMetric(session, name, metrics, properties)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trackEvent_+3A_session">session</code></td>
<td>
<p>The <code>session</code> object passed to function given to <code>shinyServer</code>.</p>
</td></tr>
<tr><td><code id="trackEvent_+3A_name">name</code></td>
<td>
<p>Name of the event.</p>
</td></tr>
<tr><td><code id="trackEvent_+3A_properties">properties</code></td>
<td>
<p>List of properties to track. <code>appId</code> and any extras given in
<code><a href="#topic+startAzureAppInsights">startAzureAppInsights</a></code> is automatically inserted.</p>
</td></tr>
<tr><td><code id="trackEvent_+3A_metrics">metrics</code></td>
<td>
<p>Numeric vector of values to calculate summary on. Non-finite values are removed.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Method sends data to client's browser; returns the sent list, invisibly.
</p>


<h3>Tracking Metrics</h3>

<p>Individual measured values are not sent to Application Insights. Instead,
summaries of the values (mean, range, average, standard deviation) are sent.
<em>Note:</em> Standard deviation doesn't quite work yet.
</p>
<p>Before calculating summaries, non-finite values are removed (see <code><a href="base.html#topic+is.finite">is.finite</a></code>).
If there are no values in <code>metrics</code>, nothing is sent.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
