<!DOCTYPE html><html><head><title>Help for package patchSynctex</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {patchSynctex}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#patchSynctex-package'>
<p>Allows for communication between .Rnw editor and .pdf viewer.</p></a></li>
<li><a href='#patchSynctex'><p>Create correspondence between .pdf and .Rnw files</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Communication Between Editor and Viewer for Literate Programs</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1-4</td>
</tr>
<tr>
<td>Date:</td>
<td>2016-12-12</td>
</tr>
<tr>
<td>Depends:</td>
<td>tools, stringr</td>
</tr>
<tr>
<td>Enhances:</td>
<td>knitr, utils</td>
</tr>
<tr>
<td>Description:</td>
<td>This utility eases the debugging of literate documents
	     ('noweb' files) by patching the synchronization information
	     (the '.synctex(.gz)' file) produced by 'pdflatex' with
	     concordance information produced by 'Sweave' or 'knitr' and
	     'Sweave' or 'knitr' ; this allows for bilateral communication
	     between a text editor (visualizing the 'noweb' source) and
	     a viewer (visualizing the resultant 'PDF'), thus bypassing
	     the intermediate 'TeX' file.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/EmmanuelCharpentier/patchSynctex">https://github.com/EmmanuelCharpentier/patchSynctex</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2016-12-12 17:48:18 UTC; charpent</td>
</tr>
<tr>
<td>Author:</td>
<td>Jan Gleixner [aut],
  Daniel Hicks [ctb],
  Kyle J. Harms [ctb],
  Emmanuel Charpentier [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Emmanuel Charpentier &lt;emm.charpentier@free.fr&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2016-12-13 01:31:40</td>
</tr>
</table>
<hr>
<h2 id='patchSynctex-package'>
Allows for communication between .Rnw editor and .pdf viewer.
</h2><span id='topic+patchSynctex-package'></span>

<h3>Description</h3>

<p>Utility patching the .synctec(.gz) file resulting from then
<code>LaTeX</code>ing of a .tex file with the concordance information from the
.concordance.tex file resulting from knitting (possibly Sweaving) of the
.Rnw source, allowing(for|back)ward searching from the editor to the viewer and back.
</p>


<h3>Details</h3>

<p>Synchronising TeX source and DVI/PDF output considerably eases
the editing (and, sometimes, debugging) of such documents, by allowing
interaction between source and end-result. Modern DVI/PDF viewers and
editors support this synchronization, either directly, by using
information embedded in the <code>.dvi</code> or <code>.pdf</code> file, or by
using an auxilliary file generated by a LaTeX run with option
<code>\synctex=1</code>, teh <code>.synctex(.gz)</code> file.
</p>
<p>However, when one uses a tool such as <code>Sweave</code> or <code>knitr</code> to
generate a dynamic document (compounding analysis, computations and
report), the resulting <code>.tex</code> file is no longer the original
source, and the references to the <code>.tex</code> file are of little help in
the revision of such a document.
</p>
<p>Duncan Murdoch's <strong>patchDVI</strong> package aims at solving this problem
by using a <em>concordance</em> file that can be generated by passing a
<code>concordance=TRUE</code> option so <code>Sweave</code> or <code>knit*</code>. This
<code>-concordance.tex</code> file contains an RLE encoding of the
correspondence between the <code>.Rnw</code> source and the <code>.tex</code>
intermediary file.
</p>
<p><strong>patchDVI</strong> uses this concordance information to patch the DVI
pointers to source with the relevant pointers to the <code>.Rnw</code> file.
</p>
<p>This package also has a <code>patchSynctex</code> function, attempting t find
the relevant information in the <code>.pdf</code> file. However, some (most ?)
PDFs happens to be impenetrable to <strong>patchDVI</strong>'s
<code>patchSynctex</code> function.
</p>
<p>The present package aims at patching the <code>.synctex(.gz)</code> file with
pointers to the original <code>.Rnw</code> source(s), using exclusively the
<code>.synctex(.gz)</code> file as a source of information. Therefore, the
tools (editors and viewers) must support Synctex in such a way that,
when a <code>.synctex(.gz)</code> file is present, this information is
preffered to the information present in the DVI or PDF document.
</p>
<p>This turns out, according to some serious googling and limited testing,
to be the case with :
</p>

<ul>
<li><p> under Linux: <code>emacs</code>, <code>gedit</code> (editors),
<code>evince</code>, <code>okular</code> (viewers), <code>RStudio</code> (IDE);
</p>
</li>
<li><p> under MS-Windows: <code>emacs</code> (editor), <code>Sumatra</code>
(viewer), <code>RStudio</code> (IDE).

</p>
</li></ul>

<p>Furthermore, the <code>.synctex(.gz)</code> file file remains necessary for
any synchronization, whereas a patched <code>.dvi</code> file can in principle
be used without the <code>.synctex(.gz)</code> file.
</p>
<p>This package is mostly aimed at <strong>programs</strong> (integrated
development environments (IDEs), such as <code>RStudio</code>, or programmable
editors, such as <code>emacs</code> and <code>gedit</code>) able to get R to execute
code: it gives them an easy-to-use interface to a simple function does
the ncessary patches for a given document (characterized by its name
sans extension).
</p>
<p>Its unique function can still be used from an interactive R session for
debugging purposes.
</p>


<h3>Integration in editors and IDEs</h3>

<p><em>This section will be enriched by <strong>your</strong> contributions.</em>
</p>


<h4><code>ESS</code> under <code>emacs</code></h4>

<p>The logical point of insertion of <code>.synctex(.gz)</code> patching is
after each PDF compilation. It may be a bit wasteful (when two or
more compilations are necessary, in order, for example, to fix
references), but there is no standard way to determine if a LaTeX run
is final.
</p>
<p>This can be achieved by placing an advice on the function used to
compile to PDF|DVI. The example shows how to advice PDF compilation.
</p>


<h5>Up to <code>emacs</code> 24.3</h5>

<p>The following <code>elisp</code> snippet can be placed in your
<code>emacs</code> initialization file (e. g. <code>~/.emacs</code> in
Unix(-like) systems): 
</p>
<pre>
(defadvice ess-swv-PDF (after ess-run-patchKnitr (&amp;optional
						  PDFLATEX-CMD)
			      activate)
  "Patches the .synctex.gz file after PDF compilation"
  (interactive)
  (let* ((fn (buffer-file-name))
	 (fe (file-name-extension fn)))
    (if (string= fe "Rnw")
	(progn
	  (setq RPScmd (concat "patchSynctex('"
			       (file-name-sans-extension fn)
			       "')"))
	  (ess-create-temp-buffer "tampon-ess-execute")
	  (ess-execute "require(patchSynctex)" 'buffer "tampon-ess-execute")
	  (ess-execute RPScmd 'buffer "tampon-ess-execute")
	  (kill-buffer "tampon-ess-execute")))))
(ad-activate 'ess-swv-PDF)
      </pre>



<h5>From <code>emacs</code> 24.4 onwards</h5>

<p>The previous <code>elisp</code> snippet has to be adapted to the newer
<code>advice</code> system of <code>elisp</code>:
</p>
<pre>

(defun ess-swv-patch-after-PDF (&amp;optional PDFLATEX-CMD)
  "Patch the synctex file after PDF compilation"
  (let* ((fn (buffer-file-name))
	 (fe (file-name-extension fn)))
    (if (string= fe "Rnw")
	(progn
	  (setq RPScmd (concat "patchSynctex('"
			       (file-name-sans-extension fn)
			       "')"))
	  (ess-create-temp-buffer "tampon-ess-execute")
	  (ess-execute "require(patchSynctex)" 'buffer "tampon-ess-execute")
	  (ess-execute RPScmd 'buffer "tampon-ess-execute")
	  (kill-buffer "tampon-ess-execute")))))
(advice-add 'ess-swv-PDF :after #'ess-swv-patch-after-PDF)
      </pre>




<h4><code>AUCTeX</code> under <code>emacs</code></h4>

<p>This is a work in progress : <code>AUCTeX</code> is more sophisticated
than <code>ESS</code> about PDF production. There is no single function to
advice (and <code>knit</code>ting is not yet well integrated, by the
way...). In the meantime, <code>ESS</code> functions remain
available. <em>Stay tuned...</em>
</p>



<h4>Eclipse + StatET</h4>

<p>Create an external build configuration (Sweave document processing)
and place :
</p>
<pre>
require(knitr); 
opts_knit$set(concordance = TRUE); 
texfile &lt;- knit("${resource_loc:${source_file_path}}", encoding="UTF-8")
    </pre>
<p>in the <code>sweave</code> tab, and :
</p>
<pre>
syntex &lt;- if (opts_knit$get('concordance'))"-synctex=1" else "-synctex=0";
command=paste("latexmk -pdf", syntex, "-interaction=nonstopmode", shQuote(texfile));
print(paste("Command ",command,"...\n"));
print(shell(command),intern = TRUE);
if (opts_knit$get('concordance')){
    require(patchSynctex);
    patchSynctex(texfile); 
}
print(paste0(substr(texfile,1, nchar(texfile)-3), "pdf"))
      </pre>
<p>in the <code>LaTeX</code> tab.
</p>



<h3>Note</h3>

<p> The current (1.8) version of <code>knitr</code> does not yet implement
concordance for multifile projects (i. e. children chunks). </p>


<h3>Author(s)</h3>

<p>Jan Gleixner, Emmanuel Charpentier
</p>
<p>Maintainer: Emmanuel Charpentier <a href="emm.charpentier@free.fr">emm.charpentier@free.fr</a> </p>


<h3>References</h3>

<p>Duncan Murdoch's excellent
<a href="https://CRAN.R-project.org/package=patchDVI">patchDVI</a> has a
great vignette explaining the basics of the problem.
</p>

<hr>
<h2 id='patchSynctex'>Create correspondence between .pdf and .Rnw files</h2><span id='topic+patchSynctex'></span>

<h3>Description</h3>

<p><code>patchSynctex(foo)</code> uses the concordance file
<code>foo-concordance.tex</code> generated by <code>knit</code>ting (possibly
<code>Sweave</code>ing) <code>foo.Rnw</code> with the option <code>concordance=TRUE</code>
to patch <code>foo.synctex(.gz)</code> with information pointing to
<code>foo.Rnw</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>patchSynctex(nwfile, syncfile=NULL, verbose=FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="patchSynctex_+3A_nwfile">nwfile</code></td>
<td>
<p> name of the file to patch (used sans extension).  </p>
</td></tr>
<tr><td><code id="patchSynctex_+3A_syncfile">syncfile</code></td>
<td>
<p> output sync file (if nwfile is related to an included
file). </p>
</td></tr>
<tr><td><code id="patchSynctex_+3A_verbose">verbose</code></td>
<td>
<p> if TRUE, emit a message stating the number of
patches. Useful for debugging integration in your tools. </p>
</td></tr>
<tr><td><code id="patchSynctex_+3A_...">...</code></td>
<td>

<p>Unused. Allows any argument forced by your tools to be passed
without causing an error.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function reads the information given in the
<code>nwfile-concordance.tex</code> file (which <em>must</em> exist) to patch
the <code>nwfile.synctex(.gz)</code> file, which originally contains
pointers from <code>nwfile.pdf</code> to the source in <code>nwfile.tex</code>
with information pointing to the latter's source in <code>nwfile.Rnw</code>.
</p>
<p>Editors and viewers supporting Synctex will be able to use this
information to allow forward- and backward search between PDF and ists
original source, thus easing debugging.
</p>
<p>The <code>nwfile</code> will be used sans extension ; this allows your
favorite IDE to pass either the name of the noweb file or the name of
the .tex file.
</p>
<p>The <code>syncfile</code> argument allows to force the addition of the
patched references to the main syncfile for a document that uses
subfiles. This is a workaround that may or may not be well-supported
by <code>knitr</code> and/or your viewer.
</p>
<p>The function may raise errors (files not found), warnings (no patch
found to be done) or messages (number of patched locations).
</p>
<p>This function is principally intended for use by programmable IDEs able
to execute <code>R</code> code. It is documented mostly for debugging
purposes.
</p>


<h3>Value</h3>

<p>Nothing useful.</p>


<h3>Note</h3>

<p> The current (1.8) version of <code>knitr</code> does not yet implement
concordance for multifile projects (i. e. children chunks). </p>


<h3>Author(s)</h3>

<p>Jan Gleixner, Emmanuel Charpentier <a href="mailto:emm.charpentier@free.fr">emm.charpentier@free.fr</a></p>


<h3>References</h3>

<p>Duncan Murdoch's excellent <code>patchDVI</code> package:
<a href="https://cran.r-project.org/package=patchDVI">https://cran.r-project.org/package=patchDVI</a>. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(requireNamespace("tools", quietly=TRUE) &amp;&amp;
   requireNamespace("knitr", quietly=TRUE)) {
    ## Minimal demonstrative knitr example.
    RnwSrc&lt;-"
\\synctex=1
\\documentclass{article}
&lt;&lt;Setup, eval=TRUE, echo=FALSE, results='hide'&gt;&gt;=
opts_knit$set(concordance=TRUE, self.contained=TRUE)##$
require(patchSynctex)
@ 
\\author{A.~U.~Thor}
\\title{A minimal \\textsf{knitr} example}
\\date{Some time}
\\begin{document}
\\maketitle

A first paragraph of text, which offers a target for forward search\\,:
for example, in \\textsf{emacs} with \\textsf{AUCTeX}, typing
``C-c~C-v'' should bring you to your PDF viewer in the corresponding
typeset line.

&lt;&lt;TestFig, echo=FALSE&gt;&gt;=
curve(sin(x), from=-pi, to=pi, main='A curve generated by R',
      sub='back-searching from here should bring you close to the \\'TestFig\\' chunk.')
@ 

This second paragraph of text is also a convenient target for
back-searching. For example, in \\textsf{evince}, a ``&lt;Ctrl&gt;-click''
should bring you to the \\textsf{noweb} source, bypassing the \\LaTeX
intermediate file.
\\end{document}
"
    require(knitr)
    cat(RnwSrc, file="Minimal.Rnw")
    knit2pdf("Minimal.Rnw", quiet=TRUE)
    D1&lt;-file.info("Minimal.synctex.gz")$mtime
    patchSynctex("Minimal", verbose=TRUE)
    ## should print a message telling the number of patches
    D2&lt;-file.info("Minimal.synctex.gz")$mtime
    D1!=D2
    ## should return TRUE
    ## To see the effect, try (example on a Linux system)
    ## Not run: system("evince Minimal.pdf")
}
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
