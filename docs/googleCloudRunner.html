<!DOCTYPE html><html><head><title>Help for package googleCloudRunner</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {googleCloudRunner}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#Build'><p>Build Object</p></a></li>
<li><a href='#BuildTrigger'><p>BuildTrigger Object</p></a></li>
<li><a href='#cr_bucket_set'><p>Get/Set the Cloud Storage bucket for your Cloud Build Service</p></a></li>
<li><a href='#cr_build'><p>Starts a build with the specified configuration.</p></a></li>
<li><a href='#cr_build_artifacts'><p>Download artifacts from a build</p></a></li>
<li><a href='#cr_build_list'><p>Lists the build</p></a></li>
<li><a href='#cr_build_logs'><p>Download logs from a Cloud Build</p></a></li>
<li><a href='#cr_build_make'><p>Make a Cloud Build object out of a cloudbuild.yml file</p></a></li>
<li><a href='#cr_build_schedule_http'><p>Create a Cloud Scheduler HTTP target from a Cloud Build object</p></a></li>
<li><a href='#cr_build_source'><p>Build a source object</p></a></li>
<li><a href='#cr_build_status'><p>Returns information about a previously requested build.</p></a></li>
<li><a href='#cr_build_targets'><p>Set up Google Cloud Build to run a targets pipeline</p></a></li>
<li><a href='#cr_build_upload_gcs'><p>Create a StorageSource</p></a></li>
<li><a href='#cr_build_wait'><p>Wait for a Build to run</p></a></li>
<li><a href='#cr_build_write'><p>Write out a Build object to cloudbuild.yaml</p></a></li>
<li><a href='#cr_build_yaml'><p>Create a cloudbuild Yaml object in R</p></a></li>
<li><a href='#cr_build_yaml_artifact'><p>Add an artifact for cloudbuild.yaml</p></a></li>
<li><a href='#cr_build_yaml_secrets'><p>Create an availableSecrets entry for build yaml</p></a></li>
<li><a href='#cr_buildstep'><p>Create a yaml build step</p></a></li>
<li><a href='#cr_buildstep_bash'><p>Run a bash script in a Cloud Build step</p></a></li>
<li><a href='#cr_buildstep_compute_container'><p>Buildstep to deploy to Google Compute Engine</p></a></li>
<li><a href='#cr_buildstep_decrypt'><p>Create a build step for decrypting files via KMS</p></a></li>
<li><a href='#cr_buildstep_df'><p>Convert a data.frame into cr_buildstep</p></a></li>
<li><a href='#cr_buildstep_docker'><p>Create a build step to build and push a docker image</p></a></li>
<li><a href='#cr_buildstep_edit'><p>Modify an existing buildstep with new parameters</p></a></li>
<li><a href='#cr_buildstep_extract'><p>Extract a buildstep from a Build object</p></a></li>
<li><a href='#cr_buildstep_gcloud'><p>A buildstep template for gcloud</p></a></li>
<li><a href='#cr_buildstep_gitsetup'><p>Create a build step for authenticating with Git</p></a></li>
<li><a href='#cr_buildstep_mailgun'><p>Send an email in a Cloud Build step via MailGun.org</p></a></li>
<li><a href='#cr_buildstep_nginx_setup'><p>Setup nginx for Cloud Run in a buildstep</p></a></li>
<li><a href='#cr_buildstep_packagetests'><p>Do R package tests and upload to Codecov</p></a></li>
<li><a href='#cr_buildstep_pkgdown'><p>Create buildsteps for deploying an R pkgdown website to GitHub</p></a></li>
<li><a href='#cr_buildstep_r'><p>Run an R script in a Cloud Build R step</p></a></li>
<li><a href='#cr_buildstep_run'><p>Create buildsteps to deploy to Cloud Run</p></a></li>
<li><a href='#cr_buildstep_secret'><p>Create a buildstep for using Secret Manager</p></a></li>
<li><a href='#cr_buildstep_slack'><p>Send a Slack message to a channel from a Cloud Build step</p></a></li>
<li><a href='#cr_buildstep_targets'><p>Buildstep to run a targets pipeline on Cloud Build</p></a></li>
<li><a href='#cr_buildtrigger'><p>Create a new BuildTrigger</p></a></li>
<li><a href='#cr_buildtrigger_copy'><p>Copy a buildtrigger</p></a></li>
<li><a href='#cr_buildtrigger_delete'><p>Deletes a 'BuildTrigger' by its project ID and trigger ID.This API is experimental.</p></a></li>
<li><a href='#cr_buildtrigger_edit'><p>Updates a 'BuildTrigger' by its project ID and trigger ID.This API is experimental.</p></a></li>
<li><a href='#cr_buildtrigger_get'><p>Returns information about a 'BuildTrigger'.This API is experimental.</p></a></li>
<li><a href='#cr_buildtrigger_list'><p>Lists existing 'BuildTrigger's.This API is experimental.</p></a></li>
<li><a href='#cr_buildtrigger_pubsub'><p>Create a buildtrigger pub/sub object</p></a></li>
<li><a href='#cr_buildtrigger_repo'><p>Create a buildtrigger repo object</p></a></li>
<li><a href='#cr_buildtrigger_run'><p>Runs a 'BuildTrigger' at a particular source revision.</p></a></li>
<li><a href='#cr_buildtrigger_webhook'><p>Create a buildtrigger webhook object</p></a></li>
<li><a href='#cr_deploy_badger'><p>Deploy a Cloud Run app to display build badges</p></a></li>
<li><a href='#cr_deploy_docker'><p>Deploy a local Dockerfile to be built on ContainerRegistry</p></a></li>
<li><a href='#cr_deploy_docker_trigger'><p>Deploy Docker build from a Git repo</p></a></li>
<li><a href='#cr_deploy_gadget'><p>Launch the googleCloudRunner deployment RStudio gadget</p></a></li>
<li><a href='#cr_deploy_packagetests'><p>Deploy a cloudbuild.yml for R package tests and upload to Codecov</p></a></li>
<li><a href='#cr_deploy_pkgdown'><p>Deploy a cloudbuild.yml for a pkgdown website of an R package</p></a></li>
<li><a href='#cr_deploy_r'><p>Deploy an R script with an optional schedule</p></a></li>
<li><a href='#cr_deploy_run'><p>Deploy to Cloud Run</p></a></li>
<li><a href='#cr_deploy_run_website'><p>Deploy HTML built from a repo each commit</p></a></li>
<li><a href='#cr_email_get'><p>Get/Set cloud build email</p></a></li>
<li><a href='#cr_jwt_create'><p>Create a JSON Web Token (JWT) from your service client and call Google services</p></a></li>
<li><a href='#cr_plumber_pubsub'><p>Plumber - Pub/Sub parser</p></a></li>
<li><a href='#cr_project_set'><p>Get/Set the projectId for your CloudRun services</p></a></li>
<li><a href='#cr_pubsub'><p>Send a message to pubsub</p></a></li>
<li><a href='#cr_region_set'><p>Get/Set the endpoint for your CloudRun services</p></a></li>
<li><a href='#cr_regions'><p>Cloud Run Regions</p></a></li>
<li><a href='#cr_run'><p>Create a CloudRun service.</p></a></li>
<li><a href='#cr_run_email'><p>Create an invoker email for use within authenticated Cloud Run</p></a></li>
<li><a href='#cr_run_get'><p>Get information about a Cloud Run service.</p></a></li>
<li><a href='#cr_run_list'><p>List CloudRun services.</p></a></li>
<li><a href='#cr_run_schedule_http'><p>Create a Cloud Scheduler HTTP target for a private Cloud Run URI</p></a></li>
<li><a href='#cr_schedule_build'><p>Schedule a Build object via HTTP or PubSub</p></a></li>
<li><a href='#cr_schedule_delete'><p>Deletes a scheduled job.</p></a></li>
<li><a href='#cr_schedule_get'><p>Gets a scheduler job.</p></a></li>
<li><a href='#cr_schedule_list'><p>Lists Cloud Scheduler jobs.</p></a></li>
<li><a href='#cr_schedule_pause'><p>Pauses and resumes a scheduled job.</p></a></li>
<li><a href='#cr_schedule_run'><p>Forces a job to run now.</p></a></li>
<li><a href='#cr_setup'><p>A helper setup function for setting up use with googleCloudRunner</p></a></li>
<li><a href='#cr_setup_auth'><p>Create a service account for googleCloudRunner</p></a></li>
<li><a href='#cr_setup_service'><p>Give a service account the right permissions for googleCloudRunner operations</p></a></li>
<li><a href='#cr_setup_test'><p>Run tests over your setup</p></a></li>
<li><a href='#cr_sourcerepo_list'><p>List source repositories available under a project</p></a></li>
<li><a href='#GitHubEventsConfig'><p>GitHubEventsConfig Object</p></a></li>
<li><a href='#googleCloudRunner'><p>Launch R scripts into the Google Cloud via Cloud Build, Cloud Run and Cloud Scheduler</p></a></li>
<li><a href='#HttpTarget'><p>HttpTarget Object</p></a></li>
<li><a href='#Job'><p>Job Schedule Object</p></a></li>
<li><a href='#PubsubConfig'><p>Pubsub Config (Build Trigger)</p></a></li>
<li><a href='#PubsubTarget'><p>Pubsub Target Object (Cloud Scheduler)</p></a></li>
<li><a href='#RepoSource'><p>RepoSource Object</p></a></li>
<li><a href='#Source'><p>Source Object</p></a></li>
<li><a href='#StorageSource'><p>StorageSource Object</p></a></li>
<li><a href='#WebhookConfig'><p>WebhookConfig (Build Triggers)</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>R Scripts in the Google Cloud via Cloud Run, Cloud Build and
Cloud Scheduler</td>
</tr>
<tr>
<td>Version:</td>
<td>0.5.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Tools to easily enable R scripts in the Google Cloud Platform.
  Utilise cloud services such as Cloud Run <a href="https://cloud.google.com/run/">https://cloud.google.com/run/</a> for R 
  over HTTP, Cloud Build <a href="https://cloud.google.com/build">https://cloud.google.com/build</a> for Continuous 
  Delivery and Integration services and 
  Cloud Scheduler <a href="https://cloud.google.com/scheduler/">https://cloud.google.com/scheduler/</a> for scheduled scripts.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://code.markedmondson.me/googleCloudRunner/">https://code.markedmondson.me/googleCloudRunner/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/MarkEdmondson1234/googleCloudRunner/issues">https://github.com/MarkEdmondson1234/googleCloudRunner/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.3.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>assertthat (&ge; 0.2.0), cli (&ge; 2.0.2), curl (&ge; 4.3),
googleAuthR (&ge; 2.0.0), googleCloudStorageR (&ge; 0.7.0),
googlePubsubR (&ge; 0.0.2), httr (&ge; 1.4.1), jose (&ge; 1.0),
jsonlite (&ge; 1.5), openssl (&ge; 1.4.1), plumber (&ge; 1.0.0),
usethis (&ge; 1.6.0), utils, withr, yaml (&ge; 2.2.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, markdown, miniUI, rmarkdown, rstudioapi, shiny,
targets, testthat (&ge; 2.1.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Config/testthat/parallel:</td>
<td>false</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-02-28 09:32:46 UTC; mark</td>
</tr>
<tr>
<td>Author:</td>
<td>Mark Edmondson <a href="https://orcid.org/0000-0002-8434-3881"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Sunholo Ltd [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Mark Edmondson &lt;r@sunholo.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-02-28 09:40:01 UTC</td>
</tr>
</table>
<hr>
<h2 id='Build'>Build Object</h2><span id='topic+Build'></span>

<h3>Description</h3>

<p>Build Object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Build(
  Build.substitutions = NULL,
  Build.timing = NULL,
  results = NULL,
  logsBucket = NULL,
  steps = NULL,
  buildTriggerId = NULL,
  id = NULL,
  tags = NULL,
  startTime = NULL,
  substitutions = NULL,
  timing = NULL,
  sourceProvenance = NULL,
  createTime = NULL,
  images = NULL,
  projectId = NULL,
  logUrl = NULL,
  finishTime = NULL,
  source = NULL,
  options = NULL,
  timeout = NULL,
  status = NULL,
  statusDetail = NULL,
  artifacts = NULL,
  secrets = NULL,
  availableSecrets = NULL,
  serviceAccount = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Build_+3A_build.substitutions">Build.substitutions</code></td>
<td>
<p>The Build.substitutions object or list of objects</p>
</td></tr>
<tr><td><code id="Build_+3A_build.timing">Build.timing</code></td>
<td>
<p>The Build.timing object or list of objects</p>
</td></tr>
<tr><td><code id="Build_+3A_results">results</code></td>
<td>
<p>Output only</p>
</td></tr>
<tr><td><code id="Build_+3A_logsbucket">logsBucket</code></td>
<td>
<p>Google Cloud Storage bucket where logs should be written (see</p>
</td></tr>
<tr><td><code id="Build_+3A_steps">steps</code></td>
<td>
<p>Required</p>
</td></tr>
<tr><td><code id="Build_+3A_buildtriggerid">buildTriggerId</code></td>
<td>
<p>Output only</p>
</td></tr>
<tr><td><code id="Build_+3A_id">id</code></td>
<td>
<p>Output only</p>
</td></tr>
<tr><td><code id="Build_+3A_tags">tags</code></td>
<td>
<p>Tags for annotation of a 'Build'</p>
</td></tr>
<tr><td><code id="Build_+3A_starttime">startTime</code></td>
<td>
<p>Output only</p>
</td></tr>
<tr><td><code id="Build_+3A_substitutions">substitutions</code></td>
<td>
<p>Substitutions data for 'Build' resource</p>
</td></tr>
<tr><td><code id="Build_+3A_timing">timing</code></td>
<td>
<p>Output only</p>
</td></tr>
<tr><td><code id="Build_+3A_sourceprovenance">sourceProvenance</code></td>
<td>
<p>Output only</p>
</td></tr>
<tr><td><code id="Build_+3A_createtime">createTime</code></td>
<td>
<p>Output only</p>
</td></tr>
<tr><td><code id="Build_+3A_images">images</code></td>
<td>
<p>A list of images to be pushed upon the successful completion of all build</p>
</td></tr>
<tr><td><code id="Build_+3A_projectid">projectId</code></td>
<td>
<p>Output only</p>
</td></tr>
<tr><td><code id="Build_+3A_logurl">logUrl</code></td>
<td>
<p>Output only</p>
</td></tr>
<tr><td><code id="Build_+3A_finishtime">finishTime</code></td>
<td>
<p>Output only</p>
</td></tr>
<tr><td><code id="Build_+3A_source">source</code></td>
<td>
<p>A <a href="#topic+Source">Source</a> object specifying the location of the source files to build, usually created by <a href="#topic+cr_build_source">cr_build_source</a></p>
</td></tr>
<tr><td><code id="Build_+3A_options">options</code></td>
<td>
<p>Special options for this build</p>
</td></tr>
<tr><td><code id="Build_+3A_timeout">timeout</code></td>
<td>
<p>Amount of time that this build should be allowed to run, to second</p>
</td></tr>
<tr><td><code id="Build_+3A_status">status</code></td>
<td>
<p>Output only</p>
</td></tr>
<tr><td><code id="Build_+3A_statusdetail">statusDetail</code></td>
<td>
<p>Output only</p>
</td></tr>
<tr><td><code id="Build_+3A_artifacts">artifacts</code></td>
<td>
<p>Artifacts produced by the build that should be uploaded upon</p>
</td></tr>
<tr><td><code id="Build_+3A_secrets">secrets</code></td>
<td>
<p>Secrets to decrypt using Cloud Key Management Service [deprecated]</p>
</td></tr>
<tr><td><code id="Build_+3A_availablesecrets">availableSecrets</code></td>
<td>
<p>preferred way to use Secrets, via Secret Manager</p>
</td></tr>
<tr><td><code id="Build_+3A_serviceaccount">serviceAccount</code></td>
<td>
<p>service account email to be used for the build</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A build resource in the Cloud Build API.
</p>
<p>At a high level, a 'Build' describes where to find source code, how to build it (for example, the builder image to run on the source), and where to store the built artifacts.
</p>


<h3>Value</h3>

<p>Build object
</p>


<h3>Build Macros</h3>

<p>Fields can include the following variables, which will be expanded when the build is created:-
</p>

<ul>
<li><p> $PROJECT_ID: the project ID of the build.
</p>
</li>
<li><p> $BUILD_ID: the autogenerated ID of the build.
</p>
</li>
<li><p> $REPO_NAME: the source repository name specified by RepoSource.
</p>
</li>
<li><p> $BRANCH_NAME: the branch name specified by RepoSource.
</p>
</li>
<li><p> $TAG_NAME: the tag name specified by RepoSource.
</p>
</li>
<li><p> $REVISION_ID or $COMMIT_SHA: the commit SHA specified by RepoSource or  resolved from the specified branch or tag.
</p>
</li>
<li><p>  $SHORT_SHA: first 7 characters of $REVISION_ID or $COMMIT_SHA.
</p>
</li></ul>



<h3>See Also</h3>

<p>Other Cloud Build functions: 
<code><a href="#topic+RepoSource">RepoSource</a>()</code>,
<code><a href="#topic+Source">Source</a>()</code>,
<code><a href="#topic+StorageSource">StorageSource</a>()</code>,
<code><a href="#topic+cr_build_artifacts">cr_build_artifacts</a>()</code>,
<code><a href="#topic+cr_build_list">cr_build_list</a>()</code>,
<code><a href="#topic+cr_build_logs">cr_build_logs</a>()</code>,
<code><a href="#topic+cr_build_make">cr_build_make</a>()</code>,
<code><a href="#topic+cr_build_status">cr_build_status</a>()</code>,
<code><a href="#topic+cr_build_targets">cr_build_targets</a>()</code>,
<code><a href="#topic+cr_build_upload_gcs">cr_build_upload_gcs</a>()</code>,
<code><a href="#topic+cr_build_wait">cr_build_wait</a>()</code>,
<code><a href="#topic+cr_build_write">cr_build_write</a>()</code>,
<code><a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a>()</code>,
<code><a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a>()</code>,
<code><a href="#topic+cr_build_yaml">cr_build_yaml</a>()</code>,
<code><a href="#topic+cr_build">cr_build</a>()</code>
</p>

<hr>
<h2 id='BuildTrigger'>BuildTrigger Object</h2><span id='topic+BuildTrigger'></span>

<h3>Description</h3>

<p>Configuration for an automated build in response to source repositorychanges.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BuildTrigger(
  filename = NULL,
  name = NULL,
  tags = NULL,
  build = NULL,
  ignoredFiles = NULL,
  github = NULL,
  substitutions = NULL,
  includedFiles = NULL,
  disabled = NULL,
  sourceToBuild = NULL,
  triggerTemplate = NULL,
  webhookConfig = NULL,
  description = NULL,
  pubsubConfig = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="BuildTrigger_+3A_filename">filename</code></td>
<td>
<p>Path, from the source root, to a file whose contents is used for the build</p>
</td></tr>
<tr><td><code id="BuildTrigger_+3A_name">name</code></td>
<td>
<p>User assigned name of the trigger</p>
</td></tr>
<tr><td><code id="BuildTrigger_+3A_tags">tags</code></td>
<td>
<p>Tags for annotation of a 'BuildTrigger'</p>
</td></tr>
<tr><td><code id="BuildTrigger_+3A_build">build</code></td>
<td>
<p>Contents of the build template</p>
</td></tr>
<tr><td><code id="BuildTrigger_+3A_ignoredfiles">ignoredFiles</code></td>
<td>
<p>ignored_files and included_files are file glob matches extended with support for &quot;**&quot;.</p>
</td></tr>
<tr><td><code id="BuildTrigger_+3A_github">github</code></td>
<td>
<p>a <a href="#topic+GitHubEventsConfig">GitHubEventsConfig</a> object - mutually exclusive with <code>triggerTemplate</code></p>
</td></tr>
<tr><td><code id="BuildTrigger_+3A_substitutions">substitutions</code></td>
<td>
<p>A named list of Build macro variables</p>
</td></tr>
<tr><td><code id="BuildTrigger_+3A_includedfiles">includedFiles</code></td>
<td>
<p>If any of the files altered in the commit pass the ignored_files</p>
</td></tr>
<tr><td><code id="BuildTrigger_+3A_disabled">disabled</code></td>
<td>
<p>If true, the trigger will never result in a build</p>
</td></tr>
<tr><td><code id="BuildTrigger_+3A_sourcetobuild">sourceToBuild</code></td>
<td>
<p>A <a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a> object (but no regex allowed for branch or tag)  This field is currently only used by Webhook, Pub/Sub, Manual, and Cron triggers and is the source of the build will execute upon.</p>
</td></tr>
<tr><td><code id="BuildTrigger_+3A_triggertemplate">triggerTemplate</code></td>
<td>
<p>a <a href="#topic+RepoSource">RepoSource</a> object - mutually exclusive with <code>github</code></p>
</td></tr>
<tr><td><code id="BuildTrigger_+3A_webhookconfig">webhookConfig</code></td>
<td>
<p>WebhookConfig describes the configuration of a trigger that creates a build whenever a webhook is sent to a trigger's webhook URL.</p>
</td></tr>
<tr><td><code id="BuildTrigger_+3A_description">description</code></td>
<td>
<p>Human-readable description of this trigger</p>
</td></tr>
<tr><td><code id="BuildTrigger_+3A_pubsubconfig">pubsubConfig</code></td>
<td>
<p>PubsubConfig describes the configuration of a trigger that creates a build whenever a Pub/Sub message is published.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>BuildTrigger object
</p>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/build/docs/api/reference/rest/v1/projects.triggers">https://cloud.google.com/build/docs/api/reference/rest/v1/projects.triggers</a>
</p>
<p>Other BuildTrigger functions: 
<code><a href="#topic+GitHubEventsConfig">GitHubEventsConfig</a>()</code>,
<code><a href="#topic+cr_buildtrigger_copy">cr_buildtrigger_copy</a>()</code>,
<code><a href="#topic+cr_buildtrigger_delete">cr_buildtrigger_delete</a>()</code>,
<code><a href="#topic+cr_buildtrigger_edit">cr_buildtrigger_edit</a>()</code>,
<code><a href="#topic+cr_buildtrigger_get">cr_buildtrigger_get</a>()</code>,
<code><a href="#topic+cr_buildtrigger_list">cr_buildtrigger_list</a>()</code>,
<code><a href="#topic+cr_buildtrigger_pubsub">cr_buildtrigger_pubsub</a>()</code>,
<code><a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a>()</code>,
<code><a href="#topic+cr_buildtrigger_run">cr_buildtrigger_run</a>()</code>,
<code><a href="#topic+cr_buildtrigger_webhook">cr_buildtrigger_webhook</a>()</code>,
<code><a href="#topic+cr_buildtrigger">cr_buildtrigger</a>()</code>
</p>

<hr>
<h2 id='cr_bucket_set'>Get/Set the Cloud Storage bucket for your Cloud Build Service</h2><span id='topic+cr_bucket_set'></span><span id='topic+cr_bucket_get'></span>

<h3>Description</h3>

<p>Can also use environment arg GCS_DEFAULT_BUCKET
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_bucket_set(bucket)

cr_bucket_get()
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_bucket_set_+3A_bucket">bucket</code></td>
<td>
<p>The GCS bucket</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
cr_bucket_get()
</code></pre>

<hr>
<h2 id='cr_build'>Starts a build with the specified configuration.</h2><span id='topic+cr_build'></span>

<h3>Description</h3>

<p>This method returns a long-running 'Operation', which includes the buildID. Pass the build ID to <a href="#topic+cr_build_status">cr_build_status</a> to determine the build status (such as 'SUCCESS' or 'FAILURE').
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_build(
  x,
  source = NULL,
  timeout = NULL,
  images = NULL,
  substitutions = NULL,
  serviceAccount = NULL,
  artifacts = NULL,
  options = NULL,
  projectId = cr_project_get(),
  launch_browser = interactive()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_build_+3A_x">x</code></td>
<td>
<p>A cloudbuild.yaml file location or an R object that will be turned into yaml via <a href="yaml.html#topic+as.yaml">as.yaml</a> or a <a href="#topic+Build">Build</a> object created by <a href="#topic+cr_build_make">cr_build_make</a> or from a previous build you want to rerun.</p>
</td></tr>
<tr><td><code id="cr_build_+3A_source">source</code></td>
<td>
<p>A <a href="#topic+Source">Source</a> object specifying the location of the source files to build, usually created by <a href="#topic+cr_build_source">cr_build_source</a></p>
</td></tr>
<tr><td><code id="cr_build_+3A_timeout">timeout</code></td>
<td>
<p>Amount of time that this build should be allowed to run, to second</p>
</td></tr>
<tr><td><code id="cr_build_+3A_images">images</code></td>
<td>
<p>A list of images to be pushed upon the successful completion of all build</p>
</td></tr>
<tr><td><code id="cr_build_+3A_substitutions">substitutions</code></td>
<td>
<p>Substitutions data for 'Build' resource</p>
</td></tr>
<tr><td><code id="cr_build_+3A_serviceaccount">serviceAccount</code></td>
<td>
<p>service account email to be used for the build</p>
</td></tr>
<tr><td><code id="cr_build_+3A_artifacts">artifacts</code></td>
<td>
<p>Artifacts produced by the build that should be uploaded upon</p>
</td></tr>
<tr><td><code id="cr_build_+3A_options">options</code></td>
<td>
<p>Special options for this build</p>
</td></tr>
<tr><td><code id="cr_build_+3A_projectid">projectId</code></td>
<td>
<p>ID of the project</p>
</td></tr>
<tr><td><code id="cr_build_+3A_launch_browser">launch_browser</code></td>
<td>
<p>Whether to launch the logs URL in a browser once deployed</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/build/docs/">Google Documentation for Cloud Build</a>
</p>
<p>Other Cloud Build functions: 
<code><a href="#topic+Build">Build</a>()</code>,
<code><a href="#topic+RepoSource">RepoSource</a>()</code>,
<code><a href="#topic+Source">Source</a>()</code>,
<code><a href="#topic+StorageSource">StorageSource</a>()</code>,
<code><a href="#topic+cr_build_artifacts">cr_build_artifacts</a>()</code>,
<code><a href="#topic+cr_build_list">cr_build_list</a>()</code>,
<code><a href="#topic+cr_build_logs">cr_build_logs</a>()</code>,
<code><a href="#topic+cr_build_make">cr_build_make</a>()</code>,
<code><a href="#topic+cr_build_status">cr_build_status</a>()</code>,
<code><a href="#topic+cr_build_targets">cr_build_targets</a>()</code>,
<code><a href="#topic+cr_build_upload_gcs">cr_build_upload_gcs</a>()</code>,
<code><a href="#topic+cr_build_wait">cr_build_wait</a>()</code>,
<code><a href="#topic+cr_build_write">cr_build_write</a>()</code>,
<code><a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a>()</code>,
<code><a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a>()</code>,
<code><a href="#topic+cr_build_yaml">cr_build_yaml</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cr_project_set("my-project")
my_gcs_source &lt;- cr_build_source(StorageSource("my_code.tar.gz",
  bucket = "gs://my-bucket"
))
my_gcs_source

my_repo_source &lt;- cr_build_source(RepoSource("github_username_my-repo.com",
  branchName = "master"
))
my_repo_source
## Not run: 

# build from a cloudbuild.yaml file
cloudbuild_file &lt;- system.file("cloudbuild/cloudbuild.yaml",
  package = "googleCloudRunner"
)

# asynchronous, will launch log browser by default
b1 &lt;- cr_build(cloudbuild_file)

# synchronous waiting for build to finish
b2 &lt;- cr_build_wait(b1)

# the same results
cr_build_status(b1)
cr_build_status(b2)

# build from a cloud storage source
build1 &lt;- cr_build(cloudbuild_file,
  source = my_gcs_source
)
# build from a git repository source
build2 &lt;- cr_build(cloudbuild_file,
  source = my_repo_source
)

# you can send in results for previous builds to trigger
# the same build under a new Id
# will trigger build2 again
cr_build(build2)

# a build with substitutions (Cloud Build macros)
cr_build(build2, substitutions = list(`_SUB` = "yo"))

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_build_artifacts'>Download artifacts from a build</h2><span id='topic+cr_build_artifacts'></span>

<h3>Description</h3>

<p>If a completed build includes artifact files this downloads them to local files
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_build_artifacts(
  build,
  download_folder = getwd(),
  overwrite = FALSE,
  path_regex = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_build_artifacts_+3A_build">build</code></td>
<td>
<p>A <a href="#topic+Build">Build</a> object that includes the artifact location</p>
</td></tr>
<tr><td><code id="cr_build_artifacts_+3A_download_folder">download_folder</code></td>
<td>
<p>Where to download the artifact files</p>
</td></tr>
<tr><td><code id="cr_build_artifacts_+3A_overwrite">overwrite</code></td>
<td>
<p>Whether to overwrite existing local data</p>
</td></tr>
<tr><td><code id="cr_build_artifacts_+3A_path_regex">path_regex</code></td>
<td>
<p>A regex of files to fetch from the artifact bucket location.  This is due to not being able to support the path globs</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If your artifacts are using file glob (e.g. <code>myfolder/**</code>) to decide which workspace files are uploaded to Cloud Storage, you will need to create a path_regex of similar functionality (<code>"^myfolder/"</code>).  This is not needed if you use absolute path names such as <code>"myfile.csv"</code>
</p>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/build/docs/building/store-build-artifacts">Storing images and artifacts</a>
</p>
<p>Other Cloud Build functions: 
<code><a href="#topic+Build">Build</a>()</code>,
<code><a href="#topic+RepoSource">RepoSource</a>()</code>,
<code><a href="#topic+Source">Source</a>()</code>,
<code><a href="#topic+StorageSource">StorageSource</a>()</code>,
<code><a href="#topic+cr_build_list">cr_build_list</a>()</code>,
<code><a href="#topic+cr_build_logs">cr_build_logs</a>()</code>,
<code><a href="#topic+cr_build_make">cr_build_make</a>()</code>,
<code><a href="#topic+cr_build_status">cr_build_status</a>()</code>,
<code><a href="#topic+cr_build_targets">cr_build_targets</a>()</code>,
<code><a href="#topic+cr_build_upload_gcs">cr_build_upload_gcs</a>()</code>,
<code><a href="#topic+cr_build_wait">cr_build_wait</a>()</code>,
<code><a href="#topic+cr_build_write">cr_build_write</a>()</code>,
<code><a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a>()</code>,
<code><a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a>()</code>,
<code><a href="#topic+cr_build_yaml">cr_build_yaml</a>()</code>,
<code><a href="#topic+cr_build">cr_build</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
#' r &lt;- "write.csv(mtcars,file = 'artifact.csv')"
ba &lt;- cr_build_yaml(
  steps = cr_buildstep_r(r),
  artifacts = cr_build_yaml_artifact("artifact.csv", bucket = "my-bucket")
)
ba

build &lt;- cr_build(ba)
built &lt;- cr_build_wait(build)

cr_build_artifacts(built)

## End(Not run)

</code></pre>

<hr>
<h2 id='cr_build_list'>Lists the build</h2><span id='topic+cr_build_list'></span><span id='topic+cr_build_list_filter'></span>

<h3>Description</h3>

<p>Get a list of builds within your project
</p>
<p>cr_build_list_filter outputs valid filters for <code>cr_build_list</code>'s filter argument
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_build_list(
  filter = NULL,
  projectId = cr_project_get(),
  pageSize = 1000,
  data_frame_output = TRUE
)

cr_build_list_filter(
  field,
  operator = c("=", "!=", "&gt;", "&gt;=", "&lt;", "&lt;="),
  value
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_build_list_+3A_filter">filter</code></td>
<td>
<p>Text filter for the list - use <code>cr_build_list_filter()</code> or a raw string</p>
</td></tr>
<tr><td><code id="cr_build_list_+3A_projectid">projectId</code></td>
<td>
<p>ID of the project</p>
</td></tr>
<tr><td><code id="cr_build_list_+3A_pagesize">pageSize</code></td>
<td>
<p>How many builds to fetch per page</p>
</td></tr>
<tr><td><code id="cr_build_list_+3A_data_frame_output">data_frame_output</code></td>
<td>
<p>If TRUE will output a data.frame of a subset of info from the builds, merged with the list of triggers from <a href="#topic+cr_buildtrigger_list">cr_buildtrigger_list</a>.  Set to FALSE to return a list of Build objects similar to output from <a href="#topic+cr_build_status">cr_build_status</a></p>
</td></tr>
<tr><td><code id="cr_build_list_+3A_field">field</code></td>
<td>
<p>The field you want to filter on.  Will validate.</p>
</td></tr>
<tr><td><code id="cr_build_list_+3A_operator">operator</code></td>
<td>
<p>The type of comparision for the filter</p>
</td></tr>
<tr><td><code id="cr_build_list_+3A_value">value</code></td>
<td>
<p>The value for the filter's field. Auto-formats <code>POSIXct</code> and <code>Date</code> objects</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When <code>data_frame_output=TRUE</code> results are sorted with the latest buildStartTime in the first row
</p>
<p>If filter is <code>NULL</code> then this will return all historic builds.  To use filters, ensure you use <code>""</code> and not <code>''</code> to quote the fields e.g. <code>'status!="SUCCESS"'</code> and <code>'status="SUCCESS"'</code> - see <a href="https://cloud.google.com/build/docs/view-build-results#filtering_build_results_using_queries">Filtering build results docs</a>.  <code>cr_build_list_filter</code> helps you construct valid filters.  More complex filters can be done using a combination of <a href="base.html#topic+paste">paste</a> and <code>cr_build_list_filter()</code> - see examples
</p>
<p>Use <a href="base.html#topic+POSIXct">POSIXct</a> via functions like <a href="base.html#topic+Sys.time">Sys.time</a> to have them formatted into valid timestamps for time related fields, or <a href="base.html#topic+Date">Date</a> objects via functions like <a href="base.html#topic+Sys.Date">Sys.Date</a>
</p>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/build/docs/api/reference/rest/v1/projects.builds/list">https://cloud.google.com/build/docs/api/reference/rest/v1/projects.builds/list</a>
</p>
<p>Other Cloud Build functions: 
<code><a href="#topic+Build">Build</a>()</code>,
<code><a href="#topic+RepoSource">RepoSource</a>()</code>,
<code><a href="#topic+Source">Source</a>()</code>,
<code><a href="#topic+StorageSource">StorageSource</a>()</code>,
<code><a href="#topic+cr_build_artifacts">cr_build_artifacts</a>()</code>,
<code><a href="#topic+cr_build_logs">cr_build_logs</a>()</code>,
<code><a href="#topic+cr_build_make">cr_build_make</a>()</code>,
<code><a href="#topic+cr_build_status">cr_build_status</a>()</code>,
<code><a href="#topic+cr_build_targets">cr_build_targets</a>()</code>,
<code><a href="#topic+cr_build_upload_gcs">cr_build_upload_gcs</a>()</code>,
<code><a href="#topic+cr_build_wait">cr_build_wait</a>()</code>,
<code><a href="#topic+cr_build_write">cr_build_write</a>()</code>,
<code><a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a>()</code>,
<code><a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a>()</code>,
<code><a href="#topic+cr_build_yaml">cr_build_yaml</a>()</code>,
<code><a href="#topic+cr_build">cr_build</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# merge with buildtrigger list
cr_build_list()

# output a list of build objects
cr_build_list(data_frame_output = FALSE)

# output a list of builds that failed using raw string
cr_build_list('status!="SUCCESS"')

# output builds for a specific trigger using raw string
cr_build_list('trigger_id="af2c7ddc-e4eb-4170-b938-a4babb53bac6"')

# use cr_build_list_filter to help validate filters
failed_builds &lt;- cr_build_list_filter("status", "!=", "SUCCESS")
cr_build_list(failed_builds)

f1 &lt;- cr_build_list_filter(
  "trigger_id", "=", "af2c7ddc-e4eb-4170-b938-a4babb53bac6"
)
cr_build_list(f1)

# do AND (and other) filters via paste() and cr_build_list_filter()
cr_build_list(paste(f1, "AND", failed_builds))

# builds in last 5 days
last_five &lt;- cr_build_list_filter("create_time", "&gt;", Sys.Date() - 5)
cr_build_list(last_five)

# builds in last 60 mins
last_hour &lt;- cr_build_list_filter("create_time", "&gt;", Sys.time() - 3600)
cr_build_list(last_hour)

# builds for this package's buildtrigger
gcr_trigger_id &lt;- "0a3cade0-425f-4adc-b86b-14cde51af674"
gcr_bt &lt;- cr_build_list_filter(
  "trigger_id",
  value = gcr_trigger_id
)
gcr_builds &lt;- cr_build_list(gcr_bt)

# get logs for last build
last_build &lt;- gcr_builds[1, ]
last_build_logs &lt;- cr_build_logs(log_url = last_build$bucketLogUrl)
tail(last_build_logs, 10)

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_build_logs'>Download logs from a Cloud Build</h2><span id='topic+cr_build_logs'></span><span id='topic+cr_buildtrigger_logs'></span>

<h3>Description</h3>

<p>This lets you download the logs to your local R session, rather than viewing them in the Cloud Console.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_build_logs(built = NULL, log_url = NULL)

cr_buildtrigger_logs(
  trigger_name = NULL,
  trigger_id = NULL,
  projectId = cr_project_get()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_build_logs_+3A_built">built</code></td>
<td>
<p>The built object from <a href="#topic+cr_build_status">cr_build_status</a> or <a href="#topic+cr_build_wait">cr_build_wait</a></p>
</td></tr>
<tr><td><code id="cr_build_logs_+3A_log_url">log_url</code></td>
<td>
<p>You can optionally instead of <code>built</code> provide the direct gs:// URI to the log here.  It is in the format <code>gs://{{bucket}}/log-{{buildId}}.txt</code></p>
</td></tr>
<tr><td><code id="cr_build_logs_+3A_trigger_name">trigger_name</code></td>
<td>
<p>The trigger name to check, will be used to look up trigger_id</p>
</td></tr>
<tr><td><code id="cr_build_logs_+3A_trigger_id">trigger_id</code></td>
<td>
<p>If supplied, trigger_name will be ignored</p>
</td></tr>
<tr><td><code id="cr_build_logs_+3A_projectid">projectId</code></td>
<td>
<p>The project containing the trigger_id</p>
</td></tr>
</table>


<h3>Details</h3>

<p>By default, Cloud Build stores your build logs in a Google-created Cloud Storage bucket. You can view build logs store in the Google-created Cloud Storage bucket, but you cannot make any other changes to it. If you require full control over your logs bucket, store the logs in a user-created Cloud Storage bucket.
</p>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/build/docs/securing-builds/store-manage-build-logs">https://cloud.google.com/build/docs/securing-builds/store-manage-build-logs</a>
</p>
<p><a href="#topic+cr_build_logs_badger">cr_build_logs_badger</a> to see logs for a badger created build
</p>
<p>Other Cloud Build functions: 
<code><a href="#topic+Build">Build</a>()</code>,
<code><a href="#topic+RepoSource">RepoSource</a>()</code>,
<code><a href="#topic+Source">Source</a>()</code>,
<code><a href="#topic+StorageSource">StorageSource</a>()</code>,
<code><a href="#topic+cr_build_artifacts">cr_build_artifacts</a>()</code>,
<code><a href="#topic+cr_build_list">cr_build_list</a>()</code>,
<code><a href="#topic+cr_build_make">cr_build_make</a>()</code>,
<code><a href="#topic+cr_build_status">cr_build_status</a>()</code>,
<code><a href="#topic+cr_build_targets">cr_build_targets</a>()</code>,
<code><a href="#topic+cr_build_upload_gcs">cr_build_upload_gcs</a>()</code>,
<code><a href="#topic+cr_build_wait">cr_build_wait</a>()</code>,
<code><a href="#topic+cr_build_write">cr_build_write</a>()</code>,
<code><a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a>()</code>,
<code><a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a>()</code>,
<code><a href="#topic+cr_build_yaml">cr_build_yaml</a>()</code>,
<code><a href="#topic+cr_build">cr_build</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
s_yaml &lt;- cr_build_yaml(steps = cr_buildstep("gcloud", "version"))
build &lt;- cr_build_make(s_yaml)
built &lt;- cr_build(build)
the_build &lt;- cr_build_wait(built)
cr_build_logs(the_build)
# [1] "starting build \"6ce86e05-b0b1-4070-a849-05ec9020fd3b\""
# [2] ""
# [3] "FETCHSOURCE"
# [4] "BUILD"
# [5] "Already have image (with digest): gcr.io/cloud-builders/gcloud"
# [6] "Google Cloud SDK 325.0.0"
# [7] "alpha 2021.01.22"
# [8] "app-engine-go 1.9.71"
# ...

## End(Not run)
## Not run: 

# get your trigger name
ts &lt;- cr_buildtrigger_list()
ts$buildTriggerName

my_trigger &lt;- "package-checks"
last_logs &lt;- cr_buildtrigger_logs(my_trigger)

my_trigger_id &lt;- "0a3cade0-425f-4adc-b86b-14cde51af674"
last_logs &lt;- cr_buildtrigger_logs(trigger_id = my_trigger_id)

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_build_make'>Make a Cloud Build object out of a cloudbuild.yml file</h2><span id='topic+cr_build_make'></span>

<h3>Description</h3>

<p>This creates a <a href="#topic+Build">Build</a> object via the standard cloudbuild.yaml format
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_build_make(
  yaml,
  source = NULL,
  timeout = NULL,
  images = NULL,
  artifacts = NULL,
  options = NULL,
  substitutions = NULL,
  availableSecrets = NULL,
  serviceAccount = NULL,
  logsBucket = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_build_make_+3A_yaml">yaml</code></td>
<td>
<p>A <code>Yaml</code> object created from <a href="#topic+cr_build_yaml">cr_build_yaml</a> or a file location of a .yaml/.yml cloud build file</p>
</td></tr>
<tr><td><code id="cr_build_make_+3A_source">source</code></td>
<td>
<p>A <a href="#topic+Source">Source</a> object specifying the location of the source files to build, usually created by <a href="#topic+cr_build_source">cr_build_source</a></p>
</td></tr>
<tr><td><code id="cr_build_make_+3A_timeout">timeout</code></td>
<td>
<p>Amount of time that this build should be allowed to run, to second</p>
</td></tr>
<tr><td><code id="cr_build_make_+3A_images">images</code></td>
<td>
<p>A list of images to be pushed upon the successful completion of all build</p>
</td></tr>
<tr><td><code id="cr_build_make_+3A_artifacts">artifacts</code></td>
<td>
<p>Artifacts that may be built via <a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a></p>
</td></tr>
<tr><td><code id="cr_build_make_+3A_options">options</code></td>
<td>
<p>Options to pass to a Cloud Build</p>
</td></tr>
<tr><td><code id="cr_build_make_+3A_substitutions">substitutions</code></td>
<td>
<p>Substitutions data for 'Build' resource</p>
</td></tr>
<tr><td><code id="cr_build_make_+3A_availablesecrets">availableSecrets</code></td>
<td>
<p>Secret Manager objects built by <a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a></p>
</td></tr>
<tr><td><code id="cr_build_make_+3A_serviceaccount">serviceAccount</code></td>
<td>
<p>service account email to be used for the build</p>
</td></tr>
<tr><td><code id="cr_build_make_+3A_logsbucket">logsBucket</code></td>
<td>
<p>The gs:// location of a bucket to put logs in</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/build/docs/build-config-file-schema">https://cloud.google.com/build/docs/build-config-file-schema</a>
</p>
<p>Other Cloud Build functions: 
<code><a href="#topic+Build">Build</a>()</code>,
<code><a href="#topic+RepoSource">RepoSource</a>()</code>,
<code><a href="#topic+Source">Source</a>()</code>,
<code><a href="#topic+StorageSource">StorageSource</a>()</code>,
<code><a href="#topic+cr_build_artifacts">cr_build_artifacts</a>()</code>,
<code><a href="#topic+cr_build_list">cr_build_list</a>()</code>,
<code><a href="#topic+cr_build_logs">cr_build_logs</a>()</code>,
<code><a href="#topic+cr_build_status">cr_build_status</a>()</code>,
<code><a href="#topic+cr_build_targets">cr_build_targets</a>()</code>,
<code><a href="#topic+cr_build_upload_gcs">cr_build_upload_gcs</a>()</code>,
<code><a href="#topic+cr_build_wait">cr_build_wait</a>()</code>,
<code><a href="#topic+cr_build_write">cr_build_write</a>()</code>,
<code><a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a>()</code>,
<code><a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a>()</code>,
<code><a href="#topic+cr_build_yaml">cr_build_yaml</a>()</code>,
<code><a href="#topic+cr_build">cr_build</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cloudbuild &lt;- system.file("cloudbuild/cloudbuild.yaml",
  package = "googleCloudRunner"
)
cr_build_make(cloudbuild)
</code></pre>

<hr>
<h2 id='cr_build_schedule_http'>Create a Cloud Scheduler HTTP target from a Cloud Build object</h2><span id='topic+cr_build_schedule_http'></span><span id='topic+cr_schedule_http'></span><span id='topic+cr_schedule_pubsub'></span><span id='topic+cr_schedule'></span>

<h3>Description</h3>

<p>This enables Cloud Scheduler to trigger Cloud Builds
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_build_schedule_http(
  build,
  email = cr_email_get(),
  projectId = cr_project_get()
)

cr_schedule_http(build, email = cr_email_get(), projectId = cr_project_get())

cr_schedule_pubsub(
  topicName,
  PubsubMessage = NULL,
  data = NULL,
  attributes = NULL,
  projectId = cr_project_get()
)

cr_schedule(
  name,
  schedule = NULL,
  httpTarget = NULL,
  pubsubTarget = NULL,
  description = NULL,
  overwrite = FALSE,
  timeZone = Sys.timezone(),
  region = cr_region_get(),
  projectId = cr_project_get()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_build_schedule_http_+3A_build">build</code></td>
<td>
<p>A <a href="#topic+Build">Build</a> object created via <a href="#topic+cr_build_make">cr_build_make</a> or <a href="#topic+cr_build">cr_build</a></p>
</td></tr>
<tr><td><code id="cr_build_schedule_http_+3A_email">email</code></td>
<td>
<p>The email that will authenticate the job set via <a href="#topic+cr_email_set">cr_email_set</a></p>
</td></tr>
<tr><td><code id="cr_build_schedule_http_+3A_projectid">projectId</code></td>
<td>
<p>The GCP project to run within usually set with <a href="#topic+cr_project_set">cr_project_set</a></p>
</td></tr>
<tr><td><code id="cr_build_schedule_http_+3A_topicname">topicName</code></td>
<td>
<p>The name of the Cloud Pub/Sub topic or a Topic object from <a href="googlePubsubR.html#topic+topics_get">topics_get</a></p>
</td></tr>
<tr><td><code id="cr_build_schedule_http_+3A_pubsubmessage">PubsubMessage</code></td>
<td>
<p>A <code>PubsubMessage</code> object generated via <a href="googlePubsubR.html#topic+PubsubMessage">PubsubMessage</a>.  If used, then do not send in 'data' or 'attributes' arguments as will be redundant since this variable will hold the information.</p>
</td></tr>
<tr><td><code id="cr_build_schedule_http_+3A_data">data</code></td>
<td>
<p>The message payload for PubsubMessage. An R object that will be turned into JSON via [jsonlite] and then base64 encoded into the PubSub format.</p>
</td></tr>
<tr><td><code id="cr_build_schedule_http_+3A_attributes">attributes</code></td>
<td>
<p>Attributes for PubsubMessage.</p>
</td></tr>
<tr><td><code id="cr_build_schedule_http_+3A_name">name</code></td>
<td>
<p>Name to call your scheduled job</p>
</td></tr>
<tr><td><code id="cr_build_schedule_http_+3A_schedule">schedule</code></td>
<td>
<p>A cron schedule e.g. <code>"15 5 * * *"</code></p>
</td></tr>
<tr><td><code id="cr_build_schedule_http_+3A_httptarget">httpTarget</code></td>
<td>
<p>A HTTP target object <a href="#topic+HttpTarget">HttpTarget</a></p>
</td></tr>
<tr><td><code id="cr_build_schedule_http_+3A_pubsubtarget">pubsubTarget</code></td>
<td>
<p>A Pub/Sub target object <a href="#topic+PubsubTarget">PubsubTarget</a> such as created via <a href="#topic+cr_schedule_pubsub">cr_schedule_pubsub</a></p>
</td></tr>
<tr><td><code id="cr_build_schedule_http_+3A_description">description</code></td>
<td>
<p>Optionally caller-specified in CreateJob or</p>
</td></tr>
<tr><td><code id="cr_build_schedule_http_+3A_overwrite">overwrite</code></td>
<td>
<p>If TRUE and an existing job with the same name exists, will overwrite it with the new parameters</p>
</td></tr>
<tr><td><code id="cr_build_schedule_http_+3A_timezone">timeZone</code></td>
<td>
<p>Specifies the time zone to be used in interpreting schedule. If set to <code>NULL</code> will be &quot;UTC&quot;. Note that some time zones include a provision for daylight savings time.</p>
</td></tr>
<tr><td><code id="cr_build_schedule_http_+3A_region">region</code></td>
<td>
<p>The region usually set with <a href="#topic+cr_region_set">cr_region_set</a></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Ensure you have a service email with <a href="#topic+cr_email_set">cr_email_set</a> of format <code>service-{project-number}@gcp-sa-cloudscheduler.iam.gserviceaccount.com</code> with Cloud Scheduler Service Agent role as per https://cloud.google.com/scheduler/docs/http-target-auth#add
</p>
<p>You can parametrise builds by sending in values within PubSub. To read the data in the message set a substitution variable that picks up the data.  For example <code>_VAR1=$(body.message.data.var1)</code>
</p>
<p>If your schedule to PubSub fails with a permission error, try turning the Cloud Scheduler API off and on again the Cloud Console, which will refresh the Google permissions.
</p>


<h3>Value</h3>

<p><code>cr_schedule_http</code> returns a <a href="#topic+HttpTarget">HttpTarget</a> object for use in <a href="#topic+cr_schedule">cr_schedule</a>
</p>
<p><code>cr_schedule_pubsub</code> returns a <a href="#topic+PubsubTarget">PubsubTarget</a> object for use within <a href="#topic+cr_schedule">cr_schedule</a> or <a href="#topic+cr_schedule_build">cr_schedule_build</a>
</p>
<p>A <code>gar_scheduleJob</code> class object
</p>


<h3>See Also</h3>

<p>https://cloud.google.com/build/docs/api/reference/rest/v1/projects.builds/create
</p>
<p><a href="https://cloud.google.com/scheduler/docs/reference/rest/v1/projects.locations.jobs/create">Google Documentation for Cloud Scheduler</a>
</p>
<p>Other Cloud Scheduler functions: 
<code><a href="#topic+HttpTarget">HttpTarget</a>()</code>,
<code><a href="#topic+Job">Job</a>()</code>,
<code><a href="#topic+PubsubTarget">PubsubTarget</a>()</code>,
<code><a href="#topic+cr_run_schedule_http">cr_run_schedule_http</a>()</code>,
<code><a href="#topic+cr_schedule_delete">cr_schedule_delete</a>()</code>,
<code><a href="#topic+cr_schedule_get">cr_schedule_get</a>()</code>,
<code><a href="#topic+cr_schedule_list">cr_schedule_list</a>()</code>,
<code><a href="#topic+cr_schedule_pause">cr_schedule_pause</a>()</code>,
<code><a href="#topic+cr_schedule_run">cr_schedule_run</a>()</code>
</p>
<p>Other Cloud Scheduler functions: 
<code><a href="#topic+HttpTarget">HttpTarget</a>()</code>,
<code><a href="#topic+Job">Job</a>()</code>,
<code><a href="#topic+PubsubTarget">PubsubTarget</a>()</code>,
<code><a href="#topic+cr_run_schedule_http">cr_run_schedule_http</a>()</code>,
<code><a href="#topic+cr_schedule_delete">cr_schedule_delete</a>()</code>,
<code><a href="#topic+cr_schedule_get">cr_schedule_get</a>()</code>,
<code><a href="#topic+cr_schedule_list">cr_schedule_list</a>()</code>,
<code><a href="#topic+cr_schedule_pause">cr_schedule_pause</a>()</code>,
<code><a href="#topic+cr_schedule_run">cr_schedule_run</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cloudbuild &lt;- system.file("cloudbuild/cloudbuild.yaml", package = "googleCloudRunner")
build1 &lt;- cr_build_make(cloudbuild)
build1
## Not run: 
cr_schedule("cloud-build-test1",
  schedule = "15 5 * * *",
  httpTarget = cr_schedule_http(build1)
)

# a cloud build you would like to schedule
itworks &lt;- cr_build("cloudbuild.yaml", launch_browser = FALSE)

# once working, pass in the build to the scheduler
cr_schedule("itworks-schedule",
  schedule = "15 5 * * *",
  httpTarget = cr_schedule_http(itworks)
)

## End(Not run)
cr_project_set("my-project")
cr_bucket_set("my-bucket")
cloudbuild &lt;- system.file("cloudbuild/cloudbuild.yaml",
  package = "googleCloudRunner"
)
bb &lt;- cr_build_make(cloudbuild)
## Not run: 
# create a pubsub topic either in Google Console webUI or library(googlePubSubR)
library(googlePubsubR)
pubsub_auth()
topics_create("test-topic")

## End(Not run)

# create build trigger that will watch for messages to your created topic
pubsub_trigger &lt;- cr_buildtrigger_pubsub("test-topic")
pubsub_trigger
## Not run: 
# create the build trigger with in-line build
cr_buildtrigger(bb, name = "pubsub-triggered", trigger = pubsub_trigger)


# create scheduler that calls the pub/sub topic
cr_schedule("cloud-build-pubsub",
  "15 5 * * *",
  pubsubTarget = cr_schedule_pubsub("test-topic")
)

## End(Not run)

# builds can be also parametrised to respond to parameters within your pubsub topic
# this cloudbuild echos back the value sent in 'var1'
cloudbuild &lt;- system.file("cloudbuild/cloudbuild_substitutions.yml",
  package = "googleCloudRunner"
)
the_build &lt;- cr_build_make(cloudbuild)

# var1 is sent via Pubsub to the buildtrigger
message &lt;- list(var1 = "hello mum")
send_me &lt;- jsonlite::base64_enc(jsonlite::toJSON(message))

# create build trigger that will work from pub/subscription
pubsub_trigger &lt;- cr_buildtrigger_pubsub("test-topic")
## Not run: 
cr_buildtrigger(the_build, name = "pubsub-triggered-subs", trigger = pubsub_trigger)

# create scheduler that calls the pub/sub topic with a parameter
cr_schedule("cloud-build-pubsub",
  "15 5 * * *",
  pubsubTarget = cr_schedule_pubsub("test-topic",
    data = send_me
  )
)

## End(Not run)

## Not run: 
cr_project_set("my-project")
cr_region_set("europe-west1")
cr_schedule("test",
      "* * * * *",
      httpTarget = HttpTarget(uri="https://code.markedmondson.me"))

# schedule a cloud build (no source)
build1 &lt;- cr_build_make("cloudbuild.yaml")
cr_schedule("cloud-build-test", "15 5 * * *",
             httpTarget = cr_schedule_http(build1))

# schedule a cloud build with code source from GCS bucket
my_gcs_source &lt;- cr_build_upload_gcs("my_folder", bucket = cr_get_bucket())
build &lt;- cr_build_make("cloudbuild.yaml", source = my_gcs_source)
cr_schedule("cloud-build-test2", "15 5 * * *",
            httpTarget = cr_schedule_http(build))

# update a schedule with the same name - only supply what you want to change
cr_schedule("cloud-build-test2", "12 6 * * *", overwrite=TRUE)

# By default will use the timezone as specified by Sys.timezone() - change
# this by supplying it directly
cr_schedule("timzone-utc", "12 2 * * *", timeZone = "UTC")

# schedule private Cloud Run app
# for authenticated Cloud Run apps - create with allowUnauthenticated=FALSE
cr_deploy_run("my-app", allowUnauthenticated = TRUE)

# deploying via R will help create a service email called my-app-invoker
cr_run_email("my-app")
#&gt; "my-app-invoker@your-project.iam.gserviceaccount.com"

# schedule the endpoint
my_app &lt;- cr_run_get("my-app")

endpoint &lt;- paste0(my_app$status$url, "/fetch_stuff")

app_sched &lt;- cr_run_schedule_http(endpoint, http_method = "GET",
                                  email = cr_run_email("my-app"))

cr_schedule("my-app-scheduled-1", schedule = "16 4 * * *",
            httpTarget = app_sched)


# creating build triggers that respond to pubsub events

\dontrun{
# create a pubsub topic either in webUI or via library(googlePubSubR)
library(googlePubsubR)
pubsub_auth()
topics_create("test-topic")
}

# create build trigger that will work from pub/subscription
pubsub_trigger &lt;- cr_buildtrigger_pubsub("test-topic")
pubsub_trigger

\dontrun{
# create the build trigger with in-line build
cr_buildtrigger(bb, name = "pubsub-triggered", trigger = pubsub_trigger)
# create scheduler that calls the pub/sub topic

cr_schedule("cloud-build-pubsub",
            "15 5 * * *",
            pubsubTarget = cr_schedule_pubsub("test-topic"))

}


## End(Not run)
</code></pre>

<hr>
<h2 id='cr_build_source'>Build a source object</h2><span id='topic+cr_build_source'></span><span id='topic+cr_build_source.gar_RepoSource'></span><span id='topic+cr_build_source.gar_StorageSource'></span>

<h3>Description</h3>

<p>This creates a source object for a build.  Note you may instead want to use sources connected to a Build Trigger in which case see <a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_build_source(x)

## S3 method for class 'gar_RepoSource'
cr_build_source(x)

## S3 method for class 'gar_StorageSource'
cr_build_source(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_build_source_+3A_x">x</code></td>
<td>
<p>A <a href="#topic+RepoSource">RepoSource</a> or a <a href="#topic+StorageSource">StorageSource</a> object</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
repo &lt;- RepoSource("my_repo", branchName = "master")
gcs &lt;- StorageSource("my_code.tar.gz", "gs://my-bucket")

cr_build_source(repo)
cr_build_source(gcs)

my_gcs_source &lt;- cr_build_source(gcs)
my_repo_source &lt;- cr_build_source(repo)
## Not run: 

build1 &lt;- cr_build("cloudbuild.yaml", source = my_gcs_source)
build2 &lt;- cr_build("cloudbuild.yaml", source = my_repo_source)

## End(Not run)

</code></pre>

<hr>
<h2 id='cr_build_status'>Returns information about a previously requested build.</h2><span id='topic+cr_build_status'></span>

<h3>Description</h3>

<p>The 'Build' that is returned includes its status (such as 'SUCCESS','FAILURE', or 'WORKING'), and timing information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_build_status(id = .Last.value, projectId = cr_project_get())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_build_status_+3A_id">id</code></td>
<td>
<p>ID of the build or a <code>BuildOperationMetadata</code> object</p>
</td></tr>
<tr><td><code id="cr_build_status_+3A_projectid">projectId</code></td>
<td>
<p>ID of the project</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A gar_Build object <a href="#topic+Build">Build</a> or NULL if not found
</p>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/build/docs/api/reference/rest/v1/projects.builds#Build.Status">https://cloud.google.com/build/docs/api/reference/rest/v1/projects.builds#Build.Status</a>
</p>
<p>Other Cloud Build functions: 
<code><a href="#topic+Build">Build</a>()</code>,
<code><a href="#topic+RepoSource">RepoSource</a>()</code>,
<code><a href="#topic+Source">Source</a>()</code>,
<code><a href="#topic+StorageSource">StorageSource</a>()</code>,
<code><a href="#topic+cr_build_artifacts">cr_build_artifacts</a>()</code>,
<code><a href="#topic+cr_build_list">cr_build_list</a>()</code>,
<code><a href="#topic+cr_build_logs">cr_build_logs</a>()</code>,
<code><a href="#topic+cr_build_make">cr_build_make</a>()</code>,
<code><a href="#topic+cr_build_targets">cr_build_targets</a>()</code>,
<code><a href="#topic+cr_build_upload_gcs">cr_build_upload_gcs</a>()</code>,
<code><a href="#topic+cr_build_wait">cr_build_wait</a>()</code>,
<code><a href="#topic+cr_build_write">cr_build_write</a>()</code>,
<code><a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a>()</code>,
<code><a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a>()</code>,
<code><a href="#topic+cr_build_yaml">cr_build_yaml</a>()</code>,
<code><a href="#topic+cr_build">cr_build</a>()</code>
</p>

<hr>
<h2 id='cr_build_targets'>Set up Google Cloud Build to run a targets pipeline</h2><span id='topic+cr_build_targets'></span><span id='topic+cr_build_targets_artifacts'></span><span id='topic+cr_buildstep_targets_single'></span><span id='topic+cr_buildstep_targets_multi'></span>

<h3>Description</h3>

<p>Creates a Google Cloud Build yaml file so as to execute <a href="targets.html#topic+tar_make">tar_make</a> pipelines
</p>
<p>Historical runs accumulate in the
configured Google Cloud Storage bucket, and the latest output is downloaded before
<a href="targets.html#topic+tar_make">tar_make</a> executes so up-to-date steps do not rerun.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_build_targets(
  buildsteps = cr_buildstep_targets_multi(),
  execute = c("trigger", "now"),
  path = "cloudbuild_targets.yaml",
  local = ".",
  predefinedAcl = "bucketLevel",
  bucket = cr_bucket_get(),
  download_folder = getwd(),
  ...
)

cr_build_targets_artifacts(
  build,
  bucket = cr_bucket_get(),
  target_folder = NULL,
  download_folder = NULL,
  target_subfolder = c("all", "meta", "objects", "user"),
  overwrite = TRUE
)

cr_buildstep_targets_single(
  target_folder = NULL,
  bucket = cr_bucket_get(),
  tar_config = NULL,
  task_image = "gcr.io/gcer-public/targets",
  task_args = NULL,
  tar_make = "targets::tar_make()"
)

cr_buildstep_targets_multi(
  target_folder = NULL,
  bucket = cr_bucket_get(),
  tar_config = NULL,
  task_image = "gcr.io/gcer-public/targets",
  task_args = NULL,
  last_id = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_build_targets_+3A_buildsteps">buildsteps</code></td>
<td>
<p>Generated buildsteps that create the targets build</p>
</td></tr>
<tr><td><code id="cr_build_targets_+3A_execute">execute</code></td>
<td>
<p>Whether to run the Cloud Build now or to write to a file for use within triggers or otherwise</p>
</td></tr>
<tr><td><code id="cr_build_targets_+3A_path">path</code></td>
<td>
<p>File path to write the Google Cloud Build yaml workflow file. Set to NULL to write no file and just return the <code>Yaml</code> object.</p>
</td></tr>
<tr><td><code id="cr_build_targets_+3A_local">local</code></td>
<td>
<p>If executing now, the local folder that will be uploaded as the context for the target build</p>
</td></tr>
<tr><td><code id="cr_build_targets_+3A_predefinedacl">predefinedAcl</code></td>
<td>
<p>The ACL rules for the object uploaded. Set to &quot;bucketLevel&quot; for buckets with bucket level access enabled</p>
</td></tr>
<tr><td><code id="cr_build_targets_+3A_bucket">bucket</code></td>
<td>
<p>The Google Cloud Storage bucket the target metadata will be saved to in folder 'target_folder'</p>
</td></tr>
<tr><td><code id="cr_build_targets_+3A_download_folder">download_folder</code></td>
<td>
<p>Set to NULL to overwrite local _target folder: <code>_targets/*</code> otherwise will write to <code>download_folder/_targets/*</code></p>
</td></tr>
<tr><td><code id="cr_build_targets_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+cr_build_yaml">cr_build_yaml</a></code>, <code><a href="#topic+cr_build_yaml">cr_build_yaml</a></code>
</p>

<dl>
<dt><code>steps</code></dt><dd><p>A vector of <a href="#topic+cr_buildstep">cr_buildstep</a></p>
</dd>
<dt><code>timeout</code></dt><dd><p>How long the entire build will run. If not set will be 10mins</p>
</dd>
<dt><code>logsBucket</code></dt><dd><p>Where logs are written.  If you don't set this field, Cloud Build will use a default bucket to store your build logs.</p>
</dd>
<dt><code>options</code></dt><dd><p>A named list of options</p>
</dd>
<dt><code>substitutions</code></dt><dd><p>Build macros that will replace entries in other elements</p>
</dd>
<dt><code>tags</code></dt><dd><p>Tags for the build</p>
</dd>
<dt><code>secrets</code></dt><dd><p>A secrets object</p>
</dd>
<dt><code>images</code></dt><dd><p>What images will be build from this cloudbuild</p>
</dd>
<dt><code>artifacts</code></dt><dd><p>What artifacts may be built from this cloudbuild - create via <a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a></p>
</dd>
<dt><code>availableSecrets</code></dt><dd><p>What environment arguments from Secret Manager are available to the build - create via <a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a></p>
</dd>
<dt><code>serviceAccount</code></dt><dd><p>What service account should the build be run under?</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="cr_build_targets_+3A_build">build</code></td>
<td>
<p>A <a href="#topic+Build">Build</a> object that includes the artifact location</p>
</td></tr>
<tr><td><code id="cr_build_targets_+3A_target_folder">target_folder</code></td>
<td>
<p>Where target metadata will sit within the Google Cloud Storage bucket as a folder.  If NULL defaults to RStudio project name or &quot;targets_cloudbuild&quot; if no RStudio project found.</p>
</td></tr>
<tr><td><code id="cr_build_targets_+3A_target_subfolder">target_subfolder</code></td>
<td>
<p>If you only want to download a specific folder from the _targets/ folder on Cloud Build then specify it here.</p>
</td></tr>
<tr><td><code id="cr_build_targets_+3A_overwrite">overwrite</code></td>
<td>
<p>Whether to overwrite existing local data</p>
</td></tr>
<tr><td><code id="cr_build_targets_+3A_tar_config">tar_config</code></td>
<td>
<p>An R script that will run before <code>targets::tar_make()</code> in the build e.g. <code>"targets::tar_config_set(script = 'targets/_targets.R')"</code></p>
</td></tr>
<tr><td><code id="cr_build_targets_+3A_task_image">task_image</code></td>
<td>
<p>An existing Docker image that will be used to run your targets workflow after the targets meta has been downloaded from Google Cloud Storage</p>
</td></tr>
<tr><td><code id="cr_build_targets_+3A_task_args">task_args</code></td>
<td>
<p>A named list of additional arguments to send to <a href="#topic+cr_buildstep_r">cr_buildstep_r</a> when its executing the <a href="targets.html#topic+tar_make">tar_make</a> command (such as environment arguments)</p>
</td></tr>
<tr><td><code id="cr_build_targets_+3A_tar_make">tar_make</code></td>
<td>
<p>The R script that will run in the tar_make() step. Modify to include custom settings such as &quot;script&quot;</p>
</td></tr>
<tr><td><code id="cr_build_targets_+3A_last_id">last_id</code></td>
<td>
<p>The final buildstep that needs to complete before the upload.  If left NULL then will default to the last tar_target step.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Steps to set up your target task in Cloud Build:
</p>

<ul>
<li><p> Create your 'targets' workflow.
</p>
</li>
<li><p> Create a Dockerfile that holds the R and system dependencies for your workflow.  You can test the image using <a href="#topic+cr_deploy_docker">cr_deploy_docker</a>.  Include <code>library(targets)</code> dependencies - a Docker image with <code>targets</code> installed is available at <code>gcr.io/gcer-public/targets</code>.
</p>
</li>
<li><p> Run <code>cr_build_targets</code> to create the cloudbuild yaml file.
</p>
</li>
<li><p> Run the build via <a href="#topic+cr_build">cr_build</a> or similar.  Each build should only recompute outdated targets.
</p>
</li>
<li><p> Optionally create a build trigger via <a href="#topic+cr_buildtrigger">cr_buildtrigger</a>.
</p>
</li>
<li><p> Trigger a build. The first trigger will run the targets pipeline, subsequent runs will only recompute the outdated targets.
</p>
</li></ul>

<p>Use <code>cr_build_targets_artifacts</code> to download the return values of a
target Cloud Build, then <a href="targets.html#topic+tar_read">tar_read</a> to read the results.  You can set the downloaded files as the target store via <code>targets::tar_config_set(store="_targets_cloudbuild")</code>.  Set <code>download_folder = "_targets"</code> to overwrite your local targets store.
</p>


<h3>Value</h3>

<p>A Yaml object as generated by <a href="#topic+cr_build_yaml">cr_build_yaml</a> if <code>execute="trigger"</code> or the built object if <code>execute="now"</code>
</p>
<p><code>cr_build_targets_artifacts</code> returns the file path to where the download occurred.
</p>


<h3>DAGs</h3>

<p>If your target workflow has parallel processing steps then leaving this as default <code>cr_buildstep_targets_multi()</code> will create a build that uses waitFor and build ids to create a DAG.  Setting this to <code>cr_buildstep_targets_single()</code> will be single thread but you can then customise the <code>targets::tar_make</code> script.  Or add your own custom target buildsteps here using <a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a> - for example you could create the docker environment targets runs within before the main pipeline.
</p>


<h3>See Also</h3>

<p><a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a> if you want to customise the build
</p>
<p>Other Cloud Build functions: 
<code><a href="#topic+Build">Build</a>()</code>,
<code><a href="#topic+RepoSource">RepoSource</a>()</code>,
<code><a href="#topic+Source">Source</a>()</code>,
<code><a href="#topic+StorageSource">StorageSource</a>()</code>,
<code><a href="#topic+cr_build_artifacts">cr_build_artifacts</a>()</code>,
<code><a href="#topic+cr_build_list">cr_build_list</a>()</code>,
<code><a href="#topic+cr_build_logs">cr_build_logs</a>()</code>,
<code><a href="#topic+cr_build_make">cr_build_make</a>()</code>,
<code><a href="#topic+cr_build_status">cr_build_status</a>()</code>,
<code><a href="#topic+cr_build_upload_gcs">cr_build_upload_gcs</a>()</code>,
<code><a href="#topic+cr_build_wait">cr_build_wait</a>()</code>,
<code><a href="#topic+cr_build_write">cr_build_write</a>()</code>,
<code><a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a>()</code>,
<code><a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a>()</code>,
<code><a href="#topic+cr_build_yaml">cr_build_yaml</a>()</code>,
<code><a href="#topic+cr_build">cr_build</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
write.csv(mtcars, file = "mtcars.csv", row.names = FALSE)

targets::tar_script(
  list(
    targets::tar_target(file1,
      "mtcars.csv", format = "file"),
    targets::tar_target(input1,
      read.csv(file1)),
    targets::tar_target(result1,
      sum(input1$mpg)),
    targets::tar_target(result2,
      mean(input1$mpg)),
    targets::tar_target(result3,
      max(input1$mpg)),
    targets::tar_target(result4,
      min(input1$mpg)),
    targets::tar_target(merge1,
      paste(result1, result2, result3, result4))
    ),
 ask = FALSE)

bs &lt;- cr_buildstep_targets_multi()

# only create the yaml
par_build &lt;- cr_build_targets(bs, path = NULL)
par_build

# clean up example
unlink("mtcars.csv")
unlink("_targets.R")

## Not run: 
# run it immediately in cloud
cr_build_targets(bs, execute="now")

# create a yaml file for use in build triggers
cr_build_targets(bs)

## End(Not run)

</code></pre>

<hr>
<h2 id='cr_build_upload_gcs'>Create a StorageSource</h2><span id='topic+cr_build_upload_gcs'></span><span id='topic+cr_buildstep_source_move'></span>

<h3>Description</h3>

<p>This creates a <a href="#topic+StorageSource">StorageSource</a> object after uploading to Google Cloud Storage
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_build_upload_gcs(
  local,
  remote = paste0(local, format(Sys.time(), "%Y%m%d%H%M%S"), ".tar.gz"),
  bucket = cr_bucket_get(),
  predefinedAcl = "bucketOwnerFullControl",
  deploy_folder = "deploy"
)

cr_buildstep_source_move(deploy_folder)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_build_upload_gcs_+3A_local">local</code></td>
<td>
<p>Local directory containing the Dockerfile etc. you wish to deploy</p>
</td></tr>
<tr><td><code id="cr_build_upload_gcs_+3A_remote">remote</code></td>
<td>
<p>The name of the folder in your bucket</p>
</td></tr>
<tr><td><code id="cr_build_upload_gcs_+3A_bucket">bucket</code></td>
<td>
<p>The Google Cloud Storage bucket to upload to</p>
</td></tr>
<tr><td><code id="cr_build_upload_gcs_+3A_predefinedacl">predefinedAcl</code></td>
<td>
<p>The ACL rules for the object uploaded. Set to &quot;bucketLevel&quot; for buckets with bucket level access enabled</p>
</td></tr>
<tr><td><code id="cr_build_upload_gcs_+3A_deploy_folder">deploy_folder</code></td>
<td>
<p>Which folder to deploy from - this will mean the files uploaded will be by default in <code>/workspace/deploy/</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>cr_build_upload_gcs</code> copies the files into the <code>deploy_folder</code> in your working directory, then tars it for upload.  Files will be available on Cloud Build at <code>/workspace/deploy_folder/*</code>.
</p>
<p><code>cr_buildstep_source_move</code> is a way to move the StorageSource files in <code>/workspace/deploy_folder/*</code> into the root <code>/workspace/*</code> location, which is more consistent with <a href="#topic+RepoSource">RepoSource</a> objects or GitHub build triggers created using <a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a>.  This means the same runtime code can run for both sources.
</p>


<h3>Value</h3>

<p>A Source object
</p>


<h3>See Also</h3>

<p>Other Cloud Build functions: 
<code><a href="#topic+Build">Build</a>()</code>,
<code><a href="#topic+RepoSource">RepoSource</a>()</code>,
<code><a href="#topic+Source">Source</a>()</code>,
<code><a href="#topic+StorageSource">StorageSource</a>()</code>,
<code><a href="#topic+cr_build_artifacts">cr_build_artifacts</a>()</code>,
<code><a href="#topic+cr_build_list">cr_build_list</a>()</code>,
<code><a href="#topic+cr_build_logs">cr_build_logs</a>()</code>,
<code><a href="#topic+cr_build_make">cr_build_make</a>()</code>,
<code><a href="#topic+cr_build_status">cr_build_status</a>()</code>,
<code><a href="#topic+cr_build_targets">cr_build_targets</a>()</code>,
<code><a href="#topic+cr_build_wait">cr_build_wait</a>()</code>,
<code><a href="#topic+cr_build_write">cr_build_write</a>()</code>,
<code><a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a>()</code>,
<code><a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a>()</code>,
<code><a href="#topic+cr_build_yaml">cr_build_yaml</a>()</code>,
<code><a href="#topic+cr_build">cr_build</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
cr_project_set("my-project")
cr_bucket_set("my-bucket")
my_gcs_source &lt;- cr_build_upload_gcs("my_folder")
build1 &lt;- cr_build("cloudbuild.yaml", source = my_gcs_source)

## End(Not run)
cr_buildstep_source_move("deploy")

</code></pre>

<hr>
<h2 id='cr_build_wait'>Wait for a Build to run</h2><span id='topic+cr_build_wait'></span>

<h3>Description</h3>

<p>This will repeatedly call <a href="#topic+cr_build_status">cr_build_status</a> whilst the status is STATUS_UNKNOWN, QUEUED or WORKING
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_build_wait(op = .Last.value, projectId = cr_project_get())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_build_wait_+3A_op">op</code></td>
<td>
<p>The operation build object to wait for</p>
</td></tr>
<tr><td><code id="cr_build_wait_+3A_projectid">projectId</code></td>
<td>
<p>The projectId</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A gar_Build object <a href="#topic+Build">Build</a>
</p>


<h3>See Also</h3>

<p>Other Cloud Build functions: 
<code><a href="#topic+Build">Build</a>()</code>,
<code><a href="#topic+RepoSource">RepoSource</a>()</code>,
<code><a href="#topic+Source">Source</a>()</code>,
<code><a href="#topic+StorageSource">StorageSource</a>()</code>,
<code><a href="#topic+cr_build_artifacts">cr_build_artifacts</a>()</code>,
<code><a href="#topic+cr_build_list">cr_build_list</a>()</code>,
<code><a href="#topic+cr_build_logs">cr_build_logs</a>()</code>,
<code><a href="#topic+cr_build_make">cr_build_make</a>()</code>,
<code><a href="#topic+cr_build_status">cr_build_status</a>()</code>,
<code><a href="#topic+cr_build_targets">cr_build_targets</a>()</code>,
<code><a href="#topic+cr_build_upload_gcs">cr_build_upload_gcs</a>()</code>,
<code><a href="#topic+cr_build_write">cr_build_write</a>()</code>,
<code><a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a>()</code>,
<code><a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a>()</code>,
<code><a href="#topic+cr_build_yaml">cr_build_yaml</a>()</code>,
<code><a href="#topic+cr_build">cr_build</a>()</code>
</p>

<hr>
<h2 id='cr_build_write'>Write out a Build object to cloudbuild.yaml</h2><span id='topic+cr_build_write'></span>

<h3>Description</h3>

<p>Write out a Build object to cloudbuild.yaml
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_build_write(x, file = "cloudbuild.yaml")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_build_write_+3A_x">x</code></td>
<td>
<p>A <a href="#topic+Build">Build</a> object perhaps created with <a href="#topic+cr_build_make">cr_build_make</a> or <a href="#topic+cr_build_yaml">cr_build_yaml</a></p>
</td></tr>
<tr><td><code id="cr_build_write_+3A_file">file</code></td>
<td>
<p>Where to write the yaml file</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other Cloud Build functions: 
<code><a href="#topic+Build">Build</a>()</code>,
<code><a href="#topic+RepoSource">RepoSource</a>()</code>,
<code><a href="#topic+Source">Source</a>()</code>,
<code><a href="#topic+StorageSource">StorageSource</a>()</code>,
<code><a href="#topic+cr_build_artifacts">cr_build_artifacts</a>()</code>,
<code><a href="#topic+cr_build_list">cr_build_list</a>()</code>,
<code><a href="#topic+cr_build_logs">cr_build_logs</a>()</code>,
<code><a href="#topic+cr_build_make">cr_build_make</a>()</code>,
<code><a href="#topic+cr_build_status">cr_build_status</a>()</code>,
<code><a href="#topic+cr_build_targets">cr_build_targets</a>()</code>,
<code><a href="#topic+cr_build_upload_gcs">cr_build_upload_gcs</a>()</code>,
<code><a href="#topic+cr_build_wait">cr_build_wait</a>()</code>,
<code><a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a>()</code>,
<code><a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a>()</code>,
<code><a href="#topic+cr_build_yaml">cr_build_yaml</a>()</code>,
<code><a href="#topic+cr_build">cr_build</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cr_project_set("my-project")
# write from creating a Yaml object
image &lt;- "gcr.io/my-project/my-image$BUILD_ID"
run_yaml &lt;- cr_build_yaml(
  steps = c(
    cr_buildstep("docker", c("build", "-t", image, ".")),
    cr_buildstep("docker", c("push", image)),
    cr_buildstep("gcloud", c("beta", "run", "deploy", "test1", "--image", image))
  ),
  images = image
)
## Not run: 
cr_build_write(run_yaml)

## End(Not run)

# write from a Build object
build &lt;- cr_build_make(system.file("cloudbuild/cloudbuild.yaml",
  package = "googleCloudRunner"
))
## Not run: 
cr_build_write(build)

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_build_yaml'>Create a cloudbuild Yaml object in R</h2><span id='topic+cr_build_yaml'></span>

<h3>Description</h3>

<p>This can be written to disk or used directly with functions such as <a href="#topic+cr_build">cr_build</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_build_yaml(
  steps,
  timeout = NULL,
  logsBucket = NULL,
  options = NULL,
  substitutions = NULL,
  tags = NULL,
  secrets = NULL,
  availableSecrets = NULL,
  images = NULL,
  artifacts = NULL,
  serviceAccount = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_build_yaml_+3A_steps">steps</code></td>
<td>
<p>A vector of <a href="#topic+cr_buildstep">cr_buildstep</a></p>
</td></tr>
<tr><td><code id="cr_build_yaml_+3A_timeout">timeout</code></td>
<td>
<p>How long the entire build will run. If not set will be 10mins</p>
</td></tr>
<tr><td><code id="cr_build_yaml_+3A_logsbucket">logsBucket</code></td>
<td>
<p>Where logs are written.  If you don't set this field, Cloud Build will use a default bucket to store your build logs.</p>
</td></tr>
<tr><td><code id="cr_build_yaml_+3A_options">options</code></td>
<td>
<p>A named list of options</p>
</td></tr>
<tr><td><code id="cr_build_yaml_+3A_substitutions">substitutions</code></td>
<td>
<p>Build macros that will replace entries in other elements</p>
</td></tr>
<tr><td><code id="cr_build_yaml_+3A_tags">tags</code></td>
<td>
<p>Tags for the build</p>
</td></tr>
<tr><td><code id="cr_build_yaml_+3A_secrets">secrets</code></td>
<td>
<p>A secrets object</p>
</td></tr>
<tr><td><code id="cr_build_yaml_+3A_availablesecrets">availableSecrets</code></td>
<td>
<p>What environment arguments from Secret Manager are available to the build - create via <a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a></p>
</td></tr>
<tr><td><code id="cr_build_yaml_+3A_images">images</code></td>
<td>
<p>What images will be build from this cloudbuild</p>
</td></tr>
<tr><td><code id="cr_build_yaml_+3A_artifacts">artifacts</code></td>
<td>
<p>What artifacts may be built from this cloudbuild - create via <a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a></p>
</td></tr>
<tr><td><code id="cr_build_yaml_+3A_serviceaccount">serviceAccount</code></td>
<td>
<p>What service account should the build be run under?</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/build/docs/build-config-file-schema">Build configuration overview for cloudbuild.yaml</a>
</p>
<p>Other Cloud Build functions: 
<code><a href="#topic+Build">Build</a>()</code>,
<code><a href="#topic+RepoSource">RepoSource</a>()</code>,
<code><a href="#topic+Source">Source</a>()</code>,
<code><a href="#topic+StorageSource">StorageSource</a>()</code>,
<code><a href="#topic+cr_build_artifacts">cr_build_artifacts</a>()</code>,
<code><a href="#topic+cr_build_list">cr_build_list</a>()</code>,
<code><a href="#topic+cr_build_logs">cr_build_logs</a>()</code>,
<code><a href="#topic+cr_build_make">cr_build_make</a>()</code>,
<code><a href="#topic+cr_build_status">cr_build_status</a>()</code>,
<code><a href="#topic+cr_build_targets">cr_build_targets</a>()</code>,
<code><a href="#topic+cr_build_upload_gcs">cr_build_upload_gcs</a>()</code>,
<code><a href="#topic+cr_build_wait">cr_build_wait</a>()</code>,
<code><a href="#topic+cr_build_write">cr_build_write</a>()</code>,
<code><a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a>()</code>,
<code><a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a>()</code>,
<code><a href="#topic+cr_build">cr_build</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cr_project_set("my-project")
image &lt;- "gcr.io/my-project/my-image"
cr_build_yaml(
  steps = c(
    cr_buildstep("docker", c("build", "-t", image, ".")),
    cr_buildstep("docker", c("push", image)),
    cr_buildstep("gcloud", c("beta", "run", "deploy", "test1", "--image", image))
  ),
  images = image
)
</code></pre>

<hr>
<h2 id='cr_build_yaml_artifact'>Add an artifact for cloudbuild.yaml</h2><span id='topic+cr_build_yaml_artifact'></span>

<h3>Description</h3>

<p>Add artifact objects to a build
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_build_yaml_artifact(paths, bucket_dir = NULL, bucket = cr_bucket_get())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_build_yaml_artifact_+3A_paths">paths</code></td>
<td>
<p>Which files from the working directory to upload to cloud storage once the build is finished.  Can use globs but see details of <a href="#topic+cr_build_artifacts">cr_build_artifacts</a> on how that affects downloads</p>
</td></tr>
<tr><td><code id="cr_build_yaml_artifact_+3A_bucket_dir">bucket_dir</code></td>
<td>
<p>The directory in the bucket the files will be uploaded to</p>
</td></tr>
<tr><td><code id="cr_build_yaml_artifact_+3A_bucket">bucket</code></td>
<td>
<p>the bucket to send to</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other Cloud Build functions: 
<code><a href="#topic+Build">Build</a>()</code>,
<code><a href="#topic+RepoSource">RepoSource</a>()</code>,
<code><a href="#topic+Source">Source</a>()</code>,
<code><a href="#topic+StorageSource">StorageSource</a>()</code>,
<code><a href="#topic+cr_build_artifacts">cr_build_artifacts</a>()</code>,
<code><a href="#topic+cr_build_list">cr_build_list</a>()</code>,
<code><a href="#topic+cr_build_logs">cr_build_logs</a>()</code>,
<code><a href="#topic+cr_build_make">cr_build_make</a>()</code>,
<code><a href="#topic+cr_build_status">cr_build_status</a>()</code>,
<code><a href="#topic+cr_build_targets">cr_build_targets</a>()</code>,
<code><a href="#topic+cr_build_upload_gcs">cr_build_upload_gcs</a>()</code>,
<code><a href="#topic+cr_build_wait">cr_build_wait</a>()</code>,
<code><a href="#topic+cr_build_write">cr_build_write</a>()</code>,
<code><a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a>()</code>,
<code><a href="#topic+cr_build_yaml">cr_build_yaml</a>()</code>,
<code><a href="#topic+cr_build">cr_build</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
cr_project_set("my-project")
r &lt;- "write.csv(mtcars,file = 'artifact.csv')"
cr_build_yaml(
  steps = cr_buildstep_r(r),
  artifacts = cr_build_yaml_artifact("artifact.csv", bucket = "my-bucket")
)

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_build_yaml_secrets'>Create an availableSecrets entry for build yaml</h2><span id='topic+cr_build_yaml_secrets'></span>

<h3>Description</h3>

<p>This creates the availabelSecrets entry for Builds so they can use Secret Manager environment arguments in the builds.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_build_yaml_secrets(
  secretEnv,
  secret,
  version = "latest",
  projectId = cr_project_get()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_build_yaml_secrets_+3A_secretenv">secretEnv</code></td>
<td>
<p>The name of the secretEnv that will be referred to in the build steps e.g. <code>'GH_TOKEN'</code></p>
</td></tr>
<tr><td><code id="cr_build_yaml_secrets_+3A_secret">secret</code></td>
<td>
<p>The secret data name in Secret Manager</p>
</td></tr>
<tr><td><code id="cr_build_yaml_secrets_+3A_version">version</code></td>
<td>
<p>The version of the secret</p>
</td></tr>
<tr><td><code id="cr_build_yaml_secrets_+3A_projectid">projectId</code></td>
<td>
<p>The project to get the Secret from</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>To download from Secret Manager to a file in a dedicated buildstep see <a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>.
</p>
<p><a href="https://cloud.google.com/build/docs/securing-builds/use-secrets">Using secrets from Secret Manager</a>
</p>
<p>Other Cloud Build functions: 
<code><a href="#topic+Build">Build</a>()</code>,
<code><a href="#topic+RepoSource">RepoSource</a>()</code>,
<code><a href="#topic+Source">Source</a>()</code>,
<code><a href="#topic+StorageSource">StorageSource</a>()</code>,
<code><a href="#topic+cr_build_artifacts">cr_build_artifacts</a>()</code>,
<code><a href="#topic+cr_build_list">cr_build_list</a>()</code>,
<code><a href="#topic+cr_build_logs">cr_build_logs</a>()</code>,
<code><a href="#topic+cr_build_make">cr_build_make</a>()</code>,
<code><a href="#topic+cr_build_status">cr_build_status</a>()</code>,
<code><a href="#topic+cr_build_targets">cr_build_targets</a>()</code>,
<code><a href="#topic+cr_build_upload_gcs">cr_build_upload_gcs</a>()</code>,
<code><a href="#topic+cr_build_wait">cr_build_wait</a>()</code>,
<code><a href="#topic+cr_build_write">cr_build_write</a>()</code>,
<code><a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a>()</code>,
<code><a href="#topic+cr_build_yaml">cr_build_yaml</a>()</code>,
<code><a href="#topic+cr_build">cr_build</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cr_build_yaml_secrets("GH_TOKEN", "github_token")

s1 &lt;- cr_build_yaml_secrets("USERNAME", "my_username")
s2 &lt;- cr_build_yaml_secrets("PASSWORD", "my_password")

# use one $ in scripts to use the secretEnv (will be replaced by $$)
cr_build_yaml(
  steps = cr_buildstep(
    "docker",
    entrypoint = "bash",
    args = c(
      "-c",
      "docker login --username=$USERNAME --password=$PASSWORD"
    ),
    secretEnv = c("USERNAME", "PASSWORD")
  ),
  availableSecrets = list(s1, s2)
)
</code></pre>

<hr>
<h2 id='cr_buildstep'>Create a yaml build step</h2><span id='topic+cr_buildstep'></span>

<h3>Description</h3>

<p>Helper for creating build steps for upload to Cloud Build
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep(
  name,
  args = NULL,
  id = NULL,
  prefix = "gcr.io/cloud-builders/",
  entrypoint = NULL,
  dir = "",
  env = NULL,
  waitFor = NULL,
  volumes = NULL,
  secretEnv = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_+3A_name">name</code></td>
<td>
<p>name of docker image to call appended to <code>prefix</code></p>
</td></tr>
<tr><td><code id="cr_buildstep_+3A_args">args</code></td>
<td>
<p>character vector of arguments</p>
</td></tr>
<tr><td><code id="cr_buildstep_+3A_id">id</code></td>
<td>
<p>Optional id for the step</p>
</td></tr>
<tr><td><code id="cr_buildstep_+3A_prefix">prefix</code></td>
<td>
<p>prefixed to name - set to &quot;&quot; to suppress.  Will be suppressed if <code>name</code> starts with gcr.io or <code>*-docker.pkg.dev</code></p>
</td></tr>
<tr><td><code id="cr_buildstep_+3A_entrypoint">entrypoint</code></td>
<td>
<p>change the entrypoint for the docker container</p>
</td></tr>
<tr><td><code id="cr_buildstep_+3A_dir">dir</code></td>
<td>
<p>The directory to use, relative to /workspace e.g. /workspace/deploy/</p>
</td></tr>
<tr><td><code id="cr_buildstep_+3A_env">env</code></td>
<td>
<p>Environment variables for this step.  A character vector for each assignment</p>
</td></tr>
<tr><td><code id="cr_buildstep_+3A_waitfor">waitFor</code></td>
<td>
<p>Whether to wait for previous buildsteps to complete before running.  Default it will wait for previous step.</p>
</td></tr>
<tr><td><code id="cr_buildstep_+3A_volumes">volumes</code></td>
<td>
<p>volumes to connect and write to</p>
</td></tr>
<tr><td><code id="cr_buildstep_+3A_secretenv">secretEnv</code></td>
<td>
<p>A list of secrets stored in Secret Manager referred to in args via a <code>$$var</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>This uses R to make building steps for cloudbuild.yml files harder to make mistakes with, and also means you can program creation of cloud build steps for use in R or other languages.  Various templates with common use cases of buildsteps are also available that wrap this function, refer to the &quot;See Also&quot; section.
</p>


<h3>WaitFor</h3>

<p>By default each buildstep waits for the previous, but if you pass <code>"-"</code> then it will start immediately, or if you pass in a list of ids it will wait for previous buildsteps to finish who have that id.  See <a href="https://cloud.google.com/build/docs/configuring-builds/configure-build-step-order">Configuring Build Step Order</a> for details.
</p>


<h3>Build Macros</h3>

<p>Fields can include the following variables, which will be expanded when the build is created:-
</p>

<ul>
<li><p> $PROJECT_ID: the project ID of the build.
</p>
</li>
<li><p> $BUILD_ID: the autogenerated ID of the build.
</p>
</li>
<li><p> $REPO_NAME: the source repository name specified by RepoSource.
</p>
</li>
<li><p> $BRANCH_NAME: the branch name specified by RepoSource.
</p>
</li>
<li><p> $TAG_NAME: the tag name specified by RepoSource.
</p>
</li>
<li><p> $REVISION_ID or $COMMIT_SHA: the commit SHA specified by RepoSource or  resolved from the specified branch or tag.
</p>
</li>
<li><p>  $SHORT_SHA: first 7 characters of $REVISION_ID or $COMMIT_SHA.
</p>
</li></ul>

<p>Or you can add your own custom variables, set in the Build Trigger.  Custom variables always start with $_ e.g. $_MY_VAR
</p>


<h3>secretEnv</h3>

<p>You can pass secrets that are stored in Secret Manager directly instead of using a dedicated buildstep via <a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>
</p>
<p>Within the code passed to <code>args</code> those secrets are referred to via <code>$$SECRET_NAME</code>.  If used then <a href="#topic+cr_build_yaml">cr_build_yaml</a> must also include the <code>availableSecrets</code> argument.
</p>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/build/docs/configuring-builds/use-community-and-custom-builders">Creating custom build steps how-to guide</a>
</p>
<p>Other Cloud Buildsteps: 
<code><a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a>()</code>,
<code><a href="#topic+cr_buildstep_decrypt">cr_buildstep_decrypt</a>()</code>,
<code><a href="#topic+cr_buildstep_df">cr_buildstep_df</a>()</code>,
<code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a>()</code>,
<code><a href="#topic+cr_buildstep_edit">cr_buildstep_edit</a>()</code>,
<code><a href="#topic+cr_buildstep_extract">cr_buildstep_extract</a>()</code>,
<code><a href="#topic+cr_buildstep_gcloud">cr_buildstep_gcloud</a>()</code>,
<code><a href="#topic+cr_buildstep_gitsetup">cr_buildstep_gitsetup</a>()</code>,
<code><a href="#topic+cr_buildstep_mailgun">cr_buildstep_mailgun</a>()</code>,
<code><a href="#topic+cr_buildstep_nginx_setup">cr_buildstep_nginx_setup</a>()</code>,
<code><a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a>()</code>,
<code><a href="#topic+cr_buildstep_pkgdown">cr_buildstep_pkgdown</a>()</code>,
<code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a>()</code>,
<code><a href="#topic+cr_buildstep_r">cr_buildstep_r</a>()</code>,
<code><a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>()</code>,
<code><a href="#topic+cr_buildstep_slack">cr_buildstep_slack</a>()</code>,
<code><a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cr_project_set("my-project")
cr_bucket_set("my-bucket")
# creating yaml for use in deploying cloud run
image &lt;- "gcr.io/my-project/my-image:$BUILD_ID"
cr_build_yaml(
  steps = c(
    cr_buildstep("docker", c("build", "-t", image, ".")),
    cr_buildstep("docker", c("push", image)),
    cr_buildstep("gcloud", c(
      "beta", "run", "deploy", "test1",
      "--image", image
    ))
  ),
  images = image
)

# use premade docker buildstep - combine using c()
image &lt;- "gcr.io/my-project/my-image"
cr_build_yaml(
  steps = c(
    cr_buildstep_docker(image),
    cr_buildstep("gcloud",
      args = c(
        "beta", "run", "deploy",
        "test1", "--image", image
      )
    )
  ),
  images = image
)

# list files with a new entrypoint for gcloud
cr_build_yaml(steps = cr_buildstep("gcloud", c("-c", "ls -la"),
  entrypoint = "bash"
))

# to call from images not using gcr.io/cloud-builders stem
cr_buildstep("alpine", c("-c", "ls -la"), entrypoint = "bash", prefix = "")

# to add environment arguments to the step
cr_buildstep("docker", "version", env = c("ENV1=env1", "ENV2=$PROJECT_ID"))

# to add volumes wrap in list()
cr_buildstep("test", "ls", volumes = list(list(name = "ssh", path = "/root/.ssh")))
</code></pre>

<hr>
<h2 id='cr_buildstep_bash'>Run a bash script in a Cloud Build step</h2><span id='topic+cr_buildstep_bash'></span>

<h3>Description</h3>

<p>Helper to run a supplied bash script, that will be copied in-line
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep_bash(
  bash_script,
  name = "ubuntu",
  bash_source = c("local", "runtime"),
  escape_dollar = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_bash_+3A_bash_script">bash_script</code></td>
<td>
<p>bash code to run or a filepath to a file containing bash code that ends with .bash or .sh</p>
</td></tr>
<tr><td><code id="cr_buildstep_bash_+3A_name">name</code></td>
<td>
<p>The image that will run the R code</p>
</td></tr>
<tr><td><code id="cr_buildstep_bash_+3A_bash_source">bash_source</code></td>
<td>
<p>Whether the code will be from a runtime file within the source or at build time copying over from a local file in your session</p>
</td></tr>
<tr><td><code id="cr_buildstep_bash_+3A_escape_dollar">escape_dollar</code></td>
<td>
<p>Default TRUE.  This will turn <code>$</code> into <code>$$</code> within the script to avoid them being recognised as Cloud Build variables.  Turn this off if you want that behaviour (e.g. <code>my_project="$PROJECT_ID"</code>)</p>
</td></tr>
<tr><td><code id="cr_buildstep_bash_+3A_...">...</code></td>
<td>
<p>Other arguments passed to <a href="#topic+cr_buildstep">cr_buildstep</a></p>
</td></tr>
</table>


<h3>Details</h3>

<p>If you need to escape build parameters in bash scripts, you need to escape CloudBuild's substitution via <code>$$</code> and bash's substitution via <code>\$</code> e.g. <code>\$$PARAM</code>
</p>


<h3>See Also</h3>

<p>Other Cloud Buildsteps: 
<code><a href="#topic+cr_buildstep_decrypt">cr_buildstep_decrypt</a>()</code>,
<code><a href="#topic+cr_buildstep_df">cr_buildstep_df</a>()</code>,
<code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a>()</code>,
<code><a href="#topic+cr_buildstep_edit">cr_buildstep_edit</a>()</code>,
<code><a href="#topic+cr_buildstep_extract">cr_buildstep_extract</a>()</code>,
<code><a href="#topic+cr_buildstep_gcloud">cr_buildstep_gcloud</a>()</code>,
<code><a href="#topic+cr_buildstep_gitsetup">cr_buildstep_gitsetup</a>()</code>,
<code><a href="#topic+cr_buildstep_mailgun">cr_buildstep_mailgun</a>()</code>,
<code><a href="#topic+cr_buildstep_nginx_setup">cr_buildstep_nginx_setup</a>()</code>,
<code><a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a>()</code>,
<code><a href="#topic+cr_buildstep_pkgdown">cr_buildstep_pkgdown</a>()</code>,
<code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a>()</code>,
<code><a href="#topic+cr_buildstep_r">cr_buildstep_r</a>()</code>,
<code><a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>()</code>,
<code><a href="#topic+cr_buildstep_slack">cr_buildstep_slack</a>()</code>,
<code><a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a>()</code>,
<code><a href="#topic+cr_buildstep">cr_buildstep</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cr_project_set("my-project")
bs &lt;- cr_build_yaml(
  steps = cr_buildstep_bash("echo 'Hello'")
)
## Not run: 
cr_build(bs)

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_buildstep_compute_container'>Buildstep to deploy to Google Compute Engine</h2><span id='topic+cr_buildstep_compute_container'></span><span id='topic+cr_buildstep_compute_rstudio'></span>

<h3>Description</h3>

<p>This build step adds some helpers to <a href="#topic+cr_buildstep_gcloud">cr_buildstep_gcloud</a> for deploying to VMs to GCE that will auto create a container within them and atytach it to the disk
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep_compute_container(
  vm_name,
  container_image = "gcr.io/gcer-public/persistent-rstudio:latest",
  disk_name = paste0(vm_name, "-disk"),
  disk_mount_path = "/home",
  zone = "europe-west1-b",
  disk_size = "10GB",
  machine_type = "n1-standard-1",
  container_env = "",
  scopes = "cloud-platform",
  network = "default",
  gcloud_args = NULL
)

cr_buildstep_compute_rstudio(
  rstudio_user,
  rstudio_pw,
  vm_name = "rstudio",
  disk_name = "rstudio-disk",
  zone = "europe-west1-b",
  disk_size = "10GB",
  machine_type = "n1-standard-1",
  container_image = "gcr.io/gcer-public/persistent-rstudio:latest",
  network = "default"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_compute_container_+3A_vm_name">vm_name</code></td>
<td>
<p>Name of the VM you will create</p>
</td></tr>
<tr><td><code id="cr_buildstep_compute_container_+3A_container_image">container_image</code></td>
<td>
<p>The Docker image that will be launched in the VM</p>
</td></tr>
<tr><td><code id="cr_buildstep_compute_container_+3A_disk_name">disk_name</code></td>
<td>
<p>Name of the disk that will be attached to the VM's container image</p>
</td></tr>
<tr><td><code id="cr_buildstep_compute_container_+3A_disk_mount_path">disk_mount_path</code></td>
<td>
<p>Where the disk will be attached to the container in the VM</p>
</td></tr>
<tr><td><code id="cr_buildstep_compute_container_+3A_zone">zone</code></td>
<td>
<p>Which zone the VM will launch within</p>
</td></tr>
<tr><td><code id="cr_buildstep_compute_container_+3A_disk_size">disk_size</code></td>
<td>
<p>The size of the disk</p>
</td></tr>
<tr><td><code id="cr_buildstep_compute_container_+3A_machine_type">machine_type</code></td>
<td>
<p>The type of VM that will be launched</p>
</td></tr>
<tr><td><code id="cr_buildstep_compute_container_+3A_container_env">container_env</code></td>
<td>
<p>Environment variables set within the VM's container image</p>
</td></tr>
<tr><td><code id="cr_buildstep_compute_container_+3A_scopes">scopes</code></td>
<td>
<p>The GCE scopes that the VM will be launched with permission to use</p>
</td></tr>
<tr><td><code id="cr_buildstep_compute_container_+3A_network">network</code></td>
<td>
<p>The network the VM will use.  The container will bridge into the same network</p>
</td></tr>
<tr><td><code id="cr_buildstep_compute_container_+3A_gcloud_args">gcloud_args</code></td>
<td>
<p>Other gcloud arguments you send in e.g. <code>c("--boot-disk-device-name=boot-disk1","--boot-disk-size=10GB")</code></p>
</td></tr>
<tr><td><code id="cr_buildstep_compute_container_+3A_rstudio_user">rstudio_user</code></td>
<td>
<p>The usename for the RStudio image the VM will launch</p>
</td></tr>
<tr><td><code id="cr_buildstep_compute_container_+3A_rstudio_pw">rstudio_pw</code></td>
<td>
<p>The password for the RStudio image the VM will launch</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
bs &lt;- cr_buildstep_compute_rstudio("mark", "securepassword1234")
build &lt;- cr_build_yaml(bs)
build
## Not run: 

cr_build(build)

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_buildstep_decrypt'>Create a build step for decrypting files via KMS</h2><span id='topic+cr_buildstep_decrypt'></span>

<h3>Description</h3>

<p>Create a build step to decrypt files using CryptoKey from Cloud Key Management Service.
Usually you will prefer to use <a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep_decrypt(cipher, plain, keyring, key, location = "global", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_decrypt_+3A_cipher">cipher</code></td>
<td>
<p>The file that has been encrypted</p>
</td></tr>
<tr><td><code id="cr_buildstep_decrypt_+3A_plain">plain</code></td>
<td>
<p>The file location to decrypt to</p>
</td></tr>
<tr><td><code id="cr_buildstep_decrypt_+3A_keyring">keyring</code></td>
<td>
<p>The KMS keyring to use</p>
</td></tr>
<tr><td><code id="cr_buildstep_decrypt_+3A_key">key</code></td>
<td>
<p>The KMS key to use</p>
</td></tr>
<tr><td><code id="cr_buildstep_decrypt_+3A_location">location</code></td>
<td>
<p>The KMS location</p>
</td></tr>
<tr><td><code id="cr_buildstep_decrypt_+3A_...">...</code></td>
<td>
<p>Further arguments passed in to <a href="#topic+cr_buildstep">cr_buildstep</a></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Key Management Store can encrypt secret files for use within your later buildsteps.
</p>


<h3>Setup</h3>

<p>You will need to set up the <a href="https://cloud.google.com/build/docs/securing-builds/use-secrets">encrypted key using gcloud</a> following the link from Google
</p>


<h3>See Also</h3>

<p>Other Cloud Buildsteps: 
<code><a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a>()</code>,
<code><a href="#topic+cr_buildstep_df">cr_buildstep_df</a>()</code>,
<code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a>()</code>,
<code><a href="#topic+cr_buildstep_edit">cr_buildstep_edit</a>()</code>,
<code><a href="#topic+cr_buildstep_extract">cr_buildstep_extract</a>()</code>,
<code><a href="#topic+cr_buildstep_gcloud">cr_buildstep_gcloud</a>()</code>,
<code><a href="#topic+cr_buildstep_gitsetup">cr_buildstep_gitsetup</a>()</code>,
<code><a href="#topic+cr_buildstep_mailgun">cr_buildstep_mailgun</a>()</code>,
<code><a href="#topic+cr_buildstep_nginx_setup">cr_buildstep_nginx_setup</a>()</code>,
<code><a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a>()</code>,
<code><a href="#topic+cr_buildstep_pkgdown">cr_buildstep_pkgdown</a>()</code>,
<code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a>()</code>,
<code><a href="#topic+cr_buildstep_r">cr_buildstep_r</a>()</code>,
<code><a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>()</code>,
<code><a href="#topic+cr_buildstep_slack">cr_buildstep_slack</a>()</code>,
<code><a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a>()</code>,
<code><a href="#topic+cr_buildstep">cr_buildstep</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cr_project_set("my-project")
cr_bucket_set("my-bucket")
cr_buildstep_decrypt("secret.json.enc",
  plain = "secret.json",
  keyring = "my_keyring",
  key = "my_key"
)
</code></pre>

<hr>
<h2 id='cr_buildstep_df'>Convert a data.frame into cr_buildstep</h2><span id='topic+cr_buildstep_df'></span>

<h3>Description</h3>

<p>Helper to turn a data.frame of buildsteps info into format accepted by <a href="#topic+cr_build">cr_build</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep_df(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_df_+3A_x">x</code></td>
<td>
<p>A data.frame of steps to turn into buildsteps, with at least name and args columns</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This helps convert the output of <a href="#topic+cr_build">cr_build</a> into valid <a href="#topic+cr_buildstep">cr_buildstep</a> so it can be sent back into the API
</p>
<p>If constructing arg list columns then <a href="base.html#topic+I">I</a> suppresses conversion of the list to columns that would otherwise break the yaml format
</p>


<h3>See Also</h3>

<p>Other Cloud Buildsteps: 
<code><a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a>()</code>,
<code><a href="#topic+cr_buildstep_decrypt">cr_buildstep_decrypt</a>()</code>,
<code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a>()</code>,
<code><a href="#topic+cr_buildstep_edit">cr_buildstep_edit</a>()</code>,
<code><a href="#topic+cr_buildstep_extract">cr_buildstep_extract</a>()</code>,
<code><a href="#topic+cr_buildstep_gcloud">cr_buildstep_gcloud</a>()</code>,
<code><a href="#topic+cr_buildstep_gitsetup">cr_buildstep_gitsetup</a>()</code>,
<code><a href="#topic+cr_buildstep_mailgun">cr_buildstep_mailgun</a>()</code>,
<code><a href="#topic+cr_buildstep_nginx_setup">cr_buildstep_nginx_setup</a>()</code>,
<code><a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a>()</code>,
<code><a href="#topic+cr_buildstep_pkgdown">cr_buildstep_pkgdown</a>()</code>,
<code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a>()</code>,
<code><a href="#topic+cr_buildstep_r">cr_buildstep_r</a>()</code>,
<code><a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>()</code>,
<code><a href="#topic+cr_buildstep_slack">cr_buildstep_slack</a>()</code>,
<code><a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a>()</code>,
<code><a href="#topic+cr_buildstep">cr_buildstep</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>y &lt;- data.frame(
  name = c("docker", "alpine"),
  args = I(list(c("version"), c("echo", "Hello Cloud Build"))),
  id = c("Docker Version", "Hello Cloud Build"),
  prefix = c(NA, ""),
  stringsAsFactors = FALSE
)
cr_buildstep_df(y)
</code></pre>

<hr>
<h2 id='cr_buildstep_docker'>Create a build step to build and push a docker image</h2><span id='topic+cr_buildstep_docker'></span>

<h3>Description</h3>

<p>Create a build step to build and push a docker image
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep_docker(
  image,
  tag = c("latest", "$BUILD_ID"),
  location = ".",
  projectId = cr_project_get(),
  dockerfile = "Dockerfile",
  kaniko_cache = FALSE,
  build_args = NULL,
  push_image = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_docker_+3A_image">image</code></td>
<td>
<p>The image tag that will be pushed, starting with gcr.io or created by combining with <code>projectId</code> if not starting with gcr.io</p>
</td></tr>
<tr><td><code id="cr_buildstep_docker_+3A_tag">tag</code></td>
<td>
<p>The tag or tags to be attached to the pushed image - can use <code>Build</code> macros</p>
</td></tr>
<tr><td><code id="cr_buildstep_docker_+3A_location">location</code></td>
<td>
<p>Where the Dockerfile to build is in relation to <code>dir</code></p>
</td></tr>
<tr><td><code id="cr_buildstep_docker_+3A_projectid">projectId</code></td>
<td>
<p>The projectId</p>
</td></tr>
<tr><td><code id="cr_buildstep_docker_+3A_dockerfile">dockerfile</code></td>
<td>
<p>Specify the name of the Dockerfile found at <code>location</code></p>
</td></tr>
<tr><td><code id="cr_buildstep_docker_+3A_kaniko_cache">kaniko_cache</code></td>
<td>
<p>If TRUE will use kaniko cache for Docker builds.</p>
</td></tr>
<tr><td><code id="cr_buildstep_docker_+3A_build_args">build_args</code></td>
<td>
<p>additional arguments to pass to <code>docker build</code>,
should be a character vector.</p>
</td></tr>
<tr><td><code id="cr_buildstep_docker_+3A_push_image">push_image</code></td>
<td>
<p>if <code>kaniko_cache = FALSE</code> and
<code>push_image = FALSE</code>, then the docker image is simply built and not
pushed</p>
</td></tr>
<tr><td><code id="cr_buildstep_docker_+3A_...">...</code></td>
<td>
<p>Further arguments passed in to <a href="#topic+cr_buildstep">cr_buildstep</a></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Setting <code>kaniko_cache = TRUE</code> will enable caching of the layers of the Dockerfile, which will speed up subsequent builds of that Dockerfile.  See <a href="https://cloud.google.com/build/docs/kaniko-cache">Using Kaniko cache</a>
</p>
<p>If building multiple tags they don't have to run sequentially - set <code>waitFor = "-"</code> to build concurrently
</p>


<h3>See Also</h3>

<p>Other Cloud Buildsteps: 
<code><a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a>()</code>,
<code><a href="#topic+cr_buildstep_decrypt">cr_buildstep_decrypt</a>()</code>,
<code><a href="#topic+cr_buildstep_df">cr_buildstep_df</a>()</code>,
<code><a href="#topic+cr_buildstep_edit">cr_buildstep_edit</a>()</code>,
<code><a href="#topic+cr_buildstep_extract">cr_buildstep_extract</a>()</code>,
<code><a href="#topic+cr_buildstep_gcloud">cr_buildstep_gcloud</a>()</code>,
<code><a href="#topic+cr_buildstep_gitsetup">cr_buildstep_gitsetup</a>()</code>,
<code><a href="#topic+cr_buildstep_mailgun">cr_buildstep_mailgun</a>()</code>,
<code><a href="#topic+cr_buildstep_nginx_setup">cr_buildstep_nginx_setup</a>()</code>,
<code><a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a>()</code>,
<code><a href="#topic+cr_buildstep_pkgdown">cr_buildstep_pkgdown</a>()</code>,
<code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a>()</code>,
<code><a href="#topic+cr_buildstep_r">cr_buildstep_r</a>()</code>,
<code><a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>()</code>,
<code><a href="#topic+cr_buildstep_slack">cr_buildstep_slack</a>()</code>,
<code><a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a>()</code>,
<code><a href="#topic+cr_buildstep">cr_buildstep</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cr_project_set("my-project")
cr_bucket_set("my-bucket")

cr_buildstep_docker("gcr.io/my-project/my-image")
cr_buildstep_docker("my-image")
cr_buildstep_docker("my-image", tag = "$BRANCH_NAME")

# setting up a build to trigger off a Git source:
my_image &lt;- "gcr.io/my-project/my-image"
my_repo &lt;- RepoSource("github_markedmondson1234_googlecloudrunner",
  branchName = "master"
)
## Not run: 
docker_yaml &lt;- cr_build_yaml(steps = cr_buildstep_docker(my_image))
built_docker &lt;- cr_build(docker_yaml, source = my_repo)

# make a build trigger so it builds on each push to master
cr_buildtrigger("build-docker", trigger = my_repo, build = built_docker)


# add a cache to your docker build to speed up repeat builds
cr_buildstep_docker("my-image", kaniko_cache = TRUE)

# building using manual buildsteps to clone from git
bs &lt;- c(
  cr_buildstep_gitsetup("github-ssh"),
  cr_buildstep_git(c("clone", "git@github.com:MarkEdmondson1234/googleCloudRunner", ".")),
  cr_buildstep_docker("gcr.io/gcer-public/packagetools",
    dir = "inst/docker/packages/"
  )
)

built &lt;- cr_build(cr_build_yaml(bs))

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_buildstep_edit'>Modify an existing buildstep with new parameters</h2><span id='topic+cr_buildstep_edit'></span>

<h3>Description</h3>

<p>Useful for editing existing buildsteps
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep_edit(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_edit_+3A_x">x</code></td>
<td>
<p>A buildstep created previously</p>
</td></tr>
<tr><td><code id="cr_buildstep_edit_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+cr_buildstep">cr_buildstep</a></code>
</p>

<dl>
<dt><code>name</code></dt><dd><p>name of docker image to call appended to <code>prefix</code></p>
</dd>
<dt><code>args</code></dt><dd><p>character vector of arguments</p>
</dd>
<dt><code>prefix</code></dt><dd><p>prefixed to name - set to &quot;&quot; to suppress.  Will be suppressed if <code>name</code> starts with gcr.io or <code>*-docker.pkg.dev</code></p>
</dd>
<dt><code>entrypoint</code></dt><dd><p>change the entrypoint for the docker container</p>
</dd>
<dt><code>dir</code></dt><dd><p>The directory to use, relative to /workspace e.g. /workspace/deploy/</p>
</dd>
<dt><code>id</code></dt><dd><p>Optional id for the step</p>
</dd>
<dt><code>env</code></dt><dd><p>Environment variables for this step.  A character vector for each assignment</p>
</dd>
<dt><code>volumes</code></dt><dd><p>volumes to connect and write to</p>
</dd>
<dt><code>waitFor</code></dt><dd><p>Whether to wait for previous buildsteps to complete before running.  Default it will wait for previous step.</p>
</dd>
<dt><code>secretEnv</code></dt><dd><p>A list of secrets stored in Secret Manager referred to in args via a <code>$$var</code></p>
</dd>
</dl>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other Cloud Buildsteps: 
<code><a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a>()</code>,
<code><a href="#topic+cr_buildstep_decrypt">cr_buildstep_decrypt</a>()</code>,
<code><a href="#topic+cr_buildstep_df">cr_buildstep_df</a>()</code>,
<code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a>()</code>,
<code><a href="#topic+cr_buildstep_extract">cr_buildstep_extract</a>()</code>,
<code><a href="#topic+cr_buildstep_gcloud">cr_buildstep_gcloud</a>()</code>,
<code><a href="#topic+cr_buildstep_gitsetup">cr_buildstep_gitsetup</a>()</code>,
<code><a href="#topic+cr_buildstep_mailgun">cr_buildstep_mailgun</a>()</code>,
<code><a href="#topic+cr_buildstep_nginx_setup">cr_buildstep_nginx_setup</a>()</code>,
<code><a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a>()</code>,
<code><a href="#topic+cr_buildstep_pkgdown">cr_buildstep_pkgdown</a>()</code>,
<code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a>()</code>,
<code><a href="#topic+cr_buildstep_r">cr_buildstep_r</a>()</code>,
<code><a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>()</code>,
<code><a href="#topic+cr_buildstep_slack">cr_buildstep_slack</a>()</code>,
<code><a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a>()</code>,
<code><a href="#topic+cr_buildstep">cr_buildstep</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>package_build &lt;- system.file("cloudbuild/cloudbuild.yaml",
  package = "googleCloudRunner"
)
build &lt;- cr_build_make(package_build)
build
cr_buildstep_extract(build, step = 1)
cr_buildstep_extract(build, step = 2)

edit_me &lt;- cr_buildstep_extract(build, step = 2)
cr_buildstep_edit(edit_me, name = "blah")
cr_buildstep_edit(edit_me, name = "gcr.io/blah")
cr_buildstep_edit(edit_me, args = c("blah1", "blah2"), dir = "meh")

# to edit multiple buildsteps at once
bs &lt;- c(cr_buildstep_extract(build, 1), cr_buildstep_extract(build, 2))
lapply(bs, function(x) cr_buildstep_edit(list(x), dir = "blah")[[1]])
</code></pre>

<hr>
<h2 id='cr_buildstep_extract'>Extract a buildstep from a Build object</h2><span id='topic+cr_buildstep_extract'></span>

<h3>Description</h3>

<p>Useful if you have a step from an existing cloudbuild.yaml you want in another
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep_extract(x, step = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_extract_+3A_x">x</code></td>
<td>
<p>A <a href="#topic+Build">Build</a> object</p>
</td></tr>
<tr><td><code id="cr_buildstep_extract_+3A_step">step</code></td>
<td>
<p>The numeric step number to extract</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other Cloud Buildsteps: 
<code><a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a>()</code>,
<code><a href="#topic+cr_buildstep_decrypt">cr_buildstep_decrypt</a>()</code>,
<code><a href="#topic+cr_buildstep_df">cr_buildstep_df</a>()</code>,
<code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a>()</code>,
<code><a href="#topic+cr_buildstep_edit">cr_buildstep_edit</a>()</code>,
<code><a href="#topic+cr_buildstep_gcloud">cr_buildstep_gcloud</a>()</code>,
<code><a href="#topic+cr_buildstep_gitsetup">cr_buildstep_gitsetup</a>()</code>,
<code><a href="#topic+cr_buildstep_mailgun">cr_buildstep_mailgun</a>()</code>,
<code><a href="#topic+cr_buildstep_nginx_setup">cr_buildstep_nginx_setup</a>()</code>,
<code><a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a>()</code>,
<code><a href="#topic+cr_buildstep_pkgdown">cr_buildstep_pkgdown</a>()</code>,
<code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a>()</code>,
<code><a href="#topic+cr_buildstep_r">cr_buildstep_r</a>()</code>,
<code><a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>()</code>,
<code><a href="#topic+cr_buildstep_slack">cr_buildstep_slack</a>()</code>,
<code><a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a>()</code>,
<code><a href="#topic+cr_buildstep">cr_buildstep</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>package_build &lt;- system.file("cloudbuild/cloudbuild.yaml",
  package = "googleCloudRunner"
)
build &lt;- cr_build_make(package_build)
build
cr_buildstep_extract(build, step = 1)
cr_buildstep_extract(build, step = 2)
</code></pre>

<hr>
<h2 id='cr_buildstep_gcloud'>A buildstep template for gcloud</h2><span id='topic+cr_buildstep_gcloud'></span>

<h3>Description</h3>

<p>This enables an optimised version of gcloud docker for your buildstep such as <code>gcr.io/google.com/cloudsdktool/cloud-sdk:alpine</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep_gcloud(component = c("gcloud", "bq", "gsutil", "kubectl"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_gcloud_+3A_component">component</code></td>
<td>
<p>What gcloud service you need, such as &quot;gcloud&quot;, &quot;bq&quot; or &quot;gsutil&quot;</p>
</td></tr>
<tr><td><code id="cr_buildstep_gcloud_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+cr_buildstep">cr_buildstep</a></code>
</p>

<dl>
<dt><code>name</code></dt><dd><p>name of docker image to call appended to <code>prefix</code></p>
</dd>
<dt><code>args</code></dt><dd><p>character vector of arguments</p>
</dd>
<dt><code>prefix</code></dt><dd><p>prefixed to name - set to &quot;&quot; to suppress.  Will be suppressed if <code>name</code> starts with gcr.io or <code>*-docker.pkg.dev</code></p>
</dd>
<dt><code>entrypoint</code></dt><dd><p>change the entrypoint for the docker container</p>
</dd>
<dt><code>dir</code></dt><dd><p>The directory to use, relative to /workspace e.g. /workspace/deploy/</p>
</dd>
<dt><code>id</code></dt><dd><p>Optional id for the step</p>
</dd>
<dt><code>env</code></dt><dd><p>Environment variables for this step.  A character vector for each assignment</p>
</dd>
<dt><code>volumes</code></dt><dd><p>volumes to connect and write to</p>
</dd>
<dt><code>waitFor</code></dt><dd><p>Whether to wait for previous buildsteps to complete before running.  Default it will wait for previous step.</p>
</dd>
<dt><code>secretEnv</code></dt><dd><p>A list of secrets stored in Secret Manager referred to in args via a <code>$$var</code></p>
</dd>
</dl>
</td></tr>
</table>


<h3>See Also</h3>

<p><a href="https://github.com/GoogleCloudPlatform/cloud-builders/tree/master/gcloud">https://github.com/GoogleCloudPlatform/cloud-builders/tree/master/gcloud</a>
</p>
<p>Other Cloud Buildsteps: 
<code><a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a>()</code>,
<code><a href="#topic+cr_buildstep_decrypt">cr_buildstep_decrypt</a>()</code>,
<code><a href="#topic+cr_buildstep_df">cr_buildstep_df</a>()</code>,
<code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a>()</code>,
<code><a href="#topic+cr_buildstep_edit">cr_buildstep_edit</a>()</code>,
<code><a href="#topic+cr_buildstep_extract">cr_buildstep_extract</a>()</code>,
<code><a href="#topic+cr_buildstep_gitsetup">cr_buildstep_gitsetup</a>()</code>,
<code><a href="#topic+cr_buildstep_mailgun">cr_buildstep_mailgun</a>()</code>,
<code><a href="#topic+cr_buildstep_nginx_setup">cr_buildstep_nginx_setup</a>()</code>,
<code><a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a>()</code>,
<code><a href="#topic+cr_buildstep_pkgdown">cr_buildstep_pkgdown</a>()</code>,
<code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a>()</code>,
<code><a href="#topic+cr_buildstep_r">cr_buildstep_r</a>()</code>,
<code><a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>()</code>,
<code><a href="#topic+cr_buildstep_slack">cr_buildstep_slack</a>()</code>,
<code><a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a>()</code>,
<code><a href="#topic+cr_buildstep">cr_buildstep</a>()</code>
</p>

<hr>
<h2 id='cr_buildstep_gitsetup'>Create a build step for authenticating with Git</h2><span id='topic+cr_buildstep_gitsetup'></span><span id='topic+cr_buildstep_git'></span><span id='topic+git_volume'></span>

<h3>Description</h3>

<p>This creates steps to configure git to use an ssh created key.
</p>
<p>This creates steps to use git with an ssh created key.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep_gitsetup(secret, post_setup = NULL)

cr_buildstep_git(
  git_args = c("clone", "git@github.com:[GIT-USERNAME]/[REPOSITORY]", "."),
  ...
)

git_volume()
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_gitsetup_+3A_secret">secret</code></td>
<td>
<p>The name of the secret on Google Secret Manager for the git ssh private key</p>
</td></tr>
<tr><td><code id="cr_buildstep_gitsetup_+3A_post_setup">post_setup</code></td>
<td>
<p>Steps that occur after git setup</p>
</td></tr>
<tr><td><code id="cr_buildstep_gitsetup_+3A_git_args">git_args</code></td>
<td>
<p>The arguments to send to git</p>
</td></tr>
<tr><td><code id="cr_buildstep_gitsetup_+3A_...">...</code></td>
<td>
<p>Further arguments passed in to <a href="#topic+cr_buildstep">cr_buildstep</a></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The ssh private key should be uploaded to Google Secret Manager first
</p>
<p><code>cr_buildstep</code> must come after <code>cr_buildstep_gitsetup</code>
</p>
<p>Use <code>git_volume</code> to add the git credentials folder to other buildsteps
</p>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/build/docs/access-github-from-build">Accessing private GitHub repositories using Cloud Build (google article)</a>
</p>
<p>Other Cloud Buildsteps: 
<code><a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a>()</code>,
<code><a href="#topic+cr_buildstep_decrypt">cr_buildstep_decrypt</a>()</code>,
<code><a href="#topic+cr_buildstep_df">cr_buildstep_df</a>()</code>,
<code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a>()</code>,
<code><a href="#topic+cr_buildstep_edit">cr_buildstep_edit</a>()</code>,
<code><a href="#topic+cr_buildstep_extract">cr_buildstep_extract</a>()</code>,
<code><a href="#topic+cr_buildstep_gcloud">cr_buildstep_gcloud</a>()</code>,
<code><a href="#topic+cr_buildstep_mailgun">cr_buildstep_mailgun</a>()</code>,
<code><a href="#topic+cr_buildstep_nginx_setup">cr_buildstep_nginx_setup</a>()</code>,
<code><a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a>()</code>,
<code><a href="#topic+cr_buildstep_pkgdown">cr_buildstep_pkgdown</a>()</code>,
<code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a>()</code>,
<code><a href="#topic+cr_buildstep_r">cr_buildstep_r</a>()</code>,
<code><a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>()</code>,
<code><a href="#topic+cr_buildstep_slack">cr_buildstep_slack</a>()</code>,
<code><a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a>()</code>,
<code><a href="#topic+cr_buildstep">cr_buildstep</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cr_project_set("my-project")
cr_bucket_set("my-bucket")

# assumes you have previously saved git ssh key called "github-ssh"
cr_build_yaml(
  steps = c(
    cr_buildstep_gitsetup("github-ssh"),
    cr_buildstep_git(c(
      "clone",
      "git@github.com:github_name/repo_name"
    ))
  )
)
</code></pre>

<hr>
<h2 id='cr_buildstep_mailgun'>Send an email in a Cloud Build step via MailGun.org</h2><span id='topic+cr_buildstep_mailgun'></span>

<h3>Description</h3>

<p>This uses Mailgun to send emails.  It calls an R script that posts the message to MailGuns API.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep_mailgun(
  message,
  to,
  subject,
  from,
  mailgun_url = "$_MAILGUN_URL",
  mailgun_key = "$_MAILGUN_KEY",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_mailgun_+3A_message">message</code></td>
<td>
<p>The message markdown</p>
</td></tr>
<tr><td><code id="cr_buildstep_mailgun_+3A_to">to</code></td>
<td>
<p>to email</p>
</td></tr>
<tr><td><code id="cr_buildstep_mailgun_+3A_subject">subject</code></td>
<td>
<p>subject email</p>
</td></tr>
<tr><td><code id="cr_buildstep_mailgun_+3A_from">from</code></td>
<td>
<p>from email</p>
</td></tr>
<tr><td><code id="cr_buildstep_mailgun_+3A_mailgun_url">mailgun_url</code></td>
<td>
<p>The Mailgun API base URL. Default assumes you set this in <a href="#topic+Build">Build</a> substitution macros</p>
</td></tr>
<tr><td><code id="cr_buildstep_mailgun_+3A_mailgun_key">mailgun_key</code></td>
<td>
<p>The Mailgun API key.  Default assumes you set this in <a href="#topic+Build">Build</a> substitution macros</p>
</td></tr>
<tr><td><code id="cr_buildstep_mailgun_+3A_...">...</code></td>
<td>
<p>Other arguments passed to <a href="#topic+cr_buildstep_r">cr_buildstep_r</a></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Requires an account at Mailgun: https://mailgun.com
Pre-verification you can only send to a whitelist of emails you configure - see Mailgun website for details.
</p>


<h3>See Also</h3>

<p>Other Cloud Buildsteps: 
<code><a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a>()</code>,
<code><a href="#topic+cr_buildstep_decrypt">cr_buildstep_decrypt</a>()</code>,
<code><a href="#topic+cr_buildstep_df">cr_buildstep_df</a>()</code>,
<code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a>()</code>,
<code><a href="#topic+cr_buildstep_edit">cr_buildstep_edit</a>()</code>,
<code><a href="#topic+cr_buildstep_extract">cr_buildstep_extract</a>()</code>,
<code><a href="#topic+cr_buildstep_gcloud">cr_buildstep_gcloud</a>()</code>,
<code><a href="#topic+cr_buildstep_gitsetup">cr_buildstep_gitsetup</a>()</code>,
<code><a href="#topic+cr_buildstep_nginx_setup">cr_buildstep_nginx_setup</a>()</code>,
<code><a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a>()</code>,
<code><a href="#topic+cr_buildstep_pkgdown">cr_buildstep_pkgdown</a>()</code>,
<code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a>()</code>,
<code><a href="#topic+cr_buildstep_r">cr_buildstep_r</a>()</code>,
<code><a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>()</code>,
<code><a href="#topic+cr_buildstep_slack">cr_buildstep_slack</a>()</code>,
<code><a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a>()</code>,
<code><a href="#topic+cr_buildstep">cr_buildstep</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cr_project_set("my-project")
cr_bucket_set("my-bucket")
mailgun_url &lt;- "https://api.mailgun.net/v3/sandboxXXX.mailgun.org"
mailgun_key &lt;- "key-XXXX"
## Not run: 
# assumes you have verified the email
cr_build(
  cr_build_yaml(
    steps = cr_buildstep_mailgun(
      "Hello from Cloud Build",
      to = "me@verfied_email.com",
      subject = "Hello",
      from = "googleCloudRunner@example.com"
    ),
    substitutions = list(
      `_MAILGUN_URL` = mailgun_url,
      `_MAILGUN_KEY` = mailgun_key
    )
  )
)

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_buildstep_nginx_setup'>Setup nginx for Cloud Run in a buildstep</h2><span id='topic+cr_buildstep_nginx_setup'></span>

<h3>Description</h3>

<p>Setup nginx for Cloud Run in a buildstep
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep_nginx_setup(html_folder, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_nginx_setup_+3A_html_folder">html_folder</code></td>
<td>
<p>The folder that will hold the HTML for Cloud Run
</p>
<p>This uses a premade bash script that sets up a Docker container ready for Cloud Run running nginx</p>
</td></tr>
<tr><td><code id="cr_buildstep_nginx_setup_+3A_...">...</code></td>
<td>
<p>Other arguments passed to <a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a></p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other Cloud Buildsteps: 
<code><a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a>()</code>,
<code><a href="#topic+cr_buildstep_decrypt">cr_buildstep_decrypt</a>()</code>,
<code><a href="#topic+cr_buildstep_df">cr_buildstep_df</a>()</code>,
<code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a>()</code>,
<code><a href="#topic+cr_buildstep_edit">cr_buildstep_edit</a>()</code>,
<code><a href="#topic+cr_buildstep_extract">cr_buildstep_extract</a>()</code>,
<code><a href="#topic+cr_buildstep_gcloud">cr_buildstep_gcloud</a>()</code>,
<code><a href="#topic+cr_buildstep_gitsetup">cr_buildstep_gitsetup</a>()</code>,
<code><a href="#topic+cr_buildstep_mailgun">cr_buildstep_mailgun</a>()</code>,
<code><a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a>()</code>,
<code><a href="#topic+cr_buildstep_pkgdown">cr_buildstep_pkgdown</a>()</code>,
<code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a>()</code>,
<code><a href="#topic+cr_buildstep_r">cr_buildstep_r</a>()</code>,
<code><a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>()</code>,
<code><a href="#topic+cr_buildstep_slack">cr_buildstep_slack</a>()</code>,
<code><a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a>()</code>,
<code><a href="#topic+cr_buildstep">cr_buildstep</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cr_project_set("my-project")
cr_bucket_set("my-bucket")
cr_region_set("europe-west1")

html_folder &lt;- "my_html"
run_image &lt;- "gcr.io/my-project/my-image-for-cloudrun"
cr_build_yaml(
  steps = c(
    cr_buildstep_nginx_setup(html_folder),
    cr_buildstep_docker(run_image, dir = html_folder),
    cr_buildstep_run(
      name = "running-nginx",
      image = run_image,
      concurrency = 80
    )
  )
)
</code></pre>

<hr>
<h2 id='cr_buildstep_packagetests'>Do R package tests and upload to Codecov</h2><span id='topic+cr_buildstep_packagetests'></span>

<h3>Description</h3>

<p>This lets you run R package tests and is intended to be used in a trigger when you push to a repository so you can monitor code quality.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep_packagetests(
  test_script = NULL,
  codecov_script = NULL,
  codecov_token = "$_CODECOV_TOKEN",
  build_image = "gcr.io/gcer-public/packagetools:latest",
  env = c("NOT_CRAN=true")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_packagetests_+3A_test_script">test_script</code></td>
<td>
<p>The script that will call <a href="rcmdcheck.html#topic+rcmdcheck">rcmdcheck</a> to perform tests.  If <code>NULL</code> a default script is used in <code>system.file("r_buildsteps", "devtools_tests.R", package="googlecloudRunner")</code></p>
</td></tr>
<tr><td><code id="cr_buildstep_packagetests_+3A_codecov_script">codecov_script</code></td>
<td>
<p>The script that will call <a href="covr.html#topic+codecov">codecov</a> to perform coverage.  If <code>NULL</code> a default script is used in <code>system.file("r_buildsteps", "codecov_tests.R", package="googleCloudRunner")</code></p>
</td></tr>
<tr><td><code id="cr_buildstep_packagetests_+3A_codecov_token">codecov_token</code></td>
<td>
<p>If using codecov, supply your codecov token here.</p>
</td></tr>
<tr><td><code id="cr_buildstep_packagetests_+3A_build_image">build_image</code></td>
<td>
<p>The docker image that will be used to run the R code for the test scripts</p>
</td></tr>
<tr><td><code id="cr_buildstep_packagetests_+3A_env">env</code></td>
<td>
<p>Environment arguments to be set during the test script runs</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If using codecov, these environment arguments are added to aid with the codecoverage:
</p>
<p><code>
* "CODECOV_TOKEN=$_CODECOV_TOKEN"
* "GCB_PROJECT_ID=$PROJECT_ID"
* "GCB_BUILD_ID=$BUILD_ID"
* "GCB_COMMIT_SHA=$COMMIT_SHA"
* "GCB_REPO_NAME=$REPO_NAME"
* "GCB_BRANCH_NAME=$BRANCH_NAME"
* "GCB_TAG_NAME=$TAG_NAME"
* "GCB_HEAD_BRANCH=$_HEAD_BRANCH"
* "GCB_BASE_BRANCH=$_BASE_BRANCH"
* "GCB_HEAD_REPO_URL=$_HEAD_REPO_URL"
* "GCB_PR_NUMBER=$_PR_NUMBER"
</code>
</p>


<h3>See Also</h3>

<p><a href="https://docs.codecov.com/reference">https://docs.codecov.com/reference</a>
</p>
<p>Other Cloud Buildsteps: 
<code><a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a>()</code>,
<code><a href="#topic+cr_buildstep_decrypt">cr_buildstep_decrypt</a>()</code>,
<code><a href="#topic+cr_buildstep_df">cr_buildstep_df</a>()</code>,
<code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a>()</code>,
<code><a href="#topic+cr_buildstep_edit">cr_buildstep_edit</a>()</code>,
<code><a href="#topic+cr_buildstep_extract">cr_buildstep_extract</a>()</code>,
<code><a href="#topic+cr_buildstep_gcloud">cr_buildstep_gcloud</a>()</code>,
<code><a href="#topic+cr_buildstep_gitsetup">cr_buildstep_gitsetup</a>()</code>,
<code><a href="#topic+cr_buildstep_mailgun">cr_buildstep_mailgun</a>()</code>,
<code><a href="#topic+cr_buildstep_nginx_setup">cr_buildstep_nginx_setup</a>()</code>,
<code><a href="#topic+cr_buildstep_pkgdown">cr_buildstep_pkgdown</a>()</code>,
<code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a>()</code>,
<code><a href="#topic+cr_buildstep_r">cr_buildstep_r</a>()</code>,
<code><a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>()</code>,
<code><a href="#topic+cr_buildstep_slack">cr_buildstep_slack</a>()</code>,
<code><a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a>()</code>,
<code><a href="#topic+cr_buildstep">cr_buildstep</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cr_buildstep_packagetests()
</code></pre>

<hr>
<h2 id='cr_buildstep_pkgdown'>Create buildsteps for deploying an R pkgdown website to GitHub</h2><span id='topic+cr_buildstep_pkgdown'></span>

<h3>Description</h3>

<p>Create buildsteps for deploying an R pkgdown website to GitHub
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep_pkgdown(
  github_repo,
  git_email,
  secret,
  env = NULL,
  build_image = "gcr.io/gcer-public/packagetools:latest",
  post_setup = NULL,
  post_clone = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_pkgdown_+3A_github_repo">github_repo</code></td>
<td>
<p>The GitHub repo to deploy pkgdown website from and to.</p>
</td></tr>
<tr><td><code id="cr_buildstep_pkgdown_+3A_git_email">git_email</code></td>
<td>
<p>The email the git commands will be identifying as</p>
</td></tr>
<tr><td><code id="cr_buildstep_pkgdown_+3A_secret">secret</code></td>
<td>
<p>The name of the secret on Google Secret Manager for the git ssh private key</p>
</td></tr>
<tr><td><code id="cr_buildstep_pkgdown_+3A_env">env</code></td>
<td>
<p>A character vector of env arguments to set for all steps</p>
</td></tr>
<tr><td><code id="cr_buildstep_pkgdown_+3A_build_image">build_image</code></td>
<td>
<p>A docker image with <code>pkgdown</code> installed</p>
</td></tr>
<tr><td><code id="cr_buildstep_pkgdown_+3A_post_setup">post_setup</code></td>
<td>
<p>Steps that occur after git setup</p>
</td></tr>
<tr><td><code id="cr_buildstep_pkgdown_+3A_post_clone">post_clone</code></td>
<td>
<p>A <a href="#topic+cr_buildstep">cr_buildstep</a> that occurs after the repo is cloned</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Its convenient to set some of the above via <a href="#topic+Build">Build</a> macros, such as <code>github_repo=$_GITHUB_REPO</code> and <code>git_email=$_BUILD_EMAIL</code> in the Build Trigger web UI
</p>
<p>To commit the website to git, <a href="#topic+cr_buildstep_gitsetup">cr_buildstep_gitsetup</a> is used for which
you will need to add your git ssh private key to Google Secret Manager
</p>
<p>The R package is installed via <a href="devtools.html#topic+install">install</a> before
running <a href="pkgdown.html#topic+build_site">build_site</a>
</p>


<h3>See Also</h3>

<p>Other Cloud Buildsteps: 
<code><a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a>()</code>,
<code><a href="#topic+cr_buildstep_decrypt">cr_buildstep_decrypt</a>()</code>,
<code><a href="#topic+cr_buildstep_df">cr_buildstep_df</a>()</code>,
<code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a>()</code>,
<code><a href="#topic+cr_buildstep_edit">cr_buildstep_edit</a>()</code>,
<code><a href="#topic+cr_buildstep_extract">cr_buildstep_extract</a>()</code>,
<code><a href="#topic+cr_buildstep_gcloud">cr_buildstep_gcloud</a>()</code>,
<code><a href="#topic+cr_buildstep_gitsetup">cr_buildstep_gitsetup</a>()</code>,
<code><a href="#topic+cr_buildstep_mailgun">cr_buildstep_mailgun</a>()</code>,
<code><a href="#topic+cr_buildstep_nginx_setup">cr_buildstep_nginx_setup</a>()</code>,
<code><a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a>()</code>,
<code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a>()</code>,
<code><a href="#topic+cr_buildstep_r">cr_buildstep_r</a>()</code>,
<code><a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>()</code>,
<code><a href="#topic+cr_buildstep_slack">cr_buildstep_slack</a>()</code>,
<code><a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a>()</code>,
<code><a href="#topic+cr_buildstep">cr_buildstep</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cr_project_set("my-project")
cr_bucket_set("my-bucket")

# set github repo directly to write it out via cr_build_write()
cr_buildstep_pkgdown("MarkEdmondson1234/googleCloudRunner",
  git_email = "cloudbuild@google.com",
  secret = "github-ssh"
)

# github repo set via build trigger macro _GITHUB_REPO
cr_buildstep_pkgdown("$_GITHUB_REPO",
  git_email = "cloudbuild@google.com",
  secret = "github-ssh"
)

# example including environment arguments for pkgdown build step
cr_buildstep_pkgdown("$_GITHUB_REPO",
  git_email = "cloudbuild@google.com",
  secret = "github-ssh",
  env = c("MYVAR=$_MY_VAR", "PROJECT=$PROJECT_ID")
)
</code></pre>

<hr>
<h2 id='cr_buildstep_r'>Run an R script in a Cloud Build R step</h2><span id='topic+cr_buildstep_r'></span>

<h3>Description</h3>

<p>Helper to run R code within build steps, from either an existing local R file or within the source of the build.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep_r(
  r,
  name = "r-base",
  r_source = c("local", "runtime"),
  prefix = "rocker/",
  escape_dollar = TRUE,
  rscript_args = NULL,
  r_cmd = c("Rscript", "R"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_r_+3A_r">r</code></td>
<td>
<p>R code to run or a file containing R code ending with .R, or the gs:// location on Cloud Storage of the R file you want to run</p>
</td></tr>
<tr><td><code id="cr_buildstep_r_+3A_name">name</code></td>
<td>
<p>The docker image that will run the R code, usually from rocker-project.org</p>
</td></tr>
<tr><td><code id="cr_buildstep_r_+3A_r_source">r_source</code></td>
<td>
<p>Whether the R code will be from a runtime file within the source or at build time copying over from a local R file in your session</p>
</td></tr>
<tr><td><code id="cr_buildstep_r_+3A_prefix">prefix</code></td>
<td>
<p>prefixed to name - set to &quot;&quot; to suppress.  Will be suppressed if <code>name</code> starts with gcr.io or <code>*-docker.pkg.dev</code></p>
</td></tr>
<tr><td><code id="cr_buildstep_r_+3A_escape_dollar">escape_dollar</code></td>
<td>
<p>Default TRUE.  This will turn <code>$</code> into <code>$$</code> within the script to avoid them being recognised as Cloud Build variables.  Turn this off if you want that behaviour (e.g. <code>my_project="$PROJECT_ID"</code>)</p>
</td></tr>
<tr><td><code id="cr_buildstep_r_+3A_rscript_args">rscript_args</code></td>
<td>
<p>Optional arguments for the R script run by <code>Rscript</code>.</p>
</td></tr>
<tr><td><code id="cr_buildstep_r_+3A_r_cmd">r_cmd</code></td>
<td>
<p>should 'Rscript' be run or 'R'?</p>
</td></tr>
<tr><td><code id="cr_buildstep_r_+3A_...">...</code></td>
<td>
<p>Other arguments passed to <a href="#topic+cr_buildstep">cr_buildstep</a></p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>r_source="runtime"</code> then <code>r</code> should be the location of that file within the source or <code>image</code> that will be run by the R code from <code>image</code>
</p>
<p>If <code>r_source="local"</code> then it will copy over from a character string or local file into the build step directly.
</p>
<p>If the R code location starts with <code>gs://</code> then an extra buildstep will be added that will download the R script from that location then run it as per <code>r_source="runtime"</code>.  This will consequently override your setting of <code>r_source</code>
</p>


<h3>See Also</h3>

<p>Other Cloud Buildsteps: 
<code><a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a>()</code>,
<code><a href="#topic+cr_buildstep_decrypt">cr_buildstep_decrypt</a>()</code>,
<code><a href="#topic+cr_buildstep_df">cr_buildstep_df</a>()</code>,
<code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a>()</code>,
<code><a href="#topic+cr_buildstep_edit">cr_buildstep_edit</a>()</code>,
<code><a href="#topic+cr_buildstep_extract">cr_buildstep_extract</a>()</code>,
<code><a href="#topic+cr_buildstep_gcloud">cr_buildstep_gcloud</a>()</code>,
<code><a href="#topic+cr_buildstep_gitsetup">cr_buildstep_gitsetup</a>()</code>,
<code><a href="#topic+cr_buildstep_mailgun">cr_buildstep_mailgun</a>()</code>,
<code><a href="#topic+cr_buildstep_nginx_setup">cr_buildstep_nginx_setup</a>()</code>,
<code><a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a>()</code>,
<code><a href="#topic+cr_buildstep_pkgdown">cr_buildstep_pkgdown</a>()</code>,
<code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a>()</code>,
<code><a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>()</code>,
<code><a href="#topic+cr_buildstep_slack">cr_buildstep_slack</a>()</code>,
<code><a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a>()</code>,
<code><a href="#topic+cr_buildstep">cr_buildstep</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cr_project_set("my-project")
cr_bucket_set("my-bucket")

# create an R buildstep inline
cr_buildstep_r(c("paste('1+1=', 1+1)", "sessionInfo()"))
## Not run: 

# create an R buildstep from a local file
cr_buildstep_r("my-r-file.R")

# create an R buildstep from a file within the source of the Build
cr_buildstep_r("inst/schedule/schedule.R", r_source = "runtime")

# create an R buildstep with Rscript arguments and use a large
# machine with 32 cores

## create storage source
storage_source &lt;- cr_build_upload_gcs(
  "my-r-script.R"
)
## create the buildstep with the R script
step1 &lt;- cr_buildstep_r("deploy/my-r-script.R",
  r_source = "runtime",
  rscript_args = c("args_1=&lt;args1&gt;", "args_2=&lt;args_2&gt;")
)

## run the script on Cloud Build
cr_build(
  cr_build_yaml(
    steps = step1
  ),
  source = storage_source,
  options = list(machineType = "E2_HIGHCPU_32")
)

## End(Not run)
# use a different Rocker image e.g. rocker/verse
cr_buildstep_r(c(
  "library(dplyr)",
  "mtcars %&gt;% select(mpg)",
  "sessionInfo()"
),
name = "verse"
)

# use your own R image with custom R
my_r &lt;- c("devtools::install()", "pkgdown::build_site()")
br &lt;- cr_buildstep_r(my_r, name = "gcr.io/gcer-public/packagetools:latest")
</code></pre>

<hr>
<h2 id='cr_buildstep_run'>Create buildsteps to deploy to Cloud Run</h2><span id='topic+cr_buildstep_run'></span>

<h3>Description</h3>

<p>Create buildsteps to deploy to Cloud Run
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep_run(
  name,
  image,
  allowUnauthenticated = TRUE,
  region = cr_region_get(),
  concurrency = 80,
  port = NULL,
  max_instances = "default",
  memory = "256Mi",
  cpu = 1,
  env_vars = NULL,
  gcloud_args = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_run_+3A_name">name</code></td>
<td>
<p>Name for deployment on Cloud Run</p>
</td></tr>
<tr><td><code id="cr_buildstep_run_+3A_image">image</code></td>
<td>
<p>The name of the image to create or use in deployment - <code>gcr.io</code></p>
</td></tr>
<tr><td><code id="cr_buildstep_run_+3A_allowunauthenticated">allowUnauthenticated</code></td>
<td>
<p>TRUE if can be reached from public HTTP address. If FALSE will configure a service-email called <code>(name)-cloudrun-invoker@(project-id).iam.gserviceaccount.com</code></p>
</td></tr>
<tr><td><code id="cr_buildstep_run_+3A_region">region</code></td>
<td>
<p>The endpoint region for deployment</p>
</td></tr>
<tr><td><code id="cr_buildstep_run_+3A_concurrency">concurrency</code></td>
<td>
<p>How many connections each container instance can serve. Can be up to 80.</p>
</td></tr>
<tr><td><code id="cr_buildstep_run_+3A_port">port</code></td>
<td>
<p>Container port to receive requests at. Also sets the $PORT environment variable. Must be a number between 1 and 65535, inclusive. To unset this field, pass the special value &quot;default&quot;.</p>
</td></tr>
<tr><td><code id="cr_buildstep_run_+3A_max_instances">max_instances</code></td>
<td>
<p>the desired maximum nuimber of container instances. &quot;default&quot; is 1000, you can get more if you requested a quota instance.  For Shiny instances on Cloud Run, this needs to be 1.</p>
</td></tr>
<tr><td><code id="cr_buildstep_run_+3A_memory">memory</code></td>
<td>
<p>The format for size is a fixed or floating point number followed by a unit: G, M, or K corresponding to gigabyte, megabyte, or kilobyte, respectively, or use the power-of-two equivalents: Gi, Mi, Ki corresponding to gibibyte, mebibyte or kibibyte respectively. The default is 256Mi</p>
</td></tr>
<tr><td><code id="cr_buildstep_run_+3A_cpu">cpu</code></td>
<td>
<p>1 or 2 CPUs for your instance</p>
</td></tr>
<tr><td><code id="cr_buildstep_run_+3A_env_vars">env_vars</code></td>
<td>
<p>Environment arguments passed to the Cloud Run container at runtime.  Distinct from <code>env</code> that run at build time.</p>
</td></tr>
<tr><td><code id="cr_buildstep_run_+3A_gcloud_args">gcloud_args</code></td>
<td>
<p>a character string of arguments that can be sent to the gcloud command not covered by other parameters of this function</p>
</td></tr>
<tr><td><code id="cr_buildstep_run_+3A_...">...</code></td>
<td>
<p>passed on to <a href="#topic+cr_buildstep">cr_buildstep</a></p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Docs for <a href="https://cloud.google.com/sdk/gcloud/reference/run/deploy">gcloud run deploy this buildstep invokes</a>
</p>
<p>Other Cloud Buildsteps: 
<code><a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a>()</code>,
<code><a href="#topic+cr_buildstep_decrypt">cr_buildstep_decrypt</a>()</code>,
<code><a href="#topic+cr_buildstep_df">cr_buildstep_df</a>()</code>,
<code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a>()</code>,
<code><a href="#topic+cr_buildstep_edit">cr_buildstep_edit</a>()</code>,
<code><a href="#topic+cr_buildstep_extract">cr_buildstep_extract</a>()</code>,
<code><a href="#topic+cr_buildstep_gcloud">cr_buildstep_gcloud</a>()</code>,
<code><a href="#topic+cr_buildstep_gitsetup">cr_buildstep_gitsetup</a>()</code>,
<code><a href="#topic+cr_buildstep_mailgun">cr_buildstep_mailgun</a>()</code>,
<code><a href="#topic+cr_buildstep_nginx_setup">cr_buildstep_nginx_setup</a>()</code>,
<code><a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a>()</code>,
<code><a href="#topic+cr_buildstep_pkgdown">cr_buildstep_pkgdown</a>()</code>,
<code><a href="#topic+cr_buildstep_r">cr_buildstep_r</a>()</code>,
<code><a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>()</code>,
<code><a href="#topic+cr_buildstep_slack">cr_buildstep_slack</a>()</code>,
<code><a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a>()</code>,
<code><a href="#topic+cr_buildstep">cr_buildstep</a>()</code>
</p>

<hr>
<h2 id='cr_buildstep_secret'>Create a buildstep for using Secret Manager</h2><span id='topic+cr_buildstep_secret'></span>

<h3>Description</h3>

<p>This is the preferred way to manage secrets for files, rather than
<a href="#topic+cr_buildstep_decrypt">cr_buildstep_decrypt</a>, as it stores the encrypted file in the cloud
rather than in your project workspace.  For single environment values, <a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a> may be more suitable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep_secret(
  secret,
  decrypted,
  version = "latest",
  binary_mode = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_secret_+3A_secret">secret</code></td>
<td>
<p>The secret data name in Secret Manager</p>
</td></tr>
<tr><td><code id="cr_buildstep_secret_+3A_decrypted">decrypted</code></td>
<td>
<p>The name of the file the secret will be decrypted into</p>
</td></tr>
<tr><td><code id="cr_buildstep_secret_+3A_version">version</code></td>
<td>
<p>The version of the secret</p>
</td></tr>
<tr><td><code id="cr_buildstep_secret_+3A_binary_mode">binary_mode</code></td>
<td>
<p>Should the file be treated in binary/raw format?</p>
</td></tr>
<tr><td><code id="cr_buildstep_secret_+3A_...">...</code></td>
<td>
<p>Other arguments sent to <a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a></p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is for downloading encrypted files from Google Secret Manager.  You will need to add the
Secret Accessor Cloud IAM role to the Cloud Build service account to use it.
Once you have uploaded your secret file and named it, it is available for Cloud
Build to use.
</p>


<h3>See Also</h3>

<p>How to set up secrets using <a href="https://cloud.google.com/build/docs/securing-builds/use-secrets">Secret Manager</a>
</p>
<p><a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a> let you directly support environment arguments in the buildsteps
</p>
<p>Other Cloud Buildsteps: 
<code><a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a>()</code>,
<code><a href="#topic+cr_buildstep_decrypt">cr_buildstep_decrypt</a>()</code>,
<code><a href="#topic+cr_buildstep_df">cr_buildstep_df</a>()</code>,
<code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a>()</code>,
<code><a href="#topic+cr_buildstep_edit">cr_buildstep_edit</a>()</code>,
<code><a href="#topic+cr_buildstep_extract">cr_buildstep_extract</a>()</code>,
<code><a href="#topic+cr_buildstep_gcloud">cr_buildstep_gcloud</a>()</code>,
<code><a href="#topic+cr_buildstep_gitsetup">cr_buildstep_gitsetup</a>()</code>,
<code><a href="#topic+cr_buildstep_mailgun">cr_buildstep_mailgun</a>()</code>,
<code><a href="#topic+cr_buildstep_nginx_setup">cr_buildstep_nginx_setup</a>()</code>,
<code><a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a>()</code>,
<code><a href="#topic+cr_buildstep_pkgdown">cr_buildstep_pkgdown</a>()</code>,
<code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a>()</code>,
<code><a href="#topic+cr_buildstep_r">cr_buildstep_r</a>()</code>,
<code><a href="#topic+cr_buildstep_slack">cr_buildstep_slack</a>()</code>,
<code><a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a>()</code>,
<code><a href="#topic+cr_buildstep">cr_buildstep</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cr_buildstep_secret("my_secret", decrypted = "/workspace/secret.json")
</code></pre>

<hr>
<h2 id='cr_buildstep_slack'>Send a Slack message to a channel from a Cloud Build step</h2><span id='topic+cr_buildstep_slack'></span>

<h3>Description</h3>

<p>This uses https://github.com/technosophos/slack-notify to send Slack messages
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep_slack(
  message,
  title = "CloudBuild - $BUILD_ID",
  channel = NULL,
  username = "googleCloudRunnerBot",
  webhook = "$_SLACK_WEBHOOK",
  icon = NULL,
  colour = "#efefef"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_slack_+3A_message">message</code></td>
<td>
<p>The body of the message</p>
</td></tr>
<tr><td><code id="cr_buildstep_slack_+3A_title">title</code></td>
<td>
<p>The title of the message</p>
</td></tr>
<tr><td><code id="cr_buildstep_slack_+3A_channel">channel</code></td>
<td>
<p>The channel to send the message to (if omitted, use Slack-configured default)</p>
</td></tr>
<tr><td><code id="cr_buildstep_slack_+3A_username">username</code></td>
<td>
<p>The name of the sender of the message. Does not need to be a &quot;real&quot; username</p>
</td></tr>
<tr><td><code id="cr_buildstep_slack_+3A_webhook">webhook</code></td>
<td>
<p>The Slack webhook to send to</p>
</td></tr>
<tr><td><code id="cr_buildstep_slack_+3A_icon">icon</code></td>
<td>
<p>A URL to an icon (squares between 512px and 2000px)</p>
</td></tr>
<tr><td><code id="cr_buildstep_slack_+3A_colour">colour</code></td>
<td>
<p>The RGB colour for message formatting</p>
</td></tr>
</table>


<h3>Details</h3>

<p>You will need to set up a Slack webhook first, via this <a href="https://api.slack.com/messaging/webhooks">Slack guide on using incoming webhooks</a>.
</p>
<p>Once set, the default is to set this webhook to a Build macro called <code>_SLACK_WEBHOOK</code>, or supply it to the webhook argument.
</p>


<h3>See Also</h3>

<p>Other Cloud Buildsteps: 
<code><a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a>()</code>,
<code><a href="#topic+cr_buildstep_decrypt">cr_buildstep_decrypt</a>()</code>,
<code><a href="#topic+cr_buildstep_df">cr_buildstep_df</a>()</code>,
<code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a>()</code>,
<code><a href="#topic+cr_buildstep_edit">cr_buildstep_edit</a>()</code>,
<code><a href="#topic+cr_buildstep_extract">cr_buildstep_extract</a>()</code>,
<code><a href="#topic+cr_buildstep_gcloud">cr_buildstep_gcloud</a>()</code>,
<code><a href="#topic+cr_buildstep_gitsetup">cr_buildstep_gitsetup</a>()</code>,
<code><a href="#topic+cr_buildstep_mailgun">cr_buildstep_mailgun</a>()</code>,
<code><a href="#topic+cr_buildstep_nginx_setup">cr_buildstep_nginx_setup</a>()</code>,
<code><a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a>()</code>,
<code><a href="#topic+cr_buildstep_pkgdown">cr_buildstep_pkgdown</a>()</code>,
<code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a>()</code>,
<code><a href="#topic+cr_buildstep_r">cr_buildstep_r</a>()</code>,
<code><a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>()</code>,
<code><a href="#topic+cr_buildstep_targets">cr_buildstep_targets</a>()</code>,
<code><a href="#topic+cr_buildstep">cr_buildstep</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># send a message to googleAuthRverse Slack
webhook &lt;-
  "https://hooks.slack.com/services/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"
cr_buildstep_slack("Hello Slack", webhook = webhook)
## Not run: 

bs &lt;- cr_build_yaml(steps = cr_buildstep_slack("Hello Slack"))

cr_build(bs, substitutions = list(`_SLACK_WEBHOOK` = webhook))

## End(Not run)

</code></pre>

<hr>
<h2 id='cr_buildstep_targets'>Buildstep to run a targets pipeline on Cloud Build</h2><span id='topic+cr_buildstep_targets'></span><span id='topic+cr_buildstep_targets_setup'></span><span id='topic+cr_buildstep_targets_teardown'></span>

<h3>Description</h3>

<p>This is a buildstep to help upload a targets pipeline, see <a href="#topic+cr_build_targets">cr_build_targets</a> for examples and suggested workflow
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildstep_targets(
  task_args = NULL,
  tar_make = "targets::tar_make()",
  task_image = "gcr.io/gcer-public/targets",
  id = "target pipeline"
)

cr_buildstep_targets_setup(bucket_folder)

cr_buildstep_targets_teardown(bucket_folder, last_id = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildstep_targets_+3A_task_args">task_args</code></td>
<td>
<p>If not NULL, a named list of additional arguments to send to <a href="#topic+cr_buildstep_r">cr_buildstep_r</a> when its executing the <a href="targets.html#topic+tar_make">tar_make</a> command (such as environment arguments or waitFor ids)</p>
</td></tr>
<tr><td><code id="cr_buildstep_targets_+3A_tar_make">tar_make</code></td>
<td>
<p>The R script that will run in the <code>tar_make()</code> step. Modify to include custom settings</p>
</td></tr>
<tr><td><code id="cr_buildstep_targets_+3A_task_image">task_image</code></td>
<td>
<p>An existing Docker image that will be used to run your targets workflow after the targets meta has been downloaded from Google Cloud Storage</p>
</td></tr>
<tr><td><code id="cr_buildstep_targets_+3A_id">id</code></td>
<td>
<p>The id of the buildstep.  In linkcr_buildstep_targets_multi this is used along with <code>waitFor</code> to determine the order of execution</p>
</td></tr>
<tr><td><code id="cr_buildstep_targets_+3A_bucket_folder">bucket_folder</code></td>
<td>
<p>The Google Cloud Storage bucket and folder the target metadata will be saved to, e.g. <code>gs://my-bucket/my_target_project</code>   You can also pass in build substitution variables such as <code>"${_MY_BUCKET}"</code>.</p>
</td></tr>
<tr><td><code id="cr_buildstep_targets_+3A_last_id">last_id</code></td>
<td>
<p>The final buildstep that needs to complete before the upload.  If left NULL then will default to the last tar_target step.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other Cloud Buildsteps: 
<code><a href="#topic+cr_buildstep_bash">cr_buildstep_bash</a>()</code>,
<code><a href="#topic+cr_buildstep_decrypt">cr_buildstep_decrypt</a>()</code>,
<code><a href="#topic+cr_buildstep_df">cr_buildstep_df</a>()</code>,
<code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a>()</code>,
<code><a href="#topic+cr_buildstep_edit">cr_buildstep_edit</a>()</code>,
<code><a href="#topic+cr_buildstep_extract">cr_buildstep_extract</a>()</code>,
<code><a href="#topic+cr_buildstep_gcloud">cr_buildstep_gcloud</a>()</code>,
<code><a href="#topic+cr_buildstep_gitsetup">cr_buildstep_gitsetup</a>()</code>,
<code><a href="#topic+cr_buildstep_mailgun">cr_buildstep_mailgun</a>()</code>,
<code><a href="#topic+cr_buildstep_nginx_setup">cr_buildstep_nginx_setup</a>()</code>,
<code><a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a>()</code>,
<code><a href="#topic+cr_buildstep_pkgdown">cr_buildstep_pkgdown</a>()</code>,
<code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a>()</code>,
<code><a href="#topic+cr_buildstep_r">cr_buildstep_r</a>()</code>,
<code><a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a>()</code>,
<code><a href="#topic+cr_buildstep_slack">cr_buildstep_slack</a>()</code>,
<code><a href="#topic+cr_buildstep">cr_buildstep</a>()</code>
</p>

<hr>
<h2 id='cr_buildtrigger'>Create a new BuildTrigger</h2><span id='topic+cr_buildtrigger'></span>

<h3>Description</h3>

<p>Build Triggers are a way to have your builds respond to various events, most commonly a git commit or a pubsub event.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildtrigger(
  build,
  name,
  trigger,
  description = paste("cr_buildtrigger: ", Sys.time()),
  disabled = FALSE,
  substitutions = NULL,
  ignoredFiles = NULL,
  includedFiles = NULL,
  trigger_tags = NULL,
  projectId = cr_project_get(),
  sourceToBuild = NULL,
  overwrite = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildtrigger_+3A_build">build</code></td>
<td>
<p>The build to trigger created via <a href="#topic+cr_build_make">cr_build_make</a>, or the file location of the cloudbuild.yaml within the trigger source</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_+3A_name">name</code></td>
<td>
<p>User assigned name of the trigger</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_+3A_trigger">trigger</code></td>
<td>
<p>The trigger source created via <a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a> or a pubsub trigger made with <a href="#topic+cr_buildtrigger_pubsub">cr_buildtrigger_pubsub</a> or a webhook trigger made with <a href="#topic+cr_buildtrigger_webhook">cr_buildtrigger_webhook</a></p>
</td></tr>
<tr><td><code id="cr_buildtrigger_+3A_description">description</code></td>
<td>
<p>Human-readable description of this trigger</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_+3A_disabled">disabled</code></td>
<td>
<p>If true, the trigger will never result in a build</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_+3A_substitutions">substitutions</code></td>
<td>
<p>A named list of Build macro variables</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_+3A_ignoredfiles">ignoredFiles</code></td>
<td>
<p>ignored_files and included_files are file glob matches extended with support for &quot;**&quot;.</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_+3A_includedfiles">includedFiles</code></td>
<td>
<p>If any of the files altered in the commit pass the ignored_files</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_+3A_trigger_tags">trigger_tags</code></td>
<td>
<p>Tags for the buildtrigger listing</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_+3A_projectid">projectId</code></td>
<td>
<p>ID of the project for which to configure automatic builds</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_+3A_sourcetobuild">sourceToBuild</code></td>
<td>
<p>A <a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a> object (but no regex allowed for branch or tag)  This field is currently only used by Webhook, Pub/Sub, Manual, and Cron triggers and is the source of the build will execute upon.</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_+3A_overwrite">overwrite</code></td>
<td>
<p>If TRUE will overwrite an existing trigger with the same name</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Any source specified in the build will be overwritten to use the trigger as a source (GitHub or Cloud Source Repositories)
</p>
<p>If you want multiple triggers for a build, then duplicate the build and create another build under a different name but with a different trigger.  Its easier to keep track of.
</p>


<h3>See Also</h3>

<p>Other BuildTrigger functions: 
<code><a href="#topic+BuildTrigger">BuildTrigger</a>()</code>,
<code><a href="#topic+GitHubEventsConfig">GitHubEventsConfig</a>()</code>,
<code><a href="#topic+cr_buildtrigger_copy">cr_buildtrigger_copy</a>()</code>,
<code><a href="#topic+cr_buildtrigger_delete">cr_buildtrigger_delete</a>()</code>,
<code><a href="#topic+cr_buildtrigger_edit">cr_buildtrigger_edit</a>()</code>,
<code><a href="#topic+cr_buildtrigger_get">cr_buildtrigger_get</a>()</code>,
<code><a href="#topic+cr_buildtrigger_list">cr_buildtrigger_list</a>()</code>,
<code><a href="#topic+cr_buildtrigger_pubsub">cr_buildtrigger_pubsub</a>()</code>,
<code><a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a>()</code>,
<code><a href="#topic+cr_buildtrigger_run">cr_buildtrigger_run</a>()</code>,
<code><a href="#topic+cr_buildtrigger_webhook">cr_buildtrigger_webhook</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cr_project_set("my-project")
cr_bucket_set("my-bucket")
cloudbuild &lt;- system.file("cloudbuild/cloudbuild.yaml",
  package = "googleCloudRunner"
)
bb &lt;- cr_build_make(cloudbuild)

# repo hosted on GitHub
gh_trigger &lt;- cr_buildtrigger_repo("MarkEdmondson1234/googleCloudRunner")

# repo mirrored to Cloud Source Repositories
cs_trigger &lt;- cr_buildtrigger_repo("github_markedmondson1234_googlecloudrunner",
  type = "cloud_source"
)
## Not run: 
# build with in-line build code
cr_buildtrigger(bb, name = "bt-github-inline", trigger = gh_trigger)

# build with in-line build code using Cloud Source Repository
cr_buildtrigger(bb, name = "bt-github-inline", trigger = cs_trigger)

# build pointing to cloudbuild.yaml within the GitHub repo
cr_buildtrigger("inst/cloudbuild/cloudbuild.yaml",
  name = "bt-github-file", trigger = gh_trigger
)

# build with repo mirror from file
cr_buildtrigger("inst/cloudbuild/cloudbuild.yaml",
  name = "bt-cs-file", trigger = cs_trigger
)

## End(Not run)

# creating build triggers that respond to pubsub events
## Not run: 
# create a pubsub topic either in webUI or via library(googlePubSubR)
library(googlePubsubR)
pubsub_auth()
topics_create("test-topic")

## End(Not run)

# create build trigger that will work from pub/subscription
pubsub_trigger &lt;- cr_buildtrigger_pubsub("test-topic")
pubsub_trigger
## Not run: 
# create the build trigger with in-line build
cr_buildtrigger(bb, name = "pubsub-triggered", trigger = pubsub_trigger)
# create scheduler that calls the pub/sub topic

cr_schedule("cloud-build-pubsub",
  "15 5 * * *",
  pubsubTarget = cr_schedule_pubsub("test-topic")
)

## End(Not run)

# create a pubsub trigger that uses github as a source of code to build upon
gh &lt;- cr_buildtrigger_repo("MarkEdmondson1234/googleCloudRunner")
blist &lt;- cr_build_make(cr_build_yaml(cr_buildstep_r('list.files()')))

## Not run: 
cr_buildtrigger(blist,
                name = "pubsub-triggered-github-source",
                trigger = pubsub_trigger,
                sourceToBuild = gh)

## End(Not run)

</code></pre>

<hr>
<h2 id='cr_buildtrigger_copy'>Copy a buildtrigger</h2><span id='topic+cr_buildtrigger_copy'></span>

<h3>Description</h3>

<p>This lets you use the response from <a href="#topic+cr_buildtrigger_get">cr_buildtrigger_get</a> for an existing buildtrigger to copy over settings to a new buildtrigger.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildtrigger_copy(
  buildTrigger,
  filename = NULL,
  name = NULL,
  tags = NULL,
  build = NULL,
  ignoredFiles = NULL,
  github = NULL,
  sourceToBuild = NULL,
  substitutions = NULL,
  includedFiles = NULL,
  disabled = NULL,
  triggerTemplate = NULL,
  projectId = cr_project_get()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildtrigger_copy_+3A_buildtrigger">buildTrigger</code></td>
<td>
<p>A <code>CloudBuildTriggerResponse</code> object from <a href="#topic+cr_buildtrigger_get">cr_buildtrigger_get</a></p>
</td></tr>
<tr><td><code id="cr_buildtrigger_copy_+3A_filename">filename</code></td>
<td>
<p>Path, from the source root, to a file whose contents is used for the build</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_copy_+3A_name">name</code></td>
<td>
<p>User assigned name of the trigger</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_copy_+3A_tags">tags</code></td>
<td>
<p>Tags for annotation of a 'BuildTrigger'</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_copy_+3A_build">build</code></td>
<td>
<p>Contents of the build template</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_copy_+3A_ignoredfiles">ignoredFiles</code></td>
<td>
<p>ignored_files and included_files are file glob matches extended with support for &quot;**&quot;.</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_copy_+3A_github">github</code></td>
<td>
<p>a <a href="#topic+GitHubEventsConfig">GitHubEventsConfig</a> object - mutually exclusive with <code>triggerTemplate</code></p>
</td></tr>
<tr><td><code id="cr_buildtrigger_copy_+3A_sourcetobuild">sourceToBuild</code></td>
<td>
<p>A <a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a> object (but no regex allowed for branch or tag)  This field is currently only used by Webhook, Pub/Sub, Manual, and Cron triggers and is the source of the build will execute upon.</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_copy_+3A_substitutions">substitutions</code></td>
<td>
<p>A named list of Build macro variables</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_copy_+3A_includedfiles">includedFiles</code></td>
<td>
<p>If any of the files altered in the commit pass the ignored_files</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_copy_+3A_disabled">disabled</code></td>
<td>
<p>If true, the trigger will never result in a build</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_copy_+3A_triggertemplate">triggerTemplate</code></td>
<td>
<p>a <a href="#topic+RepoSource">RepoSource</a> object - mutually exclusive with <code>github</code></p>
</td></tr>
<tr><td><code id="cr_buildtrigger_copy_+3A_projectid">projectId</code></td>
<td>
<p>The projectId you are copying to</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Overwrite settings for the build trigger you are copying by supplying it as one of the other arguments from <a href="#topic+BuildTrigger">BuildTrigger</a>.
</p>


<h3>See Also</h3>

<p>Other BuildTrigger functions: 
<code><a href="#topic+BuildTrigger">BuildTrigger</a>()</code>,
<code><a href="#topic+GitHubEventsConfig">GitHubEventsConfig</a>()</code>,
<code><a href="#topic+cr_buildtrigger_delete">cr_buildtrigger_delete</a>()</code>,
<code><a href="#topic+cr_buildtrigger_edit">cr_buildtrigger_edit</a>()</code>,
<code><a href="#topic+cr_buildtrigger_get">cr_buildtrigger_get</a>()</code>,
<code><a href="#topic+cr_buildtrigger_list">cr_buildtrigger_list</a>()</code>,
<code><a href="#topic+cr_buildtrigger_pubsub">cr_buildtrigger_pubsub</a>()</code>,
<code><a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a>()</code>,
<code><a href="#topic+cr_buildtrigger_run">cr_buildtrigger_run</a>()</code>,
<code><a href="#topic+cr_buildtrigger_webhook">cr_buildtrigger_webhook</a>()</code>,
<code><a href="#topic+cr_buildtrigger">cr_buildtrigger</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# copying a GitHub buildtrigger across projects and git repos
bt &lt;- cr_buildtrigger_get("my-trigger", projectId = "my-project-1")

# a new GitHub project
gh &lt;- GitHubEventsConfig("username/new-repo",
  event = "push",
  branch = "^master$"
)

# give 'Cloud Build Editor' role to your service auth key in new project
# then copy configuration across
cr_buildtrigger_copy(bt, github = gh, projectId = "my-new-project")

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_buildtrigger_delete'>Deletes a 'BuildTrigger' by its project ID and trigger ID.This API is experimental.</h2><span id='topic+cr_buildtrigger_delete'></span>

<h3>Description</h3>

<p>Deletes a 'BuildTrigger' by its project ID and trigger ID.This API is experimental.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildtrigger_delete(triggerId, projectId = cr_project_get())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildtrigger_delete_+3A_triggerid">triggerId</code></td>
<td>
<p>ID of the 'BuildTrigger' to get or a <code>BuildTriggerResponse</code> object</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_delete_+3A_projectid">projectId</code></td>
<td>
<p>ID of the project that owns the trigger</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other BuildTrigger functions: 
<code><a href="#topic+BuildTrigger">BuildTrigger</a>()</code>,
<code><a href="#topic+GitHubEventsConfig">GitHubEventsConfig</a>()</code>,
<code><a href="#topic+cr_buildtrigger_copy">cr_buildtrigger_copy</a>()</code>,
<code><a href="#topic+cr_buildtrigger_edit">cr_buildtrigger_edit</a>()</code>,
<code><a href="#topic+cr_buildtrigger_get">cr_buildtrigger_get</a>()</code>,
<code><a href="#topic+cr_buildtrigger_list">cr_buildtrigger_list</a>()</code>,
<code><a href="#topic+cr_buildtrigger_pubsub">cr_buildtrigger_pubsub</a>()</code>,
<code><a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a>()</code>,
<code><a href="#topic+cr_buildtrigger_run">cr_buildtrigger_run</a>()</code>,
<code><a href="#topic+cr_buildtrigger_webhook">cr_buildtrigger_webhook</a>()</code>,
<code><a href="#topic+cr_buildtrigger">cr_buildtrigger</a>()</code>
</p>

<hr>
<h2 id='cr_buildtrigger_edit'>Updates a 'BuildTrigger' by its project ID and trigger ID.This API is experimental.</h2><span id='topic+cr_buildtrigger_edit'></span>

<h3>Description</h3>

<p>Seems not to work at the moment (issue #16)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildtrigger_edit(BuildTrigger, triggerId, projectId = cr_project_get())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildtrigger_edit_+3A_buildtrigger">BuildTrigger</code></td>
<td>
<p>The <a href="#topic+BuildTrigger">BuildTrigger</a> object to update to</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_edit_+3A_triggerid">triggerId</code></td>
<td>
<p>ID of the 'BuildTrigger' to edit or a previous <code>BuildTriggerResponse</code> object that will be edited</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_edit_+3A_projectid">projectId</code></td>
<td>
<p>ID of the project that owns the trigger</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other BuildTrigger functions: 
<code><a href="#topic+BuildTrigger">BuildTrigger</a>()</code>,
<code><a href="#topic+GitHubEventsConfig">GitHubEventsConfig</a>()</code>,
<code><a href="#topic+cr_buildtrigger_copy">cr_buildtrigger_copy</a>()</code>,
<code><a href="#topic+cr_buildtrigger_delete">cr_buildtrigger_delete</a>()</code>,
<code><a href="#topic+cr_buildtrigger_get">cr_buildtrigger_get</a>()</code>,
<code><a href="#topic+cr_buildtrigger_list">cr_buildtrigger_list</a>()</code>,
<code><a href="#topic+cr_buildtrigger_pubsub">cr_buildtrigger_pubsub</a>()</code>,
<code><a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a>()</code>,
<code><a href="#topic+cr_buildtrigger_run">cr_buildtrigger_run</a>()</code>,
<code><a href="#topic+cr_buildtrigger_webhook">cr_buildtrigger_webhook</a>()</code>,
<code><a href="#topic+cr_buildtrigger">cr_buildtrigger</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

github &lt;- GitHubEventsConfig("MarkEdmondson1234/googleCloudRunner",
  branch = "master"
)
bt2 &lt;- cr_buildtrigger("trig2",
  trigger = github,
  build = "inst/cloudbuild/cloudbuild.yaml"
)
bt3 &lt;- BuildTrigger(
  filename = "inst/cloudbuild/cloudbuild.yaml",
  name = "edited1",
  tags = "edit",
  github = github,
  disabled = TRUE,
  description = "edited trigger"
)

edited &lt;- cr_buildtrigger_edit(bt3, triggerId = bt2)

## End(Not run)

</code></pre>

<hr>
<h2 id='cr_buildtrigger_get'>Returns information about a 'BuildTrigger'.This API is experimental.</h2><span id='topic+cr_buildtrigger_get'></span>

<h3>Description</h3>

<p>Returns information about a 'BuildTrigger'.This API is experimental.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildtrigger_get(triggerId, projectId = cr_project_get())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildtrigger_get_+3A_triggerid">triggerId</code></td>
<td>
<p>ID of the 'BuildTrigger' to get or a <code>BuildTriggerResponse</code> object</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_get_+3A_projectid">projectId</code></td>
<td>
<p>ID of the project that owns the trigger</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other BuildTrigger functions: 
<code><a href="#topic+BuildTrigger">BuildTrigger</a>()</code>,
<code><a href="#topic+GitHubEventsConfig">GitHubEventsConfig</a>()</code>,
<code><a href="#topic+cr_buildtrigger_copy">cr_buildtrigger_copy</a>()</code>,
<code><a href="#topic+cr_buildtrigger_delete">cr_buildtrigger_delete</a>()</code>,
<code><a href="#topic+cr_buildtrigger_edit">cr_buildtrigger_edit</a>()</code>,
<code><a href="#topic+cr_buildtrigger_list">cr_buildtrigger_list</a>()</code>,
<code><a href="#topic+cr_buildtrigger_pubsub">cr_buildtrigger_pubsub</a>()</code>,
<code><a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a>()</code>,
<code><a href="#topic+cr_buildtrigger_run">cr_buildtrigger_run</a>()</code>,
<code><a href="#topic+cr_buildtrigger_webhook">cr_buildtrigger_webhook</a>()</code>,
<code><a href="#topic+cr_buildtrigger">cr_buildtrigger</a>()</code>
</p>

<hr>
<h2 id='cr_buildtrigger_list'>Lists existing 'BuildTrigger's.This API is experimental.</h2><span id='topic+cr_buildtrigger_list'></span>

<h3>Description</h3>

<p>Lists existing 'BuildTrigger's.This API is experimental.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildtrigger_list(projectId = cr_project_get())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildtrigger_list_+3A_projectid">projectId</code></td>
<td>
<p>ID of the project for which to list BuildTriggers</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><a href="#topic+cr_build_list">cr_build_list</a> which merges with this list
</p>
<p>Other BuildTrigger functions: 
<code><a href="#topic+BuildTrigger">BuildTrigger</a>()</code>,
<code><a href="#topic+GitHubEventsConfig">GitHubEventsConfig</a>()</code>,
<code><a href="#topic+cr_buildtrigger_copy">cr_buildtrigger_copy</a>()</code>,
<code><a href="#topic+cr_buildtrigger_delete">cr_buildtrigger_delete</a>()</code>,
<code><a href="#topic+cr_buildtrigger_edit">cr_buildtrigger_edit</a>()</code>,
<code><a href="#topic+cr_buildtrigger_get">cr_buildtrigger_get</a>()</code>,
<code><a href="#topic+cr_buildtrigger_pubsub">cr_buildtrigger_pubsub</a>()</code>,
<code><a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a>()</code>,
<code><a href="#topic+cr_buildtrigger_run">cr_buildtrigger_run</a>()</code>,
<code><a href="#topic+cr_buildtrigger_webhook">cr_buildtrigger_webhook</a>()</code>,
<code><a href="#topic+cr_buildtrigger">cr_buildtrigger</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

cr_buildtrigger_list()

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_buildtrigger_pubsub'>Create a buildtrigger pub/sub object</h2><span id='topic+cr_buildtrigger_pubsub'></span>

<h3>Description</h3>

<p>Create a trigger from a Pub/Sub topic
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildtrigger_pubsub(
  topic,
  serviceAccountEmail = NULL,
  projectId = cr_project_get()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildtrigger_pubsub_+3A_topic">topic</code></td>
<td>
<p>The name of the Cloud Pub/Sub topic or a Topic object from <a href="googlePubsubR.html#topic+topics_get">topics_get</a></p>
</td></tr>
<tr><td><code id="cr_buildtrigger_pubsub_+3A_serviceaccountemail">serviceAccountEmail</code></td>
<td>
<p>Service account that will make the push request.</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_pubsub_+3A_projectid">projectId</code></td>
<td>
<p>The GCP project the topic is created within</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When using a PubSub trigger, you can use data within your PubSub message in substitution variables within the build.  The data from pubsub is available in the variable value: <code>$(body.message.data.x)</code> when x is a field in the pubsub message.
</p>


<h3>See Also</h3>

<p>Other BuildTrigger functions: 
<code><a href="#topic+BuildTrigger">BuildTrigger</a>()</code>,
<code><a href="#topic+GitHubEventsConfig">GitHubEventsConfig</a>()</code>,
<code><a href="#topic+cr_buildtrigger_copy">cr_buildtrigger_copy</a>()</code>,
<code><a href="#topic+cr_buildtrigger_delete">cr_buildtrigger_delete</a>()</code>,
<code><a href="#topic+cr_buildtrigger_edit">cr_buildtrigger_edit</a>()</code>,
<code><a href="#topic+cr_buildtrigger_get">cr_buildtrigger_get</a>()</code>,
<code><a href="#topic+cr_buildtrigger_list">cr_buildtrigger_list</a>()</code>,
<code><a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a>()</code>,
<code><a href="#topic+cr_buildtrigger_run">cr_buildtrigger_run</a>()</code>,
<code><a href="#topic+cr_buildtrigger_webhook">cr_buildtrigger_webhook</a>()</code>,
<code><a href="#topic+cr_buildtrigger">cr_buildtrigger</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# create build object
cloudbuild &lt;- system.file("cloudbuild/cloudbuild_substitutions.yml",
  package = "googleCloudRunner"
)
the_build &lt;- cr_build_make(cloudbuild)

# this build includes substitution variables that read from pubsub message var1
the_build

# using googlePubSubR to create pub/sub topic if needed
## Not run: 
library(googlePubsubR)
pubsub_auth()
topics_create("test-topic")

## End(Not run)

# create build trigger that will work from pub/subscription
pubsub_trigger &lt;- cr_buildtrigger_pubsub("test-topic")
pubsub_trigger
## Not run: 
cr_buildtrigger(the_build, name = "pubsub-triggered-subs", trigger = pubsub_trigger)

## End(Not run)

# make base64 encoded json for pubsub
library(jsonlite)
library(googlePubsubR)

# the message with the var1 that will be passed into the Cloud Build via substitution
message &lt;- toJSON(list(var1 = "hello mum"))

# turning into JSON and encoding
send_me &lt;- msg_encode(message)
## Not run: 
# send a PubSub message with the encoded data message
topics_publish(PubsubMessage(send_me), "test-topic")

# did it work? After a while should see logs if it did
cr_buildtrigger_logs("pubsub-triggered-subs")

## End(Not run)

</code></pre>

<hr>
<h2 id='cr_buildtrigger_repo'>Create a buildtrigger repo object</h2><span id='topic+cr_buildtrigger_repo'></span>

<h3>Description</h3>

<p>Create a repository trigger object for use in build triggers
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildtrigger_repo(
  repo_name,
  branch = ".*",
  tag = NULL,
  type = c("github", "cloud_source"),
  github_secret = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildtrigger_repo_+3A_repo_name">repo_name</code></td>
<td>
<p>Either the GitHub username/repo_name or the Cloud Source repo_name</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_repo_+3A_branch">branch</code></td>
<td>
<p>Regex of the branches that will trigger a build.  Ignore if tag is not NULL</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_repo_+3A_tag">tag</code></td>
<td>
<p>Regex of tags that will trigger a build</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_repo_+3A_type">type</code></td>
<td>
<p>Whether trigger is GitHub or Cloud Source repoistory</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_repo_+3A_github_secret">github_secret</code></td>
<td>
<p>If you need to pull from a private GitHub repo, add the github secret from Google Secret Manager which will be used via <a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a></p>
</td></tr>
<tr><td><code id="cr_buildtrigger_repo_+3A_...">...</code></td>
<td>
<p>Other arguments passed to either <a href="#topic+GitHubEventsConfig">GitHubEventsConfig</a> or <a href="#topic+RepoSource">RepoSource</a></p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other BuildTrigger functions: 
<code><a href="#topic+BuildTrigger">BuildTrigger</a>()</code>,
<code><a href="#topic+GitHubEventsConfig">GitHubEventsConfig</a>()</code>,
<code><a href="#topic+cr_buildtrigger_copy">cr_buildtrigger_copy</a>()</code>,
<code><a href="#topic+cr_buildtrigger_delete">cr_buildtrigger_delete</a>()</code>,
<code><a href="#topic+cr_buildtrigger_edit">cr_buildtrigger_edit</a>()</code>,
<code><a href="#topic+cr_buildtrigger_get">cr_buildtrigger_get</a>()</code>,
<code><a href="#topic+cr_buildtrigger_list">cr_buildtrigger_list</a>()</code>,
<code><a href="#topic+cr_buildtrigger_pubsub">cr_buildtrigger_pubsub</a>()</code>,
<code><a href="#topic+cr_buildtrigger_run">cr_buildtrigger_run</a>()</code>,
<code><a href="#topic+cr_buildtrigger_webhook">cr_buildtrigger_webhook</a>()</code>,
<code><a href="#topic+cr_buildtrigger">cr_buildtrigger</a>()</code>
</p>

<hr>
<h2 id='cr_buildtrigger_run'>Runs a 'BuildTrigger' at a particular source revision.</h2><span id='topic+cr_buildtrigger_run'></span>

<h3>Description</h3>

<p>Runs a 'BuildTrigger' at a particular source revision.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildtrigger_run(triggerId, RepoSource, projectId = cr_project_get())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildtrigger_run_+3A_triggerid">triggerId</code></td>
<td>
<p>ID of the 'BuildTrigger' to get or a <code>BuildTriggerResponse</code> object</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_run_+3A_reposource">RepoSource</code></td>
<td>
<p>The <a href="#topic+RepoSource">RepoSource</a> object to pass to this method</p>
</td></tr>
<tr><td><code id="cr_buildtrigger_run_+3A_projectid">projectId</code></td>
<td>
<p>ID of the project</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other BuildTrigger functions: 
<code><a href="#topic+BuildTrigger">BuildTrigger</a>()</code>,
<code><a href="#topic+GitHubEventsConfig">GitHubEventsConfig</a>()</code>,
<code><a href="#topic+cr_buildtrigger_copy">cr_buildtrigger_copy</a>()</code>,
<code><a href="#topic+cr_buildtrigger_delete">cr_buildtrigger_delete</a>()</code>,
<code><a href="#topic+cr_buildtrigger_edit">cr_buildtrigger_edit</a>()</code>,
<code><a href="#topic+cr_buildtrigger_get">cr_buildtrigger_get</a>()</code>,
<code><a href="#topic+cr_buildtrigger_list">cr_buildtrigger_list</a>()</code>,
<code><a href="#topic+cr_buildtrigger_pubsub">cr_buildtrigger_pubsub</a>()</code>,
<code><a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a>()</code>,
<code><a href="#topic+cr_buildtrigger_webhook">cr_buildtrigger_webhook</a>()</code>,
<code><a href="#topic+cr_buildtrigger">cr_buildtrigger</a>()</code>
</p>

<hr>
<h2 id='cr_buildtrigger_webhook'>Create a buildtrigger webhook object</h2><span id='topic+cr_buildtrigger_webhook'></span>

<h3>Description</h3>

<p>Create a trigger from a webhook
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_buildtrigger_webhook(secret)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_buildtrigger_webhook_+3A_secret">secret</code></td>
<td>
<p>Resource name for the secret required as a URL parameter.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other BuildTrigger functions: 
<code><a href="#topic+BuildTrigger">BuildTrigger</a>()</code>,
<code><a href="#topic+GitHubEventsConfig">GitHubEventsConfig</a>()</code>,
<code><a href="#topic+cr_buildtrigger_copy">cr_buildtrigger_copy</a>()</code>,
<code><a href="#topic+cr_buildtrigger_delete">cr_buildtrigger_delete</a>()</code>,
<code><a href="#topic+cr_buildtrigger_edit">cr_buildtrigger_edit</a>()</code>,
<code><a href="#topic+cr_buildtrigger_get">cr_buildtrigger_get</a>()</code>,
<code><a href="#topic+cr_buildtrigger_list">cr_buildtrigger_list</a>()</code>,
<code><a href="#topic+cr_buildtrigger_pubsub">cr_buildtrigger_pubsub</a>()</code>,
<code><a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a>()</code>,
<code><a href="#topic+cr_buildtrigger_run">cr_buildtrigger_run</a>()</code>,
<code><a href="#topic+cr_buildtrigger">cr_buildtrigger</a>()</code>
</p>

<hr>
<h2 id='cr_deploy_badger'>Deploy a Cloud Run app to display build badges</h2><span id='topic+cr_deploy_badger'></span><span id='topic+cr_build_logs_badger'></span>

<h3>Description</h3>

<p>This uses <a href="https://github.com/kelseyhightower/badger">https://github.com/kelseyhightower/badger</a> to create badges you can display in README.md etc. showing the current status of a Cloud Build
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_deploy_badger(
  badger_image = "gcr.io/hightowerlabs/badger:0.0.1",
  json = Sys.getenv("GAR_CLIENT_JSON"),
  region = cr_region_get()
)

cr_build_logs_badger(dir = getwd(), projectId = cr_project_get())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_deploy_badger_+3A_badger_image">badger_image</code></td>
<td>
<p>The docker image from the badger project to use</p>
</td></tr>
<tr><td><code id="cr_deploy_badger_+3A_json">json</code></td>
<td>
<p>The clientId JSON file of the project to create within</p>
</td></tr>
<tr><td><code id="cr_deploy_badger_+3A_region">region</code></td>
<td>
<p>The Cloud Run region</p>
</td></tr>
<tr><td><code id="cr_deploy_badger_+3A_dir">dir</code></td>
<td>
<p>The directory containing the README.md file</p>
</td></tr>
<tr><td><code id="cr_deploy_badger_+3A_projectid">projectId</code></td>
<td>
<p>The projectId running the badger badge for a buildtrigger</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>cr_build_logs_badger</code> is intended to be run from the root directory of
an R package that holds a README.md file containing a <code>![Cloudbuild]</code>
badge as created by <code>cr_deploy_badger()</code>.  The function will scan the
README.md file for the correct triggerId to pass to <a href="#topic+cr_buildtrigger_logs">cr_buildtrigger_logs</a>
</p>

<hr>
<h2 id='cr_deploy_docker'>Deploy a local Dockerfile to be built on ContainerRegistry</h2><span id='topic+cr_deploy_docker'></span><span id='topic+cr_deploy_docker_construct'></span>

<h3>Description</h3>

<p>Build a local Dockerfile in the cloud. See googleCloudRunner website for help how to generate Dockerfiles.  If you want the docker to build on each commit, see also <a href="#topic+cr_deploy_docker_trigger">cr_deploy_docker_trigger</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_deploy_docker(
  local,
  image_name = remote,
  dockerfile = NULL,
  remote = basename(local),
  tag = c("latest", "$BUILD_ID"),
  timeout = 600L,
  bucket = cr_bucket_get(),
  projectId = cr_project_get(),
  launch_browser = interactive(),
  kaniko_cache = TRUE,
  predefinedAcl = "bucketOwnerFullControl",
  pre_steps = NULL,
  post_steps = NULL,
  ...
)

cr_deploy_docker_construct(
  local,
  image_name = remote,
  dockerfile = NULL,
  remote = basename(local),
  tag = c("latest", "$BUILD_ID"),
  timeout = 600L,
  bucket = cr_bucket_get(),
  projectId = cr_project_get(),
  launch_browser = interactive(),
  kaniko_cache = TRUE,
  predefinedAcl = "bucketOwnerFullControl",
  pre_steps = NULL,
  post_steps = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_deploy_docker_+3A_local">local</code></td>
<td>
<p>The folder containing the Dockerfile to build</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_+3A_image_name">image_name</code></td>
<td>
<p>The name of the docker image to be built either full name starting with gcr.io or constructed from the image_name and projectId via <code>gcr.io/{projectId}/{image_name}</code></p>
</td></tr>
<tr><td><code id="cr_deploy_docker_+3A_dockerfile">dockerfile</code></td>
<td>
<p>An optional Dockerfile built to support the script.  Not needed if &quot;Dockerfile&quot; exists in folder.  If supplied will be copied into deployment folder and called &quot;Dockerfile&quot;</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_+3A_remote">remote</code></td>
<td>
<p>The folder on Google Cloud Storage</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_+3A_tag">tag</code></td>
<td>
<p>The tag or tags to be attached to the pushed image - can use <code>Build</code> macros</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_+3A_timeout">timeout</code></td>
<td>
<p>Amount of time that this build should be allowed to run, to second</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_+3A_bucket">bucket</code></td>
<td>
<p>The GCS bucket that will be used to deploy code source</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_+3A_projectid">projectId</code></td>
<td>
<p>The projectId</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_+3A_launch_browser">launch_browser</code></td>
<td>
<p>Whether to launch the logs URL in a browser once deployed</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_+3A_kaniko_cache">kaniko_cache</code></td>
<td>
<p>If TRUE will use kaniko cache for Docker builds.</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_+3A_predefinedacl">predefinedAcl</code></td>
<td>
<p>Access setting for the bucket used in deployed.  Set to &quot;bucketLevel&quot; if using bucket level access</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_+3A_pre_steps">pre_steps</code></td>
<td>
<p>Other <a href="#topic+cr_buildstep">cr_buildstep</a> to run before the docker build</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_+3A_post_steps">post_steps</code></td>
<td>
<p>Other <a href="#topic+cr_buildstep">cr_buildstep</a> to run after the docker build</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a></code>
</p>

<dl>
<dt><code>image</code></dt><dd><p>The image tag that will be pushed, starting with gcr.io or created by combining with <code>projectId</code> if not starting with gcr.io</p>
</dd>
<dt><code>location</code></dt><dd><p>Where the Dockerfile to build is in relation to <code>dir</code></p>
</dd>
<dt><code>build_args</code></dt><dd><p>additional arguments to pass to <code>docker build</code>,
should be a character vector.</p>
</dd>
<dt><code>push_image</code></dt><dd><p>if <code>kaniko_cache = FALSE</code> and
<code>push_image = FALSE</code>, then the docker image is simply built and not
pushed</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Details</h3>

<p>This lets you deploy local folders with Dockerfiles, automating saving the source on Google Cloud Storage.
</p>
<p>To deploy builds on git triggers and sources such as GitHub, see the examples of <a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a> or the use cases on the website
</p>


<h3>Note</h3>

<p>'cr_deploy_docker_construct' is a helper function to construct the arguments
needed to deploy the docker, which may be combined with
<code><a href="#topic+cr_deploy_r">cr_deploy_r</a></code> to combine Docker and R
</p>


<h3>See Also</h3>

<p>If you want the docker to build on each commit, see <a href="#topic+cr_deploy_docker_trigger">cr_deploy_docker_trigger</a>
</p>
<p>Other Deployment functions: 
<code><a href="#topic+cr_deploy_docker_trigger">cr_deploy_docker_trigger</a>()</code>,
<code><a href="#topic+cr_deploy_packagetests">cr_deploy_packagetests</a>()</code>,
<code><a href="#topic+cr_deploy_pkgdown">cr_deploy_pkgdown</a>()</code>,
<code><a href="#topic+cr_deploy_run_website">cr_deploy_run_website</a>()</code>,
<code><a href="#topic+cr_deploy_run">cr_deploy_run</a>()</code>,
<code><a href="#topic+cr_deploy_r">cr_deploy_r</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
cr_project_set("my-project")
cr_region_set("europe-west1")
cr_email_set("123456@projectid.iam.gserviceaccount.com")
cr_bucket_set("my-bucket")

b &lt;- cr_deploy_docker(system.file("example/", package = "googleCloudRunner"))

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_deploy_docker_trigger'>Deploy Docker build from a Git repo</h2><span id='topic+cr_deploy_docker_trigger'></span>

<h3>Description</h3>

<p>This helps the common use case of building a Dockerfile based on the contents of a GitHub repo, and sets up a build trigger so it will build on every commit.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_deploy_docker_trigger(
  repo,
  image,
  trigger_name = paste0("docker-", image),
  image_tag = c("latest", "$SHORT_SHA", "$BRANCH_NAME"),
  ...,
  substitutions = NULL,
  ignoredFiles = NULL,
  includedFiles = NULL,
  timeout = NULL,
  projectId_target = cr_project_get()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_deploy_docker_trigger_+3A_repo">repo</code></td>
<td>
<p>The git repo holding the Dockerfile from <a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a></p>
</td></tr>
<tr><td><code id="cr_deploy_docker_trigger_+3A_image">image</code></td>
<td>
<p>The name of the image you want to build</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_trigger_+3A_trigger_name">trigger_name</code></td>
<td>
<p>The trigger name</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_trigger_+3A_image_tag">image_tag</code></td>
<td>
<p>What to tag the build docker image</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_trigger_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+cr_buildstep_docker">cr_buildstep_docker</a></code>
</p>

<dl>
<dt><code>tag</code></dt><dd><p>The tag or tags to be attached to the pushed image - can use <code>Build</code> macros</p>
</dd>
<dt><code>location</code></dt><dd><p>Where the Dockerfile to build is in relation to <code>dir</code></p>
</dd>
<dt><code>projectId</code></dt><dd><p>The projectId</p>
</dd>
<dt><code>dockerfile</code></dt><dd><p>Specify the name of the Dockerfile found at <code>location</code></p>
</dd>
<dt><code>kaniko_cache</code></dt><dd><p>If TRUE will use kaniko cache for Docker builds.</p>
</dd>
<dt><code>build_args</code></dt><dd><p>additional arguments to pass to <code>docker build</code>,
should be a character vector.</p>
</dd>
<dt><code>push_image</code></dt><dd><p>if <code>kaniko_cache = FALSE</code> and
<code>push_image = FALSE</code>, then the docker image is simply built and not
pushed</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="cr_deploy_docker_trigger_+3A_substitutions">substitutions</code></td>
<td>
<p>A named list of Build macro variables</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_trigger_+3A_ignoredfiles">ignoredFiles</code></td>
<td>
<p>ignored_files and included_files are file glob matches extended with support for &quot;**&quot;.</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_trigger_+3A_includedfiles">includedFiles</code></td>
<td>
<p>If any of the files altered in the commit pass the ignored_files</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_trigger_+3A_timeout">timeout</code></td>
<td>
<p>Timeout for build</p>
</td></tr>
<tr><td><code id="cr_deploy_docker_trigger_+3A_projectid_target">projectId_target</code></td>
<td>
<p>The project to publish the Docker image to.  The image will be built under the project configured via <a href="#topic+cr_project_get">cr_project_get</a>.  You will need to give the build project's service email access to the target GCP project via IAM for it to push successfully.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This creates a buildtrigger to do a kamiko cache enabled Docker build upon each commit, as defined by your repo settings via <a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a>.  It will build all tags concurrently.
</p>


<h3>See Also</h3>

<p><a href="#topic+cr_deploy_docker">cr_deploy_docker</a> which lets you build Dockerfiles for more generic use cases
</p>
<p>Other Deployment functions: 
<code><a href="#topic+cr_deploy_docker">cr_deploy_docker</a>()</code>,
<code><a href="#topic+cr_deploy_packagetests">cr_deploy_packagetests</a>()</code>,
<code><a href="#topic+cr_deploy_pkgdown">cr_deploy_pkgdown</a>()</code>,
<code><a href="#topic+cr_deploy_run_website">cr_deploy_run_website</a>()</code>,
<code><a href="#topic+cr_deploy_run">cr_deploy_run</a>()</code>,
<code><a href="#topic+cr_deploy_r">cr_deploy_r</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
repo &lt;- cr_buildtrigger_repo("MarkEdmondson1234/googleCloudRunner")
# create trigger that will publish Docker image to gcr.io/your-project/test upon each GitHub commit
cr_deploy_docker_trigger(repo, "test", dir = "cloud_build")

# build in one project, publish the docker image to another project (gcr.io/another-project/test)
cr_deploy_docker_trigger(repo, "test", projectId_target = "another-project", dir = "cloud_build")

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_deploy_gadget'>Launch the googleCloudRunner deployment RStudio gadget</h2><span id='topic+cr_deploy_gadget'></span>

<h3>Description</h3>

<p>You can assign a hotkey to the addin via Tools &gt; Addins &gt; Browse Addins &gt; Keyboard shortcuts.  CTRL+SHIFT+D is a suggested hotkey.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_deploy_gadget()
</code></pre>

<hr>
<h2 id='cr_deploy_packagetests'>Deploy a cloudbuild.yml for R package tests and upload to Codecov</h2><span id='topic+cr_deploy_packagetests'></span>

<h3>Description</h3>

<p>This tests an R package each time you commit, and uploads the test coverage results to Codecov
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_deploy_packagetests(
  steps = NULL,
  cloudbuild_file = "cloudbuild-tests.yml",
  env = c("NOT_CRAN=true"),
  test_script = NULL,
  codecov_script = NULL,
  codecov_token = "$_CODECOV_TOKEN",
  build_image = "gcr.io/gcer-public/packagetools:latest",
  create_trigger = c("file", "inline", "no"),
  trigger_repo = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_deploy_packagetests_+3A_steps">steps</code></td>
<td>
<p>extra steps to run before the <a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a> steps run (such as decryption of auth files)</p>
</td></tr>
<tr><td><code id="cr_deploy_packagetests_+3A_cloudbuild_file">cloudbuild_file</code></td>
<td>
<p>The cloudbuild yaml file to write to.  See create_trigger</p>
</td></tr>
<tr><td><code id="cr_deploy_packagetests_+3A_env">env</code></td>
<td>
<p>Environment arguments to be set during the test script runs</p>
</td></tr>
<tr><td><code id="cr_deploy_packagetests_+3A_test_script">test_script</code></td>
<td>
<p>The script that will call <a href="rcmdcheck.html#topic+rcmdcheck">rcmdcheck</a> to perform tests.  If <code>NULL</code> a default script is used in <code>system.file("r_buildsteps", "devtools_tests.R", package="googlecloudRunner")</code></p>
</td></tr>
<tr><td><code id="cr_deploy_packagetests_+3A_codecov_script">codecov_script</code></td>
<td>
<p>The script that will call <a href="covr.html#topic+codecov">codecov</a> to perform coverage.  If <code>NULL</code> a default script is used in <code>system.file("r_buildsteps", "codecov_tests.R", package="googleCloudRunner")</code></p>
</td></tr>
<tr><td><code id="cr_deploy_packagetests_+3A_codecov_token">codecov_token</code></td>
<td>
<p>If using codecov, supply your codecov token here.</p>
</td></tr>
<tr><td><code id="cr_deploy_packagetests_+3A_build_image">build_image</code></td>
<td>
<p>The docker image that will be used to run the R code for the test scripts</p>
</td></tr>
<tr><td><code id="cr_deploy_packagetests_+3A_create_trigger">create_trigger</code></td>
<td>
<p>If creating a trigger, whether to create it from the cloudbuild_file or inline</p>
</td></tr>
<tr><td><code id="cr_deploy_packagetests_+3A_trigger_repo">trigger_repo</code></td>
<td>
<p>If not NULL, a <a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a> where a buildtrigger will be created via <a href="#topic+cr_buildtrigger">cr_buildtrigger</a></p>
</td></tr>
<tr><td><code id="cr_deploy_packagetests_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+cr_build_make">cr_build_make</a></code>
</p>

<dl>
<dt><code>yaml</code></dt><dd><p>A <code>Yaml</code> object created from <a href="#topic+cr_build_yaml">cr_build_yaml</a> or a file location of a .yaml/.yml cloud build file</p>
</dd>
<dt><code>artifacts</code></dt><dd><p>Artifacts that may be built via <a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a></p>
</dd>
<dt><code>options</code></dt><dd><p>Options to pass to a Cloud Build</p>
</dd>
<dt><code>availableSecrets</code></dt><dd><p>Secret Manager objects built by <a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a></p>
</dd>
<dt><code>logsBucket</code></dt><dd><p>The gs:// location of a bucket to put logs in</p>
</dd>
<dt><code>source</code></dt><dd><p>A <a href="#topic+Source">Source</a> object specifying the location of the source files to build, usually created by <a href="#topic+cr_build_source">cr_build_source</a></p>
</dd>
<dt><code>timeout</code></dt><dd><p>Amount of time that this build should be allowed to run, to second</p>
</dd>
<dt><code>images</code></dt><dd><p>A list of images to be pushed upon the successful completion of all build</p>
</dd>
<dt><code>substitutions</code></dt><dd><p>Substitutions data for 'Build' resource</p>
</dd>
<dt><code>serviceAccount</code></dt><dd><p>service account email to be used for the build</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Details</h3>

<p>The trigger repository needs to hold an R package configured to do tests upon.
</p>
<p>For GitHub, the repository will need to be linked to the project you are building within, via <a href="https://console.cloud.google.com/cloud-build/triggers/connect">https://console.cloud.google.com/cloud-build/triggers/connect</a>
</p>
<p>If your tests need authentication details, add these via <a href="#topic+cr_buildstep_secret">cr_buildstep_secret</a> to the <code>steps</code> argument, which will prepend decrypting the authentication file before running the tests.
</p>
<p>If you want codecov to ignore some files then also deploy a .covrignore file to your repository - see covr website at <a href="https://covr.r-lib.org/">https://covr.r-lib.org/</a> for details.
</p>


<h3>See Also</h3>

<p>Create your own custom deployment using <a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a> which this function uses with some defaults
</p>
<p><a href="#topic+cr_buildstep_packagetests">cr_buildstep_packagetests</a>
</p>
<p>Other Deployment functions: 
<code><a href="#topic+cr_deploy_docker_trigger">cr_deploy_docker_trigger</a>()</code>,
<code><a href="#topic+cr_deploy_docker">cr_deploy_docker</a>()</code>,
<code><a href="#topic+cr_deploy_pkgdown">cr_deploy_pkgdown</a>()</code>,
<code><a href="#topic+cr_deploy_run_website">cr_deploy_run_website</a>()</code>,
<code><a href="#topic+cr_deploy_run">cr_deploy_run</a>()</code>,
<code><a href="#topic+cr_deploy_r">cr_deploy_r</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# create a local cloudbuild.yml file for packagetests
pd &lt;- cr_deploy_packagetests(create_trigger = "no")
pd

# add a decryption step for an auth file
cr_deploy_packagetests(
  steps = cr_buildstep_secret("my_secret", "auth.json"),
  env = c("NOT_CRAN=true", "MY_AUTH_FILE=auth.json"),
  timeout = 1200,
  create_trigger = "no"
)


# creating a buildtrigger repo for trigger_repo
repo &lt;- cr_buildtrigger_repo("MarkEdmondson1234/googleCloudRunner",
  branch = "master"
)
## Not run: 

# will create the file in the repo, and point a buildtrigger at it
cr_deploy_packagetests(create_trigger = "file", trigger_repo = repo)


# will make an inline build within a buildtrigger
cr_deploy_packagetests(create_trigger = "inline", trigger_repo = repo)

## End(Not run)

unlink("cloudbuild-tests.yml")
</code></pre>

<hr>
<h2 id='cr_deploy_pkgdown'>Deploy a cloudbuild.yml for a pkgdown website of an R package</h2><span id='topic+cr_deploy_pkgdown'></span>

<h3>Description</h3>

<p>This builds a pkgdown website each time the trigger fires and deploys it to git
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_deploy_pkgdown(
  github_repo,
  secret,
  steps = NULL,
  create_trigger = c("file", "inline", "no"),
  cloudbuild_file = "cloudbuild-pkgdown.yml",
  git_email = "googlecloudrunner@r.com",
  env = NULL,
  build_image = "gcr.io/gcer-public/packagetools:latest",
  post_setup = NULL,
  post_clone = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_deploy_pkgdown_+3A_github_repo">github_repo</code></td>
<td>
<p>The GitHub repo to deploy pkgdown website from and to.</p>
</td></tr>
<tr><td><code id="cr_deploy_pkgdown_+3A_secret">secret</code></td>
<td>
<p>The name of the secret on Google Secret Manager for the git ssh private key</p>
</td></tr>
<tr><td><code id="cr_deploy_pkgdown_+3A_steps">steps</code></td>
<td>
<p>extra steps to run before the pkgdown website steps run</p>
</td></tr>
<tr><td><code id="cr_deploy_pkgdown_+3A_create_trigger">create_trigger</code></td>
<td>
<p>If not &quot;no&quot; then the buildtrigger will be setup for you via <a href="#topic+cr_buildtrigger">cr_buildtrigger</a>, if &quot;file&quot; will create a buildtrigger pointing at <code>cloudbuild_file</code>, if &quot;inline&quot; will put the build inline within the trigger (no file created)</p>
</td></tr>
<tr><td><code id="cr_deploy_pkgdown_+3A_cloudbuild_file">cloudbuild_file</code></td>
<td>
<p>The cloudbuild yaml file to write to</p>
</td></tr>
<tr><td><code id="cr_deploy_pkgdown_+3A_git_email">git_email</code></td>
<td>
<p>The email the git commands will be identifying as</p>
</td></tr>
<tr><td><code id="cr_deploy_pkgdown_+3A_env">env</code></td>
<td>
<p>A character vector of env arguments to set for all steps</p>
</td></tr>
<tr><td><code id="cr_deploy_pkgdown_+3A_build_image">build_image</code></td>
<td>
<p>A docker image with <code>pkgdown</code> installed</p>
</td></tr>
<tr><td><code id="cr_deploy_pkgdown_+3A_post_setup">post_setup</code></td>
<td>
<p>Steps that occur after git setup</p>
</td></tr>
<tr><td><code id="cr_deploy_pkgdown_+3A_post_clone">post_clone</code></td>
<td>
<p>A <a href="#topic+cr_buildstep">cr_buildstep</a> that occurs after the repo is cloned</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The trigger repository needs to hold an R package configured to build a pkgdown website.
</p>
<p>For GitHub, the repository will also need to be linked to the project you are building within, via <a href="https://console.cloud.google.com/cloud-build/triggers/connect">https://console.cloud.google.com/cloud-build/triggers/connect</a>
</p>
<p>The git ssh keys need to be deployed to Google Secret Manager for the deployment of the website - see <a href="#topic+cr_buildstep_git">cr_buildstep_git</a> - this only needs to be done once per Git account.
</p>


<h3>See Also</h3>

<p>Create your own custom deployment using <a href="#topic+cr_buildstep_pkgdown">cr_buildstep_pkgdown</a> which this function uses with some defaults.
</p>
<p>Other Deployment functions: 
<code><a href="#topic+cr_deploy_docker_trigger">cr_deploy_docker_trigger</a>()</code>,
<code><a href="#topic+cr_deploy_docker">cr_deploy_docker</a>()</code>,
<code><a href="#topic+cr_deploy_packagetests">cr_deploy_packagetests</a>()</code>,
<code><a href="#topic+cr_deploy_run_website">cr_deploy_run_website</a>()</code>,
<code><a href="#topic+cr_deploy_run">cr_deploy_run</a>()</code>,
<code><a href="#topic+cr_deploy_r">cr_deploy_r</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
pd &lt;- cr_deploy_pkgdown("MarkEdmondson1234/googleCloudRunner",
  secret = "my_git_secret",
  create_trigger = "no"
)
pd
file.exists("cloudbuild-pkgdown.yml")
unlink("cloudbuild-pkgdown.yml")
## Not run: 
cr_deploy_pkgdown("MarkEdmondson1234/googleCloudRunner",
  secret = "my_git_secret",
  create_trigger = "inline"
)

## End(Not run)

</code></pre>

<hr>
<h2 id='cr_deploy_r'>Deploy an R script with an optional schedule</h2><span id='topic+cr_deploy_r'></span>

<h3>Description</h3>

<p>Will create a build to run an R script in Cloud Build with an optional schedule from Cloud Scheduler
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_deploy_r(
  r,
  schedule = NULL,
  source = NULL,
  run_name = NULL,
  r_image = "rocker/verse",
  pre_steps = NULL,
  post_steps = NULL,
  timeout = 600L,
  ...,
  schedule_type = c("pubsub", "http"),
  schedule_pubsub = NULL,
  email = cr_email_get(),
  region = cr_region_get(),
  projectId = cr_project_get(),
  serviceAccount = NULL,
  launch_browser = interactive()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_deploy_r_+3A_r">r</code></td>
<td>
<p>R code to run or a file containing R code ending with .R, or the gs:// location on Cloud Storage of the R file you want to run</p>
</td></tr>
<tr><td><code id="cr_deploy_r_+3A_schedule">schedule</code></td>
<td>
<p>A cron schedule e.g. <code>"15 5 * * *"</code></p>
</td></tr>
<tr><td><code id="cr_deploy_r_+3A_source">source</code></td>
<td>
<p>A <a href="#topic+Source">Source</a> object specifying the location of the source files to build, usually created by <a href="#topic+cr_build_source">cr_build_source</a></p>
</td></tr>
<tr><td><code id="cr_deploy_r_+3A_run_name">run_name</code></td>
<td>
<p>What name the R code will identify itself as.  If <code>NULL</code> one is autogenerated.</p>
</td></tr>
<tr><td><code id="cr_deploy_r_+3A_r_image">r_image</code></td>
<td>
<p>The R docker environment executing the R code</p>
</td></tr>
<tr><td><code id="cr_deploy_r_+3A_pre_steps">pre_steps</code></td>
<td>
<p>Other <a href="#topic+cr_buildstep">cr_buildstep</a> to run before the R code executes</p>
</td></tr>
<tr><td><code id="cr_deploy_r_+3A_post_steps">post_steps</code></td>
<td>
<p>Other <a href="#topic+cr_buildstep">cr_buildstep</a> to run after the R code executes</p>
</td></tr>
<tr><td><code id="cr_deploy_r_+3A_timeout">timeout</code></td>
<td>
<p>Amount of time that this build should be allowed to run, to second</p>
</td></tr>
<tr><td><code id="cr_deploy_r_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+cr_buildstep_r">cr_buildstep_r</a></code>
</p>

<dl>
<dt><code>name</code></dt><dd><p>The docker image that will run the R code, usually from rocker-project.org</p>
</dd>
<dt><code>r_source</code></dt><dd><p>Whether the R code will be from a runtime file within the source or at build time copying over from a local R file in your session</p>
</dd>
<dt><code>escape_dollar</code></dt><dd><p>Default TRUE.  This will turn <code>$</code> into <code>$$</code> within the script to avoid them being recognised as Cloud Build variables.  Turn this off if you want that behaviour (e.g. <code>my_project="$PROJECT_ID"</code>)</p>
</dd>
<dt><code>rscript_args</code></dt><dd><p>Optional arguments for the R script run by <code>Rscript</code>.</p>
</dd>
<dt><code>r_cmd</code></dt><dd><p>should 'Rscript' be run or 'R'?</p>
</dd>
<dt><code>prefix</code></dt><dd><p>prefixed to name - set to &quot;&quot; to suppress.  Will be suppressed if <code>name</code> starts with gcr.io or <code>*-docker.pkg.dev</code></p>
</dd>
</dl>
</td></tr>
<tr><td><code id="cr_deploy_r_+3A_schedule_type">schedule_type</code></td>
<td>
<p>If you have specified a schedule, this will select what strategy it will use to deploy it. See details</p>
</td></tr>
<tr><td><code id="cr_deploy_r_+3A_schedule_pubsub">schedule_pubsub</code></td>
<td>
<p>If you have a custom pubsub message to send via an existing topic, use <a href="#topic+cr_schedule_pubsub">cr_schedule_pubsub</a> to supply it here</p>
</td></tr>
<tr><td><code id="cr_deploy_r_+3A_email">email</code></td>
<td>
<p>The email that will authenticate the job set via <a href="#topic+cr_email_set">cr_email_set</a></p>
</td></tr>
<tr><td><code id="cr_deploy_r_+3A_region">region</code></td>
<td>
<p>The region usually set with <a href="#topic+cr_region_set">cr_region_set</a></p>
</td></tr>
<tr><td><code id="cr_deploy_r_+3A_projectid">projectId</code></td>
<td>
<p>ID of the project</p>
</td></tr>
<tr><td><code id="cr_deploy_r_+3A_serviceaccount">serviceAccount</code></td>
<td>
<p>service account email to be used for the build</p>
</td></tr>
<tr><td><code id="cr_deploy_r_+3A_launch_browser">launch_browser</code></td>
<td>
<p>Whether to launch the logs URL in a browser once deployed</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The R script will execute within the root directory of whichever <a href="#topic+Source">Source</a> you supply, usually created via <a href="#topic+cr_build_source">cr_build_source</a> representing a Cloud Storage bucket or a GitHub repository that is copied across before code execution.  Bear in mind if the source changes then the code scheduled may need updating.
</p>
<p>The <code>r_image</code> dictates what R libraries the R environment executing the code of <code>r</code> will have, via the underlying Docker container usually supplied by rocker-project.org.  If you want custom R libraries beyond the default, create a docker container with those R libraries installed (perhaps via <a href="#topic+cr_deploy_docker">cr_deploy_docker</a>)
</p>


<h3>Value</h3>

<p>If scheduling then a <a href="#topic+Job">Job</a>, if building immediately then a <a href="#topic+Build">Build</a>
</p>


<h3>Scheduling</h3>

<p>If <code>schedule=NULL</code> then the R script will be run immediately on Cloud Build via <a href="#topic+cr_build">cr_build</a>.
</p>
<p>If <code>schedule</code> carries a cron job string (e.g. <code>"15 5 * * *"</code>) then the build will be scheduled via Cloud Scheduler
</p>
<p>If <code>schedule_type="pubsub"</code> then you will need <code>googlePubsubR</code> installed and set-up and scheduling will involve:
</p>

<ol>
<li><p> Creating a PubSub topic called <code>"{run_name}-topic"</code> or subscribing to the one you provided in <code>schedule_pubsub</code>.  It is assumed you have created the PubSub topic beforehand if you do supply your own.
</p>
</li>
<li><p> Create a Build Trigger called <code>"{run_name}-trigger"</code> that will run when the PubSub topic is called
</p>
</li>
<li><p> Create a Cloud Schedule called <code>"{run_name}-trigger"</code> that will send a pubsub message to the topic: either the default that contains just the name of the script, or the message you supplied in <code>schedule_pubsub</code>.
</p>
</li></ol>

<p>Type &quot;pubsub&quot; is recommended for more complex R scripts as you will have more visibility for debugging schedules via inspecting the PubSub topic, build trigger and build logs, as well as enabling triggering the script from other PubSub topics and allowing to pass dynamic parameters into your schedule scripts via the PubSub message.
</p>
<p>If <code>schedule_type="http"</code> then scheduling will involve:
</p>

<ol>
<li><p> Create a Cloud Build API call with your build embedded within it via <a href="#topic+cr_schedule_http">cr_schedule_http</a>
</p>
</li>
<li><p> Schedule the HTTP call using the authentication email supplied in <code>email</code> or the default <a href="#topic+cr_email_get">cr_email_get</a>
</p>
</li></ol>

<p>This is the old default and is suitable for smaller R scripts or when you don't want to use the other  GCP services.  The authentication for the API call from Cloud Scheduler can cause opaque errors as it will give you invalid response codes whether its that or an error in your R script you wish to schedule.
</p>


<h3>See Also</h3>

<p>If you want to run R code upon certain events like GitHub pushes, look at <a href="#topic+cr_buildtrigger">cr_buildtrigger</a>
</p>
<p>Other Deployment functions: 
<code><a href="#topic+cr_deploy_docker_trigger">cr_deploy_docker_trigger</a>()</code>,
<code><a href="#topic+cr_deploy_docker">cr_deploy_docker</a>()</code>,
<code><a href="#topic+cr_deploy_packagetests">cr_deploy_packagetests</a>()</code>,
<code><a href="#topic+cr_deploy_pkgdown">cr_deploy_pkgdown</a>()</code>,
<code><a href="#topic+cr_deploy_run_website">cr_deploy_run_website</a>()</code>,
<code><a href="#topic+cr_deploy_run">cr_deploy_run</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
r_lines &lt;- c(
  "list.files()",
  "library(dplyr)",
  "mtcars %&gt;% select(mpg)",
  "sessionInfo()"
)
source &lt;- cr_build_source(RepoSource("googleCloudStorageR",
  branchName = "master"
))
## Not run: 
cr_project_set("my-project")
cr_region_set("europe-west1")
cr_email_set("123456@projectid.iam.gserviceaccount.com")

# check the script runs ok
cr_deploy_r(r_lines, source = source)

# schedule the script
cr_deploy_r(r_lines, schedule = "15 21 * * *", source = source)

## End(Not run)

</code></pre>

<hr>
<h2 id='cr_deploy_run'>Deploy to Cloud Run</h2><span id='topic+cr_deploy_run'></span><span id='topic+cr_deploy_html'></span><span id='topic+cr_deploy_plumber'></span>

<h3>Description</h3>

<p>Deploy R api plumber scripts, HTML files or other images create the Docker image, add the build to Cloud Build and deploy to Cloud Run
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_deploy_run(
  local,
  remote = basename(local),
  dockerfile = NULL,
  image_name = remote,
  tag = "$BUILD_ID",
  region = cr_region_get(),
  bucket = cr_bucket_get(),
  projectId = cr_project_get(),
  launch_browser = interactive(),
  timeout = 600L,
  kaniko_cache = TRUE,
  pre_steps = NULL,
  post_steps = NULL,
  ...
)

cr_deploy_html(
  html_folder,
  remote = basename(html_folder),
  image_name = remote,
  tag = "$BUILD_ID",
  region = cr_region_get(),
  bucket = cr_bucket_get(),
  projectId = cr_project_get(),
  launch_browser = interactive(),
  timeout = 600L,
  ...
)

cr_deploy_plumber(
  api,
  remote = basename(api),
  dockerfile = NULL,
  image_name = remote,
  tag = "$BUILD_ID",
  region = cr_region_get(),
  bucket = cr_bucket_get(),
  projectId = cr_project_get(),
  launch_browser = interactive(),
  timeout = 600L,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_deploy_run_+3A_local">local</code></td>
<td>
<p>A folder containing the scripts and Dockerfile to deploy to Cloud Run</p>
</td></tr>
<tr><td><code id="cr_deploy_run_+3A_remote">remote</code></td>
<td>
<p>The folder on Google Cloud Storage, and the name of the service on Cloud Run</p>
</td></tr>
<tr><td><code id="cr_deploy_run_+3A_dockerfile">dockerfile</code></td>
<td>
<p>An optional Dockerfile built to support the script.  Not needed if 'Dockerfile' exists in folder.  If supplied will be copied into deployment folder and called &quot;Dockerfile&quot;</p>
</td></tr>
<tr><td><code id="cr_deploy_run_+3A_image_name">image_name</code></td>
<td>
<p>The gcr.io image name that will be deployed and/or built</p>
</td></tr>
<tr><td><code id="cr_deploy_run_+3A_tag">tag</code></td>
<td>
<p>The tag or tags to be attached to the pushed image - can use <code>Build</code> macros</p>
</td></tr>
<tr><td><code id="cr_deploy_run_+3A_region">region</code></td>
<td>
<p>The Cloud Run endpoint set by CR_REGION env arg</p>
</td></tr>
<tr><td><code id="cr_deploy_run_+3A_bucket">bucket</code></td>
<td>
<p>The Cloud Storage bucket that will hold the code</p>
</td></tr>
<tr><td><code id="cr_deploy_run_+3A_projectid">projectId</code></td>
<td>
<p>The projectId where it all gets deployed to</p>
</td></tr>
<tr><td><code id="cr_deploy_run_+3A_launch_browser">launch_browser</code></td>
<td>
<p>Whether to launch the logs URL in a browser once deployed</p>
</td></tr>
<tr><td><code id="cr_deploy_run_+3A_timeout">timeout</code></td>
<td>
<p>Amount of time that this build should be allowed to run, to second</p>
</td></tr>
<tr><td><code id="cr_deploy_run_+3A_kaniko_cache">kaniko_cache</code></td>
<td>
<p>If TRUE will use kaniko cache for Docker builds.</p>
</td></tr>
<tr><td><code id="cr_deploy_run_+3A_pre_steps">pre_steps</code></td>
<td>
<p>Other <a href="#topic+cr_buildstep">cr_buildstep</a> to run before the docker build</p>
</td></tr>
<tr><td><code id="cr_deploy_run_+3A_post_steps">post_steps</code></td>
<td>
<p>Other <a href="#topic+cr_buildstep">cr_buildstep</a> to run after the docker build</p>
</td></tr>
<tr><td><code id="cr_deploy_run_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a></code>
</p>

<dl>
<dt><code>name</code></dt><dd><p>Name for deployment on Cloud Run</p>
</dd>
<dt><code>image</code></dt><dd><p>The name of the image to create or use in deployment - <code>gcr.io</code></p>
</dd>
<dt><code>allowUnauthenticated</code></dt><dd><p>TRUE if can be reached from public HTTP address. If FALSE will configure a service-email called <code>(name)-cloudrun-invoker@(project-id).iam.gserviceaccount.com</code></p>
</dd>
<dt><code>concurrency</code></dt><dd><p>How many connections each container instance can serve. Can be up to 80.</p>
</dd>
<dt><code>port</code></dt><dd><p>Container port to receive requests at. Also sets the $PORT environment variable. Must be a number between 1 and 65535, inclusive. To unset this field, pass the special value &quot;default&quot;.</p>
</dd>
<dt><code>max_instances</code></dt><dd><p>the desired maximum nuimber of container instances. &quot;default&quot; is 1000, you can get more if you requested a quota instance.  For Shiny instances on Cloud Run, this needs to be 1.</p>
</dd>
<dt><code>memory</code></dt><dd><p>The format for size is a fixed or floating point number followed by a unit: G, M, or K corresponding to gigabyte, megabyte, or kilobyte, respectively, or use the power-of-two equivalents: Gi, Mi, Ki corresponding to gibibyte, mebibyte or kibibyte respectively. The default is 256Mi</p>
</dd>
<dt><code>cpu</code></dt><dd><p>1 or 2 CPUs for your instance</p>
</dd>
<dt><code>env_vars</code></dt><dd><p>Environment arguments passed to the Cloud Run container at runtime.  Distinct from <code>env</code> that run at build time.</p>
</dd>
<dt><code>gcloud_args</code></dt><dd><p>a character string of arguments that can be sent to the gcloud command not covered by other parameters of this function</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="cr_deploy_run_+3A_html_folder">html_folder</code></td>
<td>
<p>the folder containing all the html</p>
</td></tr>
<tr><td><code id="cr_deploy_run_+3A_api">api</code></td>
<td>
<p>A folder containing the R script using plumber called api.R and all its dependencies</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These deploy containers to Cloud Run, a scale 0-to-millions container-as-a-service on Google Cloud Platform.
</p>


<h3>cr_deploy_html</h3>

<p>Deploy html files to a nginx server on Cloud Run.
</p>
<p>Supply the html folder to host it on Cloud Run.  Builds the dockerfile with the html within it, then deploys to Cloud Run
</p>
<p>Will add a <code>default.template</code> file to the html folder that holds the nginx configuration
</p>


<h3>cr_deploy_plumber</h3>

<p>The entrypoint for CloudRun will be via a plumber script called api.R - this should be included in your local folder to deploy.
From that api.R you can source or call other resources in the same folder, using relative paths.
</p>
<p>The function will create a local folder called &quot;deploy&quot; and a tar.gz of that folder which is what is being uploaded to Google Cloud Storage
</p>


<h3>See Also</h3>

<p>For scheduling Cloud Run apps <a href="#topic+cr_run_schedule_http">cr_run_schedule_http</a>
</p>
<p><a href="#topic+cr_deploy_run_website">cr_deploy_run_website</a> which has more features like rending Rmd files and deploying upon each git commit
</p>
<p>Other Deployment functions: 
<code><a href="#topic+cr_deploy_docker_trigger">cr_deploy_docker_trigger</a>()</code>,
<code><a href="#topic+cr_deploy_docker">cr_deploy_docker</a>()</code>,
<code><a href="#topic+cr_deploy_packagetests">cr_deploy_packagetests</a>()</code>,
<code><a href="#topic+cr_deploy_pkgdown">cr_deploy_pkgdown</a>()</code>,
<code><a href="#topic+cr_deploy_run_website">cr_deploy_run_website</a>()</code>,
<code><a href="#topic+cr_deploy_r">cr_deploy_r</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
cr_project_set("my-project")
cr_region_set("europe-west1")
cr_bucket_set("my-bucket")
cr_deploy_run(system.file("example/", package = "googleCloudRunner"))

## End(Not run)
## Not run: 
cr_project_set("my-project")
cr_region_set("europe-west1")
cr_bucket_set("my-bucket")

cr_deploy_html("my_folder")

## End(Not run)
## Not run: 
cr_project_set("my-project")
cr_region_set("europe-west1")
cr_bucket_set("my-bucket")

cr_deploy_plumber(system.file("example/", package = "googleCloudRunner"))

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_deploy_run_website'>Deploy HTML built from a repo each commit</h2><span id='topic+cr_deploy_run_website'></span>

<h3>Description</h3>

<p>This lets you set up triggers that will update an R generated website each commit.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_deploy_run_website(
  repo,
  image = paste0("website-", format(Sys.Date(), "%Y%m%d")),
  rmd_folder = NULL,
  html_folder = NULL,
  image_tag = "$SHORT_SHA",
  timeout = 600L,
  edit_r = NULL,
  r_image = "gcr.io/gcer-public/packagetools:latest",
  allowUnauthenticated = TRUE,
  region = cr_region_get(),
  projectId = cr_project_get()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_deploy_run_website_+3A_repo">repo</code></td>
<td>
<p>A git repository defined in <a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a></p>
</td></tr>
<tr><td><code id="cr_deploy_run_website_+3A_image">image</code></td>
<td>
<p>The name of the image you want to build</p>
</td></tr>
<tr><td><code id="cr_deploy_run_website_+3A_rmd_folder">rmd_folder</code></td>
<td>
<p>A folder of Rmd files within GitHub source that will be built into HTML for serving via <a href="rmarkdown.html#topic+render">render</a></p>
</td></tr>
<tr><td><code id="cr_deploy_run_website_+3A_html_folder">html_folder</code></td>
<td>
<p>A folder of html to deploy within GitHub source.  Will be ignored if rmd_folder is not NULL</p>
</td></tr>
<tr><td><code id="cr_deploy_run_website_+3A_image_tag">image_tag</code></td>
<td>
<p>What to tag the build docker image</p>
</td></tr>
<tr><td><code id="cr_deploy_run_website_+3A_timeout">timeout</code></td>
<td>
<p>Timeout for the build</p>
</td></tr>
<tr><td><code id="cr_deploy_run_website_+3A_edit_r">edit_r</code></td>
<td>
<p>If you want to change the R code to render the HTML, supply R code via a file or string of R as per <a href="#topic+cr_buildstep_r">cr_buildstep_r</a></p>
</td></tr>
<tr><td><code id="cr_deploy_run_website_+3A_r_image">r_image</code></td>
<td>
<p>The image that will run the R code from <code>edit_r</code></p>
</td></tr>
<tr><td><code id="cr_deploy_run_website_+3A_allowunauthenticated">allowUnauthenticated</code></td>
<td>
<p>TRUE if can be reached from public HTTP address. If FALSE will configure a service-email called <code>(name)-cloudrun-invoker@(project-id).iam.gserviceaccount.com</code></p>
</td></tr>
<tr><td><code id="cr_deploy_run_website_+3A_region">region</code></td>
<td>
<p>The region for cloud run</p>
</td></tr>
<tr><td><code id="cr_deploy_run_website_+3A_projectid">projectId</code></td>
<td>
<p>The GCP projectId which will be deployed within</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This lets you render the Rmd (or other R functions that produce HTML) in a folder for your repo, which will then be hosted on a Cloud Run enabled with nginx.  Each time you push to git with modified Rmd code, it will build the new HTML and push an update to the website.
</p>
<p>This default R code is rendered in the rmd_folder:
</p>
<p><code>lapply(list.files('.', pattern = '.Rmd', full.names = TRUE),
      rmarkdown::render, output_format = 'html_document')</code>
</p>


<h3>See Also</h3>

<p><a href="#topic+cr_deploy_html">cr_deploy_html</a> that lets you deploy just HTML files and <a href="#topic+cr_deploy_pkgdown">cr_deploy_pkgdown</a> for running pkgdown websites.
</p>
<p>Other Deployment functions: 
<code><a href="#topic+cr_deploy_docker_trigger">cr_deploy_docker_trigger</a>()</code>,
<code><a href="#topic+cr_deploy_docker">cr_deploy_docker</a>()</code>,
<code><a href="#topic+cr_deploy_packagetests">cr_deploy_packagetests</a>()</code>,
<code><a href="#topic+cr_deploy_pkgdown">cr_deploy_pkgdown</a>()</code>,
<code><a href="#topic+cr_deploy_run">cr_deploy_run</a>()</code>,
<code><a href="#topic+cr_deploy_r">cr_deploy_r</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
cr_project_set("my-project")
cr_region_set("europe-west1")
your_repo &lt;- cr_buildtrigger_repo("MarkEdmondson1234/googleCloudRunner")
cr_deploy_run_website(your_repo, rmd_folder = "vignettes")

# change the Rmd rendering to pkgdown
r &lt;- "devtools::install();pkgdown::build_site()"

cr_deploy_run_website(your_repo,
  image = paste0(your_repo, "-pkgdown"),
  rmd_folder = ".",
  edit_r = r
)

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_email_get'>Get/Set cloud build email</h2><span id='topic+cr_email_get'></span><span id='topic+cr_email_set'></span>

<h3>Description</h3>

<p>Needed so Cloud Scheduler can run Cloud Build jobs - can also set via environment argument CR_BUILD_EMAIL
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_email_get()

cr_email_set(cloudbuildEmail)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_email_get_+3A_cloudbuildemail">cloudbuildEmail</code></td>
<td>
<p>The Cloud Build service email</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>https://console.cloud.google.com/cloud-build/settings
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cr_email_set("myemail@domain.com")
cr_email_get()
</code></pre>

<hr>
<h2 id='cr_jwt_create'>Create a JSON Web Token (JWT) from your service client and call Google services</h2><span id='topic+cr_jwt_create'></span><span id='topic+cr_jwt_token'></span><span id='topic+cr_jwt_with_httr'></span><span id='topic+cr_jwt_with_curl'></span><span id='topic+cr_jwt_async'></span>

<h3>Description</h3>

<p>This can be used to call authenticated services such as Cloud Run.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_jwt_create(the_url, service_json = Sys.getenv("GCE_AUTH_FILE"))

cr_jwt_token(signed_jwt, the_url)

cr_jwt_with_httr(req, token)

cr_jwt_with_curl(h = curl::new_handle(), token)

cr_jwt_async(urls, token, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_jwt_create_+3A_the_url">the_url</code></td>
<td>
<p>The URL of the service you want to call</p>
</td></tr>
<tr><td><code id="cr_jwt_create_+3A_service_json">service_json</code></td>
<td>
<p>The account service key JSON that will be used to generate the JWT</p>
</td></tr>
<tr><td><code id="cr_jwt_create_+3A_signed_jwt">signed_jwt</code></td>
<td>
<p>A JWT created from <a href="#topic+cr_jwt_create">cr_jwt_create</a></p>
</td></tr>
<tr><td><code id="cr_jwt_create_+3A_req">req</code></td>
<td>
<p>A <code>httr</code> request to the service running on <code>the_url</code>, using httr verbs such as <a href="httr.html#topic+GET">GET</a></p>
</td></tr>
<tr><td><code id="cr_jwt_create_+3A_token">token</code></td>
<td>
<p>The token created via <a href="#topic+cr_jwt_token">cr_jwt_token</a></p>
</td></tr>
<tr><td><code id="cr_jwt_create_+3A_h">h</code></td>
<td>
<p>A curl handle such as set with <a href="curl.html#topic+new_handle">new_handle</a></p>
</td></tr>
<tr><td><code id="cr_jwt_create_+3A_urls">urls</code></td>
<td>
<p>URLs to request asynchronously</p>
</td></tr>
<tr><td><code id="cr_jwt_create_+3A_...">...</code></td>
<td>
<p>Other arguments passed to <a href="curl.html#topic+new_handle">new_handle</a></p>
</td></tr>
</table>


<h3>Details</h3>

<p>For certain Google services a JWT is needed to authenticate access, which is distinct from OAuth2.  An example of this is authenticated Cloud Run such as deployed when using <a href="#topic+cr_run">cr_run</a> and parameter <code>allowUnauthenticated = FALSE</code>.  These functions help you call your services by generating the JWT from your service account key.
</p>
<p>The token is set to expire in 1 hour, so it will need refreshing before then by calling this function again.
</p>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/run/docs/authenticating/service-to-service">Service-to-service authentication on GCP</a>
</p>
<p>Other Cloud Run functions: 
<code><a href="#topic+cr_plumber_pubsub">cr_plumber_pubsub</a>()</code>,
<code><a href="#topic+cr_run_email">cr_run_email</a>()</code>,
<code><a href="#topic+cr_run_get">cr_run_get</a>()</code>,
<code><a href="#topic+cr_run_list">cr_run_list</a>()</code>,
<code><a href="#topic+cr_run_schedule_http">cr_run_schedule_http</a>()</code>,
<code><a href="#topic+cr_run">cr_run</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# The private authenticated access only Cloud Run service
the_url &lt;- "https://authenticated-cloudrun-ewjogewawq-ew.a.run.app/"

# creating the JWT and token
jwt &lt;- cr_jwt_create(the_url)
token &lt;- cr_jwt_token(jwt, the_url)

# call Cloud Run app using token with any httr verb
library(httr)
res &lt;- cr_jwt_with_httr(
  GET("https://authenticated-cloudrun-ewjogewawq-ew.a.run.app/hello"),
  token
)
content(res)

# call Cloud Run app with curl - you can pass in a curl handle
library(curl)
h &lt;- new_handle()
handle_setopt(h, customrequest = "PUT")
handle_setform(h, a = "1", b = "2")
h &lt;- cr_jwt_with_curl(h, token = token)
r &lt;- curl_fetch_memory("https://authenticated-cloudrun-ewjogewawq-ew.a.run.app/hello", h)
cat(rawToChar(r$content))

# use curls multi-asynch functions
many_urls &lt;- paste0(
  "https://authenticated-cloudrun-ewjogewawq-ew.a.run.app/hello",
  paste0("?param="), 1:6
)
cr_jwt_async(many_urls, token = token)

## End(Not run)

</code></pre>

<hr>
<h2 id='cr_plumber_pubsub'>Plumber - Pub/Sub parser</h2><span id='topic+cr_plumber_pubsub'></span>

<h3>Description</h3>

<p>A function to use in plumber scripts to accept Pub/Sub messages
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_plumber_pubsub(message = NULL, pass_f = function(x) x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_plumber_pubsub_+3A_message">message</code></td>
<td>
<p>The pubsub message</p>
</td></tr>
<tr><td><code id="cr_plumber_pubsub_+3A_pass_f">pass_f</code></td>
<td>
<p>An R function that will work with the data parsed out of the pubsub <code>message$data</code> field.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is intended to be used within <a href="plumber.html#topic+plumb">plumb</a> API scripts.  It needs to be annotated with a <code>@post</code> URL route and a <code>@param message The pubsub message</code> as per the plumber documentation.
</p>
<p><code>pass_f</code> should be a function you create that accepts one argument, the data from the pubsub <code>message$data</code> field.  It is unencoded for you.  Make sure the function returns a 200 response otherwise pub/sub will keep resending the message!  <code>return(TRUE)</code> is adequate.
</p>
<p>The Docker container for the API will need to include <code>googleCloudRunner</code> installed in its R environment to run this function.  This is available in the public <code>gcr.io/gcer-public/cloudrunner</code> image.
</p>
<p>Use <a href="#topic+cr_pubsub">cr_pubsub</a> to test this function once deployed.
</p>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/run/docs/tutorials/pubsub">Google Pub/Sub tutorial for Cloud Run</a>.  You can set up Pub/Sub messages from Google Cloud Storage buckets via <a href="googleCloudStorageR.html#topic+gcs_create_pubsub">gcs_create_pubsub</a>
</p>
<p>Other Cloud Run functions: 
<code><a href="#topic+cr_jwt_create">cr_jwt_create</a>()</code>,
<code><a href="#topic+cr_run_email">cr_run_email</a>()</code>,
<code><a href="#topic+cr_run_get">cr_run_get</a>()</code>,
<code><a href="#topic+cr_run_list">cr_run_list</a>()</code>,
<code><a href="#topic+cr_run_schedule_http">cr_run_schedule_http</a>()</code>,
<code><a href="#topic+cr_run">cr_run</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# within a plumber api.R script:

# example function echos back pubsub message
pub &lt;- function(x) {
  paste("Echo:", x)
}

#' Recieve pub/sub message
#' @post /pubsub #nolint
#' @param message a pub/sub message
function(message = NULL) {
  googleCloudRunner::cr_plumber_pubsub(message, pub)
}

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_project_set'>Get/Set the projectId for your CloudRun services</h2><span id='topic+cr_project_set'></span><span id='topic+cr_project_get'></span>

<h3>Description</h3>

<p>Can also use environment argument GCE_DEFAULT_PROJECT_ID
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_project_set(projectId)

cr_project_get()
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_project_set_+3A_projectid">projectId</code></td>
<td>
<p>The projectId</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
cr_project_get()
</code></pre>

<hr>
<h2 id='cr_pubsub'>Send a message to pubsub</h2><span id='topic+cr_pubsub'></span>

<h3>Description</h3>

<p>Useful for testing Cloud Run pubsub deployments
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_pubsub(endpoint, payload = jsonlite::toJSON("hello"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_pubsub_+3A_endpoint">endpoint</code></td>
<td>
<p>The url endpoint of the PubSub service</p>
</td></tr>
<tr><td><code id="cr_pubsub_+3A_payload">payload</code></td>
<td>
<p>Will be base64 encoded and placed in <code>message$data</code></p>
</td></tr>
</table>

<hr>
<h2 id='cr_region_set'>Get/Set the endpoint for your CloudRun services</h2><span id='topic+cr_region_set'></span><span id='topic+cr_region_get'></span>

<h3>Description</h3>

<p>Can also use environment argument CR_REGION
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_region_set(region = googleCloudRunner::cr_regions)

cr_region_get()
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_region_set_+3A_region">region</code></td>
<td>
<p>Region for the endpoint</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
cr_region_get()
</code></pre>

<hr>
<h2 id='cr_regions'>Cloud Run Regions</h2><span id='topic+cr_regions'></span>

<h3>Description</h3>

<p>Cloud Run Regions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_regions
</code></pre>


<h3>Format</h3>

<p>A character vector of valid Cloud Run region names
</p>

<hr>
<h2 id='cr_run'>Create a CloudRun service.</h2><span id='topic+cr_run'></span>

<h3>Description</h3>

<p>Deploys an existing gcr.io image.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_run(
  image,
  name = basename(image),
  allowUnauthenticated = TRUE,
  concurrency = 1,
  port = NULL,
  max_instances = "default",
  memory = "256Mi",
  cpu = 1,
  timeout = 600L,
  region = cr_region_get(),
  projectId = cr_project_get(),
  launch_browser = interactive(),
  env_vars = NULL,
  gcloud_args = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_run_+3A_image">image</code></td>
<td>
<p>The name of the image to create or use in deployment - <code>gcr.io</code></p>
</td></tr>
<tr><td><code id="cr_run_+3A_name">name</code></td>
<td>
<p>Name for deployment on Cloud Run</p>
</td></tr>
<tr><td><code id="cr_run_+3A_allowunauthenticated">allowUnauthenticated</code></td>
<td>
<p>TRUE if can be reached from public HTTP address. If FALSE will configure a service-email called <code>(name)-cloudrun-invoker@(project-id).iam.gserviceaccount.com</code></p>
</td></tr>
<tr><td><code id="cr_run_+3A_concurrency">concurrency</code></td>
<td>
<p>How many connections each container instance can serve. Can be up to 80.</p>
</td></tr>
<tr><td><code id="cr_run_+3A_port">port</code></td>
<td>
<p>Container port to receive requests at. Also sets the $PORT environment variable. Must be a number between 1 and 65535, inclusive. To unset this field, pass the special value &quot;default&quot;.</p>
</td></tr>
<tr><td><code id="cr_run_+3A_max_instances">max_instances</code></td>
<td>
<p>the desired maximum nuimber of container instances. &quot;default&quot; is 1000, you can get more if you requested a quota instance.  For Shiny instances on Cloud Run, this needs to be 1.</p>
</td></tr>
<tr><td><code id="cr_run_+3A_memory">memory</code></td>
<td>
<p>The format for size is a fixed or floating point number followed by a unit: G, M, or K corresponding to gigabyte, megabyte, or kilobyte, respectively, or use the power-of-two equivalents: Gi, Mi, Ki corresponding to gibibyte, mebibyte or kibibyte respectively. The default is 256Mi</p>
</td></tr>
<tr><td><code id="cr_run_+3A_cpu">cpu</code></td>
<td>
<p>1 or 2 CPUs for your instance</p>
</td></tr>
<tr><td><code id="cr_run_+3A_timeout">timeout</code></td>
<td>
<p>Amount of time that this build should be allowed to run, to second</p>
</td></tr>
<tr><td><code id="cr_run_+3A_region">region</code></td>
<td>
<p>The endpoint region for deployment</p>
</td></tr>
<tr><td><code id="cr_run_+3A_projectid">projectId</code></td>
<td>
<p>The GCP project from which the services should be listed</p>
</td></tr>
<tr><td><code id="cr_run_+3A_launch_browser">launch_browser</code></td>
<td>
<p>Whether to launch the logs URL in a browser once deployed</p>
</td></tr>
<tr><td><code id="cr_run_+3A_env_vars">env_vars</code></td>
<td>
<p>Environment arguments passed to the Cloud Run container at runtime.  Distinct from <code>env</code> that run at build time.</p>
</td></tr>
<tr><td><code id="cr_run_+3A_gcloud_args">gcloud_args</code></td>
<td>
<p>a character string of arguments that can be sent to the gcloud command not covered by other parameters of this function</p>
</td></tr>
<tr><td><code id="cr_run_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+cr_buildstep_run">cr_buildstep_run</a></code>
</p>

<dl>
<dt></dt><dd></dd>
</dl>
</td></tr>
</table>


<h3>Details</h3>

<p>Uses Cloud Build to deploy an image to Cloud Run
</p>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/run/">Google Documentation for Cloud Run</a>
</p>
<p>Use <a href="#topic+cr_deploy_docker">cr_deploy_docker</a> or similar to create image, <a href="#topic+cr_deploy_run">cr_deploy_run</a> to automate building and deploying, <a href="#topic+cr_deploy_plumber">cr_deploy_plumber</a> to deploy plumber APIs.
</p>
<p><a href="https://cloud.google.com/build/docs/deploying-builds/deploy-cloud-run">Deploying Cloud Run using Cloud Build</a>
</p>
<p>Other Cloud Run functions: 
<code><a href="#topic+cr_jwt_create">cr_jwt_create</a>()</code>,
<code><a href="#topic+cr_plumber_pubsub">cr_plumber_pubsub</a>()</code>,
<code><a href="#topic+cr_run_email">cr_run_email</a>()</code>,
<code><a href="#topic+cr_run_get">cr_run_get</a>()</code>,
<code><a href="#topic+cr_run_list">cr_run_list</a>()</code>,
<code><a href="#topic+cr_run_schedule_http">cr_run_schedule_http</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
cr_project_set("my-project")
cr_region_set("europe-west1")
cr_run("gcr.io/my-project/my-image")
cr_run("gcr.io/cloud-tagging-10302018/gtm-cloud-image:stable",
  env_vars = c("CONTAINER_CONFIG=xxxxxxx")
)

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_run_email'>Create an invoker email for use within authenticated Cloud Run</h2><span id='topic+cr_run_email'></span>

<h3>Description</h3>

<p>Create an invoker email for use within authenticated Cloud Run
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_run_email(name, projectId = cr_project_get())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_run_email_+3A_name">name</code></td>
<td>
<p>Name of the Cloud Run service</p>
</td></tr>
<tr><td><code id="cr_run_email_+3A_projectid">projectId</code></td>
<td>
<p>The projectId where the Cloud Run service will run - set to NULL to only return the processed service name</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other Cloud Run functions: 
<code><a href="#topic+cr_jwt_create">cr_jwt_create</a>()</code>,
<code><a href="#topic+cr_plumber_pubsub">cr_plumber_pubsub</a>()</code>,
<code><a href="#topic+cr_run_get">cr_run_get</a>()</code>,
<code><a href="#topic+cr_run_list">cr_run_list</a>()</code>,
<code><a href="#topic+cr_run_schedule_http">cr_run_schedule_http</a>()</code>,
<code><a href="#topic+cr_run">cr_run</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cr_run_email("my-run-app", "my-project")
</code></pre>

<hr>
<h2 id='cr_run_get'>Get information about a Cloud Run service.</h2><span id='topic+cr_run_get'></span>

<h3>Description</h3>

<p>Get information about a Cloud Run service.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_run_get(name, projectId = cr_project_get())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_run_get_+3A_name">name</code></td>
<td>
<p>The name of the service to retrieve</p>
</td></tr>
<tr><td><code id="cr_run_get_+3A_projectid">projectId</code></td>
<td>
<p>The projectId to get from</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This returns details on a particular deployed Cloud Run service.
</p>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/run/docs/reference/rest/v1/namespaces.services/get">Google Documentation on namespaces.services.get</a>
</p>
<p>Other Cloud Run functions: 
<code><a href="#topic+cr_jwt_create">cr_jwt_create</a>()</code>,
<code><a href="#topic+cr_plumber_pubsub">cr_plumber_pubsub</a>()</code>,
<code><a href="#topic+cr_run_email">cr_run_email</a>()</code>,
<code><a href="#topic+cr_run_list">cr_run_list</a>()</code>,
<code><a href="#topic+cr_run_schedule_http">cr_run_schedule_http</a>()</code>,
<code><a href="#topic+cr_run">cr_run</a>()</code>
</p>

<hr>
<h2 id='cr_run_list'>List CloudRun services.</h2><span id='topic+cr_run_list'></span>

<h3>Description</h3>

<p>List the Cloud Run services you have access to
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_run_list(
  projectId = cr_project_get(),
  labelSelector = NULL,
  limit = NULL,
  summary = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_run_list_+3A_projectid">projectId</code></td>
<td>
<p>The GCP project from which the services should be listed</p>
</td></tr>
<tr><td><code id="cr_run_list_+3A_labelselector">labelSelector</code></td>
<td>
<p>Allows to filter resources based on a label</p>
</td></tr>
<tr><td><code id="cr_run_list_+3A_limit">limit</code></td>
<td>
<p>The maximum number of records that should be returned</p>
</td></tr>
<tr><td><code id="cr_run_list_+3A_summary">summary</code></td>
<td>
<p>If TRUE will return only a subset of info available, set to FALSE for all metadata</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/run/">Google Documentation for Cloud Run</a>
</p>
<p>Other Cloud Run functions: 
<code><a href="#topic+cr_jwt_create">cr_jwt_create</a>()</code>,
<code><a href="#topic+cr_plumber_pubsub">cr_plumber_pubsub</a>()</code>,
<code><a href="#topic+cr_run_email">cr_run_email</a>()</code>,
<code><a href="#topic+cr_run_get">cr_run_get</a>()</code>,
<code><a href="#topic+cr_run_schedule_http">cr_run_schedule_http</a>()</code>,
<code><a href="#topic+cr_run">cr_run</a>()</code>
</p>

<hr>
<h2 id='cr_run_schedule_http'>Create a Cloud Scheduler HTTP target for a private Cloud Run URI</h2><span id='topic+cr_run_schedule_http'></span>

<h3>Description</h3>

<p>This enables Cloud Scheduler to trigger Cloud Run endpoints when they are not public.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_run_schedule_http(uri, email, http_method = "GET", body = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_run_schedule_http_+3A_uri">uri</code></td>
<td>
<p>The URI of your Cloud Run application</p>
</td></tr>
<tr><td><code id="cr_run_schedule_http_+3A_email">email</code></td>
<td>
<p>The service email that has invoke access to the Cloud Run application.  If using <a href="#topic+cr_run">cr_run</a> and derivatives to make the email this will include <code>(name)-cloudrun-invoker@(project-id).iam.gserviceaccount.com</code> - see <a href="#topic+cr_run_email">cr_run_email</a> to help make the email.</p>
</td></tr>
<tr><td><code id="cr_run_schedule_http_+3A_http_method">http_method</code></td>
<td>
<p>The HTTP verb you have set up your Cloud Run application to receive</p>
</td></tr>
<tr><td><code id="cr_run_schedule_http_+3A_body">body</code></td>
<td>
<p>(optional) An R list object that will be turned into JSON via <a href="jsonlite.html#topic+toJSON">toJSON</a> and turned into a base64-encoded string if you are doing a POST, PUT or PATCH request.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Ensure you have a service email with <a href="#topic+cr_email_set">cr_email_set</a> of format <code>service-{project-number}@gcp-sa-cloudscheduler.iam.gserviceaccount.com</code> with Cloud Scheduler Service Agent role as per https://cloud.google.com/scheduler/docs/http-target-auth#add
</p>


<h3>Value</h3>

<p>A <a href="#topic+HttpTarget">HttpTarget</a> object for use in <a href="#topic+cr_schedule">cr_schedule</a>
</p>


<h3>See Also</h3>

<p>https://cloud.google.com/run/docs/triggering/using-scheduler
</p>
<p><a href="#topic+cr_schedule_http">cr_schedule_http</a> and <a href="#topic+cr_run">cr_run</a> and <a href="#topic+cr_deploy_run">cr_deploy_run</a>
</p>
<p>Other Cloud Scheduler functions: 
<code><a href="#topic+HttpTarget">HttpTarget</a>()</code>,
<code><a href="#topic+Job">Job</a>()</code>,
<code><a href="#topic+PubsubTarget">PubsubTarget</a>()</code>,
<code><a href="#topic+cr_build_schedule_http">cr_build_schedule_http</a>()</code>,
<code><a href="#topic+cr_schedule_delete">cr_schedule_delete</a>()</code>,
<code><a href="#topic+cr_schedule_get">cr_schedule_get</a>()</code>,
<code><a href="#topic+cr_schedule_list">cr_schedule_list</a>()</code>,
<code><a href="#topic+cr_schedule_pause">cr_schedule_pause</a>()</code>,
<code><a href="#topic+cr_schedule_run">cr_schedule_run</a>()</code>
</p>
<p>Other Cloud Run functions: 
<code><a href="#topic+cr_jwt_create">cr_jwt_create</a>()</code>,
<code><a href="#topic+cr_plumber_pubsub">cr_plumber_pubsub</a>()</code>,
<code><a href="#topic+cr_run_email">cr_run_email</a>()</code>,
<code><a href="#topic+cr_run_get">cr_run_get</a>()</code>,
<code><a href="#topic+cr_run_list">cr_run_list</a>()</code>,
<code><a href="#topic+cr_run">cr_run</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# for unauthenticated apps create a HttpTarget
run_me &lt;- HttpTarget(
  uri = "https://public-ewjogewawq-ew.a.run.app/echo?msg=blah",
  http_method = "GET"
)
cr_schedule("cloud-run-scheduled",
  schedule = "16 4 * * *",
  httpTarget = run_me
)

# for authenticated Cloud Run apps - create with allowUnauthenticated=FALSE
cr_deploy_run("my-app", allowUnauthenticated = TRUE)

## End(Not run)

# deploying via R will help create a service email called my-app-cloudrun-invoker
cr_run_email("my-app")
## Not run: 
# use that email to schedule the Cloud Run private micro-service

# schedule the endpoint
my_run_name &lt;- "my-app"
my_app &lt;- cr_run_get(my_run_name)
email &lt;- cr_run_email(my_run_name)
endpoint &lt;- paste0(my_app$status$url, "/fetch_stuff")

app_sched &lt;- cr_run_schedule_http(endpoint,
  http_method = "GET",
  email = email
)

cr_schedule("cloud-run-scheduled-1",
  schedule = "4 16 * * *",
  httpTarget = app_sched
)

## End(Not run)

</code></pre>

<hr>
<h2 id='cr_schedule_build'>Schedule a Build object via HTTP or PubSub</h2><span id='topic+cr_schedule_build'></span>

<h3>Description</h3>

<p>Schedule a Build object via HTTP or PubSub
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_schedule_build(
  build,
  schedule,
  schedule_type = c("http", "pubsub"),
  email = cr_email_get(),
  projectId = cr_project_get(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_schedule_build_+3A_build">build</code></td>
<td>
<p>A Build object</p>
</td></tr>
<tr><td><code id="cr_schedule_build_+3A_schedule">schedule</code></td>
<td>
<p>A cron schedule e.g. <code>"15 5 * * *"</code></p>
</td></tr>
<tr><td><code id="cr_schedule_build_+3A_schedule_type">schedule_type</code></td>
<td>
<p>Whether to use HTTP or PubSub styled schedules</p>
</td></tr>
<tr><td><code id="cr_schedule_build_+3A_email">email</code></td>
<td>
<p>The email that will authenticate the job set via <a href="#topic+cr_email_set">cr_email_set</a></p>
</td></tr>
<tr><td><code id="cr_schedule_build_+3A_projectid">projectId</code></td>
<td>
<p>The GCP project to run within usually set with <a href="#topic+cr_project_set">cr_project_set</a></p>
</td></tr>
<tr><td><code id="cr_schedule_build_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+cr_schedule">cr_schedule</a></code>
</p>

<dl>
<dt><code>region</code></dt><dd><p>The region usually set with <a href="#topic+cr_region_set">cr_region_set</a></p>
</dd>
<dt><code>overwrite</code></dt><dd><p>If TRUE and an existing job with the same name exists, will overwrite it with the new parameters</p>
</dd>
<dt><code>name</code></dt><dd><p>Name to call your scheduled job</p>
</dd>
<dt><code>httpTarget</code></dt><dd><p>A HTTP target object <a href="#topic+HttpTarget">HttpTarget</a></p>
</dd>
<dt><code>pubsubTarget</code></dt><dd><p>A Pub/Sub target object <a href="#topic+PubsubTarget">PubsubTarget</a> such as created via <a href="#topic+cr_schedule_pubsub">cr_schedule_pubsub</a></p>
</dd>
<dt><code>description</code></dt><dd><p>Optionally caller-specified in CreateJob or</p>
</dd>
<dt><code>timeZone</code></dt><dd><p>Specifies the time zone to be used in interpreting schedule. If set to <code>NULL</code> will be &quot;UTC&quot;. Note that some time zones include a provision for daylight savings time.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Details</h3>

<p>See also <a href="#topic+cr_schedule">cr_schedule</a> which you can use by to customise your schedule.
</p>


<h3>Value</h3>

<p><code>cr_schedule_build</code> returns a cloud scheduler <a href="#topic+Job">Job</a> object
</p>

<hr>
<h2 id='cr_schedule_delete'>Deletes a scheduled job.</h2><span id='topic+cr_schedule_delete'></span>

<h3>Description</h3>

<p>Deletes a scheduled job.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_schedule_delete(
  x,
  region = cr_region_get(),
  projectId = cr_project_get(),
  pubsub_cleanup = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_schedule_delete_+3A_x">x</code></td>
<td>
<p>The name of the scheduled job or a <a href="#topic+Job">Job</a> object</p>
</td></tr>
<tr><td><code id="cr_schedule_delete_+3A_region">region</code></td>
<td>
<p>The region to run within</p>
</td></tr>
<tr><td><code id="cr_schedule_delete_+3A_projectid">projectId</code></td>
<td>
<p>The projectId</p>
</td></tr>
<tr><td><code id="cr_schedule_delete_+3A_pubsub_cleanup">pubsub_cleanup</code></td>
<td>
<p>If the Cloud Scheduler is pointing at a Build Trigger/PubSub as deployed by <a href="#topic+cr_deploy_r">cr_deploy_r</a> will attempt to clean up those resources too.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>TRUE</code> if job not found or its deleted, <code>FALSE</code> if it could not delete the job
</p>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/scheduler/docs/reference/rest/v1/projects.locations.jobs/delete">cloudscheduler.projects.locations.jobs.delete</a>
</p>
<p>Other Cloud Scheduler functions: 
<code><a href="#topic+HttpTarget">HttpTarget</a>()</code>,
<code><a href="#topic+Job">Job</a>()</code>,
<code><a href="#topic+PubsubTarget">PubsubTarget</a>()</code>,
<code><a href="#topic+cr_build_schedule_http">cr_build_schedule_http</a>()</code>,
<code><a href="#topic+cr_run_schedule_http">cr_run_schedule_http</a>()</code>,
<code><a href="#topic+cr_schedule_get">cr_schedule_get</a>()</code>,
<code><a href="#topic+cr_schedule_list">cr_schedule_list</a>()</code>,
<code><a href="#topic+cr_schedule_pause">cr_schedule_pause</a>()</code>,
<code><a href="#topic+cr_schedule_run">cr_schedule_run</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
cr_project_set("my-project")
cr_region_set("europe-west1")
cr_schedule_delete("cloud-build-test1")


## End(Not run)
</code></pre>

<hr>
<h2 id='cr_schedule_get'>Gets a scheduler job.</h2><span id='topic+cr_schedule_get'></span>

<h3>Description</h3>

<p>Gets a scheduler job.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_schedule_get(name, region = cr_region_get(), projectId = cr_project_get())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_schedule_get_+3A_name">name</code></td>
<td>
<p>Required - a string or a schedule Job object</p>
</td></tr>
<tr><td><code id="cr_schedule_get_+3A_region">region</code></td>
<td>
<p>The region to run within</p>
</td></tr>
<tr><td><code id="cr_schedule_get_+3A_projectid">projectId</code></td>
<td>
<p>The projectId</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/scheduler/docs/reference/rest/v1/projects.locations.jobs/get">Google Documentation</a>
</p>
<p>Other Cloud Scheduler functions: 
<code><a href="#topic+HttpTarget">HttpTarget</a>()</code>,
<code><a href="#topic+Job">Job</a>()</code>,
<code><a href="#topic+PubsubTarget">PubsubTarget</a>()</code>,
<code><a href="#topic+cr_build_schedule_http">cr_build_schedule_http</a>()</code>,
<code><a href="#topic+cr_run_schedule_http">cr_run_schedule_http</a>()</code>,
<code><a href="#topic+cr_schedule_delete">cr_schedule_delete</a>()</code>,
<code><a href="#topic+cr_schedule_list">cr_schedule_list</a>()</code>,
<code><a href="#topic+cr_schedule_pause">cr_schedule_pause</a>()</code>,
<code><a href="#topic+cr_schedule_run">cr_schedule_run</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
cr_project_set("my-project")
cr_region_set("europe-west1")
cr_schedule_get("cloud-build-test1")

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_schedule_list'>Lists Cloud Scheduler jobs.</h2><span id='topic+cr_schedule_list'></span>

<h3>Description</h3>

<p>Lists cloud scheduler jobs including targeting, schedule and authentication
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_schedule_list(region = cr_region_get(), projectId = cr_project_get())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_schedule_list_+3A_region">region</code></td>
<td>
<p>The region to run within</p>
</td></tr>
<tr><td><code id="cr_schedule_list_+3A_projectid">projectId</code></td>
<td>
<p>The projectId</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/scheduler/docs/reference/rest/v1/projects.locations.jobs/list">Google Documentation</a>
</p>
<p>Other Cloud Scheduler functions: 
<code><a href="#topic+HttpTarget">HttpTarget</a>()</code>,
<code><a href="#topic+Job">Job</a>()</code>,
<code><a href="#topic+PubsubTarget">PubsubTarget</a>()</code>,
<code><a href="#topic+cr_build_schedule_http">cr_build_schedule_http</a>()</code>,
<code><a href="#topic+cr_run_schedule_http">cr_run_schedule_http</a>()</code>,
<code><a href="#topic+cr_schedule_delete">cr_schedule_delete</a>()</code>,
<code><a href="#topic+cr_schedule_get">cr_schedule_get</a>()</code>,
<code><a href="#topic+cr_schedule_pause">cr_schedule_pause</a>()</code>,
<code><a href="#topic+cr_schedule_run">cr_schedule_run</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
cr_project_set("my-project")
cr_region_set("europe-west1")
cr_schedule_list()


## End(Not run)
</code></pre>

<hr>
<h2 id='cr_schedule_pause'>Pauses and resumes a scheduled job.</h2><span id='topic+cr_schedule_pause'></span><span id='topic+cr_schedule_resume'></span>

<h3>Description</h3>

<p>If a job is paused then the system will stop executing the job until it is re-enabled via <a href="#topic+cr_schedule_resume">cr_schedule_resume</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_schedule_pause(x, region = cr_region_get(), projectId = cr_project_get())

cr_schedule_resume(x, region = cr_region_get(), projectId = cr_project_get())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_schedule_pause_+3A_x">x</code></td>
<td>
<p>The name of the scheduled job or a <a href="#topic+Job">Job</a> object</p>
</td></tr>
<tr><td><code id="cr_schedule_pause_+3A_region">region</code></td>
<td>
<p>The region to run within</p>
</td></tr>
<tr><td><code id="cr_schedule_pause_+3A_projectid">projectId</code></td>
<td>
<p>The projectId</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The state of the job is stored in state; if paused it will be set to Job.State.PAUSED. A job must be in Job.State.ENABLED to be paused.
</p>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/scheduler/docs/reference/rest/v1/projects.locations.jobs/pause">cloudscheduler.projects.locations.jobs.pause</a>
</p>
<p><a href="https://cloud.google.com/scheduler/">cloudscheduler.projects.locations.jobs.resume</a>
</p>
<p>Other Cloud Scheduler functions: 
<code><a href="#topic+HttpTarget">HttpTarget</a>()</code>,
<code><a href="#topic+Job">Job</a>()</code>,
<code><a href="#topic+PubsubTarget">PubsubTarget</a>()</code>,
<code><a href="#topic+cr_build_schedule_http">cr_build_schedule_http</a>()</code>,
<code><a href="#topic+cr_run_schedule_http">cr_run_schedule_http</a>()</code>,
<code><a href="#topic+cr_schedule_delete">cr_schedule_delete</a>()</code>,
<code><a href="#topic+cr_schedule_get">cr_schedule_get</a>()</code>,
<code><a href="#topic+cr_schedule_list">cr_schedule_list</a>()</code>,
<code><a href="#topic+cr_schedule_run">cr_schedule_run</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
cr_project_set("my-project")
cr_region_set("europe-west1")
cr_schedule_pause("cloud-build-test1")
cr_schedule_resume("cloud-build-test1")

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_schedule_run'>Forces a job to run now.</h2><span id='topic+cr_schedule_run'></span>

<h3>Description</h3>

<p>When this method is called, Cloud Scheduler will dispatch the job, even if the job is already running.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_schedule_run(x, region = cr_region_get(), projectId = cr_project_get())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_schedule_run_+3A_x">x</code></td>
<td>
<p>The name of the scheduled job or a <a href="#topic+Job">Job</a> object</p>
</td></tr>
<tr><td><code id="cr_schedule_run_+3A_region">region</code></td>
<td>
<p>The region to run within</p>
</td></tr>
<tr><td><code id="cr_schedule_run_+3A_projectid">projectId</code></td>
<td>
<p>The projectId</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/scheduler/docs/reference/rest/v1/projects.locations.jobs/run">cloudscheduler.projects.locations.jobs.run</a>
</p>
<p>Other Cloud Scheduler functions: 
<code><a href="#topic+HttpTarget">HttpTarget</a>()</code>,
<code><a href="#topic+Job">Job</a>()</code>,
<code><a href="#topic+PubsubTarget">PubsubTarget</a>()</code>,
<code><a href="#topic+cr_build_schedule_http">cr_build_schedule_http</a>()</code>,
<code><a href="#topic+cr_run_schedule_http">cr_run_schedule_http</a>()</code>,
<code><a href="#topic+cr_schedule_delete">cr_schedule_delete</a>()</code>,
<code><a href="#topic+cr_schedule_get">cr_schedule_get</a>()</code>,
<code><a href="#topic+cr_schedule_list">cr_schedule_list</a>()</code>,
<code><a href="#topic+cr_schedule_pause">cr_schedule_pause</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
cr_project_set("my-project")
cr_region_set("europe-west1")
cr_schedule_run("cloud-build-test1")

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_setup'>A helper setup function for setting up use with googleCloudRunner</h2><span id='topic+cr_setup'></span>

<h3>Description</h3>

<p>A helper setup function for setting up use with googleCloudRunner
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_setup()
</code></pre>


<h3>See Also</h3>

<p>Other setup functions: 
<code><a href="#topic+cr_setup_auth">cr_setup_auth</a>()</code>,
<code><a href="#topic+cr_setup_service">cr_setup_service</a>()</code>,
<code><a href="#topic+cr_setup_test">cr_setup_test</a>()</code>
</p>

<hr>
<h2 id='cr_setup_auth'>Create a service account for googleCloudRunner</h2><span id='topic+cr_setup_auth'></span>

<h3>Description</h3>

<p>This will use your Google OAuth2 user to create a suitable service account
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_setup_auth(
  email = Sys.getenv("GARGLE_EMAIL"),
  file = "googlecloudrunner-auth-key.json",
  session_user = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_setup_auth_+3A_email">email</code></td>
<td>
<p>What email to open OAuth2 with</p>
</td></tr>
<tr><td><code id="cr_setup_auth_+3A_file">file</code></td>
<td>
<p>Where to save the authentication file</p>
</td></tr>
<tr><td><code id="cr_setup_auth_+3A_session_user">session_user</code></td>
<td>
<p>1 for user level, 2 for project level, leave <code>NULL</code> to be prompted</p>
</td></tr>
</table>


<h3>Value</h3>

<p>TRUE if the file is ready to be setup by <a href="#topic+cr_setup">cr_setup</a>, FALSE if need to stop
</p>


<h3>See Also</h3>

<p>Other setup functions: 
<code><a href="#topic+cr_setup_service">cr_setup_service</a>()</code>,
<code><a href="#topic+cr_setup_test">cr_setup_test</a>()</code>,
<code><a href="#topic+cr_setup">cr_setup</a>()</code>
</p>

<hr>
<h2 id='cr_setup_service'>Give a service account the right permissions for googleCloudRunner operations</h2><span id='topic+cr_setup_service'></span><span id='topic+cr_setup_role_lookup'></span>

<h3>Description</h3>

<p>Give a service account the right permissions for googleCloudRunner operations
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_setup_service(
  account_email,
  roles = cr_setup_role_lookup("local"),
  json = Sys.getenv("GAR_CLIENT_JSON"),
  email = Sys.getenv("GARGLE_EMAIL")
)

cr_setup_role_lookup(
  type = c("local", "cloudrun", "bigquery", "secrets", "cloudbuild", "cloudstorage",
    "schedule_agent", "run_agent", "compute")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_setup_service_+3A_account_email">account_email</code></td>
<td>
<p>The service account email e.g. <code>accountId@projectid.iam.gserviceaccount.com</code> or 12345678@cloudbuild.gserviceaccount.com</p>
</td></tr>
<tr><td><code id="cr_setup_service_+3A_roles">roles</code></td>
<td>
<p>the roles to grant access - default is all googleCloudRunner functions</p>
</td></tr>
<tr><td><code id="cr_setup_service_+3A_json">json</code></td>
<td>
<p>the project clientId JSON</p>
</td></tr>
<tr><td><code id="cr_setup_service_+3A_email">email</code></td>
<td>
<p>the email of an Owner/Editor for the project</p>
</td></tr>
<tr><td><code id="cr_setup_service_+3A_type">type</code></td>
<td>
<p>the role</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other setup functions: 
<code><a href="#topic+cr_setup_auth">cr_setup_auth</a>()</code>,
<code><a href="#topic+cr_setup_test">cr_setup_test</a>()</code>,
<code><a href="#topic+cr_setup">cr_setup</a>()</code>
</p>

<hr>
<h2 id='cr_setup_test'>Run tests over your setup</h2><span id='topic+cr_setup_test'></span>

<h3>Description</h3>

<p>This allows you to check if your setup works - run <a href="#topic+cr_setup">cr_setup</a> first.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_setup_test(
  option = c("menu", "all", "docker", "plumber", "r_script", "r_schedule")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_setup_test_+3A_option">option</code></td>
<td>
<p>Default will use an interactive menu, select other option to run that test without a menu</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other setup functions: 
<code><a href="#topic+cr_setup_auth">cr_setup_auth</a>()</code>,
<code><a href="#topic+cr_setup_service">cr_setup_service</a>()</code>,
<code><a href="#topic+cr_setup">cr_setup</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# start the menu for interactive use
cr_setup_test()

# skip menu and run all tests
cr_setup_test("all")

# run just the plumber deployment test
cr_setup_test("plumber")

## End(Not run)
</code></pre>

<hr>
<h2 id='cr_sourcerepo_list'>List source repositories available under a project</h2><span id='topic+cr_sourcerepo_list'></span>

<h3>Description</h3>

<p>List source repositories available under a project
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_sourcerepo_list(projectId = cr_project_get())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cr_sourcerepo_list_+3A_projectid">projectId</code></td>
<td>
<p>The projectId that holds the repositories</p>
</td></tr>
</table>

<hr>
<h2 id='GitHubEventsConfig'>GitHubEventsConfig Object</h2><span id='topic+GitHubEventsConfig'></span>

<h3>Description</h3>

<p>GitHubEventsConfig Object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GitHubEventsConfig(
  x,
  event = c("push", "pull"),
  branch = ".*",
  tag = NULL,
  commentControl = c("COMMENTS_DISABLED", "COMMENTS_ENABLED")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="GitHubEventsConfig_+3A_x">x</code></td>
<td>
<p>The repository in format owner/repo e.g. MarkEdmondson1234/googleCloudRunner</p>
</td></tr>
<tr><td><code id="GitHubEventsConfig_+3A_event">event</code></td>
<td>
<p>Whether to trigger on push or pull GitHub events</p>
</td></tr>
<tr><td><code id="GitHubEventsConfig_+3A_branch">branch</code></td>
<td>
<p>Regex of branches to match</p>
</td></tr>
<tr><td><code id="GitHubEventsConfig_+3A_tag">tag</code></td>
<td>
<p>If a push request, regexes matching what tags to build. If not <code>NULL</code> then argument <code>branch</code> will be ignored</p>
</td></tr>
<tr><td><code id="GitHubEventsConfig_+3A_commentcontrol">commentControl</code></td>
<td>
<p>If a pull request, whether to require comments before builds are triggered.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The syntax of the regular expressions accepted is the syntax accepted by RE2 and described at <a href="https://github.com/google/re2/wiki/Syntax">https://github.com/google/re2/wiki/Syntax</a>
</p>


<h3>Value</h3>

<p>GitHubEventsConfig object
</p>


<h3>See Also</h3>

<p>Other BuildTrigger functions: 
<code><a href="#topic+BuildTrigger">BuildTrigger</a>()</code>,
<code><a href="#topic+cr_buildtrigger_copy">cr_buildtrigger_copy</a>()</code>,
<code><a href="#topic+cr_buildtrigger_delete">cr_buildtrigger_delete</a>()</code>,
<code><a href="#topic+cr_buildtrigger_edit">cr_buildtrigger_edit</a>()</code>,
<code><a href="#topic+cr_buildtrigger_get">cr_buildtrigger_get</a>()</code>,
<code><a href="#topic+cr_buildtrigger_list">cr_buildtrigger_list</a>()</code>,
<code><a href="#topic+cr_buildtrigger_pubsub">cr_buildtrigger_pubsub</a>()</code>,
<code><a href="#topic+cr_buildtrigger_repo">cr_buildtrigger_repo</a>()</code>,
<code><a href="#topic+cr_buildtrigger_run">cr_buildtrigger_run</a>()</code>,
<code><a href="#topic+cr_buildtrigger_webhook">cr_buildtrigger_webhook</a>()</code>,
<code><a href="#topic+cr_buildtrigger">cr_buildtrigger</a>()</code>
</p>

<hr>
<h2 id='googleCloudRunner'>Launch R scripts into the Google Cloud via Cloud Build, Cloud Run and Cloud Scheduler</h2><span id='topic+googleCloudRunner'></span>

<h3>Description</h3>

<p>See website for more details: <a href="https://code.markedmondson.me/googleCloudRunner/">https://code.markedmondson.me/googleCloudRunner/</a>
</p>

<hr>
<h2 id='HttpTarget'>HttpTarget Object</h2><span id='topic+HttpTarget'></span>

<h3>Description</h3>

<p>HttpTarget Object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HttpTarget(
  headers = NULL,
  body = NULL,
  oauthToken = NULL,
  uri = NULL,
  oidcToken = NULL,
  httpMethod = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="HttpTarget_+3A_headers">headers</code></td>
<td>
<p>A named list of HTTP headers e.g. <code>list(Blah = "yes", Boo = "no")</code></p>
</td></tr>
<tr><td><code id="HttpTarget_+3A_body">body</code></td>
<td>
<p>HTTP request body.  Just send in the R object/list, which will be base64encoded correctly</p>
</td></tr>
<tr><td><code id="HttpTarget_+3A_oauthtoken">oauthToken</code></td>
<td>
<p>If specified, an OAuth token will be generated and attached as an Authorization header in the HTTP request. This type of authorization should be used when sending requests to a GCP endpoint.</p>
</td></tr>
<tr><td><code id="HttpTarget_+3A_uri">uri</code></td>
<td>
<p>Required</p>
</td></tr>
<tr><td><code id="HttpTarget_+3A_oidctoken">oidcToken</code></td>
<td>
<p>If specified, an OIDC token will be generated and attached as an Authorization header in the HTTP request. This type of authorization should be used when sending requests to third party endpoints or Cloud Run.</p>
</td></tr>
<tr><td><code id="HttpTarget_+3A_httpmethod">httpMethod</code></td>
<td>
<p>Which HTTP method to use for the request</p>
</td></tr>
</table>


<h3>Value</h3>

<p>HttpTarget object
</p>


<h3>See Also</h3>

<p>https://cloud.google.com/scheduler/docs/reference/rest/v1/projects.locations.jobs#HttpTarget
</p>
<p>Other Cloud Scheduler functions: 
<code><a href="#topic+Job">Job</a>()</code>,
<code><a href="#topic+PubsubTarget">PubsubTarget</a>()</code>,
<code><a href="#topic+cr_build_schedule_http">cr_build_schedule_http</a>()</code>,
<code><a href="#topic+cr_run_schedule_http">cr_run_schedule_http</a>()</code>,
<code><a href="#topic+cr_schedule_delete">cr_schedule_delete</a>()</code>,
<code><a href="#topic+cr_schedule_get">cr_schedule_get</a>()</code>,
<code><a href="#topic+cr_schedule_list">cr_schedule_list</a>()</code>,
<code><a href="#topic+cr_schedule_pause">cr_schedule_pause</a>()</code>,
<code><a href="#topic+cr_schedule_run">cr_schedule_run</a>()</code>
</p>

<hr>
<h2 id='Job'>Job Schedule Object</h2><span id='topic+Job'></span>

<h3>Description</h3>

<p>Job Schedule Object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Job(
  name = NULL,
  description = NULL,
  schedule = NULL,
  timeZone = NULL,
  userUpdateTime = NULL,
  state = NULL,
  status = NULL,
  scheduleTime = NULL,
  lastAttemptTime = NULL,
  retryConfig = NULL,
  attemptDeadline = NULL,
  pubsubTarget = NULL,
  appEngineHttpTarget = NULL,
  httpTarget = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Job_+3A_name">name</code></td>
<td>
<p>Name to call your scheduled job</p>
</td></tr>
<tr><td><code id="Job_+3A_description">description</code></td>
<td>
<p>Optionally caller-specified in CreateJob or</p>
</td></tr>
<tr><td><code id="Job_+3A_schedule">schedule</code></td>
<td>
<p>A cron schedule e.g. <code>"15 5 * * *"</code></p>
</td></tr>
<tr><td><code id="Job_+3A_timezone">timeZone</code></td>
<td>
<p>Specifies the time zone to be used in interpreting schedule. If set to <code>NULL</code> will be &quot;UTC&quot;. Note that some time zones include a provision for daylight savings time.</p>
</td></tr>
<tr><td><code id="Job_+3A_userupdatetime">userUpdateTime</code></td>
<td>
<p>Output only</p>
</td></tr>
<tr><td><code id="Job_+3A_state">state</code></td>
<td>
<p>Output only</p>
</td></tr>
<tr><td><code id="Job_+3A_status">status</code></td>
<td>
<p>Output only</p>
</td></tr>
<tr><td><code id="Job_+3A_scheduletime">scheduleTime</code></td>
<td>
<p>Output only</p>
</td></tr>
<tr><td><code id="Job_+3A_lastattempttime">lastAttemptTime</code></td>
<td>
<p>Output only</p>
</td></tr>
<tr><td><code id="Job_+3A_retryconfig">retryConfig</code></td>
<td>
<p>Settings that determine the retry behavior</p>
</td></tr>
<tr><td><code id="Job_+3A_attemptdeadline">attemptDeadline</code></td>
<td>
<p>The deadline for job attempts</p>
</td></tr>
<tr><td><code id="Job_+3A_pubsubtarget">pubsubTarget</code></td>
<td>
<p>A Pub/Sub target object <a href="#topic+PubsubTarget">PubsubTarget</a> such as created via <a href="#topic+cr_schedule_pubsub">cr_schedule_pubsub</a></p>
</td></tr>
<tr><td><code id="Job_+3A_appenginehttptarget">appEngineHttpTarget</code></td>
<td>
<p>App Engine HTTP target</p>
</td></tr>
<tr><td><code id="Job_+3A_httptarget">httpTarget</code></td>
<td>
<p>A HTTP target object <a href="#topic+HttpTarget">HttpTarget</a></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Configuration for a job.The maximum allowed size for a job is 100KB.
</p>


<h3>Value</h3>

<p>Job object
</p>


<h3>See Also</h3>

<p>Other Cloud Scheduler functions: 
<code><a href="#topic+HttpTarget">HttpTarget</a>()</code>,
<code><a href="#topic+PubsubTarget">PubsubTarget</a>()</code>,
<code><a href="#topic+cr_build_schedule_http">cr_build_schedule_http</a>()</code>,
<code><a href="#topic+cr_run_schedule_http">cr_run_schedule_http</a>()</code>,
<code><a href="#topic+cr_schedule_delete">cr_schedule_delete</a>()</code>,
<code><a href="#topic+cr_schedule_get">cr_schedule_get</a>()</code>,
<code><a href="#topic+cr_schedule_list">cr_schedule_list</a>()</code>,
<code><a href="#topic+cr_schedule_pause">cr_schedule_pause</a>()</code>,
<code><a href="#topic+cr_schedule_run">cr_schedule_run</a>()</code>
</p>

<hr>
<h2 id='PubsubConfig'>Pubsub Config (Build Trigger)</h2><span id='topic+PubsubConfig'></span>

<h3>Description</h3>

<p>PubsubConfig describes the configuration of a trigger that creates a build whenever a Pub/Sub message is published.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PubsubConfig(
  subscription = NULL,
  topic = NULL,
  serviceAccountEmail = NULL,
  state = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PubsubConfig_+3A_subscription">subscription</code></td>
<td>
<p>Output only. Name of the subscription.</p>
</td></tr>
<tr><td><code id="PubsubConfig_+3A_topic">topic</code></td>
<td>
<p>The name of the topic from which this subscription is receiving messages.</p>
</td></tr>
<tr><td><code id="PubsubConfig_+3A_serviceaccountemail">serviceAccountEmail</code></td>
<td>
<p>Service account that will make the push request.</p>
</td></tr>
<tr><td><code id="PubsubConfig_+3A_state">state</code></td>
<td>
<p>Potential issues with the underlying Pub/Sub subscription configuration. Only populated on get requests.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A PubsubConfig object
</p>


<h3>See Also</h3>

<p>'https://cloud.google.com/build/docs/api/reference/rest/v1/projects.locations.triggers#BuildTrigger.PubsubConfig'
</p>

<hr>
<h2 id='PubsubTarget'>Pubsub Target Object (Cloud Scheduler)</h2><span id='topic+PubsubTarget'></span>

<h3>Description</h3>

<p>Pubsub Target Object (Cloud Scheduler)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PubsubTarget(topicName = NULL, data = NULL, attributes = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PubsubTarget_+3A_topicname">topicName</code></td>
<td>
<p>The name of the Cloud Pub/Sub topic to which messages will be published when a job is delivered.</p>
</td></tr>
<tr><td><code id="PubsubTarget_+3A_data">data</code></td>
<td>
<p>The message payload for PubsubMessage. An R object that will be turned into JSON via [jsonlite] and then base64 encoded into the PubSub format.</p>
</td></tr>
<tr><td><code id="PubsubTarget_+3A_attributes">attributes</code></td>
<td>
<p>Attributes for PubsubMessage.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Pub/Sub target. The job will be delivered by publishing a message to the given Pub/Sub topic.
</p>


<h3>Value</h3>

<p>PubsubTarget object
</p>


<h3>See Also</h3>

<p>Other Cloud Scheduler functions: 
<code><a href="#topic+HttpTarget">HttpTarget</a>()</code>,
<code><a href="#topic+Job">Job</a>()</code>,
<code><a href="#topic+cr_build_schedule_http">cr_build_schedule_http</a>()</code>,
<code><a href="#topic+cr_run_schedule_http">cr_run_schedule_http</a>()</code>,
<code><a href="#topic+cr_schedule_delete">cr_schedule_delete</a>()</code>,
<code><a href="#topic+cr_schedule_get">cr_schedule_get</a>()</code>,
<code><a href="#topic+cr_schedule_list">cr_schedule_list</a>()</code>,
<code><a href="#topic+cr_schedule_pause">cr_schedule_pause</a>()</code>,
<code><a href="#topic+cr_schedule_run">cr_schedule_run</a>()</code>
</p>

<hr>
<h2 id='RepoSource'>RepoSource Object</h2><span id='topic+RepoSource'></span>

<h3>Description</h3>

<p>RepoSource Object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RepoSource(
  repoName = NULL,
  tagName = NULL,
  commitSha = NULL,
  branchName = NULL,
  dir = NULL,
  projectId = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="RepoSource_+3A_reponame">repoName</code></td>
<td>
<p>Name of the Cloud Source Repository</p>
</td></tr>
<tr><td><code id="RepoSource_+3A_tagname">tagName</code></td>
<td>
<p>Regex matching tags to build</p>
</td></tr>
<tr><td><code id="RepoSource_+3A_commitsha">commitSha</code></td>
<td>
<p>Explicit commit SHA to build</p>
</td></tr>
<tr><td><code id="RepoSource_+3A_branchname">branchName</code></td>
<td>
<p>Regex matching branches to build e.g. &quot;.*&quot;</p>
</td></tr>
<tr><td><code id="RepoSource_+3A_dir">dir</code></td>
<td>
<p>Directory, relative to the source root, in which to run the build</p>
</td></tr>
<tr><td><code id="RepoSource_+3A_projectid">projectId</code></td>
<td>
<p>ID of the project that owns the Cloud Source Repository</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Location of the source in a Google Cloud Source Repository.
</p>
<p>Only one of commitSha, branchName or tagName are allowed.
</p>
<p>If you want to use GitHub or BitBucket repos, you need to setup mirroring
them via Cloud Source Repositories https://source.cloud.google.com/
</p>


<h3>Value</h3>

<p>RepoSource object
</p>


<h3>See Also</h3>

<p>Other Cloud Build functions: 
<code><a href="#topic+Build">Build</a>()</code>,
<code><a href="#topic+Source">Source</a>()</code>,
<code><a href="#topic+StorageSource">StorageSource</a>()</code>,
<code><a href="#topic+cr_build_artifacts">cr_build_artifacts</a>()</code>,
<code><a href="#topic+cr_build_list">cr_build_list</a>()</code>,
<code><a href="#topic+cr_build_logs">cr_build_logs</a>()</code>,
<code><a href="#topic+cr_build_make">cr_build_make</a>()</code>,
<code><a href="#topic+cr_build_status">cr_build_status</a>()</code>,
<code><a href="#topic+cr_build_targets">cr_build_targets</a>()</code>,
<code><a href="#topic+cr_build_upload_gcs">cr_build_upload_gcs</a>()</code>,
<code><a href="#topic+cr_build_wait">cr_build_wait</a>()</code>,
<code><a href="#topic+cr_build_write">cr_build_write</a>()</code>,
<code><a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a>()</code>,
<code><a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a>()</code>,
<code><a href="#topic+cr_build_yaml">cr_build_yaml</a>()</code>,
<code><a href="#topic+cr_build">cr_build</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cr_project_set("my-project")
cr_bucket_set("my-bucket")
## Not run: 

my_repo &lt;- cr_build_source(
  RepoSource("github_markedmondson1234_googlecloudrunner",
    branchName = "master"
  )
)

build &lt;- cr_build(
  cr_build_yaml(
    steps =
      cr_buildstep("gcloud", c("-c", "ls -la"),
        entrypoint = "bash",
        dir = ""
      )
  ),
  source = my_repo
)

## End(Not run)
</code></pre>

<hr>
<h2 id='Source'>Source Object</h2><span id='topic+Source'></span>

<h3>Description</h3>

<p>It is suggested to use <a href="#topic+cr_build_source">cr_build_source</a> instead to build sources
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Source(storageSource = NULL, repoSource = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Source_+3A_storagesource">storageSource</code></td>
<td>
<p>If provided via <a href="#topic+StorageSource">StorageSource</a>, get the source
from this location in Google Cloud Storage</p>
</td></tr>
<tr><td><code id="Source_+3A_reposource">repoSource</code></td>
<td>
<p>If provided via <a href="#topic+RepoSource">RepoSource</a>, get the source from
this location in a Cloud Source</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Location of the source in a supported storage service.
</p>


<h3>Value</h3>

<p>Source object
</p>


<h3>See Also</h3>

<p>Other Cloud Build functions: 
<code><a href="#topic+Build">Build</a>()</code>,
<code><a href="#topic+RepoSource">RepoSource</a>()</code>,
<code><a href="#topic+StorageSource">StorageSource</a>()</code>,
<code><a href="#topic+cr_build_artifacts">cr_build_artifacts</a>()</code>,
<code><a href="#topic+cr_build_list">cr_build_list</a>()</code>,
<code><a href="#topic+cr_build_logs">cr_build_logs</a>()</code>,
<code><a href="#topic+cr_build_make">cr_build_make</a>()</code>,
<code><a href="#topic+cr_build_status">cr_build_status</a>()</code>,
<code><a href="#topic+cr_build_targets">cr_build_targets</a>()</code>,
<code><a href="#topic+cr_build_upload_gcs">cr_build_upload_gcs</a>()</code>,
<code><a href="#topic+cr_build_wait">cr_build_wait</a>()</code>,
<code><a href="#topic+cr_build_write">cr_build_write</a>()</code>,
<code><a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a>()</code>,
<code><a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a>()</code>,
<code><a href="#topic+cr_build_yaml">cr_build_yaml</a>()</code>,
<code><a href="#topic+cr_build">cr_build</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cr_project_set("my-project")
cr_bucket_set("my-bucket")
my_gcs_source &lt;- Source(storageSource = StorageSource(
  "my_code.tar.gz",
  "gs://my-bucket"
))
my_repo_source &lt;- Source(repoSource = RepoSource("https://my-repo.com",
  branchName = "master"
))
## Not run: 

build1 &lt;- cr_build("cloudbuild.yaml", source = my_gcs_source)
build2 &lt;- cr_build("cloudbuild.yaml", source = my_repo_source)

## End(Not run)
</code></pre>

<hr>
<h2 id='StorageSource'>StorageSource Object</h2><span id='topic+StorageSource'></span>

<h3>Description</h3>

<p>StorageSource Object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>StorageSource(object, bucket = NULL, generation = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="StorageSource_+3A_object">object</code></td>
<td>
<p>Google Cloud Storage object containing the source. This object
must be a gzipped archive file (.tar.gz) containing source to build.</p>
</td></tr>
<tr><td><code id="StorageSource_+3A_bucket">bucket</code></td>
<td>
<p>Google Cloud Storage bucket containing the source</p>
</td></tr>
<tr><td><code id="StorageSource_+3A_generation">generation</code></td>
<td>
<p>Google Cloud Storage generation for the object.
If the generation is omitted, the latest generation will be used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Location of the source in an archive file in Google Cloud Storage.
</p>


<h3>Value</h3>

<p>StorageSource object
</p>


<h3>See Also</h3>

<p>Other Cloud Build functions: 
<code><a href="#topic+Build">Build</a>()</code>,
<code><a href="#topic+RepoSource">RepoSource</a>()</code>,
<code><a href="#topic+Source">Source</a>()</code>,
<code><a href="#topic+cr_build_artifacts">cr_build_artifacts</a>()</code>,
<code><a href="#topic+cr_build_list">cr_build_list</a>()</code>,
<code><a href="#topic+cr_build_logs">cr_build_logs</a>()</code>,
<code><a href="#topic+cr_build_make">cr_build_make</a>()</code>,
<code><a href="#topic+cr_build_status">cr_build_status</a>()</code>,
<code><a href="#topic+cr_build_targets">cr_build_targets</a>()</code>,
<code><a href="#topic+cr_build_upload_gcs">cr_build_upload_gcs</a>()</code>,
<code><a href="#topic+cr_build_wait">cr_build_wait</a>()</code>,
<code><a href="#topic+cr_build_write">cr_build_write</a>()</code>,
<code><a href="#topic+cr_build_yaml_artifact">cr_build_yaml_artifact</a>()</code>,
<code><a href="#topic+cr_build_yaml_secrets">cr_build_yaml_secrets</a>()</code>,
<code><a href="#topic+cr_build_yaml">cr_build_yaml</a>()</code>,
<code><a href="#topic+cr_build">cr_build</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
cr_project_set("my-project")
cr_bucket_set("my-bucket")
# construct Source object
my_gcs_source &lt;- Source(storageSource = StorageSource(
  "my_code.tar.gz",
  "gs://my-bucket"
))
build1 &lt;- cr_build("cloudbuild.yaml", source = my_gcs_source)

# helper that tars and adds to Source() for you
my_gcs_source2 &lt;- cr_build_upload_gcs("my_folder")
build2 &lt;- cr_build("cloudbuild.yaml", source = my_gcs_source2)

## End(Not run)
</code></pre>

<hr>
<h2 id='WebhookConfig'>WebhookConfig (Build Triggers)</h2><span id='topic+WebhookConfig'></span>

<h3>Description</h3>

<p>WebhookConfig describes the configuration of a trigger that creates a build whenever a webhook is sent to a trigger's webhook URL.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>WebhookConfig(secret, state = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="WebhookConfig_+3A_secret">secret</code></td>
<td>
<p>Resource name for the secret required as a URL parameter.</p>
</td></tr>
<tr><td><code id="WebhookConfig_+3A_state">state</code></td>
<td>
<p>Potential issues with the underlying Pub/Sub subscription configuration. Only populated on get requests.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A WebhookConfig object
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
