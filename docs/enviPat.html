<!DOCTYPE html><html><head><title>Help for package enviPat</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {enviPat}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#enviPat-package'><p> Calculation of isotope patterns, stick profiles (envelopes) and centroids/intensoids for mass spectrometry.</p></a></li>
<li><a href='#adducts'>
<p>Adduct list</p></a></li>
<li><a href='#check_chemform'><p>Check chemical formulas</p></a></li>
<li><a href='#check_ded'>
<p>Check if a chemical formula is subset in another one</p></a></li>
<li><a href='#check_several'><p>Check for overlapping molecules.</p></a></li>
<li><a href='#chemforms'>
<p>Set of exemplary chemical formulas for small molecules.</p></a></li>
<li><a href='#envelope'><p>Isotope pattern envelope calculation</p></a></li>
<li><a href='#getR'><p>Interpolation of MS measurement resolution</p></a></li>
<li><a href='#isopattern'><p>Isotope pattern calculation</p></a></li>
<li><a href='#isotopes'>
<p>Stable isotopes</p></a></li>
<li><a href='#isowrap'>
<p>Combined (batch) calculation of isotope pattern, envelope and centroids/intensoids/valleys on</p>
interpolated resolutions.</a></li>
<li><a href='#mergeform'><p>Combine chemical formulas</p></a></li>
<li><a href='#multiform'><p>Multiply a chemical formula</p></a></li>
<li><a href='#resolution_list'><p>Resolutions (R) list for mass spectrometers</p></a></li>
<li><a href='#subform'><p>Subtract one chemical formula from another</p></a></li>
<li><a href='#vdetect'><p>Valley detection and centroidization</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Isotope Pattern, Profile and Centroid Calculation for Mass
Spectrometry</td>
</tr>
<tr>
<td>Version:</td>
<td>2.6</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-10-21</td>
</tr>
<tr>
<td>Author:</td>
<td>Martin Loos, Christian Gerber</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Martin Loos &lt;mloos@envibee.ch&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Fast and very memory-efficient calculation of isotope patterns,
    subsequent convolution to theoretical envelopes (profiles) plus valley
    detection and centroidization or intensoid calculation. Batch processing,
    resolution interpolation, wrapper, adduct calculations and molecular
    formula parsing.
	Loos, M., Gerber, C., Corona, F., Hollender, J., Singer, H. (2015) 
	&lt;<a href="https://doi.org/10.1021%2Facs.analchem.5b00941">doi:10.1021/acs.analchem.5b00941</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/blosloos/enviPat/issues">https://github.com/blosloos/enviPat/issues</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://www.envipat.eawag.ch/">https://www.envipat.eawag.ch/</a>,
<a href="https://pubs.acs.org/doi/abs/10.1021/acs.analchem.5b00941">https://pubs.acs.org/doi/abs/10.1021/acs.analchem.5b00941</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-10-21 11:36:36 UTC; mloos</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-10-21 12:55:12 UTC</td>
</tr>
</table>
<hr>
<h2 id='enviPat-package'> Calculation of isotope patterns, stick profiles (envelopes) and centroids/intensoids for mass spectrometry.</h2><span id='topic+enviPat-package'></span><span id='topic+enviPat'></span>

<h3>Description</h3>

<p>Fast and memory-efficient calculation of isotope patterns (fine structures) for up to very large molecules, based on three different algorithms.
Subsequent convolution of isotope patterns with a peak shape function to theoretical envelopes (profiles).
Based on envelopes, valley detection and centroidization/intensoid calculation.
Allows for batch processing of chemical formulas and interpolation of measurement resolutions.
Includes a wrapper combining all of the above functionalities.
</p>
<p>Furthermore, includes 
(1) a check for consistency of chemical formulas,
(2) a check for molecules with overlapping isotope patterns,
(3) a list of all stable isotopes,
(4) a list of different resolution data sets for Thermo Orbitrap and QExactive high-resolution mass spectrometers and
(5) a list of adducts formed during electorspray ionization (ESI).
</p>
<p>A web-based GUI for enviPat is freely available under <a href="https://www.envipat.eawag.ch">https://www.envipat.eawag.ch</a>.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> enviPat</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.0</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2013-03-05</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL-2</td>
</tr>
<tr>
 <td style="text-align: left;">
LazyLoad: </td><td style="text-align: left;"> yes</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Martin Loos, Christian Gerber
</p>
<p>Maintainer: Martin Loos &lt;martin.loos@alumni.ethz.ch&gt;
</p>


<h3>References</h3>

<p>Loos, M., Gerber, C., Corona, F., Hollender, J., Singer, H. (2015).  Accelerated isotope fine structure calculation using 
pruned transition trees, Analytical Chemistry 87(11), 5738-5744.
</p>
<p><a href="https://pubs.acs.org/doi/abs/10.1021/acs.analchem.5b00941">https://pubs.acs.org/doi/abs/10.1021/acs.analchem.5b00941</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+check_chemform">check_chemform</a></code>
<code><a href="#topic+getR">getR</a></code>
<code><a href="#topic+isopattern">isopattern</a></code>
<code><a href="#topic+envelope">envelope</a></code>
<code><a href="#topic+vdetect">vdetect</a></code>
<code><a href="#topic+isowrap">isowrap</a></code>
<code><a href="#topic+check_several">check_several</a></code>
</p>
<p><code><a href="#topic+isotopes">isotopes</a></code>
<code><a href="#topic+resolution_list">resolution_list</a></code>
<code><a href="#topic+chemforms">chemforms</a></code>
</p>
<p><code><a href="#topic+adducts">adducts</a></code>
<code><a href="#topic+check_ded">check_ded</a></code>
<code><a href="#topic+mergeform">mergeform</a></code>
<code><a href="#topic+subform">subform</a></code>
<code><a href="#topic+multiform">multiform</a></code>
</p>

<hr>
<h2 id='adducts'>
Adduct list
</h2><span id='topic+adducts'></span>

<h3>Description</h3>

<p>List of common adducts observed for ESI-MS measurements in soft positive and negative ionization modes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(adducts)</code></pre>


<h3>Format</h3>

<p>A data frame with 47 observations on the following 6 variables.
</p>

<dl>
<dt><code>Name</code></dt><dd><p>Adduct name</p>
</dd>
<dt><code>calc</code></dt><dd><p>Equation for calculating adduct m/z from uncharged non-adduct molecular mass M (m/z = M/z + X)</p>
</dd>
<dt><code>Charge</code></dt><dd><p>z</p>
</dd>
<dt><code>Mult</code></dt><dd><p>1/z</p>
</dd>
<dt><code>Mass</code></dt><dd><p>X</p>
</dd>
<dt><code>Ion_mode</code></dt><dd><p>Ionization mode (positive or negative)</p>
</dd>
<dt><code>Formula_add</code></dt><dd><p>Adduct chemical formula to be added</p>
</dd>
<dt><code>Formula_ded</code></dt><dd><p>Adduct chemical formula to be subtracted</p>
</dd>
<dt><code>Multi</code></dt><dd><p>Factor to multiply chemical formula with</p>
</dd>
</dl>



<h3>Details</h3>

<p>The correct way to calculate the isotopic pattern of a specific adduct is the following.
First, multiply the chemical formula of the molecule by the times it appears in the final adduct; <code><a href="#topic+multiform">multiform</a></code>.  
Second, add the chemical formula of any adduct to that of the molecule; <code><a href="#topic+mergeform">mergeform</a></code>.
Third, subtract the chemical formula of any deduct from that of the molecule; <code><a href="#topic+check_ded">check_ded</a></code> &amp; <code><a href="#topic+subform">subform</a></code>.
Finally, calculate the isotopic fine structure using the correct <code>charge</code> argument in <code><a href="#topic+isopattern">isopattern</a></code>.   
</p>


<h3>Note</h3>

<p>Chemical formulas must conform to what is described in <code><a href="#topic+check_chemform">check_chemform</a></code>.
</p>


<h3>Source</h3>

<p><a href="https://fiehnlab.ucdavis.edu/staff/kind/Metabolomics/MS-Adduct-Calculator/">https://fiehnlab.ucdavis.edu/staff/kind/Metabolomics/MS-Adduct-Calculator/</a>
</p>


<h3>References</h3>

<p>Huang N., Siegel M.M., Kruppa G.H., Laukien F.H., J. Am. Soc. Mass. Spectrom. 1999, 10.
Automation of a Fourier transform ion cyclotron resonance mass spectrometer for acquisition, analysis, 
and e-mailing of high-resolution exact-mass electrospray ionization mass spectral data
</p>


<h3>See Also</h3>

<p><code><a href="#topic+multiform">multiform</a></code>
<code><a href="#topic+mergeform">mergeform</a></code>
<code><a href="#topic+check_ded">check_ded</a></code>
<code><a href="#topic+subform">subform</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># example of M+H adduct batch calculation
data(adducts)
data(isotopes)
data(chemforms)
# (1) check formulas for consistency - recommended
checked_chemforms &lt;-	check_chemform(isotopes, chemforms)			 
# (2) multiply, see column 4 of adducts
chemforms &lt;-multiform(checked_chemforms[,2],1)			 
# (3) add adduct - see column 7 of adducts
chemforms&lt;-mergeform(chemforms,"H1")
# (4) calculate fine structure
patterns &lt;- isopattern(isotopes, chemforms)
</code></pre>

<hr>
<h2 id='check_chemform'>Check chemical formulas</h2><span id='topic+check_chemform'></span>

<h3>Description</h3>

<p>Checks chemical formulas (=a vector of character strings) for consistency with usage in <code><a href="#topic+isopattern">isopattern</a></code>; 
calculation of the molecular mass.</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_chemform(isotopes,chemforms,get_sorted=FALSE,get_list=FALSE)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_chemform_+3A_isotopes">isotopes</code></td>
<td>
<p><code><a href="#topic+isotopes">isotopes</a></code></p>
</td></tr>
<tr><td><code id="check_chemform_+3A_chemforms">chemforms</code></td>
<td>
<p>Vector of character strings with chemical formulas</p>
</td></tr>
<tr><td><code id="check_chemform_+3A_get_sorted">get_sorted</code></td>
<td>
<p>Should elements in each formula be sorted according to their order in <code>isotopes</code>?</p>
</td></tr>
<tr><td><code id="check_chemform_+3A_get_list">get_list</code></td>
<td>
<p>Return list with vectors of elementwise atom counts contained in each chemical formula?</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Default checks if (1) a chemical formula contains only letters, numbers and square or round brackets, (2) elements can be found 
in <code><a href="#topic+isotopes">isotopes</a></code> and (3) letters and round brackets are all followed by a number of counts.
Where (3) are missing, they are set to 1.
</p>
<p>(2) must consist of an upper case letter, possibly followed by lower case letters; to refer to individual isotopes
(e.g., from isotope labelling of a molecule, e.g., N5 vs. [15]N2N3), square brackets may precede the capital letter.	
Any other symbols which may be part of a chemical formula (e.g., charges (+), dashes, asterisks, ...) are not permissible.
</p>
<p>The molecular mass will be calculated from isotope masses and abundances listed in <code><a href="#topic+isotopes">isotopes</a></code>.
</p>


<h3>Value</h3>

<p>Dataframe with 3 columns for <code>get_list=FALSE</code>:
</p>
<table>
<tr><td><code>warning</code></td>
<td>
<p>Correct chemical formula, <code>FALSE</code>/<code>TRUE</code>?</p>
</td></tr>
<tr><td><code>new_formula</code></td>
<td>
<p>Chemical formula</p>
</td></tr>
<tr><td><code>monoisotopic_mass</code></td>
<td>
<p>Monoisotopic mass</p>
</td></tr>
</table>
<p>Or list containing vector of elements for <code>get_list=TRUE</code>.
</p>


<h3>Note</h3>

<p>Highly recommended for usage with <code><a href="#topic+isopattern">isopattern</a></code>
</p>


<h3>Author(s)</h3>

<p>Martin Loos, Christian Gerber
</p>


<h3>See Also</h3>

<p><code><a href="#topic+isopattern">isopattern</a></code>
<code><a href="#topic+isotopes">isotopes</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Check package data set of chemical formulas #############
data(chemforms);
data(isotopes);
checked&lt;-check_chemform(isotopes,chemforms);
checked;

# Check for some senseless molecular formulas #############
chemforms&lt;-c("C900Cl4H49","O82394","C8G500Zn9","Br1","6DBr9889");
data(isotopes);
checked&lt;-check_chemform(isotopes,chemforms);
checked;

# Molecular mass with and without isotope labelling #######
chemforms&lt;-c("C10H5N4O5","[13]C2C8D2H3[15]N2N2[18]O2O3");
data(isotopes);
checked&lt;-check_chemform(isotopes,chemforms);
checked;

</code></pre>

<hr>
<h2 id='check_ded'>
Check if a chemical formula is subset in another one
</h2><span id='topic+check_ded'></span>

<h3>Description</h3>

<p>Check if a chemical formula is contained in another chemical formula
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_ded(formulas, deduct)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_ded_+3A_formulas">formulas</code></td>
<td>
<p>Vector with the containing chemical formula(s)</p>
</td></tr>
<tr><td><code id="check_ded_+3A_deduct">deduct</code></td>
<td>
<p>Chemical formula to be contained (&quot;deduct&quot;)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a vector with length of input <code>formulas</code>, with <code>TRUE</code> if deduct is not contained and <code>FALSE</code> otherwise.
</p>


<h3>Note</h3>

<p>Might be used used prior to subtracting a &quot;deduct&quot; chemical formula from that of a molecule when including adducts in the calculation of 
isotopic patterns. Chemical formulas must conform to what is described in <code><a href="#topic+check_chemform">check_chemform</a></code>.
</p>


<h3>Author(s)</h3>

<p>Martin Loos</p>


<h3>See Also</h3>

<p><code><a href="#topic+adducts">adducts</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>formulas&lt;-c("C8H4Cl2","C10H16O2","C3H10")
deduct&lt;-c("C4H10")
check_ded(formulas, deduct)

</code></pre>

<hr>
<h2 id='check_several'>Check for overlapping molecules.</h2><span id='topic+check_several'></span>

<h3>Description</h3>

<p>Check for molecules overlapping in m/z, 
based on isotope fine structures from <code><a href="#topic+isopattern">isopattern</a></code>
or on centroids/intensoids from <code><a href="#topic+envelope">envelope</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_several(pattern, dmz, ppm = TRUE)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_several_+3A_pattern">pattern</code></td>
<td>
<p>Output from <code><a href="#topic+isopattern">isopattern</a></code> or from <code><a href="#topic+envelope">envelope</a></code>.</p>
</td></tr>
<tr><td><code id="check_several_+3A_dmz">dmz</code></td>
<td>
<p>m/z window. In combination with <code>ppm=TRUE</code> set as ppm or with <code>ppm=FALSE</code> set as absolute m/z.</p>
</td></tr>
<tr><td><code id="check_several_+3A_ppm">ppm</code></td>
<td>
<p>Should m/z window be set in ppm (<code>TRUE</code>) or absolute m/z (<code>FALsE</code>)?</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Overlaps in m/z among molecules are screened for within the m/z tolerance defined by the arguments <code>dmz</code> and <code>ppm</code>. 
</p>


<h3>Value</h3>

<p>Dataframe with 4 columns, with number of rows equal to the length of argument <code>pattern</code>
</p>
<table>
<tr><td><code>compound</code></td>
<td>
<p>Chemical formula of the compound</p>
</td></tr>
<tr><td><code>warning</code></td>
<td>
<p>Overlap detected?</p>
</td></tr>
<tr><td><code>to?</code></td>
<td>
<p>If overlap: with wich other compound(s)? Refers to row number, recycled for peak_number.</p>
</td></tr>
<tr><td><code>peak_number</code></td>
<td>
<p>If overlap: with which peak(s) of the other compound(s)? Refers to peak number.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Martin Loos, Christian Gerber</p>


<h3>See Also</h3>

<p><code><a href="#topic+isopattern">isopattern</a></code>
<code><a href="#topic+envelope">envelope</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(isotopes)
data(chemforms)
pattern&lt;-isopattern(
  isotopes,
  chemforms,
  threshold=0.1,
  plotit=TRUE,
  charge=FALSE,
  emass=0.00054858,
  algo=1
)
check_several(pattern,dmz=0.001,ppm=FALSE)
</code></pre>

<hr>
<h2 id='chemforms'>
Set of exemplary chemical formulas for small molecules.
</h2><span id='topic+chemforms'></span>

<h3>Description</h3>

<p>Vector with character strings of exemplary chemical formulas (pesticides, pharmaceuticals)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(chemforms)</code></pre>


<h3>Format</h3>

<p>Vector with character strings
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(chemforms)
chemforms
</code></pre>

<hr>
<h2 id='envelope'>Isotope pattern envelope calculation</h2><span id='topic+envelope'></span>

<h3>Description</h3>

<p>Convolutes an isotope pattern from <code><a href="#topic+isopattern">isopattern</a></code> with a peak shape function (Gaussian or Cauchy-Lorentz function) 
to its theoretical envelope (profile), at a given measurement resolution. 
The envelope is represented by sticks, i.e. measurement abundances at discrete m/z intervals. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>envelope(pattern, ppm = FALSE, dmz = "get", frac = 1/4, env = "Gaussian", 
resolution = 5e+05, plotit = FALSE, verbose = TRUE)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="envelope_+3A_pattern">pattern</code></td>
<td>
<p>List of isotope pattern(s) as generated by <code><a href="#topic+isopattern">isopattern</a></code>.</p>
</td></tr>
<tr><td><code id="envelope_+3A_ppm">ppm</code></td>
<td>
<p>Should stick discretization be set in ppm (<code>TRUE</code>) or absolute m/z (<code>FALSE</code>)?
Only checked if <code>dmz</code> is not set to <code>"get"</code>; check details section.</p>
</td></tr>
<tr><td><code id="envelope_+3A_dmz">dmz</code></td>
<td>
<p>Stick discretization. Set to <code>"get"</code> to derive discretization from argument <code>resolution</code> or set a numerical value
in combination with <code>ppm</code> to use as ppm or absolute m/z. Check details section.</p>
</td></tr>
<tr><td><code id="envelope_+3A_frac">frac</code></td>
<td>
<p>Used if <code>dmz</code> is set to <code>"get"</code>. Check details section.</p>
</td></tr>
<tr><td><code id="envelope_+3A_env">env</code></td>
<td>
<p>Peak shape function; either <code>"Gaussian"</code> or <code>"CauchyLorentz"</code>.</p>
</td></tr>
<tr><td><code id="envelope_+3A_resolution">resolution</code></td>
<td>
<p>Single resolution value or vector of resolutions with length equal to the number of entries in list <code>pattern</code>. 
Check resolution definition in the details section.</p>
</td></tr>
<tr><td><code id="envelope_+3A_plotit">plotit</code></td>
<td>
<p>Should results be plotted, <code>TRUE/FALSE</code> ?</p>
</td></tr>
<tr><td><code id="envelope_+3A_verbose">verbose</code></td>
<td>
<p>Verbose, <code>TRUE/FALSE</code>?</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The theoretical profiles are represented by sticks, i.e. abundances at discrete m/z intervals.
While the profile width is set by argument <code>resolution</code>, the mass discretization between adjacent sticks can be set in two different ways. 
</p>
<p>On the one hand, discretization can be given as a numerical value, either in ppm or absolute m/z. 
To do so, set argument <code>dmz</code> to a numerical value and specify with argument <code>ppm</code> if this value is stating the discretization in ppm or 
as absolute m/z.
</p>
<p>On the other hand, discretization can be derived from the measurement resolution (R) set by
argument <code>resolution</code>. To do so, set <code>dmz</code> to <code>"get"</code>, which leads to argument <code>ppm</code> being ignored. 
In this case, the stick discretization is retrieved from (dm/z)*<code>frac</code>, with (dm/z) = (m/z)/R = peak width at half maximum.</p>


<h3>Value</h3>

<p>List with length equal to length of list <code>pattern</code>, with equal names of list entries.
Each entry in that list contains the sticks of the envelope in two columns:
</p>
<table>
<tr><td><code>m/z</code></td>
<td>
<p>Stick m/z</p>
</td></tr>
<tr><td><code>abundance</code></td>
<td>
<p>Stick abundance</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The resolution R is defined as R=(m/z)/(dm/z), with dm/z = peak width at half maximum, cp. <code><a href="#topic+resolution_list">resolution_list</a></code>.</p>


<h3>Author(s)</h3>

<p>Martin Loos, Christian Gerber</p>


<h3>References</h3>

<p>Li, L., Kresh, J., Karabacak, N., Cobb, J., Agar, J. and Hong, P. (2008). 
A Hierarchical Algorithm for Calculating the Isotopic Fine Structures of Molecules.
Journal of the American Society for Mass Spectrometry, 19, 1867&ndash;1874.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+isopattern">isopattern</a></code>
<code><a href="#topic+getR">getR</a></code>
<code><a href="#topic+vdetect">vdetect</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
############################
# batch of chemforms #######
data(isotopes)
data(chemforms)
chemforms&lt;-chemforms[1:5]

pattern&lt;-isopattern(
  isotopes,
  chemforms,
  threshold=0.1,
  plotit=TRUE,
  charge=FALSE,
  emass=0.00054858,
  algo=2
)

profiles&lt;-envelope(
    pattern,
    ppm=FALSE,
    dmz=0.0001,   
    frac=1/4,
    env="Gaussian",
    resolution=1E6,
    plotit=TRUE
)
############################

</code></pre>

<hr>
<h2 id='getR'>Interpolation of MS measurement resolution</h2><span id='topic+getR'></span>

<h3>Description</h3>

<p>Given a set of MS measurement resolutions (R) as a function of measurement mass (m/z), <a href="#topic+getR">getR</a> interpolates R for any given molecular mass(es)
calculated by <code><a href="#topic+check_chemform">check_chemform</a></code> using <code><a href="stats.html#topic+smooth.spline">smooth.spline</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getR(checked, resmass, nknots = 13, spar = 0.1, plotit = TRUE)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getR_+3A_checked">checked</code></td>
<td>
<p>Dataframe produced by <code><a href="#topic+check_chemform">check_chemform</a></code>.</p>
</td></tr>
<tr><td><code id="getR_+3A_resmass">resmass</code></td>
<td>
<p>Dataframe with two columns, resolution and mass; such as the list entries in <code><a href="#topic+resolution_list">resolution_list</a></code>.</p>
</td></tr>
<tr><td><code id="getR_+3A_nknots">nknots</code></td>
<td>
<p>Integer number of knots to use for the smoothing spline. Default = 6. See also <code><a href="stats.html#topic+smooth.spline">smooth.spline</a></code>.</p>
</td></tr>
<tr><td><code id="getR_+3A_spar">spar</code></td>
<td>
<p>Smoothing parameter, (0,1]. See also <code><a href="stats.html#topic+smooth.spline">smooth.spline</a></code>.</p>
</td></tr>
<tr><td><code id="getR_+3A_plotit">plotit</code></td>
<td>
<p>Plot results, <code>TRUE/FALSE</code> ?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Vector with resolutions.</p>


<h3>Note</h3>

<p><code><a href="#topic+check_chemform">check_chemform</a></code> gives molecular masses (m/z) for z=+/-1 only. 
If z&gt;1 or z&lt;-1 is required, molecular mass entries in argument checked have to be divided accordingly to be consistent.
</p>


<h3>Author(s)</h3>

<p>Martin Loos, Christian Gerber
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+smooth.spline">smooth.spline</a></code>
<code><a href="#topic+check_chemform">check_chemform</a></code>
<code><a href="#topic+resolution_list">resolution_list</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(resolution_list)
resmass&lt;-resolution_list[[4]]
data(isotopes)
data(chemforms)
checked&lt;-check_chemform(isotopes,chemforms)
resolution&lt;-getR(checked,resmass,nknots=13,spar=0.1,plotit=TRUE)

# same for z=-2:
checked&lt;-check_chemform(isotopes,chemforms)
checked[,3]&lt;-(checked[,3]/abs(-2))
resolution&lt;-getR(checked,resmass,nknots=13,spar=0.1,plotit=TRUE)
</code></pre>

<hr>
<h2 id='isopattern'>Isotope pattern calculation</h2><span id='topic+isopattern'></span>

<h3>Description</h3>

<p>The function calculates the isotopologues (&quot;isotope fine structure&quot;) of a given chemical formula or a
set of chemical formulas (batch calculation) with fast and memory efficient transition tree algorithms,
which can handle relative pruning thresholds. 
Returns accurate masses, probabilities and isotopic compositions of individual isotopologues. 
The isotopes of elements can be defined by the user.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>isopattern(isotopes, chemforms, threshold = 0.001, charge = FALSE, 
emass = 0.00054857990924, plotit = FALSE, algo=1, rel_to = 0, verbose = TRUE,
return_iso_calc_amount = FALSE)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="isopattern_+3A_isotopes">isotopes</code></td>
<td>
<p>Dataframe listing all relevant isotopes, such as <code><a href="#topic+isotopes">isotopes</a></code>.</p>
</td></tr>
<tr><td><code id="isopattern_+3A_chemforms">chemforms</code></td>
<td>
<p>Vector with character strings of chemical formulas, such as data set <code><a href="#topic+chemforms">chemforms</a></code> 
or the second column in the value of <code><a href="#topic+check_chemform">check_chemform</a></code>.</p>
</td></tr>
<tr><td><code id="isopattern_+3A_threshold">threshold</code></td>
<td>
<p>Probability below which isotope peaks can be omitted, as specified by argument <code>rel_to</code>. 
Set to <code>0</code> if all peaks shall be calculated.</p>
</td></tr>
<tr><td><code id="isopattern_+3A_charge">charge</code></td>
<td>
<p>z in m/z. Either a single integer or a vector of integers with length equal to that of argument <code>chemforms</code>. 
Set to <code>FALSE</code> for omitting any charge calculations.</p>
</td></tr>
<tr><td><code id="isopattern_+3A_emass">emass</code></td>
<td>
<p>Electrone mass; only relevant if <code>charge</code> is not set to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="isopattern_+3A_plotit">plotit</code></td>
<td>
<p>Should results be plotted, <code>TRUE/FALSE</code>?</p>
</td></tr>
<tr><td><code id="isopattern_+3A_algo">algo</code></td>
<td>
<p>Which algorithm to use? Type <code>1</code> or <code>2</code>. See details.</p>
</td></tr>
<tr><td><code id="isopattern_+3A_rel_to">rel_to</code></td>
<td>
<p>Probability definition, numeric <code>0,1,2,3 or 4</code>? See details.</p>
</td></tr>
<tr><td><code id="isopattern_+3A_verbose">verbose</code></td>
<td>
<p>Verbose, <code>TRUE/FALSE</code>?</p>
</td></tr>
<tr><td><code id="isopattern_+3A_return_iso_calc_amount">return_iso_calc_amount</code></td>
<td>
<p>Ignore; number of intermediate isotopologues.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Isotope pattern calculation can be done by chosing one of two algorithms, set by argument <code>algo</code>. Both algorithms use
transition tree updates to derive the exact mass and probability of a new isotopologue from existing ones, by steps of single isotope replacements. 
These transition tree approaches are memory-efficient and fast for a wide range of molecular formulas and are able to reproduce the isotope fine structure
of molecules. The latter must often be pruned during calculation, c.p. argument <code>rel_to</code>. 
</p>
<p><code>algo=1</code> grows transition trees within element-wise sub-molecules, whereas <code>algo==2</code> grows them in larger sub-molecules of two elements, if available.
The latter approach can be slightly more efficient for very large or very complex molecules. The sub-isotopologues within sub-molecules are finally combined to
the isotopologuees of the full molecule. In contrast, intermediate counts of sub-isotopologues instead of fine structures are returned for <code>return_iso_calc_amount==TRUE</code>
</p>
<p><code>rel_to</code> offers 5 possibilities of how probabilities are defined and pruned, each affecting the <code>threshold</code> argument differently.
Default option <code>rel_to=0</code> prunes and returns probabilities relative to the most intense isotope peak; 
<code>threshold</code> states a percentage of the intensity of this latter peak.
Similarly, option <code>rel_to=1</code> normalizes relative to the peak consisting of the most abundant isotopes for each element, which
is often the monoisotopic one.
Option <code>rel_to=2</code> prunes and returns absolute probabilities ; <code>threshold</code> is not a percentage but an abolute cutoff.
Options <code>rel_to=3</code> and <code>rel_to=4</code> prune relative to the most intense and &quot;monoisotopic&quot; peak, respectively. 
Although <code>threshold</code> is a percentage, both options return absolut probabilities .
</p>


<h3>Value</h3>

<p>List with length equal to length of vector <code>chemforms</code>; names of entries in list = chemical formula in chemform.
Each entry in that list contains information on individual isotopologues (rows) with columns:
</p>
<table>
<tr><td><code>m/z</code></td>
<td>
<p>First column; m/z of an isotope peak.</p>
</td></tr>
<tr><td><code>abundance</code></td>
<td>
<p>Second column; abundance of an isotope peak. Probabilities  are set relative to the most abundant peak of the isotope pattern.</p>
</td></tr>
<tr><td><code>12C</code>, <code>13C</code>, <code>1H</code>, <code>2H</code>, <code>...</code></td>
<td>
<p>Third to all other columns; atom counts of individual isotopes for an isotope peak.</p>
</td></tr>
</table>


<h3>warning</h3>

<p>Too low values for <code>threshold</code> may lead to unnecessary calculation of low probable isotope peaks - to the extent that not enough memory is available 
for either of the two algorithms.
</p>


<h3>Note</h3>

<p>It is highly recommended to check argument <code>chemforms</code> with <code><a href="#topic+check_chemform">check_chemform</a></code> prior to running 
<code><a href="#topic+isopattern">isopattern</a></code>; argument <code>chemforms</code> must conform to chemical formulas as defined in <code><a href="#topic+check_chemform">check_chemform</a></code>.
Element names must be followed by numbers (atom counts of that element),  i.e. C1H4 is a valid argument whereas CH4 is not.
Otherwise, numbers may only be used in square brackets to denote individual isotopes defined in the element name column of iso_list, such as [14]C or [18]O.
For example, [13]C2C35H67N1O13 is the molecular formula of erythromycin labeled at two C-positions with [13]C;
C37H67N1O13 is the molecular formula of the unlabeled compound.
</p>
<p>For correct adduct isotope pattern calculations, please check <code><a href="#topic+adducts">adducts</a></code>.
</p>


<h3>Author(s)</h3>

<p>Martin Loos, Christian Gerber</p>


<h3>References</h3>

<p>Loos, M., Gerber, C., Corona, F., Hollender, J., Singer, H. (2015).  Accelerated isotope fine structure calculation using 
pruned transition trees, Analytical Chemistry 87(11), 5738-5744.
</p>
<p><a href="https://pubs.acs.org/doi/abs/10.1021/acs.analchem.5b00941">https://pubs.acs.org/doi/abs/10.1021/acs.analchem.5b00941</a>
</p>
<p><a href="https://www.envipat.eawag.ch/index.php">https://www.envipat.eawag.ch/index.php</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+isopattern">isopattern</a></code>
<code><a href="#topic+chemforms">chemforms</a></code>
<code><a href="#topic+check_chemform">check_chemform</a></code>
<code><a href="#topic+getR">getR</a></code>
<code><a href="#topic+envelope">envelope</a></code>
<code><a href="#topic+vdetect">vdetect</a></code>
<code><a href="#topic+check_several">check_several</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
############################
# batch of chemforms #######
data(isotopes)
data(chemforms)
pattern&lt;-isopattern(
  isotopes,
  chemforms,
  threshold=0.1,
  plotit=TRUE,
  charge=FALSE,
  emass=0.00054858,
  algo=1
)
############################
# Single chemical formula ##
data(isotopes) 
pattern&lt;-isopattern(
  isotopes,
  "C100H200S2Cl5",
  threshold=0.1,
  plotit=TRUE,
  charge=FALSE,
  emass=0.00054858,
  algo=1
)
############################


</code></pre>

<hr>
<h2 id='isotopes'>
Stable isotopes
</h2><span id='topic+isotopes'></span>

<h3>Description</h3>

<p>Dataframe with stable isotopes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(isotopes)</code></pre>


<h3>Format</h3>

<p>A data frame with 302 observations on the following 4 variables.
</p>

<dl>
<dt><code>element</code></dt><dd><p>Chemical element</p>
</dd> 
<dt><code>isotope</code></dt><dd><p>Stable isotopes of an element</p>
</dd>
<dt><code>mass</code></dt><dd><p>Relative atomic mass</p>
</dd>
<dt><code>abundance</code></dt><dd><p>Isotopic composition of an element</p>
</dd>
<dt><code>ratioC</code></dt><dd><p>Maximum number of atoms of an element for one C-atom in a molecule, based on 99.99 % of case molecules.</p>
</dd>
</dl>



<h3>Details</h3>

<p>The <code>ratioC</code>-value stems from a database survey conducted by Kind&amp;Fiehn (2007); to disable, set value to 0.
The list serves as input into several package nontarget-functions. The first column of the data frame also 
contains names of specific isotopes used for labeled compounds. 
</p>


<h3>Source</h3>

<p><a href="https://physics.nist.gov/cgi-bin/Compositions/stand_alone.pl">https://physics.nist.gov/cgi-bin/Compositions/stand_alone.pl</a>
</p>


<h3>References</h3>

<p>Kind, T. and Fiehn, O., 2007. Seven golden rules for heuristic filtering  of molecular formulas obtained by 
accurate mass spectrometry. BMC Bioinformatics, 8:105.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(isotopes)
</code></pre>

<hr>
<h2 id='isowrap'>
Combined (batch) calculation of isotope pattern, envelope and centroids/intensoids/valleys on
interpolated resolutions.
</h2><span id='topic+isowrap'></span>

<h3>Description</h3>

<p>Wrapper combining the functions <code><a href="#topic+getR">getR</a></code>, <code><a href="#topic+isopattern">isopattern</a></code>, <code><a href="#topic+envelope">envelope</a></code> and
<code><a href="#topic+vdetect">vdetect</a></code>.
</p>
<p>Uses chemical formulas from <code><a href="#topic+check_chemform">check_chemform</a></code> as argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>isowrap(isotopes, checked, resmass, resolution = FALSE, nknots = 6, 
spar = 0.2, threshold = 0.1, charge = 1, emass = 0.00054858, algo=2, 
ppm = FALSE, dmz = "get", frac = 1/4, env = "Gaussian", 
detect = "centroid", plotit = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="isowrap_+3A_isotopes">isotopes</code></td>
<td>
<p>Dataframe listing all relevant isotopes, such as <code><a href="#topic+isotopes">isotopes</a></code>.</p>
</td></tr>
<tr><td><code id="isowrap_+3A_checked">checked</code></td>
<td>
<p>Output dataframe from <code><a href="#topic+check_chemform">check_chemform</a></code> with correct chemical formulas.</p>
</td></tr>
<tr><td><code id="isowrap_+3A_resmass">resmass</code></td>
<td>
<p>For resolution interpolation: dataframe with two columns, resolution and mass; see <code><a href="#topic+getR">getR</a></code>. 
Otherwise, set to <code>FALSE</code> and use argument <code>resolution</code> to utilize a single resolution.</p>
</td></tr> 
<tr><td><code id="isowrap_+3A_resolution">resolution</code></td>
<td>
<p>Single resolution value. Only used if argument <code>resmass</code> is set to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="isowrap_+3A_nknots">nknots</code></td>
<td>
<p>Number of knots, see <code><a href="#topic+getR">getR</a></code>. Ignored if argument <code>resmass</code> set to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="isowrap_+3A_spar">spar</code></td>
<td>
<p>Smoothing parameter, see <code><a href="#topic+getR">getR</a></code>. Ignored if argument <code>resmass</code> set to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="isowrap_+3A_threshold">threshold</code></td>
<td>
<p>Abundance below which isotope peaks are omitted, see <code><a href="#topic+isopattern">isopattern</a></code>.</p>
</td></tr>
<tr><td><code id="isowrap_+3A_charge">charge</code></td>
<td>
<p>z in m/z, see <code><a href="#topic+isopattern">isopattern</a></code>.</p>
</td></tr>
<tr><td><code id="isowrap_+3A_emass">emass</code></td>
<td>
<p>Electrone mass. Only relevant if <code>charge</code> is not set to <code>FALSE</code>, see <code><a href="#topic+isopattern">isopattern</a></code>.</p>
</td></tr>
<tr><td><code id="isowrap_+3A_algo">algo</code></td>
<td>
<p>Which algorithm to use? Type <code>1</code> or <code>2</code>. See details section in <code><a href="#topic+isopattern">isopattern</a></code>.</p>
</td></tr>
<tr><td><code id="isowrap_+3A_ppm">ppm</code></td>
<td>
<p>Set stick discretization, see details section of <code><a href="#topic+envelope">envelope</a></code>.</p>
</td></tr>
<tr><td><code id="isowrap_+3A_dmz">dmz</code></td>
<td>
<p>Set stick discretization, see details section of <code><a href="#topic+envelope">envelope</a></code>.</p>
</td></tr>
<tr><td><code id="isowrap_+3A_frac">frac</code></td>
<td>
<p>Set stick discretization, see details section of <code><a href="#topic+envelope">envelope</a></code>.</p>
</td></tr>
<tr><td><code id="isowrap_+3A_env">env</code></td>
<td>
<p>Peak shape function, see <code><a href="#topic+envelope">envelope</a></code>.</p>
</td></tr>
<tr><td><code id="isowrap_+3A_detect">detect</code></td>
<td>
<p>Return either <code>"centroid"</code>, <code>"intensoid"</code> or <code>"valley"</code>. See <code><a href="#topic+vdetect">vdetect</a></code>.</p>
</td></tr>
<tr><td><code id="isowrap_+3A_plotit">plotit</code></td>
<td>
<p>Should results be plotted, <code>TRUE/FALSE</code>?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with length equal to length of list <code>profiles</code>, with equal names of list entries.
Each entry in that list contains the centroids, intensoids or valley of the envelope in two columns:
</p>
<table>
<tr><td><code>m/z</code></td>
<td>
<p>m/z</p>
</td></tr>
<tr><td><code>abundance</code></td>
<td>
<p>area(centroid) or abundance (intensoid, valley)</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Martin Loos, Christian Gerber
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vdetect">vdetect</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(isotopes);
data(resolution_list);
data(chemforms);
chemforms&lt;-chemforms[1:10];

checked&lt;-check_chemform(
    isotopes,
    chemforms
  );

resmass&lt;-resolution_list[[1]]

centro&lt;-isowrap(
  isotopes,
  checked,
  resmass=resolution_list[[4]],
  resolution=FALSE,
  nknots=4,
  spar=0.2,
  threshold=0.1,
  charge=1,
  emass=0.00054858,
  algo=2,
  ppm=FALSE,
  dmz="get",   # retrieve dm from R=m/dm
  frac=1/4,
  env="Gaussian",
  detect="centroid",
  plotit=TRUE
)


</code></pre>

<hr>
<h2 id='mergeform'>Combine chemical formulas</h2><span id='topic+mergeform'></span>

<h3>Description</h3>

<p>Combine chemical formulas</p>


<h3>Usage</h3>

<pre><code class='language-R'>mergeform(formula1,formula2)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mergeform_+3A_formula1">formula1</code></td>
<td>
<p>Vector of first chemical formula(s), character string(s)</p>
</td></tr>
<tr><td><code id="mergeform_+3A_formula2">formula2</code></td>
<td>
<p>Second chemical formula, single character string</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Useful for adduct calculations, check <code><a href="#topic+adducts">adducts</a></code>.
Chemical formulas must conform to what is described in <code><a href="#topic+check_chemform">check_chemform</a></code>.
</p>


<h3>Value</h3>

<p>Merged chemical formula(s), character string</p>


<h3>Author(s)</h3>

<p>Martin Loos</p>


<h3>See Also</h3>

<p><code><a href="#topic+adducts">adducts</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>formula1&lt;-c("C10[13]C2H10Cl10")
formula2&lt;-c("C2H5Na1")
mergeform(formula1,formula2)
</code></pre>

<hr>
<h2 id='multiform'>Multiply a chemical formula</h2><span id='topic+multiform'></span>

<h3>Description</h3>

<p>Multiply all atom numbers in a chemical formula by a factor</p>


<h3>Usage</h3>

<pre><code class='language-R'>multiform(formula_in,fact)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="multiform_+3A_formula_in">formula_in</code></td>
<td>
<p>Chemical formula to be multiplied, vector of character strings</p>
</td></tr>
<tr><td><code id="multiform_+3A_fact">fact</code></td>
<td>
<p>Factor to multiply with</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Useful for adduct calculations, check <code><a href="#topic+adducts">adducts</a></code>.
Chemical formulas must conform to what is described in <code><a href="#topic+check_chemform">check_chemform</a></code>.
</p>


<h3>Value</h3>

<p>Multiplied chemical formula, character string</p>


<h3>Author(s)</h3>

<p>Martin Loos</p>


<h3>See Also</h3>

<p><code><a href="#topic+adducts">adducts</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>formula_in &lt;- "C10[13]C2H10Cl10"
multiform(formula_in, 3)
</code></pre>

<hr>
<h2 id='resolution_list'>Resolutions (R) list for mass spectrometers</h2><span id='topic+resolution_list'></span>

<h3>Description</h3>

<p>List of different resolutions R=f(m/z) for various (high-resolution) mass spectrometers.
For each of the instruments, different resolution settings are available. 
Here, R is defined as R=(m/z)/(dm/z), with dm/z = peak width at half maximum.
Serves as input to <a href="#topic+getR">getR</a> to interpolate R from given molecular masses.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(resolution_list)</code></pre>


<h3>Format</h3>

<p>The format is:
List with 29 data sets: Instrument_(massRange_instrumentMode_slicerMode)_Resolution@m/z 
</p>
<p>Elite/R240000@400
</p>
<p>Elite/R120000@400
</p>
<p>Elite/R60000@400
</p>
<p>Elite/R30000@400
</p>
<p>OrbitrapXL,Velos,VelosPro/R120000@400
</p>
<p>OrbitrapXL,Velos,VelosPro/R60000@400
</p>
<p>OrbitrapXL,Velos,VelosPro/R30000@400
</p>
<p>OrbitrapXL,Velos,VelosPro/R15000@400
</p>
<p>OrbitrapXL,Velos,VelosPro/R7500@400
</p>
<p>Q-Exactive,ExactivePlus/280K@200
</p>
<p>Q-Exactive,ExactivePlus/R140000@200
</p>
<p>Q-Exactive,ExactivePlus/R70000@200
</p>
<p>Q-Exactive,ExactivePlus/R35000@200
</p>
<p>Q-Exactive,ExactivePlus/R17500@200
</p>
<p>Exactive/R100000@200
</p>
<p>Exactive/R50000@200
</p>
<p>Exactive/R25000@200
</p>
<p>Exactive/R12500@200
</p>
<p>OTFusion,QExactiveHF/480000@200
</p>
<p>OTFusion,QExactiveHF/240000@200
</p>
<p>OTFusion,QExactiveHF/120000@200
</p>
<p>OTFusion,QExactiveHF/60000@200
</p>
<p>OTFusion,QExactiveHF/30000@200
</p>
<p>OTFusion,QExactiveHF/15000@200
</p>
<p>QTOF_XevoG2-S/R25000@200
</p>
<p>Sciex_TripleTOF5600_R25000@200
</p>
<p>Sciex_TripleTOF6600_R25000@200
</p>
<p>Sciex_QTOFX500R_R25000@200
</p>
<p>Agilent_low_extended_highSens_QTOF6550_R25000@200
</p>


<h3>Source</h3>

<p>Data assembled from individual measurements.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(resolution_list)
resolution_list
</code></pre>

<hr>
<h2 id='subform'>Subtract one chemical formula from another</h2><span id='topic+subform'></span>

<h3>Description</h3>

<p>Subtract one chemical formula from another</p>


<h3>Usage</h3>

<pre><code class='language-R'>subform(formula1,formula2)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="subform_+3A_formula1">formula1</code></td>
<td>
<p>Chemical formula to subtract from</p>
</td></tr>
<tr><td><code id="subform_+3A_formula2">formula2</code></td>
<td>
<p>Chemical formula to subtract</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Useful for adduct calculations, check <code><a href="#topic+adducts">adducts</a></code>.
Chemical formulas must conform to what is described in <code><a href="#topic+check_chemform">check_chemform</a></code>.
Prior check if <code>formula2</code> is contained in <code>formula2</code> at all? See <code><a href="#topic+check_ded">check_ded</a></code>.
</p>


<h3>Value</h3>

<p>A unified and filtered peaklist</p>


<h3>Author(s)</h3>

<p>Martin Loos</p>


<h3>See Also</h3>

<p><code><a href="#topic+adducts">adducts</a></code>,<code><a href="#topic+check_ded">check_ded</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>formula1&lt;-c("C10[13]C2H10Cl10")
formula2&lt;-c("C2H5[13]C1")
subform(formula1,formula2)
</code></pre>

<hr>
<h2 id='vdetect'>Valley detection and centroidization</h2><span id='topic+vdetect'></span>

<h3>Description</h3>

<p>Checks envelopes calculated by <code><a href="#topic+envelope">envelope</a></code> for valleys and extracts centroids or intensoids.</p>


<h3>Usage</h3>

<pre><code class='language-R'>vdetect(profiles,detect="centroid",plotit=TRUE,verbose=TRUE)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vdetect_+3A_profiles">profiles</code></td>
<td>
<p>List of stick profiles as generated by <code><a href="#topic+envelope">envelope</a></code>.</p>
</td></tr>
<tr><td><code id="vdetect_+3A_detect">detect</code></td>
<td>
<p>To return either <code>"centroid"</code>, <code>"intensoid"</code> or <code>"valley"</code>.</p>
</td></tr>
<tr><td><code id="vdetect_+3A_plotit">plotit</code></td>
<td>
<p>Should results be plotted, <code>TRUE/FALSE</code>?</p>
</td></tr>
<tr><td><code id="vdetect_+3A_verbose">verbose</code></td>
<td>
<p>Verbose, <code>TRUE/FALSE</code>?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with length equal to length of list <code>profiles</code>, with equal names of list entries.
Each entry in that list contains the centroids, intensoids or valleys of the envelope in two columns:
</p>
<table>
<tr><td><code>m/z</code></td>
<td>
<p>m/z</p>
</td></tr>
<tr><td><code>abundance</code></td>
<td>
<p>Area (centroid) or abundance (intensoid, valley)</p>
</td></tr>
</table>


<h3>definitions</h3>

<p>Valley: local profile minimum, i.e. any envelope stick flanked by two other sticks of higher abundance. 
</p>
<p>Stick: see <code><a href="#topic+envelope">envelope</a></code>.
</p>
<p>Centroid mass: intensity-weighted sum of the m/z of sticks between two valleys. 
</p>
<p>Centroid intensity: profile area between two valleys (mean of upper and lower sum of stick intensities),
normalized to the maximum centroid area of the envelope.
</p>
<p>Intensoid mass: m/z of the most intense stick between two valleys.
</p>
<p>Intensoid intensity: intensity of the most intensive stick between two valleys, normalized to the most intense intensoid.
</p>


<h3>Note</h3>

<p>Too low stick discretization leads to imprecision in valley, centroid and intensoid characteristics.</p>


<h3>Author(s)</h3>

<p>Martin Loos, Christian Gerber</p>


<h3>See Also</h3>

<p><code><a href="#topic+isopattern">isopattern</a></code>
<code><a href="#topic+envelope">envelope</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>############################
# batch of chemforms #######
data(isotopes)
data(chemforms)
chemforms&lt;-chemforms[1:5]

pattern&lt;-isopattern(
  isotopes,
  chemforms,
  threshold=0.1,
  plotit=TRUE,
  charge=FALSE,
  emass=0.00054858,
  algo=2
)

profiles&lt;-envelope(
    pattern,
    ppm=FALSE,
    dmz=0.0001,   
    frac=1/4,
    env="Gaussian",
    resolution=1E6,
    plotit=TRUE
)

centro&lt;-vdetect(
  profiles,
  detect="centroid",
  plotit=TRUE
)

############################

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
