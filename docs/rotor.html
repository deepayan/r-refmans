<!DOCTYPE html><html lang="en"><head><title>Help for package rotor</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {rotor}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#rotor-package'><p>rotor: Log Rotation and Conditional Backups</p></a></li>
<li><a href='#backup_info'><p>Discover existing backups</p></a></li>
<li><a href='#BackupQueue'><p>An R6 Class for managing backups (abstract base class)</p></a></li>
<li><a href='#BackupQueueDate'><p>An R6 class for managing datestamped backups</p></a></li>
<li><a href='#BackupQueueDateTime'><p>An R6 class for managing timestamped backups</p></a></li>
<li><a href='#BackupQueueIndex'><p>An R6 class for managing indexed backups</p></a></li>
<li><a href='#Cache'><p>An R6 class for managing a persistent file-based cache</p></a></li>
<li><a href='#DirectoryQueue'><p>An R6 class for managing persistent file-based queues (abstract base class)</p></a></li>
<li><a href='#rotate'><p>Rotate or backup files</p></a></li>
<li><a href='#rotate_rds'><p>Serialize R objects to disk (with backup)</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Log Rotation and Conditional Backups</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.7</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Stefan Fleck &lt;stefan.b.fleck@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Conditionally rotate or back-up files based on
    their size or the date of the last backup; inspired by the 'Linux'
    utility 'logrotate'.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://s-fleck.github.io/rotor/">https://s-fleck.github.io/rotor/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/s-fleck/rotor/issues">https://github.com/s-fleck/rotor/issues</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>dint, R6, tools</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, crayon, data.table, digest, rmarkdown, testthat, uuid,
ulid, zip</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.1.9000</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-10-11 12:35:11 UTC; stefan.fleck</td>
</tr>
<tr>
<td>Author:</td>
<td>Stefan Fleck <a href="https://orcid.org/0000-0003-3344-9851"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-10-11 13:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='rotor-package'>rotor: Log Rotation and Conditional Backups</h2><span id='topic+rotor'></span><span id='topic+rotor-package'></span>

<h3>Description</h3>

<p>Conditionally rotate or back-up files based on their size or the date of the last backup; inspired by the 'Linux' utility 'logrotate'.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Stefan Fleck <a href="mailto:stefan.b.fleck@gmail.com">stefan.b.fleck@gmail.com</a> (<a href="https://orcid.org/0000-0003-3344-9851">ORCID</a>)
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://s-fleck.github.io/rotor/">https://s-fleck.github.io/rotor/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/s-fleck/rotor/issues">https://github.com/s-fleck/rotor/issues</a>
</p>
</li></ul>


<hr>
<h2 id='backup_info'>Discover existing backups</h2><span id='topic+backup_info'></span><span id='topic+list_backups'></span><span id='topic+n_backups'></span><span id='topic+newest_backup'></span><span id='topic+oldest_backup'></span>

<h3>Description</h3>

<p>These function return information on the backups of a file (if any exist)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>backup_info(file, dir = dirname(file))

list_backups(file, dir = dirname(file))

n_backups(file, dir = dirname(file))

newest_backup(file, dir = dirname(file))

oldest_backup(file, dir = dirname(file))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="backup_info_+3A_file">file</code></td>
<td>
<p><code>character</code> scalar: Path to a file.</p>
</td></tr>
<tr><td><code id="backup_info_+3A_dir">dir</code></td>
<td>
<p><code>character</code> scalar. The directory in which the backups
of <code>file</code> are stored (defaults to <code>dirname(file)</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>backup_info()</code> returns a <code>data.frame</code> similar to the output of
<code><a href="base.html#topic+file.info">file.info()</a></code>
</p>
<p><code>list_backups()</code> returns the paths to all backups of <code>file</code>
</p>
<p><code>n_backups()</code> returns the number of backups of <code>file</code> as an <code>integer</code>
scalar
</p>
<p><code>newest_backup()</code> and <code>oldest_backup()</code> return the paths to the
newest or oldest backup of <code>file</code> (or an empty <code>character</code> vector if none exist)
</p>


<h3>Intervals</h3>

<p>In <strong>rotor</strong>, an interval is a character string in the form
<code>"&lt;number&gt; &lt;interval&gt;"</code>. The following intervals are possible:
<code>"day(s)"</code>, <code>"week(s)"</code>, <code>"month(s)"</code>, <code>"quarter(s)"</code>, <code>"year(s)"</code>.
The plural <code>"s"</code> is optional (so <code>"2 weeks"</code> and <code>"2 week"</code> are equivalent).
Please be aware that weeks are
<a href="https://en.wikipedia.org/wiki/ISO_week_date">ISOweeks</a>
and start on Monday (not Sunday as in some countries).
</p>
<p>Interval strings can be used as arguments when backing up or rotating files,
or for pruning backup queues (i.e. limiting the number of backups of a
single) file.
</p>
<p>When rotating/backing up <code>"1 months"</code> means &quot;make a new backup if the last
backup is from the preceding month&quot;. E.g if the last backup of <code>myfile</code>
is from <code>2019-02-01</code> then <code>backup_time(myfile, age = "1 month")</code> will only
create a backup if the current date is at least <code>2019-03-01</code>.
</p>
<p>When pruning/limiting backup queues, <code>"1 year"</code> means &quot;keep at least most
one year worth of backups&quot;. So if you call
<code>backup_time(myfile, max_backups = "1 year")</code> on <code>2019-03-01</code>, it will create
a backup and then remove all backups of <code>myfile</code> before <code>2019-01-01</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rotate">rotate()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># setup example files
tf &lt;- tempfile("test", fileext = ".rds")
saveRDS(cars, tf)
backup(tf)
backup(tf)

backup_info(tf)
list_backups(tf)
n_backups(tf)
newest_backup(tf)
oldest_backup(tf)

# cleanup
prune_backups(tf, 0)
n_backups(tf)
file.remove(tf)
</code></pre>

<hr>
<h2 id='BackupQueue'>An R6 Class for managing backups (abstract base class)</h2><span id='topic+BackupQueue'></span>

<h3>Description</h3>

<p><code>BackupQueue</code>is an abstract class not intended for direct usage, please refer to
<a href="#topic+BackupQueueIndex">BackupQueueIndex</a>, <a href="#topic+BackupQueueDateTime">BackupQueueDateTime</a>, <a href="#topic+BackupQueueDate">BackupQueueDate</a> instead.
</p>


<h3>Details</h3>

<p>This class is part of the <a href="R6.html#topic+R6Class">R6</a> API of <strong>rotor</strong> which is
intended for developers that want to extend this package. For normal usage,
the simpler functional API is recommended (see <code><a href="#topic+rotate">rotate()</a></code>).
</p>


<h3>Super class</h3>

<p><code><a href="#topic+DirectoryQueue">rotor::DirectoryQueue</a></code> -&gt; <code>BackupQueue</code>
</p>


<h3>Public fields</h3>

<div class="r6-fields">

<dl>
<dt><code>dir</code></dt><dd><p><code>character</code> scalar. Directory in which to place the backups.</p>
</dd>
<dt><code>n</code></dt><dd><p><code>integer</code> scalar. The number of backups that exist for <code>BackupQueue$origin</code></p>
</dd>
</dl>

</div>


<h3>Active bindings</h3>

<div class="r6-active-bindings">

<dl>
<dt><code>dir</code></dt><dd><p><code>character</code> scalar. Directory in which to place the backups.</p>
</dd>
<dt><code>n</code></dt><dd><p><code>integer</code> scalar. The number of backups that exist for <code>BackupQueue$origin</code></p>
</dd>
<dt><code>file</code></dt><dd><p><code>character</code> scalar. The file to backup/rotate.</p>
</dd>
<dt><code>compression</code></dt><dd><p>(Optional) compression to use <code>compression</code> argument of <code><a href="#topic+rotate">rotate()</a></code>.</p>
</dd>
<dt><code>max_backups</code></dt><dd><p>Maximum number/size/age of backups. See <code>max_backups</code>
argument of <code><a href="#topic+rotate">rotate()</a></code></p>
</dd>
<dt><code>has_backups</code></dt><dd><p>Returns <code>TRUE</code> if at least one backup of <code>BackupQueue$origin</code>
exists
All backups of self$origin</p>
</dd>
</dl>

</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-BackupQueue-new"><code>BackupQueue$new()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueue-prune"><code>BackupQueue$prune()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueue-prune_identical"><code>BackupQueue$prune_identical()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueue-print"><code>BackupQueue$print()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueue-push_backup"><code>BackupQueue$push_backup()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueue-set_origin"><code>BackupQueue$set_origin()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueue-set_compression"><code>BackupQueue$set_compression()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueue-set_max_backups"><code>BackupQueue$set_max_backups()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueue-set_file"><code>BackupQueue$set_file()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueue-set_backup_dir"><code>BackupQueue$set_backup_dir()</code></a>
</p>
</li></ul>



<details open><summary>Inherited methods</summary>
<ul>
<li><span class="pkg-link" data-pkg="rotor" data-topic="DirectoryQueue" data-id="push"><a href='../../rotor/html/DirectoryQueue.html#method-DirectoryQueue-push'><code>rotor::DirectoryQueue$push()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="DirectoryQueue" data-id="set_dir"><a href='../../rotor/html/DirectoryQueue.html#method-DirectoryQueue-set_dir'><code>rotor::DirectoryQueue$set_dir()</code></a></span></li>
</ul>
</details>

<hr>
<a id="method-BackupQueue-new"></a>



<h4>Method <code>new()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>BackupQueue$new(
  origin,
  dir = dirname(origin),
  max_backups = Inf,
  compression = FALSE,
  backup_dir = NULL
)</pre></div>


<hr>
<a id="method-BackupQueue-prune"></a>



<h4>Method <code>prune()</code></h4>

<p>Delete all backups except <code>max_backups</code>. See <code><a href="#topic+prune_backups">prune_backups()</a></code>.
</p>


<h5>Usage</h5>

<div class="r"><pre>BackupQueue$prune(max_backups = self$max_backups)</pre></div>


<hr>
<a id="method-BackupQueue-prune_identical"></a>



<h4>Method <code>prune_identical()</code></h4>

<p>Delete all identical backups. Uses <code><a href="tools.html#topic+md5sum">tools::md5sum()</a></code> to
compare the files.
Set the file to be backed up
</p>


<h5>Usage</h5>

<div class="r"><pre>BackupQueue$prune_identical()</pre></div>


<hr>
<a id="method-BackupQueue-print"></a>



<h4>Method <code>print()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>BackupQueue$print()</pre></div>


<hr>
<a id="method-BackupQueue-push_backup"></a>



<h4>Method <code>push_backup()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>BackupQueue$push_backup(...)</pre></div>


<hr>
<a id="method-BackupQueue-set_origin"></a>



<h4>Method <code>set_origin()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>BackupQueue$set_origin(x)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>x</code></dt><dd><p>a <code>character</code> scalar. Path to a file
Set the file to be backed up</p>
</dd>
</dl>

</div>


<hr>
<a id="method-BackupQueue-set_compression"></a>



<h4>Method <code>set_compression()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>BackupQueue$set_compression(x)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>x</code></dt><dd><p>a <code>character</code> scalar. Path to a file</p>
</dd>
</dl>

</div>


<hr>
<a id="method-BackupQueue-set_max_backups"></a>



<h4>Method <code>set_max_backups()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>BackupQueue$set_max_backups(x)</pre></div>


<hr>
<a id="method-BackupQueue-set_file"></a>



<h4>Method <code>set_file()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>BackupQueue$set_file(x)</pre></div>


<hr>
<a id="method-BackupQueue-set_backup_dir"></a>



<h4>Method <code>set_backup_dir()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>BackupQueue$set_backup_dir(x)</pre></div>




<h3>See Also</h3>

<p>Other R6 Classes: 
<code><a href="#topic+BackupQueueDateTime">BackupQueueDateTime</a></code>,
<code><a href="#topic+BackupQueueDate">BackupQueueDate</a></code>,
<code><a href="#topic+BackupQueueIndex">BackupQueueIndex</a></code>,
<code><a href="#topic+Cache">Cache</a></code>,
<code><a href="#topic+DirectoryQueue">DirectoryQueue</a></code>
</p>

<hr>
<h2 id='BackupQueueDate'>An R6 class for managing datestamped backups</h2><span id='topic+BackupQueueDate'></span>

<h3>Description</h3>

<p>A BackupQueue for date-stamped backups, e.g. <code>foo.log</code>, <code style="white-space: pre;">&#8288;foo.2020-07-24.log&#8288;</code>
</p>


<h3>Details</h3>

<p>This class is part of the <a href="R6.html#topic+R6Class">R6</a> API of <strong>rotor</strong> which is
intended for developers that want to extend this package. For normal usage,
the simpler functional API is recommended (see <code><a href="#topic+rotate">rotate()</a></code>).
</p>


<h3>Super classes</h3>

<p><code><a href="#topic+DirectoryQueue">rotor::DirectoryQueue</a></code> -&gt; <code><a href="#topic+BackupQueue">rotor::BackupQueue</a></code> -&gt; <code><a href="#topic+BackupQueueDateTime">rotor::BackupQueueDateTime</a></code> -&gt; <code>BackupQueueDate</code>
</p>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-BackupQueueDate-new"><code>BackupQueueDate$new()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueueDate-set_fmt"><code>BackupQueueDate$set_fmt()</code></a>
</p>
</li></ul>



<details><summary>Inherited methods</summary>
<ul>
<li><span class="pkg-link" data-pkg="rotor" data-topic="DirectoryQueue" data-id="set_dir"><a href='../../rotor/html/DirectoryQueue.html#method-DirectoryQueue-set_dir'><code>rotor::DirectoryQueue$set_dir()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="print"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-print'><code>rotor::BackupQueue$print()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="prune_identical"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-prune_identical'><code>rotor::BackupQueue$prune_identical()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="push_backup"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-push_backup'><code>rotor::BackupQueue$push_backup()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="set_backup_dir"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-set_backup_dir'><code>rotor::BackupQueue$set_backup_dir()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="set_compression"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-set_compression'><code>rotor::BackupQueue$set_compression()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="set_file"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-set_file'><code>rotor::BackupQueue$set_file()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="set_origin"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-set_origin'><code>rotor::BackupQueue$set_origin()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueueDateTime" data-id="prune"><a href='../../rotor/html/BackupQueueDateTime.html#method-BackupQueueDateTime-prune'><code>rotor::BackupQueueDateTime$prune()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueueDateTime" data-id="push"><a href='../../rotor/html/BackupQueueDateTime.html#method-BackupQueueDateTime-push'><code>rotor::BackupQueueDateTime$push()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueueDateTime" data-id="set_cache_backups"><a href='../../rotor/html/BackupQueueDateTime.html#method-BackupQueueDateTime-set_cache_backups'><code>rotor::BackupQueueDateTime$set_cache_backups()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueueDateTime" data-id="set_max_backups"><a href='../../rotor/html/BackupQueueDateTime.html#method-BackupQueueDateTime-set_max_backups'><code>rotor::BackupQueueDateTime$set_max_backups()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueueDateTime" data-id="should_rotate"><a href='../../rotor/html/BackupQueueDateTime.html#method-BackupQueueDateTime-should_rotate'><code>rotor::BackupQueueDateTime$should_rotate()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueueDateTime" data-id="update_backups_cache"><a href='../../rotor/html/BackupQueueDateTime.html#method-BackupQueueDateTime-update_backups_cache'><code>rotor::BackupQueueDateTime$update_backups_cache()</code></a></span></li>
</ul>
</details>

<hr>
<a id="method-BackupQueueDate-new"></a>



<h4>Method <code>new()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>BackupQueueDate$new(
  origin,
  dir = dirname(origin),
  max_backups = Inf,
  compression = FALSE,
  fmt = "%Y-%m-%d",
  cache_backups = FALSE,
  backup_dir = NULL
)</pre></div>


<hr>
<a id="method-BackupQueueDate-set_fmt"></a>



<h4>Method <code>set_fmt()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>BackupQueueDate$set_fmt(x)</pre></div>




<h3>See Also</h3>

<p>Other R6 Classes: 
<code><a href="#topic+BackupQueueDateTime">BackupQueueDateTime</a></code>,
<code><a href="#topic+BackupQueueIndex">BackupQueueIndex</a></code>,
<code><a href="#topic+BackupQueue">BackupQueue</a></code>,
<code><a href="#topic+Cache">Cache</a></code>,
<code><a href="#topic+DirectoryQueue">DirectoryQueue</a></code>
</p>

<hr>
<h2 id='BackupQueueDateTime'>An R6 class for managing timestamped backups</h2><span id='topic+BackupQueueDateTime'></span>

<h3>Description</h3>

<p>A BackupQueue for timestamped backups, e.g. <code>foo.log</code>, <code style="white-space: pre;">&#8288;foo.2020-07-24_10-54-30.log&#8288;</code>
</p>


<h3>Details</h3>

<p>This class is part of the <a href="R6.html#topic+R6Class">R6</a> API of <strong>rotor</strong> which is
intended for developers that want to extend this package. For normal usage,
the simpler functional API is recommended (see <code><a href="#topic+rotate">rotate()</a></code>).
</p>


<h3>Super classes</h3>

<p><code><a href="#topic+DirectoryQueue">rotor::DirectoryQueue</a></code> -&gt; <code><a href="#topic+BackupQueue">rotor::BackupQueue</a></code> -&gt; <code>BackupQueueDateTime</code>
</p>


<h3>Active bindings</h3>

<div class="r6-active-bindings">

<dl>
<dt><code>fmt</code></dt><dd><p>See <code>format</code> argument of <code><a href="#topic+rotate_date">rotate_date()</a></code>
<code>logical</code> scalar. If <code>TRUE</code> (the default) the list of backups is cached,
if <code>FALSE</code> it is read from disk every time this appender triggers.
Caching brings a significant speedup for checking whether to rotate or
not based on the <code>age</code> of the last backup, but is only safe if there are
no other programs/functions interacting with the backups. This is only
advantageous for high frequency file rotation (i.e. several times per
second)
<code>POSIXct</code> scalar. Timestamp of the last rotation (the last backup)</p>
</dd>
</dl>

</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-BackupQueueDateTime-new"><code>BackupQueueDateTime$new()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueueDateTime-push"><code>BackupQueueDateTime$push()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueueDateTime-prune"><code>BackupQueueDateTime$prune()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueueDateTime-should_rotate"><code>BackupQueueDateTime$should_rotate()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueueDateTime-update_backups_cache"><code>BackupQueueDateTime$update_backups_cache()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueueDateTime-set_max_backups"><code>BackupQueueDateTime$set_max_backups()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueueDateTime-set_fmt"><code>BackupQueueDateTime$set_fmt()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueueDateTime-set_cache_backups"><code>BackupQueueDateTime$set_cache_backups()</code></a>
</p>
</li></ul>



<details><summary>Inherited methods</summary>
<ul>
<li><span class="pkg-link" data-pkg="rotor" data-topic="DirectoryQueue" data-id="set_dir"><a href='../../rotor/html/DirectoryQueue.html#method-DirectoryQueue-set_dir'><code>rotor::DirectoryQueue$set_dir()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="print"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-print'><code>rotor::BackupQueue$print()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="prune_identical"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-prune_identical'><code>rotor::BackupQueue$prune_identical()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="push_backup"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-push_backup'><code>rotor::BackupQueue$push_backup()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="set_backup_dir"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-set_backup_dir'><code>rotor::BackupQueue$set_backup_dir()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="set_compression"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-set_compression'><code>rotor::BackupQueue$set_compression()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="set_file"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-set_file'><code>rotor::BackupQueue$set_file()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="set_origin"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-set_origin'><code>rotor::BackupQueue$set_origin()</code></a></span></li>
</ul>
</details>

<hr>
<a id="method-BackupQueueDateTime-new"></a>



<h4>Method <code>new()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>BackupQueueDateTime$new(
  origin,
  dir = dirname(origin),
  max_backups = Inf,
  compression = FALSE,
  fmt = "%Y-%m-%d--%H-%M-%S",
  cache_backups = FALSE,
  backup_dir = NULL
)</pre></div>


<hr>
<a id="method-BackupQueueDateTime-push"></a>



<h4>Method <code>push()</code></h4>

<p>Create a new time-stamped backup (e.g. &lsquo;<span class="file">logfile.2020-07-22_12-26-29.log</span>&rsquo;)
</p>


<h5>Usage</h5>

<div class="r"><pre>BackupQueueDateTime$push(overwrite = FALSE, now = Sys.time())</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>overwrite</code></dt><dd><p><code>logical</code> scalar. Overwrite backups with the same
filename (i.e timestamp)?</p>
</dd>
<dt><code>now</code></dt><dd><p><code>POSIXct</code> scalar. Can be used as an override mechanism for
the current system time if necessary.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-BackupQueueDateTime-prune"></a>



<h4>Method <code>prune()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>BackupQueueDateTime$prune(max_backups = self$max_backups)</pre></div>


<hr>
<a id="method-BackupQueueDateTime-should_rotate"></a>



<h4>Method <code>should_rotate()</code></h4>

<p>Should a file of <code>size</code> and <code>age</code> be rotated? See <code>size</code> and <code>age</code>
arguments of <code><a href="#topic+rotate_date">rotate_date()</a></code>. <code>now</code> overrides the current system time,
'last_rotation&ldquo; overrides the date of the last rotation.
</p>


<h5>Usage</h5>

<div class="r"><pre>BackupQueueDateTime$should_rotate(
  size,
  age,
  now = Sys.time(),
  last_rotation = self$last_rotation %||% file.info(self$origin)$ctime,
  verbose = FALSE
)</pre></div>



<h5>Returns</h5>

<p><code>TRUE</code> or <code>FALSE</code>
</p>


<hr>
<a id="method-BackupQueueDateTime-update_backups_cache"></a>



<h4>Method <code>update_backups_cache()</code></h4>

<p>Force update of the backups cache (only if <code style="white-space: pre;">&#8288;$cache_backups == TRUE&#8288;</code>).
</p>


<h5>Usage</h5>

<div class="r"><pre>BackupQueueDateTime$update_backups_cache()</pre></div>


<hr>
<a id="method-BackupQueueDateTime-set_max_backups"></a>



<h4>Method <code>set_max_backups()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>BackupQueueDateTime$set_max_backups(x)</pre></div>


<hr>
<a id="method-BackupQueueDateTime-set_fmt"></a>



<h4>Method <code>set_fmt()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>BackupQueueDateTime$set_fmt(x)</pre></div>


<hr>
<a id="method-BackupQueueDateTime-set_cache_backups"></a>



<h4>Method <code>set_cache_backups()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>BackupQueueDateTime$set_cache_backups(x)</pre></div>




<h3>See Also</h3>

<p>Other R6 Classes: 
<code><a href="#topic+BackupQueueDate">BackupQueueDate</a></code>,
<code><a href="#topic+BackupQueueIndex">BackupQueueIndex</a></code>,
<code><a href="#topic+BackupQueue">BackupQueue</a></code>,
<code><a href="#topic+Cache">Cache</a></code>,
<code><a href="#topic+DirectoryQueue">DirectoryQueue</a></code>
</p>

<hr>
<h2 id='BackupQueueIndex'>An R6 class for managing indexed backups</h2><span id='topic+BackupQueueIndex'></span>

<h3>Description</h3>

<p>A BackupQueue for indexed backups, e.g. <code>foo.log</code>, <code>foo.1.log</code>, <code>foo.2.log</code>, ...
</p>


<h3>Details</h3>

<p>This class is part of the <a href="R6.html#topic+R6Class">R6</a> API of <strong>rotor</strong> which is
intended for developers that want to extend this package. For normal usage,
the simpler functional API is recommended (see <code><a href="#topic+rotate">rotate()</a></code>).
</p>


<h3>Super classes</h3>

<p><code><a href="#topic+DirectoryQueue">rotor::DirectoryQueue</a></code> -&gt; <code><a href="#topic+BackupQueue">rotor::BackupQueue</a></code> -&gt; <code>BackupQueueIndex</code>
</p>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-BackupQueueIndex-push"><code>BackupQueueIndex$push()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueueIndex-prune"><code>BackupQueueIndex$prune()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueueIndex-prune_identical"><code>BackupQueueIndex$prune_identical()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueueIndex-should_rotate"><code>BackupQueueIndex$should_rotate()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueueIndex-pad_index"><code>BackupQueueIndex$pad_index()</code></a>
</p>
</li>
<li> <p><a href="#method-BackupQueueIndex-increment_index"><code>BackupQueueIndex$increment_index()</code></a>
</p>
</li></ul>



<details><summary>Inherited methods</summary>
<ul>
<li><span class="pkg-link" data-pkg="rotor" data-topic="DirectoryQueue" data-id="set_dir"><a href='../../rotor/html/DirectoryQueue.html#method-DirectoryQueue-set_dir'><code>rotor::DirectoryQueue$set_dir()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="initialize"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-initialize'><code>rotor::BackupQueue$initialize()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="print"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-print'><code>rotor::BackupQueue$print()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="push_backup"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-push_backup'><code>rotor::BackupQueue$push_backup()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="set_backup_dir"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-set_backup_dir'><code>rotor::BackupQueue$set_backup_dir()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="set_compression"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-set_compression'><code>rotor::BackupQueue$set_compression()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="set_file"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-set_file'><code>rotor::BackupQueue$set_file()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="set_max_backups"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-set_max_backups'><code>rotor::BackupQueue$set_max_backups()</code></a></span></li>
<li><span class="pkg-link" data-pkg="rotor" data-topic="BackupQueue" data-id="set_origin"><a href='../../rotor/html/BackupQueue.html#method-BackupQueue-set_origin'><code>rotor::BackupQueue$set_origin()</code></a></span></li>
</ul>
</details>

<hr>
<a id="method-BackupQueueIndex-push"></a>



<h4>Method <code>push()</code></h4>

<p>Create a new index-stamped backup (e.g. &lsquo;<span class="file">logfile.1.log</span>&rsquo;)
</p>


<h5>Usage</h5>

<div class="r"><pre>BackupQueueIndex$push()</pre></div>


<hr>
<a id="method-BackupQueueIndex-prune"></a>



<h4>Method <code>prune()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>BackupQueueIndex$prune(max_backups = self$max_backups)</pre></div>


<hr>
<a id="method-BackupQueueIndex-prune_identical"></a>



<h4>Method <code>prune_identical()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>BackupQueueIndex$prune_identical()</pre></div>


<hr>
<a id="method-BackupQueueIndex-should_rotate"></a>



<h4>Method <code>should_rotate()</code></h4>

<p>Should a file of <code>size</code> be rotated? See <code>size</code> argument of <code><a href="#topic+rotate">rotate()</a></code>
</p>


<h5>Usage</h5>

<div class="r"><pre>BackupQueueIndex$should_rotate(size, verbose = FALSE)</pre></div>



<h5>Returns</h5>

<p><code>TRUE</code> or <code>FALSE</code>
</p>


<hr>
<a id="method-BackupQueueIndex-pad_index"></a>



<h4>Method <code>pad_index()</code></h4>

<p>Pad the indices in the filenames of indexed backups
to the number of digits of the largest index. Usually does not have to
be called manually.
</p>


<h5>Usage</h5>

<div class="r"><pre>BackupQueueIndex$pad_index()</pre></div>


<hr>
<a id="method-BackupQueueIndex-increment_index"></a>



<h4>Method <code>increment_index()</code></h4>

<p>Increment die Indices of all backups by <code>n</code> Usually does
not have to be called manually.
</p>


<h5>Usage</h5>

<div class="r"><pre>BackupQueueIndex$increment_index(n = 1)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>n</code></dt><dd><p><code>integer</code> &gt; 0</p>
</dd>
</dl>

</div>




<h3>See Also</h3>

<p>Other R6 Classes: 
<code><a href="#topic+BackupQueueDateTime">BackupQueueDateTime</a></code>,
<code><a href="#topic+BackupQueueDate">BackupQueueDate</a></code>,
<code><a href="#topic+BackupQueue">BackupQueue</a></code>,
<code><a href="#topic+Cache">Cache</a></code>,
<code><a href="#topic+DirectoryQueue">DirectoryQueue</a></code>
</p>

<hr>
<h2 id='Cache'>An R6 class for managing a persistent file-based cache</h2><span id='topic+Cache'></span>

<h3>Description</h3>

<p><code>Cache</code> provides an <a href="R6.html#topic+R6Class">R6</a> API for managing an on-disk key-value
store for <span class="rlang"><b>R</b></span> objects. The objects are serialized to a single folder as
<a href="base.html#topic+readRDS">.rds</a> files and the key of the object equals the name of the file.
<code>Cache</code> supports automatic removal of old files if the cache folder exceeds a
predetermined number of files, total size, or if the individual files exceed
a certain age.
</p>


<h3>Details</h3>

<p>This class is part of the <a href="R6.html#topic+R6Class">R6</a> API of <strong>rotor</strong> which is
intended for developers that want to extend this package. For normal usage,
the simpler functional API is recommended (see <code><a href="#topic+rotate">rotate()</a></code>).
</p>


<h3>Super class</h3>

<p><code><a href="#topic+DirectoryQueue">rotor::DirectoryQueue</a></code> -&gt; <code>Cache</code>
</p>


<h3>Public fields</h3>

<div class="r6-fields">

<dl>
<dt><code>dir</code></dt><dd><p>a <code>character</code> scalar. path of the directory in which to store the cache files</p>
</dd>
<dt><code>n</code></dt><dd><p><code>integer</code> scalar: number of files in the cache</p>
</dd>
<dt><code>max_files</code></dt><dd><p>see the <code>compress</code> argument of <code><a href="base.html#topic+readRDS">base::saveRDS()</a></code>.
<strong>Note</strong>: this differs from the <code style="white-space: pre;">&#8288;$compress&#8288;</code> argument of <code><a href="#topic+rotate">rotate()</a></code>.</p>
</dd>
<dt><code>max_files</code></dt><dd><p><code>integer</code> scalar: maximum number of files to keep in
the cache</p>
</dd>
</dl>

</div>


<h3>Active bindings</h3>

<div class="r6-active-bindings">

<dl>
<dt><code>dir</code></dt><dd><p>a <code>character</code> scalar. path of the directory in which to store the cache files</p>
</dd>
<dt><code>n</code></dt><dd><p><code>integer</code> scalar: number of files in the cache</p>
</dd>
<dt><code>max_files</code></dt><dd><p>see the <code>compress</code> argument of <code><a href="base.html#topic+readRDS">base::saveRDS()</a></code>.
<strong>Note</strong>: this differs from the <code style="white-space: pre;">&#8288;$compress&#8288;</code> argument of <code><a href="#topic+rotate">rotate()</a></code>.</p>
</dd>
<dt><code>max_files</code></dt><dd><p><code>integer</code> scalar: maximum number of files to keep in
the cache</p>
</dd>
<dt><code>max_size</code></dt><dd><p>scalar <code>integer</code>, <code>character</code> or <code>Inf</code>. Delete
cached files (starting with the oldest) until the total size of the
cache is below <code>max_size</code>. <code>Integers</code> are interpreted as bytes. You
can pass <code>character</code> vectors that contain a file size suffix like <code style="white-space: pre;">&#8288;1k&#8288;</code>
(kilobytes), <code style="white-space: pre;">&#8288;3M&#8288;</code> (megabytes), <code style="white-space: pre;">&#8288;4G&#8288;</code> (gigabytes), <code style="white-space: pre;">&#8288;5T&#8288;</code> (terabytes). Instead
of these short forms you can also be explicit and use the IEC suffixes
<code>KiB</code>, <code>MiB</code>, <code>GiB</code>, <code>TiB</code>. In Both cases <code>1</code> kilobyte is <code>1024</code> bytes, 1
<code>megabyte</code> is <code>1024</code> kilobytes, etc... .</p>
</dd>
<dt><code>max_age</code></dt><dd>
<ul>
<li><p> a <code>Date</code> scalar: Remove all backups before this date
</p>
</li>
<li><p> a <code>character</code> scalar representing a Date in ISO format (e.g. <code>"2019-12-31"</code>)
</p>
</li>
<li><p> a <code>character</code> scalar representing an Interval in the form <code>"&lt;number&gt; &lt;interval&gt;"</code> (see <code><a href="#topic+rotate">rotate()</a></code>)
</p>
</li></ul>
</dd>
<dt><code>hashfun</code></dt><dd><p><code>NULL</code> or a <code>function</code> to generate a unique hash from the
object to be cached (see example). The hash <em>must</em> be a text string
that is a valid filename on the target system. If <code style="white-space: pre;">&#8288;$hashfun&#8288;</code> is <code>NULL</code>,
a storage key must be supplied manually in <code>cache$push()</code>. If a new
object is added with the same key as an existing object, the existing
object will be overwritten without warning.
All cached files</p>
</dd>
</dl>

</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-Cache-new"><code>Cache$new()</code></a>
</p>
</li>
<li> <p><a href="#method-Cache-push"><code>Cache$push()</code></a>
</p>
</li>
<li> <p><a href="#method-Cache-read"><code>Cache$read()</code></a>
</p>
</li>
<li> <p><a href="#method-Cache-remove"><code>Cache$remove()</code></a>
</p>
</li>
<li> <p><a href="#method-Cache-pop"><code>Cache$pop()</code></a>
</p>
</li>
<li> <p><a href="#method-Cache-prune"><code>Cache$prune()</code></a>
</p>
</li>
<li> <p><a href="#method-Cache-purge"><code>Cache$purge()</code></a>
</p>
</li>
<li> <p><a href="#method-Cache-destroy"><code>Cache$destroy()</code></a>
</p>
</li>
<li> <p><a href="#method-Cache-print"><code>Cache$print()</code></a>
</p>
</li>
<li> <p><a href="#method-Cache-set_max_files"><code>Cache$set_max_files()</code></a>
</p>
</li>
<li> <p><a href="#method-Cache-set_max_age"><code>Cache$set_max_age()</code></a>
</p>
</li>
<li> <p><a href="#method-Cache-set_max_size"><code>Cache$set_max_size()</code></a>
</p>
</li>
<li> <p><a href="#method-Cache-set_compression"><code>Cache$set_compression()</code></a>
</p>
</li>
<li> <p><a href="#method-Cache-set_hashfun"><code>Cache$set_hashfun()</code></a>
</p>
</li></ul>



<details open><summary>Inherited methods</summary>
<ul>
<li><span class="pkg-link" data-pkg="rotor" data-topic="DirectoryQueue" data-id="set_dir"><a href='../../rotor/html/DirectoryQueue.html#method-DirectoryQueue-set_dir'><code>rotor::DirectoryQueue$set_dir()</code></a></span></li>
</ul>
</details>

<hr>
<a id="method-Cache-new"></a>



<h4>Method <code>new()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>Cache$new(
  dir = dirname(file),
  max_files = Inf,
  max_size = Inf,
  max_age = Inf,
  compression = TRUE,
  hashfun = digest::digest,
  create_dir = TRUE
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>create_dir</code></dt><dd><p><code>logical</code> scalar. If <code>TRUE</code> <code>dir</code> is created if it
does not exist.</p>
</dd>
</dl>

</div>



<h5>Examples</h5>

<div class="r example copy">
<pre>td &lt;- file.path(tempdir(), "cache-test")

# When using a real hash function as hashfun, identical objects will only
# be added to the cache once
cache_hash &lt;- Cache$new(td, hashfun = digest::digest)
cache_hash$push(iris)
cache_hash$push(iris)
cache_hash$files
cache_hash$purge()

# To override this behaviour use a generator for unique ids, such as uuid
if (requireNamespace("uuid")){
  cache_uid &lt;- Cache$new(td, hashfun = function(x) uuid::UUIDgenerate())
  cache_uid$push(iris)
  cache_uid$push(iris)
  cache_uid$files
  cache_uid$purge()
}

unlink(td, recursive = TRUE)
</pre>
</div>


<hr>
<a id="method-Cache-push"></a>



<h4>Method <code>push()</code></h4>

<p>push a new object to the cache
</p>


<h5>Usage</h5>

<div class="r"><pre>Cache$push(x, key = self$hashfun(x))</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>x</code></dt><dd><p>any <span class="rlang"><b>R</b></span> object</p>
</dd>
<dt><code>key</code></dt><dd><p>a <code>character</code> scalar. Key under which to store the cached
object. Must be a valid filename. Defaults to being generated by
<code style="white-space: pre;">&#8288;$hashfun()&#8288;</code> but may also be supplied manually.</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>a <code>character</code> scalar: the key of the newly added object
</p>


<hr>
<a id="method-Cache-read"></a>



<h4>Method <code>read()</code></h4>

<p>read a cached file
</p>


<h5>Usage</h5>

<div class="r"><pre>Cache$read(key)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>key</code></dt><dd><p><code>character</code> scalar. key of the cached file to read.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cache-remove"></a>



<h4>Method <code>remove()</code></h4>

<p>remove a single file from the cache
</p>


<h5>Usage</h5>

<div class="r"><pre>Cache$remove(key)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>key</code></dt><dd><p><code>character</code> scalar. key of the cached file to remove</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cache-pop"></a>



<h4>Method <code>pop()</code></h4>

<p>Read and remove a single file from the cache
</p>


<h5>Usage</h5>

<div class="r"><pre>Cache$pop(key)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>key</code></dt><dd><p><code>character</code> scalar. key of the cached file to read/remove</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cache-prune"></a>



<h4>Method <code>prune()</code></h4>

<p>Prune the cache
</p>
<p>Delete cached objects that match certain criteria. <code>max_files</code> and
<code>max_size</code> deletes the oldest cached objects first; however, this is
dependent on accuracy of the file modification timestamps on your system.
For example, ext3 only supports second-accuracy, and some windows
version only support timestamps at a resolution of two seconds.
</p>
<p>If two files have the same timestamp, they are deleted in the lexical
sort order of their key. This means that by using a function that
generates lexically sortable keys as <code>hashfun</code> (such as
<code><a href="ulid.html#topic+ULIDgenerate">ulid::generate()</a></code>) you can enforce the correct deletion order. There
is no such workaround if you use a real hash function.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cache$prune(
  max_files = self$max_files,
  max_size = self$max_size,
  max_age = self$max_age,
  now = Sys.time()
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>max_files, max_size, max_age</code></dt><dd><p>see section Active Bindings.</p>
</dd>
<dt><code>now</code></dt><dd><p>a <code>POSIXct</code> datetime scalar. The current time (for max_age)</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cache-purge"></a>



<h4>Method <code>purge()</code></h4>

<p>purge the cache (remove all cached files)
</p>


<h5>Usage</h5>

<div class="r"><pre>Cache$purge()</pre></div>


<hr>
<a id="method-Cache-destroy"></a>



<h4>Method <code>destroy()</code></h4>

<p>purge the cache (remove all cached files)
</p>


<h5>Usage</h5>

<div class="r"><pre>Cache$destroy()</pre></div>


<hr>
<a id="method-Cache-print"></a>



<h4>Method <code>print()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>Cache$print()</pre></div>


<hr>
<a id="method-Cache-set_max_files"></a>



<h4>Method <code>set_max_files()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>Cache$set_max_files(x)</pre></div>


<hr>
<a id="method-Cache-set_max_age"></a>



<h4>Method <code>set_max_age()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>Cache$set_max_age(x)</pre></div>


<hr>
<a id="method-Cache-set_max_size"></a>



<h4>Method <code>set_max_size()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>Cache$set_max_size(x)</pre></div>


<hr>
<a id="method-Cache-set_compression"></a>



<h4>Method <code>set_compression()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>Cache$set_compression(x)</pre></div>


<hr>
<a id="method-Cache-set_hashfun"></a>



<h4>Method <code>set_hashfun()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>Cache$set_hashfun(x)</pre></div>




<h3>See Also</h3>

<p>Other R6 Classes: 
<code><a href="#topic+BackupQueueDateTime">BackupQueueDateTime</a></code>,
<code><a href="#topic+BackupQueueDate">BackupQueueDate</a></code>,
<code><a href="#topic+BackupQueueIndex">BackupQueueIndex</a></code>,
<code><a href="#topic+BackupQueue">BackupQueue</a></code>,
<code><a href="#topic+DirectoryQueue">DirectoryQueue</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## ------------------------------------------------
## Method `Cache$new`
## ------------------------------------------------

td &lt;- file.path(tempdir(), "cache-test")

# When using a real hash function as hashfun, identical objects will only
# be added to the cache once
cache_hash &lt;- Cache$new(td, hashfun = digest::digest)
cache_hash$push(iris)
cache_hash$push(iris)
cache_hash$files
cache_hash$purge()

# To override this behaviour use a generator for unique ids, such as uuid
if (requireNamespace("uuid")){
  cache_uid &lt;- Cache$new(td, hashfun = function(x) uuid::UUIDgenerate())
  cache_uid$push(iris)
  cache_uid$push(iris)
  cache_uid$files
  cache_uid$purge()
}

unlink(td, recursive = TRUE)
</code></pre>

<hr>
<h2 id='DirectoryQueue'>An R6 class for managing persistent file-based queues (abstract base class)</h2><span id='topic+DirectoryQueue'></span>

<h3>Description</h3>

<p>Abstract class from which all other classes in <span class="pkg">rotor</span> inherit their
basic fields and methods.
</p>


<h3>Details</h3>

<p>This class is part of the <a href="R6.html#topic+R6Class">R6</a> API of <strong>rotor</strong> which is
intended for developers that want to extend this package. For normal usage,
the simpler functional API is recommended (see <code><a href="#topic+rotate">rotate()</a></code>).
</p>


<h3>Active bindings</h3>

<div class="r6-active-bindings">

<dl>
<dt><code>dir</code></dt><dd><p>a <code>character</code> scalar. path of the directory in which to store
the cache files</p>
</dd>
</dl>

</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-DirectoryQueue-new"><code>DirectoryQueue$new()</code></a>
</p>
</li>
<li> <p><a href="#method-DirectoryQueue-push"><code>DirectoryQueue$push()</code></a>
</p>
</li>
<li> <p><a href="#method-DirectoryQueue-prune"><code>DirectoryQueue$prune()</code></a>
</p>
</li>
<li> <p><a href="#method-DirectoryQueue-set_dir"><code>DirectoryQueue$set_dir()</code></a>
</p>
</li></ul>


<hr>
<a id="method-DirectoryQueue-new"></a>



<h4>Method <code>new()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>DirectoryQueue$new(...)</pre></div>


<hr>
<a id="method-DirectoryQueue-push"></a>



<h4>Method <code>push()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>DirectoryQueue$push(x, ...)</pre></div>


<hr>
<a id="method-DirectoryQueue-prune"></a>



<h4>Method <code>prune()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>DirectoryQueue$prune(x, ...)</pre></div>


<hr>
<a id="method-DirectoryQueue-set_dir"></a>



<h4>Method <code>set_dir()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>DirectoryQueue$set_dir(x, create = TRUE)</pre></div>




<h3>See Also</h3>

<p>Other R6 Classes: 
<code><a href="#topic+BackupQueueDateTime">BackupQueueDateTime</a></code>,
<code><a href="#topic+BackupQueueDate">BackupQueueDate</a></code>,
<code><a href="#topic+BackupQueueIndex">BackupQueueIndex</a></code>,
<code><a href="#topic+BackupQueue">BackupQueue</a></code>,
<code><a href="#topic+Cache">Cache</a></code>
</p>

<hr>
<h2 id='rotate'>Rotate or backup files</h2><span id='topic+rotate'></span><span id='topic+backup'></span><span id='topic+prune_backups'></span><span id='topic+prune_identical_backups'></span><span id='topic+rotate_date'></span><span id='topic+backup_date'></span><span id='topic+rotate_time'></span><span id='topic+backup_time'></span>

<h3>Description</h3>

<p>Functions starting with <code>backup</code> create backups of a <code>file</code>, while functions
starting with <code>rotate</code> do the same but also replace the original <code>file</code>
with an empty one (this is useful for log rotation)
</p>
<p><strong>Note:</strong>: <code>rotate()</code> and co will not work reliable on filenames that contain
dots but have no file extension (e.g. <code>my.holiday.picture.jpg</code> is OK but
<code>my.holiday.picture</code> is not)
</p>
<p><code>prune_backups()</code> physically deletes all backups of a file
based on <code>max_backups</code>
</p>
<p><code>prune_backups()</code> physically deletes all backups of a file
based on <code>max_backups</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rotate(
  file,
  size = 1,
  max_backups = Inf,
  compression = FALSE,
  dir = dirname(file),
  create_file = TRUE,
  dry_run = FALSE,
  verbose = dry_run
)

backup(
  file,
  size = 0,
  max_backups = Inf,
  compression = FALSE,
  dir = dirname(file),
  dry_run = FALSE,
  verbose = dry_run
)

prune_backups(
  file,
  max_backups,
  dir = dirname(file),
  dry_run = FALSE,
  verbose = dry_run
)

prune_identical_backups(
  file,
  dir = dirname(file),
  dry_run = FALSE,
  verbose = dry_run
)

rotate_date(
  file,
  age = 1,
  size = 1,
  max_backups = Inf,
  compression = FALSE,
  format = "%Y-%m-%d",
  dir = dirname(file),
  overwrite = FALSE,
  create_file = TRUE,
  now = Sys.Date(),
  dry_run = FALSE,
  verbose = dry_run
)

backup_date(
  file,
  age = 1,
  size = 1,
  max_backups = Inf,
  compression = FALSE,
  format = "%Y-%m-%d",
  dir = dirname(file),
  overwrite = FALSE,
  now = Sys.Date(),
  dry_run = FALSE,
  verbose = dry_run
)

rotate_time(
  file,
  age = -1,
  size = 1,
  max_backups = Inf,
  compression = FALSE,
  format = "%Y-%m-%d--%H-%M-%S",
  dir = dirname(file),
  overwrite = FALSE,
  create_file = TRUE,
  now = Sys.time(),
  dry_run = FALSE,
  verbose = dry_run
)

backup_time(
  file,
  age = -1,
  size = 1,
  max_backups = Inf,
  compression = FALSE,
  format = "%Y-%m-%d--%H-%M-%S",
  dir = dirname(file),
  overwrite = FALSE,
  now = Sys.time(),
  dry_run = FALSE,
  verbose = dry_run
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rotate_+3A_file">file</code></td>
<td>
<p><code>character</code> scalar: file to backup/rotate</p>
</td></tr>
<tr><td><code id="rotate_+3A_size">size</code></td>
<td>
<p>scalar <code>integer</code>, <code>character</code> or <code>Inf</code>. Backup/rotate only if
<code>file</code> is larger than this size. <code>Integers</code> are interpreted as bytes. You
can pass <code>character</code> vectors that contain a file size suffix like <code style="white-space: pre;">&#8288;1k&#8288;</code>
(kilobytes), <code style="white-space: pre;">&#8288;3M&#8288;</code> (megabytes), <code style="white-space: pre;">&#8288;4G&#8288;</code> (gigabytes), <code style="white-space: pre;">&#8288;5T&#8288;</code> (terabytes). Instead
of these short forms you can also be explicit and use the IEC suffixes
<code>KiB</code>, <code>MiB</code>, <code>GiB</code>, <code>TiB</code>. In Both cases <code>1</code> kilobyte is <code>1024</code> bytes, 1
<code>megabyte</code> is <code>1024</code> kilobytes, etc... .
</p>
<p>(if <code>age</code> <em>and</em> <code>size</code> are provided, both criteria must be <code>TRUE</code> to
trigger rotation)</p>
</td></tr>
<tr><td><code id="rotate_+3A_max_backups">max_backups</code></td>
<td>
<p>maximum number of backups to keep
</p>

<ul>
<li><p> an <code>integer</code> scalar: Maximum number of backups to keep
</p>
</li></ul>

<p>In addition for timestamped backups the following value are supported:
</p>

<ul>
<li><p> a <code>Date</code> scalar: Remove all backups before this date
</p>
</li>
<li><p> a <code>character</code> scalar representing a Date in ISO format (e.g. <code>"2019-12-31"</code>)
</p>
</li>
<li><p> a <code>character</code> scalar representing an Interval in the form <code>"&lt;number&gt; &lt;interval&gt;"</code> (see below for more info)
</p>
</li></ul>
</td></tr>
<tr><td><code id="rotate_+3A_compression">compression</code></td>
<td>
<p>Whether or not backups should be compressed
</p>

<ul>
<li> <p><code>FALSE</code> for uncompressed backups,
</p>
</li>
<li> <p><code>TRUE</code> for zip compression; uses <code><a href="utils.html#topic+zip">zip()</a></code>
</p>
</li>
<li><p> a scalar <code>integer</code> between <code>1</code> and <code>9</code> to specify a compression
level (requires the
<a href="https://CRAN.R-project.org/package=zip">zip</a> package,
see its documentation for details)
</p>
</li>
<li><p> the <code>character</code> scalars <code>"utils::zip()"</code> or <code>"zip::zipr"</code> to force a
specific zip command
</p>
</li></ul>
</td></tr>
<tr><td><code id="rotate_+3A_dir">dir</code></td>
<td>
<p><code>character</code> scalar. The directory in which the backups
of <code>file</code> are stored (defaults to <code>dirname(file)</code>)</p>
</td></tr>
<tr><td><code id="rotate_+3A_create_file">create_file</code></td>
<td>
<p><code>logical</code> scalar. If <code>TRUE</code> create an empty file in
place of <code>file</code> after rotating.</p>
</td></tr>
<tr><td><code id="rotate_+3A_dry_run">dry_run</code></td>
<td>
<p><code>logical</code> scalar. If <code>TRUE</code> no changes are applied to the
file system (no files are created or deleted)</p>
</td></tr>
<tr><td><code id="rotate_+3A_verbose">verbose</code></td>
<td>
<p><code>logical</code> scalar. If <code>TRUE</code> additional informative <code>messages</code>
are printed</p>
</td></tr>
<tr><td><code id="rotate_+3A_age">age</code></td>
<td>
<p>minimum age after which to backup/rotate a file; can be
</p>

<ul>
<li><p> a <code>character</code> scalar representing an Interval in the form
<code>"&lt;number&gt; &lt;interval&gt;"</code> (e.g. <code>"2 months"</code>, see <em>Intervals</em> section below).
</p>
</li>
<li><p> a <code>Date</code> or a <code>character</code> scalar representing a Date for
a fixed point in time after which to backup/rotate. See <code>format</code> for
which Date/Datetime formats are supported by rotor.
</p>
</li></ul>

<p>(if <code>age</code> <em>and</em> <code>size</code> are provided, both criteria must be <code>TRUE</code> to
trigger rotation)</p>
</td></tr>
<tr><td><code id="rotate_+3A_format">format</code></td>
<td>
<p>a scalar <code>character</code> that can be a subset of of valid
<code>strftime()</code> formatting strings. The default setting is
<code>"%Y-%m-%d--%H-%M-%S"</code>.
</p>

<ul>
<li><p> You can use an arbitrary number of dashes anywhere in the format, so
<code>"%Y-%m-%d--%H-%M-%S"</code> and <code>"%Y%m%d%H%M%S"</code> are both legal.
</p>
</li>
<li> <p><code>T</code> and <code style="white-space: pre;">&#8288;_&#8288;</code> can also be used as separators. For example, the following
datetime formats are also possible:
<code style="white-space: pre;">&#8288;%Y-%m-%d_%H-%M-%S&#8288;</code> (Python logging default),
<code style="white-space: pre;">&#8288;%Y%m%dT%H%M%S&#8288;</code> (<a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a>)
</p>
</li>
<li><p> All datetime components except <code style="white-space: pre;">&#8288;%Y&#8288;</code> are optional. If you leave out part
of the timestamp, the first point in time in the period is assumed. For
example (assuming the current year is 2019) <code style="white-space: pre;">&#8288;%Y&#8288;</code> is identical to
<code>2019-01-01--00-00-00</code>.
</p>
</li>
<li><p> The timestamps must be lexically sortable, so <code>"%Y-%m-%d"</code> is legal,
<code>"%m-%d-%Y"</code> and <code style="white-space: pre;">&#8288;%Y-%d&#8288;</code> are not.
</p>
</li></ul>
</td></tr>
<tr><td><code id="rotate_+3A_overwrite">overwrite</code></td>
<td>
<p><code>logical</code> scalar. If <code>TRUE</code> overwrite backups if a backup
of the same name (usually due to timestamp collision) exists.</p>
</td></tr>
<tr><td><code id="rotate_+3A_now">now</code></td>
<td>
<p>The current <code>Date</code> or time (<code>POSIXct</code>) as a scalar. You can pass a
custom value here to to override the real system time. As a convenience you
can also pass in <code>character</code> strings that follow the guidelines outlined
above for <code>format</code>, but please note that these differ from the formats
understood by <code><a href="base.html#topic+as.POSIXct">as.POSIXct()</a></code> or <code><a href="base.html#topic+as.Date">as.Date()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>file</code> as a <code>character</code> scalar (invisibly)
</p>


<h3>Side Effects</h3>

<p><code>backup()</code>, <code>backup_date()</code>, and <code>backup_time()</code> may create files (if the
specified conditions are met). They may also delete backups, based on
<code>max_backup</code>.
</p>
<p><code>rotate()</code>, <code>rotate_date()</code> and <code>rotate_time()</code> do the same, but in
addition delete the input <code>file</code>, or replace it with an empty file if
<code>create_file == TRUE</code> (the default).
</p>
<p><code>prune_backups()</code> may delete files, depending on <code>max_backups</code>.
</p>
<p><code>prune_backups()</code> may delete files, depending on <code>max_backups</code>.
</p>


<h3>Intervals</h3>

<p>In <strong>rotor</strong>, an interval is a character string in the form
<code>"&lt;number&gt; &lt;interval&gt;"</code>. The following intervals are possible:
<code>"day(s)"</code>, <code>"week(s)"</code>, <code>"month(s)"</code>, <code>"quarter(s)"</code>, <code>"year(s)"</code>.
The plural <code>"s"</code> is optional (so <code>"2 weeks"</code> and <code>"2 week"</code> are equivalent).
Please be aware that weeks are
<a href="https://en.wikipedia.org/wiki/ISO_week_date">ISOweeks</a>
and start on Monday (not Sunday as in some countries).
</p>
<p>Interval strings can be used as arguments when backing up or rotating files,
or for pruning backup queues (i.e. limiting the number of backups of a
single) file.
</p>
<p>When rotating/backing up <code>"1 months"</code> means &quot;make a new backup if the last
backup is from the preceding month&quot;. E.g if the last backup of <code>myfile</code>
is from <code>2019-02-01</code> then <code>backup_time(myfile, age = "1 month")</code> will only
create a backup if the current date is at least <code>2019-03-01</code>.
</p>
<p>When pruning/limiting backup queues, <code>"1 year"</code> means &quot;keep at least most
one year worth of backups&quot;. So if you call
<code>backup_time(myfile, max_backups = "1 year")</code> on <code>2019-03-01</code>, it will create
a backup and then remove all backups of <code>myfile</code> before <code>2019-01-01</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+list_backups">list_backups()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># setup example file
tf &lt;- tempfile("test", fileext = ".rds")
saveRDS(cars, tf)

# create two backups of `tf``
backup(tf)
backup(tf)
list_backups(tf)  # find all backups of a file

# If `size` is set, a backup is only created if the target file is at least
# that big. This is more useful for log rotation than for backups.
backup(tf, size = "100 mb")  # no backup becuase `tf` is to small
list_backups(tf)

# If `dry_run` is TRUE, backup() only shows what would happen without
# actually creating or deleting files
backup(tf, size = "0.1kb", dry_run = TRUE)

# rotate() is the same as backup(), but replaces `tf`` with an empty file
rotate(tf)
list_backups(tf)
file.size(tf)
file.size(list_backups(tf))

# prune_backups() can remove old backups
prune_backups(tf, 1)  # keep only one backup
list_backups(tf)

# rotate/backup_date() adds a date instead of an index
# you should not mix index backups and timestamp backups
# so we clean up first
prune_backups(tf, 0)
saveRDS(cars, tf)

# backup_date() adds the date instead of an index to the filename
backup_date(tf)

# `age` sets the minimum age of the last backup before creating a new one.
# the example below creates no new backup since it's less than a week
# since the last.
backup_date(tf, age = "1 week")

# `now` overrides the current date.
backup_date(tf, age = "1 year", now = "2999-12-31")
list_backups(tf)

# backup_time() creates backups with a full timestamp
backup_time(tf)

# It's okay to mix backup_date() and backup_time()
list_backups(tf)

# cleanup
prune_backups(tf, 0)
file.remove(tf)
</code></pre>

<hr>
<h2 id='rotate_rds'>Serialize R objects to disk (with backup)</h2><span id='topic+rotate_rds'></span><span id='topic+rotate_rds_date'></span><span id='topic+rotate_rds_time'></span>

<h3>Description</h3>

<p>The <code style="white-space: pre;">&#8288;rotate_rds*()&#8288;</code> functions are wrappers around <a href="base.html#topic+readRDS">base::saveRDS()</a> that
create a backup of the destination file (if it exists) instead of just
overwriting it.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rotate_rds(
  object,
  file = "",
  ascii = FALSE,
  version = NULL,
  compress = TRUE,
  refhook = NULL,
  ...,
  on_change_only = FALSE
)

rotate_rds_date(
  object,
  file = "",
  ascii = FALSE,
  version = NULL,
  compress = TRUE,
  refhook = NULL,
  ...,
  age = -1L,
  on_change_only = FALSE
)

rotate_rds_time(
  object,
  file = "",
  ascii = FALSE,
  version = NULL,
  compress = TRUE,
  refhook = NULL,
  ...,
  age = -1L,
  on_change_only = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rotate_rds_+3A_object">object</code></td>
<td>
<p><span class="rlang"><b>R</b></span> object to serialize.</p>
</td></tr>
<tr><td><code id="rotate_rds_+3A_file">file</code></td>
<td>
<p>a <a href="base.html#topic+connection">connection</a> or the name of the file where the <span class="rlang"><b>R</b></span> object
is saved to or read from.</p>
</td></tr>
<tr><td><code id="rotate_rds_+3A_ascii">ascii</code></td>
<td>
<p>a logical.  If <code>TRUE</code> or <code>NA</code>, an ASCII
representation is written; otherwise (default), a binary one is used.
See the comments in the help for <code><a href="base.html#topic+save">save</a></code>.</p>
</td></tr>
<tr><td><code id="rotate_rds_+3A_version">version</code></td>
<td>
<p>the workspace format version to use.  <code>NULL</code>
specifies the current default version (3). The only other supported
value is 2, the default from <span class="rlang"><b>R</b></span> 1.4.0 to <span class="rlang"><b>R</b></span> 3.5.0.</p>
</td></tr>
<tr><td><code id="rotate_rds_+3A_compress">compress</code></td>
<td>
<p>a logical specifying whether saving to a named file is
to use <code>"gzip"</code> compression, or one of <code>"gzip"</code>,
<code>"bzip2"</code> or <code>"xz"</code> to indicate the type of compression to
be used.  Ignored if <code>file</code> is a connection.</p>
</td></tr>
<tr><td><code id="rotate_rds_+3A_refhook">refhook</code></td>
<td>
<p>a hook function for handling reference objects.</p>
</td></tr>
<tr><td><code id="rotate_rds_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+rotate">rotate</a></code>, <code><a href="#topic+rotate_date">rotate_date</a></code>, <code><a href="#topic+rotate_time">rotate_time</a></code>
</p>

<dl>
<dt><code>max_backups</code></dt><dd><p>maximum number of backups to keep
</p>

<ul>
<li><p> an <code>integer</code> scalar: Maximum number of backups to keep
</p>
</li></ul>

<p>In addition for timestamped backups the following value are supported:
</p>

<ul>
<li><p> a <code>Date</code> scalar: Remove all backups before this date
</p>
</li>
<li><p> a <code>character</code> scalar representing a Date in ISO format (e.g. <code>"2019-12-31"</code>)
</p>
</li>
<li><p> a <code>character</code> scalar representing an Interval in the form <code>"&lt;number&gt; &lt;interval&gt;"</code> (see below for more info)
</p>
</li></ul>
</dd>
<dt><code>size</code></dt><dd><p>scalar <code>integer</code>, <code>character</code> or <code>Inf</code>. Backup/rotate only if
<code>file</code> is larger than this size. <code>Integers</code> are interpreted as bytes. You
can pass <code>character</code> vectors that contain a file size suffix like <code style="white-space: pre;">&#8288;1k&#8288;</code>
(kilobytes), <code style="white-space: pre;">&#8288;3M&#8288;</code> (megabytes), <code style="white-space: pre;">&#8288;4G&#8288;</code> (gigabytes), <code style="white-space: pre;">&#8288;5T&#8288;</code> (terabytes). Instead
of these short forms you can also be explicit and use the IEC suffixes
<code>KiB</code>, <code>MiB</code>, <code>GiB</code>, <code>TiB</code>. In Both cases <code>1</code> kilobyte is <code>1024</code> bytes, 1
<code>megabyte</code> is <code>1024</code> kilobytes, etc... .
</p>
<p>(if <code>age</code> <em>and</em> <code>size</code> are provided, both criteria must be <code>TRUE</code> to
trigger rotation)</p>
</dd>
<dt><code>dir</code></dt><dd><p><code>character</code> scalar. The directory in which the backups
of <code>file</code> are stored (defaults to <code>dirname(file)</code>)</p>
</dd>
<dt><code>compression</code></dt><dd><p>Whether or not backups should be compressed
</p>

<ul>
<li> <p><code>FALSE</code> for uncompressed backups,
</p>
</li>
<li> <p><code>TRUE</code> for zip compression; uses <code><a href="utils.html#topic+zip">zip()</a></code>
</p>
</li>
<li><p> a scalar <code>integer</code> between <code>1</code> and <code>9</code> to specify a compression
level (requires the
<a href="https://CRAN.R-project.org/package=zip">zip</a> package,
see its documentation for details)
</p>
</li>
<li><p> the <code>character</code> scalars <code>"utils::zip()"</code> or <code>"zip::zipr"</code> to force a
specific zip command
</p>
</li></ul>
</dd>
<dt><code>dry_run</code></dt><dd><p><code>logical</code> scalar. If <code>TRUE</code> no changes are applied to the
file system (no files are created or deleted)</p>
</dd>
<dt><code>verbose</code></dt><dd><p><code>logical</code> scalar. If <code>TRUE</code> additional informative <code>messages</code>
are printed</p>
</dd>
<dt><code>create_file</code></dt><dd><p><code>logical</code> scalar. If <code>TRUE</code> create an empty file in
place of <code>file</code> after rotating.</p>
</dd>
<dt><code>format</code></dt><dd><p>a scalar <code>character</code> that can be a subset of of valid
<code>strftime()</code> formatting strings. The default setting is
<code>"%Y-%m-%d--%H-%M-%S"</code>.
</p>

<ul>
<li><p> You can use an arbitrary number of dashes anywhere in the format, so
<code>"%Y-%m-%d--%H-%M-%S"</code> and <code>"%Y%m%d%H%M%S"</code> are both legal.
</p>
</li>
<li> <p><code>T</code> and <code style="white-space: pre;">&#8288;_&#8288;</code> can also be used as separators. For example, the following
datetime formats are also possible:
<code style="white-space: pre;">&#8288;%Y-%m-%d_%H-%M-%S&#8288;</code> (Python logging default),
<code style="white-space: pre;">&#8288;%Y%m%dT%H%M%S&#8288;</code> (<a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a>)
</p>
</li>
<li><p> All datetime components except <code style="white-space: pre;">&#8288;%Y&#8288;</code> are optional. If you leave out part
of the timestamp, the first point in time in the period is assumed. For
example (assuming the current year is 2019) <code style="white-space: pre;">&#8288;%Y&#8288;</code> is identical to
<code>2019-01-01--00-00-00</code>.
</p>
</li>
<li><p> The timestamps must be lexically sortable, so <code>"%Y-%m-%d"</code> is legal,
<code>"%m-%d-%Y"</code> and <code style="white-space: pre;">&#8288;%Y-%d&#8288;</code> are not.
</p>
</li></ul>
</dd>
<dt><code>now</code></dt><dd><p>The current <code>Date</code> or time (<code>POSIXct</code>) as a scalar. You can pass a
custom value here to to override the real system time. As a convenience you
can also pass in <code>character</code> strings that follow the guidelines outlined
above for <code>format</code>, but please note that these differ from the formats
understood by <code><a href="base.html#topic+as.POSIXct">as.POSIXct()</a></code> or <code><a href="base.html#topic+as.Date">as.Date()</a></code>.</p>
</dd>
<dt><code>overwrite</code></dt><dd><p><code>logical</code> scalar. If <code>TRUE</code> overwrite backups if a backup
of the same name (usually due to timestamp collision) exists.</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="rotate_rds_+3A_on_change_only">on_change_only</code></td>
<td>
<p><code>logical</code> scalaror a <code>list</code>. Rotate only if <code>object</code>
is different from the object saved in <code>file</code>. If a <code>list</code>, arguments
that will be passed on to <code>data.table::all.equal</code> (only when both obects
are <code>data.tables</code>)</p>
</td></tr>
<tr><td><code id="rotate_rds_+3A_age">age</code></td>
<td>
<p>minimum age after which to backup/rotate a file; can be
</p>

<ul>
<li><p> a <code>character</code> scalar representing an Interval in the form
<code>"&lt;number&gt; &lt;interval&gt;"</code> (e.g. <code>"2 months"</code>, see <em>Intervals</em> section below).
</p>
</li>
<li><p> a <code>Date</code> or a <code>character</code> scalar representing a Date for
a fixed point in time after which to backup/rotate. See <code>format</code> for
which Date/Datetime formats are supported by rotor.
</p>
</li></ul>

<p>(if <code>age</code> <em>and</em> <code>size</code> are provided, both criteria must be <code>TRUE</code> to
trigger rotation)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the path to <code>file</code> (invisibly)
</p>


<h3>Note</h3>

<p>The default value for <code>age</code> is different for <code>rotate_rds_date()</code> (<code>-1</code>)
than for <code><a href="#topic+rotate_date">rotate_date()</a></code> (<code>1</code>) to make it a bit safer. This means if you
execute <code>rotate_date()</code> twice on the same file on a given day it will
silently not rotate the file, while <code>rotate_rds_date()</code> will throw an
error.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dest &lt;- tempfile()
rotate_rds(iris, dest)
rotate_rds(iris, dest)
rotate_rds(iris, dest)

list_backups(dest)

# cleanup
unlink(list_backups(dest))
unlink(dest)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
