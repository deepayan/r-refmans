<!DOCTYPE html><html><head><title>Help for package NBDesign</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {NBDesign}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#NBDesign-package'>
<p>Design and Monitoring of Clinical Trials with Negative Binomial Endpoint</p></a></li>
<li><a href='#negint2'><p>A utility functon to calculate the mean exposure under different scenarios</p></a></li>
<li><a href='#ynegbinompower'><p>Two-sample sample size calculation for negative binomial distribution with variable follow-up</p></a></li>
<li><a href='#ynegbinompowersim'><p>Two-sample sample size calculation for negative binomial distribution with variable follow-up</p></a></li>
<li><a href='#ynegbinomsize'><p>Two-sample sample size calculation for negative binomial distribution with variable follow-up</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Version:</td>
<td>2.0.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2020-09-09</td>
</tr>
<tr>
<td>Title:</td>
<td>Design and Monitoring of Clinical Trials with Negative Binomial
Endpoint</td>
</tr>
<tr>
<td>Description:</td>
<td>Calculate various functions needed for design and monitoring clinical trials with negative binomial endpoint
    with variable follow-up. This version has a few changes compared to the previous version 1.0.0, including 
    (1) correct a typo in Type 1 censoring, mtbnull=bnull and (2) restructure the code to account for shape parameter equal to zero, i.e. Poisson scenario. </td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1.2)</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats,PWEALL,MASS</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>5.0.1</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-09-09 12:59:08 UTC; marve</td>
</tr>
<tr>
<td>Author:</td>
<td>Xiaodong Luo [aut, cre],
  Sanofi [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Xiaodong Luo &lt;Xiaodong.Luo@sanofi.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-09-10 06:30:22 UTC</td>
</tr>
</table>
<hr>
<h2 id='NBDesign-package'>
Design and Monitoring of Clinical Trials with Negative Binomial Endpoint
</h2><span id='topic+NBDesign-package'></span><span id='topic+NBDesign'></span>

<h3>Description</h3>

<p>Calculate various functions needed for design and monitoring clinical trials with negative binomial endpoint
    with variable follow-up. This version has a few changes compared to the previous version 1.0.0, including 
    (1) correct a typo in Type 1 censoring, mtbnull=bnull and (2) restructure the code to account for shape parameter equal to zero, i.e. Poisson scenario. 
</p>


<h3>Details</h3>

<p>The DESCRIPTION file:
</p>

<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> NBDesign</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 2.0.0</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2020-09-09</td>
</tr>
<tr>
 <td style="text-align: left;">
Title: </td><td style="text-align: left;"> Design and Monitoring of Clinical Trials with Negative Binomial Endpoint</td>
</tr>
<tr>
 <td style="text-align: left;">
Description: </td><td style="text-align: left;"> Calculate various functions needed for design and monitoring clinical trials with negative binomial endpoint
    with variable follow-up. This version has a few changes compared to the previous version 1.0.0, including 
    (1) correct a typo in Type 1 censoring, mtbnull=bnull and (2) restructure the code to account for shape parameter equal to zero, i.e. Poisson scenario. </td>
</tr>
<tr>
 <td style="text-align: left;">
Authors@R: </td><td style="text-align: left;"> c(
    person(given="Xiaodong", family="Luo", email = "Xiaodong.Luo@sanofi.com", role =c("aut", "cre")),
    person("Sanofi", role = "cph"))</td>
</tr>
<tr>
 <td style="text-align: left;">
Depends: </td><td style="text-align: left;"> R (&gt;= 3.1.2)</td>
</tr>
<tr>
 <td style="text-align: left;">
Imports: </td><td style="text-align: left;"> stats,PWEALL,MASS</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL (&gt;= 2)</td>
</tr>
<tr>
 <td style="text-align: left;">
RoxygenNote: </td><td style="text-align: left;"> 5.0.1</td>
</tr>
<tr>
 <td style="text-align: left;">
LazyData: </td><td style="text-align: left;"> true</td>
</tr>
<tr>
 <td style="text-align: left;">
Author: </td><td style="text-align: left;"> Xiaodong Luo [aut, cre],
  Sanofi [cph]</td>
</tr>
<tr>
 <td style="text-align: left;">
Maintainer: </td><td style="text-align: left;"> Xiaodong Luo &lt;Xiaodong.Luo@sanofi.com&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>


<p>Index of help topics:
</p>
<pre>
NBDesign-package        Design and Monitoring of Clinical Trials with
                        Negative Binomial Endpoint
negint2                 A utility functon to calculate the mean
                        exposure under different scenarios
ynegbinompower          Two-sample sample size calculation for negative
                        binomial distribution with variable follow-up
ynegbinompowersim       Two-sample sample size calculation for negative
                        binomial distribution with variable follow-up
ynegbinomsize           Two-sample sample size calculation for negative
                        binomial distribution with variable follow-up
</pre>


<h3>Author(s)</h3>

<p>NA
</p>
<p>Maintainer: NA
</p>

<hr>
<h2 id='negint2'>A utility functon to calculate the mean exposure under different scenarios</h2><span id='topic+negint2'></span>

<h3>Description</h3>

<p>This will calculate the mean exposure under different scenarios: 
2: fixed follow-up with drop-out, 3: variable follow-up with a maximum (maxfu), 4: variable follow-up with a maximum and drop-out
</p>


<h3>Usage</h3>

<pre><code class='language-R'>negint2(ux=0.5,fixedfu=1,type=2,u=c(0.5,0.5,1),ut=c(0.5,1.0,1.5),
  tfix=ut[length(ut)]+0.5,maxfu=10.0,tchange=c(0,0.5,1),
  ratec=c(0.15,0.15,0.15),eps=1.0e-03)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="negint2_+3A_ux">ux</code></td>
<td>
<p>the parameter a in (a*t)/(1+a*t)</p>
</td></tr>
<tr><td><code id="negint2_+3A_fixedfu">fixedfu</code></td>
<td>
<p>the minimum follow-up time</p>
</td></tr>
<tr><td><code id="negint2_+3A_type">type</code></td>
<td>
<p>follow-up type, type=2: fixed fu with fu time <code>fixedfu</code> but subject to censoring; type=3: depending on entry time, minimum fu is <code>fixedfu</code> and maximum fu is <code>maxfu</code>; type=4: same as 3 but subject to censoring</p>
</td></tr>
<tr><td><code id="negint2_+3A_u">u</code></td>
<td>
<p>recruitment rate</p>
</td></tr>
<tr><td><code id="negint2_+3A_ut">ut</code></td>
<td>
<p>recruitment interval, must have the same length as <code>u</code></p>
</td></tr>
<tr><td><code id="negint2_+3A_tfix">tfix</code></td>
<td>
<p>fixed study duration, often equals to recruitment time plus minimum follow-up</p>
</td></tr>
<tr><td><code id="negint2_+3A_maxfu">maxfu</code></td>
<td>
<p>maximum follow-up time, should not be greater than <code>tfix</code></p>
</td></tr>
<tr><td><code id="negint2_+3A_tchange">tchange</code></td>
<td>
<p>a strictly increasing sequence of time points starting from zero at which the drop-out rate changes. The first element of tchange must be zero. The above rates and <code>tchange</code> must have the same length.</p>
</td></tr>
<tr><td><code id="negint2_+3A_ratec">ratec</code></td>
<td>
<p>piecewise constant drop-out rate</p>
</td></tr>
<tr><td><code id="negint2_+3A_eps">eps</code></td>
<td>
<p>error tolerance for the numerical intergration</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let <code class="reqn">\tau_{min}</code> and <code class="reqn">\tau_{max}</code> correspond to the minimum follow-up time <code>taumin</code> and the maximum follow-up time <code>taumax</code>. Let <code class="reqn">T_f</code>, <code class="reqn">C</code>, <code class="reqn">E</code> and <code class="reqn">R</code> be the follow-up time, the drop-out time, the study entry time and the total recruitment period(<code class="reqn">R</code> is the last element of <code>ut</code>). For type 2 follow-up <code class="reqn">T_f=min(C,\tau_{min})</code>. For type 3 follow-up, <code class="reqn">T_f=min(R+\tau_{min}-E,\tau_{max})</code>. For type 4 follow-up, <code class="reqn">T_f=min(R+\tau_{min}-E,\tau_{max},C)</code>. Let <code class="reqn">f</code> be the density of <code class="reqn">T_f</code>. We calculate
</p>
<p style="text-align: center;"><code class="reqn">\int_0^{\infty} t f(t)dt</code>
</p>

<p>and
</p>
<p style="text-align: center;"><code class="reqn">\int_0^{\infty} \frac{a t}{1+a t} f(t)dt</code>
</p>

<p>where <code class="reqn">a</code> is the <code>ux</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>mt</code></td>
<td>
<p>mean of (a*t)/(1+a*t)</p>
</td></tr>
<tr><td><code>tt</code></td>
<td>
<p>mean of t</p>
</td></tr>
<tr><td><code>vt</code></td>
<td>
<p>variance of t</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>Examples</h3>

<pre><code class='language-R'>##calculating the exposure for type 4 follow-up
exp4=negint2(ux=0.5,fixedfu=1,type=2,u=c(0.5,0.5,1),ut=c(0.5,1.0,1.5),
  tfix=2.0,maxfu=1.0,tchange=c(0,0.5,1),
  ratec=c(0.15,0.15,0.15),eps=1.0e-03)
#mean exposure            
meanexp=exp4$tt
#var exposure
varexp=exp4$vt
c(meanexp,sqrt(varexp))
#mean of (ux*t)/(1+ux*t)
meanuxt=exp4$mt
</code></pre>

<hr>
<h2 id='ynegbinompower'>Two-sample sample size calculation for negative binomial distribution with variable follow-up</h2><span id='topic+ynegbinompower'></span>

<h3>Description</h3>

<p>This will calculate the power for the negative binomial distribution for the 2-sample case under different follow-up scenarios: 1: fixed follow-up, 2: fixed follow-up with drop-out, 3: variable follow-up with a minimum fu and a maximum fu, 4: variable follow-up with a minimum fu and a maximum fu and drop-out.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ynegbinompower(nsize=200,r0=1.0,r1=0.5,shape0=1,shape1=shape0,pi1=0.5,
     alpha=0.05,twosided=1,fixedfu=1,type=1,u=c(0.5,0.5,1),ut=c(0.5,1.0,1.5),
     tfix=ut[length(ut)]+0.5,maxfu=10.0,tchange=c(0,0.5,1),
     ratec1=c(0.15,0.15,0.15),ratec0=ratec1,eps=1.0e-03)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ynegbinompower_+3A_nsize">nsize</code></td>
<td>
<p>total number of subjects in two groups</p>
</td></tr>
<tr><td><code id="ynegbinompower_+3A_r0">r0</code></td>
<td>
<p>event rate for the control</p>
</td></tr>
<tr><td><code id="ynegbinompower_+3A_r1">r1</code></td>
<td>
<p>event rate for the treatment</p>
</td></tr>
<tr><td><code id="ynegbinompower_+3A_shape0">shape0</code></td>
<td>
<p>dispersion parameter for the control</p>
</td></tr>
<tr><td><code id="ynegbinompower_+3A_shape1">shape1</code></td>
<td>
<p>dispersion parameter for the treatment</p>
</td></tr>
<tr><td><code id="ynegbinompower_+3A_pi1">pi1</code></td>
<td>
<p>allocation prob for the treatment</p>
</td></tr>
<tr><td><code id="ynegbinompower_+3A_alpha">alpha</code></td>
<td>
<p>type-1 error</p>
</td></tr>
<tr><td><code id="ynegbinompower_+3A_twosided">twosided</code></td>
<td>
<p>1: two-side, others: one-sided</p>
</td></tr>
<tr><td><code id="ynegbinompower_+3A_fixedfu">fixedfu</code></td>
<td>
<p>fixed follow-up time for each patient</p>
</td></tr>
<tr><td><code id="ynegbinompower_+3A_type">type</code></td>
<td>
<p>follow-up time type, type=1: fixed fu with fu time <code>fixedfu</code>;  type=2: same as 1 but subject to censoring; type=3: depending on entry time, minimum fu is <code>fixedfu</code> and maximum fu is <code>maxfu</code>; type=4: same as 3 but subject to censoring</p>
</td></tr>
<tr><td><code id="ynegbinompower_+3A_u">u</code></td>
<td>
<p>recruitment rate</p>
</td></tr>
<tr><td><code id="ynegbinompower_+3A_ut">ut</code></td>
<td>
<p>recruitment interval, must have the same length as <code>u</code></p>
</td></tr>
<tr><td><code id="ynegbinompower_+3A_tfix">tfix</code></td>
<td>
<p>fixed study duration, often equals to recruitment time plus minimum follow-up</p>
</td></tr>
<tr><td><code id="ynegbinompower_+3A_maxfu">maxfu</code></td>
<td>
<p>maximum follow-up time, should not be greater than <code>tfix</code></p>
</td></tr>
<tr><td><code id="ynegbinompower_+3A_tchange">tchange</code></td>
<td>
<p>a strictly increasing sequence of time points starting from zero at which the drop-out rate changes. The first element of tchange must be zero. The above rates and <code>tchange</code> must have the same length.</p>
</td></tr>
<tr><td><code id="ynegbinompower_+3A_ratec1">ratec1</code></td>
<td>
<p>piecewise constant drop-out rate for the treatment</p>
</td></tr>
<tr><td><code id="ynegbinompower_+3A_ratec0">ratec0</code></td>
<td>
<p>piecewise constant drop-out rate for the control</p>
</td></tr>
<tr><td><code id="ynegbinompower_+3A_eps">eps</code></td>
<td>
<p>error tolerance for the numerical intergration</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let <code class="reqn">\tau_{min}</code> and <code class="reqn">\tau_{max}</code> correspond to the minimum follow-up time <code>fixedfu</code> and the maximum follow-up time <code>maxfu</code>. Let <code class="reqn">T_f</code>, <code class="reqn">C</code>, <code class="reqn">E</code> and <code class="reqn">R</code> be the follow-up time, the drop-out time, the study entry time and the total recruitment period(<code class="reqn">R</code> is the last element of <code>ut</code>). For type 1 follow-up, <code class="reqn">T_f=\tau_{min}</code>. For type 2 follow-up <code class="reqn">T_f=min(C,\tau_{min})</code>. For type 3 follow-up, <code class="reqn">T_f=min(R+\tau_{min}-E,\tau_{max})</code>. For type 4 follow-up, <code class="reqn">T_f=min(R+\tau_{min}-E,\tau_{max},C)</code>. Let <code class="reqn">f</code> be the density of <code class="reqn">T_f</code>. 
Suppose that <code class="reqn">Y_i</code> is the number of event obsevred in follow-up time <code class="reqn">t_i</code> for patient <code class="reqn">i</code> with treatment assignment <code class="reqn">Z_i</code>, <code class="reqn">i=1,\ldots,n</code>. Suppose that <code class="reqn">Y_i</code> follows a negative binomial distribution such that 
</p>
<p style="text-align: center;"><code class="reqn">P(Y_i=y\mid Z_i=j)=\frac{\Gamma(y+1/k_j)}{\Gamma(y+1)\Gamma(1/k_j)}\Bigg(\frac{k_ju_i}{1+k_ju_i}\Bigg)^y\Bigg(\frac{1}{1+k_ju_i}\Bigg)^{1/k_j},</code>
</p>

<p>where 
</p>
<p style="text-align: center;"><code class="reqn">\log(u_i)=\log(t_i)+\beta_0+\beta_1 Z_i.</code>
</p>

<p>Let <code class="reqn">\hat{\beta}_0</code> and <code class="reqn">\hat{\beta}_1</code> be the MLE of <code class="reqn">\beta_0</code> and <code class="reqn">\beta_1</code>. 
The varaince of <code class="reqn">\hat{\beta}_1</code> is 
</p>
<p style="text-align: center;"><code class="reqn">\mbox{var}(\hat{\beta}_1)=1/\tilde{a}_0(r_0)+1/\tilde{a}_1(r_1)</code>
</p>

<p>where 
</p>
<p style="text-align: center;"><code class="reqn">\tilde{a}_j(r)=\sum_{i=1}^n I(Z_i=j)k_jrt_i/(1+k_jrt_i), \hspace{0.5cm}j=0,1,</code>
</p>

<p>and <code class="reqn">k_j, j=0,1</code> are the dispersion parameters for control <code class="reqn">j=0</code> and treatment <code class="reqn">j=1</code>. Note that Zhu and Lakkis (2014) use 
</p>
<p style="text-align: center;"><code class="reqn">a_j(r)=\sum_{i=1}^n I(Z_i=j)k_jrE(t_i)/\{1+k_jrE(t_i)\}, </code>
</p>

<p>to replace <code class="reqn">\tilde{a}_j(r)</code>, <code class="reqn">j=0,1</code>. Using Jensen's inequality, we can show <code class="reqn">a_j(r)\ge \tilde{a}_j(r)</code>, which means 
Zhu and Lakkis's method will underestimate variance of <code class="reqn">\hat{\beta}_1</code>, which leads to either smaller than required sample size or inflated power. For comparison, I provide sample sizes under both <code class="reqn">\tilde{a}_j(r)</code> and <code class="reqn">a_j(r)</code>. 
</p>
<p>Zhu and Lakkis (2014) discuss three types of the variance under the null. The first way is to set <code class="reqn">\tilde{r}_0=\tilde{r}_1=r_0</code>, using event rate from the control group. The second way is to set <code class="reqn">\tilde{r}_0=r_0, \tilde{r}_1=r_1</code>, using true event rates. The third way is to set <code class="reqn">\tilde{r}_0=\tilde{r}_1=\tilde{r}</code>, where <code class="reqn">\tilde{r}=\pi_1 r_1+\pi_0 r_0</code>, using maximum likelihood estimation. 
</p>
<p>Therefore, for each type of follow-up, there are 3 sample sizes calculated (because there are 3 varainces under the null) for with and without approximation of Zhu and Lakkis (2014). 
</p>
<p>Note that PASS14.0 provides 3 ways of null varaince with the default being the MLE. PASS does not allow different dispersion parameters between treatmetn and control. EAST only provides the second way of null varaince but allows for different dispersion parameters. Both of these softwares base on the approximatin method of Zhu and Lakkis (2014), which underestimate the required sample sizes.    
</p>


<h3>Value</h3>

<table>
<tr><td><code>tildeXPWR</code></td>
<td>
<p>powers (in percentage) not based on current approach, i.e. not based on the Zhu and Lakkis's approximation</p>
</td></tr>
<tr><td><code>XPWR</code></td>
<td>
<p>powers (in percentage) based on on the Zhu and Lakkis's approximation</p>
</td></tr>
<tr><td><code>tildemineffsize</code></td>
<td>
<p>minimum detectable effect sizes not based on approximation</p>
</td></tr>
<tr><td><code>mineffsize</code></td>
<td>
<p>minimum detectable effect sizes based on approximation</p>
</td></tr>
<tr><td><code>Exposure</code></td>
<td>
<p>mean exposure under different follow-up types with element 1 for control, element 2 for treatment and element 3 for overall.</p>
</td></tr>
<tr><td><code>SDExp</code></td>
<td>
<p>Sd of the exposure under different follow-up types with element 1 for control, element 2 for treatment and column 3 for overall.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Zhu~H and Lakkis~H. Sample size calculation for comparing two negative binomial rates. Statistics in Medicine 2014, 33: 376-387.</p>


<h3>Examples</h3>

<pre><code class='language-R'>##calculating the sample sizes
abc=ynegbinompower(nsize=200,r0=1.0,r1=0.5,shape0=1,
        pi1=0.5,alpha=0.05,twosided=1,fixedfu=1,
        type=4,u=c(0.5,0.5,1),ut=c(0.5,1.0,1.5),
        tchange=c(0,0.5,1),
        ratec1=c(0.15,0.15,0.15),eps=1.0e-03)
###Zhu and Lakkis's powers (i.e. with approximation) 
abc$XPWR
###Our powers (i.e. without approximation)
abc$tildeXPWR
</code></pre>

<hr>
<h2 id='ynegbinompowersim'>Two-sample sample size calculation for negative binomial distribution with variable follow-up</h2><span id='topic+ynegbinompowersim'></span>

<h3>Description</h3>

<p>This will calculate the power for the negative binomial distribution for the 2-sample case under different follow-up scenarios: 1: fixed follow-up, 2: fixed follow-up with drop-out, 3: variable follow-up with a minimum fu and a maximum fu, 4: variable follow-up with a minimum fu and a maximum fu and drop-out.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ynegbinompowersim(nsize=200,r0=1.0,r1=0.5,shape0=1,shape1=shape0,pi1=0.5,
   alpha=0.05,twosided=1,fixedfu=1,type=1,u=c(0.5,0.5,1),ut=c(0.5,1.0,1.5),
   tfix=ut[length(ut)]+0.5,maxfu=10.0,tchange=c(0,0.5,1),
   ratec1=c(0.15,0.15,0.15),ratec0=ratec1,rn=10000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ynegbinompowersim_+3A_nsize">nsize</code></td>
<td>
<p>total number of subjects in two groups</p>
</td></tr>
<tr><td><code id="ynegbinompowersim_+3A_r0">r0</code></td>
<td>
<p>event rate for the control</p>
</td></tr>
<tr><td><code id="ynegbinompowersim_+3A_r1">r1</code></td>
<td>
<p>event rate for the treatment</p>
</td></tr>
<tr><td><code id="ynegbinompowersim_+3A_shape0">shape0</code></td>
<td>
<p>dispersion parameter for the control</p>
</td></tr>
<tr><td><code id="ynegbinompowersim_+3A_shape1">shape1</code></td>
<td>
<p>dispersion parameter for the treatment</p>
</td></tr>
<tr><td><code id="ynegbinompowersim_+3A_pi1">pi1</code></td>
<td>
<p>allocation prob for the treatment</p>
</td></tr>
<tr><td><code id="ynegbinompowersim_+3A_alpha">alpha</code></td>
<td>
<p>type-1 error</p>
</td></tr>
<tr><td><code id="ynegbinompowersim_+3A_twosided">twosided</code></td>
<td>
<p>1: two-side, others: one-sided</p>
</td></tr>
<tr><td><code id="ynegbinompowersim_+3A_fixedfu">fixedfu</code></td>
<td>
<p>fixed follow-up time for each patient</p>
</td></tr>
<tr><td><code id="ynegbinompowersim_+3A_type">type</code></td>
<td>
<p>follow-up time type, type=1: fixed fu with fu time <code>fixedfu</code>;  type=2: same as 1 but subject to censoring; type=3: depending on entry time, minimum fu is <code>fixedfu</code> and maximum fu is <code>maxfu</code>; type=4: same as 3 but subject to censoring</p>
</td></tr>
<tr><td><code id="ynegbinompowersim_+3A_u">u</code></td>
<td>
<p>recruitment rate</p>
</td></tr>
<tr><td><code id="ynegbinompowersim_+3A_ut">ut</code></td>
<td>
<p>recruitment interval, must have the same length as <code>u</code></p>
</td></tr>
<tr><td><code id="ynegbinompowersim_+3A_tfix">tfix</code></td>
<td>
<p>fixed study duration, often equals to recruitment time plus minimum follow-up</p>
</td></tr>
<tr><td><code id="ynegbinompowersim_+3A_maxfu">maxfu</code></td>
<td>
<p>maximum follow-up time, should not be greater than <code>tfix</code></p>
</td></tr>
<tr><td><code id="ynegbinompowersim_+3A_tchange">tchange</code></td>
<td>
<p>a strictly increasing sequence of time points starting from zero at which the drop-out rate changes. The first element of tchange must be zero. The above rates and <code>tchange</code> must have the same length.</p>
</td></tr>
<tr><td><code id="ynegbinompowersim_+3A_ratec1">ratec1</code></td>
<td>
<p>piecewise constant drop-out rate for the treatment</p>
</td></tr>
<tr><td><code id="ynegbinompowersim_+3A_ratec0">ratec0</code></td>
<td>
<p>piecewise constant drop-out rate for the control</p>
</td></tr>
<tr><td><code id="ynegbinompowersim_+3A_rn">rn</code></td>
<td>
<p>Number of repetitions</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let <code class="reqn">\tau_{min}</code> and <code class="reqn">\tau_{max}</code> correspond to the minimum follow-up time <code>fixedfu</code> and the maximum follow-up time <code>maxfu</code>. Let <code class="reqn">T_f</code>, <code class="reqn">C</code>, <code class="reqn">E</code> and <code class="reqn">R</code> be the follow-up time, the drop-out time, the study entry time and the total recruitment period(<code class="reqn">R</code> is the last element of <code>ut</code>). For type 1 follow-up, <code class="reqn">T_f=\tau_{min}</code>. For type 2 follow-up <code class="reqn">T_f=min(C,\tau_{min})</code>. For type 3 follow-up, <code class="reqn">T_f=min(R+\tau_{min}-E,\tau_{max})</code>. For type 4 follow-up, <code class="reqn">T_f=min(R+\tau_{min}-E,\tau_{max},C)</code>. Let <code class="reqn">f</code> be the density of <code class="reqn">T_f</code>. 
Suppose that <code class="reqn">Y_i</code> is the number of event obsevred in follow-up time <code class="reqn">t_i</code> for patient <code class="reqn">i</code> with treatment assignment <code class="reqn">Z_i</code>, <code class="reqn">i=1,\ldots,n</code>. Suppose that <code class="reqn">Y_i</code> follows a negative binomial distribution such that 
</p>
<p style="text-align: center;"><code class="reqn">P(Y_i=y\mid Z_i=j)=\frac{\Gamma(y+1/k_j)}{\Gamma(y+1)\Gamma(1/k_j)}\Bigg(\frac{k_ju_i}{1+k_ju_i}\Bigg)^y\Bigg(\frac{1}{1+k_ju_i}\Bigg)^{1/k_j},</code>
</p>

<p>where <code class="reqn">k_j, j=0,1</code> are the dispersion parameters for control <code class="reqn">j=0</code> and treatment <code class="reqn">j=1</code> and
</p>
<p style="text-align: center;"><code class="reqn">\log(u_i)=\log(t_i)+\beta_0+\beta_1 Z_i.</code>
</p>

<p>The data will be gnerated according to the above model. Note that the piecewise exponential distribution and the piecewise uniform distribution are genrated using R package PWEALL functions &quot;rpwe&quot; and &quot;rpwu&quot;, respectively. 
</p>
<p>The parameters in the model are estimated by MLE using the R package MASS function &quot;glm.nb&quot;. 
</p>


<h3>Value</h3>

<table>
<tr><td><code>power</code></td>
<td>
<p>simulation power (in percentage)</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>Examples</h3>

<pre><code class='language-R'>##calculating the sample sizes
abc=ynegbinompowersim(nsize=200,r0=1.0,r1=0.5,shape0=1,
        pi1=0.5,alpha=0.05,twosided=1,fixedfu=1,
        type=4,u=c(0.5,0.5,1),ut=c(0.5,1.0,1.5),
        tchange=c(0,0.5,1),
        ratec1=c(0.15,0.15,0.15),rn=10)
###Power
abc$power
</code></pre>

<hr>
<h2 id='ynegbinomsize'>Two-sample sample size calculation for negative binomial distribution with variable follow-up</h2><span id='topic+ynegbinomsize'></span>

<h3>Description</h3>

<p>This will calculate the sample size for the negative binomial distribution for the 2-sample case under different follow-up scenarios: 1: fixed follow-up, 2: fixed follow-up with drop-out, 3: variable follow-up with a minimum fu and a maximum fu, 4: variable follow-up with a minimum fu and a maximum fu and drop-out.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ynegbinomsize(r0=1.0,r1=0.5,shape0=1,shape1=shape0,pi1=0.5,
      alpha=0.05,twosided=1,beta=0.2,fixedfu=1,
      type=1,u=c(0.5,0.5,1),ut=c(0.5,1.0,1.5),tfix=ut[length(ut)]+0.5,maxfu=10.0,
      tchange=c(0,0.5,1),ratec1=c(0.15,0.15,0.15),ratec0=ratec1,eps=1.0e-03)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ynegbinomsize_+3A_r0">r0</code></td>
<td>
<p>event rate for the control</p>
</td></tr>
<tr><td><code id="ynegbinomsize_+3A_r1">r1</code></td>
<td>
<p>event rate for the treatment</p>
</td></tr>
<tr><td><code id="ynegbinomsize_+3A_shape0">shape0</code></td>
<td>
<p>dispersion parameter for the control</p>
</td></tr>
<tr><td><code id="ynegbinomsize_+3A_shape1">shape1</code></td>
<td>
<p>dispersion parameter for the treatment</p>
</td></tr>
<tr><td><code id="ynegbinomsize_+3A_pi1">pi1</code></td>
<td>
<p>allocation prob for the treatment</p>
</td></tr>
<tr><td><code id="ynegbinomsize_+3A_alpha">alpha</code></td>
<td>
<p>type-1 error</p>
</td></tr>
<tr><td><code id="ynegbinomsize_+3A_twosided">twosided</code></td>
<td>
<p>1: two-side, others: one-sided</p>
</td></tr>
<tr><td><code id="ynegbinomsize_+3A_beta">beta</code></td>
<td>
<p>tyep-2 error</p>
</td></tr>
<tr><td><code id="ynegbinomsize_+3A_fixedfu">fixedfu</code></td>
<td>
<p>fixed follow-up time for each patient</p>
</td></tr>
<tr><td><code id="ynegbinomsize_+3A_type">type</code></td>
<td>
<p>follow-up time type, type=1: fixed fu with fu time <code>fixedfu</code>;  type=2: same as 1 but subject to censoring; type=3: depending on entry time, minimum fu is <code>fixedfu</code> and maximum fu is <code>maxfu</code>; type=4: same as 3 but subject to censoring</p>
</td></tr>
<tr><td><code id="ynegbinomsize_+3A_u">u</code></td>
<td>
<p>recruitment rate</p>
</td></tr>
<tr><td><code id="ynegbinomsize_+3A_ut">ut</code></td>
<td>
<p>recruitment interval, must have the same length as <code>u</code></p>
</td></tr>
<tr><td><code id="ynegbinomsize_+3A_tfix">tfix</code></td>
<td>
<p>fixed study duration, often equals to recruitment time plus minimum follow-up <code>fixedfu</code></p>
</td></tr>
<tr><td><code id="ynegbinomsize_+3A_maxfu">maxfu</code></td>
<td>
<p>maximum follow-up time, should not be greater than <code>tfix</code></p>
</td></tr>
<tr><td><code id="ynegbinomsize_+3A_tchange">tchange</code></td>
<td>
<p>a strictly increasing sequence of time points starting from zero at which the drop-out rate changes. The first element of tchange must be zero. </p>
</td></tr>
<tr><td><code id="ynegbinomsize_+3A_ratec1">ratec1</code></td>
<td>
<p>piecewise constant drop-out rate for the treatment. The rate and <code>tchange</code> must have the same length.</p>
</td></tr>
<tr><td><code id="ynegbinomsize_+3A_ratec0">ratec0</code></td>
<td>
<p>piecewise constant drop-out rate for the control. The rate and <code>tchange</code> must have the same length.</p>
</td></tr>
<tr><td><code id="ynegbinomsize_+3A_eps">eps</code></td>
<td>
<p>error tolerance for the numerical intergration</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let <code class="reqn">\tau_{min}</code> and <code class="reqn">\tau_{max}</code> correspond to the minimum follow-up time <code>fixedfu</code> and the maximum follow-up time <code>maxfu</code>. Let <code class="reqn">T_f</code>, <code class="reqn">C</code>, <code class="reqn">E</code> and <code class="reqn">R</code> be the follow-up time, the drop-out time, the study entry time and the total recruitment period(<code class="reqn">R</code> is the last element of <code>ut</code>). For type 1 follow-up, <code class="reqn">T_f=\tau_{min}</code>. For type 2 follow-up <code class="reqn">T_f=min(C,\tau_{min})</code>. For type 3 follow-up, <code class="reqn">T_f=min(R+\tau_{min}-E,\tau_{max})</code>. For type 4 follow-up, <code class="reqn">T_f=min(R+\tau_{min}-E,\tau_{max},C)</code>. Let <code class="reqn">f</code> be the density of <code class="reqn">T_f</code>. 
Suppose that <code class="reqn">Y_i</code> is the number of event obsevred in follow-up time <code class="reqn">t_i</code> for patient <code class="reqn">i</code> with treatment assignment <code class="reqn">Z_i</code>, <code class="reqn">i=1,\ldots,n</code>. Suppose that <code class="reqn">Y_i</code> follows a negative binomial distribution such that 
</p>
<p style="text-align: center;"><code class="reqn">P(Y_i=y\mid Z_i=j)=\frac{\Gamma(y+1/k_j)}{\Gamma(y+1)\Gamma(1/k_j)}\Bigg(\frac{k_ju_i}{1+k_ju_i}\Bigg)^y\Bigg(\frac{1}{1+k_ju_i}\Bigg)^{1/k_j},</code>
</p>

<p>where 
</p>
<p style="text-align: center;"><code class="reqn">\log(u_i)=\log(t_i)+\beta_0+\beta_1 Z_i.</code>
</p>

<p>Let <code class="reqn">\hat{\beta}_0</code> and <code class="reqn">\hat{\beta}_1</code> be the MLE of <code class="reqn">\beta_0</code> and <code class="reqn">\beta_1</code>. 
The varaince of <code class="reqn">\hat{\beta}_1</code> is 
</p>
<p style="text-align: center;"><code class="reqn">\mbox{var}(\hat{\beta}_1)=1/\tilde{a}_0(r_0)+1/\tilde{a}_1(r_1)</code>
</p>

<p>where 
</p>
<p style="text-align: center;"><code class="reqn">\tilde{a}_j(r)=\sum_{i=1}^n I(Z_i=j)k_jrt_i/(1+k_jrt_i), \hspace{0.5cm}j=0,1,</code>
</p>

<p>and <code class="reqn">k_j, j=0,1</code> are the dispersion parameters for control <code class="reqn">j=0</code> and treatment <code class="reqn">j=1</code>. Note that Zhu and Lakkis (2014) use 
</p>
<p style="text-align: center;"><code class="reqn">a_j(r)=\sum_{i=1}^n I(Z_i=j)k_jrE(t_i)/\{1+k_jrE(t_i)\}, </code>
</p>

<p>to replace <code class="reqn">\tilde{a}_j(r)</code>, <code class="reqn">j=0,1</code>. Using Jensen's inequality, we can show <code class="reqn">a_j(r)\ge \tilde{a}_j(r)</code>, which means 
Zhu and Lakkis's method will underestimate variance of <code class="reqn">\hat{\beta}_1</code>, which leads to either smaller than required sample size or inflated power. For comparison, I provide sample sizes under both <code class="reqn">\tilde{a}_j(r)</code> and <code class="reqn">a_j(r)</code>. 
</p>
<p>Zhu and Lakkis (2014) discuss three types of the variance under the null. The first way is to set <code class="reqn">\tilde{r}_0=\tilde{r}_1=r_0</code>, using event rate from the control group. The second way is to set <code class="reqn">\tilde{r}_0=r_0, \tilde{r}_1=r_1</code>, using true event rates. The third way is to set <code class="reqn">\tilde{r}_0=\tilde{r}_1=\tilde{r}</code>, where <code class="reqn">\tilde{r}=\pi_1 r_1+\pi_0 r_0</code>, using maximum likelihood estimation. 
</p>
<p>Therefore, for each type of follow-up, there are 3 sample sizes calculated (because there are 3 varainces under the null) for with and without approximation of Zhu and Lakkis (2014). 
</p>
<p>Note that PASS14.0 provides 3 ways of null varaince with the default being the MLE. PASS does not allow different dispersion parameters between treatmetn and control. EAST only provides the second way of null varaince but allows for different dispersion parameters. Both of these softwares base on the approximatin method of Zhu and Lakkis (2014), which underestimate the required sample sizes.    
</p>


<h3>Value</h3>

<table>
<tr><td><code>tildeXN</code></td>
<td>
<p>sample sizes based on current approach, i.e. not based on the Zhu and Lakkis's approximation</p>
</td></tr>
<tr><td><code>XN</code></td>
<td>
<p>sample sizes based on the Zhu and Lakkis's approximation</p>
</td></tr>
<tr><td><code>Exposure</code></td>
<td>
<p>mean exposure under different follow-up types with element 1 for control, element 2 for treatment and element 3 for overall.</p>
</td></tr>
<tr><td><code>SDExp</code></td>
<td>
<p>Sd of the exposure under different follow-up types with element 1 for control, element 2 for treatment and column 3 for overall.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Zhu~H and Lakkis~H. Sample size calculation for comparing two negative binomial rates. Statistics in Medicine 2014, 33: 376-387.</p>


<h3>Examples</h3>

<pre><code class='language-R'>##calculating the sample sizes
abc=ynegbinomsize(r0=1.0,r1=0.5,shape0=1,pi1=0.5,alpha=0.05,twosided=1,
    beta=0.2,fixedfu=1,type=4,u=c(0.5,0.5,1),ut=c(0.5,1.0,1.5),
    tfix=1.5,maxfu=1,tchange=c(0,0.5,1),ratec1=c(0.15,0.15,0.15),
    eps=1.0e-03)
###Zhu and Lakkis's sample sizes (i.e. with approximation) 
abc$XN
###Our sample sizes (i.e. without approximation)
abc$tildeXN
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
