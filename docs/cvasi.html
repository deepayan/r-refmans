<!DOCTYPE html><html lang="en"><head><title>Help for package cvasi</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {cvasi}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#+25+26gt+3B+25'><p>Pipe operator</p></a></li>
<li><a href='#Algae_Simple'><p>Algae model with exponential growth but without additional forcings</p></a></li>
<li><a href='#Algae_TKTD'><p>Algae model with exponential growth, forcings (P, I) and scaled damage</p></a></li>
<li><a href='#Algae_Weber'><p>Algae model with exponential growth and forcings (I, T)</p></a></li>
<li><a href='#Algae-models'><p>Algae models</p></a></li>
<li><a href='#americamysis'><p>A DEB abj scenario of Americamysis bahia</p></a></li>
<li><a href='#batch'><p>Batch simulation of multiple exposure levels</p></a></li>
<li><a href='#cache_controls'><p>Cache control simulations</p></a></li>
<li><a href='#calibrate'><p>Fit model parameters to experimental data</p></a></li>
<li><a href='#CalibrationSet'><p>Calibration set</p></a></li>
<li><a href='#DEB_abj'><p>DEB_abj</p></a></li>
<li><a href='#DEB-models'><p>Dynamic Energy Budget (DEB) models</p></a></li>
<li><a href='#DEBtox'><p>DEBtox model</p></a></li>
<li><a href='#dmagna'><p>A DEBtox scenario of Daphnia magna</p></a></li>
<li><a href='#dose_response'><p>Calculate a dose response curve</p></a></li>
<li><a href='#effect'><p>Effect level</p></a></li>
<li><a href='#epx'><p>Effect profiles (EPx values)</p></a></li>
<li><a href='#epx_mtw'><p>Calculate EPx values for a series of moving time window</p></a></li>
<li><a href='#explore_space'><p>Explore parameter space</p></a></li>
<li><a href='#ExposureSeries'><p>Exposure time-series</p></a></li>
<li><a href='#focusd1'><p>A Lemna_SETAC scenario with variable environment</p></a></li>
<li><a href='#fx'><p>Generic to calculate effects for a particular scenario</p></a></li>
<li><a href='#get_model'><p>Get model name</p></a></li>
<li><a href='#get_tag'><p>Get scenario tag</p></a></li>
<li><a href='#GUTS_RED_IT'><p>GUTS-RED-IT scenario</p></a></li>
<li><a href='#GUTS_RED_SD'><p>GUTS-RED-SD scenario</p></a></li>
<li><a href='#GUTS-RED-models'><p>GUTS-RED models</p></a></li>
<li><a href='#import_morse'><p>Import <code>morse</code> model parameters</p></a></li>
<li><a href='#import_swash'><p>SWASH project exposure profile import</p></a></li>
<li><a href='#import_toxswa'><p>Import <em>TOXSWA</em> exposure series</p></a></li>
<li><a href='#is_DEB'><p>Test if argument is a DEB model</p></a></li>
<li><a href='#is_GUTS'><p>Test if argument is a GUTS model</p></a></li>
<li><a href='#is_Lemna'><p>Test if argument is a Lemna model</p></a></li>
<li><a href='#is_LemnaThreshold'><p>Test if argument is a LemnaThreshold model</p></a></li>
<li><a href='#is_scenario'><p>Test if argument is an effect scenario</p></a></li>
<li><a href='#Lemna_Schmitt'><p>Lemna model (Schmitt et al. 2013)</p></a></li>
<li><a href='#Lemna_SETAC'><p>Lemna model (Klein et al. 2021)</p></a></li>
<li><a href='#Lemna-models'><p>Lemna models</p></a></li>
<li><a href='#lik_profile'><p>Likelihood profiling</p></a></li>
<li><a href='#log_enable'><p>Start and stop logging</p></a></li>
<li><a href='#log_envir'><p>Log R environment properties</p></a></li>
<li><a href='#log_lik'><p>Calculate log likelihood</p></a></li>
<li><a href='#log_msg'><p>Add a log message</p></a></li>
<li><a href='#log_scenarios'><p>Log scenario properties</p></a></li>
<li><a href='#Macrophyte-models'><p>Macrophyte models</p></a></li>
<li><a href='#metsulfuron'><p>Lemna data published by Schmitt (2013)</p></a></li>
<li><a href='#minnow_it'><p>A fitted GUTS-RED-IT scenario of the fathead minnow</p></a></li>
<li><a href='#minnow_sd'><p>A fitted GUTS-RED-SD scenario of the fathead minnow</p></a></li>
<li><a href='#Myrio'><p>Myriophyllum model with exponential growth</p></a></li>
<li><a href='#Myrio_log'><p>Myriophyllum model with logistic growth</p></a></li>
<li><a href='#Myriophyllum-models'><p>Myriophyllum models</p></a></li>
<li><a href='#no_exposure'><p>Zero exposure</p></a></li>
<li><a href='#parameter_set'><p>Set of model parameters</p></a></li>
<li><a href='#pll_debug'><p>Disable parallelization for debugging</p></a></li>
<li><a href='#plot'><p>S3 plotting functions</p></a></li>
<li><a href='#plot_epx'><p>Plot EPx values</p></a></li>
<li><a href='#plot_lik_profile'><p>Plot likelihood profiles or all profiled parameters</p></a></li>
<li><a href='#plot_param_space'><p>Plot likelihood profiles or all profiled parameters</p></a></li>
<li><a href='#plot_ppc'><p>Creates a PPC plot for a single dataset</p></a></li>
<li><a href='#plot_ppc_combi'><p>Create PPC plot for one or more datasets</p></a></li>
<li><a href='#plot_scenario'><p>Creates a prediction plot for one effect scenario</p></a></li>
<li><a href='#plot_sd'><p>Creates plot of model results (uncertainties optional)</p></a></li>
<li><a href='#pull_metadata'><p>Pull metadata from scenarios</p></a></li>
<li><a href='#Rsubcapitata'><p>An algae scenario</p></a></li>
<li><a href='#Scenarios'><p>Effect scenario classes</p></a></li>
<li><a href='#Schmitt2013'><p>A Lemna data set with multiple treatment levels</p></a></li>
<li><a href='#sequence'><p>Sequence of scenarios</p></a></li>
<li><a href='#set_bounds'><p>Set boundaries of model parameters</p></a></li>
<li><a href='#set_endpoints'><p>Set effect endpoints</p></a></li>
<li><a href='#set_exposure'><p>Set exposure time-series</p></a></li>
<li><a href='#set_forcings'><p>Set time-dependent parameters</p></a></li>
<li><a href='#set_init'><p>Set initial state</p></a></li>
<li><a href='#set_mode_of_action'><p>Set mode of action</p></a></li>
<li><a href='#set_noexposure'><p>Set zero exposure</p></a></li>
<li><a href='#set_param'><p>Set model parameters</p></a></li>
<li><a href='#set_tag'><p>Set a tag</p></a></li>
<li><a href='#set_times'><p>Set output times</p></a></li>
<li><a href='#set_transfer'><p>Set transfer events</p></a></li>
<li><a href='#set_window'><p>Set window length</p></a></li>
<li><a href='#simulate'><p>Simulate an effect scenario</p></a></li>
<li><a href='#simulate_batch'><p>Batch simulation using multiple exposure series</p></a></li>
<li><a href='#solver'><p>Calls ODE solver for a particular model</p></a></li>
<li><a href='#survival'><p>Survival rate</p></a></li>
<li><a href='#Transferable'><p>Biomass transfer class</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Calibration, Validation, and Simulation of TKTD Models</td>
</tr>
<tr>
<td>Version:</td>
<td>1.4.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Eases the use of ecotoxicological effect models. Can simulate
    common toxicokinetic-toxicodynamic (TK/TD) models such as 
    General Unified Threshold models of Survival (GUTS) and Lemna. It can
    derive effects and effect profiles (EPx) from scenarios. It supports the
    use of 'tidyr' workflows employing the pipe symbol. Time-consuming
    tasks can be parallelized.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/cvasi-tktd/cvasi">https://github.com/cvasi-tktd/cvasi</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/cvasi-tktd/cvasi/issues">https://github.com/cvasi-tktd/cvasi/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>cli, rlang, stringr, dplyr, tibble, purrr, furrr, tidyr,
magrittr, utils, stats, methods, grid, gridExtra, ggplot2,
GGally, deSolve, lubridate, units, lifecycle</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Collate:</td>
<td>'batch.R' 'cache_controls.R' 'class-CalibrationSet.R'
'class-ExposureSeries.R' 'class-EffectScenario.R' 'calibrate.R'
'class-ParameterSet.R' 'class-Transferable.R' 'data.R'
'dose_response.R' 'effect.R' 'epx.R' 'explore_space.R' 'fx.R'
'get.R' 'globals.R' 'has.R' 'import_morse.R' 'import_toxswa.R'
'is.R' 'lik_profile.R' 'log.R' 'man-deb.R' 'man-lemna.R'
'man-macrophytes.R' 'solver.R' 'model-algae.R'
'model-deb_abj.R' 'model-debtox.R' 'model-deb_daphnia.R'
'model-guts_red.R' 'model-lemna_setac.R'
'model-lemna_schmitt.R' 'model-myriophyllum.R' 'package.R'
'pll.R' 'plot.R' 'plotting.r' 'pull.R' 'sequence.R' 'set.R'
'set_bounds.R' 'set_exposure.R' 'set_forcings.R' 'set_init.R'
'set_param.R' 'set_transfer.R' 'set_window.R' 'show.R'
'simulate.R' 'survival.R' 'utils-pipe.R'</td>
</tr>
<tr>
<td>Suggests:</td>
<td>future, knitr, lemna, rmarkdown, roxyglobals, testthat, withr</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/roxyglobals/filename:</td>
<td>globals.R</td>
</tr>
<tr>
<td>Config/roxyglobals/unique:</td>
<td>FALSE</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-02-28 10:39:38 UTC; ENCAZ</td>
</tr>
<tr>
<td>Author:</td>
<td>Nils Kehrein [aut, cre],
  Dirk Nickisch [aut],
  Peter Vermeiren [aut],
  Torben Wittwer [ctb],
  Johannes Witt [ctb],
  Andre Gergs [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Nils Kehrein &lt;nils.kehrein@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-02-28 11:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='+25+26gt+3B+25'>Pipe operator</h2><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>See <code>magrittr::<a href="magrittr.html#topic+pipe">%&gt;%</a></code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lhs %&gt;% rhs
</code></pre>


<h3>Value</h3>

<p>description
</p>

<hr>
<h2 id='Algae_Simple'>Algae model with exponential growth but without additional forcings</h2><span id='topic+Algae_Simple'></span><span id='topic+AlgaeSimple-class'></span><span id='topic+AlgaeSimpleScenario-class'></span>

<h3>Description</h3>

<p>The model is a mechanistic combined toxicokinetic-toxicodynamic (TK/TD) and
growth model for algae. It follows the concept of a simplified algae model
described in Rendal et al. (2023). The model simulates the development of
algal biomass. The growth of the algae population is simulated on the basis
of growth rates, which are, in contrast to the Weber model, independent on
environmental conditions which are usually optimal in laboratory effect studies.
The toxicodynamic sub-model describes the effects of growth-inhibiting
substances through a corresponding reduction in the photosynthesis rate on the
basis of either external or internal concentrations (depending on user choice of 'scaled' parameter setting).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Algae_Simple()
</code></pre>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+AlgaeSimple-class">AlgaeSimple</a>
</p>


<h3>State variables</h3>

<p>The model has two state variables:
</p>

<ul>
<li> <p><code>A</code>, Biomass (ug fresh wt/mL, cells/mL *10^4)
</p>
</li>
<li> <p><code>Dw</code>, only used if scaled = 1
</p>
</li></ul>



<h3>Model parameters</h3>


<ul>
<li><p> Growth model
</p>

<ul>
<li> <p><code>mu_max</code>, Maximum growth rate (d-1)
</p>
</li></ul>

</li>
<li><p> Concentration response (Toxicodynamics)
</p>

<ul>
<li> <p><code>EC_50</code>, Effect concentration of 50% inhibition of growth rate (ug L-1)
</p>
</li>
<li> <p><code>b</code>, slope of concentration effect curve at EC_50 (-)
</p>
</li>
<li> <p><code>dose_response</code>, shape of the dose response curve (0 = logit, 1 = probit)
</p>
</li></ul>

</li>
<li><p> External concentration (Toxicokinetics)
</p>

<ul>
<li> <p><code>kD</code>, dominant rate constant of toxicant in aquatic environments (d-1)
</p>
</li>
<li> <p><code>scaled</code>, 0 = no internal scaled damage / 1 = yes (-)
</p>
</li></ul>

</li></ul>



<h3>Forcings</h3>

<p>Simplified model without additional forcings for e.g. irradiation or temperature
as implemented in <code>Algae_Weber</code>. A constant growth over time is assumed.
In case that growth is time dependent, a forcing variable (f_growth) can be set.
Forcing time-series are represented by <code>data.frame</code> objects consisting of two
columns. The first for time and the second for a scaling factor of mu_max.
The input format for all forcings is a list of the data frames. If f_growth is
not set, a default scaling factor of 1 is used.
</p>


<h3>Parameter boundaries</h3>

<p>Upper and lower parameter boundaries are set by default for each parameter. This,
to avoid extreme values during calibration (particularly likelihood profiling)
</p>


<h3>Simulation output</h3>

<p>Simulation results will contain the state variables biomass (<code>A</code>) and
scaled damage concentration (<code>Dw</code>).
</p>
<p>It is possible to amend the output of <code><a href="#topic+simulate">simulate()</a></code> with additional model
quantities that are not state variables, for e.g. debugging purposes or to
analyze model behavior. To enable or disable additional outputs, use the
optional argument <code>nout</code> of <code><a href="#topic+simulate">simulate()</a></code>. As an example, set <code>nout=2</code> to
enable reporting of external concentration (<code>Cw</code>) and growth scaling factor
(<code>f_growth</code>). Set <code>nout=0</code> to disable additional outputs (default).
</p>
<p>The available output levels are as follows:
</p>

<ul>
<li> <p><code>nout &gt;= 1</code>: <code>Cw</code> external concentration (ug L-1)
</p>
</li>
<li> <p><code>nout &gt;= 2</code>: <code>f_growth</code> growth scaling factor (-)
</p>
</li>
<li> <p><code>nout &gt;= 3</code>: <code>dA</code>, biomass derivative (µg)
</p>
</li>
<li> <p><code>nout &gt;= 4</code>: <code>dDw</code>, damage concentration derivative (ug L-1)
</p>
</li></ul>



<h3>Solver settings</h3>

<p>The arguments to ODE solver <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code> control how model equations
are numerically integrated. The settings influence stability of the numerical
integration scheme as well as numerical precision of model outputs. Generally, the
default settings as defined by <em>deSolve</em> are used, but all <em>deSolve</em> settings
can be modified in <em>cvasi</em> workflows by the user, if needed. Please refer
to e.g. <code><a href="#topic+simulate">simulate()</a></code> on how to pass arguments to <em>deSolve</em> in <em>cvasi</em>
workflows.
</p>
<p>Some default settings of <em>deSolve</em> were adapted for this model by expert
judgement to enable precise, but also computationally efficient, simulations
for most model parameters. These settings can be modified by the user,
if needed:
</p>

<ul>
<li> <p><code>hmax = 0.01</code><br>
Maximum step length in time suitable for most simulations.
</p>
</li></ul>



<h3>References</h3>

<p>Weber D, Schaeffer D, Dorgerloh M, Bruns E, Goerlitz G, Hammel K, Preuss TG
and Ratte HT, 2012. Combination of a higher-tier flow-through system and
population modeling to assess the effects of time-variable exposure of
isoproturon on the green algae Desmodesmus subspictatus and
Pseudokirchneriella subcapitata. Environmental Toxicology and
Chemistry, 31, 899-908. <a href="https://doi.org/10.1002/etc.1765">doi:10.1002/etc.1765</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Scenarios">Scenarios</a>, <a href="#topic+Transferable">Transferable</a>
</p>
<p>Other algae models: 
<code><a href="#topic+Algae-models">Algae-models</a></code>,
<code><a href="#topic+Algae_TKTD">Algae_TKTD</a>()</code>,
<code><a href="#topic+Algae_Weber">Algae_Weber</a>()</code>
</p>

<hr>
<h2 id='Algae_TKTD'>Algae model with exponential growth, forcings (P, I) and scaled damage</h2><span id='topic+Algae_TKTD'></span><span id='topic+AlgaeTKTD-class'></span><span id='topic+AlgaeTKTDScenario-class'></span>

<h3>Description</h3>

<p>The model is a mechanistic combined toxicokinetic-toxicodynamic (TK/TD) and
growth model for algae. The model simulates the development of algal biomass
under laboratory and environmental conditions. The growth of the algae
population is simulated on the basis of growth rates, which are dependent on
environmental conditions (radiation, temperature and phosphorus).
The model is a variant of the <code><a href="#topic+Algae_Weber">Algae_Weber()</a></code> model (Weber 2012) as cited
in EFSA TKTD opinion (2018). This Algae model, <code><a href="#topic+Algae_TKTD">Algae_TKTD()</a></code>, provides an
additional possibility (probit) to simulate the dose-response curve and
considers a scaled internal damage instead of the external concentration.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Algae_TKTD()
</code></pre>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+AlgaeTKTD-class">AlgaeTKTD</a>
</p>


<h3>State variables</h3>

<p>The model has four state variables:
</p>

<ul>
<li> <p><code>A</code>, Biomass (ug fresh wt/mL, cells/mL *10^4)
</p>
</li>
<li> <p><code>Q</code>, Mass of phosphorous internal (ug P/ug fresh wt)
</p>
</li>
<li> <p><code>P</code>, Mass of phosphorous external (ug P/L)
</p>
</li>
<li> <p><code>Dw</code>, Damage concentration (ug/L)
</p>
</li></ul>



<h3>Model parameters</h3>


<ul>
<li><p> Growth model
</p>

<ul>
<li> <p><code>mu_max</code>, Maximum growth rate (d-1)
</p>
</li>
<li> <p><code>Q_min</code>, Minimum intracellular P (ug P/ug fresh wt)
</p>
</li>
<li> <p><code>Q_max</code>, Maximum intracellular P (ug P/ug fresh wt)
</p>
</li>
<li> <p><code>v_max</code>, Maximum P-uptake rate at non-limited growth (ug P/ug fresh wt/d)
</p>
</li>
<li> <p><code>k_s</code>,   Half-saturation constant for extracellular P (mg P/L)
</p>
</li>
<li> <p><code>m_max</code>, Natural mortality rate (1/d)
</p>
</li>
<li> <p><code>I_opt</code>, Optimum light intensity for growth (uE/m²/s)
</p>
</li>
<li> <p><code>T_opt</code>, Optimum temperature for growth (°C)
</p>
</li>
<li> <p><code>T_max</code>, Maximum temperature for growth (°C)
</p>
</li>
<li> <p><code>T_min</code>, Minimum temperature for growth (°C)
</p>
</li></ul>

</li>
<li><p> Concentration response (Toxicodynamics)
</p>

<ul>
<li> <p><code>EC_50</code>, Effect concentration of 50% inhibition of growth rate (ug L-1)
</p>
</li>
<li> <p><code>b</code>, slope of concentration effect curve at EC_50 (-)
</p>
</li>
<li> <p><code>dose_resp</code>, shape of the dose response curve (0 = logit, 1 = probit)
</p>
</li></ul>

</li>
<li><p> External concentration (Toxicokinetics)
</p>

<ul>
<li> <p><code>kD</code>, dominant rate constant (d-1)
</p>
</li></ul>

</li></ul>



<h3>Forcings</h3>

<p>Besides exposure events (Cw), the <em>Algae</em> model requires two environmental
properties as time-series input: Irradiance (<code>I</code>, uE/m²/s) and
temperature (<code>T_act</code>, deg C).
Forcings time-series are represented by <code>data.frame</code> objects
consisting of two columns. The first for time and the second for the
environmental factor in question. The input format for all forcings is a
list of the data frames.
</p>


<h3>Simulation output</h3>

<p>Simulation results will contain the state variables Biomass (<code>A</code>), mass of
internal phosphorous (<code>Q</code>), mass of external phosphorous (<code>P</code>) and the damage
concentration (<code>Dw</code>).
</p>
<p>It is possible to amend the output of <code><a href="#topic+simulate">simulate()</a></code> with additional model
quantities that are not state variables, for e.g. debugging purposes or to
analyze model behavior. To enable or disable additional outputs, use the
optional argument <code>nout</code> of <code><a href="#topic+simulate">simulate()</a></code>. As an example, set <code>nout=2</code> to
enable reporting of model derivatives <code>dA</code> and <code>dQ</code>. Set <code>nout=0</code> to disable
additional outputs (default).
</p>
<p>The available output levels are as follows:
</p>

<ul>
<li><p> Derivatives
</p>

<ul>
<li> <p><code>nout &gt;= 1</code>: <code>dA</code>, biomass derivative (µg)
</p>
</li>
<li> <p><code>nout &gt;= 2</code>: <code>dQ</code>, internal phosphorous derivative (mg P/ug fresh wt)
</p>
</li>
<li> <p><code>nout &gt;= 3</code>: <code>dP</code>, external phosphorous derivative (mg P L-1)
</p>
</li>
<li> <p><code>nout &gt;= 4</code>: <code>dDw</code>, damage concentration derivative (ug L-1)
</p>
</li></ul>

</li></ul>



<h3>Solver settings</h3>

<p>The arguments to ODE solver <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code> control how model equations
are numerically integrated. The settings influence stability of the numerical
integration scheme as well as numerical precision of model outputs. Generally, the
default settings as defined by <em>deSolve</em> are used, but all <em>deSolve</em> settings
can be modified in <em>cvasi</em> workflows by the user, if needed. Please refer
to e.g. <code><a href="#topic+simulate">simulate()</a></code> on how to pass arguments to <em>deSolve</em> in <em>cvasi</em>
workflows.
</p>
<p>Some default settings of <em>deSolve</em> were adapted for this model by expert
judgement to enable precise, but also computationally efficient, simulations
for most model parameters. These settings can be modified by the user,
if needed:
</p>

<ul>
<li> <p><code>hmax = 0.1</code><br>
Maximum step length in time suitable for most simulations.
</p>
</li></ul>



<h3>References</h3>

<p>Weber D, Schaeffer D, Dorgerloh M, Bruns E, Goerlitz G, Hammel K, Preuss TG
and Ratte HT, 2012. Combination of a higher-tier flow-through system and
population modeling to assess the effects of time-variable exposure of
isoproturon on the green algae Desmodesmus subspictatus and
Pseudokirchneriella subcapitata. Environmental Toxicology and
Chemistry, 31, 899-908. <a href="https://doi.org/10.1002/etc.1765">doi:10.1002/etc.1765</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Scenarios">Scenarios</a>, <a href="#topic+Transferable">Transferable</a>
</p>
<p>Other algae models: 
<code><a href="#topic+Algae-models">Algae-models</a></code>,
<code><a href="#topic+Algae_Simple">Algae_Simple</a>()</code>,
<code><a href="#topic+Algae_Weber">Algae_Weber</a>()</code>
</p>

<hr>
<h2 id='Algae_Weber'>Algae model with exponential growth and forcings (I, T)</h2><span id='topic+Algae_Weber'></span><span id='topic+AlgaeWeber-class'></span><span id='topic+AlgaeWeberScenario-class'></span>

<h3>Description</h3>

<p>The model is a mechanistic combined toxicokinetic-toxicodynamic (TK/TD) and
growth model for algae. The model simulates the development of algal biomass
under laboratory and environmental conditions and was developed by
Weber et al. (2012) as cited in EFSA TKTD opinion (2018). The growth of the
algae population is simulated on the basis of growth rates, which are
dependent on environmental conditions (radiation, temperature and phosphorus).
The toxicodynamic sub-model describes the effects of growth-inhibiting
substances through a corresponding reduction in the photosynthesis rate on
the basis of internal concentrations. (the implementation of Weber et al.
(2012) is followed where units differ with EFSA)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Algae_Weber()
</code></pre>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+AlgaeWeber-class">AlgaeWeber</a>
</p>


<h3>State variables</h3>

<p>The model has four state variables:
</p>

<ul>
<li> <p><code>A</code>, Biomass (ug fresh wt/mL, cells/mL *10^4)
</p>
</li>
<li> <p><code>Q</code>, Mass of phosphorous internal (mg P/L, or ug P/mL)
</p>
</li>
<li> <p><code>P</code>, Mass of phosphorous external (mg P/L, or ug P/mL)
</p>
</li>
<li> <p><code>C</code>, external substance concentration (ug/L)
</p>
</li></ul>



<h3>Model parameters</h3>


<ul>
<li><p> Growth model
</p>

<ul>
<li> <p><code>mu_max</code>, Maximum growth rate (d-1)
</p>
</li>
<li> <p><code>Q_min</code>, Minimum intracellular P (ug P/ug fresh wt)
</p>
</li>
<li> <p><code>Q_max</code>, Maximum intracellular P (ug P/ug fresh wt)
</p>
</li>
<li> <p><code>v_max</code>, Maximum P-uptake rate at non-limited growth (ug P/ug fresh wt/d)
</p>
</li>
<li> <p><code>k_s</code>,   Half-saturation constant for extracellular P (mg P/L)
</p>
</li>
<li> <p><code>m_max</code>, Natural mortality rate (1/d)
</p>
</li>
<li> <p><code>I_opt</code>, Optimum light intensity for growth (uE/m²/s)
</p>
</li>
<li> <p><code>T_opt</code>, Optimum temperature for growth (°C)
</p>
</li>
<li> <p><code>T_max</code>, Maximum temperature for growth (°C)
</p>
</li>
<li> <p><code>T_min</code>, Minimum temperature for growth (°C)
</p>
</li>
<li> <p><code>D</code>, Dilution rate (1/d)
</p>
</li>
<li> <p><code>R_0</code>, Influx concentration of P (mg P/L)
</p>
</li></ul>

</li>
<li><p> Concentration response (Toxicodynamics)
</p>

<ul>
<li> <p><code>EC_50</code>, Effect concentration of 50% inhibition of growth rate (ug/L)
</p>
</li>
<li> <p><code>b</code>, slope of concentration effect curve at EC_50 (-)
</p>
</li></ul>

</li>
<li><p> External concentration (Toxicokinetics)
</p>

<ul>
<li> <p><code>k</code>, Degradation rate of toxicant in aquatic environments (d-1)
</p>
</li></ul>

</li></ul>



<h3>Forcings</h3>

<p>Besides exposure events (C_in), the <em>Algae</em> model requires three environmental
properties as time-series input: Irradiance (<code>I</code>, uE/m²/s)
and temperature (<code>T_act</code>, deg C).
Forcings time-series are represented by <code>data.frame</code> objects
consisting of two columns. The first for time and the second for the
environmental factor in question. The input format for all forcings is a
list of the data frames.
</p>


<h3>Simulation output</h3>

<p>Simulation results will contain the state variables Biomass (<code>A</code>), mass of
internal phosphorous (<code>Q</code>), mass of external phosphorous (<code>P</code>) and the external
concentration (<code>C</code>).
</p>
<p>It is possible to amend the output of <code><a href="#topic+simulate">simulate()</a></code> with additional model
quantities that are not state variables, for e.g. debugging purposes or to
analyze model behavior. To enable or disable additional outputs, use the
optional argument <code>nout</code> of <code><a href="#topic+simulate">simulate()</a></code>. As an example, set <code>nout=2</code> to
enable reporting of model derivatives <code>dA</code> and <code>dQ</code>. Set <code>nout=0</code> to disable
additional outputs (default).
</p>
<p>The available output levels are as follows:
</p>

<ul>
<li><p> Derivatives
</p>

<ul>
<li> <p><code>nout &gt;= 1</code>: <code>dA</code>, biomass derivative (µg)
</p>
</li>
<li> <p><code>nout &gt;= 2</code>: <code>dQ</code>, internal phosphorous derivative (mg P/ug fresh wt)
</p>
</li>
<li> <p><code>nout &gt;= 3</code>: <code>dP</code>, external phosphorous derivative (mg P L-1)
</p>
</li>
<li> <p><code>nout &gt;= 4</code>: <code>dC</code>, external concentration derivative (ug L-1)
</p>
</li></ul>

</li></ul>



<h3>Solver settings</h3>

<p>The arguments to ODE solver <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code> control how model equations
are numerically integrated. The settings influence stability of the numerical
integration scheme as well as numerical precision of model outputs. Generally, the
default settings as defined by <em>deSolve</em> are used, but all <em>deSolve</em> settings
can be modified in <em>cvasi</em> workflows by the user, if needed. Please refer
to e.g. <code><a href="#topic+simulate">simulate()</a></code> on how to pass arguments to <em>deSolve</em> in <em>cvasi</em>
workflows.
</p>
<p>Some default settings of <em>deSolve</em> were adapted for this model by expert
judgement to enable precise, but also computationally efficient, simulations
for most model parameters. These settings can be modified by the user,
if needed:
</p>

<ul>
<li> <p><code>hmax = 0.1</code><br>
Maximum step length in time suitable for most simulations.
</p>
</li></ul>



<h3>Parameter boundaries</h3>

<p>Default values for parameter boundaries are set for all parameters by expert
judgement, for calibration purposes. Values can be access from the object, and
defaults overwritten.
</p>


<h3>References</h3>

<p>Weber D, Schaeffer D, Dorgerloh M, Bruns E, Goerlitz G, Hammel K, Preuss TG
and Ratte HT, 2012. Combination of a higher-tier flow-through system and
population modeling to assess the effects of time-variable exposure of
isoproturon on the green algae Desmodesmus subspictatus and
Pseudokirchneriella subcapitata. Environmental Toxicology and
Chemistry, 31, 899-908. <a href="https://doi.org/10.1002/etc.1765">doi:10.1002/etc.1765</a>
</p>
<p>EFSA PPR Panel (EFSA Panel on Plant Protection Products and their Residues),
Ockleford C, Adriaanse P, Berny P, Brock T, Duquesne S, Grilli S,
Hernandez-Jerez AF, Bennekou SH,Klein M, Kuhl T, Laskowski R, Machera K,
Pelkonen O, Pieper S, Smith RH, Stemmer M, Sundh I, Tiktak A,Topping CJ,
Wolterink G, Cedergreen N, Charles S, Focks A, Reed M, Arena M, Ippolito A,
Byers H andTeodorovic I, 2018. Scientific Opinion on the state of the art of
Toxicokinetic/Toxicodynamic (TKTD)effect models for regulatory risk assessment
of pesticides for aquatic organisms. EFSA Journal, 16(8), 5377.
<a href="https://doi.org/10.2903/j.efsa.2018.5377">doi:10.2903/j.efsa.2018.5377</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Scenarios">Scenarios</a>, <a href="#topic+Transferable">Transferable</a>
</p>
<p>Other algae models: 
<code><a href="#topic+Algae-models">Algae-models</a></code>,
<code><a href="#topic+Algae_Simple">Algae_Simple</a>()</code>,
<code><a href="#topic+Algae_TKTD">Algae_TKTD</a>()</code>
</p>

<hr>
<h2 id='Algae-models'>Algae models</h2><span id='topic+Algae-models'></span><span id='topic+Algae-class'></span>

<h3>Description</h3>

<p>Overview of supported <em>Algae</em> models
</p>


<h3>Details</h3>


<ul>
<li> <p><code><a href="#topic+Algae_Weber">Algae_Weber()</a></code> by Weber <em>et al.</em> (2012)
</p>
</li>
<li> <p><code><a href="#topic+Algae_TKTD">Algae_TKTD()</a></code> based on Weber <em>et al.</em> (2012), but with scaled damage
</p>
</li>
<li> <p><code><a href="#topic+Algae_Simple">Algae_Simple()</a></code> simplified growth model without additional forcing variables
</p>
</li></ul>



<h3>Biomass transfer</h3>

<p>Models supporting biomass transfer can be instructed to move a fixed amount
of biomass to a new medium after a period of time. This feature replicates
a procedure occurring in e.g. <em>Lemna</em> effect studies and may be necessary to
recreate study results.
</p>
<p>The biomass transfer feature assumes that always a fixed amount of
biomass is transferred. Transfers can occur at any fixed point in time or
in regular intervals. During a transfer, the biomass is reset to the
transferred amount and additional compartments can be scaled 1:1 accordingly,
to e.g. reflect the change in internal toxicant mass when biomass is modified.
Transfer settings can be modified using <code><a href="#topic+set_transfer">set_transfer()</a></code>.
</p>
<p>If a transfer occurs, simulation results of that time point will report the model state
<strong>before</strong> the transfer. Be aware that if transfers are defined using the
<code>interval</code> argument, the transfers will always occur relative to time point
zero (<code>t = 0</code>). As an example, setting a regular transfer of seven days,
<code>interval =  7</code>, will result at transfers occurring at time points which are
integer multiplicates of seven, such as <code>t=0</code>, <code>t=7</code>, <code>t=14</code> and so forth.
The starting and end times of a scenario do not influece <strong>when</strong> a regular
transfer occurs, only <strong>if</strong> it occurs.
</p>


<h3>References</h3>

<p>Weber D, Schaeffer D, Dorgerloh M, Bruns E, Goerlitz G, Hammel K, Preuss TG
and Ratte HT, 2012. Combination of a higher-tier flow-through system and
population modeling to assess the effects of time-variable exposure of
isoproturon on the green algae Desmodesmus subspictatus and
Pseudokirchneriella subcapitata. Environmental Toxicology and
Chemistry, 31, 899-908. <a href="https://doi.org/10.1002/etc.1765">doi:10.1002/etc.1765</a>
</p>
<p>EFSA Panel on Plant Protection Products and their Residues, 2018. Scientific
opinion on the state of the art of Toxicokinetic/Toxicodynamic (TKTD) effect
models for regulatory risk assessment of pesticides for aquatic organisms.
EFSA journal 16:5377 <a href="https://doi.org/10.2903/j.efsa.2018.5377">doi:10.2903/j.efsa.2018.5377</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Lemna-models">Lemna-models</a>, <a href="#topic+Transferable">Transferable</a>
</p>
<p>Other algae models: 
<code><a href="#topic+Algae_Simple">Algae_Simple</a>()</code>,
<code><a href="#topic+Algae_TKTD">Algae_TKTD</a>()</code>,
<code><a href="#topic+Algae_Weber">Algae_Weber</a>()</code>
</p>
<p>Other models: 
<code><a href="#topic+DEB-models">DEB-models</a></code>,
<code><a href="#topic+GUTS-RED-models">GUTS-RED-models</a></code>,
<code><a href="#topic+Lemna-models">Lemna-models</a></code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Myriophyllum-models">Myriophyllum-models</a></code>
</p>

<hr>
<h2 id='americamysis'>A DEB abj scenario of Americamysis bahia</h2><span id='topic+americamysis'></span>

<h3>Description</h3>

<p>Species parameters were collected from the AddMyPet database entry on
Americamysis bahia (Opossum shrimp). The exposure series consists of a
constant exposure resulting in medium effects on length and reproduction.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>americamysis
</code></pre>


<h3>Format</h3>

<p>An object of class <code>DebAbj</code> of length 1.
</p>


<h3>Source</h3>

<p><a href="https://www.bio.vu.nl/thb/deb/deblab/add_my_pet/entries_web/Americamysis_bahia/Americamysis_bahia_res.html">https://www.bio.vu.nl/thb/deb/deblab/add_my_pet/entries_web/Americamysis_bahia/Americamysis_bahia_res.html</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DEB_abj">DEB_abj()</a></code>
</p>

<hr>
<h2 id='batch'>Batch simulation of multiple exposure levels</h2><span id='topic+batch'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>batch(
  scenario,
  exposure,
  id_col = "trial",
  format = c("long", "wide"),
  times_from = c("scenario", "exposure"),
  select = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="batch_+3A_scenario">scenario</code></td>
<td>
<p>a <a href="#topic+scenario">scenario</a> object</p>
</td></tr>
<tr><td><code id="batch_+3A_exposure">exposure</code></td>
<td>
<p>a named <code>list()</code> or a <code>data.frame</code> with three columns</p>
</td></tr>
<tr><td><code id="batch_+3A_id_col">id_col</code></td>
<td>
<p><code>character</code>, name of column in resulting ´data.frame' which
contains a trial's name or ID</p>
</td></tr>
<tr><td><code id="batch_+3A_format">format</code></td>
<td>
<p><code>character</code>, set to <code>'long'</code> for long tabular format, or
<code>'wide'</code> for wide format</p>
</td></tr>
<tr><td><code id="batch_+3A_times_from">times_from</code></td>
<td>
<p><code>character</code>, set to <code>'scenario'</code> to use output times from
scenario, or <code>'exposure'</code> to take output times from each exposure series</p>
</td></tr>
<tr><td><code id="batch_+3A_select">select</code></td>
<td>
<p>optional <code>character</code> vector to select columns from the
simulation output</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A convenience function to simulate a single base scenario with one or more
exposure levels. The functions aims at reproducing the setup and result format
of common effect studies.
</p>
<p>Simulating a <a href="#topic+scenario">scenario</a> is generally limited to assessing a single exposure
series. However, laboratory experiments commonly examine the effects of
multiple exposure levels on a biological system.
A <em>batch simulation</em> approach involves running multiple simulations with
varying exposure or <em>treatment</em> conditions. To illustrate: if the objective is
to examine the impact of a chemical on cell growth, multiple scenarios need
to be simulated to reproduce the cell growth dynamics under varying
concentrations of the assessed chemical. Each simulation run will represent a
specific exposure level, ranging from low to high concentrations of the
chemical.
</p>
<p>To simulate the conditions of such a laboratory experiment, the scenarios and
exposure levels can either be created and simulated individually, or the
<code>batch()</code> function can be used for ease of use.
</p>


<h4>Exposure series</h4>

<p>The set of exposure levels can be represented by one of the following types:
</p>

<ul>
<li><p> A (named) list: Each element represents an exposure level or exposure
series. An exposure level can be represented by a constant numeric, a
<code>data.frame</code> with two columns, or an ExposureSeries object. The names of
the list elements specify the study ID.
</p>
</li>
<li><p> Or alternatively, a <code>data.frame</code> with three columns: One column for time,
one for the exposure level, and one character column to specify the
study IDs.
</p>
</li></ul>

<p>Each exposure level will be simulated using the base scenario. If the exposure
levels are provided as a named list, the names will also appear in the return
value of <code>simulate()</code>. This behavior can be used, for example, to define unique
study IDs for particular exposure levels.
</p>



<h4>Exposure IDs</h4>

<p>The list of exposure levels can be supplied as a named list. The names
will be used as unique (study) IDs, so that the simulation results belonging
to any exposure level can be identified in the output.
If no IDs are defined by the user, generic IDs of the form <code>'trial{n}'</code> will
be assigned, with <code>{n}</code> being replaced by consecutive integers starting at one.
</p>
<p>If the batch is passed on to <code><a href="#topic+simulate">simulate()</a></code>', the IDs will be contained in its
return value, e.g. as a dedicated column (long format) or as part of the
column names (wide format).
</p>



<h4>Output format</h4>

<p>The return value of <code><a href="#topic+simulate">simulate()</a></code> is by default in long format, i.e. it will
contain one row for each output time and exposure level. It is possible to
pivot the tabular data to wide format, by setting the argument
<code>format = 'wide'</code>.
</p>
<p>In wide format, the output columns of each exposure level are pasted
next to each other. If more than one column is pivoted per exposure level,
then the exposure or study ID is added as a suffix to column names.
If the output per exposure level contains only a single column (besides time
and the exposure ID itself), then original column name is dropped and only
exposure IDs are used. See the examples section for reference.
</p>



<h4>Select output columns</h4>

<p>Often, only a single output column is of interest in batch simulations,
such as the number of surviving individuals. To ease the interpretation and
handling of the output of batch simulations, the columns contained in the
output of each simulated exposure level can be filtered. One or more columns
can be selected. By default, no filtering of output columns is conducted.
</p>
<p>As an example, to create an overview of survival probabilities (<em>S</em>) in the
GUTS-RED-IT example scenario <code>minnow_it</code>:
</p>
<div class="sourceCode"><pre>minnow_it %&gt;%
  batch(exposure=list(0, 5, 10), select="S", format="wide") %&gt;%
  simulate()
</pre></div>



<h3>Value</h3>

<p>a simulation batch object
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate a batch experiment with three constant exposure levels of
# 0.0, 2.0, and 5.0 µmol/L
simulate(batch(minnow_it, list(0, 2, 5)))

# Alternatively, in tidyr style syntax
trials_list1 &lt;- list(0, 2, 5)
minnow_it %&gt;%
  batch(trials_list1) %&gt;%
  simulate()

# Assign unique IDs to each exposure level
trials_list2 &lt;- list(Control=0, TrialA=2, TrialB=5)
minnow_it %&gt;%
  batch(trials_list2) %&gt;%
  simulate()

# Alternatively, define multiple exposure levels in a single data.frame
trials_table &lt;- data.frame(time=c(0, 0, 0),
                           conc=c(0, 2, 5),
                           trial=c("Control", "TrialA", "TrialB"))
minnow_it %&gt;%
  batch(trials_table) %&gt;%
  simulate()

# Limit simulation output to column 'S' (survival probability)
minnow_it %&gt;%
  batch(trials_list2, select="S") %&gt;%
  simulate()

# Return data in wide-format, unique IDs will be used as column names
minnow_it %&gt;%
  batch(trials_list2, select="S", format="wide") %&gt;%
  simulate()
</code></pre>

<hr>
<h2 id='cache_controls'>Cache control simulations</h2><span id='topic+cache_controls'></span>

<h3>Description</h3>

<p>Cache control simulations
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cache_controls(x, windows, skipZeroExposure = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cache_controls_+3A_x">x</code></td>
<td>
<p>vector of <a href="#topic+scenario">scenario</a> objects</p>
</td></tr>
<tr><td><code id="cache_controls_+3A_windows">windows</code></td>
<td>
<p><code>list</code> of window tuples</p>
</td></tr>
<tr><td><code id="cache_controls_+3A_skipzeroexposure">skipZeroExposure</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code>, windows with zero exposure will
not be included in calculations</p>
</td></tr>
<tr><td><code id="cache_controls_+3A_...">...</code></td>
<td>
<p>additional parameters passed on to <code><a href="#topic+effect">effect()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Modified <a href="#topic+scenario">scenario</a> objects
</p>

<hr>
<h2 id='calibrate'>Fit model parameters to experimental data</h2><span id='topic+calibrate'></span><span id='topic+calibrate+2CEffectScenario-method'></span><span id='topic+calibrate+2CCalibrationSet-method'></span><span id='topic+calibrate+2Clist-method'></span>

<h3>Description</h3>

<p>The function <code>calibrate()</code> performs the calibration (fitting) of model
parameters to observed data. The data can originate from one or more experiments or
trials. Experimental conditions, such as model parameters and exposure
level, can differ between trials; fitting can be performed on all datasets
at the same time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calibrate(x, ...)

## S4 method for signature 'EffectScenario'
calibrate(
  x,
  par,
  data,
  endpoint = deprecated(),
  output,
  by,
  metric_fun = deprecated(),
  err_fun,
  as_tibble = deprecated(),
  catch_errors = deprecated(),
  verbose = TRUE,
  ...
)

## S4 method for signature 'CalibrationSet'
calibrate(x, par, output, err_fun, verbose = TRUE, ...)

## S4 method for signature 'list'
calibrate(
  x,
  par,
  endpoint = deprecated(),
  output,
  metric_fun = deprecated(),
  metric_total = deprecated(),
  err_fun,
  as_tibble = deprecated(),
  catch_errors = deprecated(),
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calibrate_+3A_x">x</code></td>
<td>
<p>either a single <a href="#topic+scenario">scenario</a> or a list of <a href="#topic+caliset">caliset</a> objects to be fitted</p>
</td></tr>
<tr><td><code id="calibrate_+3A_...">...</code></td>
<td>
<p>additional parameters passed on to <code><a href="stats.html#topic+optim">stats::optim()</a></code> and <code><a href="#topic+simulate">simulate()</a></code></p>
</td></tr>
<tr><td><code id="calibrate_+3A_par">par</code></td>
<td>
<p>named numeric vector with parameters to fit and their start values</p>
</td></tr>
<tr><td><code id="calibrate_+3A_data">data</code></td>
<td>
<p><code>data.frame</code> with two or more columns with experimental data,
1st column must contain time points, the following columns may values
which the scenario is fitted to.</p>
</td></tr>
<tr><td><code id="calibrate_+3A_endpoint">endpoint</code></td>
<td>
<p><em>deprecated</em> <code>character</code>, please use <code>output</code> instead</p>
</td></tr>
<tr><td><code id="calibrate_+3A_output">output</code></td>
<td>
<p><code>character</code>, name of a single output column of <code><a href="#topic+simulate">simulate()</a></code> to
optimize on</p>
</td></tr>
<tr><td><code id="calibrate_+3A_by">by</code></td>
<td>
<p>optional <code>character</code>, groups and splits the experimental data
into multiple distinct trials and datasets before fitting</p>
</td></tr>
<tr><td><code id="calibrate_+3A_metric_fun">metric_fun</code></td>
<td>
<p><em>deprecated</em>, please use <code>err_fun</code> instead</p>
</td></tr>
<tr><td><code id="calibrate_+3A_err_fun">err_fun</code></td>
<td>
<p>vectorized error function to calculate an error term that is
minimized during optimization, must accept exactly four vectorized
arguments, defaults to sum of squared errors</p>
</td></tr>
<tr><td><code id="calibrate_+3A_as_tibble">as_tibble</code></td>
<td>
<p><em>deprecated</em>, result can no longer be returned as a tibble</p>
</td></tr>
<tr><td><code id="calibrate_+3A_catch_errors">catch_errors</code></td>
<td>
<p><em>deprecated</em>, simulation errors are always caught</p>
</td></tr>
<tr><td><code id="calibrate_+3A_verbose">verbose</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code> then debug outputs are displayed during
optimization</p>
</td></tr>
<tr><td><code id="calibrate_+3A_metric_total">metric_total</code></td>
<td>
<p><em>deprecated</em></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Fitting of model parameters can be performed in two ways:
</p>

<ol>
<li><p> A single <a href="#topic+scenario">scenario</a> is fitted to a single dataset.
The dataset must represent a time-series of an output variable of the
model, e.g. observed biomass over time (effect data). The dataset can represent
results of one or more experimental replicates under identical conditions.
</p>
</li>
<li><p> One or more datasets of observed data are fitted each to a scenario which
describes the experimental conditions during observation, such as exposure
level and environmental properties. Each combination of dataset and scenario
is represented by a <a href="#topic+caliset">calibration set</a>. During fitting,
all <em>calibration sets</em> are evaluated and a total error term is calculated
over all observed and predicted values.
</p>
</li></ol>



<h4>Observed data</h4>

<p>Experimental, or effect, data must be supplied as a <code>data.frame</code> in long format
with at least two columns: the first column contains <code>numeric</code> timestamps and
the remaining columns must contain the observed quantity. The dataset must
contain a column that which matches with the contents of parameter <code>output</code>.
</p>
<p>As an example, the simulation result of <a href="#topic+Lemna_Schmitt">Lemna_Schmitt</a> model contains the
output column <em>biomass</em> (<code>BM</code>), amongst others. To fit model parameters of said
<em>Lemna_Schmitt</em> scenario based on observed biomass, the observed data must
contain a column named <code>BM</code> which represents the observed biomass.
A minimal observed dataset could look like this:
</p>
<div class="sourceCode"><pre>observed &lt;- data.frame(time=c(0,  7, 14, 21),
                       BM=c( 12, 23, 37, 56))
</pre></div>



<h4>Error function</h4>

<p>By default, the total sum of squared errors is used as the target
function which is minimized during fitting. A custom error function can be
supplied by the user: The function must accept four vectorized
arguments and return a numeric of length one, i.e. the total error value
which gets <em>minimized</em> by <code>calibrate()</code>.
</p>
<p>Example of a custom error function which returns the sum of absolute errors:
</p>
<div class="sourceCode"><pre>my_absolute_error &lt;- function(observed, predicted, weights, tags) {
  sum(abs(observed - predicted))
}
</pre></div>
<p>The arguments to the error function will contain all observed and predicted
values, as well as any weights and tags that were defined by the <em>calibration sets</em>.
As tags are optional, the fourth argument may be a list containing <code>NULL</code> values.
The fourth argument can be used to pass additional information to the error
function: For example, the tag may identify the study from where the data
originates from and the error function could group and evaluate the data
accordingly.
</p>



<h3>Value</h3>

<p>A list of fitted parameters (as produced by <code><a href="stats.html#topic+optim">stats::optim()</a></code>)
is returned.
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>calibrate(EffectScenario)</code>: Fit single scenario using a dataset
</p>
</li>
<li> <p><code>calibrate(CalibrationSet)</code>: Fit using a <a href="#topic+CalibrationSet">CalibrationSet</a>
</p>
</li>
<li> <p><code>calibrate(list)</code>: Fit using a list of <a href="#topic+caliset">caliset</a> objects
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)

# Get observed biomass during control experiment by Schmitt et al. (2013)
observed &lt;- Schmitt2013 %&gt;%
  filter(ID == "T0") %&gt;%
  select(t, BM=obs)

# Create a scenario that represents conditions during experiment
scenario &lt;- metsulfuron %&gt;%
  set_param(c(k_phot_fix=TRUE, k_resp=0, Emax=1)) %&gt;%
  set_init(c(BM=12)) %&gt;%
  set_noexposure()

# Fit parameter 'k_phot_max' to observed biomass growth from experiment
calibrate(
  scenario,
  par=c(k_phot_max=1),
  data=observed,
  output="BM",
  method="Brent", # Brent is recommended for one-dimensional optimization
  lower=0,        # lower parameter boundary
  upper=0.5       # upper parameter boundary
) -&gt; fit
fit$par

</code></pre>

<hr>
<h2 id='CalibrationSet'>Calibration set</h2><span id='topic+CalibrationSet'></span><span id='topic+CalibrationSet-class'></span><span id='topic+caliset'></span>

<h3>Description</h3>

<p>A <em>calibration set</em> combines a <a href="#topic+scenario">scenario</a>, observed data, and an
optional weighting factor into one object. The <em>calibration set</em> is used to fit
model parameters to observed data using <code><a href="#topic+calibrate">calibrate()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>caliset(scenario, data, weight = 1.0, tag = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CalibrationSet_+3A_scenario">scenario</code></td>
<td>
<p>a <a href="#topic+scenario">scenario</a> describing conditions during the experiment</p>
</td></tr>
<tr><td><code id="CalibrationSet_+3A_data">data</code></td>
<td>
<p>a <code>data.frame</code> with observed data in long format containing two
columns: the 1st column with <code>numeric</code> time points and 2nd column with
<code>numeric</code> data to fit to.</p>
</td></tr>
<tr><td><code id="CalibrationSet_+3A_weight">weight</code></td>
<td>
<p>optional <code>numeric</code> weight to be applied when calculating the
error term for each data point. Default value is <code>1.0</code>, i.e. no weighting.</p>
</td></tr>
<tr><td><code id="CalibrationSet_+3A_tag">tag</code></td>
<td>
<p>optional value to identify the data, e.g. a study number</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A <em>calibration set</em> usually represents a single experiment or trial.
Multiple experimental replicates can be combined into a single <em>set</em>, if model
parameters are identical between trials.
If model parameters were modified during a trial, e.g. a pump failure occurred
or flow rates changed, this can be represented by using a <em>scenario sequence</em>
instead of a basic <a href="#topic+scenario">scenario</a>. Please refer to <code><a href="#topic+sequence">sequence()</a></code> for details.
</p>


<h4>Weighting</h4>

<p>An optional weighting factor can be used to scale the error term of a
whole <em>set</em> or of individual data points when fitting parameters using e.g.
<code><a href="#topic+calibrate">calibrate()</a></code>.
</p>
<p>The vector of weights must either be of length one or have the same length
as the dataset. In the former case, the same weight will be applied to all
values in the dataset. In the latter, individual weights are applied
for each data point.
</p>



<h3>Value</h3>

<p><code>caliset()</code> returns a <em>calibration set</em> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)

# Get observed biomass during control experiment by Schmitt et al. (2013)
observed &lt;- Schmitt2013 %&gt;%
  filter(ID == "T0") %&gt;%
  select(t, BM=obs)

# Create a scenario that represents conditions during experiment
scenario &lt;- metsulfuron %&gt;%
  set_param(c(k_phot_fix=TRUE, k_resp=0, Emax=1)) %&gt;%
  set_init(c(BM=12)) %&gt;%
  set_noexposure()

# Create a calibration set
cs &lt;- caliset(scenario, observed)

# Fit parameter 'k_phot_max' to observed biomass growth from experiment
calibrate(
  cs,
  par=c(k_phot_max=1),
  output="BM",
  method="Brent", # Brent is recommended for one-dimensional optimization
  lower=0,        # lower parameter boundary
  upper=0.5       # upper parameter boundary
) -&gt; fit
fit$par

</code></pre>

<hr>
<h2 id='DEB_abj'>DEB_abj</h2><span id='topic+DEB_abj'></span><span id='topic+DebAbj-class'></span>

<h3>Description</h3>

<p>Creates a <em>DEB abj</em> scenario. The <em>abj</em> model with type M acceleration is
like model <em>std</em>, but acceleration occurs between birth and metamorphosis (V1-morph).
Isomorphy is assumed before and after acceleration. Metamorphosis is before
puberty and occurs at maturity <code>E_Hj</code>, which might or might not correspond with
changes in morphology. The <em>abj</em> model is a one-parameter extension of model <em>std</em>
<a href="https://debportal.debtheory.org/docs/Typified_models.html">(DEB Wiki)</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DEB_abj()
</code></pre>


<h3>Details</h3>



<h4>State variables</h4>

<p>The following list describes the default names and standard units of the model's
state variables:
</p>

<ul>
<li> <p><code>L</code>, structural length (cm)
</p>
</li>
<li> <p><code>E</code>, energy reserve (J)
</p>
</li>
<li> <p><code>H</code>, energy invested in maturity (J)
</p>
</li>
<li> <p><code>R</code>, reproduction buffer (J)
</p>
</li>
<li> <p><code>cV</code>, internal concentration (<a href="stats.html#topic+C">C</a>)
</p>
</li>
<li> <p><code>Lmax</code>, maximum structural length (cm)
</p>
</li></ul>

<p>All state variables are initialized with zero. See <code><a href="#topic+set_init">set_init()</a></code> on how to set
the initial state.
</p>



<h4>Parameters</h4>

<p>The following model parameters are required:
</p>

<ul>
<li> <p><code>p_M</code>, vol-spec somatic maintenance (J/d.cm^3)
</p>
</li>
<li> <p><code>v</code>, energy conductance (cm/d)
</p>
</li>
<li> <p><code>k_J</code>, maturity maint rate coefficient (1/d)
</p>
</li>
<li> <p><code>p_Am</code>, surface-area specific maximum assimilation rate (J/d.cm^2)
</p>
</li>
<li> <p><code>kap</code>, allocation fraction to soma (-)
</p>
</li>
<li> <p><code>E_G</code>, spec cost for structure (J/cm^3)
</p>
</li>
<li> <p><code>f</code>, scaled functional response (-)
</p>
</li>
<li> <p><code>E_Hj</code>, maturity at metamorphosis (J)
</p>
</li>
<li> <p><code>E_Hp</code>, maturity at puberty (J)
</p>
</li>
<li> <p><code>kap_R</code>, reproduction efficiency (-)
</p>
</li>
<li> <p><code>L_b</code>, structural length at birth (cm)
</p>
</li>
<li> <p><code>L_j</code>, structural length at metamorphosis (cm)
</p>
</li>
<li> <p><code>ke</code>, elimination rate constant (d-1)
</p>
</li>
<li> <p><code>c0</code>, no-effect concentration sub-lethal (<a href="stats.html#topic+C">C</a>)
</p>
</li>
<li> <p><code>cT</code>, tolerance concentration (<a href="stats.html#topic+C">C</a>)
</p>
</li>
<li> <p><code>MoA</code>, mode of action switch (-)
</p>
</li></ul>




<h4>Mode of Actions</h4>

<p>Any combination of the following mode of actions (MoA) can be considered by
the model:
</p>

<ul>
<li> <p><code>MoA = 1</code>: effect on feeding
</p>
</li>
<li> <p><code>MoA = 2</code>: effect on maintenance costs
</p>
</li>
<li> <p><code>MoA = 4</code>: effect on overhead costs for making an egg
</p>
</li>
<li> <p><code>MoA = 8</code>: hazard during oogenesis
</p>
</li>
<li> <p><code>MoA = 16</code>: energy conductance
</p>
</li></ul>

<p>To activate more than one MoA, simply add up the corresponding
codes. To disable all MoAs, set the parameter to zero.
See also <code><a href="#topic+set_mode_of_action">set_mode_of_action()</a></code>.
</p>



<h4>Effects</h4>

<p>The state variables <em>L</em> (structural length) and <em>R</em> (reproduction buffer) are
set as effect endpoints by default. All state variables are available as
potential endpoints. The list of considered endpoints can be modified
by using <code><a href="#topic+set_endpoints">set_endpoints()</a></code>.
</p>
<p>To calculate effects, each <em>DEB</em> scenario is simulated twice: One simulation
which considers exposure to a toxicant and one simulation without exposure, i.e.
a control. See also <code><a href="#topic+effect">effect()</a></code>.
</p>



<h3>Value</h3>

<p>an S4 object of type <a href="#topic+DebAbj-class">DebAbj</a>
</p>


<h3>Simulation output</h3>

<p>Simulation results will contain the state variables.
It is possible to amend the output of <code><a href="#topic+simulate">simulate()</a></code> with additional model
quantities that are not state variables, for e.g. debugging purposes or to
analyze model behavior. To enable or disable additional outputs, use the
optional argument <code>nout</code> of <code><a href="#topic+simulate">simulate()</a></code>. As an example, set <code>nout=2</code> to
enable reporting of the acceleration factor (<code>MV</code>) and the mobilization flux
(<code>pC</code>). Set <code>nout=0</code> to disable additional outputs (default).
</p>
<p>The available output levels are as follows:
</p>

<ul>
<li> <p><code>nout</code> &gt;= 1: <code>MV</code> acceleration factor (-)
</p>
</li>
<li> <p><code>nout</code> &gt;= 2: <code>pC</code> mobilization flux (J/d)
</p>
</li>
<li> <p><code>nout</code> &gt;= 3: <code>pA</code> assimilation flux (J/d)
</p>
</li>
<li> <p><code>nout</code> &gt;= 4: <code>pJ</code> energy invested in maturity flux (J/d)
</p>
</li></ul>



<h3>Solver settings</h3>

<p>The arguments to ODE solver <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code> control how model equations
are numerically integrated. The settings influence stability of the numerical
integration scheme as well as numerical precision of model outputs. Generally, the
default settings as defined by <em>deSolve</em> are used, but all <em>deSolve</em> settings
can be modified in <em>cvasi</em> workflows by the user, if needed. Please refer
to e.g. <code><a href="#topic+simulate">simulate()</a></code> on how to pass arguments to <em>deSolve</em> in <em>cvasi</em>
workflows.
</p>


<h3>See Also</h3>

<p>Other DEB models: 
<code><a href="#topic+DEB-models">DEB-models</a></code>,
<code><a href="#topic+DEBtox">DEBtox</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Create an abj scenario from scratch and simulate it
DEB_abj() %&gt;%
  set_init(c(L=0.02,E=0.1,H=0.01)) %&gt;%
  set_param(c(p_M=3000,v=0.02,k_J=0.6,p_Am=300,kap=0.9,E_G=4000,f=1,
              E_Hj=0.05,E_Hp=0.3,kap_R=0.9,ke=1,c0=0,cT=1,L_b=0.02,
              L_j=0.04,MoA=0)) %&gt;%
  set_exposure(no_exposure()) %&gt;%
  set_times(0:10) %&gt;%
  simulate()

# Print information about sample scenario 'americamysis'
americamysis

# Simulate 'americamysis' scenario
americamysis %&gt;% simulate()
</code></pre>

<hr>
<h2 id='DEB-models'>Dynamic Energy Budget (DEB) models</h2><span id='topic+DEB-models'></span><span id='topic+Deb-class'></span>

<h3>Description</h3>

<p>Supported models:
</p>

<ul>
<li> <p><a href="#topic+DEB_abj">DEB_abj</a>
</p>
</li>
<li> <p><a href="#topic+DEBtox">DEBtox</a>
</p>
</li></ul>



<h3>See Also</h3>

<p>Other DEB models: 
<code><a href="#topic+DEB_abj">DEB_abj</a>()</code>,
<code><a href="#topic+DEBtox">DEBtox</a>()</code>
</p>
<p>Other models: 
<code><a href="#topic+Algae-models">Algae-models</a></code>,
<code><a href="#topic+GUTS-RED-models">GUTS-RED-models</a></code>,
<code><a href="#topic+Lemna-models">Lemna-models</a></code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Myriophyllum-models">Myriophyllum-models</a></code>
</p>

<hr>
<h2 id='DEBtox'>DEBtox model</h2><span id='topic+DEBtox'></span><span id='topic+DEBtox2019'></span><span id='topic+DebTox-class'></span><span id='topic+DEB_Daphnia'></span><span id='topic+DebDaphnia-class'></span>

<h3>Description</h3>

<p>Creates a  <em>DEBtox</em> scenario as described by Jager (2020). It
represents a simplified <em>DEBtox</em> model based on <em>DEBkiss</em>. In the <em>BYOM</em>
application [<a href="https://www.debtox.info/byom.html">link</a>], this model is
referred to as <em>DEBtox 2019</em>, version 4.7.
It supports an optional feature of the <em>ERA special</em> model variant, which
can consider a reference <em>Lm</em> parameter to compare results of multiple
datasets.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DEBtox()

DEB_Daphnia()
</code></pre>


<h3>Details</h3>



<h4>State variables</h4>

<p>The following list describes the names and units of the
model's state variables:
</p>

<ul>
<li> <p><code>D</code>, scaled damage ([C])
</p>
</li>
<li> <p><code>L</code>, body length (mm)
</p>
</li>
<li> <p><code>R</code>, cumulative reproduction (-)
</p>
</li>
<li> <p><code>S</code>, survival probability (-)
</p>
</li></ul>

<p>State variables <code>D</code>, <code>L</code>, and <code>R</code> are initialized with zero. Variable <code>S</code>
is initialized with one (<code>1.0</code>). See <code><a href="#topic+set_init">set_init()</a></code> on how to set
the initial state manually.
</p>



<h4>Parameters</h4>

<p>The following parameters are required:
</p>

<ul>
<li><p> General
</p>

<ul>
<li> <p><code>L0</code>, body length at start (mm)
</p>
</li>
<li> <p><code>Lp</code>, body length at puberty (mm)
</p>
</li>
<li> <p><code>Lm</code>, maximum body length (mm)
</p>
</li>
<li> <p><code>rB</code>, von Bertalanffy growth rate constant (1/d)
</p>
</li>
<li> <p><code>Rm</code>, maximum reproduction rate (#/d)
</p>
</li>
<li> <p><code>f</code>, scaled functional response (-)
</p>
</li>
<li> <p><code>hb</code>, background hazard rate (d-1)
</p>
</li>
<li> <p><code>a</code>, Weibull background hazard coefficient (-). Set to <code>1</code> to disable.
</p>
</li></ul>

</li>
<li><p> Extra parameters
</p>

<ul>
<li> <p><code>Lf</code>, body length at half-saturation feeding (mm)
</p>
</li>
<li> <p><code>Lj</code>, body length at which acceleration stops (mm)
</p>
</li>
<li> <p><code>Tlag</code>, lag time for start development (d)
</p>
</li></ul>

</li>
<li><p> TK/TD parameters
</p>

<ul>
<li> <p><code>kd</code>, dominant rate constant (d-1)
</p>
</li>
<li> <p><code>zb</code>, effect threshold energy budget ([C])
</p>
</li>
<li> <p><code>bb</code>, effect strength energy-budget effects (1/[C])
</p>
</li>
<li> <p><code>zs</code>, effect threshold survival ([C])
</p>
</li>
<li> <p><code>bs</code>, effect strength survival (1/([C] d))
</p>
</li></ul>

</li>
<li><p> Other parameters (formerly globals in <em>BYOM</em>)
</p>

<ul>
<li> <p><code>FBV</code>, dry weight egg as fraction of structural body weight (-)
</p>
</li>
<li> <p><code>KRV</code>, part. coeff. repro buffer and structure (kg/kg) (for losses with reproduction)
</p>
</li>
<li> <p><code>kap</code>, approximation for kappa (for starvation response)
</p>
</li>
<li> <p><code>yP</code>, product of yVA and yAV (for starvation response)
</p>
</li>
<li> <p><code>Lm_ref</code>, optional reference max length for scaling rate constants (mm).
Set to zero to disable the reference length. Disabled by default.
</p>
</li>
<li> <p><code>len</code>, a switch to control body length dynamics: <code>1</code> organism can shrink,
<code>2</code> organism cannot shrink. Default value is <code>1</code>.
</p>
</li>
<li> <p><code>Tbp</code>, optional brood-pouch delay (d). Set to <code>NA</code> or zero to disable.
Default value is <code>0</code>.
</p>
</li>
<li> <p><code>MoA</code>, mode of action switches (-). Default value is <code>0</code>.
</p>
</li>
<li> <p><code>FB</code>, feedback on damage dynamics switches (-). Default value is <code>0</code>.
</p>
</li></ul>

</li></ul>

<p>A reference <code>Lm_ref</code> is needed to properly compare different data sets,
or when calibrating on more than one data set. If <code>Lm</code> differs, one would not
want to have different rate constants at the same length.
</p>


<h5>Mode of Action</h5>

<p>Any combination of the following mode of actions (<em>MoA</em>) can be considered by
the model:
</p>

<ul>
<li> <p><code>MoA = 1</code>: assimilation/feeding
</p>
</li>
<li> <p><code>MoA = 2</code>: costs for maintenance
</p>
</li>
<li> <p><code>MoA = 4</code>: costs for growth and reproduction
</p>
</li>
<li> <p><code>MoA = 8</code>: costs for reproduction
</p>
</li>
<li> <p><code>MoA = 16</code>: hazard for reproduction
</p>
</li></ul>

<p>To activate more than one mode of action, simply add up the corresponding
codes and set parameter <code>MoA</code> to the desired value. To disable all mode of
actions, set parameter <code>MoA</code> to zero. See also <code><a href="#topic+set_moa">set_moa()</a></code>.
</p>
<p>As an example, to consider effects on feeding and maintenance, set the
mode of action to three (<code>3</code>):
</p>
<p><code>DEBtox() %&gt;% set_param(c(MoA=3))</code>
</p>



<h5>Feedbacks</h5>

<p>Any combination of the following damage feedbacks can be considered by
the model:
</p>

<ul>
<li> <p><code>1</code>: surf:vol scaling uptake rate
</p>
</li>
<li> <p><code>2</code>: surf:vol scaling elimination rate
</p>
</li>
<li> <p><code>4</code>: growth dilution
</p>
</li>
<li> <p><code>8</code>: losses with reproduction
</p>
</li></ul>

<p>To activate more than one feedback, simply add up the corresponding
codes. To disable all feedbacks, set the parameter to zero.
</p>




<h4>Effects</h4>

<p>The state variables <em>L</em> (body length), <em>R</em> (cumulative reproduction), and
<em>S</em> (survival probability) are set as effect endpoints by default. All state
variables are available as potential endpoints. The list of considered
endpoints can be modified by using <code><a href="#topic+set_endpoints">set_endpoints()</a></code>.
</p>
<p>To calculate effects, each <em>DEBtox</em> scenario is simulated twice: One simulation
which considers exposure to a toxicant and one simulation without exposure, i.e.
a control. See also <code><a href="#topic+effect">effect()</a></code>.
</p>



<h4>Simulation output</h4>

<p>The following intermediary model variables can be added to the model
output on demand. Simply set the optional parameter <code>nout</code> to the
required output level and pass it to <code><a href="#topic+simulate">simulate()</a></code>.
</p>

<ul>
<li> <p><code>nout</code> &gt;= 1: <code>f</code>, actual scaled response
</p>
</li>
<li> <p><code>nout</code> &gt;= 2: <code>fR</code>, actual f considering starvation
</p>
</li>
<li> <p><code>nout</code> &gt;= 3: <code>kd</code>, actual kd
</p>
</li>
<li> <p><code>nout</code> &gt;= 4: <code>s</code>, stress level
</p>
</li>
<li> <p><code>nout</code> &gt;= 5: <code>h</code>, hazard rate
</p>
</li>
<li> <p><code>nout</code> &gt;= 6: <code>sA</code>, stress factor on assimilation/feeding
</p>
</li>
<li> <p><code>nout</code> &gt;= 7: <code>sM</code>, stress factor on maintenance
</p>
</li>
<li> <p><code>nout</code> &gt;= 8: <code>sG</code>, stress factor on growth costs
</p>
</li>
<li> <p><code>nout</code> &gt;= 9: <code>sR</code>, stress factor on reproduction costs
</p>
</li>
<li> <p><code>nout</code> &gt;= 10: <code>sH</code>, stress factor on hazard to reproduction
</p>
</li>
<li> <p><code>nout</code> &gt;= 11: <code>xu</code>, damage feedback factor for surf:vol scaling uptake rate
</p>
</li>
<li> <p><code>nout</code> &gt;= 12: <code>xe</code>, damage feedback factor for surf:vol scaling elimination rate
</p>
</li>
<li> <p><code>nout</code> &gt;= 13: <code>xG</code>, damage feedback factor for growth dilution
</p>
</li>
<li> <p><code>nout</code> &gt;= 14: <code>xR</code>, damage feedback factor for losses with repro
</p>
</li></ul>




<h4>Solver settings</h4>

<p>The arguments to ODE solver <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code> control how model equations
are numerically integrated. The settings influence stability of the numerical
integration scheme as well as numerical precision of model outputs. Generally, the
default settings as defined by <em>deSolve</em> are used, but all <em>deSolve</em> settings
can be modified in <em>cvasi</em> workflows by the user, if needed. Please refer
to e.g. <code><a href="#topic+simulate">simulate()</a></code> on how to pass arguments to <em>deSolve</em> in <em>cvasi</em>
workflows.
</p>
<p>Some default settings of <em>deSolve</em> were adapted for this model by expert
judgement to enable precise, but also computationally efficient, simulations
for most model parameters. These settings can be modified by the user,
if needed:
</p>

<ul>
<li> <p><code>method = 'ode45'</code><br>
Selects the Dormand-Prince 4(5) method of the Runge-Kutta family, see
<code><a href="deSolve.html#topic+rkMethod">deSolve::rkMethod()</a></code> for details.
</p>
</li></ul>




<h4>Model history and changes</h4>


<ul>
<li><p> cvasi v1.0.0
</p>

<ul>
<li><p> The <code>DEB_Daphnia()</code> model implemented BYOM's <em>DEBtox 2019</em>
model version 4.5
</p>
</li></ul>

</li>
<li><p> cvasi v1.2.0
</p>

<ul>
<li><p> The model equations were updated to conform with BYOM's <em>DEBtox 2019</em>
version 4.7. This introduced a new model parameter <code>a</code>, the Weibull
background hazard coefficient, and limited the maximum hazard rate to
99% per hour.
</p>
</li>
<li><p> The scenario constructor was renamed to <code>DEBtox()</code>.
</p>
</li>
<li><p> Additional intermediary model variables available as optional simulation
output
</p>
</li></ul>

</li></ul>




<h3>Value</h3>

<p>an S4 object of type <a href="#topic+DebTox-class">DebTox</a>
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>DEB_Daphnia()</code>: Deprecated model variant of <code>DEBtox()</code>
</p>
</li></ul>


<h3>References</h3>

<p>Jager T, 2020: Revisiting simplified DEBtox models for analysing
ecotoxicity data. Ecol Model 416. <a href="https://doi.org/10.1016/j.ecolmodel.2019.108904">doi:10.1016/j.ecolmodel.2019.108904</a>
</p>
<p>Romoli et al., 2024: Environmental risk assessment with energy budget
models: a comparison between two models of different complexity.
Environ Toxicol Chem 43(2):440-449. <a href="https://doi.org/10.1002/etc.5795">doi:10.1002/etc.5795</a>
</p>


<h3>See Also</h3>

<p>Other DEB models: 
<code><a href="#topic+DEB-models">DEB-models</a></code>,
<code><a href="#topic+DEB_abj">DEB_abj</a>()</code>
</p>

<hr>
<h2 id='dmagna'>A DEBtox scenario of Daphnia magna</h2><span id='topic+dmagna'></span>

<h3>Description</h3>

<p>Species and substance parameters were collected from test runs of the
original <a href="#topic+DEBtox">DEBtox</a> Daphnia model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dmagna
</code></pre>


<h3>Format</h3>

<p>An object of class <code>DebTox</code> of length 1.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DEBtox">DEBtox()</a></code>
</p>

<hr>
<h2 id='dose_response'>Calculate a dose response curve</h2><span id='topic+dose_response'></span>

<h3>Description</h3>

<p>Returns a <code>data.frame</code> with points on the dose response curve for the given
effect scenario.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dose_response(
  scenario,
  range = c(1, 99),
  n = 20,
  strategy = c("exponential", "decadic", "vanilla"),
  verbose = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dose_response_+3A_scenario">scenario</code></td>
<td>
<p>used for calculation</p>
</td></tr>
<tr><td><code id="dose_response_+3A_range">range</code></td>
<td>
<p>numeric vector specifying the required range of effect levels in
percent (%), defaults to <code>c(1,99)</code></p>
</td></tr>
<tr><td><code id="dose_response_+3A_n">n</code></td>
<td>
<p>minimum number of points on the dose response curve</p>
</td></tr>
<tr><td><code id="dose_response_+3A_strategy">strategy</code></td>
<td>
<p>controls how multiplication factors are chosen, <code>vanilla</code> uses a fixed
set of multiplication factors, <code>decadic</code> and <code>exponential</code> have varying step lengths.</p>
</td></tr>
<tr><td><code id="dose_response_+3A_verbose">verbose</code></td>
<td>
<p>logical, set to <code>TRUE</code> for additional status messages</p>
</td></tr>
<tr><td><code id="dose_response_+3A_...">...</code></td>
<td>
<p>additional arguments passed on to <code><a href="#topic+effect">effect()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Derives a dose response curve from a <a href="#topic+scenario">scenario</a>. The result will
cover the requested range of effect levels. The tested multiplication factors
can be chosen by different strategies, i.e. a <code>vanilla</code> approach using a
fixed set of factors, or <code>decadic</code> and <code>exponential</code> approaches
employing logarithmic and exponential factor scaling, respectively.
</p>


<h3>Value</h3>

<p><code>data.frame</code> with two columns, i.e. <code>mf</code> and <code>effect</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># basic dose response curve
minnow_sd %&gt;% dose_response()

# modify the minimum number of points on the curve
minnow_sd %&gt;% dose_response(n=10)

# select a subset of the effect range
minnow_sd %&gt;% dose_response(range=c(10,20))

# use an alternative strategy for the selection of multiplication factors
minnow_sd %&gt;% dose_response(strategy="decadic")

# provide additional output how multiplication factors were selected
minnow_sd %&gt;% dose_response(verbose=TRUE)
</code></pre>

<hr>
<h2 id='effect'>Effect level</h2><span id='topic+effect'></span>

<h3>Description</h3>

<p>Derives the effect level due to toxicant exposure in the supplied scenarios.
Either relative to a control scenario or derived directly from model
endpoints, depending on model type. For scenarios with moving exposure windows,
the maximum effect is returned.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>effect(x, factor = 1, max_only = TRUE, ep_only = FALSE, marginal_effect, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="effect_+3A_x">x</code></td>
<td>
<p>vector of <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="effect_+3A_factor">factor</code></td>
<td>
<p>optional numeric value which scales the exposure time-series</p>
</td></tr>
<tr><td><code id="effect_+3A_max_only">max_only</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code> only the maximum effect is returned, else
results for all effect windows are reported</p>
</td></tr>
<tr><td><code id="effect_+3A_ep_only">ep_only</code></td>
<td>
<p>logical, if TRUE only effect endpoints are returned as a vector</p>
</td></tr>
<tr><td><code id="effect_+3A_marginal_effect">marginal_effect</code></td>
<td>
<p><code>numeric</code>, if set, any effect smaller than this threshold will
be reported as zero to exclude pseudo-effects originating from small numerical
errors</p>
</td></tr>
<tr><td><code id="effect_+3A_...">...</code></td>
<td>
<p>additional parameters passed on to <code><a href="#topic+simulate">simulate()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>By default, only the maximum effect in all moving exposure windows will
be returned. If argument <code>max_only=FALSE</code> is set, the returned table will
be converted to long-format and will contain effect levels for each
assessed exposure window.
</p>


<h4>Output formatting</h4>

<p>Start and end time of exposure windows can be disabled by setting <code>ep_only=TRUE</code>.
Effect levels smaller than a certain threshold can be automatically set to
zero (<code>0.0</code>) to avoid spurious effect levels introduced by numerical errors.
Set <code>marginal_effect</code> to an adequate value less than 1%.
</p>



<h4>Computational efficiency</h4>

<p>Calculations can be sped up by providing a <code>data.frame</code> of pre-calculated
control scenarios for each assessed time window. As control scenarios are
by definition independent of any exposure multiplication factor, they can
be reused for repeated calculations, e.g. to derive effect profiles or
dose-response relationships.
</p>



<h3>Value</h3>

<p>a <code>tibble</code>, by default containing scenarios, effect levels, and the
exposure window where the maximum effect level occurred. The number of columns
depends on the enabled effect endpoints and function arguments.
</p>
<p>By default, the first column, named <code>scenarios</code>, contains the original scenario
objects that were the basis of the calculation. For each effect endpoint, it
will be followed by one column with the maximum effect level and two columns
containing start and end time of the associated exposure window. If exposure
windows are disabled, the columns will just contain the start and end time of
the simulation. The effect level column will have the name of the effect
endpoint, start and end time will additionally have the suffixes <code>.dat.start</code>
and <code>.dat.end</code>, respectively.
</p>

<hr>
<h2 id='epx'>Effect profiles (EPx values)</h2><span id='topic+epx'></span>

<h3>Description</h3>

<p>Derives one or more EPx/LPx values for the supplied effect scenarios, i.e. it
calculates the multiplication factors of an exposure profile that cause
x% of effect. Scenarios are processed in parallel, if possible.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>epx(
  scenarios,
  level = c(10, 50),
  effect_tolerance = 0.001,
  factor_cutoff = NA,
  min_factor = 1e-30,
  max_factor = 1e+30,
  verbose = FALSE,
  ep_only = FALSE,
  long_format = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="epx_+3A_scenarios">scenarios</code></td>
<td>
<p>table or vector of <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="epx_+3A_level">level</code></td>
<td>
<p>effect levels in percent (%), defaults to <code>c(10,50)</code></p>
</td></tr>
<tr><td><code id="epx_+3A_effect_tolerance">effect_tolerance</code></td>
<td>
<p><code>numeric</code>, minimum absolute accuracy of effect levels</p>
</td></tr>
<tr><td><code id="epx_+3A_factor_cutoff">factor_cutoff</code></td>
<td>
<p>optional <code>numeric</code>, the search for a multiplication factor
will be cut short if  tried factors exceed this value; the result will report
the cutoff value as the final EPx value.</p>
</td></tr>
<tr><td><code id="epx_+3A_min_factor">min_factor</code></td>
<td>
<p><code>numeric</code>, if tried factors fall below this threshold, the algorithm
will halt with an error</p>
</td></tr>
<tr><td><code id="epx_+3A_max_factor">max_factor</code></td>
<td>
<p><code>numeric</code>, if tried factors exceed this threshold, the algorithm
will halt with an error</p>
</td></tr>
<tr><td><code id="epx_+3A_verbose">verbose</code></td>
<td>
<p><code>logic</code>, if <code>TRUE</code> then infos about model evaluations are displayed</p>
</td></tr>
<tr><td><code id="epx_+3A_ep_only">ep_only</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code> then only EPx values are part of the output,
any contextual information such as <code>EffectScenario</code> objects are left out</p>
</td></tr>
<tr><td><code id="epx_+3A_long_format">long_format</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code> then EPx values are returned as
a table in long format, any contextual information will be duplicated</p>
</td></tr>
<tr><td><code id="epx_+3A_...">...</code></td>
<td>
<p>additional arguments passed on to <code><a href="#topic+effect">effect()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>To estimate EPx values, a <em>binary search</em> on multiplication factors is conducted.
The algorithm can achieve arbitrary precision in terms of effects. The
same approach is implemented in the <code>morse</code> package in the <code>MFx()</code> function.
Convergence is often achieved in less than 10 iterations per effect level and
endpoint.
</p>
<p>Internally, a knowledge base of all tried factors and resulting effect levels is
kept to speed up convergence if more than one endpoint or effect level was
requested. The algorithm will automatically sweep the range of multiplication
factors as needed but hard cutoff values are implemented to avoid infinite loops;
the algorithm will halt with an error message if tried factors are
smaller than <code>1e-30</code> or greater than <code>1e30</code>.
</p>


<h4>Numerical precision</h4>

<p>The precision of reported <em>EPx</em> values is controlled by the argument
<code>effect_tolerance</code> and is given as the upper absolute error threshold of
effects that is deemed acceptable. The default value of <code>0.001</code> ensures that
a derived <em>EPx</em> will result in an effect of x% ± 0.1. Decreasing the
<code>effect_tolerance</code> will result in additional model iterations and longer
runtime. Setting an extremely small tolerance value may lead to a breakdown
of the algorithm due to the occurrence of extremely small, quasi-random
numerical errors in simulation results.
</p>



<h3>Value</h3>

<p>The original <code>tibble</code> with additional columns named after the request effect levels, e.g. <code>L.EP10.</code>
If no tibble was used as argument, then a new one is created. The first column <code>scenario</code> will contain
the supplied <code>EffectScenario</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>minnow_sd %&gt;% epx()
minnow_sd %&gt;% epx(level=c(10,23,42))

# displays infos about tested multiplication factors
minnow_sd %&gt;% epx(verbose=TRUE)

# return results as a table in wide format
minnow_sd %&gt;% epx(long_format=TRUE)
</code></pre>

<hr>
<h2 id='epx_mtw'>Calculate EPx values for a series of moving time window</h2><span id='topic+epx_mtw'></span>

<h3>Description</h3>

<p>Calls <code>epx()</code> to calculate the EPx value (i.e. the multiplication factors of
an exposure profile that cause x% of effect) for moving windows with length
<code>window_length</code> that move timesteps defined by <code>window_interval</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>epx_mtw(
  x,
  level = c(10, 50),
  factor_cutoff = 1000,
  window_length = 7,
  window_interval = 1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="epx_mtw_+3A_x">x</code></td>
<td>
<p>a <a href="#topic+scenario">scenario</a></p>
</td></tr>
<tr><td><code id="epx_mtw_+3A_level">level</code></td>
<td>
<p>The target effect level of the effect, ie. the x of EPx.</p>
</td></tr>
<tr><td><code id="epx_mtw_+3A_factor_cutoff">factor_cutoff</code></td>
<td>
<p>above which cutoff is the EPx is not relevant</p>
</td></tr>
<tr><td><code id="epx_mtw_+3A_window_length">window_length</code></td>
<td>
<p>the length of the moving time window</p>
</td></tr>
<tr><td><code id="epx_mtw_+3A_window_interval">window_interval</code></td>
<td>
<p>the interval that the moving time window moves</p>
</td></tr>
<tr><td><code id="epx_mtw_+3A_...">...</code></td>
<td>
<p>arguments passed to <code>epx</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a tibble with five columns
</p>

<ul>
<li><p> window.start
</p>
</li>
<li><p> window.end
</p>
</li>
<li><p> endpoint
</p>
</li>
<li><p> level
</p>
</li>
<li><p> EPx
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>metsulfuron %&gt;%
  set_window(length=7, interval=1) %&gt;%
  epx_mtw()
</code></pre>

<hr>
<h2 id='explore_space'>Explore parameter space</h2><span id='topic+explore_space'></span>

<h3>Description</h3>

<p>The function is aimed at getting an idea of how the parameter space
of a model behaves, so that parameter identifiability problems and correlations
between parameters can be explored. Therefore, the function samples a large
number of parameter sets by randomly drawing from each parameter's 95%
confidence interval (generated by <code><a href="#topic+lik_profile">lik_profile()</a></code>). It then
checks how many of the parameter sets are within acceptable limits by comparing
the likelihood ratio of a parameter set vs. the original parameter set against
a chi-square distribution as degrees of freedom (df) the total number of profile
parameters (outer rim) or one df (inner rim). If needed, the function resamples
until at least <code>nr_accept</code> parameters sets are within the inner rim
</p>


<h3>Usage</h3>

<pre><code class='language-R'>explore_space(
  x,
  par,
  res,
  output,
  sample_size = 1000,
  max_runs = 30,
  nr_accept = 100,
  sample_factor = 1.2
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="explore_space_+3A_x">x</code></td>
<td>
<p>a list of <a href="#topic+caliset">caliset</a> objects</p>
</td></tr>
<tr><td><code id="explore_space_+3A_par">par</code></td>
<td>
<p>best fit parameters from joined calibration</p>
</td></tr>
<tr><td><code id="explore_space_+3A_res">res</code></td>
<td>
<p>output of 'lik_profile()' function</p>
</td></tr>
<tr><td><code id="explore_space_+3A_output">output</code></td>
<td>
<p>character vector, name of output column of <code><a href="#topic+simulate">simulate()</a></code> that
is used in calibration</p>
</td></tr>
<tr><td><code id="explore_space_+3A_sample_size">sample_size</code></td>
<td>
<p>number of samples to draw from each parameter interval</p>
</td></tr>
<tr><td><code id="explore_space_+3A_max_runs">max_runs</code></td>
<td>
<p>max number of times to redraw samples (within a smaller space), and repeat the process</p>
</td></tr>
<tr><td><code id="explore_space_+3A_nr_accept">nr_accept</code></td>
<td>
<p>threshold for number of points sampled within the inner circle</p>
</td></tr>
<tr><td><code id="explore_space_+3A_sample_factor">sample_factor</code></td>
<td>
<p>multiplication factor for sampling (95% interval * sample factor)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list containing a plot to explore the parameter space, and the <code>data.frame</code>
supporting it
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
# Example with Lemna model - physiological params
# Before applying the function, a model needs to be calibrated and its parameters profiled
# Inputs for likelihood profiling

# exposure - control run
exp &lt;- Schmitt2013 %&gt;%
  filter(ID == "T0") %&gt;%
  select(time=t, conc)

# observations - control run
obs &lt;- Schmitt2013 %&gt;%
  filter(ID == "T0") %&gt;%
  select(t, BM=obs)

# parameters after calibration
params &lt;- c(
  k_phot_max = 5.663571,
  k_resp = 1.938689,
  Topt = 26.7
)

# set parameter boundaries (if different from defaults)
bounds &lt;- list(
  k_resp = list(0, 10),
  k_phot_max = list(0, 30),
  Topt = list(20, 30)
)

# update metsulfuron
myscenario &lt;- metsulfuron %&gt;%
  set_init(c(BM = 5, E = 1, M_int = 0)) %&gt;%
  set_param(list(
    k_0 = 5E-5,
    a_k = 0.25,
    BM50 = 17600,
    mass_per_frond = 0.1
  )) %&gt;%
  set_exposure(exp) %&gt;%
  set_param(params) %&gt;%
  set_bounds(bounds)

# Likelihood profiling
res &lt;- lik_profile(
  x = myscenario,
  data = obs,
  output = "BM",
  par = params,
  refit = FALSE,
  type = "fine",
  method = "Brent"
)
# plot
plot_lik_profile(res)

# parameter space explorer
set.seed(1) # for reproducibility
res_space &lt;- explore_space(
  x = list(caliset(myscenario, obs)),
  par = params,
  res = res,
  output = "BM",
  sample_size = 1000,
  max_runs = 20,
  nr_accept = 100)

plot_param_space(res_space)


</code></pre>

<hr>
<h2 id='ExposureSeries'>Exposure time-series</h2><span id='topic+ExposureSeries'></span><span id='topic+ExposureSeries-class'></span>

<h3>Description</h3>

<p>Creates an object that encapsulates an exposure time-series with its
metadata, such as formatted datetime strings and file name where the
series was loaded from. <code><a href="#topic+no_exposure">no_exposure()</a></code> is shorthand to create a time-series
of constant zero exposure.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ExposureSeries(series, dates, file, meta, context)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ExposureSeries_+3A_series">series</code></td>
<td>
<p><code>data.frame</code> with two columns containing a time-series</p>
</td></tr>
<tr><td><code id="ExposureSeries_+3A_dates">dates</code></td>
<td>
<p><code>vector</code>, optional original list of time stamps</p>
</td></tr>
<tr><td><code id="ExposureSeries_+3A_file">file</code></td>
<td>
<p><code>character</code>, optional file name where data originates from</p>
</td></tr>
<tr><td><code id="ExposureSeries_+3A_meta">meta</code></td>
<td>
<p><code>list</code>, optional metadata</p>
</td></tr>
<tr><td><code id="ExposureSeries_+3A_context">context</code></td>
<td>
<p><code>list</code> optional contextual metadata such as project ids</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+ExposureSeries-class">ExposureSeries</a>
</p>


<h3>Slots</h3>


<dl>
<dt><code>dates</code></dt><dd><p>original time points of time-series, e.g. time stamps of the form <code style="white-space: pre;">&#8288;2000-01-01 12:00&#8288;</code></p>
</dd>
<dt><code>file</code></dt><dd><p><code>character</code>, file name where data originates from, may be empty</p>
</dd>
<dt><code>meta</code></dt><dd><p><code>list</code>, contains metadata</p>
</dd>
<dt><code>context</code></dt><dd><p><code>list</code>, contains contextual metadata, such as project ids</p>
</dd>
<dt><code>series</code></dt><dd><p><code>data.frame</code> containing the actual time-series</p>
</dd>
</dl>


<h3>See Also</h3>

<p><code><a href="#topic+no_exposure">no_exposure()</a></code>
</p>

<hr>
<h2 id='focusd1'>A Lemna_SETAC scenario with variable environment</h2><span id='topic+focusd1'></span>

<h3>Description</h3>

<p>A mechanistic combined toxicokinetic-toxicodynamic (TK/TD) and growth
model for the aquatic macrophytes Lemna spp. as published by
Klein <em>et al.</em> (2021).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>focusd1
</code></pre>


<h3>Format</h3>

<p>An object of class <code>LemnaSetac</code> of length 1.
</p>


<h3>Details</h3>

<p>The scenario will simulate a period of 365 days, a start
population of 80 g/m² dry weight, variable environmental conditions, and a
complex, time-varying exposure pattern.
</p>
<p>The scenario setup was published by Hommen <em>et al</em>. (2015). Exposure pattern
and substance specific parameters are of exemplary character
and represent the herbicide <em>metsulfuron-methyl</em>. The parameters were
derived by Schmitt et al. (2013) based on literature
data.
</p>


<h3>References</h3>

<p>Hommen U., Schmitt W., Heine S., Brock Theo CM., Duquesne S., Manson P., Meregalli G.,
Ochoa-Acuña H., van Vliet P., Arts G., 2015: How TK-TD and Population Models for
Aquatic Macrophytes Could Support the Risk Assessment for Plant Protection
Products. Integr Environ Assess Manag 12(1), pp. 82-95.
<a href="https://doi.org/10.1002/ieam.1715">doi:10.1002/ieam.1715</a>
</p>
<p>Klein J., Cedergreen N., Heine S., Reichenberger S., Rendal C.,
Schmitt W., Hommen U., 2021: Refined description of the <em>Lemna</em> TKTD growth model
based on <em>Schmitt et al.</em> (2013) - equation system and default parameters.
Report of the working group <em>Lemna</em> of the SETAC Europe Interest Group Effect
Modeling. Version 1, uploaded on 22. Sept. 2021.
<a href="https://www.setac.org/group/effect-modeling.html">https://www.setac.org/group/effect-modeling.html</a>
</p>
<p>Schmitt W., Bruns E., Dollinger M., Sowig P., 2013: Mechanistic TK/TD-model
simulating the effect of growth inhibitors on <em>Lemna</em> populations. Ecol Model
255, pp. 1-10. <a href="https://doi.org/10.1016/j.ecolmodel.2013.01.017">doi:10.1016/j.ecolmodel.2013.01.017</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Lemna-models">Lemna-models</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate the example scenario
focusd1 %&gt;% simulate()

</code></pre>

<hr>
<h2 id='fx'>Generic to calculate effects for a particular scenario</h2><span id='topic+fx'></span><span id='topic+fx+2CANY-method'></span><span id='topic+fx+2CAlgae-method'></span><span id='topic+fx+2CGutsRedSd-method'></span><span id='topic+fx+2CGutsRedIt-method'></span><span id='topic+fx+2CLemna-method'></span><span id='topic+fx+2CMyriophyllum-method'></span>

<h3>Description</h3>

<p>Generic to calculate effects for a particular scenario
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fx(scenario, ...)

## S4 method for signature 'ANY'
fx(scenario, ...)

## S4 method for signature 'Algae'
fx(scenario, ...)

## S4 method for signature 'GutsRedSd'
fx(scenario, ...)

## S4 method for signature 'GutsRedIt'
fx(scenario, ...)

## S4 method for signature 'Lemna'
fx(scenario, ...)

## S4 method for signature 'Myriophyllum'
fx(scenario, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fx_+3A_scenario">scenario</code></td>
<td>
<p><a href="#topic+scenario">scenario</a> object</p>
</td></tr>
<tr><td><code id="fx_+3A_...">...</code></td>
<td>
<p>additional parameters</p>
</td></tr>
</table>


<h3>Value</h3>

<p>numeric named vector
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>fx(ANY)</code>: Use state variables at end of simulation
</p>
</li>
<li> <p><code>fx(Algae)</code>: Effect at end of simulation of <a href="#topic+Algae-models">Algae-models</a>
</p>
</li>
<li> <p><code>fx(GutsRedSd)</code>: Survival and lethality in <a href="#topic+GUTS-RED-models">GUTS-RED-models</a>
</p>
</li>
<li> <p><code>fx(GutsRedIt)</code>: Survival and lethality in <a href="#topic+GUTS-RED-models">GUTS-RED-models</a>
</p>
</li>
<li> <p><code>fx(Lemna)</code>: Effect at end of simulation of <a href="#topic+Lemna-models">Lemna-models</a>
</p>
</li>
<li> <p><code>fx(Myriophyllum)</code>: Effect at end of simulation of <a href="#topic+Myriophyllum-models">Myriophyllum-models</a>
</p>
</li></ul>

<hr>
<h2 id='get_model'>Get model name</h2><span id='topic+get_model'></span><span id='topic+get_model+2CANY-method'></span><span id='topic+get_model+2Clist-method'></span><span id='topic+get_model+2CEffectScenario-method'></span><span id='topic+get_model+2CParameterSet-method'></span><span id='topic+get_model_name'></span>

<h3>Description</h3>

<p>Returns the unique model name that is associated with a scenario, e.g.
<code>GUTS-RED-IT</code>. The function supports vectorized arguments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_model(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_model_+3A_x">x</code></td>
<td>
<p>(vector of) <a href="#topic+scenarios">scenarios</a> or <code><a href="#topic+parameter_set">parameter_set</a></code> objects</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of <code>character</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># returns `GUTS-RED-IT`
get_model(minnow_it)
</code></pre>

<hr>
<h2 id='get_tag'>Get scenario tag</h2><span id='topic+get_tag'></span><span id='topic+get_tag+2CANY-method'></span><span id='topic+get_tag+2Clist-method'></span><span id='topic+get_tag+2CEffectScenario-method'></span><span id='topic+get_tag+2CParameterSet-method'></span>

<h3>Description</h3>

<p>Returns the user-defined, custom tag of a scenario, if available. Tags
can be helpful to quickly distinguish scenarios of the same model type.
The function supports vectorized inputs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_tag(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_tag_+3A_x">x</code></td>
<td>
<p>(vector of) <a href="#topic+scenarios">scenarios</a> or <code><a href="#topic+parameter_set">parameter_set</a></code> objects</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of <code>character</code>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+set_tag">set_tag()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># returns `fathead minnow`
get_tag(minnow_it)

# update or set a tag
myscenario &lt;- minnow_it %&gt;% set_tag("My Custom Tag")
# returns `My Custom Tag`
get_tag(myscenario)
</code></pre>

<hr>
<h2 id='GUTS_RED_IT'>GUTS-RED-IT scenario</h2><span id='topic+GUTS_RED_IT'></span><span id='topic+GutsRedIt-class'></span>

<h3>Description</h3>

<p>Reduced <em>General Unified Threshold models of Survival</em> (GUTS) with
individual tolerance (<em>IT</em>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GUTS_RED_IT(param, init)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="GUTS_RED_IT_+3A_param">param</code></td>
<td>
<p>optional named <code>list</code> or <code>vector</code> with model parameters</p>
</td></tr>
<tr><td><code id="GUTS_RED_IT_+3A_init">init</code></td>
<td>
<p>optional named numeric <code>vector</code> to use as initial state</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+GutsRedIt-class">GutsRedIt</a>
</p>


<h3>Simulation output</h3>

<p>The return value of <code><a href="#topic+simulate">simulate()</a></code> will contain values for the state variables,
as well as an additional column <code>S</code> which represents the survival probability
for each time point. <code>S</code> is calculated as described in EFSA (2018) as
<em>S = (1- F(t))</em>. The background hazard rate <code>hb</code> is already considered in state
variable <code>H</code> and therefore does not occur as an additional term to derive <code>S</code>.
</p>


<h3>Solver settings</h3>

<p>The arguments to ODE solver <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code> control how model equations
are numerically integrated. The settings influence stability of the numerical
integration scheme as well as numerical precision of model outputs. Generally, the
default settings as defined by <em>deSolve</em> are used, but all <em>deSolve</em> settings
can be modified in <em>cvasi</em> workflows by the user, if needed. Please refer
to e.g. <code><a href="#topic+simulate">simulate()</a></code> on how to pass arguments to <em>deSolve</em> in <em>cvasi</em>
workflows.
</p>


<h3>State variables</h3>

<p>The following list describes the default names and standard units of <em>GUTS-RED</em>
state variables:
</p>

<ul>
<li> <p><code>D</code>, scaled damage (conc)
</p>
</li>
<li> <p><code>H</code>, cumulative hazard (-)
</p>
</li></ul>

<p>The state variables are initialized with zero by default.
</p>


<h3>IT model parameters</h3>


<ul>
<li> <p><code>kd</code>, dominant rate constant (time^-1)
</p>
</li>
<li> <p><code>hb</code>, background hazard rate (time^-1)
</p>
</li>
<li> <p><code>alpha</code>, median of thresholds (conc)
</p>
</li>
<li> <p><code>beta</code>, shape parameter (-)
</p>
</li></ul>



<h3>Effects</h3>

<p>The effect endpoint <code>L</code> (lethality) is available for <em>GUTS-RED</em> models.
A value of zero (<code>0.0</code>) denotes <em>no effect</em> on organism survival. A value of
one (<code>1.0</code>) denotes a lethality rate of 100%, i.e. no survivors.
</p>
<p>The survival probability <code>S</code> is available in the return value of <code><a href="#topic+simulate">simulate()</a></code>.
</p>


<h3>References</h3>

<p>EFSA PPR Panel (EFSA Panel on Plant Protection Products and their Residues),
Ockleford C, Adriaanse P, Berny P, et al., 2018: <em>Scientific Opinion on the
state of the art of Toxicokinetic/Toxicodynamic (TKTD) effect models for
regulatory risk assessment of pesticides for aquatic organisms</em>. EFSA Journal 2018;
16(8):5377, 188 pp. <a href="https://doi.org/10.2903/j.efsa.2018.5377">doi:10.2903/j.efsa.2018.5377</a>
</p>


<h3>See Also</h3>

<p>Other GUTS-RED models: 
<code><a href="#topic+GUTS-RED-models">GUTS-RED-models</a></code>,
<code><a href="#topic+GUTS_RED_SD">GUTS_RED_SD</a>()</code>
</p>

<hr>
<h2 id='GUTS_RED_SD'>GUTS-RED-SD scenario</h2><span id='topic+GUTS_RED_SD'></span><span id='topic+GutsRedSd-class'></span>

<h3>Description</h3>

<p>Reduced <em>General Unified Threshold models of Survival</em> (GUTS) with stochastic
death (<em>SD</em>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GUTS_RED_SD(param, init)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="GUTS_RED_SD_+3A_param">param</code></td>
<td>
<p>optional named <code>list</code> or <code>vector</code> with model parameters</p>
</td></tr>
<tr><td><code id="GUTS_RED_SD_+3A_init">init</code></td>
<td>
<p>optional named numeric <code>vector</code> to use as initial state</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+GutsRedSd-class">GutsRedSd</a>
</p>


<h3>Simulation output</h3>

<p>The return value of <code><a href="#topic+simulate">simulate()</a></code> will contain values for the state variables,
as well as an additional column <code>S</code> which represents the survival probability
for each time point. <code>S</code> is calculated as described in EFSA (2018) as
<em>S = exp(-H)</em>. The background hazard rate <code>hb</code> is already considered in state
variable <code>H</code> and therefore does not occur as an additional term to derive <code>S</code>.
</p>


<h3>State variables</h3>

<p>The following list describes the default names and standard units of <em>GUTS-RED</em>
state variables:
</p>

<ul>
<li> <p><code>D</code>, scaled damage (conc)
</p>
</li>
<li> <p><code>H</code>, cumulative hazard (-)
</p>
</li></ul>

<p>The state variables are initialized with zero by default.
</p>


<h3>SD model parameters</h3>


<ul>
<li> <p><code>kd</code>, dominant rate constant (time^-1)
</p>
</li>
<li> <p><code>hb</code>, background hazard rate (time^-1)
</p>
</li>
<li> <p><code>z</code>, threshold for effects (conc)
</p>
</li>
<li> <p><code>kk</code>, killing rate constant (time^-1)
</p>
</li></ul>



<h3>Effects</h3>

<p>The effect endpoint <code>L</code> (lethality) is available for <em>GUTS-RED</em> models.
A value of zero (<code>0.0</code>) denotes <em>no effect</em> on organism survival. A value of
one (<code>1.0</code>) denotes a lethality rate of 100%, i.e. no survivors.
</p>
<p>The survival probability <code>S</code> is available in the return value of <code><a href="#topic+simulate">simulate()</a></code>.
</p>


<h3>Solver settings</h3>

<p>The arguments to ODE solver <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code> control how model equations
are numerically integrated. The settings influence stability of the numerical
integration scheme as well as numerical precision of model outputs. Generally, the
default settings as defined by <em>deSolve</em> are used, but all <em>deSolve</em> settings
can be modified in <em>cvasi</em> workflows by the user, if needed. Please refer
to e.g. <code><a href="#topic+simulate">simulate()</a></code> on how to pass arguments to <em>deSolve</em> in <em>cvasi</em>
workflows.
</p>


<h3>References</h3>

<p>EFSA PPR Panel (EFSA Panel on Plant Protection Products and their Residues),
Ockleford C, Adriaanse P, Berny P, et al., 2018: <em>Scientific Opinion on the
state of the art of Toxicokinetic/Toxicodynamic (TKTD) effect models for
regulatory risk assessment of pesticides for aquatic organisms</em>. EFSA Journal 2018;
16(8):5377, 188 pp. <a href="https://doi.org/10.2903/j.efsa.2018.5377">doi:10.2903/j.efsa.2018.5377</a>
</p>


<h3>See Also</h3>

<p>Other GUTS-RED models: 
<code><a href="#topic+GUTS-RED-models">GUTS-RED-models</a></code>,
<code><a href="#topic+GUTS_RED_IT">GUTS_RED_IT</a>()</code>
</p>

<hr>
<h2 id='GUTS-RED-models'>GUTS-RED models</h2><span id='topic+GUTS-RED-models'></span>

<h3>Description</h3>

<p>Reduced <em>General Unified Threshold models of Survival</em> (GUTS) with stochastic
death (<em>SD</em>) and individual tolerance (<em>IT</em>)
</p>


<h3>Details</h3>

<p>The TKTD models <em><a href="#topic+GUTS_RED_SD">GUTS-RED-SD</a></em> and <em><a href="#topic+GUTS_RED_IT">GUTS-RED-IT</a></em>
were described by EFSA (2018).
GUTS-RED models assume a one-compartment model which directly links
external concentration to the scaled damage. The scaled damage is given in
units of concentration, equal to the units of measurement in the external
medium, e.g. ug/L. The damage dynamics is connected to an individual hazard
state variable, resulting in simulated mortality when an internal damage
threshold is exceeded. The death mechanisms stochastic death (<em>SD</em>) and
individual threshold (<em>IT</em>) are extreme cases of the <em>GUTS</em> theory.
</p>
<p>For <em>SD</em> models, the threshold parameter for lethal effects is fixed and
identical for all individuals of a group, meaning that the variance of the
threshold values is zero. Hence, the killing rate relates the probability of
a mortality event in proportion to the scaled damage. For <em>IT</em> models,
the thresholds for effects are distributed among individuals of a group.
Mortality of an individual follows immediately once the individual's tolerance
is exceeded. Meaning in model terms that the killing rate is set to
infinity (EFSA 2018).
</p>


<h3>State variables</h3>

<p>The following list describes the default names and standard units of <em>GUTS-RED</em>
state variables:
</p>

<ul>
<li> <p><code>D</code>, scaled damage (conc)
</p>
</li>
<li> <p><code>H</code>, cumulative hazard (-)
</p>
</li></ul>

<p>The state variables are initialized with zero by default.
</p>


<h3>SD model parameters</h3>


<ul>
<li> <p><code>kd</code>, dominant rate constant (time^-1)
</p>
</li>
<li> <p><code>hb</code>, background hazard rate (time^-1)
</p>
</li>
<li> <p><code>z</code>, threshold for effects (conc)
</p>
</li>
<li> <p><code>kk</code>, killing rate constant (time^-1)
</p>
</li></ul>



<h3>IT model parameters</h3>


<ul>
<li> <p><code>kd</code>, dominant rate constant (time^-1)
</p>
</li>
<li> <p><code>hb</code>, background hazard rate (time^-1)
</p>
</li>
<li> <p><code>alpha</code>, median of thresholds (conc)
</p>
</li>
<li> <p><code>beta</code>, shape parameter (-)
</p>
</li></ul>



<h3>Effects</h3>

<p>The effect endpoint <code>L</code> (lethality) is available for <em>GUTS-RED</em> models.
A value of zero (<code>0.0</code>) denotes <em>no effect</em> on organism survival. A value of
one (<code>1.0</code>) denotes a lethality rate of 100%, i.e. no survivors.
</p>
<p>The survival probability <code>S</code> is available in the return value of <code><a href="#topic+simulate">simulate()</a></code>.
</p>


<h3>References</h3>

<p>EFSA PPR Panel (EFSA Panel on Plant Protection Products and their Residues),
Ockleford C, Adriaanse P, Berny P, et al., 2018: <em>Scientific Opinion on the
state of the art of Toxicokinetic/Toxicodynamic (TKTD) effect models for
regulatory risk assessment of pesticides for aquatic organisms</em>. EFSA Journal 2018;
16(8):5377, 188 pp. <a href="https://doi.org/10.2903/j.efsa.2018.5377">doi:10.2903/j.efsa.2018.5377</a>
</p>


<h3>See Also</h3>

<p>Other GUTS-RED models: 
<code><a href="#topic+GUTS_RED_IT">GUTS_RED_IT</a>()</code>,
<code><a href="#topic+GUTS_RED_SD">GUTS_RED_SD</a>()</code>
</p>
<p>Other models: 
<code><a href="#topic+Algae-models">Algae-models</a></code>,
<code><a href="#topic+DEB-models">DEB-models</a></code>,
<code><a href="#topic+Lemna-models">Lemna-models</a></code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Myriophyllum-models">Myriophyllum-models</a></code>
</p>

<hr>
<h2 id='import_morse'>Import <code>morse</code> model parameters</h2><span id='topic+import_morse'></span><span id='topic+morse'></span>

<h3>Description</h3>

<p>Loads GUTS model parameters which were fitted by the morse package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>import_morse(
  fit,
  find_sd = TRUE,
  find_it = TRUE,
  reset_hb = TRUE,
  params = c("estim", "all"),
  mcmc_size,
  find.SD = deprecated(),
  find.IT = deprecated(),
  reset.hb = deprecated(),
  mcmc.size = deprecated(),
  file = deprecated()
)

morse(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="import_morse_+3A_fit">fit</code></td>
<td>
<p>Either a string with a file path to an <em>.Rdata</em> or <em>.RDS</em> file
containing a <em>morse</em> fit, or a <em>morse</em> fit object itself</p>
</td></tr>
<tr><td><code id="import_morse_+3A_find_sd">find_sd</code></td>
<td>
<p>a logical value. If <code>TRUE</code>, it will try to find fitted parameters of a <em>GUTS-RED-SD</em> model</p>
</td></tr>
<tr><td><code id="import_morse_+3A_find_it">find_it</code></td>
<td>
<p>a logical value. If <code>TRUE</code>, it will try to find fitted parameters of a <em>GUTS-RED-IT</em> model</p>
</td></tr>
<tr><td><code id="import_morse_+3A_reset_hb">reset_hb</code></td>
<td>
<p>a logical value. If <code>TRUE</code>, the background hazard rate <code>hb</code> is set to zero</p>
</td></tr>
<tr><td><code id="import_morse_+3A_params">params</code></td>
<td>
<p><code>character</code>, if set to <code>"estim"</code> then only the best-fit parameters are
imported, else all parameter sets in the MCM chains are returned</p>
</td></tr>
<tr><td><code id="import_morse_+3A_mcmc_size">mcmc_size</code></td>
<td>
<p>optional <code>integer</code>, sets the maximum number of imported parameter sets per MCMC.
By default, all MSMS parameter samples are imported.</p>
</td></tr>
<tr><td><code id="import_morse_+3A_find.sd">find.SD</code></td>
<td>
<p><em>deprecated</em><code style="white-space: pre;">&#8288;,&#8288;</code> alias for parameter <code>find_sd</code></p>
</td></tr>
<tr><td><code id="import_morse_+3A_find.it">find.IT</code></td>
<td>
<p><em>deprecated</em><code style="white-space: pre;">&#8288;,&#8288;</code> alias for parameter <code>find_it</code></p>
</td></tr>
<tr><td><code id="import_morse_+3A_reset.hb">reset.hb</code></td>
<td>
<p><em>deprecated</em><code style="white-space: pre;">&#8288;,&#8288;</code> alias for parameter <code>rest_hb</code></p>
</td></tr>
<tr><td><code id="import_morse_+3A_mcmc.size">mcmc.size</code></td>
<td>
<p><em>deprecated</em><code style="white-space: pre;">&#8288;,&#8288;</code> alias for parameter <code>mcmc_size</code></p>
</td></tr>
<tr><td><code id="import_morse_+3A_file">file</code></td>
<td>
<p><em>deprecated</em><code style="white-space: pre;">&#8288;,&#8288;</code> alias for parameter <code>fit</code></p>
</td></tr>
<tr><td><code id="import_morse_+3A_...">...</code></td>
<td>
<p>Arguments passed on to <code>import_morse()</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>list of <a href="#topic+parameter_set">parameter_set</a> objects
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>morse()</code>: deprecated alias
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'># import all parameter fits
try(import_morse("path/to/morse_fit.RData"))

# import parameters for a specific model
try(import_morse("path/to/morse_fit.RData", find_it=TRUE, find_sd=FALSE))

# modify model objects
try(models %&gt;% set_param(import_morse("path/to/morse_fit.RData")))
</code></pre>

<hr>
<h2 id='import_swash'>SWASH project exposure profile import</h2><span id='topic+import_swash'></span>

<h3>Description</h3>

<p>Read all TOXSWA files within a SWASH project directory.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>import_swash(swash_dir, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="import_swash_+3A_swash_dir">swash_dir</code></td>
<td>
<p>path to the SWASH project directory</p>
</td></tr>
<tr><td><code id="import_swash_+3A_...">...</code></td>
<td>
<p>arguments passed on to <code><a href="#topic+import_toxswa">import_toxswa()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of imported exposure series, see <code><a href="#topic+import_toxswa">import_toxswa()</a></code> for details
</p>

<hr>
<h2 id='import_toxswa'>Import <em>TOXSWA</em> exposure series</h2><span id='topic+import_toxswa'></span>

<h3>Description</h3>

<p>Read one or more <em>TOXSWA</em> exposure series from <em>TOXSWA</em>'s <code>.out</code> files. By default, the
concentration dissolved in water (<em>ConLiqWatLay</em>) at the end of the simulated waterbody
(i.e. at the maximum of the <em>x</em> dimension) is returned. The unit of the time
scale as well as of the imported model output variable can be scaled as needed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>import_toxswa(
  files,
  alias = NA,
  output_var = "ConLiqWatLay",
  output_unit = "ug/L",
  time_unit = "days",
  substance = NULL,
  split = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="import_toxswa_+3A_files">files</code></td>
<td>
<p>vector of strings with absolute or relative paths to files</p>
</td></tr>
<tr><td><code id="import_toxswa_+3A_alias">alias</code></td>
<td>
<p>optional vector with strings, will be used as an alias to identify
a TOXSWA series instead of its filename</p>
</td></tr>
<tr><td><code id="import_toxswa_+3A_output_var">output_var</code></td>
<td>
<p>character, single output variable from <em>TOXSWA</em> that is
imported, defaults to <em>ConLiqWatLay</em></p>
</td></tr>
<tr><td><code id="import_toxswa_+3A_output_unit">output_unit</code></td>
<td>
<p>character, target unit of the imported output variable,
defaults to <em>ug/L</em>, syntax must be compatible with <code><a href="units.html#topic+units">units::units()</a></code></p>
</td></tr>
<tr><td><code id="import_toxswa_+3A_time_unit">time_unit</code></td>
<td>
<p>character, target unit of the imported time scale,
defaults to <em>days</em>, syntax must be compatible with <code><a href="units.html#topic+units">units::units()</a></code></p>
</td></tr>
<tr><td><code id="import_toxswa_+3A_substance">substance</code></td>
<td>
<p>optional vector of characters, if set, only the substance
codes defined in this vector are imported</p>
</td></tr>
<tr><td><code id="import_toxswa_+3A_split">split</code></td>
<td>
<p>logical, if <code>TRUE</code> then one series will be returned for each
substance found in the <em>TOXSWA</em> files, else all substances per file will
be in one <em>data.frame</em>. Defaults to <code>TRUE</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The numerical time scale is shifted to always start at time zero (0.0).
Numerical columns of the returned <em>data.frame</em> objects will be of type
<a href="units.html#topic+units">units::units</a>. Please be aware that the use of <code>units</code> objects may not be
supported by all functions in this package. However, <code><a href="#topic+set_times">set_times()</a></code> and
<code><a href="#topic+set_exposure">set_exposure()</a></code> can handle <code>units</code> objects safely.
</p>
<p>Incomplete list of alternative <em>TOXSWA</em> v5.5.3 output variables:
</p>

<ul>
<li> <p><em>ConLiqWatLay</em>: Concentration dissolved in water (g/m3)
</p>
</li>
<li> <p><em>ConLiqSed</em>: Concentration in pore water sediment (g/m3)
</p>
</li>
<li> <p><em>ConSysWatLay</em>: Total concentration in water (g/m3)
</p>
</li>
<li> <p><em>CntSorSusSol</em>: Content sorbed to suspended solids (g/kg)
</p>
</li>
<li> <p><em>CntSorSed</em>: Content sorbed to sediment (g/kg)
</p>
</li></ul>



<h3>Value</h3>

<p>list of <em>data.frame</em> objects with exposure series. Each <em>data.frame</em> has at
least three columns:
</p>

<ul>
<li> <p><code>time</code>: numerical time scale, always starts at zero
</p>
</li>
<li> <p><code>timestamp</code>: time as datetime objects such as <code>POSIXct</code>
</p>
</li>
<li><p> one or more additional columns for each imported substance
</p>
</li></ul>


<hr>
<h2 id='is_DEB'>Test if argument is a DEB model</h2><span id='topic+is_DEB'></span>

<h3>Description</h3>

<p>Test if argument is a DEB model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_DEB(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="is_DEB_+3A_x">x</code></td>
<td>
<p>vector of <code>EffectScenario</code> objects</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of <code>logical</code> values
</p>

<hr>
<h2 id='is_GUTS'>Test if argument is a GUTS model</h2><span id='topic+is_GUTS'></span><span id='topic+is_GUTS_IT'></span><span id='topic+is_GUTS_SD'></span>

<h3>Description</h3>

<p>Test if argument is a GUTS model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_GUTS(x)

is_GUTS_IT(x)

is_GUTS_SD(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="is_GUTS_+3A_x">x</code></td>
<td>
<p>vector of <code>EffectScenario</code> objects</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of <code>logical</code> values
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>is_GUTS_IT()</code>: Test if argument is a GUTS-IT model
</p>
</li>
<li> <p><code>is_GUTS_SD()</code>: Test if argument is a GUTS-IT model
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'># returns `TRUE`
is_GUTS(minnow_it)
is_GUTS(GUTS_RED_IT())

# returns `c(TRUE,TRUE,TRUE)`
is_GUTS(c(minnow_it, minnow_it, minnow_it))

# returns `FALSE`
is_GUTS_SD(minnow_it)
</code></pre>

<hr>
<h2 id='is_Lemna'>Test if argument is a Lemna model</h2><span id='topic+is_Lemna'></span>

<h3>Description</h3>

<p>Also returns <code>TRUE</code> for <code>LemnaThreshold</code> models
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_Lemna(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="is_Lemna_+3A_x">x</code></td>
<td>
<p>vector of <a href="#topic+scenarios">scenarios</a> objects</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of logical values
</p>


<h3>See Also</h3>

<p><code><a href="#topic+is_LemnaThreshold">is_LemnaThreshold()</a></code>
</p>

<hr>
<h2 id='is_LemnaThreshold'>Test if argument is a LemnaThreshold model</h2><span id='topic+is_LemnaThreshold'></span>

<h3>Description</h3>

<p>Test if argument is a LemnaThreshold model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_LemnaThreshold(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="is_LemnaThreshold_+3A_x">x</code></td>
<td>
<p>vector of <a href="#topic+scenarios">scenarios</a> objects</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of <code>logical</code> values
</p>


<h3>See Also</h3>

<p><code><a href="#topic+is_Lemna">is_Lemna()</a></code>
</p>

<hr>
<h2 id='is_scenario'>Test if argument is an effect scenario</h2><span id='topic+is_scenario'></span>

<h3>Description</h3>

<p>Supports vectorized arguments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_scenario(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="is_scenario_+3A_x">x</code></td>
<td>
<p>Some value or object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of <code>logical</code> values
</p>


<h3>Examples</h3>

<pre><code class='language-R'># returns `TRUE`
is_scenario(minnow_it)

# returns `FALSE`
is_scenario(list())

</code></pre>

<hr>
<h2 id='Lemna_Schmitt'>Lemna model (Schmitt et al. 2013)</h2><span id='topic+Lemna_Schmitt'></span><span id='topic+LemnaSchmitt-class'></span><span id='topic+LemnaSchmittScenario-class'></span><span id='topic+Lemna_SchmittThold'></span>

<h3>Description</h3>

<p>The model is a mechanistic combined toxicokinetic-toxicodynamic (TK/TD) and
growth model for the aquatic macrophytes <em>Lemna spp.</em>
The model simulates the development of <em>Lemna</em> biomass under laboratory and
environmental conditions and was developed by Schmitt <em>et al.</em> (2013). Growth
of the <em>Lemna</em> population is simulated on basis of photosynthesis and respiration
rates which are functions of environmental conditions.
The toxicodynamic sub-model describes the effects of growth-inhibiting
substances by a respective reduction in the photosynthesis rate based on
internal concentrations. This is the historical version of the Lemna model.
For current uses, we recommend the Lemna (SETAC) model, which is a more recent
version of the Schmitt model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Lemna_Schmitt(param, init)

Lemna_SchmittThold(param, init)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Lemna_Schmitt_+3A_param">param</code></td>
<td>
<p>optional named <code>list</code> or <code>vector</code> of model parameters</p>
</td></tr>
<tr><td><code id="Lemna_Schmitt_+3A_init">init</code></td>
<td>
<p>optional named numeric <code>vector</code> of initial state values</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Constructors to ease creation of scenarios based on the <em>Lemna</em> model by
Schmitt <em>et al.</em> (2013).
A variant of this <em>Lemna</em> model, <code>Lemna_SchmittThold()</code>, provides an additional
cumulative exposure threshold parameter. The Lemna biomass stops growing
if the integral of exposure over time exceeds the threshold. The integral
of exposure is internally accounted for by an additional state variable
<code>AUC</code> (Area Under Curve).
</p>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+LemnaSchmitt-class">LemnaSchmitt</a>
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>Lemna_SchmittThold()</code>: model variant with cumulative exposure threshold
</p>
</li></ul>


<h3>State variables</h3>

<p>The following list describes the default names and standard units of the model's
state variables:
</p>

<ul>
<li><p> BM, g_dw/m2, dry weight biomass per square meter
</p>
</li>
<li><p> E, -, effect [0,1]
</p>
</li>
<li><p> M_int, ug, internal toxicant mass
</p>
</li>
<li><p> AUC, ug/L, cumulative exposure (<strong>only</strong> for <code>LemnaThreshold</code> model)
</p>
</li></ul>

<p>Biomass (BM) and internal toxicant mass (M_int) are initialized to zero by
default. See <code><a href="#topic+set_init">set_init()</a></code> on how to set the initial states.
</p>


<h3>Model parameters</h3>

<p>The following model parameters are required:
</p>

<ul>
<li><p> Fate and biomass
</p>

<ul>
<li> <p><code>k_phot_fix</code>, logical, TRUE then k_phot_max is not changed by environmental factors, else FALSE
</p>
</li>
<li> <p><code>k_phot_max</code>, 1/d, maximum photosynthesis rate
</p>
</li>
<li> <p><code>k_resp</code>, 1/d, respiration rate
</p>
</li>
<li> <p><code>k_loss</code>, 1/d, rate of loss (e.g. flow rate)
</p>
</li>
<li> <p><code>mass_per_frond</code>, g_dw/frond, dry weight per frond
</p>
</li>
<li> <p><code>BMw2BMd</code>, g_fw/g_dw, Fresh weight/dry weight
</p>
</li></ul>

</li>
<li><p> Effect
</p>

<ul>
<li> <p><code>Emax</code>, -, maximum effect [0,1]
</p>
</li>
<li> <p><code>EC50</code>, ug/L, midpoint of effect curve
</p>
</li>
<li> <p><code>b</code>, -, slope of effect curve
</p>
</li></ul>

</li>
<li><p> Toxicokinetics
</p>

<ul>
<li> <p><code>P_up</code>, cm/d, Permeability for uptake
</p>
</li>
<li> <p><code>AperBM</code>, cm2/g_dw, A_leaf / d_leaf = 1/d_leaf (for circular disc, d=0.05 cm)
</p>
</li>
<li> <p><code>Kbm</code>, -, Biomass(fw) : water partition coefficient
</p>
</li>
<li> <p><code>P_Temp</code>, logical, TRUE to enable temperature dependence of cuticle permeability, else FALSE
</p>
</li>
<li> <p><code>MolWeight</code>, g/mol, Molmass of molecule (determines Q10_permeability)
</p>
</li></ul>

</li>
<li><p> Temperature dependence
</p>

<ul>
<li> <p><code>Tmin</code>, deg C, minimum temperature for growth
</p>
</li>
<li> <p><code>Tmax</code>, deg C, maximum temperature for growth
</p>
</li>
<li> <p><code>Topt</code>, deg C, optimal temperature for growth
</p>
</li>
<li> <p><code>t_ref</code>, deg C, reference temperature for respiration rate
</p>
</li>
<li> <p><code>Q10</code>, -, temperature dependence factor for respiration rate
</p>
</li></ul>

</li>
<li><p> Light dependence
</p>

<ul>
<li> <p><code>k_0</code>, 1/d, light dependence: intercept of linear part
</p>
</li>
<li> <p><code>a_k</code>, (1/d)/(kJ/m2.d), light dependence: slope of linear part
</p>
</li></ul>

</li>
<li><p> Phosphorus dependence (Hill like dep.)
</p>

<ul>
<li> <p><code>C_P</code>, mg/L, phosphorus concentration in water
</p>
</li>
<li> <p><code>CP50</code>, mg/L, phosphorus conc. where growth rate is halfed
</p>
</li>
<li> <p><code>a_p</code>, -, Hill coefficient
</p>
</li>
<li> <p><code>KiP</code>, mg/L, p-inhibition constant for very high p-conc.
</p>
</li></ul>

</li>
<li><p> Nitrogen dependence (Hill like dep.)
</p>

<ul>
<li> <p><code>C_N</code>, mg/L, nitrogen concentration in water
</p>
</li>
<li> <p><code>CN50</code>, mg/L, n-conc. where growth rate is halfed
</p>
</li>
<li> <p><code>a_N</code>, -, Hill coefficient
</p>
</li>
<li> <p><code>KiN</code>, mg/L, n-inhibition constant for very high p-conc.
</p>
</li></ul>

</li>
<li><p> Density dependence
</p>

<ul>
<li> <p><code>BM50</code>, g_dw/m2, cut off BM
</p>
</li></ul>

</li></ul>

<p>The <code>Lemna_SchmittThold</code> model requires the following additional parameter:
</p>

<ul>
<li> <p><code>threshold</code>, ug/L, cumulative exposure threshold
</p>
</li></ul>



<h3>Forcings</h3>

<p>Besides exposure, the Lemna model requires two environmental properties as
time-series input: global radiation (<code>rad</code>, kJ/m2.d) and temperature (<code>temp</code>, deg C).
Forcings time-series are represented by <code>data.frame</code> objects consisting of two
columns. The first for time and the second for the environmental factor in question.
</p>
<p>Entries of the <code>data.frame</code> need to be ordered chronologically. A time-series
can consist of only a single row; in this case it will represent constant
environmental conditions. See <a href="#topic+scenarios">scenarios</a> for more details.
</p>


<h3>Effects</h3>

<p>Supported effect endpoints include <em>BM</em> (biomass) and <em>r</em> (average
growth rate during simulation). The effect on biomass is calculated from
the last state of a simulation. Be aware that endpoint <em>r</em> is incompatible
with frond transfers.
</p>


<h3>Parameter boundaries</h3>

<p>Default values for parameter boundaries are set for all parameters by expert
judgement, for calibration purposes. Values can be access from the object, and
defaults overwritten.
</p>


<h3>Simulation output</h3>

<p>Simulation results will contain two additional columns besides state variables:
</p>

<ul>
<li> <p><code>C_int</code>, ug/L, internal concentration of toxicant
</p>
</li>
<li> <p><code>FrondNo</code>, -, number of fronds
</p>
</li></ul>

<p>It is possible to amend the output of <code><a href="#topic+simulate">simulate()</a></code> with additional model
quantities that are not state variables, for e.g. debugging purposes or to
analyze model behavior. To enable or disable additional outputs, use the
optional argument <code>nout</code> of <code><a href="#topic+simulate">simulate()</a></code>, see examples below. <code>nout=1</code>
enables reporting of internal concentration (C_int), <code>nout=14</code> enables all
additional outputs, and <code>nout=0</code> will disable additional outputs.
</p>
<p>The available output levels are as follows:
</p>

<ul>
<li> <p><code>nout &gt;= 1</code>: <code>C_int</code>, internal concentration (ug/L)
</p>
</li>
<li> <p><code>nout &gt;= 2</code>: <code>FrondNo</code>, number of fronds (-)
</p>
</li>
<li> <p><code>nout &gt;= 3</code>: <code>C_int_u</code>, unbound internal concentration (ug/l)
</p>
</li>
<li><p> Growth and TK/TD
</p>

<ul>
<li> <p><code>nout &gt;= 4</code>: <code>BM_fresh</code>, fresh weight biomass (g_fw/m2)
</p>
</li>
<li> <p><code>nout &gt;= 5</code>: <code>k_photo_eff</code>, current photosynthesis rate (1/d)
</p>
</li>
<li> <p><code>nout &gt;= 6</code>: <code>k_resp_eff</code>, current respiration rate (1/d)
</p>
</li>
<li> <p><code>nout &gt;= 7</code>: <code>f_Eff</code>, toxic effect factor (-)
</p>
</li>
<li> <p><code>nout &gt;= 8</code>: <code>P_up_eff</code>, current permeability for uptake (cm/d)
</p>
</li></ul>

</li>
<li><p> Environmental variables
</p>

<ul>
<li> <p><code>nout &gt;= 9</code>: <code>actConc</code>, current toxicant concentration in surrounding medium (ug/L)
</p>
</li>
<li> <p><code>nout &gt;= 10</code>: <code>actTemp</code>, current environmental temperature (deg C)
</p>
</li>
<li> <p><code>nout &gt;= 11</code>: <code>actRad</code>, current environmental radiation (kJ/m2.d)
</p>
</li></ul>

</li>
<li><p> Derivatives
</p>

<ul>
<li> <p><code>nout &gt;= 12</code>: <code style="white-space: pre;">&#8288;d BM/dt&#8288;</code>, current change in state variable BM
</p>
</li>
<li> <p><code>nout &gt;= 13</code>: <code style="white-space: pre;">&#8288;d E/dt&#8288;</code>, current change in effect
</p>
</li>
<li> <p><code>nout &gt;= 14</code>: <code style="white-space: pre;">&#8288;d M_int/dt&#8288;</code>, current change in internal toxicant mass
</p>
</li></ul>

</li></ul>



<h3>Solver settings</h3>

<p>The arguments to ODE solver <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code> control how model equations
are numerically integrated. The settings influence stability of the numerical
integration scheme as well as numerical precision of model outputs. Generally, the
default settings as defined by <em>deSolve</em> are used, but all <em>deSolve</em> settings
can be modified in <em>cvasi</em> workflows by the user, if needed. Please refer
to e.g. <code><a href="#topic+simulate">simulate()</a></code> on how to pass arguments to <em>deSolve</em> in <em>cvasi</em>
workflows.
</p>
<p>Some default settings of <em>deSolve</em> were adapted for this model by expert
judgement to enable precise, but also computationally efficient, simulations
for most model parameters. These settings can be modified by the user,
if needed:
</p>

<ul>
<li> <p><code>hmax = 0.1</code><br>
Maximum step length in time suitable for most simulations.
</p>
</li></ul>



<h3>Biomass transfer</h3>

<p>Models supporting biomass transfer can be instructed to move a fixed amount
of biomass to a new medium after a period of time. This feature replicates
a procedure occurring in e.g. <em>Lemna</em> effect studies and may be necessary to
recreate study results.
</p>
<p>The biomass transfer feature assumes that always a fixed amount of
biomass is transferred. Transfers can occur at any fixed point in time or
in regular intervals. During a transfer, the biomass is reset to the
transferred amount and additional compartments can be scaled 1:1 accordingly,
to e.g. reflect the change in internal toxicant mass when biomass is modified.
Transfer settings can be modified using <code><a href="#topic+set_transfer">set_transfer()</a></code>.
</p>
<p>If a transfer occurs, simulation results of that time point will report the model state
<strong>before</strong> the transfer. Be aware that if transfers are defined using the
<code>interval</code> argument, the transfers will always occur relative to time point
zero (<code>t = 0</code>). As an example, setting a regular transfer of seven days,
<code>interval =  7</code>, will result at transfers occurring at time points which are
integer multiplicates of seven, such as <code>t=0</code>, <code>t=7</code>, <code>t=14</code> and so forth.
The starting and end times of a scenario do not influece <strong>when</strong> a regular
transfer occurs, only <strong>if</strong> it occurs.
</p>


<h3>References</h3>

<p>Schmitt W., Bruns E., Dollinger M., and Sowig P., 2013:
<em>Mechanistic TK/TD-model simulating the effect of growth inhibitors on
Lemna populations</em>. Ecol Model 255, pp. 1-10. <a href="https://doi.org/10.1016/j.ecolmodel.2013.01.017">doi:10.1016/j.ecolmodel.2013.01.017</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Lemna-models">Lemna-models</a>, <a href="#topic+Macrophyte-models">Macrophyte-models</a>, <a href="#topic+Transferable">Transferable</a>, <a href="#topic+Scenarios">Scenarios</a>
</p>
<p>Other Lemna models: 
<code><a href="#topic+Lemna-models">Lemna-models</a></code>,
<code><a href="#topic+Lemna_SETAC">Lemna_SETAC</a>()</code>
</p>
<p>Other macrophyte models: 
<code><a href="#topic+Lemna_SETAC">Lemna_SETAC</a>()</code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Myrio">Myrio</a>()</code>,
<code><a href="#topic+Myrio_log">Myrio_log</a>()</code>
</p>

<hr>
<h2 id='Lemna_SETAC'>Lemna model (Klein et al. 2021)</h2><span id='topic+Lemna_SETAC'></span><span id='topic+LemnaSetacScenario-class'></span><span id='topic+LemnaSetac-class'></span>

<h3>Description</h3>

<p>The model was described and published by the SETAC Europe Interest Group
Effect Modeling (Klein et al. 2022). It is based on the <em>Lemna</em> model
by Schmitt (2013). The model is a mechanistic combined
toxicokinetic-toxicodynamic (TK/TD) and growth model for the aquatic
macrophytes <em>Lemna spp.</em>. The model simulates the development of Lemna biomass
under laboratory and environmental conditions. Growth of the Lemna population
is simulated on basis of photosynthesis and respiration rates which are
functions of environmental conditions. The toxicodynamic sub-model describes
the effects of growth-inhibiting substances by a respective reduction in the
photosynthesis rate based on internal concentrations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Lemna_SETAC()
</code></pre>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+LemnaSetac-class">LemnaSetac</a>
</p>


<h3>State variables</h3>

<p>The model has two state variables:
</p>

<ul>
<li> <p><code>BM</code>, Biomass (g dw m-2)
</p>
</li>
<li> <p><code>M_int</code>, Mass of toxicant in plant population (mass per m2, e.g. ug m-2)
</p>
</li></ul>



<h3>Model parameters</h3>


<ul>
<li><p> Growth model
</p>

<ul>
<li> <p><code>k_photo_fixed</code>, Model switch for unlimited growth conditions (TRUE/FALSE)
</p>
</li>
<li> <p><code>k_photo_max</code>, Maximum photosynthesis rate (d-1)
</p>
</li>
<li> <p><code>k_loss</code>, Reference loss rate (d-1)
</p>
</li>
<li> <p><code>BM_threshold</code>, Lower biomass abundance threshold,  (g dw m-2)
</p>
</li>
<li> <p><code>BM_min</code>, Reservoir for biomass recovery,  (g dw m-2)
</p>
</li></ul>

</li>
<li><p> Temperature response of photosynthesis
</p>

<ul>
<li> <p><code>T_opt</code>, Optimum growth temperature (°C)
</p>
</li>
<li> <p><code>T_min</code>, Minimum growth temperature (°C)
</p>
</li>
<li> <p><code>T_max</code>, Maximum growth temperature (°C)
</p>
</li></ul>

</li>
<li><p> Temperature response of biomass loss rate
</p>

<ul>
<li> <p><code>Q10</code>, Temperature coefficient (-)
</p>
</li>
<li> <p><code>T_ref</code>, Reference temperature for response=1 (°C)
</p>
</li></ul>

</li>
<li><p> Irradiance reponse of photosynthesis
</p>

<ul>
<li> <p><code>alpha</code>, Slope of irradiance response (m2 d kJ-1)
</p>
</li>
<li> <p><code>beta</code>, Intercept of irradiance response (-)
</p>
</li></ul>

</li>
<li><p> Nutrient response of photosynthesis
</p>

<ul>
<li> <p><code>N_50</code>, Half-saturation constant of Nitrogen (mg N L-1)
</p>
</li>
<li> <p><code>P_50</code>, Half-saturation constant of Phosphorus (mg P L-1)
</p>
</li></ul>

</li>
<li><p> Density dependence of photosynthesis
</p>

<ul>
<li> <p><code>BM_L</code>, Carrying capacity (g dw m-2)
</p>
</li></ul>

</li>
<li><p> Concentration response (Toxicodynamics)
</p>

<ul>
<li> <p><code>EC50_int</code>, Internal concentration resulting in 50% effect (ug L-1)
</p>
</li>
<li> <p><code>E_max</code>, Maximum inhibition (-)
</p>
</li>
<li> <p><code>b</code>, Slope parameter (-)
</p>
</li></ul>

</li>
<li><p> Internal concentration (Toxicokinetics)
</p>

<ul>
<li> <p><code>P</code>, Permeability (cm d-1)
</p>
</li>
<li> <p><code>r_A_DW</code>, Area per dry-weight ratio (cm2 g-1)
</p>
</li>
<li> <p><code>r_FW_DW</code>, Fresh weight per dry weight ratio (-)
</p>
</li>
<li> <p><code>r_FW_V</code>, Fresh weight density (g cm-3)
</p>
</li>
<li> <p><code>r_DW_FN</code>, Dry weight per frond ratio  (g dw)
</p>
</li>
<li> <p><code>K_pw</code>, Partitioning coefficient plant:water (-)
</p>
</li>
<li> <p><code>k_met</code>, Metabolisation rate (d-1)
</p>
</li></ul>

</li></ul>



<h3>Forcings</h3>

<p>Besides exposure, the model requires four environmental properties as
time-series input:
</p>

<ul>
<li> <p><code>tmp</code>, temperature (°C)
</p>
</li>
<li> <p><code>irr</code>, irradiance (kJ m-2 d-1)
</p>
</li>
<li> <p><code>P</code>, Phosphorus concentration (mg P L-1)
</p>
</li>
<li> <p><code>N</code>, Nitrogen concentration (mg N L-1)
</p>
</li></ul>

<p>Forcings time-series are represented by <code>data.frame</code> objects consisting of two
columns. The first for time and the second for the environmental factor in question.
</p>
<p>Entries of the <code>data.frame</code> need to be ordered chronologically. A time-series
can consist of only a single row; in this case it will represent constant
environmental conditions. See <a href="#topic+scenarios">scenarios</a> for more details.
</p>


<h3>Effects</h3>

<p>Supported effect endpoints include <em>BM</em> (biomass) and <em>r</em> (average
growth rate during simulation). The effect on biomass is calculated from
the last state of a simulation. Be aware that endpoint <em>r</em> is incompatible
with biomass transfers.
</p>


<h3>Simulation output</h3>

<p>For reasons of convenience, the return value contains by default two additional
variables derived from simulation results: the internal concentration <code>C_int</code>
as well as the number of fronds <code>FrondNo</code>. These can be disabled by setting
the argument <code>nout = 0</code>.
</p>
<p>The available output levels are as follows:
</p>

<ul>
<li> <p><code>nout &gt;= 1</code>: <code>C_int</code>, internal concentration (mass per volume)
</p>
</li>
<li> <p><code>nout &gt;= 2</code>: <code>FrondNo</code>, frond number (-)
</p>
</li>
<li><p> Response functions
</p>

<ul>
<li> <p><code>nout &gt;= 3</code>: <code>f_loss</code>, respiration dependency function (-)
</p>
</li>
<li> <p><code>nout &gt;= 4</code>: <code>f_photo</code>, photosynthesis dependency function (-)
</p>
</li>
<li> <p><code>nout &gt;= 5</code>: <code>fT_photo</code>, temperature response of photosynthesis (-)
</p>
</li>
<li> <p><code>nout &gt;= 6</code>: <code>fI_photo</code>, irradiance response of photosynthesis (-)
</p>
</li>
<li> <p><code>nout &gt;= 7</code>: <code>fP_photo</code>, phosphorus response of photosynthesis (-)
</p>
</li>
<li> <p><code>nout &gt;= 8</code>: <code>fN_photo</code>, nitrogen response of photosynthesis (-)
</p>
</li>
<li> <p><code>nout &gt;= 9</code>: <code>fBM_photo</code>, density response of photosynthesis (-)
</p>
</li>
<li> <p><code>nout &gt;= 10</code>: <code>fCint_photo</code>, concentration response of photosynthesis (-)
</p>
</li></ul>

</li>
<li><p> Environmental variables
</p>

<ul>
<li> <p><code>nout &gt;= 11</code>: <code>C_int_unb</code>, unbound internal concentration (mass per volume)
</p>
</li>
<li> <p><code>nout &gt;= 12</code>: <code>C_ext</code>, external concentration (mass per volume)
</p>
</li>
<li> <p><code>nout &gt;= 13</code>: <code>Tmp</code>, temperature (deg C)
</p>
</li>
<li> <p><code>nout &gt;= 14</code>: <code>Irr</code>, irradiance (kJ m-2 d-1)
</p>
</li>
<li> <p><code>nout &gt;= 15</code>: <code>Phs</code>, Phosphorus concentration (mg P L-1)
</p>
</li>
<li> <p><code>nout &gt;= 16</code>: <code>Ntr</code>, Nitrogen concentration (mg N L-1)
</p>
</li></ul>

</li>
<li><p> Derivatives
</p>

<ul>
<li> <p><code>nout &gt;= 17</code>: <code>dBM</code>, biomass derivative (g dw m-2 d-1)
</p>
</li>
<li> <p><code>nout &gt;= 18</code>: <code>dM_int</code>, mass of toxicant in plants derivative (mass per m2 d-1)
</p>
</li></ul>

</li></ul>



<h3>Solver settings</h3>

<p>The arguments to ODE solver <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code> control how model equations
are numerically integrated. The settings influence stability of the numerical
integration scheme as well as numerical precision of model outputs. Generally, the
default settings as defined by <em>deSolve</em> are used, but all <em>deSolve</em> settings
can be modified in <em>cvasi</em> workflows by the user, if needed. Please refer
to e.g. <code><a href="#topic+simulate">simulate()</a></code> on how to pass arguments to <em>deSolve</em> in <em>cvasi</em>
workflows.
</p>
<p>Some default settings of <em>deSolve</em> were adapted for this model by expert
judgement to enable precise, but also computationally efficient, simulations
for most model parameters. These settings can be modified by the user,
if needed:
</p>

<ul>
<li> <p><code>hmax = 0.1</code><br>
Maximum step length in time suitable for most simulations.
</p>
</li></ul>



<h3>Biomass transfer</h3>

<p>Models supporting biomass transfer can be instructed to move a fixed amount
of biomass to a new medium after a period of time. This feature replicates
a procedure occurring in e.g. <em>Lemna</em> effect studies and may be necessary to
recreate study results.
</p>
<p>The biomass transfer feature assumes that always a fixed amount of
biomass is transferred. Transfers can occur at any fixed point in time or
in regular intervals. During a transfer, the biomass is reset to the
transferred amount and additional compartments can be scaled 1:1 accordingly,
to e.g. reflect the change in internal toxicant mass when biomass is modified.
Transfer settings can be modified using <code><a href="#topic+set_transfer">set_transfer()</a></code>.
</p>
<p>If a transfer occurs, simulation results of that time point will report the model state
<strong>before</strong> the transfer. Be aware that if transfers are defined using the
<code>interval</code> argument, the transfers will always occur relative to time point
zero (<code>t = 0</code>). As an example, setting a regular transfer of seven days,
<code>interval =  7</code>, will result at transfers occurring at time points which are
integer multiplicates of seven, such as <code>t=0</code>, <code>t=7</code>, <code>t=14</code> and so forth.
The starting and end times of a scenario do not influece <strong>when</strong> a regular
transfer occurs, only <strong>if</strong> it occurs.
</p>


<h3>References</h3>

<p>Klein J., Cedergreen N., Heine S., Reichenberger S., Rendal C.,
Schmitt W., Hommen U., 2021: <em>Refined description of the Lemna TKTD growth model
based on Schmitt et al. (2013) - equation system and default parameters</em>.
Report of the working group <em>Lemna</em> of the SETAC Europe Interest Group Effect
Modeling. Version 1, uploaded on 22. Sept. 2021.
https://www.setac.org/group/effect-modeling.html
</p>
<p>Schmitt W., Bruns E., Dollinger M., and Sowig P., 2013:
<em>Mechanistic TK/TD-model simulating the effect of growth inhibitors on
Lemna populations</em>. Ecol Model 255, pp. 1-10. <a href="https://doi.org/10.1016/j.ecolmodel.2013.01.017">doi:10.1016/j.ecolmodel.2013.01.017</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Lemna-models">Lemna-models</a>, <a href="#topic+Macrophyte-models">Macrophyte-models</a>, <a href="#topic+Transferable">Transferable</a>, <a href="#topic+Scenarios">Scenarios</a>
</p>
<p>Other Lemna models: 
<code><a href="#topic+Lemna-models">Lemna-models</a></code>,
<code><a href="#topic+Lemna_Schmitt">Lemna_Schmitt</a>()</code>
</p>
<p>Other macrophyte models: 
<code><a href="#topic+Lemna_Schmitt">Lemna_Schmitt</a>()</code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Myrio">Myrio</a>()</code>,
<code><a href="#topic+Myrio_log">Myrio_log</a>()</code>
</p>

<hr>
<h2 id='Lemna-models'>Lemna models</h2><span id='topic+Lemna-models'></span><span id='topic+Lemna-class'></span>

<h3>Description</h3>

<p>Overview of supported <em>Lemna</em> models
</p>


<h3>Details</h3>


<ul>
<li> <p><code><a href="#topic+Lemna_Schmitt">Lemna_Schmitt()</a></code> by Schmitt <em>et al.</em> (2013)
</p>
</li>
<li> <p><code><a href="#topic+Lemna_SETAC">Lemna_SETAC()</a></code> by Klein <em>et al.</em> (2021)
</p>
</li></ul>



<h3>Biomass transfer</h3>

<p>Models supporting biomass transfer can be instructed to move a fixed amount
of biomass to a new medium after a period of time. This feature replicates
a procedure occurring in e.g. <em>Lemna</em> effect studies and may be necessary to
recreate study results.
</p>
<p>The biomass transfer feature assumes that always a fixed amount of
biomass is transferred. Transfers can occur at any fixed point in time or
in regular intervals. During a transfer, the biomass is reset to the
transferred amount and additional compartments can be scaled 1:1 accordingly,
to e.g. reflect the change in internal toxicant mass when biomass is modified.
Transfer settings can be modified using <code><a href="#topic+set_transfer">set_transfer()</a></code>.
</p>
<p>If a transfer occurs, simulation results of that time point will report the model state
<strong>before</strong> the transfer. Be aware that if transfers are defined using the
<code>interval</code> argument, the transfers will always occur relative to time point
zero (<code>t = 0</code>). As an example, setting a regular transfer of seven days,
<code>interval =  7</code>, will result at transfers occurring at time points which are
integer multiplicates of seven, such as <code>t=0</code>, <code>t=7</code>, <code>t=14</code> and so forth.
The starting and end times of a scenario do not influece <strong>when</strong> a regular
transfer occurs, only <strong>if</strong> it occurs.
</p>


<h3>See Also</h3>

<p><a href="#topic+Macrophyte-models">Macrophyte-models</a>
</p>
<p>Other Lemna models: 
<code><a href="#topic+Lemna_SETAC">Lemna_SETAC</a>()</code>,
<code><a href="#topic+Lemna_Schmitt">Lemna_Schmitt</a>()</code>
</p>
<p>Other models: 
<code><a href="#topic+Algae-models">Algae-models</a></code>,
<code><a href="#topic+DEB-models">DEB-models</a></code>,
<code><a href="#topic+GUTS-RED-models">GUTS-RED-models</a></code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Myriophyllum-models">Myriophyllum-models</a></code>
</p>

<hr>
<h2 id='lik_profile'>Likelihood profiling</h2><span id='topic+lik_profile'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>
<p>The aim of the function is two-fold: 1) estimate a 95% confidence
around each parameter of a calibrated model, and 2) see if perhaps a local minimum was found rather
than a global minimum. To achieve this, the likelihood profiling goes through
every parameter one by one. For each parameter,
the model is sequentially refit with the parameter value set to
increasingly lower and higher values, and the likelihood of the model given the
data calculated (using <code><a href="#topic+log_lik">log_lik()</a></code>). The likelihood is then compared
to the likelihood of the original model (using a likelihood ratio). This leads
to the development of a likelihood profile, from which a plot a 95%
confidence interval for the parameter is derived.
</p>
<p>The idea of the function is a variable stepwise algorithm:
When the likelihood ratio changes very little (less than <code>l_crit_min</code>), the stepsize is
increased (up to a maximum, specified by <code>f_step_max</code>). When the lik.
ratio changes too much (more than <code>l_crit_max</code>), the algorithm tries again
with a smaller stepsize (also bound to a minimum: <code>f_step_min</code>). Note that
the stepsize is used as a fraction of the parameter value that is tried.
To prevent very small stepsizes when the value goes towards zero (as can
be the case for effect thresholds), an absolute minimum
stepsize (<code>f_step_abs</code>), which is specified as a fraction of the best
parameter value (<code>Xhat</code>) (unless it is zero, then algoritm takes
something small).
</p>
<p>The function was inspired by a MatLab BYOM v.6.8 procedure, created by
Tjalling Jager. For details, please refer to BYOM (http://debtox.info/byom.html)
as well as Jager (2021).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lik_profile(
  x,
  par,
  output,
  data = NULL,
  bounds = NULL,
  refit = TRUE,
  type = c("coarse", "fine"),
  break_prof = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lik_profile_+3A_x">x</code></td>
<td>
<p>either a single <a href="#topic+scenario">scenario</a> or a list of <a href="#topic+caliset">caliset</a> objects</p>
</td></tr>
<tr><td><code id="lik_profile_+3A_par">par</code></td>
<td>
<p>named vector - parameters (names and values) to be profiled</p>
</td></tr>
<tr><td><code id="lik_profile_+3A_output">output</code></td>
<td>
<p>character vector, name of output column of <code><a href="#topic+simulate">simulate()</a></code> that
is used in calibration</p>
</td></tr>
<tr><td><code id="lik_profile_+3A_data">data</code></td>
<td>
<p>only needed if <code>x</code> is a <a href="#topic+scenario">scenario</a></p>
</td></tr>
<tr><td><code id="lik_profile_+3A_bounds">bounds</code></td>
<td>
<p>optional list of lists (including lower and upper bound): uses defaults in <code>x</code> object, but
can be overwritten here (e.g. bounds &lt;- list(k_resp = list(0,10), k_phot_max = list(0,30)) )</p>
</td></tr>
<tr><td><code id="lik_profile_+3A_refit">refit</code></td>
<td>
<p>if 'TRUE' (default), refit if a better minimum is found</p>
</td></tr>
<tr><td><code id="lik_profile_+3A_type">type</code></td>
<td>
<p>&quot;fine&quot; or &quot;coarse&quot; (default) likelihood profiling</p>
</td></tr>
<tr><td><code id="lik_profile_+3A_break_prof">break_prof</code></td>
<td>
<p>if 'TRUE' (default), stop the profiling if a better optimum is located</p>
</td></tr>
<tr><td><code id="lik_profile_+3A_...">...</code></td>
<td>
<p>additional parameters passed on to <code><a href="stats.html#topic+optim">stats::optim()</a></code> and <code><a href="#topic+calibrate">calibrate()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing, for each parameter profiled, the likelihood
profiling results as a dataframe;
the 95% confidence interval; the original parameter value; the likelihood plot object; and
the recalibrated parameter values (in case a lower optimum was found)
</p>


<h3>References</h3>

<p>Jager T, 2021. Robust Likelihood-Based Optimization and Uncertainty Analysis
of Toxicokinetic-Toxicodynamic Models. Integrated Environmental Assessment and
Management 17:388-397. <a href="https://doi.org/10.1002/ieam.4333">doi:10.1002/ieam.4333</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example with Lemna model - physiological params
library(dplyr)

# exposure - control run
exp &lt;- Schmitt2013 %&gt;%
  filter(ID == "T0") %&gt;%
  select(time=t, conc)

# observations - control run
obs &lt;- Schmitt2013 %&gt;%
  filter(ID == "T0") %&gt;%
   select(t, BM=obs)

# update metsulfuron
myscenario &lt;- metsulfuron %&gt;%
  set_param(c(k_phot_fix = TRUE,Emax = 1)) %&gt;%
  set_init(c(BM = 12)) %&gt;%
  set_exposure(exp)

fit &lt;- calibrate(
  x = myscenario,
  par = c(k_phot_max = 1),
  data = obs,
  output = "BM",
  lower=0,
  upper=1,
  method="Brent"
)

# Likelihood profiling

res &lt;- lik_profile(
  x = myscenario,
  data = obs,
  output = "BM",
  par = fit$par,
  bounds = list(
    k_phot_max = list(0, 30)
  ),
  refit = FALSE,
  type = "fine",
  method = "Brent"
)
# plot
plot_lik_profile(res)


</code></pre>

<hr>
<h2 id='log_enable'>Start and stop logging</h2><span id='topic+log_enable'></span><span id='topic+log_disable'></span>

<h3>Description</h3>

<p>Start and stop logging
</p>


<h3>Usage</h3>

<pre><code class='language-R'>log_enable(file = NULL, append = TRUE, envir = parent.frame())

log_disable()
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="log_enable_+3A_file">file</code></td>
<td>
<p><code>character</code>, file name or path to a log file</p>
</td></tr>
<tr><td><code id="log_enable_+3A_append">append</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code> output will be appended to an existing log file,
otherwise the log file will be replaced</p>
</td></tr>
<tr><td><code id="log_enable_+3A_envir">envir</code></td>
<td>
<p>log will be automatically disabled if <code>environment</code> is exited,
set to <code>NULL</code> to disable</p>
</td></tr>
</table>


<h3>Value</h3>

<p>no return value
</p>

<hr>
<h2 id='log_envir'>Log R environment properties</h2><span id='topic+log_envir'></span>

<h3>Description</h3>

<p>Log R environment properties
</p>


<h3>Usage</h3>

<pre><code class='language-R'>log_envir()
</code></pre>


<h3>Value</h3>

<p>no return value
</p>

<hr>
<h2 id='log_lik'>Calculate log likelihood</h2><span id='topic+log_lik'></span>

<h3>Description</h3>

<p>Calculates the sum of log likelihoods of each observation given
the model parameterization (considering a normal distribution around the prediction
for each datapoint)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>log_lik(npars, obs, pred)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="log_lik_+3A_npars">npars</code></td>
<td>
<p>named numeric vector of parameters that the model was calibrated on</p>
</td></tr>
<tr><td><code id="log_lik_+3A_obs">obs</code></td>
<td>
<p>numeric vector of observed values</p>
</td></tr>
<tr><td><code id="log_lik_+3A_pred">pred</code></td>
<td>
<p>numeric vector of predicted values</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the log likelihood value
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# observations
obs &lt;- c(12, 38, 92, 176, 176, 627, 1283, 2640)
# intercept, a, and slope, b, of a Poisson regression fitted through obs
pars &lt;- c(a = 2, b = 0.73)
# predictions with the Poisson regression
pred &lt;- c(15.43, 32.15, 66.99, 139.57, 290.82, 605.94, 1262.52, 2630.58)
# example plot
plot(seq(1:length(obs)), obs)
lines(seq(1:length(obs)), pred)
log_lik(
  npars = length(pars),
  obs = obs,
  pred = pred
)

</code></pre>

<hr>
<h2 id='log_msg'>Add a log message</h2><span id='topic+log_msg'></span>

<h3>Description</h3>

<p>Message will only appear in the console or in log file if logging was
enabled using <code>log_enable()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>log_msg(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="log_msg_+3A_...">...</code></td>
<td>
<p>elements will be concatenated using <code>paste0()</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>no return value
</p>


<h3>Examples</h3>

<pre><code class='language-R'>log_msg("this message will not appear")

log_enable()
log_msg("this message will appear")
log_msg("a number of ","elements to ",42," concatenate")
</code></pre>

<hr>
<h2 id='log_scenarios'>Log scenario properties</h2><span id='topic+log_scenarios'></span>

<h3>Description</h3>

<p>Log scenario properties
</p>


<h3>Usage</h3>

<pre><code class='language-R'>log_scenarios(x, header = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="log_scenarios_+3A_x">x</code></td>
<td>
<p>vector of <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="log_scenarios_+3A_header">header</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code> a header line will be printed</p>
</td></tr>
</table>


<h3>Value</h3>

<p>unmodified argument <code>x</code>
</p>

<hr>
<h2 id='Macrophyte-models'>Macrophyte models</h2><span id='topic+Macrophyte-models'></span>

<h3>Description</h3>

<p>Population models of standard test macrophytes, such as <em>Lemna spp.</em>
</p>


<h3>Details</h3>

<p>Available macrophyte models:
</p>

<ul>
<li> <p><a href="#topic+Lemna-models">Lemna</a>
</p>
</li>
<li> <p><a href="#topic+Myrio">Myriophyllum</a>
</p>
</li></ul>



<h3>Biomass transfer</h3>

<p>Models supporting biomass transfer can be instructed to move a fixed amount
of biomass to a new medium after a period of time. This feature replicates
a procedure occurring in e.g. <em>Lemna</em> effect studies and may be necessary to
recreate study results.
</p>
<p>The biomass transfer feature assumes that always a fixed amount of
biomass is transferred. Transfers can occur at any fixed point in time or
in regular intervals. During a transfer, the biomass is reset to the
transferred amount and additional compartments can be scaled 1:1 accordingly,
to e.g. reflect the change in internal toxicant mass when biomass is modified.
Transfer settings can be modified using <code><a href="#topic+set_transfer">set_transfer()</a></code>.
</p>
<p>If a transfer occurs, simulation results of that time point will report the model state
<strong>before</strong> the transfer. Be aware that if transfers are defined using the
<code>interval</code> argument, the transfers will always occur relative to time point
zero (<code>t = 0</code>). As an example, setting a regular transfer of seven days,
<code>interval =  7</code>, will result at transfers occurring at time points which are
integer multiplicates of seven, such as <code>t=0</code>, <code>t=7</code>, <code>t=14</code> and so forth.
The starting and end times of a scenario do not influece <strong>when</strong> a regular
transfer occurs, only <strong>if</strong> it occurs.
</p>


<h3>See Also</h3>

<p><a href="#topic+Scenarios">Scenarios</a>
</p>
<p>Other macrophyte models: 
<code><a href="#topic+Lemna_SETAC">Lemna_SETAC</a>()</code>,
<code><a href="#topic+Lemna_Schmitt">Lemna_Schmitt</a>()</code>,
<code><a href="#topic+Myrio">Myrio</a>()</code>,
<code><a href="#topic+Myrio_log">Myrio_log</a>()</code>
</p>
<p>Other models: 
<code><a href="#topic+Algae-models">Algae-models</a></code>,
<code><a href="#topic+DEB-models">DEB-models</a></code>,
<code><a href="#topic+GUTS-RED-models">GUTS-RED-models</a></code>,
<code><a href="#topic+Lemna-models">Lemna-models</a></code>,
<code><a href="#topic+Myriophyllum-models">Myriophyllum-models</a></code>
</p>

<hr>
<h2 id='metsulfuron'>Lemna data published by Schmitt (2013)</h2><span id='topic+metsulfuron'></span>

<h3>Description</h3>

<p>Data set for the parametrisation of a mechanistic combined
toxicokinetic-toxicodynamic (TK/TD) and growth model for the aquatic
macrophytes Lemna spp. as published by Schmitt <em>et al.</em> (2013).
The growth model was parameterised by Schmitt et al. based on these
data while toxicokinetic and toxicodynamic parameters were determined by
calibrating the model using substance specific effect data of metsulfuron-methyl.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>metsulfuron
</code></pre>


<h3>Format</h3>

<p>An object of class <code>LemnaSchmittScenario</code> of length 1.
</p>


<h3>References</h3>

<p>Schmitt W., Bruns E., Dollinger M., and Sowig P., 2013: <em>Mechanistic TK/TD-model
simulating the effect of growth inhibitors on Lemna populations</em>. Ecol Model 255,
pp. 1-10. <a href="https://doi.org/10.1016/j.ecolmodel.2013.01.017">doi:10.1016/j.ecolmodel.2013.01.017</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Lemna-models">Lemna-models</a>
</p>

<hr>
<h2 id='minnow_it'>A fitted GUTS-RED-IT scenario of the fathead minnow</h2><span id='topic+minnow_it'></span>

<h3>Description</h3>

<p>The example scenario consists of a fitted <a href="#topic+GUTS_RED_IT">GUTS-RED-IT</a>
model and a constant exposure series. Model parameters were derived from a
typical four-day acute fish toxicity study of the <em>fathead minnow</em> by
Geiger <em>et al.</em> (1988).
The study evaluated the effect of <em>chlorpyrifos</em> concentrations in water on
survival of <em>fathead minnows</em>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>minnow_it
</code></pre>


<h3>Format</h3>

<p>An object of class <code>GutsRedIt</code> of length 1.
</p>


<h3>Details</h3>

<p>The toxicity dataset used for parameter calibration is also referred to as
<em>GUTS Ring-test dataset C</em> by EFSA (2018). Fitted parameters were estimated
using the <em>morse</em> package.
</p>
<p>The exposure series of the example scenario is a constant concentration of 1.0 µmol/L
over a period of four days with a daily time step.
</p>


<h3>Source</h3>

<p>https://mosaic.univ-lyon1.fr/guts
</p>


<h3>References</h3>

<p>Geiger D.L., Call D.J., and Brooke L.T., 1988: <em>Acute toxicities of organic
chemicals to fathead minnows (Pimephales promelas): Volume IV</em>, pp. 195-197.
University of Wisconsin-Superior, Center for Lake Superior Environmental Studies.
ISBN 9780961496838.
</p>
<p>EFSA PPR Panel (EFSA Panel on Plant Protection Products and their Residues),
Ockleford C, Adriaanse P, Berny P, et al., 2018: <em>Scientific Opinion on the
state of the art of Toxicokinetic/Toxicodynamic (TKTD) effect models for
regulatory risk assessment of pesticides for aquatic organisms</em>. EFSA Journal 2018;
16(8):5377, 188 pp. <a href="https://doi.org/10.2903/j.efsa.2018.5377">doi:10.2903/j.efsa.2018.5377</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+GUTS-RED-models">GUTS-RED-models</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Print scenario parameters
minnow_it

# Run the example scenario
minnow_it %&gt;% simulate()

</code></pre>

<hr>
<h2 id='minnow_sd'>A fitted GUTS-RED-SD scenario of the fathead minnow</h2><span id='topic+minnow_sd'></span>

<h3>Description</h3>

<p>The example scenario consists of a fitted <a href="#topic+GUTS_RED_SD">GUTS-RED-SD</a>
model and a constant exposure series. Model parameters were derived from a
typical four-day acute fish toxicity study of the <em>fathead minnow</em> by
Geiger <em>et al.</em> (1988).
The study evaluated the effect of <em>chlorpyrifos</em> concentrations in water on
survival of <em>fathead minnows</em>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>minnow_sd
</code></pre>


<h3>Format</h3>

<p>An object of class <code>GutsRedSd</code> of length 1.
</p>


<h3>Details</h3>

<p>The toxicity dataset used for parameter calibration is also referred to as
<em>GUTS Ring-test dataset C</em> by EFSA (2018). Fitted parameters were estimated
using the <em>morse</em> package.
</p>
<p>The exposure series of the example scenario is a constant concentration of 1.0 µmol/L
over a period of four days with a daily time step.
</p>


<h3>Source</h3>

<p>https://mosaic.univ-lyon1.fr/guts
</p>


<h3>References</h3>

<p>Geiger D.L., Call D.J., and Brooke L.T., 1988: <em>Acute toxicities of organic
chemicals to fathead minnows (Pimephales promelas): Volume IV</em>, pp. 195-197.
University of Wisconsin-Superior, Center for Lake Superior Environmental Studies.
ISBN 9780961496838.
</p>
<p>EFSA PPR Panel (EFSA Panel on Plant Protection Products and their Residues),
Ockleford C, Adriaanse P, Berny P, et al., 2018: <em>Scientific Opinion on the
state of the art of Toxicokinetic/Toxicodynamic (TKTD) effect models for
regulatory risk assessment of pesticides for aquatic organisms</em>. EFSA Journal 2018;
16(8):5377, 188 pp. <a href="https://doi.org/10.2903/j.efsa.2018.5377">doi:10.2903/j.efsa.2018.5377</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+GUTS-RED-models">GUTS-RED-models</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Print scenario parameters
minnow_sd

# Run the example scenario
minnow_sd %&gt;% simulate()
</code></pre>

<hr>
<h2 id='Myrio'>Myriophyllum model with exponential growth</h2><span id='topic+Myrio'></span><span id='topic+MyrioExp-class'></span><span id='topic+MyrioExpScenario-class'></span>

<h3>Description</h3>

<p>The <em>Myriophyllum</em> model is derived from the <em>Lemna</em> TKTD model by
Klein <em>et al.</em> (2021). The Myriophyllum model is mathematically equivalent
to the Tier 2C version of the <em>Lemna</em> model by Klein <em>et al.</em> (2021),
cf. <code><a href="#topic+Lemna_SETAC">Lemna_SETAC()</a></code>. Recommended settings for Tier 2C are <code>k_photo_fixed=TRUE</code>
and <code>k_resp=0</code> (Klein <em>et al.</em> 2021).
In particular, the growth model is a simple exponential growth model,
which is considered to be the typical situation for a laboratory macrophyte
study. Instead of frond numbers as for <em>Lemna</em>, the biomass is also returned as
total shoot length (<code>TSL</code>) in simulation results.
Consequently, the model has the additional parameter <code>r_DW_TSL</code>
(dry weight per total shoot length ratio) instead of <code>r_DW_FN</code> (dry weight
per frond number ratio).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Myrio()
</code></pre>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+MyrioExpScenario-class">MyrioExpScenario</a>
</p>


<h3>State variables</h3>

<p>The model has two state variables:
</p>

<ul>
<li> <p><code>BM</code>, Biomass (g dw m-2 for field studies or mg dw for lab)
</p>
</li>
<li> <p><code>M_int</code>, Mass of toxicant in plant population (mass per m2, e.g. ug m-2)
</p>
</li></ul>



<h3>Model parameters</h3>


<ul>
<li><p> Growth model
</p>

<ul>
<li> <p><code>k_photo_max</code>, Maximum photosynthesis rate (d-1), default: <code>0.47</code>
</p>
</li></ul>

</li>
<li><p> Concentration response (Toxicodynamics)
</p>

<ul>
<li> <p><code>EC50_int</code>, Internal concentration resulting in 50% effect (ug L-1)
</p>
</li>
<li> <p><code>E_max</code>, Maximum inhibition (-), default: <code>1</code>
</p>
</li>
<li> <p><code>b</code>, Slope parameter (-)
</p>
</li></ul>

</li>
<li><p> Internal concentration (Toxicokinetics)
</p>

<ul>
<li> <p><code>P</code>, Permeability (cm d-1)
</p>
</li>
<li> <p><code>r_A_DW</code>, Area per dry-weight ratio (cm2 g-1), default: <code>1000</code>
</p>
</li>
<li> <p><code>r_FW_DW</code>, Fresh weight per dry weight ratio (-), default: <code>16.7</code>
</p>
</li>
<li> <p><code>r_FW_V</code>, Fresh weight density (g cm-3), default: <code>1</code>
</p>
</li>
<li> <p><code>r_DW_TSL</code>, Dry weight per total shoot length ratio  (g (field) or mg (lab) dw cm-1)
</p>
</li>
<li> <p><code>K_pw</code>, Partitioning coefficient plant:water (-), default: <code>1</code>
</p>
</li>
<li> <p><code>k_met</code>, Metabolisation rate (d-1), default: <code>0</code>
</p>
</li></ul>

</li></ul>



<h3>Environmental factors</h3>

<p>None.
</p>


<h3>Parameter boundaries</h3>

<p>Default values for parameter boundaries are set for all parameters by expert
judgement, for calibration purposes. Values can be modified using <code><a href="#topic+set_bounds">set_bounds()</a></code>.
</p>


<h3>Simulation output</h3>

<p>Simulation results will contain the state variables
It is possible to amend the output of <code><a href="#topic+simulate">simulate()</a></code> with additional model
quantities that are not state variables, for e.g. debugging purposes or to
analyze model behavior. To enable or disable additional outputs, use the
optional argument <code>nout</code> of <code><a href="#topic+simulate">simulate()</a></code>. As an example, set <code>nout=2</code> to
enable reporting of the acceleration factor (<code>MV</code>) and the mobilization flux
(<code>pC</code>). Set <code>nout=0</code> to disable additional outputs (default).
</p>
<p>The available output levels are as follows:
</p>

<ul>
<li> <p><code>nout</code> &gt;= 1: <code>C_int</code>, internal concentration (mass per volume)
</p>
</li>
<li> <p><code>nout</code> &gt;= 2: <code>TSL</code>, total shoot length (?)
</p>
</li>
<li> <p><code>nout</code> &gt;= 3: <code>f_photo</code>, photosynthesis dependency function (-)
</p>
</li>
<li><p> Growth and TK/TD
</p>

<ul>
<li> <p><code>nout</code> &gt;= 4: <code>C_int_unb</code>, unbound internal concentration (mass per volume)
</p>
</li>
<li> <p><code>nout</code> &gt;= 5: <code>C_ext</code>, external concentration (mass per volume)
</p>
</li></ul>

</li>
<li><p> Derivatives
</p>

<ul>
<li> <p><code>nout</code> &gt;= 6: <code>dBM</code>, biomass derivative (g dw m-2 d-1)
</p>
</li>
<li> <p><code>nout</code> &gt;= 7: <code>dM_int</code>, mass of toxicant in plants derivative (mass per m2 d-1)
</p>
</li></ul>

</li></ul>



<h3>Solver settings</h3>

<p>The arguments to ODE solver <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code> control how model equations
are numerically integrated. The settings influence stability of the numerical
integration scheme as well as numerical precision of model outputs. Generally, the
default settings as defined by <em>deSolve</em> are used, but all <em>deSolve</em> settings
can be modified in <em>cvasi</em> workflows by the user, if needed. Please refer
to e.g. <code><a href="#topic+simulate">simulate()</a></code> on how to pass arguments to <em>deSolve</em> in <em>cvasi</em>
workflows.
</p>
<p>Some default settings of <em>deSolve</em> were adapted for this model by expert
judgement to enable precise, but also computationally efficient, simulations
for most model parameters. These settings can be modified by the user,
if needed:
</p>

<ul>
<li> <p><code>hmax = 0.1</code><br>
Maximum step length in time suitable for most simulations.
</p>
</li></ul>



<h3>Effects</h3>

<p>Supported effect endpoints include <em>BM</em> (biomass) and <em>r</em> (average
growth rate during simulation). The effect on biomass is calculated from
the last state of a simulation. Be aware that endpoint <em>r</em> is incompatible
with biomass transfers.
</p>


<h3>Biomass transfer</h3>

<p>Models supporting biomass transfer can be instructed to move a fixed amount
of biomass to a new medium after a period of time. This feature replicates
a procedure occurring in e.g. <em>Lemna</em> effect studies and may be necessary to
recreate study results.
</p>
<p>The biomass transfer feature assumes that always a fixed amount of
biomass is transferred. Transfers can occur at any fixed point in time or
in regular intervals. During a transfer, the biomass is reset to the
transferred amount and additional compartments can be scaled 1:1 accordingly,
to e.g. reflect the change in internal toxicant mass when biomass is modified.
Transfer settings can be modified using <code><a href="#topic+set_transfer">set_transfer()</a></code>.
</p>
<p>If a transfer occurs, simulation results of that time point will report the model state
<strong>before</strong> the transfer. Be aware that if transfers are defined using the
<code>interval</code> argument, the transfers will always occur relative to time point
zero (<code>t = 0</code>). As an example, setting a regular transfer of seven days,
<code>interval =  7</code>, will result at transfers occurring at time points which are
integer multiplicates of seven, such as <code>t=0</code>, <code>t=7</code>, <code>t=14</code> and so forth.
The starting and end times of a scenario do not influece <strong>when</strong> a regular
transfer occurs, only <strong>if</strong> it occurs.
</p>


<h3>References</h3>

<p>Klein J., Cedergreen N., Heine S., Reichenberger S., Rendal C.,
Schmitt W., Hommen U., 2021: <em>Refined description of the Lemna TKTD growth model
based on Schmitt et al. (2013) - equation system and default parameters</em>.
Report of the working group <em>Lemna</em> of the SETAC Europe Interest Group Effect
Modeling. Version 1, uploaded on 22. Sept. 2021.
https://www.setac.org/group/effect-modeling.html
</p>


<h3>See Also</h3>

<p><a href="#topic+Macrophyte-models">Macrophyte-models</a>, <a href="#topic+Transferable">Transferable</a>, <a href="#topic+Scenarios">Scenarios</a>
</p>
<p>Other Myriophyllum models: 
<code><a href="#topic+Myrio_log">Myrio_log</a>()</code>,
<code><a href="#topic+Myriophyllum-models">Myriophyllum-models</a></code>
</p>
<p>Other macrophyte models: 
<code><a href="#topic+Lemna_SETAC">Lemna_SETAC</a>()</code>,
<code><a href="#topic+Lemna_Schmitt">Lemna_Schmitt</a>()</code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Myrio_log">Myrio_log</a>()</code>
</p>

<hr>
<h2 id='Myrio_log'>Myriophyllum model with logistic growth</h2><span id='topic+Myrio_log'></span><span id='topic+MyrioLog-class'></span><span id='topic+MyrioLogScenario-class'></span>

<h3>Description</h3>

<p>The <em>Myriophyllum</em> model is derived from the <em>Lemna</em> TKTD model
by Klein <em>et al.</em> (2021).
<code>Myrio_log()</code> modifies the <code><a href="#topic+Myrio">Myrio()</a></code> model to feature logistic growth, i.e.
control growth is described by the differential equation
<code style="white-space: pre;">&#8288;d BM/dt = k_photo_max*BM*(1 - BM/BM_L)&#8288;</code> where <code>BM_L</code> is the carrying capacity.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Myrio_log()
</code></pre>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+MyrioLogScenario-class">MyrioLogScenario</a>
</p>


<h3>Model parameters</h3>


<ul>
<li><p> Growth model
</p>

<ul>
<li> <p><code>k_photo_max</code>, Maximum photosynthesis rate (d-1), default: <code>0.47</code>
</p>
</li>
<li> <p><code>BM_L</code>, Carrying capacity (g dw m-2)
</p>
</li></ul>

</li>
<li><p> Concentration response (Toxicodynamics)
</p>

<ul>
<li> <p><code>EC50_int</code>, Internal concentration resulting in 50% effect (ug L-1)
</p>
</li>
<li> <p><code>E_max</code>, Maximum inhibition (-), default: <code>1</code>
</p>
</li>
<li> <p><code>b</code>, Slope parameter (-)
</p>
</li></ul>

</li>
<li><p> Internal concentration (Toxicokinetics)
</p>

<ul>
<li> <p><code>P</code>, Permeability (cm d-1)
</p>
</li>
<li> <p><code>r_A_DW</code>, Area per dry-weight ratio (cm2 g-1), default: <code>1000</code>
</p>
</li>
<li> <p><code>r_FW_DW</code>, Fresh weight per dry weight ratio (-), default: <code>16.7</code>
</p>
</li>
<li> <p><code>r_FW_V</code>, Fresh weight density (g cm-3), default: <code>1</code>
</p>
</li>
<li> <p><code>r_DW_TSL</code>, Dry weight per total shoot length ratio  (?)
</p>
</li>
<li> <p><code>K_pw</code>, Partitioning coefficient plant:water (-), default: <code>1</code>
</p>
</li>
<li> <p><code>k_met</code>, Metabolisation rate (d-1), default: <code>0</code>
</p>
</li></ul>

</li></ul>



<h3>State variables</h3>

<p>The model has two state variables:
</p>

<ul>
<li> <p><code>BM</code>, Biomass (g dw m-2 for field studies or mg dw for lab)
</p>
</li>
<li> <p><code>M_int</code>, Mass of toxicant in plant population (mass per m2, e.g. ug m-2)
</p>
</li></ul>



<h3>Environmental factors</h3>

<p>None.
</p>


<h3>Simulation output</h3>

<p>Simulation results will contain the state variables
It is possible to amend the output of <code><a href="#topic+simulate">simulate()</a></code> with additional model
quantities that are not state variables, for e.g. debugging purposes or to
analyze model behavior. To enable or disable additional outputs, use the
optional argument <code>nout</code> of <code><a href="#topic+simulate">simulate()</a></code>. As an example, set <code>nout=2</code> to
enable reporting of the acceleration factor (<code>MV</code>) and the mobilization flux
(<code>pC</code>). Set <code>nout=0</code> to disable additional outputs (default).
</p>
<p>The available output levels are as follows:
</p>

<ul>
<li> <p><code>nout</code> &gt;= 1: <code>C_int</code>, internal concentration (mass per volume)
</p>
</li>
<li> <p><code>nout</code> &gt;= 2: <code>TSL</code>, total shoot length (?)
</p>
</li>
<li> <p><code>nout</code> &gt;= 3: <code>f_photo</code>, photosynthesis dependency function (-)
</p>
</li>
<li><p> Growth and TK/TD
</p>

<ul>
<li> <p><code>nout</code> &gt;= 4: <code>C_int_unb</code>, unbound internal concentration (mass per volume)
</p>
</li>
<li> <p><code>nout</code> &gt;= 5: <code>C_ext</code>, external concentration (mass per volume)
</p>
</li></ul>

</li>
<li><p> Derivatives
</p>

<ul>
<li> <p><code>nout</code> &gt;= 6: <code>dBM</code>, biomass derivative (g dw m-2 d-1)
</p>
</li>
<li> <p><code>nout</code> &gt;= 7: <code>dM_int</code>, mass of toxicant in plants derivative (mass per m2 d-1)
</p>
</li></ul>

</li></ul>



<h3>Solver settings</h3>

<p>The arguments to ODE solver <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code> control how model equations
are numerically integrated. The settings influence stability of the numerical
integration scheme as well as numerical precision of model outputs. Generally, the
default settings as defined by <em>deSolve</em> are used, but all <em>deSolve</em> settings
can be modified in <em>cvasi</em> workflows by the user, if needed. Please refer
to e.g. <code><a href="#topic+simulate">simulate()</a></code> on how to pass arguments to <em>deSolve</em> in <em>cvasi</em>
workflows.
</p>
<p>Some default settings of <em>deSolve</em> were adapted for this model by expert
judgement to enable precise, but also computationally efficient, simulations
for most model parameters. These settings can be modified by the user,
if needed:
</p>

<ul>
<li> <p><code>hmax = 0.1</code><br>
Maximum step length in time suitable for most simulations.
</p>
</li></ul>



<h3>Effects</h3>

<p>Supported effect endpoints include <em>BM</em> (biomass) and <em>r</em> (average
growth rate during simulation). The effect on biomass is calculated from
the last state of a simulation. Be aware that endpoint <em>r</em> is incompatible
with biomass transfers.
</p>


<h3>Biomass transfer</h3>

<p>Models supporting biomass transfer can be instructed to move a fixed amount
of biomass to a new medium after a period of time. This feature replicates
a procedure occurring in e.g. <em>Lemna</em> effect studies and may be necessary to
recreate study results.
</p>
<p>The biomass transfer feature assumes that always a fixed amount of
biomass is transferred. Transfers can occur at any fixed point in time or
in regular intervals. During a transfer, the biomass is reset to the
transferred amount and additional compartments can be scaled 1:1 accordingly,
to e.g. reflect the change in internal toxicant mass when biomass is modified.
Transfer settings can be modified using <code><a href="#topic+set_transfer">set_transfer()</a></code>.
</p>
<p>If a transfer occurs, simulation results of that time point will report the model state
<strong>before</strong> the transfer. Be aware that if transfers are defined using the
<code>interval</code> argument, the transfers will always occur relative to time point
zero (<code>t = 0</code>). As an example, setting a regular transfer of seven days,
<code>interval =  7</code>, will result at transfers occurring at time points which are
integer multiplicates of seven, such as <code>t=0</code>, <code>t=7</code>, <code>t=14</code> and so forth.
The starting and end times of a scenario do not influece <strong>when</strong> a regular
transfer occurs, only <strong>if</strong> it occurs.
</p>


<h3>Parameter boundaries</h3>

<p>Default values for parameter boundaries are set for all parameters by expert
judgement, for calibration purposes. Values can be modified using <code><a href="#topic+set_bounds">set_bounds()</a></code>.
</p>


<h3>References</h3>

<p>Klein J., Cedergreen N., Heine S., Reichenberger S., Rendal C.,
Schmitt W., Hommen U., 2021: <em>Refined description of the Lemna TKTD growth model
based on Schmitt et al. (2013) - equation system and default parameters</em>.
Report of the working group <em>Lemna</em> of the SETAC Europe Interest Group Effect
Modeling. Version 1, uploaded on 22. Sept. 2021.
https://www.setac.org/group/effect-modeling.html
</p>


<h3>See Also</h3>

<p><a href="#topic+Transferable">Transferable</a>, <a href="#topic+Scenarios">Scenarios</a>
</p>
<p>Other Myriophyllum models: 
<code><a href="#topic+Myrio">Myrio</a>()</code>,
<code><a href="#topic+Myriophyllum-models">Myriophyllum-models</a></code>
</p>
<p>Other macrophyte models: 
<code><a href="#topic+Lemna_SETAC">Lemna_SETAC</a>()</code>,
<code><a href="#topic+Lemna_Schmitt">Lemna_Schmitt</a>()</code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Myrio">Myrio</a>()</code>
</p>

<hr>
<h2 id='Myriophyllum-models'>Myriophyllum models</h2><span id='topic+Myriophyllum-models'></span><span id='topic+Myriophyllum-class'></span>

<h3>Description</h3>

<p>Supported models:
</p>

<ul>
<li> <p><code><a href="#topic+Myrio">Myrio()</a></code>, with exponential growth
</p>
</li>
<li> <p><code><a href="#topic+Myrio_log">Myrio_log()</a></code>, with logistic growth
</p>
</li></ul>



<h3>See Also</h3>

<p><a href="#topic+Lemna-models">Lemna-models</a>, <a href="#topic+Transferable">Transferable</a>
</p>
<p>Other Myriophyllum models: 
<code><a href="#topic+Myrio">Myrio</a>()</code>,
<code><a href="#topic+Myrio_log">Myrio_log</a>()</code>
</p>
<p>Other models: 
<code><a href="#topic+Algae-models">Algae-models</a></code>,
<code><a href="#topic+DEB-models">DEB-models</a></code>,
<code><a href="#topic+GUTS-RED-models">GUTS-RED-models</a></code>,
<code><a href="#topic+Lemna-models">Lemna-models</a></code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>
</p>

<hr>
<h2 id='no_exposure'>Zero exposure</h2><span id='topic+no_exposure'></span>

<h3>Description</h3>

<p>Creates an <a href="#topic+ExposureSeries">ExposureSeries</a> with zero concentration. When setting
the zero exposure, pay attention not to accidentally reset the output times
of your scenario as the zero exposure series contains only a single time point.
See the examples.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>no_exposure()
</code></pre>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+ExposureSeries-class">ExposureSeries</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+set_noexposure">set_noexposure()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># this will reset the output times of the sample scenario,
# simulate() will quit with an error
try(
  minnow_it %&gt;%
    set_exposure(no_exposure()) %&gt;%
    simulate()
)

# set zero exposure, but keep original output times
minnow_it %&gt;%
  set_exposure(no_exposure(), reset_times=FALSE) %&gt;%
  simulate()
</code></pre>

<hr>
<h2 id='parameter_set'>Set of model parameters</h2><span id='topic+parameter_set'></span><span id='topic+ParameterSet-class'></span><span id='topic+parameter_set-class'></span>

<h3>Description</h3>

<p>Set of model parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>parameter_set(model, param = list(), tag = NA_character_)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="parameter_set_+3A_model">model</code></td>
<td>
<p><code>character</code>, a string containing a model name, e.g. <code>"GUTS-RED-IT"</code></p>
</td></tr>
<tr><td><code id="parameter_set_+3A_param">param</code></td>
<td>
<p>named <code>list</code> of model parameters</p>
</td></tr>
<tr><td><code id="parameter_set_+3A_tag">tag</code></td>
<td>
<p><code>character</code>, an optional identifier</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+ParameterSet-class">ParameterSet</a>
</p>


<h3>Slots</h3>


<dl>
<dt><code>model</code></dt><dd><p><code>character</code>, a string containing a model name, e.g. <code>"GUTS-RED-IT"</code></p>
</dd>
<dt><code>tag</code></dt><dd><p><code>character</code>, an optional identifier</p>
</dd>
<dt><code>param</code></dt><dd><p>named <code>list</code> of model parameters</p>
</dd>
</dl>


<h3>Examples</h3>

<pre><code class='language-R'># create a parameter set and assign it
ps &lt;- parameter_set("GUTS-RED-IT", list(kd=0.12, hb=0.3))
GUTS_RED_IT() %&gt;% set_param(ps)

# multiple scenarios can be modified at once
c(GUTS_RED_IT(), GUTS_RED_IT()) %&gt;%
  set_param(ps)

# model names must match, otherwise an error will be raised
try(GUTS_RED_SD() %&gt;% set_param(ps))
</code></pre>

<hr>
<h2 id='pll_debug'>Disable parallelization for debugging</h2><span id='topic+pll_debug'></span>

<h3>Description</h3>

<p>In certain cases it might be beneficial to disable parallel execution
of e.g. effect profile calculations. By disabling, all processes run
sequentially and instantly pass messages to the console which would be
delayed during parallel processing. This makes it easier to pinpoint
problems within the data or algorithm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pll_debug(state = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pll_debug_+3A_state">state</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code> then parallelization is disabled</p>
</td></tr>
</table>


<h3>Value</h3>

<p>no return value
</p>

<hr>
<h2 id='plot'>S3 plotting functions</h2><span id='topic+plot'></span><span id='topic+plot.cvasi.drc'></span><span id='topic+plot.cvasi.simulate'></span>

<h3>Description</h3>

<p>These functions overload <code><a href="base.html#topic+plot">base::plot()</a></code> to provide simple plotting
routines to display various time-series and scenario objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'cvasi.drc'
plot(x, y, scale_x = c("auto", "log10", "none"), ...)

## S3 method for class 'cvasi.simulate'
plot(x, y, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_+3A_x">x</code></td>
<td>
<p>object to plot</p>
</td></tr>
<tr><td><code id="plot_+3A_y">y</code></td>
<td>
<p>unused parameter</p>
</td></tr>
<tr><td><code id="plot_+3A_scale_x">scale_x</code></td>
<td>
<p>character, controls how the x-axis is scaled. <code>log10</code> for
a log10-scaled axis, <code>none</code> for no scaling, and <code>auto</code> for automatic selection</p>
</td></tr>
<tr><td><code id="plot_+3A_...">...</code></td>
<td>
<p>unused parameters</p>
</td></tr>
</table>


<h3>Value</h3>

<p><em>ggplot2</em> plot object
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>plot(cvasi.drc)</code>: Plot dose response curves
</p>
</li>
<li> <p><code>plot(cvasi.simulate)</code>: Plot return value of <code><a href="#topic+simulate">simulate()</a></code>
</p>
</li></ul>

<hr>
<h2 id='plot_epx'>Plot EPx values</h2><span id='topic+plot_epx'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_epx(
  EPx_ts,
  exposure_ts,
  draw = TRUE,
  time_col = "time",
  conc_col = "conc",
  epx_x_title = "Start time",
  conc_y_title = "Exposure conc."
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_epx_+3A_epx_ts">EPx_ts</code></td>
<td>
<p>the result of <code>epx_mtw</code>, ie. a tibble with window.start,
window.end, endpoint, level and EPx</p>
</td></tr>
<tr><td><code id="plot_epx_+3A_exposure_ts">exposure_ts</code></td>
<td>
<p>an exposure time series with columns for time 't' and
concentration 'conc'</p>
</td></tr>
<tr><td><code id="plot_epx_+3A_draw">draw</code></td>
<td>
<p>Should the whole plot be drawn? If FALSE the exposure plot and
the EPx plot are returned as a list for later modification</p>
</td></tr>
<tr><td><code id="plot_epx_+3A_time_col">time_col</code></td>
<td>
<p>the name of the time column in the exposure dataset</p>
</td></tr>
<tr><td><code id="plot_epx_+3A_conc_col">conc_col</code></td>
<td>
<p>the name of the concentration column in the exposure dataset</p>
</td></tr>
<tr><td><code id="plot_epx_+3A_epx_x_title">epx_x_title</code></td>
<td>
<p>title of the x-axis of the epx panel</p>
</td></tr>
<tr><td><code id="plot_epx_+3A_conc_y_title">conc_y_title</code></td>
<td>
<p>title of the y-axis of the concentration panel</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a grid of ggplots
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ti &lt;- 0:21
expo &lt;- abs(0.01*ti + rnorm(length(ti), 0, 0.05))
exposure &lt;- data.frame(time = ti, conc = expo)
metsulfuron_epx_mtw &lt;- metsulfuron %&gt;%
set_exposure(exposure) %&gt;%
epx_mtw(level = 10, factor_cutoff = 1000)
metsulfuron_epx_mtw
plot_epx(EPx_ts = metsulfuron_epx_mtw,
exposure_ts = exposure, conc_y_title = "env. concentration [µg/L]")
</code></pre>

<hr>
<h2 id='plot_lik_profile'>Plot likelihood profiles or all profiled parameters</h2><span id='topic+plot_lik_profile'></span>

<h3>Description</h3>

<p>The function provides a combined plot of the likelihood profiles
of all parameters profiled.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_lik_profile(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_lik_profile_+3A_x">x</code></td>
<td>
<p>object of class lik_profile</p>
</td></tr>
</table>


<h3>Value</h3>

<p>plots
</p>

<hr>
<h2 id='plot_param_space'>Plot likelihood profiles or all profiled parameters</h2><span id='topic+plot_param_space'></span>

<h3>Description</h3>

<p>The function provides bivariate parameter space plots indicating
parameter draws (from the 95%confidence intervals per parameter obtained
through likelihood profiling) that fall within the inner rim (in green, i.e.
parameter sets which are not significantly different from the original, based
on a chi-square test). The original parameter set is also indicated (in orange),
and, if different from the original set, the best fit parameter set is indicated
(in red)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_param_space(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_param_space_+3A_x">x</code></td>
<td>
<p>object of class param_space</p>
</td></tr>
</table>


<h3>Value</h3>

<p>plots
</p>

<hr>
<h2 id='plot_ppc'>Creates a PPC plot for a single dataset</h2><span id='topic+plot_ppc'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_ppc(
  rs_mean,
  rs_range,
  col_number = 2,
  obs_mean = NULL,
  obs_full = NULL,
  xy_lim = NULL,
  study = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_ppc_+3A_rs_mean">rs_mean</code></td>
<td>
<p><code>data.frame</code>, model results best fit params</p>
</td></tr>
<tr><td><code id="plot_ppc_+3A_rs_range">rs_range</code></td>
<td>
<p><code>data.frame</code>, predictions (min, max from param.sample run)</p>
</td></tr>
<tr><td><code id="plot_ppc_+3A_col_number">col_number</code></td>
<td>
<p>column to plot, default = 2</p>
</td></tr>
<tr><td><code id="plot_ppc_+3A_obs_mean">obs_mean</code></td>
<td>
<p><code>data.frame</code>, observations with means per treatment level</p>
</td></tr>
<tr><td><code id="plot_ppc_+3A_obs_full">obs_full</code></td>
<td>
<p><code>data.frame</code>, full data set including results for replicates</p>
</td></tr>
<tr><td><code id="plot_ppc_+3A_xy_lim">xy_lim</code></td>
<td>
<p>optional <code>numeric</code>, limits of x and y axis for plotting</p>
</td></tr>
<tr><td><code id="plot_ppc_+3A_study">study</code></td>
<td>
<p>optional <code>string</code>, name of study which can be used as key</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A sample of parameters representing the uncertainty within the dataset
is passed to the function. All parameter combinations and exposure patterns
are simulated and the range of predicted frond numbers is derived for a
single study. The uncertainty is displayed by a Posterior Predictive Plot
(PPC). The data (rs_mean, obs_mean and obs_full) must have the
following format (col1 = time, col2 = data of interest, col3 = trial name).
Data for uncertainties (rs_range) must have the format: col1 = time,
col2 = lower boundaries, col3 = upper boundaries, col4 = trial. The user
should take care of the input data and consider whether control data and
data at time zero should be included in the model check.
</p>


<h3>Value</h3>

<p>a ggplot2 plot object
</p>

<hr>
<h2 id='plot_ppc_combi'>Create PPC plot for one or more datasets</h2><span id='topic+plot_ppc_combi'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_ppc_combi(table, xy_lim = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_ppc_combi_+3A_table">table</code></td>
<td>
<p><code>data.frame</code> containing return values of calls to <code>plot_ppc()</code></p>
</td></tr>
<tr><td><code id="plot_ppc_combi_+3A_xy_lim">xy_lim</code></td>
<td>
<p>optional <code>numeric</code>, limits of x and y axis for plotting</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function expects a data.frame with five mandatory and one optional
column. The mandatory columns are as follows:
</p>

<ul>
<li> <p><code>pred</code>: mean of predictions e.g. frond number for lemna
</p>
</li>
<li> <p><code>max</code>: maximum of predictions
</p>
</li>
<li> <p><code>min</code>: minimum of predictions
</p>
</li>
<li> <p><code>obs</code>: observations
</p>
</li>
<li> <p><code>PPC</code>: color code
The optional column is to be named <code>study</code> and contains a study identifier.
If more than one study identifier is present in the table, individual
studies will be plotted in different colors and a legend will be displayed.
The function is called by plot_ppc where the column names are defined
(see rs_ppc object).
</p>
</li></ul>



<h3>Value</h3>

<p>a ggplot2 plot object
</p>

<hr>
<h2 id='plot_scenario'>Creates a prediction plot for one effect scenario</h2><span id='topic+plot_scenario'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_scenario(model_base, plot_col = 2, trial_number = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_scenario_+3A_model_base">model_base</code></td>
<td>
<p>effect scenario object with mean parameters</p>
</td></tr>
<tr><td><code id="plot_scenario_+3A_plot_col">plot_col</code></td>
<td>
<p>output column which should be plotted, default = 2</p>
</td></tr>
<tr><td><code id="plot_scenario_+3A_trial_number">trial_number</code></td>
<td>
<p>name for model run (if available tag is used)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function has been deprecated and replaced by the generic <code><a href="#topic+plot">plot()</a></code>.
</p>
<p>Sometimes it is helpful if the user can plot results of one effect
scenario. This is for instance the case for test simulations or predictions
for one profile. This function runs the simulation for one effect scenario
and plots the results. Function plots the time (column 1) and the predictions
(column 2, can be changed by the user plot_col)
</p>


<h3>Value</h3>

<p>plot of the results for one <code style="white-space: pre;">&#8288;effect scenario&#8288;</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Please use `plot()` instead
metsulfuron %&gt;%
  simulate() %&gt;%
  plot()
</code></pre>

<hr>
<h2 id='plot_sd'>Creates plot of model results (uncertainties optional)</h2><span id='topic+plot_sd'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_sd(
  model_base,
  treatments,
  rs_mean,
  rs_range = NULL,
  obs_mean = NULL,
  obs_full = NULL,
  x_breaks = NULL,
  y_lim = NULL,
  grid_labels = NULL,
  grid_ncol = 2,
  plot_col = 2,
  y_title = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_sd_+3A_model_base">model_base</code></td>
<td>
<p>effect scenario object with mean parameters</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_treatments">treatments</code></td>
<td>
<p>treatments exposure levels as data frame</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_rs_mean">rs_mean</code></td>
<td>
<p><code>data.frame</code>, model results best fit params</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_rs_range">rs_range</code></td>
<td>
<p><code>data.frame</code>, uncertainties as data frame</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_obs_mean">obs_mean</code></td>
<td>
<p><code>data.frame</code>, observation data with means per treatment level</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_obs_full">obs_full</code></td>
<td>
<p><code>data.frame</code>, full set including results for replicates</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_x_breaks">x_breaks</code></td>
<td>
<p>optional vector of breaks of x-axis</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_y_lim">y_lim</code></td>
<td>
<p>optional vector containing limits of y-axis</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_grid_labels">grid_labels</code></td>
<td>
<p>optional labels of grid headers</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_grid_ncol">grid_ncol</code></td>
<td>
<p>optional number of grid columns</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_plot_col">plot_col</code></td>
<td>
<p>output column which should be plotted</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_y_title">y_title</code></td>
<td>
<p>optional title of y-axis</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_...">...</code></td>
<td>
<p>any additional parameters</p>
</td></tr>
</table>


<h3>Details</h3>

<p>All parameter combinations and exposure patterns are simulated and the mean
of predictions is derived for a single study. The uncertainty is
passed to the function due to computation time. Results are displayed by
plotting the time series including the uncertainty interval. Observation data
can be optionally displayed. Data should be provided in long format. Function
plots the time (column 1) and the predictions (column 2, can be changed by
the user plot_col)
</p>


<h3>Value</h3>

<p>a ggplot2 plot object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(124)
exposure &lt;- data.frame(
  time = 0:21,
  conc = rnorm(n = 22, mean = 0.1, sd = 0.06),
  trial = "T1"
)
forcings &lt;- list(temp = 12, rad = 15000)
param &lt;- list(EC50 = 0.3, b = 4.16, P_up = 0.0054)
inits &lt;- list(BM = 0.0012, E = 1, M_int = 0)

scenario &lt;- Lemna_Schmitt() %&gt;%
  set_forcings(forcings) %&gt;%
  set_param(param) %&gt;%
  set_init(inits)

sim_result &lt;- simulate_batch(
  model_base = scenario,
  treatments = exposure,
  param_sample = NULL
)

plot_sd(
  model_base = scenario,
  treatments = exposure,
  rs_mean = sim_result
)
</code></pre>

<hr>
<h2 id='pull_metadata'>Pull metadata from scenarios</h2><span id='topic+pull_metadata'></span>

<h3>Description</h3>

<p>The method pulls available metadata from scenario objects and returns a
table with additional columns. If the argument already was a <code>data.frame</code>
object, the columns are appended. May overwrite existing columns of the
same name.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pull_metadata(x, model = TRUE, exposure = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pull_metadata_+3A_x">x</code></td>
<td>
<p>vector of <a href="#topic+scenarios">scenarios</a> or a <code>data.frame</code> containing a column
<code>scenario</code> with <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="pull_metadata_+3A_model">model</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code> then model metadata is pulled</p>
</td></tr>
<tr><td><code id="pull_metadata_+3A_exposure">exposure</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code> then exposure series metadata is pulled</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>data.frame</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>metsulfuron %&gt;%
  pull_metadata()
</code></pre>

<hr>
<h2 id='Rsubcapitata'>An algae scenario</h2><span id='topic+Rsubcapitata'></span>

<h3>Description</h3>

<p>Data are from Weber 2012 publication.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Rsubcapitata
</code></pre>


<h3>Format</h3>

<p>An object of class <code>AlgaeTKTD</code> of length 1.
</p>


<h3>References</h3>

<p>Weber D, Schaeffer D, Dorgerloh M, Bruns E, Goerlitz G, Hammel K, Preuss TG
and Ratte HT, 2012. Combination of a higher-tier flow-through system and
population modeling to assess the effects of time-variable exposure of
isoproturon on the green algae Desmodesmus subspictatus and
Pseudokirchneriella subcapitata. Environmental Toxicology and
Chemistry, 31, 899-908. <a href="https://doi.org/10.1002/etc.1765">doi:10.1002/etc.1765</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Algae_TKTD">Algae_TKTD</a>
</p>

<hr>
<h2 id='Scenarios'>Effect scenario classes</h2><span id='topic+Scenarios'></span><span id='topic+scenario'></span><span id='topic+scenarios'></span><span id='topic+EffectScenario-class'></span>

<h3>Description</h3>

<p>The <code>EffectScenario</code> class is the base for all of the basic scenario
types and models. It contains slots for data and settings that are
required by most models such as a vector of model parameters and a vector
of initial states. For each particular model, the class's slots are
filled with certain default or fixed values. Some models derive from this
class and add slots to store additional data.
</p>


<h3>Details</h3>

<p>Certain behaviors that are required to model complex processes cannot be
represented by a single EffectScenario. As an example, the parameters of a scenario
are generally fixed during the simulated time period. In order to represent a
change in parameter values, the original scenario would
need to split into two scenarios <em>A</em> and <em>B</em> which differ by parameter values
and simulated time period. By combining these scenarios to a <em>scenario sequence</em>,
the sequence would be treated as a single, complex scenario. See
<code><a href="#topic+sequence">sequence()</a></code> for more information.
</p>


<h4>Parameters</h4>

<p>Most parameters are represented by numerical types but other types
are possible depending on model. Please refer to the model description
which parameters are required and in which unit. Some or all parameters may
be required to start a simulation. If required parameters are missing,
simulation will fail with an error message.
</p>



<h4>Initial state</h4>

<p>The <em>initial state</em> represents the starting values of state variables when
starting a simulation. A scenario's default initial state may be insufficient
to get sensible results. It is advisable to set an initial state explicitly
when creating a new scenario, see <code><a href="#topic+set_init">set_init()</a></code>.
</p>
<p>In theory, a scenario's state variables can be renamed by modifying the names
of the initial state vector. However, this is strongly
discouraged as this will affect other routines such as <code><a href="#topic+effect">effect()</a></code> and <code><a href="#topic+epx">epx()</a></code>
and may render results useless.
</p>



<h4>Exposure</h4>

<p><em>Exposure</em> refers to the concentration of toxicant an organism is exposed to.
In case of aquatic organisms, this would commonly be the concentration of a
toxicant in water. Other interpretations are possible depending on model
assumptions.
</p>
<p>Exposure time-series are generally represented by a <code>data.frame</code> containing two
columns. The first column representing time, the second representing the
exposure level. The ordering of columns is mandatory. The column names
are essentially irrelevant but sensible names may help documenting the
scenario and its data. The rows must be ordered chronologically. A time-series
can consist of only a single row; in this case it will represent constant
exposure. Exposure time-series are set to a scenario using <code><a href="#topic+set_exposure">set_exposure()</a></code>.
</p>
<p>Handling time-series is a costly task for the ODE solver due to consistency
checks and interpolation between time steps. How the solver interpolates
the time-series can be controlled by certain arguments to functions
such as <code><a href="#topic+simulate">simulate()</a></code> and <code><a href="#topic+effect">effect()</a></code>. Please refer to <code><a href="#topic+simulate">simulate()</a></code> for a brief
overview and <a href="deSolve.html#topic+forcings">deSolve::forcings</a> for a detailed description.
</p>
<p>Exposure time-series should be kept as short as possible and as complex as
needed for optimal computational efficiency.
</p>



<h4>Environmental forcings</h4>

<p><em>Forcings</em> generally refer to model parameters that change over time as part
of an external function such as environmental temperature and exposure levels.
Due to the importance of exposure in regulatory assessments, this R package
explicitly distinguishes between environmental forcings and exposure. However,
the same restrictions and features apply to both of them.
</p>
<p>Forcing time-series are handled the same way as exposure time-series, i.e.
they are represented by a <code>data.frame</code> containing two columns. The first column
representing time, the second representing the parameter that is a function of
time. The ordering of columns is mandatory. The rows must be ordered
chronologically. Forcings time-series are set using <code><a href="#topic+set_forcings">set_forcings()</a></code>.
Please refer to the <em>Exposure</em> section for more information on how time-series
are handled.
</p>



<h4>Output times</h4>

<p>A scenario's simulated time period is defined by its minimum and maximum output
time. Simulation results will only be returned for the defined output times
even though the ODE solver may use smaller time steps between output times.
Output times can be explicitly set using <code><a href="#topic+set_times">set_times()</a></code>. The number and
distance of output times may have influence on the precision of simulation
results and numerical stability, cf. <code><a href="#topic+simulate">simulate()</a></code>.
</p>
<p>Be aware that <code><a href="#topic+set_exposure">set_exposure()</a></code> will overwrite previously defined output times
if not requested otherwise.
</p>



<h4>Effects</h4>

<p>Generally, all state variables can be used as effect endpoints but models may
provide additional endpoints. Use <code><a href="#topic+set_endpoints">set_endpoints()</a></code> to enable or disable
endpoints for a scenario.
</p>
<p>Some scenarios or models require control runs to calculate effects under
exposure. Generally, control simulations will run automatically
where needed. However, when conducting a large number of repeated simulations, e.g.
when calculating effect profiles (EPx values) or simulating moving exposure
windows, it may be computational efficient to run control simulations only
once and cache their results within the scenario. Please refer to <code><a href="#topic+cache_controls">cache_controls()</a></code>
for details.
</p>



<h4>Moving exposure windows</h4>

<p>The time frame relevant for effects may be much shorter than the assessed
exposure time-series for certain organisms. This fact can be represented
by moving exposure windows which divide a long time period in a number of
consecutive windows of the same length. Each window is simulated individually and effects are
calculated. By default, methods such as <code><a href="#topic+effect">effect()</a></code> will only return the
maximum effect of all considered windows but detailed results can be presented
on demand.
</p>
<p>To use moving exposure windows, the exposure time-series must be regular,
i.e. must have an equidistant step length in time. The length of the window
is defined as the number of time steps of the exposure time-series. As an
example, assume the time-series has daily granularity and a moving window
of seven days length is required. In this case, the moving window must have
a length of seven (7) time steps. If the exposure time-series had hourly granularity,
the same window would need to have a length of 168 (=7*24) time steps. Please
refer to <code><a href="#topic+set_window">set_window()</a></code> for details.
</p>



<h3>Slots</h3>


<dl>
<dt><code>name</code></dt><dd><p><code>character</code>, unique model name</p>
</dd>
<dt><code>tag</code></dt><dd><p><code>character</code>, an optional identifier</p>
</dd>
<dt><code>param</code></dt><dd><p><code>list</code> of parameter key-value pairs</p>
</dd>
<dt><code>param.bounds</code></dt><dd><p>named <code>list</code> of parameter boundaries</p>
</dd>
<dt><code>param.req</code></dt><dd><p><code>character</code> vector of required parameters</p>
</dd>
<dt><code>forcings</code></dt><dd><p><code>list</code> of <code>data.frame</code>s representing forcing time-series</p>
</dd>
<dt><code>forcings.req</code></dt><dd><p><code>character</code> vector or required model forcings data, e.g. temperature</p>
</dd>
<dt><code>init</code></dt><dd><p><code>list</code> of initial model states</p>
</dd>
<dt><code>times</code></dt><dd><p><code>numeric</code> vector of output times, beginning and end also define
the simulated period</p>
</dd>
<dt><code>endpoints</code></dt><dd><p><code>character</code> vector of endpoints to calculate results for</p>
</dd>
<dt><code>exposure</code></dt><dd><p><code>data.frame</code> with two columns representing an exposure time-series</p>
</dd>
<dt><code>control</code></dt><dd><p><code>list</code> of named numerical vectors, contains the control values
for all relevant moving windows</p>
</dd>
<dt><code>control.req</code></dt><dd><p><code>logical</code>, if <code>TRUE</code> then control values are required to
calculate effects</p>
</dd>
<dt><code>window.length</code></dt><dd><p><code>numeric</code>, maximum length of the simulated period, if
<code>window.length</code> is shorter than the exposure pattern, then all possible
exposure sub-patterns are evaluated for effect calculation. This is also
referred to as a moving window approach.</p>
</dd>
<dt><code>window.interval</code></dt><dd><p><code>numeric</code>, interval determining distance between moving
windows during effect calculation. First window starts at first time point
in exposure pattern.</p>
</dd>
</dl>


<h3>See Also</h3>

<p>Other scenario-related: 
<code><a href="#topic+Transferable">Transferable</a></code>
</p>

<hr>
<h2 id='Schmitt2013'>A Lemna data set with multiple treatment levels</h2><span id='topic+Schmitt2013'></span>

<h3>Description</h3>

<p>Data are from Schmitt 2013 publication.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Schmitt2013
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 56 rows and 4 columns.
</p>


<h3>References</h3>

<p>Schmitt W., Bruns E., Dollinger M., and Sowig P., 2013: <em>Mechanistic TK/TD-model
simulating the effect of growth inhibitors on Lemna populations</em>. Ecol Model 255,
pp. 1-10. <a href="https://doi.org/10.1016/j.ecolmodel.2013.01.017">doi:10.1016/j.ecolmodel.2013.01.017</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Lemna-models">Lemna-models</a>
</p>

<hr>
<h2 id='sequence'>Sequence of scenarios</h2><span id='topic+sequence'></span><span id='topic+ScenarioSequence-class'></span>

<h3>Description</h3>

<p>A sequence of scenarios is treated as a single scenario and each scenario
is simulated one after the other. If scenario <code>n</code> in a sequence was simulated,
scenario <code>n+1</code> will start off in the model state where <code>n</code> has ended.
Scenario sequences can be used to e.g. implement changes in model parameters
over time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sequence(seq, breaks = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sequence_+3A_seq">seq</code></td>
<td>
<p>list of <a href="#topic+scenario">scenario</a> objects</p>
</td></tr>
<tr><td><code id="sequence_+3A_breaks">breaks</code></td>
<td>
<p>optional vector of <em>numerics</em>, scenarios' output times will
be modified so that one scenario ends at the break and the next one begins</p>
</td></tr>
</table>


<h3>Details</h3>



<h4>Requirements</h4>

<p>All scenarios in a sequence must fulfill the following requirements:
</p>

<ul>
<li><p> All scenarios must have identical state variables
</p>
</li>
<li><p> The <em>output times</em> of all scenarios must represent a continuous time series
without gaps or overlaps
</p>
</li></ul>

<p>Using the <code>breaks</code> parameter, the function can split up the scenarios'
output times at the given break points. The break points must be within
the interval defined by the superset of all output times in the sequence.
</p>



<h4>Limitations</h4>

<p>Only simulation of sequences are supported, at the moment.
Effects and effect profiles (EPx values) cannot be derived, yet.
</p>



<h3>Value</h3>

<p>an S4 object of type <a href="#topic+ScenarioSequence-class">ScenarioSequence</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Create a scenario with background mortality only
scen1 &lt;- minnow_it %&gt;%
  set_noexposure() %&gt;%
  set_times(0:10)
# Modify a scenario parameter, e.g. set background mortality to zero
scen2 &lt;- scen1 %&gt;% set_param(c(hb=0))

# Create a sequence of scenarios, scenario #1 will be simulated for the
# time period [0, 4], and #2 for [4, 10]
sq &lt;- sequence(list(scen1, scen2), breaks=c(4))

# Simulate the sequence: the mortality stops after t=4.0, due to scenario #2
# being simulated after t=4.0, which disabled the background mortality
simulate(sq)

</code></pre>

<hr>
<h2 id='set_bounds'>Set boundaries of model parameters</h2><span id='topic+set_bounds'></span><span id='topic+set_bounds+2CEffectScenario+2Clist-method'></span><span id='topic+set_bounds+2CCalibrationSet+2Clist-method'></span><span id='topic+set_bounds+2Clist+2Clist-method'></span>

<h3>Description</h3>

<p>Modifies the boundaries of model parameters for one or more <a href="#topic+scenario">scenario</a> or
<a href="#topic+caliset">caliset</a> objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_bounds(x, bounds)

## S4 method for signature 'EffectScenario,list'
set_bounds(x, bounds)

## S4 method for signature 'CalibrationSet,list'
set_bounds(x, bounds)

## S4 method for signature 'list,list'
set_bounds(x, bounds)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_bounds_+3A_x">x</code></td>
<td>
<p>vector of <a href="#topic+scenario">scenario</a> or <a href="#topic+caliset">caliset</a> objects</p>
</td></tr>
<tr><td><code id="set_bounds_+3A_bounds">bounds</code></td>
<td>
<p>named list of numerical vectors, where the first level lists the parameters
by name, and the second level lists the lower and upper boundary</p>
</td></tr>
</table>


<h3>Value</h3>

<p><a href="#topic+scenario">scenario</a> or <a href="#topic+caliset">caliset</a> with modified parameter boundaries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>metsulfuron %&gt;%
   set_bounds(list(k_phot_max = c(0, 30),
                   k_resp = c(0, 10)))

</code></pre>

<hr>
<h2 id='set_endpoints'>Set effect endpoints</h2><span id='topic+set_endpoints'></span>

<h3>Description</h3>

<p>Effect endpoints calculated by functions such as <code><a href="#topic+effect">effect()</a></code> and <code><a href="#topic+epx">epx()</a></code>
can be enabled and disabled. If an endpoint is not required for an assessment,
it should be disabled for reasons of computational efficiency. Please refer
to the model description for a list of available endpoints.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_endpoints(x, endpoints)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_endpoints_+3A_x">x</code></td>
<td>
<p>vector of <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="set_endpoints_+3A_endpoints">endpoints</code></td>
<td>
<p><code>character</code> vector of endpoint names</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Modified <code>EffectScenario</code> objects
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Only enable reproduction (R) endpoint for americamysis scenario
americamysis %&gt;%
  set_endpoints("R") %&gt;%
  effect()

# Enable endpoints length (L) and reproduction (R)
americamysis %&gt;%
  set_endpoints(c("L","R")) %&gt;%
  effect()
</code></pre>

<hr>
<h2 id='set_exposure'>Set exposure time-series</h2><span id='topic+set_exposure'></span><span id='topic+set_exposure+2CANY+2CANY-method'></span><span id='topic+set_exposure+2CEffectScenario+2Cdata.frame-method'></span><span id='topic+set_exposure+2CEffectScenario+2CExposureSeries-method'></span><span id='topic+set_exposure+2CEffectScenario+2Clist-method'></span><span id='topic+set_exposure+2Clist+2Clist-method'></span><span id='topic+set_exposure+2Clist+2CANY-method'></span>

<h3>Description</h3>

<p><em>Exposure</em> refers to the toxicant concentration an organism is exposed to.
In case of aquatic organisms, this would commonly be the concentration of a
toxicant in water. Other interpretations are possible depending on model
assumptions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_exposure(scenarios, series, ...)

## S4 method for signature 'ANY,ANY'
set_exposure(scenarios, series, ...)

## S4 method for signature 'EffectScenario,data.frame'
set_exposure(scenarios, series, ...)

## S4 method for signature 'EffectScenario,ExposureSeries'
set_exposure(scenarios, series, reset_times = TRUE)

## S4 method for signature 'EffectScenario,list'
set_exposure(scenarios, series, ...)

## S4 method for signature 'list,list'
set_exposure(scenarios, series, ...)

## S4 method for signature 'list,ANY'
set_exposure(scenarios, series, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_exposure_+3A_scenarios">scenarios</code></td>
<td>
<p><code>vector</code> of <a href="#topic+scenarios">scenarios</a></p>
</td></tr>
<tr><td><code id="set_exposure_+3A_series">series</code></td>
<td>
<p><code>vector</code> of  <a href="#topic+ExposureSeries">ExposureSeries</a> objects or a single <code>data.frame</code></p>
</td></tr>
<tr><td><code id="set_exposure_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
<tr><td><code id="set_exposure_+3A_reset_times">reset_times</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code>, the exposure time-series' time points
will be set as output times. Defaults to <code>TRUE</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Exposure time-series are generally represented by a <code>data.frame</code> containing two
columns. The first column for time, the second representing the
exposure level. The ordering of columns is mandatory. The column names
are non-relevant but sensible names may help documenting the
scenario and its data. The <code>data.frame</code>'s rows must be ordered chronologically.
A time-series can consist of only a single row; in this case it will represent constant
exposure.
</p>
<p>For convenience, a time-series with zero exposure can be set using
<code><a href="#topic+set_noexposure">set_noexposure()</a></code>.
</p>


<h4>Computational efficiency</h4>

<p>Handling time-series is a costly task for the ODE solver due to consistency
checks and interpolation between time steps. How the solver interpolates
the time-series can be controlled by optional arguments to functions
such as <code><a href="#topic+simulate">simulate()</a></code> and <code><a href="#topic+effect">effect()</a></code>. Please refer to <code><a href="#topic+simulate">simulate()</a></code> for a brief
overview and <a href="deSolve.html#topic+forcings">deSolve::forcings</a> for a detailed description.
</p>
<p>Exposure time-series should be kept as short as possible and as complex as
needed for optimal computational efficiency.
</p>



<h4>Output times</h4>

<p>By default, the exposure time-series' time points will also be used as output
times of the scenario. Any output times previously set by <code><a href="#topic+set_times">set_times()</a></code> will
be lost. If this behavior is undesired, set the function argument
<code>reset_times=FALSE</code>.
</p>



<h4>Multiple exposure series and scenarios</h4>

<p>The functions supports modifying multiple scenarios at once: by
calling it with lists of <a href="#topic+scenario">scenario</a> and <a href="#topic+ExposureSeries">ExposureSeries</a>
objects. The cartesian product of all scenarios and exposure series will
be returned, iff the parameter <code>expand = TRUE</code> is set.
</p>
<p>As an example for the <em>expand</em> mode, two scenarios <code>A</code> and <code>B</code> and one
exposure series <code>g</code> will result in two scenarios <code>Ag</code> and <code>Bg</code>, both
using exposure series <code>g</code>. Two scenarios <code>A</code> and <code>B</code> as well as two
exposure seres <code>g</code> and <code>h</code> will result in four scenarios <code>Ag</code>,<code>Ah</code>,<code>Bg</code>,
and <code>Bh</code>.
</p>



<h3>Value</h3>

<p><code>list</code> of <code>EffectScenario</code> objects
</p>


<h3>Examples</h3>

<pre><code class='language-R'># set a data.frame as exposure series
Lemna_Schmitt() %&gt;% set_exposure(data.frame(time=c(0, 1, 2, 3), conc=c(1, 1, 0, 0)))

# set one ExposureSeries
es1 &lt;- ExposureSeries(data.frame(time=0, conc=0))
Lemna_Schmitt() %&gt;% set_exposure(es1)

# set two ExposureSeries to create two scenarios
es2 &lt;- ExposureSeries(data.frame(time=5:10, conc=1))
Lemna_Schmitt() %&gt;% set_exposure(c(es1, es2))

# set one ExposureSeries without resetting existing output times
Lemna_Schmitt() %&gt;%
  set_times(0:5) %&gt;%
  set_exposure(es1, reset_times=FALSE)
</code></pre>

<hr>
<h2 id='set_forcings'>Set time-dependent parameters</h2><span id='topic+set_forcings'></span><span id='topic+set_forcings+2CEffectScenario-method'></span><span id='topic+set_forcings+2Clist-method'></span>

<h3>Description</h3>

<p>Parameters which change their value over time are referred to as <em>forcings</em>.
If and what parameters can vary over time depends on the model in question.
In many cases, <em>forcings</em> represent time-series of environmental properties.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_forcings(x, ...)

## S4 method for signature 'EffectScenario'
set_forcings(x, ...)

## S4 method for signature 'list'
set_forcings(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_forcings_+3A_x">x</code></td>
<td>
<p>(vector of) <a href="#topic+scenario">scenario</a> objects</p>
</td></tr>
<tr><td><code id="set_forcings_+3A_...">...</code></td>
<td>
<p>named argument list to set as forcings</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Forcing time-series are always represented by a
<code>data.frame</code> containing two columns. The first column representing time,
the second representing the parameter that is a function of time. The
ordering of columns is mandatory. The column names are essentially irrelevant
but may help documenting the scenario and its data. The rows must be
ordered chronologically. A time-series can consist of only a single row; in
this case it will represent constant conditions.
</p>
<p>Handling forcing time-series is a costly task for the ODE solver due to consistency
checks and interpolation between timesteps. How the solver interpolates
the forcing time-series can be controlled by certain arguments to functions
such as <code><a href="#topic+simulate">simulate()</a></code> and <code><a href="#topic+effect">effect()</a></code>. Please refer to <code><a href="#topic+simulate">simulate()</a></code> for a brief
overview and <a href="deSolve.html#topic+forcings">deSolve::forcings</a> for a detailed description.
</p>
<p>Forcing time-series should be kept as short as possible and as complex as
needed for optimal computational efficiency.
</p>


<h3>Value</h3>

<p>Modified <a href="#topic+scenarios">scenarios</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># constant values will be automatically converted to a data.frame
Lemna_Schmitt() %&gt;% set_forcings(temp=20) -&gt; lemna
lemna@forcings

# setting multiple forcings at once
df &lt;- data.frame(t=0:14, temp=rnorm(15, mean=20)) # random temperature series
Lemna_Schmitt() %&gt;% set_forcings(temp=df, rad=15000) -&gt; lemna
lemna@forcings

# forcings can also be supplied as a named list
Lemna_Schmitt() %&gt;% set_forcings(list(temp=20, rad=15000)) -&gt; lemna
lemna@forcings
</code></pre>

<hr>
<h2 id='set_init'>Set initial state</h2><span id='topic+set_init'></span><span id='topic+set_init+2Cvector-method'></span><span id='topic+set_init+2CEffectScenario-method'></span>

<h3>Description</h3>

<p>The <em>initial state</em> represents the starting values of a scenario's state
variables when starting a simulation. A scenario's default initial state
may be insufficient to get sensible results.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_init(x, init)

## S4 method for signature 'vector'
set_init(x, init)

## S4 method for signature 'EffectScenario'
set_init(x, init)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_init_+3A_x">x</code></td>
<td>
<p>vector of <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="set_init_+3A_init">init</code></td>
<td>
<p>named numeric vector</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In theory, a scenarios's state variables can be renamed by modifying the names
of the initial state vector. However, this is strongly
discouraged as this will affect other routines such as <code><a href="#topic+effect">effect()</a></code> and <code><a href="#topic+epx">epx()</a></code>
and may render results useless.
</p>


<h3>Value</h3>

<p>modified <code>EffectScenario</code> objects
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Set initial biomass to 1.0
metsulfuron %&gt;% set_init(c(BM=1.0)) %&gt;% simulate()
</code></pre>

<hr>
<h2 id='set_mode_of_action'>Set mode of action</h2><span id='topic+set_mode_of_action'></span><span id='topic+set_moa'></span>

<h3>Description</h3>

<p>Updates the model parameter <code>MoA</code> to a certain value
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_mode_of_action(x, code)

set_moa(x, code)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_mode_of_action_+3A_x">x</code></td>
<td>
<p>vector of <a href="#topic+scenarios">scenarios</a></p>
</td></tr>
<tr><td><code id="set_mode_of_action_+3A_code">code</code></td>
<td>
<p>a code for a mode of action, refer to model description for
details</p>
</td></tr>
</table>


<h3>Value</h3>

<p>modified <a href="#topic+scenarios">scenarios</a>
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>set_moa()</code>: Shorthand version
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'># Set MoA=8, i.e. hazard during oogenesis
americamysis %&gt;%
  set_mode_of_action(8) %&gt;%
  effect(method="ode45")

# alternative approach using the parameter directly
americamysis %&gt;%
  set_param(c(MoA=8)) %&gt;%
  effect(method="ode45")
</code></pre>

<hr>
<h2 id='set_noexposure'>Set zero exposure</h2><span id='topic+set_noexposure'></span>

<h3>Description</h3>

<p>The scenarios current exposure is replaced by a constant exposure time-series
of value zero(<code>0.0</code>). Output times are unaffected.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_noexposure(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_noexposure_+3A_x">x</code></td>
<td>
<p>vector of <a href="#topic+scenarios">scenarios</a></p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of <a href="#topic+scenarios">scenarios</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Derive effect size in sample scenario without toxicant exposure
minnow_it %&gt;%
  set_noexposure() %&gt;%
  effect()
</code></pre>

<hr>
<h2 id='set_param'>Set model parameters</h2><span id='topic+set_param'></span><span id='topic+set_param+2CEffectScenario+2Cvector-method'></span><span id='topic+set_param+2CEffectScenario+2CParameterSet-method'></span><span id='topic+set_param+2Clist+2CParameterSet-method'></span><span id='topic+set_param+2Clist+2Cvector-method'></span><span id='topic+set_param+2CScenarioSequence+2Cvector-method'></span><span id='topic+set_param+2CScenarioSequence+2CParameterSet-method'></span>

<h3>Description</h3>

<p>Modifies the parameters of one or more <code>EffectScenario</code> objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_param(x, param)

## S4 method for signature 'EffectScenario,vector'
set_param(x, param)

## S4 method for signature 'EffectScenario,ParameterSet'
set_param(x, param)

## S4 method for signature 'list,ParameterSet'
set_param(x, param)

## S4 method for signature 'list,vector'
set_param(x, param)

## S4 method for signature 'ScenarioSequence,vector'
set_param(x, param)

## S4 method for signature 'ScenarioSequence,ParameterSet'
set_param(x, param)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_param_+3A_x">x</code></td>
<td>
<p>object(s) to modify</p>
</td></tr>
<tr><td><code id="set_param_+3A_param">param</code></td>
<td>
<p>named numeric <code>vector</code> with parameter names and value OR a
list of <a href="#topic+parameter_set-class">parameter_set</a> objects</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Most parameters are represented by numerical types but other types
are possible depending on model. Please refer to the model description
which parameters are required and in which unit. Some or all parameters may
be required to start a simulation. If required parameters are missing,
simulation will fail with an error message.
</p>


<h3>Value</h3>

<p>Vector of modified objects
</p>


<h3>Examples</h3>

<pre><code class='language-R'>Lemna_Schmitt() %&gt;% set_param(c(Emax=1,EC50=0.12))
</code></pre>

<hr>
<h2 id='set_tag'>Set a tag</h2><span id='topic+set_tag'></span>

<h3>Description</h3>

<p>Sets the user-defined, custom tag of a scenario. Tags
can be helpful to quickly distinguish scenarios of the same model type.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_tag(x, tag)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_tag_+3A_x">x</code></td>
<td>
<p>(vector of) <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="set_tag_+3A_tag">tag</code></td>
<td>
<p>vector of <code>character</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>(vector of) modified <code>EffectScenario</code> objects
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_tag">get_tag()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># set a custom tag
myscenario &lt;- GUTS_RED_SD() %&gt;% set_tag("My Custom Tag")

# returns `My Custom Tag`
get_tag(myscenario)

# the tag also appears in the scenario overview
myscenario
</code></pre>

<hr>
<h2 id='set_times'>Set output times</h2><span id='topic+set_times'></span>

<h3>Description</h3>

<p>Minimum and maximum output times define the simulated period for a scenario.
Simulation results will be returned for each output time, see <code><a href="#topic+simulate">simulate()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_times(x, times)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_times_+3A_x">x</code></td>
<td>
<p>vector of <a href="#topic+scenarios">scenarios</a></p>
</td></tr>
<tr><td><code id="set_times_+3A_times">times</code></td>
<td>
<p><code>numerical</code> vector</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Be aware that output times may be modified by <code><a href="#topic+set_exposure">set_exposure()</a></code>. Precision of
simulation results may be influenced by chosen output times, see <code><a href="#topic+simulate">simulate()</a></code>
for more information.
</p>


<h3>Value</h3>

<p>Vector of modified <a href="#topic+scenarios">scenarios</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+simulate">simulate()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Set simulated period to [2,4] with output intervals of length 1
minnow_it %&gt;% set_times(c(2,3,4))

# Decrease output interval length to 0.1
minnow_it %&gt;% set_times(seq(2, 4, 0.1))
</code></pre>

<hr>
<h2 id='set_transfer'>Set transfer events</h2><span id='topic+set_transfer'></span><span id='topic+set_transfer+2CANY-method'></span><span id='topic+set_transfer+2CTransferable-method'></span><span id='topic+set_notransfer'></span>

<h3>Description</h3>

<p>A <em>transfer</em> refers to an event where a certain amount of biomass
is moved to a new medium after a period of time. Effectively, this resets
the scenario's state variable representing biomass and re-scales all state
variables which are correlated with biomass, such as adsorbed chemical mass.
This feature replicates a procedure occurring e.g. in <em>Lemna</em> effect studies
and may be necessary to recreate study results.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_transfer(x, interval, times, biomass, scaled_comp)

## S4 method for signature 'ANY'
set_transfer(x, interval, times, biomass, scaled_comp)

## S4 method for signature 'Transferable'
set_transfer(x, interval, times, biomass, scaled_comp)

set_notransfer(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_transfer_+3A_x">x</code></td>
<td>
<p>vector of <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="set_transfer_+3A_interval">interval</code></td>
<td>
<p>optional <code>numeric</code>, interval in time units of the scenario,
set to <code>-1</code> to disable transfers.</p>
</td></tr>
<tr><td><code id="set_transfer_+3A_times">times</code></td>
<td>
<p>optional <code>numeric</code> vector of time points where transfers occur</p>
</td></tr>
<tr><td><code id="set_transfer_+3A_biomass">biomass</code></td>
<td>
<p>optional <code>numeric</code> vector, amount of biomass that is being
transferred at each transfer</p>
</td></tr>
<tr><td><code id="set_transfer_+3A_scaled_comp">scaled_comp</code></td>
<td>
<p>optional <code>character</code> vector of affected compartments
that are scaled according to new biomass levels</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If a transfer occurs, simulation results of that time point will report the model state
<strong>before</strong> the transfer. Be aware that if transfers are defined using the
<code>interval</code> argument, the transfers will always occur relative to time point
zero (<code>t = 0</code>). As an example, setting a regular transfer of seven days,
<code>interval =  7</code>, will result at transfers occurring at time points which are
integer multiplicates of seven, such as <code>t=0</code>, <code>t=7</code>, <code>t=14</code> and so forth.
The starting and end times of a scenario do not influece <strong>when</strong> a regular
transfer occurs, only <strong>if</strong> it occurs.
</p>


<h4>Transferred biomass</h4>

<p>At each transfer, a defined amount of biomass is transferred to a new medium.
This is modeled by interrupting the simulation at a transfer time point, modifying
the biomass level <code>BM</code>, and scaling affected compartments according to new
biomass levels. Scaling of compartments depending on biomass, such as
<em>internal toxicant mass</em>, is necessary to correctly reflect mass balances and
concentrations over time.
</p>
<p>Transferred biomass is set using the <code>biomass</code> parameter. Is is either a
single numerical value in which case the same biomass level is set at each
transfer. Or it is a vector of numerical values with the same length as the
<code>times</code> parameter in which case a custom biomass level can be set for each
transfer. Multiple biomass levels can only be set in conjunction with
custom transfer time points.
</p>
<p>Some scenario types define default values for transferred biomass based
on common study set ups.
</p>



<h4>Regular and custom transfer time points</h4>

<p>Transfers can occur either in regular intervals of time or at selected, custom
time points. For regular intervals, the parameter <code>interval</code> is set to a single
numeric value which has the same unit as the scenario's time dimension. As an
example: if a scenario uses the unit of <em>days</em> for time, the transfer interval
is also specified in <em>days</em>:
</p>
<p>Transfers occurring at custom time points are set by passing a numerical vector
to the parameter <code>times</code>. The time points' units must match with the unit of
time in the scenario. A custom transfer time point <strong>must not occur at the
starting time point of a simulation</strong>.
</p>



<h4>Affected compartments</h4>

<p>Some compartments depend on biomass to correctly reflect mass balances and
concentrations over time, such as <em>internal toxicant mass</em>. These compartments
need to be scaled linearly to reflect the change in biomass levels.
The parameter <code>scaled_comp</code> accepts a character vector of compartment names
which are scaled at each transfer. This parameter should only be used with
custom, user-defined models. If no compartment needs to be scaled, set or
use the default value of <code>character(0)</code>.
</p>



<h3>Value</h3>

<p>Modified <a href="#topic+scenario">scenario</a> objects
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>set_notransfer()</code>: Disable biomass transfers
</p>
</li></ul>


<h3>See Also</h3>

<p><a href="#topic+Lemna-models">Lemna-models</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate biomass transfer of 50 *g/m²* at a regular interval of 7 *days*
metsulfuron %&gt;%
  set_transfer(interval=7, biomass=50) %&gt;%
  simulate()

# Simulate irregular biomass transfers occuring at days 5, 10, and 12
metsulfuron %&gt;%
  set_transfer(times=c(5, 10, 12), biomass=50) %&gt;%
  simulate()

# Simulate irregular transfers with changing amounts of transferred biomass
metsulfuron %&gt;%
  set_transfer(times=c(5, 10, 12), biomass=c(50, 20, 10)) %&gt;%
  simulate()

# Disable all biomass transfers
metsulfuron %&gt;%
  set_notransfer() %&gt;%
  simulate()
</code></pre>

<hr>
<h2 id='set_window'>Set window length</h2><span id='topic+set_window'></span><span id='topic+set_nowindow'></span>

<h3>Description</h3>

<p>Exposure windows are defined as a period of time at the scale of the exposure series.
As an example: if an exposure series has an hourly time step, a window length
of <code>24</code> will consider the exposure within 24 hours intervals for effect
calculation. The same applies for the window interval, i.e. the period between
considered exposure windows. Set <code>length=-1</code> to disable moving windows.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_window(x, length, interval)

set_nowindow(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_window_+3A_x">x</code></td>
<td>
<p>vector of <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="set_window_+3A_length">length</code></td>
<td>
<p><code>numeric</code>, length of exposure window to consider for effect
calculation, set <code>length=-1</code> to disable moving windows</p>
</td></tr>
<tr><td><code id="set_window_+3A_interval">interval</code></td>
<td>
<p><code>numeric</code>, interval between considered exposure windows</p>
</td></tr>
</table>


<h3>Value</h3>

<p>modified <code>EffectScenario</code> objects
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>set_nowindow()</code>: Disable moving windows
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'># Calculate the maximum effect for all windows of 10 days length
metsulfuron %&gt;%
  set_window(length=10, interval=1) %&gt;%
  effect()

# Disable moving exposure windows
metsulfuron %&gt;%
  set_nowindow() %&gt;%
  effect()
</code></pre>

<hr>
<h2 id='simulate'>Simulate an effect scenario</h2><span id='topic+simulate'></span><span id='topic+simulate+2CEffectScenario-method'></span><span id='topic+simulate+2CTransferable-method'></span><span id='topic+simulate+2CScenarioSequence-method'></span><span id='topic+simulate+2CSimulationBatch-method'></span>

<h3>Description</h3>

<p>The supplied <code>EffectScenario</code> is passed on to the ODE solver for numerical
integration. Internally, <code>simulate()</code> is split up into several functions
dedicated to particular models, e.g. one for GUTS and one for Lemna type
models. The package will take care of using the correct function
for each model when <code>simulate()</code> is called.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate(x, ...)

## S4 method for signature 'EffectScenario'
simulate(x, ...)

## S4 method for signature 'Transferable'
simulate(x, ...)

## S4 method for signature 'ScenarioSequence'
simulate(x, ...)

## S4 method for signature 'SimulationBatch'
simulate(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="simulate_+3A_x">x</code></td>
<td>
<p><a href="#topic+scenario">scenario</a> to simulate</p>
</td></tr>
<tr><td><code id="simulate_+3A_...">...</code></td>
<td>
<p>additional parameters passed on to ODE solver</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Simulation results are returned as a time-series for each state
variable. Some models provide additional properties describing the model state,
e.g. the internal concentration of a toxicant within the organism. Refer
to the respective <a href="#topic+scenario">scenario</a> for more information.
</p>
<p>Additional arguments to <code>simulate()</code> will be passed on to <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code>
which enables control of the numerical integration parameters.
</p>


<h4>Output times and windows</h4>

<p>The minimum and maximum of given time points define the simulated
period. However, the simulation can also be limited to
a subset of time points by enabling a moving exposure window, see <code><a href="#topic+set_window">set_window()</a></code>.
</p>
<p>Results will be returned for each output time point. Precision of the numeric solver
may be affected by chosen output times in certain cases. Hence, small deviations
in results should be expected if different output times are set. This effect
can be mitigated by either defining are sufficiently small time step for the solver
using argument <code>hmax</code> or by decreasing the error tolerances <code>atol</code> and <code>rtol</code>.
These arguments are passed to the solver, see e.g. <code><a href="deSolve.html#topic+lsoda">deSolve::lsoda()</a></code> for details.
</p>



<h4>Optional output variables</h4>

<p>Some models support adding intermediary model variables to the return value
of <code>simulate()</code>. Analyzing the additional outputs may be helpful to understand
model behavior and support finding potential issues in model parameterization.
</p>
<p>Optional outputs are enabled by setting the parameter <code>nout</code> to a value greater
than zero. If <code>nout</code> is set to <code>n</code>, then the first <code>n</code> optional output columns
will be returned along the normal simulation result.
</p>
<p>Which optional outputs are available depends on the model/scenario at hand.
Please refer to the model documentation for details.
As an example, the <a href="#topic+GUTS_RED_IT">GUTS-RED-IT</a> model supports adding the
external toxicant concentration to the output by setting <code>nout=1</code>:
</p>
<p><code>minnow_it %&gt;% simulate(nout=1)</code>
</p>



<h4>Numerical precision and stability</h4>

<p>Each model was assigned a default ODE solver which handles most of the
occurring inputs well. In most cases, this will be an explicit numerical
scheme of the Runge-Kutta family with variable step width. For certain extreme
parameters settings, such as very high uptake/permeability of the contaminant
or exposure series which represent step functions, the numerical approximation
might deteriorate and yield invalid results. In this case try to decrease the
allowed max step width by setting the argument <code>hmax</code> with various values.
Start with <code>hmax=1</code> and decrease the value by orders of 10. It is not
possible or desirable to reduce <code>hmax</code> to extremely small values, as the
ODE solver will require more CPU time and simulation will become inefficient.
</p>
<p>Oftentimes, it will be computational more efficient to adapt the solver's
error tolerances <code>atol</code> and <code>rtol</code> than reducing the step width <code>hmax</code> to achieve
stable numerics. Start by decreasing deSolve's default values by
orders of ten until the simulation yields acceptable results, see e.g.
<code><a href="deSolve.html#topic+lsoda">deSolve::lsoda()</a></code> for more information on error tolerances.
</p>
<p>As an alternative to adapting solver parameters, it might be worthwhile to
try other numerical schemes which can handle stiff ODEs, such as Radau, LSODA,
or LSODES. To change solvers, set the <code>method</code> argument.
To select e.g. the Radau scheme, set <code>method="radau"</code>. For LSODA, set <code>method="lsoda"</code>.
Radau performs better than LSODA in some cases, as the latter method can return
biologically nonsensical results without raising an error. See <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code>
for details on available ODE solvers.
</p>



<h3>Value</h3>

<p>A <code>data.frame</code> with the time-series of simulation results
</p>


<h3>Examples</h3>

<pre><code class='language-R'># base R syntax
simulate(minnow_sd)
# tidy syntax with the same result
minnow_sd %&gt;% simulate()

# Extend the simulated time frame to the interval [0, 10]
minnow_sd %&gt;%
  set_times(seq(0, 10)) %&gt;%
  simulate()

# Use an alternative exposure profile, but keep the original output times
minnow_sd %&gt;%
  set_exposure(data.frame(t=0, c=10), reset_times=FALSE) %&gt;%
  simulate()

##
## Precision of results

# A large number of output times forces smaller solver time steps
minnow_it %&gt;%
  set_times(seq(0, 10, 0.001)) %&gt;%
  simulate() %&gt;%
  tail()

# Defining only two output times allows the ODE solver to make larger steps
# in time during numerical integration. However, results can become
# imprecise.
minnow_long &lt;- minnow_it %&gt;% set_times(c(0, 10))
minnow_long %&gt;% simulate()

# Numerical precision of results can be increased by limiting the solver's
# maximum step length in time using argument `hmax`.
minnow_long %&gt;% simulate(hmax=0.005)

# A similar numerical precision can be achieved by switching to an alternative
# numerical integration scheme, such as the Radau scheme, without limiting
# the step length.
minnow_long %&gt;% simulate(method="radau")

# Reducing the step length even further may increase numerical precision, but
# may exceed the solver's allowed number of integration steps per output interval.
# The following simulation will be aborted with a solver error:
try(
  minnow_long %&gt;% simulate(hmax=0.001)
)

# However, the solver's maximum number of allowed steps can be increased,
# if needed, using the argument `maxsteps`:
minnow_long %&gt;% simulate(hmax=0.001, maxsteps=10^5)
</code></pre>

<hr>
<h2 id='simulate_batch'>Batch simulation using multiple exposure series</h2><span id='topic+simulate_batch'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate_batch(model_base, treatments, param_sample = deprecated())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="simulate_batch_+3A_model_base">model_base</code></td>
<td>
<p>effect scenario object with mean parameters</p>
</td></tr>
<tr><td><code id="simulate_batch_+3A_treatments">treatments</code></td>
<td>
<p>treatments exposure levels as data frame (time, conc, trial)</p>
</td></tr>
<tr><td><code id="simulate_batch_+3A_param_sample">param_sample</code></td>
<td>
<p><em>deprecated</em> parameter, no longer in use</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A convenience function to simulate a single base scenario with one or more
exposure series. This aims at reproducing the setup and results of common
effect studies.
</p>
<p>A scenario contains only one exposure series. However, laboratory experiments
commonly examine the effects of multiple exposure levels on a biological system.
A batch simulation approach would involve running multiple simulations with
varying exposure or treatment conditions. To illustrate, if the objective is
to examine the impact of a substance on cell growth, the simulation model
could be designed to replicate the cell growth dynamics under varying
concentrations of the substance. Each simulation run would represent a
specific exposure level, ranging from low to high concentrations of the
chemical. To simulate such a laboratory experiment, the simulate_batch
function can be used. All exposure series are saved in the treatment argument.
The first column contains the time, the second column the concentration, and
the third column the trial name (exposure level, e.g. 'T1', 'T2', 'T3').
</p>


<h3>Value</h3>

<p>a <code>data.frame</code> with simulation results
</p>


<h3>Examples</h3>

<pre><code class='language-R'>t1 &lt;- data.frame(time=0:10, conc=0, trial="control")  # 1st treatment level
t2 &lt;- data.frame(time=0:10, conc=1, trial="T1")       # 2nd treatment level
treatments &lt;- rbind(t1, t2)

metsulfuron %&gt;%
  simulate_batch(treatments)
</code></pre>

<hr>
<h2 id='solver'>Calls ODE solver for a particular model</h2><span id='topic+solver'></span><span id='topic+solver+2CANY-method'></span><span id='topic+solver+2CAlgaeWeber-method'></span><span id='topic+solver+2CAlgaeTKTD-method'></span><span id='topic+solver+2CAlgaeSimple-method'></span><span id='topic+solver+2CDebAbj-method'></span><span id='topic+solver+2CDebTox-method'></span><span id='topic+solver+2CDebDaphnia-method'></span><span id='topic+solver+2CGutsRedSd-method'></span><span id='topic+solver+2CGutsRedIt-method'></span><span id='topic+solver+2CLemnaSetac-method'></span><span id='topic+solver+2CLemnaSchmitt-method'></span><span id='topic+solver+2CMyrioExp-method'></span><span id='topic+solver+2CMyrioLog-method'></span>

<h3>Description</h3>

<p>Please refer to the <em>Modeling Howto</em> vignette on how to implement custom
models by overloading the <code>solver</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solver(scenario, ...)

## S4 method for signature 'ANY'
solver(scenario, ...)

## S4 method for signature 'AlgaeWeber'
solver(scenario, method = "lsoda", hmax = 0.1, ...)

## S4 method for signature 'AlgaeTKTD'
solver(scenario, method = "lsoda", hmax = 0.1, ...)

## S4 method for signature 'AlgaeSimple'
solver(scenario, method = "lsoda", hmax = 0.1, ...)

## S4 method for signature 'DebAbj'
solver(scenario, ...)

## S4 method for signature 'DebTox'
solver(scenario, method = "ode45", ...)

## S4 method for signature 'DebDaphnia'
solver(scenario, ...)

## S4 method for signature 'GutsRedSd'
solver(scenario, ...)

## S4 method for signature 'GutsRedIt'
solver(scenario, ...)

## S4 method for signature 'LemnaSetac'
solver(scenario, ...)

## S4 method for signature 'LemnaSchmitt'
solver(scenario, ...)

## S4 method for signature 'MyrioExp'
solver(scenario, ...)

## S4 method for signature 'MyrioLog'
solver(scenario, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solver_+3A_scenario">scenario</code></td>
<td>
<p><a href="#topic+scenario">scenario</a> object</p>
</td></tr>
<tr><td><code id="solver_+3A_...">...</code></td>
<td>
<p>additional parameters passed on to <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code></p>
</td></tr>
<tr><td><code id="solver_+3A_method">method</code></td>
<td>
<p>string, numerical solver used by <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code></p>
</td></tr>
<tr><td><code id="solver_+3A_hmax">hmax</code></td>
<td>
<p>numeric, maximum step length in time, see <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Some solvers may set reasonable default values for e.g. maximum step
length in time (<code>hmax</code>), but not all do. Please check the model documentation for
details.
</p>


<h3>Value</h3>

<p><code>data.frame</code> with simulation results
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>solver(ANY)</code>: Default solver, raises an error
</p>
</li>
<li> <p><code>solver(AlgaeWeber)</code>: numerically integrates Algae_Weber models
</p>
</li>
<li> <p><code>solver(AlgaeTKTD)</code>: numerically integrates Algae_TKTD models
</p>
</li>
<li> <p><code>solver(AlgaeSimple)</code>: numerically integrates Algae_Simple models
</p>
</li>
<li> <p><code>solver(DebAbj)</code>: Numerically integrates DEB_abj models
</p>
</li>
<li> <p><code>solver(DebTox)</code>: Numerically integrates <em>DEBtox</em> scenarios
</p>
</li>
<li> <p><code>solver(DebDaphnia)</code>: (deprecated) Numerically integrates <em>DEBtox_Daphnia</em> scenarios
</p>
</li>
<li> <p><code>solver(GutsRedSd)</code>: Numerically integrates GUTS-RED-SD models
</p>
</li>
<li> <p><code>solver(GutsRedIt)</code>: Numerically integrates GUTS-RED-IT models
</p>
</li>
<li> <p><code>solver(LemnaSetac)</code>: Numerically integrates Lemna_SETAC models
</p>
</li>
<li> <p><code>solver(LemnaSchmitt)</code>: Numerically integrates Lemna_Schmitt models
</p>
</li>
<li> <p><code>solver(MyrioExp)</code>: Numerically integrates <code>MyrioExp</code> models
</p>
</li>
<li> <p><code>solver(MyrioLog)</code>: Numerically integrates <code>MyrioLog</code> models
</p>
</li></ul>

<hr>
<h2 id='survival'>Survival rate</h2><span id='topic+survival'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
Derives the survival rate of individuals for
<em>Reduced GUTS</em> models. Function was replaced by output of <code><a href="#topic+simulate">simulate()</a></code> and
will be removed in a later version.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>survival(scenario, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="survival_+3A_scenario">scenario</code></td>
<td>
<p>an <code>EffectScenario</code> to simulate</p>
</td></tr>
<tr><td><code id="survival_+3A_...">...</code></td>
<td>
<p>additional parameters passed on to <code><a href="#topic+simulate">simulate()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The survival rate describes the survival probability at each
time point. The function simulates the <em>GUTS</em> scenario and appends a column
<code>survival</code> to the simulation result. A value of one (<code>1.0</code>) denotes that
all individuals survive. A value of zero (<code>0.0</code>) denotes that no individuals
survived.
</p>
<p>Only available for <em>Reduced GUTS</em> models, see <a href="#topic+GUTS-RED-models">GUTS-RED-models</a>.
The equations were described by EFSA (2018).
</p>


<h3>Value</h3>

<p>a <code>data.frame</code> containing simulation results
</p>


<h3>References</h3>

<p>EFSA PPR Panel (EFSA Panel on Plant Protection Products and their Residues),
Ockleford C, Adriaanse P, Berny P, et al., 2018: <em>Scientific Opinion on the
state of the art of Toxicokinetic/Toxicodynamic (TKTD) effect models for
regulatory risk assessment of pesticides for aquatic organisms</em>. EFSA Journal 2018;
16(8):5377, 188 pp. <a href="https://doi.org/10.2903/j.efsa.2018.5377">doi:10.2903/j.efsa.2018.5377</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+GUTS-RED-models">GUTS-RED-models</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># calculate survival rate
minnow_it %&gt;% survival()

# plot survival over time based on a random exposure profile
minnow_sd %&gt;%
  set_exposure(data.frame(t=1:100, c=runif(100)*10)) %&gt;%
  survival() -&gt; df
plot(df$time, df$survival, "l")
</code></pre>

<hr>
<h2 id='Transferable'>Biomass transfer class</h2><span id='topic+Transferable'></span><span id='topic+Biomass-transfer'></span><span id='topic+Transferable-class'></span>

<h3>Description</h3>

<p>By inheriting from class <code>Transferable</code>, a scenario's behavior can be
extended to support transfer and reset of biomass at dedicated points during
simulation.
</p>


<h3>Slots</h3>


<dl>
<dt><code>transfer.times</code></dt><dd><p><code>numeric</code>, vector of custom time points at which transfers occur,
e.g. <code>c(2,5,14)</code></p>
</dd>
<dt><code>transfer.interval</code></dt><dd><p><code>numeric</code>, length of regular interval until biomass transfer to new
medium, regular transfers always occur relative to time point zero</p>
</dd>
<dt><code>transfer.biomass</code></dt><dd><p><code>numeric</code>, amount of biomass transferred to new medium</p>
</dd>
<dt><code>transfer.comp.biomass</code></dt><dd><p><code>character</code> state variable which describes
biomass</p>
</dd>
<dt><code>transfer.comp.scaled</code></dt><dd><p><code>character</code> vector of state variable which will
be scaled 1:1 when biomass is modified, e.g. internal toxicant mass</p>
</dd>
</dl>


<h3>Biomass transfer</h3>

<p>Models supporting biomass transfer can be instructed to move a fixed amount
of biomass to a new medium after a period of time. This feature replicates
a procedure occurring in e.g. <em>Lemna</em> effect studies and may be necessary to
recreate study results.
</p>
<p>The biomass transfer feature assumes that always a fixed amount of
biomass is transferred. Transfers can occur at any fixed point in time or
in regular intervals. During a transfer, the biomass is reset to the
transferred amount and additional compartments can be scaled 1:1 accordingly,
to e.g. reflect the change in internal toxicant mass when biomass is modified.
Transfer settings can be modified using <code><a href="#topic+set_transfer">set_transfer()</a></code>.
</p>
<p>If a transfer occurs, simulation results of that time point will report the model state
<strong>before</strong> the transfer. Be aware that if transfers are defined using the
<code>interval</code> argument, the transfers will always occur relative to time point
zero (<code>t = 0</code>). As an example, setting a regular transfer of seven days,
<code>interval =  7</code>, will result at transfers occurring at time points which are
integer multiplicates of seven, such as <code>t=0</code>, <code>t=7</code>, <code>t=14</code> and so forth.
The starting and end times of a scenario do not influece <strong>when</strong> a regular
transfer occurs, only <strong>if</strong> it occurs.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+set_transfer">set_transfer()</a></code>
</p>
<p>Other scenario-related: 
<code><a href="#topic+Scenarios">Scenarios</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulation without biomass transfers
metsulfuron %&gt;%
  set_noexposure() %&gt;%
  set_notransfer() %&gt;%
  simulate()

# With biomass transfer every 7 days, biomass is reset to 50 *g/m²* on transfer
metsulfuron %&gt;%
  set_noexposure() %&gt;%
  set_transfer(interval=7, biomass=50) %&gt;%
  simulate()
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
