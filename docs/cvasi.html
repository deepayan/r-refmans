<!DOCTYPE html><html><head><title>Help for package cvasi</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {cvasi}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#+25+26gt+3B+25'><p>Pipe operator</p></a></li>
<li><a href='#Algae_Simple'><p>Algae model with exponential growth but without additional forcings</p></a></li>
<li><a href='#Algae_TKTD'><p>Algae model with exponential growth, forcings (P, I) and scaled damage</p></a></li>
<li><a href='#Algae_Weber'><p>Algae model with exponential growth and forcings (I, T)</p></a></li>
<li><a href='#Algae-models'><p>Algae models</p></a></li>
<li><a href='#americamysis'><p>A DEB abj scenario of Americamysis bahia</p></a></li>
<li><a href='#cache_controls'><p>Cache control simulations</p></a></li>
<li><a href='#calibrate'><p>Fit model parameters to experimental data</p></a></li>
<li><a href='#CalibrationSet'><p>Calibration set</p></a></li>
<li><a href='#DEB_abj'><p>DEB_abj</p></a></li>
<li><a href='#DEB_Daphnia'><p>DEBtox Daphnia</p></a></li>
<li><a href='#DEB-models'><p>Dynamic Energy Budget (DEB) models</p></a></li>
<li><a href='#dmagna'><p>A DEBtox Daphnia magna scenario</p></a></li>
<li><a href='#dose_response'><p>Calculate a dose response curve</p></a></li>
<li><a href='#effect'><p>Effect level</p></a></li>
<li><a href='#epx'><p>Effect profiles (EPx values)</p></a></li>
<li><a href='#epx_mtw'><p>Calculate EPx values for a series of moving time window</p></a></li>
<li><a href='#ExposureSeries'><p>Exposure time-series</p></a></li>
<li><a href='#focusd1'><p>A Lemna_SETAC scenario with variable environment</p></a></li>
<li><a href='#fx'><p>Generic to calculate effects for a particular scenario</p></a></li>
<li><a href='#get_model'><p>Get model name</p></a></li>
<li><a href='#get_tag'><p>Get scenario tag</p></a></li>
<li><a href='#GUTS_RED_IT'><p>GUTS-RED-IT scenario</p></a></li>
<li><a href='#GUTS_RED_SD'><p>GUTS-RED-SD scenario</p></a></li>
<li><a href='#GUTS-RED-models'><p>GUTS-RED models</p></a></li>
<li><a href='#import_exposure_text'><p>Import exposure profiles from text files</p></a></li>
<li><a href='#import_swash'><p>SWASH project exposure profile import</p></a></li>
<li><a href='#import_toxswa'><p>Read TOXSWA exposure profiles from out-files</p></a></li>
<li><a href='#is_DEB'><p>Test if argument is a DEB model</p></a></li>
<li><a href='#is_GUTS'><p>Test if argument is a GUTS model</p></a></li>
<li><a href='#is_Lemna'><p>Test if argument is a Lemna model</p></a></li>
<li><a href='#is_LemnaThreshold'><p>Test if argument is a LemnaThreshold model</p></a></li>
<li><a href='#is_scenario'><p>Test if argument is an effect scenario</p></a></li>
<li><a href='#Lemna_Schmitt'><p>Lemna model (Schmitt et al. 2013)</p></a></li>
<li><a href='#Lemna_SETAC'><p>Lemna model (Klein et al. 2021)</p></a></li>
<li><a href='#Lemna-models'><p>Lemna models</p></a></li>
<li><a href='#log_enable'><p>Start and stop logging</p></a></li>
<li><a href='#log_envir'><p>Log R environment properties</p></a></li>
<li><a href='#log_msg'><p>Add a log message</p></a></li>
<li><a href='#log_scenarios'><p>Log scenario properties</p></a></li>
<li><a href='#Macrophyte-models'><p>Macrophyte models</p></a></li>
<li><a href='#metsulfuron'><p>Lemna data published by Schmitt (2013)</p></a></li>
<li><a href='#minnow_it'><p>A GUTS-RED-IT scenario of the fathead minnow</p></a></li>
<li><a href='#minnow_sd'><p>A GUTS-RED-SD scenario of the fathead minnow</p></a></li>
<li><a href='#morse'><p>Import <code>morse</code> model parameters</p></a></li>
<li><a href='#Myrio'><p>Myriophyllum model with exponential growth</p></a></li>
<li><a href='#Myrio_log'><p>Myriophyllum model with logistic growth</p></a></li>
<li><a href='#Myriophyllum-models'><p>Myriophyllum models</p></a></li>
<li><a href='#no_exposure'><p>Zero exposure</p></a></li>
<li><a href='#parameter_set'><p>Set of model parameters</p></a></li>
<li><a href='#pll_debug'><p>Disable parallelization for debugging</p></a></li>
<li><a href='#plot_epx'><p>Plot EPx values</p></a></li>
<li><a href='#plot_ppc'><p>Creates a PPC plot for a single dataset</p></a></li>
<li><a href='#plot_ppc_combi'><p>Create PPC plot for one or more datasets</p></a></li>
<li><a href='#plot_sd'><p>Creates plot of model results (uncertainties optional)</p></a></li>
<li><a href='#pull_metadata'><p>Pull metadata from scenarios</p></a></li>
<li><a href='#Rsubcapitata'><p>An algae scenario</p></a></li>
<li><a href='#Scenarios'><p>Effect scenario classes</p></a></li>
<li><a href='#Schmitt2013'><p>A Lemna data set with multiple treatment levels</p></a></li>
<li><a href='#sequence'><p>Sequence of scenarios</p></a></li>
<li><a href='#set_endpoints'><p>Set effect endpoints</p></a></li>
<li><a href='#set_exposure'><p>Set exposure time-series</p></a></li>
<li><a href='#set_forcings'><p>Set time-dependent parameters</p></a></li>
<li><a href='#set_init'><p>Set initial state</p></a></li>
<li><a href='#set_mode_of_action'><p>Set mode of action</p></a></li>
<li><a href='#set_noexposure'><p>Set zero exposure</p></a></li>
<li><a href='#set_param'><p>Set model parameters</p></a></li>
<li><a href='#set_tag'><p>Set a tag</p></a></li>
<li><a href='#set_times'><p>Set output times</p></a></li>
<li><a href='#set_transfer'><p>Set transfer events</p></a></li>
<li><a href='#set_window'><p>Set window length</p></a></li>
<li><a href='#simulate'><p>Simulate an effect scenario</p></a></li>
<li><a href='#simulate_batch'><p>Batch simulation of several effect scenarios</p></a></li>
<li><a href='#solver'><p>Calls ODE solver for a particular model</p></a></li>
<li><a href='#survival'><p>Survival rate</p></a></li>
<li><a href='#Transferable'><p>Biomass transfer class</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Calibration, Validation, and Simulation of TKTD Models</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Eases the use of ecotoxicological effect models. Can simulate
    common toxicokinetic-toxicodynamic (TK/TD) models such as 
    General Unified Threshold models of Survival (GUTS) and Lemna. It can
    derive effects and effect profiles (EPx) from scenarios. It supports the
    use of 'tidyr' workflows employing the pipe symbol. Time-consuming
    tasks can be parallelized.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/cvasi-tktd/cvasi">https://github.com/cvasi-tktd/cvasi</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/cvasi-tktd/cvasi/issues">https://github.com/cvasi-tktd/cvasi/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>cli, glue, rlang, stringr, dplyr, tibble, purrr, furrr, tidyr,
magrittr, utils, stats, methods, grid, ggplot2, deSolve, lemna,
lubridate, attempt, units, lifecycle</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Collate:</td>
<td>'cache_controls.R' 'class-CalibrationSet.R'
'class-ExposureSeries.R' 'class-EffectScenario.R' 'calibrate.R'
'class-Transferable.R' 'class-Algae.R' 'class-Deb.R'
'class-GutsRed.R' 'class-Lemna.R' 'class-Myriophyllum.R'
'class-ScenarioSequence.R' 'class-parameter_set.R' 'data.R'
'dose_response.R' 'effect.R' 'epx.R' 'get.R' 'globals.R'
'has.R' 'helper_functions.r' 'import.R' 'import_toxswa.R'
'is.R' 'log.R' 'morse.R' 'package.R' 'pll.R' 'plotting.r'
'pull.R' 'sequence.R' 'set.R' 'set_exposure.R' 'set_forcings.R'
'set_init.R' 'set_param.R' 'set_transfer.R' 'set_window.R'
'show.R' 'simulate.R' 'solver.R' 'survival.R' 'utils-pipe.R'
'utils-stats.R'</td>
</tr>
<tr>
<td>Suggests:</td>
<td>future, testthat, morse, knitr, rmarkdown, roxyglobals, rjags</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/roxyglobals/filename:</td>
<td>globals.R</td>
</tr>
<tr>
<td>Config/roxyglobals/unique:</td>
<td>FALSE</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-05-23 10:21:45 UTC; ENCAZ</td>
</tr>
<tr>
<td>Author:</td>
<td>Nils Kehrein [aut, cre],
  Dirk Nickisch [aut],
  Peter Vermeiren [aut],
  Torben Wittwer [ctb],
  Johannes Witt [ctb],
  Andre Gergs [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Nils Kehrein &lt;nils.kehrein@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-05-30 20:10:09 UTC</td>
</tr>
</table>
<hr>
<h2 id='+25+26gt+3B+25'>Pipe operator</h2><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>See <code>magrittr::<a href="magrittr.html#topic+pipe">%&gt;%</a></code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lhs %&gt;% rhs
</code></pre>


<h3>Value</h3>

<p>description
</p>

<hr>
<h2 id='Algae_Simple'>Algae model with exponential growth but without additional forcings</h2><span id='topic+Algae_Simple'></span><span id='topic+AlgaeSimpleScenario-class'></span>

<h3>Description</h3>

<p>The model is a mechanistic combined toxicokinetic-toxicodynamic (TK/TD) and
growth model for algae. It follows the concept of a simplified algae model
described in Rendal et al. (2023). The model simulates the development of
algal biomass. The growth of the algae population is simulated on the basis
of growth rates, which are, in contrast to the Weber model, independent on
environmental conditions which are usually optimal in laboratory effect studies.
The toxicodynamic sub-model describes the effects of growth-inhibiting
substances through a corresponding reduction in the photosynthesis rate on the
basis of internal concentrations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Algae_Simple()
</code></pre>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+AlgaeSimpleScenario-class">AlgaeSimpleScenario</a>
</p>


<h3>State variables</h3>

<p>The model has two state variables:
</p>

<ul>
<li> <p><code>A</code>, Biomass
</p>
</li>
<li> <p><code>Dw</code>, only used if scaled = 1
</p>
</li></ul>



<h3>Model parameters</h3>


<ul>
<li><p> Growth model
</p>

<ul>
<li> <p><code>mu_max</code>, Maximum growth rate (d-1)
</p>
</li>
<li> <p><code>const_growth</code>, constant growth over time (0 = no, 1 = yes)
</p>
</li></ul>

</li>
<li><p> Concentration response (Toxicodynamics)
</p>

<ul>
<li> <p><code>EC_50</code>, Effect concentration of 50% inhibition of growth rate (ug L-1)
</p>
</li>
<li> <p><code>b</code>, slope of concentration effect curve at EC_50 (-)
</p>
</li>
<li> <p><code>dose_response</code>, shape of the dose response curve (0 = logit, 1 = probit)
</p>
</li></ul>

</li>
<li><p> External concentration (Toxicokinetics)
</p>

<ul>
<li> <p><code>kD</code>, dominant rate constant of toxicant in aquatic environments (d-1)
</p>
</li>
<li> <p><code>scaled</code>, 0 = no internal scaled damage / 1 = yes (-)
</p>
</li></ul>

</li></ul>



<h3>Forcings</h3>

<p>simplified model without additional forcings except the external concentration
and a forcing variable f_growth if the growth rates are time-dependent. If
not time dependent, f_growth should be set to 1.
</p>


<h3>Simulation output</h3>

<p>Simulation results will contain state variables.
</p>


<h3>References</h3>

<p>Weber D, Schaeffer D, Dorgerloh M, Bruns E, Goerlitz G, Hammel K, Preuss TG
and Ratte HT, 2012. Combination of a higher-tier flow-through system and
population modeling to assess the effects of time-variable exposure of
isoproturon on the green algae Desmodesmus subspictatus and
Pseudokirchneriella subcapitata. Environmental Toxicology and
Chemistry, 31, 899-908. <a href="https://doi.org/10.1002/etc.1765">doi:10.1002/etc.1765</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Scenarios">Scenarios</a>, <a href="#topic+Transferable">Transferable</a>
</p>
<p>Other algae models: 
<code><a href="#topic+Algae-models">Algae-models</a></code>,
<code><a href="#topic+Algae_TKTD">Algae_TKTD</a>()</code>,
<code><a href="#topic+Algae_Weber">Algae_Weber</a>()</code>
</p>

<hr>
<h2 id='Algae_TKTD'>Algae model with exponential growth, forcings (P, I) and scaled damage</h2><span id='topic+Algae_TKTD'></span><span id='topic+AlgaeTKTDScenario-class'></span>

<h3>Description</h3>

<p>Creates an <em>Algae</em> scenario. The model is a variant
of the <code><a href="#topic+Algae_Weber">Algae_Weber()</a></code> model (Weber 2012) as cited in EFSA TKTD opinion (2018).
This Algae model, <code><a href="#topic+Algae_TKTD">Algae_TKTD()</a></code>, a) provides an additional
possibility to simulate the dose-response curve (probit) and b) considers an
scaled internal damage instead of the external concentration.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Algae_TKTD()
</code></pre>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+AlgaeTKTDScenario-class">AlgaeTKTDScenario</a>
</p>


<h3>State variables</h3>

<p>The model has four state variables:
</p>

<ul>
<li> <p><code>A</code>, Biomass (ug fresh wt)
</p>
</li>
<li> <p><code>Q</code>, Mass of phosphorous internal (mg P/ug fresh wt)
</p>
</li>
<li> <p><code>P</code>, Mass of phosphorous external (mg P/L)
</p>
</li>
<li> <p><code>Dw</code>, Damage concentration (ug/L)
</p>
</li></ul>



<h3>Model parameters</h3>


<ul>
<li><p> Growth model
</p>

<ul>
<li> <p><code>mu_max</code>, Maximum growth rate (d-1)
</p>
</li>
<li> <p><code>Q_min</code>, Minimum intracellular P (mg P/ug fresh wt)
</p>
</li>
<li> <p><code>Q_max</code>, Maximum intracellular P (mg P/ug fresh wt)
</p>
</li>
<li> <p><code>v_max</code>, Maximum P-uptake rate at non-limited growth (mg P/ug fresh wt/d)
</p>
</li>
<li> <p><code>k_s</code>,   Half-saturation constant for extracellular P (mg P/L)
</p>
</li>
<li> <p><code>m_max</code>, Natural mortality rate (1/d)
</p>
</li>
<li> <p><code>I_opt</code>, Optimum light intensity for growth (uE/m²/s)
</p>
</li>
<li> <p><code>T_opt</code>, Optimum temperature for growth (°C)
</p>
</li>
<li> <p><code>T_max</code>, Maximum temperature for growth (°C)
</p>
</li>
<li> <p><code>T_min</code>, Minimum temperature for growth (°C)
</p>
</li></ul>

</li>
<li><p> Concentration response (Toxicodynamics)
</p>

<ul>
<li> <p><code>EC_50</code>, Effect concentration of 50% inhibition of growth rate (ug L-1)
</p>
</li>
<li> <p><code>b</code>, slope of concentration effect curve at EC_50 (-)
</p>
</li>
<li> <p><code>dose_resp</code>, shape of the dose response curve (0 = logit, 1 = probit)
</p>
</li></ul>

</li>
<li><p> External concentration (Toxicokinetics)
</p>

<ul>
<li> <p><code>kD</code>, dominant rate constant (used in <code>Algae_TKTD()</code>only) (d-1)
</p>
</li></ul>

</li></ul>



<h3>Forcings</h3>

<p>Besides exposure events (Cw), the <em>Algae</em> model requires two environmental
properties as time-series input: Irradiance (<code>I</code>, uE/m²/s) and
temperature (<code>T_act</code>, deg C).
Forcings time-series are represented by <code>data.frame</code> objects
consisting of two columns. The first for time and the second for the
environmental factor in question. The input format for all forcings is a
list of the data frames.
</p>


<h3>Simulation output</h3>

<p>Simulation results will contain state variables.
</p>


<h3>References</h3>

<p>Weber D, Schaeffer D, Dorgerloh M, Bruns E, Goerlitz G, Hammel K, Preuss TG
and Ratte HT, 2012. Combination of a higher-tier flow-through system and
population modeling to assess the effects of time-variable exposure of
isoproturon on the green algae Desmodesmus subspictatus and
Pseudokirchneriella subcapitata. Environmental Toxicology and
Chemistry, 31, 899-908. <a href="https://doi.org/10.1002/etc.1765">doi:10.1002/etc.1765</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Scenarios">Scenarios</a>, <a href="#topic+Transferable">Transferable</a>
</p>
<p>Other algae models: 
<code><a href="#topic+Algae-models">Algae-models</a></code>,
<code><a href="#topic+Algae_Simple">Algae_Simple</a>()</code>,
<code><a href="#topic+Algae_Weber">Algae_Weber</a>()</code>
</p>

<hr>
<h2 id='Algae_Weber'>Algae model with exponential growth and forcings (I, T)</h2><span id='topic+Algae_Weber'></span><span id='topic+AlgaeWeberScenario-class'></span>

<h3>Description</h3>

<p>The model is a mechanistic combined toxicokinetic-toxicodynamic (TK/TD) and
growth model for algae. The model simulates the development of algal biomass
under laboratory and environmental conditions and was developed by
Weber et al. (2012) as cited in EFSA TKTD opinion (2018). The growth of the
algae population is simulated on the basis of growth rates, which are
dependent on environmental conditions (radiation, temperature and phosphorus).
The toxicodynamic sub-model describes the effects of growth-inhibiting
substances through a corresponding reduction in the photosynthesis rate on
the basis of internal concentrations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Algae_Weber()
</code></pre>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+AlgaeWeberScenario-class">AlgaeWeberScenario</a>
</p>


<h3>State variables</h3>

<p>The model has four state variables:
</p>

<ul>
<li> <p><code>A</code>, Biomass (ug fresh wt)
</p>
</li>
<li> <p><code>Q</code>, Mass of phosphorous internal (mg P/ug fresh wt)
</p>
</li>
<li> <p><code>P</code>, Mass of phosphorous external (mg P/L)
</p>
</li>
<li> <p><code>C</code>, external substance concentration (ug/L)
</p>
</li></ul>



<h3>Model parameters</h3>


<ul>
<li><p> Growth model
</p>

<ul>
<li> <p><code>mu_max</code>, Maximum growth rate (d-1)
</p>
</li>
<li> <p><code>Q_min</code>, Minimum intracellular P (mg P/ug fresh wt)
</p>
</li>
<li> <p><code>Q_max</code>, Maximum intracellular P (mg P/ug fresh wt)
</p>
</li>
<li> <p><code>v_max</code>, Maximum P-uptake rate at non-limited growth (mg P/ug fresh wt/d)
</p>
</li>
<li> <p><code>k_s</code>,   Half-saturation constant for extracellular P (mg P/L)
</p>
</li>
<li> <p><code>m_max</code>, Natural mortality rate (1/d)
</p>
</li>
<li> <p><code>I_opt</code>, Optimum light intensity for growth (uE/m²/s)
</p>
</li>
<li> <p><code>T_opt</code>, Optimum temperature for growth (°C)
</p>
</li>
<li> <p><code>T_max</code>, Maximum temperature for growth (°C)
</p>
</li>
<li> <p><code>T_min</code>, Minimum temperature for growth (°C)
</p>
</li></ul>

</li>
<li><p> Concentration response (Toxicodynamics)
</p>

<ul>
<li> <p><code>EC_50</code>, Effect concentration of 50% inhibition of growth rate (ug/L)
</p>
</li>
<li> <p><code>b</code>, slope of concentration effect curve at EC_50 (-)
</p>
</li></ul>

</li>
<li><p> External concentration (Toxicokinetics)
</p>

<ul>
<li> <p><code>k</code>, Degradation rate of toxicant in aquatic environments (d-1)
</p>
</li></ul>

</li></ul>



<h3>Forcings</h3>

<p>Besides exposure events (C_in), the <em>Algae</em> model requires three environmental
properties as time-series input: Irradiance (<code>I</code>, uE/m²/s)
and temperature (<code>T_act</code>, deg C).
Forcings time-series are represented by <code>data.frame</code> objects
consisting of two columns. The first for time and the second for the
environmental factor in question. The input format for all forcings is a
list of the data frames.
</p>


<h3>Simulation output</h3>

<p>Simulation results will contain state variables.
</p>


<h3>References</h3>

<p>Weber D, Schaeffer D, Dorgerloh M, Bruns E, Goerlitz G, Hammel K, Preuss TG
and Ratte HT, 2012. Combination of a higher-tier flow-through system and
population modeling to assess the effects of time-variable exposure of
isoproturon on the green algae Desmodesmus subspictatus and
Pseudokirchneriella subcapitata. Environmental Toxicology and
Chemistry, 31, 899-908. <a href="https://doi.org/10.1002/etc.1765">doi:10.1002/etc.1765</a>
</p>
<p>EFSA PPR Panel (EFSA Panel on Plant Protection Products and their Residues),
Ockleford C, Adriaanse P, Berny P, Brock T, Duquesne S, Grilli S,
Hernandez-Jerez AF, Bennekou SH,Klein M, Kuhl T, Laskowski R, Machera K,
Pelkonen O, Pieper S, Smith RH, Stemmer M, Sundh I, Tiktak A,Topping CJ,
Wolterink G, Cedergreen N, Charles S, Focks A, Reed M, Arena M, Ippolito A,
Byers H andTeodorovic I, 2018. Scientific Opinion on the state of the art of
Toxicokinetic/Toxicodynamic (TKTD)effect models for regulatory risk assessment
of pesticides for aquatic organisms. EFSA Journal, 16(8), 5377.
<a href="https://doi.org/10.2903/j.efsa.2018.5377">doi:10.2903/j.efsa.2018.5377</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Scenarios">Scenarios</a>, <a href="#topic+Transferable">Transferable</a>
</p>
<p>Other algae models: 
<code><a href="#topic+Algae-models">Algae-models</a></code>,
<code><a href="#topic+Algae_Simple">Algae_Simple</a>()</code>,
<code><a href="#topic+Algae_TKTD">Algae_TKTD</a>()</code>
</p>

<hr>
<h2 id='Algae-models'>Algae models</h2><span id='topic+Algae-models'></span><span id='topic+Algae-class'></span>

<h3>Description</h3>

<p>Overview of supported <em>Algae</em> models
</p>


<h3>Details</h3>


<ul>
<li> <p><code><a href="#topic+Algae_Weber">Algae_Weber()</a></code> by Weber <em>et al.</em> (2012)
</p>
</li>
<li> <p><code><a href="#topic+Algae_TKTD">Algae_TKTD()</a></code> based on Weber <em>et al.</em> (2012), but with scaled damage
</p>
</li>
<li> <p><code><a href="#topic+Algae_Simple">Algae_Simple()</a></code> Simple growth model without additional forcing variables
</p>
</li></ul>



<h3>Biomass transfer</h3>

<p>Models supporting biomass transfer can be instructed to move a fixed amount
of biomass to a new medium after a period of time. This feature replicates
a procedure occurring in e.g. Lemna effect studies and may be necessary to
recreate study results.
</p>
<p>The biomass transfer feature assumes that always a fixed amount of
biomass is transferred. Transfers can occur at any fixed point in time or
in regular intervals. During a transfer, the biomass is reset to the
transferred amount and additional compartments can be scaled 1:1 accordingly,
to e.g. reflect the change in internal toxicant mass when biomass is modified.
Transfer settings can be modified using <code><a href="#topic+set_transfer">set_transfer()</a></code>.
</p>
<p>Any transfer time point must also be an output time point. If a transfer
occurs, simulation results of that time point will report the model state
<strong>before</strong> the transfer. Be aware that in order to use transfers at regular
intervals, the simulation must start at time point zero.
</p>


<h3>References</h3>

<p>Weber D, Schaeffer D, Dorgerloh M, Bruns E, Goerlitz G, Hammel K, Preuss TG
and Ratte HT, 2012. Combination of a higher-tier flow-through system and
population modeling to assess the effects of time-variable exposure of
isoproturon on the green algae Desmodesmus subspictatus and
Pseudokirchneriella subcapitata. Environmental Toxicology and
Chemistry, 31, 899-908. <a href="https://doi.org/10.1002/etc.1765">doi:10.1002/etc.1765</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Lemna-models">Lemna-models</a>, <a href="#topic+Transferable">Transferable</a>
</p>
<p>Other algae models: 
<code><a href="#topic+Algae_Simple">Algae_Simple</a>()</code>,
<code><a href="#topic+Algae_TKTD">Algae_TKTD</a>()</code>,
<code><a href="#topic+Algae_Weber">Algae_Weber</a>()</code>
</p>
<p>Other scenarios: 
<code><a href="#topic+DEB-models">DEB-models</a></code>,
<code><a href="#topic+GUTS-RED-models">GUTS-RED-models</a></code>,
<code><a href="#topic+Lemna-models">Lemna-models</a></code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Myriophyllum-models">Myriophyllum-models</a></code>,
<code><a href="#topic+Scenarios">Scenarios</a></code>,
<code><a href="#topic+Transferable">Transferable</a></code>
</p>

<hr>
<h2 id='americamysis'>A DEB abj scenario of Americamysis bahia</h2><span id='topic+americamysis'></span>

<h3>Description</h3>

<p>Species parameters were collected from the AddMyPet database entry on
Americamysis bahia (Opossum shrimp). The exposure series consists of a
constant exposure resulting in medium effects on length and reproduction.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>americamysis
</code></pre>


<h3>Format</h3>

<p>An object of class <code>DebAbj</code> of length 1.
</p>


<h3>Source</h3>

<p><a href="https://www.bio.vu.nl/thb/deb/deblab/add_my_pet/entries_web/Americamysis_bahia/Americamysis_bahia_res.html">https://www.bio.vu.nl/thb/deb/deblab/add_my_pet/entries_web/Americamysis_bahia/Americamysis_bahia_res.html</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DEB_abj">DEB_abj()</a></code>
</p>

<hr>
<h2 id='cache_controls'>Cache control simulations</h2><span id='topic+cache_controls'></span>

<h3>Description</h3>

<p>Cache control simulations
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cache_controls(x, windows, skipZeroExposure = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cache_controls_+3A_x">x</code></td>
<td>
<p>vector of <a href="#topic+scenario">scenario</a> objects</p>
</td></tr>
<tr><td><code id="cache_controls_+3A_windows">windows</code></td>
<td>
<p><code>list</code> of window tuples</p>
</td></tr>
<tr><td><code id="cache_controls_+3A_skipzeroexposure">skipZeroExposure</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code>, windows with zero exposure will
not be included in calculations</p>
</td></tr>
<tr><td><code id="cache_controls_+3A_...">...</code></td>
<td>
<p>additional parameters passed on to <code><a href="#topic+effect">effect()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Modified <a href="#topic+scenario">scenario</a> objects
</p>

<hr>
<h2 id='calibrate'>Fit model parameters to experimental data</h2><span id='topic+calibrate'></span><span id='topic+calibrate+2CEffectScenario-method'></span><span id='topic+calibrate+2CCalibrationSet-method'></span><span id='topic+calibrate+2Clist-method'></span>

<h3>Description</h3>

<p>The function <code>calibrate()</code> performs the calibration (fitting) of model
parameters to observed data. The data can originate from one or more experiments or
trials. Experimental conditions, such as model parameters and exposure
level, can differ between trials; fitting can be performed on all datasets
at the same time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calibrate(x, ...)

## S4 method for signature 'EffectScenario'
calibrate(
  x,
  par,
  data,
  endpoint = deprecated(),
  output,
  by,
  metric_fun = deprecated(),
  err_fun,
  as_tibble = deprecated(),
  catch_errors = deprecated(),
  verbose = FALSE,
  ...
)

## S4 method for signature 'CalibrationSet'
calibrate(x, par, output, err_fun, verbose = FALSE, ...)

## S4 method for signature 'list'
calibrate(
  x,
  par,
  endpoint = deprecated(),
  output,
  metric_fun = deprecated(),
  metric_total = deprecated(),
  err_fun,
  as_tibble = deprecated(),
  catch_errors = deprecated(),
  verbose = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calibrate_+3A_x">x</code></td>
<td>
<p>either a single <a href="#topic+scenario">scenario</a> or a list of <a href="#topic+CalibrationSet">CalibrationSet</a> objects to be fitted</p>
</td></tr>
<tr><td><code id="calibrate_+3A_...">...</code></td>
<td>
<p>additional parameters passed on to <code><a href="stats.html#topic+optim">stats::optim()</a></code> and <code><a href="#topic+simulate">simulate()</a></code></p>
</td></tr>
<tr><td><code id="calibrate_+3A_par">par</code></td>
<td>
<p>named numeric vector with parameters to fit and their start values</p>
</td></tr>
<tr><td><code id="calibrate_+3A_data">data</code></td>
<td>
<p><code>data.frame</code> with two or more columns with experimental data,
1st column must contain time points, the following columns may values
which the scenario is fitted to.</p>
</td></tr>
<tr><td><code id="calibrate_+3A_endpoint">endpoint</code></td>
<td>
<p><em>deprecated</em> <code>character</code>, please use <code>output</code> instead</p>
</td></tr>
<tr><td><code id="calibrate_+3A_output">output</code></td>
<td>
<p><code>character</code>, name of a single output column of <code><a href="#topic+simulate">simulate()</a></code> to
optimize on</p>
</td></tr>
<tr><td><code id="calibrate_+3A_by">by</code></td>
<td>
<p>optional <code>character</code>, groups and splits the experimental data
into multiple distinct trials and datasets before fitting</p>
</td></tr>
<tr><td><code id="calibrate_+3A_metric_fun">metric_fun</code></td>
<td>
<p><em>deprecated</em>, please use <code>err_fun</code> instead</p>
</td></tr>
<tr><td><code id="calibrate_+3A_err_fun">err_fun</code></td>
<td>
<p>vectorized error function to calculate an error term that is
minimized during optimization, must accept exactly two vectorized numeric
arguments, defaults to sum of squared errors</p>
</td></tr>
<tr><td><code id="calibrate_+3A_as_tibble">as_tibble</code></td>
<td>
<p><em>deprecated</em>, result can no longer be returned as a tibble</p>
</td></tr>
<tr><td><code id="calibrate_+3A_catch_errors">catch_errors</code></td>
<td>
<p><em>deprecated</em>, simulation errors are always caught</p>
</td></tr>
<tr><td><code id="calibrate_+3A_verbose">verbose</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code> then debug outputs are displayed during
optimization</p>
</td></tr>
<tr><td><code id="calibrate_+3A_metric_total">metric_total</code></td>
<td>
<p><em>deprecated</em></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Fitting of model parameters can be performed in two ways:
</p>

<ol>
<li><p> A single <a href="#topic+scenario">scenario</a> is fitted to a single dataset.
The dataset must represent a time-series of an output variable of the
model, e.g. observed biomass over time (effect data). The dataset can represent
results of one or more experimental replicates under identical conditions.
</p>
</li>
<li><p> One or more datasets of observed data are fitted each to a scenario which
describes the experimental conditions during observation, such as exposure
level and environmental properties. Each combination of dataset and scenario
is represented by a <a href="#topic+CalibrationSet">calibration set</a>. During fitting,
all <em>calibration sets</em> are evaluated and a total error term is calculated by
summing the error of each <em>calibration set</em>.
</p>
</li></ol>



<h4>Observed data</h4>

<p>Experimental, or effect, data must be supplied as a <code>data.frame</code> in long format
with at least two columns: the first column contains <code>numeric</code> timestamps and
the remaining columns must contain the observed quantity. The dataset must
contain a column that which matches with the contents of parameter <code>output</code>.
</p>
<p>As an example, the simulation result of <a href="#topic+Lemna_Schmitt">Lemna_Schmitt</a> model contains the
output column <em>biomass</em> (<code>BM</code>), amongst others. To fit model parameters of said
<em>Lemna_Schmitt</em> scenario based on observed biomass, the observed data must
contain a column named <code>BM</code> which represents the observed biomass.
A minimal observed dataset could look like this:
</p>
<div class="sourceCode"><pre>observed &lt;- data.frame(time=c(0,  7, 14, 21),
                       BM=c( 12, 23, 37, 56))
</pre></div>



<h4>Error function</h4>

<p>By default, the total sum of squared errors is used as the target
function which is minimized during fitting. A custom error function can be
supplied by the user: The function must accept two numeric vectorized
arguments and return a numeric of length one, i.e. the error value.
</p>
<p>Example of a custom error function which returns the sum of absolute errors:
</p>
<div class="sourceCode"><pre>my_absolute_error &lt;- function(observed, simulated) {
  sum(abs(observed - simulated))
}
</pre></div>
<p>When using <em>calibration sets</em>, the error term is calculated for each <em>calibration
set</em> individually, the weighting factor is applied to the error of each set,
and then all error terms are summed up.
</p>



<h3>Value</h3>

<p>A list of fitted parameters (as produced by <code><a href="stats.html#topic+optim">stats::optim()</a></code>)
is returned.
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>calibrate(EffectScenario)</code>: Fit single scenario using a dataset
</p>
</li>
<li> <p><code>calibrate(CalibrationSet)</code>: Fit using a <a href="#topic+CalibrationSet">CalibrationSet</a>
</p>
</li>
<li> <p><code>calibrate(list)</code>: Fit using a list of <a href="#topic+CalibrationSet">CalibrationSet</a> objects
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)

# Get observed biomass during control experiment by Schmitt et al. (2013)
observed &lt;- Schmitt2013 %&gt;%
  filter(ID == "T0") %&gt;%
  select(t, BM=obs)

# Create a scenario that represents conditions during experiment
scenario &lt;- metsulfuron %&gt;%
  set_param(c(k_phot_fix=TRUE, k_resp=0, Emax=1)) %&gt;%
  set_init(c(BM=12)) %&gt;%
  set_noexposure()

# Fit parameter 'k_phot_max' to observed biomass growth from experiment
calibrate(
  scenario,
  par=c(k_phot_max=1),
  data=observed,
  output="BM",
  method="Brent", # Brent is recommended for one-dimensional optimization
  lower=0,        # lower parameter boundary
  upper=0.5       # upper parameter boundary
) -&gt; fit
fit$par

</code></pre>

<hr>
<h2 id='CalibrationSet'>Calibration set</h2><span id='topic+CalibrationSet'></span><span id='topic+CalibrationSet-class'></span><span id='topic+caliset'></span>

<h3>Description</h3>

<p>A <em>calibration set</em> combines a <a href="#topic+scenario">scenario</a>, observed data, and an
optional weighting factor into one object. The <em>calibration set</em> is used to fit
model parameters to observed data using <code><a href="#topic+calibrate">calibrate()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>caliset(scenario, data, weight = 1.0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CalibrationSet_+3A_scenario">scenario</code></td>
<td>
<p>a <a href="#topic+scenario">scenario</a> describing conditions during the experiment</p>
</td></tr>
<tr><td><code id="CalibrationSet_+3A_data">data</code></td>
<td>
<p>a <code>data.frame</code> with observed data in long format containing two
columns: the 1st column with <code>numeric</code> time points and 2nd column with
<code>numeric</code> data to fit to.</p>
</td></tr>
<tr><td><code id="CalibrationSet_+3A_weight">weight</code></td>
<td>
<p>optional <code>numeric</code> weight to be applied to this dataset's error
term during fitting, default values is 1.0.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A <em>calibration set</em> usually represents a single experiment or trial.
Multiple experimental replicates can be combined into a single <em>set</em>, if model
parameters are identical between trials.
If model parameters were modified during a trial, e.g. a pump failure occurred
or flow rates changed, this can be represented by using a <em>scenario sequence</em>
instead of a basic <a href="#topic+scenario">scenario</a>. Please refer to <code><a href="#topic+sequence">sequence()</a></code> for details.
</p>


<h4>Weighting</h4>

<p>If more than one <em>calibration set</em> is used for fitting, then an optional
weighting factor can be used to scale the error term of the affected <em>set</em>.
</p>



<h3>Value</h3>

<p><code>caliset()</code> returns a <em>calibration set</em> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)

# Get observed biomass during control experiment by Schmitt et al. (2013)
observed &lt;- Schmitt2013 %&gt;%
  filter(ID == "T0") %&gt;%
  select(t, BM=obs)

# Create a scenario that represents conditions during experiment
scenario &lt;- metsulfuron %&gt;%
  set_param(c(k_phot_fix=TRUE, k_resp=0, Emax=1)) %&gt;%
  set_init(c(BM=12)) %&gt;%
  set_noexposure()

# Create a calibration set
cs &lt;- caliset(scenario, observed)

# Fit parameter 'k_phot_max' to observed biomass growth from experiment
calibrate(
  cs,
  par=c(k_phot_max=1),
  output="BM",
  method="Brent", # Brent is recommended for one-dimensional optimization
  lower=0,        # lower parameter boundary
  upper=0.5       # upper parameter boundary
) -&gt; fit
fit$par

</code></pre>

<hr>
<h2 id='DEB_abj'>DEB_abj</h2><span id='topic+DEB_abj'></span><span id='topic+DebAbj-class'></span>

<h3>Description</h3>

<p>Creates a <em>DEB abj</em> scenario. The <em>abj</em> model with type M acceleration is
like model <em>std</em>, but acceleration occurs between birth and metamorphosis (V1-morph).
Isomorphy is assumed before and after acceleration. Metamorphosis is before
puberty and occurs at maturity <code>E_Hj</code>, which might or might not correspond with
changes in morphology. The <em>abj</em> model is a one-parameter extension of model <em>std</em>
<a href="https://debportal.debtheory.org/docs/Typified_models.html">(DEB Wiki)</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DEB_abj()
</code></pre>


<h3>Details</h3>



<h4>State variables</h4>

<p>The following list describes the default names and standard units of the model's
state variables:
</p>

<ul>
<li> <p><code>L</code>, structural length (cm)
</p>
</li>
<li> <p><code>E</code>, energy reserve (J)
</p>
</li>
<li> <p><code>H</code>, energy invested in maturity (J)
</p>
</li>
<li> <p><code>R</code>, reproduction buffer (J)
</p>
</li>
<li> <p><code>cV</code>, internal concentration (<a href="stats.html#topic+C">C</a>)
</p>
</li>
<li> <p><code>Lmax</code>, maximum structural length (cm)
</p>
</li></ul>

<p>All state variables are initialized with zero. See <code><a href="#topic+set_init">set_init()</a></code> on how to set
the initial state.
</p>



<h4>Parameters</h4>

<p>The following model parameters are required:
</p>

<ul>
<li> <p><code>p_M</code>, vol-spec somatic maintenance (J/d.cm^3)
</p>
</li>
<li> <p><code>v</code>, energy conductance (cm/d)
</p>
</li>
<li> <p><code>k_J</code>, maturity maint rate coefficient (1/d)
</p>
</li>
<li> <p><code>p_Am</code>, surface-area specific maximum assimilation rate (J/d.cm^2)
</p>
</li>
<li> <p><code>kap</code>, allocation fraction to soma (-)
</p>
</li>
<li> <p><code>E_G</code>, spec cost for structure (J/cm^3)
</p>
</li>
<li> <p><code>f</code>, scaled functional response (-)
</p>
</li>
<li> <p><code>E_Hj</code>, maturity at metamorphosis (J)
</p>
</li>
<li> <p><code>E_Hp</code>, maturity at puberty (J)
</p>
</li>
<li> <p><code>kap_R</code>, reproduction efficiency (-)
</p>
</li>
<li> <p><code>L_b</code>, structural length at birth (cm)
</p>
</li>
<li> <p><code>L_j</code>, structural length at metamorphosis (cm)
</p>
</li>
<li> <p><code>ke</code>, elimination rate constant (d-1)
</p>
</li>
<li> <p><code>c0</code>, no-effect concentration sub-lethal (<a href="stats.html#topic+C">C</a>)
</p>
</li>
<li> <p><code>cT</code>, tolerance concentration (<a href="stats.html#topic+C">C</a>)
</p>
</li>
<li> <p><code>MoA</code>, mode of action switch (-)
</p>
</li></ul>




<h4>Mode of Actions</h4>

<p>Any combination of the following mode of actions (MoA) can be considered by
the model:
</p>

<ul>
<li> <p><code>MoA = 1</code>: effect on feeding
</p>
</li>
<li> <p><code>MoA = 2</code>: effect on maintenance costs
</p>
</li>
<li> <p><code>MoA = 4</code>: effect on overhead costs for making an egg
</p>
</li>
<li> <p><code>MoA = 8</code>: hazard during oogenesis
</p>
</li>
<li> <p><code>MoA = 16</code>: energy conductance
</p>
</li></ul>

<p>To activate more than one MoA, simply add up the corresponding
codes. To disable all MoAs, set the parameter to zero.
See also <code><a href="#topic+set_mode_of_action">set_mode_of_action()</a></code>.
</p>



<h4>Effects</h4>

<p>The state variables <em>L</em> (structural length) and <em>R</em> (reproduction buffer) are
set as effect endpoints by default. All state variables are available as
potential endpoints. The list of considered endpoints can be modified
by using <code><a href="#topic+set_endpoints">set_endpoints()</a></code>.
</p>
<p>To calculate effects, each <em>DEB</em> scenario is simulated twice: One simulation
which considers exposure to a toxicant and one simulation without exposure, i.e.
a control. See also <code><a href="#topic+effect">effect()</a></code>.
</p>



<h3>Value</h3>

<p>an S4 object of type <a href="#topic+DebAbj-class">DebAbj</a>
</p>


<h3>See Also</h3>

<p>Other DEB models: 
<code><a href="#topic+DEB-models">DEB-models</a></code>,
<code><a href="#topic+DEB_Daphnia">DEB_Daphnia</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Create an abj scenario from scratch and simulate it
DEB_abj() %&gt;%
  set_init(c(L=0.02,E=0.1,H=0.01)) %&gt;%
  set_param(c(p_M=3000,v=0.02,k_J=0.6,p_Am=300,kap=0.9,E_G=4000,f=1,
              E_Hj=0.05,E_Hp=0.3,kap_R=0.9,ke=1,c0=0,cT=1,L_b=0.02,
              L_j=0.04,MoA=0)) %&gt;%
  set_exposure(no_exposure()) %&gt;%
  set_times(0:10) %&gt;%
  simulate()

# Print information about sample scenario 'americamysis'
americamysis

# Simulate 'americamysis' scenario
americamysis %&gt;% simulate()
</code></pre>

<hr>
<h2 id='DEB_Daphnia'>DEBtox Daphnia</h2><span id='topic+DEB_Daphnia'></span><span id='topic+DebDaphnia-class'></span>

<h3>Description</h3>

<p>Creates a  <em>DEBtox Daphnia</em> scemarop.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DEB_Daphnia()
</code></pre>


<h3>Details</h3>



<h4>State variables</h4>

<p>The following list describes the default names and standard units of the
model's state variables:
</p>

<ul>
<li> <p><code>D</code>, scaled damage (<a href="stats.html#topic+C">C</a>)
</p>
</li>
<li> <p><code>L</code>, body length (mm)
</p>
</li>
<li> <p><code>R</code>, cumulative reproduction (-)
</p>
</li>
<li> <p><code>S</code>, survival probability (-)
</p>
</li></ul>

<p>All state variables are initialized with zero. See <code><a href="#topic+set_init">set_init()</a></code> on how to set
the initial state.
</p>



<h4>Parameters</h4>

<p>The following parameters are required:
</p>

<ul>
<li><p> General
</p>

<ul>
<li> <p><code>L0</code>, body length at start (mm)
</p>
</li>
<li> <p><code>Lp</code>, body length at puberty (mm)
</p>
</li>
<li> <p><code>Lm</code>, maximum body length (mm)
</p>
</li>
<li> <p><code>rB</code>, von Bertalanffy growth rate constant (1/d)
</p>
</li>
<li> <p><code>Rm</code>, maximum reproduction rate (#/d)
</p>
</li>
<li> <p><code>f</code>, scaled functional response (-)
</p>
</li>
<li> <p><code>hb</code>, background hazard rate (d-1)
</p>
</li></ul>

</li>
<li><p> Extra parameters
</p>

<ul>
<li> <p><code>Lf</code>, body length at half-saturation feeding (mm)
</p>
</li>
<li> <p><code>Lj</code>, body length at which acceleration stops (mm)
</p>
</li>
<li> <p><code>Tlag</code>, lag time for start development (d)
</p>
</li></ul>

</li>
<li><p> TKTD parameters
</p>

<ul>
<li> <p><code>kd</code>, dominant rate constant (d-1)
</p>
</li>
<li> <p><code>zb</code>, effect threshold energy budget (<a href="stats.html#topic+C">C</a>)
</p>
</li>
<li> <p><code>bb</code>, effect strength energy-budget effects (1/<a href="stats.html#topic+C">C</a>)
</p>
</li>
<li> <p><code>zs</code>, effect threshold survival (<a href="stats.html#topic+C">C</a>)
</p>
</li>
<li> <p><code>bs</code>, effect strength survival (1/(<a href="stats.html#topic+C">C</a> d))
</p>
</li></ul>

</li>
<li><p> Global parameters
</p>

<ul>
<li> <p><code>FBV</code>, dry weight egg as fraction of structural body weight (-)
</p>
</li>
<li> <p><code>KRV</code>, part. coeff. repro buffer and structure (kg/kg) (for losses with reproduction)
</p>
</li>
<li> <p><code>kap</code>, approximation for kappa (for starvation response)
</p>
</li>
<li> <p><code>yP</code>, product of yVA and yAV (for starvation response)
</p>
</li>
<li> <p><code>Lm_ref</code>, reference max length for scaling rate constants (mm)
</p>
</li>
<li> <p><code>len</code>, switch to fit length 1) with shrinking, 2) without shrinking
</p>
</li>
<li> <p><code>Tbp</code>, brood-pouch delay (d)
</p>
</li></ul>

</li>
<li> <p><code>MoA</code>, mode of action switch (-)
</p>
</li>
<li> <p><code>FB</code>, feedback on damage dynamics switch (-)
</p>
</li></ul>



<h5>Mode of Action</h5>

<p>Any combination of the following mode of actions (MoA) can be considered by
the model:
</p>

<ul>
<li> <p><code>MoA = 1</code>: assimilation/feeding
</p>
</li>
<li> <p><code>MoA = 2</code>: costs for maintenance
</p>
</li>
<li> <p><code>MoA = 4</code>: costs for growth and reproduction
</p>
</li>
<li> <p><code>MoA = 8</code>: costs for reproduction
</p>
</li>
<li> <p><code>MoA = 16</code>: hazard for reproduction
</p>
</li></ul>

<p>To activate more than one MoA, simply add up the corresponding
codes. To disable all MoAs, set the parameter to zero. See also
<code><a href="#topic+set_mode_of_action">set_mode_of_action()</a></code>.
</p>



<h5>Feedbacks</h5>

<p>Any combination of the following damage feedbacks can be considered by
the model:
</p>

<ul>
<li> <p><code>1</code>: surf:vol scaling uptake rate
</p>
</li>
<li> <p><code>2</code>: surf:vol scaling elimination rate
</p>
</li>
<li> <p><code>4</code>: growth dilution
</p>
</li>
<li> <p><code>8</code>: losses with reproduction
</p>
</li></ul>

<p>To activate more than one feedback, simply add up the corresponding
codes. To disable all feedbacks, set the parameter to zero.
</p>




<h4>Effects</h4>

<p>The state variables <em>L</em> (body length), <em>R</em> (cumulative reproduction), and
<em>S</em> (survival probability) are set as effect endpoints by default. All state
variables are available as potential endpoints. The list of considered
endpoints can be modified by using <code><a href="#topic+set_endpoints">set_endpoints()</a></code>.
</p>
<p>To calculate effects, each <em>DEB</em> scenario is simulated twice: One simulation
which considers exposure to a toxicant and one simulation without exposure, i.e.
a control. See also <code><a href="#topic+effect">effect()</a></code>.
</p>



<h4>Output variables</h4>

<p>The following intermediary model variables can be added to the model
output on demand, see <code><a href="#topic+simulate">simulate()</a></code> for details:
</p>

<ul>
<li> <p><code>nout &gt;= 3</code>
</p>

<ul>
<li> <p><code>f</code>, actual f
</p>
</li>
<li> <p><code>fR</code>, actual f considering starvation
</p>
</li>
<li> <p><code>kd</code>, actual kd
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 6</code>
</p>

<ul>
<li> <p><code>s</code>, stress level for metabolic effects
</p>
</li>
<li> <p><code>sA</code>, stress factor on assimilation/feeding
</p>
</li>
<li> <p><code>h</code>, hazard rate for effects on survival
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 10</code>, damage feedbacks
</p>

<ul>
<li> <p><code>xu</code>, factor for surf:vol scaling uptake rate
</p>
</li>
<li> <p><code>xe</code>, factor for surf:vol scaling elimination rate
</p>
</li>
<li> <p><code>xG</code>, factor for growth dilution
</p>
</li>
<li> <p><code>xR</code>, factor for losses with repro
</p>
</li></ul>

</li></ul>




<h3>Value</h3>

<p>an S4 object of type <a href="#topic+DebDaphnia-class">DebDaphnia</a>
</p>


<h3>See Also</h3>

<p>Other DEB models: 
<code><a href="#topic+DEB-models">DEB-models</a></code>,
<code><a href="#topic+DEB_abj">DEB_abj</a>()</code>
</p>

<hr>
<h2 id='DEB-models'>Dynamic Energy Budget (DEB) models</h2><span id='topic+DEB-models'></span><span id='topic+DebScenario-class'></span>

<h3>Description</h3>

<p>Supported models:
</p>

<ul>
<li> <p><a href="#topic+DEB_abj">DEB_abj</a>
</p>
</li>
<li> <p><a href="#topic+DEB_Daphnia">DEB_Daphnia</a>
</p>
</li></ul>



<h3>See Also</h3>

<p>Other DEB models: 
<code><a href="#topic+DEB_Daphnia">DEB_Daphnia</a>()</code>,
<code><a href="#topic+DEB_abj">DEB_abj</a>()</code>
</p>
<p>Other scenarios: 
<code><a href="#topic+Algae-models">Algae-models</a></code>,
<code><a href="#topic+GUTS-RED-models">GUTS-RED-models</a></code>,
<code><a href="#topic+Lemna-models">Lemna-models</a></code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Myriophyllum-models">Myriophyllum-models</a></code>,
<code><a href="#topic+Scenarios">Scenarios</a></code>,
<code><a href="#topic+Transferable">Transferable</a></code>
</p>

<hr>
<h2 id='dmagna'>A DEBtox Daphnia magna scenario</h2><span id='topic+dmagna'></span>

<h3>Description</h3>

<p>Species and substance parameters were collected from test runs of the
original DEBtox Daphnia model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dmagna
</code></pre>


<h3>Format</h3>

<p>An object of class <code>DebDaphnia</code> of length 1.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DEB_Daphnia">DEB_Daphnia()</a></code>
</p>

<hr>
<h2 id='dose_response'>Calculate a dose response curve</h2><span id='topic+dose_response'></span>

<h3>Description</h3>

<p>Returns a <code>data.frame</code> with points on the dose response curve for the given
effect scenario.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dose_response(
  scenario,
  range = c(1, 99),
  n = 20,
  strategy = c("exponential", "decadic", "vanilla"),
  verbose = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dose_response_+3A_scenario">scenario</code></td>
<td>
<p><code>EffectScenario</code> used for calculation</p>
</td></tr>
<tr><td><code id="dose_response_+3A_range">range</code></td>
<td>
<p>numeric vector specifying the required range of effect levels in percent (%), defaults to <code>c(1,99)</code></p>
</td></tr>
<tr><td><code id="dose_response_+3A_n">n</code></td>
<td>
<p>minimum number of points on the dose response curve</p>
</td></tr>
<tr><td><code id="dose_response_+3A_strategy">strategy</code></td>
<td>
<p>controls how multiplication factors are chosen, <code>vanilla</code> uses a fixed
set of multiplication factors, <code>decadic</code> and <code>exponential</code> have varying step lengths
if this is feasible depends on the environment setup as defined by the <code>future</code> package</p>
</td></tr>
<tr><td><code id="dose_response_+3A_verbose">verbose</code></td>
<td>
<p>logical, set to <code>TRUE</code> for additional status messages</p>
</td></tr>
<tr><td><code id="dose_response_+3A_...">...</code></td>
<td>
<p>additional arguments passed on to <code><a href="#topic+effect">effect()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Derives a dose response curve from a <a href="#topic+scenario">scenario</a>. The result will
cover the requested range of effect levels. The tested multiplication factors
can be chosen by different strategies, i.e. a <code>vanilla</code> approach using a
fixed set of factors, or <code>decadic</code> and <code>exponential</code> approaches
employing logarithmic and exponential factor scaling, respectively.
</p>


<h3>Value</h3>

<p><code>data.frame</code> with two columns, i.e. <code>factor</code> and <code>effect</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># basic dose response curve
minnow_sd %&gt;% dose_response()

# modify the minimum number of points on the curve
minnow_sd %&gt;% dose_response(n=10)

# select a subset of the effect range
minnow_sd %&gt;% dose_response(range=c(10,20))

# use an alternative strategy for the selection of multiplication factors
minnow_sd %&gt;% dose_response(strategy="decadic")

# provide additional output how multiplication factors were selected
minnow_sd %&gt;% dose_response(verbose=TRUE)
</code></pre>

<hr>
<h2 id='effect'>Effect level</h2><span id='topic+effect'></span>

<h3>Description</h3>

<p>Derives the effect level due to toxicant exposure in the supplied scenarios.
Either relative to a control scenario or derived directly from model
endpoints, depending on model type. For scenarios with moving exposure windows,
the maximum effect is returned.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>effect(x, factor = 1, max_only = TRUE, ep_only = FALSE, marginal_effect, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="effect_+3A_x">x</code></td>
<td>
<p>vector of <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="effect_+3A_factor">factor</code></td>
<td>
<p>optional numeric value which scales the exposure time-series</p>
</td></tr>
<tr><td><code id="effect_+3A_max_only">max_only</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code> only the maximum effect is returned, else
results for all effect windows are reported</p>
</td></tr>
<tr><td><code id="effect_+3A_ep_only">ep_only</code></td>
<td>
<p>logical, if TRUE only effect endpoints are returned as a vector</p>
</td></tr>
<tr><td><code id="effect_+3A_marginal_effect">marginal_effect</code></td>
<td>
<p><code>numeric</code>, if set, any effect smaller than this threshold will
be reported as zero to exclude pseudo-effects originating from small numerical
errors</p>
</td></tr>
<tr><td><code id="effect_+3A_...">...</code></td>
<td>
<p>additional parameters passed on to <code><a href="#topic+simulate">simulate()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>By default, only the maximum effect in all moving exposure windows will
be returned. If argument <code>max_only=FALSE</code> is set, the returned table will
be converted to long-format and will contain effect levels for each
assessed exposure window.
</p>


<h4>Output formatting</h4>

<p>Start and end time of exposure windows can be disabled by setting <code>ep_only=TRUE</code>.
Effect levels smaller than a certain threshold can be automatically set to
zero (<code>0.0</code>) to avoid spurious effect levels introduced by numerical errors.
Set <code>marginal_effect</code> to an adequate value less than 1%.
</p>



<h4>Computational efficiency</h4>

<p>Calculations can be sped up by providing a <code>data.frame</code> of pre-calculated
control scenarios for each assessed time window. As control scenarios are
by definition independent of any exposure multiplication factor, they can
be reused for repeated calculations, e.g. to derive effect profiles or
dose-response relationships.
</p>



<h3>Value</h3>

<p>a <code>tibble</code>, by default containing scenarios, effect levels, and the
exposure window where the maximum effect level occurred. The number of columns
depends on the enabled effect endpoints and function arguments.
</p>
<p>By default, the first column, named <code>scenarios</code>, contains the original scenario
objects that were the basis of the calculation. For each effect endpoint, it
will be followed by one column with the maximum effect level and two columns
containing start and end time of the associated exposure window. If exposure
windows are disabled, the columns will just contain the start and end time of
the simulation. The effect level column will have the name of the effect
endpoint, start and end time will additionally have the suffixes <code>.dat.start</code>
and <code>.dat.end</code>, respectively.
</p>

<hr>
<h2 id='epx'>Effect profiles (EPx values)</h2><span id='topic+epx'></span>

<h3>Description</h3>

<p>Derives one or more EPx/LPx values for the supplied effect scenarios, i.e. it
calculates the multiplication factors of an exposure profile that cause
x% of effect. Scenarios are processed in parallel, if possible.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>epx(
  scenarios,
  level = c(10, 50),
  effect_tolerance = 0.001,
  factor_cutoff = NA,
  min_factor = 1e-30,
  max_factor = 1e+30,
  verbose = FALSE,
  ep_only = FALSE,
  long_format = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="epx_+3A_scenarios">scenarios</code></td>
<td>
<p>table or vector of <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="epx_+3A_level">level</code></td>
<td>
<p>effect levels in percent (%), defaults to <code>c(10,50)</code></p>
</td></tr>
<tr><td><code id="epx_+3A_effect_tolerance">effect_tolerance</code></td>
<td>
<p><code>numeric</code>, minimum absolute accuracy of effect levels</p>
</td></tr>
<tr><td><code id="epx_+3A_factor_cutoff">factor_cutoff</code></td>
<td>
<p>optional <code>numeric</code>, the search for a multiplication factor
will be cut short if  tried factors exceed this value; the result will report
the cutoff value as the final EPx value.</p>
</td></tr>
<tr><td><code id="epx_+3A_min_factor">min_factor</code></td>
<td>
<p><code>numeric</code>, if tried factors fall below this threshold, the algorithm
will halt with an error</p>
</td></tr>
<tr><td><code id="epx_+3A_max_factor">max_factor</code></td>
<td>
<p><code>numeric</code>, if tried factors exceed this threshold, the algorithm
will halt with an error</p>
</td></tr>
<tr><td><code id="epx_+3A_verbose">verbose</code></td>
<td>
<p><code>logic</code>, if <code>TRUE</code> then infos about model evaluations are displayed</p>
</td></tr>
<tr><td><code id="epx_+3A_ep_only">ep_only</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code> then only EPx values are part of the output,
any contextual information such as <code>EffectScenario</code> objects are left out</p>
</td></tr>
<tr><td><code id="epx_+3A_long_format">long_format</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code> then EPx values are returned as
a table in long format, any contextual information will be duplicated</p>
</td></tr>
<tr><td><code id="epx_+3A_...">...</code></td>
<td>
<p>additional arguments passed on to <code><a href="#topic+effect">effect()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>To estimate EPx values, a <em>binary search</em> on multiplication factors is conducted.
The algorithm can achieve arbitrary precision in terms of effects. The
same approach is implemented in the <code>morse</code> package in the <code>MFx()</code> function.
Convergence is often achieved in less than 10 iterations per effect level and
endpoint.
</p>
<p>Internally, a knowledge base of all tried factors and resulting effect levels is
kept to speed up convergence if more than one endpoint or effect level was
requested. The algorithm will automatically sweep the range of multiplication
factors as needed but hard cutoff values are implemented to avoid infinite loops;
the algorithm will halt with an error message if tried factors are
smaller than <code>1e-30</code> or greater than <code>1e30</code>.
</p>


<h4>Numerical precision</h4>

<p>The precision of reported <em>EPx</em> values is controlled by the argument
<code>effect_tolerance</code> and is given as the upper absolute error threshold of
effects that is deemed acceptable. The default value of <code>0.001</code> ensures that
a derived <em>EPx</em> will result in an effect of x% ± 0.1. Decreasing the
<code>effect_tolerance</code> will result in additional model iterations and longer
runtime. Setting an extremely small tolerance value may lead to a breakdown
of the algorithm due to the occurrence of extremely small, quasi-random
numerical errors in simulation results.
</p>



<h3>Value</h3>

<p>The original <code>tibble</code> with additional columns named after the request effect levels, e.g. <code>L.EP10.</code>
If no tibble was used as argument, then a new one is created. The first column <code>scenario</code> will contain
the supplied <code>EffectScenario</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>minnow_sd %&gt;% epx()
minnow_sd %&gt;% epx(level=c(10,23,42))

# displays infos about tested multiplication factors
minnow_sd %&gt;% epx(verbose=TRUE)

# return results as a table in wide format
minnow_sd %&gt;% epx(long_format=TRUE)
</code></pre>

<hr>
<h2 id='epx_mtw'>Calculate EPx values for a series of moving time window</h2><span id='topic+epx_mtw'></span>

<h3>Description</h3>

<p>Calls <code>epx()</code> to calculate the EPx value (i.e. the multiplication factors of
an exposure profile that cause x% of effect) for moving windows with length
<code>window_length</code> that move timesteps defined by <code>window_interval</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>epx_mtw(
  x,
  level = c(10, 50),
  factor_cutoff = 1000,
  window_length = 7,
  window_interval = 1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="epx_mtw_+3A_x">x</code></td>
<td>
<p>a <a href="#topic+scenario">scenario</a></p>
</td></tr>
<tr><td><code id="epx_mtw_+3A_level">level</code></td>
<td>
<p>The target effect level of the effect, ie. the x of EPx.</p>
</td></tr>
<tr><td><code id="epx_mtw_+3A_factor_cutoff">factor_cutoff</code></td>
<td>
<p>above which cutoff is the EPx is not relevant</p>
</td></tr>
<tr><td><code id="epx_mtw_+3A_window_length">window_length</code></td>
<td>
<p>the length of the moving time window</p>
</td></tr>
<tr><td><code id="epx_mtw_+3A_window_interval">window_interval</code></td>
<td>
<p>the interval that the moving time window moves</p>
</td></tr>
<tr><td><code id="epx_mtw_+3A_...">...</code></td>
<td>
<p>arguments passed to <code>epx</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a tibble with five columns
</p>

<ul>
<li><p> window.start
</p>
</li>
<li><p> window.end
</p>
</li>
<li><p> endpoint
</p>
</li>
<li><p> level
</p>
</li>
<li><p> EPx
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>metsulfuron %&gt;%
  set_window(length=7, interval=1) %&gt;%
  epx_mtw()
</code></pre>

<hr>
<h2 id='ExposureSeries'>Exposure time-series</h2><span id='topic+ExposureSeries'></span><span id='topic+ExposureSeries-class'></span>

<h3>Description</h3>

<p>Creates an object that encapsulates an exposure time-series with its
metadata, such as formatted datetime strings and file name where the
series was loaded from. <code><a href="#topic+no_exposure">no_exposure()</a></code> is shorthand to create a time-series
of constant zero exposure.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ExposureSeries(series, dates, file, meta, context)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ExposureSeries_+3A_series">series</code></td>
<td>
<p><code>data.frame</code> with two columns containing a time-series</p>
</td></tr>
<tr><td><code id="ExposureSeries_+3A_dates">dates</code></td>
<td>
<p><code>vector</code>, optional original list of time stamps</p>
</td></tr>
<tr><td><code id="ExposureSeries_+3A_file">file</code></td>
<td>
<p><code>character</code>, optional file name where data originates from</p>
</td></tr>
<tr><td><code id="ExposureSeries_+3A_meta">meta</code></td>
<td>
<p><code>list</code>, optional metadata</p>
</td></tr>
<tr><td><code id="ExposureSeries_+3A_context">context</code></td>
<td>
<p><code>list</code> optional contextual metadata such as project ids</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+ExposureSeries-class">ExposureSeries</a>
</p>


<h3>Slots</h3>


<dl>
<dt><code>dates</code></dt><dd><p>original time points of time-series, e.g. time stamps of the form <code style="white-space: pre;">&#8288;2000-01-01 12:00&#8288;</code></p>
</dd>
<dt><code>file</code></dt><dd><p><code>character</code>, file name where data originates from, may be empty</p>
</dd>
<dt><code>meta</code></dt><dd><p><code>list</code>, contains metadata</p>
</dd>
<dt><code>context</code></dt><dd><p><code>list</code>, contains contextual metadata, such as project ids</p>
</dd>
<dt><code>series</code></dt><dd><p><code>data.frame</code> containing the actual time-series</p>
</dd>
</dl>


<h3>See Also</h3>

<p><code><a href="#topic+no_exposure">no_exposure()</a></code>
</p>

<hr>
<h2 id='focusd1'>A Lemna_SETAC scenario with variable environment</h2><span id='topic+focusd1'></span>

<h3>Description</h3>

<p>A mechanistic combined toxicokinetic-toxicodynamic (TK/TD) and growth
model for the aquatic macrophytes Lemna spp. as published by
Klein <em>et al.</em> (2021).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>focusd1
</code></pre>


<h3>Format</h3>

<p>An object of class <code>LemnaSetacScenario</code> of length 1.
</p>


<h3>Details</h3>

<p>The scenario will simulate a period of 365 days, a start
population of 80 g/m² dry weight, variable environmental conditions, and a
complex, time-varying exposure pattern.
</p>
<p>The scenario setup was published by Hommen <em>et al</em>. (2015). Exposure pattern
and substance specific parameters are of exemplary character
and represent the herbicide <em>metsulfuron-methyl</em>. The parameters were
derived by Schmitt et al. (2013) based on literature
data.
</p>


<h3>References</h3>

<p>Hommen U., Schmitt W., Heine S., Brock Theo CM., Duquesne S., Manson P., Meregalli G.,
Ochoa-Acuña H., van Vliet P., Arts G., 2015: How TK-TD and Population Models for
Aquatic Macrophytes Could Support the Risk Assessment for Plant Protection
Products. Integr Environ Assess Manag 12(1), pp. 82-95.
<a href="https://doi.org/10.1002/ieam.1715">doi:10.1002/ieam.1715</a>
</p>
<p>Klein J., Cedergreen N., Heine S., Reichenberger S., Rendal C.,
Schmitt W., Hommen U., 2021: Refined description of the <em>Lemna</em> TKTD growth model
based on <em>Schmitt et al.</em> (2013) - equation system and default parameters.
Report of the working group <em>Lemna</em> of the SETAC Europe Interest Group Effect
Modeling. Version 1, uploaded on 22. Sept. 2021.
<a href="https://www.setac.org/group/effect-modeling.html">https://www.setac.org/group/effect-modeling.html</a>
</p>
<p>Schmitt W., Bruns E., Dollinger M., Sowig P., 2013: Mechanistic TK/TD-model
simulating the effect of growth inhibitors on <em>Lemna</em> populations. Ecol Model
255, pp. 1-10. <a href="https://doi.org/10.1016/j.ecolmodel.2013.01.017">doi:10.1016/j.ecolmodel.2013.01.017</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Lemna-models">Lemna-models</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate the example scenario
focusd1 %&gt;% simulate()

</code></pre>

<hr>
<h2 id='fx'>Generic to calculate effects for a particular scenario</h2><span id='topic+fx'></span><span id='topic+fx+2CANY-method'></span><span id='topic+fx+2CGutsRedSd-method'></span><span id='topic+fx+2CGutsRedIt-method'></span><span id='topic+fx+2CLemna-method'></span><span id='topic+fx+2CMyriophyllum-method'></span><span id='topic+fx+2CAlgae-method'></span>

<h3>Description</h3>

<p>Generic to calculate effects for a particular scenario
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fx(scenario, ...)

## S4 method for signature 'ANY'
fx(scenario, ...)

## S4 method for signature 'GutsRedSd'
fx(scenario, ...)

## S4 method for signature 'GutsRedIt'
fx(scenario, ...)

## S4 method for signature 'Lemna'
fx(scenario, ...)

## S4 method for signature 'Myriophyllum'
fx(scenario, ...)

## S4 method for signature 'Algae'
fx(scenario, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fx_+3A_scenario">scenario</code></td>
<td>
<p><a href="#topic+scenario">scenario</a> object</p>
</td></tr>
<tr><td><code id="fx_+3A_...">...</code></td>
<td>
<p>additional parameters</p>
</td></tr>
</table>


<h3>Value</h3>

<p>numeric named vector
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>fx(ANY)</code>: Use state variables at end of simulation
</p>
</li>
<li> <p><code>fx(GutsRedSd)</code>: Effect at end of simulation of <a href="#topic+GUTS-RED-models">GUTS-RED-models</a>
</p>
</li>
<li> <p><code>fx(GutsRedIt)</code>: Effect at end of simulation of <a href="#topic+GUTS-RED-models">GUTS-RED-models</a>
</p>
</li>
<li> <p><code>fx(Lemna)</code>: Effect at end of simulation of <a href="#topic+Lemna-models">Lemna-models</a>
</p>
</li>
<li> <p><code>fx(Myriophyllum)</code>: Effect at end of simulation of <a href="#topic+Macrophyte-models">Macrophyte-models</a>
</p>
</li>
<li> <p><code>fx(Algae)</code>: Effect at end of simulation of <a href="#topic+Algae-models">Algae-models</a>
</p>
</li></ul>

<hr>
<h2 id='get_model'>Get model name</h2><span id='topic+get_model'></span><span id='topic+get_model+2CANY-method'></span><span id='topic+get_model+2Clist-method'></span><span id='topic+get_model+2CEffectScenario-method'></span><span id='topic+get_model+2Cparameter_set-method'></span><span id='topic+get_model_name'></span>

<h3>Description</h3>

<p>Returns the unique model name that is associated with a scenario, e.g.
<code>GUTS-RED-IT</code>. The function supports vectorized arguments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_model(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_model_+3A_x">x</code></td>
<td>
<p>(vector of) <a href="#topic+scenarios">scenarios</a> or <code><a href="#topic+parameter_set">parameter_set</a></code> objects</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of <code>character</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># returns `GUTS-RED-IT`
get_model(minnow_it)
</code></pre>

<hr>
<h2 id='get_tag'>Get scenario tag</h2><span id='topic+get_tag'></span><span id='topic+get_tag+2CANY-method'></span><span id='topic+get_tag+2Clist-method'></span><span id='topic+get_tag+2CEffectScenario-method'></span><span id='topic+get_tag+2Cparameter_set-method'></span>

<h3>Description</h3>

<p>Returns the user-defined, custom tag of a scenario, if available. Tags
can be helpful to quickly distinguish scenarios of the same model type.
The function supports vectorized inputs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_tag(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_tag_+3A_x">x</code></td>
<td>
<p>(vector of) <a href="#topic+scenarios">scenarios</a> or <code><a href="#topic+parameter_set">parameter_set</a></code> objects</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of <code>character</code>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+set_tag">set_tag()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># returns `fathead minnow`
get_tag(minnow_it)

# update or set a tag
myscenario &lt;- minnow_it %&gt;% set_tag("My Custom Tag")
# returns `My Custom Tag`
get_tag(myscenario)
</code></pre>

<hr>
<h2 id='GUTS_RED_IT'>GUTS-RED-IT scenario</h2><span id='topic+GUTS_RED_IT'></span><span id='topic+GutsRedIt-class'></span>

<h3>Description</h3>

<p>Reduced <em>General Unified Threshold models of Survival</em> (GUTS) with
individual tolerance (<em>IT</em>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GUTS_RED_IT(param, init)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="GUTS_RED_IT_+3A_param">param</code></td>
<td>
<p>optional named <code>list</code> or <code>vector</code> with model parameters</p>
</td></tr>
<tr><td><code id="GUTS_RED_IT_+3A_init">init</code></td>
<td>
<p>optional named numeric <code>vector</code> to use as initial state</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+GutsRedIt-class">GutsRedIt</a>
</p>


<h3>State variables</h3>

<p>The following list describes the default names and standard units of <em>GUTS-RED</em>
state variables:
</p>

<ul>
<li> <p><code>D</code>, scaled damage (conc)
</p>
</li>
<li> <p><code>H</code>, cumulative hazard (-)
</p>
</li></ul>

<p>The state variables are initialized with zero by default.
</p>


<h3>IT model parameters</h3>


<ul>
<li> <p><code>kd</code>, dominant rate constant (time^-1)
</p>
</li>
<li> <p><code>hb</code>, background hazard rate (time^-1)
</p>
</li>
<li> <p><code>alpha</code>, median of thresholds (conc)
</p>
</li>
<li> <p><code>beta</code>, shape parameter (-)
</p>
</li></ul>



<h3>Effects</h3>

<p>The effect endpoint <code>L</code> (lethality) is available for <em>GUTS-RED</em> models.
A value of zero (<code>0.0</code>) denotes <em>no effect</em> on organism survival. A value of
one (<code>1.0</code>) denotes a lethality rate of 100%, i.e. no survivors.
</p>
<p>In addition, the surival rate over time can be derived for all output time
points using <code><a href="#topic+survival">survival()</a></code>.
</p>


<h3>References</h3>

<p>EFSA PPR Panel (EFSA Panel on Plant Protection Products and their Residues),
Ockleford C, Adriaanse P, Berny P, et al., 2018: <em>Scientific Opinion on the
state of the art of Toxicokinetic/Toxicodynamic (TKTD) effect models for
regulatory risk assessment of pesticides for aquatic organisms</em>. EFSA Journal 2018;
16(8):5377, 188 pp. <a href="https://doi.org/10.2903/j.efsa.2018.5377">doi:10.2903/j.efsa.2018.5377</a>
</p>


<h3>See Also</h3>

<p>Other GUTS-RED models: 
<code><a href="#topic+GUTS-RED-models">GUTS-RED-models</a></code>,
<code><a href="#topic+GUTS_RED_SD">GUTS_RED_SD</a>()</code>
</p>

<hr>
<h2 id='GUTS_RED_SD'>GUTS-RED-SD scenario</h2><span id='topic+GUTS_RED_SD'></span><span id='topic+GutsRedSd-class'></span>

<h3>Description</h3>

<p>Reduced <em>General Unified Threshold models of Survival</em> (GUTS) with stochastic
death (<em>SD</em>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GUTS_RED_SD(param, init)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="GUTS_RED_SD_+3A_param">param</code></td>
<td>
<p>optional named <code>list</code> or <code>vector</code> with model parameters</p>
</td></tr>
<tr><td><code id="GUTS_RED_SD_+3A_init">init</code></td>
<td>
<p>optional named numeric <code>vector</code> to use as initial state</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+GutsRedSd-class">GutsRedSd</a>
</p>


<h3>State variables</h3>

<p>The following list describes the default names and standard units of <em>GUTS-RED</em>
state variables:
</p>

<ul>
<li> <p><code>D</code>, scaled damage (conc)
</p>
</li>
<li> <p><code>H</code>, cumulative hazard (-)
</p>
</li></ul>

<p>The state variables are initialized with zero by default.
</p>


<h3>SD model parameters</h3>


<ul>
<li> <p><code>kd</code>, dominant rate constant (time^-1)
</p>
</li>
<li> <p><code>hb</code>, background hazard rate (time^-1)
</p>
</li>
<li> <p><code>z</code>, threshold for effects (conc)
</p>
</li>
<li> <p><code>kk</code>, killing rate constant (time^-1)
</p>
</li></ul>



<h3>Effects</h3>

<p>The effect endpoint <code>L</code> (lethality) is available for <em>GUTS-RED</em> models.
A value of zero (<code>0.0</code>) denotes <em>no effect</em> on organism survival. A value of
one (<code>1.0</code>) denotes a lethality rate of 100%, i.e. no survivors.
</p>
<p>In addition, the surival rate over time can be derived for all output time
points using <code><a href="#topic+survival">survival()</a></code>.
</p>


<h3>References</h3>

<p>EFSA PPR Panel (EFSA Panel on Plant Protection Products and their Residues),
Ockleford C, Adriaanse P, Berny P, et al., 2018: <em>Scientific Opinion on the
state of the art of Toxicokinetic/Toxicodynamic (TKTD) effect models for
regulatory risk assessment of pesticides for aquatic organisms</em>. EFSA Journal 2018;
16(8):5377, 188 pp. <a href="https://doi.org/10.2903/j.efsa.2018.5377">doi:10.2903/j.efsa.2018.5377</a>
</p>


<h3>See Also</h3>

<p>Other GUTS-RED models: 
<code><a href="#topic+GUTS-RED-models">GUTS-RED-models</a></code>,
<code><a href="#topic+GUTS_RED_IT">GUTS_RED_IT</a>()</code>
</p>

<hr>
<h2 id='GUTS-RED-models'>GUTS-RED models</h2><span id='topic+GUTS-RED-models'></span>

<h3>Description</h3>

<p>Reduced <em>General Unified Threshold models of Survival</em> (GUTS) with stochastic
death (<em>SD</em>) and individual tolerance (<em>IT</em>)
</p>


<h3>Details</h3>

<p>The TKTD models <em><a href="#topic+GUTS_RED_SD">GUTS-RED-SD</a></em> and <em><a href="#topic+GUTS_RED_IT">GUTS-RED-IT</a></em>
were described by EFSA (2018).
GUTS-RED models assume a one-compartment model which directly links
external concentration to the scaled damage. The scaled damage is given in
units of concentration, equal to the units of measurement in the external
medium, e.g. ug/L. The damage dynamics is connected to an individual hazard
state variable, resulting in simulated mortality when an internal damage
threshold is exceeded. The death mechanisms stochastic death (<em>SD</em>) and
individual threshold (<em>IT</em>) are extreme cases of the <em>GUTS</em> theory.
</p>
<p>For <em>SD</em> models, the threshold parameter for lethal effects is fixed and
identical for all individuals of a group, meaning that the variance of the
threshold values is zero. Hence, the killing rate relates the probability of
a mortality event in proportion to the scaled damage. For <em>IT</em> models,
the thresholds for effects are distributed among individuals of a group.
Mortality of an individual follows immediately once the individual's tolerance
is exceeded. Meaning in model terms that the killing rate is set to
infinity (EFSA 2018).
</p>


<h3>State variables</h3>

<p>The following list describes the default names and standard units of <em>GUTS-RED</em>
state variables:
</p>

<ul>
<li> <p><code>D</code>, scaled damage (conc)
</p>
</li>
<li> <p><code>H</code>, cumulative hazard (-)
</p>
</li></ul>

<p>The state variables are initialized with zero by default.
</p>


<h3>SD model parameters</h3>


<ul>
<li> <p><code>kd</code>, dominant rate constant (time^-1)
</p>
</li>
<li> <p><code>hb</code>, background hazard rate (time^-1)
</p>
</li>
<li> <p><code>z</code>, threshold for effects (conc)
</p>
</li>
<li> <p><code>kk</code>, killing rate constant (time^-1)
</p>
</li></ul>



<h3>IT model parameters</h3>


<ul>
<li> <p><code>kd</code>, dominant rate constant (time^-1)
</p>
</li>
<li> <p><code>hb</code>, background hazard rate (time^-1)
</p>
</li>
<li> <p><code>alpha</code>, median of thresholds (conc)
</p>
</li>
<li> <p><code>beta</code>, shape parameter (-)
</p>
</li></ul>



<h3>Effects</h3>

<p>The effect endpoint <code>L</code> (lethality) is available for <em>GUTS-RED</em> models.
A value of zero (<code>0.0</code>) denotes <em>no effect</em> on organism survival. A value of
one (<code>1.0</code>) denotes a lethality rate of 100%, i.e. no survivors.
</p>
<p>In addition, the surival rate over time can be derived for all output time
points using <code><a href="#topic+survival">survival()</a></code>.
</p>


<h3>References</h3>

<p>EFSA PPR Panel (EFSA Panel on Plant Protection Products and their Residues),
Ockleford C, Adriaanse P, Berny P, et al., 2018: <em>Scientific Opinion on the
state of the art of Toxicokinetic/Toxicodynamic (TKTD) effect models for
regulatory risk assessment of pesticides for aquatic organisms</em>. EFSA Journal 2018;
16(8):5377, 188 pp. <a href="https://doi.org/10.2903/j.efsa.2018.5377">doi:10.2903/j.efsa.2018.5377</a>
</p>


<h3>See Also</h3>

<p>Other GUTS-RED models: 
<code><a href="#topic+GUTS_RED_IT">GUTS_RED_IT</a>()</code>,
<code><a href="#topic+GUTS_RED_SD">GUTS_RED_SD</a>()</code>
</p>
<p>Other scenarios: 
<code><a href="#topic+Algae-models">Algae-models</a></code>,
<code><a href="#topic+DEB-models">DEB-models</a></code>,
<code><a href="#topic+Lemna-models">Lemna-models</a></code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Myriophyllum-models">Myriophyllum-models</a></code>,
<code><a href="#topic+Scenarios">Scenarios</a></code>,
<code><a href="#topic+Transferable">Transferable</a></code>
</p>

<hr>
<h2 id='import_exposure_text'>Import exposure profiles from text files</h2><span id='topic+import_exposure_text'></span>

<h3>Description</h3>

<p>Read several exposure profiles at their corresponding paths at 'pathtofiles'.
The exposure profiles are read for each file that are character seperated
text files in a table format. The expected table format includes the columns
<code>time</code> and <code>conc</code> for the concentration at each timestep.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>import_exposure_text(pathtofiles, profileNames = NA, sep = "\t")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="import_exposure_text_+3A_pathtofiles">pathtofiles</code></td>
<td>
<p>path to files</p>
</td></tr>
<tr><td><code id="import_exposure_text_+3A_profilenames">profileNames</code></td>
<td>
<p>the names of the profiles</p>
</td></tr>
<tr><td><code id="import_exposure_text_+3A_sep">sep</code></td>
<td>
<p>the field separator character</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list of exposure profiles
</p>

<hr>
<h2 id='import_swash'>SWASH project exposure profile import</h2><span id='topic+import_swash'></span>

<h3>Description</h3>

<p>Read all TOXSWA files within a SWASH project directory.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>import_swash(swash_dir)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="import_swash_+3A_swash_dir">swash_dir</code></td>
<td>
<p>path to the SWASH project directory</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of exposure profiles each with two columns (time and concentration)
</p>

<hr>
<h2 id='import_toxswa'>Read TOXSWA exposure profiles from out-files</h2><span id='topic+import_toxswa'></span>

<h3>Description</h3>

<p>Read several TOXSWA exposure profiles from out-files at their corresponding
paths given by'pathtofiles'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>import_toxswa(pathtofiles, profileNames = NA)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="import_toxswa_+3A_pathtofiles">pathtofiles</code></td>
<td>
<p>paths to toxswa files that should be read</p>
</td></tr>
<tr><td><code id="import_toxswa_+3A_profilenames">profileNames</code></td>
<td>
<p>a vector of names to be used for the loaded toxswa files. if &quot;NA&quot; the filename without extension will be used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list of exposure profiles each with two columns (time and concentration)
</p>

<hr>
<h2 id='is_DEB'>Test if argument is a DEB model</h2><span id='topic+is_DEB'></span>

<h3>Description</h3>

<p>Test if argument is a DEB model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_DEB(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is_DEB_+3A_x">x</code></td>
<td>
<p>vector of <code>EffectScenario</code> objects</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of <code>logical</code> values
</p>

<hr>
<h2 id='is_GUTS'>Test if argument is a GUTS model</h2><span id='topic+is_GUTS'></span><span id='topic+is_GUTS_IT'></span><span id='topic+is_GUTS_SD'></span>

<h3>Description</h3>

<p>Test if argument is a GUTS model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_GUTS(x)

is_GUTS_IT(x)

is_GUTS_SD(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is_GUTS_+3A_x">x</code></td>
<td>
<p>vector of <code>EffectScenario</code> objects</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of <code>logical</code> values
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>is_GUTS_IT()</code>: Test if argument is a GUTS-IT model
</p>
</li>
<li> <p><code>is_GUTS_SD()</code>: Test if argument is a GUTS-IT model
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'># returns `TRUE`
is_GUTS(minnow_it)
is_GUTS(GUTS_RED_IT())

# returns `c(TRUE,TRUE,TRUE)`
is_GUTS(c(minnow_it, minnow_it, minnow_it))

# returns `FALSE`
is_GUTS_SD(minnow_it)
</code></pre>

<hr>
<h2 id='is_Lemna'>Test if argument is a Lemna model</h2><span id='topic+is_Lemna'></span>

<h3>Description</h3>

<p>Also returns <code>TRUE</code> for <code>LemnaThreshold</code> models
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_Lemna(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is_Lemna_+3A_x">x</code></td>
<td>
<p>vector of <a href="#topic+scenarios">scenarios</a> objects</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of logical values
</p>


<h3>See Also</h3>

<p><code><a href="#topic+is_LemnaThreshold">is_LemnaThreshold()</a></code>
</p>

<hr>
<h2 id='is_LemnaThreshold'>Test if argument is a LemnaThreshold model</h2><span id='topic+is_LemnaThreshold'></span>

<h3>Description</h3>

<p>Test if argument is a LemnaThreshold model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_LemnaThreshold(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is_LemnaThreshold_+3A_x">x</code></td>
<td>
<p>vector of <a href="#topic+scenarios">scenarios</a> objects</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of <code>logical</code> values
</p>


<h3>See Also</h3>

<p><code><a href="#topic+is_Lemna">is_Lemna()</a></code>
</p>

<hr>
<h2 id='is_scenario'>Test if argument is an effect scenario</h2><span id='topic+is_scenario'></span>

<h3>Description</h3>

<p>Supports vectorized arguments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_scenario(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is_scenario_+3A_x">x</code></td>
<td>
<p>Some value or object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of <code>logical</code> values
</p>


<h3>Examples</h3>

<pre><code class='language-R'># returns `TRUE`
is_scenario(minnow_it)

# returns `FALSE`
is_scenario(list())

</code></pre>

<hr>
<h2 id='Lemna_Schmitt'>Lemna model (Schmitt et al. 2013)</h2><span id='topic+Lemna_Schmitt'></span><span id='topic+LemnaSchmittScenario-class'></span><span id='topic+Lemna_SchmittThold'></span>

<h3>Description</h3>

<p>The model is a mechanistic combined toxicokinetic-toxicodynamic (TK/TD) and
growth model for the aquatic macrophytes <em>Lemna spp.</em>
The model simulates the development of <em>Lemna</em> biomass under laboratory and
environmental conditions and was developed by Schmitt <em>et al.</em> (2013). Growth
of the <em>Lemna</em> population is simulated on basis of photosynthesis and respiration
rates which are functions of environmental conditions.
The toxicodynamic sub-model describes the effects of growth-inhibiting
substances by a respective reduction in the photosynthesis rate based on
internal concentrations. This is the historical version of the Lemna model.
For current uses, we recommend the Lemna (SETAC) model, which is a more recent
version of the Schmitt model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Lemna_Schmitt(param, init)

Lemna_SchmittThold(param, init)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Lemna_Schmitt_+3A_param">param</code></td>
<td>
<p>optional named <code>list</code> or <code>vector</code> of model parameters</p>
</td></tr>
<tr><td><code id="Lemna_Schmitt_+3A_init">init</code></td>
<td>
<p>optional named numeric <code>vector</code> of initial state values</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Constructors to ease creation of scenarios based on the <em>Lemna</em> model by
Schmitt <em>et al.</em> (2013).
A variant of this <em>Lemna</em> model, <code>Lemna_SchmittThold()</code>, provides an additional
cumulative exposure threshold parameter. The Lemna biomass stops growing
if the integral of exposure over time exceeds the threshold. The integral
of exposure is internally accounted for by an additional state variable
<code>AUC</code> (Area Under Curve).
</p>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+LemnaSchmittScenario-class">LemnaSchmittScenario</a>
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>Lemna_SchmittThold()</code>: model variant with cumulative exposure threshold
</p>
</li></ul>


<h3>State variables</h3>

<p>The following list describes the default names and standard units of the model's
state variables:
</p>

<ul>
<li><p> BM, g_dw/m2, dry weight biomass per square meter
</p>
</li>
<li><p> E, -, effect [0,1]
</p>
</li>
<li><p> M_int, ug, internal toxicant mass
</p>
</li>
<li><p> AUC, ug/L, cumulative exposure (<strong>only</strong> for <code>LemnaThreshold</code> model)
</p>
</li></ul>

<p>Biomass (BM) and internal toxicant mass (M_int) are initialized to zero by
default. See <code><a href="#topic+set_init">set_init()</a></code> on how to set the initial states.
</p>


<h3>Model parameters</h3>

<p>The following model parameters are required:
</p>

<ul>
<li><p> Fate and biomass
</p>

<ul>
<li><p> k_phot_fix, logical, TRUE then k_phot_max is not changed by environmental factors, else FALSE
</p>
</li>
<li><p> k_phot_max, 1/d, maximum photosynthesis rate
</p>
</li>
<li><p> k_resp, 1/d, respiration rate
</p>
</li>
<li><p> k_loss, 1/d, rate of loss (e.g. flow rate)
</p>
</li>
<li><p> mass_per_frond, g_dw/frond, dry weight per frond
</p>
</li>
<li><p> BMw2BMd, g_fw/g_dw, Fresh weight/dry weight
</p>
</li></ul>

</li>
<li><p> Effect
</p>

<ul>
<li><p> Emax, -, maximum effect [0,1]
</p>
</li>
<li><p> EC50, ug/L, midpoint of effect curve
</p>
</li>
<li><p> b, -, slope of effect curve
</p>
</li></ul>

</li>
<li><p> Toxicokinetics
</p>

<ul>
<li><p> P_up, cm/d, Permeability for uptake
</p>
</li>
<li><p> AperBM, cm2/g_dw, A_leaf / d_leaf = 1/d_leaf (for circular disc, d=0.05 cm)
</p>
</li>
<li><p> Kbm, -, Biomass(fw) : water partition coefficient
</p>
</li>
<li><p> P_Temp, logical, TRUE to enable temperature dependence of cuticle permeability, else FALSE
</p>
</li>
<li><p> MolWeight, g/mol, Molmass of molecule (determines Q10_permeability)
</p>
</li></ul>

</li>
<li><p> Temperature dependence
</p>

<ul>
<li><p> Tmin, deg C, minimum temperature for growth
</p>
</li>
<li><p> Tmax, deg C, maximum temperature for growth
</p>
</li>
<li><p> Topt, deg C, optimal temperature for growth
</p>
</li>
<li><p> t_ref, deg C, reference temperature for respiration rate
</p>
</li>
<li><p> Q10, -, temperature dependence factor for respiration rate
</p>
</li></ul>

</li>
<li><p> Light dependence
</p>

<ul>
<li><p> k_0, 1/d, light dependence: intercept of linear part
</p>
</li>
<li><p> a_k, (1/d)/(kJ/m2.d), light dependence: slope of linear part
</p>
</li></ul>

</li>
<li><p> Phosphorus dependence (Hill like dep.)
</p>

<ul>
<li><p> C_P, mg/L, phosphorus concentration in water
</p>
</li>
<li><p> CP50, mg/L, phosphorus conc. where growth rate is halfed
</p>
</li>
<li><p> a_p, -, Hill coefficient
</p>
</li>
<li><p> KiP, mg/L, p-inhibition constant for very high p-conc.
</p>
</li></ul>

</li>
<li><p> Nitrogen dependence (Hill like dep.)
</p>

<ul>
<li><p> C_N, mg/L, nitrogen concentration in water
</p>
</li>
<li><p> CN50, mg/L, n-conc. where growth rate is halfed
</p>
</li>
<li><p> a_N, -, Hill coefficient
</p>
</li>
<li><p> KiN, mg/L, n-inhibition constant for very high p-conc.
</p>
</li></ul>

</li>
<li><p> Density dependence
</p>

<ul>
<li><p> BM50, g_dw/m2, cut off BM
</p>
</li></ul>

</li></ul>

<p>The <code>Lemna_SchmittThold</code> model requires the following additional parameter:
</p>

<ul>
<li><p> threshold, ug/L, cumulative exposure threshold
</p>
</li></ul>



<h3>Forcings</h3>

<p>Besides exposure, the Lemna model requires two environmental properties as
time-series input: global radiation (<code>rad</code>, kJ/m2.d) and temperature (<code>temp</code>, deg C).
Forcings time-series are represented by <code>data.frame</code> objects consisting of two
columns. The first for time and the second for the environmental factor in question.
</p>
<p>Entries of the <code>data.frame</code> need to be ordered chronologically. A time-series
can consist of only a single row; in this case it will represent constant
environmental conditions. See <a href="#topic+scenarios">scenarios</a> for more details.
</p>


<h3>Effects</h3>

<p>Supported effect endpoints include <em>BM</em> (biomass) and <em>r</em> (average
growth rate during simulation). The effect on biomass is calculated from
the last state of a simulation. Be aware that endpoint <em>r</em> is incompatible
with frond transfers.
</p>


<h3>Simulation output</h3>

<p>Simulation results will contain two additional columns besides state variables:
</p>

<ul>
<li><p> C_int, ug/L, internal concentration of toxicant
</p>
</li>
<li><p> FrondNo, -, number of fronds
</p>
</li></ul>

<p>It is possible to amend the output of <code><a href="#topic+simulate">simulate()</a></code> with additional model
quantities that are not state variables, for e.g. debugging purposes or to
analyze model behavior. To enable or disable additional outputs, use the
optional argument <code>nout</code> of <code><a href="#topic+simulate">simulate()</a></code>, see examples below. <code>nout=1</code>
enables reporting of internal concentration (C_int), <code>nout=14</code> enables all
additional outputs, and <code>nout=0</code> will disable additional outputs.
</p>
<p>The available output levels are as follows:
</p>

<ul>
<li> <p><code>nout=1</code>
</p>

<ul>
<li> <p><code>C_int</code>, internal concentration (ug/L)
</p>
</li></ul>

</li>
<li> <p><code>nout=2</code>
</p>

<ul>
<li> <p><code>FrondNo</code>, number of fronds (-)
</p>
</li></ul>

</li>
<li> <p><code>nout=3</code>
</p>

<ul>
<li> <p><code>C_int_u</code>, unbound internal concentration (ug/l)
</p>
</li></ul>

</li>
<li> <p><code>nout=8</code>, growth and TK/TD
</p>

<ul>
<li> <p><code>BM_fresh</code>, fresh weight biomass (g_fw/m2)
</p>
</li>
<li> <p><code>k_photo_eff</code>, current photosynthesis rate (1/d)
</p>
</li>
<li> <p><code>k_resp_eff</code>, current respiration rate (1/d)
</p>
</li>
<li> <p><code>f_Eff</code>, toxic effect factor (-)
</p>
</li>
<li> <p><code>P_up_eff</code>, current permeability for uptake (cm/d)
</p>
</li></ul>

</li>
<li> <p><code>nout=11</code>, environmental factors
</p>

<ul>
<li> <p><code>actConc</code>, current toxicant concentration in surrounding medium (ug/L)
</p>
</li>
<li> <p><code>actTemp</code>, current environmental temperature (deg C)
</p>
</li>
<li> <p><code>actRad</code>, current environmental radiation (kJ/m2.d)
</p>
</li></ul>

</li>
<li> <p><code>nout=14</code>, derivatives
</p>

<ul>
<li> <p><code style="white-space: pre;">&#8288;d BM/dt&#8288;</code>, current change in state variable BM
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;d E/dt&#8288;</code>, current change in effect
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;d M_int/dt&#8288;</code>, current change in internal toxicant mass
</p>
</li></ul>

</li></ul>



<h3>Biomass transfer</h3>

<p>Models supporting biomass transfer can be instructed to move a fixed amount
of biomass to a new medium after a period of time. This feature replicates
a procedure occurring in e.g. Lemna effect studies and may be necessary to
recreate study results.
</p>
<p>The biomass transfer feature assumes that always a fixed amount of
biomass is transferred. Transfers can occur at any fixed point in time or
in regular intervals. During a transfer, the biomass is reset to the
transferred amount and additional compartments can be scaled 1:1 accordingly,
to e.g. reflect the change in internal toxicant mass when biomass is modified.
Transfer settings can be modified using <code><a href="#topic+set_transfer">set_transfer()</a></code>.
</p>
<p>Any transfer time point must also be an output time point. If a transfer
occurs, simulation results of that time point will report the model state
<strong>before</strong> the transfer. Be aware that in order to use transfers at regular
intervals, the simulation must start at time point zero.
</p>


<h3>References</h3>

<p>Schmitt W., Bruns E., Dollinger M., and Sowig P., 2013:
<em>Mechanistic TK/TD-model simulating the effect of growth inhibitors on
Lemna populations</em>. Ecol Model 255, pp. 1-10. <a href="https://doi.org/10.1016/j.ecolmodel.2013.01.017">doi:10.1016/j.ecolmodel.2013.01.017</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Lemna-models">Lemna-models</a>, <a href="#topic+Macrophyte-models">Macrophyte-models</a>, <a href="#topic+Transferable">Transferable</a>, <a href="#topic+Scenarios">Scenarios</a>
</p>
<p>Other Lemna models: 
<code><a href="#topic+Lemna-models">Lemna-models</a></code>,
<code><a href="#topic+Lemna_SETAC">Lemna_SETAC</a>()</code>
</p>
<p>Other macrophyte models: 
<code><a href="#topic+Lemna_SETAC">Lemna_SETAC</a>()</code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Myrio">Myrio</a>()</code>,
<code><a href="#topic+Myrio_log">Myrio_log</a>()</code>
</p>

<hr>
<h2 id='Lemna_SETAC'>Lemna model (Klein et al. 2021)</h2><span id='topic+Lemna_SETAC'></span><span id='topic+LemnaSetacScenario-class'></span>

<h3>Description</h3>

<p>The model was described and published by the SETAC Europe Interest Group
Effect Modeling (Klein et al. 2022). It is based on the <em>Lemna</em> model
by Schmitt (2013). The model is a mechanistic combined
toxicokinetic-toxicodynamic (TK/TD) and growth model for the aquatic
macrophytes <em>Lemna spp.</em>. The model simulates the development of Lemna biomass
under laboratory and environmental conditions. Growth of the Lemna population
is simulated on basis of photosynthesis and respiration rates which are
functions of environmental conditions. The toxicodynamic sub-model describes
the effects of growth-inhibiting substances by a respective reduction in the
photosynthesis rate based on internal concentrations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Lemna_SETAC()
</code></pre>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+LemnaSetacScenario-class">LemnaSetacScenario</a>
</p>


<h3>State variables</h3>

<p>The model has two state variables:
</p>

<ul>
<li> <p><code>BM</code>, Biomass (g dw m-2)
</p>
</li>
<li> <p><code>M_int</code>, Mass of toxicant in plant population (mass per m2, e.g. ug m-2)
</p>
</li></ul>



<h3>Model parameters</h3>


<ul>
<li><p> Growth model
</p>

<ul>
<li> <p><code>k_photo_fixed</code>, Model switch for unlimited growth conditions (TRUE/FALSE)
</p>
</li>
<li> <p><code>k_photo_max</code>, Maximum photosynthesis rate (d-1)
</p>
</li>
<li> <p><code>k_loss</code>, Reference loss rate (d-1)
</p>
</li>
<li> <p><code>BM_threshold</code>, Lower biomass abundance threshold,  (g dw m-2)
</p>
</li>
<li> <p><code>BM_min</code>, Reservoir for biomass recovery,  (g dw m-2)
</p>
</li></ul>

</li>
<li><p> Temperature response of photosynthesis
</p>

<ul>
<li> <p><code>T_opt</code>, Optimum growth temperature (°C)
</p>
</li>
<li> <p><code>T_min</code>, Minimum growth temperature (°C)
</p>
</li>
<li> <p><code>T_max</code>, Maximum growth temperature (°C)
</p>
</li></ul>

</li>
<li><p> Temperature response of biomass loss rate
</p>

<ul>
<li> <p><code>Q10</code>, Temperature coefficient (-)
</p>
</li>
<li> <p><code>T_ref</code>, Reference temperature for response=1 (°C)
</p>
</li></ul>

</li>
<li><p> Irradiance reponse of photosynthesis
</p>

<ul>
<li> <p><code>alpha</code>, Slope of irradiance response (m2 d kJ-1)
</p>
</li>
<li> <p><code>beta</code>, Intercept of irradiance response (-)
</p>
</li></ul>

</li>
<li><p> Nutrient response of photosynthesis
</p>

<ul>
<li> <p><code>N_50</code>, Half-saturation constant of Nitrogen (mg N L-1)
</p>
</li>
<li> <p><code>P_50</code>, Half-saturation constant of Phosphorus (mg P L-1)
</p>
</li></ul>

</li>
<li><p> Density dependence of photosynthesis
</p>

<ul>
<li> <p><code>BM_L</code>, Carrying capacity (g dw m-2)
</p>
</li></ul>

</li>
<li><p> Concentration response (Toxicodynamics)
</p>

<ul>
<li> <p><code>EC50_int</code>, Internal concentration resulting in 50% effect (ug L-1)
</p>
</li>
<li> <p><code>E_max</code>, Maximum inhibition (-)
</p>
</li>
<li> <p><code>b</code>, Slope parameter (-)
</p>
</li></ul>

</li>
<li><p> Internal concentration (Toxicokinetics)
</p>

<ul>
<li> <p><code>P</code>, Permeability (cm d-1)
</p>
</li>
<li> <p><code>r_A_DW</code>, Area per dry-weight ratio (cm2 g-1)
</p>
</li>
<li> <p><code>r_FW_DW</code>, Fresh weight per dry weight ratio (-)
</p>
</li>
<li> <p><code>r_FW_V</code>, Fresh weight density (g cm-3)
</p>
</li>
<li> <p><code>r_DW_FN</code>, Dry weight per frond ratio  (g dw)
</p>
</li>
<li> <p><code>K_pw</code>, Partitioning coefficient plant:water (-)
</p>
</li>
<li> <p><code>k_met</code>, Metabolisation rate (d-1)
</p>
</li></ul>

</li></ul>



<h3>Forcings</h3>

<p>Besides exposure, the model requires four environmental properties as
time-series input:
</p>

<ul>
<li> <p><code>tmp</code>, temperature (°C)
</p>
</li>
<li> <p><code>irr</code>, irradiance (kJ m-2 d-1)
</p>
</li>
<li> <p><code>P</code>, Phosphorus concentration (mg P L-1)
</p>
</li>
<li> <p><code>N</code>, Nitrogen concentration (mg N L-1)
</p>
</li></ul>

<p>Forcings time-series are represented by <code>data.frame</code> objects consisting of two
columns. The first for time and the second for the environmental factor in question.
</p>
<p>Entries of the <code>data.frame</code> need to be ordered chronologically. A time-series
can consist of only a single row; in this case it will represent constant
environmental conditions. See <a href="#topic+scenarios">scenarios</a> for more details.
</p>


<h3>Effects</h3>

<p>Supported effect endpoints include <em>BM</em> (biomass) and <em>r</em> (average
growth rate during simulation). The effect on biomass is calculated from
the last state of a simulation. Be aware that endpoint <em>r</em> is incompatible
with biomass transfers.
</p>


<h3>Simulation output</h3>

<p>For reasons of convenience, the return value contains by default two additional
variables derived from simulation results: the internal concentration <code>C_int</code>
as well as the number of fronds <code>FrondNo</code>. These can be disabled by setting
the argument <code>nout = 0</code>.
</p>
<p>The available output levels are as follows:
</p>

<ul>
<li> <p><code>nout &gt;= 1</code>
</p>

<ul>
<li> <p><code>C_int</code>, internal concentration (mass per volume)
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 2</code>
</p>

<ul>
<li> <p><code>FrondNo</code>, frond number (-)
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 4</code>
</p>

<ul>
<li> <p><code>f_loss</code>, respiration dependency function (-)
</p>
</li>
<li> <p><code>f_photo</code>, photosynthesis dependency function (-)
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 10</code>
</p>

<ul>
<li> <p><code>fT_photo</code>, temperature response of photosynthesis (-)
</p>
</li>
<li> <p><code>fI_photo</code>, irradiance response of photosynthesis (-)
</p>
</li>
<li> <p><code>fP_photo</code>, phosphorus response of photosynthesis (-)
</p>
</li>
<li> <p><code>fN_photo</code>, nitrogen response of photosynthesis (-)
</p>
</li>
<li> <p><code>fBM_photo</code>, density response of photosynthesis (-)
</p>
</li>
<li> <p><code>fCint_photo</code>, concentration response of photosynthesis (-)
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 16</code>
</p>

<ul>
<li> <p><code>C_int_unb</code>, unbound internal concentration (mass per volume)
</p>
</li>
<li> <p><code>C_ext</code>, external concentration (mass per volume)
</p>
</li>
<li> <p><code>Tmp</code>, temperature (deg C)
</p>
</li>
<li> <p><code>Irr</code>, irradiance (kJ m-2 d-1)
</p>
</li>
<li> <p><code>Phs</code>, Phosphorus concentration (mg P L-1)
</p>
</li>
<li> <p><code>Ntr</code>, Nitrogen concentration (mg N L-1)
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 18</code>
</p>

<ul>
<li> <p><code>dBM</code>, biomass derivative (g dw m-2 d-1)
</p>
</li>
<li> <p><code>dM_int</code>, mass of toxicant in plants derivative (mass per m2 d-1)
</p>
</li></ul>

</li></ul>



<h3>Biomass transfer</h3>

<p>Models supporting biomass transfer can be instructed to move a fixed amount
of biomass to a new medium after a period of time. This feature replicates
a procedure occurring in e.g. Lemna effect studies and may be necessary to
recreate study results.
</p>
<p>The biomass transfer feature assumes that always a fixed amount of
biomass is transferred. Transfers can occur at any fixed point in time or
in regular intervals. During a transfer, the biomass is reset to the
transferred amount and additional compartments can be scaled 1:1 accordingly,
to e.g. reflect the change in internal toxicant mass when biomass is modified.
Transfer settings can be modified using <code><a href="#topic+set_transfer">set_transfer()</a></code>.
</p>
<p>Any transfer time point must also be an output time point. If a transfer
occurs, simulation results of that time point will report the model state
<strong>before</strong> the transfer. Be aware that in order to use transfers at regular
intervals, the simulation must start at time point zero.
</p>


<h3>References</h3>

<p>Klein J., Cedergreen N., Heine S., Reichenberger S., Rendal C.,
Schmitt W., Hommen U., 2021: <em>Refined description of the Lemna TKTD growth model
based on Schmitt et al. (2013) - equation system and default parameters</em>.
Report of the working group <em>Lemna</em> of the SETAC Europe Interest Group Effect
Modeling. Version 1, uploaded on 22. Sept. 2021.
https://www.setac.org/group/effect-modeling.html
</p>
<p>Schmitt W., Bruns E., Dollinger M., and Sowig P., 2013:
<em>Mechanistic TK/TD-model simulating the effect of growth inhibitors on
Lemna populations</em>. Ecol Model 255, pp. 1-10. <a href="https://doi.org/10.1016/j.ecolmodel.2013.01.017">doi:10.1016/j.ecolmodel.2013.01.017</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Lemna-models">Lemna-models</a>, <a href="#topic+Macrophyte-models">Macrophyte-models</a>, <a href="#topic+Transferable">Transferable</a>, <a href="#topic+Scenarios">Scenarios</a>
</p>
<p>Other Lemna models: 
<code><a href="#topic+Lemna-models">Lemna-models</a></code>,
<code><a href="#topic+Lemna_Schmitt">Lemna_Schmitt</a>()</code>
</p>
<p>Other macrophyte models: 
<code><a href="#topic+Lemna_Schmitt">Lemna_Schmitt</a>()</code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Myrio">Myrio</a>()</code>,
<code><a href="#topic+Myrio_log">Myrio_log</a>()</code>
</p>

<hr>
<h2 id='Lemna-models'>Lemna models</h2><span id='topic+Lemna-models'></span><span id='topic+Lemna-class'></span>

<h3>Description</h3>

<p>Overview of supported <em>Lemna</em> models
</p>


<h3>Details</h3>


<ul>
<li> <p><code><a href="#topic+Lemna_Schmitt">Lemna_Schmitt()</a></code> by Schmitt <em>et al.</em> (2013)
</p>
</li>
<li> <p><code><a href="#topic+Lemna_SETAC">Lemna_SETAC()</a></code> by Klein <em>et al.</em> (2021)
</p>
</li></ul>



<h3>Biomass transfer</h3>

<p>Models supporting biomass transfer can be instructed to move a fixed amount
of biomass to a new medium after a period of time. This feature replicates
a procedure occurring in e.g. Lemna effect studies and may be necessary to
recreate study results.
</p>
<p>The biomass transfer feature assumes that always a fixed amount of
biomass is transferred. Transfers can occur at any fixed point in time or
in regular intervals. During a transfer, the biomass is reset to the
transferred amount and additional compartments can be scaled 1:1 accordingly,
to e.g. reflect the change in internal toxicant mass when biomass is modified.
Transfer settings can be modified using <code><a href="#topic+set_transfer">set_transfer()</a></code>.
</p>
<p>Any transfer time point must also be an output time point. If a transfer
occurs, simulation results of that time point will report the model state
<strong>before</strong> the transfer. Be aware that in order to use transfers at regular
intervals, the simulation must start at time point zero.
</p>


<h3>See Also</h3>

<p><a href="#topic+Macrophyte-models">Macrophyte-models</a>
</p>
<p>Other Lemna models: 
<code><a href="#topic+Lemna_SETAC">Lemna_SETAC</a>()</code>,
<code><a href="#topic+Lemna_Schmitt">Lemna_Schmitt</a>()</code>
</p>
<p>Other scenarios: 
<code><a href="#topic+Algae-models">Algae-models</a></code>,
<code><a href="#topic+DEB-models">DEB-models</a></code>,
<code><a href="#topic+GUTS-RED-models">GUTS-RED-models</a></code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Myriophyllum-models">Myriophyllum-models</a></code>,
<code><a href="#topic+Scenarios">Scenarios</a></code>,
<code><a href="#topic+Transferable">Transferable</a></code>
</p>

<hr>
<h2 id='log_enable'>Start and stop logging</h2><span id='topic+log_enable'></span><span id='topic+log_disable'></span>

<h3>Description</h3>

<p>Start and stop logging
</p>


<h3>Usage</h3>

<pre><code class='language-R'>log_enable(file = NULL, append = TRUE, envir = parent.frame())

log_disable()
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="log_enable_+3A_file">file</code></td>
<td>
<p><code>character</code>, file name or path to a log file</p>
</td></tr>
<tr><td><code id="log_enable_+3A_append">append</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code> output will be appended to an existing log file,
otherwise the log file will be replaced</p>
</td></tr>
<tr><td><code id="log_enable_+3A_envir">envir</code></td>
<td>
<p>log will be automatically disabled if <code>environment</code> is exited,
set to <code>NULL</code> to disable</p>
</td></tr>
</table>


<h3>Value</h3>

<p>no return value
</p>

<hr>
<h2 id='log_envir'>Log R environment properties</h2><span id='topic+log_envir'></span>

<h3>Description</h3>

<p>Log R environment properties
</p>


<h3>Usage</h3>

<pre><code class='language-R'>log_envir()
</code></pre>


<h3>Value</h3>

<p>no return value
</p>

<hr>
<h2 id='log_msg'>Add a log message</h2><span id='topic+log_msg'></span>

<h3>Description</h3>

<p>Message will only appear in the console or in log file if logging was
enabled using <code>log_enable()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>log_msg(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="log_msg_+3A_...">...</code></td>
<td>
<p>elements will be concatenated using <code>paste0()</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>no return value
</p>


<h3>Examples</h3>

<pre><code class='language-R'>log_msg("this message will not appear")

log_enable()
log_msg("this message will appear")
log_msg("a number of ","elements to ",42," concatenate")
</code></pre>

<hr>
<h2 id='log_scenarios'>Log scenario properties</h2><span id='topic+log_scenarios'></span>

<h3>Description</h3>

<p>Log scenario properties
</p>


<h3>Usage</h3>

<pre><code class='language-R'>log_scenarios(x, header = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="log_scenarios_+3A_x">x</code></td>
<td>
<p>vector of <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="log_scenarios_+3A_header">header</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code> a header line will be printed</p>
</td></tr>
</table>


<h3>Value</h3>

<p>unmodified argument <code>x</code>
</p>

<hr>
<h2 id='Macrophyte-models'>Macrophyte models</h2><span id='topic+Macrophyte-models'></span>

<h3>Description</h3>

<p>Population models of standard test macrophytes, such as <em>Lemna spp.</em>
</p>


<h3>Details</h3>

<p>Available macrophyte models:
</p>

<ul>
<li> <p><a href="#topic+Lemna-models">Lemna</a>
</p>
</li>
<li> <p><a href="#topic+Myrio">Myriophyllum</a>
</p>
</li></ul>



<h3>Biomass transfer</h3>

<p>Models supporting biomass transfer can be instructed to move a fixed amount
of biomass to a new medium after a period of time. This feature replicates
a procedure occurring in e.g. Lemna effect studies and may be necessary to
recreate study results.
</p>
<p>The biomass transfer feature assumes that always a fixed amount of
biomass is transferred. Transfers can occur at any fixed point in time or
in regular intervals. During a transfer, the biomass is reset to the
transferred amount and additional compartments can be scaled 1:1 accordingly,
to e.g. reflect the change in internal toxicant mass when biomass is modified.
Transfer settings can be modified using <code><a href="#topic+set_transfer">set_transfer()</a></code>.
</p>
<p>Any transfer time point must also be an output time point. If a transfer
occurs, simulation results of that time point will report the model state
<strong>before</strong> the transfer. Be aware that in order to use transfers at regular
intervals, the simulation must start at time point zero.
</p>


<h3>See Also</h3>

<p><a href="#topic+Scenarios">Scenarios</a>
</p>
<p>Other macrophyte models: 
<code><a href="#topic+Lemna_SETAC">Lemna_SETAC</a>()</code>,
<code><a href="#topic+Lemna_Schmitt">Lemna_Schmitt</a>()</code>,
<code><a href="#topic+Myrio">Myrio</a>()</code>,
<code><a href="#topic+Myrio_log">Myrio_log</a>()</code>
</p>
<p>Other scenarios: 
<code><a href="#topic+Algae-models">Algae-models</a></code>,
<code><a href="#topic+DEB-models">DEB-models</a></code>,
<code><a href="#topic+GUTS-RED-models">GUTS-RED-models</a></code>,
<code><a href="#topic+Lemna-models">Lemna-models</a></code>,
<code><a href="#topic+Myriophyllum-models">Myriophyllum-models</a></code>,
<code><a href="#topic+Scenarios">Scenarios</a></code>,
<code><a href="#topic+Transferable">Transferable</a></code>
</p>

<hr>
<h2 id='metsulfuron'>Lemna data published by Schmitt (2013)</h2><span id='topic+metsulfuron'></span>

<h3>Description</h3>

<p>Data set for the parametrisation of a mechanistic combined
toxicokinetic-toxicodynamic (TK/TD) and growth model for the aquatic
macrophytes Lemna spp. as published by Schmitt <em>et al.</em> (2013).
The growth model was parameterised by Schmitt et al. based on these
data while toxicokinetic and toxicodynamic parameters were determined by
calibrating the model using substance specific effect data of metsulfuron-methyl.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>metsulfuron
</code></pre>


<h3>Format</h3>

<p>An object of class <code>LemnaSchmittScenario</code> of length 1.
</p>


<h3>References</h3>

<p>Schmitt W., Bruns E., Dollinger M., and Sowig P., 2013: <em>Mechanistic TK/TD-model
simulating the effect of growth inhibitors on Lemna populations</em>. Ecol Model 255,
pp. 1-10. <a href="https://doi.org/10.1016/j.ecolmodel.2013.01.017">doi:10.1016/j.ecolmodel.2013.01.017</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Lemna-models">Lemna-models</a>
</p>

<hr>
<h2 id='minnow_it'>A GUTS-RED-IT scenario of the fathead minnow</h2><span id='topic+minnow_it'></span>

<h3>Description</h3>

<p>The scenario consists of a parameterized GUTS-RED-IT model and a constant
exposure series. Model parameters were derived from an acute fish toxicity
study of the fathead minnow and chlorpyrifos by Geiger <em>et al.</em> (1988).
The dataset is also referred to as the <em>GUTS Ring-test dataset C</em> and was
downloaded from the <a href="https://mosaic.univ-lyon1.fr/guts">MOSAIC</a> website.
Fitted parameters were estimated using the <a href="#topic+morse">morse</a> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>minnow_it
</code></pre>


<h3>Format</h3>

<p>An object of class <code>GutsRedIt</code> of length 1.
</p>


<h3>Details</h3>

<p>The background mortality rate (<code>hb</code>) was set to zero.
</p>


<h3>Source</h3>

<p><a href="https://mosaic.univ-lyon1.fr/guts">https://mosaic.univ-lyon1.fr/guts</a>
</p>


<h3>References</h3>

<p>Geiger D.L., Call D.J., and Brooke L.T., 1988: <em>Acute toxicities of organic
chemicals to fathead minnows (Pimephales promelas): Volume IV</em>, pp. 195-197.
University of Wisconsin-Superior, Center for Lake Superior Environmental Studies.
ISBN 9780961496838.
</p>


<h3>See Also</h3>

<p><a href="#topic+GUTS-RED-models">GUTS-RED-models</a>
</p>

<hr>
<h2 id='minnow_sd'>A GUTS-RED-SD scenario of the fathead minnow</h2><span id='topic+minnow_sd'></span>

<h3>Description</h3>

<p>The scenario consists of a parameterized GUTS-RED-SD model and a constant
exposure series. Model parameters were derived from an acute fish toxicity
study of the fathead minnow and chlorpyrifos by Geiger <em>et al.</em> (1988).
The dataset is also referred to as the <em>GUTS Ring-test dataset C</em> and was
downloaded from the <a href="https://mosaic.univ-lyon1.fr/guts">MOSAIC</a> website.
Fitted parameters were estimated using the <a href="#topic+morse">morse</a> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>minnow_sd
</code></pre>


<h3>Format</h3>

<p>An object of class <code>GutsRedSd</code> of length 1.
</p>


<h3>Details</h3>

<p>The background mortality rate (<code>hb</code>) was set to zero.
</p>


<h3>Source</h3>

<p><a href="https://mosaic.univ-lyon1.fr/guts">https://mosaic.univ-lyon1.fr/guts</a>
</p>


<h3>References</h3>

<p>Geiger D.L., Call D.J., and Brooke L.T., 1988: <em>Acute toxicities of organic
chemicals to fathead minnows (Pimephales promelas): Volume IV</em>, pp. 195-197.
University of Wisconsin-Superior, Center for Lake Superior Environmental Studies.
ISBN 9780961496838.
</p>


<h3>See Also</h3>

<p><a href="#topic+GUTS-RED-models">GUTS-RED-models</a>
</p>

<hr>
<h2 id='morse'>Import <code>morse</code> model parameters</h2><span id='topic+morse'></span>

<h3>Description</h3>

<p>Loads GUTS model parameters which were fitted by the morse package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>morse(
  file,
  find.SD = TRUE,
  find.IT = TRUE,
  reset.hb = TRUE,
  params = c("estim", "all"),
  mcmc.size
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="morse_+3A_file">file</code></td>
<td>
<p>Path to .RData file</p>
</td></tr>
<tr><td><code id="morse_+3A_find.sd">find.SD</code></td>
<td>
<p>a logical value. If <code>TRUE</code>, it will try to find fitted parameters of the GUTS_SD model</p>
</td></tr>
<tr><td><code id="morse_+3A_find.it">find.IT</code></td>
<td>
<p>a logical value. If <code>TRUE</code>, it will try to find fitted parameters of the GUTS_IT model</p>
</td></tr>
<tr><td><code id="morse_+3A_reset.hb">reset.hb</code></td>
<td>
<p>a logical value. If <code>TRUE</code>, the background hazard rate <code>hb</code> is set to zero</p>
</td></tr>
<tr><td><code id="morse_+3A_params">params</code></td>
<td>
<p><code>character</code>, if <code>"estim"</code> is selected then only the fitted parameter set for each model
is returned, else for <code>"auto"</code> all parameter sets in the MCM chains are returned</p>
</td></tr>
<tr><td><code id="morse_+3A_mcmc.size">mcmc.size</code></td>
<td>
<p>optional <code>integer</code>, sets the maximum number of imported parameter sets per MCMC,
all parameters are imported by default</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of <code>parameter_set</code> objects
</p>


<h3>Examples</h3>

<pre><code class='language-R'># import all parameter fits
try(morse("path/to/morse_fit.RData"))

# import parameters for a specific model
try(morse("path/to/morse_fit.RData", find.IT=TRUE, find.SD=FALSE))

# modify model objects
try(models %&gt;% set_param(morse("path/to/morse_fit.RData")))
</code></pre>

<hr>
<h2 id='Myrio'>Myriophyllum model with exponential growth</h2><span id='topic+Myrio'></span><span id='topic+MyrioExpScenario-class'></span>

<h3>Description</h3>

<p>The <em>Myriophyllum</em> model is derived from the <em>Lemna</em> TKTD model by
Klein <em>et al.</em> (2021). The Myriophyllum model is mathematically equivalent
to the Tier 2C version of the <em>Lemna</em> model by Klein <em>et al.</em> (2021),
cf. <code><a href="#topic+Lemna_SETAC">Lemna_SETAC()</a></code>. Recommended settings for Tier 2C are <code>k_photo_fixed=TRUE</code>
and <code>k_resp=0</code> (Klein <em>et al.</em> 2021).
In particular, the growth model is a simple exponential growth model,
which is considered to be the typical situation for a laboratory macrophyte
study. Instead of frond numbers as for <em>Lemna</em>, the biomass is also returned as
total shoot length (<code>TSL</code>) in simulation results.
Consequently, the model has the additional parameter <code>r_DW_TSL</code>
(dry weight per total shoot length ratio) instead of <code>r_DW_FN</code> (dry weight
per frond number ratio).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Myrio()
</code></pre>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+MyrioExpScenario-class">MyrioExpScenario</a>
</p>


<h3>State variables</h3>

<p>The model has two state variables:
</p>

<ul>
<li> <p><code>BM</code>, Biomass (g dw m-2)
</p>
</li>
<li> <p><code>M_int</code>, Mass of toxicant in plant population (mass per m2, e.g. ug m-2)
</p>
</li></ul>



<h3>Model parameters</h3>


<ul>
<li><p> Growth model
</p>

<ul>
<li> <p><code>k_photo_max</code>, Maximum photosynthesis rate (d-1), default: <code>0.47</code>
</p>
</li></ul>

</li>
<li><p> Concentration response (Toxicodynamics)
</p>

<ul>
<li> <p><code>EC50_int</code>, Internal concentration resulting in 50% effect (ug L-1)
</p>
</li>
<li> <p><code>E_max</code>, Maximum inhibition (-), default: <code>1</code>
</p>
</li>
<li> <p><code>b</code>, Slope parameter (-)
</p>
</li></ul>

</li>
<li><p> Internal concentration (Toxicokinetics)
</p>

<ul>
<li> <p><code>P</code>, Permeability (cm d-1)
</p>
</li>
<li> <p><code>r_A_DW</code>, Area per dry-weight ratio (cm2 g-1), default: <code>1000</code>
</p>
</li>
<li> <p><code>r_FW_DW</code>, Fresh weight per dry weight ratio (-), default: <code>16.7</code>
</p>
</li>
<li> <p><code>r_FW_V</code>, Fresh weight density (g cm-3), default: <code>1</code>
</p>
</li>
<li> <p><code>r_DW_TSL</code>, Dry weight per total shoot length ratio  (?)
</p>
</li>
<li> <p><code>K_pw</code>, Partitioning coefficient plant:water (-), default: <code>1</code>
</p>
</li>
<li> <p><code>k_met</code>, Metabolisation rate (d-1), default: <code>0</code>
</p>
</li></ul>

</li></ul>



<h3>Environmental factors</h3>

<p>None.
</p>


<h3>Simulation output</h3>

<p>Simulation results will contain two additional columns besides state variables:
</p>

<ul>
<li> <p><code>C_int</code>, internal concentration of toxicant (mass per volume)
</p>
</li>
<li> <p><code>TSL</code>, total shoot length (?)
</p>
</li></ul>

<p>The available output levels are as follows:
</p>

<ul>
<li> <p><code>nout &gt;= 1</code>
</p>

<ul>
<li> <p><code>C_int</code>, internal concentration (mass per volume)
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 2</code>
</p>

<ul>
<li> <p><code>TSL</code>, total shoot length (?)
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 3</code>
</p>

<ul>
<li> <p><code>f_photo</code>, photosynthesis dependency function (-)
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 5</code>, growth and TK/TD
</p>

<ul>
<li> <p><code>C_int_unb</code>, unbound internal concentration (mass per volume)
</p>
</li>
<li> <p><code>C_ext</code>, external concentration (mass per volume)
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 7</code>, environmental factors
</p>

<ul>
<li> <p><code>dBM</code>, biomass derivative (g dw m-2 d-1)
</p>
</li>
<li> <p><code>dM_int</code>, mass of toxicant in plants derivative (mass per m2 d-1)
</p>
</li></ul>

</li></ul>



<h3>Effects</h3>

<p>Supported effect endpoints include <em>BM</em> (biomass) and <em>r</em> (average
growth rate during simulation). The effect on biomass is calculated from
the last state of a simulation. Be aware that endpoint <em>r</em> is incompatible
with biomass transfers.
</p>


<h3>Biomass transfer</h3>

<p>Models supporting biomass transfer can be instructed to move a fixed amount
of biomass to a new medium after a period of time. This feature replicates
a procedure occurring in e.g. Lemna effect studies and may be necessary to
recreate study results.
</p>
<p>The biomass transfer feature assumes that always a fixed amount of
biomass is transferred. Transfers can occur at any fixed point in time or
in regular intervals. During a transfer, the biomass is reset to the
transferred amount and additional compartments can be scaled 1:1 accordingly,
to e.g. reflect the change in internal toxicant mass when biomass is modified.
Transfer settings can be modified using <code><a href="#topic+set_transfer">set_transfer()</a></code>.
</p>
<p>Any transfer time point must also be an output time point. If a transfer
occurs, simulation results of that time point will report the model state
<strong>before</strong> the transfer. Be aware that in order to use transfers at regular
intervals, the simulation must start at time point zero.
</p>


<h3>References</h3>

<p>Klein J., Cedergreen N., Heine S., Reichenberger S., Rendal C.,
Schmitt W., Hommen U., 2021: <em>Refined description of the Lemna TKTD growth model
based on Schmitt et al. (2013) - equation system and default parameters</em>.
Report of the working group <em>Lemna</em> of the SETAC Europe Interest Group Effect
Modeling. Version 1, uploaded on 22. Sept. 2021.
https://www.setac.org/group/effect-modeling.html
</p>


<h3>See Also</h3>

<p><a href="#topic+Macrophyte-models">Macrophyte-models</a>, <a href="#topic+Transferable">Transferable</a>, <a href="#topic+Scenarios">Scenarios</a>
</p>
<p>Other Myriophyllum models: 
<code><a href="#topic+Myrio_log">Myrio_log</a>()</code>,
<code><a href="#topic+Myriophyllum-models">Myriophyllum-models</a></code>
</p>
<p>Other macrophyte models: 
<code><a href="#topic+Lemna_SETAC">Lemna_SETAC</a>()</code>,
<code><a href="#topic+Lemna_Schmitt">Lemna_Schmitt</a>()</code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Myrio_log">Myrio_log</a>()</code>
</p>

<hr>
<h2 id='Myrio_log'>Myriophyllum model with logistic growth</h2><span id='topic+Myrio_log'></span><span id='topic+MyrioLogScenario-class'></span>

<h3>Description</h3>

<p>The <em>Myriophyllum</em> model is derived from the <em>Lemna</em> TKTD model
by Klein <em>et al.</em> (2021).
<code>Myrio_log()</code> modifies the <code><a href="#topic+Myrio">Myrio()</a></code> model to feature logistic growth, i.e.
control growth is described by the differential equation
<code style="white-space: pre;">&#8288;d BM/dt = k_photo_max*BM*(1 - BM/BM_L)&#8288;</code> where <code>BM_L</code> is the carrying capacity.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Myrio_log()
</code></pre>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+MyrioLogScenario-class">MyrioLogScenario</a>
</p>


<h3>Model parameters</h3>


<ul>
<li><p> Growth model
</p>

<ul>
<li> <p><code>k_photo_max</code>, Maximum photosynthesis rate (d-1), default: <code>0.47</code>
</p>
</li>
<li> <p><code>BM_L</code>, Carrying capacity (g dw m-2)
</p>
</li></ul>

</li>
<li><p> Concentration response (Toxicodynamics)
</p>

<ul>
<li> <p><code>EC50_int</code>, Internal concentration resulting in 50% effect (ug L-1)
</p>
</li>
<li> <p><code>E_max</code>, Maximum inhibition (-), default: <code>1</code>
</p>
</li>
<li> <p><code>b</code>, Slope parameter (-)
</p>
</li></ul>

</li>
<li><p> Internal concentration (Toxicokinetics)
</p>

<ul>
<li> <p><code>P</code>, Permeability (cm d-1)
</p>
</li>
<li> <p><code>r_A_DW</code>, Area per dry-weight ratio (cm2 g-1), default: <code>1000</code>
</p>
</li>
<li> <p><code>r_FW_DW</code>, Fresh weight per dry weight ratio (-), default: <code>16.7</code>
</p>
</li>
<li> <p><code>r_FW_V</code>, Fresh weight density (g cm-3), default: <code>1</code>
</p>
</li>
<li> <p><code>r_DW_TSL</code>, Dry weight per total shoot length ratio  (?)
</p>
</li>
<li> <p><code>K_pw</code>, Partitioning coefficient plant:water (-), default: <code>1</code>
</p>
</li>
<li> <p><code>k_met</code>, Metabolisation rate (d-1), default: <code>0</code>
</p>
</li></ul>

</li></ul>



<h3>State variables</h3>

<p>The model has two state variables:
</p>

<ul>
<li> <p><code>BM</code>, Biomass (g dw m-2)
</p>
</li>
<li> <p><code>M_int</code>, Mass of toxicant in plant population (mass per m2, e.g. ug m-2)
</p>
</li></ul>



<h3>Environmental factors</h3>

<p>None.
</p>


<h3>Simulation output</h3>

<p>Simulation results will contain two additional columns besides state variables:
</p>

<ul>
<li> <p><code>C_int</code>, internal concentration of toxicant (mass per volume)
</p>
</li>
<li> <p><code>TSL</code>, total shoot length (?)
</p>
</li></ul>

<p>The available output levels are as follows:
</p>

<ul>
<li> <p><code>nout &gt;= 1</code>
</p>

<ul>
<li> <p><code>C_int</code>, internal concentration (mass per volume)
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 2</code>
</p>

<ul>
<li> <p><code>TSL</code>, total shoot length (?)
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 3</code>
</p>

<ul>
<li> <p><code>f_photo</code>, photosynthesis dependency function (-)
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 5</code>, growth and TK/TD
</p>

<ul>
<li> <p><code>C_int_unb</code>, unbound internal concentration (mass per volume)
</p>
</li>
<li> <p><code>C_ext</code>, external concentration (mass per volume)
</p>
</li></ul>

</li>
<li> <p><code>nout &gt;= 7</code>, environmental factors
</p>

<ul>
<li> <p><code>dBM</code>, biomass derivative (g dw m-2 d-1)
</p>
</li>
<li> <p><code>dM_int</code>, mass of toxicant in plants derivative (mass per m2 d-1)
</p>
</li></ul>

</li></ul>



<h3>Effects</h3>

<p>Supported effect endpoints include <em>BM</em> (biomass) and <em>r</em> (average
growth rate during simulation). The effect on biomass is calculated from
the last state of a simulation. Be aware that endpoint <em>r</em> is incompatible
with biomass transfers.
</p>


<h3>Biomass transfer</h3>

<p>Models supporting biomass transfer can be instructed to move a fixed amount
of biomass to a new medium after a period of time. This feature replicates
a procedure occurring in e.g. Lemna effect studies and may be necessary to
recreate study results.
</p>
<p>The biomass transfer feature assumes that always a fixed amount of
biomass is transferred. Transfers can occur at any fixed point in time or
in regular intervals. During a transfer, the biomass is reset to the
transferred amount and additional compartments can be scaled 1:1 accordingly,
to e.g. reflect the change in internal toxicant mass when biomass is modified.
Transfer settings can be modified using <code><a href="#topic+set_transfer">set_transfer()</a></code>.
</p>
<p>Any transfer time point must also be an output time point. If a transfer
occurs, simulation results of that time point will report the model state
<strong>before</strong> the transfer. Be aware that in order to use transfers at regular
intervals, the simulation must start at time point zero.
</p>


<h3>References</h3>

<p>Klein J., Cedergreen N., Heine S., Reichenberger S., Rendal C.,
Schmitt W., Hommen U., 2021: <em>Refined description of the Lemna TKTD growth model
based on Schmitt et al. (2013) - equation system and default parameters</em>.
Report of the working group <em>Lemna</em> of the SETAC Europe Interest Group Effect
Modeling. Version 1, uploaded on 22. Sept. 2021.
https://www.setac.org/group/effect-modeling.html
</p>


<h3>See Also</h3>

<p><a href="#topic+Transferable">Transferable</a>, <a href="#topic+Scenarios">Scenarios</a>
</p>
<p>Other Myriophyllum models: 
<code><a href="#topic+Myrio">Myrio</a>()</code>,
<code><a href="#topic+Myriophyllum-models">Myriophyllum-models</a></code>
</p>
<p>Other macrophyte models: 
<code><a href="#topic+Lemna_SETAC">Lemna_SETAC</a>()</code>,
<code><a href="#topic+Lemna_Schmitt">Lemna_Schmitt</a>()</code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Myrio">Myrio</a>()</code>
</p>

<hr>
<h2 id='Myriophyllum-models'>Myriophyllum models</h2><span id='topic+Myriophyllum-models'></span><span id='topic+Myriophyllum-class'></span>

<h3>Description</h3>

<p>Supported models:
</p>

<ul>
<li> <p><code><a href="#topic+Myrio">Myrio()</a></code>, with exponential growth
</p>
</li>
<li> <p><code><a href="#topic+Myrio_log">Myrio_log()</a></code>, with logistic growth
</p>
</li></ul>



<h3>See Also</h3>

<p><a href="#topic+Lemna-models">Lemna-models</a>, <a href="#topic+Transferable">Transferable</a>
</p>
<p>Other Myriophyllum models: 
<code><a href="#topic+Myrio">Myrio</a>()</code>,
<code><a href="#topic+Myrio_log">Myrio_log</a>()</code>
</p>
<p>Other scenarios: 
<code><a href="#topic+Algae-models">Algae-models</a></code>,
<code><a href="#topic+DEB-models">DEB-models</a></code>,
<code><a href="#topic+GUTS-RED-models">GUTS-RED-models</a></code>,
<code><a href="#topic+Lemna-models">Lemna-models</a></code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Scenarios">Scenarios</a></code>,
<code><a href="#topic+Transferable">Transferable</a></code>
</p>

<hr>
<h2 id='no_exposure'>Zero exposure</h2><span id='topic+no_exposure'></span>

<h3>Description</h3>

<p>Creates an <a href="#topic+ExposureSeries">ExposureSeries</a> with zero concentration. When setting
the zero exposure, pay attention not to accidentally reset the output times
of your scenario as the zero exposure series contains only a single time point.
See the examples.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>no_exposure()
</code></pre>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+ExposureSeries-class">ExposureSeries</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+set_noexposure">set_noexposure()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># this will reset the output times of the sample scenario,
# simulate() will quit with an error
try(
  minnow_it %&gt;%
    set_exposure(no_exposure()) %&gt;%
    simulate()
)

# set zero exposure, but keep original output times
minnow_it %&gt;%
  set_exposure(no_exposure(), reset_times=FALSE) %&gt;%
  simulate()
</code></pre>

<hr>
<h2 id='parameter_set'>Set of model parameters</h2><span id='topic+parameter_set'></span><span id='topic+parameter_set-class'></span>

<h3>Description</h3>

<p>Set of model parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>parameter_set(model, param = list(), tag = NA_character_)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="parameter_set_+3A_model">model</code></td>
<td>
<p><code>character</code>, a string containing a model name, e.g. <code>"GUTS-RED-IT"</code></p>
</td></tr>
<tr><td><code id="parameter_set_+3A_param">param</code></td>
<td>
<p>named <code>list</code> of model parameters</p>
</td></tr>
<tr><td><code id="parameter_set_+3A_tag">tag</code></td>
<td>
<p><code>character</code>, an optional identifier</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an S4 object of type <a href="#topic+parameter_set-class">parameter_set</a>
</p>


<h3>Slots</h3>


<dl>
<dt><code>model</code></dt><dd><p><code>character</code>, a string containing a model name, e.g. <code>"GUTS-RED-IT"</code></p>
</dd>
<dt><code>tag</code></dt><dd><p><code>character</code>, an optional identifier</p>
</dd>
<dt><code>param</code></dt><dd><p>named <code>list</code> of model parameters</p>
</dd>
</dl>


<h3>Examples</h3>

<pre><code class='language-R'># create a parameter set and assign it
ps &lt;- parameter_set("GUTS-RED-IT", list(kd=0.12, hb=0.3))
GUTS_RED_IT() %&gt;% set_param(ps)

# multiple scenarios can be modified at once
c(GUTS_RED_IT(), GUTS_RED_IT()) %&gt;%
  set_param(ps)

# model names must match, otherwise an error will be raised
try(GUTS_RED_SD() %&gt;% set_param(ps))
</code></pre>

<hr>
<h2 id='pll_debug'>Disable parallelization for debugging</h2><span id='topic+pll_debug'></span>

<h3>Description</h3>

<p>In certain cases it might be beneficial to disable parallel execution
of e.g. effect profile calculations. By disabling, all processes run
sequentially and instantly pass messages to the console which would be
delayed during parallel processing. This makes it easier to pinpoint
problems within the data or algorithm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pll_debug(state = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pll_debug_+3A_state">state</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code> then parallelization is disabled</p>
</td></tr>
</table>


<h3>Value</h3>

<p>no return value
</p>

<hr>
<h2 id='plot_epx'>Plot EPx values</h2><span id='topic+plot_epx'></span>

<h3>Description</h3>

<p>Plot EPx values
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_epx(
  EPx_ts,
  exposure_ts,
  draw = TRUE,
  time_col = "time",
  conc_col = "conc"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_epx_+3A_epx_ts">EPx_ts</code></td>
<td>
<p>the result of <code>epx_mtw</code>, ie. a tibble with window.start,
window.end, endpoint, level and EPx</p>
</td></tr>
<tr><td><code id="plot_epx_+3A_exposure_ts">exposure_ts</code></td>
<td>
<p>an exposure time series with columns for time 't' and
concentration 'conc'</p>
</td></tr>
<tr><td><code id="plot_epx_+3A_draw">draw</code></td>
<td>
<p>Should the whole plot be drawn? If FALSE the exposure plot and
the EPx plot are returned as a list for later modification</p>
</td></tr>
<tr><td><code id="plot_epx_+3A_time_col">time_col</code></td>
<td>
<p>the name of the time column in the exposure dataset</p>
</td></tr>
<tr><td><code id="plot_epx_+3A_conc_col">conc_col</code></td>
<td>
<p>the name of the concentration column in the exposure dataset</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a grid of ggplots
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ti &lt;- 0:21
expo &lt;- abs(0.01*ti + rnorm(length(ti), 0, 0.05))
exposure &lt;- data.frame(time = ti, conc = expo)
metsulfuron_epx_mtw &lt;- metsulfuron %&gt;%
set_exposure(exposure) %&gt;%
epx_mtw(level = 10, factor_cutoff = 1000)
metsulfuron_epx_mtw
plot_epx(EPx_ts = metsulfuron_epx_mtw,
exposure_ts = exposure)
</code></pre>

<hr>
<h2 id='plot_ppc'>Creates a PPC plot for a single dataset</h2><span id='topic+plot_ppc'></span>

<h3>Description</h3>

<p>A sample of parameters representing the uncertainty within the dataset
is passed to the function. All parameter combinations and exposure patterns
are simulated and the range of predicted frond numbers is derived for a
single study. The uncertainty is displayed by a Posterior Predicitve Plot
(PPC).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_ppc(
  rs_mean,
  rs_range,
  obs_mean = NULL,
  obs_full = NULL,
  xy_lim = NULL,
  study = NULL,
  outfile = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_ppc_+3A_rs_mean">rs_mean</code></td>
<td>
<p><code>data.frame</code>, model results best fit params</p>
</td></tr>
<tr><td><code id="plot_ppc_+3A_rs_range">rs_range</code></td>
<td>
<p><code>data.frame</code>, predictions (min, max from param.sample run)</p>
</td></tr>
<tr><td><code id="plot_ppc_+3A_obs_mean">obs_mean</code></td>
<td>
<p><code>data.frame</code>, observations with means per treatment level</p>
</td></tr>
<tr><td><code id="plot_ppc_+3A_obs_full">obs_full</code></td>
<td>
<p><code>data.frame</code>, full data set including results for replicates</p>
</td></tr>
<tr><td><code id="plot_ppc_+3A_xy_lim">xy_lim</code></td>
<td>
<p>optional <code>numeric</code>, limits of x and y axis for plotting</p>
</td></tr>
<tr><td><code id="plot_ppc_+3A_study">study</code></td>
<td>
<p>optional <code>string</code>, name of study which can be used as key</p>
</td></tr>
<tr><td><code id="plot_ppc_+3A_outfile">outfile</code></td>
<td>
<p>optional <code>string</code>, file path is given = save graph</p>
</td></tr>
<tr><td><code id="plot_ppc_+3A_...">...</code></td>
<td>
<p>any additional parameters</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>data.frame</code> with fitted and observed frond numbers
</p>

<hr>
<h2 id='plot_ppc_combi'>Create PPC plot for one or more datasets</h2><span id='topic+plot_ppc_combi'></span>

<h3>Description</h3>

<p>The function expects a data.frame with four mandatory and one optional
column. The mandatory columns are as follows:
</p>

<ul>
<li> <p><code>pred</code>: mean of predictions e.g. frond number for lemna
</p>
</li>
<li> <p><code>max</code>: maximum of predictions
</p>
</li>
<li> <p><code>min</code>: minimum of predictions
</p>
</li>
<li> <p><code>obs</code>: observations
The optional column is to be named <code>study</code> and contains a study identifier.
If more than one study identifier is present in the table, individual
studies will be plotted in different colors and a legend will be displayed.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>plot_ppc_combi(table, xy_lim = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_ppc_combi_+3A_table">table</code></td>
<td>
<p><code>data.frame</code> containing return values of calls to <code>plot_ppc()</code></p>
</td></tr>
<tr><td><code id="plot_ppc_combi_+3A_xy_lim">xy_lim</code></td>
<td>
<p>optional <code>numeric</code>, limits of x and y axis for plotting</p>
</td></tr>
</table>

<hr>
<h2 id='plot_sd'>Creates plot of model results (uncertainties optional)</h2><span id='topic+plot_sd'></span>

<h3>Description</h3>

<p>All parameter combinations and exposure patterns are simulated and the mean
of predicted frond numbers is derived for a single study. The uncertainty is
passed to the function due to computation time. Results are displayed by
plotting the time series including the uncertainty interval. Observation data
can be optionally displayed. Data should be provided in long format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_sd(
  model_base,
  treatments,
  rs_mean,
  rs_range = NULL,
  obs_mean = NULL,
  obs_full = NULL,
  x_breaks = NULL,
  y_lim = NULL,
  grid_labels = NULL,
  grid_ncol = 2,
  plot_col = 2,
  y_title = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_sd_+3A_model_base">model_base</code></td>
<td>
<p>effect scenario object with mean parameters</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_treatments">treatments</code></td>
<td>
<p>treatments exposure levels as data frame</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_rs_mean">rs_mean</code></td>
<td>
<p><code>data.frame</code>, model results best fit params</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_rs_range">rs_range</code></td>
<td>
<p><code>data.frame</code>, uncertainties as data frame</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_obs_mean">obs_mean</code></td>
<td>
<p><code>data.frame</code>, observation data with means per treatment level</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_obs_full">obs_full</code></td>
<td>
<p><code>data.frame</code>, full set including results for replicates</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_x_breaks">x_breaks</code></td>
<td>
<p>optional vector of breaks of x-axis</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_y_lim">y_lim</code></td>
<td>
<p>optional vector containing limits of y-axis</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_grid_labels">grid_labels</code></td>
<td>
<p>optional labels of grid headers</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_grid_ncol">grid_ncol</code></td>
<td>
<p>optional number of grid columns</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_plot_col">plot_col</code></td>
<td>
<p>output column which should be plotted</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_y_title">y_title</code></td>
<td>
<p>optional title of y-axis</p>
</td></tr>
<tr><td><code id="plot_sd_+3A_...">...</code></td>
<td>
<p>any additional parameters</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a ggplot2 plot object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(124)
exposure &lt;- data.frame(
  time = 0:21,
  conc = rnorm(n=22, mean=0.1, sd=0.06),
  trial = "T1")
forcings &lt;- list(temp=12, rad=15000)
param &lt;- list(EC50=0.3, b=4.16, P_up=0.0054)
inits &lt;- list(BM=0.0012, E=1, M_int=0)

scenario &lt;- Lemna_Schmitt() %&gt;%
  set_forcings(forcings) %&gt;%
  set_param(param) %&gt;%
  set_init(inits)

sim_result &lt;- simulate_batch(model_base = scenario,
                             treatments = exposure,
                             param_sample = NULL)

plot_sd(model_base = scenario,
        treatments = exposure,
        rs_mean = sim_result)
</code></pre>

<hr>
<h2 id='pull_metadata'>Pull metadata from scenarios</h2><span id='topic+pull_metadata'></span>

<h3>Description</h3>

<p>The method pulls available metadata from scenario objects and returns a
table with additional columns. If the argument already was a <code>data.frame</code>
object, the columns are appended. May overwrite existing columns of the
same name.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pull_metadata(x, model = TRUE, exposure = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pull_metadata_+3A_x">x</code></td>
<td>
<p>vector of <a href="#topic+scenarios">scenarios</a> or a <code>data.frame</code> containing a column
<code>scenario</code> with <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="pull_metadata_+3A_model">model</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code> then model metadata is pulled</p>
</td></tr>
<tr><td><code id="pull_metadata_+3A_exposure">exposure</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code> then exposure series metadata is pulled</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>data.frame</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>metsulfuron %&gt;%
  pull_metadata()
</code></pre>

<hr>
<h2 id='Rsubcapitata'>An algae scenario</h2><span id='topic+Rsubcapitata'></span>

<h3>Description</h3>

<p>Data are from Weber 2012 publication.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Rsubcapitata
</code></pre>


<h3>Format</h3>

<p>An object of class <code>AlgaeTKTDScenario</code> of length 1.
</p>


<h3>References</h3>

<p>Weber D, Schaeffer D, Dorgerloh M, Bruns E, Goerlitz G, Hammel K, Preuss TG
and Ratte HT, 2012. Combination of a higher-tier flow-through system and
population modeling to assess the effects of time-variable exposure of
isoproturon on the green algae Desmodesmus subspictatus and
Pseudokirchneriella subcapitata. Environmental Toxicology and
Chemistry, 31, 899-908. <a href="https://doi.org/10.1002/etc.1765">doi:10.1002/etc.1765</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Algae_TKTD">Algae_TKTD</a>
</p>

<hr>
<h2 id='Scenarios'>Effect scenario classes</h2><span id='topic+Scenarios'></span><span id='topic+scenario'></span><span id='topic+scenarios'></span><span id='topic+EffectScenario-class'></span>

<h3>Description</h3>

<p>The <code>EffectScenario</code> class is the base for all of the basic scenario
types and models. It contains slots for data and settings that are
required by most models such as a vector of model parameters and a vector
of initial states. For each particular model, the class's slots are
filled with certain default or fixed values. Some models derive from this
class and add slots to store additional data.
</p>


<h3>Details</h3>

<p>Certain behaviors that are required to model complex processes cannot be
represented by a single EffectScenario. As an example, the parameters of a scenario
are generally fixed during the simulated time period. In order to represent a
change in parameter values, the original scenario would
need to split into two scenarios <em>A</em> and <em>B</em> which differ by parameter values
and simulated time period. By combining these scenarios to a <em>scenario sequence</em>,
the sequence would be treated as a single, complex scenario. See
<code><a href="#topic+sequence">sequence()</a></code> for more information.
</p>


<h4>Parameters</h4>

<p>Most parameters are represented by numerical types but other types
are possible depending on model. Please refer to the model description
which parameters are required and in which unit. Some or all parameters may
be required to start a simulation. If required parameters are missing,
simulation will fail with an error message.
</p>



<h4>Initial state</h4>

<p>The <em>initial state</em> represents the starting values of state variables when
starting a simulation. A scenario's default initial state may be insufficient
to get sensible results. It is advisable to set an initial state explicitly
when creating a new scenario, see <code><a href="#topic+set_init">set_init()</a></code>.
</p>
<p>In theory, a scenario's state variables can be renamed by modifying the names
of the initial state vector. However, this is strongly
discouraged as this will affect other routines such as <code><a href="#topic+effect">effect()</a></code> and <code><a href="#topic+epx">epx()</a></code>
and may render results useless.
</p>



<h4>Exposure</h4>

<p><em>Exposure</em> refers to the concentration of toxicant an organism is exposed to.
In case of aquatic organisms, this would commonly be the concentration of a
toxicant in water. Other interpretations are possible depending on model
assumptions.
</p>
<p>Exposure time-series are generally represented by a <code>data.frame</code> containing two
columns. The first column representing time, the second representing the
exposure level. The ordering of columns is mandatory. The column names
are essentially irrelevant but sensible names may help documenting the
scenario and its data. The rows must be ordered chronologically. A time-series
can consist of only a single row; in this case it will represent constant
exposure. Exposure time-series are set to a scenario using <code><a href="#topic+set_exposure">set_exposure()</a></code>.
</p>
<p>Handling time-series is a costly task for the ODE solver due to consistency
checks and interpolation between time steps. How the solver interpolates
the time-series can be controlled by certain arguments to functions
such as <code><a href="#topic+simulate">simulate()</a></code> and <code><a href="#topic+effect">effect()</a></code>. Please refer to <code><a href="#topic+simulate">simulate()</a></code> for a brief
overview and <a href="deSolve.html#topic+forcings">deSolve::forcings</a> for a detailed description.
</p>
<p>Exposure time-series should be kept as short as possible and as complex as
needed for optimal computational efficiency.
</p>



<h4>Environmental forcings</h4>

<p><em>Forcings</em> generally refer to model parameters that change over time as part
of an external function such as environmental temperature and exposure levels.
Due to the importance of exposure in regulatory assessments, this R package
explicitly distinguishes between environmental forcings and exposure. However,
the same restrictions and features apply to both of them.
</p>
<p>Forcing time-series are handled the same way as exposure time-series, i.e.
they are represented by a <code>data.frame</code> containing two columns. The first column
representing time, the second representing the parameter that is a function of
time. The ordering of columns is mandatory. The rows must be ordered
chronologically. Forcings time-series are set using <code><a href="#topic+set_forcings">set_forcings()</a></code>.
Please refer to the <em>Exposure</em> section for more information on how time-series
are handled.
</p>



<h4>Output times</h4>

<p>A scenario's simulated time period is defined by its minimum and maximum output
time. Simulation results will only be returned for the defined output times
even though the ODE solver may use smaller time steps between output times.
Output times can be explicitly set using <code><a href="#topic+set_times">set_times()</a></code>. The number and
distance of output times may have influence on the precision of simulation
results and numerical stability, cf. <code><a href="#topic+simulate">simulate()</a></code>.
</p>
<p>Be aware that <code><a href="#topic+set_exposure">set_exposure()</a></code> will overwrite previously defined output times
if not requested otherwise.
</p>



<h4>Effects</h4>

<p>Generally, all state variables can be used as effect endpoints but models may
provide additional endpoints. Use <code><a href="#topic+set_endpoints">set_endpoints()</a></code> to enable or disable
endpoints for a scenario.
</p>
<p>Some scenarios or models require control runs to calculate effects under
exposure. Generally, control simulations will run automatically
where needed. However, when conducting a large number of repeated simulations, e.g.
when calculating effect profiles (EPx values) or simulating moving exposure
windows, it may be computational efficient to run control simulations only
once and cache their results within the scenario. Please refer to <code><a href="#topic+cache_controls">cache_controls()</a></code>
for details.
</p>



<h4>Moving exposure windows</h4>

<p>The time frame relevant for effects may be much shorter than the assessed
exposure time-series for certain organisms. This fact can be represented
by moving exposure windows which divide a long time period in a number of
consecutive windows of the same length. Each window is simulated individually and effects are
calculated. By default, methods such as <code><a href="#topic+effect">effect()</a></code> will only return the
maximum effect of all considered windows but detailed results can be presented
on demand.
</p>
<p>To use moving exposure windows, the exposure time-series must be regular,
i.e. must have an equidistant step length in time. The length of the window
is defined as the number of time steps of the exposure time-series. As an
example, assume the time-series has daily granularity and a moving window
of seven days length is required. In this case, the moving window must have
a length of seven (7) time steps. If the exposure time-series had hourly granularity,
the same window would need to have a length of 168 (=7*24) time steps. Please
refer to <code><a href="#topic+set_window">set_window()</a></code> for details.
</p>



<h3>Slots</h3>


<dl>
<dt><code>name</code></dt><dd><p><code>character</code>, unique model name</p>
</dd>
<dt><code>tag</code></dt><dd><p><code>character</code>, an optional identifier</p>
</dd>
<dt><code>param</code></dt><dd><p><code>list</code> of parameter key-value pairs</p>
</dd>
<dt><code>param.req</code></dt><dd><p><code>character</code> vector of required parameters</p>
</dd>
<dt><code>forcings</code></dt><dd><p><code>list</code> of <code>data.frame</code>s representing forcing time-series</p>
</dd>
<dt><code>forcings.req</code></dt><dd><p><code>character</code> vector or required model forcings data, e.g. temperature</p>
</dd>
<dt><code>init</code></dt><dd><p><code>list</code> of initial model states</p>
</dd>
<dt><code>times</code></dt><dd><p><code>numeric</code> vector of output times, beginning and end also define
the simulated period</p>
</dd>
<dt><code>endpoints</code></dt><dd><p><code>character</code> vector of endpoints to calculate results for</p>
</dd>
<dt><code>exposure</code></dt><dd><p><code>data.frame</code> with two columns representing an exposure time-series</p>
</dd>
<dt><code>control</code></dt><dd><p><code>list</code> of named numerical vectors, contains the control values
for all relevant moving windows</p>
</dd>
<dt><code>control.req</code></dt><dd><p><code>logical</code>, if <code>TRUE</code> then control values are required to
calculate effects</p>
</dd>
<dt><code>window.length</code></dt><dd><p><code>numeric</code>, maximum length of the simulated period, if
<code>window.length</code> is shorter than the exposure pattern, then all possible
exposure sub-patterns are evaluated for effect calculation. This is also
referred to as a moving window approach.</p>
</dd>
<dt><code>window.interval</code></dt><dd><p><code>numeric</code>, interval determining distance between moving
windows during effect calculation. First window starts at first time point
in exposure pattern.</p>
</dd>
</dl>


<h3>See Also</h3>

<p>Other scenarios: 
<code><a href="#topic+Algae-models">Algae-models</a></code>,
<code><a href="#topic+DEB-models">DEB-models</a></code>,
<code><a href="#topic+GUTS-RED-models">GUTS-RED-models</a></code>,
<code><a href="#topic+Lemna-models">Lemna-models</a></code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Myriophyllum-models">Myriophyllum-models</a></code>,
<code><a href="#topic+Transferable">Transferable</a></code>
</p>

<hr>
<h2 id='Schmitt2013'>A Lemna data set with multiple treatment levels</h2><span id='topic+Schmitt2013'></span>

<h3>Description</h3>

<p>Data are from Schmitt 2013 publication.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Schmitt2013
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 56 rows and 4 columns.
</p>


<h3>References</h3>

<p>Schmitt W., Bruns E., Dollinger M., and Sowig P., 2013: <em>Mechanistic TK/TD-model
simulating the effect of growth inhibitors on Lemna populations</em>. Ecol Model 255,
pp. 1-10. <a href="https://doi.org/10.1016/j.ecolmodel.2013.01.017">doi:10.1016/j.ecolmodel.2013.01.017</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+Lemna-models">Lemna-models</a>
</p>

<hr>
<h2 id='sequence'>Sequence of scenarios</h2><span id='topic+sequence'></span><span id='topic+ScenarioSequence-class'></span>

<h3>Description</h3>

<p>A sequence of scenarios is treated as a single scenario and each scenario
is simulated one after the other. If scenario <code>n</code> in a sequence was simulated,
scenario <code>n+1</code> will start off in the model state where <code>n</code> had ended.
Scenario sequences can be used to e.g. implement changes in model parameters
over time.
</p>


<h3>Details</h3>



<h4>Requirements</h4>

<p>All scenarios in a sequence must fulfill the following requirements:
</p>

<ul>
<li><p> All scenarios must have identical state variables
</p>
</li>
<li><p> The <em>output times</em> of all scenarios must represent a continuous time series
without gaps or overlaps
</p>
</li></ul>




<h4>Limitations</h4>

<p>Only simulation of sequences are supported, at the moment.
Effects and effect profiles (EPx values) cannot be derived, yet.
</p>



<h3>Value</h3>

<p>an S4 object of type <a href="#topic+ScenarioSequence-class">ScenarioSequence</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># create two scenarios that need to be simulated one after the other
scen1 &lt;- minnow_it %&gt;% set_times(0:3)
scen2 &lt;- minnow_it %&gt;% set_times(3:6) %&gt;% set_param(c(kd=0))

# create a sequence and assign scenarios
sq &lt;- sequence(list(scen1, scen2))

# simulate the sequence

simulate(sq)

</code></pre>

<hr>
<h2 id='set_endpoints'>Set effect endpoints</h2><span id='topic+set_endpoints'></span>

<h3>Description</h3>

<p>Effect endpoints calculated by functions such as <code><a href="#topic+effect">effect()</a></code> and <code><a href="#topic+epx">epx()</a></code>
can be enabled and disabled. If an endpoint is not required for an assessment,
it should be disabled for reasons of computational efficiency. Please refer
to the model description for a list of available endpoints.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_endpoints(x, endpoints)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_endpoints_+3A_x">x</code></td>
<td>
<p>vector of <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="set_endpoints_+3A_endpoints">endpoints</code></td>
<td>
<p><code>character</code> vector of endpoint names</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Modified <code>EffectScenario</code> objects
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Only enable reproduction (R) endpoint for americamysis scenario
americamysis %&gt;%
  set_endpoints("R") %&gt;%
  effect()

# Enable endpoints length (L) and reproduction (R)
americamysis %&gt;%
  set_endpoints(c("L","R")) %&gt;%
  effect()
</code></pre>

<hr>
<h2 id='set_exposure'>Set exposure time-series</h2><span id='topic+set_exposure'></span><span id='topic+set_exposure+2CANY+2CANY-method'></span><span id='topic+set_exposure+2CEffectScenario+2Cdata.frame-method'></span><span id='topic+set_exposure+2CEffectScenario+2CExposureSeries-method'></span><span id='topic+set_exposure+2CEffectScenario+2Clist-method'></span><span id='topic+set_exposure+2Clist+2Clist-method'></span><span id='topic+set_exposure+2Clist+2CANY-method'></span>

<h3>Description</h3>

<p><em>Exposure</em> refers to the toxicant concentration an organism is exposed to.
In case of aquatic organisms, this would commonly be the concentration of a
toxicant in water. Other interpretations are possible depending on model
assumptions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_exposure(scenarios, series, ...)

## S4 method for signature 'ANY,ANY'
set_exposure(scenarios, series)

## S4 method for signature 'EffectScenario,data.frame'
set_exposure(scenarios, series, ...)

## S4 method for signature 'EffectScenario,ExposureSeries'
set_exposure(scenarios, series, reset_times = TRUE)

## S4 method for signature 'EffectScenario,list'
set_exposure(scenarios, series, ...)

## S4 method for signature 'list,list'
set_exposure(scenarios, series, ...)

## S4 method for signature 'list,ANY'
set_exposure(scenarios, series, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_exposure_+3A_scenarios">scenarios</code></td>
<td>
<p><code>vector</code> of <a href="#topic+scenarios">scenarios</a></p>
</td></tr>
<tr><td><code id="set_exposure_+3A_series">series</code></td>
<td>
<p><code>vector</code> of  <a href="#topic+ExposureSeries">ExposureSeries</a> objects or a single <code>data.frame</code></p>
</td></tr>
<tr><td><code id="set_exposure_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
<tr><td><code id="set_exposure_+3A_reset_times">reset_times</code></td>
<td>
<p><code>logical</code>, if <code>TRUE</code>, the exposure time-series' time points
will be set as output times. Defaults to <code>TRUE</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Exposure time-series are generally represented by a <code>data.frame</code> containing two
columns. The first column for time, the second representing the
exposure level. The ordering of columns is mandatory. The column names
are non-relevant but sensible names may help documenting the
scenario and its data. The <code>data.frame</code>'s rows must be ordered chronologically.
A time-series can consist of only a single row; in this case it will represent constant
exposure.
</p>
<p>For convenience, a time-series with zero exposure can be set using
<code><a href="#topic+set_noexposure">set_noexposure()</a></code>.
</p>


<h4>Computational efficiency</h4>

<p>Handling time-series is a costly task for the ODE solver due to consistency
checks and interpolation between time steps. How the solver interpolates
the time-series can be controlled by optional arguments to functions
such as <code><a href="#topic+simulate">simulate()</a></code> and <code><a href="#topic+effect">effect()</a></code>. Please refer to <code><a href="#topic+simulate">simulate()</a></code> for a brief
overview and <a href="deSolve.html#topic+forcings">deSolve::forcings</a> for a detailed description.
</p>
<p>Exposure time-series should be kept as short as possible and as complex as
needed for optimal computational efficiency.
</p>



<h4>Output times</h4>

<p>By default, the exposure time-series' time points will also be used as output
times of the scenario. Any output times previously set by <code><a href="#topic+set_times">set_times()</a></code> will
be lost. If this behavior is undesired, set the function argument
<code>reset_times=FALSE</code>.
</p>



<h4>Multiple exposure series and scenarios</h4>

<p>The functions supports modifying multiple scenarios at once: by
calling it with lists of <a href="#topic+scenario">scenario</a> and <a href="#topic+ExposureSeries">ExposureSeries</a>
objects. The cartesian product of all scenarios and exposure series will
be returned, iff the parameter <code>expand = TRUE</code> is set.
</p>
<p>As an example for the <em>expand</em> mode, two scenarios <code>A</code> and <code>B</code> and one
exposure series <code>g</code> will result in two scenarios <code>Ag</code> and <code>Bg</code>, both
using exposure series <code>g</code>. Two scenarios <code>A</code> and <code>B</code> as well as two
exposure seres <code>g</code> and <code>h</code> will result in four scenarios <code>Ag</code>,<code>Ah</code>,<code>Bg</code>,
and <code>Bh</code>.
</p>



<h3>Value</h3>

<p><code>list</code> of <code>EffectScenario</code> objects
</p>


<h3>Examples</h3>

<pre><code class='language-R'># set a data.frame as exposure series
Lemna_Schmitt() %&gt;% set_exposure(data.frame(time=c(0, 1, 2, 3), conc=c(1, 1, 0, 0)))

# set one ExposureSeries
es1 &lt;- ExposureSeries(data.frame(time=0, conc=0))
Lemna_Schmitt() %&gt;% set_exposure(es1)

# set two ExposureSeries to create two scenarios
es2 &lt;- ExposureSeries(data.frame(time=5:10, conc=1))
Lemna_Schmitt() %&gt;% set_exposure(c(es1, es2))

# set one ExposureSeries without resetting existing output times
Lemna_Schmitt() %&gt;%
  set_times(0:5) %&gt;%
  set_exposure(es1, reset_times=FALSE)
</code></pre>

<hr>
<h2 id='set_forcings'>Set time-dependent parameters</h2><span id='topic+set_forcings'></span><span id='topic+set_forcings+2CEffectScenario-method'></span><span id='topic+set_forcings+2Clist-method'></span>

<h3>Description</h3>

<p>Parameters which change their value over time are referred to as <em>forcings</em>.
If and what parameters can vary over time depends on the model in question.
In many cases, <em>forcings</em> represent time-series of environmental properties.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_forcings(x, ...)

## S4 method for signature 'EffectScenario'
set_forcings(x, ...)

## S4 method for signature 'list'
set_forcings(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_forcings_+3A_x">x</code></td>
<td>
<p>(vector of) <a href="#topic+scenario">scenario</a> objects</p>
</td></tr>
<tr><td><code id="set_forcings_+3A_...">...</code></td>
<td>
<p>named argument list to set as forcings</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Forcing time-series are always represented by a
<code>data.frame</code> containing two columns. The first column representing time,
the second representing the parameter that is a function of time. The
ordering of columns is mandatory. The column names are essentially irrelevant
but may help documenting the scenario and its data. The rows must be
ordered chronologically. A time-series can consist of only a single row; in
this case it will represent constant conditions.
</p>
<p>Handling forcing time-series is a costly task for the ODE solver due to consistency
checks and interpolation between timesteps. How the solver interpolates
the forcing time-series can be controlled by certain arguments to functions
such as <code><a href="#topic+simulate">simulate()</a></code> and <code><a href="#topic+effect">effect()</a></code>. Please refer to <code><a href="#topic+simulate">simulate()</a></code> for a brief
overview and <a href="deSolve.html#topic+forcings">deSolve::forcings</a> for a detailed description.
</p>
<p>Forcing time-series should be kept as short as possible and as complex as
needed for optimal computational efficiency.
</p>


<h3>Value</h3>

<p>Modified <a href="#topic+scenarios">scenarios</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># constant values will be automatically converted to a data.frame
Lemna_Schmitt() %&gt;% set_forcings(temp=20) -&gt; lemna
lemna@forcings

# setting multiple forcings at once
df &lt;- data.frame(t=0:14, temp=rnorm(15, mean=20)) # random temperature series
Lemna_Schmitt() %&gt;% set_forcings(temp=df, rad=15000) -&gt; lemna
lemna@forcings

# forcings can also be supplied as a named list
Lemna_Schmitt() %&gt;% set_forcings(list(temp=20, rad=15000)) -&gt; lemna
lemna@forcings
</code></pre>

<hr>
<h2 id='set_init'>Set initial state</h2><span id='topic+set_init'></span><span id='topic+set_init+2Cvector-method'></span><span id='topic+set_init+2CEffectScenario-method'></span>

<h3>Description</h3>

<p>The <em>initial state</em> represents the starting values of a scenario's state
variables when starting a simulation. A scenario's default initial state
may be insufficient to get sensible results.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_init(x, init)

## S4 method for signature 'vector'
set_init(x, init)

## S4 method for signature 'EffectScenario'
set_init(x, init)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_init_+3A_x">x</code></td>
<td>
<p>vector of <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="set_init_+3A_init">init</code></td>
<td>
<p>named numeric vector</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In theory, a scenarios's state variables can be renamed by modifying the names
of the initial state vector. However, this is strongly
discouraged as this will affect other routines such as <code><a href="#topic+effect">effect()</a></code> and <code><a href="#topic+epx">epx()</a></code>
and may render results useless.
</p>


<h3>Value</h3>

<p>modified <code>EffectScenario</code> objects
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Set initial biomass to 1.0
metsulfuron %&gt;% set_init(c(BM=1.0)) %&gt;% simulate()
</code></pre>

<hr>
<h2 id='set_mode_of_action'>Set mode of action</h2><span id='topic+set_mode_of_action'></span><span id='topic+set_moa'></span>

<h3>Description</h3>

<p>Updates the model parameter <code>MoA</code> to a certain value
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_mode_of_action(x, code)

set_moa(x, code)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_mode_of_action_+3A_x">x</code></td>
<td>
<p>vector of <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="set_mode_of_action_+3A_code">code</code></td>
<td>
<p>a code for a mode of action</p>
</td></tr>
</table>


<h3>Value</h3>

<p>modified <code>EffectScenario</code> objects
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>set_moa()</code>: Shorthand version
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'># Set MoA=8, i.e. hazard during oogenesis
americamysis %&gt;%
  set_mode_of_action(8) %&gt;%
  effect(method="ode45")

# alternative approach using the parameter directly
americamysis %&gt;%
  set_param(c(MoA=8)) %&gt;%
  effect(method="ode45")
</code></pre>

<hr>
<h2 id='set_noexposure'>Set zero exposure</h2><span id='topic+set_noexposure'></span>

<h3>Description</h3>

<p>The scenarios current exposure is replaced by a constant exposure time-series
of value zero(<code>0.0</code>). Output times are unaffected.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_noexposure(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_noexposure_+3A_x">x</code></td>
<td>
<p>vector of <a href="#topic+scenarios">scenarios</a></p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of <a href="#topic+scenarios">scenarios</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Derive effect size in sample scenario without toxicant exposure
minnow_it %&gt;%
  set_noexposure() %&gt;%
  effect()
</code></pre>

<hr>
<h2 id='set_param'>Set model parameters</h2><span id='topic+set_param'></span><span id='topic+set_param+2CEffectScenario+2Cvector-method'></span><span id='topic+set_param+2CEffectScenario+2Cparameter_set-method'></span><span id='topic+set_param+2Clist+2Cparameter_set-method'></span><span id='topic+set_param+2Clist+2Cvector-method'></span><span id='topic+set_param+2CScenarioSequence+2Cvector-method'></span><span id='topic+set_param+2CScenarioSequence+2Cparameter_set-method'></span>

<h3>Description</h3>

<p>Modifies the parameters of one or more <code>EffectScenario</code> objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_param(x, param)

## S4 method for signature 'EffectScenario,vector'
set_param(x, param)

## S4 method for signature 'EffectScenario,parameter_set'
set_param(x, param)

## S4 method for signature 'list,parameter_set'
set_param(x, param)

## S4 method for signature 'list,vector'
set_param(x, param)

## S4 method for signature 'ScenarioSequence,vector'
set_param(x, param)

## S4 method for signature 'ScenarioSequence,parameter_set'
set_param(x, param)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_param_+3A_x">x</code></td>
<td>
<p>object(s) to modify</p>
</td></tr>
<tr><td><code id="set_param_+3A_param">param</code></td>
<td>
<p>named numeric <code>vector</code> with parameter names and value OR a
list of <a href="#topic+parameter_set-class">parameter_set</a> objects</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Most parameters are represented by numerical types but other types
are possible depending on model. Please refer to the model description
which parameters are required and in which unit. Some or all parameters may
be required to start a simulation. If required parameters are missing,
simulation will fail with an error message.
</p>


<h3>Value</h3>

<p>Vector of modified objects
</p>


<h3>Examples</h3>

<pre><code class='language-R'>Lemna_Schmitt() %&gt;% set_param(c(Emax=1,EC50=0.12))
</code></pre>

<hr>
<h2 id='set_tag'>Set a tag</h2><span id='topic+set_tag'></span>

<h3>Description</h3>

<p>Sets the user-defined, custom tag of a scenario. Tags
can be helpful to quickly distinguish scenarios of the same model type.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_tag(x, tag)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_tag_+3A_x">x</code></td>
<td>
<p>(vector of) <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="set_tag_+3A_tag">tag</code></td>
<td>
<p>vector of <code>character</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>(vector of) modified <code>EffectScenario</code> objects
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_tag">get_tag()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># set a custom tag
myscenario &lt;- GUTS_RED_SD() %&gt;% set_tag("My Custom Tag")

# returns `My Custom Tag`
get_tag(myscenario)

# the tag also appears in the scenario overview
myscenario
</code></pre>

<hr>
<h2 id='set_times'>Set output times</h2><span id='topic+set_times'></span>

<h3>Description</h3>

<p>Minimum and maximum output times define the simulated period for a scenario.
Simulation results will be returned for each output time, see <code><a href="#topic+simulate">simulate()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_times(x, times)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_times_+3A_x">x</code></td>
<td>
<p>vector of <a href="#topic+scenarios">scenarios</a></p>
</td></tr>
<tr><td><code id="set_times_+3A_times">times</code></td>
<td>
<p><code>numerical</code> vector</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Be aware that output times may be modified by <code><a href="#topic+set_exposure">set_exposure()</a></code>. Precision of
simulation results may be influenced by chosen output times, see <code><a href="#topic+simulate">simulate()</a></code>
for more information.
</p>


<h3>Value</h3>

<p>Vector of modified <code>ExposureScenario</code> objects
</p>


<h3>See Also</h3>

<p><code><a href="#topic+simulate">simulate()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Set simulated period to [2,4] with output intervals of length 1
minnow_it %&gt;% set_times(c(2,3,4))

# Decrease output interval length to 0.1
minnow_it %&gt;% set_times(seq(2, 4, 0.1))
</code></pre>

<hr>
<h2 id='set_transfer'>Set transfer events</h2><span id='topic+set_transfer'></span><span id='topic+set_transfer+2CANY-method'></span><span id='topic+set_transfer+2CTransferable-method'></span>

<h3>Description</h3>

<p>A <em>transfer</em> refers to an event where a certain amount of biomass (<em>BM</em>)
is moved to a new medium after a period of time. This feature replicates
a procedure occurring e.g. in Lemna effect studies and may be necessary to recreate
study results.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_transfer(x, interval, times, biomass, scaled_comp)

## S4 method for signature 'ANY'
set_transfer(x, interval, times, biomass, scaled_comp)

## S4 method for signature 'Transferable'
set_transfer(x, interval, times, biomass, scaled_comp)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_transfer_+3A_x">x</code></td>
<td>
<p>vector of <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="set_transfer_+3A_interval">interval</code></td>
<td>
<p>optional <code>numeric</code>, interval in time units of the scenario,
set to <code>-1</code> to disable transfers.</p>
</td></tr>
<tr><td><code id="set_transfer_+3A_times">times</code></td>
<td>
<p>optional <code>numeric</code> vector of time points where transfers occur</p>
</td></tr>
<tr><td><code id="set_transfer_+3A_biomass">biomass</code></td>
<td>
<p>optional <code>numeric</code> vector, amount of biomass that is being
transferred at each transfer</p>
</td></tr>
<tr><td><code id="set_transfer_+3A_scaled_comp">scaled_comp</code></td>
<td>
<p>optional <code>character</code> vector of affected compartments
that are scaled according to new biomass levels</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Any transfer time point must also be an output time point. If a transfer
occurs, simulation results of that time point will report the model state
<strong>before</strong> the transfer. Be aware that in order to use transfers at regular
intervals, the simulation must start at time point zero.
</p>


<h4>Transferred biomass</h4>

<p>At each transfer, a defined amount of biomass is transferred to a new medium.
This is modeled by interrupting the simulation at a transfer time point, modifying
the biomass level <code>BM</code>, and scaling affected compartments according to new
biomass levels. Scaling of compartments depending on biomass, such as
<em>internal toxicant mass</em>, is necessary to correctly reflect mass balances and
concentrations over time.
</p>
<p>Transferred biomass is set using the <code>biomass</code> parameter. Is is either a
single numerical value in which case the same biomass level is set at each
transfer. Or it is a vector of numerical values with the same length as the
<code>times</code> parameter in which case a custom biomass level can be set for each
transfer. Multiple biomass levels can only be set in conjunction with
custom transfer time points.
</p>
<p>Some scenario types define default values for transferred biomass based
on common study set ups.
</p>



<h4>Regular and custom transfer time points</h4>

<p>Transfers can occur either in regular intervals of time or at selected, custom
time points. For regular intervals, the parameter <code>interval</code> is set to a single
numeric value which has the same unit as the scenario's time dimension. As an
example: if a scenario uses the unit of <em>days</em> for time, the transfer interval
is also specified in <em>days</em>:
</p>
<p>Transfers occurring at custom time points are set by passing a numerical vector
to the parameter <code>times</code>. The time points' units must match with the unit of
time in the scenario. A custom transfer time point <strong>must not occur at the
starting time point of a simulation</strong>.
</p>



<h4>Affected compartments</h4>

<p>Some compartments depend on biomass to correctly reflect mass balances and
concentrations over time, such as <em>internal toxicant mass</em>. These compartments
need to be scaled linearly to reflect the change in biomass levels.
The parameter <code>scaled_comp</code> accepts a character vector of compartment names
which are scaled at each transfer. This parameter should only be used with
custom, user-defined models. If no compartment needs to be scaled, set or
use the default value of <code>character(0)</code>.
</p>



<h3>Value</h3>

<p>Modified <code>EffectScenario</code> objects
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Lemna_Schmitt">Lemna_Schmitt()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate biomass transfer of 50 *g dw/m²* at a regular interval of 7 *days*
metsulfuron %&gt;%
  set_transfer(interval=7, biomass=50) %&gt;%
  simulate()

# Simulate irregular biomass transfers occuring at days 5, 10, and 12
metsulfuron %&gt;%
  set_transfer(times=c(5,10,12), biomass=50) %&gt;%
  simulate()

# Simulate irregular transfers with changing amounts of transferred biomass
metsulfuron %&gt;%
  set_transfer(times=c(5,10,12), biomass=c(50,20,10)) %&gt;%
  simulate()
</code></pre>

<hr>
<h2 id='set_window'>Set window length</h2><span id='topic+set_window'></span>

<h3>Description</h3>

<p>Exposure windows are defined as a period of time at the scale of the exposure series.
As an example: if an exposure series has an hourly time step, a window length
of <code>24</code> will consider the exposure within 24 hours intervals for effect
calculation. The same applies for the window interval, i.e. the period between
considered exposure windows. Set <code>length=-1</code> to disable moving windows.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_window(x, length, interval)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_window_+3A_x">x</code></td>
<td>
<p>vector of <code>EffectScenario</code> objects</p>
</td></tr>
<tr><td><code id="set_window_+3A_length">length</code></td>
<td>
<p><code>numeric</code>, length of exposure window to consider for effect
calculation, set <code>length=-1</code> to disable moving windows</p>
</td></tr>
<tr><td><code id="set_window_+3A_interval">interval</code></td>
<td>
<p><code>numeric</code>, interval between considered exposure windows</p>
</td></tr>
</table>


<h3>Value</h3>

<p>modified <code>EffectScenario</code> objects
</p>


<h3>Examples</h3>

<pre><code class='language-R'># calculate the maximum effect for all windows of 10 days length
metsulfuron %&gt;%
  set_window(length=10, interval=1) %&gt;%
  effect()
</code></pre>

<hr>
<h2 id='simulate'>Simulate an effect scenario</h2><span id='topic+simulate'></span><span id='topic+simulate+2CEffectScenario-method'></span><span id='topic+simulate+2CTransferable-method'></span><span id='topic+simulate+2CScenarioSequence-method'></span>

<h3>Description</h3>

<p>The supplied <code>EffectScenario</code> is passed on to the ODE solver for numerical
integration. Internally, <code>simulate()</code> is split up into several functions
dedicated to particular models, e.g. one for GUTS and one for Lemna type
models. The package will take care of using the correct function
for each model when <code>simulate()</code> is called.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate(x, ...)

## S4 method for signature 'EffectScenario'
simulate(x, ...)

## S4 method for signature 'Transferable'
simulate(x, ...)

## S4 method for signature 'ScenarioSequence'
simulate(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simulate_+3A_x">x</code></td>
<td>
<p><a href="#topic+scenario">scenario</a> to simulate</p>
</td></tr>
<tr><td><code id="simulate_+3A_...">...</code></td>
<td>
<p>additional parameters passed on to ODE solver</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Simulation results are returned as a time-series for each state
variable. Some models provide additional properties describing the model state,
e.g. the internal concentration of a toxicant within the organism. Refer
to the respective <a href="#topic+scenario">scenario</a> for more information.
</p>
<p>Additional arguments to <code>simulate()</code> will be passed on to <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code>
which enables control of the numerical integration parameters.
</p>


<h4>Output times and windows</h4>

<p>The minimum and maximum of given time points generally define the simulated
period. Function argument <code>times</code> overrides settings of the scenario, i.e.
time points set in <code>scenario@times</code>. However, the simulation can be limited to
a subset of time points by enabling a moving exposure window, see <code><a href="#topic+set_window">set_window()</a></code>.
</p>
<p>Results will be returned for each time point. Precision of the numeric solver
may be affected by chosen output times in certain cases. Hence, small deviations
in results should be expected if different output times are set. This effect
can be mitigated by either defining are sufficiently small time step for the solver
using argument <code>hmax</code> or by decreasing the error tolerances <code>atol</code> and <code>rtol</code>.
These arguments are passed to the solver, see e.g. <code><a href="deSolve.html#topic+lsoda">deSolve::lsoda()</a></code> for details.
</p>



<h4>Numerical precision and stability</h4>

<p>Each model was assigned a default ODE solver which handles most of the
occurring inputs well. In most cases, this will be an explicit numerical
scheme of the Runge-Kutta family with variable step width. For certain extreme
parameters settings, such as very high uptake/permeability of the contaminant
or exposure series which represent step functions, the numerical approximation
might deteriorate and yield invalid results. In this case try to decrease the
allowed max step width by setting the argument <code>hmax</code> with various values.
Start with <code>hmax=1</code> and decrease the value by orders of 10. It is not
possible or desirable to reduce <code>hmax</code> to extremely small values, as the
ODE solver will require more CPU time and simulation will become inefficient.
</p>
<p>Oftentimes, it will be computational more efficient to adapt the solver's
error tolerances <code>atol</code> and <code>rtol</code> than reducing the step width <code>hmax</code> to achieve
stable numerics. Start by decreasing deSolve's default values by
orders of ten until the simulation yields acceptable results, see e.g.
<code><a href="deSolve.html#topic+lsoda">deSolve::lsoda()</a></code> for more information on error tolerances.
</p>
<p>As an alternative to adapting solver parameters, it might be worthwhile to
try other numerical schemes which can handle stiff ODEs, such as Radau, LSODA,
or LSODES. To change solvers, set the <code>method</code> argument.
To select e.g. the Radau scheme, set <code>method="radau"</code>. For LSODA, set <code>method="lsoda"</code>.
Radau performs better than LSODA in some cases, as the latter method can return
biologically nonsensical results without raising an error. See <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code>
for details on available ODE solvers.
</p>



<h3>Value</h3>

<p>A <code>data.frame</code> with the time-series of simulation results
</p>


<h3>Examples</h3>

<pre><code class='language-R'>minnow_sd %&gt;% simulate() # tidy syntax
simulate(minnow_sd) # base R syntax

# Set new output times
minnow_sd %&gt;% simulate(times=c(0,4))

# Modify simulated time frame
minnow_sd %&gt;% simulate(times=c(0,10))

# Use an alternative exposure profile than defined in the scenario
minnow_sd %&gt;% set_exposure(data.frame(t=0,c=10), reset_times=FALSE) %&gt;% simulate()

##
## Precision of results

# A large number of output times forces smaller solver time steps
minnow_it %&gt;% simulate(times=seq(0,1,0.001)) %&gt;% tail()

# Defining only two output times allows for larger solver time steps
minnow_it %&gt;% simulate(times=c(0,1))

# The difference between results can be reduced by limiting the solver's
# maximum step length
minnow_it %&gt;% simulate(times=c(0,1), hmax=0.001)

# The same numerical precision can be achieved by switching to
# the Radau scheme
minnow_it %&gt;% simulate(times=c(0,1), method="radau")

# A very small step length may reduce the difference even further but may
# also exceed the allowed number of steps per output interval. The following
# simulation will be aborted with a solver error:
try(
  minnow_it %&gt;% simulate(times=c(0,1), hmax=0.0001)
)

# However, the solver's max number of allowed steps can be increased:
minnow_it %&gt;% simulate(times=c(0,1), hmax=0.0001, maxsteps=10^5)
</code></pre>

<hr>
<h2 id='simulate_batch'>Batch simulation of several effect scenarios</h2><span id='topic+simulate_batch'></span>

<h3>Description</h3>

<p>An effect scenario contains only one exposure level. Consequently, the
simulation of an effect scenario (e.g. metsulfuron %&gt;% simulate will return
the results for one exposure level only). However, in a laboratory experiment
examining the effects of different exposure levels on a biological system,
a batch simulation approach would involve running multiple simulations with
varying exposure or treatment conditions. To illustrate, if the objective is
to examine the impact of a substance on cell growth, the simulation model
could be designed to replicate the cell growth dynamics under varying
concentrations of the substance. Each simulation run would represent a
specific exposure level, ranging from low to high concentrations of the
chemical. To simulate such a laboratory experiment, the simulate_batch
function can be used. All exposure series are saved in the treatment argument.
The first column contains the time, the second column the concentration, and
the third column the trial name (exposure level, e.g. 'T1', 'T2', 'T3').
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate_batch(model_base, treatments, param_sample = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simulate_batch_+3A_model_base">model_base</code></td>
<td>
<p>effect scenario object with mean parameters</p>
</td></tr>
<tr><td><code id="simulate_batch_+3A_treatments">treatments</code></td>
<td>
<p>treatments exposure levels as data frame (time, conc, trial)</p>
</td></tr>
<tr><td><code id="simulate_batch_+3A_param_sample">param_sample</code></td>
<td>
<p>data.frame with parameter sample</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>data.frame</code> with simulation results
</p>

<hr>
<h2 id='solver'>Calls ODE solver for a particular model</h2><span id='topic+solver'></span><span id='topic+solver+2CANY-method'></span><span id='topic+solver+2CGutsRedSd-method'></span><span id='topic+solver+2CGutsRedIt-method'></span><span id='topic+solver+2CLemnaSchmittScenario-method'></span><span id='topic+solver+2CLemnaSetacScenario-method'></span><span id='topic+solver+2CMyrioExpScenario-method'></span><span id='topic+solver+2CMyrioLogScenario-method'></span><span id='topic+solver+2CDebAbj-method'></span><span id='topic+solver+2CDebDaphnia-method'></span><span id='topic+solver+2CAlgaeWeberScenario-method'></span><span id='topic+solver+2CAlgaeTKTDScenario-method'></span><span id='topic+solver+2CAlgaeSimpleScenario-method'></span>

<h3>Description</h3>

<p>Please refer to the <em>Modeling Howto</em> vignette on how to implement custom
models by overloading the <code>solver</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solver(scenario, times, ...)

## S4 method for signature 'ANY'
solver(scenario, times, ...)

## S4 method for signature 'GutsRedSd'
solver(scenario, times, ...)

## S4 method for signature 'GutsRedIt'
solver(scenario, times, ...)

## S4 method for signature 'LemnaSchmittScenario'
solver(scenario, times, ...)

## S4 method for signature 'LemnaSetacScenario'
solver(scenario, times, ...)

## S4 method for signature 'MyrioExpScenario'
solver(scenario, times, ...)

## S4 method for signature 'MyrioLogScenario'
solver(scenario, times, ...)

## S4 method for signature 'DebAbj'
solver(scenario, times, ...)

## S4 method for signature 'DebDaphnia'
solver(
  scenario,
  times,
  approx = c("linear", "constant"),
  f = 1,
  method = "ode45",
  ...
)

## S4 method for signature 'AlgaeWeberScenario'
solver(
  scenario,
  times,
  approx = c("linear", "constant"),
  f = 1,
  method = "lsoda",
  hmax = 0.1,
  ...
)

## S4 method for signature 'AlgaeTKTDScenario'
solver(
  scenario,
  times,
  approx = c("linear", "constant"),
  f = 1,
  method = "lsoda",
  hmax = 0.1,
  ...
)

## S4 method for signature 'AlgaeSimpleScenario'
solver(
  scenario,
  times,
  approx = c("linear", "constant"),
  f = 1,
  method = "ode45",
  hmax = 0.01,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="solver_+3A_scenario">scenario</code></td>
<td>
<p><a href="#topic+scenario">scenario</a> object</p>
</td></tr>
<tr><td><code id="solver_+3A_times">times</code></td>
<td>
<p>numeric vector of output times, overrides any scenario setting</p>
</td></tr>
<tr><td><code id="solver_+3A_...">...</code></td>
<td>
<p>additional parameters passed on to <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code></p>
</td></tr>
<tr><td><code id="solver_+3A_approx">approx</code></td>
<td>
<p>string, interpolation method of exposure series, see <code><a href="stats.html#topic+approxfun">stats::approxfun()</a></code></p>
</td></tr>
<tr><td><code id="solver_+3A_f">f</code></td>
<td>
<p>if <code>approx="constant"</code>, a number between 0 and 1 inclusive, see <code><a href="stats.html#topic+approxfun">stats::approxfun()</a></code></p>
</td></tr>
<tr><td><code id="solver_+3A_method">method</code></td>
<td>
<p>string, numerical solver used by <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code></p>
</td></tr>
<tr><td><code id="solver_+3A_hmax">hmax</code></td>
<td>
<p>numeric, maximum step length in time, see <code><a href="deSolve.html#topic+ode">deSolve::ode()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>data.frame</code> with simulation results
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>solver(ANY)</code>: Default solver, raises an error
</p>
</li>
<li> <p><code>solver(GutsRedSd)</code>: Numerically integrates GUTS-RED-SD models
</p>
</li>
<li> <p><code>solver(GutsRedIt)</code>: Numerically integrates GUTS-RED-IT models
</p>
</li>
<li> <p><code>solver(LemnaSchmittScenario)</code>: Numerically integrates Lemna_Schmitt models
</p>
</li>
<li> <p><code>solver(LemnaSetacScenario)</code>: Numerically integrates Lemna_SETAC models
</p>
</li>
<li> <p><code>solver(MyrioExpScenario)</code>: Numerically integrates Myrio models
</p>
</li>
<li> <p><code>solver(MyrioLogScenario)</code>: Numerically integrates Myrio_log models
</p>
</li>
<li> <p><code>solver(DebAbj)</code>: Numerically integrates DEB_abj models
</p>
</li>
<li> <p><code>solver(DebDaphnia)</code>: Numerically integrates DEB_Daphnia models
</p>
</li>
<li> <p><code>solver(AlgaeWeberScenario)</code>: numerically integrates Algae_Weber models
</p>
</li>
<li> <p><code>solver(AlgaeTKTDScenario)</code>: numerically integrates Algae_TKTD models
</p>
</li>
<li> <p><code>solver(AlgaeSimpleScenario)</code>: numerically integrates Algae_Simple models
</p>
</li></ul>

<hr>
<h2 id='survival'>Survival rate</h2><span id='topic+survival'></span>

<h3>Description</h3>

<p>Derives the survival rate of individuals for <em>Reduced GUTS</em> models
</p>


<h3>Usage</h3>

<pre><code class='language-R'>survival(scenario, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="survival_+3A_scenario">scenario</code></td>
<td>
<p>an <code>EffectScenario</code> to simulate</p>
</td></tr>
<tr><td><code id="survival_+3A_...">...</code></td>
<td>
<p>additional parameters passed on to <code><a href="#topic+simulate">simulate()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The survival rate describes the survival probability at each
time point. The function simulates the <em>GUTS</em> scenario and appends a column
<code>survival</code> to the simulation result. A value of one (<code>1.0</code>) denotes that
all individuals survive. A value of zero (<code>0.0</code>) denotes that no individuals
survived.
</p>
<p>Only available for <em>Reduced GUTS</em> models, see <a href="#topic+GUTS-RED-models">GUTS-RED-models</a>.
The equations were described by EFSA (2018).
</p>


<h3>Value</h3>

<p>a <code>data.frame</code> containing simulation results
</p>


<h3>References</h3>

<p>EFSA PPR Panel (EFSA Panel on Plant Protection Products and their Residues),
Ockleford C, Adriaanse P, Berny P, et al., 2018: <em>Scientific Opinion on the
state of the art of Toxicokinetic/Toxicodynamic (TKTD) effect models for
regulatory risk assessment of pesticides for aquatic organisms</em>. EFSA Journal 2018;
16(8):5377, 188 pp. <a href="https://doi.org/10.2903/j.efsa.2018.5377">doi:10.2903/j.efsa.2018.5377</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+GUTS-RED-models">GUTS-RED-models</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># calculate survival rate
minnow_it %&gt;% survival()

# plot survival over time based on a random exposure profile
minnow_sd %&gt;%
  set_exposure(data.frame(t=1:100, c=runif(100)*10)) %&gt;%
  survival() -&gt; df
plot(df$time, df$survival, "l")
</code></pre>

<hr>
<h2 id='Transferable'>Biomass transfer class</h2><span id='topic+Transferable'></span><span id='topic+Biomass-transfer'></span><span id='topic+Transferable-class'></span>

<h3>Description</h3>

<p>By inheriting from class <code>Transferable</code>, a scenario's behavior can be
extended to support transfer and reset of biomass at dedicated points during
simulation.
</p>


<h3>Slots</h3>


<dl>
<dt><code>transfer.times</code></dt><dd><p><code>numeric</code>, vector of time points at which transfers occur,
e.g. <code>c(7,10,14)</code></p>
</dd>
<dt><code>transfer.interval</code></dt><dd><p><code>numeric</code>, interval length until frond transfer to new
medium</p>
</dd>
<dt><code>transfer.biomass</code></dt><dd><p><code>numeric</code>, amount of biomass transferred to new medium</p>
</dd>
<dt><code>transfer.comp.biomass</code></dt><dd><p><code>character</code> state variable which describes
biomass</p>
</dd>
<dt><code>transfer.comp.scaled</code></dt><dd><p><code>character</code> vector of state variable which will
be scaled 1:1 when biomass is modified, e.g. internal toxicant mass</p>
</dd>
</dl>


<h3>Biomass transfer</h3>

<p>Models supporting biomass transfer can be instructed to move a fixed amount
of biomass to a new medium after a period of time. This feature replicates
a procedure occurring in e.g. Lemna effect studies and may be necessary to
recreate study results.
</p>
<p>The biomass transfer feature assumes that always a fixed amount of
biomass is transferred. Transfers can occur at any fixed point in time or
in regular intervals. During a transfer, the biomass is reset to the
transferred amount and additional compartments can be scaled 1:1 accordingly,
to e.g. reflect the change in internal toxicant mass when biomass is modified.
Transfer settings can be modified using <code><a href="#topic+set_transfer">set_transfer()</a></code>.
</p>
<p>Any transfer time point must also be an output time point. If a transfer
occurs, simulation results of that time point will report the model state
<strong>before</strong> the transfer. Be aware that in order to use transfers at regular
intervals, the simulation must start at time point zero.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+set_transfer">set_transfer()</a></code>
</p>
<p>Other scenarios: 
<code><a href="#topic+Algae-models">Algae-models</a></code>,
<code><a href="#topic+DEB-models">DEB-models</a></code>,
<code><a href="#topic+GUTS-RED-models">GUTS-RED-models</a></code>,
<code><a href="#topic+Lemna-models">Lemna-models</a></code>,
<code><a href="#topic+Macrophyte-models">Macrophyte-models</a></code>,
<code><a href="#topic+Myriophyllum-models">Myriophyllum-models</a></code>,
<code><a href="#topic+Scenarios">Scenarios</a></code>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
