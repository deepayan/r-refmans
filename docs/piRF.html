<!DOCTYPE html><html><head><title>Help for package piRF</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {piRF}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#airfoil'><p>airfoil self noise dataset</p></a></li>
<li><a href='#boostStage'><p>Generates stage 2 (and more) RF for Ghosal, Hooker RF implementation. Helper function.</p></a></li>
<li><a href='#calibrate'><p>calibrate()</p></a></li>
<li><a href='#CQRF'><p>implements RF prediction interval using split conformal prediction as outlined in Romano, Patterson, Candes 2018. Helper function.</p></a></li>
<li><a href='#genBOP'><p>Generate BOP sets from Roy, Larocque 2019</p></a></li>
<li><a href='#genCHDInt'><p>generates BOP contiguous HDI prediction intervals from Roy, Larocque 2019</p></a></li>
<li><a href='#genCombRF'><p>Generates stage 1 RF for Ghosal, Hooker RF implementation. Helper function.</p></a></li>
<li><a href='#genHDInt'><p>generates BOP HDI prediction intervals from Roy, Larocque 2019</p></a></li>
<li><a href='#genqInt'><p>Generates BOP quantile prediction intervals from Roy, Larocque 2019.</p></a></li>
<li><a href='#genRF'><p>Generate quantile RF</p></a></li>
<li><a href='#genWeights'><p>Generate weights for RF through feature bias reduction method outlined in Tung 2014.</p></a></li>
<li><a href='#GhosalBoostRF'><p>Implements RF prediction interval method in Ghosal, Hooker 2018. Helper function.</p></a></li>
<li><a href='#GHVar'><p>Generate prediction intervals for Ghosal, Hooker 2018 implementation. Helper function.</p></a></li>
<li><a href='#HDI_quantregforest'><p>Implements HDI RF prediction interval method in Zhu 2019. Helper function.</p></a></li>
<li><a href='#parse.formula'><p>Authors: Marvin N. Wright, Gregor DeCillia</p></a></li>
<li><a href='#predictionUbRF'><p>Performs prediction debiasing from Tung 2014</p></a></li>
<li><a href='#rfint'><p>rfint()</p></a></li>
<li><a href='#RoyRF'><p>implements RF prediction interval method in Roy, Larocque 2019. Helper function.</p></a></li>
<li><a href='#TungUbRF'><p>Implements RF prediction interval method in Tung, Huang, Nyugen, Khan 2014.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Prediction Intervals for Random Forests</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2020-04-17</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Chancellor Johnstone &lt;chancellor.johnstone@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Implements multiple state-of-the-art prediction interval methodologies for random forests. 
	These include: quantile regression intervals, out-of-bag intervals, bag-of-observations intervals, 
	one-step boosted random forest intervals, bias-corrected intervals, high-density intervals, and 
	split-conformal intervals. The implementations include a combination of novel adjustments to the 
	original random forest methodology and novel prediction interval methodologies. All of these 
	methodologies can be utilized using solely this package, rather than a collection of separate 
	packages. Currently, only regression trees are supported. Also capable of handling high dimensional data. 
	Roy, Marie-Helene and Larocque, Denis (2019) &lt;<a href="https://doi.org/10.1177%2F0962280219829885">doi:10.1177/0962280219829885</a>&gt;.
	Ghosal, Indrayudh and Hooker, Giles (2018) &lt;<a href="https://arxiv.org/abs/1803.08000">arXiv:1803.08000</a>&gt;.
	Zhu, Lin and Lu, Jiaxin and Chen, Yihong (2019) &lt;<a href="https://arxiv.org/abs/1905.10101">arXiv:1905.10101</a>&gt;.
	Zhang, Haozhe and Zimmerman, Joshua and Nettleton, Dan and Nordman, Daniel J. (2019) &lt;<a href="https://doi.org/10.1080%2F00031305.2019.1585288">doi:10.1080/00031305.2019.1585288</a>&gt;.
	Meinshausen, Nicolai (2006) <a href="http://www.jmlr.org/papers/volume7/meinshausen06a/meinshausen06a.pdf">http://www.jmlr.org/papers/volume7/meinshausen06a/meinshausen06a.pdf</a>.
	Romano, Yaniv and Patterson, Evan and Candes, Emmanuel (2019) &lt;<a href="https://arxiv.org/abs/1905.03222">arXiv:1905.03222</a>&gt;.
	Tung, Nguyen Thanh and Huang, Joshua Zhexue and Nguyen, Thuy Thi and Khan, Imran (2014) &lt;<a href="https://doi.org/10.13140%2F2.1.2500.8002">doi:10.13140/2.1.2500.8002</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, devtools, foreach, doParallel, hdrcde, rfinterval,
ranger</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="http://github.com/chancejohnstone/piRF">http://github.com/chancejohnstone/piRF</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.0.2</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rdpack</td>
</tr>
<tr>
<td>RdMacros:</td>
<td>Rdpack</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-05-09 00:05:56 UTC; thechanceyman</td>
</tr>
<tr>
<td>Author:</td>
<td>Chancellor Johnstone [cre, aut, cph],
  Haozhe Zhang [aut, cph],
  Martin Wright [ctb, cph],
  Gregor DeCillia [ctb, cph]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-05-12 09:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='airfoil'>airfoil self noise dataset</h2><span id='topic+airfoil'></span>

<h3>Description</h3>

<p>The NASA data set comprises different size NACA 0012 airfoils at various wind tunnel speeds and angles of attack.
The span of the airfoil and the observer position were the same in all of the experiments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(airfoil)
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 1503 rows and 6 columns.</p>


<h3>Source</h3>

<p><a href="https://archive.ics.uci.edu/ml/datasets/Airfoil+Self-Noise#">UCI Archive</a>
</p>


<h3>References</h3>

<p>T.F. Brooks, D.S. Pope, and A.M. Marcolini.
Airfoil self-noise and prediction.
Technical report, NASA RP-1218, July 1989.
</p>
<p>K. Lau.
A neural networks approach for aerofoil noise prediction.
Master's thesis, Department of Aeronautics.
Imperial College of Science, Technology and Medicine (London, United Kingdom), 2006.
</p>
<p>Lopez, R. and Balsa-Canto, E. and Onate, E.
Neural Networks for Variational Problems in Engineering.
PhD Thesis, Technical University of Catalonia, 2008.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(airfoil)
airfoil$pressure
</code></pre>

<hr>
<h2 id='boostStage'>Generates stage 2 (and more) RF for Ghosal, Hooker RF implementation. Helper function.</h2><span id='topic+boostStage'></span>

<h3>Description</h3>

<p>Used within GhosalBoostRF().
</p>


<h3>Usage</h3>

<pre><code class='language-R'>boostStage(
  rf,
  formula = NULL,
  train_data = NULL,
  pred_data = NULL,
  num_trees = num_trees,
  min_node_size = NULL,
  m_try = NULL,
  keep_inbag = TRUE,
  intervals = TRUE,
  alpha = alpha,
  weights = NULL,
  num_stages = 2,
  prop = prop,
  num_threads = num_threads,
  variant = NULL
)
</code></pre>

<hr>
<h2 id='calibrate'>calibrate()</h2><span id='topic+calibrate'></span>

<h3>Description</h3>

<p>This function outputs a calibrated significance level based on coverage of prediction intervals generated using oob collections. Primarily for use in RoyRF().
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calibrate(
  oob,
  alpha = 0.1,
  response_data,
  tolerance = 0.025,
  step_percent = 0.618,
  undercoverage = FALSE,
  method = "quantile",
  max_iter = 10
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calibrate_+3A_oob">oob</code></td>
<td>
<p>collection of oob predictions for training data (in list form).</p>
</td></tr>
<tr><td><code id="calibrate_+3A_alpha">alpha</code></td>
<td>
<p>nominal significance level. Defaults to 0.01.</p>
</td></tr>
<tr><td><code id="calibrate_+3A_response_data">response_data</code></td>
<td>
<p>response data of class data.frame. Must have names() attribute.</p>
</td></tr>
<tr><td><code id="calibrate_+3A_tolerance">tolerance</code></td>
<td>
<p>tolerance allowed around nominal alpha. Default is 0.25.</p>
</td></tr>
<tr><td><code id="calibrate_+3A_step_percent">step_percent</code></td>
<td>
<p>ratio absolute difference between empirical oob coverage and nominal coverage to adjust when calibrating. Defaults to 0.618.</p>
</td></tr>
<tr><td><code id="calibrate_+3A_undercoverage">undercoverage</code></td>
<td>
<p>Allow undercoverage. Defaults to TRUE. Not currently implemented.</p>
</td></tr>
<tr><td><code id="calibrate_+3A_method">method</code></td>
<td>
<p>Method to calibrate prediction intervals with. Defaults to &quot;quantile&quot;). Current only &quot;quantile&quot; implemented.</p>
</td></tr>
<tr><td><code id="calibrate_+3A_max_iter">max_iter</code></td>
<td>
<p>Maximum number of iterations. Defaults to 10.</p>
</td></tr>
</table>

<hr>
<h2 id='CQRF'>implements RF prediction interval using split conformal prediction as outlined in Romano, Patterson, Candes 2018. Helper function.</h2><span id='topic+CQRF'></span>

<h3>Description</h3>

<p>This function implements split conformal prediction intervals for RFs. Currently used in rfint().
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CQRF(
  formula = NULL,
  train_data = NULL,
  pred_data = NULL,
  num_trees = NULL,
  min_node_size = NULL,
  m_try = NULL,
  keep_inbag = TRUE,
  intervals = TRUE,
  alpha = NULL,
  forest_type = "RF",
  num_threads = NULL,
  interval_type = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CQRF_+3A_formula">formula</code></td>
<td>
<p>Object of class formula or character describing the model to fit. Interaction terms supported only for numerical variables.</p>
</td></tr>
<tr><td><code id="CQRF_+3A_train_data">train_data</code></td>
<td>
<p>Training data of class data.frame, matrix, dgCMatrix (Matrix) or gwaa.data (GenABEL). Matches ranger() requirements.</p>
</td></tr>
<tr><td><code id="CQRF_+3A_pred_data">pred_data</code></td>
<td>
<p>Test data of class data.frame, matrix, dgCMatrix (Matrix) or gwaa.data (GenABEL). Utilizes ranger::predict() to get prediction intervals for test data.</p>
</td></tr>
<tr><td><code id="CQRF_+3A_num_trees">num_trees</code></td>
<td>
<p>Number of trees.</p>
</td></tr>
<tr><td><code id="CQRF_+3A_min_node_size">min_node_size</code></td>
<td>
<p>Minimum number of observations before split at a node.</p>
</td></tr>
<tr><td><code id="CQRF_+3A_m_try">m_try</code></td>
<td>
<p>Number of variables to randomly select from at each split.</p>
</td></tr>
<tr><td><code id="CQRF_+3A_keep_inbag">keep_inbag</code></td>
<td>
<p>Saves matrix of observations and which tree(s) they occur in. Required to be true to generate variance estimates for Ghosal, Hooker 2018 method. *Should not be an option...</p>
</td></tr>
<tr><td><code id="CQRF_+3A_intervals">intervals</code></td>
<td>
<p>Generate prediction intervals or not.</p>
</td></tr>
<tr><td><code id="CQRF_+3A_alpha">alpha</code></td>
<td>
<p>Significance level for prediction intervals.</p>
</td></tr>
<tr><td><code id="CQRF_+3A_forest_type">forest_type</code></td>
<td>
<p>Determines what type of forest: regression forest vs. quantile regression forest. *Should not be an option...</p>
</td></tr>
<tr><td><code id="CQRF_+3A_num_threads">num_threads</code></td>
<td>
<p>The number of threads to use in parallel. Default is the current number of cores.</p>
</td></tr>
<tr><td><code id="CQRF_+3A_interval_type">interval_type</code></td>
<td>
<p>Type of prediction interval to generate.
Options are <code>method = c("two-sided", "lower", "upper")</code>. Default is  <code>method = "two-sided"</code>.</p>
</td></tr>
</table>

<hr>
<h2 id='genBOP'>Generate BOP sets from Roy, Larocque 2019</h2><span id='topic+genBOP'></span>

<h3>Description</h3>

<p>This function is primarily meant to be used within the RoyRF() function. All parameters are same as in RoyRF().
</p>


<h3>Usage</h3>

<pre><code class='language-R'>genBOP(
  rf,
  inbag = rf$inbag.counts,
  alpha = alpha,
  pred_data,
  train_data,
  num_threads = num_threads,
  calibrate = calibrate
)
</code></pre>

<hr>
<h2 id='genCHDInt'>generates BOP contiguous HDI prediction intervals from Roy, Larocque 2019</h2><span id='topic+genCHDInt'></span>

<h3>Description</h3>

<p>This function is primarily meant to be used within the RoyRF() function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>genCHDInt(BOP, alpha = alpha)
</code></pre>

<hr>
<h2 id='genCombRF'>Generates stage 1 RF for Ghosal, Hooker RF implementation. Helper function.</h2><span id='topic+genCombRF'></span>

<h3>Description</h3>

<p>This function is primarily meant to be used within GhosalBoostRF().
</p>


<h3>Usage</h3>

<pre><code class='language-R'>genCombRF(
  formula = NULL,
  train_data = NULL,
  pred_data = NULL,
  num_trees = num_trees,
  min_node_size = NULL,
  m_try = NULL,
  keep_inbag = TRUE,
  intervals = TRUE,
  alpha = NULL,
  importance = "none",
  weights = NULL,
  prop = NULL,
  inbag = NULL,
  num_threads = NULL
)
</code></pre>

<hr>
<h2 id='genHDInt'>generates BOP HDI prediction intervals from Roy, Larocque 2019</h2><span id='topic+genHDInt'></span>

<h3>Description</h3>

<p>This function is primarily meant to be used within the RoyRF() function. Could ptentially result in non-contiguous intervals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>genHDInt(BOP, alpha = alpha)
</code></pre>

<hr>
<h2 id='genqInt'>Generates BOP quantile prediction intervals from Roy, Larocque 2019.</h2><span id='topic+genqInt'></span>

<h3>Description</h3>

<p>This function is primarily meant to be used within the RoyRF() function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>genqInt(BOP, alpha = alpha, interval_type = interval_type)
</code></pre>

<hr>
<h2 id='genRF'>Generate quantile RF</h2><span id='topic+genRF'></span>

<h3>Description</h3>

<p>This function is primarily meant to be used within the TungUbRF() function. All parameters are same as in TungUbRF().
</p>


<h3>Usage</h3>

<pre><code class='language-R'>genRF(
  formula = NULL,
  train_data = NULL,
  pred_data = NULL,
  num_trees = num_trees,
  min_node_size = NULL,
  m_try = NULL,
  keep_inbag = TRUE,
  intervals = TRUE,
  alpha = alpha,
  forest_type = "RF",
  importance = "none",
  weights = NULL,
  num_threads = num_threads
)
</code></pre>

<hr>
<h2 id='genWeights'>Generate weights for RF through feature bias reduction method outlined in Tung 2014.</h2><span id='topic+genWeights'></span>

<h3>Description</h3>

<p>This function is primarily meant to be used within the TungUbRF() function. All parameters are same as in TungUbRF().
</p>


<h3>Usage</h3>

<pre><code class='language-R'>genWeights(
  formula = NULL,
  train_data = NULL,
  pred_data = NULL,
  feature_num_trees = feature_num_trees,
  min_node_size = NULL,
  m_try = NULL,
  keep_inbag = TRUE,
  intervals = TRUE,
  alpha = alpha,
  forest_type = "RF",
  importance = "permutation",
  R = R,
  num_threads = num_threads
)
</code></pre>

<hr>
<h2 id='GhosalBoostRF'>Implements RF prediction interval method in Ghosal, Hooker 2018. Helper function.</h2><span id='topic+GhosalBoostRF'></span>

<h3>Description</h3>

<p>This function implements variant one and two of the prediction interval methods in Ghosal, Hooker 2018. Used inside rfint().
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GhosalBoostRF(
  formula = NULL,
  train_data = NULL,
  pred_data = NULL,
  num_trees = NULL,
  min_node_size = NULL,
  m_try = NULL,
  keep_inbag = TRUE,
  intervals = FALSE,
  alpha = NULL,
  prop = NULL,
  variant = 1,
  num_threads = NULL,
  num_stages = NULL,
  interval_type = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="GhosalBoostRF_+3A_formula">formula</code></td>
<td>
<p>Object of class formula or character describing the model to fit. Interaction terms supported only for numerical variables.</p>
</td></tr>
<tr><td><code id="GhosalBoostRF_+3A_train_data">train_data</code></td>
<td>
<p>Training data of class data.frame, matrix, dgCMatrix (Matrix) or gwaa.data (GenABEL). Matches ranger() requirements.</p>
</td></tr>
<tr><td><code id="GhosalBoostRF_+3A_pred_data">pred_data</code></td>
<td>
<p>Test data of class data.frame, matrix, dgCMatrix (Matrix) or gwaa.data (GenABEL). Utilizes ranger::predict() to get prediction intervals for test data.</p>
</td></tr>
<tr><td><code id="GhosalBoostRF_+3A_num_trees">num_trees</code></td>
<td>
<p>Number of trees.</p>
</td></tr>
<tr><td><code id="GhosalBoostRF_+3A_min_node_size">min_node_size</code></td>
<td>
<p>Minimum number of observations before split at a node.</p>
</td></tr>
<tr><td><code id="GhosalBoostRF_+3A_m_try">m_try</code></td>
<td>
<p>Number of variables to randomly select from at each split.</p>
</td></tr>
<tr><td><code id="GhosalBoostRF_+3A_keep_inbag">keep_inbag</code></td>
<td>
<p>Saves matrix of observations and which tree(s) they occur in. Required to be true to generate variance estimates for Ghosal, Hooker 2018 method.</p>
</td></tr>
<tr><td><code id="GhosalBoostRF_+3A_intervals">intervals</code></td>
<td>
<p>Generate prediction intervals or not. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="GhosalBoostRF_+3A_alpha">alpha</code></td>
<td>
<p>Significance level for prediction intervals.</p>
</td></tr>
<tr><td><code id="GhosalBoostRF_+3A_prop">prop</code></td>
<td>
<p>Proportion of training data to sample for each tree. Currently variant 2 not implemented.</p>
</td></tr>
<tr><td><code id="GhosalBoostRF_+3A_variant">variant</code></td>
<td>
<p>Choose which variant to use. Currently variant 2 not implemented.</p>
</td></tr>
<tr><td><code id="GhosalBoostRF_+3A_num_threads">num_threads</code></td>
<td>
<p>The number of threads to use in parallel. Default is the current number of cores.</p>
</td></tr>
<tr><td><code id="GhosalBoostRF_+3A_num_stages">num_stages</code></td>
<td>
<p>Number of boosting stages. Functional for &gt;= 2; variance estimates need adjustment for variant 2.</p>
</td></tr>
<tr><td><code id="GhosalBoostRF_+3A_interval_type">interval_type</code></td>
<td>
<p>Type of prediction interval to generate.
Options are <code>method = c("two-sided", "lower", "upper")</code>. Default is  <code>method = "two-sided"</code>.</p>
</td></tr>
</table>

<hr>
<h2 id='GHVar'>Generate prediction intervals for Ghosal, Hooker 2018 implementation. Helper function.</h2><span id='topic+GHVar'></span>

<h3>Description</h3>

<p>This function is primarily meant to be used within GhosalBoostRF().
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GHVar(
  boostRF,
  train_data,
  pred_data,
  variant,
  dep,
  alpha,
  num_threads = num_threads,
  interval_type = interval_type
)
</code></pre>

<hr>
<h2 id='HDI_quantregforest'>Implements HDI RF prediction interval method in Zhu 2019. Helper function.</h2><span id='topic+HDI_quantregforest'></span>

<h3>Description</h3>

<p>This function implements an HDI RF prediction interval method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HDI_quantregforest(
  formula = NULL,
  train_data = NULL,
  test_data = NULL,
  alpha = NULL,
  num_tree = NULL,
  mtry = NULL,
  min_node_size = NULL,
  max_depth = NULL,
  replace = TRUE,
  verbose = FALSE,
  num_threads = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="HDI_quantregforest_+3A_formula">formula</code></td>
<td>
<p>Object of class formula or character describing the model to fit. Interaction terms supported only for numerical variables.</p>
</td></tr>
<tr><td><code id="HDI_quantregforest_+3A_train_data">train_data</code></td>
<td>
<p>Training data of class data.frame, matrix, dgCMatrix (Matrix) or gwaa.data (GenABEL). Matches ranger() requirements.</p>
</td></tr>
<tr><td><code id="HDI_quantregforest_+3A_test_data">test_data</code></td>
<td>
<p>Test data of class data.frame, matrix, dgCMatrix (Matrix) or gwaa.data (GenABEL). Utilizes ranger::predict() to get prediction intervals for test data.</p>
</td></tr>
<tr><td><code id="HDI_quantregforest_+3A_alpha">alpha</code></td>
<td>
<p>Significance level for prediction intervals.</p>
</td></tr>
<tr><td><code id="HDI_quantregforest_+3A_num_tree">num_tree</code></td>
<td>
<p>Number of trees.</p>
</td></tr>
<tr><td><code id="HDI_quantregforest_+3A_mtry">mtry</code></td>
<td>
<p>Number of variables to randomly select from at each split.</p>
</td></tr>
<tr><td><code id="HDI_quantregforest_+3A_min_node_size">min_node_size</code></td>
<td>
<p>Minimum number of observations before split at a node.</p>
</td></tr>
<tr><td><code id="HDI_quantregforest_+3A_max_depth">max_depth</code></td>
<td>
<p>maximum depth of each tree in RF. ranger parameter.</p>
</td></tr>
<tr><td><code id="HDI_quantregforest_+3A_replace">replace</code></td>
<td>
<p>Sample with replacement, or not. Utilized for the two different variants outlined in Ghosal, Hooker 2018. Currently variant 2 not implemented.</p>
</td></tr>
<tr><td><code id="HDI_quantregforest_+3A_num_threads">num_threads</code></td>
<td>
<p>The number of threads to use in parallel. Default is the current number of cores.</p>
</td></tr>
</table>

<hr>
<h2 id='parse.formula'>Authors: Marvin N. Wright, Gregor DeCillia</h2><span id='topic+parse.formula'></span>

<h3>Description</h3>

<p>taken from source code for ranger package; not exported with package
</p>


<h3>Usage</h3>

<pre><code class='language-R'>parse.formula(formula, data, env = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="parse.formula_+3A_formula">formula</code></td>
<td>
<p>Object of class <code>formula</code> or <code>character</code> describing the model to fit.</p>
</td></tr>
<tr><td><code id="parse.formula_+3A_data">data</code></td>
<td>
<p>Training data of class <code>data.frame</code>.</p>
</td></tr>
<tr><td><code id="parse.formula_+3A_env">env</code></td>
<td>
<p>The environment in which the left hand side of <code>formula</code> is evaluated.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Parse formula and return dataset containing selected columns.
Interactions are supported for numerical columns only.
An interaction column is the product of all interacting columns.
</p>


<h3>Value</h3>

<p>Dataset including selected columns and interactions.
</p>

<hr>
<h2 id='predictionUbRF'>Performs prediction debiasing from Tung 2014</h2><span id='topic+predictionUbRF'></span>

<h3>Description</h3>

<p>This function is primarily meant to be used within the TungUbRF() function. All parameters are same as in TungUbRF().
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predictionUbRF(
  rf,
  formula = NULL,
  train_data = NULL,
  pred_data = NULL,
  num_trees = NULL,
  min_node_size = NULL,
  m_try = NULL,
  keep_inbag = TRUE,
  intervals = TRUE,
  alpha = alpha,
  forest_type = "QRF",
  weights = NULL,
  num_threads = num_threads,
  interval_type = NULL
)
</code></pre>

<hr>
<h2 id='rfint'>rfint()</h2><span id='topic+rfint'></span>

<h3>Description</h3>

<p>Implements seven different random forest prediction interval methods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rfint(
  formula = formula,
  train_data = NULL,
  test_data = NULL,
  method = "Zhang",
  alpha = 0.1,
  symmetry = TRUE,
  seed = NULL,
  m_try = 2,
  num_trees = 500,
  min_node_size = 5,
  num_threads = parallel::detectCores(),
  calibrate = FALSE,
  Roy_method = "quantile",
  featureBias = FALSE,
  predictionBias = TRUE,
  Tung_R = 5,
  Tung_num_trees = 75,
  variant = 1,
  Ghosal_num_stages = 2,
  prop = 0.618,
  concise = TRUE,
  interval_type = "two-sided"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rfint_+3A_formula">formula</code></td>
<td>
<p>Object of class formula or character describing the model to fit. Interaction terms supported only for numerical variables.</p>
</td></tr>
<tr><td><code id="rfint_+3A_train_data">train_data</code></td>
<td>
<p>Training data of class data.frame.</p>
</td></tr>
<tr><td><code id="rfint_+3A_test_data">test_data</code></td>
<td>
<p>Test data of class data.frame. Utilizes ranger::predict() to produce prediction intervals for test data.</p>
</td></tr>
<tr><td><code id="rfint_+3A_method">method</code></td>
<td>
<p>Choose what method to generate RF prediction intervals. Options are <code>method = c("Zhang", "quantile", "Romano", "Ghosal", "Roy", "Tung", "HDI")</code>. Defaults to <code>method = "Zhang"</code>.</p>
</td></tr>
<tr><td><code id="rfint_+3A_alpha">alpha</code></td>
<td>
<p>Significance level for prediction intervals. Defaults to <code>alpha = 0.1</code>.</p>
</td></tr>
<tr><td><code id="rfint_+3A_symmetry">symmetry</code></td>
<td>
<p>True if constructing symmetric out-of-bag prediction intervals, False otherwise. Used only <code>method = "Zhang"</code>. Defaults to <code>symmetry = TRUE</code>.</p>
</td></tr>
<tr><td><code id="rfint_+3A_seed">seed</code></td>
<td>
<p>Seed for random number generation. Currently not utilized.</p>
</td></tr>
<tr><td><code id="rfint_+3A_m_try">m_try</code></td>
<td>
<p>Number of variables to randomly select from at each split.</p>
</td></tr>
<tr><td><code id="rfint_+3A_num_trees">num_trees</code></td>
<td>
<p>Number of trees used in the random forest.</p>
</td></tr>
<tr><td><code id="rfint_+3A_min_node_size">min_node_size</code></td>
<td>
<p>Minimum number of observations before split at a node.</p>
</td></tr>
<tr><td><code id="rfint_+3A_num_threads">num_threads</code></td>
<td>
<p>The number of threads to use in parallel. Default is the current number of cores.</p>
</td></tr>
<tr><td><code id="rfint_+3A_calibrate">calibrate</code></td>
<td>
<p>If <code>calibrate = TRUE</code>, intervals are calibrated to achieve nominal coverage. Currently uses quantiles to calibrate. Only for <code>method = "Roy"</code>.</p>
</td></tr>
<tr><td><code id="rfint_+3A_roy_method">Roy_method</code></td>
<td>
<p>Interval method for <code>method = "Roy"</code>.
Options are <code>Roy_method = c("quantile", "HDI", "CHDI")</code>.</p>
</td></tr>
<tr><td><code id="rfint_+3A_featurebias">featureBias</code></td>
<td>
<p>Remove feature bias. Only for <code>method = "Tung"</code>.</p>
</td></tr>
<tr><td><code id="rfint_+3A_predictionbias">predictionBias</code></td>
<td>
<p>Remove prediction bias. Only for <code>method = "Tung"</code>.</p>
</td></tr>
<tr><td><code id="rfint_+3A_tung_r">Tung_R</code></td>
<td>
<p>Number of repetitions used in bias removal. Only for <code>method = "Tung"</code>.</p>
</td></tr>
<tr><td><code id="rfint_+3A_tung_num_trees">Tung_num_trees</code></td>
<td>
<p>Number of trees used in bias removal. Only for <code>method = "Tung"</code>.</p>
</td></tr>
<tr><td><code id="rfint_+3A_variant">variant</code></td>
<td>
<p>Choose which variant to use. Options are <code>method = c("1", "2")</code>. Only for <code>method = "Ghosal"</code>.</p>
</td></tr>
<tr><td><code id="rfint_+3A_ghosal_num_stages">Ghosal_num_stages</code></td>
<td>
<p>Number of total stages. Only for <code>method = "Ghosal"</code>.</p>
</td></tr>
<tr><td><code id="rfint_+3A_prop">prop</code></td>
<td>
<p>Proportion of training data to sample for each tree. Only for <code>method = "Ghosal"</code>.</p>
</td></tr>
<tr><td><code id="rfint_+3A_concise">concise</code></td>
<td>
<p>If  concise = TRUE, only predictions output. Defaults to <code>concise = FALSE</code>.</p>
</td></tr>
<tr><td><code id="rfint_+3A_interval_type">interval_type</code></td>
<td>
<p>Type of prediction interval to generate.
Options are <code>method = c("two-sided", "lower", "upper")</code>. Default is  <code>method = "two-sided"</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The seven methods implemented are cited in the References section.
Additional information can be found within those references.
Each of these methods are implemented by utilizing the ranger package.
For <code>method = "Zhang"</code>, prediction intervals are generated using out-of-bag residuals.
<code>method = "Romano"</code> utilizes a split-conformal approach.
<code>method = "Roy"</code> uses a bag-of-predictors approach.
<code>method = "Ghosal"</code> performs boosting to reduce bias in the random forest, and estimates variance.
The authors provide multiple variants to their methodology.
<code>method = "Tung"</code> debiases feature selection and prediction. Prediction intervals are generated using quantile regression forests.
<code>method = "HDI"</code> delivers prediction intervals through highest-density interval regression forests.
<code>method = "quantile"</code> utilizes quantile regression forests.
</p>


<h3>Value</h3>

<table>
<tr><td><code>int</code></td>
<td>
<p>Default output. Includes prediction intervals for all methods in <code>methods</code>.</p>
</td></tr>
<tr><td><code>preds</code></td>
<td>
<p>Predictions for test data for all methods in <code>methods</code>. Output when <code>concise = FALSE</code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Chancellor Johnstone
</p>
<p>Haozhe Zhang
</p>


<h3>References</h3>

<p>Breiman L (2001).
&ldquo;Random forests.&rdquo;
<em>Machine learning</em>, <b>45</b>(1), 5&ndash;32.
<a href="https://link.springer.com/article/10.1023/A:1010933404324">https://link.springer.com/article/10.1023/A:1010933404324</a>.
</p>
<p>Ghosal I, Hooker G (2018).
&ldquo;Boosting random forests to reduce bias; one-step boosted forest and its variance estimate.&rdquo;
<em>arXiv preprint</em>.
<a href="https://arxiv.org/pdf/1803.08000.pdf">https://arxiv.org/pdf/1803.08000.pdf</a>.
</p>
<p>Meinshausen N (2006).
&ldquo;Quantile regression forests.&rdquo;
<em>Journal of Machine Learning Research</em>, <b>7</b>(Jun), 983&ndash;999.
<a href="http://www.jmlr.org/papers/volume7/meinshausen06a/meinshausen06a.pdf">http://www.jmlr.org/papers/volume7/meinshausen06a/meinshausen06a.pdf</a>.
</p>
<p>Romano Y, Patterson E, Candes E (2019).
&ldquo;Conformalized quantile regression.&rdquo;
<em>arXiv preprint</em>.
<a href="https://arxiv.org/pdf/1905.03222v1.pdf">https://arxiv.org/pdf/1905.03222v1.pdf</a>.
</p>
<p>Roy M, Larocque D (2019).
&ldquo;Prediction intervals with random forests.&rdquo;
<em>Statistical methods in medical research</em>.
<a href="https://doi.org/10.1177/0962280219829885">https://doi.org/10.1177/0962280219829885</a>.
</p>
<p>Tung NT, Huang JZ, Nguyen TT, Khan I (2014).
&ldquo;Bias-corrected quantile regression forests for high-dimensional data.&rdquo;
In <em>2014 International Conference on Machine Learning and Cybernetics</em>, volume 1, 1&ndash;6.
IEEE.
<a href="https://link.springer.com/article/10.1007/s10994-014-5452-1">https://link.springer.com/article/10.1007/s10994-014-5452-1</a>.
</p>
<p>Zhang H, Zimmerman J, Nettleton D, Nordman DJ (2019).
&ldquo;Random forest prediction intervals.&rdquo;
<em>The American Statistician</em>, 1&ndash;15.
<a href="https://doi.org/10.1080/00031305.2019.1585288">https://doi.org/10.1080/00031305.2019.1585288</a>.
</p>
<p>Zhu L, Lu J, Chen Y (2019).
&ldquo;HDI-Forest: Highest density interval regression forest.&rdquo;
<em>arXiv preprint</em>.
<a href="https://arxiv.org/pdf/1905.10101.pdf">https://arxiv.org/pdf/1905.10101.pdf</a>.
</p>


<h3>See Also</h3>

<p><a href="ranger.html#topic+ranger">ranger</a>
</p>
<p><a href="rfinterval.html#topic+rfinterval">rfinterval</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(piRF)

#functions to get average length and average coverage of output
getPILength &lt;- function(x){
#average PI length across each set of predictions
l &lt;- x[,2] - x[,1]
avg_l &lt;- mean(l)
return(avg_l)
}

getCoverage &lt;- function(x, response){
  #output coverage for test data
  coverage &lt;- sum((response &gt;= x[,1]) * (response &lt;= x[,2]))/length(response)
  return(coverage)
}

#import airfoil self noise dataset
data(airfoil)
method_vec &lt;- c("quantile", "Zhang", "Tung", "Romano", "Roy", "HDI", "Ghosal")
#generate train and test data
ratio &lt;- .975
nrow &lt;- nrow(airfoil)
n &lt;- floor(nrow*ratio)
samp &lt;- sample(1:nrow, size = n)
train &lt;- airfoil[samp,]
test &lt;- airfoil[-samp,]

#generate prediction intervals
res &lt;- rfint(pressure ~ . , train_data = train, test_data = test,
             method = method_vec,
             concise= FALSE,
             num_threads = 1)

#empirical coverage, and average prediction interval length for each method
coverage &lt;- sapply(res$int, FUN = getCoverage, response = test$pressure)
coverage
length &lt;- sapply(res$int, FUN = getPILength)
length

#get current mfrow setting
opar &lt;- par(mfrow = c(2,2))

#plotting intervals and predictions
for(i in 1:7){
   col &lt;- ((test$pressure &gt;= res$int[[i]][,1]) *
   (test$pressure &lt;= res$int[[i]][,2])-1)*(-1)+1
   plot(x = res$preds[[i]], y = test$pressure, pch = 20,
      col = "black", ylab = "true", xlab = "predicted", main = method_vec[i])
   abline(a = 0, b = 1)
   segments(x0 = res$int[[i]][,1], x1 = res$int[[i]][,2],
      y1 = test$pressure, y0 = test$pressure, lwd = 1, col = col)
}
par(opar)

</code></pre>

<hr>
<h2 id='RoyRF'>implements RF prediction interval method in Roy, Larocque 2019. Helper function.</h2><span id='topic+RoyRF'></span>

<h3>Description</h3>

<p>Currently implemented is the quantile method with BOP intervals. Used inside rfint().
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RoyRF(
  formula = NULL,
  train_data = NULL,
  pred_data = NULL,
  num_trees = NULL,
  min_node_size = NULL,
  m_try = NULL,
  keep_inbag = TRUE,
  intervals = TRUE,
  interval_method = "quantile",
  calibrate = FALSE,
  alpha = NULL,
  num_threads = NULL,
  tolerance = NULL,
  step_percent = NULL,
  under = NULL,
  method = NULL,
  max_iter = NULL,
  interval_type = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="RoyRF_+3A_formula">formula</code></td>
<td>
<p>Object of class formula or character describing the model to fit. Interaction terms supported only for numerical variables.</p>
</td></tr>
<tr><td><code id="RoyRF_+3A_train_data">train_data</code></td>
<td>
<p>Training data of class data.frame, matrix, dgCMatrix (Matrix) or gwaa.data (GenABEL). Matches ranger() requirements.</p>
</td></tr>
<tr><td><code id="RoyRF_+3A_pred_data">pred_data</code></td>
<td>
<p>Test data of class data.frame, matrix, dgCMatrix (Matrix) or gwaa.data (GenABEL). Utilizes ranger::predict() to get prediction intervals for test data.</p>
</td></tr>
<tr><td><code id="RoyRF_+3A_num_trees">num_trees</code></td>
<td>
<p>Number of trees.</p>
</td></tr>
<tr><td><code id="RoyRF_+3A_min_node_size">min_node_size</code></td>
<td>
<p>Minimum number of observations before split at a node.</p>
</td></tr>
<tr><td><code id="RoyRF_+3A_m_try">m_try</code></td>
<td>
<p>Number of variables to randomly select from at each split.</p>
</td></tr>
<tr><td><code id="RoyRF_+3A_keep_inbag">keep_inbag</code></td>
<td>
<p>Saves matrix of observations and which tree(s) they occur in. Required to be true to generate variance estimates for Ghosal, Hooker 2018 method. *Should not be an option...</p>
</td></tr>
<tr><td><code id="RoyRF_+3A_intervals">intervals</code></td>
<td>
<p>Generate prediction intervals or not.</p>
</td></tr>
<tr><td><code id="RoyRF_+3A_interval_method">interval_method</code></td>
<td>
<p>which prediction interval type to generate. Several outlined in paper; currently only one method implemented.</p>
</td></tr>
<tr><td><code id="RoyRF_+3A_calibrate">calibrate</code></td>
<td>
<p>calibrate prediction intervals based on out-of-bag performance. Adjusts alpha to get nominal coverage.</p>
</td></tr>
<tr><td><code id="RoyRF_+3A_alpha">alpha</code></td>
<td>
<p>Significance level for prediction intervals.</p>
</td></tr>
<tr><td><code id="RoyRF_+3A_num_threads">num_threads</code></td>
<td>
<p>The number of threads to use in parallel. Default is the current number of cores.</p>
</td></tr>
<tr><td><code id="RoyRF_+3A_interval_type">interval_type</code></td>
<td>
<p>Type of prediction interval to generate.
Options are <code>method = c("two-sided", "lower", "upper")</code>. Default is  <code>method = "two-sided"</code>.</p>
</td></tr>
</table>

<hr>
<h2 id='TungUbRF'>Implements RF prediction interval method in Tung, Huang, Nyugen, Khan 2014.</h2><span id='topic+TungUbRF'></span>

<h3>Description</h3>

<p>This function implements the feature bias and prediction bias methods outlined in Tung 2014.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TungUbRF(
  formula = NULL,
  train_data = NULL,
  pred_data = NULL,
  num_trees = NULL,
  min_node_size = NULL,
  m_try = NULL,
  keep_inbag = TRUE,
  intervals = TRUE,
  feature_num_trees = NULL,
  alpha = NULL,
  forest_type = "QRF",
  featureBias = TRUE,
  predictionBias = TRUE,
  R = NULL,
  num_threads = NULL,
  interval_type = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="TungUbRF_+3A_formula">formula</code></td>
<td>
<p>Object of class formula or character describing the model to fit. Interaction terms supported only for numerical variables.</p>
</td></tr>
<tr><td><code id="TungUbRF_+3A_train_data">train_data</code></td>
<td>
<p>Training data of class data.frame, matrix, dgCMatrix (Matrix) or gwaa.data (GenABEL). Matches ranger() requirements.</p>
</td></tr>
<tr><td><code id="TungUbRF_+3A_pred_data">pred_data</code></td>
<td>
<p>Test data of class data.frame, matrix, dgCMatrix (Matrix) or gwaa.data (GenABEL). Utilizes ranger::predict() to get prediction intervals for test data.</p>
</td></tr>
<tr><td><code id="TungUbRF_+3A_num_trees">num_trees</code></td>
<td>
<p>Number of trees.</p>
</td></tr>
<tr><td><code id="TungUbRF_+3A_min_node_size">min_node_size</code></td>
<td>
<p>Minimum number of observations before split at a node.</p>
</td></tr>
<tr><td><code id="TungUbRF_+3A_m_try">m_try</code></td>
<td>
<p>Number of variables to randomly select from at each split.</p>
</td></tr>
<tr><td><code id="TungUbRF_+3A_keep_inbag">keep_inbag</code></td>
<td>
<p>Saves matrix of observations and which tree(s) they occur in. Required to be true to generate variance estimates for Ghosal, Hooker 2018 method. *Should not be an option...</p>
</td></tr>
<tr><td><code id="TungUbRF_+3A_intervals">intervals</code></td>
<td>
<p>Generate prediction intervals or not.</p>
</td></tr>
<tr><td><code id="TungUbRF_+3A_alpha">alpha</code></td>
<td>
<p>Significance level for prediction intervals.</p>
</td></tr>
<tr><td><code id="TungUbRF_+3A_featurebias">featureBias</code></td>
<td>
<p>perform feature bias step.</p>
</td></tr>
<tr><td><code id="TungUbRF_+3A_predictionbias">predictionBias</code></td>
<td>
<p>perform prediction bias.</p>
</td></tr>
<tr><td><code id="TungUbRF_+3A_r">R</code></td>
<td>
<p>number of RFs generated in feature bias stage of Tung 2014 prediction interval. Defualt is 10.</p>
</td></tr>
<tr><td><code id="TungUbRF_+3A_num_threads">num_threads</code></td>
<td>
<p>The number of threads to use in parallel. Default is the current number of cores.</p>
</td></tr>
<tr><td><code id="TungUbRF_+3A_interval_type">interval_type</code></td>
<td>
<p>Type of prediction interval to generate.
Options are <code>method = c("two-sided", "lower", "upper")</code>. Default is  <code>method = "two-sided"</code>.</p>
</td></tr>
<tr><td><code id="TungUbRF_+3A_feature_num_tree">feature_num_tree</code></td>
<td>
<p>number of trees to be used in ech random forest generated for feature bias step.</p>
</td></tr>
</table>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
