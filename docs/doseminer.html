<!DOCTYPE html><html><head><title>Help for package doseminer</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {doseminer}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#doseminer-package'><p>doseminer: Extract Drug Dosages from Free-Text Prescriptions</p></a></li>
<li><a href='#clean_prescription_text'><p>Clean up raw prescription freetext</p></a></li>
<li><a href='#cprd'><p>Sample electronic prescribing dataset</p></a></li>
<li><a href='#drug_units'><p>Medication dosage units</p></a></li>
<li><a href='#example_cprd'><p>Example freetext prescriptions</p></a></li>
<li><a href='#example_prescriptions'><p>Example freetext prescriptions</p></a></li>
<li><a href='#extract_dose_unit'><p>Extract units of dose from freetext prescriptions.</p></a></li>
<li><a href='#extract_from_prescription'><p>Extract dosage information from free-text English-language prescriptions</p></a></li>
<li><a href='#hourly_to_daily'><p>Convert hourly to daily frequency</p></a></li>
<li><a href='#latin_medical_terms'><p>List of Latin medical and pharmaceutical abbreviations</p></a></li>
<li><a href='#multiply_dose'><p>Evaluate a multiplicative plaintext expression</p></a></li>
<li><a href='#numb_replacements'><p>Dictionary of English names of numbers</p></a></li>
<li><a href='#regex_numbers'><p>Regular expression to match numbers in English</p></a></li>
<li><a href='#replace_numbers'><p>Replace English number phrases with their decimal representations</p></a></li>
<li><a href='#weekly_to_daily'><p>Convert weekly interval to daily interval</p></a></li>
<li><a href='#words2number'><p>Convert English names of numbers to their numerical values</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Extract Drug Dosages from Free-Text Prescriptions</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.2</td>
</tr>
<tr>
<td>Description:</td>
<td>Utilities for converting unstructured electronic prescribing instructions into structured medication data. Extracts drug dose, units, daily dosing frequency and intervals from English-language prescriptions. Based on Karystianis et al. (2015) &lt;<a href="https://doi.org/10.1186%2Fs12911-016-0255-x">doi:10.1186/s12911-016-0255-x</a>&gt;.</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/Selbosh/doseminer/issues">https://github.com/Selbosh/doseminer/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>magrittr(&ge; 2.0.1), stringr(&ge; 1.4.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>rmarkdown, knitr, testthat, tidyr, dplyr, ggplot2, prettydoc</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Language:</td>
<td>en-GB</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-07-19 10:27:42 UTC; David</td>
</tr>
<tr>
<td>Author:</td>
<td>David Selby <a href="https://orcid.org/0000-0001-8026-5663"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre],
  Belay Birlie Yimer [ctb],
  Ben Marwick [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>David Selby &lt;david.selby@manchester.ac.uk&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-07-19 10:40:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='doseminer-package'>doseminer: Extract Drug Dosages from Free-Text Prescriptions</h2><span id='topic+doseminer'></span><span id='topic+doseminer-package'></span>

<h3>Description</h3>

<p>Utilities for converting unstructured electronic prescribing instructions into structured medication data. Extracts drug dose, units, daily dosing frequency and intervals from English-language prescriptions. Based on Karystianis et al. (2015) &lt;doi:10.1186/s12911-016-0255-x&gt;.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: David Selby <a href="mailto:david.selby@manchester.ac.uk">david.selby@manchester.ac.uk</a> (<a href="https://orcid.org/0000-0001-8026-5663">ORCID</a>)
</p>
<p>Other contributors:
</p>

<ul>
<li><p> Belay Birlie Yimer <a href="mailto:belaybirlie.yimer@manchester.ac.uk">belaybirlie.yimer@manchester.ac.uk</a> [contributor]
</p>
</li>
<li><p> Ben Marwick <a href="mailto:benmarwick@gmail.com">benmarwick@gmail.com</a> [contributor]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li><p> Report bugs at <a href="https://github.com/Selbosh/doseminer/issues">https://github.com/Selbosh/doseminer/issues</a>
</p>
</li></ul>


<hr>
<h2 id='clean_prescription_text'>Clean up raw prescription freetext</h2><span id='topic+clean_prescription_text'></span>

<h3>Description</h3>

<p>Clean up raw prescription freetext
</p>


<h3>Usage</h3>

<pre><code class='language-R'>clean_prescription_text(txt)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="clean_prescription_text_+3A_txt">txt</code></td>
<td>
<p>a character vector</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a character vector the same length as <code>txt</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>clean_prescription_text(example_prescriptions)

</code></pre>

<hr>
<h2 id='cprd'>Sample electronic prescribing dataset</h2><span id='topic+cprd'></span>

<h3>Description</h3>

<p>A dataset containing product codes, patient identifiers, quantities, dates
and free-text dose instructions, similar to data provided by the Clinical
Practice Research Datalink (CPRD).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cprd
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 714 rows and 6 columns.
</p>


<h3>Details</h3>

<p>Variables in the data include
</p>

<dl>
<dt>id</dt><dd><p>record identifier</p>
</dd>
<dt>patid</dt><dd><p>patient identifier</p>
</dd>
<dt>date</dt><dd><p>date of start of prescription</p>
</dd>
<dt>prodcode</dt><dd><p>product code; identifier for the prescribed medication</p>
</dd>
<dt>qty</dt><dd><p>total quantity of medication prescribed</p>
</dd>
<dt>text</dt><dd><p>free text prescribing instructions</p>
</dd>
</dl>


<hr>
<h2 id='drug_units'>Medication dosage units</h2><span id='topic+drug_units'></span>

<h3>Description</h3>

<p>A named character vector. Names represent patterns to match dose units
and values represent standardised names for those units.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>drug_units
</code></pre>


<h3>Format</h3>

<p>An object of class <code>character</code> of length 28.
</p>


<h3>Details</h3>

<p>Use with a function like <code><a href="stringr.html#topic+str_replace">str_replace_all</a></code>
to standardise a freetext prescription. Used internally in
<code><a href="#topic+extract_from_prescription">extract_from_prescription</a></code>.
</p>

<hr>
<h2 id='example_cprd'>Example freetext prescriptions</h2><span id='topic+example_cprd'></span>

<h3>Description</h3>

<p>Adapted from CPRD common dosages
</p>


<h3>Usage</h3>

<pre><code class='language-R'>example_cprd
</code></pre>


<h3>Format</h3>

<p>An object of class <code>character</code> of length 28.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+example_prescriptions">example_prescriptions</a></code>
</p>

<hr>
<h2 id='example_prescriptions'>Example freetext prescriptions</h2><span id='topic+example_prescriptions'></span>

<h3>Description</h3>

<p>Various examples of how prescription data may be represented in free text.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>example_prescriptions
</code></pre>


<h3>Format</h3>

<p>An object of class <code>character</code> of length 27.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+example_cprd">example_cprd</a></code>
</p>

<hr>
<h2 id='extract_dose_unit'>Extract units of dose from freetext prescriptions.</h2><span id='topic+extract_dose_unit'></span>

<h3>Description</h3>

<p>A function used internally in <code><a href="#topic+extract_from_prescription">extract_from_prescription</a></code> to
parse the dosage units, such as millilitres, tablets, grams and so on.
If there are multiple units mentioned in a string, only the first is returned.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_dose_unit(txt)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_dose_unit_+3A_txt">txt</code></td>
<td>
<p>a character vector</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character vector the same length as <code>txt</code>, containing
standardised units, or <code>NA</code> if no units were found in the prescription.
</p>
<p>A simple wrapper around <code><a href="stringr.html#topic+str_replace">str_replace_all</a></code> and
<code><a href="stringr.html#topic+str_extract">str_extract</a></code>.
Based on <code>add_dose_unit.py</code> from original Python/Java algorithm.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+extract_from_prescription">extract_from_prescription</a></code>
</p>

<hr>
<h2 id='extract_from_prescription'>Extract dosage information from free-text English-language prescriptions</h2><span id='topic+extract_from_prescription'></span>

<h3>Description</h3>

<p>This is the main workhorse function for the <code>doseminer</code> package.
Pass in a character vector of prescribing instructions and it will extract
structured dosage information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_from_prescription(txt)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_from_prescription_+3A_txt">txt</code></td>
<td>
<p>A character vector of freetext prescriptions</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To avoid redundant computation, it is recommended to remove duplicate
elements from the input vector. The results can be joined back to the
original data using the <code>raw</code> column.
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> with seven columns:
</p>

<dl>
<dt>raw</dt><dd><p>the input character vector</p>
</dd>
<dt>output</dt><dd><p>a residual character vector of 'non-extracted' text. For debugging.</p>
</dd>
<dt>freq</dt><dd><p>number of doses administered per day</p>
</dd>
<dt>itvl</dt><dd><p>number of days between doses</p>
</dd>
<dt>dose</dt><dd><p>quantity of medication in each dose</p>
</dd>
<dt>unit</dt><dd><p>unit of measurement of medication, if any</p>
</dd>
<dt>optional</dt><dd><p>integer. Can the dose be zero? 1 if yes, otherwise 0</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>extract_from_prescription(example_prescriptions)

</code></pre>

<hr>
<h2 id='hourly_to_daily'>Convert hourly to daily frequency</h2><span id='topic+hourly_to_daily'></span>

<h3>Description</h3>

<p>Convert hourly to daily frequency
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hourly_to_daily(txt)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hourly_to_daily_+3A_txt">txt</code></td>
<td>
<p>String of the form 'every n hours'</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An equivalent string of the form 'x / day'
</p>

<hr>
<h2 id='latin_medical_terms'>List of Latin medical and pharmaceutical abbreviations</h2><span id='topic+latin_medical_terms'></span>

<h3>Description</h3>

<p>A named character vector. Names represent Latin terms and values the English
translations. Used for converting terms like &quot;q4h&quot; into &quot;every 4 hours&quot;,
which can then be parsed into a dosage frequency/interval.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>latin_medical_terms
</code></pre>


<h3>Format</h3>

<p>An object of class <code>character</code> of length 47.
</p>


<h3>Details</h3>

<p>Use with a function like <code><a href="stringr.html#topic+str_replace">str_replace_all</a></code>
to translate a prescription from Latin to English (thence to numbers).
</p>


<h3>Source</h3>

<p><a href="https://en.wikipedia.org/wiki/List_of_abbreviations_used_in_medical_prescriptions">https://en.wikipedia.org/wiki/List_of_abbreviations_used_in_medical_prescriptions</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>stringr::str_replace_all('Take two tablets q4h', latin_medical_terms)

</code></pre>

<hr>
<h2 id='multiply_dose'>Evaluate a multiplicative plaintext expression</h2><span id='topic+multiply_dose'></span>

<h3>Description</h3>

<p>Replaces written phrases like &quot;2 x 5&quot; with their arithmetic result (i.e. 10)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>multiply_dose(axb)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="multiply_dose_+3A_axb">axb</code></td>
<td>
<p>An string expression of the form 'A x B' where A, B are numeric</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An equivalent string giving the product of <code>A</code> and <code>B</code>.
If <code>A</code> is a range of values, a range of values is returned.
</p>


<h3>See Also</h3>

<p>Used internally within <code><a href="#topic+extract_from_prescription">extract_from_prescription</a></code>
</p>

<hr>
<h2 id='numb_replacements'>Dictionary of English names of numbers</h2><span id='topic+numb_replacements'></span>

<h3>Description</h3>

<p>For internal use in <code><a href="#topic+words2number">words2number</a></code>. When passed as a replacement
to a function like
<code><a href="stringr.html#topic+str_replace">str_replace_all</a></code>, it turns the
string into an arithmetic expression that can be evaluated to give an integer
representation of the named number.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>numb_replacements
</code></pre>


<h3>Format</h3>

<p>An object of class <code>character</code> of length 49.
</p>


<h3>Details</h3>

<p>Lifted from Ben Marwick's <code>words2number</code> package and converted into
a named vector (previously a chain of <code><a href="base.html#topic+gsub">gsub</a></code> calls).
</p>


<h3>Note</h3>

<p>Does not yet fully support decimals, fractions or mixed fractions.
Some limited support for 'half' expressions, e.g. 'one and a half'.
</p>


<h3>Source</h3>

<p><a href="https://github.com/benmarwick/words2number">https://github.com/benmarwick/words2number</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
stringr::str_replace_all('one hundred and forty-two', numb_replacements)

## End(Not run)

</code></pre>

<hr>
<h2 id='regex_numbers'>Regular expression to match numbers in English</h2><span id='topic+regex_numbers'></span>

<h3>Description</h3>

<p>A regex pattern to identify natural language English number phrases, such as
&quot;one hundred and fifty&quot; or &quot;thirty-seven&quot;. Used internally by
<code><a href="#topic+replace_numbers">replace_numbers</a></code> to identify substrings to replace with their
decimal representation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>regex_numbers
</code></pre>


<h3>Format</h3>

<p>An object of class <code>character</code> of length 1.
</p>


<h3>Details</h3>

<p>This is a PCRE (Perl type) regular expression, so it must be used with
<code>perl = TRUE</code> in base R regex functions. The packages <code>stringr</code>
and <code>stringi</code> are based on the alternative ICU regular expression
engine, so they cannot use this pattern.
</p>


<h3>Note</h3>

<p>There is limited support for fractional expressions like &quot;one half&quot;.
The original pattern did not support expressions like &quot;a thousand&quot;, but
it has been adapted to offer (experimental) support for this.
Phrases like &quot;million&quot; or &quot;thousand&quot; with no prefix will <em>not</em> match.
</p>


<h3>Source</h3>

<p><a href="https://www.rexegg.com/regex-trick-numbers-in-english.html">https://www.rexegg.com/regex-trick-numbers-in-english.html</a>
</p>

<hr>
<h2 id='replace_numbers'>Replace English number phrases with their decimal representations</h2><span id='topic+replace_numbers'></span>

<h3>Description</h3>

<p>Uses <code><a href="#topic+numb_replacements">numb_replacements</a></code> to match parts of a string corresponding
to numbers, then invokes <code><a href="#topic+words2number">words2number</a></code> to convert these
substrings to numeric. The rest of the string (the non-number words) is
left intact.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>replace_numbers(string)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="replace_numbers_+3A_string">string</code></td>
<td>
<p>A character vector. Can contain numbers and other text</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Works on non-negative integer numbers under one billion
(one thousand million). Does not support fractions or decimals (yet).
</p>


<h3>Value</h3>

<p>A character vector the same length as <code>string</code>, with words
replaced by their decimal representations.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+words2number">words2number</a></code>, for use on cleaned text that does not contain
any non-number words
</p>


<h3>Examples</h3>

<pre><code class='language-R'>replace_numbers('Two plus two equals four')
replace_numbers('one hundred thousand dollars!')
replace_numbers(c('A vector', 'containing numbers', 'like thirty seven'))

</code></pre>

<hr>
<h2 id='weekly_to_daily'>Convert weekly interval to daily interval</h2><span id='topic+weekly_to_daily'></span>

<h3>Description</h3>

<p>Convert weekly interval to daily interval
</p>


<h3>Usage</h3>

<pre><code class='language-R'>weekly_to_daily(Dperweek)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="weekly_to_daily_+3A_dperweek">Dperweek</code></td>
<td>
<p>String of the form 'n / week'</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An equivalent string of the form 'x / day'
</p>

<hr>
<h2 id='words2number'>Convert English names of numbers to their numerical values</h2><span id='topic+words2number'></span>

<h3>Description</h3>

<p>Convert English names of numbers to their numerical values
</p>


<h3>Usage</h3>

<pre><code class='language-R'>words2number(txt)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="words2number_+3A_txt">txt</code></td>
<td>
<p>A character vector containing names of numbers (only).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A named numeric vector of the same length as <code>phrase</code>.
</p>


<h3>Source</h3>

<p>Originally adapted from the
<a href="https://github.com/benmarwick/words2number"><code>words2number</code></a> package by
Ben Marwick.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>words2number('seven')
words2number('forty-two')
words2number(c('three', 'one', 'twenty two thousand'))

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
