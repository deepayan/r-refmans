<!DOCTYPE html><html><head><title>Help for package eventPred</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {eventPred}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#eventPred-package'><p>Event Prediction</p></a></li>
<li><a href='#finalData'><p>Final enrollment and event data after achieving the target number of events</p></a></li>
<li><a href='#fitDropout'><p>Fit time-to-dropout model</p></a></li>
<li><a href='#fitEnrollment'><p>Fit enrollment model</p></a></li>
<li><a href='#fitEvent'><p>Fit time-to-event model</p></a></li>
<li><a href='#getPrediction'><p>Enrollment and event prediction</p></a></li>
<li><a href='#interimData1'><p>Interim enrollment and event data before enrollment completion</p></a></li>
<li><a href='#interimData2'><p>Interim enrollment and event data after enrollment completion</p></a></li>
<li><a href='#llik_pwexp'><p>Log likelihood for piecewise exponential regression</p></a></li>
<li><a href='#pmodavg'><p>Distribution function for model averaging of Weibull and log-normal</p></a></li>
<li><a href='#ppwexp'><p>Distribution function for piecewise exponential regression</p></a></li>
<li><a href='#predictEnrollment'><p>Predict enrollment</p></a></li>
<li><a href='#predictEvent'><p>Predict event</p></a></li>
<li><a href='#pwexpreg'><p>Piecewise exponential regression</p></a></li>
<li><a href='#qpwexp'><p>Quantile function for piecewise exponential regression</p></a></li>
<li><a href='#runShinyApp'><p>Run Shiny app</p></a></li>
<li><a href='#summarizeObserved'><p>Summarize observed data</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Event Prediction</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.5</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-02-27</td>
</tr>
<tr>
<td>Description:</td>
<td>Predicts enrollment and events at the design or analysis stage using specified enrollment and time-to-event models through simulations.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.0</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr (&ge; 1.1.0), rlang (&ge; 1.0.6), plotly (&ge; 4.10.1),
survival (&ge; 2.41-3), splines (&ge; 3.5.0), Matrix (&ge; 1.2-14),
mvtnorm (&ge; 1.1-3), rstpm2 (&ge; 1.6.1), numDeriv (&ge;
2016.8-1.1), purrr (&ge; 1.0.2), flexsurv (&ge; 2.2.2), erify (&ge;
0.4.0), stats (&ge; 3.5.0), shiny (&ge; 1.7.1)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/kaifenglu/eventPred">https://github.com/kaifenglu/eventPred</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/kaifenglu/eventPred/issues">https://github.com/kaifenglu/eventPred/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-27 22:02:12 UTC; kaife</td>
</tr>
<tr>
<td>Author:</td>
<td>Kaifeng Lu <a href="https://orcid.org/0000-0002-6160-7119"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Kaifeng Lu &lt;kaifenglu@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-02-28 00:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='eventPred-package'>Event Prediction</h2><span id='topic+eventPred-package'></span>

<h3>Description</h3>

<p>Predicts enrollment and events at the design stage
using assumed enrollment and treatment-specific time-to-event models,
or at the analysis stage using blinded or unblinded data and
specified enrollment and time-to-event models through simulations.
</p>


<h3>Details</h3>

<p>Accurately predicting the date at which a target number
of subjects or events will be achieved is critical for the planning,
monitoring, and execution of clinical trials. The <code>eventPred</code>
package provides enrollment and event prediction capabilities
using assumed enrollment and treatment-specific time-to-event models
at the design stage, using blinded or unblinded data and
specified enrollment and time-to-event models at the analysis stage.
</p>
<p>At the design stage, enrollment is often specified using a
piecewise Poisson process with a constant enrollment rate
during each specified time interval. At the analysis stage,
before enrollment completion, the <code>eventPred</code> package
considers several models, including the homogeneous Poisson
model, the time-decay model with an enrollment
rate function <code>lambda(t) = mu/delta*(1 - exp(-delta*t))</code>,
the B-spline model with the daily enrollment rate
<code>lambda(t) = exp(B(t)*theta)</code>, and the piecewise Poisson model.
If prior information exists on the model parameters, it can
be combined with the likelihood to yield the posterior distribution.
</p>
<p>The <code>eventPred</code> package also offers several time-to-event models,
including exponential, Weibull, log-logistic, log-normal, piecewise
exponential, model averaging of Weibull and log-normal, and spline.
For time to dropout, the same set of model options are considered.
If enrollment is complete, ongoing subjects who have not had the event
of interest or dropped out of the study before the data cut contribute
additional events in the future. Their event times are generated
from the conditional distribution given that they have survived
at the data cut. For new subjects that need to be enrolled,
their enrollment time and event time can be generated from the
specified enrollment and time-to-event models with parameters
drawn from the posterior distribution. Time-to-dropout can be
generated in a similar fashion.
</p>
<p>The <code>eventPred</code> package displays the Akaike Information
Criterion (AIC), the Bayesian Information
Criterion (BIC) and a fitted curve overlaid with observed data
to help users select the most appropriate model for enrollment
and event prediction. Prediction intervals in the prediction plot
can be used to measure prediction uncertainty, and the simulated
enrollment and event data can be used for further data exploration.
</p>
<p>The most useful function in the <code>eventPred</code> package is
<code>getPrediction</code>, which combines model fitting, data simulation,
and a summary of simulation results. Other functions perform
individual tasks and can be used to select an appropriate
prediction model.
</p>
<p>The <code>eventPred</code> package implements a model
parameterization that enhances the asymptotic normality of
parameter estimates. Specifically, the package utilizes the
following parameterization to achieve this goal:
</p>

<ul>
<li><p> Enrollment models
</p>

<ul>
<li><p> Poisson: <code>theta = log(rate)</code>
</p>
</li>
<li><p> Time-decay: <code>theta = c(log(mu), log(delta))</code>
</p>
</li>
<li><p> B-spline: no reparametrization is needed. The
knots as considered fixed.
</p>
</li>
<li><p> Piecewise Poisson: <code>theta = log(rates)</code>.
The left endpoints of time intervals, denoted as
<code>accrualTime</code>, are considered fixed.
</p>
</li></ul>

</li>
<li><p> Event or dropout models
</p>

<ul>
<li><p> Exponential: <code>theta = log(rate)</code>
</p>
</li>
<li><p> Weibull: <code>theta = c(log(scale), -log(shape))</code>
</p>
</li>
<li><p> Log-logistic: <code>theta = c(log(scale), -log(shape))</code>
</p>
</li>
<li><p> Log-normal: <code>theta = c(meanlog, log(sdlog))</code>
</p>
</li>
<li><p> Piecewise exponential: <code>theta = log(rates)</code>.
The left endpoints of time intervals, denoted as
<code>piecewiseSurvivalTime</code> for event model and
<code>piecewiseDropoutTime</code> for dropout model, are
considered fixed.
</p>
</li>
<li><p> Model averaging: <code>theta = c(log(weibull$scale),
    -log(weibull$shape), lnorm$meanlog, log(lnorm$sdlog))</code>.
The covariance matrix for <code>theta</code> is structured
as a block diagonal matrix, with the upper-left block
corresponding to the Weibull component and the
lower-right block corresponding to the log-normal
component. In other words, the covariance matrix is
partitioned into two distinct blocks, with no
off-diagonal elements connecting the two components.
The weight assigned to the Weibull component, denoted as
<code>w1</code>, is considered fixed.
</p>
</li>
<li><p> Spline: <code>theta</code> corresponds to the coefficients
of basis vectors. The <code>knots</code> and <code>scale</code>
are considered fixed. The <code>scale</code> can be hazard,
odds, or normal, corresponding to extensions of Weibull,
log-logistic, and log-normal distributions, respectively.
</p>
</li></ul>

</li></ul>

<p>The <code>eventPred</code> package uses days as its primary time unit.
If you need to convert enrollment or event rates per month to
rates per day, simply divide by 30.4375.
</p>


<h3>Author(s)</h3>

<p>Kaifeng Lu, <a href="mailto:kaifenglu@gmail.com">kaifenglu@gmail.com</a>
</p>


<h3>References</h3>

<p>Emilia Bagiella and Daniel F. Heitjan. Predicting analysis times in
randomized clinical trials. Stat in Med. 2001; 20:2055-2063.
</p>
<p>Gui-shuang Ying and Daniel F. Heitjan. Weibull prediction of event
times in clinical trials. Pharm Stat. 2008; 7:107-120.
</p>
<p>Xiaoxi Zhang and Qi Long. Stochastic modeling and prediction for
accrual in clinical trials. Stat in Med. 2010; 29:649-658.
</p>
<p>Patrick Royston and Mahesh K. B. Parmar. Flexible parametric
proportional-hazards and proportional-odds models for censored
survival data, with application to prognostic modelling and
estimation of treatment effects. Stat in Med. 2002; 21:2175-2197.
</p>

<hr>
<h2 id='finalData'>Final enrollment and event data after achieving the target number of events</h2><span id='topic+finalData'></span>

<h3>Description</h3>

<p>A data frame with 300 rows and 7 columns:
</p>

<dl>
<dt><code>trialsdt</code></dt><dd><p>The trial start date</p>
</dd>
<dt><code>usubjid</code></dt><dd><p>The unique subject ID</p>
</dd>
<dt><code>randdt</code></dt><dd><p>The randomization date</p>
</dd>
<dt><code>treatment</code></dt><dd><p>The treatment group number</p>
</dd>
<dt><code>treatment_description</code></dt><dd><p>Description of the treatment group</p>
</dd>
<dt><code>time</code></dt><dd><p>The day of event or censoring since randomization</p>
</dd>
<dt><code>event</code></dt><dd><p>The event indicator: 1 for event, 0 for non-event</p>
</dd>
<dt><code>dropout</code></dt><dd><p>The dropout indicator: 1 for dropout,
0 for non-dropout</p>
</dd>
<dt><code>cutoffdt</code></dt><dd><p>The cutoff date</p>
</dd>
</dl>

<p>For ongoing subjects, both <code>event</code> and <code>dropout</code> are equal to 0.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>finalData
</code></pre>


<h3>Format</h3>

<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 300 rows and 9 columns.
</p>

<hr>
<h2 id='fitDropout'>Fit time-to-dropout model</h2><span id='topic+fitDropout'></span>

<h3>Description</h3>

<p>Fits a specified time-to-dropout model to the dropout data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fitDropout(
  df,
  dropout_model = "exponential",
  piecewiseDropoutTime = 0,
  k_dropout = 0,
  scale_dropout = "hazard",
  showplot = TRUE,
  by_treatment = FALSE,
  covariates = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fitDropout_+3A_df">df</code></td>
<td>
<p>The subject-level dropout data, including <code>time</code> and
<code>dropout</code>. The data should also include <code>treatment</code>
coded as 1, 2, and so on, and <code>treatment_description</code>
for fitting the dropout model by treatment.</p>
</td></tr>
<tr><td><code id="fitDropout_+3A_dropout_model">dropout_model</code></td>
<td>
<p>The dropout model used to analyze the dropout data
which can be set to one of the following options:
&quot;exponential&quot;, &quot;Weibull&quot;, &quot;log-logistic&quot;, &quot;log-normal&quot;,
&quot;piecewise exponential&quot;, &quot;model averaging&quot;, or &quot;spline&quot;.
The model averaging uses the <code>exp(-bic/2)</code> weighting and
combines Weibull and log-normal models. The spline model of
Royston and Parmar (2002) assumes that a transformation of
the survival function is modeled as a natural cubic spline
function of log time. By default, it is set to &quot;exponential&quot;.</p>
</td></tr>
<tr><td><code id="fitDropout_+3A_piecewisedropouttime">piecewiseDropoutTime</code></td>
<td>
<p>A vector that specifies the time
intervals for the piecewise exponential dropout distribution.
Must start with 0, e.g., c(0, 60) breaks the time axis into 2
event intervals: [0, 60) and [60, Inf). By default, it is set to 0.</p>
</td></tr>
<tr><td><code id="fitDropout_+3A_k_dropout">k_dropout</code></td>
<td>
<p>The number of inner knots of the spline. The default
<code>k_dropout=0</code> gives a Weibull, log-logistic or log-normal model,
if <code>scale_dropout</code> is &quot;hazard&quot;, &quot;odds&quot;, or &quot;normal&quot;, respectively.
The knots are chosen as equally-spaced quantiles of the log
uncensored survival times. The boundary knots are chosen as the
minimum and maximum log uncensored survival times.</p>
</td></tr>
<tr><td><code id="fitDropout_+3A_scale_dropout">scale_dropout</code></td>
<td>
<p>If &quot;hazard&quot;, the log cumulative hazard is modeled
as a spline function. If &quot;odds&quot;, the log cumulative odds is
modeled as a spline function. If &quot;normal&quot;, -qnorm(S(t)) is
modeled as a spline function.</p>
</td></tr>
<tr><td><code id="fitDropout_+3A_showplot">showplot</code></td>
<td>
<p>A Boolean variable to control whether or not to
show the fitted time-to-dropout survival curve. By default, it is
set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="fitDropout_+3A_by_treatment">by_treatment</code></td>
<td>
<p>A Boolean variable to control whether or not to
fit the time-to-dropout data by treatment group. By default,
it is set to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="fitDropout_+3A_covariates">covariates</code></td>
<td>
<p>The names of baseline covariates from the input
data frame to include in the dropout model, e.g., c(&quot;age&quot;, &quot;sex&quot;).
Factor variables need to be declared in the input data frame.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of results from the model fit including key information
such as the dropout model, <code>model</code>, the estimated model parameters,
<code>theta</code>, the covariance matrix, <code>vtheta</code>, as well as the
Akaike Information Criterion, <code>aic</code>, and
Bayesian Information Criterion, <code>bic</code>.
</p>
<p>If the piecewise exponential model is used, the location
of knots used in the model, <code>piecewiseDropoutTime</code>, will
be included in the list of results.
</p>
<p>If the model averaging option is chosen, the weight assigned
to the Weibull component is indicated by the <code>w1</code> variable.
</p>
<p>If the spline option is chosen, the <code>knots</code> and <code>scale</code>
will be included in the list of results.
</p>
<p>When fitting the dropout model by treatment, the outcome is presented
as a list of lists, where each list element corresponds to a
specific treatment group.
</p>
<p>The fitted time-to-dropout survival curve is also returned.
</p>


<h3>Author(s)</h3>

<p>Kaifeng Lu, <a href="mailto:kaifenglu@gmail.com">kaifenglu@gmail.com</a>
</p>


<h3>References</h3>

<p>Patrick Royston and Mahesh K. B. Parmar. Flexible parametric
proportional-hazards and proportional-odds models for censored
survival data, with application to prognostic modelling and
estimation of treatment effects. Stat in Med. 2002; 21:2175-2197.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
dropout_fit &lt;- fitDropout(df = interimData2,
                          dropout_model = "exponential")

</code></pre>

<hr>
<h2 id='fitEnrollment'>Fit enrollment model</h2><span id='topic+fitEnrollment'></span>

<h3>Description</h3>

<p>Fits a specified enrollment model to the enrollment data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fitEnrollment(
  df,
  enroll_model = "b-spline",
  nknots = 0,
  accrualTime = 0,
  showplot = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fitEnrollment_+3A_df">df</code></td>
<td>
<p>The subject-level enrollment data, including <code>trialsdt</code>,
<code>randdt</code> and <code>cutoffdt</code>.</p>
</td></tr>
<tr><td><code id="fitEnrollment_+3A_enroll_model">enroll_model</code></td>
<td>
<p>The enrollment model which can be specified as
&quot;Poisson&quot;, &quot;Time-decay&quot;, &quot;B-spline&quot;, or
&quot;Piecewise Poisson&quot;. By default, it is set to &quot;B-spline&quot;.</p>
</td></tr>
<tr><td><code id="fitEnrollment_+3A_nknots">nknots</code></td>
<td>
<p>The number of inner knots for the B-spline enrollment
model. By default, it is set to 0.</p>
</td></tr>
<tr><td><code id="fitEnrollment_+3A_accrualtime">accrualTime</code></td>
<td>
<p>The accrual time intervals for the piecewise Poisson
model. Must start with 0, e.g., c(0, 30) breaks the time axis into
2 accrual intervals: [0, 30) and [30, Inf). By default, it is set to 0.</p>
</td></tr>
<tr><td><code id="fitEnrollment_+3A_showplot">showplot</code></td>
<td>
<p>A Boolean variable to control whether or not to
show the fitted enrollment curve. By default, it is set to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For the time-decay model, the mean function is
<code>mu(t) = mu/delta*(t - 1/delta*(1 - exp(-delta*t)))</code>
and the rate function is
<code>lambda(t) = mu/delta*(1 - exp(-delta*t))</code>.
For the B-spline model, the daily enrollment rate is approximated as
<code>lambda(t) = exp(B(t)*theta)</code>,
where <code>B(t)</code> represents the B-spline basis functions.
</p>


<h3>Value</h3>

<p>A list of results from the model fit including key information
such as the enrollment model, <code>model</code>, the estimated model
parameters, <code>theta</code>, the covariance matrix, <code>vtheta</code>,
the Akaike Information Criterion, <code>aic</code>, and
the Bayesian Information Criterion, <code>bic</code>, as well as
the design matrix <code>x</code> for the B-spline enrollment model, and
<code>accrualTime</code> for the piecewise Poisson enrollment model.
</p>
<p>The fitted enrollment curve is also returned.
</p>


<h3>Author(s)</h3>

<p>Kaifeng Lu, <a href="mailto:kaifenglu@gmail.com">kaifenglu@gmail.com</a>
</p>


<h3>References</h3>

<p>Xiaoxi Zhang and Qi Long. Stochastic modeling and prediction for
accrual in clinical trials. Stat in Med. 2010; 29:649-658.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
enroll_fit &lt;- fitEnrollment(df = interimData1, enroll_model = "b-spline",
                            nknots = 1)

</code></pre>

<hr>
<h2 id='fitEvent'>Fit time-to-event model</h2><span id='topic+fitEvent'></span>

<h3>Description</h3>

<p>Fits a specified time-to-event model to the event data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fitEvent(
  df,
  event_model = "model averaging",
  piecewiseSurvivalTime = 0,
  k = 0,
  scale = "hazard",
  showplot = TRUE,
  by_treatment = FALSE,
  covariates = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fitEvent_+3A_df">df</code></td>
<td>
<p>The subject-level event data, including <code>time</code>
and <code>event</code>. The data should also include <code>treatment</code>
coded as 1, 2, and so on, and <code>treatment_description</code>
for fitting the event model by treatment.</p>
</td></tr>
<tr><td><code id="fitEvent_+3A_event_model">event_model</code></td>
<td>
<p>The event model used to analyze the event data
which can be set to one of the following options:
&quot;exponential&quot;, &quot;Weibull&quot;, &quot;log-logistic&quot;, &quot;log-normal&quot;,
&quot;piecewise exponential&quot;, &quot;model averaging&quot;, or &quot;spline&quot;.
The model averaging uses the <code>exp(-bic/2)</code> weighting and
combines Weibull and log-normal models. The spline model of
Royston and Parmar (2002) assumes that a transformation of
the survival function is modeled as a natural cubic spline
function of log time. By default, it is set to &quot;model averaging&quot;.</p>
</td></tr>
<tr><td><code id="fitEvent_+3A_piecewisesurvivaltime">piecewiseSurvivalTime</code></td>
<td>
<p>A vector that specifies the time
intervals for the piecewise exponential survival distribution.
Must start with 0, e.g., c(0, 60) breaks the time axis into 2
event intervals: [0, 60) and [60, Inf). By default, it is set to 0.</p>
</td></tr>
<tr><td><code id="fitEvent_+3A_k">k</code></td>
<td>
<p>The number of inner knots of the spline. The default
<code>k=0</code> gives a Weibull, log-logistic or log-normal model,
if <code>scale</code> is &quot;hazard&quot;, &quot;odds&quot;, or &quot;normal&quot;, respectively.
The knots are chosen as equally-spaced quantiles of the log
uncensored survival times. The boundary knots are chosen as the
minimum and maximum log uncensored survival times.</p>
</td></tr>
<tr><td><code id="fitEvent_+3A_scale">scale</code></td>
<td>
<p>If &quot;hazard&quot;, the log cumulative hazard is modeled
as a spline function. If &quot;odds&quot;, the log cumulative odds is
modeled as a spline function. If &quot;normal&quot;, -qnorm(S(t)) is
modeled as a spline function.</p>
</td></tr>
<tr><td><code id="fitEvent_+3A_showplot">showplot</code></td>
<td>
<p>A Boolean variable to control whether or not to
show the fitted time-to-event survival curve. By default, it is
set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="fitEvent_+3A_by_treatment">by_treatment</code></td>
<td>
<p>A Boolean variable to control whether or not to
fit the time-to-event data by treatment group. By default,
it is set to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="fitEvent_+3A_covariates">covariates</code></td>
<td>
<p>The names of baseline covariates from the input
data frame to include in the event model, e.g., c(&quot;age&quot;, &quot;sex&quot;).
Factor variables need to be declared in the input data frame.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of results from the model fit including key information
such as the event model, <code>model</code>, the estimated model parameters,
<code>theta</code>, the covariance matrix, <code>vtheta</code>, as well as the
Akaike Information Criterion, <code>aic</code>, and
Bayesian Information Criterion, <code>bic</code>.
</p>
<p>If the piecewise exponential model is used, the location
of knots used in the model, <code>piecewiseSurvivalTime</code>, will
be included in the list of results.
</p>
<p>If the model averaging option is chosen, the weight assigned
to the Weibull component is indicated by the <code>w1</code> variable.
</p>
<p>If the spline option is chosen, the <code>knots</code> and <code>scale</code>
will be included in the list of results.
</p>
<p>When fitting the event model by treatment, the outcome is presented
as a list of lists, where each list element corresponds to a
specific treatment group.
</p>
<p>The fitted time-to-event survival curve is also returned.
</p>


<h3>Author(s)</h3>

<p>Kaifeng Lu, <a href="mailto:kaifenglu@gmail.com">kaifenglu@gmail.com</a>
</p>


<h3>References</h3>

<p>Patrick Royston and Mahesh K. B. Parmar. Flexible parametric
proportional-hazards and proportional-odds models for censored
survival data, with application to prognostic modelling and
estimation of treatment effects. Stat in Med. 2002; 21:2175-2197.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
event_fit &lt;- fitEvent(df = interimData2,
                      event_model = "piecewise exponential",
                      piecewiseSurvivalTime = c(0, 180))

</code></pre>

<hr>
<h2 id='getPrediction'>Enrollment and event prediction</h2><span id='topic+getPrediction'></span>

<h3>Description</h3>

<p>Performs enrollment and event prediction by utilizing
observed data and specified enrollment and event models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getPrediction(
  df = NULL,
  to_predict = "enrollment and event",
  target_n = NA,
  target_d = NA,
  enroll_model = "b-spline",
  nknots = 0,
  lags = 30,
  accrualTime = 0,
  enroll_prior = NULL,
  event_model = "model averaging",
  piecewiseSurvivalTime = 0,
  k = 0,
  scale = "hazard",
  event_prior = NULL,
  dropout_model = "exponential",
  piecewiseDropoutTime = 0,
  k_dropout = 0,
  scale_dropout = "hazard",
  dropout_prior = NULL,
  fixedFollowup = FALSE,
  followupTime = 365,
  pilevel = 0.9,
  nyears = 4,
  nreps = 500,
  showEnrollment = TRUE,
  showEvent = TRUE,
  showDropout = FALSE,
  showOngoing = FALSE,
  showsummary = TRUE,
  showplot = TRUE,
  by_treatment = FALSE,
  ngroups = 1,
  alloc = NULL,
  treatment_label = NULL,
  covariates_event = NULL,
  event_prior_with_covariates = NULL,
  covariates_dropout = NULL,
  dropout_prior_with_covariates = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getPrediction_+3A_df">df</code></td>
<td>
<p>The subject-level enrollment and event data, including
<code>trialsdt</code>, <code>usubjid</code>, <code>randdt</code>, and <code>cutoffdt</code> for
enrollment prediction, and, additionally, <code>time</code>, <code>event</code>,
and <code>dropout</code> for event prediction. The data should also include
<code>treatment</code> coded as 1, 2, and so on, and
<code>treatment_description</code> for enrollment and
event prediction by treatment. By default, it is set to
<code>NULL</code> for enrollment and event prediction at the design stage.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_to_predict">to_predict</code></td>
<td>
<p>Specifies what to predict: &quot;enrollment only&quot;, &quot;event
only&quot;, or &quot;enrollment and event&quot;. By default, it is set to
&quot;enrollment and event&quot;.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_target_n">target_n</code></td>
<td>
<p>The target number of subjects to enroll in the study.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_target_d">target_d</code></td>
<td>
<p>The target number of events to reach in the study.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_enroll_model">enroll_model</code></td>
<td>
<p>The enrollment model which can be specified as
&quot;Poisson&quot;, &quot;Time-decay&quot;, &quot;B-spline&quot;, or
&quot;Piecewise Poisson&quot;. By default, it is set to &quot;B-spline&quot;.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_nknots">nknots</code></td>
<td>
<p>The number of inner knots for the B-spline enrollment
model. By default, it is set to 0.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_lags">lags</code></td>
<td>
<p>The day lags to compute the average enrollment rate to
carry forward for the B-spline enrollment model. By default,
it is set to 30.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_accrualtime">accrualTime</code></td>
<td>
<p>The accrual time intervals for the piecewise
Poisson model. Must start with 0, e.g., c(0, 30) breaks the
time axis into 2 accrual intervals: [0, 30) and [30, Inf).
By default, it is set to 0.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_enroll_prior">enroll_prior</code></td>
<td>
<p>The prior of enrollment model parameters.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_event_model">event_model</code></td>
<td>
<p>The event model used to analyze the event data
which can be set to one of the following options:
&quot;exponential&quot;, &quot;Weibull&quot;, &quot;log-logistic&quot;, &quot;log-normal&quot;,
&quot;piecewise exponential&quot;, &quot;model averaging&quot;, or &quot;spline&quot;.
The model averaging uses the <code>exp(-bic/2)</code> weighting and
combines Weibull and log-normal models. By default, it is set to
&quot;model averaging&quot;.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_piecewisesurvivaltime">piecewiseSurvivalTime</code></td>
<td>
<p>A vector that specifies the time
intervals for the piecewise exponential survival distribution.
Must start with 0, e.g., c(0, 60) breaks the time axis into 2
event intervals: [0, 60) and [60, Inf). By default, it is set to 0.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_k">k</code></td>
<td>
<p>The number of inner knots of the spline event model of
Royston and Parmar (2002). The default
<code>k=0</code> gives a Weibull, log-logistic or log-normal model,
if <code>scale</code> is &quot;hazard&quot;, &quot;odds&quot;, or &quot;normal&quot;, respectively.
The knots are chosen as equally-spaced quantiles of the log
uncensored survival times. The boundary knots are chosen as the
minimum and maximum log uncensored survival times.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_scale">scale</code></td>
<td>
<p>If &quot;hazard&quot;, the log cumulative hazard is modeled
as a spline function. If &quot;odds&quot;, the log cumulative odds is
modeled as a spline function. If &quot;normal&quot;, -qnorm(S(t)) is
modeled as a spline function.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_event_prior">event_prior</code></td>
<td>
<p>The prior of event model parameters.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_dropout_model">dropout_model</code></td>
<td>
<p>The dropout model used to analyze the dropout data
which can be set to one of the following options:
&quot;none&quot;, &quot;exponential&quot;, &quot;Weibull&quot;, &quot;log-logistic&quot;, &quot;log-normal&quot;,
&quot;piecewise exponential&quot;, &quot;model averaging&quot;, or &quot;spline&quot;.
The model averaging uses the <code>exp(-bic/2)</code> weighting and
combines Weibull and log-normal models. By default, it is set to
&quot;exponential&quot;.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_piecewisedropouttime">piecewiseDropoutTime</code></td>
<td>
<p>A vector that specifies the time
intervals for the piecewise exponential dropout distribution.
Must start with 0, e.g., c(0, 60) breaks the time axis into 2
event intervals: [0, 60) and [60, Inf). By default, it is set to 0.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_k_dropout">k_dropout</code></td>
<td>
<p>The number of inner knots of the spline dropout model of
Royston and Parmar (2002). The default
<code>k_dropout=0</code> gives a Weibull, log-logistic or log-normal model,
if <code>scale_dropout</code> is &quot;hazard&quot;, &quot;odds&quot;, or &quot;normal&quot;, respectively.
The knots are chosen as equally-spaced quantiles of the log
uncensored survival times. The boundary knots are chosen as the
minimum and maximum log uncensored survival times.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_scale_dropout">scale_dropout</code></td>
<td>
<p>If &quot;hazard&quot;, the log cumulative hazard is modeled
as a spline function. If &quot;odds&quot;, the log cumulative odds is
modeled as a spline function. If &quot;normal&quot;, -qnorm(S(t)) is
modeled as a spline function.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_dropout_prior">dropout_prior</code></td>
<td>
<p>The prior of dropout model parameters.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_fixedfollowup">fixedFollowup</code></td>
<td>
<p>A Boolean variable indicating whether a fixed
follow-up design is used. By default, it is set to <code>FALSE</code>
for a variable follow-up design.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_followuptime">followupTime</code></td>
<td>
<p>The follow-up time for a fixed
follow-up design, in days. By default, it is set to 365.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_pilevel">pilevel</code></td>
<td>
<p>The prediction interval level. By default,
it is set to 0.90.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_nyears">nyears</code></td>
<td>
<p>The number of years after the data cut for prediction.
By default, it is set to 4.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_nreps">nreps</code></td>
<td>
<p>The number of replications for simulation. By default,
it is set to 500.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_showenrollment">showEnrollment</code></td>
<td>
<p>A Boolean variable to control whether or not to
show the number of enrolled subjects. By default, it is set to
<code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_showevent">showEvent</code></td>
<td>
<p>A Boolean variable to control whether or not to
show the number of events. By default, it is set to
<code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_showdropout">showDropout</code></td>
<td>
<p>A Boolean variable to control whether or not to
show the number of dropouts. By default, it is set to
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_showongoing">showOngoing</code></td>
<td>
<p>A Boolean variable to control whether or not to
show the number of ongoing subjects. By default, it is set to
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_showsummary">showsummary</code></td>
<td>
<p>A Boolean variable to control whether or not to
show the prediction summary. By default, it is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_showplot">showplot</code></td>
<td>
<p>A Boolean variable to control whether or not to
show the plots. By default, it is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_by_treatment">by_treatment</code></td>
<td>
<p>A Boolean variable to control whether or not to
predict by treatment group. By default, it is set to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_ngroups">ngroups</code></td>
<td>
<p>The number of treatment groups for enrollment prediction
at the design stage. By default, it is set to 1.
It is replaced with the actual number of
treatment groups in the observed data if <code>df</code> is not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_alloc">alloc</code></td>
<td>
<p>The treatment allocation in a randomization block.
By default, it is set to <code>NULL</code>, which yields equal allocation
among the treatment groups.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_treatment_label">treatment_label</code></td>
<td>
<p>The treatment labels for treatments in a
randomization block for design stage prediction.
It is replaced with the treatment_description
in the observed data if <code>df</code> is not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_covariates_event">covariates_event</code></td>
<td>
<p>The names of baseline covariates from the input
data frame to include in the event model, e.g., c(&quot;age&quot;, &quot;sex&quot;).
Factor variables need to be declared in the input data frame.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_event_prior_with_covariates">event_prior_with_covariates</code></td>
<td>
<p>The prior of event model parameters
in the presence of covariates.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_covariates_dropout">covariates_dropout</code></td>
<td>
<p>The names of baseline covariates from the input
data frame to include in the dropout model, e.g., c(&quot;age&quot;, &quot;sex&quot;).
Factor variables need to be declared in the input data frame.</p>
</td></tr>
<tr><td><code id="getPrediction_+3A_dropout_prior_with_covariates">dropout_prior_with_covariates</code></td>
<td>
<p>The prior of dropout model
parameters in the presence of covariates.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For the time-decay model, the mean function is
<code>mu(t) = mu/delta*(t - 1/delta*(1 - exp(-delta*t)))</code>
and the rate function is
<code>lambda(t) = mu/delta*(1 - exp(-delta*t))</code>.
For the B-spline model, the daily enrollment rate is approximated as
<code>lambda(t) = exp(B(t)*theta)</code>,
where <code>B(t)</code> represents the B-spline basis functions.
</p>
<p>The <code>enroll_prior</code> variable should be a list that
includes <code>model</code> to specify the enrollment model
(poisson, time-decay, or piecewise poisson),
<code>theta</code> and <code>vtheta</code> to indicate the parameter
values and the covariance matrix. One can use a very small
value of <code>vtheta</code> to fix the parameter values.
For the piecewise Poisson enrollment model, the list
should also include <code>accrualTime</code>. It should be noted
that the B-spline model is not appropriate for use as prior.
</p>
<p>For event prediction by treatment with prior information,
the <code>event_prior</code> (<code>dropout_prior</code>) variable should be
a list with one element per treatment. For each treatment, the
element should include <code>model</code> to specify the event (dropout)
model (exponential, weibull, log-logistic, log-normal,
or piecewise exponential), <code>theta</code> and <code>vtheta</code> to
indicate the parameter values and the covariance matrix.
For the piecewise exponential event (dropout) model, the list
should also include <code>piecewiseSurvivalTime</code>
(<code>piecewiseDropoutTime</code>) to indicate the location of knots.
It should be noted that the model averaging and spline options
are not appropriate for use as prior.
</p>
<p>If the event prediction is not by treatment while the prior
information is given by treatment, then each element of
<code>event_prior</code> (<code>dropout_prior</code>) should also include
<code>w</code> to specify the weight of the treatment in a
randomization block. If the prediction is not by treatment and
the prior is given for the overall study, then <code>event_prior</code>
(<code>dropout_prior</code>) is a flat list with <code>model</code>,
<code>theta</code>, and <code>vtheta</code>. For the piecewise exponential
event (dropout) model, it should also include
<code>piecewiseSurvivalTime</code> (<code>piecewiseDropoutTime</code>) to
indicate the location of knots.
</p>
<p>For analysis-stage enrollment and event prediction, the
<code>enroll_prior</code>, <code>event_prior</code>, and
<code>dropout_prior</code> are either set to <code>NULL</code> to
use the observed data only, or specify the prior distribution
of model parameters to be combined with observed data likelihood
for enhanced modeling flexibility.
</p>


<h3>Value</h3>

<p>A list that includes the fits of observed data models,
as well as simulated enrollment data for new subjects and
simulated event data for ongoing and new subjects.
</p>


<h3>Author(s)</h3>

<p>Kaifeng Lu, <a href="mailto:kaifenglu@gmail.com">kaifenglu@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Event prediction after enrollment completion

pred &lt;- getPrediction(
  df = interimData2, to_predict = "event only",
  target_d = 200,
  event_model = "weibull",
  dropout_model = "exponential",
  pilevel = 0.90, nreps = 100)

</code></pre>

<hr>
<h2 id='interimData1'>Interim enrollment and event data before enrollment completion</h2><span id='topic+interimData1'></span>

<h3>Description</h3>

<p>A data frame with 225 rows and 9 columns:
</p>

<dl>
<dt><code>trialsdt</code></dt><dd><p>The trial start date</p>
</dd>
<dt><code>usubjid</code></dt><dd><p>The unique subject ID</p>
</dd>
<dt><code>randdt</code></dt><dd><p>The randomization date</p>
</dd>
<dt><code>treatment</code></dt><dd><p>The treatment group number</p>
</dd>
<dt><code>treatment_description</code></dt><dd><p>Description of the treatment group</p>
</dd>
<dt><code>time</code></dt><dd><p>The day of event or censoring since randomization</p>
</dd>
<dt><code>event</code></dt><dd><p>The event indicator: 1 for event, 0 for non-event</p>
</dd>
<dt><code>dropout</code></dt><dd><p>The dropout indicator: 1 for dropout,
0 for non-dropout</p>
</dd>
<dt><code>cutoffdt</code></dt><dd><p>The cutoff date</p>
</dd>
</dl>

<p>For ongoing subjects, both <code>event</code> and <code>dropout</code> are equal to 0.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>interimData1
</code></pre>


<h3>Format</h3>

<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 224 rows and 9 columns.
</p>

<hr>
<h2 id='interimData2'>Interim enrollment and event data after enrollment completion</h2><span id='topic+interimData2'></span>

<h3>Description</h3>

<p>A data frame with 300 rows and 7 columns:
</p>

<dl>
<dt><code>trialsdt</code></dt><dd><p>The trial start date</p>
</dd>
<dt><code>usubjid</code></dt><dd><p>The unique subject ID</p>
</dd>
<dt><code>randdt</code></dt><dd><p>The randomization date</p>
</dd>
<dt><code>treatment</code></dt><dd><p>The treatment group number</p>
</dd>
<dt><code>treatment_description</code></dt><dd><p>Description of the treatment group</p>
</dd>
<dt><code>time</code></dt><dd><p>The day of event or censoring since randomization</p>
</dd>
<dt><code>event</code></dt><dd><p>The event indicator: 1 for event, 0 for non-event</p>
</dd>
<dt><code>dropout</code></dt><dd><p>The dropout indicator: 1 for dropout,
0 for non-dropout</p>
</dd>
<dt><code>cutoffdt</code></dt><dd><p>The cutoff date</p>
</dd>
</dl>

<p>For ongoing subjects, both <code>event</code> and <code>dropout</code> are equal to 0.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>interimData2
</code></pre>


<h3>Format</h3>

<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 300 rows and 9 columns.
</p>

<hr>
<h2 id='llik_pwexp'>Log likelihood for piecewise exponential regression</h2><span id='topic+llik_pwexp'></span>

<h3>Description</h3>

<p>Obtains the log likelihood value for piecewise
exponential regression.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>llik_pwexp(theta, time, event, J, tcut, q, x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="llik_pwexp_+3A_theta">theta</code></td>
<td>
<p>The parameter vector consisting of gamma for log
piecewise hazards and beta for regression coefficients.</p>
</td></tr>
<tr><td><code id="llik_pwexp_+3A_time">time</code></td>
<td>
<p>The survival time.</p>
</td></tr>
<tr><td><code id="llik_pwexp_+3A_event">event</code></td>
<td>
<p>The event indicator.</p>
</td></tr>
<tr><td><code id="llik_pwexp_+3A_j">J</code></td>
<td>
<p>The number of time intervals.</p>
</td></tr>
<tr><td><code id="llik_pwexp_+3A_tcut">tcut</code></td>
<td>
<p>A vector that specifies the endpoints of time intervals
for the baseline piecewise exponential survival distribution.
Must start with 0, e.g., c(0, 60) breaks the time axis into 2 event
intervals: [0, 60) and [60, Inf). By default, it is set to 0.</p>
</td></tr>
<tr><td><code id="llik_pwexp_+3A_q">q</code></td>
<td>
<p>The number of columns of the covariates matrix.</p>
</td></tr>
<tr><td><code id="llik_pwexp_+3A_x">x</code></td>
<td>
<p>The covariates matrix (excluding the intercept).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The log likelihood value for piecewise exponential regression.
</p>

<hr>
<h2 id='pmodavg'>Distribution function for model averaging of Weibull and log-normal</h2><span id='topic+pmodavg'></span>

<h3>Description</h3>

<p>Obtains the distribution function value for model-averaging
of Weibull and log-normal regression.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pmodavg(t, theta, w1, q, x, lower.tail = TRUE, log.p = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pmodavg_+3A_t">t</code></td>
<td>
<p>The vector of time points.</p>
</td></tr>
<tr><td><code id="pmodavg_+3A_theta">theta</code></td>
<td>
<p>The parameter vector consisting of the accelerate failure
time (AFT) regression coefficients and the logrithm of the AFT
regression scale parameter for the Weibull and log-normal distributions.</p>
</td></tr>
<tr><td><code id="pmodavg_+3A_w1">w1</code></td>
<td>
<p>The weight for the Weibull component distribution.</p>
</td></tr>
<tr><td><code id="pmodavg_+3A_q">q</code></td>
<td>
<p>The number of elements in the vector of covariates.</p>
</td></tr>
<tr><td><code id="pmodavg_+3A_x">x</code></td>
<td>
<p>The vector of covariates (excluding the intercept).</p>
</td></tr>
<tr><td><code id="pmodavg_+3A_lower.tail">lower.tail</code></td>
<td>
<p>logical; if TRUE (default), probabilities are
the distribution function, otherwise, the survival function.</p>
</td></tr>
<tr><td><code id="pmodavg_+3A_log.p">log.p</code></td>
<td>
<p>logical; if TRUE, probabilities p are given as log(p).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The probabilities p = P(T &lt;= t | X = x).
</p>

<hr>
<h2 id='ppwexp'>Distribution function for piecewise exponential regression</h2><span id='topic+ppwexp'></span>

<h3>Description</h3>

<p>Obtains the distribution function value for piecewise
exponential regression.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ppwexp(t, theta, J, tcut, q = 0, x = 0, lower.tail = TRUE, log.p = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ppwexp_+3A_t">t</code></td>
<td>
<p>The vector of time points.</p>
</td></tr>
<tr><td><code id="ppwexp_+3A_theta">theta</code></td>
<td>
<p>The parameter vector consisting of gamma for log
piecewise hazards and beta for regression coefficients.</p>
</td></tr>
<tr><td><code id="ppwexp_+3A_j">J</code></td>
<td>
<p>The number of time intervals.</p>
</td></tr>
<tr><td><code id="ppwexp_+3A_tcut">tcut</code></td>
<td>
<p>A vector that specifies the time intervals
for the piecewise exponential survival distribution.
Must start with 0, e.g., c(0, 60) breaks the time axis into 2 event
intervals: [0, 60) and [60, Inf). By default, it is set to 0.</p>
</td></tr>
<tr><td><code id="ppwexp_+3A_q">q</code></td>
<td>
<p>The number of elements in the vector of covariates.</p>
</td></tr>
<tr><td><code id="ppwexp_+3A_x">x</code></td>
<td>
<p>The vector of covariates (excluding the intercept).</p>
</td></tr>
<tr><td><code id="ppwexp_+3A_lower.tail">lower.tail</code></td>
<td>
<p>logical; if TRUE (default), probabilities are
the distribution function, otherwise, the survival function.</p>
</td></tr>
<tr><td><code id="ppwexp_+3A_log.p">log.p</code></td>
<td>
<p>logical; if TRUE, probabilities p are given as log(p).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The probabilities p = P(T &lt;= t | X = x).
</p>

<hr>
<h2 id='predictEnrollment'>Predict enrollment</h2><span id='topic+predictEnrollment'></span>

<h3>Description</h3>

<p>Utilizes a pre-fitted enrollment model to generate
enrollment times for new subjects and provide a prediction
interval for the expected time to reach the enrollment target.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predictEnrollment(
  df = NULL,
  target_n,
  enroll_fit,
  lags = 30,
  pilevel = 0.9,
  nyears = 4,
  nreps = 500,
  showsummary = TRUE,
  showplot = TRUE,
  by_treatment = FALSE,
  ngroups = 1,
  alloc = NULL,
  treatment_label = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predictEnrollment_+3A_df">df</code></td>
<td>
<p>The subject-level enrollment data, including <code>trialsdt</code>,
<code>randdt</code> and <code>cutoffdt</code>. The data should also include
<code>treatment</code> coded as 1, 2, and so on, and
<code>treatment_description</code> for prediction
by treatment group. By default, it is set to <code>NULL</code>
for enrollment prediction at the design stage.</p>
</td></tr>
<tr><td><code id="predictEnrollment_+3A_target_n">target_n</code></td>
<td>
<p>The target number of subjects to enroll in the study.</p>
</td></tr>
<tr><td><code id="predictEnrollment_+3A_enroll_fit">enroll_fit</code></td>
<td>
<p>The pre-fitted enrollment model used to
generate predictions.</p>
</td></tr>
<tr><td><code id="predictEnrollment_+3A_lags">lags</code></td>
<td>
<p>The day lags to compute the average enrollment rate to
carry forward for the B-spline enrollment model. By default,
it is set to 30.</p>
</td></tr>
<tr><td><code id="predictEnrollment_+3A_pilevel">pilevel</code></td>
<td>
<p>The prediction interval level. By default,
it is set to 0.90.</p>
</td></tr>
<tr><td><code id="predictEnrollment_+3A_nyears">nyears</code></td>
<td>
<p>The number of years after the data cut for prediction.
By default, it is set to 4.</p>
</td></tr>
<tr><td><code id="predictEnrollment_+3A_nreps">nreps</code></td>
<td>
<p>The number of replications for simulation. By default,
it is set to 500.</p>
</td></tr>
<tr><td><code id="predictEnrollment_+3A_showsummary">showsummary</code></td>
<td>
<p>A Boolean variable to control whether or not to
show the prediction summary. By default, it is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="predictEnrollment_+3A_showplot">showplot</code></td>
<td>
<p>A Boolean variable to control whether or not to
show the prediction plot. By default, it is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="predictEnrollment_+3A_by_treatment">by_treatment</code></td>
<td>
<p>A Boolean variable to control whether or not to
predict enrollment by treatment group. By default,
it is set to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="predictEnrollment_+3A_ngroups">ngroups</code></td>
<td>
<p>The number of treatment groups for enrollment prediction
at the design stage. By default, it is set to 1.
It is replaced with the actual number of
treatment groups in the observed data if <code>df</code> is not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="predictEnrollment_+3A_alloc">alloc</code></td>
<td>
<p>The treatment allocation in a randomization block.
By default, it is set to <code>NULL</code>, which yields equal allocation
among the treatment groups.</p>
</td></tr>
<tr><td><code id="predictEnrollment_+3A_treatment_label">treatment_label</code></td>
<td>
<p>The treatment labels for treatments in a
randomization block for design stage prediction.
It is replaced with the treatment_description
in the observed data if <code>df</code> is not <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>enroll_fit</code> variable can be used for enrollment prediction
at the design stage. A piecewise Poisson model can be parameterized
through the time intervals, <code>accrualTime</code>, which is
treated as fixed, and the enrollment rates in the intervals,
<code>accrualIntensity</code>, the log of which is used as the
model parameter. For the homogeneous Poisson, time-decay,
and piecewise Poisson models, <code>enroll_fit</code> is used to
specify the prior distribution of model parameters, with
a very small variance being used to fix the parameter values.
It should be noted that the B-spline model is not appropriate
for use during the design stage.
</p>
<p>During the enrollment stage, <code>enroll_fit</code> is the enrollment model
fit based on the observed data. The fitted enrollment model is used to
generate enrollment times for new subjects.
</p>


<h3>Value</h3>

<p>A list of prediction results, which includes important information
such as the median, lower and upper percentiles for the estimated
time to reach the target number of subjects, as well as simulated
enrollment data for new subjects. The data for the
prediction plot is also included within the list.
</p>


<h3>Author(s)</h3>

<p>Kaifeng Lu, <a href="mailto:kaifenglu@gmail.com">kaifenglu@gmail.com</a>
</p>


<h3>References</h3>

<p>Xiaoxi Zhang and Qi Long. Stochastic modeling and prediction for
accrual in clinical trials. Stat in Med. 2010; 29:649-658.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Enrollment prediction at the design stage

enroll_pred &lt;- predictEnrollment(
  target_n = 300,
  enroll_fit = list(model = "piecewise poisson",
                    theta = log(26/9*seq(1, 9)/30.4375),
                    vtheta = diag(9)*1e-8,
                    accrualTime = seq(0, 8)*30.4375),
  pilevel = 0.90, nreps = 100)

</code></pre>

<hr>
<h2 id='predictEvent'>Predict event</h2><span id='topic+predictEvent'></span>

<h3>Description</h3>

<p>Utilizes pre-fitted time-to-event and time-to-dropout models
to generate event and dropout times for ongoing subjects
and new subjects. It also provides a
prediction interval for the expected time to reach the target
number of events.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predictEvent(
  df = NULL,
  target_d,
  newSubjects = NULL,
  event_fit = NULL,
  dropout_fit = NULL,
  fixedFollowup = FALSE,
  followupTime = 365,
  pilevel = 0.9,
  nyears = 4,
  nreps = 500,
  showEnrollment = TRUE,
  showEvent = TRUE,
  showDropout = FALSE,
  showOngoing = FALSE,
  showsummary = TRUE,
  showplot = TRUE,
  by_treatment = FALSE,
  covariates_event = NULL,
  event_fit_with_covariates = NULL,
  covariates_dropout = NULL,
  dropout_fit_with_covariates = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predictEvent_+3A_df">df</code></td>
<td>
<p>The subject-level enrollment and event data, including
<code>trialsdt</code>, <code>usubjid</code>, <code>randdt</code>, <code>cutoffdt</code>,
<code>time</code>, <code>event</code>, and <code>dropout</code>. The data should also
include <code>treatment</code> coded as 1, 2, and so on, and
<code>treatment_description</code> for by-treatment prediction. By default,
it is set to <code>NULL</code> for event prediction at the design stage.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_target_d">target_d</code></td>
<td>
<p>The target number of events to reach in the study.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_newsubjects">newSubjects</code></td>
<td>
<p>The enrollment data for new subjects including
<code>draw</code> and <code>arrivalTime</code>. The data should also include
<code>treatment</code> for prediction by treatment. By default,
it is set to <code>NULL</code>,
indicating the completion of subject enrollment.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_event_fit">event_fit</code></td>
<td>
<p>The pre-fitted event model used to generate
predictions.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_dropout_fit">dropout_fit</code></td>
<td>
<p>The pre-fitted dropout model used to generate
predictions. By default, it is set to <code>NULL</code>,
indicating no dropout.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_fixedfollowup">fixedFollowup</code></td>
<td>
<p>A Boolean variable indicating whether a fixed
follow-up design is used. By default, it is set to <code>FALSE</code>
for a variable follow-up design.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_followuptime">followupTime</code></td>
<td>
<p>The follow-up time for a fixed
follow-up design, in days. By default, it is set to 365.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_pilevel">pilevel</code></td>
<td>
<p>The prediction interval level. By default,
it is set to 0.90.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_nyears">nyears</code></td>
<td>
<p>The number of years after the data cut for prediction.
By default, it is set to 4.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_nreps">nreps</code></td>
<td>
<p>The number of replications for simulation. By default,
it is set to 500. If <code>newSubjects</code> is not <code>NULL</code>,
the number of draws in <code>newSubjects</code> should be <code>nreps</code>.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_showenrollment">showEnrollment</code></td>
<td>
<p>A Boolean variable to control whether or not to
show the number of enrolled subjects. By default, it is set to
<code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_showevent">showEvent</code></td>
<td>
<p>A Boolean variable to control whether or not to
show the number of events. By default, it is set to
<code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_showdropout">showDropout</code></td>
<td>
<p>A Boolean variable to control whether or not to
show the number of dropouts. By default, it is set to
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_showongoing">showOngoing</code></td>
<td>
<p>A Boolean variable to control whether or not to
show the number of ongoing subjects. By default, it is set to
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_showsummary">showsummary</code></td>
<td>
<p>A Boolean variable to control whether or not to
show the prediction summary. By default, it is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_showplot">showplot</code></td>
<td>
<p>A Boolean variable to control whether or not to
show the prediction plot. By default, it is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_by_treatment">by_treatment</code></td>
<td>
<p>A Boolean variable to control whether or not to
predict event by treatment group. By default,
it is set to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_covariates_event">covariates_event</code></td>
<td>
<p>The names of baseline covariates from the input
data frame to include in the event model, e.g., c(&quot;age&quot;, &quot;sex&quot;).
Factor variables need to be declared in the input data frame.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_event_fit_with_covariates">event_fit_with_covariates</code></td>
<td>
<p>The pre-fitted event model with
covariates used to generate event predictions for ongoing subjects.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_covariates_dropout">covariates_dropout</code></td>
<td>
<p>The names of baseline covariates from the input
data frame to include in the dropout model, e.g., c(&quot;age&quot;, &quot;sex&quot;).
Factor variables need to be declared in the input data frame.</p>
</td></tr>
<tr><td><code id="predictEvent_+3A_dropout_fit_with_covariates">dropout_fit_with_covariates</code></td>
<td>
<p>The pre-fitted dropout model with
covariates used to generate dropout predictions for ongoing subjects.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To ensure successful event prediction at the design stage, it is
important to provide the <code>newSubjects</code> data set.
</p>
<p>To specify the event (dropout) model used during the design-stage event
prediction, the <code>event_fit</code> (<code>dropout_fit</code>) should be a list
with one element per treatment. For each treatment, the element should
include <code>w</code> to specify the weight of the treatment in a
randomization block, <code>model</code> to specify the event model
(exponential, weibull, log-logistic, log-normal, or piecewise
exponential), <code>theta</code> and <code>vtheta</code> to indicate
the parameter values and the covariance matrix. For the piecewise
exponential event (dropout) model, the list should also include
<code>piecewiseSurvivalTime</code> (<code>piecewiseDropoutTime</code>) to indicate
the location of knots. It should be noted that the model averaging
and spline options are not appropriate for use during the design stage.
</p>
<p>Following the commencement of the trial, we obtain the event
model fit and the dropout model fit based on the observed data,
denoted as <code>event_fit</code> and <code>dropout_fit</code>, respectively.
These fitted models are subsequently utilized to generate event
and dropout times for both ongoing and new subjects in the trial.
</p>


<h3>Value</h3>

<p>A list of prediction results which includes important
information such as the median, lower and upper percentiles for
the estimated day and date to reach the target number of events,
as well as simulated event data for both ongoing and new subjects.
The data for the prediction plot is also included
within this list.
</p>


<h3>Author(s)</h3>

<p>Kaifeng Lu, <a href="mailto:kaifenglu@gmail.com">kaifenglu@gmail.com</a>
</p>


<h3>References</h3>

<p>Emilia Bagiella and Daniel F. Heitjan. Predicting analysis times in
randomized clinical trials. Stat in Med. 2001; 20:2055-2063.
</p>
<p>Gui-shuang Ying and Daniel F. Heitjan. Weibull prediction of event
times in clinical trials. Pharm Stat. 2008; 7:107-120.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Event prediction after enrollment completion

event_fit &lt;- fitEvent(df = interimData2,
                      event_model = "piecewise exponential",
                      piecewiseSurvivalTime = c(0, 140, 352))

dropout_fit &lt;- fitDropout(df = interimData2,
                          dropout_model = "exponential")

event_pred &lt;- predictEvent(df = interimData2, target_d = 200,
                           event_fit = event_fit$fit,
                           dropout_fit = dropout_fit$fit,
                           pilevel = 0.90, nreps = 100)

</code></pre>

<hr>
<h2 id='pwexpreg'>Piecewise exponential regression</h2><span id='topic+pwexpreg'></span>

<h3>Description</h3>

<p>Obtains the maximum likelihood estimates for piecewise
exponential regression.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pwexpreg(time, event, J, tcut, q, x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pwexpreg_+3A_time">time</code></td>
<td>
<p>The survival time.</p>
</td></tr>
<tr><td><code id="pwexpreg_+3A_event">event</code></td>
<td>
<p>The event indicator.</p>
</td></tr>
<tr><td><code id="pwexpreg_+3A_j">J</code></td>
<td>
<p>The number of time intervals.</p>
</td></tr>
<tr><td><code id="pwexpreg_+3A_tcut">tcut</code></td>
<td>
<p>A vector that specifies the endpoints of time intervals
for the baseline piecewise exponential survival distribution.
Must start with 0, e.g., c(0, 60) breaks the time axis into 2 event
intervals: [0, 60) and [60, Inf). By default, it is set to 0.</p>
</td></tr>
<tr><td><code id="pwexpreg_+3A_q">q</code></td>
<td>
<p>The number of columns of the covariates matrix.</p>
</td></tr>
<tr><td><code id="pwexpreg_+3A_x">x</code></td>
<td>
<p>The covariates matrix (excluding the intercept).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The maximum likelihood estimates and the associated
covariance matrix, AIC and BIC.
</p>

<hr>
<h2 id='qpwexp'>Quantile function for piecewise exponential regression</h2><span id='topic+qpwexp'></span>

<h3>Description</h3>

<p>Obtains the quantile function value for piecewise
exponential regression.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>qpwexp(p, theta, J, tcut, q = 0, x = 0, lower.tail = TRUE, log.p = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="qpwexp_+3A_p">p</code></td>
<td>
<p>The vector of probabilities.</p>
</td></tr>
<tr><td><code id="qpwexp_+3A_theta">theta</code></td>
<td>
<p>The parameter vector consisting of gamma for log
piecewise hazards and beta for regression coefficients.</p>
</td></tr>
<tr><td><code id="qpwexp_+3A_j">J</code></td>
<td>
<p>The number of time intervals.</p>
</td></tr>
<tr><td><code id="qpwexp_+3A_tcut">tcut</code></td>
<td>
<p>A vector that specifies the endpoints of time intervals
for the baseline piecewise exponential survival distribution.
Must start with 0, e.g., c(0, 60) breaks the time axis into 2 event
intervals: [0, 60) and [60, Inf). By default, it is set to 0.</p>
</td></tr>
<tr><td><code id="qpwexp_+3A_q">q</code></td>
<td>
<p>The number of elements in the vector of covariates.</p>
</td></tr>
<tr><td><code id="qpwexp_+3A_x">x</code></td>
<td>
<p>The vector of covariates (excluding the intercept).</p>
</td></tr>
<tr><td><code id="qpwexp_+3A_lower.tail">lower.tail</code></td>
<td>
<p>logical; if TRUE (default), probabilities are
the distribution function, otherwise, the survival function.</p>
</td></tr>
<tr><td><code id="qpwexp_+3A_log.p">log.p</code></td>
<td>
<p>logical; if TRUE, probabilities p are given as log(p).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The quantiles t such that P(T &lt;= t | X = x) = p.
</p>

<hr>
<h2 id='runShinyApp'>Run Shiny app</h2><span id='topic+runShinyApp'></span>

<h3>Description</h3>

<p>Runs the event prediction Shiny app.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>runShinyApp()
</code></pre>


<h3>Author(s)</h3>

<p>Kaifeng Lu, <a href="mailto:kaifenglu@gmail.com">kaifenglu@gmail.com</a>
</p>

<hr>
<h2 id='summarizeObserved'>Summarize observed data</h2><span id='topic+summarizeObserved'></span>

<h3>Description</h3>

<p>Provides an overview of the observed data, including
the trial start date, data cutoff date, enrollment duration,
number of subjects enrolled, number of events and dropouts,
number of subjects at risk, cumulative enrollment and event data,
daily enrollment rates, and Kaplan-Meier plots for time to event
and time to dropout.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>summarizeObserved(
  df,
  to_predict = "event only",
  showplot = TRUE,
  by_treatment = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summarizeObserved_+3A_df">df</code></td>
<td>
<p>The subject-level data, including <code>trialsdt</code>,
<code>usubjid</code>, <code>randdt</code>, and <code>cutoffdt</code> for enrollment
prediction, as well as <code>time</code>, <code>event</code> and <code>dropout</code>
for event prediction, and <code>treatment</code> coded as 1, 2,
and so on, and <code>treatment_description</code> for prediction
by treatment group.</p>
</td></tr>
<tr><td><code id="summarizeObserved_+3A_to_predict">to_predict</code></td>
<td>
<p>Specifies what to predict: &quot;enrollment only&quot;,
&quot;event only&quot;, or &quot;enrollment and event&quot;. By default, it is set to
&quot;event only&quot;.</p>
</td></tr>
<tr><td><code id="summarizeObserved_+3A_showplot">showplot</code></td>
<td>
<p>A Boolean variable to control whether or not to
show the observed data plots. By default, it is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="summarizeObserved_+3A_by_treatment">by_treatment</code></td>
<td>
<p>A Boolean variable to control whether or not to
summarize observed data by treatment group. By default,
it is set to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list that includes a range of summary statistics,
data sets, and plots depending on the value of <code>to_predict</code>.
</p>


<h3>Author(s)</h3>

<p>Kaifeng Lu, <a href="mailto:kaifenglu@gmail.com">kaifenglu@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
observed1 &lt;- summarizeObserved(df = interimData1,
                               to_predict = "enrollment and event")

observed2 &lt;- summarizeObserved(df = interimData2,
                               to_predict = "event only")

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
