<!DOCTYPE html><html><head><title>Help for package ubiquity</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ubiquity}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#apply_sub_file_COV'><p>Extracts Covariates for a Subject from a Subject Data File</p></a></li>
<li><a href='#archive_estimation'><p>Archive Estimation Results</p></a></li>
<li><a href='#AUC_Bailers_method'><p>Calculate AUC for Sparse Data</p></a></li>
<li><a href='#build_system'><p>Build the System File</p></a></li>
<li><a href='#calculate_halflife'><p>Calculate the halflife of data</p></a></li>
<li><a href='#calculate_objective'><p>Calculates the Value of the Specified Objective Function</p></a></li>
<li><a href='#calculate_objective_ga'><p><code>GA</code> Wrapper for calculate_objective</p></a></li>
<li><a href='#calculate_objective_pso'><p><code>pso</code> Wrapper for calculate_objective</p></a></li>
<li><a href='#calculate_variance'><p>Calculates the Variance in od_general</p></a></li>
<li><a href='#check_steady_state'><p>Verify System Steady State</p></a></li>
<li><a href='#compare_estimate'><p>Compares Estimate to Bounds</p></a></li>
<li><a href='#estimate_parameters'><p>Performs parameter estimation</p></a></li>
<li><a href='#fetch_full_parameters'><p>Create Full Parameter Vector from Estimation Subset</p></a></li>
<li><a href='#find_bracketed_arguments'><p>Parse Prototype Functions for Arguments</p></a></li>
<li><a href='#generate_parameter'><p>Generates a Parameter Based on <code>&lt;IIV:?&gt;</code> in the System File</p></a></li>
<li><a href='#generate_report'><p>Generate Text Report with Estimation Results</p></a></li>
<li><a href='#generate_subject'><p>Generate Subject</p></a></li>
<li><a href='#gg_axis'><p>Make Pretty ggplot x- or y-Axis Log 10 Scale</p></a></li>
<li><a href='#gg_log10_xaxis'><p>Make Pretty ggplot x-Axis Log 10 Scale</p></a></li>
<li><a href='#gg_log10_yaxis'><p>Make Pretty ggplot y-Axis Log 10 Scale</p></a></li>
<li><a href='#GUI_log_entry'><p>Wrapper for system_log_entry Used in ShinyApp</p></a></li>
<li><a href='#linspace'><p>Implementation of the <code>linspace</code> Function from Matlab</p></a></li>
<li><a href='#logspace'><p>Implementation of the <code>logspace</code> Function from Matlab</p></a></li>
<li><a href='#make_forcing_function'><p>Makes Forcing Function From Times and Values</p></a></li>
<li><a href='#nm_select_records'><p>Select Records from NONMEM-ish Data Set</p></a></li>
<li><a href='#pad_string'><p>Pad String with Spaces</p></a></li>
<li><a href='#parse_patterns'><p>Parse String for Prototype Functions</p></a></li>
<li><a href='#prepare_figure'><p>Make ggplot Figure Pretty</p></a></li>
<li><a href='#run_simulation_titrate'><p>Simulate With Titration or Rule-Based Inputs</p></a></li>
<li><a href='#run_simulation_ubiquity'><p>Simulate Individual Response</p></a></li>
<li><a href='#sample_around'><p>Define Sample Times Around Events</p></a></li>
<li><a href='#simulate_subjects'><p>Run Population Simulations</p></a></li>
<li><a href='#solution_statistics'><p>Calculate Solution Statistics</p></a></li>
<li><a href='#som_to_df'><p>Converts the Wide/Verbose Output Simulation Functions into Data Frames</p></a></li>
<li><a href='#system_check_requirements'><p>Check For Perl and C Tools</p></a></li>
<li><a href='#system_check_steady_state'><p>Verify System Steady State</p></a></li>
<li><a href='#system_clear_cohorts'><p>Clear all Cohorts</p></a></li>
<li><a href='#system_define_cohort'><p>Define Estimation Cohort</p></a></li>
<li><a href='#system_define_cohorts_nm'><p>Define Cohorts from NONMEM Input File</p></a></li>
<li><a href='#system_estimate_parameters'><p>Control Estimation Process</p></a></li>
<li><a href='#system_fetch_guess'><p>Fetch Current Parameter Guesses</p></a></li>
<li><a href='#system_fetch_iiv'><p>Fetch Variability Terms</p></a></li>
<li><a href='#system_fetch_nca'><p>Fetch NCA Results</p></a></li>
<li><a href='#system_fetch_nca_columns'><p>Columns in NCA Analysis</p></a></li>
<li><a href='#system_fetch_parameters'><p>Fetch System Parameters</p></a></li>
<li><a href='#system_fetch_rpt_officer_object'><p>Extracts the officer Object From the Specified ubiquity Report</p></a></li>
<li><a href='#system_fetch_rpt_onbrand_object'><p>Extracts the onbrand Object From the Specified ubiquity Report</p></a></li>
<li><a href='#system_fetch_set'><p>Fetch Mathematical Set</p></a></li>
<li><a href='#system_fetch_template'><p>Create New Analysis Template</p></a></li>
<li><a href='#system_fetch_TSsys'><p>Fetch System Timescale</p></a></li>
<li><a href='#system_glp_init'><p>Initialize GLP study design</p></a></li>
<li><a href='#system_glp_scenario'><p>Design GLP Study For a Scenario</p></a></li>
<li><a href='#system_load_data'><p>Loading Datasets</p></a></li>
<li><a href='#system_log_debug_save'><p>Save variables to files</p></a></li>
<li><a href='#system_log_entry'><p>Add Log Entry</p></a></li>
<li><a href='#system_log_init'><p>Initialize System Log File</p></a></li>
<li><a href='#system_nca_parameters_meta'><p>List NCA parameters, text names and descriptions</p></a></li>
<li><a href='#system_nca_run'><p>Automatic NCA</p></a></li>
<li><a href='#system_nca_summary'><p>Summarize NCA Results in Tabular Format</p></a></li>
<li><a href='#system_new'><p>Create New <code>system.txt</code> File</p></a></li>
<li><a href='#system_new_list'><p>Fetch List of Available System Templates</p></a></li>
<li><a href='#system_new_tt_rule'><p>Titration Rules</p></a></li>
<li><a href='#system_nm_check_ds'><p>Check NONMEM Dataset for Automatic Definitions</p></a></li>
<li><a href='#system_od_general'><p>General Observation Details Function</p></a></li>
<li><a href='#system_plot_cohorts'><p>Plot Estimation Results</p></a></li>
<li><a href='#system_req'><p>Require Suggested Packages</p></a></li>
<li><a href='#system_rpt_add_doc_content'><p>Adds Content to a Word Report</p></a></li>
<li><a href='#system_rpt_add_slide'><p>Add Slide to a Powerpoint Report</p></a></li>
<li><a href='#system_rpt_estimation'><p>Generate a Report from Parameter Estimation</p></a></li>
<li><a href='#system_rpt_nca'><p>Report NCA</p></a></li>
<li><a href='#system_rpt_read_template'><p>Initialize a New Report</p></a></li>
<li><a href='#system_rpt_save_report'><p>Save Report to a File</p></a></li>
<li><a href='#system_rpt_template_details'><p>Generate Details about Report Template</p></a></li>
<li><a href='#system_select_set'><p>Selecting Parameter Sets</p></a></li>
<li><a href='#system_set_bolus'><p>Set Bolus Inputs</p></a></li>
<li><a href='#system_set_covariate'><p>Set Covariate Values</p></a></li>
<li><a href='#system_set_guess'><p>Alter Initial Guess and Parameter Bounds</p></a></li>
<li><a href='#system_set_iiv'><p>Set Variability Terms</p></a></li>
<li><a href='#system_set_option'><p>Setting Analysis Options</p></a></li>
<li><a href='#system_set_parameter'><p>Set Value for Parameter</p></a></li>
<li><a href='#system_set_rate'><p>Set Infusion Rate Inputs</p></a></li>
<li><a href='#system_set_rpt_officer_object'><p>Sets the officer Object for the Specified ubiquity Report</p></a></li>
<li><a href='#system_set_rpt_onbrand_object'><p>Sets the onbrand Object for the Specified ubiquity Report</p></a></li>
<li><a href='#system_set_tt_bolus'><p>Actual Function Called by <code>SI_TT_BOLUS</code></p></a></li>
<li><a href='#system_set_tt_cond'><p>Define Titration Triggers and Actions</p></a></li>
<li><a href='#system_set_tt_rate'><p>Actual Function Called by <code>SI_TT_RATE</code></p></a></li>
<li><a href='#system_simulate_estimation_results'><p>Simulate Results at Estimates</p></a></li>
<li><a href='#system_ts_to_simtime'><p>Convert Time in Timescale to Simulation Time</p></a></li>
<li><a href='#system_view'><p>View Information About the System</p></a></li>
<li><a href='#system_zero_inputs'><p>Zero All Model Inputs</p></a></li>
<li><a href='#tic'><p>Implementation of Matlab <code>tic()</code> command</p></a></li>
<li><a href='#timecourse_stats'><p>Calculate Timecourse Statistics for a Matrix of Responses</p></a></li>
<li><a href='#toc'><p>Implementation of Matlab <code>toc()</code> command</p></a></li>
<li><a href='#ubiquity_name_check'><p>Check Names of Cohorts, Analyses, Reports, etc.</p></a></li>
<li><a href='#var2string'><p>Converts Numeric Variables into Padded Strings</p></a></li>
<li><a href='#var2string_gen'><p>Convert R Objects to Strings</p></a></li>
<li><a href='#vp'><p>Print and Log Messages</p></a></li>
<li><a href='#workshop_fetch'><p>Fetch Ubiquity Workshop Sections</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>PKPD, PBPK, and Systems Pharmacology Modeling Tools</td>
</tr>
<tr>
<td>Version:</td>
<td>2.0.3</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>John Harrold &lt;john.m.harrold@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Complete work flow for the analysis of pharmacokinetic pharmacodynamic (PKPD), physiologically-based pharmacokinetic (PBPK) and systems pharmacology models including: creation of ordinary differential equation-based models, pooled parameter estimation, individual/population based simulations, rule-based simulations for clinical trial design and modeling assays, deployment with a customizable 'Shiny' app, and non-compartmental analysis. System-specific analysis templates can be generated and each element includes integrated reporting with 'PowerPoint' and 'Word'. </td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://ubiquity.tools/rworkflow">https://ubiquity.tools/rworkflow</a></td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>Perl</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/john-harrold/ubiquity/issues">https://github.com/john-harrold/ubiquity/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/BSD-2-Clause">BSD_2_clause</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Imports:</td>
<td>cli, deSolve, dplyr (&ge; 1.0.0), digest, doParallel, flextable,
foreach, ggplot2, knitr, magrittr, MASS, onbrand (&ge; 1.0.2),
optimx, PKNCA, pso, readxl, rmarkdown, rhandsontable, scales,
stats, stringr, shiny,</td>
</tr>
<tr>
<td>Suggests:</td>
<td>GA, GGally, gridGraphics, gridExtra, grid, officer, webshot,
ggrepel, rstudioapi, testthat</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-03-08 03:55:37 UTC; jmh</td>
</tr>
<tr>
<td>Author:</td>
<td>John Harrold <a href="https://orcid.org/0000-0003-2052-4373"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-03-08 09:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='apply_sub_file_COV'>Extracts Covariates for a Subject from a Subject Data File</h2><span id='topic+apply_sub_file_COV'></span>

<h3>Description</h3>

<p>This function is used when stochastic simulations are being performed using
a data file for the subject level information. If the data file contains
covariate information, this function will update the system for each subjects
covariates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apply_sub_file_COV(
  tmpcfg,
  cov_found,
  sub_dataset,
  sub_ID_col,
  sub_TIME_col,
  file_ID
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apply_sub_file_COV_+3A_tmpcfg">tmpcfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="apply_sub_file_COV_+3A_cov_found">cov_found</code></td>
<td>
<p>list of covariates found in dataset</p>
</td></tr>
<tr><td><code id="apply_sub_file_COV_+3A_sub_dataset">sub_dataset</code></td>
<td>
<p>name of dataset with subject parameters</p>
</td></tr>
<tr><td><code id="apply_sub_file_COV_+3A_sub_id_col">sub_ID_col</code></td>
<td>
<p>name of column in dataset with subject IDs</p>
</td></tr>
<tr><td><code id="apply_sub_file_COV_+3A_sub_time_col">sub_TIME_col</code></td>
<td>
<p>name of column in dataset with simulation time</p>
</td></tr>
<tr><td><code id="apply_sub_file_COV_+3A_file_id">file_ID</code></td>
<td>
<p>subject ID to extract covariates for</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ubiquity system object with the covariates set to those for the current subject
</p>

<hr>
<h2 id='archive_estimation'>Archive Estimation Results</h2><span id='topic+archive_estimation'></span>

<h3>Description</h3>

<p>Archives the estimation results by moving the output files to the same file
names with <code>'name'</code> prepended to them. This prevents them from being
overwritten in a different analysis script the following files are
archived:
</p>

<ul>
<li> <p><code>output/parameters_all.csv</code>
</p>
</li>
<li> <p><code>output/parameters_est.csv</code>
</p>
</li>
<li> <p><code>output/report.txt</code>
</p>
</li></ul>

<p>Example:
</p>
<p>archive_estimation('mysoln', cfg)
</p>
<p>Would rename the files above 
</p>

<ul>
<li> <p><code>output/mysoln-parameters_all.csv</code>
</p>
</li>
<li> <p><code>output/mysoln-parameters_est.csv</code>
</p>
</li>
<li> <p><code>output/mysoln-report.txt</code>
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>archive_estimation(name, cfg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="archive_estimation_+3A_name">name</code></td>
<td>
<p>analysis name</p>
</td></tr>
<tr><td><code id="archive_estimation_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Boolean variable indicating success (<code>TRUE</code>) or failure (<code>FALSE</code>)
</p>

<hr>
<h2 id='AUC_Bailers_method'>Calculate AUC for Sparse Data</h2><span id='topic+AUC_Bailers_method'></span>

<h3>Description</h3>

<p>This is an implementation of Bailors method for calculating AUCs with
sparse sampling. It is taken from the following publication:
</p>
<p>Nedelman, J. R., Gibiansky, E., &amp; Lau, D. T. (1995). Applying Bailer's
method for AUC confidence intervals to sparse sampling Pharmaceutical
Research, 12(1), 124-128.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AUC_Bailers_method(
  conc_data = NULL,
  dsmap = list(NTIME = "NTIME", CONC = "CONC", ID = "ID")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AUC_Bailers_method_+3A_conc_data">conc_data</code></td>
<td>
<p>data frame containing the sparse data</p>
</td></tr>
<tr><td><code id="AUC_Bailers_method_+3A_dsmap">dsmap</code></td>
<td>
<p>list with names specifying the columns:
</p>

<ul>
<li> <p><code>NTIME</code>       Nominal time since last dose;  <code>"NTIME"</code> (default)
</p>
</li>
<li> <p><code>CONC</code>        Concentration data;  <code>"CONC"</code> (default)
</p>
</li>
<li> <p><code>ID</code>          Subject ID;  (<code>"ID"</code> (default)
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>list with the following elements
</p>

<ul>
<li> <p><code>isgood</code>   Boolean value indicating the result of the function call
</p>
</li>
<li> <p><code>AUC</code>      Mean AUC
</p>
</li>
<li> <p><code>var_AUC</code>  Variance of the AUC
</p>
</li>
<li> <p><code>msgs</code>     Sequence of strings contianing a description of any problems 
</p>
</li>
<li> <p><code>obss</code>     Internal of observations
</p>
</li>
<li> <p><code>times</code>    Sequence of time corresponding to the rows of <code>obs</code>
</p>
</li>
<li> <p><code>r</code>        number of observations at each time point (rows correspond to rows of <code>obs</code>)
</p>
</li></ul>


<hr>
<h2 id='build_system'>Build the System File</h2><span id='topic+build_system'></span>

<h3>Description</h3>

<p>Builds the specified system file creating the targets for R and other languages as well as the templates for performing simulations and estimations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>build_system(
  system_file = "system.txt",
  distribution = "automatic",
  perlcmd = "perl",
  output_directory = file.path(".", "output"),
  temporary_directory = file.path(".", "transient"),
  verbose = TRUE,
  ubiquity_app = FALSE,
  debug = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="build_system_+3A_system_file">system_file</code></td>
<td>
<p>name of the file defining the system in the <a href="https://ubiquity.tools">ubiquity</a> format (default = 'system.txt'), if the file does not exist a template will be created and compiled.</p>
</td></tr>
<tr><td><code id="build_system_+3A_distribution">distribution</code></td>
<td>
<p>indicates weather you are using a <code>'package'</code> or a <code>'stand alone'</code>
distribution of ubiquity. If set to <code>'automatic'</code> the build script will first 
look to see if the ubiquity R package is installed. If it is installed it
will use the package. Otherwise, it will assume a <code>"sand alone"</code> distribution.</p>
</td></tr>
<tr><td><code id="build_system_+3A_perlcmd">perlcmd</code></td>
<td>
<p>system command to run perl (&quot;perl&quot;)</p>
</td></tr>
<tr><td><code id="build_system_+3A_output_directory">output_directory</code></td>
<td>
<p>location to store analysis outputs (<code>file.path(".", "output")</code>)</p>
</td></tr>
<tr><td><code id="build_system_+3A_temporary_directory">temporary_directory</code></td>
<td>
<p>location to templates and otehr files after building the system (<code>file.path(".", "transient")</code>)</p>
</td></tr>
<tr><td><code id="build_system_+3A_verbose">verbose</code></td>
<td>
<p>enable verbose messaging   (<code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="build_system_+3A_ubiquity_app">ubiquity_app</code></td>
<td>
<p>set to <code>TRUE</code> when building the system to be used with the ubiquty App (<code>FALSE</code>)</p>
</td></tr>
<tr><td><code id="build_system_+3A_debug">debug</code></td>
<td>
<p>Boolean variable indicating if debugging information should be displayed (<code>TRUE</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>initialized ubiquity system object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
fr = system_new(file_name        = "system.txt", 
                system_file      = "mab_pk", 
                overwrite        = TRUE, 
                output_directory = tempdir())
cfg = build_system(system_file  = file.path(tempdir(), "system.txt"),
      output_directory          = file.path(tempdir(), "output"),
      temporary_directory       = tempdir())

</code></pre>

<hr>
<h2 id='calculate_halflife'>Calculate the halflife of data</h2><span id='topic+calculate_halflife'></span>

<h3>Description</h3>

<p>Determines the terminal halflife of a sequence of corresponding times and values with optional minimum and maximum times to censor data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_halflife(times = NULL, values = NULL, tmin = NULL, tmax = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calculate_halflife_+3A_times">times</code></td>
<td>
<p>- sequence of times</p>
</td></tr>
<tr><td><code id="calculate_halflife_+3A_values">values</code></td>
<td>
<p>- corresponding sequence of values</p>
</td></tr>
<tr><td><code id="calculate_halflife_+3A_tmin">tmin</code></td>
<td>
<p>- minimum time to include (<code>NULL</code>)</p>
</td></tr>
<tr><td><code id="calculate_halflife_+3A_tmax">tmax</code></td>
<td>
<p>- maximum time to include  (<code>NULL</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with the following names
</p>

<ul>
<li><p>thalf Halflife in units of times above
</p>
</li>
<li><p>mod Result of lm used to fit the log transformed data
</p>
</li>
<li><p>df Dataframe with the data and predicted values at the time within tmin and tmax
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>x     = c(0:100)
y     = exp(-.1*x)
th    = calculate_halflife(times=x, values=y)
thalf = th$thalf 
</code></pre>

<hr>
<h2 id='calculate_objective'>Calculates the Value of the Specified Objective Function</h2><span id='topic+calculate_objective'></span>

<h3>Description</h3>

<p>For a given set of system parameters the objective function
will be calculated based on defined cohorts and variance models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_objective(parameters, cfg, estimation = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calculate_objective_+3A_parameters">parameters</code></td>
<td>
<p>system parameters</p>
</td></tr>
<tr><td><code id="calculate_objective_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="calculate_objective_+3A_estimation">estimation</code></td>
<td>
<p>boolean variable to indicate if the objective function is being called during parameter estimation</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If estimation is <code>TRUE</code> it will return the objective function
value, if it is <code>FALSE</code> it will return a list with an element
<code>value</code> containing the objective function value and an element named
<code>isgood</code> that is <cite>TRUE</cite> if the objective function was successful.
</p>

<hr>
<h2 id='calculate_objective_ga'><code>GA</code> Wrapper for calculate_objective</h2><span id='topic+calculate_objective_ga'></span>

<h3>Description</h3>

<p>Converts the parameter vector to a named list and returns the
negative of the objective (turning the maximization into a minimization)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_objective_ga(pvect, cfg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calculate_objective_ga_+3A_pvect">pvect</code></td>
<td>
<p>system parameters</p>
</td></tr>
<tr><td><code id="calculate_objective_ga_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>objective function value
</p>

<hr>
<h2 id='calculate_objective_pso'><code>pso</code> Wrapper for calculate_objective</h2><span id='topic+calculate_objective_pso'></span>

<h3>Description</h3>

<p>The psoptim objective function assumes parameters will be a
vector and this function converts it to a named list to be consistent with the
ubiquity optmization routines.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_objective_pso(pvect, cfg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calculate_objective_pso_+3A_pvect">pvect</code></td>
<td>
<p>system parameters</p>
</td></tr>
<tr><td><code id="calculate_objective_pso_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>objective function value
</p>

<hr>
<h2 id='calculate_variance'>Calculates the Variance in od_general</h2><span id='topic+calculate_variance'></span>

<h3>Description</h3>

<p>Takes the variance specified as a string and evaluates it
locally, and returns that value
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_variance(
  SIMINT_parameters,
  SIMINT_varstr,
  SIMINT_odchunk,
  SIMINT_cfg
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calculate_variance_+3A_simint_parameters">SIMINT_parameters</code></td>
<td>
<p>system parameters</p>
</td></tr>
<tr><td><code id="calculate_variance_+3A_simint_varstr">SIMINT_varstr</code></td>
<td>
<p>string containing variance calculation</p>
</td></tr>
<tr><td><code id="calculate_variance_+3A_simint_odchunk">SIMINT_odchunk</code></td>
<td>
<p>chunk of observation details containing predictions, observations and the time</p>
</td></tr>
<tr><td><code id="calculate_variance_+3A_simint_cfg">SIMINT_cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Variance calculated for a given set of parameters in a model
</p>

<hr>
<h2 id='check_steady_state'>Verify System Steady State</h2><span id='topic+check_steady_state'></span>

<h3>Description</h3>

<p>Takes the output  <code><a href="#topic+run_simulation_ubiquity">run_simulation_ubiquity</a></code> and verifies that the system is running at steady state by analyzing the timecourse of all of the states in the system
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_steady_state(cfg, som)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_steady_state_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="check_steady_state_+3A_som">som</code></td>
<td>
<p>output of <code><a href="#topic+run_simulation_ubiquity">run_simulation_ubiquity</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with name <code>steady_state</code> (boolean indicating weather the system was at steady state) and <code>states</code> a vector of states that have steady state offset.
</p>

<hr>
<h2 id='compare_estimate'>Compares Estimate to Bounds</h2><span id='topic+compare_estimate'></span>

<h3>Description</h3>

<p>Compares the parameter estimate to the bounds and indicates if
the estimate is near the bound.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compare_estimate(cfg, parameters, pname)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="compare_estimate_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="compare_estimate_+3A_parameters">parameters</code></td>
<td>
<p>list of parameter estimates</p>
</td></tr>
<tr><td><code id="compare_estimate_+3A_pname">pname</code></td>
<td>
<p>name of parameter to compare</p>
</td></tr>
</table>


<h3>Value</h3>

<p>L - near the lower bound, U - near the upper bound
</p>

<hr>
<h2 id='estimate_parameters'>Performs parameter estimation</h2><span id='topic+estimate_parameters'></span>

<h3>Description</h3>

<p>Performs the actual parameter estimation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_parameters(cfg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimate_parameters_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with elements: 
</p>

<ul>
<li> <p><code>estimate</code> - vector of parameter estimates
</p>
</li>
<li> <p><code>raw</code> - raw output from the underlying optimization routine
</p>
</li>
<li> <p><code>conv</code> - list of convergence criteria with keys <code>num</code> (numeric)  <code>text</code> (text description)
</p>
</li>
<li> <p><code>obj</code> - objective function value
</p>
</li>
<li> <p><code>statistics_est</code> - solution statistics
</p>
</li>
<li> <p><code>sysup</code> - Text to update the system file with the parameter estimates
</p>
</li>
<li> <p><code>estimate</code> - Names list of parameter estiamtes
</p>
</li>
<li> <p><code>report</code> - Named list with elements for reporting
</p>
</li>
<li> <p><code>cohorts</code> - Cohort elements from the <code>cfg</code> file
</p>
</li>
<li> <p><code>cohort_view</code> - Cohort view from <code>system_view()</code> 
</p>
</li>
<li> <p><code>system_file</code> - Contents of the system file when estimation was
run
</p>
</li></ul>


<hr>
<h2 id='fetch_full_parameters'>Create Full Parameter Vector from Estimation Subset</h2><span id='topic+fetch_full_parameters'></span>

<h3>Description</h3>

<p>Can be used to take a subset of parameters (those being
estimated and returned from ' <code><a href="#topic+system_estimate_parameters">system_estimate_parameters</a></code>)
into a full list of system parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fetch_full_parameters(pest, cfg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fetch_full_parameters_+3A_pest">pest</code></td>
<td>
<p>list containing subset of parameters being estimated</p>
</td></tr>
<tr><td><code id="fetch_full_parameters_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is used to build a full parameter set from a subset, and is
normally used during parameter estimation in the observation details
function when the entire parameter vector is needed to simulate the system.
</p>
<p>The function select_set pulls out a parameter set and can optionally select
only a subset for estimation:
</p>
<pre>pnames = c('Vp', 'CL')
cfg = system_select_set(cfg, "default", pnames)</pre>
<p>The default values of this subset can be accessed in the following way:
</p>
<pre>pest = system_fetch_guess(cfg)</pre>
<p>The estimation routines will work with this reduced parameter set, but to
run simulations the full set is needed. The full values can be retrieved 
using the following: 
</p>
<pre>parameters = fetch_full_parameters(pest, cfg) </pre>


<h3>Value</h3>

<p>Full list of parameters with default values for the currently selected parameter set and the values in pest  merged
</p>


<h3>See Also</h3>

<p><code><a href="#topic+system_fetch_guess">system_fetch_guess</a></code>, <code><a href="#topic+system_select_set">system_select_set</a></code>
</p>

<hr>
<h2 id='find_bracketed_arguments'>Parse Prototype Functions for Arguments</h2><span id='topic+find_bracketed_arguments'></span>

<h3>Description</h3>

<p>Parses strings to find abstract functions (of the format
SIFUNC[ARG1][ARG2][ARG3] and extract the arguments from that function and
replace it with actual functions and any additional arguments needed
</p>


<h3>Usage</h3>

<pre><code class='language-R'>find_bracketed_arguments(str, pattern, replace = "", narg, op = "[", cp = "]")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="find_bracketed_arguments_+3A_str">str</code></td>
<td>
<p>string containing the prototype function call</p>
</td></tr>
<tr><td><code id="find_bracketed_arguments_+3A_pattern">pattern</code></td>
<td>
<p>string indicating the start of the function eg. <code>"SI_TT_BOLUS["</code></p>
</td></tr>
<tr><td><code id="find_bracketed_arguments_+3A_replace">replace</code></td>
<td>
<p>string to replace <code>pattern</code> with</p>
</td></tr>
<tr><td><code id="find_bracketed_arguments_+3A_narg">narg</code></td>
<td>
<p>number of arguments to prototype function</p>
</td></tr>
<tr><td><code id="find_bracketed_arguments_+3A_op">op</code></td>
<td>
<p>string used to indicating open parenthesis</p>
</td></tr>
<tr><td><code id="find_bracketed_arguments_+3A_cp">cp</code></td>
<td>
<p>string used to indicating close parenthesis</p>
</td></tr>
</table>


<h3>Value</h3>

<p>string containing the actual function call/code built from the prototype function
</p>

<hr>
<h2 id='generate_parameter'>Generates a Parameter Based on <code>&lt;IIV:?&gt;</code> in the System File</h2><span id='topic+generate_parameter'></span>

<h3>Description</h3>

<p>Internal function used to generate parameters based on IIV information
</p>


<h3>Usage</h3>

<pre><code class='language-R'>generate_parameter(
  SIMINT_parameters,
  SIMINT_cfg,
  SIMINT_PARAMETER_TV,
  SIMINT_IIV_VALUE,
  SIMINT_equation
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="generate_parameter_+3A_simint_parameters">SIMINT_parameters</code></td>
<td>
<p>parameters vector containing the typical values</p>
</td></tr>
<tr><td><code id="generate_parameter_+3A_simint_cfg">SIMINT_cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="generate_parameter_+3A_simint_parameter_tv">SIMINT_PARAMETER_TV</code></td>
<td>
<p>Typical value of the parameter in question</p>
</td></tr>
<tr><td><code id="generate_parameter_+3A_simint_iiv_value">SIMINT_IIV_VALUE</code></td>
<td>
<p>sample from mvr distribution</p>
</td></tr>
<tr><td><code id="generate_parameter_+3A_simint_equation">SIMINT_equation</code></td>
<td>
<p>equation relating IIV and typical value to the parameter value with variability</p>
</td></tr>
</table>


<h3>Value</h3>

<p>parameter value with the variability applied
</p>

<hr>
<h2 id='generate_report'>Generate Text Report with Estimation Results</h2><span id='topic+generate_report'></span>

<h3>Description</h3>

<p>Internal function used to generate a report of estimation results
</p>


<h3>Usage</h3>

<pre><code class='language-R'>generate_report(parameters, ss, cfg, conv_desc)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="generate_report_+3A_parameters">parameters</code></td>
<td>
<p>list of parameter estimates</p>
</td></tr>
<tr><td><code id="generate_report_+3A_ss">ss</code></td>
<td>
<p>output from solution_statistics</p>
</td></tr>
<tr><td><code id="generate_report_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="generate_report_+3A_conv_desc">conv_desc</code></td>
<td>
<p>description of convergence criteria</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with the following elements: 
</p>

<ul>
<li> <p><code>report_file</code> name of report file          
</p>
</li>
<li> <p><code>report_file_contents</code> contents of report file
</p>
</li>
<li> <p><code>parameters_all_file</code> name of CSV file with all parameters 
</p>
</li>
<li> <p><code>parameters_est_file</code> name of CSV file with only the estimates 
</p>
</li></ul>


<hr>
<h2 id='generate_subject'>Generate Subject</h2><span id='topic+generate_subject'></span>

<h3>Description</h3>

<p>Generates subject with variability specified using the <code>&lt;IIV:?&gt;</code> descriptor
in the system file
</p>


<h3>Usage</h3>

<pre><code class='language-R'>generate_subject(parameters, cfg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="generate_subject_+3A_parameters">parameters</code></td>
<td>
<p>vector of nominal parameter values</p>
</td></tr>
<tr><td><code id="generate_subject_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with a field named <code>parameters</code> containing a sample representing a subject
</p>

<hr>
<h2 id='gg_axis'>Make Pretty ggplot x- or y-Axis Log 10 Scale</h2><span id='topic+gg_axis'></span>

<h3>Description</h3>

<p>used to convert the x and y-axis of a ggplot to a log 10 scale that is more visually satisfying than the ggplot default.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gg_axis(
  fo,
  yaxis_scale = TRUE,
  xaxis_scale = TRUE,
  ylim_min = NULL,
  ylim_max = NULL,
  xlim_min = NULL,
  xlim_max = NULL,
  x_tick_label = TRUE,
  y_tick_label = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gg_axis_+3A_fo">fo</code></td>
<td>
<p>ggplot figure object</p>
</td></tr>
<tr><td><code id="gg_axis_+3A_yaxis_scale">yaxis_scale</code></td>
<td>
<p><code>TRUE</code> indicates that the y-axis should be log10 scaled</p>
</td></tr>
<tr><td><code id="gg_axis_+3A_xaxis_scale">xaxis_scale</code></td>
<td>
<p><code>TRUE</code> indicates that the x-axis should be log10 scaled</p>
</td></tr>
<tr><td><code id="gg_axis_+3A_ylim_min">ylim_min</code></td>
<td>
<p>set to a number to define the lower bound of the y-axis</p>
</td></tr>
<tr><td><code id="gg_axis_+3A_ylim_max">ylim_max</code></td>
<td>
<p>set to a number to define the upper bound of the y-axis</p>
</td></tr>
<tr><td><code id="gg_axis_+3A_xlim_min">xlim_min</code></td>
<td>
<p>set to a number to define the lower bound of the x-axis</p>
</td></tr>
<tr><td><code id="gg_axis_+3A_xlim_max">xlim_max</code></td>
<td>
<p>set to a number to define the upper bound of the x-axis</p>
</td></tr>
<tr><td><code id="gg_axis_+3A_x_tick_label">x_tick_label</code></td>
<td>
<p><code>TRUE</code> to show x tick labels, <code>FALSE</code> to hide the x tick labels</p>
</td></tr>
<tr><td><code id="gg_axis_+3A_y_tick_label">y_tick_label</code></td>
<td>
<p><code>TRUE</code> to show y tick labels, <code>FALSE</code> to hide the y tick labels</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot object with formatted axis
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gg_log10_xaxis">gg_log10_xaxis</a></code> and <code><a href="#topic+gg_log10_yaxis">gg_log10_yaxis</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("ggplot2")
df = data.frame(x = seq(0.01,10,.01),
               y = seq(0.01,10,.01)^2)
p       = ggplot(df, aes(x=x, y=y)) + geom_line()
# pretty up the axes
p       = prepare_figure(fo=p, purpose="print")
# pretty log10 y-axis 
p_logy  = gg_log10_yaxis(fo=p)
# pretty log10 x-axis 
p_logx  = gg_log10_xaxis(fo=p)
# pretty log10 yx-axis 
p_logxy = gg_axis(fo=p)
</code></pre>

<hr>
<h2 id='gg_log10_xaxis'>Make Pretty ggplot x-Axis Log 10 Scale</h2><span id='topic+gg_log10_xaxis'></span>

<h3>Description</h3>

<p>Wrapper for <code><a href="#topic+gg_axis">gg_axis</a></code> to create a log 10 x-axis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gg_log10_xaxis(
  fo,
  xlim_min = NULL,
  xlim_max = NULL,
  y_tick_label = TRUE,
  x_tick_label = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gg_log10_xaxis_+3A_fo">fo</code></td>
<td>
<p>ggplot figure object</p>
</td></tr>
<tr><td><code id="gg_log10_xaxis_+3A_xlim_min">xlim_min</code></td>
<td>
<p>set to a number to define the lower bound of the x-axis</p>
</td></tr>
<tr><td><code id="gg_log10_xaxis_+3A_xlim_max">xlim_max</code></td>
<td>
<p>set to a number to define the upper bound of the x-axis</p>
</td></tr>
<tr><td><code id="gg_log10_xaxis_+3A_y_tick_label">y_tick_label</code></td>
<td>
<p><code>TRUE</code> to show y tick labels, <code>FALSE</code> to hide the y tick labels</p>
</td></tr>
<tr><td><code id="gg_log10_xaxis_+3A_x_tick_label">x_tick_label</code></td>
<td>
<p><code>TRUE</code> to show x tick labels, <code>FALSE</code> to hide the x tick labels</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot object with formatted axis
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gg_axis">gg_axis</a></code> and <code><a href="#topic+gg_log10_xaxis">gg_log10_xaxis</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("ggplot2")
df = data.frame(x = seq(0.01,10,.01),
               y = seq(0.01,10,.01)^2)
p       = ggplot(df, aes(x=x, y=y)) + geom_line()
# pretty up the axes
p       = prepare_figure(fo=p, purpose="print")
# pretty log10 y-axis 
p_logy  = gg_log10_yaxis(fo=p)
# pretty log10 x-axis 
p_logx  = gg_log10_xaxis(fo=p)
# pretty log10 yx-axis 
p_logxy = gg_axis(fo=p)
</code></pre>

<hr>
<h2 id='gg_log10_yaxis'>Make Pretty ggplot y-Axis Log 10 Scale</h2><span id='topic+gg_log10_yaxis'></span>

<h3>Description</h3>

<p>Wrapper for <code><a href="#topic+gg_axis">gg_axis</a></code> to create a log 10 y-axis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gg_log10_yaxis(
  fo,
  ylim_min = NULL,
  ylim_max = NULL,
  y_tick_label = TRUE,
  x_tick_label = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gg_log10_yaxis_+3A_fo">fo</code></td>
<td>
<p>ggplot figure object</p>
</td></tr>
<tr><td><code id="gg_log10_yaxis_+3A_ylim_min">ylim_min</code></td>
<td>
<p>set to a number to define the lower bound of the y-axis</p>
</td></tr>
<tr><td><code id="gg_log10_yaxis_+3A_ylim_max">ylim_max</code></td>
<td>
<p>set to a number to define the upper bound of the y-axis</p>
</td></tr>
<tr><td><code id="gg_log10_yaxis_+3A_y_tick_label">y_tick_label</code></td>
<td>
<p><code>TRUE</code> to show y tick labels, <code>FALSE</code> to hide the y tick labels</p>
</td></tr>
<tr><td><code id="gg_log10_yaxis_+3A_x_tick_label">x_tick_label</code></td>
<td>
<p><code>TRUE</code> to show x tick labels, <code>FALSE</code> to hide the x tick labels</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot object with formatted axis
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gg_axis">gg_axis</a></code> and <code><a href="#topic+gg_log10_xaxis">gg_log10_xaxis</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("ggplot2")
df = data.frame(x = seq(0.01,10,.01),
               y = seq(0.01,10,.01)^2)
p       = ggplot(df, aes(x=x, y=y)) + geom_line()
# pretty up the axes
p       = prepare_figure(fo=p, purpose="print")
# pretty log10 y-axis 
p_logy  = gg_log10_yaxis(fo=p)
# pretty log10 x-axis 
p_logx  = gg_log10_xaxis(fo=p)
# pretty log10 yx-axis 
p_logxy = gg_axis(fo=p)
</code></pre>

<hr>
<h2 id='GUI_log_entry'>Wrapper for system_log_entry Used in ShinyApp</h2><span id='topic+GUI_log_entry'></span>

<h3>Description</h3>

<p>Called from the ShinyApp to add a log entry with &quot;App&quot;
prepended to the log entry
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GUI_log_entry(cfg, text)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="GUI_log_entry_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="GUI_log_entry_+3A_text">text</code></td>
<td>
<p>string to print/log</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Boolean variable indicating success (<code>TRUE</code>) or failure (<code>FALSE</code>)
</p>

<hr>
<h2 id='linspace'>Implementation of the <code>linspace</code> Function from Matlab</h2><span id='topic+linspace'></span>

<h3>Description</h3>

<p>Creates a vector of n elements equally spaced apart.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>linspace(a, b, n = 100)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="linspace_+3A_a">a</code></td>
<td>
<p>initial number</p>
</td></tr>
<tr><td><code id="linspace_+3A_b">b</code></td>
<td>
<p>final number</p>
</td></tr>
<tr><td><code id="linspace_+3A_n">n</code></td>
<td>
<p>number of elements  (integer &gt;= 2)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of numbers from <code>a</code> to <code>b</code> with
<code>n</code> linearly spaced apart
</p>


<h3>Examples</h3>

<pre><code class='language-R'>linspace(0,100, 20)
</code></pre>

<hr>
<h2 id='logspace'>Implementation of the <code>logspace</code> Function from Matlab</h2><span id='topic+logspace'></span>

<h3>Description</h3>

<p>Creates a vector of n elements logarithmically spaced apart.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>logspace(a, b, n = 100)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="logspace_+3A_a">a</code></td>
<td>
<p>initial number</p>
</td></tr>
<tr><td><code id="logspace_+3A_b">b</code></td>
<td>
<p>final number</p>
</td></tr>
<tr><td><code id="logspace_+3A_n">n</code></td>
<td>
<p>number of elements  (integer &gt;=2)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of numbers from <code>a</code> to <code>b</code> with
<code>n</code> logarithmically (base 10) spaced apart
</p>


<h3>Examples</h3>

<pre><code class='language-R'>logspace(-2, 3,20)
</code></pre>

<hr>
<h2 id='make_forcing_function'>Makes Forcing Function From Times and Values</h2><span id='topic+make_forcing_function'></span>

<h3>Description</h3>

<p>Takes a list of times, values, and an interpolation method
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_forcing_function(
  times,
  values,
  type,
  output_times,
  sample_delta_mult = 0.001
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="make_forcing_function_+3A_times">times</code></td>
<td>
<p>time values for the forcing function</p>
</td></tr>
<tr><td><code id="make_forcing_function_+3A_values">values</code></td>
<td>
<p>magnitude for each time (same length of time)</p>
</td></tr>
<tr><td><code id="make_forcing_function_+3A_type">type</code></td>
<td>
<p>string indicating the type of forcing function can be one of the following:
</p>

<ul>
<li>  <p><code>"step"</code> for constant values that switch to new values at the times
</p>
</li>
<li>  <p><code>"linear"</code> to linearly interpolate between the points
</p>
</li></ul>
</td></tr>
<tr><td><code id="make_forcing_function_+3A_output_times">output_times</code></td>
<td>
<p>vector of simulation output times</p>
</td></tr>
<tr><td><code id="make_forcing_function_+3A_sample_delta_mult">sample_delta_mult</code></td>
<td>
<p>multiplier used to control the magnitude of spacing around event times</p>
</td></tr>
</table>


<h3>Value</h3>

<p>matrix with two columns: first column is a vector of times and the second column is a vector of values
</p>

<hr>
<h2 id='nm_select_records'>Select Records from NONMEM-ish Data Set</h2><span id='topic+nm_select_records'></span>

<h3>Description</h3>

<p>Retrieves a subset of a NONMEM-ish data set based on a list containing filtering information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nm_select_records(cfg, values, filter)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nm_select_records_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="nm_select_records_+3A_values">values</code></td>
<td>
<p>dataframe containing the dataset with column headers</p>
</td></tr>
<tr><td><code id="nm_select_records_+3A_filter">filter</code></td>
<td>
<p>list with element names as headers for <code>values</code> with values from the same header OR'd and values across headers AND'd</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the dataset has the headings <code>ID</code>, <code>DOSE</code> and <code>SEX</code>  and
<code>filter</code> has the following format:
</p>
<pre>
filter = list()
filter$ID   = c(1:4)
filter$DOSE = c(5,10)
filter$SEX  = c(1)
</pre>
<p>It would be translated into the boolean filter:
</p>
<pre>
((ID==1) | (ID==2) | (ID==3) | (ID==4)) &amp; ((DOSE == 5) | (DOSE==10)) &amp; (SEX == 1)
</pre>


<h3>Value</h3>

<p>subset of dataset
</p>

<hr>
<h2 id='pad_string'>Pad String with Spaces</h2><span id='topic+pad_string'></span>

<h3>Description</h3>

<p>Adds spaces to the beginning or end of strings until it reaches the maxlength. Used for aligning text.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pad_string(str, maxlength = 1, location = "beginning")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pad_string_+3A_str">str</code></td>
<td>
<p>string</p>
</td></tr>
<tr><td><code id="pad_string_+3A_maxlength">maxlength</code></td>
<td>
<p>length to pad to</p>
</td></tr>
<tr><td><code id="pad_string_+3A_location">location</code></td>
<td>
<p>either <code>"beginning"</code> to pad the left or <code>"end"</code> to pad the right</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Padded string
</p>


<h3>Examples</h3>

<pre><code class='language-R'>pad_string("bob", maxlength=10)
pad_string("bob", maxlength=10, location="end")
</code></pre>

<hr>
<h2 id='parse_patterns'>Parse String for Prototype Functions</h2><span id='topic+parse_patterns'></span>

<h3>Description</h3>

<p>A string can contain any number of prototype functions, and this function will find them and replace them with the actual R code.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>parse_patterns(cfg, str)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="parse_patterns_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="parse_patterns_+3A_str">str</code></td>
<td>
<p>string</p>
</td></tr>
</table>


<h3>Value</h3>

<p>String with the prototype functions replaced
</p>

<hr>
<h2 id='prepare_figure'>Make ggplot Figure Pretty</h2><span id='topic+prepare_figure'></span>

<h3>Description</h3>

<p>Takes a ggplot object and alters the line thicknesses and makes
other cosmetic changes to make it more appropriate for exporting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prepare_figure(
  purpose = "present",
  fo,
  y_tick_minor = FALSE,
  y_tick_major = FALSE,
  x_tick_minor = FALSE,
  x_tick_major = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="prepare_figure_+3A_purpose">purpose</code></td>
<td>
<p>either <code>"present"</code> (default), <code>"print"</code> or <code>"shiny"</code></p>
</td></tr>
<tr><td><code id="prepare_figure_+3A_fo">fo</code></td>
<td>
<p>ggplot figure object</p>
</td></tr>
<tr><td><code id="prepare_figure_+3A_y_tick_minor">y_tick_minor</code></td>
<td>
<p>Boolean value to control grid lines</p>
</td></tr>
<tr><td><code id="prepare_figure_+3A_y_tick_major">y_tick_major</code></td>
<td>
<p>Boolean value to control grid lines</p>
</td></tr>
<tr><td><code id="prepare_figure_+3A_x_tick_minor">x_tick_minor</code></td>
<td>
<p>Boolean value to control grid lines</p>
</td></tr>
<tr><td><code id="prepare_figure_+3A_x_tick_major">x_tick_major</code></td>
<td>
<p>Boolean value to control grid lines</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("ggplot2")
df = data.frame(x = seq(0.01,10,.01),
               y = seq(0.01,10,.01)^2)
p       = ggplot(df, aes(x=x, y=y)) + geom_line()
# pretty up the axes
p       = prepare_figure(fo=p, purpose="print")
# pretty log10 y-axis 
p_logy  = gg_log10_yaxis(fo=p)
# pretty log10 x-axis 
p_logx  = gg_log10_xaxis(fo=p)
# pretty log10 yx-axis 
p_logxy = gg_axis(fo=p)
</code></pre>

<hr>
<h2 id='run_simulation_titrate'>Simulate With Titration or Rule-Based Inputs</h2><span id='topic+run_simulation_titrate'></span>

<h3>Description</h3>

<p>Provides an interface to <code><a href="#topic+run_simulation_ubiquity">run_simulation_ubiquity</a></code>
to start and stop simulations and apply rules to control dosing and state-resets.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_simulation_titrate(SIMINT_p, SIMINT_cfg, SIMINT_dropfirst = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="run_simulation_titrate_+3A_simint_p">SIMINT_p</code></td>
<td>
<p>list of system parameters</p>
</td></tr>
<tr><td><code id="run_simulation_titrate_+3A_simint_cfg">SIMINT_cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="run_simulation_titrate_+3A_simint_dropfirst">SIMINT_dropfirst</code></td>
<td>
<p>when <code>TRUE</code> it will drop the first sample point (prevents bolus doses from starting at 0)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>som
</p>


<h3>See Also</h3>

<p><code><a href="#topic+system_new_tt_rule">system_new_tt_rule</a></code>, <code><a href="#topic+system_set_tt_cond">system_set_tt_cond</a></code> and the titration vignette (<code>vignette("Titration", package = "ubiquity")</code>)
</p>

<hr>
<h2 id='run_simulation_ubiquity'>Simulate Individual Response</h2><span id='topic+run_simulation_ubiquity'></span>

<h3>Description</h3>

<p>Controls the execution of individual simulations with deSolve using either R scripts or loadable C libraries.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_simulation_ubiquity(SIMINT_parameters, SIMINT_cfg, SIMINT_dropfirst = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="run_simulation_ubiquity_+3A_simint_parameters">SIMINT_parameters</code></td>
<td>
<p>vector of parameters</p>
</td></tr>
<tr><td><code id="run_simulation_ubiquity_+3A_simint_cfg">SIMINT_cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="run_simulation_ubiquity_+3A_simint_dropfirst">SIMINT_dropfirst</code></td>
<td>
<p>when <code>TRUE</code> it will drop the first sample point (prevents bolus doses from starting at 0)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The simulation output is mapped (<code>som</code>) is a list.
time-course is stored in the <code>simout</code> element. 
</p>

<ul>
<li><p> The first column (<code>time</code>) contains the simulation time in the units of the simulation. 
</p>
</li>
<li><p> Next there is a column for each: State, output and system parameter   
</p>
</li>
<li><p> Models with covariate will contain the initial value  (prefix: <code>SIMINT_CVIC_</code>) as well as the values at each time point
</p>
</li>
<li><p> Each static and dynamic system parameter is also passed through
</p>
</li>
<li><p> A column for each timescale is returned with a &quot;<code>ts.</code>&quot; prefix.
</p>
</li></ul>



<h3>See Also</h3>

<p>Simulation vignette (<code>vignette("Simulation", package = "ubiquity")</code>)
</p>

<hr>
<h2 id='sample_around'>Define Sample Times Around Events</h2><span id='topic+sample_around'></span>

<h3>Description</h3>

<p>When events, such as bolus doses, are applied to the system
rapid changes can occur. If the system is not sampled heavily around these
times, these changes may be missed in the output profiles. Based on the total
duration of the sample times, extra samples can be added near these events.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sample_around(tvals, ot, sample_delta_mult = 1e-06)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sample_around_+3A_tvals">tvals</code></td>
<td>
<p>vector of event times</p>
</td></tr>
<tr><td><code id="sample_around_+3A_ot">ot</code></td>
<td>
<p>simualtion output times</p>
</td></tr>
<tr><td><code id="sample_around_+3A_sample_delta_mult">sample_delta_mult</code></td>
<td>
<p>multiplier used to control the magnitude of spacing around and following event times</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For more information on setting options for population simulation see the
stochastic section of the <code><a href="#topic+system_set_option">system_set_option</a></code> help file.
</p>


<h3>Value</h3>

<p>vector of event times and added samples
</p>

<hr>
<h2 id='simulate_subjects'>Run Population Simulations</h2><span id='topic+simulate_subjects'></span>

<h3>Description</h3>

<p>Used to run Population/Monte Carlo simulations with subjects
generated from either provided variance/covariance information or a dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate_subjects(
  parameters,
  cfg,
  show_progress = TRUE,
  progress_message = "Simulating Subjects:"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simulate_subjects_+3A_parameters">parameters</code></td>
<td>
<p>list containing the typical value of parameters</p>
</td></tr>
<tr><td><code id="simulate_subjects_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="simulate_subjects_+3A_show_progress">show_progress</code></td>
<td>
<p>Boolean value controlling the display of a progress indicator (<code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="simulate_subjects_+3A_progress_message">progress_message</code></td>
<td>
<p>text string to prepend when called from the ShinyApp</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Failures due to numerical instability or other integration errors will be
captured within the function. Data for those subjects will be removed from the
output. Their IDs will be displayed as messages and stored in the output. 
</p>
<p>For more information on setting options for population simulation see the
stochastic section of the <code><a href="#topic+system_set_option">system_set_option</a></code> help file.
</p>


<h3>Value</h3>

<p>Mapped simulation output with individual predictions, individual
parameters, and summary statistics of the parameters. The Vignettes below
details on the format of the output.
</p>


<h3>See Also</h3>

<p>Vignette on simulation (<code>vignette("Simulation", package = "ubiquity")</code>) titration (<code>vignette("Titration", package = "ubiquity")</code>) as well as <code><a href="#topic+som_to_df">som_to_df</a></code>
</p>

<hr>
<h2 id='solution_statistics'>Calculate Solution Statistics</h2><span id='topic+solution_statistics'></span>

<h3>Description</h3>

<p>Attempts to determine the variance/covariance matrix,
confidence intervals and CV percent for a list of parameter estimates 
<code>parameters</code>. This method was taken from the ADAPT 5 User's Guide
chapter 3.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solution_statistics(parameters, cfg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="solution_statistics_+3A_parameters">parameters</code></td>
<td>
<p>list of parameter estimates</p>
</td></tr>
<tr><td><code id="solution_statistics_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The returned list has the following format:
</p>

<ul>
<li> <p><code>objective</code> - objective function value
</p>
</li>
<li> <p><code>num_observations</code> - number of observations
</p>
</li>
<li> <p><code>degrees_of_freedom</code> - degrees of freedom 
</p>
</li>
<li> <p><code>aic</code> - Akaike information criterion 
</p>
</li>
<li> <p><code>bic</code> - Bayesian (Schwarz) information criterion 
</p>
</li>
<li> <p><code>covariance</code> - variance covariance matrix
</p>
</li>
<li> <p><code>wls</code> - defined for weighted least squares objective with the following elements:
</p>

<ul>
<li> <p><code>jacobian</code>  - Jacobian matrix
</p>
</li>
<li> <p><code>weights</code>  - diagonal matrix of weights
</p>
</li>
<li> <p><code>error_variance</code>  - diagonal matrix of variances
</p>
</li></ul>

</li>
<li> <p><code>ml</code> - defined for maximum likelihood objective with the following elements:
</p>

<ul>
<li> <p><code>M</code> - Jacobian matrix with block for variance parameters
</p>
</li></ul>

</li>
<li> <p><code>coefficient_of_variation$pname</code> - CV percent for parameter <code>pname</code>
</p>
</li>
<li> <p><code>confidence_interval$lower_bound$pname</code> - Lower bound of the confidence interval for <code>pname</code>
</p>
</li>
<li> <p><code>confidence_interval$upper_bound$pname</code> - Upper bound of the confidence interval for <code>pname</code>
</p>
</li></ul>



<h3>Value</h3>

<p>list containing information about the provided estimates
</p>


<h3>See Also</h3>

<p>Vignette on estimation (<code>vignette("Estimation", package = "ubiquity")</code>)
</p>

<hr>
<h2 id='som_to_df'>Converts the Wide/Verbose Output Simulation Functions into Data Frames</h2><span id='topic+som_to_df'></span>

<h3>Description</h3>

<p>The functions <code><a href="#topic+run_simulation_ubiquity">run_simulation_ubiquity</a></code>, <code><a href="#topic+simulate_subjects">simulate_subjects</a></code>, or <code><a href="#topic+run_simulation_titrate">run_simulation_titrate</a></code>
provide outputs in a more structured format, but it may be useful to
convert this &quot;wide&quot; format to a tall/skinny format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>som_to_df(cfg, som)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="som_to_df_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="som_to_df_+3A_som">som</code></td>
<td>
<p>simulation output from <code><a href="#topic+run_simulation_ubiquity">run_simulation_ubiquity</a></code>, <code><a href="#topic+simulate_subjects">simulate_subjects</a></code>, or  <code><a href="#topic+run_simulation_titrate">run_simulation_titrate</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Data frame of the format:
</p>
<p>When applied to the output of <code><a href="#topic+run_simulation_ubiquity">run_simulation_ubiquity</a></code> or  <code><a href="#topic+run_simulation_titrate">run_simulation_titrate</a></code>
</p>

<ul>
<li> <p><code>ts.time</code>                   - timescale of the system
</p>
</li>
<li> <p><code>ts.ts1</code>, ... <code>ts.tsn</code> - timescales defined in the system (&lt;TS&gt;)
</p>
</li>
<li> <p><code>pred</code>                      - predicted/simulated response
</p>
</li>
<li> <p><code>tt.ti1.x</code>                  - titration event information (*)
</p>
</li>
<li> <p><code>name</code>                      - state or output (&lt;O&gt;) name corresponding to the prediction
</p>
</li></ul>

<p>When applied to the output of  <code><a href="#topic+simulate_subjects">simulate_subjects</a></code>
</p>

<ul>
<li> <p><code>ID</code>                      - subject ID
</p>
</li>
<li> <p><code>ts.time</code>                 - timescale of the system
</p>
</li>
<li> <p><code>ts.ts1, ... ts.tsn</code>      - timescales defined in the system (&lt;TS&gt;)
</p>
</li>
<li> <p><code>pred</code>                    - predicted/simulated response
</p>
</li>
<li> <p><code>tt.ti1.x</code>                - titration event information (*)
</p>
</li>
<li> <p><code>P1, P2, ... Pn</code>          - system parameters for the subject (&lt;P&gt;)
</p>
</li>
<li> <p><code>name</code>                    - state or output (&lt;O&gt;) name corresponding to the prediction
</p>
</li></ul>

<p>(* - field present when titration is enabled)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+run_simulation_titrate">run_simulation_titrate</a></code> internally when running simulations.
</p>

<hr>
<h2 id='system_check_requirements'>Check For Perl and C Tools</h2><span id='topic+system_check_requirements'></span>

<h3>Description</h3>

<p>Check the local installation for perl and verify C compiler is installed and working.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_check_requirements(
  checklist = list(perl = list(check = TRUE, perlcmd = "perl"), C = list(check = TRUE)),
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_check_requirements_+3A_checklist">checklist</code></td>
<td>
<p>list with names corresponding to elements of the system to check.</p>
</td></tr>
<tr><td><code id="system_check_requirements_+3A_verbose">verbose</code></td>
<td>
<p>enable verbose messaging</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List fn result of all packages
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
invisible(system_check_requirements())

</code></pre>

<hr>
<h2 id='system_check_steady_state'>Verify System Steady State</h2><span id='topic+system_check_steady_state'></span>

<h3>Description</h3>

<p>Takes the ubiquity system object and other optional inputs to verify the system is running at steady state. This also provides information that can be helpful in debugging systems not running at steady state.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_check_steady_state(
  cfg,
  parameters = NULL,
  zero_rates = TRUE,
  zero_bolus = TRUE,
  output_times = seq(0, 100, 1),
  offset_tol = .Machine$double.eps * 100,
  derivative_tol = .Machine$double.eps * 100,
  derivative_time = 0
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_check_steady_state_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_check_steady_state_+3A_parameters">parameters</code></td>
<td>
<p>optional set of parameters (<code>NULL</code>) to check at steady state (if set to <code>NULL</code> then the parameters for the currently selected parameter set will be used)</p>
</td></tr>
<tr><td><code id="system_check_steady_state_+3A_zero_rates">zero_rates</code></td>
<td>
<p>Boolean value to control removing all rate inputs (<code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="system_check_steady_state_+3A_zero_bolus">zero_bolus</code></td>
<td>
<p>Boolean value to control removing all bolus inputs (<code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="system_check_steady_state_+3A_output_times">output_times</code></td>
<td>
<p>sequence of output times to simulate for offset determination (<code>seq(0,100,1)</code>)</p>
</td></tr>
<tr><td><code id="system_check_steady_state_+3A_offset_tol">offset_tol</code></td>
<td>
<p>maximum percent offset to be considered zero (<code>.Machine$double.eps*100</code>)</p>
</td></tr>
<tr><td><code id="system_check_steady_state_+3A_derivative_tol">derivative_tol</code></td>
<td>
<p>maximum derivative value to be considered zero (<code>.Machine$double.eps*100</code>)</p>
</td></tr>
<tr><td><code id="system_check_steady_state_+3A_derivative_time">derivative_time</code></td>
<td>
<p>time to evaluate derivatives to identify deviations (<code>0</code>), set to <code>NULL</code> to skip derivative evaluation</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with the following names
</p>

<ul>
<li> <p><code>steady_state</code> Boolean indicating weather the system was at steady state
</p>
</li>
<li> <p><code>states_derivative</code> Derivatives that had values greater than the <code>derivative_tol</code>
</p>
</li>
<li> <p><code>states_simulation</code> States that had values greater than the <code>offset_tol</code>
</p>
</li>
<li> <p><code>som</code> Simulated output 
</p>
</li>
<li> <p><code>derivatives</code> Derivatives
</p>
</li>
<li> <p><code>states_derivative_NA_NaN</code> States that had derivatives that evaluated as either NA or NaN
</p>
</li>
<li> <p><code>states_simulation_NA_NaN</code> States with simulation values that had either NA or NaN
</p>
</li>
<li> <p><code>derivative_tc</code> Data frame with the timecourse of states where the derivative was found to be greater than tolerance (states_derivative)
</p>
</li></ul>


<hr>
<h2 id='system_clear_cohorts'>Clear all Cohorts</h2><span id='topic+system_clear_cohorts'></span>

<h3>Description</h3>

<p>Clear previously defined cohorts
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_clear_cohorts(cfg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_clear_cohorts_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ubiquity system object with no cohorts defined
</p>

<hr>
<h2 id='system_define_cohort'>Define Estimation Cohort</h2><span id='topic+system_define_cohort'></span>

<h3>Description</h3>

<p>Define a cohort to include in a parameter estimation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_define_cohort(cfg, cohort)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_define_cohort_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_define_cohort_+3A_cohort">cohort</code></td>
<td>
<p>list with cohort information</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Each cohort has a name (eg <code>d5mpk</code>), and the dataset containing the
information for this cohort is identified (the name defined in <code><a href="#topic+system_load_data">system_load_data</a></code>)
</p>
<pre>cohort = list(
  name         = "d5mpk",
  dataset      = "pm_data",
  inputs       = NULL,
  outputs      = NULL)</pre>
<p>Next if only a portion of the dataset applies to the current cohort, you
can define a filter (<code>cf</code> field). This will be 
applied to the dataset to only return values relevant to this cohort. For
example, if we only want records where the column <code>DOSE</code> is 5 (for the 5
mpk cohort). We can use the following: 
</p>
<pre>cohort[["cf"]]   = list(DOSE   = c(5))</pre>
<p>If the dataset has the headings <code>ID</code>, <code>DOSE</code> and <code>SEX</code>  and
cohort filter had the following format:
</p>
<pre>cohort[["cf"]]   = list(ID    = c(1:4),
                        DOSE  = c(5,10),
                        SEX   = c(1))</pre>
<p>It would be translated into the boolean filter:
</p>
<pre>(ID==1) | (ID==2) | (ID==3) | (ID==4)) &amp; ((DOSE == 5) | (DOSE==10)) &amp; (SEX == 1)</pre>
<p>Optionally you may want to fix a system parameter to a different value for a
given cohort. This can be done using the cohort parameter (<code>cp</code>) field.
For example if you had the body weight defined as a system parameter 
(<code>BW</code>), and you wanted to fix the body weight to 70 for the current
cohort you would do the following:
</p>
<pre>cohort[["cp"]]   = list(BW        = c(70))</pre>
<p>Note that you can only fix parameters that are not being estimated.
</p>
<p>By default the underlying simulation output times will be taken from the
general output_times option (see <code><a href="#topic+system_set_option">system_set_option</a></code>). However It may also be 
necessary to specify simulation output times for a specific cohort. The
<code>output_times</code> field can be used for this. Simply provide a vector of
output times:
</p>
<pre>cohort[["output_times"]]   = seq(0,100,2)</pre>
<p>Next we define the dosing for this cohort. It is only necessary to define
those inputs that are non-zero. So if the data here were generated from
animals given a single 5 mpk IV at time 0. Bolus dosing is defined 
using <code>&lt;B:times&gt;</code> and <code>&lt;B:events&gt;</code>. If <code>Cp</code> is the central
compartment, you would pass this information to the cohort in the
following manner:
</p>
<pre>cohort[["inputs"]][["bolus"]] = list()
cohort[["inputs"]][["bolus"]][["Cp"]] = list(TIME=NULL, AMT=NULL)
cohort[["inputs"]][["bolus"]][["Cp"]][["TIME"]] = c( 0) 
cohort[["inputs"]][["bolus"]][["Cp"]][["AMT"]]  = c( 5)</pre>
<p>Inputs can also include any infusion rates (<code>infusion_rates</code>) or
covariates (<code>covariates</code>). Covariates will have the default value
specified in the system file unless overwritten here. The units here are
the same as those in the system file
</p>
<p>Next we need to map the outputs in the model to the observation data in the
dataset. Under the <code>outputs</code> field there is a field for each output. Here 
the field <code>ONAME</code> can be replaced with something more useful (like 
<code>PK</code>). 
</p>
<pre>cohort[["outputs"]][["ONAME"]] = list()</pre>
<p>If you want to further filter the dataset. Say for example you
have two outputs and the <code>cf</code> applied above reduces your dataset
down to both outputs. Here you can use the  &quot;of&quot; field to apply an &quot;output filter&quot;
to further filter the records down to those that apply to the current output ONAME. 
</p>
<pre>cohort[["outputs"]][["ONAME"]][["of"]] = list(
       COLNAME          = c(),
       COLNAME          = c())</pre>
<p>If you do not need further filtering of data, you can you can just omit the field.
</p>
<p>Next you need to identify the columns in the dataset that contain your
times and observations. This is found in the <code>obs</code> field for the 
current observation:
</p>
<pre>cohort[["outputs"]][["ONAME"]][["obs"]] = list(
         time           = "TIMECOL",
         value          = "OBSCOL",
         missing        = -1)</pre>
<p>The times and observations in the dataset are found in the <code>TIMECOL</code> column 
and the <code>OBSCOL</code> column (optional missing data option specified by -1). 
</p>
<p>These observations in the dataset need to be mapped to the appropriate
elements of your model defined in the system file. This is done with the
<code>model</code> field:
</p>
<pre>cohort[["outputs"]][["ONAME"]][["model"]] = list(
         time           = "TS",       
         value          = "MODOUTPUT",
         variance       = "PRED^2")</pre>
<p>First the system time scale indicated by the <code>TS</code> placeholder above
must be specfied. The time scale must correspond to the data found in
<code>TIMECOL</code> above.  Next the model output indicated by the <code>MODOUTPUT</code>
placeholder needs to be specified. This is defined in the system file using
<code>&lt;O&gt;</code> and should correspond to <code>OBSCOL</code> from the dataset. Lastly the
<code>variance</code> field specifies the variance model. You can use the keyword
<code>PRED</code> (the model predicted output) and any variance parameters. Some
examples include:
</p>

<ul>
<li> <p><code>variance = "1"</code> - Least squares
</p>
</li>
<li> <p><code>variance = "PRED^2"</code> -  Weighted least squares proportional to the prediction squared
</p>
</li>
<li> <p><code>variance = "(SLOPE*PRED)^2"</code>  Maximum likelihood estimation where <code>SLOPE</code> is defined as a variance parameter (<code>&lt;VP&gt;</code>)
</p>
</li></ul>

<p>The following controls the plotting aspects associated with this output. The
color, shape and line values are the values used by ggplot functions. 
</p>
<pre>cohort[["outputs"]][["ONAME"]][["options"]] = list(
        marker_color   = "black",
        marker_shape   = 16,
        marker_line    = 1 )</pre>
<p>If the cohort has multiple outputs, simply repeat the process above for the. 
additional cohorts. The estimation vignettes contains examples of this. 
</p>
<p><b>Note: Output names should be consistent between cohorts so they will be grouped together when plotting results.</b>
</p>


<h3>Value</h3>

<p>ubiquity system object with cohort defined
</p>


<h3>See Also</h3>

<p>Estimation vignette (<code>vignette("Estimation", package = "ubiquity")</code>)
</p>

<hr>
<h2 id='system_define_cohorts_nm'>Define Cohorts from NONMEM Input File</h2><span id='topic+system_define_cohorts_nm'></span>

<h3>Description</h3>

<p>This function allows the user to define cohorts automatically
from a NONMEM dataset
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_define_cohorts_nm(
  cfg,
  DS = "DSNAME",
  col_ID = "ID",
  col_CMT = "CMT",
  col_DV = "DV",
  col_TIME = "TIME",
  col_AMT = "AMT",
  col_RATE = "RATE",
  col_EVID = "EVID",
  col_GROUP = NULL,
  filter = NULL,
  INPUTS = NULL,
  OBS = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_define_cohorts_nm_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_define_cohorts_nm_+3A_ds">DS</code></td>
<td>
<p>Name of the dataset loaded using <code>system_load_data</code></p>
</td></tr>
<tr><td><code id="system_define_cohorts_nm_+3A_col_id">col_ID</code></td>
<td>
<p>Column of unique subject identifier</p>
</td></tr>
<tr><td><code id="system_define_cohorts_nm_+3A_col_cmt">col_CMT</code></td>
<td>
<p>Compartment column</p>
</td></tr>
<tr><td><code id="system_define_cohorts_nm_+3A_col_dv">col_DV</code></td>
<td>
<p>Column with observations or <code>.</code> for input</p>
</td></tr>
<tr><td><code id="system_define_cohorts_nm_+3A_col_time">col_TIME</code></td>
<td>
<p>Column with system time of each record</p>
</td></tr>
<tr><td><code id="system_define_cohorts_nm_+3A_col_amt">col_AMT</code></td>
<td>
<p>Infusion/dose amounts (these need to be in the same units specified in the system.txt file)</p>
</td></tr>
<tr><td><code id="system_define_cohorts_nm_+3A_col_rate">col_RATE</code></td>
<td>
<p>Rate of infusion or <code>.</code> for bolus</p>
</td></tr>
<tr><td><code id="system_define_cohorts_nm_+3A_col_evid">col_EVID</code></td>
<td>
<p>EVID (0 - observation, 1 dose)</p>
</td></tr>
<tr><td><code id="system_define_cohorts_nm_+3A_col_group">col_GROUP</code></td>
<td>
<p>Column name to use for defining similar cohorts when generating figures.</p>
</td></tr>
<tr><td><code id="system_define_cohorts_nm_+3A_filter">filter</code></td>
<td>
<p>List used to filter the dataset or <code>NULL</code> if the whole dataset is to be used (see filter rules or  <code><a href="#topic+nm_select_records">nm_select_records</a></code> or a description of how to use this option)</p>
</td></tr>
<tr><td><code id="system_define_cohorts_nm_+3A_inputs">INPUTS</code></td>
<td>
<p>List mapping input information in the dataset to names used in the system.txt file</p>
</td></tr>
<tr><td><code id="system_define_cohorts_nm_+3A_obs">OBS</code></td>
<td>
<p>List mapping obseravation information in the dataset to nams used in the system.txt file</p>
</td></tr>
</table>


<h3>Details</h3>

<p><b>NOTE: to use this function it is necessary that a timescale be define for the system time scale. For example, if the system time scale was days, something like the following is needed:</b>
</p>
<pre>&lt;TS:days&gt; 1</pre>
<p>Include all records in the dataset
</p>
<pre>filter = NULL</pre>
<p>Include only records matching the following filter
</p>
<pre>filter = list()
filter$COLNAME = c()</pre>
<p>Mapping information: 
</p>
<p>The inputs mapping information (<code>INPUTMAP</code>) is alist with a field for each type of input:
input:
</p>

<ul>
<li> <p><code>bolus</code> List with a name for each bolus state in the dataset (<code>&lt;B:?&gt;</code>): each bolus name should have a <code>CMT_NUM</code> field indicating the compartment number for that state
</p>
</li>
<li> <p><code>infusion_rates</code> List with a name for each rate in the dataset (<code>&lt;R:?&gt;</code>): each rate name should have a <code>CMT_NUM</code> field indicating the compartment number for that state
</p>
</li>
<li> <p><code>covariates</code> List with for each covariate in the dataset (<code>&lt;CV:?&gt;</code>): each covariate name should have a <code>col_COV</code> indicating the column in the database that contains that covariate
</p>
</li></ul>

<p>From a coding perspective it looks like this:
</p>
<pre>INPUTMAP = list()
INPUTMAP$bolus$SPECIES$CMT_NUM            =  1
INPUTMAP$infusion_rates$RATE$CMT_NUM      =  1
INPUTMAP$covariates$CVNAME$col_COV        = 'CNAME'</pre>
<p>The observation mapping information (<code>OBSMAP</code>) is a list with elements for each output as
described in for system_define_cohort. Each output is a list with the following names:
</p>

<ul>
<li><p> variance Variance model for this output
</p>
</li>
<li><p> CMT Compartment number mapping observations for this output
</p>
</li>
<li><p> output Name of the output (<code>&lt;O&gt;</code>) corresponding with the observations
</p>
</li>
<li><p> missing Value indicating a missing observation or <code>NULL</code>
</p>
</li></ul>

<p>From a coding perspective it looks like this:
</p>
<pre>OBSMAP = list()
OBSMAP$ONAME=list(variance     = 'PRED^2',
                 CMT          =  1,
                 output       = '&lt;O&gt;',
                 missing      =  NULL )</pre>


<h3>Value</h3>

<p>ubiquity system object with cohorts defined.
</p>


<h3>See Also</h3>

<p>Estimation vignette (<code>vignette("Estimation", package = "ubiquity")</code>)
</p>

<hr>
<h2 id='system_estimate_parameters'>Control Estimation Process</h2><span id='topic+system_estimate_parameters'></span>

<h3>Description</h3>

<p>Manages the flow of parameter estimation using data specified with <code>system_define_cohort</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_estimate_parameters(
  cfg,
  flowctl = "plot guess",
  analysis_name = "my_analysis",
  archive_results = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_estimate_parameters_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_estimate_parameters_+3A_flowctl">flowctl</code></td>
<td>
<p>string to control what the flow of the function</p>
</td></tr>
<tr><td><code id="system_estimate_parameters_+3A_analysis_name">analysis_name</code></td>
<td>
<p>string containing the name of the analysis</p>
</td></tr>
<tr><td><code id="system_estimate_parameters_+3A_archive_results">archive_results</code></td>
<td>
<p>boolean variable to control whether results will be archived</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>flowctl</code> argument can have the following values
</p>

<ul>
<li> <p><code>"plot guess"</code> return the initial guess
</p>
</li>
<li> <p><code>"estimate"</code> perform estimation
</p>
</li>
<li> <p><code>"previous estimate as guess"</code> load previous estimate for <code>analysis_name</code> and use that as the initial guess
</p>
</li>
<li> <p><code>"plot previous estimate"</code> return the previous estimate for <code>analysis_name</code>
</p>
</li></ul>



<h3>Value</h3>

<p>parameter estimates
</p>

<hr>
<h2 id='system_fetch_guess'>Fetch Current Parameter Guesses</h2><span id='topic+system_fetch_guess'></span>

<h3>Description</h3>

<p>Fetch a list of the guesses for the current parameter set and
parameters selected for estimation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_fetch_guess(cfg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_fetch_guess_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list of current parameter gauesses
</p>

<hr>
<h2 id='system_fetch_iiv'>Fetch Variability Terms</h2><span id='topic+system_fetch_iiv'></span>

<h3>Description</h3>

<p>Extract elements of the current variance/covariance matrix
specified in the system file with <code>&lt;IIV:?:?&gt; ?</code>, <code>&lt;IIVCOR:?:?&gt;?</code>, <code>&lt;IIVSET:?:?&gt; ?</code>, <code>&lt;IIVCORSET:?:?&gt;?</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_fetch_iiv(cfg, IIV1, IIV2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_fetch_iiv_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_fetch_iiv_+3A_iiv1">IIV1</code></td>
<td>
<p>row name of the variance/covariance matrix</p>
</td></tr>
<tr><td><code id="system_fetch_iiv_+3A_iiv2">IIV2</code></td>
<td>
<p>column name of the variance/covariance matrix</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Value from the variance/covariance matrix
</p>


<h3>See Also</h3>

<p><code><a href="#topic+system_set_iiv">system_set_iiv</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Creating a system file from the mab_pk example
fr = system_new(file_name        = "system.txt", 
                system_file      = "mab_pk", 
                overwrite        = TRUE, 
                output_directory = tempdir())

# Building the system 
cfg = build_system(system_file  = file.path(tempdir(), "system.txt"),
      output_directory          = file.path(tempdir(), "output"),
      temporary_directory       = tempdir())

# Covariance term for ETACL and ETAVc
val = system_fetch_iiv(cfg, IIV1="ETACL", IIV2="ETAVc")

</code></pre>

<hr>
<h2 id='system_fetch_nca'>Fetch NCA Results</h2><span id='topic+system_fetch_nca'></span>

<h3>Description</h3>

<p>Fetches the NCA summary from the ubiquity system object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_fetch_nca(cfg, analysis_name = "analysis")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_fetch_nca_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_fetch_nca_+3A_analysis_name">analysis_name</code></td>
<td>
<p>string containing the name of the NCA analysis (default <code>'analysis'</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with a data frame of the NCA results (<code>NCA_summary</code>), the raw
output from PKNCA (<code>PKNCA_results</code>), and also a list element indicating the
overall success of the function call (<code>isgood</code>)
</p>


<h3>See Also</h3>

<p>Vignette on NCA (<code>vignette("NCA", package = "ubiquity")</code>)
</p>

<hr>
<h2 id='system_fetch_nca_columns'>Columns in NCA Analysis</h2><span id='topic+system_fetch_nca_columns'></span>

<h3>Description</h3>

<p>Show the columns available in a given NCA analysis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_fetch_nca_columns(cfg, analysis_name = "analysis")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_fetch_nca_columns_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_fetch_nca_columns_+3A_analysis_name">analysis_name</code></td>
<td>
<p>string containing the name of the NCA analysis (default <code>'analysis'</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with the following elements:
</p>

<ul>
<li> <p><code>isgood</code> Boolean variable to identify if the function
executed properly (<code>TRUE</code>) or if there were any errors
(<code>FALSE</code>)
</p>
</li>
<li> <p><code>NCA_col_summary</code> dataframe with the columns from the
analysis in <code>analysis_name</code> (<code>col_name</code> - NCA short name,
<code>from</code> - where the parameter was derived from, <code>label</code> - verbose
text label for the column, and <code>description</code>, verbose text description
of the parameter.
</p>
</li>
<li> <p><code>len_NCA_col</code>     maximum length of the <code>col_name</code> column
</p>
</li>
<li> <p><code>len_from</code>        maximum length of the <code>from</code> column
</p>
</li>
<li> <p><code>len_label</code>       maximum length of the <code>label</code> column
</p>
</li>
<li> <p><code>len_description</code> maximum length of the <code>description</code> column
</p>
</li></ul>



<h3>See Also</h3>

<p>Vignette on NCA (<code><a href="#topic+system_nca_parameters_meta">system_nca_parameters_meta</a></code>)
</p>

<hr>
<h2 id='system_fetch_parameters'>Fetch System Parameters</h2><span id='topic+system_fetch_parameters'></span>

<h3>Description</h3>

<p>Fetch the parameters of the currently selected parameter set. To switch
between parameter sets use <code><a href="#topic+system_select_set">system_select_set</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_fetch_parameters(cfg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_fetch_parameters_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of parameters for the selected parameter set
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Creating a system file from the mab_pk example
fr = system_new(file_name        = "system.txt", 
                system_file      = "mab_pk", 
                overwrite        = TRUE, 
                output_directory = tempdir())

# Building the system 
cfg = build_system(system_file  = file.path(tempdir(), "system.txt"),
      output_directory          = file.path(tempdir(), "output"),
      temporary_directory       = tempdir())

# Fetching the default parameter set
parameters = system_fetch_parameters(cfg)

</code></pre>

<hr>
<h2 id='system_fetch_rpt_officer_object'>Extracts the officer Object From the Specified ubiquity Report</h2><span id='topic+system_fetch_rpt_officer_object'></span>

<h3>Description</h3>

<p>This will extract an officer object from the ubiqiuty system
object for the specified report name.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_fetch_rpt_officer_object(cfg, rptname = "default")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_fetch_rpt_officer_object_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_fetch_rpt_officer_object_+3A_rptname">rptname</code></td>
<td>
<p>ubiquity report name</p>
</td></tr>
</table>


<h3>Value</h3>

<p>officer report object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+system_set_rpt_officer_object">system_set_rpt_officer_object</a></code>
</p>

<hr>
<h2 id='system_fetch_rpt_onbrand_object'>Extracts the onbrand Object From the Specified ubiquity Report</h2><span id='topic+system_fetch_rpt_onbrand_object'></span>

<h3>Description</h3>

<p>This will extract an onbrand object from the ubiqiuty system
object for the specified report name.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_fetch_rpt_onbrand_object(cfg, rptname = "default")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_fetch_rpt_onbrand_object_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_fetch_rpt_onbrand_object_+3A_rptname">rptname</code></td>
<td>
<p>ubiquity report name</p>
</td></tr>
</table>


<h3>Value</h3>

<p>onbrand report object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+system_set_rpt_onbrand_object">system_set_rpt_onbrand_object</a></code>
</p>

<hr>
<h2 id='system_fetch_set'>Fetch Mathematical Set</h2><span id='topic+system_fetch_set'></span>

<h3>Description</h3>

<p>Fetch the elements of the specified mathematical set that was defined in the system file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_fetch_set(cfg, set_name = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_fetch_set_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_fetch_set_+3A_set_name">set_name</code></td>
<td>
<p>name of mathematical set</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A sequence containing the elements of the parameter set or NULL if if there was a problem.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Creating a system file from the pbpk example
fr = system_new(file_name        = "system.txt", 
                system_file      = "pbpk", 
                overwrite        = TRUE, 
                output_directory = tempdir())

# Building the system 
cfg = build_system(system_file  = file.path(tempdir(), "system.txt"),
      output_directory          = file.path(tempdir(), "output"),
      temporary_directory       = tempdir())

# Fetching the contents of the ORG mathematical set
ORG_elements = system_fetch_set(cfg, "ORG")

</code></pre>

<hr>
<h2 id='system_fetch_template'>Create New Analysis Template</h2><span id='topic+system_fetch_template'></span>

<h3>Description</h3>

<p>Building a system file will produce templates for R and other languages.
This function provides a method to make local copies of these templates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_fetch_template(
  cfg,
  template = "Simulation",
  overwrite = FALSE,
  output_directory = getwd()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_fetch_template_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_fetch_template_+3A_template">template</code></td>
<td>
<p>template type</p>
</td></tr>
<tr><td><code id="system_fetch_template_+3A_overwrite">overwrite</code></td>
<td>
<p>if <code>TRUE</code> the new system file will overwrite any existing files present</p>
</td></tr>
<tr><td><code id="system_fetch_template_+3A_output_directory">output_directory</code></td>
<td>
<p>directory where workshop files will be placed (getwd())</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The template argument can have the following values for the R
workflow:
</p>

<ul>
<li><p>&quot;Simulation&quot;       produces <code>analysis_simulate.R</code>: R-Script named with placeholders used to run simulations
</p>
</li>
<li><p>&quot;Estimation&quot;       produces <code>analysis_estimate.R</code>: R-Script named with placeholders used to perform naive-pooled parameter estimation
</p>
</li>
<li><p>&quot;NCA&quot;              produces <code>analysis_nca.R</code>: R-Script to perform non-compartmental analysis (NCA) and report out the results
</p>
</li>
<li><p>&quot;ShinyApp&quot;         produces <code>ubiquity_app.R</code>, <code>server.R</code> and <code>ui.R</code>: files needed to run the model through a Shiny App either locally or on a Shiny Server
</p>
</li>
<li><p>&quot;Model Diagram&quot;    produces <code>system.svg</code>: SVG template for producing a model diagram (Goto <a href="https://inkscape.org">https://inkscape.org</a> for a free SVG editor)
</p>
</li>
<li><p>&quot;Shiny Rmd Report&quot; produces <code>system_report.Rmd</code> and <code>test_system_report.R</code>: R-Markdown file used to generate report tabs for the Shiny App and a script to test it
</p>
</li>
<li><p>&quot;myOrg&quot;            produces <code>myOrg.R</code>: R-Script for defining functions used within your organization
</p>
</li></ul>

<p>And this will create files to use in other software:
</p>

<ul>
<li><p>&quot;Adapt&quot;            produces <code>system_adapt.for</code> and <code>system_adapt.prm</code>: Fortran and parameter files for the currently selected parameter set in Adapt format.
</p>
</li>
<li><p>&quot;Berkeley Madonna&quot; produces <code>system_berkeley_madonna.txt</code>: text file with the model and the currently selected parameter set in Berkeley Madonna format
</p>
</li>
<li><p>&quot;nlmixr&quot;           produces <code>system_nlmixr.R</code> For the currently selected parameter set to define the system in the 'nlmixr' format.
</p>
</li>
<li><p>&quot;NONMEM&quot;           produces <code>system_nonmem.R</code> For the currently selected parameter set as a NONMEM conntrol stream.
</p>
</li>
<li><p>&quot;Monolix&quot;          produces <code>system_monolix.txt</code> For the currently selected parameter set as a NONMEM conntrol stream.
</p>
</li>
<li><p>&quot;mrgsolve&quot;         produces <code>system_mrgsolve.cpp</code>: text file with the model and the currently selected parameter set in mrgsolve format  
</p>
</li></ul>



<h3>Value</h3>

<p>List with vectors of template <code>sources</code>, <code>destinations</code>
and corresponding write success (<code>write_file</code>), also a list element
indicating the overall success of the function call (<code>isgood</code>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Creating a system file from the mab_pk example
fr = system_new(file_name        = "system.txt", 
                system_file      = "mab_pk", 
                overwrite        = TRUE, 
                output_directory = tempdir())

# Building the system 
cfg = build_system(system_file  = file.path(tempdir(), "system.txt"),
      output_directory          = file.path(tempdir(), "output"),
      temporary_directory       = tempdir())

# Creating a simulation template
fr =  system_fetch_template(cfg, 
      template         = "Simulation", 
      output_directory = tempdir())

</code></pre>

<hr>
<h2 id='system_fetch_TSsys'>Fetch System Timescale</h2><span id='topic+system_fetch_TSsys'></span>

<h3>Description</h3>

<p>Reads through the system information and tries to determine the
system time scale (the timescale that has a value of 1)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_fetch_TSsys(cfg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_fetch_TSsys_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Name of the system timescale or <code>NULL</code> if it was not found
</p>

<hr>
<h2 id='system_glp_init'>Initialize GLP study design</h2><span id='topic+system_glp_init'></span>

<h3>Description</h3>

<p>Creates a new GLP study design
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_glp_init(cfg, study_title = "Study Title", study_name = "default")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_glp_init_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_glp_init_+3A_study_title">study_title</code></td>
<td>
<p>String containing descriptive information about the study</p>
</td></tr>
<tr><td><code id="system_glp_init_+3A_study_name">study_name</code></td>
<td>
<p>short name used to identify the study in other functions  (<code>"default"</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>cfg ubiquity system object with the study initialized
</p>

<hr>
<h2 id='system_glp_scenario'>Design GLP Study For a Scenario</h2><span id='topic+system_glp_scenario'></span>

<h3>Description</h3>

<p>Identifies the top dose required in a GLP tox study in order to match human metrics (Cmax and AUCs) within a specified multiplier.
</p>
<p>For a given set of human parameters the human doses required to hit the target Cmin and AUC (both or one) will be identified. The Cmax and AUC associated with the largest of those doses will be determined and the corresponding doses for a tox species (and provided parameters) will be determined for specific tox multipliers. 
</p>
<p>Optionally, simulations can be be run by specifying doses for either/or the human or tox species. Sample times can also be specified to generate annotated figures and tables to be given to analysts to facilitate assay design. 
</p>
<p>The system file requires the following components:
</p>
<p>- Output for the drug concentration
- Output for the cumulative AUC
- Bolus dosing defined in a specific compartment
- Timescale specified for the system timescale  (e.g. if the timescale is hours then you need <code>&lt;TS&gt; hours = 1.0</code>)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_glp_scenario(
  cfg,
  output_Conc = NULL,
  output_AUC = NULL,
  timescale = NULL,
  units_Conc = "",
  units_AUC = "",
  study_scenario = "Tox Study",
  human_sim_times = NULL,
  study_name = "default",
  human_parameters = NULL,
  human_bolus = NULL,
  human_ndose = 1,
  human_dose_interval = 1,
  human_Cmin = NULL,
  human_AUC = NULL,
  human_sample_interval = NULL,
  human_sim_doses = NULL,
  human_sim_samples = NULL,
  tox_species = "Tox",
  tox_sim_times = NULL,
  tox_parameters = NULL,
  tox_bolus = NULL,
  tox_ndose = 1,
  tox_dose_interval = 1,
  tox_Cmax_multiple = 10,
  tox_AUC_multiple = 10,
  tox_sample_interval = NULL,
  tox_sim_doses = NULL,
  tox_sim_samples = NULL,
  annotate_plots = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_glp_scenario_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_output_conc">output_Conc</code></td>
<td>
<p>model output specified with <code>&lt;O&gt;</code> containing the concentration associated with drug exposure.</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_output_auc">output_AUC</code></td>
<td>
<p>model output specified with <code>&lt;O&gt;</code> containing the cumulative exposure</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_timescale">timescale</code></td>
<td>
<p>system timescale specified with <code>&lt;TS&gt;</code> used for AUC comparisons and plotting</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_units_conc">units_Conc</code></td>
<td>
<p>units of concentration (<code>''</code>)</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_units_auc">units_AUC</code></td>
<td>
<p>units of AUC (<code>''</code>)</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_study_scenario">study_scenario</code></td>
<td>
<p>string containing a descriptive name for the tox study</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_human_sim_times">human_sim_times</code></td>
<td>
<p>user-specified simulation output times for humans (same timescale as the system)</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_study_name">study_name</code></td>
<td>
<p>name of the study to append the scenario to set with <code>'system_glp_init()'</code> (<code>'default'</code>):
When a report is initialized using <code><a href="#topic+system_rpt_read_template">system_rpt_read_template</a></code> the report name is 'default' unless otherwise specified. To disable reporting set this to  <code>NULL</code>, and to use a different report specify the name here.</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_human_parameters">human_parameters</code></td>
<td>
<p>list containing the human parameters</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_human_bolus">human_bolus</code></td>
<td>
<p>string containing the dosing state for human doses (specified with <code>&lt;B:?&gt;</code>)</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_human_ndose">human_ndose</code></td>
<td>
<p>number of human doses to simulate</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_human_dose_interval">human_dose_interval</code></td>
<td>
<p>dosing interval in humans (time units specified with <code>&lt;B:?&gt;</code>)</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_human_cmin">human_Cmin</code></td>
<td>
<p>target Cmin in humans (corresponding to output_Conc above)</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_human_auc">human_AUC</code></td>
<td>
<p>target AUC  in humans (corresponding to output_AUC  above)</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_human_sample_interval">human_sample_interval</code></td>
<td>
<p>time interval in units specified by timescale above to evaluate the trough concentration and AUC (e.g c(1.99, 4.001) would consider the interval between 2 and 4)</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_human_sim_doses">human_sim_doses</code></td>
<td>
<p>optional list of doses into <code>human_bolus</code> to simulate (see Details below)</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_human_sim_samples">human_sim_samples</code></td>
<td>
<p>optional list of sample times in units specified by timescale above to label on plots of simulated doses (the default <code>NULL</code> will disable labels)</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_tox_species">tox_species</code></td>
<td>
<p>optional name of the tox species (<code>"Tox"</code>)</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_tox_sim_times">tox_sim_times</code></td>
<td>
<p>user-specified simulation output times for the tox species (same timescale as the system)</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_tox_parameters">tox_parameters</code></td>
<td>
<p>list containing the parameters for the tox species</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_tox_bolus">tox_bolus</code></td>
<td>
<p>string containing the dosing state for tox species doses (specified with <code>&lt;B:?&gt;</code>)</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_tox_ndose">tox_ndose</code></td>
<td>
<p>number of tox doses to simulate</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_tox_dose_interval">tox_dose_interval</code></td>
<td>
<p>dosing interval in the tox species (time units specified with <code>&lt;B:?&gt;</code>)</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_tox_cmax_multiple">tox_Cmax_multiple</code></td>
<td>
<p>for each target (Cmin and AUC) the dose in the tox species will be found to cover this multiple over the projected Cmax in humans (10)</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_tox_auc_multiple">tox_AUC_multiple</code></td>
<td>
<p>for each target (Cmin and AUC) the dose in the tox species will be found to cover this multiple over the projected AUC in humans (10)</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_tox_sample_interval">tox_sample_interval</code></td>
<td>
<p>interval to consider the AUC and Cmax for comparing the human prediction to the tox multiple</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_tox_sim_doses">tox_sim_doses</code></td>
<td>
<p>optional list of doses into <code>tox_bolus</code> to simulate (see Details below)</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_tox_sim_samples">tox_sim_samples</code></td>
<td>
<p>optional list of sample times in units specified by timescale above to label on plots of simulated doses (the default <code>NULL</code> will disable labels)</p>
</td></tr>
<tr><td><code id="system_glp_scenario_+3A_annotate_plots">annotate_plots</code></td>
<td>
<p>Boolean switch to indicate if <code>human_sim_samples</code> and <code>tox_sim_samples</code> should be labeled on  their respective plots (<code>TRUE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Both <code>human_sim_doses</code> and <code>tox_sim_doses</code> are lists with names
corresponding to the label of the dose. Each element has an AMT and TIME
element which corresponds to the dosing times and amounts in the units 
specified with <code>&lt;B:?&gt;</code> in the system file.
</p>
<p>For example if you wanted to simulate four weekly doses of 20 mg to a 70 kg 
person and the units of bolus doses were days and mg/kg for the times and 
amounts you would do the following:
</p>
<pre>
 human_sim_doses = list()
 human_sim_doses[["20 mg QW"]]$TIME = c(     0,      7,     14,     21)
 human_sim_doses[["20 mg QW"]]$AMT  = c(0.2857, 0.2857, 0.2857, 0.2857)
</pre>


<h3>Value</h3>

<p>cfg ubiquity system object with the scenario added if successful
</p>

<hr>
<h2 id='system_load_data'>Loading Datasets</h2><span id='topic+system_load_data'></span>

<h3>Description</h3>

<p>Loads datasets at the scripting level from  a variable if
<code>data_file</code> is a data.frame or from the following
formats (based on the file extension)
</p>

<ul>
<li><p> csv - comma delimited 
</p>
</li>
<li><p> tab - tab delimited
</p>
</li>
<li><p> xls or xlsx - excel spread sheet
</p>
</li></ul>

<p>Multiple datasets can be loaded as long as they are given different
names. Datasets should be in a NONMEM-ish format with the
first row containing the column header names.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_load_data(cfg, dsname, data_file, data_sheet)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_load_data_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_load_data_+3A_dsname">dsname</code></td>
<td>
<p>short name of the dataset to be used to link this dataset to different operations</p>
</td></tr>
<tr><td><code id="system_load_data_+3A_data_file">data_file</code></td>
<td>
<p>the file name of the dataset or a data frame containing the data</p>
</td></tr>
<tr><td><code id="system_load_data_+3A_data_sheet">data_sheet</code></td>
<td>
<p>argument identifying the name of the sheet in an excel file</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Ubiquity system object with the dataset loaded
</p>

<hr>
<h2 id='system_log_debug_save'>Save variables to files</h2><span id='topic+system_log_debug_save'></span>

<h3>Description</h3>

<p>Triggered when debugging is enabled, this function will save
the contents of values to the specified file name in the ubiquity temporary
directory.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_log_debug_save(cfg, file_name = "my_file", values = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_log_debug_save_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_log_debug_save_+3A_file_name">file_name</code></td>
<td>
<p>name of the save file without the &quot;.RData&quot; extension</p>
</td></tr>
<tr><td><code id="system_log_debug_save_+3A_values">values</code></td>
<td>
<p>named list of variables to save</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Boolean variable indicating success
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Creating a system file from the mab_pk example
fr = system_new(file_name        = "system.txt", 
                system_file      = "mab_pk", 
                overwrite        = TRUE, 
                output_directory = tempdir())

# Building the system 
cfg = build_system(system_file  = file.path(tempdir(), "system.txt"),
      output_directory          = file.path(tempdir(), "output"),
      temporary_directory       = tempdir())

# enable debugging:
cfg=system_set_option(cfg,group = "logging", 
                         option = "debug", 
                         value  = TRUE)

# Saving the cfg variable 
system_log_debug_save(cfg, 
   file_name = 'my_file',
   values = list(cfg=cfg))


</code></pre>

<hr>
<h2 id='system_log_entry'>Add Log Entry</h2><span id='topic+system_log_entry'></span>

<h3>Description</h3>

<p>Appends a specified line to the analysis log
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_log_entry(cfg, entry)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_log_entry_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_log_entry_+3A_entry">entry</code></td>
<td>
<p>string containing the log entry</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Boolean variable indicating success (<code>TRUE</code>) or failure (<code>FALSE</code>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Creating a system file from the mab_pk example
fr = system_new(file_name        = "system.txt", 
                system_file      = "mab_pk", 
                overwrite        = TRUE, 
                output_directory = tempdir())

# Building the system 
cfg = build_system(system_file  = file.path(tempdir(), "system.txt"),
      output_directory          = file.path(tempdir(), "output"),
      temporary_directory       = tempdir())

# Initialzing the log file
system_log_entry(cfg, "Text of log entry")

</code></pre>

<hr>
<h2 id='system_log_init'>Initialize System Log File</h2><span id='topic+system_log_init'></span>

<h3>Description</h3>

<p>Initializes the currently specified system log file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_log_init(cfg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_log_init_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ubiquity system object with logging enabled
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Creating a system file from the mab_pk example
fr = system_new(file_name        = "system.txt", 
                system_file      = "mab_pk", 
                overwrite        = TRUE, 
                output_directory = tempdir())

# Building the system 
cfg = build_system(system_file  = file.path(tempdir(), "system.txt"),
      output_directory          = file.path(tempdir(), "output"),
      temporary_directory       = tempdir())

# Initialzing the log file
cfg = system_log_init(cfg)

</code></pre>

<hr>
<h2 id='system_nca_parameters_meta'>List NCA parameters, text names and descriptions</h2><span id='topic+system_nca_parameters_meta'></span>

<h3>Description</h3>

<p>Provides a verbose information about NCA parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_nca_parameters_meta(cfg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_nca_parameters_meta_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with the following elements:
</p>

<ul>
<li> <p><code>isgood</code> Boolean value indicating the success of the function call.
</p>
</li>
<li> <p><code>parameters</code> List with element names for each standard column header for NCA output. Each element name is a list with the following elements:
</p>

<ul>
<li> <p><code>label</code> Textual descriptor of the parameter.
</p>
</li>
<li> <p><code>description</code> Verbose description of the parameter.
</p>
</li>
<li> <p><code>from</code> Text indicating the source of the parameter (either PKNCA or ubiquity).
</p>
</li></ul>

</li></ul>



<h3>See Also</h3>

<p>Vignette on NCA (<code>vignette("NCA", package = "ubiquity")</code>)
</p>

<hr>
<h2 id='system_nca_run'>Automatic NCA</h2><span id='topic+system_nca_run'></span>

<h3>Description</h3>

<p>Performs NCA in an automated fashion
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_nca_run(
  cfg,
  dsname = "PKDS",
  dscale = 1,
  NCA_options = NULL,
  NCA_min = 4,
  analysis_name = "analysis",
  dsfilter = NULL,
  extrap_C0 = TRUE,
  extrap_N = 2,
  sparse = FALSE,
  dsmap = list(TIME = "TIME", NTIME = "NTIME", CONC = "CONC", DOSE = "DOSE", ID = "ID",
    ROUTE = "ROUTE", DOSENUM = NULL, BACKEXTRAP = NULL, SPARSEGROUP = NULL),
  dsinc = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_nca_run_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_nca_run_+3A_dsname">dsname</code></td>
<td>
<p>name of dataset loaded with (<code><a href="#topic+system_load_data">system_load_data</a></code>)</p>
</td></tr>
<tr><td><code id="system_nca_run_+3A_dscale">dscale</code></td>
<td>
<p>factor to multiply the dose to get it into the same units as concentration (default <code>1</code>):
if you are dosing in mg/kg and your concentrations is in ng/ml, then <code>dscale = 1e6</code></p>
</td></tr>
<tr><td><code id="system_nca_run_+3A_nca_options">NCA_options</code></td>
<td>
<p>specify a list of options for PKNCA to overwrite the
defaults (default <code>NULL</code> will use defaults). For example if you want to
set the maximum extrapolation of AUCinf to 10
half-life half-life of 0.8 you would use: <code>list(max.aucinf.pext=10, min.hl.r.squared=.9)</code></p>
</td></tr>
<tr><td><code id="system_nca_run_+3A_nca_min">NCA_min</code></td>
<td>
<p>minimum number of points required to perform NCA for a given subset (default <code>4</code>)</p>
</td></tr>
<tr><td><code id="system_nca_run_+3A_analysis_name">analysis_name</code></td>
<td>
<p>string containing the name of the analysis (default 'analysis') to archive to files and reference results later</p>
</td></tr>
<tr><td><code id="system_nca_run_+3A_dsfilter">dsfilter</code></td>
<td>
<p>list of names corresponding to the column names in the dataset and values are a sequence indicating values to keep (default <code>NULL</code>. Multiple names are and-ed together. For example the following would keep all of the records where dose is 1, 2, or 5 and the dose_number is 1
</p>
<pre>
 dsfilter = list(dose=c(1,2,5), dose_number = c(1))
</pre></td></tr>
<tr><td><code id="system_nca_run_+3A_extrap_c0">extrap_C0</code></td>
<td>
<p>Boolean variable to enable automatic determination of initial drug concentration if no value is specified; the rules used by WinNonlin will be used: 
</p>

<ul>
<li><p> If the route is <code>"iv infusion"</code> or <code>"extra-vascular"</code> and the data is single dose data, then a concentration of zero will be used. If repeat dosing is used, the minimum value from the previous dosing interval will be used.
</p>
</li>
<li><p> If the route is <code>"iv bolus"</code> then log-linear regression of the number of observations specified by <code>extrap_N</code> will be used. If the slope of these points is positive the first positive observation will be used as an estimate of C0
</p>
</li></ul>
</td></tr>
<tr><td><code id="system_nca_run_+3A_extrap_n">extrap_N</code></td>
<td>
<p>number of points to use for back extrapolation (default <code>2</code>); this number can be overwritten for each subject using the <code>BACKEXTRAP</code> column in the dataset</p>
</td></tr>
<tr><td><code id="system_nca_run_+3A_sparse">sparse</code></td>
<td>
<p>Boolean variable used to indicate data used sparse sampling and the analysis should use the average at each time point (the <code>SPARSEGROUP</code> column must be specified in the <code>dsmap</code> below)</p>
</td></tr>
<tr><td><code id="system_nca_run_+3A_dsmap">dsmap</code></td>
<td>
<p>list with names specifying the columns in the dataset (* required): 
</p>

<ul>
<li> <p><code>TIME</code>*       Time since the first dose; <code>"TIME"</code> (default)
</p>
</li>
<li> <p><code>NTIME</code>*      Nominal time since last dose;  <code>"NTIME"</code> (default)
</p>
</li>
<li> <p><code>CONC</code>*       Concentration data;  <code>"CONC"</code> (default)
</p>
</li>
<li> <p><code>DOSE</code>*       Dose given;  (<code>"DOSE"</code> (default)
</p>
</li>
<li> <p><code>ID</code>*         Subject ID;  (<code>"ID"</code> (default)
</p>
</li>
<li> <p><code>ROUTE</code>*      Route of administration;  <code>"ROUTE"</code> (default), can be either <code>"iv bolus"</code>, <code>"iv infusion"</code> or <code>"extra-vascular"</code>. Variants such as <code>"IV_bolus"</code> and <code>"extravascular"</code> should work as well.
</p>
</li>
<li> <p><code>DOSENUM</code>     Numeric dose (starting at 1) used for grouping multiple dose data; optional, <code>NULL</code> (default) for single dose data)
</p>
</li>
<li> <p><code>BACKEXTRAP</code>  Specifying the number of points to use to extrapolate the initial concentration for &quot;iv bolus&quot; dosing; optoinal f <code>NULL</code> (default) will use the value defined in <code>extrap_N</code> (note this value must be &lt;= NCA_min)
</p>
</li>
<li> <p><code>SPARSEGROUP</code> Column containing a unique value grouping cohorts for pooling data. Needed when <code>sparse</code> is set to <code>TRUE</code>; optional, <code>NULL</code> (default)
</p>
</li></ul>
</td></tr>
<tr><td><code id="system_nca_run_+3A_dsinc">dsinc</code></td>
<td>
<p>(NOT CURRENTLY IMPLEMENTED) optional character vector of columns from the dataset to include in the output summary (default <code>NULL</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>cfg ubiquity system object with the NCA results and if the analysis name is specified:
</p>

<ul>
<li><p>output/analysis_name-nca_summary-pknca.csv NCA summary 
</p>
</li>
<li><p>output/analysis_name-pknca_summary.csv Raw output from PKNCA with subject and dose number columns appended 
</p>
</li>
<li><p>output/analysis_name-nca_data.RData objects containing the NCA summary and a list with the ggplot grobs
</p>
</li></ul>



<h3>See Also</h3>

<p>Vignette on NCA (<code>vignette("NCA", package = "ubiquity")</code>)
</p>

<hr>
<h2 id='system_nca_summary'>Summarize NCA Results in Tabular Format</h2><span id='topic+system_nca_summary'></span>

<h3>Description</h3>

<p>Creates tabular summaries of NCA results
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_nca_summary(
  cfg,
  analysis_name = "analysis",
  treat_as_factor = c("ID", "Dose_Number", "Dose"),
  params_include = c("ID", "cmax", "tmax", "auclast"),
  params_header = NULL,
  rptname = "default",
  label_format = NULL,
  summary_stats = NULL,
  summary_labels = list(MEAN = "Mean", STD = "Std Dev", MEDIAN = "Median", N = "N obs",
    SE = "Std Err."),
  summary_location = NULL,
  ds_wrangle = NULL,
  digits = 3,
  table_theme = "theme_zebra"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_nca_summary_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_nca_summary_+3A_analysis_name">analysis_name</code></td>
<td>
<p>string containing the name of the analysis (default <code>'analysis'</code>) that was previously run</p>
</td></tr>
<tr><td><code id="system_nca_summary_+3A_treat_as_factor">treat_as_factor</code></td>
<td>
<p>sequence of column names to be treated as factors (default <code>c("ID", "Dose_Number", "Dose")</code>). Use this to report values without added decimals.</p>
</td></tr>
<tr><td><code id="system_nca_summary_+3A_params_include">params_include</code></td>
<td>
<p>vector with names of parameters to include (default c(&quot;ID&quot;, &quot;cmax&quot;, &quot;tmax&quot;, &quot;auclast&quot;))</p>
</td></tr>
<tr><td><code id="system_nca_summary_+3A_params_header">params_header</code></td>
<td>
<p>list with names of parameters followed by a vector of headers. You can use the placeholder &quot;&lt;label&gt;&quot; to include the standard label (e.g. list(cmax=c(&quot;&lt;label&gt;&quot;, &quot;(ng/ml)&quot;))), with a default of <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="system_nca_summary_+3A_rptname">rptname</code></td>
<td>
<p>report name (either PowerPoint or Word) that this table will be used in (<code>"default"</code>)</p>
</td></tr>
<tr><td><code id="system_nca_summary_+3A_label_format">label_format</code></td>
<td>
<p>string containing the format in which headers and labels are being specified, either <code>"text"</code>, or <code>"md"</code> (default <code>NULL</code> assumes <code>"text"</code> format)</p>
</td></tr>
<tr><td><code id="system_nca_summary_+3A_summary_stats">summary_stats</code></td>
<td>
<p>list with strings as names containing placeholders for
summary statistics and the values indicate the parameters to apply those
statistics to. for example, if you want to calculate mean and standard deviation of
AUClast you could use <code>list("&lt;MEAN&gt; (&lt;STD&gt;)"=c("auclast")</code>. This would create
a row at the bottom of the table with this information for just the listed
parameters. To split this up across two rows just do the following:
<code>list("&lt;MEAN&gt;"=c("auclast"), "&lt;STD&gt;"=c("auclast"))</code>. Any NA values
will be ignored when calculating statistics.  The allowed
summary statistics are the mean (&lt;MEAN&gt;), median (&lt;MEDIAN&gt;), standard
deviation (&lt;STD&gt;), standard error (&lt;SE&gt;), and the number of observations
used to calculate statistics. (&lt;N&gt;). The default value of <code>NULL</code>
prevents any summary statistics from being included.</p>
</td></tr>
<tr><td><code id="system_nca_summary_+3A_summary_labels">summary_labels</code></td>
<td>
<p>list containing the mapping of summary statistics
defined by <code>summary_stats</code> with their text labels in the output tables: 
</p>
<pre>
list(MEAN   = "Mean", 
     STD    = "Std Dev", 
     MEDIAN = "Median", 
     N      = "N obs", 
     SE     = "Std Err.")</pre></td></tr>
<tr><td><code id="system_nca_summary_+3A_summary_location">summary_location</code></td>
<td>
<p>column where to put the labels (e.g. Mean (Std)) for
summary statistic. The default (<code>NULL</code>) will leave these labels off.
If you set this to the &quot;ID&quot; column it will put them under the subject IDs.</p>
</td></tr>
<tr><td><code id="system_nca_summary_+3A_ds_wrangle">ds_wrangle</code></td>
<td>
<pre>
 ds_wrangle = list(Dose=c(30), Dose_Number = c(1))
</pre></td></tr>
<tr><td><code id="system_nca_summary_+3A_digits">digits</code></td>
<td>
<p>number of significant digits to report (3) or <code>NULL</code> to prevent rounding</p>
</td></tr>
<tr><td><code id="system_nca_summary_+3A_table_theme">table_theme</code></td>
<td>
<p>flextable theme see the flextable package for available themes, and set to <code>NULL</code> to prevent themes from being applied. (default=<code>"theme_zebra"</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with the following elements
</p>

<ul>
<li><p>isgood Boolean variable indicating success (<code>TRUE</code>) or failure (<code>FALSE</code>) if the call is successful the following will be defined (<code>NULL</code> 
</p>
</li>
<li><p>nca_summary dataframe containing the summary table with headers and any summary statistics appended to the bottom
</p>
</li>
<li><p>nca_summary_ft same information in the <code>nca_summary</code> ouput as a flextable object
</p>
</li>
<li><p>components  list with the elements of the summary table each as dataframes (header, data, and summary)
</p>
</li></ul>



<h3>See Also</h3>

<p>Vignette on NCA (<code>vignette("NCA", package = "ubiquity")</code>)
</p>

<hr>
<h2 id='system_new'>Create New <code>system.txt</code> File</h2><span id='topic+system_new'></span>

<h3>Description</h3>

<p>Copy a blank template (<code>system_file="template"</code>) file to the working directory or an example by specifying the following:
</p>

<ul>
<li> <p><code>"template"</code> - Empty system file template
</p>
</li>
<li> <p><code>"adapt"</code> - Parent/metabolite model taken from the adapt manual used in estimation examples [ADAPT]
</p>
</li>
<li> <p><code>"two_cmt_cl"</code> - Two compartment model parameterized in terms of clearances 
</p>
</li>
<li> <p><code>"one_cmt_cl"</code> - One compartment model parameterized in terms of clearances 
</p>
</li>
<li> <p><code>"two_cmt_micro"</code> - Two compartment model parameterized in terms of rates (micro constants)
</p>
</li>
<li> <p><code>"one_cmt_micro"</code> - One compartment model parameterized in terms of rates (micro constants)
</p>
</li>
<li> <p><code>"mab_pk"</code> - General compartmental model of mAb PK from Davda 2014 [DG]
</p>
</li>
<li> <p><code>"pbpk"</code> - PBPK model of mAb disposition in mice from Shah 2012 [SB]
</p>
</li>
<li> <p><code>"pbpk_template"</code> - System parameters from Shah 2012 [SB] have been defined for all species along with the set notation to be used as a template for developing models with physiological parameters
</p>
</li>
<li> <p><code>"pwc"</code> - Example showing how to make if/then or piece-wise continuous variables  
</p>
</li>
<li> <p><code>"tmdd"</code> - Model of antibody with target-mediated drug disposition
</p>
</li>
<li> <p><code>"tumor"</code> - Transit tumor growth model taken from Lobo 2002 [LB] 
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>system_new(
  file_name = "system.txt",
  system_file = "template",
  overwrite = FALSE,
  output_directory = getwd()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_new_+3A_file_name">file_name</code></td>
<td>
<p>name of the new file to create</p>
</td></tr>
<tr><td><code id="system_new_+3A_system_file">system_file</code></td>
<td>
<p>name of the system file to copy</p>
</td></tr>
<tr><td><code id="system_new_+3A_overwrite">overwrite</code></td>
<td>
<p>if <code>TRUE</code> the new system file will overwrite any existing files present</p>
</td></tr>
<tr><td><code id="system_new_+3A_output_directory">output_directory</code></td>
<td>
<p><code>getwd()</code> directory where system file will be placed</p>
</td></tr>
</table>


<h3>Details</h3>

<p>References
</p>

<ul>
<li><p>[ADAPT] Adapt 5 Users Guide <a href="https://bmsr.usc.edu/files/2013/02/ADAPT5-User-Guide.pdf">https://bmsr.usc.edu/files/2013/02/ADAPT5-User-Guide.pdf</a>
</p>
</li>
<li><p>[DG] Davda et. al. mAbs (2014) 6(4):1094-1102  <a href="https://doi.org/10.4161/mabs.29095">doi:10.4161/mabs.29095</a>
</p>
</li>
<li><p>[LB] Lobo, E.D. &amp; Balthasar, J.P. AAPS J (2002) 4, 212-222  <a href="https://doi.org/10.1208/ps040442">doi:10.1208/ps040442</a>
</p>
</li>
<li><p>[SB] Shah, D.K. &amp; Betts, A.M. JPKPD (2012) 39 (1), 67-86 <a href="https://doi.org/10.1007/s10928-011-9232-2">doi:10.1007/s10928-011-9232-2</a>
</p>
</li></ul>



<h3>Value</h3>

<p><code>TRUE</code> if the new file was created and <code>FALSE</code> otherwise
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# To create an example system file named example_system.txt:
system_new(system_file      = "mab_pk", 
           file_name        = "system_example.txt", 
           overwrite        = TRUE,  
           output_directory = tempdir())

</code></pre>

<hr>
<h2 id='system_new_list'>Fetch List of Available System Templates</h2><span id='topic+system_new_list'></span>

<h3>Description</h3>

<p>Returns a list of internal templates with descriptions of their contents and file locations
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_new_list()
</code></pre>


<h3>Value</h3>

<p>list with the template names as the keys
</p>

<ul>
<li><p>file_path Full path to the system file
</p>
</li>
<li><p>description Description of what this system file provides
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># To get a list of systems
systems = system_new_list()
</code></pre>

<hr>
<h2 id='system_new_tt_rule'>Titration Rules</h2><span id='topic+system_new_tt_rule'></span>

<h3>Description</h3>

<p>Defines a new titration rule and the times when that rule is evaluated
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_new_tt_rule(cfg, name, times, timescale)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_new_tt_rule_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_new_tt_rule_+3A_name">name</code></td>
<td>
<p>name for the titration rule</p>
</td></tr>
<tr><td><code id="system_new_tt_rule_+3A_times">times</code></td>
<td>
<p>list of times when the rule will be evaluated</p>
</td></tr>
<tr><td><code id="system_new_tt_rule_+3A_timescale">timescale</code></td>
<td>
<p>time scale associated with the titration times (as defined by <code>&lt;TS:?&gt;</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<pre>
cfg = system_new_tt_rule(cfg,
                        name      = "rname",
                        times     = c(0, 2, 4),
                        timescale = "weeks")'
</pre>
<p>A titration rule identifies a set of times (<code>times</code>) and an associated time
scale (<code>timescale</code>) in which titration events can potentially occur. Any
times scale, as defined in the system file with <code>&lt;TS:?&gt;</code>, can be used in
place of &quot;weeks&quot; above. The <code>name</code>, <code>"rname"</code> above, is used to link the
titration rule to different conditions discussed below. The name should be
a string beginning with a letter, and it can contain any combination of
numbers, letters, and underscores. With the rule created we can then add conditions to that rule.'
</p>


<h3>Value</h3>

<p>Ubiquity system object with the titration rule created
</p>


<h3>See Also</h3>

<p><code><a href="#topic+system_set_tt_cond">system_set_tt_cond</a></code>, <code><a href="#topic+run_simulation_titrate">run_simulation_titrate</a></code>
</p>

<hr>
<h2 id='system_nm_check_ds'>Check NONMEM Dataset for Automatic Definitions</h2><span id='topic+system_nm_check_ds'></span>

<h3>Description</h3>

<p>Checks the dataset against the information specified by <code><a href="#topic+system_define_cohorts_nm">system_define_cohorts_nm</a></code> for validity
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_nm_check_ds(
  cfg,
  DS = "DSNAME",
  col_ID = "ID",
  col_CMT = "CMT",
  col_DV = "DV",
  col_TIME = "TIME",
  col_AMT = "AMT",
  col_RATE = "RATE",
  col_EVID = "EVID",
  col_GROUP = NULL,
  filter = NULL,
  INPUTS = NULL,
  OBS = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_nm_check_ds_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_nm_check_ds_+3A_ds">DS</code></td>
<td>
<p>Name of the dataset loaded using <code>system_load_data</code></p>
</td></tr>
<tr><td><code id="system_nm_check_ds_+3A_col_id">col_ID</code></td>
<td>
<p>Column of unique subject identifier</p>
</td></tr>
<tr><td><code id="system_nm_check_ds_+3A_col_cmt">col_CMT</code></td>
<td>
<p>Compartment column</p>
</td></tr>
<tr><td><code id="system_nm_check_ds_+3A_col_dv">col_DV</code></td>
<td>
<p>Column with observations or <code>.</code> for input</p>
</td></tr>
<tr><td><code id="system_nm_check_ds_+3A_col_time">col_TIME</code></td>
<td>
<p>Column with system time of each record</p>
</td></tr>
<tr><td><code id="system_nm_check_ds_+3A_col_amt">col_AMT</code></td>
<td>
<p>Infusion/dose amounts (these need to be in the same units specified in the system.txt file)</p>
</td></tr>
<tr><td><code id="system_nm_check_ds_+3A_col_rate">col_RATE</code></td>
<td>
<p>Rate of infusion or <code>.</code> for bolus</p>
</td></tr>
<tr><td><code id="system_nm_check_ds_+3A_col_evid">col_EVID</code></td>
<td>
<p>EVID (0 - observation, 1 dose)</p>
</td></tr>
<tr><td><code id="system_nm_check_ds_+3A_col_group">col_GROUP</code></td>
<td>
<p>Column name to use for defining similar cohorts when generating figures.</p>
</td></tr>
<tr><td><code id="system_nm_check_ds_+3A_filter">filter</code></td>
<td>
<p>List used to filter the dataset or <code>NULL</code> if the whole dataset is to be used (see filter rules or  <code><a href="#topic+nm_select_records">nm_select_records</a></code> or a description of how to use this option)</p>
</td></tr>
<tr><td><code id="system_nm_check_ds_+3A_inputs">INPUTS</code></td>
<td>
<p>List mapping input information in the dataset to names used in the system.txt file</p>
</td></tr>
<tr><td><code id="system_nm_check_ds_+3A_obs">OBS</code></td>
<td>
<p>List mapping obseravation information in the dataset to names used in the system.txt file</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with the following elements 
</p>

<ul>
<li><p>&quot;isgood&quot; Boolean variable indicating success (<code>TRUE</code>) or failure (<code>FALSE</code>)
</p>
</li>
<li><p>&quot;mywarning&quot; Boolean variable indicating warnings (<code>TRUE</code>) or no warnings (<code>FALSE</code>)
</p>
</li>
<li><p>&quot;dsraw&quot; Dataframe with the filtered raw data that was used
</p>
</li>
<li><p>&quot;input_records&quot; Rows from <code>dsraw</code> containing the input information
</p>
</li>
<li><p>&quot;obs_records&quot; Rows from <code>dsraw</code> containing the observation information
</p>
</li>
<li><p>&quot;sids&quot; Subject ids found in <code>dsraw</code>
</p>
</li>
<li><p>&quot;TSsys&quot; system time scale used in the dataset
</p>
</li></ul>


<hr>
<h2 id='system_od_general'>General Observation Details Function</h2><span id='topic+system_od_general'></span>

<h3>Description</h3>

<p>Used to calculate observation details based on 
cohorts created with <code>system_define_cohort</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_od_general(pest, cfg, estimation = TRUE, details = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_od_general_+3A_pest">pest</code></td>
<td>
<p>vector of parameters to be estimated</p>
</td></tr>
<tr><td><code id="system_od_general_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_od_general_+3A_estimation">estimation</code></td>
<td>
<p><code>TRUE</code> when called during an estimation and <code>FALSE</code> when called to test objective function or generate observation information for plotting</p>
</td></tr>
<tr><td><code id="system_od_general_+3A_details">details</code></td>
<td>
<p><code>TRUE</code> to display information about cohorts as they are simulated (useful for debugging when passed through <code><a href="#topic+system_simulate_estimation_results">system_simulate_estimation_results</a></code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If estimation is TRUE then the output is a matrix  of observation details of the format:
</p>
<pre>od$pred  = [TIME, OBS, PRED, VAR, OUTPUT, COHORT] </pre>
<p>The values are the observed (<code>OBS</code>) data, predicted
values (<code>PRED</code>) and variance (<code>VAR</code>) at the given <code>TIME</code>. The columns <code>OUTPUT</code> and
<code>COHORT</code> can be used for sorting. These should be unique numbers.
</p>
<p>When estimation is <code>FALSE</code> we output <code>od$pred</code> is a data frame with the
following headings:
</p>
<pre>od$pred  = [TIME, OBS, PRED, VAR, SMOOTH, OUTPUT, COHORT] </pre>
<p>The <code>TIME</code>, <code>OBS</code>, <code>PRED</code> and <code>VAR</code> are the same as those listed above. The <code>SMOOTH</code>
variable is <code>FALSE</code> for rows that correspond to records in the dataset and
<code>TRUE</code> when the <code>PRED</code> represents the smooth predictions. The <code>OUTPUT</code> and <code>COHORT</code>
columns here are text values used when defining the cohorts.
</p>
<p>Also the <code>od$all</code> list item is created with all of the simulation information
stored for each cohort:
</p>
<pre>od$all = [ts.time, ts.ts1, ... ts.tsn, pred, name, cohort]</pre>

<ul>
<li> <p><code>tstime</code>             - timescale of the system
</p>
</li>
<li> <p><code>ts.ts1, ... ts.tsn</code> - timescales defined in the system
</p>
</li>
<li> <p><code>pred</code>               - smooth prediction
</p>
</li>
<li> <p><code>name</code>               - state or output name corresponding to the prediction
</p>
</li>
<li> <p><code>cohort</code>             - name of the cohort for these predictions
</p>
</li></ul>

<p>Lastly the field <code>isgood</code> will be set to <code>FALSE</code> if any problems are encountered, and <code>TRUE</code> if everything worked.
</p>
<pre>od$isgood = TRUE</pre>


<h3>See Also</h3>

<p><code><a href="#topic+system_define_cohort">system_define_cohort</a></code> and <code><a href="#topic+system_simulate_estimation_results">system_simulate_estimation_results</a></code>
</p>

<hr>
<h2 id='system_plot_cohorts'>Plot Estimation Results</h2><span id='topic+system_plot_cohorts'></span>

<h3>Description</h3>

<p>Generates figures for each cohort/output for a given set of
parameter estimates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_plot_cohorts(
  erp,
  plot_opts = c(),
  cfg,
  analysis_name = "analysis",
  archive_results = TRUE,
  prefix = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_plot_cohorts_+3A_erp">erp</code></td>
<td>
<p>output from <code>system_simulate_estimation_results</code></p>
</td></tr>
<tr><td><code id="system_plot_cohorts_+3A_plot_opts">plot_opts</code></td>
<td>
<p>list controling how predictions and data are overlaid</p>
</td></tr>
<tr><td><code id="system_plot_cohorts_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_plot_cohorts_+3A_analysis_name">analysis_name</code></td>
<td>
<p>string containing the name of the analysis</p>
</td></tr>
<tr><td><code id="system_plot_cohorts_+3A_archive_results">archive_results</code></td>
<td>
<p>boolean variable to control whether results will be archived</p>
</td></tr>
<tr><td><code id="system_plot_cohorts_+3A_prefix">prefix</code></td>
<td>
<p>depreciated input mapped to analysis_name</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The general format for a plot option for a given output (<code>OUTPUT</code>) is:
</p>
<p><code>plot_opts$outputs$OUTPUTt$option = value</code>
</p>
<p>The following options are:
</p>

<ul>
<li> <p><code>yscale</code> and  <code>xscale</code> <code>= "linear" or "log"</code>
</p>
</li>
<li> <p><code>ylabel</code> and  <code>xlabel</code> <code>= "text"</code>
</p>
</li>
<li> <p><code>xlim</code>   and  <code>ylim</code>   <code>= c(min, max)</code>
</p>
</li></ul>

<p>It is also possible to control the <code>height</code> and <code>width</code> of the time course <code>tc</code> and observed vs predicted <code>op</code> file by specifying the following in the default units of <code>ggsave</code>.
</p>

<ul>
<li> <p><code>plot_opts$tc$width  = 10</code>  
</p>
</li>
<li> <p><code>plot_opts$tc$height = 5.5</code> 
</p>
</li>
<li> <p><code>plot_opts$op$width  = 10</code>  
</p>
</li>
<li> <p><code>plot_opts$op$height = 8.0</code> 
</p>
</li></ul>

<p>To control the figures that are generated you can set the purpose to either &quot;print&quot;, &quot;present&quot; (default) or &quot;shiny&quot;.
</p>
<p><code>plot_opts$purpose = "present"</code>
</p>


<h3>Value</h3>

<p>List of plot outputs containing two elements <code>timecourse</code> and
<code>obs_pred</code>, for the time course of and observed vs predicted,
respectively. Both of these fields contain three elements for a given
output. For example, say there is an output named <code>PK</code> the both the
<code>timecourse</code> and <code>obs_pred</code> elements will have a field named
<code>PK</code> containing a ggplot object
and two fields <code>PK_png</code> and <code>PK_pdf</code> containing the paths to the
files containing that figure in the respective formats.
</p>


<h3>See Also</h3>

<p>The estimation vignette (<code>vignette("Estimation", package = "ubiquity")</code>)
</p>

<hr>
<h2 id='system_req'>Require Suggested Packages</h2><span id='topic+system_req'></span>

<h3>Description</h3>

<p>Used to ensure packages are loaded as they are needed for the
stand alone distribution of ubiquity. If the ubiquity package is being used this
function simply returns 'TRUE' if the packages are installed and FALSE if
if not.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_req(pkgs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_req_+3A_pkgs">pkgs</code></td>
<td>
<p>character vector of package names to check</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Boolean result of the loaded (stand alone) or installed (package) status for all of the packages
</p>

<hr>
<h2 id='system_rpt_add_doc_content'>Adds Content to a Word Report</h2><span id='topic+system_rpt_add_doc_content'></span>

<h3>Description</h3>

<p>Appends content to an open ubiquity Word report.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_rpt_add_doc_content(
  cfg,
  type = NULL,
  content = NULL,
  rptname = "default"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_rpt_add_doc_content_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_rpt_add_doc_content_+3A_type">type</code></td>
<td>
<p>Type of content to add. See the
onbrand function <code><a href="onbrand.html#topic+report_add_doc_content">report_add_doc_content</a></code> 
for the allowed content types.</p>
</td></tr>
<tr><td><code id="system_rpt_add_doc_content_+3A_content">content</code></td>
<td>
<p>List with content to add to the report.  See the
onbrand function <code><a href="onbrand.html#topic+report_add_doc_content">report_add_doc_content</a></code> 
format of this list.</p>
</td></tr>
<tr><td><code id="system_rpt_add_doc_content_+3A_rptname">rptname</code></td>
<td>
<p>Report name</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ubiquity system object with the content added to the specified
report
</p>


<h3>See Also</h3>

<p><code><a href="onbrand.html#topic+report_add_doc_content">report_add_doc_content</a></code> and
Reporting vignette (<code>vignette("Reporting", package = "ubiquity")</code>)
</p>

<hr>
<h2 id='system_rpt_add_slide'>Add Slide to a Powerpoint Report</h2><span id='topic+system_rpt_add_slide'></span>

<h3>Description</h3>

<p>Adds a slide to a ubiquity report.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_rpt_add_slide(
  cfg,
  template = NULL,
  elements = NULL,
  rptname = "default"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_rpt_add_slide_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_rpt_add_slide_+3A_template">template</code></td>
<td>
<p>Name of slide template to use</p>
</td></tr>
<tr><td><code id="system_rpt_add_slide_+3A_elements">elements</code></td>
<td>
<p>List with content to populate placeholders in the slide. See the
onbrand functions <code><a href="onbrand.html#topic+report_add_slide">report_add_slide</a></code> and
<code><a href="onbrand.html#topic+add_pptx_ph_content">add_pptx_ph_content</a></code> for details on the expected
format of this list.</p>
</td></tr>
<tr><td><code id="system_rpt_add_slide_+3A_rptname">rptname</code></td>
<td>
<p>Report name</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ubiquity system object with the slide added to the specified
report
</p>


<h3>See Also</h3>

<p><code><a href="onbrand.html#topic+report_add_slide">report_add_slide</a></code>, 
<code><a href="onbrand.html#topic+add_pptx_ph_content">add_pptx_ph_content</a></code>, and 
Reporting vignette (<code>vignette("Reporting", package = "ubiquity")</code>)
</p>

<hr>
<h2 id='system_rpt_estimation'>Generate a Report from Parameter Estimation</h2><span id='topic+system_rpt_estimation'></span>

<h3>Description</h3>

<p>This will take the output generated during a parameter estimation and append those results to a specified report.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_rpt_estimation(cfg, rptname = "default", analysis_name = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_rpt_estimation_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_rpt_estimation_+3A_rptname">rptname</code></td>
<td>
<p>report name (<code>"default"</code>)</p>
</td></tr>
<tr><td><code id="system_rpt_estimation_+3A_analysis_name">analysis_name</code></td>
<td>
<p>string containing the name of the estimation analysis and used as a prefix to store the results</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ubiquity system object with estimation report appended
</p>


<h3>See Also</h3>

<p><code><a href="#topic+system_rpt_read_template">system_rpt_read_template</a></code>, the reporting vignette (<code>vignette("Reporting", package = "ubiquity")</code>)
and the estimation vignette (<code>vignette("Estimation", package = "ubiquity")</code>)
</p>

<hr>
<h2 id='system_rpt_nca'>Report NCA</h2><span id='topic+system_rpt_nca'></span>

<h3>Description</h3>

<p>Appends the results of NCA to a report
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_rpt_nca(
  cfg,
  rptname = "default",
  analysis_name = "analysis",
  rows_max = 10,
  table_headers = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_rpt_nca_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_rpt_nca_+3A_rptname">rptname</code></td>
<td>
<p>report name (either PowerPoint or Word)</p>
</td></tr>
<tr><td><code id="system_rpt_nca_+3A_analysis_name">analysis_name</code></td>
<td>
<p>string containing the name of the NCA analysis (default <code>'analysis'</code>)</p>
</td></tr>
<tr><td><code id="system_rpt_nca_+3A_rows_max">rows_max</code></td>
<td>
<p>maximum number of rows per slide when generating tabular data</p>
</td></tr>
<tr><td><code id="system_rpt_nca_+3A_table_headers">table_headers</code></td>
<td>
<p>Boolean variable to add descriptive headers to output tables (default <code>TRUE</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>cfg ubiquity system object with the NCA results appended to the specified report and if the analysis name is specified:
</p>


<h3>See Also</h3>

<p>Vignette on NCA (<code>vignette("NCA", package = "ubiquity")</code>)
</p>

<hr>
<h2 id='system_rpt_read_template'>Initialize a New Report</h2><span id='topic+system_rpt_read_template'></span>

<h3>Description</h3>

<p>Creates a new officer report based either on the ubiquity
template or one specified by the user. Once created, content can then be
added.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_rpt_read_template(
  cfg,
  template = "PowerPoint",
  mapping = NULL,
  rptname = "default"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_rpt_read_template_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_rpt_read_template_+3A_template">template</code></td>
<td>
<p>Type of internal template to use (&quot;PowerPoint&quot; or &quot;Word&quot;) or path to template file.</p>
</td></tr>
<tr><td><code id="system_rpt_read_template_+3A_mapping">mapping</code></td>
<td>
<p>Path to an onbrand yaml mapping file: If an internal ubiquity
template has been supplied, this argument will be ignored and the yaml file
from ubiquity will be used.</p>
</td></tr>
<tr><td><code id="system_rpt_read_template_+3A_rptname">rptname</code></td>
<td>
<p>report name</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The 'template' and 'mapping' inputs can specify either the internal
ubiquity templates or user-defined templates  If you specify 'template'
values of 'PowerPoint' or 'Word' then the internal
ubiquity templates for PowerPoint or Word will be used and the mapping
information will be ignored.
</p>
<p>If templates other than the values above are specified you will need also
supply a yaml mapping file for an 'onbrand' reporting template. The
vignette below highlights how to go about creating these files.
</p>


<h3>Value</h3>

<p>ubiquity system object with and empty report initialized
</p>


<h3>See Also</h3>

<p>Reporting vignette (<code>vignette("Reporting", package = "ubiquity")</code>)
</p>
<p>Custom Office Template vignette (<code>vignette("Custom_Office_Templates", package="onbrand")</code>)
</p>

<hr>
<h2 id='system_rpt_save_report'>Save Report to a File</h2><span id='topic+system_rpt_save_report'></span>

<h3>Description</h3>

<p>Saves a ubiquity report to the specified file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_rpt_save_report(cfg, output_file = NULL, rptname = "default")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_rpt_save_report_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_rpt_save_report_+3A_output_file">output_file</code></td>
<td>
<p>File to save the report to (must be either .pptx or .docx
depending on the type of report)</p>
</td></tr>
<tr><td><code id="system_rpt_save_report_+3A_rptname">rptname</code></td>
<td>
<p>ubiquity report name</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with the follwoing elements 
</p>

<ul>
<li><p>isgood Boolean variable indicating success or failure
</p>
</li>
<li><p>msgs   Verbose description of the save results
</p>
</li></ul>



<h3>See Also</h3>

<p>Reporting vignette (<code>vignette("Reporting", package = "ubiquity")</code>)
</p>

<hr>
<h2 id='system_rpt_template_details'>Generate Details about Report Template</h2><span id='topic+system_rpt_template_details'></span>

<h3>Description</h3>

<p>Wrapper for the onbrand::template_details function, see the
help for that function for more information
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_rpt_template_details(cfg, rptname = "default")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_rpt_template_details_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_rpt_template_details_+3A_rptname">rptname</code></td>
<td>
<p>Report name</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with template information, see
<code><a href="onbrand.html#topic+template_details">template_details</a></code> for information on the structure of
this list.
</p>


<h3>See Also</h3>

<p><code><a href="onbrand.html#topic+template_details">template_details</a></code> and
Reporting vignette (<code>vignette("Reporting", package = "ubiquity")</code>)
</p>

<hr>
<h2 id='system_select_set'>Selecting Parameter Sets</h2><span id='topic+system_select_set'></span>

<h3>Description</h3>

<p>The system file can contain multiple parameterizations using
the <code>&lt;PSET:?:?&gt;?</code> notation. This function provides the means for
switching between these parameterizations, and (optionally) specifying a
subset of parameters estimated when performing parameter estimation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_select_set(cfg, set_name = "default", parameter_names = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_select_set_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_select_set_+3A_set_name">set_name</code></td>
<td>
<p>string containing the name of the parameter set</p>
</td></tr>
<tr><td><code id="system_select_set_+3A_parameter_names">parameter_names</code></td>
<td>
<p>list of parameter names to be estimated</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Ubiquity system object with the specified parameter set active
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Creating a system file from the mab_pk example
fr = system_new(file_name        = "system.txt", 
                system_file      = "mab_pk", 
                overwrite        = TRUE, 
                output_directory = tempdir())

# Building the system 
cfg = build_system(system_file  = file.path(tempdir(), "system.txt"),
      output_directory          = file.path(tempdir(), "output"),
      temporary_directory       = tempdir())

# Selecting the default parameter set
cfg = system_select_set(cfg, "default")

</code></pre>

<hr>
<h2 id='system_set_bolus'>Set Bolus Inputs</h2><span id='topic+system_set_bolus'></span>

<h3>Description</h3>

<p>Defines infusion rates specified in the system file using  <code>&lt;B:times&gt;</code> and   <code>&lt;B:events&gt;</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_set_bolus(cfg, state, times, values)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_set_bolus_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_set_bolus_+3A_state">state</code></td>
<td>
<p>name of the state to apply the bolus</p>
</td></tr>
<tr><td><code id="system_set_bolus_+3A_times">times</code></td>
<td>
<p>list of injection times</p>
</td></tr>
<tr><td><code id="system_set_bolus_+3A_values">values</code></td>
<td>
<p>corresponding list injection values</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Ubiquity system object with the bolus information set
</p>


<h3>See Also</h3>

<p><code><a href="#topic+system_zero_inputs">system_zero_inputs</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Creating a system file from the mab_pk example
fr = system_new(file_name        = "system.txt", 
                system_file      = "mab_pk", 
                overwrite        = TRUE, 
                output_directory = tempdir())

# Building the system 
cfg = build_system(system_file  = file.path(tempdir(), "system.txt"),
      output_directory          = file.path(tempdir(), "output"),
      temporary_directory       = tempdir())

# Clearing all inputs
cfg = system_zero_inputs(cfg)

# SC dose of 200 mg
cfg = system_set_bolus(cfg, state   ="At", 
                            times   = c(  0.0),  #  day
                            values  = c(200.0))  #  mg

</code></pre>

<hr>
<h2 id='system_set_covariate'>Set Covariate Values</h2><span id='topic+system_set_covariate'></span>

<h3>Description</h3>

<p>Covariates specified in the system file using  <code>&lt;CV:?&gt;</code>
and <code>&lt;CVSET:?:?&gt;</code> will have their default values for a given parameter
set. This function is a means to overwrite those values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_set_covariate(cfg, covariate, times, values)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_set_covariate_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_set_covariate_+3A_covariate">covariate</code></td>
<td>
<p>name of the covariate</p>
</td></tr>
<tr><td><code id="system_set_covariate_+3A_times">times</code></td>
<td>
<p>list of times (system time units)</p>
</td></tr>
<tr><td><code id="system_set_covariate_+3A_values">values</code></td>
<td>
<p>corresponding list of values</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Ubiquity system object with the covariate set
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Creating a system file from the mab_pk example
fr = system_new(file_name        = "system.txt", 
                system_file      = "mab_pk", 
                overwrite        = TRUE, 
                output_directory = tempdir())

# Building the system 
cfg = build_system(system_file  = file.path(tempdir(), "system.txt"),
      output_directory          = file.path(tempdir(), "output"),
      temporary_directory       = tempdir())

# Setting the covariate WT to 50
cfg = system_set_covariate(cfg, 
                           covariate = "WT",
                           times     = c(0), 
                           values    = c(50))

</code></pre>

<hr>
<h2 id='system_set_guess'>Alter Initial Guess and Parameter Bounds</h2><span id='topic+system_set_guess'></span>

<h3>Description</h3>

<p>Default values for parameters are taken from the <code>system.txt</code> file
either when the parameter was defined (<code>&lt;P&gt;</code>) or when it was reassigned
for a parameter set (<code>&lt;PSET:?:?&gt;?</code>). These can be altered at the
scripting level using this function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_set_guess(cfg, pname, value, lb = NULL, ub = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_set_guess_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_set_guess_+3A_pname">pname</code></td>
<td>
<p>name of parameter to set</p>
</td></tr>
<tr><td><code id="system_set_guess_+3A_value">value</code></td>
<td>
<p>value to assign</p>
</td></tr>
<tr><td><code id="system_set_guess_+3A_lb">lb</code></td>
<td>
<p>optionally change the lower bound (<code>NULL</code>)</p>
</td></tr>
<tr><td><code id="system_set_guess_+3A_ub">ub</code></td>
<td>
<p>optionally change the upper bound (<code>NULL</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When performing a parameter estimation, the initial guess will be the value
specified in the <code>system.txt</code> file for the currently selected parameter set. The
following command can be used after the parameter set has been selected to
specify the value (<code>VALUE</code>) of the parameter <code>PNAME</code> and optionally the lower (<code>lb</code>)
and upper (<code>ub</code>) bounds:
</p>
<pre>cfg = system_set_guess(cfg, pname="PNAME", value=VALUE, lb=NULL, ub=NULL)</pre>
<p>To set the initial guess for the parameter Vc to a value of 3, the following
would be used:
</p>
<pre>cfg = system_set_guess(cfg, "Vc", value=3)</pre>
<p>To specify the guess and overwrite the upper bound on Vc and set it to 5
</p>
<pre>cfg = system_set_guess(cfg, "Vc", value=3, ub=5) </pre>


<h3>Value</h3>

<p>cfg ubiquity system object with guess and bounds assigned
</p>

<hr>
<h2 id='system_set_iiv'>Set Variability Terms</h2><span id='topic+system_set_iiv'></span>

<h3>Description</h3>

<p>Set elements of the current variance covariance matrix
specified in the system file with <code>&lt;IIV:?:?&gt; ?</code>, <code>&lt;IIVCOR:?:?&gt;?</code>, <code>&lt;IIVSET:?:?&gt; ?</code>, <code>&lt;IIVCORSET:?:?&gt;?</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_set_iiv(cfg, IIV1, IIV2, value)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_set_iiv_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_set_iiv_+3A_iiv1">IIV1</code></td>
<td>
<p>row name of the variance/covariance matrix</p>
</td></tr>
<tr><td><code id="system_set_iiv_+3A_iiv2">IIV2</code></td>
<td>
<p>column name of the variance/covariance matrix element</p>
</td></tr>
<tr><td><code id="system_set_iiv_+3A_value">value</code></td>
<td>
<p>value to assign to the variance/covariance matrix element</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Ubiquity system object with IIV information set
</p>


<h3>See Also</h3>

<p><code><a href="#topic+system_fetch_iiv">system_fetch_iiv</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Creating a system file from the mab_pk example
fr = system_new(file_name        = "system.txt", 
                system_file      = "mab_pk", 
                overwrite        = TRUE, 
                output_directory = tempdir())

# Building the system 
cfg = build_system(system_file  = file.path(tempdir(), "system.txt"),
      output_directory          = file.path(tempdir(), "output"),
      temporary_directory       = tempdir())

# Clearing all inputs
cfg = system_zero_inputs(cfg)

# Setting the covariance element for CL and Vc to 0.03
cfg = system_set_iiv(cfg,
                     IIV1 = "ETACL",
                     IIV2 = "ETAVc",
                     value=0.03)

</code></pre>

<hr>
<h2 id='system_set_option'>Setting Analysis Options</h2><span id='topic+system_set_option'></span>

<h3>Description</h3>

<p>Different options associated performing analyses (e.g running
simulations, performing parameter estimation, logging, etc.) can be set
with this function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_set_option(cfg, group, option, value)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_set_option_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_set_option_+3A_group">group</code></td>
<td>
<p>options are grouped together by the underlying activity being performed: &quot;estimation&quot;,  &quot;general&quot;, &quot;logging&quot;, &quot;simulation&quot;, &quot;solver&quot;, &quot;stochastic&quot;, or &quot;titration&quot;</p>
</td></tr>
<tr><td><code id="system_set_option_+3A_option">option</code></td>
<td>
<p>for each group there are a set of options</p>
</td></tr>
<tr><td><code id="system_set_option_+3A_value">value</code></td>
<td>
<p>corresponding value for the option</p>
</td></tr>
</table>


<h3>Details</h3>

<p><b><code>group="estimation"</code></b>
</p>
<p>The default estimation in R is performed using either the <code>optim</code> or <code>optimx</code> libraries.
This is selected by setting the <code>optimizer</code> option:
</p>
<pre>
cfg = system_set_option(cfg, 
                       group  = "estimation",
                       option = "optimizer",
                       value  = "optim")
</pre>
<p>The optimization routine then specified using the <code>method</code>. By default this <code>option</code> is
set to <code>Nelder-Mead</code>.
</p>
<pre>
cfg = system_set_option(cfg, 
                       group  = "estimation",
                       option = "method",
                       value  = "Nelder-Mead")
</pre>
<p>And different attributes are then selected using the control.
</p>
<pre>
cfg = system_set_option(cfg, 
                       group  = "estimation",
                       option = "control",
                       value  = list(trace  = TRUE,
                                     maxit  = 500,
                                     REPORT = 10))
</pre>
<p>For the different methods and control options, see the documentation for the <code>optim</code>
and <code>optimx</code> libraries.
</p>
<p>To perform a global optimization you can install either the particle swarm (<code>pso</code>)
genetic algorithm (<code>GA</code>) libraries.
To use the particle swarm set the <code>optimizer</code> and <code>method</code>:
</p>
<pre>
cfg = system_set_option(cfg, 
                       group  = "estimation",
                       option = "optimizer",
                       value  = "pso")

cfg = system_set_option(cfg, 
                       group  = "estimation",
                       option = "method",
                       value  = "psoptim")
</pre>
<p>The control option is a list described <code>pso</code> documentation.
</p>
<p>To use the genetic algorithm set the optimizer and method:
</p>
<pre>
cfg = system_set_option(cfg, 
                       group  = "estimation",
                       option = "optimizer",
                       value  = "ga")

cfg = system_set_option(cfg, 
                       group  = "estimation",
                       option = "method",
                       value  = "ga")
</pre>
<p>The control option is a list and the list elements are the named options in the GA
documentation. Use the following as an example:
</p>
<pre>
cfg = system_set_option(cfg, 
                       group  = "estimation",
                       option = "control",
                       value  = list(maxiter  = 10000,
                                    optimArgs = list(
                                      method  = "Nelder-Mead",
                                      maxiter = 1000)))
</pre>
<p>To alter initial guesses see: <code><a href="#topic+system_set_guess">system_set_guess</a></code>
</p>
<p>When performing parameter estimation, the internal function
<code>system_od_general</code> is used. This is the function that simulates your
system at the conditions defined for the different cohorts. This is pretty
flexible but if you want to go beyond this you can set the
<code>observation_function</code> option:
</p>
<pre>
cfg = system_set_option(cfg, 
                       group  = "estimation",
                       option = "observation_function",
                       value  = "my_od")
</pre>
<p>That will instruct the optimziation routines to use the user defined
function <code>my_od</code>. You will need to construct that function to have the
same input/output format as <code><a href="#topic+system_od_general">system_od_general</a></code>.
</p>
<p><b><code>group=general</code></b>
</p>

<ul>
<li> <p><code>"output_directory"</code>   = String where analysis outputs will be
placed. Generally you wont want to change this, but it can be useful in Shiny
apps where you need to have each shiny user generate output in that
users directory : <code>file.path(".", "output")</code>
</p>
</li></ul>

<p><b><code>group=logging</code></b>
</p>
<p>By default ubiquity prints different information to the console and logs this
information to a log file. The following options can be used to control
this behavior:
</p>

<ul>
<li> <p><code>"enabled"</code>   = Boolean variable to control logging: <code>TRUE</code>
</p>
</li>
<li> <p><code>"file"</code>      = String containing the name of the log file: <code>file.path("transient", "ubiquity_log.txt")</code>
</p>
</li>
<li> <p><code>"timestamp"</code> = Boolean switch to control appending a time stamp to log entries: <code>TRUE</code>
</p>
</li>
<li> <p><code>"ts_str"</code>    = String format of timestamp: &quot;
</p>
</li>
<li> <p><code>"debug"</code>     = Boolean switch to control debugging (see below): <code>FALSE</code>
</p>
</li>
<li> <p><code>"verbose"</code>   = Boolean switch to control printing to the console <code>FALSE</code>
</p>
</li></ul>

<p>To enable debugging of different functions (like when performing esitmation), 
set the <code>debug</code> option to <code>TRUE</code>. Important function calls will be 
trapped and information will be logged and reported to the console.
</p>
<pre>
cfg = system_set_option(cfg, 
                       group  = "estimation",
                       option = "debug",
                       value  = FALSE)
</pre>
<p><b><code>group="simulation"</code></b>
</p>

<ul>
<li> <p><code>"include_important_output_times"</code> - Automatically add bolus, infusion rate switching times, etc: <code>"yes"</code>(default), <code>"no"</code>.
</p>
</li>
<li> <p><code>"integrate_with"</code> - Specify if the ODE solver should use the Rscript (<code>"r-file"</code>) or compiled C (<code>"c-file"</code>), if the build process can compile and load the C version it will be the default otherwise it will switch over to the R script.
</p>
</li>
<li> <p><code>"output_times"</code> - Vector of times to evaulate the simulation (default <code>seq(0,100,1)</code>).
</p>
</li>
<li> <p><code>"solver"</code> - Selects the ODE solver: <code>"lsoda"</code> (default), <code>"lsode"</code>, <code>"vode"</code>, etc.; see the documentation for <code><a href="deSolve.html#topic+deSolve">deSolve</a></code> for an exhaustive list.
</p>
</li>
<li> <p><code>"sample_bolus_delta"</code> - Spacing used when sampling around bolus events (default <code>1e-6</code>). 
</p>
</li>
<li> <p><code>"sample_forcing_delta"</code> - Spacing used when sampling around forcing functions (infusion rates, covariates, etc) (default <code>1e-3</code>). 
</p>
</li></ul>

<p><b><code>group=solver</code></b>
</p>
<p>Depending on the solver, different options can be set. The documentation
for  <code><a href="deSolve.html#topic+deSolve">deSolve</a></code> lists the different solvers. For a full list of options, see the
documentation for the specific solver (e.g. <code>?lsoda</code>). Some common options
to consider are:
</p>

<ul>
<li> <p><code>"atol"</code> - Relative error tolerance
</p>
</li>
<li> <p><code>"rtol"</code> - Absolute error tolerance
</p>
</li>
<li> <p><code>"hmin"</code> - Minimum integration step size
</p>
</li>
<li> <p><code>"hmax"</code> - Maximum integration step size
</p>
</li></ul>

<p>To select the <code>vode</code> solver and set the maximum step size to 0.01, the
following would be used:
</p>
<pre>
cfg=system_set_option(cfg,
                     group  = "simulation",
                     option = "solver", 
                     value  = "vode")

cfg=system_set_option(cfg,
                     group  = "solver",
                     option = "hmax", 
                     value  = 0.01)
</pre>
<p><b><code>group="stochastic"</code></b>
</p>
<p>When running stochastic simulations (inter-individual variability applied to system
parameters) it can be useful to specify the following:
</p>

<ul>
<li><p><code>"ci"</code> - Confidence interval (default <code>95</code>)
</p>
</li>
<li><p><code>"nsub"</code> - Number of subjects (default <code>100</code>)
</p>
</li>
<li><p><code>"seed"</code> - Seed for the random numebr generator (default <code>8675309</code>)
</p>
</li>
<li><p><code>"ponly"</code> - Only generate the subject parameters but do not run the simulations (default <code>FALSE</code>)
</p>
</li>
<li><p><code>"ssp"</code> - A list of the calculated static secondary parameters to include (default all parameters defined by <code>&lt;As&gt;</code>)
</p>
</li>
<li><p><code>"outputs"</code> - A list of the predicted outputs to include (default all outputs defined by <code>&lt;O&gt;</code>)
</p>
</li>
<li><p><code>"states"</code> - A list of the predicted states to include(default all states)
</p>
</li>
<li><p><code>"sub_file"</code> - Name of data set loaded with (<code><a href="#topic+system_load_data">system_load_data</a></code>) containing subject level parameters and coviariates
</p>
</li>
<li><p><code>"sub_file_sample"</code> - Controls how subjects are sampled from the dataset
</p>
</li></ul>

<p>If you wanted to generate <code>1000</code> subjects but only wanted the parameters, you would
use the following:
</p>
<pre>
cfg = system_set_option(cfg,
                       group  = "stochastic", 
                       option = "nsub ",
                       value  = 1000)

cfg = system_set_option(cfg,
                       group  = "stochastic", 
                       option = "ponly",
                       value  = TRUE )
</pre>
<p>If you wanted to exclude both states and secondary parameters, while only including 
the output <code>Cp_nM</code>, you would do the following:
</p>
<pre>

cfg = system_set_option (cfg, 
                        group  = "stochastic",
                        option = "ssp",
                        value  = list())

cfg = system_set_option (cfg, 
                        group  = "stochastic",
                        option = "states",
                        value  = list())

cfg = system_set_option (cfg, 
                        group  = "stochastic",
                        option = "outputs",
                        value  = c("Cp_nM")) 
</pre>
<p>To pull subject information from a data file instead of generating the subject
parameters from IIV information the <code>sub_file</code> option can be used. The value here
<code>SUBFILE_NAME</code> is the name given to a dataset loaded with
(<code><a href="#topic+system_load_data">system_load_data</a></code>):
</p>
<pre>
cfg=system_set_option(cfg, 
                     group  = "stochastic",
                     option = "sub_file",
                     value  = "SUBFILE_NAME")
</pre>
<p>Sampling from the dataset can be controlled using the <code>sub_file_sample</code> option:
</p>
<pre>
cfg=system_set_option(cfg, 
                     group  = "stochastic",
                     option = "sub_file_sample",
                     value  = "with replacement")
</pre>
<p>Sampling can be done sequentially (<code>"sequential"</code>), with replacement
(<code>"with replacement"</code>), or without replacement (<code>"without replacement"</code>)
</p>
<p><b><code>group="titration"</code></b>
</p>
<p><code>"titrate"</code> - By default titration is disable (set to <code>FALSE</code>). If you are
going to use titration, enable it here by setting this option to <code>TRUE</code>.
This will force #' <code><a href="#topic+simulate_subjects">simulate_subjects</a></code> to use 
<code><a href="#topic+run_simulation_titrate">run_simulation_titrate</a></code> internally when running simulations.
</p>


<h3>Value</h3>

<p>Ubiquity system object with the option set
</p>

<hr>
<h2 id='system_set_parameter'>Set Value for Parameter</h2><span id='topic+system_set_parameter'></span>

<h3>Description</h3>

<p>Assigns a value for a named parameter in a parameter list.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_set_parameter(cfg, parameters, pname, value)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_set_parameter_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_set_parameter_+3A_parameters">parameters</code></td>
<td>
<p>vector of parameters</p>
</td></tr>
<tr><td><code id="system_set_parameter_+3A_pname">pname</code></td>
<td>
<p>parameter name</p>
</td></tr>
<tr><td><code id="system_set_parameter_+3A_value">value</code></td>
<td>
<p>value</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To set the parameter Vc to a value of 3, the following would be used:
</p>
<pre>parameters = system_fetch_parameters(cfg) 
parameters = system_set_parameter(cfg, parameters, pname = 'Vc', value = 3) 
</pre>


<h3>Value</h3>

<p>parameters vector with <code>pname</code> set to <code>value</code>
</p>

<hr>
<h2 id='system_set_rate'>Set Infusion Rate Inputs</h2><span id='topic+system_set_rate'></span>

<h3>Description</h3>

<p>Defines infusion rates specified in the system file using  <code>&lt;R:?&gt;</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_set_rate(cfg, rate, times, levels)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_set_rate_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_set_rate_+3A_rate">rate</code></td>
<td>
<p>name of infusion rate</p>
</td></tr>
<tr><td><code id="system_set_rate_+3A_times">times</code></td>
<td>
<p>list of time values</p>
</td></tr>
<tr><td><code id="system_set_rate_+3A_levels">levels</code></td>
<td>
<p>corresponding list of infusion values</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Ubiquity system object with the infusion rate set
</p>


<h3>See Also</h3>

<p><code><a href="#topic+system_zero_inputs">system_zero_inputs</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Creating a system file from the mab_pk example
fr = system_new(file_name        = "system.txt", 
                system_file      = "mab_pk", 
                overwrite        = TRUE, 
                output_directory = tempdir())

# Building the system 
cfg = build_system(system_file  = file.path(tempdir(), "system.txt"),
      output_directory          = file.path(tempdir(), "output"),
      temporary_directory       = tempdir())

# Clearing all inputs
cfg = system_zero_inputs(cfg)

# 5 minute infusion at 10 mg/min
cfg = system_set_rate(cfg,
           rate   = "Dinf",
           times  = c(0,  5), 
           levels = c(10, 0))

</code></pre>

<hr>
<h2 id='system_set_rpt_officer_object'>Sets the officer Object for the Specified ubiquity Report</h2><span id='topic+system_set_rpt_officer_object'></span>

<h3>Description</h3>

<p>This will replace the officer object in the ubiqiuty system
object for the specified report name with the value supplied.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_set_rpt_officer_object(cfg, rpt = NULL, rptname = "default")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_set_rpt_officer_object_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_set_rpt_officer_object_+3A_rpt">rpt</code></td>
<td>
<p>officer report object</p>
</td></tr>
<tr><td><code id="system_set_rpt_officer_object_+3A_rptname">rptname</code></td>
<td>
<p>ubiquity report name</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ubiquity system object with the replaced officer object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+system_fetch_rpt_officer_object">system_fetch_rpt_officer_object</a></code>
</p>

<hr>
<h2 id='system_set_rpt_onbrand_object'>Sets the onbrand Object for the Specified ubiquity Report</h2><span id='topic+system_set_rpt_onbrand_object'></span>

<h3>Description</h3>

<p>This will reset the onbrand object in the ubiqiuty system
object for the specified report name.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_set_rpt_onbrand_object(cfg, obnd = NULL, rptname = "default")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_set_rpt_onbrand_object_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_set_rpt_onbrand_object_+3A_obnd">obnd</code></td>
<td>
<p>onbrand report object</p>
</td></tr>
<tr><td><code id="system_set_rpt_onbrand_object_+3A_rptname">rptname</code></td>
<td>
<p>ubiquity report name</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ubiquity system object with onbrand report set
</p>


<h3>See Also</h3>

<p><code><a href="#topic+system_fetch_rpt_onbrand_object">system_fetch_rpt_onbrand_object</a></code>
</p>

<hr>
<h2 id='system_set_tt_bolus'>Actual Function Called by <code>SI_TT_BOLUS</code></h2><span id='topic+system_set_tt_bolus'></span>

<h3>Description</h3>

<p>The prototype function <code>SI_TT_BOLUS</code> provides an interface to this function. Based on the input from <code>SI_TT_BOLUS</code>
bolus inputs will be updated for the current titration time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_set_tt_bolus(
  cfg,
  state,
  values,
  times,
  tt_ts,
  tsinfo,
  repdose = "none",
  interval = 1,
  number = 0
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_set_tt_bolus_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_set_tt_bolus_+3A_state">state</code></td>
<td>
<p>dosing state/compartment (Defined in <code>&lt;B:events&gt;</code>)</p>
</td></tr>
<tr><td><code id="system_set_tt_bolus_+3A_values">values</code></td>
<td>
<p>vector of dosing amounts (in dosing units defined by <code>&lt;B:events&gt;</code>)</p>
</td></tr>
<tr><td><code id="system_set_tt_bolus_+3A_times">times</code></td>
<td>
<p>vector of dosing times relative to the current titration time (in # time units defiend by <code>&lt;B:times&gt;</code>)</p>
</td></tr>
<tr><td><code id="system_set_tt_bolus_+3A_tt_ts">tt_ts</code></td>
<td>
<p>list of timescale values for the current titration time</p>
</td></tr>
<tr><td><code id="system_set_tt_bolus_+3A_tsinfo">tsinfo</code></td>
<td>
<p>list with timescale information for inputs (bolus, rates, etc)</p>
</td></tr>
<tr><td><code id="system_set_tt_bolus_+3A_repdose">repdose</code></td>
<td>
<p><code>"none"</code>, <code>"last"</code>, <code>"all"</code></p>
</td></tr>
<tr><td><code id="system_set_tt_bolus_+3A_interval">interval</code></td>
<td>
<p>interval to repeat in the units defined in <code>&lt;B:times&gt;</code></p>
</td></tr>
<tr><td><code id="system_set_tt_bolus_+3A_number">number</code></td>
<td>
<p>number of times to repeat</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ubiquity system object with the bolus dosing updated.
</p>

<hr>
<h2 id='system_set_tt_cond'>Define Titration Triggers and Actions</h2><span id='topic+system_set_tt_cond'></span>

<h3>Description</h3>

<p>Once a rule has been defined using
<code><a href="#topic+system_new_tt_rule">system_new_tt_rule</a></code>, it can then be used by specifying checks at
each of the titration time points that, when true, will perform some actions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_set_tt_cond(cfg, name, cond, action, value = "-1")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_set_tt_cond_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_set_tt_cond_+3A_name">name</code></td>
<td>
<p>string containing the name for the titration rule to which this condition applies</p>
</td></tr>
<tr><td><code id="system_set_tt_cond_+3A_cond">cond</code></td>
<td>
<p>string that evaluates a boolean value that is <code>TRUE</code> when the action should be triggered</p>
</td></tr>
<tr><td><code id="system_set_tt_cond_+3A_action">action</code></td>
<td>
<p>stringing that evaluates to what should be done when the condition is met (e.g. changing the dose, state change, etc)</p>
</td></tr>
<tr><td><code id="system_set_tt_cond_+3A_value">value</code></td>
<td>
<p>code to be stored in the titration history to track when this condition has been triggered</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The general syntax for setting a new condition is:
</p>
<pre>
cfg = system_new_tt_cond(cfg,
                        name   = "rname",
                        cond   = "BOOLEAN EXPRESSION",
                        action = "EXPRESSION",
                        value  = "VALUE")
</pre>
<p>The <code>name</code>
input will associate this condition with a previously defined rule. For each
time defined when the rule was created, the condition (<code>cond</code>) will be
evaluated. If that condition evaluates as <code>TRUE</code> then the <code>action</code> will be
evaluated. Lastly, when a condition action is evaluated, the <code>value</code> is stored
in the titration history.
</p>
<p>Multiple conditions can be associated with a rule. The internal titration
history will track each one where a condition has been evaluated as true, but
the simulation output will only show the <b>last</b> condition to be evaluated as
true.
</p>
<p>The <code>cond</code> field is a string that, when evaluated, will produce a boolean value
(<code>TRUE</code> or <code>FALSE</code>). If you simply want to force an action at each of the times
for a given rule you can use: <code>cond = "TRUE"</code>. Alternatively you can provide
mathematical expressions or even complicated user defined functions.
</p>
<p>The <code>action</code> field is evaluated when <code>cond</code> is true. To modify how a simulation
is going to be performed, you will want to modify the <code>SIMINT_cfgtt</code>
variable using the different system commands. Certain common tasks have
prototype functions created to make it easier for the user:
</p>

<ul>
<li> <p><code>SI_TT_BOLUS</code> - Set bolus dosing
</p>
</li>
<li> <p><code>SI_TT_RATE</code> - Set infusion inputs
</p>
</li>
<li> <p><code>SI_TT_STATE</code> - Reset system states
</p>
</li></ul>

<p><b>Note:</b> Protype functions are strings but sometimes it is necessary to
specify strings within this string. For the main string use double quotes (&quot;)
and for the internal strings use single quotes (')
</p>
<p><b><code>SI_TT_BOLUS</code></b>
</p>
<p>The simplest way to apply a bolus when the condition is true is to use the following:
</p>
<pre>
action = "SI_TT_BOLUS[state=At, 
                     values=c(10, 10, 10), 
                     times=c(0, 1, 2)]"
</pre>
<p>The <code>values</code> and <code>times</code> are vectors of numbers of equal length. The dosing and
time units are those specified in the <code>system.txt</code> file for the <code>&lt;B:?&gt;</code> delimiter. The
times are relative to the titration time. So <code>0</code> above means at the titration time.
</p>
<p>Its possible to specify an interval and a number of times to repeat the last dose
using the following:
</p>
<pre>
action = "SI_TT_BOLUS[state    = At, 
                     values   = c(5, 5, 10), 
                     times    = c(0, 2, 4), 
                     repdose  = last, 
                     number   = 7, 
                     interval = 4]"
</pre>
<p>This will give a dose of <code>5</code> at the titration point and <code>2</code> time units later. The dose of <code>10</code>
at time <code>4</code> will be repeated <code>7</code> times every <code>4</code> time units. So a total of 8 (<code>7 + 1</code>) doses
at <code>10</code> will be administered. Remember the time units were those defined in <code>&lt;B:?&gt;</code>.
The input <code>repdose</code> can be either <code>last</code> or <code>none</code>.
</p>
<p><b>Note:</b> The main string is in double quotes <code>" "</code> but the strings in the protype
argument (e.g. <code>last</code>) are in single quotes <code> </code>.
</p>
<p><b><code>SI_TT_RATE</code></b> 
</p>
<p>If you created an infusion named <code>Dinf</code> using <code>&lt;R:?&gt;</code> and the infusion units
are min (times) and mg/min (rates). To have a 60 minute infusion of 20
mg/min then we would do the following:
</p>
<pre>
action = "SI_TT_RATE[rate=Dinf, times=c(0, 60), levels=c(20.0, 0)]"
</pre>
<p>If we wanted to do this every day for 9 more days (a total of 10 days) we can repeat
the sequence:
</p>
<pre>
action = "SI_TT_RATE[rate     = Dinf, 
                    times    = c(0, 60), 
                    levels   = c(20, 0), 
                    repdose  = sequence, 
                    number   = 9, 
                    interval = 24*60]"
</pre>
<p>The input <code>repdose</code> can be either <code>sequence</code> or <code>none</code>.
</p>
<p><b>Note:</b> The time units and dosing rate are those specified using <code>&lt;R:?&gt;</code>.
</p>
<p><b><code>SI_TT_STATE</code></b> 
</p>
<p>To provide fine control over states at titration points the state reset
prototype is provided. For example, if you are modeling an assay where
there is a wash step and you want to drop a concentration to zero. If you
have a state named <code>Cc</code> defined in your <code>system.txt</code> and you want to set
it to <code>0.0</code> in a condition the following action would work.
</p>
<pre>
action = "SI_TT_STATE[Cc][0.0]"
</pre>
<p>The value here is a number but you can use any mathematical
combination of variables available in the titration environment. Also you
can create your own user function and place the function call within the
brackets above.
</p>
<p><b>Titration Environment</b>
</p>
<p>The <code>cond</code>, <code>action</code>, and <code>value</code> statements can use any variables available in
the titration environment. If you want to perform complicated actions, you can
simply create a user defined functions and pass it the variables from the
titration environment that you need. These include named variables from the
model as well as internal variables used to control the titration.
</p>
<p><b>States and Parameters</b>
</p>
<p>System parameters (<code>&lt;P&gt;</code>), static secondary parameters (<code>&lt;As&gt;</code>) and 
the initial value of covariates are available. Also the state values 
(at the current titration time) can be used. These are all available as 
the names specified in the <code>system.txt</code> file. Since system resets
(<code>SI_TT_STATE</code>) are processed first, any changes made to states are 
the values that are active for other actions.
</p>
<p><b>Internal Simulation Variables</b>
</p>
<p>Internal variables are used to control titration activities. These variables can also be used in the conditions and actions.
</p>

<ul>
<li> <p><code>SIMINT_p</code> - list of system parameters
</p>
</li>
<li> <p><code>SIMINT_cfg</code> - system configuration sent into the titration routine
</p>
</li>
<li> <p><code>SIMINT_cfgtt</code>- system configuration at the current titration event time
</p>
</li>
<li> <p><code>SIMINT_ttimes</code> - vector of titration times (in simulation units)
</p>
</li>
<li> <p><code>SIMINT_ttime</code> - current titration time  (in simulation units)
</p>
</li>
<li> <p><code>SIMINT_tt_ts</code> - list of time scales for the current titration
</p>
</li>
<li> <p><code>SIMINT_history</code> - data frame tracking the history of conditions that evaluated true with the following structure:
</p>
</li>
<li> 
<ul>
<li> <p><code>tname</code> - name of titration rule
</p>
</li>
<li> <p><code>value</code> - value indicating condition that was satisfied
</p>
</li>
<li> <p><code>simtime</code> - simulation time when that rule/value were triggered
</p>
</li>
<li> <p><code>timescale</code> -  time at the rule timescale when that rule/value were triggered
</p>
</li></ul>

</li></ul>

<p><b>Individual Simulations</b>
</p>
<p>To run an individual titration simulation use the following:
</p>
<pre>
som = run_simulation_titrate(parameters, cfg)
</pre>
<p>This provides the same output as <code><a href="#topic+run_simulation_ubiquity">run_simulation_ubiquity</a></code> with
two extra fields. The first, <code>som$titration</code>, contains three columns for each
titration rule. The columns will have a length equal and corresponding to the
simulation times. If the rule name is rname, then the column headers will have
the following names and meanings:
</p>

<ul>
<li> <p><code>tt.rname.value</code> - Value of the rule for the active condition or -1 if not triggered
</p>
</li>
<li> <p><code>tt.rname.simtime</code> - Simulation time where the last condition became active
</p>
</li>
<li> <p><code>tt.rname.timescale</code> - Simulation time in the time scale the rule was specified in
</p>
</li></ul>

<p>The second field is <code>som$titration_history</code> which contains a summary list of all of the titration events that were triggered.
</p>

<ul>
<li> <p><code>tname</code> - Titration rule name
</p>
</li>
<li> <p><code>value</code> - Value of the rule for the active condition or -1 if not triggered   
</p>
</li>
<li> <p><code>simtime</code> - Simulation time where the last condition became active
</p>
</li>
<li> <p><code>timescale</code> - Simulation time in the time scale the rule was specified in
</p>
</li></ul>

<p>To convert this structured list into a data frame the <code><a href="#topic+som_to_df">som_to_df</a></code> command can be used:
</p>
<pre>
sdf = som_to_df(cfg, som)
</pre>
<p>To run stochastic titration simulations, the same function is used:
</p>
<pre>
som = simulate_subjects(parameters, cfg)
</pre>
<p>This will add a data a list element called <code>som$titration</code> with three
fields for each titration rule:
</p>

<ul>
<li> <p><code>tt.rname.value</code> - Value of the rule for the active condition or -1 if not triggered
</p>
</li>
<li> <p><code>tt.rname.simtime</code> - Simulation time where the last condition became active
</p>
</li>
<li> <p><code>tt.rname.timescale</code> - Simulation time in the time scale the rule was specified in
</p>
</li></ul>
 
<p>Each of these fields is a matrix with an entry for each simulation time
(column) and each subject (row). This data structure can also be converted to
a data frame using <code>som_to_df</code>.
</p>


<h3>Value</h3>

<p>Ubiquity system object with the titration condition defined
</p>


<h3>See Also</h3>

<p><code><a href="#topic+system_new_tt_rule">system_new_tt_rule</a></code>, <code><a href="#topic+run_simulation_titrate">run_simulation_titrate</a></code>,  <code><a href="#topic+som_to_df">som_to_df</a></code>, <code><a href="#topic+simulate_subjects">simulate_subjects</a></code>
</p>

<hr>
<h2 id='system_set_tt_rate'>Actual Function Called by <code>SI_TT_RATE</code></h2><span id='topic+system_set_tt_rate'></span>

<h3>Description</h3>

<p>The prototype function <code>SI_TT_RATE</code> provides an abstract interface to this function. Based on the input from <code>SI_TT_RATE</code>
infusion rate inputs will be updated for the current titration time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_set_tt_rate(
  cfg,
  rate,
  times,
  levels,
  tt_ts,
  tsinfo,
  repdose = "none",
  interval = 1,
  number = 0
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_set_tt_rate_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_set_tt_rate_+3A_rate">rate</code></td>
<td>
<p>name of the infusion rate to update(Defined in <code>&lt;R:?&gt;</code>)</p>
</td></tr>
<tr><td><code id="system_set_tt_rate_+3A_times">times</code></td>
<td>
<p>vector of switching times relative to the current titration time (in time units defined by <code>&lt;R:?&gt;</code>)</p>
</td></tr>
<tr><td><code id="system_set_tt_rate_+3A_levels">levels</code></td>
<td>
<p>vector of infusion rates (in dosing units defined by <code>&lt;R:?&gt;</code>)</p>
</td></tr>
<tr><td><code id="system_set_tt_rate_+3A_tt_ts">tt_ts</code></td>
<td>
<p>list of timescale values for the current titration time</p>
</td></tr>
<tr><td><code id="system_set_tt_rate_+3A_tsinfo">tsinfo</code></td>
<td>
<p>list with timescale information for inputs (bolus, rates, etc)</p>
</td></tr>
<tr><td><code id="system_set_tt_rate_+3A_repdose">repdose</code></td>
<td>
<p><code>"none"</code> or <code>"sequence"</code></p>
</td></tr>
<tr><td><code id="system_set_tt_rate_+3A_interval">interval</code></td>
<td>
<p>interval to repeat in the units defined in <code>&lt;R:?&gt;</code></p>
</td></tr>
<tr><td><code id="system_set_tt_rate_+3A_number">number</code></td>
<td>
<p>number of times to repeat</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ubiquity system object with the infusion rates updated.
</p>

<hr>
<h2 id='system_simulate_estimation_results'>Simulate Results at Estimates</h2><span id='topic+system_simulate_estimation_results'></span>

<h3>Description</h3>

<p>Simulates the system at the parameter estimates <code>pest</code> for creating diagnostic plots
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_simulate_estimation_results(pest, cfg, details = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_simulate_estimation_results_+3A_pest">pest</code></td>
<td>
<p>vector of parameters</p>
</td></tr>
<tr><td><code id="system_simulate_estimation_results_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_simulate_estimation_results_+3A_details">details</code></td>
<td>
<p>set <code>TRUE</code> to display information about cohorts as they are simulated (useful for debugging)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>observations in a list, see <code><a href="#topic+system_od_general">system_od_general</a></code> when <code>estimation=FALSE</code>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+system_define_cohort">system_define_cohort</a></code>, <code><a href="#topic+system_plot_cohorts">system_plot_cohorts</a></code>
and the vignette on parameter estimation (<code>vignette("Estimation", package = "ubiquity")</code>)
</p>

<hr>
<h2 id='system_ts_to_simtime'>Convert Time in Timescale to Simulation Time</h2><span id='topic+system_ts_to_simtime'></span>

<h3>Description</h3>

<p>converts a time specified in a defined timescale (say weeks) to the
timescale of the simulation (say hours if the rates are in 1/hr units)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_ts_to_simtime(cfg, tstime, ts)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_ts_to_simtime_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_ts_to_simtime_+3A_tstime">tstime</code></td>
<td>
<p>numeric time of the timescale</p>
</td></tr>
<tr><td><code id="system_ts_to_simtime_+3A_ts">ts</code></td>
<td>
<p>string containing the timescale</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>tstime</code> in the system timescale units
</p>

<hr>
<h2 id='system_view'>View Information About the System</h2><span id='topic+system_view'></span>

<h3>Description</h3>

<p>Displays information (dosing, simulation options, covariates,
etc) about the system.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_view(cfg, field = "all", verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_view_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_view_+3A_field">field</code></td>
<td>
<p>string indicating the aspect of the system to display</p>
</td></tr>
<tr><td><code id="system_view_+3A_verbose">verbose</code></td>
<td>
<p>Boolean variable that when set to true will echo the information to the screen</p>
</td></tr>
</table>


<h3>Value</h3>

<p>sequence of strings with system in formation (one line per element)
</p>
<p>The <code>field</code> 
</p>

<ul>
<li> <p><code>"all"</code> will show all information about the system
</p>
</li>
<li> <p><code>"parameters"</code> summary of parameter information
</p>
</li>
<li> <p><code>"bolus"</code> currently set bolus dosing
</p>
</li>
<li> <p><code>"rate"</code> infusion rate dosing 
</p>
</li>
<li> <p><code>"covariate"</code> covariates
</p>
</li>
<li> <p><code>"iiv"</code> variance/covariance information
</p>
</li>
<li> <p><code>"datasets"</code> loaded datasets
</p>
</li>
<li> <p><code>"simulation"</code> simulation options
</p>
</li>
<li> <p><code>"estimation"</code> estimation options
</p>
</li>
<li> <p><code>"nca"</code> non-compartmental analyses that have been performed
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># To log and display the current system information:

# Creating a system file from the mab_pk example
fr = system_new(file_name        = "system.txt", 
                system_file      = "mab_pk", 
                overwrite        = TRUE, 
                output_directory = tempdir())

# Building the system 
cfg = build_system(system_file  = file.path(tempdir(), "system.txt"),
      output_directory          = file.path(tempdir(), "output"),
      temporary_directory       = tempdir())

  msgs = system_view(cfg, verbose=TRUE)

</code></pre>

<hr>
<h2 id='system_zero_inputs'>Zero All Model Inputs</h2><span id='topic+system_zero_inputs'></span>

<h3>Description</h3>

<p>Multiple default inputs can be specified in the system file. At
the scripting level this function can be used to set all inputs to zero.
Then only the subsequently specified inputs will be applied.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_zero_inputs(cfg, bolus = TRUE, rates = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="system_zero_inputs_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="system_zero_inputs_+3A_bolus">bolus</code></td>
<td>
<p>Boolean value indicating weather bolus inputs should be set to zero</p>
</td></tr>
<tr><td><code id="system_zero_inputs_+3A_rates">rates</code></td>
<td>
<p>Boolean value indicating weather infusion rate inputs should be set to zero</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Ubiquity system object with the specified inputs set to zero
</p>


<h3>See Also</h3>

<p><code><a href="#topic+system_set_rate">system_set_rate</a></code>, <code><a href="#topic+system_set_bolus">system_set_bolus</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Creating a system file from the mab_pk example
fr = system_new(file_name        = "system.txt", 
                system_file      = "mab_pk", 
                overwrite        = TRUE, 
                output_directory = tempdir())

# Building the system 
cfg = build_system(system_file  = file.path(tempdir(), "system.txt"),
      output_directory          = file.path(tempdir(), "output"),
      temporary_directory       = tempdir())

# Clear only infusion rates
cfg = system_zero_inputs(cfg, bolus=TRUE, rates=FALSE)

# Clear all inputs:
cfg = system_zero_inputs(cfg)

</code></pre>

<hr>
<h2 id='tic'>Implementation of Matlab <code>tic()</code> command</h2><span id='topic+tic'></span>

<h3>Description</h3>

<p>Used in conjunction with <code>toc()</code> to find the elapsed time
when code is executed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tic(type = c("elapsed", "user.self", "sys.self"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tic_+3A_type">type</code></td>
<td>
<p>can be either <code>"elapsed"</code> <code>"user.self"</code> or <code>"sys.self"</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>time tic was called
</p>


<h3>See Also</h3>

<p><code><a href="#topic+toc">toc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>tic()
Sys.sleep(3)
toc()
</code></pre>

<hr>
<h2 id='timecourse_stats'>Calculate Timecourse Statistics for a Matrix of Responses</h2><span id='topic+timecourse_stats'></span>

<h3>Description</h3>

<p>Given a matrix (d) of time courses (each row is an individual and each column is
a time point) and a confidence interval (ci) this will calculate the mean,
median, confidence intervals and a vector of values for creating patches.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>timecourse_stats(d, ci)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="timecourse_stats_+3A_d">d</code></td>
<td>
<p>matrix of responses (each row an individual and each column a time point)</p>
</td></tr>
<tr><td><code id="timecourse_stats_+3A_ci">ci</code></td>
<td>
<p>confidence interval in percent (eg, 95)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with the following elements:
</p>

<ul>
<li> <p><code>stats$ub_ci</code>  vector of confidence interval upper bound 
</p>
</li>
<li> <p><code>stats$lb_ci</code>  vector of confidence interval lower bound 
</p>
</li>
<li> <p><code>stats$mean</code>   vector of mean values
</p>
</li>
<li> <p><code>stats$median</code> vector of median values
</p>
</li></ul>


<hr>
<h2 id='toc'>Implementation of Matlab <code>toc()</code> command</h2><span id='topic+toc'></span>

<h3>Description</h3>

<p>Used in conjunction with <code>tic()</code> to find the elapsed time
when code is executed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>toc()
</code></pre>


<h3>Value</h3>

<p>time in seconds since tic() was called
</p>


<h3>See Also</h3>

<p><code><a href="#topic+tic">tic</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>tic()
Sys.sleep(3)
toc()
</code></pre>

<hr>
<h2 id='ubiquity_name_check'>Check Names of Cohorts, Analyses, Reports, etc.</h2><span id='topic+ubiquity_name_check'></span>

<h3>Description</h3>

<p>Checks names specified for different analysis aspects (cohorts,
analyses, reports, etc.) to make sure that they start with a letter and
contain only letters, numbers and _
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ubiquity_name_check(test_name)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ubiquity_name_check_+3A_test_name">test_name</code></td>
<td>
<p>string containing the name to be tested</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with Boolean element <code>isgood</code> that is <code>TRUE</code> when the name tests correct, <code>FALSE</code> when it fails. The element <code>msgs</code> contains a verbose message on why it fails.
</p>

<hr>
<h2 id='var2string'>Converts Numeric Variables into Padded Strings</h2><span id='topic+var2string'></span>

<h3>Description</h3>

<p>Mechanism for converting numeric variables into strings for reporting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>var2string(vars, maxlength = 0, nsig_e = 3, nsig_f = 4)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="var2string_+3A_vars">vars</code></td>
<td>
<p>numeric variable or a vector of numeric variables</p>
</td></tr>
<tr><td><code id="var2string_+3A_maxlength">maxlength</code></td>
<td>
<p>if this value is greater than zero spaces will be added to the beginning of the string until the total length is equal to maxlength</p>
</td></tr>
<tr><td><code id="var2string_+3A_nsig_e">nsig_e</code></td>
<td>
<p>number of significant figures for scientific notation</p>
</td></tr>
<tr><td><code id="var2string_+3A_nsig_f">nsig_f</code></td>
<td>
<p>number of significant figures for numbers (2.123)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Number as a string padded
</p>


<h3>Examples</h3>

<pre><code class='language-R'>var2string(pi, nsig_f=20)
var2string(.0001121, nsig_e=2, maxlength=10)
</code></pre>

<hr>
<h2 id='var2string_gen'>Convert R Objects to Strings</h2><span id='topic+var2string_gen'></span>

<h3>Description</h3>

<p>Mechanism for converting R objects strings for reporting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>var2string_gen(var)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="var2string_gen_+3A_var">var</code></td>
<td>
<p>R variable</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Variable in string form
</p>


<h3>Examples</h3>

<pre><code class='language-R'>var2string_gen(c(1,2,3))
</code></pre>

<hr>
<h2 id='vp'>Print and Log Messages</h2><span id='topic+vp'></span>

<h3>Description</h3>

<p>Used to print messages to the screen and the log file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vp(cfg, str, fmt = "alert")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vp_+3A_cfg">cfg</code></td>
<td>
<p>ubiquity system object</p>
</td></tr>
<tr><td><code id="vp_+3A_str">str</code></td>
<td>
<p>sequence of strings to print</p>
</td></tr>
<tr><td><code id="vp_+3A_fmt">fmt</code></td>
<td>
<p>string format should be one of the following: <code>"h1"</code>,
<code>"h2"</code>, <code>"h3"</code>, <code>"verbatim"</code>, <code>"alert"</code> (default), <code>"warning"</code>,
<code>"danger"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Boolean variable indicating success (<code>TRUE</code>) or failure (<code>FALSE</code>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Creating a system file from the mab_pk example
fr = system_new(file_name        = "system.txt", 
                system_file      = "mab_pk", 
                overwrite        = TRUE, 
                output_directory = tempdir())

# Building the system 
cfg = build_system(system_file  = file.path(tempdir(), "system.txt"),
      output_directory          = file.path(tempdir(), "output"),
      temporary_directory       = tempdir())

# Initialzing the log file
vp(cfg, "Message that will be logged")

</code></pre>

<hr>
<h2 id='workshop_fetch'>Fetch Ubiquity Workshop Sections</h2><span id='topic+workshop_fetch'></span>

<h3>Description</h3>

<p>With the ubiquity package this function can be used to fetch
example files for different sections of the workshop.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>workshop_fetch(
  section = "Simulation",
  overwrite = FALSE,
  copy_files = TRUE,
  output_directory = getwd()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="workshop_fetch_+3A_section">section</code></td>
<td>
<p>Name of the section of workshop to retrieve  (&quot;Simulation&quot;)</p>
</td></tr>
<tr><td><code id="workshop_fetch_+3A_overwrite">overwrite</code></td>
<td>
<p>if <code>TRUE</code> the new workshop files will overwrite any existing files present (<code>FALSE</code>)</p>
</td></tr>
<tr><td><code id="workshop_fetch_+3A_copy_files">copy_files</code></td>
<td>
<p>if <code>TRUE</code> the files will be written to the output_directory, if <code>FALSE</code> only the names and locations of the files will be returned (<code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="workshop_fetch_+3A_output_directory">output_directory</code></td>
<td>
<p>directory where workshop files will be placed (getwd())</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Valid sections are &quot;Simulation&quot;, &quot;Estimation&quot;, &quot;Titration&quot; &quot;Reporting&quot;, and &quot;NCA&quot;
</p>


<h3>Value</h3>

<p>list
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
workshop_fetch("Estimation", output_directory=tempdir(), overwrite=TRUE)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
