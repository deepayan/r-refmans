<!DOCTYPE html><html lang="en"><head><title>Help for package PCMBaseCpp</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {PCMBaseCpp}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#benchmarkData'><p>Data for performing a benchmark</p></a></li>
<li><a href='#benchmarkResults'><p>Results from running a performance benchmark on a personal computer</p>
including the time for parameter transformation</a></li>
<li><a href='#benchmarkResultsNoTransform'><p>Results from running a performance benchmark on a personal computer</p>
excluding the time for parameter transformation</a></li>
<li><a href='#BenchmarkRvsCpp'><p>A log-likelihood calculation time comparison for different numbers of traits</p>
and option-sets</a></li>
<li><a href='#MiniBenchmarkRvsCpp'><p>Evaluate the likelihood calculation times for example trees and data</p></a></li>
<li><a href='#PCListInt'><p>Converts the logical matrix pc into a list of vectors denoting the (0-based) TRUE-indices in</p>
each column</a></li>
<li><a href='#PCMBaseCppIsADevRelease'><p>Check if the PCMBaseCpp version correpsonds to a dev release</p></a></li>
<li><a href='#PCMInfoCpp'><p>A S3 generic for creating C++ backend objects given a model, data and</p>
a tree.</a></li>
<li><a href='#PCMParamGetFullVector'><p>Get a vector with all model parameters unrolled</p></a></li>
<li><a href='#PCMTreePreorderCpp'><p>Fast preorder of the edges in a tree</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Fast Likelihood Calculation for Phylogenetic Comparative Models</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.9</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Venelin Mitov &lt;vmitov@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides a C++ backend for multivariate phylogenetic comparative
  models implemented in the R-package 'PCMBase'. Can be used in combination
  with 'PCMBase' to enable fast and parallel likelihood calculation. Implements
  the pruning likelihood calculation algorithm described in Mitov et al. (2018) 
  &lt;<a href="https://doi.org/10.48550/arXiv.1809.09014">doi:10.48550/arXiv.1809.09014</a>&gt;. Uses the 'SPLITT' C++ library for parallel tree traversal 
  described in Mitov and Stadler (2018) &lt;<a href="https://doi.org/10.1111%2F2041-210X.13136">doi:10.1111/2041-210X.13136</a>&gt;.</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3.0)</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1.0), Rcpp, methods</td>
</tr>
<tr>
<td>Imports:</td>
<td>PCMBase, data.table, abind</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, knitr, rmarkdown, covr</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.1.1</td>
</tr>
<tr>
<td>ByteCompile:</td>
<td>yes</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/venelin/PCMBaseCpp">https://github.com/venelin/PCMBaseCpp</a>, <a href="https://venelin.github.io">https://venelin.github.io</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/venelin/PCMBaseCpp/issues">https://github.com/venelin/PCMBaseCpp/issues</a></td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-03-22 23:20:25 UTC; vmitov</td>
</tr>
<tr>
<td>Author:</td>
<td>Venelin Mitov [aut, cre, cph] (&lt;a
    href="https://venelin.github.io"&gt;venelin.github.io&lt;/a&gt;)</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-03-23 00:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='benchmarkData'>Data for performing a benchmark</h2><span id='topic+benchmarkData'></span>

<h3>Description</h3>

<p>A dataset containing three triplets trees, trait-values and models to
evaluate the likelihood calculation times for R and C++ implementations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>benchmarkData
</code></pre>


<h3>Format</h3>

<p>A data frame with 4 rows and 8 variables:
</p>

<dl>
<dt>tree</dt><dd><p>phylogenetic tree (phylo) with set edge.regimes member</p>
</dd>
<dt>model</dt><dd><p>MGPM model used to simulate the data in X</p>
</dd>
<dt>X</dt><dd><p>trait values</p>
</dd>
<dt>ll</dt><dd><p>log-likelihood value</p>
</dd>
<dt>modelBM</dt><dd><p>a random BM model</p>
</dd>
<dt>llBM</dt><dd><p>log-likelihood value form modelBM</p>
</dd>
<dt>modelOU</dt><dd><p>a random OU model</p>
</dd>
<dt>llOU</dt><dd><p>log-likelihood value for modelOU</p>
</dd>
</dl>

<hr>
<h2 id='benchmarkResults'>Results from running a performance benchmark on a personal computer 
including the time for parameter transformation</h2><span id='topic+benchmarkResults'></span>

<h3>Description</h3>

<p>Results from running a performance benchmark on a personal computer 
including the time for parameter transformation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>benchmarkResults
</code></pre>


<h3>Format</h3>

<p>A data.table</p>

<hr>
<h2 id='benchmarkResultsNoTransform'>Results from running a performance benchmark on a personal computer 
excluding the time for parameter transformation</h2><span id='topic+benchmarkResultsNoTransform'></span>

<h3>Description</h3>

<p>Results from running a performance benchmark on a personal computer 
excluding the time for parameter transformation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>benchmarkResultsNoTransform
</code></pre>


<h3>Format</h3>

<p>A data.table</p>

<hr>
<h2 id='BenchmarkRvsCpp'>A log-likelihood calculation time comparison for different numbers of traits 
and option-sets</h2><span id='topic+BenchmarkRvsCpp'></span>

<h3>Description</h3>

<p>A log-likelihood calculation time comparison for different numbers of traits 
and option-sets
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BenchmarkRvsCpp(ks = c(1, 2, 4, 8), includeR = TRUE,
  includeTransformationTime = TRUE, optionSets = NULL,
  includeParallelMode = TRUE, doProf = FALSE,
  RprofR.out = "RprofR.out", RprofCpp.out = "RprofCpp.out",
  verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="BenchmarkRvsCpp_+3A_ks">ks</code></td>
<td>
<p>a vector of positive integers, denoting different numbers of traits. 
Default: <code>c(1, 2, 4, 8)</code>.</p>
</td></tr>
<tr><td><code id="BenchmarkRvsCpp_+3A_includer">includeR</code></td>
<td>
<p>logical (default TRUE) indicating if likelihood calculations
in R should be included in the benchmark (can be slow).</p>
</td></tr>
<tr><td><code id="BenchmarkRvsCpp_+3A_includetransformationtime">includeTransformationTime</code></td>
<td>
<p>logical (default TRUE) indicating if the time for
<code><a href="PCMBase.html#topic+PCMApplyTransformation">PCMApplyTransformation</a></code> should be included in the benchmark.</p>
</td></tr>
<tr><td><code id="BenchmarkRvsCpp_+3A_optionsets">optionSets</code></td>
<td>
<p>a named list of lists of PCM-options. If NULL (the default) 
the option set is set to <code>DefaultBenchmarkOptions(k, includeParallelMode)</code>
for each <code>k</code> in <code>ks</code> (see the code in 
<code>PCMBaseCpp:::DefaultBenchmarkOptions</code>).</p>
</td></tr>
<tr><td><code id="BenchmarkRvsCpp_+3A_includeparallelmode">includeParallelMode</code></td>
<td>
<p>logical (default TRUE) indicating if the default 
optionSet should include parallel execution modes, i.e. setting the option 
PCMBase.Lmr.mode to 21 instead of 11. This argument is taken into account 
only with the argument <code>optionSets</code> set to NULL (the default).</p>
</td></tr>
<tr><td><code id="BenchmarkRvsCpp_+3A_doprof">doProf</code></td>
<td>
<p>logical indicating if profiling should be activated (see Rprof
from the utils R-package). Default: FALSE. Additional arguments to Rprof can 
be specified by assigning lists of arguments to the options 'PCMBaseCpp.ArgsRprofR'
and 'PCMBaseCpp.ArgsRprofCpp'. The default values for both options is
<code>list(append = TRUE, line.profiling = TRUE)</code>.</p>
</td></tr>
<tr><td><code id="BenchmarkRvsCpp_+3A_rprofr.out">RprofR.out</code></td>
<td>
<p>character strings indicating Rprof.out files 
for the R and Cpp implementations; ignored if doProf is FALSE. Default values:
'RprofR.out' and 'Rprofcpp.out'.</p>
</td></tr>
<tr><td><code id="BenchmarkRvsCpp_+3A_rprofcpp.out">RprofCpp.out</code></td>
<td>
<p>character strings indicating Rprof.out files 
for the R and Cpp implementations; ignored if doProf is FALSE. Default values:
'RprofR.out' and 'Rprofcpp.out'.</p>
</td></tr>
<tr><td><code id="BenchmarkRvsCpp_+3A_verbose">verbose</code></td>
<td>
<p>logical indicating if log-messages should be printed to the console during the benchmark. Default FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data.table for results similar to the data.table returned from <code><a href="#topic+MiniBenchmarkRvsCpp">MiniBenchmarkRvsCpp</a></code> with 
additional columns for k, option-set and the type of model.
</p>

<hr>
<h2 id='MiniBenchmarkRvsCpp'>Evaluate the likelihood calculation times for example trees and data</h2><span id='topic+MiniBenchmarkRvsCpp'></span>

<h3>Description</h3>

<p>Evaluate the likelihood calculation times for example trees and data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MiniBenchmarkRvsCpp(data = PCMBaseCpp::benchmarkData, includeR = TRUE,
  includeTransformationTime = TRUE, nRepsCpp = 10L,
  listOptions = list(PCMBase.Lmr.mode = 11, PCMBase.Threshold.EV = 0,
  PCMBase.Threshold.SV = 0), doProf = FALSE, RprofR.out = "RprofR.out",
  RprofCpp.out = "RprofCpp.out")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="MiniBenchmarkRvsCpp_+3A_data">data</code></td>
<td>
<p>a 'data.frame' with at least the following columns: 
</p>

<ul>
<li><p>tree: a list column of phylo objects with an edge.part member set.
</p>
</li>
<li><p>X: a list column of k x N numerical matrices.
</p>
</li>
<li><p>model: a list column of PCM objects.
</p>
</li></ul>

<p>Defaults: to 'benchmarkData', which is small data.table included
with the PCMBaseCpp package.</p>
</td></tr>
<tr><td><code id="MiniBenchmarkRvsCpp_+3A_includer">includeR</code></td>
<td>
<p>logical (default TRUE) indicating if likelihood calculations
in R should be included in the benchmark (can be slow).</p>
</td></tr>
<tr><td><code id="MiniBenchmarkRvsCpp_+3A_includetransformationtime">includeTransformationTime</code></td>
<td>
<p>logical (default TRUE) indicating if the time for
<code><a href="PCMBase.html#topic+PCMApplyTransformation">PCMApplyTransformation</a></code> should be included in the benchmark.</p>
</td></tr>
<tr><td><code id="MiniBenchmarkRvsCpp_+3A_nrepscpp">nRepsCpp</code></td>
<td>
<p>: number of repetitions for the cpp likelihood calculation 
calls: a bigger value increases the precision of time estimation at the 
expense of longer running time for the benchmark. Defaults to 10.</p>
</td></tr>
<tr><td><code id="MiniBenchmarkRvsCpp_+3A_listoptions">listOptions</code></td>
<td>
<p>options to set before measuring the calculation times. 
Defaults to 'list(PCMBase.Lmr.mode = 11, PCMBase.Threshold.EV = 0, PCMBase.Threshold.SV = 0)'. 
'PCMBase.Lmr.mode' corresponds to the parallel traversal mode for the tree 
traversal algorithm (see 
<a href="https://venelin.github.io/SPLITT/articles/SPLITTTraversalModes.html">this page</a>
for possible values).</p>
</td></tr>
<tr><td><code id="MiniBenchmarkRvsCpp_+3A_doprof">doProf</code></td>
<td>
<p>logical indicating if profiling should be activated (see Rprof
from the utils R-package). Default: FALSE. Additional arguments to Rprof can 
be specified by assigning lists of arguments to the options 'PCMBaseCpp.ArgsRprofR'
and 'PCMBaseCpp.ArgsRprofCpp'. The default values for both options is
<code>list(append = TRUE, line.profiling = TRUE)</code>.</p>
</td></tr>
<tr><td><code id="MiniBenchmarkRvsCpp_+3A_rprofr.out">RprofR.out</code>, <code id="MiniBenchmarkRvsCpp_+3A_rprofcpp.out">RprofCpp.out</code></td>
<td>
<p>character strings indicating Rprof.out files 
for the R and Cpp implementations; ignored if doProf is FALSE. Default values:
'RprofR.out' and 'Rprofcpp.out'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data.frame.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(PCMBase)
library(PCMBaseCpp)
library(data.table)

testData &lt;- PCMBaseCpp::benchmarkData[1]
# original MGPM model
MiniBenchmarkRvsCpp(data = testData)

# original MGPM model and parallel mode
MiniBenchmarkRvsCpp(
data = testData,
listOptions = list(PCMBase.Lmr.mode = 21, PCMBase.Threshold.EV = 1e-9, 
PCMBase.Threshold.SV = 1e-9))

# single-trait data, original MGPM model and single mode and enabled option 
# PCMBase.Use1DClasses
MiniBenchmarkRvsCpp(
data = PCMBaseCpp::benchmarkData[1, list(
 tree, 
 X = lapply(X, function(x) x[1,, drop=FALSE]), 
 model = lapply(model, function(m) PCMExtractDimensions(m, dims = 1)))],
listOptions = list(
  PCMBase.Lmr.mode = 11, 
  PCMBase.Threshold.EV = 1e-9, 
  PCMBase.Threshold.SV = 1e-9,
  PCMBase.Use1DClasses = FALSE))

</code></pre>

<hr>
<h2 id='PCListInt'>Converts the logical matrix pc into a list of vectors denoting the (0-based) TRUE-indices in 
each column</h2><span id='topic+PCListInt'></span>

<h3>Description</h3>

<p>Converts the logical matrix pc into a list of vectors denoting the (0-based) TRUE-indices in 
each column
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PCListInt(pc)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PCListInt_+3A_pc">pc</code></td>
<td>
<p>a logical matrix.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list
</p>

<hr>
<h2 id='PCMBaseCppIsADevRelease'>Check if the PCMBaseCpp version correpsonds to a dev release</h2><span id='topic+PCMBaseCppIsADevRelease'></span>

<h3>Description</h3>

<p>This function is used during unit-testing, to disable some unit-
tests which run extremely long or are consistently failing on some systems.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PCMBaseCppIsADevRelease()
</code></pre>


<h3>Value</h3>

<p>a logical
</p>

<hr>
<h2 id='PCMInfoCpp'>A S3 generic for creating C++ backend objects given a model, data and 
a tree.</h2><span id='topic+PCMInfoCpp'></span>

<h3>Description</h3>

<p>Replace calls to PCMInfo() with this method in order to use C++
for likelihood calculation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PCMInfoCpp(X, tree, model, SE = matrix(0, PCMNumTraits(model),
  PCMTreeNumTips(tree)), metaI = PCMInfo(X = X, tree = tree, model =
  model, SE = SE, verbose = verbose, preorder = PCMTreePreorderCpp(tree)),
  verbose = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PCMInfoCpp_+3A_x">X</code></td>
<td>
<p>a <code>k x N</code> numerical matrix with possible <code>NA</code> and <code>NaN</code> entries. Each
column of X contains the measured trait values for one species (tip in tree).
Missing values can be either not-available (<code>NA</code>) or not existing (<code>NaN</code>).
These two values have are treated differently when calculating
likelihoods: see <code><a href="PCMBase.html#topic+PCMPresentCoordinates">PCMPresentCoordinates</a></code>.</p>
</td></tr>
<tr><td><code id="PCMInfoCpp_+3A_tree">tree</code></td>
<td>
<p>a phylo object with N tips.</p>
</td></tr>
<tr><td><code id="PCMInfoCpp_+3A_model">model</code></td>
<td>
<p>an S3 object specifying both, the model type (class, e.g. &quot;OU&quot;) as
well as the concrete model parameter values at which the likelihood is to be
calculated (see also Details).</p>
</td></tr>
<tr><td><code id="PCMInfoCpp_+3A_se">SE</code></td>
<td>
<p>a k x N matrix specifying the standard error for each measurement in 
X. Alternatively, a k x k x N cube specifying an upper triangular k x k 
Choleski factor of the variance covariance matrix for the measurement error 
for each node i=1, ..., N. 
Default: <code>matrix(0.0, PCMNumTraits(model), PCMTreeNumTips(tree))</code>.</p>
</td></tr>
<tr><td><code id="PCMInfoCpp_+3A_metai">metaI</code></td>
<td>
<p>a list returned from a call to <code>PCMInfo(X, tree, model, SE)</code>,
containing meta-data such as N, M and k. Default: 
<code>PCMInfo(X, tree, model, verbose, preorder=PCMTreePreorderCpp(tree))</code></p>
</td></tr>
<tr><td><code id="PCMInfoCpp_+3A_verbose">verbose</code></td>
<td>
<p>logical indicating if some debug-messages should be printed. 
Default: FALSE</p>
</td></tr>
<tr><td><code id="PCMInfoCpp_+3A_...">...</code></td>
<td>
<p>passed to methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list to be passed to PCMLik as argument metaI.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>metaICpp &lt;- PCMInfoCpp(
PCMBase::PCMBaseTestObjects$traits.a.123, 
PCMBase::PCMBaseTestObjects$tree.a,
PCMBase::PCMBaseTestObjects$model.a.123)
PCMBase::PCMLik(
PCMBase::PCMBaseTestObjects$traits.a.123, 
PCMBase::PCMBaseTestObjects$tree.a,
PCMBase::PCMBaseTestObjects$model.a.123,
metaI = metaICpp)
</code></pre>

<hr>
<h2 id='PCMParamGetFullVector'>Get a vector with all model parameters unrolled</h2><span id='topic+PCMParamGetFullVector'></span>

<h3>Description</h3>

<p>Get a vector with all model parameters unrolled
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PCMParamGetFullVector(model, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PCMParamGetFullVector_+3A_model">model</code></td>
<td>
<p>a PCM model object</p>
</td></tr>
<tr><td><code id="PCMParamGetFullVector_+3A_...">...</code></td>
<td>
<p>passed to methods</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a numerical vector
</p>


<h3>Examples</h3>

<pre><code class='language-R'>PCMParamGetFullVector(PCMBase::PCMBaseTestObjects$model.a.123)
</code></pre>

<hr>
<h2 id='PCMTreePreorderCpp'>Fast preorder of the edges in a tree</h2><span id='topic+PCMTreePreorderCpp'></span>

<h3>Description</h3>

<p>Fast preorder of the edges in a tree
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PCMTreePreorderCpp(tree)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PCMTreePreorderCpp_+3A_tree">tree</code></td>
<td>
<p>a phylo object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an integer vector containing indices of rows in <code>tree$edge</code> in
their preorder order.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>PCMTreePreorderCpp(PCMBase::PCMBaseTestObjects$tree.a)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
