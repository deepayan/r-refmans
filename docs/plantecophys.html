<!DOCTYPE html><html><head><title>Help for package plantecophys</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {plantecophys}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#plantecophys-package'>
<p>Modelling and Analysis of Leaf Gas Exchange Data</p></a></li>
<li><a href='#AciC4'><p>C4 Photosynthesis</p></a></li>
<li><a href='#acidata1'><p>An example A-Ci curve</p></a></li>
<li><a href='#FARAO'><p>FARquhar And Opti</p></a></li>
<li><a href='#findCiTransition'><p>Calculate transition points for fitted A-Ci curves</p></a></li>
<li><a href='#fitaci'><p>Fit the Farquhar-Berry-von Caemmerer model of leaf photosynthesis</p></a></li>
<li><a href='#fitacis'><p>Fit multiple A-Ci curves at once</p></a></li>
<li><a href='#fitBB'><p>Fit Ball-Berry type models of stomatal conductance</p></a></li>
<li><a href='#fitBBs'><p>Fit Ball-Berry type models of stomatal conductance to many groups at once</p></a></li>
<li><a href='#manyacidat'><p>An example dataset with multiple A-Ci curves</p></a></li>
<li><a href='#Photosyn'><p>Coupled leaf gas exchange model</p></a></li>
<li><a href='#PhotosynEB'><p>Coupled leaf gas exchange model with energy balance</p></a></li>
<li><a href='#PhotosynTuzet'><p>Coupled leaf gas exchange model with Tuzet stomatal conductance</p></a></li>
<li><a href='#RHtoVPD'><p>Conversions between relative humidity, vapour pressure deficit and dewpoint</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Modelling and Analysis of Leaf Gas Exchange Data</td>
</tr>
<tr>
<td>Version:</td>
<td>1.4-6</td>
</tr>
<tr>
<td>Description:</td>
<td>Coupled leaf gas exchange model, A-Ci curve simulation and
    fitting, Ball-Berry stomatal conductance models, 
    leaf energy balance using Penman-Monteith, Cowan-Farquhar
    optimization, humidity unit conversions. 
    See Duursma (2015) &lt;<a href="https://doi.org/10.1371%2Fjournal.pone.0143346">doi:10.1371/journal.pone.0143346</a>&gt;.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://bitbucket.org/remkoduursma/plantecophys">https://bitbucket.org/remkoduursma/plantecophys</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://bitbucket.org/remkoduursma/plantecophys/issues">https://bitbucket.org/remkoduursma/plantecophys/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.3.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>nlstools, testthat, knitr, rmarkdown, DT</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL]</td>
</tr>
<tr>
<td>LazyData:</td>
<td>yes</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-03-31 17:28:12 UTC; remko</td>
</tr>
<tr>
<td>Author:</td>
<td>Remko Duursma [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Remko Duursma &lt;remkoduursma@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-03-31 19:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='plantecophys-package'>
Modelling and Analysis of Leaf Gas Exchange Data
</h2><span id='topic+plantecophys-package'></span><span id='topic+plantecophys'></span>

<h3>Description</h3>

<p>Coupled leaf gas exchange model, A-Ci curve simulation and
    fitting, Ball-Berry stomatal conductance models, 
    leaf energy balance using Penman-Monteith, Cowan-Farquhar
    optimization, humidity unit conversions. 
    See Duursma (2015) &lt;doi:10.1371/journal.pone.0143346&gt;.
</p>


<h3>Details</h3>

<p>The DESCRIPTION file:
</p>

<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> plantecophys</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Title: </td><td style="text-align: left;"> Modelling and Analysis of Leaf Gas Exchange Data</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.4-6</td>
</tr>
<tr>
 <td style="text-align: left;">
Authors@R: </td><td style="text-align: left;"> person("Remko", "Duursma", role = c("aut", "cre"),email = "remkoduursma@gmail.com")</td>
</tr>
<tr>
 <td style="text-align: left;">
Description: </td><td style="text-align: left;"> Coupled leaf gas exchange model, A-Ci curve simulation and
    fitting, Ball-Berry stomatal conductance models, 
    leaf energy balance using Penman-Monteith, Cowan-Farquhar
    optimization, humidity unit conversions. 
    See Duursma (2015) &lt;doi:10.1371/journal.pone.0143346&gt;.</td>
</tr>
<tr>
 <td style="text-align: left;">
URL: </td><td style="text-align: left;"> https://bitbucket.org/remkoduursma/plantecophys</td>
</tr>
<tr>
 <td style="text-align: left;">
BugReports: </td><td style="text-align: left;"> https://bitbucket.org/remkoduursma/plantecophys/issues</td>
</tr>
<tr>
 <td style="text-align: left;">
Depends: </td><td style="text-align: left;"> R (&gt;= 3.3.0)</td>
</tr>
<tr>
 <td style="text-align: left;">
Suggests: </td><td style="text-align: left;"> nlstools,
testthat,
knitr,
rmarkdown,
DT</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL</td>
</tr>
<tr>
 <td style="text-align: left;">
LazyData: </td><td style="text-align: left;"> yes</td>
</tr>
<tr>
 <td style="text-align: left;">
RoxygenNote: </td><td style="text-align: left;"> 7.1.1</td>
</tr>
<tr>
 <td style="text-align: left;">
VignetteBuilder: </td><td style="text-align: left;"> knitr</td>
</tr>
<tr>
 <td style="text-align: left;">
Author: </td><td style="text-align: left;"> Remko Duursma [aut, cre]</td>
</tr>
<tr>
 <td style="text-align: left;">
Maintainer: </td><td style="text-align: left;"> Remko Duursma &lt;remkoduursma@gmail.com&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>


<p>Index of help topics:
</p>
<pre>
AciC4                   C4 Photosynthesis
FARAO                   FARquhar And Opti
Photosyn                Coupled leaf gas exchange model
PhotosynEB              Coupled leaf gas exchange model with energy
                        balance
PhotosynTuzet           Coupled leaf gas exchange model with Tuzet
                        stomatal conductance
RHtoVPD                 Conversions between relative humidity, vapour
                        pressure deficit and dewpoint
acidata1                An example A-Ci curve
findCiTransition        Calculate transition points for fitted A-Ci
                        curves
fitBB                   Fit Ball-Berry type models of stomatal
                        conductance
fitBBs                  Fit Ball-Berry type models of stomatal
                        conductance to many groups at once
fitaci                  Fit the Farquhar-Berry-von Caemmerer model of
                        leaf photosynthesis
fitacis                 Fit multiple A-Ci curves at once
manyacidat              An example dataset with multiple A-Ci curves
plantecophys-package    Modelling and Analysis of Leaf Gas Exchange
                        Data
</pre>
<p>The following functions are the main tools in <span class="pkg">plantecophys</span>:
</p>

<ol>
<li> <p><code><a href="#topic+fitaci">fitaci</a></code> (and <code><a href="#topic+fitaci">fitaci</a></code>) fits A-Ci curves to data.
</p>
</li>
<li> <p><code><a href="#topic+Photosyn">Photosyn</a></code> can be used to simulate A-Ci curves (or <code><a href="#topic+Aci">Aci</a></code>), and simulate from a coupled leaf gas exchange model.
</p>
</li>
<li> <p><code><a href="#topic+fitBB">fitBB</a></code> fits Ball-Berry-type stomatal conductance models to data.
</p>
</li>
<li> <p><code><a href="#topic+FARAO">FARAO</a></code> is an implementation of a numeric solution to Cowan-Farquhar optimization of stomatal conductance.
</p>
</li>
<li> <p><code><a href="#topic+RHtoVPD">RHtoVPD</a></code> converts relative humidity to vapour pressure deficit (and more similar functions on that help page).
</p>
</li></ol>

<p>The package also includes the following example datasets:
</p>

<ol>
<li> <p><code><a href="#topic+acidata1">acidata1</a></code> A dataset with a single A-Ci curve.
</p>
</li>
<li> <p><code><a href="#topic+manyacidat">manyacidat</a></code> A dataset with many A-Ci curves.
</p>
</li></ol>



<h3>Author(s)</h3>

<p>Remko Duursma
</p>
<p>Maintainer: Remko Duursma
</p>


<h3>References</h3>

<p>Duursma, R.A., 2015. Plantecophys - An R Package for Analysing and Modelling Leaf Gas Exchange Data. PLoS ONE 10, e0143346. doi:10.1371/journal.pone.0143346
</p>

<hr>
<h2 id='AciC4'>C4 Photosynthesis</h2><span id='topic+AciC4'></span>

<h3>Description</h3>

<p>An implementation of the A-Ci curve for C4 plants, based on von Caemmerer et al. (2000)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AciC4(
  Ci,
  PPFD = 1500,
  Tleaf = 25,
  VPMAX25 = 120,
  JMAX25 = 400,
  Vcmax = 60,
  Vpr = 80,
  alpha = 0,
  gbs = 0.003,
  O2 = 210,
  x = 0.4,
  THETA = 0.7,
  Q10 = 2.3,
  RD0 = 1,
  RTEMP = 25,
  TBELOW = 0,
  DAYRESP = 1,
  Q10F = 2,
  FRM = 0.5,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AciC4_+3A_ci">Ci</code></td>
<td>
<p>Intercellular CO2 concentration (ppm)</p>
</td></tr>
<tr><td><code id="AciC4_+3A_ppfd">PPFD</code></td>
<td>
<p>Photosynthetic photon flux density (mu mol m-2 s-1)</p>
</td></tr>
<tr><td><code id="AciC4_+3A_tleaf">Tleaf</code></td>
<td>
<p>Leaf temperature (C)</p>
</td></tr>
<tr><td><code id="AciC4_+3A_vpmax25">VPMAX25</code></td>
<td>
<p>The maximum rate of PEP carboxylation (mu mol m-2 s-1)</p>
</td></tr>
<tr><td><code id="AciC4_+3A_jmax25">JMAX25</code></td>
<td>
<p>Maximum electron transport rate (at 25C)</p>
</td></tr>
<tr><td><code id="AciC4_+3A_vcmax">Vcmax</code></td>
<td>
<p>Maximum rate of carboxylation (mu mol m-2 s-1) (at 25C)</p>
</td></tr>
<tr><td><code id="AciC4_+3A_vpr">Vpr</code></td>
<td>
<p>PEP regeneration (mu mol m-2 s-1)</p>
</td></tr>
<tr><td><code id="AciC4_+3A_alpha">alpha</code></td>
<td>
<p>Fraction of PSII activity in the bundle sheath (-)</p>
</td></tr>
<tr><td><code id="AciC4_+3A_gbs">gbs</code></td>
<td>
<p>Bundle sheath conductance (mol m-2 s-1)</p>
</td></tr>
<tr><td><code id="AciC4_+3A_o2">O2</code></td>
<td>
<p>Mesophyll O2 concentration</p>
</td></tr>
<tr><td><code id="AciC4_+3A_x">x</code></td>
<td>
<p>Partitioning factor for electron transport</p>
</td></tr>
<tr><td><code id="AciC4_+3A_theta">THETA</code></td>
<td>
<p>Shape parameter of the non-rectangular hyperbola</p>
</td></tr>
<tr><td><code id="AciC4_+3A_q10">Q10</code></td>
<td>
<p>T-dependence parameter for Michaelis-Menten coefficients.</p>
</td></tr>
<tr><td><code id="AciC4_+3A_rd0">RD0</code></td>
<td>
<p>Respiration at base temperature (RTEMP) (mu mol m-2 s-1)</p>
</td></tr>
<tr><td><code id="AciC4_+3A_rtemp">RTEMP</code></td>
<td>
<p>Base leaf temperature for respiration (C)</p>
</td></tr>
<tr><td><code id="AciC4_+3A_tbelow">TBELOW</code></td>
<td>
<p>Below this T, respiration is zero.</p>
</td></tr>
<tr><td><code id="AciC4_+3A_dayresp">DAYRESP</code></td>
<td>
<p>Fraction respiration in the light vs. that measured in the dark</p>
</td></tr>
<tr><td><code id="AciC4_+3A_q10f">Q10F</code></td>
<td>
<p>T-dependence parameter of respiration</p>
</td></tr>
<tr><td><code id="AciC4_+3A_frm">FRM</code></td>
<td>
<p>Fraction of day respiration that is mesophyll respiration (Rm)</p>
</td></tr>
<tr><td><code id="AciC4_+3A_...">...</code></td>
<td>
<p>Further arguments (currently ignored).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that the temperature response parameters have been hardwired 
in this function, and are based on von Caemmerer (2000).
</p>
<p>Note that it is not (yet) possible to fit this curve to observations of 
photosynthesis (see <code><a href="#topic+fitaci">fitaci</a></code> to fit the C3 model of photosynthesis).
</p>


<h3>Author(s)</h3>

<p>Rhys Whitley
</p>


<h3>References</h3>

<p>Caemmerer, S.V., 2000. Biochemical Models of Leaf Photosynthesis. Csiro Publishing.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate a C4 A-Ci curve. 
aci &lt;- AciC4(Ci=seq(5,600, length=101))
with(aci, plot(Ci, ALEAF, type='l', ylim=c(0,max(ALEAF))))
</code></pre>

<hr>
<h2 id='acidata1'>An example A-Ci curve</h2><span id='topic+acidata1'></span>

<h3>Description</h3>

<p>CO2 response of leaf photosynthesis, as measured with a Licor6400.
</p>


<h3>Format</h3>


<dl>
<dt>CO2S</dt><dd><p>CO2 concentration in cuvette (ppm)</p>
</dd>
<dt>Ci</dt><dd><p>Intercellular CO2 concentration (ppm)</p>
</dd>
<dt>Tleaf</dt><dd><p>Leaf temperature (deg C)</p>
</dd>
<dt>Photo</dt><dd><p>Net photosynthesis rate (mu mol m-2 s-1)</p>
</dd>
</dl>


<hr>
<h2 id='FARAO'>FARquhar And Opti</h2><span id='topic+FARAO'></span><span id='topic+FARAO2'></span>

<h3>Description</h3>

<p>The numerical solution of the optimal stomatal conductance model, coupled with 
the Farquhar model of photosynthesis. The model of Medlyn et al. (2011) is an approximation 
to this full numeric solution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>FARAO(
  lambda = 0.002,
  Ca = 400,
  VPD = 1,
  photo = c("BOTH", "VCMAX", "JMAX"),
  energybalance = FALSE,
  C4 = FALSE,
  Tair = 25,
  Wind = 2,
  Wleaf = 0.02,
  StomatalRatio = 1,
  LeafAbs = 0.86,
  ...
)

FARAO2(lambda = 0.002, Ca = 400, energybalance = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="FARAO_+3A_lambda">lambda</code></td>
<td>
<p>The marginal cost of water (mol mol-1)</p>
</td></tr>
<tr><td><code id="FARAO_+3A_ca">Ca</code></td>
<td>
<p>The CO2 concentration.</p>
</td></tr>
<tr><td><code id="FARAO_+3A_vpd">VPD</code></td>
<td>
<p>Vapor pressure deficit (kPa)</p>
</td></tr>
<tr><td><code id="FARAO_+3A_photo">photo</code></td>
<td>
<p>Which photosynthesis rate should stomata respond to? Defaults to 'BOTH', i.e. 
the minimum of Vcmax and Jmax limited rates.</p>
</td></tr>
<tr><td><code id="FARAO_+3A_energybalance">energybalance</code></td>
<td>
<p>If TRUE (Default = FALSE), calculates leaf temperature from energy balance 
(and its effects on photosynthesis as well as leaf transpiration), using <code><a href="#topic+PhotosynEB">PhotosynEB</a></code>.</p>
</td></tr>
<tr><td><code id="FARAO_+3A_c4">C4</code></td>
<td>
<p>If TRUE, uses the C4 photosynthesis routine (<code><a href="#topic+AciC4">AciC4</a></code>)</p>
</td></tr>
<tr><td><code id="FARAO_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="FARAO_+3A_wind">Wind</code></td>
<td>
<p>Wind speed (m s-1) (only used if energybalance=TRUE)</p>
</td></tr>
<tr><td><code id="FARAO_+3A_wleaf">Wleaf</code></td>
<td>
<p>Leaf width (m) (only used if energybalance=TRUE)</p>
</td></tr>
<tr><td><code id="FARAO_+3A_stomatalratio">StomatalRatio</code></td>
<td>
<p>The stomatal ratio (see <code><a href="#topic+PhotosynEB">PhotosynEB</a></code>) (only used if 
energybalance=TRUE)</p>
</td></tr>
<tr><td><code id="FARAO_+3A_leafabs">LeafAbs</code></td>
<td>
<p>Leaf absorptance (see <code><a href="#topic+PhotosynEB">PhotosynEB</a></code>) (only used if 
energybalance=TRUE)</p>
</td></tr>
<tr><td><code id="FARAO_+3A_...">...</code></td>
<td>
<p>All other parameters are passed to <code><a href="#topic+Aci">Aci</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>This model finds the Ci that maximizes A - lambda*E (Cowan &amp; Farquhar 1977,
see also Medlyn et al. 2011). The new function FARAO2 is a much simpler (and probably 
more stable) implementation, based on Buckley et al. 2014 (P,C&amp;E). Both functions 
are provided, as FARAO has a few more options than FARAO2, at the moment.
</p>


<h3>Author(s)</h3>

<p>Remko Duursma
</p>


<h3>References</h3>

<p>Buckley, T.N., Martorell, S., Diaz-Espejo, A., Tomas, M., Medrano, H., 2014. Is stomatal 
conductance optimized over both time and space in plant crowns? A field test in 
grapevine (Vitis vinifera). Plant Cell Environ doi:10.1111/pce.12343
</p>
<p>Cowan, I. and G.D. Farquhar. 1977. Stomatal function in relation to leaf metabolism 
and environment. Symposia of the Society for Experimental Biology. 31:471-505.
</p>
<p>Medlyn, B.E., R.A. Duursma, D. Eamus, D.S. Ellsworth, I.C. Prentice, C.V.M. Barton, 
K.Y. Crous, P. De Angelis, M. Freeman and L. Wingate. 2011. Reconciling the optimal 
and empirical approaches to modelling stomatal conductance. Global Change Biology. 17:2134-2144.
</p>

<hr>
<h2 id='findCiTransition'>Calculate transition points for fitted A-Ci curves</h2><span id='topic+findCiTransition'></span>

<h3>Description</h3>

<p>Calculates the Ci at the transition points between Ac &amp; Aj (point 1), and Aj and Ap (point 2). The latter is not NA only when TPU was estimated (and estimable), see <code><a href="#topic+fitaci">fitaci</a></code>, argument <code>fitTPU</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>findCiTransition(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="findCiTransition_+3A_object">object</code></td>
<td>
<p>Either an object returned by <code>fitaci</code>, or a copy of the <code>Photosyn</code> function.</p>
</td></tr>
<tr><td><code id="findCiTransition_+3A_...">...</code></td>
<td>
<p>Further arguments passed to the <code>Photosyn</code> function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is also used by <code>fitaci</code>, the results are stored in elements <code>Ci_transition</code> and <code>Ci_transition2</code>.
</p>

<hr>
<h2 id='fitaci'>Fit the Farquhar-Berry-von Caemmerer model of leaf photosynthesis</h2><span id='topic+fitaci'></span><span id='topic+plot.acifit'></span>

<h3>Description</h3>

<p>Fits the Farquhar-Berry-von Caemmerer model of photosynthesis to measurements of 
photosynthesis and intercellular <code class="reqn">CO_2</code> concentration (Ci). Estimates Jmax, Vcmax, Rd 
and their standard errors. A simple plotting method is also included, as well as the function 
<code><a href="#topic+fitacis">fitacis</a></code> which quickly fits multiple A-Ci curves (see its help page). Temperature 
dependencies of the parameters are taken into account following Medlyn et al. (2002), see 
<code><a href="#topic+Photosyn">Photosyn</a></code> for more details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fitaci(
  data,
  varnames = list(ALEAF = "Photo", Tleaf = "Tleaf", Ci = "Ci", PPFD = "PARi", Rd =
    "Rd"),
  Tcorrect = TRUE,
  Patm = 100,
  citransition = NULL,
  quiet = FALSE,
  startValgrid = TRUE,
  fitmethod = c("default", "bilinear", "onepoint"),
  algorithm = "default",
  fitTPU = FALSE,
  alphag = 0,
  useRd = FALSE,
  PPFD = NULL,
  Tleaf = NULL,
  alpha = 0.24,
  theta = 0.85,
  gmeso = NULL,
  EaV = 82620.87,
  EdVC = 0,
  delsC = 645.1013,
  EaJ = 39676.89,
  EdVJ = 2e+05,
  delsJ = 641.3615,
  GammaStar = NULL,
  Km = NULL,
  id = NULL,
  ...
)

## S3 method for class 'acifit'
plot(
  x,
  what = c("data", "model", "none"),
  xlim = NULL,
  ylim = NULL,
  whichA = c("Ac", "Aj", "Amin", "Ap"),
  add = FALSE,
  pch = 19,
  addzeroline = TRUE,
  addlegend = !add,
  legendbty = "o",
  transitionpoint = TRUE,
  linecols = c("black", "blue", "red"),
  lwd = c(1, 2),
  lty = 1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fitaci_+3A_data">data</code></td>
<td>
<p>Dataframe with Ci, Photo, Tleaf, PPFD (the last two are optional). For <code>fitacis</code>, 
also requires a grouping variable.</p>
</td></tr>
<tr><td><code id="fitaci_+3A_varnames">varnames</code></td>
<td>
<p>List of names of variables in the dataset (see Details).</p>
</td></tr>
<tr><td><code id="fitaci_+3A_tcorrect">Tcorrect</code></td>
<td>
<p>If TRUE, Vcmax and Jmax are corrected to 25C. Otherwise, Vcmax and Jmax 
are estimated at measurement temperature. <strong>Warning</strong> : since package version 1.4, the default parameters have been adjusted (see Details).</p>
</td></tr>
<tr><td><code id="fitaci_+3A_patm">Patm</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="fitaci_+3A_citransition">citransition</code></td>
<td>
<p>If provided, fits the Vcmax and Jmax limited regions separately (see Details).</p>
</td></tr>
<tr><td><code id="fitaci_+3A_quiet">quiet</code></td>
<td>
<p>If TRUE, no messages are written to the screen.</p>
</td></tr>
<tr><td><code id="fitaci_+3A_startvalgrid">startValgrid</code></td>
<td>
<p>If TRUE (the default), uses a fine grid of starting values to increase 
the chance of finding a solution.</p>
</td></tr>
<tr><td><code id="fitaci_+3A_fitmethod">fitmethod</code></td>
<td>
<p>Method to fit the A-Ci curve. Either 'default' (Duursma 2015), 'bilinear' (See Details), or 'onepoint' (De Kauwe et al. 2016).</p>
</td></tr>
<tr><td><code id="fitaci_+3A_algorithm">algorithm</code></td>
<td>
<p>Passed to <code><a href="stats.html#topic+nls">nls</a></code>, sets the algorithm for finding parameter values.</p>
</td></tr>
<tr><td><code id="fitaci_+3A_fittpu">fitTPU</code></td>
<td>
<p>Logical (default FALSE). Attempt to fit TPU limitation (fitmethod set to 'bilinear' 
automatically if used). See Details.</p>
</td></tr>
<tr><td><code id="fitaci_+3A_alphag">alphag</code></td>
<td>
<p>When estimating TPU limitation (with <code>fitTPU</code>), an 
additional parameter (see Details).</p>
</td></tr>
<tr><td><code id="fitaci_+3A_userd">useRd</code></td>
<td>
<p>If Rd provided in data, and useRd=TRUE (default is FALSE), uses measured Rd in 
fit. Otherwise it is estimated from the fit to the A-Ci curve.</p>
</td></tr>
<tr><td><code id="fitaci_+3A_ppfd">PPFD</code></td>
<td>
<p>Photosynthetic photon flux density ('PAR') (mu mol m-2 s-1)</p>
</td></tr>
<tr><td><code id="fitaci_+3A_tleaf">Tleaf</code></td>
<td>
<p>Leaf temperature (degrees C)</p>
</td></tr>
<tr><td><code id="fitaci_+3A_alpha">alpha</code></td>
<td>
<p>Quantum yield of electron transport (mol mol-1)</p>
</td></tr>
<tr><td><code id="fitaci_+3A_theta">theta</code></td>
<td>
<p>Shape of light response curve.</p>
</td></tr>
<tr><td><code id="fitaci_+3A_gmeso">gmeso</code></td>
<td>
<p>Mesophyll conductance (mol m-2 s-1 bar-1). If not NULL (the default), Vcmax 
and Jmax are chloroplastic rates.</p>
</td></tr>
<tr><td><code id="fitaci_+3A_eav">EaV</code>, <code id="fitaci_+3A_edvc">EdVC</code>, <code id="fitaci_+3A_delsc">delsC</code></td>
<td>
<p>Vcmax temperature response parameters</p>
</td></tr>
<tr><td><code id="fitaci_+3A_eaj">EaJ</code>, <code id="fitaci_+3A_edvj">EdVJ</code>, <code id="fitaci_+3A_delsj">delsJ</code></td>
<td>
<p>Jmax temperature response parameters</p>
</td></tr>
<tr><td><code id="fitaci_+3A_km">Km</code>, <code id="fitaci_+3A_gammastar">GammaStar</code></td>
<td>
<p>Optionally, provide Michaelis-Menten coefficient for Farquhar model, and 
Gammastar. If not provided, they are calculated with a built-in function of leaf temperature.</p>
</td></tr>
<tr><td><code id="fitaci_+3A_id">id</code></td>
<td>
<p>Names of variables (quoted, can be a vector) in the original dataset to be stored
in the result. Most useful when using <code><a href="#topic+fitacis">fitacis</a></code>, see there for examples of its use.</p>
</td></tr>
<tr><td><code id="fitaci_+3A_...">...</code></td>
<td>
<p>Further arguments (ignored at the moment).</p>
</td></tr>
<tr><td><code id="fitaci_+3A_x">x</code></td>
<td>
<p>For plot.acifit, an object returned by <code>fitaci</code></p>
</td></tr>
<tr><td><code id="fitaci_+3A_what">what</code></td>
<td>
<p>The default is to plot both the data and the model fit, or specify 'data' or 
'model' to plot one of them, or 'none' for neither (only the plot region is set up)</p>
</td></tr>
<tr><td><code id="fitaci_+3A_xlim">xlim</code></td>
<td>
<p>Limits for the X axis, if left blank estimated from data</p>
</td></tr>
<tr><td><code id="fitaci_+3A_ylim">ylim</code></td>
<td>
<p>Limits for the Y axis, if left blank estimated from data</p>
</td></tr>
<tr><td><code id="fitaci_+3A_whicha">whichA</code></td>
<td>
<p>By default all photosynthetic rates are plotted (Aj=Jmax-limited 
(blue), Ac=Vcmax-limited (red), Hyperbolic minimum (black)), TPU-limited rate 
(Ap, if estimated in the fit). Or, specify one or two of them.</p>
</td></tr>
<tr><td><code id="fitaci_+3A_add">add</code></td>
<td>
<p>If TRUE, adds to the current plot</p>
</td></tr>
<tr><td><code id="fitaci_+3A_pch">pch</code></td>
<td>
<p>The plotting symbol for the data</p>
</td></tr>
<tr><td><code id="fitaci_+3A_addzeroline">addzeroline</code></td>
<td>
<p>If TRUE, the default, adds a dashed line at y=0</p>
</td></tr>
<tr><td><code id="fitaci_+3A_addlegend">addlegend</code></td>
<td>
<p>If TRUE, adds a legend (by default does not add a legend if add=TRUE)</p>
</td></tr>
<tr><td><code id="fitaci_+3A_legendbty">legendbty</code></td>
<td>
<p>Box type for the legend, passed to argument bty in <code><a href="graphics.html#topic+legend">legend</a></code>.</p>
</td></tr>
<tr><td><code id="fitaci_+3A_transitionpoint">transitionpoint</code></td>
<td>
<p>For plot.acifit, whether to plot a symbol at the transition point.</p>
</td></tr>
<tr><td><code id="fitaci_+3A_linecols">linecols</code></td>
<td>
<p>Vector of three colours for the lines (limiting rate, Ac, Aj), if one value 
provided it is used for all three.</p>
</td></tr>
<tr><td><code id="fitaci_+3A_lwd">lwd</code></td>
<td>
<p>Line widths, can be a vector of length 2 (first element for Ac and Aj, second one 
for the limiting rate).</p>
</td></tr>
<tr><td><code id="fitaci_+3A_lty">lty</code></td>
<td>
<p>Line type (only for Amin - the limiting rate).</p>
</td></tr>
</table>


<h3>Details</h3>



<h4>Fitting method</h4>

<p>The default method to fit A-Ci curves (set by 
<code>fitmethod="default"</code>) uses non-linear regression to fit the A-Ci curve. No assumptions 
are made on which part of the curve is Vcmax or Jmax limited. Normally, all three parameters 
are estimated: Jmax, Vcmax and Rd, unless Rd is provided as measured (when <code>useRd=TRUE</code>, 
and Rd is contained in the data). This is the method as described by Duursma (2015, Plos One).
</p>
<p>The 'bilinear' method to fit A-Ci curves (set by <code>fitmethod="bilinear"</code>) linearizes 
the Vcmax and Jmax-limited regions, and applies linear regression twice to estimate first 
Vcmax and Rd, and then Jmax (using Rd estimated from the Vcmax-limited region). The transition 
point is found as the one which gives the best overall fit to the data (i.e. all possible 
transitions are tried out, similar to Gu et al. 2010, PCE). The advantage of this method is that 
it <em>always</em> returns parameter estimates, so it should be used in cases where the default 
method fails. Be aware, though, that the default method fails mostly when the curve contains 
bad data (so check your data before believing the fitted parameters).
</p>
<p>When <code>citransition</code> is set, it splits the data into a Vcmax-limited (where Ci &lt; citransition), 
and Jmax-limited region (Ci &gt; citransition). Both parameters are then estimated separately for 
each region (Rd is estimated only for the Vcmax-limited region). <b>Note</b> that the actual 
transition point as shown in the standard plot of the fitted A-Ci curve may be quite different 
from that provided, since the fitting method simply decides which part of the dataset to use 
for which limitation, it does not constrain the actual estimated transition point directly. 
See the example below. If <code>fitmethod="default"</code>, it applies non-linear regression to 
both parts of the data, and when fitmethod=&quot;bilinear&quot;, it uses linear regression on the 
linearized photosynthesis rate. Results will differ between the two methods (slightly).</p>

<p>The 'onepoint' fitting method is a very simple estimation of Vcmax and Jmax for every point 
in the dataset, simply by inverting the photosynthesis equation. See De Kauwe et al. (2016) 
for details. The output will give the original data with Vcmax and Jmax added (note you can 
set <code>Tcorrect</code> as usual!). For increased reliability, this method only works if 
dark respiration (Rd) is included in the data (<code>useRd</code> is set automatically when 
setting <code>fitmethod='one-point'</code>). This method is not recommended for full A-Ci curves, 
but rather for spot gas exchange measurements, when a simple estimate of Vcmax or Jmax 
is needed, for example when separating stomatal and non-stomatal drought effects on 
photosynthesis (Zhou et al. 2013, AgForMet). The user will have to decide whether the Vcmax 
or Jmax rates are used in further analyses. This fitting method can not be used in <code>fitacis</code>, 
because Vcmax and Jmax are already estimated for each point in the dataset.
</p>


<h4>TPU limitation</h4>

<p>Optionally, the <code>fitaci</code> function estimates the triose-phosphate 
utilization (TPU) rate. The TPU can act as another limitation on photosynthesis, and can be 
recognized by a 'flattening out' of the A-Ci curve at high Ci. When <code>fitTPU=TRUE</code>, the 
fitting method used will always be 'bilinear'. The TPU is estimated by trying out whether the 
fit improves when the last n points of the curve are TPU-limited (where n=1,2,...). When TPU is 
estimated, it is possible (though rare) that no points are Jmax-limited (in which case estimated 
Jmax will be NA). A minimum of two points is always reserved for the estimate of Vcmax and Rd. 
An additional parameter (<code>alphag</code>) can be set that affects the behaviour at high Ci (see 
Ellsworth et al. 2015 for details, and also <code><a href="#topic+Photosyn">Photosyn</a></code>). See examples.</p>



<h4>Temperature correction</h4>

<p>When <code>Tcorrect=TRUE</code> (the default), Jmax and Vcmax 
are re-scaled to 25C, using the temperature response parameters provided (but Rd is always 
at measurement temperature). When <code>Tcorrect=FALSE</code>, estimates of all parameters are at 
measurement temperature. If TPU is fit, it is never corrected for temperature. Important 
parameters to the fit are GammaStar and Km, both of which are calculated from leaf temperature 
using standard formulations. Alternatively, they can be provided as known inputs. <strong>Warning</strong> : 
since package version 1.4, the default parameters have been adjusted. The new parameter values 
(EaV, EdVJ, delSJ, etc.) were based on a comprehensive literature review. See 
<code>vignette("new_T_responses")</code> or the article on remkoduursma.github.io/plantecophys.</p>



<h4>Mesophyll conductance</h4>

<p>It is possible to provide an estimate of the mesophyll 
conductance as input (<code>gmeso</code>), in which case the fitted Vcmax and Jmax are to be interpreted 
as chloroplastic rates. When using gmeso, it is recommended to use the 'default' fitting 
method (which will use the Ethier&amp;Livingston equations inside <code>Photosyn</code>). It is also 
implemented with the 'bilinear' method but it requires more testing (and seems to give 
some strange results). When gmeso is set to a relatively low value, the resulting fit 
may be quite strange.</p>



<h4>Other parameters</h4>

<p>The A-Ci curve parameters depend on the values of a number 
of other parameters. For Jmax, PPFD is needed in order to express it as the asymptote. If 
PPFD is not provided in the dataset, it is assumed to equal 1800 mu mol m-2 s-1 (in which 
case a warning is printed). It is possible to either provide PPFD as a variable in the 
dataset (with the default name 'PARi', which can be changed), or as an argument to 
the <code>fitaci</code> directly.</p>



<h4>Plotting and summarizing</h4>

<p>The default <strong>plot</strong> of the fit is constructed 
with <code><a href="#topic+plot.acifit">plot.acifit</a></code>, see Examples below. When plotting the fit, the A-Ci curve 
is simulated using the <code><a href="#topic+Aci">Aci</a></code> function, with leaf temperature (Tleaf) and PPFD 
set to the mean value for the dataset. The <strong>coefficients</strong> estimated in the fit 
(Vcmax, Jmax, and usually Rd) are extracted with <code>coef</code>. The summary of the fit is 
the same as the 'print' method, that is <code>myfit</code> will give the same output as 
<code>summary(myfit)</code> (where <code>myfit</code> is an object returned by <code>fitaci</code>).
</p>
<p>Because fitaci returns the fitted <code><a href="stats.html#topic+nls">nls</a></code> object, more details on statistics of 
the fit can be extracted with standard tools. The Examples below shows the use of the 
<span class="pkg">nlstools</span> to extract many details of the fit at once. The fit also includes the 
<strong>root mean squared error</strong> (RMSE), which can be extracted as <code>myfit$RMSE</code>. This 
is a useful metric to compare the different fitting methods.</p>



<h4>Predicting and the CO2 compensation point</h4>

<p>The fitted object contains two functions 
that reproduce the fitted curve exactly. Suppose your object is called 'myfit', then 
<code>myfit$Photosyn(200)</code> will give the fitted rate of photosynthesis at a Ci of 200. 
The inverse, calculating the Ci where some rate of photosynthesis is achieved, can be done with
<code>myfit$Ci(10)</code> (find the Ci where net photosynthesis is ten). The (fitted!) CO2 
compensation point can then be calculated with : <code>myfit$Ci(0)</code></p>
<p>.
</p>


<h4>Atmospheric pressure correction</h4>

<p>Note that atmospheric pressure (Patm) is taken 
into account, assuming the original data are in molar units (Ci in mu mol mol-1, or ppm). 
During the fit, Ci is converted to mu bar, and Km and Gammastar are recalculated accounting 
for the effects of Patm on the partial pressure of oxygen. When plotting the fit, though,
molar units are shown on the X-axis. Thus, you should get (nearly) the same fitted curve when
Patm was set to a value lower than 100kPa, but the fitted Vcmax and Jmax will be higher. 
This is because at low Patm, photosynthetic capacity has to be higher to achieve the same 
measured photosynthesis rate.</p>



<h3>Value</h3>

<p>A list of class 'acifit', with the following components:
</p>

<dl>
<dt>df</dt><dd><p>A dataframe with the original data, including the measured photosynthetic 
rate (Ameas), the fitted photosynthetic rate (Amodel), Jmax and Vcmax-limited gross 
rates (Aj, Ac), TPU-limited rate (Ap), dark respiration (Rd), leaf temperature (Tleaf), 
chloroplastic CO2 (Cc), PPFD, atmospheric pressure (Patm), and 'original Ci, i.e. the 
Ci used as input (which is different from the Ci used in fitting if Patm was not set to 100kPa)</p>
</dd>
<dt>pars</dt><dd><p>Contains the parameter estimates and their approximate standard errors</p>
</dd>
<dt>nlsfit</dt><dd><p>The object returned by <code><a href="stats.html#topic+nls">nls</a></code>, and contains more detail on 
the quality of the fit</p>
</dd>
<dt>Tcorrect</dt><dd><p>whether the temperature correction was applied (logical)</p>
</dd>
<dt>Photosyn</dt><dd><p>A copy of the <code><a href="#topic+Photosyn">Photosyn</a></code> function with the arguments adjusted for 
the current fit. That is, Vcmax, Jmax and Rd are set to those estimated in the fit, and Tleaf and 
PPFD are set to the mean value in the dataset. All other parameters that were set in fitaci are 
also used (e.g. temperature dependency parameters, TPU, etc.).</p>
</dd>
<dt>Ci</dt><dd><p>As Photosyn, except the opposite: calculate the Ci where some rate of net photosynthesis 
is achieved.</p>
</dd>
<dt>Ci_transition</dt><dd><p>The Ci at which photosynthesis transitions from Vcmax 
to Jmax limited photosynthesis.</p>
</dd>
<dt>Ci_transition2</dt><dd><p>The Ci at which photosynthesis transitions from Jmax to
TPU limitation. Set to NA is either TPU was not estimated, or it could not be 
estimated from the data.</p>
</dd>
<dt>Rd_measured</dt><dd><p>Logical - was Rd provided as measured input?</p>
</dd>
<dt>GammaStar</dt><dd><p>The value for GammaStar, either calculated or provided to the fit.</p>
</dd>
<dt>Km</dt><dd><p>he value for Km, either calculated or provided to the fit.</p>
</dd>
<dt>kminput</dt><dd><p>Was Km provided as input? (If FALSE, it was calculated from Tleaf)</p>
</dd>
<dt>gstarinput</dt><dd><p>Was GammaStar provided as input? (If FALSE, it was calculated from Tleaf)</p>
</dd>
<dt>fitmethod</dt><dd><p>The fitmethod uses, either default or bilinear</p>
</dd>
<dt>citransition</dt><dd><p>The input citransition (NA if it was not provided as input)</p>
</dd>
<dt>gmeso</dt><dd><p>The mesophyll conductance used in the fit (NA if it was not set)</p>
</dd>
<dt>fitTPU</dt><dd><p>Was TPU fit?</p>
</dd>
<dt>alphag</dt><dd><p>The value of alphag used in estimating TPU.</p>
</dd>
<dt>RMSE</dt><dd><p>The Root-mean squared error, calculated as <code>sqrt(sum((Ameas-Amodel)^2))</code>.</p>
</dd>
<dt>runorder</dt><dd><p>The data returned in the 'df' slot are ordered by Ci, but in rare cases the 
original order of the data contains information; 'runorder' is 
the order in which the data were provided.</p>
</dd>
</dl>



<h3>References</h3>

<p>Duursma, R.A., 2015. Plantecophys - An R Package for Analysing and Modelling Leaf Gas 
Exchange Data. PLoS ONE 10, e0143346. doi:10.1371/journal.pone.0143346
</p>
<p>De Kauwe, M. G. et al. 2016. A test of the 'one-point method' for estimating maximum 
carboxylation capacity from field-measured, light-saturated photosynthesis. 
New Phytol 210, 1130-1144.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Fit an A-Ci curve on a dataframe that contains Ci, Photo and optionally Tleaf and PPFD. 
# Here, we use the built-in example dataset 'acidata1'.
f &lt;- fitaci(acidata1)

# Note that the default behaviour is to correct Vcmax and Jmax for temperature, 
# so the estimated values are at 25C. To turn this off:
f2 &lt;- fitaci(acidata1, Tcorrect=FALSE)

# To use different T response parameters (see ?Photosyn),
f3 &lt;- fitaci(acidata1, Tcorrect=TRUE, EaV=25000)

# Make a standard plot
plot(f)

# Look at a summary of the fit
summary(f)

# Extract coefficients only
coef(f)

# The object 'f' also contains the original data with predictions.
# Here, Amodel are the modelled (fitted) values, Ameas are the measured values.
with(f$df, plot(Amodel, Ameas))
abline(0,1)

# The fitted values can also be extracted with the fitted() function:
fitted(f)

# The non-linear regression (nls) fit is stored as well,
summary(f$nlsfit)

# Many more details can be extracted with the nlstools package
library(nlstools)
overview(f$nlsfit)
 
# The curve generator is stored as f$Photosyn:
# Calculate photosynthesis at some value for Ci, using estimated 
# parameters and mean Tleaf, PPFD for the dataset.
f$Photosyn(Ci=820)

# Photosynthetic rate at the transition point:
f$Photosyn(Ci=f$Ci_transition)$ALEAF

# Set the transition point; this will fit Vcmax and Jmax separately. Note that the *actual* 
# transition is quite different from that provided, this is perfectly fine : 
# in this case Jmax is estimated from the latter 3 points only (Ci&gt;800), but the actual 
# transition point is at ca. 400ppm.
g &lt;- fitaci(acidata1, citransition=800)
plot(g)
g$Ci_transition

# Use measured Rd instead of estimating it from the A-Ci curve. 
# The Rd measurement must be added to the dataset used in fitting, 
# and you must set useRd=TRUE.
acidata1$Rd &lt;- 2
f2 &lt;- fitaci(acidata1, useRd=TRUE)
f2

# Fit TPU limitation
ftpu &lt;- fitaci(acidata1, fitTPU=TRUE, PPFD=1800, Tcorrect=TRUE)
plot(ftpu)

## End(Not run)
</code></pre>

<hr>
<h2 id='fitacis'>Fit multiple A-Ci curves at once</h2><span id='topic+fitacis'></span><span id='topic+plot.acifits'></span>

<h3>Description</h3>

<p>A convenient function to fit many curves at once, by calling <code><a href="#topic+fitaci">fitaci</a></code> for 
every group in the dataset. The data provided must include a variable that uniquely identifies each A-Ci curve.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fitacis(
  data,
  group,
  fitmethod = c("default", "bilinear"),
  progressbar = TRUE,
  quiet = FALSE,
  id = NULL,
  ...
)

## S3 method for class 'acifits'
plot(
  x,
  how = c("manyplots", "oneplot"),
  highlight = NULL,
  ylim = NULL,
  xlim = NULL,
  add = FALSE,
  what = c("model", "data", "none"),
  colour_by_id = FALSE,
  id_legend = TRUE,
  linecol = "grey",
  linecol_highlight = "black",
  lty = 1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fitacis_+3A_data">data</code></td>
<td>
<p>Dataframe with Ci, Photo, Tleaf, PPFD (the last two are optional). For <code>fitacis</code>, 
also requires a grouping variable.</p>
</td></tr>
<tr><td><code id="fitacis_+3A_group">group</code></td>
<td>
<p>The name of the grouping variable in the dataframe (an A-Ci curve will be fit for each group separately).</p>
</td></tr>
<tr><td><code id="fitacis_+3A_fitmethod">fitmethod</code></td>
<td>
<p>Method to fit the A-Ci curve. Either 'default' (Duursma 2015), or 'bilinear'. See Details.</p>
</td></tr>
<tr><td><code id="fitacis_+3A_progressbar">progressbar</code></td>
<td>
<p>Display a progress bar (default is TRUE).</p>
</td></tr>
<tr><td><code id="fitacis_+3A_quiet">quiet</code></td>
<td>
<p>If TRUE, no messages are written to the screen.</p>
</td></tr>
<tr><td><code id="fitacis_+3A_id">id</code></td>
<td>
<p>Names of variables (quoted, can be a vector) in the original dataset to return as part of 
the coef() statement. Useful for keeping track of species names, treatment levels, etc. See Details and Examples.</p>
</td></tr>
<tr><td><code id="fitacis_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="#topic+fitaci">fitaci</a></code> (in the case of <code>fitacis</code>), or 
<code><a href="#topic+plot.acifit">plot.acifit</a></code> (in the case of <code>plot.acifits</code>).</p>
</td></tr>
<tr><td><code id="fitacis_+3A_x">x</code></td>
<td>
<p>For <code>plot.acifits</code>, an object returned from <code>fitacis</code></p>
</td></tr>
<tr><td><code id="fitacis_+3A_how">how</code></td>
<td>
<p>If 'manyplots', produces a single plot for each A-Ci curve. If 'oneplot' overlays all of them.</p>
</td></tr>
<tr><td><code id="fitacis_+3A_highlight">highlight</code></td>
<td>
<p>If a name of a curve is given (check names(object), where object is returned by acifits), 
all curves are plotted in grey, with the highlighted one on top.</p>
</td></tr>
<tr><td><code id="fitacis_+3A_xlim">xlim</code>, <code id="fitacis_+3A_ylim">ylim</code></td>
<td>
<p>The X and Y axis limits.</p>
</td></tr>
<tr><td><code id="fitacis_+3A_add">add</code></td>
<td>
<p>If TRUE, adds the plots to a current plot.</p>
</td></tr>
<tr><td><code id="fitacis_+3A_what">what</code></td>
<td>
<p>What to plot, either 'model' (the fitted curve), 'data' or 'none'. See examples.</p>
</td></tr>
<tr><td><code id="fitacis_+3A_colour_by_id">colour_by_id</code></td>
<td>
<p>If TRUE, uses the 'id' argument to colour the curves in the standard plot (only works when <code>how = 'oneplot'</code>, see Examples)</p>
</td></tr>
<tr><td><code id="fitacis_+3A_id_legend">id_legend</code></td>
<td>
<p>If <code>colour_by_id</code> is set, place a legend (topleft) or not.</p>
</td></tr>
<tr><td><code id="fitacis_+3A_linecol">linecol</code></td>
<td>
<p>Colour(s) to use for the non-highlighted curves (can be a vector).</p>
</td></tr>
<tr><td><code id="fitacis_+3A_linecol_highlight">linecol_highlight</code></td>
<td>
<p>Colour to use for the 'highlighted' curve.</p>
</td></tr>
<tr><td><code id="fitacis_+3A_lty">lty</code></td>
<td>
<p>Line type(s), can be a vector (one for each level of the factor, will be recycled).</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Troubleshooting - </strong> When using the default fitting method (see <code><a href="#topic+fitaci">fitaci</a></code>), it is common that 
some curves cannot be fit. Usually this indicates that the curve is poor quality and should not be used to 
estimate photosynthetic capacity, but there are exceptions. The <code>fitacis</code> function now refits the 
non-fitting curves with the 'bilinear' method (see <code>fitaci</code>), which will always return parameter estimates 
(for better or worse).
</p>
<p><strong>Summarizing and plotting - </strong> Like <code>fitaci</code>, the batch utility <code>fitacis</code> also has a standard 
plotting method. By default, it will make a single plot for every curve that you fit (thus generating many plots). 
Alternatively, use the setting <code>how="oneplot"</code> (see Examples below) for a single plot. The fitted 
<strong>coefficients</strong> are extracted with <code>coef</code>, which gives a dataframe where each row represents 
a fitted curve (the grouping label is also included).
</p>
<p><strong>Adding identifying variables - </strong> after fitting multiple curves, the most logical next step is to 
analyze the coefficient by some categorical variable (species, treatment, location). You can use the 
<code>id</code> argument to store variables from the original dataset in the output. It is important that the 
'id' variables take only one value per fitted curve, if this is not the case only the first value of the 
curve will be stored (this will be rarely useful). See examples.
</p>


<h3>References</h3>

<p>Duursma, R.A., 2015. Plantecophys - An R Package for Analysing and Modelling Leaf Gas Exchange Data. 
PLoS ONE 10, e0143346. doi:10.1371/journal.pone.0143346
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
# Fit many curves (using an example dataset)
# The bilinear method is much faster, but compare using 'default'!
fits &lt;- fitacis(manyacidat, "Curve", fitmethod="bilinear")
with(coef(fits), plot(Vcmax, Jmax))

# The resulting object is a list, with each component an object as returned by fitaci
# So, we can extract one curve:
fits[[1]]
plot(fits[[1]])

# Plot all curves in separate figures with plot(fits)
# Or, in one plot:
plot(fits, how="oneplot")

# Note that parameters can be passed to plot.acifit. For example,
plot(fits, how="oneplot", what="data", col="blue")
plot(fits, how="oneplot", add=TRUE, what="model", lwd=c(1,1))

# Other elements can be summarized with sapply. For example, look at the RMSE:
rmses &lt;- sapply(fits, "[[", "RMSE")
plot(rmses, type='h', ylab="RMSE", xlab="Curve nr")

# And plot the worst-fitting curve:
plot(fits[[which.max(rmses)]])

# It is very straightforward to summarize the coefficients by a factor variable
# that was contained in the original data. In manyacidat, there is a factor variable
# 'treatment'.
# We first have to refit the curves, using the 'id' argument:
fits &lt;- fitacis(manyacidat, "Curve", fitmethod="bilinear", id="treatment")

# And now use this to plot Vcmax by treatment.
boxplot(Vcmax ~ treatment, data=coef(fits), ylim=c(0,130))

# As of package version 1.4-2, you can also use the id variable for colouring curves,
# when plotting all fitted curves in one plot.
# Set colours to be used. Also note that the 'id' variable has to be a factor,
# colours will be set in order of the levels of the factor.
# Set palette of colours:
palette(rainbow(8))

# Use colours, add legend.
plot(fits, how="oneplot", colour_by_id = TRUE, id_legend=TRUE)


## End(Not run)

</code></pre>

<hr>
<h2 id='fitBB'>Fit Ball-Berry type models of stomatal conductance</h2><span id='topic+fitBB'></span>

<h3>Description</h3>

<p>Fits one of three versions of the Ball-Berry type stomatal conductance models to 
observations of stomatal conductance (gs), photosynthesis (A), atmospheric CO2 concentration (Ca) 
and vapour pressure deficit (VPD).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fitBB(
  data,
  varnames = list(ALEAF = "Photo", GS = "Cond", VPD = "VpdL", Ca = "CO2S", RH = "RH"),
  gsmodel = c("BBOpti", "BBLeuning", "BallBerry", "BBOptiFull"),
  fitg0 = FALSE,
  D0 = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fitBB_+3A_data">data</code></td>
<td>
<p>Input dataframe, containing all variables needed to fit the model.</p>
</td></tr>
<tr><td><code id="fitBB_+3A_varnames">varnames</code></td>
<td>
<p>List of names of variables in the input dataframe. Relative humidity (RH) is only 
needed when the original Ball-Berry model is to be fit.</p>
</td></tr>
<tr><td><code id="fitBB_+3A_gsmodel">gsmodel</code></td>
<td>
<p>One of BBOpti (Medlyn et al. 2011), BBLeuning (Leuning 1995), BallBerry (Ball et al. 1987), or BBOptiFull (Medlyn et al. 2011 but with an extra parameter gk, see Duursma et al. 2013)</p>
</td></tr>
<tr><td><code id="fitBB_+3A_fitg0">fitg0</code></td>
<td>
<p>If TRUE, also fits the intercept term (g0, the 'residual conductance'). Default is FALSE.</p>
</td></tr>
<tr><td><code id="fitBB_+3A_d0">D0</code></td>
<td>
<p>If provided, fixes D0 for the BBLeuning model. Otherwise is estimated by the data.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that unlike in some publications (e.g. Leuning et al. 1995), the models fit here do not include the CO2 compensation point. This correction may be necessary but can be added by the user (by replacing Ca with the corrected term).
</p>
<p>Note that all models use atmospheric CO2 concentration (Ca) instead of, as sometimes argued, intercellular CO2 concentration (Ci). Using the latter makes these models far more difficult to use in practice, and we have found no benefit of using Ci instead of Ca (and Ca arises from an optimization argument, see Medlyn et al. 2011). The idea that we should use Ci because 'stomata sense Ci, not Ca' is probably not valid (or at least, not sufficient), and note that Ci plays a central role in the steady-state solution to stomatal conductance anyway (see <code><a href="#topic+Photosyn">Photosyn</a></code>). 
</p>
<p>To fit the Ball-Berry models for each group in a dataframe, for example species, see the <code><a href="#topic+fitBBs">fitBBs</a></code> function.
</p>


<h3>Value</h3>

<p>A list with several components, most notably <code>fit</code>, the object returned by <code>nls</code>. If the user needs more information on the goodness of fit etc, please further analyze this object. For example, use the <span class="pkg">broom</span> package for quick summaries. Or use <code><a href="stats.html#topic+confint">confint</a></code> to calculate confidence intervals on the fitted parameters.
</p>


<h3>References</h3>

<p>Ball, J.T., Woodrow, I.E., Berry, J.A., 1987. A model predicting stomatal conductance and its contribution to the control of photosynthesis under different environmental conditions., in: Biggins, J. (Ed.), Progress in Photosynthesis Research. Martinus-Nijhoff Publishers, Dordrecht, the Netherlands, pp. 221-224.
</p>
<p>Leuning, R. 1995. A critical-appraisal of a combined stomatal-photosynthesis model for C-3 plants. Plant Cell and Environment. 18:339-355.
</p>
<p>Medlyn, B.E., R.A. Duursma, D. Eamus, D.S. Ellsworth, I.C. Prentice, C.V.M. Barton, K.Y. Crous, P. De Angelis, M. Freeman and L. Wingate. 2011. Reconciling the optimal and empirical approaches to modelling stomatal conductance. Global Change Biology. 17:2134-2144.
</p>
<p>Duursma, R.A., Payton, P., Bange, M.P., Broughton, K.J., Smith, R.A., Medlyn, B.E., Tissue, D.T., 2013. Near-optimal response of instantaneous transpiration efficiency to vapour pressure deficit, temperature and [CO2] in cotton (Gossypium hirsutum L.). Agricultural and Forest Meteorology 168, 168-176. doi:10.1016/j.agrformet.2012.09.005
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
# If 'mydfr' is a dataframe with 'Photo', 'Cond', 'VpdL' and 'CO2S', you can do:
myfit &lt;- fitBB(mydfr, gsmodel = "BBOpti")

# Coefficients and a message:
myfit

# Coefficients only
coef(myfit)

# If you have a species variable, and would like to fit the model for each species,
# use fitBBs (see its help page ?fitBBs)
myfits &lt;- fitBBs(mydfr, "species")

## End(Not run)
</code></pre>

<hr>
<h2 id='fitBBs'>Fit Ball-Berry type models of stomatal conductance to many groups at once</h2><span id='topic+fitBBs'></span>

<h3>Description</h3>

<p>A batch utility for the <code><a href="#topic+fitBB">fitBB</a></code> function, to fit the model for each group in a dataframe.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fitBBs(data, group, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fitBBs_+3A_data">data</code></td>
<td>
<p>Input dataframe, containing all variables needed to fit the model.</p>
</td></tr>
<tr><td><code id="fitBBs_+3A_group">group</code></td>
<td>
<p>Name of the grouping variable in the dataframe (quoted), the model will be fit for each group defined by this variable.</p>
</td></tr>
<tr><td><code id="fitBBs_+3A_...">...</code></td>
<td>
<p>Further parameters passed to <code><a href="#topic+fitBB">fitBB</a></code>, see there for a full description.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# If you have a factor variable in your dataset called 'species', and you
# want to fit the Ball-Berry model for each of the species:
myfits &lt;- fitBBs(mydata, "species", model="BallBerry")

# A dataframe with coefficients is returned by coef()
coef(myfits)


## End(Not run)
</code></pre>

<hr>
<h2 id='manyacidat'>An example dataset with multiple A-Ci curves</h2><span id='topic+manyacidat'></span>

<h3>Description</h3>

<p>CO2 response of leaf photosynthesis, as measured with a Licor6400, for multiple leaves.
</p>


<h3>Format</h3>


<dl>
<dt>Curve</dt><dd><p>An identifier for the A-Ci curve (28 curves in total, 13-14 points per curve)</p>
</dd>
<dt>Ci</dt><dd><p>Intercellular CO2 concentration (ppm)</p>
</dd>
<dt>Photo</dt><dd><p>Net photosynthesis rate (mu mol m-2 s-1)</p>
</dd>
<dt>Tleaf</dt><dd><p>Leaf temperature (deg C)</p>
</dd>
<dt>PPFD</dt><dd><p>Photosynthetic photon flux density (mu mol m-2 s-1)</p>
</dd>
</dl>


<hr>
<h2 id='Photosyn'>Coupled leaf gas exchange model</h2><span id='topic+Photosyn'></span><span id='topic+Aci'></span>

<h3>Description</h3>

<p>A coupled photosynthesis - stomatal conductance model, based on the 
Farquhar model of photosynthesis, and a Ball-Berry type model of stomatal conductance. 
Includes options for temperature sensitivity of photosynthetic parameters, day respiration 
(optionally calculated from leaf temperature), and mesophyll conductance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Photosyn(
  VPD = 1.5,
  Ca = 400,
  PPFD = 1500,
  Tleaf = 25,
  Patm = 100,
  RH = NULL,
  gsmodel = c("BBOpti", "BBLeuning", "BallBerry", "BBdefine"),
  g1 = 4,
  g0 = 0,
  gk = 0.5,
  vpdmin = 0.5,
  D0 = 5,
  GS = NULL,
  BBmult = NULL,
  alpha = 0.24,
  theta = 0.85,
  Jmax = 100,
  Vcmax = 50,
  gmeso = NULL,
  TPU = 1000,
  alphag = 0,
  Rd0 = 0.92,
  Q10 = 1.92,
  Rd = NULL,
  TrefR = 25,
  Rdayfrac = 1,
  EaV = 58550,
  EdVC = 2e+05,
  delsC = 629.26,
  EaJ = 29680,
  EdVJ = 2e+05,
  delsJ = 631.88,
  GammaStar = NULL,
  Km = NULL,
  Ci = NULL,
  Tcorrect = TRUE,
  returnParsOnly = FALSE,
  whichA = c("Ah", "Amin", "Ac", "Aj")
)

Aci(Ci, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Photosyn_+3A_vpd">VPD</code></td>
<td>
<p>Vapour pressure deficit (kPa) (not needed when RH provided)</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_ca">Ca</code></td>
<td>
<p>Atmospheric CO2 concentration (ppm)</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_ppfd">PPFD</code></td>
<td>
<p>Photosynthetic photon flux density ('PAR') (mu mol m-2 s-1)</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_tleaf">Tleaf</code></td>
<td>
<p>Leaf temperature (degrees C)</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_patm">Patm</code></td>
<td>
<p>Atmospheric pressure (kPa) (but see warning below!)</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_rh">RH</code></td>
<td>
<p>Relative humidity (in %) (not needed when VPD provided)</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_gsmodel">gsmodel</code></td>
<td>
<p>One of BBOpti (Medlyn et al. 2011), BBLeuning (Leuning 1995), 
BallBerry (Ball et al. 1987), or BBdefine (for full control; see Details).</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_g0">g0</code>, <code id="Photosyn_+3A_g1">g1</code></td>
<td>
<p>Parameters of Ball-Berry type stomatal conductance models.</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_gk">gk</code></td>
<td>
<p>Optional, exponent of VPD in gs model (Duursma et al. 2013)</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_vpdmin">vpdmin</code></td>
<td>
<p>Below vpdmin, VPD=vpdmin, to avoid very high gs.</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_d0">D0</code></td>
<td>
<p>Parameter for the BBLeuning stomatal conductance model.</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_gs">GS</code></td>
<td>
<p>Optionally, stomatal conductance (to H2O). If provided, <code>Photosyn</code> 
calculates Ci and photosynthesis. See Details.</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_bbmult">BBmult</code></td>
<td>
<p>Optional, only used when <code>gsmodel = "BBdefine"</code>, see Details.</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_alpha">alpha</code></td>
<td>
<p>Quantum yield of electron transport (mol mol-1)</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_theta">theta</code></td>
<td>
<p>Shape of light response curve.</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_jmax">Jmax</code></td>
<td>
<p>Maximum rate of electron transport at 25 degrees C (mu mol m-2 s-1)</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_vcmax">Vcmax</code></td>
<td>
<p>Maximum carboxylation rate at 25 degrees C (mu mol m-2 s-1)</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_gmeso">gmeso</code></td>
<td>
<p>Mesophyll conductance (mol m-2 s-1). If not NULL (the default), Vcmax and 
Jmax are chloroplastic rates.</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_tpu">TPU</code></td>
<td>
<p>Triose-phosphate utilization rate (mu mol m-2 s-1); optional.</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_alphag">alphag</code></td>
<td>
<p>Fraction of glycolate not returned to the chloroplast; parameter in 
TPU-limited photosynthesis (optional, only to be used when TPU is provided) (0 - 1)</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_rd0">Rd0</code></td>
<td>
<p>Day respiration rate at reference temperature (<code>TrefR</code>). Must be a positive value.</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_q10">Q10</code></td>
<td>
<p>Temperature sensitivity of Rd.</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_rd">Rd</code></td>
<td>
<p>Day respiration rate (mu mol m-2 s-1), optional (if not provided, calculated 
from Tleaf, Rd0, Q10 and TrefR). Must be a positive value (an error occurs when a 
negative value is supplied).</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_trefr">TrefR</code></td>
<td>
<p>Reference temperature for Rd (Celcius).</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_rdayfrac">Rdayfrac</code></td>
<td>
<p>Ratio of Rd in the light vs. in the dark.</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_eav">EaV</code>, <code id="Photosyn_+3A_edvc">EdVC</code>, <code id="Photosyn_+3A_delsc">delsC</code></td>
<td>
<p>Vcmax temperature response parameters</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_eaj">EaJ</code>, <code id="Photosyn_+3A_edvj">EdVJ</code>, <code id="Photosyn_+3A_delsj">delsJ</code></td>
<td>
<p>Jmax temperature response parameters</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_km">Km</code>, <code id="Photosyn_+3A_gammastar">GammaStar</code></td>
<td>
<p>Optionally, provide Michaelis-Menten coefficient for Farquhar 
model, and Gammastar. If not provided, they are calculated with a built-in function 
of leaf temperature.</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_ci">Ci</code></td>
<td>
<p>Optional, intercellular CO2 concentration (ppm). If not provided, 
calculated via gs model.</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_tcorrect">Tcorrect</code></td>
<td>
<p>If TRUE, corrects input Vcmax and Jmax for actual Tleaf (if FALSE, 
assumes the provided Vcmax and Jmax are at the Tleaf provided). <strong>Warning</strong> : since package 
version 1.4, the default parameters have been adjusted (see Details).</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_returnparsonly">returnParsOnly</code></td>
<td>
<p>If TRUE, returns calculated Vcmax,Jmax,Km and GammaStar based on 
leaf temperature.</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_whicha">whichA</code></td>
<td>
<p>Which assimilation rate does gs respond to?</p>
</td></tr>
<tr><td><code id="Photosyn_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code>Photosyn</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The coupled photosynthesis - stomatal conductance model finds the intersection between 
the supply of CO2 by diffusion, and the demand for CO2 by photosynthesis. See Farquhar and 
Sharkey (1982) for basic description of this type of model, Duursma (2015) for more details 
on the implementation in the <code>plantecophys</code> package, and Duursma et al. (2014) for an 
example application (that uses this implementation).
</p>
<p><strong>Photosynthesis model and temperature response</strong> - 
The model of Farquhar et al. (1980) is used to estimate the dependence of leaf net 
photosynthesis rate (ALEAF) on intercellular CO2 concentration (Ci), accounting for all 
three limitations (electron transport, carboxylation, and TPU limitation). The equations 
for the temperature response of photosynthetic parameters, including Vcmax, Jmax, 
Gammastar, and Km follow Medlyn et al. (2002). However, <strong>note that the default 
temperature response parameter values are not taken from Medlyn, and likely will have to 
be adjusted for your situation</strong>. <strong>Warning</strong> : since package version 1.4, the default 
parameters have been adjusted. The new parameter values (EaV, EdVJ, delSJ, etc.) were based 
on a comprehensive literature review. See vignette(&quot;new_T_responses&quot;) or the article on 
remkoduursma.github.io/plantecophys.
</p>
<p>#'  By default, the <code>Photosyn</code> function returns the hyperbolic minimum of Vcmax and 
Jmax-limited photosynthetic rates, as well as the hyperbolic minimum of Jmax-limited and 
TPU-limited rates. This approach avoids the discontinuity at the transition between the 
two rates (thus allowing use of <code>Photosyn</code> and <code>fitaci</code> in optimization or 
fitting routines). The individual rates (Ac, Aj and Ap) are also returned as output 
should they be needed. Note that those rates are output as gross photosynthetic rates 
(leaf respiration has to be subtracted to give net leaf photosynthesis).
</p>
<p><strong>Coupled leaf gas exchange</strong>
When Ci is not provided, Ci is calculated from the intersection between the 'supply' and 
'demand', where 'demand' is given by the Farquhar model of photosynthesis (A=f(Ci)), and 
supply by the stomatal conductance. The latter is, by default, estimated using the 
stomatal conductance model of Medlyn et al. (2011), but two other models are provided 
as well (Ball-Berry and Leuning, see <code>gsmodel</code> argument). Otherwise, stomatal 
conductance may be directly provided via the <code>GS</code> argument. 
</p>
<p><strong>Stomatal conductance models</strong> -  
At the moment, three stomatal conductance models are implemented. The 'BBOpti' model 
is a slightly more general form of the model of Medlyn et al. 2011 (see Duursma et al. 
2013). It is given by (in notation of the parameters and output 
variables of <code>Photosyn</code>),
</p>
<p style="text-align: center;"><code class="reqn">GS = g0 + 1.6*(1 + g1/D^(1-gk))*ALEAF/CA</code>
</p>

<p>where <code>gk = 0.5</code> if stomata behave optimally (cf. Medlyn et al. 2011).
</p>
<p>The 'BBLeuning' model is that of Leuning (1995). It is given by,
</p>
<p style="text-align: center;"><code class="reqn">GS = g0 + g1*ALEAF/(Ca * (1 + VPD/D0))</code>
</p>

<p>Note that this model also uses the g1 parameter, but it needs to be set to 
a much higher value to be comparable in magnitude to the BBOpti model.
</p>
<p>The 'BallBerry' model is that of Ball et al. (1987). It is given by,
</p>
<p style="text-align: center;"><code class="reqn">GS = g0 + g1*RH*ALEAF/Ca</code>
</p>

<p>Where RH is relative humidity. Again, the g1 value is not comparable to that 
used in the previous two models.
</p>
<p>Finally, <code>Photosyn</code> provides a very flexible Ball-Berry model, where 
the multiplier has to be specified by the user, the model is:
</p>
<p style="text-align: center;"><code class="reqn">GS = g0 + BBmult*ALEAF</code>
</p>

<p>This interface can be used to quickly simulate what happens if stomata do 
not respond to humidity at all (in which case BBmult=g1/Ca, or ca. 5/400), or 
to use the Tuzet model of stomatal conductance inside another model that provides 
the leaf water potential function.
</p>
<p>For the full numerical solution to the Cowan-Farquhar optimization, use 
the <code><a href="#topic+FARAO">FARAO</a></code> function (which was used in Medlyn et al. 2011 for 
comparison to the approximation there presented). See Duursma (2015) for more details.
</p>
<p><strong>Mesophyll conductance</strong> - 
</p>
<p>If the mesophyll conductance <code>gmeso</code> is provided as an input, it is assumed 
that Vcmax and Jmax are the chloroplastic rates, and leaf photosynthesis is 
calculated following the equations from Ethier and Livingston (2004). When very 
low mesophyll conductance rates are input, the model may return poor solutions 
(and sometimes they may not exist).
</p>
<p><strong>Simulating A-Ci curves</strong>
</p>
<p>If Ci is provided as an input, this function calculates an A-Ci curve. For 
example, you may do <code>Photosyn(Ci=300)</code>, for which the function <code>Aci</code> 
is included as a shortcut (<code>Aci(300)</code>).
</p>
<p><strong>Atmospheric pressure</strong> - 
</p>
<p>A correction for atmospheric pressure (Patm) is implemented in <code><a href="#topic+fitaci">fitaci</a></code>, 
but <strong>not in Photosyn</strong>. In <code>fitaci</code>, the necessary corrections are applied 
so that estimated Vcmax and Jmax are expressed at standard pressure (Patm=100kPa). 
In Photosyn, however, the corrections are much more complicated and tend to be very 
small, because effects of Patm on partial pressures are largely offset by increases 
in diffusivity (Terashima et al. 1995, Gale 1973). 
</p>
<p>Note that Patm is an argument to the Photosyn function, but it only affects 
calculations of Km and GammaStar (as used by fitaci), and transpiration rate. 
Setting only Patm <strong>does not correct for atmospheric pressure effects on 
photosynthesis rates</strong>.
</p>
<p>The simulation of limitation of the photosynthetic rate to triose-phosphate 
utilization follows details in Ellsworth et al. (2015), their Eq. 7. Note that 
the parameter <code>alphag</code> is set to zero by default.
</p>


<h3>Value</h3>

<p>Returns a dataframe.
</p>


<h3>References</h3>

<p>Duursma, R.A., Payton, P., Bange, M.P., Broughton, K.J., Smith, R.A., Medlyn, B.E., Tissue, 
D. T., 2013,  Near-optimal response of instantaneous transpiration efficiency to vapour 
pressure deficit, temperature and [CO2] in cotton (Gossypium hirsutum L.). Agricultural 
and Forest Meteorology 168 : 168 - 176.
</p>
<p>Duursma, R.A., Barton, C.V.M., Lin, Y.-S., Medlyn, B.E., Eamus, D., Tissue, D.T., Ellsworth, 
D.S., McMurtrie, R.E., 2014. The peaked response of transpiration rate to vapour pressure 
deficit in field conditions can be explained by the temperature optimum of photosynthesis.
Agricultural and Forest Meteorology 189 - 190, 2-10. doi:10.1016/j.agrformet.2013.12.007
</p>
<p>Duursma, R.A., 2015. Plantecophys - An R Package for Analysing and Modelling Leaf Gas 
Exchange Data. PLoS ONE 10, e0143346. doi:10.1371/journal.pone.0143346
</p>
<p>Ellsworth, D.S., Crous, K.Y., Lambers, H., Cooke, J., 2015. Phosphorus recycling in 
photorespiration maintains high photosynthetic capacity in woody species. Plant Cell 
Environ 38, 1142-1156. doi:10.1111/pce.12468
</p>
<p>Ethier, G. and N. Livingston. 2004. On the need to incorporate sensitivity to CO2 
transfer conductance into the Farquhar von Caemmerer Berry leaf photosynthesis model. 
Plant, Cell &amp; Environment. 27:137-153.
</p>
<p>Farquhar, G.D., S. Caemmerer and J.A. Berry. 1980. A biochemical model of photosynthetic 
CO2 assimilation in leaves of C3 species. Planta. 149:78-90.
</p>
<p>Farquhar, G. D., &amp; Sharkey, T. D. (1982). Stomatal conductance and photosynthesis. 
Annual review of plant physiology, 33(1), 317-345.
</p>
<p>Gale, J., 1972. Availability of Carbon Dioxide for Photosynthesis at High Altitudes: 
Theoretical Considerations. Ecology 53, 494-497. doi:10.2307/1934239
</p>
<p>Leuning, R. 1995. A critical-appraisal of a combined stomatal-photosynthesis model for 
C-3 plants. Plant Cell and Environment. 18:339-355.
</p>
<p>Medlyn, B.E., E. Dreyer, D. Ellsworth, M. Forstreuter, P.C. Harley, M.U.F. Kirschbaum, 
X. Le Roux, P. Montpied, J. Strassemeyer, A. Walcroft, K. Wang and D. Loustau. 2002. 
Temperature response of parameters of a biochemically based model of photosynthesis. 
II. A review of experimental data. Plant Cell and Environment. 25:1167-1179.
</p>
<p>Medlyn, B.E., R.A. Duursma, D. Eamus, D.S. Ellsworth, I.C. Prentice, C.V.M. Barton, 
K.Y. Crous, P. De Angelis, M. Freeman and L. Wingate. 2011. Reconciling the optimal 
and empirical approaches to modelling stomatal conductance. Global Change Biology. 
17:2134-2144.
</p>
<p>Terashima, I., Masuzawa, T., Ohba, H., Yokoi, Y., 1995. Is photosynthesis suppressed at 
higher elevations due to low CO2 pressure? Ecology 76, 2663-2668. doi:10.2307/2265838
</p>


<h3>See Also</h3>

<p><code><a href="#topic+FARAO">FARAO</a></code>, <code><a href="#topic+fitaci">fitaci</a></code>, <code><a href="#topic+AciC4">AciC4</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Run the coupled leaf gas exchange model, set only a couple of parameters
Photosyn(VPD=2, g1=4, Ca=500)

# It is easy to set multiple values for inputs (and these can be mixed with single inputs);
r &lt;- Photosyn(VPD=seq(0.5, 4, length=25), Vcmax=50, Jmax=100)
with(r, plot(VPD, ALEAF, type='l'))

# Set the mesophyll conductance
run1 &lt;- Photosyn(PPFD=seq(50,1000,length=25), gmeso=0.15, Vcmax=40, Jmax=85)
with(run1, plot(PPFD, GS, type='l'))

# Run A-Ci curve only (provide Ci instead of calculating it).
arun1 &lt;- Aci(Ci=seq(50, 1200, length=101), Vcmax=40, Jmax=85)
arun2 &lt;- Aci(Ci=seq(50, 1200, length=101), Vcmax=30, Jmax=70)
with(arun1, plot(Ci, ALEAF, type='l'))
with(arun2, points(Ci, ALEAF, type='l', lty=5))

# Find the intersection between supply of CO2 and demand for CO2 (cf. Farquhar and Sharkey 1982).

# Set some parameters
gs &lt;- 0.2  # stomatal conductance to H2O
Ca &lt;- 400  # ambient CO2
gctogw &lt;- 1.57  # conversion
gc &lt;- gs / gctogw  # stomatal conductance to CO2

# Demand curve (Farquhar model)
p &lt;- Aci(seq(60,500,length=101), Ca=400)

# Provide stomatal conductance as input, gives intersection point.
g &lt;- Photosyn(GS=gs, Ca=Ca)

# Intersection point visualized
par(yaxs="i")
with(p, plot(Ci, ALEAF, type='l', ylim=c(0,max(ALEAF))))
with(g, points(Ci, ALEAF, pch=19, col="red"))
abline(gc * Ca, -gc, lty=5)

legend("topleft", c(expression("Demand:"~~A==f(C[i])),
                    expression("Supply:"~~A==g[c]*(C[a]-C[i])),
                    "Operating point"),
       lty=c(1,5,-1),pch=c(-1,-1,19),
       col=c("black","black","red"),
       bty='n', cex=0.9)
</code></pre>

<hr>
<h2 id='PhotosynEB'>Coupled leaf gas exchange model with energy balance</h2><span id='topic+PhotosynEB'></span><span id='topic+FindTleaf'></span>

<h3>Description</h3>

<p>As <code><a href="#topic+Photosyn">Photosyn</a></code>, but calculates the leaf temperature based on the leaf's energy balance. Including sensible and long-wave heat loss, latent heat loss from evaporation, and solar radiation input. 
</p>
<p>#'<strong>Warning:</strong>Do not provide GS as an input to <code>PhotosynEB</code> directly; the results will not be as expected (filed as issue #27)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PhotosynEB(
  Tair = 25,
  VPD = 1.5,
  Wind = 2,
  Wleaf = 0.02,
  StomatalRatio = 1,
  LeafAbs = 0.86,
  RH = NULL,
  ...
)

FindTleaf(gs, Tair, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PhotosynEB_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (C)</p>
</td></tr>
<tr><td><code id="PhotosynEB_+3A_vpd">VPD</code></td>
<td>
<p>The vapour pressure deficit of the air (i.e. not the leaf-to-air VPD) (kPa).</p>
</td></tr>
<tr><td><code id="PhotosynEB_+3A_wind">Wind</code></td>
<td>
<p>Wind speed (m s-1)</p>
</td></tr>
<tr><td><code id="PhotosynEB_+3A_wleaf">Wleaf</code></td>
<td>
<p>Leaf width (m)</p>
</td></tr>
<tr><td><code id="PhotosynEB_+3A_stomatalratio">StomatalRatio</code></td>
<td>
<p>The stomatal ratio (cf. Licor6400 terminology), if it is 1, leaves have stomata only on one side (hypostomatous), 2 for leaves with stomata on both sides (amphistomatous).</p>
</td></tr>
<tr><td><code id="PhotosynEB_+3A_leafabs">LeafAbs</code></td>
<td>
<p>Leaf absorptance of solar radiation (0-1).</p>
</td></tr>
<tr><td><code id="PhotosynEB_+3A_rh">RH</code></td>
<td>
<p>The relative humidity of the air (i.e. not calculated with leaf temperature) (in percent).</p>
</td></tr>
<tr><td><code id="PhotosynEB_+3A_...">...</code></td>
<td>
<p>Further parameters passed to <code><a href="#topic+Photosyn">Photosyn</a></code>. Note that Tleaf is not allowed as an input, since that is calculated by <code>PhotosynEB</code> from energy balance.</p>
</td></tr>
<tr><td><code id="PhotosynEB_+3A_gs">gs</code></td>
<td>
<p>For <code>FindTleaf</code>, the stomatal conductance (mol m-2 s-1).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Uses the Penman-Monteith equation to calculate the leaf transpiration rate, and finds Tleaf by solving the leaf energy balance iteratively. In the solution, it is accounted for that stomatal conductance (via the dependence of photosynthesis on Tleaf) and net radiation depend on Tleaf.
</p>
<p>Also included is the function <code>FindTleaf</code>, which calculates the leaf temperature if the stomatal conductance is known. The <strong>limitation</strong> to this function is that input stomatal conductance (gs) is not vectorized, i.e. you can only provide one value at a time.
</p>

<hr>
<h2 id='PhotosynTuzet'>Coupled leaf gas exchange model with Tuzet stomatal conductance</h2><span id='topic+PhotosynTuzet'></span>

<h3>Description</h3>

<p>An implementation of the coupled photosynthesis - stomatal conductance model, using the Tuzet et al. (2003) model of stomatal conductance. Accepts all arguments of <code><a href="#topic+Photosyn">Photosyn</a></code> (except <code>gsmodel</code>, of course).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PhotosynTuzet(g1 = 8, Ca = 400, psis = 0, kl = 2, sf = 3, psif = -2, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PhotosynTuzet_+3A_g1">g1</code></td>
<td>
<p>The slope parameter. Note that the default value should be much higher than that used in the Medlyn et al. (2011) model to give comparable predictions.</p>
</td></tr>
<tr><td><code id="PhotosynTuzet_+3A_ca">Ca</code></td>
<td>
<p>Atmospheric CO2 concentration.</p>
</td></tr>
<tr><td><code id="PhotosynTuzet_+3A_psis">psis</code></td>
<td>
<p>Soil water potential (MPa). Note that soil-to-root hydraulic conductance is not implemented.</p>
</td></tr>
<tr><td><code id="PhotosynTuzet_+3A_kl">kl</code></td>
<td>
<p>Leaf-specific hydraulic conductance (mmol m-2 s-1 MPa-1)</p>
</td></tr>
<tr><td><code id="PhotosynTuzet_+3A_sf">sf</code></td>
<td>
<p>Shape parameter (-) of sigmoidal function of leaf water potential (see Tuzet et al. 2003)</p>
</td></tr>
<tr><td><code id="PhotosynTuzet_+3A_psif">psif</code></td>
<td>
<p>Leaf water potential at which stomatal conductance is 50% of maximum (MPa).</p>
</td></tr>
<tr><td><code id="PhotosynTuzet_+3A_...">...</code></td>
<td>
<p>All other arguments in <code><a href="#topic+Photosyn">Photosyn</a></code></p>
</td></tr>
</table>

<hr>
<h2 id='RHtoVPD'>Conversions between relative humidity, vapour pressure deficit and dewpoint</h2><span id='topic+RHtoVPD'></span><span id='topic+VPDtoRH'></span><span id='topic+esat'></span><span id='topic+VPDtoDew'></span><span id='topic+DewtoVPD'></span><span id='topic+VPDleafToAir'></span><span id='topic+VPDairToLeaf'></span><span id='topic+RHleafToAir'></span><span id='topic+RHairToLeaf'></span>

<h3>Description</h3>

<p>A collection of functions to convert between relative humidity (RH) (%), 
vapour pressure deficit (VPD) (kPa), 
dew point temperature, and leaf- or air temperature-based VPD or RH. To convert from 
relative humidity to VPD, 
use the <code>RHtoVPD</code> function,  use <code>VPDtoRH</code> for the other way around. The water 
vapor saturation pressure is 
calculated with <code>esat</code>. Use <code>DewtoVPD</code> to 
convert from dewpoint temperature to VPD. The functions <code>VPDleafToAir</code> and <code>VPDairToLeaf</code>
convert VPD from a leaf temperature to an air-temperature basis and vice versa. The 
functions <code>RHleafToAir</code> a <code>RHairToLeaf</code> do the same for relative humidity.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RHtoVPD(RH, TdegC, Pa = 101)

VPDtoRH(VPD, TdegC, Pa = 101)

esat(TdegC, Pa = 101)

VPDtoDew(VPD, TdegC, Pa = 101)

DewtoVPD(Tdew, TdegC, Pa = 101)

VPDleafToAir(VPD, Tleaf, Tair, Pa = 101)

VPDairToLeaf(VPD, Tair, Tleaf, Pa = 101)

RHleafToAir(RH, Tleaf, Tair, Pa = 101)

RHairToLeaf(RH, Tair, Tleaf, Pa = 101)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="RHtoVPD_+3A_rh">RH</code></td>
<td>
<p>Relative humidity (%)</p>
</td></tr>
<tr><td><code id="RHtoVPD_+3A_tdegc">TdegC</code></td>
<td>
<p>Temperature (degrees C) (either leaf or air)</p>
</td></tr>
<tr><td><code id="RHtoVPD_+3A_pa">Pa</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="RHtoVPD_+3A_vpd">VPD</code></td>
<td>
<p>Vapour pressure deficit (kPa)</p>
</td></tr>
<tr><td><code id="RHtoVPD_+3A_tdew">Tdew</code></td>
<td>
<p>Dewpoint temperature (degrees C)</p>
</td></tr>
<tr><td><code id="RHtoVPD_+3A_tleaf">Tleaf</code></td>
<td>
<p>Leaf temperature (degrees C)</p>
</td></tr>
<tr><td><code id="RHtoVPD_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (degrees C)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function describing saturated vapor pressure with temperature is taken from 
Jones (1992). All other calculations follow directly from the standard definitions, for
which Jones (1992) may also be consulted.
</p>


<h3>Author(s)</h3>

<p>Remko Duursma
</p>


<h3>References</h3>

<p>Jones, H.G. 1992. Plants and microclimate: a quantitative approach to 
environmental plant physiology. 2nd Edition., 2nd Edn. Cambridge University Press, Cambridge. 428 p.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
