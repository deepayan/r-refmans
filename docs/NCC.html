<!DOCTYPE html><html lang="en"><head><title>Help for package NCC</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {NCC}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#all_models'><p>Wrapper function for simulations performing inference on given treatment arms using given models</p></a></li>
<li><a href='#datasim_bin'><p>Simulate binary data from a platform trial with a shared control arm and a given number of experimental treatment arms entering at given time points</p></a></li>
<li><a href='#datasim_cont'><p>Simulate continuous data from a platform trial with a shared control arm and a given number of experimental treatment arms entering at given time points</p></a></li>
<li><a href='#fixmodel_bin'><p>Frequentist logistic regression model analysis for binary data adjusting for periods</p></a></li>
<li><a href='#fixmodel_cal_bin'><p>Frequentist logistic regression model analysis for binary data adjusting for calendar time units</p></a></li>
<li><a href='#fixmodel_cal_cont'><p>Frequentist linear regression model analysis for continuous data adjusting for calendar time units</p></a></li>
<li><a href='#fixmodel_cont'><p>Frequentist linear regression model analysis for continuous data adjusting for periods</p></a></li>
<li><a href='#gam_cont'><p>Generalized additive model analysis for continuous data</p></a></li>
<li><a href='#get_ss_matrix'><p>Sample size matrix for a platform trial with a given number of treatment arms</p></a></li>
<li><a href='#inv_u_trend'><p>Generation of an inverted-u trend</p></a></li>
<li><a href='#linear_trend'><p>Generation of a linear trend that starts in a given period</p></a></li>
<li><a href='#MAPprior_bin'><p>Analysis for binary data using the MAP Prior approach</p></a></li>
<li><a href='#MAPprior_cont'><p>Analysis for continuous data using the MAP Prior approach</p></a></li>
<li><a href='#mixmodel_AR1_cal_cont'><p>Mixed regression model analysis for continuous data adjusting for calendar time units as a random factor with AR1 correlation structure</p></a></li>
<li><a href='#mixmodel_AR1_cont'><p>Mixed regression model analysis for continuous data adjusting for periods as a random factor with AR1 correlation structure</p></a></li>
<li><a href='#mixmodel_cal_cont'><p>Mixed regression model analysis for continuous data adjusting for calendar time units as a random factor</p></a></li>
<li><a href='#mixmodel_cont'><p>Mixed regression model analysis for continuous data adjusting for periods as a random factor</p></a></li>
<li><a href='#piecewise_cal_cont'><p>Model-based analysis for continuous data using discontinuous piecewise polynomials per calendar time unit</p></a></li>
<li><a href='#piecewise_cont'><p>Model-based analysis for continuous data using discontinuous piecewise polynomials per period</p></a></li>
<li><a href='#plot_trial'><p>Function for visualizing the simulated trial</p></a></li>
<li><a href='#poolmodel_bin'><p>Pooled analysis for binary data</p></a></li>
<li><a href='#poolmodel_cont'><p>Pooled analysis for continuous data</p></a></li>
<li><a href='#seasonal_trend'><p>Generation of a seasonal trend</p></a></li>
<li><a href='#sepmodel_adj_bin'><p>Separate analysis for binary data adjusted for periods</p></a></li>
<li><a href='#sepmodel_adj_cont'><p>Separate analysis for continuous data adjusted for periods</p></a></li>
<li><a href='#sepmodel_bin'><p>Separate analysis for binary data</p></a></li>
<li><a href='#sepmodel_cont'><p>Separate analysis for continuous data</p></a></li>
<li><a href='#sim_study'><p>Wrapper function performing simulation studies for a given set of scenarios (not parallelized)</p></a></li>
<li><a href='#sim_study_par'><p>Wrapper function performing simulation studies for a given set of scenarios (parallelized on replication level)</p></a></li>
<li><a href='#splines_cal_cont'><p>Spline regression analysis for continuous data with knots placed according to calendar time units</p></a></li>
<li><a href='#splines_cont'><p>Spline regression analysis for continuous data with knots placed according to periods</p></a></li>
<li><a href='#sw_trend'><p>Generation of stepwise trend with equal jumps between periods</p></a></li>
<li><a href='#timemachine_bin'><p>Time machine analysis for binary data</p></a></li>
<li><a href='#timemachine_cont'><p>Time machine analysis for continuous data</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Simulation and Analysis of Platform Trials with Non-Concurrent
Controls</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0</td>
</tr>
<tr>
<td>Author:</td>
<td>Pavla Krotka <a href="https://orcid.org/0000-0001-5727-4270"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Marta Bofill Roig <a href="https://orcid.org/0000-0002-4400-7541"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, ths],
  Katharina Hees [aut],
  Peter Jacko [aut],
  Dominic Magirr [aut],
  Martin Posch <a href="https://orcid.org/0000-0001-8499-8573"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Pavla Krotka &lt;pavla.krotka@meduniwien.ac.at&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Design and analysis of flexible platform trials with non-concurrent controls. Functions for data generation, analysis, visualization and running simulation studies are provided. 
    The implemented analysis methods are described in: 
    Bofill Roig et al. (2022) &lt;<a href="https://doi.org/10.1186%2Fs12874-022-01683-w">doi:10.1186/s12874-022-01683-w</a>&gt;, 
    Saville et al. (2022) &lt;<a href="https://doi.org/10.1177%2F17407745221112013">doi:10.1177/17407745221112013</a>&gt; and 
    Schmidli et al. (2014) &lt;<a href="https://doi.org/10.1111%2Fbiom.12242">doi:10.1111/biom.12242</a>&gt;.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://pavlakrotka.github.io/NCC/">https://pavlakrotka.github.io/NCC/</a>,
<a href="https://github.com/pavlakrotka/NCC">https://github.com/pavlakrotka/NCC</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Imports:</td>
<td>rlang, stats, RBesT, rjags, ggplot2, lmerTest, parallel,
doParallel, parallelly, foreach, iterators, spaMM, mgcv,
splines, magick</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>rmarkdown, knitr</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-03-02 20:16:03 UTC; pavla</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-03-03 09:10:10 UTC</td>
</tr>
</table>
<hr>
<h2 id='all_models'>Wrapper function for simulations performing inference on given treatment arms using given models</h2><span id='topic+all_models'></span>

<h3>Description</h3>

<p>This function analyzes given data using different models as indicated by the user. It performs inference for indicated experimental treatment arms.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>all_models(
  data,
  arms,
  models = c("fixmodel", "sepmodel", "poolmodel"),
  endpoint,
  alpha = 0.025,
  unit_size = 250,
  ncc = TRUE,
  opt = 2,
  prior_prec_tau = 4,
  prior_prec_eta = 0.001,
  n_samples = 1000,
  n_chains = 4,
  n_iter = 4000,
  n_adapt = 1000,
  robustify = TRUE,
  weight = 0.1,
  ci = FALSE,
  prec_theta = 0.001,
  prec_eta = 0.001,
  tau_a = 0.1,
  tau_b = 0.01,
  prec_a = 0.001,
  prec_b = 0.001,
  bucket_size = 25,
  smoothing_basis = "tp",
  basis_dim = -1,
  gam_method = "GCV.Cp",
  bs_degree = 3,
  poly_degree = 3
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="all_models_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_bin()</code> or <code>datasim_cont()</code> function.</p>
</td></tr>
<tr><td><code id="all_models_+3A_arms">arms</code></td>
<td>
<p>Integer vector with treatment arms to perform inference on. These arms are compared to the control group. Default - all arms except the first one.</p>
</td></tr>
<tr><td><code id="all_models_+3A_models">models</code></td>
<td>
<p>Character vector with models that should be used for the analysis. Default=c(&quot;fixmodel&quot;, &quot;sepmodel&quot;, &quot;poolmodel&quot;). Available models for continuous endpoints are: 'fixmodel', 'fixmodel_cal', 'gam', 'MAPprior', 'mixmodel', 'mixmodel_cal', 'mixmodel_AR1', 'mixmodel_AR1_cal', 'piecewise', 'piecewise_cal', 'poolmodel', 'sepmodel', 'sepmodel_adj', 'splines', 'splines_cal', 'timemachine'. Available models for binary endpoints are: 'fixmodel', 'fixmodel_cal', 'MAPprior', 'poolmodel', 'sepmodel', 'sepmodel_adj', 'timemachine'.</p>
</td></tr>
<tr><td><code id="all_models_+3A_endpoint">endpoint</code></td>
<td>
<p>Endpoint indicator. &quot;cont&quot; for continuous endpoints, &quot;bin&quot; for binary endpoints.</p>
</td></tr>
<tr><td><code id="all_models_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="all_models_+3A_unit_size">unit_size</code></td>
<td>
<p>Integer. Number of patients per calendar time unit for frequentist models adjusting for calendar time. Default=25.</p>
</td></tr>
<tr><td><code id="all_models_+3A_ncc">ncc</code></td>
<td>
<p>Logical. Whether to include NCC data into the analysis using frequentist models. Default=TRUE.</p>
</td></tr>
<tr><td><code id="all_models_+3A_opt">opt</code></td>
<td>
<p>Integer (1 or 2). In the MAP Prior approach, if opt==1, all former periods are used as one source; if opt==2, periods get separately included into the final analysis. Default=2.</p>
</td></tr>
<tr><td><code id="all_models_+3A_prior_prec_tau">prior_prec_tau</code></td>
<td>
<p>Double. Dispersion parameter of the half normal prior, the prior for the between study heterogeneity in the MAP Prior approach. Default=4.</p>
</td></tr>
<tr><td><code id="all_models_+3A_prior_prec_eta">prior_prec_eta</code></td>
<td>
<p>Double. Dispersion parameter of the normal prior, the prior for the control response (log-odds or mean) in the MAP Prior approach. Default=0.001.</p>
</td></tr>
<tr><td><code id="all_models_+3A_n_samples">n_samples</code></td>
<td>
<p>Integer. Number of how many random samples will get drawn for the calculation of the posterior mean, the p-value and the CI's in the MAP Prior approach. Default=1000.</p>
</td></tr>
<tr><td><code id="all_models_+3A_n_chains">n_chains</code></td>
<td>
<p>Integer. Number of parallel chains for the rjags model in the MAP Prior approach. Default=4.</p>
</td></tr>
<tr><td><code id="all_models_+3A_n_iter">n_iter</code></td>
<td>
<p>Integer. Number of iterations to monitor of the jags.model. Needed for coda.samples in the MAP Prior approach. Default=4000.</p>
</td></tr>
<tr><td><code id="all_models_+3A_n_adapt">n_adapt</code></td>
<td>
<p>Integer. Number of iterations for adaptation, an initial sampling phase during which the samplers adapt their behavior to maximize their efficiency. Needed for jags.model in the MAP Prior approach. Default=1000.</p>
</td></tr>
<tr><td><code id="all_models_+3A_robustify">robustify</code></td>
<td>
<p>Logical. Indicates whether a robust prior is to be used. If TRUE, a mixture prior is considered combining a MAP prior and a weakly non-informative component prior. Default=TRUE.</p>
</td></tr>
<tr><td><code id="all_models_+3A_weight">weight</code></td>
<td>
<p>Double. Weight given to the non-informative component (0 &lt; weight &lt; 1) for the robustification of the MAP Prior according to Schmidli (2014). Default=0.1.</p>
</td></tr>
<tr><td><code id="all_models_+3A_ci">ci</code></td>
<td>
<p>Logical. Whether confidence intervals for the mixed models should be computed. Default=FALSE.</p>
</td></tr>
<tr><td><code id="all_models_+3A_prec_theta">prec_theta</code></td>
<td>
<p>Double. Precision (<code class="reqn">1/\sigma^2_{\theta}</code>) of the prior regarding the treatment effect <code class="reqn">\theta</code>. I.e. <code class="reqn">\theta \sim N(0, \sigma^2_{\theta})</code> . Default=0.001.</p>
</td></tr>
<tr><td><code id="all_models_+3A_prec_eta">prec_eta</code></td>
<td>
<p>Double. Precision (<code class="reqn">1/\sigma^2_{\eta_0}</code>) of the prior regarding the control response <code class="reqn">\eta_0</code>. I.e. <code class="reqn">\eta_0 \sim N(0, \sigma^2_{\eta_0})</code>. Default=0.001.</p>
</td></tr>
<tr><td><code id="all_models_+3A_tau_a">tau_a</code></td>
<td>
<p>Double. Parameter <code class="reqn">a</code> of the Gamma distribution for the precision parameter <code class="reqn">\tau</code> in the model for the time trend in the Time Machine approach. I.e., <code class="reqn">\tau \sim Gamma(a,b)</code>. Default=0.1.</p>
</td></tr>
<tr><td><code id="all_models_+3A_tau_b">tau_b</code></td>
<td>
<p>Double. Parameter <code class="reqn">b</code> of the Gamma distribution for the precision parameter <code class="reqn">\tau</code> in the model for the time trend in the Time Machine approach. I.e., <code class="reqn">\tau \sim Gamma(a,b)</code>. Default=0.01.</p>
</td></tr>
<tr><td><code id="all_models_+3A_prec_a">prec_a</code></td>
<td>
<p>Double. Parameter <code class="reqn">a</code> of the Gamma distribution regarding the precision of the responses for continuous endpoints in the Time Machine approach. I.e., <code class="reqn">\sigma \sim Gamma(a,b)</code>. Default=0.001.</p>
</td></tr>
<tr><td><code id="all_models_+3A_prec_b">prec_b</code></td>
<td>
<p>Double. Parameter <code class="reqn">b</code> of the Gamma distribution regarding the precision of the responses for continuous endpoints in the Time Machine approach. I.e., <code class="reqn">\sigma \sim Gamma(a,b)</code>. Default=0.001.</p>
</td></tr>
<tr><td><code id="all_models_+3A_bucket_size">bucket_size</code></td>
<td>
<p>Integer. Number of patients per time bucket in the Time Machine approach. Default=25.</p>
</td></tr>
<tr><td><code id="all_models_+3A_smoothing_basis">smoothing_basis</code></td>
<td>
<p>String indicating the (penalized) smoothing basis to use in the GAM models. Default=&quot;tp&quot;.</p>
</td></tr>
<tr><td><code id="all_models_+3A_basis_dim">basis_dim</code></td>
<td>
<p>Integer. The dimension of the basis used to represent the smooth term in the GAM models. The default depends on the number of variables that the smooth is a function of. Default=-1.</p>
</td></tr>
<tr><td><code id="all_models_+3A_gam_method">gam_method</code></td>
<td>
<p>String indicating the smoothing parameter estimation method for the GAM models. Default=&quot;GCV.Cp&quot;.</p>
</td></tr>
<tr><td><code id="all_models_+3A_bs_degree">bs_degree</code></td>
<td>
<p>Integer. Degree of the polynomial splines. Default=3.</p>
</td></tr>
<tr><td><code id="all_models_+3A_poly_degree">poly_degree</code></td>
<td>
<p>Integer. Degree of the discontinuous piecewise polynomials. Default=3.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List containing an indicator whether the null hypothesis was rejected or not, and the estimated treatment effect for all investigated treatment arms and all models.
</p>


<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_bin(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
p0 = 0.7, OR = rep(1.8, 3), lambda = rep(0.15, 4), trend="stepwise")

all_models(data = trial_data, arms = c(2,3), endpoint = "bin")


</code></pre>

<hr>
<h2 id='datasim_bin'>Simulate binary data from a platform trial with a shared control arm and a given number of experimental treatment arms entering at given time points</h2><span id='topic+datasim_bin'></span>

<h3>Description</h3>

<p>This function simulates data from a platform trial with a given number of experimental treatment arms entering at given time points and a shared control arm. The primary endpoint is a binary endpoint. The user specifies the timing of adding arms in terms of patients recruited to the trial so far and the sample size per experimental treatment arm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>datasim_bin(
  num_arms,
  n_arm,
  d,
  period_blocks = 2,
  p0,
  OR,
  lambda,
  trend,
  N_peak,
  n_wave,
  full = FALSE,
  check = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="datasim_bin_+3A_num_arms">num_arms</code></td>
<td>
<p>Integer. Number of experimental treatment arms in the trial.</p>
</td></tr>
<tr><td><code id="datasim_bin_+3A_n_arm">n_arm</code></td>
<td>
<p>Integer. Sample size per experimental treatment arm (assumed equal).</p>
</td></tr>
<tr><td><code id="datasim_bin_+3A_d">d</code></td>
<td>
<p>Integer vector with timings of adding new arms in terms of number of patients recruited to the trial so far. The first entry must be 0, so that the trial starts with at least one experimental treatment arm, and the entries must be non-decreasing. The vector length equals <code>num_arms</code>.</p>
</td></tr>
<tr><td><code id="datasim_bin_+3A_period_blocks">period_blocks</code></td>
<td>
<p>Integer. Number to define the size of the blocks for the block randomization. The block size in each period equals <code>period_blocks</code>times the number of active arms in the period (see Details). Default=2.</p>
</td></tr>
<tr><td><code id="datasim_bin_+3A_p0">p0</code></td>
<td>
<p>Double. Response probability in the control arm.</p>
</td></tr>
<tr><td><code id="datasim_bin_+3A_or">OR</code></td>
<td>
<p>Double vector with treatment effects in terms of odds ratios for each experimental treatment arm compared to control. The elements of the vector (odds ratios) are ordered by the entry time of the experimental treatment arms (e.g., the first entry in the vector corresponds to the odds ratio of the first experimental treatment arm). The vector length equals <code>num_arms</code>.</p>
</td></tr>
<tr><td><code id="datasim_bin_+3A_lambda">lambda</code></td>
<td>
<p>Double vector with strength of time trend in each arm ordered by the entry time of the arms (e.g., the first entry in the vector corresponds to the time trend in the control arm, second entry to the time trend in the first experimental treatment arm). The vector length equals <code>num_arms</code>+1, as time trend in the control is also allowed.</p>
</td></tr>
<tr><td><code id="datasim_bin_+3A_trend">trend</code></td>
<td>
<p>String indicating the time trend pattern (&quot;linear&quot;, &quot;linear_2, &quot;stepwise&quot;, &quot;stepwise_2&quot;, &quot;inv_u&quot; or &quot;seasonal&quot;). See Details for more information.</p>
</td></tr>
<tr><td><code id="datasim_bin_+3A_n_peak">N_peak</code></td>
<td>
<p>Integer. Timepoint at which the inverted-u time trend switches direction in terms of overall sample size (i.e. after how many recruited participants the trend direction switches).</p>
</td></tr>
<tr><td><code id="datasim_bin_+3A_n_wave">n_wave</code></td>
<td>
<p>Integer. Number of cycles (waves) should the seasonal trend have.</p>
</td></tr>
<tr><td><code id="datasim_bin_+3A_full">full</code></td>
<td>
<p>Logical. Indicates whether the output should be in form of a data frame with variables needed for the analysis only (FALSE) or in form of a list containing more information (TRUE). Default=FALSE.</p>
</td></tr>
<tr><td><code id="datasim_bin_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Design assumptions:</strong>
</p>

<ul>
<li><p> The simulated platform trial consists of a given number of experimental treatment arms (specified by the argument <code>num_arms</code>) and one control arm that is shared across the whole platform.
</p>
</li>
<li><p> Participants are indexed by entry order, assuming that at each time unit exactly one participant is recruited and the time of recruitment and observation of the response are equal.
</p>
</li>
<li><p> All participants are assumed to be eligible for all arms in the trial, i.e. the same inclusion and exclusion criteria apply to all experimental and control arms.
</p>
</li>
<li><p> Equal sample sizes (given by parameter <code>n_arm</code>) in all experimental treatment arms are assumed.
</p>
</li>
<li><p> The duration of the trial is divided into so-called periods, defined as time intervals bounded by distinct time points of any treatment arm entering or leaving the platform.
Hence, multiple treatment arms entering or leaving at the same time point imply the start of only one additional period.
</p>
</li>
<li><p> Allocation ratio of 1:1:...:1 in each period. Furthermore, block randomization is used to assign patients to the active arms. Block size in each period = <code>period_blocks</code>* (number of active arms in the period).
</p>
</li>
<li><p> If the period sample size is not a multiple of the block size, arms for the remaining participants are chosen by sampling without replacement from a vector containing the indices of active arms replicated times <code style="white-space: pre;">&#8288;ceiling(remaining sample size/number of active arms)&#8288;</code>.
</p>
</li></ul>

<p><strong>Data generation:</strong>
</p>
<p>The binary response <code class="reqn">y_j</code> for patient <code class="reqn">j</code> is generated according to:
</p>
<p style="text-align: center;"><code class="reqn">g(E(y_j)) = \eta_0 + \sum_{k=1}^K \cdot I(k_j=k) + f(j)</code>
</p>

<p>where <code class="reqn">g(\cdot)</code> is the logit link function, and <code class="reqn">\eta_0</code> (logit function of parameter <code>p0</code>) and <code class="reqn">\theta_k</code> (log of the parameter <code>OR</code>) are the log odds in the control arm and the log odds ratio of treatment <code class="reqn">k</code>. <code class="reqn">K</code> is the total number of treatment arms in the trial (parameter <code>num_arms</code>) and <code class="reqn">k_j</code> is an indicator of the treatment arm patient <code class="reqn">j</code> is allocated to.
</p>
<p>The function <code class="reqn">f(j)</code> denotes the time trend, whose strength is indicated by <code class="reqn">\lambda_{k_j}</code> (parameter <code>lambda</code>) and which can have the following patterns (parameter <code>trend</code>):
</p>

<ul>
<li> <p><strong>&quot;linear&quot;</strong> - trend starts at the beginning of the trial and the log odds increases or decreases linearly with a slope of <code class="reqn">\lambda</code>, according to the function <code class="reqn">f(j) = \lambda \cdot \frac{j-1}{N-1}</code>, where <code class="reqn">N</code> is the total sample size in the trial
</p>
</li>
<li> <p><strong>&quot;linear_2&quot;</strong> - trend starts after the first period (i.e. there is no time trend in the first period) and the log odds increases or decreases linearly with a slope of <code class="reqn">\lambda</code>, according to the function <code class="reqn">f(j) = \lambda \cdot \frac{j-1}{N-1}</code>, where <code class="reqn">N</code> is the total sample size in the trial
</p>
</li>
<li> <p><strong>&quot;stepwise&quot;</strong> - the log odds is constant in each period and increases or decreases by <code class="reqn">\lambda</code> each time any treatment arm enters or leaves the trial (i.e. in each period), according to the function <code class="reqn">f(j) = \lambda_{k_j} \cdot (c_j - 1)</code>, where <code class="reqn">c_j</code> is an index of the period patient <code class="reqn">j</code> was enrolled in
</p>
</li>
<li> <p><strong>&quot;stepwise_2&quot;</strong> - the log odds is constant in each period and increases or decreases by <code class="reqn">\lambda</code> each time a new treatment arm is added to the trial, according to the function <code class="reqn">f(j) = \lambda_{k_j} \cdot (w_j - 1)</code>, where <code class="reqn">w_j</code> is an indicator of how many treatment arms have already entered the ongoing trial, when patient <code class="reqn">j</code> was enrolled
</p>
</li>
<li> <p><strong>&quot;inv_u&quot;</strong> - the log odds increases up to the point <code class="reqn">N_p</code> (parameter <code>N_peak</code>) and decreases afterwards, linearly with a slope of <code class="reqn">\lambda</code>, according to the function <code class="reqn">f(j) = \lambda \cdot \frac{j-1}{N-1} (I(j \leq N_p) - I(j &gt; N_p))</code>, where <code class="reqn">N_p</code> indicates the point at which the trend turns from positive to negative in terms of the sample size (note that for negative <code class="reqn">\lambda</code>, the log odds ratio decreases first and increases after)
</p>
</li>
<li> <p><strong>&quot;seasonal&quot;</strong> - the log odds increases and decreases periodically with a magnitude of <code class="reqn">\lambda</code>, according to the function <code class="reqn">f(j) = \lambda \cdot \mathrm{sin} \big( \psi \cdot 2\pi \cdot \frac{j-1}{N-1} \big)</code>, where <code class="reqn">\psi</code> indicates how many cycles should the time trend have (parameter <code>n_wave</code>)
</p>
</li></ul>

<p>Trials with no time trend can be simulated too, by setting all elements of the vector <code>lambda</code> to zero and choosing an arbitrary pattern.
</p>


<h3>Value</h3>

<p>Data frame: simulated trial data (if full=FALSE, i.e. default) with the following columns:
</p>

<ul>
<li> <p><code>j</code> - patient recruitment index
</p>
</li>
<li> <p><code>response</code> - binary response for patient <code>j</code>
</p>
</li>
<li> <p><code>treatment</code>- index of the treatment patient <code>j</code> was allocated to
</p>
</li>
<li> <p><code>period</code> - index of the period patient <code>j</code> was recruited in
</p>
</li></ul>

<p>or List (if full=TRUE) containing the following elements:
</p>

<ul>
<li> <p><code>Data</code> - simulated trial data, including an additional column <code>p</code> with the probability used for simulating the response for patient <code>j</code>
</p>
</li>
<li> <p><code>n_total</code> - total sample size in the trial
</p>
</li>
<li> <p><code>n_arm</code> - sample size per arm (assumed equal)
</p>
</li>
<li> <p><code>num_arms</code> - number of experimental treatment arms in the trial
</p>
</li>
<li> <p><code>d</code> - timings of adding new arms
</p>
</li>
<li> <p><code>SS_matrix</code> - matrix with the sample sizes per arm and per period
</p>
</li>
<li> <p><code>period_blocks</code> - number to multiply the number of active arms with, in order to get the block size per period
</p>
</li>
<li> <p><code>p0</code> - response probability in the control arm
</p>
</li>
<li> <p><code>OR</code> - odds ratios for each experimental treatment arm
</p>
</li>
<li> <p><code>lambda</code> - strength of time trend in each arm
</p>
</li>
<li> <p><code>time_dep_effect</code> - time dependent treatment effects for each experimental treatment arm (for computing the bias)
</p>
</li>
<li> <p><code>trend</code> - time trend pattern
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka, Marta Bofill Roig
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
head(datasim_bin(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
p0 = 0.7, OR = rep(1.8, 3), lambda = rep(0.15, 4), trend="stepwise"))


</code></pre>

<hr>
<h2 id='datasim_cont'>Simulate continuous data from a platform trial with a shared control arm and a given number of experimental treatment arms entering at given time points</h2><span id='topic+datasim_cont'></span>

<h3>Description</h3>

<p>This function simulates data from a platform trial with a given number of experimental treatment arms entering at given time points and a shared control arm. The primary endpoint is a continuous endpoint. The user specifies the timing of adding arms in terms of patients recruited to the trial so far and the sample size per arm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>datasim_cont(
  num_arms,
  n_arm,
  d,
  period_blocks = 2,
  mu0 = 0,
  theta,
  lambda,
  sigma,
  trend,
  N_peak,
  n_wave,
  full = FALSE,
  check = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="datasim_cont_+3A_num_arms">num_arms</code></td>
<td>
<p>Integer. Number of experimental treatment arms in the trial.</p>
</td></tr>
<tr><td><code id="datasim_cont_+3A_n_arm">n_arm</code></td>
<td>
<p>Integer. Sample size per experimental treatment arm (assumed equal).</p>
</td></tr>
<tr><td><code id="datasim_cont_+3A_d">d</code></td>
<td>
<p>Integer vector with timings of adding new arms in terms of number of patients recruited to the trial so far. The first entry must be 0, so that the trial starts with at least one experimental treatment arm, and the entries must be non-decreasing. The vector length equals <code>num_arms</code>.</p>
</td></tr>
<tr><td><code id="datasim_cont_+3A_period_blocks">period_blocks</code></td>
<td>
<p>Integer. Number to define the size of the blocks for the block randomization. The block size in each period equals <code>period_blocks</code>times the number of active arms in the period (see Details). Default=2.</p>
</td></tr>
<tr><td><code id="datasim_cont_+3A_mu0">mu0</code></td>
<td>
<p>Double. Response in the control arm. Default=0.</p>
</td></tr>
<tr><td><code id="datasim_cont_+3A_theta">theta</code></td>
<td>
<p>Double vector with treatment effects in terms of difference of means for each experimental treatment arm compared to control. The elements of the vector (treatment effects) are ordered by the entry time of the experimental treatment arms (e.g., the first entry in the vector corresponds to the treatment effect of the first experimental treatment arm). The vector length equals <code>num_arms</code>.</p>
</td></tr>
<tr><td><code id="datasim_cont_+3A_lambda">lambda</code></td>
<td>
<p>Double vector with strength of time trend in each arm ordered by the entry time of the arms (e.g., the first entry in the vector corresponds to the time trend in the control arm, second entry to the time trend in the first experimental treatment arm). The vector length equals <code>num_arms</code>+1, as time trend in the control is also allowed.</p>
</td></tr>
<tr><td><code id="datasim_cont_+3A_sigma">sigma</code></td>
<td>
<p>Double. Standard deviation of the responses.</p>
</td></tr>
<tr><td><code id="datasim_cont_+3A_trend">trend</code></td>
<td>
<p>String indicating the time trend pattern (&quot;linear&quot;, &quot;linear_2, &quot;stepwise&quot;, &quot;stepwise_2&quot;, &quot;inv_u&quot; or &quot;seasonal&quot;). See Details for more information.</p>
</td></tr>
<tr><td><code id="datasim_cont_+3A_n_peak">N_peak</code></td>
<td>
<p>Integer. Timepoint at which the inverted-u time trend switches direction in terms of overall sample size (i.e. after how many recruited participants the trend direction switches).</p>
</td></tr>
<tr><td><code id="datasim_cont_+3A_n_wave">n_wave</code></td>
<td>
<p>Integer. Number of cycles (waves) should the seasonal trend have.</p>
</td></tr>
<tr><td><code id="datasim_cont_+3A_full">full</code></td>
<td>
<p>Logical. Indicates whether the output should be in form of a data frame with variables needed for the analysis only (FALSE) or in form of a list containing more information (TRUE). Default=FALSE.</p>
</td></tr>
<tr><td><code id="datasim_cont_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Design assumptions:</strong>
</p>

<ul>
<li><p> The simulated platform trial consists of a given number of experimental treatment arms (specified by the argument <code>num_arms</code>) and one control arm that is shared across the whole platform.
</p>
</li>
<li><p> Participants are indexed by entry order, assuming that at each time unit exactly one participant is recruited and the time of recruitment and observation of the response are equal.
</p>
</li>
<li><p> All participants are assumed to be eligible for all arms in the trial, i.e. the same inclusion and exclusion criteria apply to all experimental and control arms.
</p>
</li>
<li><p> Equal sample sizes (given by parameter <code>n_arm</code>) in all experimental treatment arms are assumed.
</p>
</li>
<li><p> The duration of a platform trial is divided into so-called periods, defined as time intervals bounded by distinct time points of any treatment arm entering or leaving the platform.
Hence, multiple treatment arms entering or leaving at the same time point imply the start of only one additional period.
</p>
</li>
<li><p> Allocation ratio of 1:1:...:1 in each period. Furthermore, block randomization is used to assign patients to the active arms. Block size in each period = <code>period_blocks</code>* (number of active arms in the period).
</p>
</li>
<li><p> If the period sample size is not a multiple of the block size, arms for the remaining participants are chosen by sampling without replacement from a vector containing the indices of active arms replicated times <code style="white-space: pre;">&#8288;ceiling(remaining sample size/number of active arms)&#8288;</code>.
</p>
</li></ul>

<p><strong>Data generation:</strong>
</p>
<p>The continuous response <code class="reqn">y_j</code> for patient <code class="reqn">j</code> is generated according to:
</p>
<p style="text-align: center;"><code class="reqn">E(y_j) = \eta_0 + \sum_{k=1}^K \cdot I(k_j=k) + f(j)</code>
</p>

<p>where <code class="reqn">\eta_0</code> (parameter <code>mu0</code>) and <code class="reqn">\theta_k</code> (parameter <code>theta</code>) are the response in the control arm and the effect of treatment <code class="reqn">k</code>. <code class="reqn">K</code> is the total number of treatment arms in the trial (parameter <code>num_arms</code>) and <code class="reqn">k_j</code> is an indicator of the treatment arm patient <code class="reqn">j</code> is allocated to.
</p>
<p>The function <code class="reqn">f(j)</code> denotes the time trend, whose strength is indicated by <code class="reqn">\lambda_{k_j}</code> (parameter <code>lambda</code>) and which can have the following patterns (parameter <code>trend</code>):
</p>

<ul>
<li> <p><strong>&quot;linear&quot;</strong> - trend starts at the beginning of the trial and the mean response increases or decreases linearly with a slope of <code class="reqn">\lambda</code>, according to the function <code class="reqn">f(j) = \lambda \cdot \frac{j-1}{N-1}</code>, where <code class="reqn">N</code> is the total sample size in the trial
</p>
</li>
<li> <p><strong>&quot;linear_2&quot;</strong> - trend starts after the first period (i.e. there is no time trend in the first period) and the mean response increases or decreases linearly with a slope of <code class="reqn">\lambda</code>, according to the function <code class="reqn">f(j) = \lambda \cdot \frac{j-1}{N-1}</code>, where <code class="reqn">N</code> is the total sample size in the trial
</p>
</li>
<li> <p><strong>&quot;stepwise&quot;</strong> - the mean response is constant in each period and increases or decreases by <code class="reqn">\lambda</code> each time any treatment arm enters or leaves the trial (i.e. in each period), according to the function <code class="reqn">f(j) = \lambda_{k_j} \cdot (c_j - 1)</code>, where <code class="reqn">c_j</code> is an index of the period patient <code class="reqn">j</code> was enrolled in
</p>
</li>
<li> <p><strong>&quot;stepwise_2&quot;</strong> - the mean response is constant in each period and increases or decreases by <code class="reqn">\lambda</code> each time a new treatment arm is added to the trial, according to the function <code class="reqn">f(j) = \lambda_{k_j} \cdot (w_j - 1)</code>, where <code class="reqn">w_j</code> is an indicator of how many treatment arms have already entered the ongoing trial, when patient <code class="reqn">j</code> was enrolled
</p>
</li>
<li> <p><strong>&quot;inv_u&quot;</strong> - the mean response increases up to the point <code class="reqn">N_p</code> (parameter <code>N_peak</code>) and decreases afterwards, linearly with a slope of <code class="reqn">\lambda</code>, according to the function <code class="reqn">f(j) = \lambda \cdot \frac{j-1}{N-1} (I(j \leq N_p) - I(j &gt; N_p))</code>, where <code class="reqn">N_p</code> indicates the point at which the trend turns from positive to negative in terms of the sample size (note that for negative <code class="reqn">\lambda</code>, the mean response decreases first and increases after)
</p>
</li>
<li> <p><strong>&quot;seasonal&quot;</strong> - the mean response increases and decreases periodically with a magnitude of <code class="reqn">\lambda</code>, according to the function <code class="reqn">f(j) = \lambda \cdot \mathrm{sin} \big( \psi \cdot 2\pi \cdot \frac{j-1}{N-1} \big)</code>, where <code class="reqn">\psi</code> indicates how many cycles should the time trend have (parameter <code>n_wave</code>)
</p>
</li></ul>

<p>Trials with no time trend can be simulated too, by setting all elements of the vector <code>lambda</code> to zero and choosing an arbitrary pattern.
</p>


<h3>Value</h3>

<p>Data frame: simulated trial data (if full=FALSE, i.e. default) with the following columns:
</p>

<ul>
<li> <p><code>j</code> - patient recruitment index
</p>
</li>
<li> <p><code>response</code> - continuous response for patient <code>j</code>
</p>
</li>
<li> <p><code>treatment</code>- index of the treatment patient <code>j</code> was allocated to
</p>
</li>
<li> <p><code>period</code> - index of the period patient <code>j</code> was recruited in
</p>
</li></ul>

<p>or List (if full=TRUE) containing the following elements:
</p>

<ul>
<li> <p><code>Data</code> - simulated trial data, including an additional column <code>means</code> with the theoretical means used for the simulation of the response for patient <code>j</code>
</p>
</li>
<li> <p><code>n_total</code> - total sample size in the trial
</p>
</li>
<li> <p><code>n_arm</code> - sample size per arm (assumed equal)
</p>
</li>
<li> <p><code>num_arms</code> - number of experimental treatment arms in the trial
</p>
</li>
<li> <p><code>d</code> - timings of adding new arms
</p>
</li>
<li> <p><code>SS_matrix</code> - matrix with the sample sizes per arm and per period
</p>
</li>
<li> <p><code>period_blocks</code> - number to multiply the number of active arms with, in order to get the block size per period
</p>
</li>
<li> <p><code>mu0</code> - response in the control arm
</p>
</li>
<li> <p><code>theta</code> - treatment effects for each experimental treatment arm
</p>
</li>
<li> <p><code>lambda</code> - strength of time trend in each arm
</p>
</li>
<li> <p><code>time_dep_effect</code> - time dependent treatment effects for each experimental treatment arm (for computing the bias)
</p>
</li>
<li> <p><code>sigma</code> - standard deviation of the responses
</p>
</li>
<li> <p><code>trend</code> - time trend pattern
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka, Marta Bofill Roig
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
head(datasim_cont(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
theta = rep(0.25, 3), lambda = rep(0.15, 4), sigma = 1, trend = "linear"))


</code></pre>

<hr>
<h2 id='fixmodel_bin'>Frequentist logistic regression model analysis for binary data adjusting for periods</h2><span id='topic+fixmodel_bin'></span>

<h3>Description</h3>

<p>This function performs logistic regression taking into account all trial data until the arm under study leaves the trial and adjusting for periods as factors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fixmodel_bin(data, arm, alpha = 0.025, ncc = TRUE, check = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fixmodel_bin_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_bin()</code> function. Must contain columns named 'treatment', 'response' and 'period'.</p>
</td></tr>
<tr><td><code id="fixmodel_bin_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="fixmodel_bin_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="fixmodel_bin_+3A_ncc">ncc</code></td>
<td>
<p>Logical. Indicates whether to include non-concurrent data into the analysis. Default=TRUE.</p>
</td></tr>
<tr><td><code id="fixmodel_bin_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="fixmodel_bin_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model-based analysis adjusts for the time effect by including the factor period (defined as a time interval bounded by any treatment arm entering or leaving the platform). The time is then modelled as a step-function with jumps at the beginning of each period.
Denoting by <code class="reqn">y_j</code> the response probability for patient <code class="reqn">j</code>, by <code class="reqn">k_j</code> the arm patient <code class="reqn">j</code> was allocated to, and by <code class="reqn">M</code> the treatment arm under evaluation, the regression model is given by:
</p>
<p style="text-align: center;"><code class="reqn">g(E(y_j)) = \eta_0  + \sum_{k \in \mathcal{K}_M} \theta_k \cdot I(k_j=k) + \sum_{s=2}^{S_M} \tau_s \cdot I(t_j \in T_{S_s})</code>
</p>

<p>where <code class="reqn">g(\cdot)</code> denotes the logit link function and <code class="reqn">\eta_0</code> is the log odds in the control arm in the first period;
<code class="reqn">\theta_k</code> represents the log odds ratio of treatment <code class="reqn">k</code> and control for <code class="reqn">k\in\mathcal{K}_M</code>, where <code class="reqn">\mathcal{K}_M</code> is the set of treatments
that were active in the trial during periods prior or up to the time when the investigated treatment arm left the trial;
<code class="reqn">\tau_s</code> indicates the stepwise period effect in terms of the log odds ratio between periods 1 and <code class="reqn">s</code> (<code class="reqn">s = 2, \ldots, S_M</code>), where <code class="reqn">S_M</code> denotes the period, in which the investigated treatment arm left the trial.
</p>
<p>If the data consists of only one period (e.g. in case of a multi-arm trial), the period in not used as covariate.
</p>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the log-odds ratio
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>References</h3>

<p>On model-based time trend adjustments in platform trials with non-concurrent controls. Bofill Roig, M., Krotka, P., et al. BMC Medical Research Methodology 22.1 (2022): 1-16.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_bin(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
p0 = 0.7, OR = rep(1.8, 3), lambda = rep(0.15, 4), trend="stepwise")

fixmodel_bin(data = trial_data, arm = 3)

</code></pre>

<hr>
<h2 id='fixmodel_cal_bin'>Frequentist logistic regression model analysis for binary data adjusting for calendar time units</h2><span id='topic+fixmodel_cal_bin'></span>

<h3>Description</h3>

<p>This function performs logistic regression taking into account all trial data until the arm under study leaves the trial and adjusting for calendar time units as factors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fixmodel_cal_bin(
  data,
  arm,
  alpha = 0.025,
  unit_size = 25,
  ncc = TRUE,
  check = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fixmodel_cal_bin_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_bin()</code> function. Must contain columns named 'treatment' and 'response'.</p>
</td></tr>
<tr><td><code id="fixmodel_cal_bin_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="fixmodel_cal_bin_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="fixmodel_cal_bin_+3A_unit_size">unit_size</code></td>
<td>
<p>Integer. Number of patients per calendar time unit. Default=25.</p>
</td></tr>
<tr><td><code id="fixmodel_cal_bin_+3A_ncc">ncc</code></td>
<td>
<p>Logical. Indicates whether to include non-concurrent data into the analysis. Default=TRUE.</p>
</td></tr>
<tr><td><code id="fixmodel_cal_bin_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="fixmodel_cal_bin_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model-based analysis adjusts for the time effect by including the factor calendar time unit (defined as time units of fixed length, defined by <code>Ã¹nit_size</code>). The time is then modelled as a step-function with jumps at the beginning of each calendar time unit.
Denoting by <code class="reqn">y_j</code> the response probability for patient <code class="reqn">j</code>, by <code class="reqn">k_j</code> the arm patient <code class="reqn">j</code> was allocated to, and by <code class="reqn">M</code> the treatment arm under evaluation, the regression model is given by:
</p>
<p style="text-align: center;"><code class="reqn">g(E(y_j)) = \eta_0  + \sum_{k \in \mathcal{K}_M} \theta_k \cdot I(k_j=k) + \sum_{c=2}^{C_M} \tau_c \cdot I(t_j \in T_{C_c})</code>
</p>

<p>where <code class="reqn">g(\cdot)</code> denotes the logit link function and <code class="reqn">\eta_0</code> is the log odds in the control arm in the first calendar time unit;
<code class="reqn">\theta_k</code> represents the log odds ratio of treatment <code class="reqn">k</code> and control for <code class="reqn">k\in\mathcal{K}_M</code>, where <code class="reqn">\mathcal{K}_M</code> is the set of treatments
that were active in the trial during calendar time units prior or up to the time when the investigated treatment arm left the trial;
<code class="reqn">\tau_c</code> indicates the stepwise calendar time effect in terms of the log odds ratio between calendar time units 1 and <code class="reqn">c</code> (<code class="reqn">c = 2, \ldots, C_M</code>), where <code class="reqn">C_M</code> denotes the calendar time unit, in which the investigated treatment arm left the trial.
</p>
<p>If the data consists of only one calendar time unit, the calendar time unit in not used as covariate.
</p>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the log-odds ratio
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_bin(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
p0 = 0.7, OR = rep(1.8, 3), lambda = rep(0.15, 4), trend="stepwise")

fixmodel_cal_bin(data = trial_data, arm = 3)

</code></pre>

<hr>
<h2 id='fixmodel_cal_cont'>Frequentist linear regression model analysis for continuous data adjusting for calendar time units</h2><span id='topic+fixmodel_cal_cont'></span>

<h3>Description</h3>

<p>This function performs linear regression taking into account all trial data until the arm under study leaves the trial and adjusting for calendar time units as factors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fixmodel_cal_cont(
  data,
  arm,
  alpha = 0.025,
  unit_size = 25,
  ncc = TRUE,
  check = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fixmodel_cal_cont_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_cont()</code> function. Must contain columns named 'treatment' and 'response'.</p>
</td></tr>
<tr><td><code id="fixmodel_cal_cont_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="fixmodel_cal_cont_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="fixmodel_cal_cont_+3A_unit_size">unit_size</code></td>
<td>
<p>Integer. Number of patients per calendar time unit. Default=25.</p>
</td></tr>
<tr><td><code id="fixmodel_cal_cont_+3A_ncc">ncc</code></td>
<td>
<p>Logical. Indicates whether to include non-concurrent data into the analysis. Default=TRUE.</p>
</td></tr>
<tr><td><code id="fixmodel_cal_cont_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="fixmodel_cal_cont_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model-based analysis adjusts for the time effect by including the factor calendar time unit (defined as time units of fixed length, defined by <code>Ã¹nit_size</code>). The time is then modelled as a step-function with jumps at the beginning of each calendar time unit.
Denoting by <code class="reqn">y_j</code> the continuous response for patient <code class="reqn">j</code>, by <code class="reqn">k_j</code> the arm patient <code class="reqn">j</code> was allocated to, and by <code class="reqn">M</code> the treatment arm under evaluation, the regression model is given by:
</p>
<p style="text-align: center;"><code class="reqn">E(y_j) = \eta_0  + \sum_{k \in \mathcal{K}_M} \theta_k \cdot I(k_j=k) + \sum_{c=2}^{C_M} \tau_c \cdot I(t_j \in T_{C_c})</code>
</p>

<p>where <code class="reqn">\eta_0</code> is the response in the control arm in the first calendar time unit;
<code class="reqn">\theta_k</code> represents the effect of treatment <code class="reqn">k</code> compared to control for <code class="reqn">k\in\mathcal{K}_M</code>, where <code class="reqn">\mathcal{K}_M</code> is the set of treatments
that were active in the trial during calendar time units prior or up to the time when the investigated treatment arm left the trial;
<code class="reqn">\tau_c</code> indicates the stepwise calendar time effect between calendar time units 1 and <code class="reqn">c</code> (<code class="reqn">c = 2, \ldots, C_M</code>), where <code class="reqn">C_M</code> denotes the calendar time unit, in which the investigated treatment arm left the trial.
</p>
<p>If the data consists of only one calendar time unit, the calendar time unit in not used as covariate.
</p>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the difference in means
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_cont(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
theta = rep(0.25, 3), lambda = rep(0.15, 4), sigma = 1, trend = "linear")

fixmodel_cal_cont(data = trial_data, arm = 3)

</code></pre>

<hr>
<h2 id='fixmodel_cont'>Frequentist linear regression model analysis for continuous data adjusting for periods</h2><span id='topic+fixmodel_cont'></span>

<h3>Description</h3>

<p>This function performs linear regression taking into account all trial data until the arm under study leaves the trial and adjusting for periods as factors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fixmodel_cont(data, arm, alpha = 0.025, ncc = TRUE, check = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fixmodel_cont_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_cont()</code> function. Must contain columns named 'treatment', 'response' and 'period'.</p>
</td></tr>
<tr><td><code id="fixmodel_cont_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="fixmodel_cont_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="fixmodel_cont_+3A_ncc">ncc</code></td>
<td>
<p>Logical. Indicates whether to include non-concurrent data into the analysis. Default=TRUE.</p>
</td></tr>
<tr><td><code id="fixmodel_cont_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="fixmodel_cont_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model-based analysis adjusts for the time effect by including the factor period (defined as a time interval bounded by any treatment arm entering or leaving the platform). The time is then modelled as a step-function with jumps at the beginning of each period.
Denoting by <code class="reqn">y_j</code> the continuous response for patient <code class="reqn">j</code>, by <code class="reqn">k_j</code> the arm patient <code class="reqn">j</code> was allocated to, and by <code class="reqn">M</code> the treatment arm under evaluation, the regression model is given by:
</p>
<p style="text-align: center;"><code class="reqn">E(y_j) = \eta_0  + \sum_{k \in \mathcal{K}_M} \theta_k \cdot I(k_j=k) + \sum_{s=2}^{S_M} \tau_s \cdot I(t_j \in T_{S_s})</code>
</p>

<p>where <code class="reqn">\eta_0</code> is the response in the control arm in the first period;
<code class="reqn">\theta_k</code> represents the effect of treatment <code class="reqn">k</code> compared to control for <code class="reqn">k\in\mathcal{K}_M</code>, where <code class="reqn">\mathcal{K}_M</code> is the set of treatments
that were active in the trial during periods prior or up to the time when the investigated treatment arm left the trial;
<code class="reqn">\tau_s</code> indicates the stepwise period effect between periods 1 and <code class="reqn">s</code> (<code class="reqn">s = 2, \ldots, S_M</code>), where <code class="reqn">S_M</code> denotes the period, in which the investigated treatment arm left the trial.
</p>
<p>If the data consists of only one period (e.g. in case of a multi-arm trial), the period in not used as covariate.
</p>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the difference in means
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>References</h3>

<p>On model-based time trend adjustments in platform trials with non-concurrent controls. Bofill Roig, M., Krotka, P., et al. BMC Medical Research Methodology 22.1 (2022): 1-16.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_cont(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
theta = rep(0.25, 3), lambda = rep(0.15, 4), sigma = 1, trend = "linear")

fixmodel_cont(data = trial_data, arm = 3)

</code></pre>

<hr>
<h2 id='gam_cont'>Generalized additive model analysis for continuous data</h2><span id='topic+gam_cont'></span>

<h3>Description</h3>

<p>This function performs analysis using a generalized additive model taking into account all trial data until the arm under study leaves the trial and smoothing over the patient entry index.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gam_cont(
  data,
  arm,
  alpha = 0.025,
  ci = FALSE,
  smoothing_basis = "tp",
  basis_dim = -1,
  gam_method = "GCV.Cp",
  check = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gam_cont_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_cont()</code> function. Must contain columns named 'treatment', 'response', 'period' and 'j'.</p>
</td></tr>
<tr><td><code id="gam_cont_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="gam_cont_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="gam_cont_+3A_ci">ci</code></td>
<td>
<p>Logical. Indicates whether confidence intervals should be computed. Default=FALSE.</p>
</td></tr>
<tr><td><code id="gam_cont_+3A_smoothing_basis">smoothing_basis</code></td>
<td>
<p>String indicating the (penalized) smoothing basis to use. Default=&quot;tp&quot; for thin plate regression spline. Available strings are 'tp', 'ts', 'ds', 'cr', 'cs', 'cc', 'sos', 'ps', 'cp', 're', 'mrf', 'gp', and 'so'. For more information see https://stat.ethz.ch/R-manual/R-devel/library/mgcv/html/smooth.terms.html.</p>
</td></tr>
<tr><td><code id="gam_cont_+3A_basis_dim">basis_dim</code></td>
<td>
<p>Integer. The dimension of the basis used to represent the smooth term. The default depends on the number of variables that the smooth is a function of. Default=-1. For more information see the description of the parameter 'k' in https://stat.ethz.ch/R-manual/R-devel/library/mgcv/html/s.html.</p>
</td></tr>
<tr><td><code id="gam_cont_+3A_gam_method">gam_method</code></td>
<td>
<p>String indicating the smoothing parameter estimation method. Default=&quot;GCV.Cp&quot;. Available strings are 'GCV.Cp', 'GACV.Cp', 'REML', 'P-REML', 'ML', and 'P-ML'. For more information see the description of the parameter 'method' in https://stat.ethz.ch/R-manual/R-devel/library/mgcv/html/gam.html.</p>
</td></tr>
<tr><td><code id="gam_cont_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="gam_cont_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the difference in means
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_cont(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
theta = rep(0.25, 3), lambda = rep(0.15, 4), sigma = 1, trend = "linear")

gam_cont(data = trial_data, arm = 3, ci = TRUE)

</code></pre>

<hr>
<h2 id='get_ss_matrix'>Sample size matrix for a platform trial with a given number of treatment arms</h2><span id='topic+get_ss_matrix'></span>

<h3>Description</h3>

<p>This function computes the matrix with sample sizes per arm and period. It is used in the functions <code>datasim_bin()</code> and <code>datasim_cont()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_ss_matrix(num_arms, n_arm, d)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_ss_matrix_+3A_num_arms">num_arms</code></td>
<td>
<p>Integer. Number of experimental treatment arms in the trial.</p>
</td></tr>
<tr><td><code id="get_ss_matrix_+3A_n_arm">n_arm</code></td>
<td>
<p>Integer. Sample size per experimental treatment arm.</p>
</td></tr>
<tr><td><code id="get_ss_matrix_+3A_d">d</code></td>
<td>
<p>Integer vector with timings of adding new arms in terms of number of patients recruited to the trial so far. The first entry must be 0, so that the trial starts with at least one experimental treatment arm, and the entries must be non-decreasing. The vector length equals <code>num_arms</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Sample size matrix, consisting of the sample size per arm and per period, where the arms are represented in the rows (with the control arm in the first row and the experimental arms coming after ordered by entry time) and the periods are represented in the columns.
</p>


<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
get_ss_matrix(num_arms = 3, n_arm = 100, d = c(0, 100, 250))

</code></pre>

<hr>
<h2 id='inv_u_trend'>Generation of an inverted-u trend</h2><span id='topic+inv_u_trend'></span>

<h3>Description</h3>

<p>This function generates a time trend for given time points in the trial according to an inverted-u function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>inv_u_trend(j, lambda, N_peak, n_total)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="inv_u_trend_+3A_j">j</code></td>
<td>
<p>Time points for which the trend should be generated.</p>
</td></tr>
<tr><td><code id="inv_u_trend_+3A_lambda">lambda</code></td>
<td>
<p>Strength of time trend.</p>
</td></tr>
<tr><td><code id="inv_u_trend_+3A_n_peak">N_peak</code></td>
<td>
<p>Point at which the time trend switches direction in terms of overall sample size.</p>
</td></tr>
<tr><td><code id="inv_u_trend_+3A_n_total">n_total</code></td>
<td>
<p>Total sample size in the trial.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The time trend is generated according to the function <code class="reqn">f(j) = \lambda \cdot \frac{j-1}{N-1} (I(j \leq N_p) - I(j &gt; N_p))</code>,
where <code class="reqn">N</code> is the total sample size (parameter <code>n_total</code>) and <code class="reqn">N_p</code> (parameter <code>N_peak</code>) indicates the point at which the trend switches direction.
</p>


<h3>Value</h3>

<p>Time trend for time points j.
</p>


<h3>Author(s)</h3>

<p>Marta Bofill Roig, Pavla Krotka
</p>

<hr>
<h2 id='linear_trend'>Generation of a linear trend that starts in a given period</h2><span id='topic+linear_trend'></span>

<h3>Description</h3>

<p>This function generates a time trend for given time points in the trial according to a linear function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>linear_trend(j, lambda, sample_size)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="linear_trend_+3A_j">j</code></td>
<td>
<p>Time points for which the trend should be generated.</p>
</td></tr>
<tr><td><code id="linear_trend_+3A_lambda">lambda</code></td>
<td>
<p>Strength of time trend.</p>
</td></tr>
<tr><td><code id="linear_trend_+3A_sample_size">sample_size</code></td>
<td>
<p>Vector of dimension 2, indicating sample size in the trial period until the time trend starts and the remaining sample size.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The time trend is generated according to the function <code class="reqn">f(j) = \lambda \cdot \frac{j-1}{N-1}</code>, where <code class="reqn">N</code> is the total sample size.
</p>


<h3>Value</h3>

<p>Time trend for time points j.
</p>


<h3>Author(s)</h3>

<p>Marta Bofill Roig, Pavla Krotka
</p>

<hr>
<h2 id='MAPprior_bin'>Analysis for binary data using the MAP Prior approach</h2><span id='topic+MAPprior_bin'></span>

<h3>Description</h3>

<p>This function performs analysis of binary data using the Meta-Analytic-Predictive (MAP) Prior approach. The method borrows data from non-concurrent controls to obtain the prior distribution for the control response in the concurrent periods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MAPprior_bin(
  data,
  arm,
  alpha = 0.025,
  opt = 2,
  prior_prec_tau = 4,
  prior_prec_eta = 0.001,
  n_samples = 1000,
  n_chains = 4,
  n_iter = 4000,
  n_adapt = 1000,
  robustify = TRUE,
  weight = 0.1,
  check = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="MAPprior_bin_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_bin()</code> function. Must contain columns named 'treatment', 'response' and 'period'.</p>
</td></tr>
<tr><td><code id="MAPprior_bin_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="MAPprior_bin_+3A_alpha">alpha</code></td>
<td>
<p>Double. Decision boundary (one-sided). Default=0.025</p>
</td></tr>
<tr><td><code id="MAPprior_bin_+3A_opt">opt</code></td>
<td>
<p>Integer (1 or 2). If opt==1, all former periods are used as one source; if opt==2, periods get separately included into the final analysis. Default=2.</p>
</td></tr>
<tr><td><code id="MAPprior_bin_+3A_prior_prec_tau">prior_prec_tau</code></td>
<td>
<p>Double. Precision parameter (<code class="reqn">1/\sigma^2_{\tau}</code>) of the half normal hyperprior, the prior for the between study heterogeneity. Default=4.</p>
</td></tr>
<tr><td><code id="MAPprior_bin_+3A_prior_prec_eta">prior_prec_eta</code></td>
<td>
<p>Double. Precision parameter (<code class="reqn">1/\sigma^2_{\eta}</code>) of the normal hyperprior, the prior for the hyperparameter mean of the control log-odds. Default=0.001.</p>
</td></tr>
<tr><td><code id="MAPprior_bin_+3A_n_samples">n_samples</code></td>
<td>
<p>Integer. Number of how many random samples will get drawn for the calculation of the posterior mean, the p-value and the CI's. Default=1000.</p>
</td></tr>
<tr><td><code id="MAPprior_bin_+3A_n_chains">n_chains</code></td>
<td>
<p>Integer. Number of parallel chains for the rjags model. Default=4.</p>
</td></tr>
<tr><td><code id="MAPprior_bin_+3A_n_iter">n_iter</code></td>
<td>
<p>Integer. Number of iterations to monitor of the jags.model. Needed for coda.samples. Default=4000.</p>
</td></tr>
<tr><td><code id="MAPprior_bin_+3A_n_adapt">n_adapt</code></td>
<td>
<p>Integer. Number of iterations for adaptation, an initial sampling phase during which the samplers adapt their behavior to maximize their efficiency. Needed for jags.model. Default=1000.</p>
</td></tr>
<tr><td><code id="MAPprior_bin_+3A_robustify">robustify</code></td>
<td>
<p>Logical. Indicates whether a robust prior is to be used. If TRUE, a mixture prior is considered combining a MAP prior and a weakly non-informative component prior. Default=TRUE.</p>
</td></tr>
<tr><td><code id="MAPprior_bin_+3A_weight">weight</code></td>
<td>
<p>Double. Weight given to the non-informative component (0 &lt; weight &lt; 1) for the robustification of the MAP prior according to Schmidli (2014). Default=0.1.</p>
</td></tr>
<tr><td><code id="MAPprior_bin_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="MAPprior_bin_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The MAP approach derives the prior distribution for the control response in the concurrent periods by combining the control information from the non-concurrent periods with a non-informative prior.
</p>
<p>The model for the binary response <code class="reqn">y_{js}</code> for the control patient <code class="reqn">j</code> in the non-concurrent period <code class="reqn">s</code> is defined as follows:
</p>
<p style="text-align: center;"><code class="reqn">g(E(y_{js})) = \eta_s</code>
</p>

<p>where <code class="reqn">g(\cdot)</code> denotes the logit link function and <code class="reqn">\eta_s</code> represents the control log odds in the non-concurrent period <code class="reqn">s</code>.
</p>
<p>The log odds for the non-concurrent controls in period <code class="reqn">s</code> are assumed to have a normal prior distribution with mean <code class="reqn">\mu_{\eta}</code> and variance <code class="reqn">\tau^2</code>:
</p>
<p style="text-align: center;"><code class="reqn">\eta_s \sim \mathcal{N}(\mu_{\eta}, \tau^2)</code>
</p>

<p>For the hyperparameters <code class="reqn">\mu_{\eta}</code> and <code class="reqn">\tau</code>, normal and half-normal hyperprior distributions are assumed, with mean 0 and variances <code class="reqn">\sigma^2_{\eta}</code> and <code class="reqn">\sigma^2_{\tau}</code>, respectively:
</p>
<p style="text-align: center;"><code class="reqn">\mu_{\eta} \sim \mathcal{N}(0, \sigma^2_{\eta})</code>
</p>

<p style="text-align: center;"><code class="reqn">\tau \sim HalfNormal(0, \sigma^2_{\tau})</code>
</p>

<p>The MAP prior distribution <code class="reqn">p_{MAP}(\eta_{CC})</code> for the control response in the concurrent periods is then obtained as the posterior distribution of the parameters <code class="reqn">\eta_s</code> from the above specified model.
</p>
<p>If <code>robustify=TRUE</code>, the MAP prior is robustified by adding a weakly-informative mixture component <code class="reqn">p_{\mathrm{non-inf}}</code>, leading to a robustified MAP prior distribution:
</p>
<p style="text-align: center;"><code class="reqn">p_{rMAP}(\eta_{CC}) = (1-w) \cdot p_{MAP}(\eta_{CC}) + w \cdot p_{\mathrm{non-inf}}(\eta_{CC})</code>
</p>

<p>where <code class="reqn">w</code> (parameter <code>weight</code>) may be interpreted as the degree of skepticism towards borrowing strength.
</p>
<p>In this function, the argument <code>alpha</code> corresponds to <code class="reqn">1-\gamma</code>, where <code class="reqn">\gamma</code> is the decision boundary. Specifically, the posterior probability of the difference distribution under the null hypothesis is such that:
<code class="reqn">P(p_{treatment}-p_{control}&gt;0) \ge 1-</code><code>alpha</code>.
In case of a non-informative prior this coincides with the frequentist type I error.
</p>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - posterior probability that the log-odds ratio is less than zero
</p>
</li>
<li> <p><code>treat_effect</code> - posterior mean of log-odds ratio
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% credible interval for log-odds ratio
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% credible interval for log-odds ratio
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Katharina Hees
</p>


<h3>References</h3>

<p>Robust meta-analytic-predictive priors in clinical trials with historical control information. Schmidli, H., et al. Biometrics 70.4 (2014): 1023-1032.
</p>
<p>Applying Meta-Analytic-Predictive Priors with the R Bayesian Evidence Synthesis Tools. Weber, S., et al. Journal of Statistical Software 100.19 (2021): 1548-7660.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_bin(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
p0 = 0.7, OR = rep(1.8, 3), lambda = rep(0.15, 4), trend="stepwise")

MAPprior_bin(data = trial_data, arm = 3)


</code></pre>

<hr>
<h2 id='MAPprior_cont'>Analysis for continuous data using the MAP Prior approach</h2><span id='topic+MAPprior_cont'></span>

<h3>Description</h3>

<p>This function performs analysis of continuous data using the Meta-Analytic-Predictive (MAP) Prior approach. The method borrows data from non-concurrent controls to obtain the prior distribution for the control response in the concurrent periods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MAPprior_cont(
  data,
  arm,
  alpha = 0.025,
  opt = 2,
  prior_prec_tau = 4,
  prior_prec_eta = 0.001,
  n_samples = 1000,
  n_chains = 4,
  n_iter = 4000,
  n_adapt = 1000,
  robustify = TRUE,
  weight = 0.1,
  check = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="MAPprior_cont_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_bin()</code> function. Must contain columns named 'treatment', 'response' and 'period'.</p>
</td></tr>
<tr><td><code id="MAPprior_cont_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="MAPprior_cont_+3A_alpha">alpha</code></td>
<td>
<p>Double. Decision boundary (one-sided). Default=0.025</p>
</td></tr>
<tr><td><code id="MAPprior_cont_+3A_opt">opt</code></td>
<td>
<p>Integer (1 or 2). If opt==1, all former periods are used as one source; if opt==2, periods get separately included into the final analysis. Default=2.</p>
</td></tr>
<tr><td><code id="MAPprior_cont_+3A_prior_prec_tau">prior_prec_tau</code></td>
<td>
<p>Double. Precision parameter (<code class="reqn">1/\sigma^2_{\tau}</code>) of the half normal hyperprior, the prior for the between study heterogeneity. Default=4.</p>
</td></tr>
<tr><td><code id="MAPprior_cont_+3A_prior_prec_eta">prior_prec_eta</code></td>
<td>
<p>Double. Precision parameter (<code class="reqn">1/\sigma^2_{\eta}</code>) of the normal hyperprior, the prior for the hyperparameter mean of the control mean. Default=0.001.</p>
</td></tr>
<tr><td><code id="MAPprior_cont_+3A_n_samples">n_samples</code></td>
<td>
<p>Integer. Number of how many random samples will get drawn for the calculation of the posterior mean, the p-value and the CI's. Default=1000.</p>
</td></tr>
<tr><td><code id="MAPprior_cont_+3A_n_chains">n_chains</code></td>
<td>
<p>Integer. Number of parallel chains for the rjags model. Default=4.</p>
</td></tr>
<tr><td><code id="MAPprior_cont_+3A_n_iter">n_iter</code></td>
<td>
<p>Integer. Number of iterations to monitor of the jags.model. Needed for coda.samples. Default=4000.</p>
</td></tr>
<tr><td><code id="MAPprior_cont_+3A_n_adapt">n_adapt</code></td>
<td>
<p>Integer. Number of iterations for adaptation, an initial sampling phase during which the samplers adapt their behavior to maximize their efficiency. Needed for jags.model. Default=1000.</p>
</td></tr>
<tr><td><code id="MAPprior_cont_+3A_robustify">robustify</code></td>
<td>
<p>Logical. Indicates whether a robust prior is to be used. If TRUE, a mixture prior is considered combining a MAP prior and a weakly non-informative component prior. Default=TRUE.</p>
</td></tr>
<tr><td><code id="MAPprior_cont_+3A_weight">weight</code></td>
<td>
<p>Double. Weight given to the non-informative component (0 &lt; weight &lt; 1) for the robustification of the MAP prior according to Schmidli (2014). Default=0.1.</p>
</td></tr>
<tr><td><code id="MAPprior_cont_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="MAPprior_cont_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The MAP approach derives the prior distribution for the control response in the concurrent periods by combining the control information from the non-concurrent periods with a non-informative prior.
</p>
<p>The model for the continuous response <code class="reqn">y_{js}</code> for the control patient <code class="reqn">j</code> in the non-concurrent period <code class="reqn">s</code> is defined as follows:
</p>
<p style="text-align: center;"><code class="reqn">E(y_{js}) = \eta_s</code>
</p>

<p>where <code class="reqn">\eta_s</code> represents the control mean in the non-concurrent period <code class="reqn">s</code>.
</p>
<p>The means for the non-concurrent controls in period <code class="reqn">s</code> are assumed to have a normal prior distribution with mean <code class="reqn">\mu_{\eta}</code> and variance <code class="reqn">\tau^2</code>:
</p>
<p style="text-align: center;"><code class="reqn">\eta_s \sim \mathcal{N}(\mu_{\eta}, \tau^2)</code>
</p>

<p>For the hyperparameters <code class="reqn">\mu_{\eta}</code> and <code class="reqn">\tau</code>, normal and half-normal hyperprior distributions are assumed, with mean 0 and variances <code class="reqn">\sigma^2_{\eta}</code> and <code class="reqn">\sigma^2_{\tau}</code>, respectively:
</p>
<p style="text-align: center;"><code class="reqn">\mu_{\eta} \sim \mathcal{N}(0, \sigma^2_{\eta})</code>
</p>

<p style="text-align: center;"><code class="reqn">\tau \sim HalfNormal(0, \sigma^2_{\tau})</code>
</p>

<p>The MAP prior distribution <code class="reqn">p_{MAP}(\eta_{CC})</code> for the control response in the concurrent periods is then obtained as the posterior distribution of the parameters <code class="reqn">\eta_s</code> from the above specified model.
</p>
<p>If <code>robustify=TRUE</code>, the MAP prior is robustified by adding a weakly-informative mixture component <code class="reqn">p_{\mathrm{non-inf}}</code>, leading to a robustified MAP prior distribution:
</p>
<p style="text-align: center;"><code class="reqn">p_{rMAP}(\eta_{CC}) = (1-w) \cdot p_{MAP}(\eta_{CC}) + w \cdot p_{\mathrm{non-inf}}(\eta_{CC})</code>
</p>

<p>where <code class="reqn">w</code> (parameter <code>weight</code>) may be interpreted as the degree of skepticism towards borrowing strength.
</p>
<p>In this function, the argument <code>alpha</code> corresponds to <code class="reqn">1-\gamma</code>, where <code class="reqn">\gamma</code> is the decision boundary. Specifically, the posterior probability of the difference distribution under the null hypothesis is such that:
<code class="reqn">P(\mu_{treatment}-\mu_{control}&gt;0) \ge 1-</code><code>alpha</code>.
In case of a non-informative prior this coincides with the frequentist type I error.
</p>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - posterior probability that the difference in means is less than zero
</p>
</li>
<li> <p><code>treat_effect</code> - posterior mean of difference in means
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% credible interval for difference in means
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% credible interval for difference in means
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Katharina Hees
</p>


<h3>References</h3>

<p>Robust meta-analytic-predictive priors in clinical trials with historical control information. Schmidli, H., et al. Biometrics 70.4 (2014): 1023-1032.
</p>
<p>Applying Meta-Analytic-Predictive Priors with the R Bayesian Evidence Synthesis Tools. Weber, S., et al. Journal of Statistical Software 100.19 (2021): 1548-7660.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_cont(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
theta = rep(0.25, 3), lambda = rep(0.15, 4), sigma = 1, trend = "stepwise")

MAPprior_cont(data = trial_data, arm = 3)


</code></pre>

<hr>
<h2 id='mixmodel_AR1_cal_cont'>Mixed regression model analysis for continuous data adjusting for calendar time units as a random factor with AR1 correlation structure</h2><span id='topic+mixmodel_AR1_cal_cont'></span>

<h3>Description</h3>

<p>This function performs linear mixed model regression taking into account all trial data until the arm under study leaves the trial and adjusting for calendar time units as random factors with AR1 correlation structure.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mixmodel_AR1_cal_cont(
  data,
  arm,
  alpha = 0.025,
  ci = FALSE,
  unit_size = 25,
  ncc = TRUE,
  check = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mixmodel_AR1_cal_cont_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_cont()</code> function. Must contain columns named 'treatment' and 'response'.</p>
</td></tr>
<tr><td><code id="mixmodel_AR1_cal_cont_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="mixmodel_AR1_cal_cont_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="mixmodel_AR1_cal_cont_+3A_ci">ci</code></td>
<td>
<p>Logical. Indicates whether confidence intervals should be computed. Default=FALSE.</p>
</td></tr>
<tr><td><code id="mixmodel_AR1_cal_cont_+3A_unit_size">unit_size</code></td>
<td>
<p>Integer. Number of patients per calendar time unit. Default=25.</p>
</td></tr>
<tr><td><code id="mixmodel_AR1_cal_cont_+3A_ncc">ncc</code></td>
<td>
<p>Logical. Indicates whether to include non-concurrent data into the analysis. Default=TRUE.</p>
</td></tr>
<tr><td><code id="mixmodel_AR1_cal_cont_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="mixmodel_AR1_cal_cont_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the difference in means
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_cont(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
theta = rep(0.25, 3), lambda = rep(0.15, 4), sigma = 1, trend = "linear")

mixmodel_AR1_cal_cont(data = trial_data, arm = 3, ci = TRUE)

</code></pre>

<hr>
<h2 id='mixmodel_AR1_cont'>Mixed regression model analysis for continuous data adjusting for periods as a random factor with AR1 correlation structure</h2><span id='topic+mixmodel_AR1_cont'></span>

<h3>Description</h3>

<p>This function performs linear mixed model regression taking into account all trial data until the arm under study leaves the trial and adjusting for periods as random factors with AR1 correlation structure.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mixmodel_AR1_cont(
  data,
  arm,
  alpha = 0.025,
  ci = FALSE,
  ncc = TRUE,
  check = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mixmodel_AR1_cont_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_cont()</code> function. Must contain columns named 'treatment', 'response' and 'period'.</p>
</td></tr>
<tr><td><code id="mixmodel_AR1_cont_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="mixmodel_AR1_cont_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="mixmodel_AR1_cont_+3A_ci">ci</code></td>
<td>
<p>Logical. Indicates whether confidence intervals should be computed. Default=FALSE.</p>
</td></tr>
<tr><td><code id="mixmodel_AR1_cont_+3A_ncc">ncc</code></td>
<td>
<p>Logical. Indicates whether to include non-concurrent data into the analysis. Default=TRUE.</p>
</td></tr>
<tr><td><code id="mixmodel_AR1_cont_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="mixmodel_AR1_cont_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the difference in means
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_cont(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
theta = rep(0.25, 3), lambda = rep(0.15, 4), sigma = 1, trend = "linear")

mixmodel_AR1_cont(data = trial_data, arm = 3, ci = TRUE)

</code></pre>

<hr>
<h2 id='mixmodel_cal_cont'>Mixed regression model analysis for continuous data adjusting for calendar time units as a random factor</h2><span id='topic+mixmodel_cal_cont'></span>

<h3>Description</h3>

<p>This function performs linear mixed model regression taking into account all trial data until the arm under study leaves the trial and adjusting for calendar time units as random factors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mixmodel_cal_cont(
  data,
  arm,
  alpha = 0.025,
  ci = FALSE,
  unit_size = 25,
  ncc = TRUE,
  check = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mixmodel_cal_cont_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_cont()</code> function. Must contain columns named 'treatment' and 'response'.</p>
</td></tr>
<tr><td><code id="mixmodel_cal_cont_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="mixmodel_cal_cont_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="mixmodel_cal_cont_+3A_ci">ci</code></td>
<td>
<p>Logical. Indicates whether confidence intervals should be computed. Default=FALSE.</p>
</td></tr>
<tr><td><code id="mixmodel_cal_cont_+3A_unit_size">unit_size</code></td>
<td>
<p>Integer. Number of patients per calendar time unit. Default=25.</p>
</td></tr>
<tr><td><code id="mixmodel_cal_cont_+3A_ncc">ncc</code></td>
<td>
<p>Logical. Indicates whether to include non-concurrent data into the analysis. Default=TRUE.</p>
</td></tr>
<tr><td><code id="mixmodel_cal_cont_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="mixmodel_cal_cont_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the difference in means
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_cont(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
theta = rep(0.25, 3), lambda = rep(0.15, 4), sigma = 1, trend = "linear")

mixmodel_cal_cont(data = trial_data, arm = 3, ci = TRUE)

</code></pre>

<hr>
<h2 id='mixmodel_cont'>Mixed regression model analysis for continuous data adjusting for periods as a random factor</h2><span id='topic+mixmodel_cont'></span>

<h3>Description</h3>

<p>This function performs linear mixed model regression taking into account all trial data until the arm under study leaves the trial and adjusting for periods as random factors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mixmodel_cont(
  data,
  arm,
  alpha = 0.025,
  ci = FALSE,
  ncc = TRUE,
  check = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mixmodel_cont_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_cont()</code> function. Must contain columns named 'treatment', 'response' and 'period'.</p>
</td></tr>
<tr><td><code id="mixmodel_cont_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="mixmodel_cont_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="mixmodel_cont_+3A_ci">ci</code></td>
<td>
<p>Logical. Indicates whether confidence intervals should be computed. Default=FALSE.</p>
</td></tr>
<tr><td><code id="mixmodel_cont_+3A_ncc">ncc</code></td>
<td>
<p>Logical. Indicates whether to include non-concurrent data into the analysis. Default=TRUE.</p>
</td></tr>
<tr><td><code id="mixmodel_cont_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="mixmodel_cont_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the difference in means
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_cont(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
theta = rep(0.25, 3), lambda = rep(0.15, 4), sigma = 1, trend = "linear")

mixmodel_cont(data = trial_data, arm = 3, ci = TRUE)

</code></pre>

<hr>
<h2 id='piecewise_cal_cont'>Model-based analysis for continuous data using discontinuous piecewise polynomials per calendar time unit</h2><span id='topic+piecewise_cal_cont'></span>

<h3>Description</h3>

<p>This function performs linear regression taking into account all trial data until the arm under study leaves the trial and adjusting for time using discontinuous piecewise polynomials in each calendar time unit.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>piecewise_cal_cont(
  data,
  arm,
  alpha = 0.025,
  unit_size = 25,
  ncc = TRUE,
  poly_degree = 3,
  check = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="piecewise_cal_cont_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_cont()</code> function. Must contain columns named 'treatment', 'response' and 'j'.</p>
</td></tr>
<tr><td><code id="piecewise_cal_cont_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="piecewise_cal_cont_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="piecewise_cal_cont_+3A_unit_size">unit_size</code></td>
<td>
<p>Integer. Number of patients per calendar time unit. Default=25.</p>
</td></tr>
<tr><td><code id="piecewise_cal_cont_+3A_ncc">ncc</code></td>
<td>
<p>Logical. Indicates whether to include non-concurrent data into the analysis. Default=TRUE.</p>
</td></tr>
<tr><td><code id="piecewise_cal_cont_+3A_poly_degree">poly_degree</code></td>
<td>
<p>Integer. Degree of the piecewise polynomial. Default=3.</p>
</td></tr>
<tr><td><code id="piecewise_cal_cont_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="piecewise_cal_cont_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the difference in means
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_cont(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
theta = rep(0.25, 3), lambda = rep(0.15, 4), sigma = 1, trend = "linear")

piecewise_cal_cont(data = trial_data, arm = 3)

</code></pre>

<hr>
<h2 id='piecewise_cont'>Model-based analysis for continuous data using discontinuous piecewise polynomials per period</h2><span id='topic+piecewise_cont'></span>

<h3>Description</h3>

<p>This function performs linear regression taking into account all trial data until the arm under study leaves the trial and adjusting for time using discontinuous piecewise polynomials in each period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>piecewise_cont(
  data,
  arm,
  alpha = 0.025,
  ncc = TRUE,
  poly_degree = 3,
  check = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="piecewise_cont_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_cont()</code> function. Must contain columns named 'treatment', 'response', 'period' and 'j'.</p>
</td></tr>
<tr><td><code id="piecewise_cont_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="piecewise_cont_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="piecewise_cont_+3A_ncc">ncc</code></td>
<td>
<p>Logical. Indicates whether to include non-concurrent data into the analysis. Default=TRUE.</p>
</td></tr>
<tr><td><code id="piecewise_cont_+3A_poly_degree">poly_degree</code></td>
<td>
<p>Integer. Degree of the piecewise polynomial. Default=3.</p>
</td></tr>
<tr><td><code id="piecewise_cont_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="piecewise_cont_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the difference in means
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_cont(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
theta = rep(0.25, 3), lambda = rep(0.15, 4), sigma = 1, trend = "linear")

piecewise_cont(data = trial_data, arm = 3)

</code></pre>

<hr>
<h2 id='plot_trial'>Function for visualizing the simulated trial</h2><span id='topic+plot_trial'></span>

<h3>Description</h3>

<p>This function creates a plot visualizing the trial progress over time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_trial(treatments)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_trial_+3A_treatments">treatments</code></td>
<td>
<p>Vector with indices of assigned arms for each participant, ordered by time, e.g. column <code>treatment</code> from the dataframe resulting from the <code>datasim_bin()</code> or <code>datasim_cont()</code> function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot showing trial progress over time.
</p>


<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_bin(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
p0 = 0.7, OR = rep(1.8, 3), lambda = rep(0.15, 4), trend="stepwise")

plot_trial(treatments = trial_data$treatment)


</code></pre>

<hr>
<h2 id='poolmodel_bin'>Pooled analysis for binary data</h2><span id='topic+poolmodel_bin'></span>

<h3>Description</h3>

<p>This function performs pooled analysis (naively pooling concurrent and non-concurrent controls without adjustment) using a logistic model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poolmodel_bin(data, arm, alpha = 0.025, check = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="poolmodel_bin_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_bin()</code> function. Must contain columns named 'treatment', 'response' and 'period'.</p>
</td></tr>
<tr><td><code id="poolmodel_bin_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="poolmodel_bin_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="poolmodel_bin_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="poolmodel_bin_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The pooled analysis takes into account only the data from the evaluated experimental treatment arm and the whole control arm and uses a logistic regression model to evaluate the given treatment arm.
Denoting by <code class="reqn">y_j</code> the response probability for patient <code class="reqn">j</code>, by <code class="reqn">k_j</code> the arm patient <code class="reqn">j</code> was allocated to, and by <code class="reqn">M</code> the treatment arm under evaluation, the regression model is given by:
</p>
<p style="text-align: center;"><code class="reqn">g(E(y_j)) = \eta_0  + \theta_M \cdot I(k_j=M)</code>
</p>

<p>where <code class="reqn">g(\cdot)</code> denotes the logit link function and <code class="reqn">\eta_0</code> is the log odds in the control arm;
<code class="reqn">\theta_M</code> represents the log odds ratio of treatment <code class="reqn">M</code> and control.
</p>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the log-odds ratio
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_bin(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
p0 = 0.7, OR = rep(1.8, 3), lambda = rep(0.15, 4), trend="stepwise")

poolmodel_bin(data = trial_data, arm = 3)

</code></pre>

<hr>
<h2 id='poolmodel_cont'>Pooled analysis for continuous data</h2><span id='topic+poolmodel_cont'></span>

<h3>Description</h3>

<p>This function performs pooled analysis (naively pooling concurrent and non-concurrent controls without adjustment) using a linear model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poolmodel_cont(data, arm, alpha = 0.025, check = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="poolmodel_cont_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_cont()</code> function. Must contain columns named 'treatment', 'response' and 'period'.</p>
</td></tr>
<tr><td><code id="poolmodel_cont_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="poolmodel_cont_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="poolmodel_cont_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="poolmodel_cont_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The pooled analysis takes into account only the data from the evaluated experimental treatment arm and the whole control arm and uses a linear regression model to evaluate the given treatment arm.
Denoting by <code class="reqn">y_j</code> the continuous response for patient <code class="reqn">j</code>, by <code class="reqn">k_j</code> the arm patient <code class="reqn">j</code> was allocated to, and by <code class="reqn">M</code> the treatment arm under evaluation, the regression model is given by:
</p>
<p style="text-align: center;"><code class="reqn">E(y_j) = \eta_0  + \theta_M \cdot I(k_j=M)</code>
</p>

<p>where <code class="reqn">\eta_0</code> is the response in the control arm;
<code class="reqn">\theta_M</code> represents the treatment effect of treatment <code class="reqn">M</code> as compared to control.
</p>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the difference in means
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_cont(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
theta = rep(0.25, 3), lambda = rep(0.15, 4), sigma = 1, trend = "linear")

poolmodel_cont(data = trial_data, arm = 3)

</code></pre>

<hr>
<h2 id='seasonal_trend'>Generation of a seasonal trend</h2><span id='topic+seasonal_trend'></span>

<h3>Description</h3>

<p>This function generates a time trend for given time points in the trial according to a periodic function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>seasonal_trend(j, lambda, n_wave, n_total)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="seasonal_trend_+3A_j">j</code></td>
<td>
<p>Time points for which the trend should be generated.</p>
</td></tr>
<tr><td><code id="seasonal_trend_+3A_lambda">lambda</code></td>
<td>
<p>Strength of time trend.</p>
</td></tr>
<tr><td><code id="seasonal_trend_+3A_n_wave">n_wave</code></td>
<td>
<p>How many cycles (waves) should the time trend have (<code class="reqn">\psi</code>).</p>
</td></tr>
<tr><td><code id="seasonal_trend_+3A_n_total">n_total</code></td>
<td>
<p>Total sample size in the trial.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The time trend is generated according to the function <code class="reqn">f(j) = \lambda \cdot \mathrm{sin} \big( \psi \cdot 2\pi \cdot \frac{j-1}{N-1} \big)</code>, where <code class="reqn">N</code> is the total sample size  (parameter <code>n_total</code>) and the parameter <code class="reqn">\psi</code> corresponds to the input parameter <code>n_wave</code>.
</p>


<h3>Value</h3>

<p>Time trend for time points j.
</p>


<h3>Author(s)</h3>

<p>Marta Bofill Roig, Pavla Krotka
</p>

<hr>
<h2 id='sepmodel_adj_bin'>Separate analysis for binary data adjusted for periods</h2><span id='topic+sepmodel_adj_bin'></span>

<h3>Description</h3>

<p>This function performs separate analysis (only taking into account concurrent controls) using a logistic model and adjusting for periods, if the treatment arm stays in the trial for more than one period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sepmodel_adj_bin(data, arm, alpha = 0.025, check = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sepmodel_adj_bin_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_bin()</code> function. Must contain columns named 'treatment', 'response' and 'period'.</p>
</td></tr>
<tr><td><code id="sepmodel_adj_bin_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="sepmodel_adj_bin_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="sepmodel_adj_bin_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="sepmodel_adj_bin_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The adjusted separate analysis takes into account only the data from the evaluated experimental treatment arm and its concurrent controls and adjusts for the time effect by including the factor period (defined as a time interval bounded by any treatment arm entering or leaving the platform). The time is then modelled as a step-function with jumps at the beginning of each period.
Denoting by <code class="reqn">y_j</code> the response probability for patient <code class="reqn">j</code>, by <code class="reqn">k_j</code> the arm patient <code class="reqn">j</code> was allocated to, and by <code class="reqn">M</code> the treatment arm under evaluation, the regression model is given by:
</p>
<p style="text-align: center;"><code class="reqn">g(E(y_j)) = \eta_0  + \theta_M \cdot I(k_j=M) + \sum_{s=S_{M_1}+1}^{S_{M_2}} \tau_s \cdot I(t_j \in T_{S_s})</code>
</p>

<p>where <code class="reqn">g(\cdot)</code> denotes the logit link function and <code class="reqn">\eta_0</code> is the log odds in the concurrent controls;
<code class="reqn">\theta_M</code> represents the log odds ratio of treatment <code class="reqn">M</code> and control;
<code class="reqn">\tau_s</code> indicates the stepwise period effect in terms of the log odds ratio between periods <code class="reqn">S_{M_1}</code> and <code class="reqn">s</code> (<code class="reqn">s = S_{M_1}+1, \ldots, S_{M_2}</code>), where <code class="reqn">S_{M_1}</code> and <code class="reqn">S_{M_2}</code> denote the periods, in which the investigated treatment arm joined and left the trial, respectively.
</p>
<p>If the data consists of only one period, the period in not used as covariate.
</p>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the log-odds ratio
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_bin(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
p0 = 0.7, OR = rep(1.8, 3), lambda = rep(0.15, 4), trend="stepwise")

sepmodel_adj_bin(data = trial_data, arm = 3)

</code></pre>

<hr>
<h2 id='sepmodel_adj_cont'>Separate analysis for continuous data adjusted for periods</h2><span id='topic+sepmodel_adj_cont'></span>

<h3>Description</h3>

<p>This function performs separate analysis (only taking into account concurrent controls) using a linear model and adjusting for periods, if the treatment arm stays in the trial for more than one period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sepmodel_adj_cont(data, arm, alpha = 0.025, check = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sepmodel_adj_cont_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_cont()</code> function. Must contain columns named 'treatment', 'response' and 'period'.</p>
</td></tr>
<tr><td><code id="sepmodel_adj_cont_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="sepmodel_adj_cont_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="sepmodel_adj_cont_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="sepmodel_adj_cont_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The adjusted separate analysis takes into account only the data from the evaluated experimental treatment arm and its concurrent controls and adjusts for the time effect by including the factor period (defined as a time interval bounded by any treatment arm entering or leaving the platform). The time is then modelled as a step-function with jumps at the beginning of each period.
Denoting by <code class="reqn">y_j</code> the response probability for patient <code class="reqn">j</code>, by <code class="reqn">k_j</code> the arm patient <code class="reqn">j</code> was allocated to, and by <code class="reqn">M</code> the treatment arm under evaluation, the regression model is given by:
</p>
<p style="text-align: center;"><code class="reqn">E(y_j) = \eta_0  + \theta_M \cdot I(k_j=M) + \sum_{s=S_{M_1}+1}^{S_{M_2}} \tau_s \cdot I(t_j \in T_{S_s})</code>
</p>

<p>where <code class="reqn">\eta_0</code> is the response in the concurrent controls;
<code class="reqn">\theta_M</code> represents the treatment effect of treatment <code class="reqn">M</code> as compared to control;
<code class="reqn">\tau_s</code> indicates the stepwise period effect between periods <code class="reqn">S_{M_1}</code> and <code class="reqn">s</code> (<code class="reqn">s = S_{M_1}+1, \ldots, S_{M_2}</code>), where <code class="reqn">S_{M_1}</code> and <code class="reqn">S_{M_2}</code> denote the periods, in which the investigated treatment arm joined and left the trial, respectively.
</p>
<p>If the data consists of only one period, the period in not used as covariate.
</p>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the difference in means
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_cont(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
theta = rep(0.25, 3), lambda = rep(0.15, 4), sigma = 1, trend = "linear")

sepmodel_adj_cont(data = trial_data, arm = 3)

</code></pre>

<hr>
<h2 id='sepmodel_bin'>Separate analysis for binary data</h2><span id='topic+sepmodel_bin'></span>

<h3>Description</h3>

<p>This function performs separate analysis (only taking into account concurrent controls) using a logistic model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sepmodel_bin(data, arm, alpha = 0.025, check = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sepmodel_bin_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_bin()</code> function. Must contain columns named 'treatment', 'response' and 'period'.</p>
</td></tr>
<tr><td><code id="sepmodel_bin_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="sepmodel_bin_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="sepmodel_bin_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="sepmodel_bin_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The separate analysis takes into account only the data from the evaluated experimental treatment arm and its concurrent controls and uses a logistic regression model to evaluate the given treatment arm.
Denoting by <code class="reqn">y_j</code> the response probability for patient <code class="reqn">j</code>, by <code class="reqn">k_j</code> the arm patient <code class="reqn">j</code> was allocated to, and by <code class="reqn">M</code> the treatment arm under evaluation, the regression model is given by:
</p>
<p style="text-align: center;"><code class="reqn">g(E(y_j)) = \eta_0  + \theta_M \cdot I(k_j=M)</code>
</p>

<p>where <code class="reqn">g(\cdot)</code> denotes the logit link function and <code class="reqn">\eta_0</code> is the log odds in the concurrent controls;
<code class="reqn">\theta_M</code> represents the log odds ratio of treatment <code class="reqn">M</code> and control.
</p>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the log-odds ratio
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_bin(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
p0 = 0.7, OR = rep(1.8, 3), lambda = rep(0.15, 4), trend="stepwise")

sepmodel_bin(data = trial_data, arm = 3)

</code></pre>

<hr>
<h2 id='sepmodel_cont'>Separate analysis for continuous data</h2><span id='topic+sepmodel_cont'></span>

<h3>Description</h3>

<p>This function performs separate analysis (only taking into account concurrent controls) using a linear model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sepmodel_cont(data, arm, alpha = 0.025, check = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sepmodel_cont_+3A_data">data</code></td>
<td>
<p>Data frame trial data, e.g. result from the <code>datasim_cont()</code> function. Must contain columns named 'treatment', 'response' and 'period'.</p>
</td></tr>
<tr><td><code id="sepmodel_cont_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="sepmodel_cont_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="sepmodel_cont_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="sepmodel_cont_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The separate analysis takes into account only the data from the evaluated experimental treatment arm and its concurrent controls and uses a linear regression model to evaluate the given treatment arm.
Denoting by <code class="reqn">y_j</code> the continuous response for patient <code class="reqn">j</code>, by <code class="reqn">k_j</code> the arm patient <code class="reqn">j</code> was allocated to, and by <code class="reqn">M</code> the treatment arm under evaluation, the regression model is given by:
</p>
<p style="text-align: center;"><code class="reqn">E(y_j) = \eta_0  + \theta_M \cdot I(k_j=M)</code>
</p>

<p>where <code class="reqn">\eta_0</code> is the response in the concurrent controls;
<code class="reqn">\theta_M</code> represents the treatment effect of treatment <code class="reqn">M</code> as compared to control.
</p>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the difference in means
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_cont(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
theta = rep(0.25, 3), lambda = rep(0.15, 4), sigma = 1, trend = "linear")

sepmodel_cont(data = trial_data, arm = 3)

</code></pre>

<hr>
<h2 id='sim_study'>Wrapper function performing simulation studies for a given set of scenarios (not parallelized)</h2><span id='topic+sim_study'></span>

<h3>Description</h3>

<p>This function performs a simulation study for a given set of scenarios, analyzing simulated data using different models as indicated by the user. Performs inference for indicated experimental treatment arms. Simulates the probability to reject <code class="reqn">H_0</code> based on a given number of replications.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim_study(
  nsim,
  scenarios,
  arms,
  models = c("fixmodel", "sepmodel", "poolmodel"),
  endpoint,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sim_study_+3A_nsim">nsim</code></td>
<td>
<p>Integer. Number of replications. Must be larger than 1.</p>
</td></tr>
<tr><td><code id="sim_study_+3A_scenarios">scenarios</code></td>
<td>
<p>Data frame containing all parameters for scenarios that should be simulated.</p>
</td></tr>
<tr><td><code id="sim_study_+3A_arms">arms</code></td>
<td>
<p>Integer vector with treatment arms to perform inference on. These arms are compared to the control group. Default - all arms except the first one.</p>
</td></tr>
<tr><td><code id="sim_study_+3A_models">models</code></td>
<td>
<p>Character vector with models that should be used for the analysis. Default=c(&quot;fixmodel&quot;, &quot;sepmodel&quot;, &quot;poolmodel&quot;). Available models for continuous endpoints are: 'fixmodel', 'fixmodel_cal', 'gam', 'MAPprior', 'mixmodel', 'mixmodel_cal', 'mixmodel_AR1', 'mixmodel_AR1_cal', 'piecewise', 'piecewise_cal', 'poolmodel', 'sepmodel', 'sepmodel_adj', 'splines', 'splines_cal', 'timemachine'. Available models for binary endpoints are: 'fixmodel', 'fixmodel_cal', 'MAPprior', 'poolmodel', 'sepmodel', 'sepmodel_adj', 'timemachine'.</p>
</td></tr>
<tr><td><code id="sim_study_+3A_endpoint">endpoint</code></td>
<td>
<p>Endpoint indicator. &quot;cont&quot; for continuous endpoints, &quot;bin&quot; for binary endpoints.</p>
</td></tr>
<tr><td><code id="sim_study_+3A_verbose">verbose</code></td>
<td>
<p>Logical. Indicates whether to print a message (system time and number of finished scenarios) after simulating each scenario in order to track the progress of the simulations. Default=TRUE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Data frame with all considered scenarios and corresponding results - the probability to reject <code class="reqn">H_0</code>.
</p>


<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# Create data frame with all parameters:
sim_scenarios &lt;- data.frame(num_arms = 4,
n_arm = 250,
d1 = 250*0,
d2 = 250*1,
d3 = 250*2,
d4 = 250*3,
period_blocks = 2,
mu0 = 0,
sigma = 1,
theta1 = 0,
theta2 = 0,
theta3 = 0,
theta4 = 0,
lambda0 = rep(seq(-0.15, 0.15, length.out = 9), 2),
lambda1 = rep(seq(-0.15, 0.15, length.out = 9), 2),
lambda2 = rep(seq(-0.15, 0.15, length.out = 9), 2),
lambda3 = rep(seq(-0.15, 0.15, length.out = 9), 2),
lambda4 = rep(seq(-0.15, 0.15, length.out = 9), 2),
trend = c(rep("linear", 9), rep("stepwise_2", 9)),
alpha = 0.025,
ncc = TRUE)

# Run simulation study:
sim_results &lt;- sim_study(nsim = 100, scenarios = sim_scenarios, arms = c(3, 4),
models = c("fixmodel", "sepmodel", "poolmodel"), endpoint = "cont")



</code></pre>

<hr>
<h2 id='sim_study_par'>Wrapper function performing simulation studies for a given set of scenarios (parallelized on replication level)</h2><span id='topic+sim_study_par'></span>

<h3>Description</h3>

<p>This function performs a simulation study for a given set of scenarios, analyzing simulated data using different models as indicated by the user. Performs inference for indicated experimental treatment arms. Simulates the probability to reject <code class="reqn">H_0</code>, and the bias, as well as the mean squared error (MSE) of the treatment effect estimates based on a given number of replications.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim_study_par(
  nsim,
  scenarios,
  arms,
  models = c("fixmodel", "sepmodel", "poolmodel"),
  endpoint,
  perc_cores = 0.9,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sim_study_par_+3A_nsim">nsim</code></td>
<td>
<p>Integer. Number of replications. Must be larger than 1.</p>
</td></tr>
<tr><td><code id="sim_study_par_+3A_scenarios">scenarios</code></td>
<td>
<p>Data frame containing all parameters for scenarios that should be simulated.</p>
</td></tr>
<tr><td><code id="sim_study_par_+3A_arms">arms</code></td>
<td>
<p>Integer vector with treatment arms to perform inference on. These arms are compared to the control group. Default - all arms except the first one.</p>
</td></tr>
<tr><td><code id="sim_study_par_+3A_models">models</code></td>
<td>
<p>Character vector with models that should be used for the analysis. Default=c(&quot;fixmodel&quot;, &quot;sepmodel&quot;, &quot;poolmodel&quot;). Available models for continuous endpoints are: 'fixmodel', 'fixmodel_cal', 'gam', 'MAPprior', 'mixmodel', 'mixmodel_cal', 'mixmodel_AR1', 'mixmodel_AR1_cal', 'piecewise', 'piecewise_cal', 'poolmodel', 'sepmodel', 'sepmodel_adj', 'splines', 'splines_cal', 'timemachine'. Available models for binary endpoints are: 'fixmodel', 'fixmodel_cal', 'MAPprior', 'poolmodel', 'sepmodel', 'sepmodel_adj', 'timemachine'.</p>
</td></tr>
<tr><td><code id="sim_study_par_+3A_endpoint">endpoint</code></td>
<td>
<p>Endpoint indicator. &quot;cont&quot; for continuous endpoints, &quot;bin&quot; for binary endpoints.</p>
</td></tr>
<tr><td><code id="sim_study_par_+3A_perc_cores">perc_cores</code></td>
<td>
<p>Double. What percentage of available cores should be used for the simulations. Default=0.9.</p>
</td></tr>
<tr><td><code id="sim_study_par_+3A_verbose">verbose</code></td>
<td>
<p>Logical. Indicates whether to print a message (system time and number of finished scenarios) after simulating each scenario in order to track the progress of the simulations. Default=TRUE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Data frame with all considered scenarios and corresponding results - the probability to reject <code class="reqn">H_0</code>, and the bias, as well as the mean squared error (MSE) of the treatment effect estimates.
</p>


<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# Create data frame with all parameters:
sim_scenarios &lt;- data.frame(num_arms = 4,
n_arm = 250,
d1 = 250*0,
d2 = 250*1,
d3 = 250*2,
d4 = 250*3,
period_blocks = 2,
mu0 = 0,
sigma = 1,
theta1 = 0,
theta2 = 0,
theta3 = 0,
theta4 = 0,
lambda0 = rep(seq(-0.15, 0.15, length.out = 9), 2),
lambda1 = rep(seq(-0.15, 0.15, length.out = 9), 2),
lambda2 = rep(seq(-0.15, 0.15, length.out = 9), 2),
lambda3 = rep(seq(-0.15, 0.15, length.out = 9), 2),
lambda4 = rep(seq(-0.15, 0.15, length.out = 9), 2),
trend = c(rep("linear", 9), rep("stepwise_2", 9)),
alpha = 0.025,
ncc = TRUE)

# Run simulation study:
sim_results &lt;- sim_study_par(nsim = 100, scenarios = sim_scenarios, arms = c(3, 4),
models = c("fixmodel", "sepmodel", "poolmodel"), endpoint = "cont")



</code></pre>

<hr>
<h2 id='splines_cal_cont'>Spline regression analysis for continuous data with knots placed according to calendar time units</h2><span id='topic+splines_cal_cont'></span>

<h3>Description</h3>

<p>This function performs linear regression taking into account all trial data until the arm under study leaves the trial and adjusting for time using regression splines with knots placed according to calendar time units.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>splines_cal_cont(
  data,
  arm,
  alpha = 0.025,
  unit_size = 25,
  ncc = TRUE,
  bs_degree = 3,
  check = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="splines_cal_cont_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_cont()</code> function. Must contain columns named 'treatment', 'response' and 'j'.</p>
</td></tr>
<tr><td><code id="splines_cal_cont_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="splines_cal_cont_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="splines_cal_cont_+3A_unit_size">unit_size</code></td>
<td>
<p>Integer. Number of patients per calendar time unit. Default=25.</p>
</td></tr>
<tr><td><code id="splines_cal_cont_+3A_ncc">ncc</code></td>
<td>
<p>Logical. Indicates whether to include non-concurrent data into the analysis. Default=TRUE.</p>
</td></tr>
<tr><td><code id="splines_cal_cont_+3A_bs_degree">bs_degree</code></td>
<td>
<p>Integer. Degree of the polynomial spline. Default=3 for cubic spline.</p>
</td></tr>
<tr><td><code id="splines_cal_cont_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="splines_cal_cont_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the difference in means
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>knots</code> - positions of the knots in terms of patient index
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_cont(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
theta = rep(0.25, 3), lambda = rep(0.15, 4), sigma = 1, trend = "linear")

splines_cal_cont(data = trial_data, arm = 3)

</code></pre>

<hr>
<h2 id='splines_cont'>Spline regression analysis for continuous data with knots placed according to periods</h2><span id='topic+splines_cont'></span>

<h3>Description</h3>

<p>This function performs linear regression taking into account all trial data until the arm under study leaves the trial and adjusting for time using regression splines with knots placed according to periods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>splines_cont(
  data,
  arm,
  alpha = 0.025,
  ncc = TRUE,
  bs_degree = 3,
  check = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="splines_cont_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_cont()</code> function. Must contain columns named 'treatment', 'response', 'period' and 'j'.</p>
</td></tr>
<tr><td><code id="splines_cont_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="splines_cont_+3A_alpha">alpha</code></td>
<td>
<p>Double. Significance level (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="splines_cont_+3A_ncc">ncc</code></td>
<td>
<p>Logical. Indicates whether to include non-concurrent data into the analysis. Default=TRUE.</p>
</td></tr>
<tr><td><code id="splines_cont_+3A_bs_degree">bs_degree</code></td>
<td>
<p>Integer. Degree of the polynomial spline. Default=3 for cubic spline.</p>
</td></tr>
<tr><td><code id="splines_cont_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="splines_cont_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - p-value (one-sided)
</p>
</li>
<li> <p><code>treat_effect</code> - estimated treatment effect in terms of the difference in means
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% confidence interval
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li>
<li> <p><code>knots</code> - positions of the knots in terms of patient index
</p>
</li>
<li> <p><code>model</code> - fitted model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pavla Krotka
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_cont(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
theta = rep(0.25, 3), lambda = rep(0.15, 4), sigma = 1, trend = "linear")

splines_cont(data = trial_data, arm = 3)

</code></pre>

<hr>
<h2 id='sw_trend'>Generation of stepwise trend with equal jumps between periods</h2><span id='topic+sw_trend'></span>

<h3>Description</h3>

<p>This function generates a stepwise trend for a given period. No time trend is assumed in the first period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sw_trend(cj, lambda)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sw_trend_+3A_cj">cj</code></td>
<td>
<p>Period indicator.</p>
</td></tr>
<tr><td><code id="sw_trend_+3A_lambda">lambda</code></td>
<td>
<p>Strength of time trend.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The time trend is generated according to the function <code class="reqn">f(j) = \lambda \cdot (c_j - 1)</code>, where <code class="reqn">c_j</code> is an index of the period patient <code class="reqn">j</code> was enrolled in.
</p>


<h3>Value</h3>

<p>Time trend in period <code class="reqn">c_j</code>.
</p>


<h3>Author(s)</h3>

<p>Marta Bofill Roig, Pavla Krotka
</p>

<hr>
<h2 id='timemachine_bin'>Time machine analysis for binary data</h2><span id='topic+timemachine_bin'></span>

<h3>Description</h3>

<p>This function performs analysis of binary data using the Time Machine approach. It takes into account all data until the investigated arm leaves the trial. It is based on logistic regression with treatment as a categorical variable and covariate adjustment for time via a second-order Bayesian normal dynamic linear model (separating the trial into buckets of pre-defined size).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>timemachine_bin(
  data,
  arm,
  alpha = 0.025,
  prec_theta = 0.001,
  prec_eta = 0.001,
  tau_a = 0.1,
  tau_b = 0.01,
  bucket_size = 25,
  check = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="timemachine_bin_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_bin()</code> function. Must contain columns named 'treatment', 'response' and 'period'.</p>
</td></tr>
<tr><td><code id="timemachine_bin_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="timemachine_bin_+3A_alpha">alpha</code></td>
<td>
<p>Double. Decision boundary (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="timemachine_bin_+3A_prec_theta">prec_theta</code></td>
<td>
<p>Double. Precision (<code class="reqn">1/\sigma^2_{\theta}</code>) of the prior regarding the treatment effect <code class="reqn">\theta</code>. I.e. <code class="reqn">\theta \sim N(0, \sigma^2_{\theta})</code> . Default=0.001.</p>
</td></tr>
<tr><td><code id="timemachine_bin_+3A_prec_eta">prec_eta</code></td>
<td>
<p>Double. Precision (<code class="reqn">1/\sigma^2_{\eta_0}</code>) of the prior regarding the control log-odds <code class="reqn">\eta_0</code>. I.e. <code class="reqn">\eta_0 \sim N(0, \sigma^2_{\eta_0})</code>. Default=0.001.</p>
</td></tr>
<tr><td><code id="timemachine_bin_+3A_tau_a">tau_a</code></td>
<td>
<p>Double. Parameter <code class="reqn">a_{\tau}</code> of the Gamma distribution for the precision parameter <code class="reqn">\tau</code> in the model for the time trend. I.e., <code class="reqn">\tau \sim Gamma(a_{\tau},b_{\tau})</code>. Default=0.1.</p>
</td></tr>
<tr><td><code id="timemachine_bin_+3A_tau_b">tau_b</code></td>
<td>
<p>Double. Parameter <code class="reqn">b_{\tau}</code> of the Gamma distribution for the precision parameter <code class="reqn">\tau</code> in the model for the time trend. I.e., <code class="reqn">\tau \sim Gamma(a_{\tau},b_{\tau})</code>. Default=0.01.</p>
</td></tr>
<tr><td><code id="timemachine_bin_+3A_bucket_size">bucket_size</code></td>
<td>
<p>Integer. Number of patients per time bucket. Default=25.</p>
</td></tr>
<tr><td><code id="timemachine_bin_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="timemachine_bin_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The Time Machine divides the trial duration into <code class="reqn">C</code> calendar time intervals of equal length (&quot;buckets&quot;), which are indexed backwards in time. That is to say, the most recent time interval is denoted by <code class="reqn">c=1</code> and the time interval corresponding to the beginning of the trial by <code class="reqn">c=C</code>.
The analysis is performed as soon as the analyzed treatment arm finishes in the trial.
</p>
<p>The model is defined as follows:
</p>
<p style="text-align: center;"><code class="reqn">g(E(y_j)) = \eta_0 + \theta_{k_j} + \alpha_{c_j}</code>
</p>

<p>where <code class="reqn">y_j</code> is the binary response for patient <code class="reqn">j</code> and <code class="reqn">g(\cdot)</code> is the logit link function, which maps the expected value of the patient response to the linear predictors in the model.
The model intercept <code class="reqn">\eta_0</code> denotes the response of the control group at time of the analysis, <code class="reqn">\theta_{k_j}</code> is the effect of the treatment arm <code class="reqn">k</code> that patient <code class="reqn">j</code> was enrolled in, relative to control in terms of the log odds ratio.
For the parameters <code class="reqn">\eta_0</code> and <code class="reqn">\theta_{k_j}</code>, normal prior distributions are assumed, with mean 0 and variances <code class="reqn">\sigma^2_{\eta_0}</code> and <code class="reqn">\sigma^2_{\theta}</code>, respectively:
</p>
<p style="text-align: center;"><code class="reqn">\eta_0 \sim \mathcal{N}(0, \sigma^2_{\eta_0})</code>
</p>

<p style="text-align: center;"><code class="reqn">\theta_{k_j} \sim \mathcal{N}(0, \sigma^2_{\theta})</code>
</p>

<p>In the Time Machine, time effect is represented by <code class="reqn">\alpha_{c_j}</code>, which is the change in the response in time bucket <code class="reqn">c_j</code> (which denotes the time bucket in which patient <code class="reqn">j</code> is enrolled) compared to the most recent time bucket <code class="reqn">c=1</code> and is modeled using a Bayesian second-order normal dynamic linear model.
This creates a smoothing over the control response, such that closer time buckets are modeled with more similar response rates:
</p>
<p style="text-align: center;"><code class="reqn">\alpha_1 = 0</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha_2 \sim \mathcal{N}(0, 1/\tau)</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha_c \sim \mathcal{N}(2 \alpha_{c-1} - \alpha_{c-2}, 1/\tau), 3 \le c \le C</code>
</p>

<p>where <code class="reqn">\tau</code> denotes the drift parameter that controls the degree of smoothing over the time buckets and is assumed to have a Gamma hyperprior distribution:
</p>
<p style="text-align: center;"><code class="reqn">\tau \sim Gamma(a_{\tau}, b_{\tau})</code>
</p>



<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - posterior probability that the log-odds ratio is less than zero
</p>
</li>
<li> <p><code>treat_effect</code> - posterior mean of log-odds ratio
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% credible interval for log-odds ratio
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% credible interval for log-odds ratio
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Dominic Magirr, Peter Jacko
</p>


<h3>References</h3>

<p>The Bayesian Time Machine: Accounting for Temporal Drift in Multi-arm Platform Trials. Saville, B. R., Berry, D. A., et al. Clinical Trials 19.5 (2022): 490-501.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_bin(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
p0 = 0.7, OR = rep(1.8, 3), lambda = rep(0.15, 4), trend="stepwise")

timemachine_bin(data = trial_data, arm = 3)


</code></pre>

<hr>
<h2 id='timemachine_cont'>Time machine analysis for continuous data</h2><span id='topic+timemachine_cont'></span>

<h3>Description</h3>

<p>This function performs analysis of continuous data using the Time Machine approach. It takes into account all data until the investigated arm leaves the trial. It is based on linear regression with treatment as a categorical variable and covariate adjustment for time via a second-order Bayesian normal dynamic linear model (separating the trial into buckets of pre-defined size).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>timemachine_cont(
  data,
  arm,
  alpha = 0.025,
  prec_theta = 0.001,
  prec_eta = 0.001,
  tau_a = 0.1,
  tau_b = 0.01,
  prec_a = 0.001,
  prec_b = 0.001,
  bucket_size = 25,
  check = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="timemachine_cont_+3A_data">data</code></td>
<td>
<p>Data frame with trial data, e.g. result from the <code>datasim_cont()</code> function. Must contain columns named 'treatment', 'response' and 'period'.</p>
</td></tr>
<tr><td><code id="timemachine_cont_+3A_arm">arm</code></td>
<td>
<p>Integer. Index of the treatment arm under study to perform inference on (vector of length 1). This arm is compared to the control group.</p>
</td></tr>
<tr><td><code id="timemachine_cont_+3A_alpha">alpha</code></td>
<td>
<p>Double. Decision boundary (one-sided). Default=0.025.</p>
</td></tr>
<tr><td><code id="timemachine_cont_+3A_prec_theta">prec_theta</code></td>
<td>
<p>Double. Precision (<code class="reqn">1/\sigma^2_{\theta}</code>) of the prior regarding the treatment effect <code class="reqn">\theta</code>. I.e. <code class="reqn">\theta \sim N(0, \sigma^2_{\theta})</code>. Default=0.001.</p>
</td></tr>
<tr><td><code id="timemachine_cont_+3A_prec_eta">prec_eta</code></td>
<td>
<p>Double. Precision (<code class="reqn">1/\sigma^2_{\eta_0}</code>) of the prior regarding the control mean <code class="reqn">\eta_0</code>. I.e. <code class="reqn">\eta_0 \sim N(0, \sigma^2_{\eta_0})</code>. Default=0.001.</p>
</td></tr>
<tr><td><code id="timemachine_cont_+3A_tau_a">tau_a</code></td>
<td>
<p>Double. Parameter <code class="reqn">a_{\tau}</code> of the Gamma distribution for the precision parameter <code class="reqn">\tau</code> in the model for the time trend. I.e., <code class="reqn">\tau \sim Gamma(a_{\tau},b_{\tau})</code>. Default=0.1.</p>
</td></tr>
<tr><td><code id="timemachine_cont_+3A_tau_b">tau_b</code></td>
<td>
<p>Double. Parameter <code class="reqn">b_{\tau}</code> of the Gamma distribution for the precision parameter <code class="reqn">\tau</code> in the model for the time trend. I.e., <code class="reqn">\tau \sim Gamma(a_{\tau},b_{\tau})</code>. Default=0.01.</p>
</td></tr>
<tr><td><code id="timemachine_cont_+3A_prec_a">prec_a</code></td>
<td>
<p>Double. Parameter <code class="reqn">a_{\sigma^2}</code> of the Gamma distribution regarding the precision of the responses. I.e., <code class="reqn">1/\sigma^2 \sim Gamma(a_{\sigma^2},b_{\sigma^2})</code>. Default=0.001.</p>
</td></tr>
<tr><td><code id="timemachine_cont_+3A_prec_b">prec_b</code></td>
<td>
<p>Double. Parameter <code class="reqn">b_{\sigma^2}</code> of the Gamma distribution regarding the precision of the responses. I.e., <code class="reqn">1/\sigma^2 \sim Gamma(a_{\sigma^2},b_{\sigma^2})</code>. Default=0.001.</p>
</td></tr>
<tr><td><code id="timemachine_cont_+3A_bucket_size">bucket_size</code></td>
<td>
<p>Integer. Number of patients per time bucket. Default=25.</p>
</td></tr>
<tr><td><code id="timemachine_cont_+3A_check">check</code></td>
<td>
<p>Logical. Indicates whether the input parameters should be checked by the function. Default=TRUE, unless the function is called by a simulation function, where the default is FALSE.</p>
</td></tr>
<tr><td><code id="timemachine_cont_+3A_...">...</code></td>
<td>
<p>Further arguments passed by wrapper functions when running simulations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The Time Machine divides the trial duration into <code class="reqn">C</code> calendar time intervals of equal length (&quot;buckets&quot;), which are indexed backwards in time. That is to say, the most recent time interval is denoted by <code class="reqn">c=1</code> and the time interval corresponding to the beginning of the trial by <code class="reqn">c=C</code>.
The analysis is performed as soon as the analyzed treatment arm finishes in the trial.
</p>
<p>The model is defined as follows:
</p>
<p style="text-align: center;"><code class="reqn">E(y_j) = \eta_0 + \theta_{k_j} + \alpha_{c_j}</code>
</p>

<p>where <code class="reqn">y_j</code> is the continuous response for patient <code class="reqn">j</code>.
The model intercept <code class="reqn">\eta_0</code> denotes the response of the control group at time of the analysis, <code class="reqn">\theta_{k_j}</code> is the effect of the treatment arm <code class="reqn">k</code> that patient <code class="reqn">j</code> was enrolled in, relative to control.
For the parameters <code class="reqn">\eta_0</code> and <code class="reqn">\theta_{k_j}</code>, normal prior distributions are assumed, with mean 0 and variances <code class="reqn">\sigma^2_{\eta_0}</code> and <code class="reqn">\sigma^2_{\theta}</code>, respectively:
</p>
<p style="text-align: center;"><code class="reqn">\eta_0 \sim \mathcal{N}(0, \sigma^2_{\eta_0})</code>
</p>

<p style="text-align: center;"><code class="reqn">\theta_{k_j} \sim \mathcal{N}(0, \sigma^2_{\theta})</code>
</p>

<p>In the Time Machine, time effect is represented by <code class="reqn">\alpha_{c_j}</code>, which is the change in the response in time bucket <code class="reqn">c_j</code> (which denotes the time bucket in which patient <code class="reqn">j</code> is enrolled) compared to the most recent time bucket <code class="reqn">c=1</code> and is modeled using a Bayesian second-order normal dynamic linear model.
This creates a smoothing over the control response, such that closer time buckets are modeled with more similar response rates:
</p>
<p style="text-align: center;"><code class="reqn">\alpha_1 = 0</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha_2 \sim \mathcal{N}(0, 1/\tau)</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha_c \sim \mathcal{N}(2 \alpha_{c-1} - \alpha_{c-2}, 1/\tau), 3 \le c \le C</code>
</p>

<p>where <code class="reqn">\tau</code> denotes the drift parameter that controls the degree of smoothing over the time buckets and is assumed to have a Gamma hyperprior distribution:
</p>
<p style="text-align: center;"><code class="reqn">\tau \sim Gamma(a_{\tau}, b_{\tau})</code>
</p>

<p>The precision of the individual patient responses (<code class="reqn">1/\sigma^2</code>) is also assumed to have a Gamma hyperprior distribution:
</p>
<p style="text-align: center;"><code class="reqn">1/\sigma^2 \sim Gamma(a_{\sigma^2}, b_{\sigma^2})</code>
</p>



<h3>Value</h3>

<p>List containing the following elements regarding the results of comparing <code>arm</code> to control:
</p>

<ul>
<li> <p><code>p-val</code> - posterior probability that the difference in means is less than zero
</p>
</li>
<li> <p><code>treat_effect</code> - posterior mean of difference in means
</p>
</li>
<li> <p><code>lower_ci</code> - lower limit of the (1-2*<code>alpha</code>)*100% credible interval for difference in means
</p>
</li>
<li> <p><code>upper_ci</code> - upper limit of the (1-2*<code>alpha</code>)*100% credible interval for difference in means
</p>
</li>
<li> <p><code>reject_h0</code> - indicator of whether the null hypothesis was rejected or not (<code>p_val</code> &lt; <code>alpha</code>)
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Dominic Magirr, Peter Jacko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
trial_data &lt;- datasim_cont(num_arms = 3, n_arm = 100, d = c(0, 100, 250),
theta = rep(0.25, 3), lambda = rep(0.15, 4), sigma = 1, trend = "linear")

timemachine_cont(data = trial_data, arm = 3)


</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
