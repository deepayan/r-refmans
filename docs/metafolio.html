<!DOCTYPE html><html lang="en"><head><title>Help for package metafolio</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {metafolio}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#metafolio'><p>metafolio: An R package to simulate metapopulations for</p>
portfolio optimization</a></li>
<li><a href='#add_dens_polygon'><p>Add a kernel density polygon</p></a></li>
<li><a href='#annotate'><p>Add annotations to panel</p></a></li>
<li><a href='#count_quasi_exts'><p>Take <code>meta_sim</code> output objects and count quasi</p>
extinctions</a></li>
<li><a href='#create_asset_weights'><p>Create an asset weights matrix</p></a></li>
<li><a href='#custom_bw'><p>Custom bandwidth</p></a></li>
<li><a href='#CVaR'><p>Conditional Value at Risk</p></a></li>
<li><a href='#est_beta_params'><p>Get beta parameters from mean and variance</p></a></li>
<li><a href='#fastlm'><p>Super fast linear regression</p></a></li>
<li><a href='#fit_ricker'><p>Fit Ricker linear regression</p></a></li>
<li><a href='#generate_env_ts'><p>Create an environmental time series.</p></a></li>
<li><a href='#generate_straying_matrix'><p>Generate a matrix of straying proportions within a metapopulation</p></a></li>
<li><a href='#get_conserv_plans_mv'><p>Run simulation for conservation schemes</p></a></li>
<li><a href='#get_efficient_frontier'><p>Get the efficient frontier from mean and variance values</p></a></li>
<li><a href='#get_port_vals'><p>Get portfolio mean and variance values</p></a></li>
<li><a href='#get_quantile_contour'><p>Get quantile contour</p></a></li>
<li><a href='#gg_color_hue'><p>ggplot2-like colour scale in HCL space</p></a></li>
<li><a href='#impl_error'><p>Add implementation error</p></a></li>
<li><a href='#is_element'><p>Check if x is an element of y.</p></a></li>
<li><a href='#meta_sim'><p>Run a single metapopulation simulation.</p></a></li>
<li><a href='#metasim_base'><p>Base-level metapopulation simulation function</p></a></li>
<li><a href='#monte_carlo_portfolios'><p>Monte Carlo asset weights into portfolios</p></a></li>
<li><a href='#my.axis'><p>Add a pretty axis</p></a></li>
<li><a href='#optim_thermal'><p>Optimize to find optimal max productivity Ricker a</p></a></li>
<li><a href='#plot_cons_plans'><p>Plot conservation plans in mean-variance space</p></a></li>
<li><a href='#plot_correlation_between_returns'><p>Plot correlation of returns (i.e. metapopulation abundance) across stocks.</p></a></li>
<li><a href='#plot_efficient_portfolios'><p>Basic plot of efficient portfolio and asset contributions</p></a></li>
<li><a href='#plot_panel_lines'><p>Standard matrix plot of values by stream for one panel:</p></a></li>
<li><a href='#plot_rickers'><p>Plot sample Ricker curves for each stock</p></a></li>
<li><a href='#plot_sim_ts'><p>Plot various time series from a simulation run</p></a></li>
<li><a href='#plot_sp_A_ts'><p>Plot sample time series from a portfolio simulation</p></a></li>
<li><a href='#ricker'><p>A simple Ricker model</p></a></li>
<li><a href='#ricker_escapement'><p>Assign a salmon escapement target based on a Ricker curve</p></a></li>
<li><a href='#ricker_v_t'><p>Ricker stock-recruit function with specified error</p></a></li>
<li><a href='#run_cons_plans'><p>Run conservation plans and return the portfolio mean and variance values</p></a></li>
<li><a href='#thermal_area'><p>Return desired squared deviation between desired area and actual</p>
area under a curve</a></li>
<li><a href='#thermal_curve_a'><p>Create thermal tolerance curves.</p></a></li>
<li><a href='#thermal_integration'><p>Integrate thermal tolerance curves to get maximum Ricker a values</p></a></li>
<li><a href='#VaR'><p>Value at Risk</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Metapopulation Simulations for Conserving Salmon Through
Portfolio Optimization</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.2</td>
</tr>
<tr>
<td>Description:</td>
<td>A tool to simulate salmon metapopulations and apply financial
    portfolio optimization concepts. The package accompanies the paper 
    Anderson et al. (2015) &lt;<a href="https://doi.org/10.1101%2F2022.03.24.485545">doi:10.1101/2022.03.24.485545</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/seananderson/metafolio">https://github.com/seananderson/metafolio</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/seananderson/metafolio/issues">https://github.com/seananderson/metafolio/issues</a></td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp (&ge; 0.11.2), plyr, colorspace, MASS</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, TeachingDemos, RColorBrewer, reshape2</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-20 17:44:53 UTC; seananderson</td>
</tr>
<tr>
<td>Author:</td>
<td>Sean C. Anderson <a href="https://orcid.org/0000-0001-9563-1937"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Jonathan W. Moore [ctb],
  Michelle M. McClure [ctb],
  Nicholas K. Dulvy [ctb],
  Andrew B. Cooper [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Sean C. Anderson &lt;sean@seananderson.ca&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-20 18:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='metafolio'>metafolio: An R package to simulate metapopulations for
portfolio optimization</h2><span id='topic+metafolio'></span><span id='topic+metafolio-package'></span>

<h3>Description</h3>

<p>The <span class="pkg">metafolio</span> <span class="rlang"><b>R</b></span> package is a tool to simulate metapopulations and
apply financial portfolio optimization concepts. The package was originally
written for salmon simulations, so some of the language refers to
salmon-specific terminology, but the package could be used and/or adopted
for other taxonomic groups.
</p>


<h3>Details</h3>

<p>The main simulation function is <code><a href="#topic+meta_sim">meta_sim</a></code>. This function takes
care of running an individual simulation iteration. The package also
contains functions for exploring conservation scenarios with these
simulations (see the &quot;Assessing multiple conservation scenarios&quot; section
below), and find optimal conservation strategies (see the &quot;Portfolio
optimization section&quot; below).
</p>


<h3>Running a simulation once</h3>

<p>To run a single simulation iteration, see the function
<code><a href="#topic+meta_sim">meta_sim</a></code>. To plot the output from one of these simulations, see
the function <code><a href="#topic+plot_sim_ts">plot_sim_ts</a></code>.
</p>


<h3>Assessing multiple conservation scenarios</h3>

<p>You can use <code><a href="#topic+run_cons_plans">run_cons_plans</a></code> to run <code><a href="#topic+meta_sim">meta_sim</a></code> for
multiple iterations and across multiple conservation strategies. These
strategies could focus on the spatial distribution of conservation or on the
number of populations conserved.
</p>
<p>The function <code><a href="#topic+plot_cons_plans">plot_cons_plans</a></code> can plot the output from
<code><a href="#topic+run_cons_plans">run_cons_plans</a></code>.
</p>


<h3>Specifying environmental patterns</h3>

<p>When you run <code><a href="#topic+meta_sim">meta_sim</a></code> you can specify the environmental signal.
One of the arguments is a list of options to pass to
<code><a href="#topic+generate_env_ts">generate_env_ts</a></code>, which controls the environmental pattern.
</p>


<h3>Diagnostic plots</h3>

<p><span class="pkg">metafolio</span> contains some additional plotting functions to inspect the
spawner-return relationships and the correlation between returns:
<code><a href="#topic+plot_rickers">plot_rickers</a></code>, and
<code><a href="#topic+plot_correlation_between_returns">plot_correlation_between_returns</a></code>.
</p>


<h3>Portfolio optimization</h3>

<p><span class="pkg">metafolio</span> also contains some experimental functions for finding optimal
conservation strategies (an efficient frontier). This is analogous to
financial portfolio where the goal is to find the investment weights that
maximizes expected return for a level of expected risk, or vice-versa.
Presently, these functions rely on Monte Carlo sampling, and so are rather
slow.
</p>
<p>For this purpose, the function <code><a href="#topic+create_asset_weights">create_asset_weights</a></code> can
generate a matrix of asset weights, which can then be passed to
<code><a href="#topic+monte_carlo_portfolios">monte_carlo_portfolios</a></code> to do the optimization itself.
<code><a href="#topic+plot_efficient_portfolios">plot_efficient_portfolios</a></code> can be used to plot the optimization
output.
</p>
<p>See the package vignette <code>vignette("metafolio")</code> for more extensive
explanation of how to use <span class="pkg">metafolio</span> along with some examples.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Sean C. Anderson <a href="mailto:sean@seananderson.ca">sean@seananderson.ca</a> (<a href="https://orcid.org/0000-0001-9563-1937">ORCID</a>)
</p>
<p>Other contributors:
</p>

<ul>
<li><p> Jonathan W. Moore [contributor]
</p>
</li>
<li><p> Michelle M. McClure [contributor]
</p>
</li>
<li><p> Nicholas K. Dulvy [contributor]
</p>
</li>
<li><p> Andrew B. Cooper [contributor]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/seananderson/metafolio">https://github.com/seananderson/metafolio</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/seananderson/metafolio/issues">https://github.com/seananderson/metafolio/issues</a>
</p>
</li></ul>


<hr>
<h2 id='add_dens_polygon'>Add a kernel density polygon</h2><span id='topic+add_dens_polygon'></span>

<h3>Description</h3>

<p>Add a kernel density polygon
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_dens_polygon(
  x,
  y,
  col,
  lwd = 1.7,
  alpha = c(0.25, 0.75),
  add_pts = FALSE,
  add_poly = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_dens_polygon_+3A_x">x</code></td>
<td>
<p>x values</p>
</td></tr>
<tr><td><code id="add_dens_polygon_+3A_y">y</code></td>
<td>
<p>y values</p>
</td></tr>
<tr><td><code id="add_dens_polygon_+3A_col">col</code></td>
<td>
<p>Colour to add polygon with. Will be made into two levels of
opacity.</p>
</td></tr>
<tr><td><code id="add_dens_polygon_+3A_lwd">lwd</code></td>
<td>
<p>lwd Line width</p>
</td></tr>
<tr><td><code id="add_dens_polygon_+3A_alpha">alpha</code></td>
<td>
<p>A numeric vector of length 2 that gives the confidence levels
for the two kernel density polygons.</p>
</td></tr>
<tr><td><code id="add_dens_polygon_+3A_add_pts">add_pts</code></td>
<td>
<p>Logical: should points be added?</p>
</td></tr>
<tr><td><code id="add_dens_polygon_+3A_add_poly">add_poly</code></td>
<td>
<p>Add polygons?</p>
</td></tr>
</table>

<hr>
<h2 id='annotate'>Add annotations to panel</h2><span id='topic+annotate'></span>

<h3>Description</h3>

<p>Add annotations to panel
</p>


<h3>Usage</h3>

<pre><code class='language-R'>annotate(label, xfrac = 0.008, yfrac = 0.18, pos = 4, cex = 0.9, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="annotate_+3A_label">label</code></td>
<td>
<p>The text to add as a label</p>
</td></tr>
<tr><td><code id="annotate_+3A_xfrac">xfrac</code></td>
<td>
<p>Fraction over from the left</p>
</td></tr>
<tr><td><code id="annotate_+3A_yfrac">yfrac</code></td>
<td>
<p>Fraction down from the top</p>
</td></tr>
<tr><td><code id="annotate_+3A_pos">pos</code></td>
<td>
<p>Position of text to pass to <code><a href="graphics.html#topic+text">text</a></code></p>
</td></tr>
<tr><td><code id="annotate_+3A_cex">cex</code></td>
<td>
<p>Character expansion value to pass to <code><a href="graphics.html#topic+text">text</a></code></p>
</td></tr>
<tr><td><code id="annotate_+3A_...">...</code></td>
<td>
<p>Anything else to pass to <code><a href="graphics.html#topic+text">text</a></code></p>
</td></tr>
</table>

<hr>
<h2 id='count_quasi_exts'>Take <code><a href="#topic+meta_sim">meta_sim</a></code> output objects and count quasi
extinctions</h2><span id='topic+count_quasi_exts'></span>

<h3>Description</h3>

<p>Take <code><a href="#topic+meta_sim">meta_sim</a></code> output objects and count quasi
extinctions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>count_quasi_exts(dat, quasi_thresh, ignore_pops_thresh = 5, duration = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="count_quasi_exts_+3A_dat">dat</code></td>
<td>
<p>Input data. Should be a list of lists. The first level
corresponds to the conservation plan and the second level
corresponds to the replicate.</p>
</td></tr>
<tr><td><code id="count_quasi_exts_+3A_quasi_thresh">quasi_thresh</code></td>
<td>
<p>The quasi extinction threshold</p>
</td></tr>
<tr><td><code id="count_quasi_exts_+3A_ignore_pops_thresh">ignore_pops_thresh</code></td>
<td>
<p>Threshold below which to ignore
populations (e.g. if you started some populations with very low
abundance and you don't want to count those populations.</p>
</td></tr>
<tr><td><code id="count_quasi_exts_+3A_duration">duration</code></td>
<td>
<p>Number of years that the abundance must be below
the <code>quasi_thresh</code> before being counted as quasi extinct.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of matrices. The list elements correspond to the
conservation plans. The columns of the matrix correspond to the
subpopulations that were above the <code>ignore_pops_thresh</code> level.
The rows of the matrix correspond to the replicates.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
set.seed(1)
w_plans &lt;- list()
w_plans[[1]] &lt;- c(5, 1000, 5, 1000, 5, 5, 1000, 5, 1000, 5)
w_plans[[2]] &lt;- c(5, 5, 5, 1000, 1000, 1000, 1000, 5, 5, 5)
w_plans[[3]] &lt;- c(rep(1000, 4), rep(5, 6))
w_plans[[4]] &lt;- rev(w_plans[[3]])
plans_name_sp &lt;- c("Full range of responses", "Most stable only",
"Lower half", "Upper half")
 n_trials &lt;- 50 # number of trials at each n conservation plan
 n_plans &lt;- 4 # number of plans
 num_pops &lt;- c(2, 4, 8, 16) # n pops to conserve
 w &lt;- list()
 for(i in 1:n_plans) { # loop over number conserved
  w[[i]] &lt;- list()
  for(j in 1:n_trials) { # loop over trials
    w[[i]][[j]] &lt;- matrix(rep(625, 16), nrow = 1)
    w[[i]][[j]][-sample(1:16, num_pops[i])] &lt;- 5
  }
 }
arma_env_params &lt;- list(mean_value = 16, ar = 0.1, sigma_env = 2, ma = 0)

x_arma_sp &lt;- run_cons_plans(w, env_type = "arma", env_params = arma_env_params)
count_quasi_exts(x_arma_sp$plans_port, quasi_thresh = 200)

## End(Not run)
</code></pre>

<hr>
<h2 id='create_asset_weights'>Create an asset weights matrix</h2><span id='topic+create_asset_weights'></span>

<h3>Description</h3>

<p>Create an asset weight matrix to run through the Monte Carlo
algorithm and test possible portfolios.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_asset_weights(n_pop, n_sims, weight_lower_limit = 0.02)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="create_asset_weights_+3A_n_pop">n_pop</code></td>
<td>
<p>The number of subpopulations.</p>
</td></tr>
<tr><td><code id="create_asset_weights_+3A_n_sims">n_sims</code></td>
<td>
<p>The number of simulations.</p>
</td></tr>
<tr><td><code id="create_asset_weights_+3A_weight_lower_limit">weight_lower_limit</code></td>
<td>
<p>The lowest fraction allowed for a subpopulation
weight. For example, a value of 0.02 means a subpopulation will at least
be assigned 2% of the total capacity</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix. The columns represent subpopulations. The rows
represent simulation repetitions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>create_asset_weights(n_pop = 5, n_sims = 10, weight_lower_limit = 0.001)
</code></pre>

<hr>
<h2 id='custom_bw'>Custom bandwidth</h2><span id='topic+custom_bw'></span>

<h3>Description</h3>

<p>Based on <code>bandwidth.nrd</code> from <span class="pkg">MASS</span>. This version takes the
absolute value of <code>var</code> to avoid errors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>custom_bw(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="custom_bw_+3A_x">x</code></td>
<td>
<p>A numeric vector</p>
</td></tr>
</table>

<hr>
<h2 id='CVaR'>Conditional Value at Risk</h2><span id='topic+CVaR'></span>

<h3>Description</h3>

<p>Get the conditional value at risk.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CVaR(x, probs = 0.05)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CVaR_+3A_x">x</code></td>
<td>
<p>A numeric vector</p>
</td></tr>
<tr><td><code id="CVaR_+3A_probs">probs</code></td>
<td>
<p>The probability cutoff to pass to the CVaR function.</p>
</td></tr>
</table>

<hr>
<h2 id='est_beta_params'>Get beta parameters from mean and variance</h2><span id='topic+est_beta_params'></span>

<h3>Description</h3>

<p>Get beta parameters from mean and variance
</p>


<h3>Usage</h3>

<pre><code class='language-R'>est_beta_params(mu, var)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="est_beta_params_+3A_mu">mu</code></td>
<td>
<p>Mean</p>
</td></tr>
<tr><td><code id="est_beta_params_+3A_var">var</code></td>
<td>
<p>Variance</p>
</td></tr>
</table>

<hr>
<h2 id='fastlm'>Super fast linear regression</h2><span id='topic+fastlm'></span>

<h3>Description</h3>

<p>Super fast linear regression
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fastlm(yr, Xr)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fastlm_+3A_yr">yr</code></td>
<td>
<p>Vector of y values</p>
</td></tr>
<tr><td><code id="fastlm_+3A_xr">Xr</code></td>
<td>
<p>Model matrix</p>
</td></tr>
</table>

<hr>
<h2 id='fit_ricker'>Fit Ricker linear regression</h2><span id='topic+fit_ricker'></span>

<h3>Description</h3>

<p>Fit a Ricker curve to spawner-recruit data and return the intercept (a) and
slope (b). The model is fit via the <span class="pkg">RcppArmadillo</span> package for speed..
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_ricker(S, R)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fit_ricker_+3A_s">S</code></td>
<td>
<p>Spawners as a numeric vector.</p>
</td></tr>
<tr><td><code id="fit_ricker_+3A_r">R</code></td>
<td>
<p>Recruits or returns as a numeric vector.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A named list with components <code>a</code> for the intercept and
<code>b</code> for the slope.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>S &lt;- seq(100, 1000, length.out = 100)
v_t &lt;- rnorm(100, 0, 0.1)
R &lt;- mapply(ricker_v_t, spawners = S, v_t = v_t, a = 1.9, b = 900, d = 1)
plot(S, log(R/S))
fit_ricker(S, R)

</code></pre>

<hr>
<h2 id='generate_env_ts'>Create an environmental time series.</h2><span id='topic+generate_env_ts'></span>

<h3>Description</h3>

<p>Generate various types of environmental time series.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>generate_env_ts(
  n_t,
  type = c("sine", "arma", "regime", "linear", "linear_arma", "constant"),
  sine_params = list(amplitude = 1, ang_frequency = 0.2, phase = 0, mean_value = 0, slope
    = 0, sigma_env = 0.02),
  arma_params = list(mean_value = 0, sigma_env = 0.5, ar = 0.4, ma = 0),
  regime_params = list(break_pts = c(25, 75), break_vals = c(-1, 0, 1)),
  linear_params = list(min_value = -1, max_value = 1, sigma_env = 0.1, start_t = 1),
  linear_arma_params = list(min_value = -1, max_value = 1, sigma_env = 0.1, start_t = 1,
    ar = 0.4, ma = 0),
  constant_params = list(value = 0)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="generate_env_ts_+3A_n_t">n_t</code></td>
<td>
<p>Length of time series.</p>
</td></tr>
<tr><td><code id="generate_env_ts_+3A_type">type</code></td>
<td>
<p>Type of time series to produce.</p>
</td></tr>
<tr><td><code id="generate_env_ts_+3A_sine_params">sine_params</code></td>
<td>
<p>Parameters controlling sine wave time series.</p>
</td></tr>
<tr><td><code id="generate_env_ts_+3A_arma_params">arma_params</code></td>
<td>
<p>Parameters controlling ARMA time series.</p>
</td></tr>
<tr><td><code id="generate_env_ts_+3A_regime_params">regime_params</code></td>
<td>
<p>Parameters controlling regime-shift time series.</p>
</td></tr>
<tr><td><code id="generate_env_ts_+3A_linear_params">linear_params</code></td>
<td>
<p>Parameters controlling warming or cooling time series.
Minimum environmental value, maximum environmental value, environmental
standard deviation, and the year to start the linear trend (useful if
you're going to throw out the early years as burn in).</p>
</td></tr>
<tr><td><code id="generate_env_ts_+3A_linear_arma_params">linear_arma_params</code></td>
<td>
<p>A combination of <code>arma_params</code> and 
<code>linear_params</code>.</p>
</td></tr>
<tr><td><code id="generate_env_ts_+3A_constant_params">constant_params</code></td>
<td>
<p>Parameter controlling constant time series.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>types &lt;- c("sine", "arma", "regime", "linear", "linear_arma", "constant")
x &lt;- list()
for(i in 1:6) x[[i]] &lt;- generate_env_ts(n_t = 100, type = types[i])
op &lt;- par(mfrow = c(5, 1), mar = c(3,3,1,0), cex = 0.7)
for(i in 1:6) plot(x[[i]], type = "o", main = types[i])
par(op)
</code></pre>

<hr>
<h2 id='generate_straying_matrix'>Generate a matrix of straying proportions within a metapopulation</h2><span id='topic+generate_straying_matrix'></span>

<h3>Description</h3>

<p>Generate a matrix of straying proportions within a metapopulation.
Based on Eq. 2 in Cooper and Mangel (1999).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>generate_straying_matrix(n_pop, stray_fraction, stray_decay_rate)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="generate_straying_matrix_+3A_n_pop">n_pop</code></td>
<td>
<p>Number of subpopulations.</p>
</td></tr>
<tr><td><code id="generate_straying_matrix_+3A_stray_fraction">stray_fraction</code></td>
<td>
<p>Fraction of individuals that stray from a given
subpopulation.</p>
</td></tr>
<tr><td><code id="generate_straying_matrix_+3A_stray_decay_rate">stray_decay_rate</code></td>
<td>
<p>Exponential rate that straying decays with distance
between subpopulations.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Cooper, A.B. and Mangel, M. 1999. The dangers of ignoring
metapopulation structure for the conservation of salmonids. Fish.
Bull. 97(2): 213-226.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- generate_straying_matrix(10, 0.01, 0.3)
image(x, col = rev(heat.colors(12)))
</code></pre>

<hr>
<h2 id='get_conserv_plans_mv'>Run simulation for conservation schemes</h2><span id='topic+get_conserv_plans_mv'></span>

<h3>Description</h3>

<p>Run the metapopulation simulation for various conservation prioritization
schemes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_conserv_plans_mv(
  weights,
  reps = 150,
  assess_freq = 5,
  burn = 1:30,
  risk_fn = var,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_conserv_plans_mv_+3A_weights">weights</code></td>
<td>
<p>A matrix of habitat weights. Each row corresponds to another
scenario. Each column is a different habitat location.</p>
</td></tr>
<tr><td><code id="get_conserv_plans_mv_+3A_reps">reps</code></td>
<td>
<p>Number of portfolios to simulate.</p>
</td></tr>
<tr><td><code id="get_conserv_plans_mv_+3A_assess_freq">assess_freq</code></td>
<td>
<p>The frequency (in generations) of spawner-recruit
re-assessment. Passed to <code><a href="#topic+meta_sim">meta_sim</a></code>.</p>
</td></tr>
<tr><td><code id="get_conserv_plans_mv_+3A_burn">burn</code></td>
<td>
<p>Cycles to throw out as burn in.</p>
</td></tr>
<tr><td><code id="get_conserv_plans_mv_+3A_risk_fn">risk_fn</code></td>
<td>
<p>Type of variance or risk metric. By default takes the variance.
Instead you can supply any function that takes a numeric vector and returns
some single numeric value. E.g. CVaR.</p>
</td></tr>
<tr><td><code id="get_conserv_plans_mv_+3A_...">...</code></td>
<td>
<p>Other values to pass to <code><a href="#topic+meta_sim">meta_sim</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the portfolio mean and variance values and the simulation runs.
</p>

<hr>
<h2 id='get_efficient_frontier'>Get the efficient frontier from mean and variance values</h2><span id='topic+get_efficient_frontier'></span>

<h3>Description</h3>

<p>Get the efficient frontier from mean and variance values
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_efficient_frontier(m, v)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_efficient_frontier_+3A_m">m</code></td>
<td>
<p>A vector of mean values</p>
</td></tr>
<tr><td><code id="get_efficient_frontier_+3A_v">v</code></td>
<td>
<p>A vector of variance values</p>
</td></tr>
</table>

<hr>
<h2 id='get_port_vals'>Get portfolio mean and variance values</h2><span id='topic+get_port_vals'></span>

<h3>Description</h3>

<p>Takes a list created by <code><a href="#topic+meta_sim">meta_sim</a></code> and returns the mean and
variance (or risk metric) values. This function is used by other internal
functions, but can also be used as its own low-level function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_port_vals(x, risk_fn = var, burn = 1:30)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_port_vals_+3A_x">x</code></td>
<td>
<p>A list object as returned from <code><a href="#topic+meta_sim">meta_sim</a></code></p>
</td></tr>
<tr><td><code id="get_port_vals_+3A_risk_fn">risk_fn</code></td>
<td>
<p>Type of variance or risk metric. By default takes the variance.
Instead you can supply any function that takes a numeric vector and returns
some single numeric value. E.g. CVaR.</p>
</td></tr>
<tr><td><code id="get_port_vals_+3A_burn">burn</code></td>
<td>
<p>Number of years to throw out as burn in</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with columns for the mean (m) and variance (v).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot_cons_plans">plot_cons_plans</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>arma_env_params &lt;- list(mean_value = 16, ar = 0.1, sigma_env = 2, ma = 0)
base1 &lt;- meta_sim(n_pop = 10, env_params = arma_env_params, env_type =
  "arma", assess_freq = 5)
get_port_vals(base1)
</code></pre>

<hr>
<h2 id='get_quantile_contour'>Get quantile contour</h2><span id='topic+get_quantile_contour'></span>

<h3>Description</h3>

<p>Get quantile contour
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_quantile_contour(x, alpha = 0.8)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_quantile_contour_+3A_x">x</code></td>
<td>
<p>Output from <code><a href="MASS.html#topic+kde2d">kde2d</a></code>.</p>
</td></tr>
<tr><td><code id="get_quantile_contour_+3A_alpha">alpha</code></td>
<td>
<p>The quantile level.</p>
</td></tr>
</table>

<hr>
<h2 id='gg_color_hue'>ggplot2-like colour scale in HCL space</h2><span id='topic+gg_color_hue'></span>

<h3>Description</h3>

<p>ggplot2-like colour scale in HCL space
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gg_color_hue(n, hue_min = 10, hue_max = 280, l = 62, c = 100)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gg_color_hue_+3A_n">n</code></td>
<td>
<p>Number of colours to return.</p>
</td></tr>
<tr><td><code id="gg_color_hue_+3A_hue_min">hue_min</code></td>
<td>
<p>Minimum hue value in the range [0,360]</p>
</td></tr>
<tr><td><code id="gg_color_hue_+3A_hue_max">hue_max</code></td>
<td>
<p>Maximum hue value in the range [0,360]</p>
</td></tr>
<tr><td><code id="gg_color_hue_+3A_l">l</code></td>
<td>
<p>Luminance in the range [0,100]</p>
</td></tr>
<tr><td><code id="gg_color_hue_+3A_c">c</code></td>
<td>
<p>Chroma of the colour.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See the <code><a href="grDevices.html#topic+hcl">hcl</a></code> function for details.
</p>


<h3>Value</h3>

<p>A vector of colour values.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>gg_color_hue(10)
</code></pre>

<hr>
<h2 id='impl_error'>Add implementation error</h2><span id='topic+impl_error'></span>

<h3>Description</h3>

<p>Add implementation error with a beta distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>impl_error(mu, sigma_impl)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="impl_error_+3A_mu">mu</code></td>
<td>
<p>The mean</p>
</td></tr>
<tr><td><code id="impl_error_+3A_sigma_impl">sigma_impl</code></td>
<td>
<p>Implementation error standard deviation</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A single numeric values representing a sample from a beta
distribution with the specified mean and standard deviation.
</p>


<h3>References</h3>

<p>Morgan, M. G. &amp; Henrion, M. (1990). Uncertainty: A Guide to Dealing
with Uncertainty in Quantitative Risk and Policy Analysis.
Cambridge University Press.
</p>
<p>Pestes, L. R., Peterman, R. M., Bradford, M. J., and Wood, C. C.
(2008). Bayesian decision analysis for evaluating management
options to promote recovery of a depleted salmon population.
22(2):351-361.
</p>
<p>http://stats.stackexchange.com/questions/12232/calculating-the-parameters-of-a-beta-distribution-using-the-mean-and-variance
</p>


<h3>Examples</h3>

<pre><code class='language-R'>y &lt;- sapply(1:200, function(x) impl_error(0.5, 0.2))
hist(y)

y &lt;- sapply(1:200, function(x) impl_error(0.3, 0.1))
hist(y)

</code></pre>

<hr>
<h2 id='is_element'>Check if x is an element of y.</h2><span id='topic+is_element'></span>

<h3>Description</h3>

<p>Check if x is an element of y.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_element(x, y)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="is_element_+3A_x">x</code></td>
<td>
<p>An integer to check</p>
</td></tr>
<tr><td><code id="is_element_+3A_y">y</code></td>
<td>
<p>A vector to check if <code>x</code> is an element of <code>y</code>.</p>
</td></tr>
</table>

<hr>
<h2 id='meta_sim'>Run a single metapopulation simulation.</h2><span id='topic+meta_sim'></span>

<h3>Description</h3>

<p>This is the master function for running <span class="pkg">metafolio</span> simulations. It runs
a single iteration of a simulation. The arguments can be manipulated with
other functions in the package to use this function as part of a portfolio
analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>meta_sim(
  n_t = 130,
  n_pop = 10,
  stray_decay_rate = 0.1,
  stray_fraction = 0.02,
  b = rep(1000, n_pop),
  spawners_0 = round(b),
  sigma_v = 0.7,
  v_rho = 0.4,
  a_width_param = c(seq(0.08, 0.04, length.out = n_pop/2), rev(seq(0.08, 0.04, length.out
    = n_pop/2))),
  optim_temp = seq(13, 19, length.out = n_pop),
  max_a = thermal_integration(n_pop),
  env_type = c("sine", "arma", "regime", "linear", "constant"),
  env_params = list(amplitude = 3.2, ang_frequency = 0.2, phase = runif(1, -pi, pi),
    mean_value = 15, slope = 0, sigma_env = 0.3),
  start_assessment = 20,
  a_lim = c(0.02, 4),
  b_lim = c(0.5, 1.5),
  silence_warnings = TRUE,
  sigma_impl = 0.1,
  assess_freq = 10,
  use_cache = FALSE,
  cache_env = FALSE,
  add_straying = TRUE,
  add_impl_error = TRUE,
  skip_saving_cache = FALSE,
  decrease_b = 0,
  debug = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="meta_sim_+3A_n_t">n_t</code></td>
<td>
<p>The number of years.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_n_pop">n_pop</code></td>
<td>
<p>Number of populations</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_stray_decay_rate">stray_decay_rate</code></td>
<td>
<p>Rate that straying (exponentially) decays with
distance.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_stray_fraction">stray_fraction</code></td>
<td>
<p>Fraction of fish that stray from natal streams.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_b">b</code></td>
<td>
<p>Ricker density-dependent parameter. A vector with one numeric value
per population.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_spawners_0">spawners_0</code></td>
<td>
<p>A vector of spawner abundances at the start of the
simulation. Length of the vector should equal the number of populations.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_sigma_v">sigma_v</code></td>
<td>
<p>Stock-recruit residual standard deviation of the
log-deviations.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_v_rho">v_rho</code></td>
<td>
<p>AR1 serial correlation of stock-recruit residuals.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_a_width_param">a_width_param</code></td>
<td>
<p>Width of the thermal curves by population.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_optim_temp">optim_temp</code></td>
<td>
<p>Optimal temperatures by population.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_max_a">max_a</code></td>
<td>
<p>Maximum Ricker productivity parameters (a) by population.  The
value obtained at the optimum temperature. Note how the default argument
uses the <code><a href="#topic+thermal_integration">thermal_integration</a></code> function.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_env_type">env_type</code></td>
<td>
<p>The type of environmental time series to generate. One of
<code>"sine"</code>, <code>"arma"</code>, <code>"regime"</code>, <code>"linear"</code>, or
<code>"constant"</code>. See <code><a href="#topic+generate_env_ts">generate_env_ts</a></code>.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_env_params">env_params</code></td>
<td>
<p>Parameters to pass on to <code><a href="#topic+generate_env_ts">generate_env_ts</a></code>.
You must provide the appropriate list given your chosen type of
environmental signal.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_start_assessment">start_assessment</code></td>
<td>
<p>Generation to start estimating the stock recruit
relationship for escapement targets. The assessment is carried out using
<code><a href="#topic+fit_ricker">fit_ricker</a></code>.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_a_lim">a_lim</code></td>
<td>
<p>A vector of length two giving the lower and upper limits for
Ricker a values. If a value is estimated beyond these limits it will be
set to the limit value.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_b_lim">b_lim</code></td>
<td>
<p>A vector of length two giving the lower and upper limits for
the estimated Ricker b values *as fractions* of the previously assessed
value. If a value is estimated beyond these limits it will be set to the
limit value.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_silence_warnings">silence_warnings</code></td>
<td>
<p>Should the warnings be skipped if the Ricker a or b
values exceed their specified bounds? <code>meta_sim</code> will still print
other warnings regardless of this argument value.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_sigma_impl">sigma_impl</code></td>
<td>
<p>Implementation standard deviation for the implementation
error beta distribution.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_assess_freq">assess_freq</code></td>
<td>
<p>How many generations before re-assessing Ricker a and b
parameters.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_use_cache">use_cache</code></td>
<td>
<p>Use the stochastically generated values (stock-recruit
residuals and possibly environmental time series) from the previous run?
See the Details section below.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_cache_env">cache_env</code></td>
<td>
<p>Logical: Should the environmental time series be cached? If
<code>use_cache = TRUE</code> then this will automatically happen. But, you
could set <code>cache_env = TRUE</code> and <code>use_cache = FALSE</code> to only
cache the environmental time series. See the Details section below.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_add_straying">add_straying</code></td>
<td>
<p>Implement straying between populations?</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_add_impl_error">add_impl_error</code></td>
<td>
<p>Add implementation error? Implementation error is
derived using <code><a href="#topic+impl_error">impl_error</a></code>.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_skip_saving_cache">skip_saving_cache</code></td>
<td>
<p>Logical: if <code>TRUE</code> then no data will be cached
for the next iteration. This will save time when running many simulations.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_decrease_b">decrease_b</code></td>
<td>
<p>A numeric value to decrease all streams by each generation.
This is intended to be used to simulate habitat loss, for example though
stream flow reduction with climate change.</p>
</td></tr>
<tr><td><code id="meta_sim_+3A_debug">debug</code></td>
<td>
<p>Logical: if <code>TRUE</code> then <code>meta_sim</code> will print a number
of debugging statements while it runs.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To use either of the caching options, you must have run <code>meta_sim</code> at
least once in the current session with both caching arguments set to
<code>FALSE</code> to generate the cached values first. If you're running many
iterations of <code>meta_sim</code> and you want to cache, then the first iteration
should have both cache arguments set to <code>FALSE</code>, and subsequent runs can
set one or both to <code>TRUE</code>. Internally, <code>meta_sim</code> caches by writing
the appropriate data to an <code>.rda</code> file in a temporary directory.
</p>


<h3>Value</h3>

<p>A list is returned that contains the following elements. All matrices that
are returned (except the straying matrix) feature populations along the
columns and generations/years along the rows.
</p>

<dl>
<dt><code>A</code></dt><dd><p>A matrix of abundances.</p>
</dd>
<dt><code>F</code></dt><dd><p>A matrix of fishing mortality in numbers.</p>
</dd>
<dt><code>E</code></dt><dd><p>A matrix of realized escapement.</p>
</dd>
<dt><code>Eps</code></dt><dd><p>A matrix of (log) spawner-return residuals. These have been
log-normal bias corrected so their expected value after exponentiation
will be one.</p>
</dd>
<dt><code>A_params</code></dt><dd><p>A matrix of actual Ricker a parameters.</p>
</dd>
<dt><code>Strays_leaving</code></dt><dd><p>A matrix of strays leaving.</p>
</dd>
<dt><code>Strays_joining</code></dt><dd><p>A matrix of strays joining.</p>
</dd>
<dt><code>env_ts</code></dt><dd><p>A vector of the environmental time series.</p>
</dd>
<dt><code>stray_mat</code></dt><dd><p>The straying matrix. These fractions are constant across
generations/years. Rows and columns are populations.</p>
</dd>
<dt><code>n_pop</code></dt><dd><p>The total possible populations as input in the simulation.</p>
</dd>
<dt><code>n_t</code></dt><dd><p>The number of generations/years the simulation was run for.</p>
</dd>
<dt><code>b</code></dt><dd><p>The original Ricker b values as specified.</p>
</dd>
<dt><code>Est_a</code></dt><dd><p>A matrix of estimated Ricker a values.</p>
</dd>
<dt><code>Est_b</code></dt><dd><p>A matrix of estimated Ricker b values.</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>arma_env_params &lt;- list(mean_value = 16, ar = 0.1, sigma_env = 2, ma = 0)
base1 &lt;- meta_sim(n_pop = 10, env_params = arma_env_params,
  env_type = "arma", assess_freq = 5)

plot_sim_ts(base1, years_to_show = 70, burn = 30)
</code></pre>

<hr>
<h2 id='metasim_base'>Base-level metapopulation simulation function</h2><span id='topic+metasim_base'></span>

<h3>Description</h3>

<p>This is an Rcpp implementation of the main simulation. It is meant to be
called by <code><a href="#topic+meta_sim">meta_sim</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>metasim_base(
  n_pop,
  n_t,
  spawners_0,
  b,
  epsilon_mat,
  A_params,
  add_straying,
  stray_mat,
  assess_years,
  r_escp_goals,
  sigma_impl,
  add_impl_error,
  decrease_b,
  debug
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="metasim_base_+3A_n_pop">n_pop</code></td>
<td>
<p>Number of populations</p>
</td></tr>
<tr><td><code id="metasim_base_+3A_n_t">n_t</code></td>
<td>
<p>The number of years.</p>
</td></tr>
<tr><td><code id="metasim_base_+3A_spawners_0">spawners_0</code></td>
<td>
<p>A vector of spawner abundances at the start of the
simulation. Length of the vector should equal the number of populations.</p>
</td></tr>
<tr><td><code id="metasim_base_+3A_b">b</code></td>
<td>
<p>Ricker density-dependent parameter. A vector with one numeric value
per population.</p>
</td></tr>
<tr><td><code id="metasim_base_+3A_epsilon_mat">epsilon_mat</code></td>
<td>
<p>A matrix of recruitment deviations.</p>
</td></tr>
<tr><td><code id="metasim_base_+3A_a_params">A_params</code></td>
<td>
<p>A matrix of Ricker a parameters</p>
</td></tr>
<tr><td><code id="metasim_base_+3A_add_straying">add_straying</code></td>
<td>
<p>Implement straying between populations?</p>
</td></tr>
<tr><td><code id="metasim_base_+3A_stray_mat">stray_mat</code></td>
<td>
<p>A straying matrix.</p>
</td></tr>
<tr><td><code id="metasim_base_+3A_assess_years">assess_years</code></td>
<td>
<p>A vector of years to assess a and b in</p>
</td></tr>
<tr><td><code id="metasim_base_+3A_r_escp_goals">r_escp_goals</code></td>
<td>
<p>A matrix of escapement goals.</p>
</td></tr>
<tr><td><code id="metasim_base_+3A_sigma_impl">sigma_impl</code></td>
<td>
<p>Implementation standard deviation for the implementation
error beta distribution.</p>
</td></tr>
<tr><td><code id="metasim_base_+3A_add_impl_error">add_impl_error</code></td>
<td>
<p>Add implementation error? Implementation error is
derived using <code><a href="#topic+impl_error">impl_error</a></code>.</p>
</td></tr>
<tr><td><code id="metasim_base_+3A_decrease_b">decrease_b</code></td>
<td>
<p>A numeric value to decrease all streams by each generation.
This is intended to be used to simulate habitat loss, for example though
stream flow reduction with climate change.</p>
</td></tr>
<tr><td><code id="metasim_base_+3A_debug">debug</code></td>
<td>
<p>Boolean. Should some debuging messages be turned on?</p>
</td></tr>
</table>

<hr>
<h2 id='monte_carlo_portfolios'>Monte Carlo asset weights into portfolios</h2><span id='topic+monte_carlo_portfolios'></span>

<h3>Description</h3>

<p>Monte Carlo the asset weights into portfolios and record the simulation
output and portfolio metrics (mean and variance).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>monte_carlo_portfolios(
  weights_matrix,
  n_sims = 500,
  mean_b = 1000,
  burn = 1:30,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="monte_carlo_portfolios_+3A_weights_matrix">weights_matrix</code></td>
<td>
<p>A matrix of asset weights. The columns correspond to
the different assets and the rows correspond to the simulation iterations.</p>
</td></tr>
<tr><td><code id="monte_carlo_portfolios_+3A_n_sims">n_sims</code></td>
<td>
<p>The number of simulations to run.</p>
</td></tr>
<tr><td><code id="monte_carlo_portfolios_+3A_mean_b">mean_b</code></td>
<td>
<p>The mean Ricker capacity value.</p>
</td></tr>
<tr><td><code id="monte_carlo_portfolios_+3A_burn">burn</code></td>
<td>
<p>The number of years to discard as burn in.</p>
</td></tr>
<tr><td><code id="monte_carlo_portfolios_+3A_...">...</code></td>
<td>
<p>Anything else to pass to <code><a href="#topic+meta_sim">meta_sim</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list object with three elements: <code>port_vals</code> (a matrix with a
column of mean rate of change and variance of rate of change),
<code>n_sims</code> (the number of simulations ran), and <code>sims_out</code> (a list
in which each element corresponds to the output from the run of
<code><a href="#topic+meta_sim">meta_sim</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+meta_sim">meta_sim</a></code>, <code><a href="#topic+create_asset_weights">create_asset_weights</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>weights_matrix &lt;- create_asset_weights(n_pop = 4, n_sims = 3,
  weight_lower_limit = 0.001)
mc_ports &lt;- monte_carlo_portfolios(weights_matrix = weights_matrix,
  n_sims = 3, mean_b = 1000)
</code></pre>

<hr>
<h2 id='my.axis'>Add a pretty axis</h2><span id='topic+my.axis'></span>

<h3>Description</h3>

<p>Add a pretty axis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>my.axis(side, shade_years = NULL, ylab = "", yticks = NA)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="my.axis_+3A_side">side</code></td>
<td>
<p>Number indicating the side to add an axis (as in the side number
passed to <code><a href="graphics.html#topic+axis">axis</a></code>).</p>
</td></tr>
<tr><td><code id="my.axis_+3A_shade_years">shade_years</code></td>
<td>
<p>An optional numerical vector of length two giving the
minimum and maximum years over which to add a light grey shading.</p>
</td></tr>
<tr><td><code id="my.axis_+3A_ylab">ylab</code></td>
<td>
<p>Y axis label</p>
</td></tr>
<tr><td><code id="my.axis_+3A_yticks">yticks</code></td>
<td>
<p>Logical: should y-axis ticks be added?</p>
</td></tr>
</table>

<hr>
<h2 id='optim_thermal'>Optimize to find optimal max productivity Ricker a</h2><span id='topic+optim_thermal'></span>

<h3>Description</h3>

<p>Optimize to find optimal max productivity Ricker a
</p>


<h3>Usage</h3>

<pre><code class='language-R'>optim_thermal(optim_temp, width_param, desired_area)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="optim_thermal_+3A_optim_temp">optim_temp</code></td>
<td>
<p>The optimum temperature as a numeric value</p>
</td></tr>
<tr><td><code id="optim_thermal_+3A_width_param">width_param</code></td>
<td>
<p>The width parameter as a numeric value</p>
</td></tr>
<tr><td><code id="optim_thermal_+3A_desired_area">desired_area</code></td>
<td>
<p>The desired area as a numeric value</p>
</td></tr>
</table>

<hr>
<h2 id='plot_cons_plans'>Plot conservation plans in mean-variance space</h2><span id='topic+plot_cons_plans'></span>

<h3>Description</h3>

<p>This makes a mean-variance plot of the portfolio output. It can take care of:
plotting the individual portfolios, adding 2D kernel density polygons at two
quantile levels, and adding an efficient frontier.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_cons_plans(
  plans_mv,
  plans_name,
  cols,
  xlim = NULL,
  ylim = NULL,
  add_pts = TRUE,
  add_all_efs = FALSE,
  x_axis = TRUE,
  y_axis = TRUE,
  add_legend = TRUE,
  legend_pos = "topright",
  w_show = "all",
  xlab = "Variance",
  ylab = "Mean",
  add_poly = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_cons_plans_+3A_plans_mv">plans_mv</code></td>
<td>
<p>The <code>plans_mv</code> element of the output from
<code><a href="#topic+run_cons_plans">run_cons_plans</a></code>.</p>
</td></tr>
<tr><td><code id="plot_cons_plans_+3A_plans_name">plans_name</code></td>
<td>
<p>A character vector of what to label each conservation
plan.</p>
</td></tr>
<tr><td><code id="plot_cons_plans_+3A_cols">cols</code></td>
<td>
<p>Colours for the conservation plan polygons.</p>
</td></tr>
<tr><td><code id="plot_cons_plans_+3A_xlim">xlim</code></td>
<td>
<p>X limits</p>
</td></tr>
<tr><td><code id="plot_cons_plans_+3A_ylim">ylim</code></td>
<td>
<p>Y limits</p>
</td></tr>
<tr><td><code id="plot_cons_plans_+3A_add_pts">add_pts</code></td>
<td>
<p>Logical: add the points?</p>
</td></tr>
<tr><td><code id="plot_cons_plans_+3A_add_all_efs">add_all_efs</code></td>
<td>
<p>Logical: add efficient frontiers?</p>
</td></tr>
<tr><td><code id="plot_cons_plans_+3A_x_axis">x_axis</code></td>
<td>
<p>Logical: add x axis?</p>
</td></tr>
<tr><td><code id="plot_cons_plans_+3A_y_axis">y_axis</code></td>
<td>
<p>Logical: add y axis?</p>
</td></tr>
<tr><td><code id="plot_cons_plans_+3A_add_legend">add_legend</code></td>
<td>
<p>Logical: add y legend?</p>
</td></tr>
<tr><td><code id="plot_cons_plans_+3A_legend_pos">legend_pos</code></td>
<td>
<p>A character string to pass to
<code><a href="graphics.html#topic+legend">legend</a></code> denoting the position of the legend.</p>
</td></tr>
<tr><td><code id="plot_cons_plans_+3A_w_show">w_show</code></td>
<td>
<p>If <code>"all"</code> then all plans will be shown. If a numeric
vector, then those plans will be shown. E.g. <code>c(1, 3)</code> will only show
the first and third plans.</p>
</td></tr>
<tr><td><code id="plot_cons_plans_+3A_xlab">xlab</code></td>
<td>
<p>X axis label.</p>
</td></tr>
<tr><td><code id="plot_cons_plans_+3A_ylab">ylab</code></td>
<td>
<p>Y axis label.</p>
</td></tr>
<tr><td><code id="plot_cons_plans_+3A_add_poly">add_poly</code></td>
<td>
<p>Add the kernal smoother quantile polygons?</p>
</td></tr>
<tr><td><code id="plot_cons_plans_+3A_...">...</code></td>
<td>
<p>Anything else to pass to <code><a href="graphics.html#topic+plot.default">plot.default</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A plot. Also, the x and y limits are returned invisibly as a list.
This makes it easy to make the first plot and then save those x and y
limits to fix them in subsequent (multipanel) plots.
</p>

<hr>
<h2 id='plot_correlation_between_returns'>Plot correlation of returns (i.e. metapopulation abundance) across stocks.</h2><span id='topic+plot_correlation_between_returns'></span>

<h3>Description</h3>

<p>Create a matrix plot showing the correlation between the log returns of each
stock/asset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_correlation_between_returns(
  x,
  burn = 1:30,
  pal = rev(gg_color_hue(x$n_pop)),
  xlab = "log of return abundance by population",
  ylab = "log of return abundance by population"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_correlation_between_returns_+3A_x">x</code></td>
<td>
<p>A list output object from <code><a href="#topic+meta_sim">meta_sim</a></code>.</p>
</td></tr>
<tr><td><code id="plot_correlation_between_returns_+3A_burn">burn</code></td>
<td>
<p>Number of years to discard at start as burn in.</p>
</td></tr>
<tr><td><code id="plot_correlation_between_returns_+3A_pal">pal</code></td>
<td>
<p>Colours to label each stock/asset.</p>
</td></tr>
<tr><td><code id="plot_correlation_between_returns_+3A_xlab">xlab</code></td>
<td>
<p>X axis label</p>
</td></tr>
<tr><td><code id="plot_correlation_between_returns_+3A_ylab">ylab</code></td>
<td>
<p>Y axis label</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A plot
</p>


<h3>Examples</h3>

<pre><code class='language-R'>arma_env_params &lt;- list(mean_value = 16, ar = 0.1, sigma_env = 2, ma = 0)
base1 &lt;- meta_sim(n_pop = 10, env_params = arma_env_params, env_type =
  "arma", assess_freq = 5)
plot_correlation_between_returns(base1)
</code></pre>

<hr>
<h2 id='plot_efficient_portfolios'>Basic plot of efficient portfolio and asset contributions</h2><span id='topic+plot_efficient_portfolios'></span>

<h3>Description</h3>

<p>This function creates a mean-variance plot of the portfolios across possible
asset weights, colour the efficient frontier, and show the contribution of
the different stocks/assets. It also (invisibly) returns the values that make
up the plot so you can create your own custom plots with the data. See the
Returns section for more details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_efficient_portfolios(
  port_vals,
  weights_matrix,
  pal,
  plot = TRUE,
  ylab_dots = "Mean of metapopulation growth rate",
  xlab_dots = "Variance of metapopulation growth rate",
  ylab_bars = "Percentage",
  xlab_bars = "Variance (multiplied by 1000)",
  port_cols = c("grey50", "red"),
  pch = 19,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_efficient_portfolios_+3A_port_vals">port_vals</code></td>
<td>
<p>A matrix of means and variances (down the two columns).
This likely comes from the output of <code><a href="#topic+monte_carlo_portfolios">monte_carlo_portfolios</a></code>.</p>
</td></tr>
<tr><td><code id="plot_efficient_portfolios_+3A_weights_matrix">weights_matrix</code></td>
<td>
<p>The same weight matrix that was passed to
<code><a href="#topic+monte_carlo_portfolios">monte_carlo_portfolios</a></code>.</p>
</td></tr>
<tr><td><code id="plot_efficient_portfolios_+3A_pal">pal</code></td>
<td>
<p>Colour palette for the stocks/assets in the barplot.</p>
</td></tr>
<tr><td><code id="plot_efficient_portfolios_+3A_plot">plot</code></td>
<td>
<p>Logical: should the plots be made?</p>
</td></tr>
<tr><td><code id="plot_efficient_portfolios_+3A_ylab_dots">ylab_dots</code></td>
<td>
<p>Y axis label for the mean-variance scatterplot.</p>
</td></tr>
<tr><td><code id="plot_efficient_portfolios_+3A_xlab_dots">xlab_dots</code></td>
<td>
<p>X axis label for the mean-variance scatterplot.</p>
</td></tr>
<tr><td><code id="plot_efficient_portfolios_+3A_ylab_bars">ylab_bars</code></td>
<td>
<p>Y axis label for the barplot.</p>
</td></tr>
<tr><td><code id="plot_efficient_portfolios_+3A_xlab_bars">xlab_bars</code></td>
<td>
<p>X axis label for the barplot.</p>
</td></tr>
<tr><td><code id="plot_efficient_portfolios_+3A_port_cols">port_cols</code></td>
<td>
<p>Colours for the dots. A vector of colours for the
non-efficient and efficient portfolios.</p>
</td></tr>
<tr><td><code id="plot_efficient_portfolios_+3A_pch">pch</code></td>
<td>
<p>Dot type</p>
</td></tr>
<tr><td><code id="plot_efficient_portfolios_+3A_...">...</code></td>
<td>
<p>Anything else to pass to both
<code><a href="graphics.html#topic+plot.default">plot.default</a></code> and <code><a href="graphics.html#topic+barplot">barplot</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A two panel plot and an (invisible) list of values calculated within the
function. This list contains <code>pv</code> (mean, variance, and whether it was
part of the efficient frontier); <code>ef_port_ids</code> (the portfolio IDs [run
numbers] that are part of the efficient frontier; <code>min_var_port_id</code> (the
portfolio ID for the minimum-variance portfolio); <code>ef_weights</code> (the
weights of the portfolios on the efficient frontier).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
weights_matrix &lt;- create_asset_weights(n_pop = 6, n_sims = 3000,
weight_lower_limit = 0.001)
mc_ports &lt;- monte_carlo_portfolios(weights_matrix = weights_matrix,
 n_sims = 3000, mean_b = 1000)

col_pal &lt;- rev(gg_color_hue(6))
ef_dat &lt;- plot_efficient_portfolios(port_vals = mc_ports$port_vals,
 pal = col_pal, weights_matrix = weights_matrix)
names(ef_dat)

## End(Not run)
</code></pre>

<hr>
<h2 id='plot_panel_lines'>Standard matrix plot of values by stream for one panel:</h2><span id='topic+plot_panel_lines'></span>

<h3>Description</h3>

<p>Standard matrix plot of values by stream for one panel:
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_panel_lines(dat, ymin = c("zero", "min"), ystretch = 1.1, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_panel_lines_+3A_dat">dat</code></td>
<td>
<p>The matrix of values to plot</p>
</td></tr>
<tr><td><code id="plot_panel_lines_+3A_ymin">ymin</code></td>
<td>
<p>Minimum y value for axis</p>
</td></tr>
<tr><td><code id="plot_panel_lines_+3A_ystretch">ystretch</code></td>
<td>
<p>A fraction to multiply the max value of when setting the y
axis limits. This is useful to make space for a panel label within the plot.</p>
</td></tr>
<tr><td><code id="plot_panel_lines_+3A_...">...</code></td>
<td>
<p>Anything else to pass to <code><a href="graphics.html#topic+matplot">matplot</a></code>.</p>
</td></tr>
</table>

<hr>
<h2 id='plot_rickers'>Plot sample Ricker curves for each stock</h2><span id='topic+plot_rickers'></span>

<h3>Description</h3>

<p>Make a plot of Ricker curves for each stock. Can be useful for visualizing
how the simulation parameters are impacting the Ricker curves and how these
vary with temperature across stocks. The colour of the lines corresponds to
the relative thermal tolerance of that stock. The shaded region shows the
range of spawners observed throughout the simulations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_rickers(
  x,
  pal = rep("black", x$n_pop),
  n_samples = 40,
  add_y_axes_pops = c(1, 6),
  add_x_axes_pops = c(6:10),
  burn = 1:30,
  add_shading = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_rickers_+3A_x">x</code></td>
<td>
<p>Output list from <code><a href="#topic+meta_sim">meta_sim</a></code>.</p>
</td></tr>
<tr><td><code id="plot_rickers_+3A_pal">pal</code></td>
<td>
<p>Colours for stocks.</p>
</td></tr>
<tr><td><code id="plot_rickers_+3A_n_samples">n_samples</code></td>
<td>
<p>Number of sample lines to draw from the <code>a</code>
parameters.</p>
</td></tr>
<tr><td><code id="plot_rickers_+3A_add_y_axes_pops">add_y_axes_pops</code></td>
<td>
<p>Panels to add y axes on.</p>
</td></tr>
<tr><td><code id="plot_rickers_+3A_add_x_axes_pops">add_x_axes_pops</code></td>
<td>
<p>Panels to add x axes on.</p>
</td></tr>
<tr><td><code id="plot_rickers_+3A_burn">burn</code></td>
<td>
<p>Number of initial years to throw out as burn in.</p>
</td></tr>
<tr><td><code id="plot_rickers_+3A_add_shading">add_shading</code></td>
<td>
<p>Logical: add the light grey shading for the range of
observed spawner abundance?</p>
</td></tr>
<tr><td><code id="plot_rickers_+3A_...">...</code></td>
<td>
<p>Anything else to pass to <code><a href="graphics.html#topic+plot.default">plot.default</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A plot
</p>


<h3>Examples</h3>

<pre><code class='language-R'>arma_env_params &lt;- list(mean_value = 16, ar = 0.1, sigma_env = 2, ma = 0)
base1 &lt;- meta_sim(n_pop = 10, env_params = arma_env_params, env_type =
  "arma", assess_freq = 5)
plot_rickers(base1)
</code></pre>

<hr>
<h2 id='plot_sim_ts'>Plot various time series from a simulation run</h2><span id='topic+plot_sim_ts'></span>

<h3>Description</h3>

<p>This function lets you quickly visualize the time series of output from a
simulation run.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_sim_ts(
  x,
  pal = rev(gg_color_hue(x$n_pop)),
  years_to_show = 30,
  burn = 1:50,
  shade_years = NULL,
  adj = 0.02,
  add_units = FALSE,
  yticks = rep(list(NA), 10),
  oma = c(4, 4.5, 1, 1)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_sim_ts_+3A_x">x</code></td>
<td>
<p>A list output object from a simulation run of
<code>link{meta_sim}</code>.</p>
</td></tr>
<tr><td><code id="plot_sim_ts_+3A_pal">pal</code></td>
<td>
<p>A colour palette for the lines. One colour per line (each
line is a population time series).</p>
</td></tr>
<tr><td><code id="plot_sim_ts_+3A_years_to_show">years_to_show</code></td>
<td>
<p>How many years to plot after the burn in period.</p>
</td></tr>
<tr><td><code id="plot_sim_ts_+3A_burn">burn</code></td>
<td>
<p>The number of years to discard as burn in at the beginning of
the time series.</p>
</td></tr>
<tr><td><code id="plot_sim_ts_+3A_shade_years">shade_years</code></td>
<td>
<p>Shade some years? Give a vector. Shading will be applied
from the minimum to maximum value. Can be used to show burn in period.</p>
</td></tr>
<tr><td><code id="plot_sim_ts_+3A_adj">adj</code></td>
<td>
<p><code>adj</code> parameter to pass to <code><a href="graphics.html#topic+mtext">mtext</a></code> for
panel labels</p>
</td></tr>
<tr><td><code id="plot_sim_ts_+3A_add_units">add_units</code></td>
<td>
<p>Should the units be added to the y axis?</p>
</td></tr>
<tr><td><code id="plot_sim_ts_+3A_yticks">yticks</code></td>
<td>
<p>Position of ticks on the Y axis.</p>
</td></tr>
<tr><td><code id="plot_sim_ts_+3A_oma">oma</code></td>
<td>
<p><code>oma</code> vector to pass to <code>par</code> for outer margin space.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A plot
</p>


<h3>Examples</h3>

<pre><code class='language-R'>arma_env_params &lt;- list(mean_value = 16, ar = 0.1, sigma_env = 2, ma = 0)
base1 &lt;- meta_sim(n_pop = 10, env_params = arma_env_params, env_type =
  "arma", assess_freq = 5, decrease_b = 10)
plot_sim_ts(base1, years_to_show = 70, burn = 1:30)
</code></pre>

<hr>
<h2 id='plot_sp_A_ts'>Plot sample time series from a portfolio simulation</h2><span id='topic+plot_sp_A_ts'></span>

<h3>Description</h3>

<p>Plot sample time series from a portfolio simulation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_sp_A_ts(
  X,
  ylim,
  x_axis = TRUE,
  y_axis = TRUE,
  rate = FALSE,
  lwd = 1.7,
  y_axis_ticks = NULL,
  start_new_plots = 1,
  labels = NULL,
  burn = 30,
  add_lm = FALSE,
  cols,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_sp_A_ts_+3A_x">X</code></td>
<td>
<p>Object to plot. Should be a list of outputs from
<code><a href="#topic+meta_sim">meta_sim</a></code>.</p>
</td></tr>
<tr><td><code id="plot_sp_A_ts_+3A_ylim">ylim</code></td>
<td>
<p>Y axis limits.</p>
</td></tr>
<tr><td><code id="plot_sp_A_ts_+3A_x_axis">x_axis</code></td>
<td>
<p>Should an x axis be added?</p>
</td></tr>
<tr><td><code id="plot_sp_A_ts_+3A_y_axis">y_axis</code></td>
<td>
<p>Should a y axis be added?</p>
</td></tr>
<tr><td><code id="plot_sp_A_ts_+3A_rate">rate</code></td>
<td>
<p>If <code>TRUE</code> then the first difference (rate of change) will be
plotted. If <code>FALSE</code> then the raw data will be plotted.</p>
</td></tr>
<tr><td><code id="plot_sp_A_ts_+3A_lwd">lwd</code></td>
<td>
<p>Line width of the lines.</p>
</td></tr>
<tr><td><code id="plot_sp_A_ts_+3A_y_axis_ticks">y_axis_ticks</code></td>
<td>
<p>Location of the y-axis tick marks, if you want to specify
them.</p>
</td></tr>
<tr><td><code id="plot_sp_A_ts_+3A_start_new_plots">start_new_plots</code></td>
<td>
<p>On which elements of the list <code>X</code> should new
panels be started? A numeric vector.</p>
</td></tr>
<tr><td><code id="plot_sp_A_ts_+3A_labels">labels</code></td>
<td>
<p>Labels for the panels.</p>
</td></tr>
<tr><td><code id="plot_sp_A_ts_+3A_burn">burn</code></td>
<td>
<p>Burn in period to discard.</p>
</td></tr>
<tr><td><code id="plot_sp_A_ts_+3A_add_lm">add_lm</code></td>
<td>
<p>Add a regression trend line?</p>
</td></tr>
<tr><td><code id="plot_sp_A_ts_+3A_cols">cols</code></td>
<td>
<p>Colours for the lines. A vector of character.</p>
</td></tr>
<tr><td><code id="plot_sp_A_ts_+3A_...">...</code></td>
<td>
<p>Anything else to pass to <code><a href="graphics.html#topic+plot.default">plot.default</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A plot, possibly with multiple panels.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>w_plans &lt;- list()
w_plans[[1]] &lt;- c(5, 1000, 5, 1000, 5, 5, 1000, 5, 1000, 5)
w_plans[[2]] &lt;- c(5, 5, 5, 1000, 1000, 1000, 1000, 5, 5, 5)
w_plans[[3]] &lt;- c(rep(1000, 4), rep(5, 6))
w_plans[[4]] &lt;- rev(w_plans[[3]])
w &lt;- list()
for(i in 1:4) { # loop over plans
 w[[i]] &lt;- list()
 for(j in 1:2) { # loop over trials
   w[[i]][[j]] &lt;- matrix(w_plans[[i]], nrow = 1)
 }
}

cons_arma_ts &lt;- list()
arma_env_params &lt;- list(mean_value = 16, ar = 0.1, sigma_env = 2, ma = 0)
for(i in 1:4) {
  use_cache &lt;- ifelse(i == 1, FALSE, TRUE)
  cons_arma_ts[[i]] &lt;- meta_sim(b = w[[i]][[1]], n_pop = 10, env_params =
    arma_env_params, env_type = "arma", assess_freq = 5,
    use_cache = use_cache)
}
cols &lt;- RColorBrewer::brewer.pal(5, "Dark2")
par(mfrow = c(2, 1))
plot_sp_A_ts(cons_arma_ts, ylim = c(0000, 12400),
  start_new_plots = c(1, 3),
  labels = c("Balanced response diversity",
    "ignore", "Unbalanced response diversity", "ignore"), cols = cols)
</code></pre>

<hr>
<h2 id='ricker'>A simple Ricker model</h2><span id='topic+ricker'></span>

<h3>Description</h3>

<p>A simple Ricker model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ricker(spawners, a, b)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ricker_+3A_spawners">spawners</code></td>
<td>
<p>Spawner abundance</p>
</td></tr>
<tr><td><code id="ricker_+3A_a">a</code></td>
<td>
<p>Ricker productivity parameter. Recruits are e^a at the origin.</p>
</td></tr>
<tr><td><code id="ricker_+3A_b">b</code></td>
<td>
<p>Ricker density dependent parameter.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the number of recruits.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>S &lt;- seq(100, 1000, length.out = 100)
R &lt;- ricker(S, a = 1.9, b = 900)
plot(S, R)
</code></pre>

<hr>
<h2 id='ricker_escapement'>Assign a salmon escapement target based on a Ricker curve</h2><span id='topic+ricker_escapement'></span>

<h3>Description</h3>

<p>Sets escapement according to Hilborn and Walters (1992) p272, Table
7.2. Smsy = b(0.5 - 0.07*a).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ricker_escapement(a, b)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ricker_escapement_+3A_a">a</code></td>
<td>
<p>Ricker productivity parameter.</p>
</td></tr>
<tr><td><code id="ricker_escapement_+3A_b">b</code></td>
<td>
<p>Ricker density-dependent parameter.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Hilborn, R.W. and Walters, C. 1992. Quantitative fisheries stock
assessment: Choice, dynamics, and uncertainty. Chapman and Hall, London.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ricker_escapement(1.1, 1000)

</code></pre>

<hr>
<h2 id='ricker_v_t'>Ricker stock-recruit function with specified error</h2><span id='topic+ricker_v_t'></span>

<h3>Description</h3>

<p>Ricker stock-recruit function with specified error
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ricker_v_t(spawners, a, b, d, v_t)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ricker_v_t_+3A_spawners">spawners</code></td>
<td>
<p>A single spawner abundance</p>
</td></tr>
<tr><td><code id="ricker_v_t_+3A_a">a</code></td>
<td>
<p>Ricker productivity parameter. Recruits are e^a at the origin.</p>
</td></tr>
<tr><td><code id="ricker_v_t_+3A_b">b</code></td>
<td>
<p>Ricker density dependent parameter.</p>
</td></tr>
<tr><td><code id="ricker_v_t_+3A_d">d</code></td>
<td>
<p>Depensation parameter. A value of 1 means no depensation. Larger
values indicate depensation.</p>
</td></tr>
<tr><td><code id="ricker_v_t_+3A_v_t">v_t</code></td>
<td>
<p>A single residual on the curve. Will be exponentiated. Note that we are
*not* bias correcting within this function (subtracting half the variance
squared) and so the deviations will not be mean unbiased unless they were
bias corrected previously.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a vector of recruits.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>plot(1, 1, xlim = c(1, 100), ylim = c(0, 90), type = "n", xlab = "Spawners",
  ylab = "Returns")
for(i in 1:100) {
points(i, ricker_v_t(i, a = 1.1, b = 60, d = 1, v_t = rnorm(1, mean =
  -(0.1^2)/2, sd = 0.1)))
}
</code></pre>

<hr>
<h2 id='run_cons_plans'>Run conservation plans and return the portfolio mean and variance values</h2><span id='topic+run_cons_plans'></span>

<h3>Description</h3>

<p>This function takes a set of weights representing different conservation
plans and gets the mean and variance in portfolio space. This function allows
a maximally complicated set of weights to accommodate all possible scenarios.
It can accommodate different spatial strategies of conservation, conserving
different numbers of populations, and a lack of knowledge. You can do this by
how you set your <code>w</code> weight object. See the example.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_cons_plans(
  w,
  env_type,
  env_params,
  show_progress = TRUE,
  burn = 1:30,
  assess_freq = 5,
  risk_fn = var,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="run_cons_plans_+3A_w">w</code></td>
<td>
<p>A (nested) list of weights. The first list level contains the
different plans. The next level contains repetitions for a given plan.
E.g. <code>cp[[2]][[1]]</code> contains the first iteration of the second
conservation plan. Each end element should be a matrix of weights with one
row and the number of columns equal to the number of subpopulations.</p>
</td></tr>
<tr><td><code id="run_cons_plans_+3A_env_type">env_type</code></td>
<td>
<p>The environmental type to pass to
<code><a href="#topic+generate_env_ts">generate_env_ts</a></code></p>
</td></tr>
<tr><td><code id="run_cons_plans_+3A_env_params">env_params</code></td>
<td>
<p>The environmental parameters to pass to
<code><a href="#topic+generate_env_ts">generate_env_ts</a></code></p>
</td></tr>
<tr><td><code id="run_cons_plans_+3A_show_progress">show_progress</code></td>
<td>
<p>Logical: show an indication of progress?</p>
</td></tr>
<tr><td><code id="run_cons_plans_+3A_burn">burn</code></td>
<td>
<p>Cycles to throw out as burn in</p>
</td></tr>
<tr><td><code id="run_cons_plans_+3A_assess_freq">assess_freq</code></td>
<td>
<p>How frequently (in years) to re-assess the Ricker a and b
values.</p>
</td></tr>
<tr><td><code id="run_cons_plans_+3A_risk_fn">risk_fn</code></td>
<td>
<p>A risk function to use. Can be any function that takes a
numeric vector and returns a single value. Suggested values include
<code>var</code>, or <code><a href="#topic+VaR">VaR</a></code>, or <code><a href="#topic+CVaR">CVaR</a></code>. Defaults to
variance.</p>
</td></tr>
<tr><td><code id="run_cons_plans_+3A_...">...</code></td>
<td>
<p>Other values to pass to <code><a href="#topic+meta_sim">meta_sim</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with two high-level elements: the mean variance output
(<code>plans_mv</code>) and the raw simulation output (<code>plans_port</code>).
Within <code>plans_mv</code>, each element of the list contains a conservation
plan. Each row of the data frames represents a trial run. Within
<code>plans_port</code>, each first level of the list contains a weight element
and each second level of the list contains a replicate.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
set.seed(1)
w_plans &lt;- list()
w_plans[[1]] &lt;- c(5, 1000, 5, 1000, 5, 5, 1000, 5, 1000, 5)
w_plans[[2]] &lt;- c(5, 5, 5, 1000, 1000, 1000, 1000, 5, 5, 5)
w_plans[[3]] &lt;- c(rep(1000, 4), rep(5, 6))
w_plans[[4]] &lt;- rev(w_plans[[3]])
plans_name_sp &lt;- c("Full range of responses", "Most stable only",
"Lower half", "Upper half")
 n_trials &lt;- 50 # number of trials at each n conservation plan
 n_plans &lt;- 4 # number of plans
 num_pops &lt;- c(2, 4, 8, 16) # n pops to conserve
 w &lt;- list()
 for(i in 1:n_plans) { # loop over number conserved
  w[[i]] &lt;- list()
  for(j in 1:n_trials) { # loop over trials
    w[[i]][[j]] &lt;- matrix(rep(625, 16), nrow = 1)
    w[[i]][[j]][-sample(1:16, num_pops[i])] &lt;- 5
  }
 }
arma_env_params &lt;- list(mean_value = 16, ar = 0.1, sigma_env = 2, ma = 0)

x_arma_sp &lt;- run_cons_plans(w, env_type = "arma", env_params = arma_env_params)

plot_cons_plans(x_arma_sp$plans_mv, plans_name = plans_name_sp, cols =
  cols, add_all_efs = FALSE, xlim = c(0.02, 0.15), ylim = c(-0.017,
    0.017), add_legend = FALSE)

# In this version, the pops are wiped out; total abundance changes
n_trials &lt;- 50 # number of trials at each n conservation plan
num_pops &lt;- c(2, 4, 8, 16) # n pops to conserve
n_plans &lt;- length(num_pops) # number of plans
w &lt;- list()
for(i in 1:n_plans) { # loop over number conserved
 w[[i]] &lt;- list()
 for(j in 1:n_trials) { # loop over trials
   w[[i]][[j]] &lt;- matrix(rep(1000, 16), nrow = 1)
   w[[i]][[j]][-sample(1:16, num_pops[i])] &lt;- 5
 }
}
plans_name_n &lt;- paste(num_pops, "populations")
arma_env_params &lt;- list(mean_value = 16, ar = 0.1, sigma_env = 2, ma = 0)

x_arma_n &lt;- run_cons_plans(w, env_type = "arma", env_params =
  arma_env_params, max_a = thermal_integration(16))

plot_cons_plans(x_arma_n$plans_mv, plans_name = plans_name_n, cols =
  cols, add_all_efs = FALSE, xlim = c(0.02, 0.15), ylim = c(-0.017,
    0.017), add_legend = FALSE)

## End(Not run)
</code></pre>

<hr>
<h2 id='thermal_area'>Return desired squared deviation between desired area and actual
area under a curve</h2><span id='topic+thermal_area'></span>

<h3>Description</h3>

<p>The function finds the lower and upper roots (where the thermal curve crosses
0) with the <code><a href="stats.html#topic+uniroot">uniroot</a></code> function and then integrates the
area under the thermal curve with the <code><a href="stats.html#topic+integrate">integrate</a></code>
function. This is useful as part of the optimization routine in
<code><a href="#topic+optim_thermal">optim_thermal</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>thermal_area(
  max_a,
  desired_area,
  optim_temp,
  width_param,
  lower = -5,
  upper = 40
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="thermal_area_+3A_max_a">max_a</code></td>
<td>
<p>Maximum Ricker a productivity value</p>
</td></tr>
<tr><td><code id="thermal_area_+3A_desired_area">desired_area</code></td>
<td>
<p>Desired area under the thermal curve</p>
</td></tr>
<tr><td><code id="thermal_area_+3A_optim_temp">optim_temp</code></td>
<td>
<p>Optimal temperature</p>
</td></tr>
<tr><td><code id="thermal_area_+3A_width_param">width_param</code></td>
<td>
<p>The width parameter as a numeric value</p>
</td></tr>
<tr><td><code id="thermal_area_+3A_lower">lower</code></td>
<td>
<p>Lower bound to pass to <code><a href="stats.html#topic+uniroot">uniroot</a></code></p>
</td></tr>
<tr><td><code id="thermal_area_+3A_upper">upper</code></td>
<td>
<p>Upper bound to pass to <code><a href="stats.html#topic+uniroot">uniroot</a></code></p>
</td></tr>
</table>

<hr>
<h2 id='thermal_curve_a'>Create thermal tolerance curves.</h2><span id='topic+thermal_curve_a'></span>

<h3>Description</h3>

<p>Creates a quadratic thermal tolerance curve of the form: width_param * (temp
- optim_temp)^2 + max_a Negative values are *not* returned as 0 for speed of
computation. You should check for this after.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>thermal_curve_a(temp, optim_temp = 15, max_a = 1.4, width_param = 0.02)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="thermal_curve_a_+3A_temp">temp</code></td>
<td>
<p>The input temperature value.</p>
</td></tr>
<tr><td><code id="thermal_curve_a_+3A_optim_temp">optim_temp</code></td>
<td>
<p>The optimal temperature.</p>
</td></tr>
<tr><td><code id="thermal_curve_a_+3A_max_a">max_a</code></td>
<td>
<p>The maximum productivity parameter 'a' from a Ricker model (or
whatever the y-axis value is you want to return).</p>
</td></tr>
<tr><td><code id="thermal_curve_a_+3A_width_param">width_param</code></td>
<td>
<p>A parameter to control the width of the parabola. Smaller
numbers make wider parabolas.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A productivity parameter given the location on a thermal tolerance
curve.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- seq(5, 30, length.out = 200)
plot(x, thermal_curve_a(x), ylab = "a", xlab = "Temperature", type
= "l")
</code></pre>

<hr>
<h2 id='thermal_integration'>Integrate thermal tolerance curves to get maximum Ricker a values</h2><span id='topic+thermal_integration'></span>

<h3>Description</h3>

<p>Get maximum Ricker a values for a given number of populations. Useful for
assembling multiple thermal tolerance curves in which each has the same total
area under it.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>thermal_integration(
  n_pop,
  width_params = c(seq(0.05, 0.02, length.out = n_pop/2), rev(seq(0.05, 0.02, length.out
    = n_pop/2))),
  optim_temps = seq(13, 19, length.out = n_pop),
  desired_area = 30
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="thermal_integration_+3A_n_pop">n_pop</code></td>
<td>
<p>The number of populations.</p>
</td></tr>
<tr><td><code id="thermal_integration_+3A_width_params">width_params</code></td>
<td>
<p>Desired widths of the thermal tolerance curves.</p>
</td></tr>
<tr><td><code id="thermal_integration_+3A_optim_temps">optim_temps</code></td>
<td>
<p>Temperature value at which to reach the peak of each
thermal tolerance curve.</p>
</td></tr>
<tr><td><code id="thermal_integration_+3A_desired_area">desired_area</code></td>
<td>
<p>Desired area under each curve.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of Ricker a values
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Minimal example:
thermal_integration(16)

# Elaborate example:
optim_temps &lt;- seq(13, 19, length.out = 10)
widths &lt;- c(seq(0.05, 0.02, length.out = 5), rev(seq(0.05, 0.02,
      length.out = 5)))
heights &lt;- c(seq(2.8, 2.2, length.out = 5), rev(seq(2.8, 2.2,
      length.out = 5)))
x &lt;- seq(3, 29, length.out = 200)
plot(1, 1, xlim = c(4, 28), ylim = c(-0.01, 2.9), ylab = "Ricker
  productivity parameter (a)", xlab = "Environmental value", type =
  "n", yaxs = "i", las = 1)
for(i in 1:10) {
  a &lt;- thermal_curve_a(x, optim_temp = optim_temps[i], max_a =
    heights[i], width_param = widths[i])
  lines(x, a, col = "grey40", lwd = 1.5)
}
</code></pre>

<hr>
<h2 id='VaR'>Value at Risk</h2><span id='topic+VaR'></span>

<h3>Description</h3>

<p>Get the value at risk.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>VaR(x, probs = 0.05)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="VaR_+3A_x">x</code></td>
<td>
<p>A numeric vector</p>
</td></tr>
<tr><td><code id="VaR_+3A_probs">probs</code></td>
<td>
<p>The probability cutoff to pass to the value at risk.</p>
</td></tr>
</table>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
