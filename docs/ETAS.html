<!DOCTYPE html><html lang="en"><head><title>Help for package ETAS</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ETAS}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#catalog'><p>Create an Earthquake Catalog</p></a></li>
<li><a href='#date2day'><p>Convert date-time data to numeric data in decimal days</p></a></li>
<li><a href='#etas'><p>Fit the space-time ETAS model to data</p></a></li>
<li><a href='#ETAS-internal'><p>Internal ETAS functions</p></a></li>
<li><a href='#etas.object'><p>Class of Fitted ETAS Models</p></a></li>
<li><a href='#iran.quakes'><p>An Iranian Earthquake Catalog</p></a></li>
<li><a href='#italy.quakes'><p>An Italian Earthquake Catalog</p></a></li>
<li><a href='#japan.quakes'><p>A Japanese Earthquake Catalog</p></a></li>
<li><a href='#lambda'><p>Clustering Part of Conditional Intensity Function of the ETAS Model</p></a></li>
<li><a href='#rates'><p>Declustering Probabilities, Background Seismicity Rate and</p>
Clustering Coefficient</a></li>
<li><a href='#resid.etas'><p>Residuals Analysis and Diagnostics Plots</p></a></li>
<li><a href='#search.isc'><p>Retrieving data from the ISC Bulletin</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Modeling Earthquake Data Using 'ETAS' Model</td>
</tr>
<tr>
<td>Description:</td>
<td>Fits the space-time Epidemic Type Aftershock Sequence
    ('ETAS') model to earthquake catalogs using a stochastic 'declustering' 
    approach. The 'ETAS' model is a 'spatio-temporal' marked point process
    model and a special case of the 'Hawkes' process. The package is based 
    on a Fortran program by 'Jiancang Zhuang'
    (available at <a href="http://bemlar.ism.ac.jp/zhuang/software.html">http://bemlar.ism.ac.jp/zhuang/software.html</a>),
    which is modified and translated into C++ and C such that it 
    can be called from R. Parallel computing with 'OpenMP' is possible 
    on supported platforms.</td>
</tr>
<tr>
<td>Version:</td>
<td>0.6.1.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-03-03</td>
</tr>
<tr>
<td>Author:</td>
<td>Abdollah Jalilian <a href="https://orcid.org/0000-0002-6573-0069"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Jiancang Zhuang <a href="https://orcid.org/0000-0002-9708-3871"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Abdollah Jalilian &lt;stat4aj@gmail.com&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.3.0), stats, graphics, utils, maps</td>
</tr>
<tr>
<td>Imports:</td>
<td>lattice, goftest, spatstat.geom, spatstat.explore,
spatstat.random, Rcpp, fields</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp (&ge; 1.0.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/jalilian/ETAS">https://github.com/jalilian/ETAS</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/jalilian/ETAS/issues">https://github.com/jalilian/ETAS/issues</a></td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-09-18 09:58:31 UTC; ripley</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-09-23 11:15:28 UTC</td>
</tr>
</table>
<hr>
<h2 id='catalog'>Create an Earthquake Catalog</h2><span id='topic+catalog'></span>

<h3>Description</h3>

<p>Creates an object of class <code>"catalog"</code> representing
an earthquake catalog dataset. An  earthquake catalog is a
chronologically ordered list of time, epicenter and magnitude
of all recorded earthquakes  in geographical region during
a specific time period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  catalog(data, time.begin=NULL, study.start=NULL,
          study.end=NULL, study.length=NULL,
          lat.range=NULL, long.range=NULL,
          region.poly=NULL, mag.threshold=NULL,
          flatmap=TRUE, dist.unit = "degree", 
          roundoff=TRUE, tz="GMT")
  
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="catalog_+3A_data">data</code></td>
<td>
<p>A <code>data.frame</code> containing date, time,
latitude, longitude and magnitude of earthquakes.</p>
</td></tr>
<tr><td><code id="catalog_+3A_time.begin">time.begin</code></td>
<td>
<p>The beginning of time span of the catalog.
A character string or an object that can be converted to
date-time (calendar dates plus time to the nearest second) by
<code>as.POSIXlt</code>. The default <code>NULL</code> sets it
to the date-time of the first event.</p>
</td></tr>
<tr><td><code id="catalog_+3A_study.start">study.start</code></td>
<td>
<p>The start of the study period.
A character string or an object that can be converted to
date-time by <code>as.POSIXlt</code>. If not specified (<code>NULL</code>),
then <code>time.begin</code> is used.</p>
</td></tr>
<tr><td><code id="catalog_+3A_study.end">study.end</code></td>
<td>
<p>The end of the study period.
A character string or an object that can be converted to
date-time by <code>as.POSIXlt</code>. The default <code>NULL</code> sets it
to the date-time of the last event.</p>
</td></tr>
<tr><td><code id="catalog_+3A_study.length">study.length</code></td>
<td>
<p>A single numeric value specifying the length
of the study period in decimal days. Incompatible with
<code>study.end</code>: either <code>study.end</code> or <code>study.length</code>
can be specified, but not both.</p>
</td></tr>
<tr><td><code id="catalog_+3A_lat.range">lat.range</code></td>
<td>
<p>The latitude range of a rectangular study region.
A numeric vector of size 2 giving (latmin, latmax). By default
(<code>NULL</code>) the range of the latitudes of events is used.</p>
</td></tr>
<tr><td><code id="catalog_+3A_long.range">long.range</code></td>
<td>
<p>The longitude range of a rectangular study region.
A numeric vector of size 2 giving (longmin, longmax). By default
(<code>NULL</code>) the range of the longitudes of events is used.</p>
</td></tr>
<tr><td><code id="catalog_+3A_region.poly">region.poly</code></td>
<td>
<p>Polygonal boundary of a non-rectangular
study region. A list with components <b>lat</b> and <b>long</b>
of equal length specifying the coordinates of the vertices of
a polygonal study region. The vertices must be listed in
<b>anticlockwise</b> order.</p>
</td></tr>
<tr><td><code id="catalog_+3A_mag.threshold">mag.threshold</code></td>
<td>
<p>The magnitude threshold of the catalog.
A positive numeric value. The default (<code>NULL</code>) sets it to
the minimum magnitude of all events.</p>
</td></tr>
<tr><td><code id="catalog_+3A_flatmap">flatmap</code></td>
<td>
<p>Logical flag indicating whether to transform
the spherical coordinates <code class="reqn">(long, lat)</code> on the earth
surface to flat map (planar) coordinates <code class="reqn">(x, y)</code>
in order to approximate the
great-circle distance on the sphere by the corresponding Euclidean
distance on the flat map.</p>
</td></tr>
<tr><td><code id="catalog_+3A_dist.unit">dist.unit</code></td>
<td>
<p>A character string specifying the unit of geographical
coordinates and spatial distances between events. Options
are <code>"degree"</code> (the default case) and <code>"km"</code>.</p>
</td></tr>
<tr><td><code id="catalog_+3A_roundoff">roundoff</code></td>
<td>
<p>Logical flag indicating whether to account for round-off 
error in coordinates of epicenters.</p>
</td></tr>
<tr><td><code id="catalog_+3A_tz">tz</code></td>
<td>
<p>A character string specifying the time zone to be used
for the date-time conversion in <code>as.POSIXlt</code>.
The default <code>"GMT"</code> is the UTC (Universal Time, Coordinated).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>data</code> is required to have at least 5 columns with names
<code>date</code>, <code>time</code>, <code>lat</code>, <code>long</code> and <code>mag</code>
containing, respectively, the date, time, latitude, longitude
and magnitude of each event in the catalog.
</p>
<p>The geographical study region can be rectangular or polygonal:
</p>

<ul>
<li>
<p><b>rectangular study region</b> can be specified by <code>lat.range</code>
and <code>long.range</code> which must be numeric vectors of length 2.
</p>
</li>
<li>
<p><b>polygonal study region</b> can be specified by <code>region.poly</code>
which contains coordinates of the vertices of the polygon. It must
be either a <code>list</code> with components <b>lat</b> and <b>long</b>
of equal length or a <code>data.frame</code> with columns <b>lat</b>
and <b>long</b>. The vertices must be listed in
<em>anticlockwise</em> order and no vertex should be repeated
(i.e. do not repeat the first vertex).
</p>
</li></ul>

<p>The function <code>inside.owin</code> in the <code>spatstat</code>
is used to indicate whether events lie inside the study region.
Only events inside the study region and the study period
(<code>study.start</code>, <code>study.end</code>) are considered as
<em>target</em> events. Other events are assumed to be
<em>complementary</em> events.
</p>
<p>If the events in <code>data</code> are not chronologically sorted,
then a warning will be produced and the events will be sorted
in ascending order with respect to time of occurrence.
</p>
<p>If <code>flatmap=TRUE</code>, longitude-latitude coordinates convert to
flat map coordinates:
</p>

<ul>
<li><p> if <code>dist.unit="degree"</code>, then the
Equirectangular projection
</p>
<p style="text-align: center;"><code class="reqn">x = \cos(cnt.lat/180 \pi) (long - cnt.long)</code>
</p>

<p>and <code class="reqn">y = lat - cnt.lat</code>
is used to obtain the flat map coordinates <code class="reqn">(x, y)</code> in
degrees, where <code class="reqn">cnt.lat</code> and <code class="reqn">cnt.long</code> are,
respectively, the latitude and longitude of the centroid of the
geographical region.
</p>
</li>
<li><p> if <code>dist.unit="km"</code>, then the projection
</p>
<p style="text-align: center;"><code class="reqn">x = 111.32 \cos(lat/180 \pi) long</code>
</p>

<p>and <code class="reqn">y = 110.547 lat</code>
is used where  <code class="reqn">x</code> and <code class="reqn">y</code> are in (approximate) kilometers.
</p>
</li></ul>



<h3>Value</h3>

<p>An object of class <code>"catalog"</code> containing an earthquake
catalog dataset.
</p>


<h3>Author(s)</h3>

<p>Abdollah Jalilian
<a href="mailto:jalilian@razi.ac.ir">jalilian@razi.ac.ir</a>
</p>


<h3>References</h3>

<p>Zhuang J (2012).
Long-term Earthquake Forecasts Based on the Epidemic-type Aftershock
Sequence (ETAS) Model for Short-term Clustering.
<em>Research in Geophysics</em>, <b>2</b>(1), 52&ndash;57.
<a href="https://doi.org/10.4081/rg.2012.e8">doi:10.4081/rg.2012.e8</a>.
</p>


<h3>See Also</h3>

<p><code>etas</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  summary(iran.quakes)

  # creating a catalog with rectangular study region
  iran.cat &lt;- catalog(iran.quakes, time.begin="1973/01/01",
     study.start="1985/01/01", study.end="2016/01/01",
     lat.range=c(25, 42), long.range=c(42, 63),
     mag.threshold=4.5)

  print(iran.cat)
  ## Not run: 
  plot(iran.cat)
  
## End(Not run)

  # equivalently, specifying the length of the study period
  iran.cat2 &lt;- catalog(iran.quakes, time.begin="1973/01/01",
     study.start="1985/01/01", study.length=11322,
     lat.range=c(25, 42), long.range=c(42, 63),
     mag.threshold=4.5)

  print(iran.cat2)


  # specifying a polygonal geographical region
  jpoly &lt;- list(long=c(134.0, 137.9, 143.1, 144.9, 147.8,
      137.8, 137.4, 135.1, 130.6), lat=c(31.9, 33.0, 33.2,
      35.2, 41.3, 44.2, 40.2, 38.0, 35.4))
  # creating a catalog with polygonal study region
  japan.cat &lt;- catalog(japan.quakes, time.begin="1966-01-01",
      study.start="1970-01-01", study.end="2010-01-01",
      region.poly=jpoly, mag.threshold=4.5)

  print(japan.cat)
  ## Not run: 
  plot(japan.cat)
  
## End(Not run)
</code></pre>

<hr>
<h2 id='date2day'>Convert date-time data to numeric data in decimal days</h2><span id='topic+date2day'></span>

<h3>Description</h3>

<p>A function to convert date-time data to decimal days with respect to a date-time origin.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  date2day(dates, start=NULL, tz="", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="date2day_+3A_dates">dates</code></td>
<td>
<p>A date-time or date object. Typically, it is a character
vector containing date-time information.</p>
</td></tr>
<tr><td><code id="date2day_+3A_start">start</code></td>
<td>
<p>A date-time or date object. Determines the origin of the conversion.</p>
</td></tr>
<tr><td><code id="date2day_+3A_tz">tz</code></td>
<td>
<p>Optional. Timezone specification to be used for the conversion.</p>
</td></tr>
<tr><td><code id="date2day_+3A_...">...</code></td>
<td>
<p>Arguments to be passed to <code>as.POSIXlt</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The arguments <code>dates</code> and <code>start</code> must be of
appropriate format to be passed to <code>as.POSIXlt</code> function.
</p>


<h3>Value</h3>

<p>A numeric vector of the same length as <code>dates</code>.
</p>


<h3>Author(s)</h3>

<p>Abdollah Jalilian
<a href="mailto:jalilian@razi.ac.ir">jalilian@razi.ac.ir</a>
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+as.POSIXlt">as.POSIXlt</a></code> and <code><a href="base.html#topic+difftime">difftime</a></code> for appropriate format of the data
to be converted.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # date-time data of Iran's earthquakes between 1973/01/01 and 2016/01/01
  dt &lt;- paste(iran.quakes$date, iran.quakes$time)
  # origin of the conversion
  start &lt;- "1973/01/01 00:00:00"
  # time in days since 1973-01-01 (UTC)
  date2day(dt, start, tz="GMT")
</code></pre>

<hr>
<h2 id='etas'>Fit the space-time ETAS model to data</h2><span id='topic+etas'></span>

<h3>Description</h3>

<p>A function to fit the space-time version of the Epidemic Type
Aftershock Sequence (ETAS) model to a catalog of earthquakes
(a spatio-temporal point pattern) and perform a stochastic
declustering method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'> etas(object, param0 = NULL, bwd = NULL, nnp = 5, bwm = 0.05,
      verbose = TRUE, plot.it = FALSE, ndiv = 1000, no.itr = 11,
      rel.tol=1e-03, eps = 1e-06, cxxcode = TRUE, nthreads = 1,
      mver = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="etas_+3A_object">object</code></td>
<td>
<p>An object of class <code>"catalog"</code> containing an
earthquake catalog dataset.</p>
</td></tr>
<tr><td><code id="etas_+3A_param0">param0</code></td>
<td>
<p>Initial guess for model parameters. A numeric vector
of appropriate length (currently 8). See details.</p>
</td></tr>
<tr><td><code id="etas_+3A_bwd">bwd</code></td>
<td>
<p>Optional. Bandwidths for smoothness and integration
on the geographical region <code>win</code>. A numeric vector
which has the length of the number of events.
If not supplied, the following arguments <code>nnp</code> and
<code>bwm</code> determine bandwidths.</p>
</td></tr>
<tr><td><code id="etas_+3A_nnp">nnp</code></td>
<td>
<p>Number of nearest neighbors for bandwidth calculations. An integer.</p>
</td></tr>
<tr><td><code id="etas_+3A_bwm">bwm</code></td>
<td>
<p>Minimum bandwidth. A positive numeric value.</p>
</td></tr>
<tr><td><code id="etas_+3A_verbose">verbose</code></td>
<td>
<p>Logical flag indicating whether to print progress reports.</p>
</td></tr>
<tr><td><code id="etas_+3A_plot.it">plot.it</code></td>
<td>
<p>Logical flag indicating whether plot probabilities of
each event being a background event on a map.</p>
</td></tr>
<tr><td><code id="etas_+3A_ndiv">ndiv</code></td>
<td>
<p>An integer indicating the number of knots on each
side of the geographical region for integral approximation.</p>
</td></tr>
<tr><td><code id="etas_+3A_no.itr">no.itr</code></td>
<td>
<p>An integer indicating the number of iterations for
convergence of the iterative approach of simultaneous estimation
and declustering algorithm. See details.</p>
</td></tr>
<tr><td><code id="etas_+3A_rel.tol">rel.tol</code></td>
<td>
<p>Relative iteration convergence tolerance of the
iterative estimation approach.</p>
</td></tr>
<tr><td><code id="etas_+3A_eps">eps</code></td>
<td>
<p>Optimization  convergence tolerance in the
Davidon-Fletch-Powell algorithm</p>
</td></tr>
<tr><td><code id="etas_+3A_cxxcode">cxxcode</code></td>
<td>
<p>Logical flag indicating whether to use the C++ code.
The C++ code is slightly faster and allows parallel computing.</p>
</td></tr>
<tr><td><code id="etas_+3A_nthreads">nthreads</code></td>
<td>
<p>An integer indicating number of threads in
the parallel region of the C++ code</p>
</td></tr>
<tr><td><code id="etas_+3A_mver">mver</code></td>
<td>
<p>An integer indicating which spatial probability density 
function for locations of triggered events should be use. 
The default <code>mver=1</code> corresponds to the inverse 
power density and <code>mver=2</code> corresponds to the 
Gaussian density.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Ogata (1988) introduced the epidemic type aftershock sequence
(ETAS) model based on Gutenberg-Richter law and modified Omori law.
In its space-time representation (Ogata, 1998), the ETAS model is a
temporal marked point process model, and a special case of marked
Hawkes process, with conditional intensity function
</p>
<p style="text-align: center;"><code class="reqn">
      \lambda(t, x, y | H_t) = \mu(x,y) + \sum_{t_i &lt; t} k(m_i)g(t - t_i)f(x - x_i, y - y_i|m_i)
    </code>
</p>

<p>where
</p>

<dl>
<dt><code class="reqn">H_t</code>: </dt><dd><p>is the observational history up to time t, but not
including t; that is
</p>
<p style="text-align: center;"><code class="reqn">H_t=\{(t_i, x_i, y_i, m_i): t_i &lt; t\}</code>
</p>

</dd>
<dt><code class="reqn">\mu(x,y)</code>: </dt><dd><p>is the background intensity. Currently it
is assumed to take the semi-parametric form
</p>
<p style="text-align: center;"><code class="reqn">\mu(x,y)=\mu u(x,y)</code>
</p>

<p>where <code class="reqn">\mu</code> is an unknown constant and <code class="reqn">u(x,y)</code>
is an unknown function.
</p>
</dd>
<dt><code class="reqn">k(m)</code>: </dt><dd><p>is the expected number of events triggered
from an event of magnitude <code class="reqn">m</code> given by
</p>
<p style="text-align: center;"><code class="reqn">k(m) = A\exp(\alpha(m - m_0))</code>
</p>

</dd>
<dt><code class="reqn">g(t)</code>: </dt><dd><p>is the p.d.f of the occurrence
times of the triggered events, taking the form
</p>
<p style="text-align: center;"><code class="reqn">g(t) =  \frac{p-1}{c}(1 + \frac{t}{c})^{-p}</code>
</p>

</dd>
<dt><code class="reqn">f(x,y|m)</code>: </dt><dd><p>is the p.d.f of
the locations of the triggered events, considered to be
either the long tail inverse power density (<code>mver = 1</code>)
</p>
<p style="text-align: center;"><code class="reqn"> f(x, y|m) = \frac{q-1}{\pi \sigma(m))}
             (1 + \frac{x^2 + y^2}{\sigma(m)})^{-q} </code>
</p>

<p>or the light tail Gaussian density (<code>mver = 2</code>, only can be used if <code>cxxcode = TRUE</code>)
</p>
<p style="text-align: center;"><code class="reqn"> f(x,y|m)= \frac{1}{2\pi \sigma(m)}\exp(-\frac{x^2 + y^2}{2\sigma(m)}) </code>
</p>

<p>with
</p>
<p style="text-align: center;"><code class="reqn"> \sigma(m) = D\exp(\gamma(m - m_0)) </code>
</p>

</dd>
</dl>

<p>The ETAS models classify seismicity into two components, background
seismicity <code class="reqn">\mu(x, y)</code> and clustering seismicity
<code class="reqn">\lambda(t, x, y|H_t) - \mu(x, y)</code>, where
each earthquake event, whether it is a background event or generated by
another event, produces its own offspring according to the branching rules
controlled by <code class="reqn">k(m)</code>, <code class="reqn">g(m)</code> and <code class="reqn">f(x, y|m)</code>.
</p>
<p>Background seismicity rate <code class="reqn">u(x, y)</code> and the model parameters
</p>
<p style="text-align: center;"><code class="reqn">\theta=(\mu, A, c, \alpha, p, D, q, \gamma)</code>
</p>

<p>are estimated simultaneously using an iterative approach proposed in Zhuang et al. (2002).
First, for an initial <code class="reqn">u_0(x, y)</code>, the parameter vector
<code class="reqn">\theta</code>  is estimated by maximizing the log-likelihood function
</p>
<p style="text-align: center;"><code class="reqn">l(\theta)=\sum_{i} \lambda(t_i, x_i, y_i|H_{t_i}) - \int \lambda(t, x, y|H_t) dx dy dt.</code>
</p>

<p>Then the procedure calculates the probability of being a background
event for each event in the catalog by
</p>
<p style="text-align: center;"><code class="reqn"> \phi_i = \frac{\mu(x_i, y_i)}{\lambda(t_i, x_i, y_i|H_{t_i})}. </code>
</p>

<p>Using these probabilities and kernel smoothing method with Gaussian kernel
and appropriate choice of bandwidth (determined by <code>bwd</code> or <code>nnp</code>
and <code>bwm</code> arguments), the background rate <code class="reqn">u_0(x, y)</code>
is updated. These steps are repeated until the estimates converge
(stabilize).
</p>
<p>The <code>no.itr</code> argument specifies the maximum number of iterations
in the iterative simultaneous estimation and declustering algorithm.
The estimates often converge in less than ten iterations. The relative
iteration convergence tolerance and the optimization
convergence tolerance are, respectively, determined by
<code>rel.tol</code> and <code>eps</code> arguments.
The progress of the computations can be traced by setting
the <code>verbose</code> and <code>plot.it</code> arguments to be <code>TRUE</code>.
</p>
<p>If <code>cxxcode = TRUE</code>, then the internal function <code>etasfit</code>
uses the C++ code implemented using the <span class="pkg">Rcpp</span> package,
which allows multi-thread parallel computing on multi-core processors
with OpenMP.
The argument <code>nthreads</code> in this case determines
the number of threads in the parallel region of the code.
If <code>nthreads = 1</code> (the default case), then a serial version of the
C++ code carries out the computations.
</p>
<p>This version of the ETAS model assumes that the earthquake catalog
is complete and the data are stationary in time. If the catalog
is incomplete or there is non-stationarity (e.g. increasing or cyclic
trend)  in the time of events, then the results of this function are
not reliable.
</p>


<h3>Value</h3>

<p>A list with components
</p>

<dl>
<dt>param:</dt><dd><p>The ML estimates of model parameters.</p>
</dd>
<dt>bk:</dt><dd><p>An estimate of the <code class="reqn">u(x, y)</code>.</p>
</dd>
<dt>pb:</dt><dd><p>The probabilities of being background event.</p>
</dd>
<dt>opt:</dt><dd><p>The results of optimization: the value of the log-likelihood
function at the optimum point, its gradient at the optimum point and AIC of the model.</p>
</dd>
<dt>rates:</dt><dd><p>Pixel images of the estimated total intensity,
background intensity, clustering intensity and conditional intensity.</p>
</dd>
</dl>



<h3>Note</h3>

<p>This function is based on a <code>C</code> port of the original
<code>Fortran</code> code by Jiancang Zhuang, Yosihiko Ogata and
their colleagues. The <code>etas</code> function is intended to be
used for small and medium-size earthquake catalogs.
For large earthquake catalogs, due to time-consuming
computations, it is highly recommended to
use the parallel <code>Fortran</code> code on a server machine.
The <code>Fortran</code> code (implemented for
parallel/non-parallel computing) can be obtained from
<a href="http://bemlar.ism.ac.jp/zhuang/software.html">http://bemlar.ism.ac.jp/zhuang/software.html</a>.
</p>


<h3>Author(s)</h3>

<p>Abdollah Jalilian
<a href="mailto:jalilian@razi.ac.ir">jalilian@razi.ac.ir</a>
</p>


<h3>References</h3>

<p>Ogata Y (1988).
Statistical Models for Earthquake Occurrences and Residual Analysis for
Point Processes.
<em>Journal of the American Statistical Association</em>,
<b>83</b>(401), 9&ndash;27.
<a href="https://doi.org/10.2307/2288914">doi:10.2307/2288914</a>.
</p>
<p>Ogata Y (1998).
Space-time Point-process Models for Earthquake Occurrences.
<em>Annals of the Institute of Statistical Mathematics</em>,
<b>50</b>(2), 379&ndash;402.
<a href="https://doi.org/10.1023/a%3A1003403601725">doi:10.1023/a:1003403601725</a>.
</p>
<p>Zhuang J, Ogata Y, Vere-Jones D (2002).
Stochastic Declustering of Space-Time Earthquake Occurrences.
<em>Journal of the American Statistical Association</em>,
<b>97</b>(458), 369&ndash;380.
<a href="https://doi.org/10.1198/016214502760046925">doi:10.1198/016214502760046925</a>.
</p>
<p>Zhuang J, Ogata Y, Vere-Jones D (2006).
Diagnostic Analysis of Space-Time Branching Processes for Earthquakes.
In <em>Case Studies in Spatial Point Process Modeling</em>,
pp. 275&ndash;292. Springer Nature.
<a href="https://doi.org/10.1007/0-387-31144-0_15">doi:10.1007/0-387-31144-0_15</a>.
</p>
<p>Zhuang J (2011).
Next-day Earthquake Forecasts for the Japan Region Generated by
the ETAS Model.
<em>Earth, Planets and Space</em>,
<b>63</b>(3), 207&ndash;216.
<a href="https://doi.org/10.5047/eps.2010.12.010">doi:10.5047/eps.2010.12.010</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+catalog">catalog</a></code> for constructing data.
<code><a href="#topic+probs">probs</a></code> for estimated declustering probabilities.
<code><a href="#topic+resid.etas">resid.etas</a></code> for diagnostic plots.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # fitting the ETAS model to an Iranian catalog
  # preparing the catalog
  iran.cat &lt;- catalog(iran.quakes, time.begin="1973/01/01",
     study.start="1986/01/01", study.end="2016/01/01",
     lat.range=c(26, 40), long.range=c(44, 63), mag.threshold=5)
  print(iran.cat)
  ## Not run: 
  plot(iran.cat)
## End(Not run)

  # setting initial parameter values
  param0 &lt;- c(0.46, 0.23, 0.022, 2.8, 1.12, 0.012, 2.4, 0.35)

  # fitting the model
  ## Not run: 
  iran.fit &lt;- etas(iran.cat, param0=param0)
## End(Not run)


  # fitting the ETAS model to an Italian catalog
  # preparing the catalog
  italy.cat &lt;- catalog(italy.quakes, dist.unit="km")
  ## Not run: 
  plot(italy.cat)
## End(Not run)

  # setting initial parameter values
  mu &lt;- 1
  k0 &lt;- 0.005
  c &lt;- 0.005
  alpha &lt;- 1.05
  p &lt;- 1.01
  D &lt;- 1.1
  q &lt;- 1.52
  gamma &lt;- 0.6
  # reparametrization: transform k0 to A
  A &lt;- pi * k0 / ((p - 1) * c^(p - 1) * (q - 1) * D^(q - 1))
  param0 &lt;- c(mu, A, c, alpha, p, D, q, gamma)

  # fitting the model
  ## Not run: 
  nthreads &lt;- parallel::detectCores()
  italy.fit &lt;- etas(italy.cat, param0, nthreads=nthreads)
## End(Not run)


  # fitting the ETAS model to a Japanese catalog
  # setting the target polygonal study region
  jpoly &lt;- list(long=c(134.0, 137.9, 143.1, 144.9, 147.8,
      137.8, 137.4, 135.1, 130.6), lat=c(31.9, 33.0, 33.2,
      35.2, 41.3, 44.2, 40.2, 38.0, 35.4))
  # preparing the catalog
  japan.cat &lt;- catalog(japan.quakes, study.start="1953-05-26",
      study.end="1990-01-08", region.poly=jpoly, mag.threshold=4.5)
  ## Not run: 
  plot(japan.cat)
## End(Not run)

  # setting initial parameter values
  param0 &lt;- c(0.592844590, 0.204288231, 0.022692883, 1.495169224,
  1.109752319, 0.001175925, 1.860044210, 1.041549634)

  # fitting the model
  ## Not run: 
  nthreads &lt;- parallel::detectCores()
  japan.fit &lt;- etas(japan.cat, param0, nthreads=nthreads)
## End(Not run)
</code></pre>

<hr>
<h2 id='ETAS-internal'>Internal ETAS functions</h2><span id='topic+rates.inter'></span><span id='topic+lambdax'></span><span id='topic+etasfit'></span><span id='topic+decluster'></span><span id='topic+cxxfit'></span><span id='topic+cxxdeclust'></span><span id='topic+cxxrates'></span><span id='topic+cxxtimetrans'></span><span id='topic+cxxlambdtemp'></span><span id='topic+cxxlambspat'></span><span id='topic+cxxSmooth'></span><span id='topic+cxxstpoisstest'></span><span id='topic+cxxstpoisstestMP'></span><span id='topic+cdeclust'></span><span id='topic+cfit'></span><span id='topic+clambdax'></span><span id='topic+timetransform'></span><span id='topic+lambdaspatial'></span><span id='topic+lambdatemporal'></span><span id='topic+longlat2xy'></span><span id='topic+xy2longlat'></span><span id='topic+print.etas'></span><span id='topic+plot.etas'></span><span id='topic+print.catalog'></span><span id='topic+plot.catalog'></span><span id='topic+poiss.test'></span><span id='topic+Smoothcatalog'></span><span id='topic+allanfactor'></span><span id='topic+morisitaindex'></span><span id='topic+decimalplaces'></span><span id='topic+roundoffErr'></span><span id='topic+ttrend'></span>

<h3>Description</h3>

<p>Internal ETAS functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rates.inter(theta, object, bwd, lat.range=NULL, long.range=NULL,
            mver=1, dimyx=NULL, plot.it=TRUE)
lambdax(rt, rx, ry, theta, revents)
etasfit(theta, revents, rpoly, tperiod, integ0, ihess, verbose,
    ndiv, eps, cxxcode, nthreads, mver)
decluster(theta, rbwd, revents, rpoly, tperiod, ndiv, cxxcode, mver)
cxxfit(tht, revents, rpoly, tperiod, rinteg0, ihess, ndiv, eps, verbose, nthreads, mver)
cxxdeclust(param, revents, rpoly, bwd, tperiod, ndiv, mver)
cxxrates(param, revents, bwd, tperiod, gx, gy, mver)
cxxtimetrans(theta, revents, rpoly, tperiod, integ0, ndiv, mver)
cxxlambdtemp(tg, theta, revents, rpoly, tperiod, integ0, ndiv, mver)
cxxlambspat(xg, yg, theta, revents, rpoly, tperiod, bwd, mver)
cxxSmooth(x, y, bwd, gx, gy, expand)
cxxstpoisstest(xrank, yrank, M)
cxxstpoisstestMP(xrank, yrank, M, nthreads)
cdeclust(theta, rbwd,revents, rpoly, tperiod)
cfit(theta, rdata, ihess, rverbose)
clambdax(rt, rx, ry, theta, revents)
timetransform(fit)
lambdaspatial(x, y, fit)
lambdatemporal(t, fit)
longlat2xy(long, lat, region.poly, dist.unit="degree")
xy2longlat(x, y, region.poly, dist.unit="degree")
poiss.test(object, which="joint", r=NULL, lambda=NULL, bwd=NULL, dimyx=NULL, 
  nsim=299, n.perm=1000, verbose=TRUE, nthreads=1)
Smoothcatalog(object, type="spatial", bwd=NULL, bwm=NULL, nnp=NULL, 
  dimyx=NULL, convert=FALSE)
allanfactor(object, K=100, nsim=500, cat.name=NULL)
morisitaindex(object, K=11, bwd=NULL, dimyx=NULL, cat.name=NULL)
decimalplaces(x) 
roundoffErr(x)
ttrend(obj, tmax=NULL, tmin=NULL)
## S3 method for class 'etas'
print(x,...)
## S3 method for class 'etas'
plot(x, which="est", dimyx=NULL, ...)
## S3 method for class 'catalog'
print(x,...)
## S3 method for class 'catalog'
plot(x,...)
</code></pre>


<h3>Details</h3>

<p>These are usually not to be called by the user.
</p>

<hr>
<h2 id='etas.object'>Class of Fitted ETAS Models</h2><span id='topic+etas.object'></span><span id='topic+methods.etas'></span>

<h3>Description</h3>

<p>A class <code>etas</code> to represent a fitted ETAS model.
The output of <code><a href="#topic+etas">etas</a></code>.
</p>


<h3>Details</h3>

<p>An object of class <code>etas</code> represents an ETAS model
that has been fitted to a spatio-temporal point pattern (catalog)
of earthquakes. It is the output of the model fitter, <code><a href="#topic+etas">etas</a></code>.
</p>
<p>The class <code>etas</code> has methods for the following
standard generic functions:
</p>

<table>
<tr>
 <td style="text-align: left;">
    generic </td><td style="text-align: left;"> method </td><td style="text-align: left;"> description </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>print</code> </td><td style="text-align: left;"> <code><a href="#topic+print.etas">print.etas</a></code>
    </td><td style="text-align: left;"> print details </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Abdollah Jalilian
<a href="mailto:jalilian@razi.ac.ir">jalilian@razi.ac.ir</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+etas">etas</a></code>,
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # fitting the ETAS model to an Iranian catalog

  data(iran.quakes)
  summary(iran.quakes)

    # fitting the ETAS model to an Iranian catalog
  # preparing the catalog
  iran.cat &lt;- catalog(iran.quakes, time.begin="1973/01/01",
     study.start="1986/01/01", study.end="2016/01/01",
     lat.range=c(26, 40), long.range=c(44, 63), mag.threshold=5)
  print(iran.cat)
  ## Not run: 
  plot(iran.cat)
## End(Not run)

  # setting initial parameter values
  param0 &lt;- c(0.46, 0.23, 0.022, 2.8, 1.12, 0.012, 2.4, 0.35)

  # fitting the model
  ## Not run: 
  iran.fit &lt;- etas(iran.cat, param0=param0)
## End(Not run)

</code></pre>

<hr>
<h2 id='iran.quakes'>An Iranian Earthquake Catalog</h2><span id='topic+iran.quakes'></span>

<h3>Description</h3>

<p>A data frame with 5970 rows and 5 columns giving occurrence date, time,
longitude, latitude and magnitude of shallow earthquakes (depth &lt; 100 km)
occurred since 1973-01-01 till 2016-01-01 in Iran and its vicinity
(40-65E and 22-42N). Only earthquakes with magnitude greater than
or equal to 4.5 are included.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(iran.quakes)</code></pre>


<h3>Format</h3>

<p>An object of class <code>"data.frame"</code> containing the following columns:
</p>

<ul>
<li> <p><code>date</code>
Occurrence date in the format &quot;yyyy-mm-dd&quot;
</p>
</li>
<li> <p><code>time</code>
Occurrence time (UTC) in the format &quot;hh:mm:ss&quot;
</p>
</li>
<li> <p><code>long</code>
Latitude of epicenter in decimal degrees
</p>
</li>
<li> <p><code>lat</code>
Latitude of epicenter in decimal degrees
</p>
</li>
<li> <p><code>mag</code>
Magnitude in body-wave magnitude scale (mb)
</p>
</li></ul>



<h3>Source</h3>

<p>The ANSS Comprehensive Catalog (ComCat):
<a href="https://earthquake.usgs.gov/earthquakes/search/">https://earthquake.usgs.gov/earthquakes/search/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  summary(iran.quakes)

  gregion &lt;- list(lat = c(26, 25, 29, 38, 35), long = c(52, 59, 58, 45, 43))
  # creat an earthquake catalog
  iran.cat &lt;- catalog(iran.quakes, study.start = "1991/01/01",
     study.end = "2011/01/01", region.poly = gregion, mag.threshold = 4.5)


  ## Not run: 
  plot(iran.cat)
  iran.fit &lt;- etas(iran.cat)
## End(Not run)

  zagros &lt;- list(lat = c(27, 26, 29, 29, 35, 33),
     long = c(52, 58, 58, 54, 48, 46))
  iran.cat &lt;- catalog(iran.quakes, study.start = "1991/01/01",
     study.end = "2011/01/01", region.poly = zagros, mag.threshold = 4)
</code></pre>

<hr>
<h2 id='italy.quakes'>An Italian Earthquake Catalog</h2><span id='topic+italy.quakes'></span>

<h3>Description</h3>

<p>A data frame with 2158 rows and 6 columns giving occurrence date,
time, longitude, latitude, magnitude and depth of earthquakes
occurred since 2005-04-16 till 2013-11-01 in Italy and its vicinity
(6.15-19E and 35-48N) with magnitude greater than or equal to 3.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(italy.quakes)</code></pre>


<h3>Format</h3>

<p>An object of class <code>"data.frame"</code> containing the following columns:
</p>

<ul>
<li> <p><code>date</code>
Occurrence date in the format &quot;yyyy/mm/dd&quot;
</p>
</li>
<li> <p><code>time</code>
Occurrence time in decimal days after the first earthquake
</p>
</li>
<li> <p><code>long</code>
Latitude of epicenter in decimal degrees
</p>
</li>
<li> <p><code>lat</code>
Latitude of epicenter in decimal degrees
</p>
</li>
<li> <p><code>mag</code>
Magnitude of each earthquake by JMA (Japan Meteorological Agency)
</p>
</li>
<li> <p><code>depth</code>
Depth of each earthquake
</p>
</li></ul>



<h3>Source</h3>

<p>Data are retrieved from the Italian Seismological Instrumental and
Parametric Data Base (ISIDE) available at <a href="http://iside.rm.ingv.it">http://iside.rm.ingv.it</a>
by Marcello Chiodi and Giada Adelfio in the <span class="pkg">etasFLP</span> package.
</p>


<h3>References</h3>

<p>Marcello Chiodi and Giada Adelfio (2015). etasFLP: Mixed FLP and ML
Estimation of ETAS Space-Time Point Processes. R package version
1.3.0. <a href="https://CRAN.R-project.org/package=etasFLP">https://CRAN.R-project.org/package=etasFLP</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # creat an earthquake catalog
  italy.cat &lt;- catalog(italy.quakes, dist.unit="km")

  ## Not run: 
  plot(italy.cat)
## End(Not run)

  # set initial parameter values
  mu &lt;- 1
  k0 &lt;- 0.005
  c &lt;- 0.005
  alpha &lt;- 1.05
  p &lt;- 1.01
  D &lt;- 1.1
  q &lt;- 1.52
  gamma &lt;- 0.6
  # reparametrization: transform k0 to A
  A &lt;- pi * k0 / ((p - 1) * c^(p - 1) * (q - 1) * D^(q - 1))
  param0 &lt;- c(mu, A, c, alpha, p, D, q, gamma)

  ## Not run: 
  italy.fit &lt;- etas(italy.cat, param0)
## End(Not run)
</code></pre>

<hr>
<h2 id='japan.quakes'>A Japanese Earthquake Catalog</h2><span id='topic+japan.quakes'></span><span id='topic+jap.quakes'></span>

<h3>Description</h3>

<p>A data frame with 13724 rows and 6 columns giving occurrence date,
time, longitude, latitude, magnitude and depth of shallow earthquakes
(depth &lt; 100 km) occurred since 1926-01-08 till
2007-12-29 in Japan and its vicinity (128-145E and 27-45N).
Only earthquakes with magnitude greater than or equal to 4.5
are included.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(japan.quakes)</code></pre>


<h3>Format</h3>

<p>An object of class <code>"data.frame"</code> containing the following columns:
</p>

<ul>
<li> <p><code>date</code>
Occurrence date in the format &quot;yyyy/mm/dd&quot;
</p>
</li>
<li> <p><code>time</code>
Occurrence time in the format &quot;hh:mm:ss.ss&quot;
</p>
</li>
<li> <p><code>long</code>
Latitude of epicenter in decimal degrees
</p>
</li>
<li> <p><code>lat</code>
Latitude of epicenter in decimal degrees
</p>
</li>
<li> <p><code>mag</code>
Magnitude of each earthquake by JMA (Japan Meteorological Agency)
</p>
</li>
<li> <p><code>depth</code>
Depth of each earthquake
</p>
</li></ul>



<h3>Source</h3>

<p>Data are retrieved from the Japan Meteorological Agency (JMA) by
Jiancang Zhuang and acoppany the <b>Fortran</b> code at
<a href="http://bemlar.ism.ac.jp/zhuang/software.html">http://bemlar.ism.ac.jp/zhuang/software.html</a>.
</p>


<h3>References</h3>

<p>Zhuang J, Ogata Y, Vere-Jones D (2002). Stochastic Declustering of
Space-Time Earthquake Occurrences.
<em>Journal of the American Statistical Association</em>,
<b>97</b>(458), 369&ndash;380.
<a href="https://doi.org/10.1198/016214502760046925">doi:10.1198/016214502760046925</a>.
</p>
<p>Zhuang J, Ogata Y, Vere-Jones D (2006). Diagnostic Analysis of Space-Time
Branching Processes for Earthquakes. In <em>Case Studies in Spatial Point
Process Modeling</em>, pp. 275&ndash;292. Springer Nature.
<a href="https://doi.org/10.1007/0-387-31144-0_15">doi:10.1007/0-387-31144-0_15</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # set the target polygonal study region
  jpoly &lt;- list(long=c(134.0, 137.9, 143.1, 144.9, 147.8,
      137.8, 137.4, 135.1, 130.6), lat=c(31.9, 33.0, 33.2,
      35.2, 41.3, 44.2, 40.2, 38.0, 35.4))

  # creat an earthquake catalog
  japan.cat &lt;- catalog(japan.quakes, study.start="1953-05-26",
      study.end="1990-01-08", region.poly=jpoly, mag.threshold=4.5)

  ## Not run: 
  plot(japan.cat)
## End(Not run)

  param0 &lt;- c(0.592844590, 0.204288231, 0.022692883, 1.495169224,
  1.109752319, 0.001175925, 1.860044210, 1.041549634)

  ## Not run: 
  nthreads &lt;- parallel::detectCores()
  japan.fit &lt;- etas(japan.cat, param0, nthreads=nthreads)
## End(Not run)

</code></pre>

<hr>
<h2 id='lambda'>Clustering Part of Conditional Intensity Function of the ETAS Model</h2><span id='topic+lambda'></span>

<h3>Description</h3>

<p>A function to compute the clustering part of the conditional
intensity function of the ETAS model at specified time and location.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  lambda(t, x, y, param, object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lambda_+3A_t">t</code></td>
<td>
<p>A numeric value. The time that the conditional intensity is
to be computed at.</p>
</td></tr>
<tr><td><code id="lambda_+3A_x">x</code></td>
<td>
<p>A numeric value. The x-coordinate of the location that the
conditional intensity is to be computed at.</p>
</td></tr>
<tr><td><code id="lambda_+3A_y">y</code></td>
<td>
<p>A numeric value. The y-coordinate of the location that the
conditional intensity is to be computed at.</p>
</td></tr>
<tr><td><code id="lambda_+3A_param">param</code></td>
<td>
<p>Vector of model parameters.</p>
</td></tr>
<tr><td><code id="lambda_+3A_object">object</code></td>
<td>
<p>An object of class <code>"catalog"</code> containing an
earthquake catalog dataset.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For a given <code class="reqn">t</code>, <code class="reqn">x</code> and <code class="reqn">y</code>, this function
computes
</p>
<p style="text-align: center;"><code class="reqn">
      \sum_{t_i &lt; t} k(m_i)g(t - t_i)f(x - x_i, y - y_i|m_i).</code>
</p>



<h3>Value</h3>

<p>A numeric value.
</p>


<h3>Author(s)</h3>

<p>Abdollah Jalilian
<a href="mailto:jalilian@razi.ac.ir">jalilian@razi.ac.ir</a>
</p>


<h3>References</h3>

<p>Zhuang J, Ogata Y, Vere-Jones D (2002).
Stochastic Declustering of Space-Time Earthquake Occurrences.
<em>Journal of the American Statistical Association</em>,
<b>97</b>(458), 369&ndash;380.
<a href="https://doi.org/10.1198/016214502760046925">doi:10.1198/016214502760046925</a>.
</p>
<p>Zhuang J, Ogata Y, Vere-Jones D (2006).
Diagnostic Analysis of Space-Time Branching Processes for Earthquakes.
In <em>Case Studies in Spatial Point Process Modeling</em>,
pp. 275&ndash;292. Springer Nature.
<a href="https://doi.org/10.1007/0-387-31144-0_15">doi:10.1007/0-387-31144-0_15</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+etas">etas</a></code>
<code><a href="#topic+catalog">catalog</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  iran.cat &lt;- catalog(iran.quakes, time.begin="1973/01/01",
     study.start="1996/01/01", study.end="2016/01/01",
     lat.range=c(25, 42), long.range=c(42, 63), mag.threshold=4.5)

  param &lt;- c(0.46, 0.23, 0.022, 2.8, 1.12, 0.012, 2.4, 0.35)

  ## Not run: 
  lambda(15706, 40.12, 34.5, param, iran.cat)
## End(Not run)

</code></pre>

<hr>
<h2 id='rates'>Declustering Probabilities, Background Seismicity Rate and
Clustering Coefficient</h2><span id='topic+rates'></span><span id='topic+probs'></span>

<h3>Description</h3>

<p>Functions to estimate the declustering probabilities, background seismicity
rate and clustering (triggering) coefficient for a fitted ETAS model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  probs(fit)
  rates(fit, lat.range = NULL, long.range = NULL,
        dimyx=NULL, plot.it=TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rates_+3A_fit">fit</code></td>
<td>
<p>A fitted ETAS model. An object of class <code>"etas"</code>.</p>
</td></tr>
<tr><td><code id="rates_+3A_lat.range">lat.range</code></td>
<td>
<p>Latitude range of the rectangular grid.
A numeric vector of length 2.</p>
</td></tr>
<tr><td><code id="rates_+3A_long.range">long.range</code></td>
<td>
<p>Longitude range of the rectangular grid.
A numeric vector of length 2.</p>
</td></tr>
<tr><td><code id="rates_+3A_dimyx">dimyx</code></td>
<td>
<p>Dimensions of the rectangular discretization
grid for the geographical study region.
A numeric vector of length 2.</p>
</td></tr>
<tr><td><code id="rates_+3A_plot.it">plot.it</code></td>
<td>
<p>Logical flag indicating whether to plot the rates or
return them as pixel images.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function <code>probs</code> returns estimates of the declustering probabilities
</p>
<p style="text-align: center;"><code class="reqn">p_j = 1 - \frac{\mu(x_j, y_j)}{lambda(t_j, x_j, y_j|H_{t_j})}</code>
</p>

<p>where <code class="reqn">1-p_j</code> is the probability that event <code class="reqn">j</code>
is a background event.
</p>
<p>The function <code>rates</code> returns kernel estimate of the background
seismicity rate <code class="reqn">\mu(x,y)</code> and the clustering (triggering)
coefficient
</p>
<p style="text-align: center;"><code class="reqn">\omega(x,y)=1-\frac{\mu(x,y)}{\Lambda(x,y)}</code>
</p>

<p>where <code class="reqn">\Lambda(x,y)</code> is the total spatial intensity
function.
</p>
<p>The argument <code>dimyx</code> determines the rectangular discretization
grid dimensions. If it is given, then it must be a numeric vector
of length 2 where the first component <code>dimyx[1]</code> is the
number of subdivisions in the y-direction (latitude) and the
second component <code>dimyx[2]</code> is the number of subdivisions
in the x-direction (longitude). 

</p>


<h3>Value</h3>

<p>If <code>plot.it=TRUE</code>, the function produces plots of the
background seismicity and total spatial rate, clustering coefficient
and conditional intensity function at the end of study period.
</p>
<p>If <code>plot.it=FALSE</code>, it returns a list with components
</p>

<ul>
<li><p><b>bkgd</b> the estimated background siesmicity rate
</p>
</li>
<li><p><b>total</b> the estimated total spatial rate
</p>
</li>
<li><p><b>clust</b> the estimated clustering coefficient
</p>
</li>
<li><p><b>lamb</b> the estimated conditional intensity function at
time <code class="reqn">t=t_{\mathrm{start}}</code>
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Abdollah Jalilian
<a href="mailto:jalilian@razi.ac.ir">jalilian@razi.ac.ir</a>
</p>


<h3>References</h3>

<p>Zhuang J, Ogata Y, Vere-Jones D (2002).
Stochastic Declustering of Space-Time Earthquake Occurrences.
<em>Journal of the American Statistical Association</em>,
<b>97</b>(458), 369&ndash;380.
<a href="https://doi.org/10.1198/016214502760046925">doi:10.1198/016214502760046925</a>.
</p>
<p>Zhuang J, Ogata Y, Vere-Jones D (2006).
Diagnostic Analysis of Space-Time Branching Processes for Earthquakes.
In <em>Case Studies in Spatial Point Process Modeling</em>,
pp. 275&ndash;292. Springer Nature.
<a href="https://doi.org/10.1007/0-387-31144-0_15">doi:10.1007/0-387-31144-0_15</a>.
</p>
<p>Zhuang J (2011).
Next-day Earthquake Forecasts for the Japan Region Generated by
the ETAS Model.
<em>Earth, Planets and Space</em>,
<b>63</b>(3), 207&ndash;216.
<a href="https://doi.org/10.5047/eps.2010.12.010">doi:10.5047/eps.2010.12.010</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+etas">etas</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  # preparing the catalog
  iran.cat &lt;- catalog(iran.quakes, time.begin="1973/01/01",
     study.start="1996/01/01", study.end="2016/01/01",
     lat.range=c(25, 42), long.range=c(42, 63), mag.threshold=4.5)

  print(iran.cat)
  ## Not run: 
  plot(iran.cat)
## End(Not run)

  # initial parameters values
  param01 &lt;- c(0.46, 0.23, 0.022, 2.8, 1.12, 0.012, 2.4, 0.35)

  # fitting the model and
  ## Not run: 
  iran.fit &lt;- etas(iran.cat, param0=param01)
## End(Not run)

  # estimating the declustering probabilities
  ## Not run: 
  pr &lt;- probs(iran.fit)
  plot(iran.cat$longlat.coord[,1:2], cex=2 * (1 - pr$prob))
## End(Not run)

  # estimating the  background seismicity rate and clustering coefficient
  ## Not run: 
  rates(iran.fit, dimyx=c(100, 125))
  iran.rates &lt;- rates(iran.fit, dimyx=c(200, 250), plot.it=FALSE)
  summary(iran.rates$background)
## End(Not run)
</code></pre>

<hr>
<h2 id='resid.etas'>Residuals Analysis and Diagnostics Plots</h2><span id='topic+resid.etas'></span>

<h3>Description</h3>

<p>A function to compute and plot spatial and temporal residuals as well as
transformed times for a fitted ETAS model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>   resid.etas(fit, type="raw", n.temp=1000, dimyx=NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="resid.etas_+3A_fit">fit</code></td>
<td>
<p>A fitted ETAS model. An object of class <code>"etas"</code>.</p>
</td></tr>
<tr><td><code id="resid.etas_+3A_type">type</code></td>
<td>
<p>A character string specifying the type residuals to be
computed. Options are <code>"raw"</code> (the default case), <code>"reciprocal"</code>
and <code>"pearson"</code>.</p>
</td></tr>
<tr><td><code id="resid.etas_+3A_n.temp">n.temp</code></td>
<td>
<p>An integer specifying the number of partition points for
temporal residuals.</p>
</td></tr>
<tr><td><code id="resid.etas_+3A_dimyx">dimyx</code></td>
<td>
<p>Dimensions of the discretization for the smoothed
spatial residuals. A numeric vector of length 2.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function computes the temporal residuals
</p>
<p style="text-align: center;"><code class="reqn">R^{temp}(I_j, h) = \sum_{i=1}^{N} \delta_i 1[t_i \in I_j] h(t_i)
    \lambda^{temp}(t_i|H_{t_i}) - \int_{I_j} h(t)\lambda^{temp}(t|H_t) d t</code>
</p>

<p>for <code class="reqn">I_j=((j-1)T/n.temp, jT/n.temp]</code>, <code class="reqn">j=1,...,n.temp</code>,
and the (smoothed version of) spatial residuals
</p>
<p style="text-align: center;"><code class="reqn">R^{spat}(B_j, h) = h(\tilde{x}_i, \tilde{y}_i)
   \lambda^{spat}(\tilde{x}_i, \tilde{y}_i)(\tilde{\delta}_i - \tilde{w}_i)</code>
</p>

<p>for a Berman-Turner quadrature scheme with quadrature points
<code class="reqn">(\tilde{x}_i, \tilde{y}_i)</code> and quadrature weights <code class="reqn">\tilde{w}_i</code>,
<code class="reqn">i=1,...,n.spat</code>. Raw, reciprocal and Pearson residuals obtain
with <code class="reqn">h=1</code>, <code class="reqn">h=1/\lambda</code> and <code class="reqn">h=1/\sqrt{\lambda}</code>,
respectively.
</p>
<p>In addition, the function computes  transformed times
</p>
<p style="text-align: center;"><code class="reqn">\tau_j=\int_{0}^{t_j} \lambda^{temp}(t|H_t) d t</code>
</p>

<p>and
</p>
<p style="text-align: center;"><code class="reqn">U_j = 1 - \exp(-(t_j - t_{j-1}))</code>
</p>



<h3>Value</h3>

<p>The function produces plots of temporal and smoothed spatial residuals,
transformed times <code class="reqn">\tau_j</code> against <code class="reqn">j</code> and Q-Q plot of <code class="reqn">U_j</code>.
</p>
<p>It also returns a list with components
</p>

<ul>
<li><p><b>tau</b> the transformed times
</p>
</li>
<li><p><b>U</b> related quantities with the transformed times
</p>
</li>
<li><p><b>tres</b> the temporal residuals
</p>
</li>
<li><p><b>sres</b> the smoothed spatial residuals
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Abdollah Jalilian
<a href="mailto:jalilian@razi.ac.ir">jalilian@razi.ac.ir</a>
</p>


<h3>References</h3>

<p>Baddeley A, Rubak E, Turner R (2015).
<em> Spatial Point Patterns: Methodology and Applications with R</em>.
Chapman and Hall/CRC Press, London. <a href="https://www.routledge.com/Spatial-Point-Patterns-Methodology-and-Applications-with-R/Baddeley-Rubak-Turner/p/book/9781482210200">https://www.routledge.com/Spatial-Point-Patterns-Methodology-and-Applications-with-R/Baddeley-Rubak-Turner/p/book/9781482210200</a>.
</p>
<p>Baddeley A, Turner R (2000).
Practical Maximum Pseudolikelihood for Spatial Point Patterns.
<em>Australian &amp; New Zealand Journal of Statistics</em>,
<b>42</b>(3), 283&ndash;322. 
<a href="https://doi.org/10.1111/1467-842X.00128">doi:10.1111/1467-842X.00128</a>.
</p>
<p>Baddeley A, Turner R, Moller J, Hazelton M (2005).
Residual Analysis for Spatial Point Processes.
<em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em>,
<b>67</b>(5), 617&ndash;666. 
<a href="https://doi.org/10.1111/j.1467-9868.2005.00519.x">doi:10.1111/j.1467-9868.2005.00519.x</a>.
</p>
<p>Ogata Y (1988).
Statistical Models for Earthquake Occurrences and Residual Analysis for
Point Processes.
<em>Journal of the American Statistical Association</em>,
<b>83</b>(401), 9&ndash;27. 
<a href="https://doi.org/10.2307/2288914">doi:10.2307/2288914</a>.
</p>
<p>Zhuang J (2006).
Second-order Residual Analysis of Spatiotemporal Point Processes and
Applications in Model Evaluation
<em>Journal of the Royal Statistical Society: Series B (Statistical
Methodology)</em>,
<b>68</b>(4), 635&ndash;653. 
<a href="https://doi.org/10.1111/j.1467-9868.2006.00559.x">doi:10.1111/j.1467-9868.2006.00559.x</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+etas">etas</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  iran.cat &lt;- catalog(iran.quakes, time.begin="1973/01/01",
     study.start="1986/01/01", study.end="2016/01/01",
     lat.range=c(26, 40), long.range=c(44, 63), mag.threshold=5)
  print(iran.cat)
  ## Not run: 
  plot(iran.cat)
## End(Not run)

  # setting initial parameter values
  param0 &lt;- c(0.46, 0.23, 0.022, 2.8, 1.12, 0.012, 2.4, 0.35)

  # fitting the model
  ## Not run: 
  iran.fit &lt;- etas(iran.cat, param0=param0)

  # diagnostic plots
  resid.etas(iran.fit)
## End(Not run)

</code></pre>

<hr>
<h2 id='search.isc'>Retrieving data from the ISC Bulletin</h2><span id='topic+search.isc'></span>

<h3>Description</h3>

<p>Searches the International Seismological Centre (ISC) bulletin 
for recorded eqrthqukes ocurred during a specified time 
period in a specified geographical region (rectangular or circular) 
with a specified magnitude type and magnitude threshould.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  search.isc(start.year=1900, start.month=1, start.day=01,
             end.year=2018, end.month=12, end.day=31,
             searchshape="RECT", lat.bot=NULL, lat.top=NULL,
             long.left=NULL, long.right=NULL, lat.ctr=NULL, 
             long.ctr=NULL, radius=NULL, dist.units="deg", 
             dep.min=0, dep.max=100, nulldep=TRUE,
             mag.min=4, mag.max=NULL, mag.type='MB', 
             mag.agcy=NULL, mirror=TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="search.isc_+3A_start.year">start.year</code></td>
<td>
<p>A single numeric value specifying the start 
year of the time period.</p>
</td></tr>
<tr><td><code id="search.isc_+3A_start.month">start.month</code></td>
<td>
<p>A single numeric value (1 to 12) specifying 
the start month of the time period.</p>
</td></tr>
<tr><td><code id="search.isc_+3A_start.day">start.day</code></td>
<td>
<p>A single numeric value (1 to 31) specifying 
the start day of the time period.</p>
</td></tr> 
<tr><td><code id="search.isc_+3A_end.year">end.year</code></td>
<td>
<p>A single numeric value specifying the end 
year of the time period.</p>
</td></tr>
<tr><td><code id="search.isc_+3A_end.month">end.month</code></td>
<td>
<p>A single numeric value (1 to 12) specifying 
the end month of the time period.</p>
</td></tr>
<tr><td><code id="search.isc_+3A_end.day">end.day</code></td>
<td>
<p>A single numeric value (1 to 31) specifying 
the end day of the time period.</p>
</td></tr> 
<tr><td><code id="search.isc_+3A_searchshape">searchshape</code></td>
<td>
<p>A character string specifying the shape of
the search region. Rectangular search with 
<code>searchshape="RECT"</code> (default) and circular search 
<code>searchshape="CIRC"</code> are possible.</p>
</td></tr>
<tr><td><code id="search.isc_+3A_lat.bot">lat.bot</code></td>
<td>
<p>A single numeric value (-90 to 90) specifying 
the bottom latitude of the rectangular search region 
(if <code>searchshape="RECT"</code>).</p>
</td></tr>
<tr><td><code id="search.isc_+3A_lat.top">lat.top</code></td>
<td>
<p>A single numeric value (-90 to 90) specifying 
the top latitude of the rectangular search region
(if <code>searchshape="RECT"</code>).</p>
</td></tr>
<tr><td><code id="search.isc_+3A_long.left">long.left</code></td>
<td>
<p>A single numeric value (-180 to 180) specifying 
the left longitude of the rectangular search region
(if <code>searchshape="RECT"</code>).</p>
</td></tr>
<tr><td><code id="search.isc_+3A_long.right">long.right</code></td>
<td>
<p>A single numeric value (-180 to 180) specifying 
the right longitude of the rectangular search region
(if <code>searchshape="RECT"</code>).</p>
</td></tr>
<tr><td><code id="search.isc_+3A_lat.ctr">lat.ctr</code></td>
<td>
<p>A single numeric value (-90 to 90) specifying 
the central latitude of the circular search region
(if <code>searchshape="CIRC"</code>).</p>
</td></tr>
<tr><td><code id="search.isc_+3A_long.ctr">long.ctr</code></td>
<td>
<p>A single numeric value (-180 to 180) specifying 
the central longitude of the circular search region
(if <code>searchshape="CIRC"</code>).</p>
</td></tr>
<tr><td><code id="search.isc_+3A_radius">radius</code></td>
<td>
<p>A single numeric value specifying the search radius
of the circular search region
(if <code>searchshape="CIRC"</code>).</p>
</td></tr>
<tr><td><code id="search.isc_+3A_dist.units">dist.units</code></td>
<td>
<p>A character string specifying the unit of
the search radius: degrees with <code>"deg"</code> and kilometers 
with <code>"km"</code> are the available options.</p>
</td></tr>
<tr><td><code id="search.isc_+3A_dep.min">dep.min</code></td>
<td>
<p>A single numeric value specifying the minumum 
depth (km).</p>
</td></tr>  
<tr><td><code id="search.isc_+3A_dep.max">dep.max</code></td>
<td>
<p>A single numeric value specifying the maximum 
depth (km).</p>
</td></tr>
<tr><td><code id="search.isc_+3A_nulldep">nulldep</code></td>
<td>
<p>Logical flag indicating whether to include 
events with unknown depths.</p>
</td></tr>
<tr><td><code id="search.isc_+3A_mag.min">mag.min</code></td>
<td>
<p>A single numeric value specifying the minumum 
magnitude.</p>
</td></tr>
<tr><td><code id="search.isc_+3A_mag.max">mag.max</code></td>
<td>
<p>A single numeric value specifying the maximum 
magnitude.</p>
</td></tr>
<tr><td><code id="search.isc_+3A_mag.type">mag.type</code></td>
<td>
<p>A character string specifying the magnitude 
type. Due to the large number of magnitude types and the 
various notation used, the selected type will search all 
magnitudes of that type. E.g. the default <code>"MB"</code> will 
match all body-wave magnitudes: mb, mB, MB, mb1mx, etc.</p>
</td></tr>
<tr><td><code id="search.isc_+3A_mag.agcy">mag.agcy</code></td>
<td>
<p>A character string specifying the magnitude 
author.  <code>"ISC"</code>, <code>"NEIC"</code>, <code>"GCMT/HRVD"</code>, 
<code>"JMA"</code>, amongst others are considered reliable magnitude
authors. The default uses <code>"Any"</code>, which will match any 
author that has a magnitude for both prime and secondary 
hypocentres included in an event. Selecting 
<code>"prime author"</code> will limit the search by magnitudes 
directly associated with the prime hypocentre (usually the 
same author as the prime hypocentre) - i.e. for events with 
an ISC authored prime hypocentre, selecting 'Prime author', 
will limit events to those with ISC determined magnitudes.</p>
</td></tr>
<tr><td><code id="search.isc_+3A_mirror">mirror</code></td>
<td>
<p>Logical flag indicating whether to use the ISC 
mirror server hosted at IRIS DMC (<a href="http://isc-mirror.iris.washington.edu">http://isc-mirror.iris.washington.edu</a>) as it may be faster.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Any use of data from the ISC by academic or commercial 
organisations, as well as individuals should always be cited. 
The correct format for citations may be found on 
<a href="http://www.isc.ac.uk/citations/">http://www.isc.ac.uk/citations/</a>.
</p>
<p>The ISC is named as a valid data centre for citations within 
American Geophysical Union (AGU) publications. As such, please 
follow the AGU guidelines when referencing ISC data in one of 
their journals. The ISC may be cited as both the institutional 
author of the Bulletin and the source from which the data 
were retrieved. 
</p>


<h3>Value</h3>

<p>An object of class <code>"data.frame"</code> which can be passed to 
the <code>"catalog"</code> function in order to create an earthquake
catalog dataset.
</p>


<h3>Author(s)</h3>

<p>Abdollah Jalilian
<a href="mailto:jalilian@razi.ac.ir">jalilian@razi.ac.ir</a>
</p>


<h3>References</h3>

<p>International Seismological Centre (2015). 
<em>On-line Bulletin</em>, 
<a href="http://www.isc.ac.uk">http://www.isc.ac.uk</a>, 
Internatl. Seismol. Cent., 
Thatcham, United Kingdom.
</p>
<p>International Seismological Centre (2015). 
<em>Reference Event Bulletin</em>, 
<a href="http://www.isc.ac.uk">http://www.isc.ac.uk</a>, 
Internatl. Seismol. Cent., 
Thatcham, United Kingdom.
</p>
<p>International Seismological Centre (2015). 
<em>EHB Bulletin</em>, 
<a href="http://www.isc.ac.uk">http://www.isc.ac.uk</a>, 
Internatl. Seismol. Cent., 
Thatcham, United Kingdom.
</p>


<h3>See Also</h3>

<p><code>catalog</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  
  # rectangular search
  ## Not run: 
  mydata &lt;- search.isc(start.year=1980, start.month=1, start.day=01,
                   end.year=2017, end.month=11, end.day=11, 
                   lat.bot=33, lat.top=37,
                   long.left=44, long.right=48,
                   mag.min=3.5, mag.type='MB')  
  mycatalog &lt;- catalog(mydata, study.start = "1990-01-01")
  plot(mycatalog)
  
## End(Not run)
  # circular search
  ## Not run: 
  mydata2 &lt;- search.isc(start.year=2017, start.month=11, start.day=12,
                   end.year=2018, end.month=3, end.day=01,
                   searchshape="CIRC", 
                   lat.ctr=34.905, long.ctr=45.956,
                   radius=150, dist.units="km",
                   mag.min=3.5, mag.type='ML') 
  mycatalog2 &lt;- catalog(mydata2)
  plot(mycatalog2)
  
## End(Not run)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
