<!DOCTYPE html><html><head><title>Help for package ragtop</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ragtop}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ragtop'><p>Pricing schemes for derivatives using equity-linked default intensity</p></a></li>
<li><a href='#accelerated_coupon_value'><p>Present value of coupons according to an acceleration schedule</p></a></li>
<li><a href='#adjust_for_dividends'><p>Find the sum of time-adjusted dividend values and adjust grid prices according</p>
to their size in the given interval</a></li>
<li><a href='#american'><p>Price one or more american-exercise options</p></a></li>
<li><a href='#american_implied_volatility'><p>Implied volatility of an american option with equity-independent term structures</p></a></li>
<li><a href='#AmericanOption-class'><p>A standard option contract allowing for <em>early</em> exercise at the choice of the option holder</p></a></li>
<li><a href='#black_scholes_on_term_structures'><p>Black-Scholes pricing of european-exercise options with term structure arguments</p></a></li>
<li><a href='#blackscholes'><p>Vectorized Black-Scholes pricing of european-exercise options</p></a></li>
<li><a href='#CALL'><p>Constant CALL for defining option contracts</p></a></li>
<li><a href='#CallableBond-class'><p>Callable (and putable) corporate or government bond.</p></a></li>
<li><a href='#construct_implicit_grid_structure'><p>Structure of implicit numerical integration grid</p></a></li>
<li><a href='#construct_tridiagonals'><p>Matrix entries for implicit numerical differentiation using Neumann boundary conditions</p></a></li>
<li><a href='#control_variate_pairs'><p>Form instrument objects for vanilla options</p></a></li>
<li><a href='#ConvertibleBond-class'><p>Convertible bond with exercise into stock</p></a></li>
<li><a href='#coupon_value_at_exercise'><p>Present value of coupons according to an acceleration schedule</p></a></li>
<li><a href='#CouponBond-class'><p>Standard corporate or government bond</p></a></li>
<li><a href='#detail_from_AnnivDates'><p>Convert output of BondValuation::AnnivDates to inputd for Bond</p></a></li>
<li><a href='#EquityOption-class'><p>An option contract with call or put terms</p></a></li>
<li><a href='#equivalent_bs_vola_to_jump'><p>Find straight Black-Scholes volatility equivalent to jump process with a given default risk</p></a></li>
<li><a href='#equivalent_jump_vola_to_bs'><p>Find jump process volatility with a given default risk from a straight Black-Scholes volatility</p></a></li>
<li><a href='#EuropeanOption-class'><p>A standard option contract</p></a></li>
<li><a href='#find_present_value'><p>Use a model to estimate the present value of financial derivatives</p></a></li>
<li><a href='#fit_to_option_market'><p>Calibrate volatilities and equity-linked default intensity</p></a></li>
<li><a href='#fit_to_option_market_df'><p>Calibrate volatilities and equity-linked default intensity making many assumptions</p></a></li>
<li><a href='#fit_variance_cumulation'><p>Fit piecewise constant volatilities to a set of equity options</p></a></li>
<li><a href='#form_present_value_grid'><p>Use a model to estimate the present value of financial derivatives on a grid of initial underlying values</p></a></li>
<li><a href='#GridPricedInstrument-class'><p>Representation of financial instrument amenable to grid pricing schemes</p></a></li>
<li><a href='#implied_jump_process_volatility'><p>Implied volatility of any instrument</p></a></li>
<li><a href='#implied_volatilities'><p>Implied volatilities of european-exercise options under Black-Scholes or a jump-process extension</p></a></li>
<li><a href='#implied_volatilities_with_rates_struct'><p>Find the implied volatility of european-exercise options with a term structure of interest rates</p></a></li>
<li><a href='#implied_volatility'><p>Implied volatility of european-exercise option under Black-Scholes or a jump-process extension</p></a></li>
<li><a href='#implied_volatility_with_term_struct'><p>Find the implied volatility of a european-exercise option with term structures</p></a></li>
<li><a href='#infer_conforming_time_grid'><p>A time grid with extra times inserted for coupons, calls and puts</p></a></li>
<li><a href='#integrate_pde'><p>Numerically integrate the pricing differential equation</p></a></li>
<li><a href='#is.blank'><p>Return TRUE if the argument is empty, NULL or NA</p></a></li>
<li><a href='#iterate_grid_from_timestep'><p>Iterate over a set of timesteps to integrate the pricing differential equation</p></a></li>
<li><a href='#penalty_with_intensity_link'><p>Helper function (volatility-normalized pricing error) for calibration of equity-linked default intensity</p></a></li>
<li><a href='#price_with_intensity_link'><p>Helper function (instrument pricing) for calibration of equity-linked default intensity</p></a></li>
<li><a href='#PUT'><p>Constant PUT for defining option contracts</p></a></li>
<li><a href='#Quandl_df_fcn_UST'><p>Get a US Treasury curve discount factor function</p></a></li>
<li><a href='#Quandl_df_fcn_UST_raw'><p>Get a US Treasury curve discount factor function</p></a></li>
<li><a href='#shift_for_dividends'><p>Shift a set of grid values for dividends paid, using spline interpolation</p></a></li>
<li><a href='#spot_to_df_fcn'><p>Create a discount factor function from a yield curve</p></a></li>
<li><a href='#take_implicit_timestep'><p>Backwardate grid values one timestep</p></a></li>
<li><a href='#time_adj_dividends'><p>Find the sum of time-adjusted dividend values</p></a></li>
<li><a href='#TIME_RESOLUTION_FACTOR'><p>Constant to define when times are considered so close to each other</p>
that they should be treated as simultaneous</a></li>
<li><a href='#TIME_RESOLUTION_SIGNIF_DIGITS'><p>Constant to define when times are considered so close to each other</p>
that they should be treated as simultaneous, in terms of significant
digits</a></li>
<li><a href='#timestep_instruments'><p>Take an implicit timestep for all the given instruments</p></a></li>
<li><a href='#TSLAMarket'><p>Market information snapshot for TSLA options</p></a></li>
<li><a href='#value_from_prior_coupons'><p>Present value of past coupons paid</p></a></li>
<li><a href='#variance_cumulation_from_vols'><p>Create a variance cumulation function from a volatility term structure</p></a></li>
<li><a href='#ZeroCouponBond-class'><p>A simple contract paying the <code>notional</code> amount at the <code>maturity</code></p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Pricing Equity Derivatives with Extensions of Black-Scholes</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2020-02-29</td>
</tr>
<tr>
<td>Author:</td>
<td>Brian K. Boonstra</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Brian K. Boonstra &lt;ragtop@boonstra.org&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Algorithms to price American and European
    equity options, convertible bonds and a
    variety of other financial derivatives. It uses an
    extension of the usual Black-Scholes model in which
    jump to default may occur at a probability specified
    by a power-law link between stock price and hazard
    rate as found in the paper by Takahashi, Kobayashi,
    and Nakagawa (2001) &lt;<a href="https://doi.org/10.3905%2Fjfi.2001.319302">doi:10.3905/jfi.2001.319302</a>&gt;.  We
    use ideas and techniques from Andersen and
    Buffum (2002) &lt;<a href="https://doi.org/10.2139%2Fssrn.355308">doi:10.2139/ssrn.355308</a>&gt; and
    Linetsky (2006) &lt;<a href="https://doi.org/10.1111%2Fj.1467-9965.2006.00271.x">doi:10.1111/j.1467-9965.2006.00271.x</a>&gt;.</td>
</tr>
<tr>
<td>Depends:</td>
<td>limSolve (&ge; 1.5.5.1), futile.logger (&ge; 1.4.1), R (&ge; 2.10),
methods (&ge; 3.2.2)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, roxygen2, knitr, rmarkdown, reshape2, stringr,
ggplot2, MASS, RColorBrewer, BondValuation, R.cache, Quandl</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>TRUE</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.0.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-03-03 03:48:55 UTC; brian</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-03-03 09:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='ragtop'>Pricing schemes for derivatives using equity-linked default intensity</h2><span id='topic+ragtop'></span><span id='topic+ragtop-package'></span>

<h3>Description</h3>

<p>Using numerical integration, we price convertible bonds, straight
bonds, equity options and various other derivatives consistently using a
jump-diffusion model in which default intensity can vary with equity price
in a user-specified deterministic manner.
</p>


<h3>Details</h3>

<p>We apply the stochastic model
</p>
<p style="text-align: center;"><code class="reqn">dS/S=(r+h-q) dt + \sigma dZ - dJ</code>
</p>

<p>where <code class="reqn">r</code> and <code class="reqn">q</code> play their usual roles, <code class="reqn">h</code> is a
deterministic function of stock price and time, and <code class="reqn">J</code>
is a Poisson jump process adapted to the <em>default intensity</em>
or <em>hazard rate</em> <code class="reqn">h</code>.  This model is a <em>jump-diffusion</em>
extension of Black-Scholes, with the jump process <em>J</em> representing
default, compensated by extra drift in the equity at rate <code class="reqn">h</code>.
</p>
<p>Volatilities, default intensities and risk-free rates may all be represented
with arbitrary term structures.  Default intensity term structures may also
take the underlying equity price into account.
</p>
<p>Pricing in the standard Black-Scholes model is a special case with default
intensity set to zero.  Therefore this package <em>also</em> serves to price securities
in the standard Black-Scholes model, while still allowing risk-free rates and volatilites
have nontrivial term structures.
</p>


<h3>Important Features</h3>


<ul>
<li><p><em>Black-Scholes</em>: The standard model is automatically supported as a special case, but also has optimized routines
</p>
</li>
<li><p><em>Term Structures</em>: The package allows for any kind of instrument to be priced with time-varying rates, volatility and default intensity
</p>
</li>
<li><p><em>Dividends</em>: Allows for discrete dividends in an arbitrary combination of fixed and proportional amounts.  The difference between fixed and proprtional can be up to 10 percent in implied volatility terms.
</p>
</li>
<li><p><em>Calibration</em>: Model calibration routines are included
</p>
</li>
<li><p><em>Bankruptcy Realism</em>: A parsimonious deterministic model of default intensity gives rich behavior and conforms reasonably well to observed market data
</p>
</li>
<li><p><em>Algorithm Parameters</em>: Default parameters for the algorithm work well for a very wide variety of pricing and implied volatility scenarios
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Vanilla European exercise
blackscholes(callput=-1, S0=100, K=90, r=0.03, time=1, vola=0.5)
blackscholes(PUT, S0=100, K=90, r=0.03, time=1, vola=0.5,
             default_intensity=0.07, borrow_cost=0.005)
## With a term structure of volatility
## Not run: 
black_scholes_on_term_structures(callput=-1, S0=100, K=90, time=1,
                                 const_short_rate=0.025,
                                 variance_cumulation_fcn = function(T, t) {
                                   0.45 ^ 2 * (T - t) + 0.15^2 * max(0, T-0.25)
                                 })

## End(Not run)

## Vanilla American exercise
## Not run: 
american(PUT, S0=100, K=110, time=0.77, const_short_rate = 0.06,
         const_volatility=0.20, num_time_steps=200)

## End(Not run)
## With a term structure of volatility
## Not run: 
american(callput=-1, S0=100, K=90, time=1, const_short_rate=0.025,
         variance_cumulation_fcn = function(T, t) {
             0.45 ^ 2 * (T - t) + 0.15^2 * max(0, T-0.25)
         })

## End(Not run)
## With discrete dividends, combined fixed and proportional
divs = data.frame(time=seq(from=0.11, to=2, by=0.25),
                  fixed=seq(1.5, 1, length.out=8),
                  proportional = seq(1, 1.5, length.out=8))
## Not run: 
american(callput=-1, S0=100, K=90, time=1, const_short_rate=0.025,
         const_volatility=0.20, dividends=divs)

## End(Not run)

## American Exercise Implied Volatility
american_implied_volatility(25,CALL,S0=100,K=100,time=2.2, const_short_rate=0.03)
df250 =  function(t) ( exp(-0.02*t)*exp(-0.03*max(0,t-1.0))) # Simple term structure
df25 = function(T,t){df250(T)/df250(t)} # Relative discount factors
## Not run: 
american_implied_volatility(25,-1,100,100,2.2,discount_factor_fcn=df25)

## End(Not run)

## Convertible Bond
## Not Run
pct4 = function(T,t=0) { exp(-0.04*(T-t)) }
cb = ConvertibleBond(conversion_ratio=3.5, maturity=1.5, notional=100,
                     discount_factor_fcn=pct4, name='Convertible')
S0 = 10; p = 6.0; h = 0.10
h_fcn = function(t, S, ...){0.9 * h + 0.1 * h * (S0/S)^p }  # Intensity linked to equity price
## Not run: 
find_present_value(S0=S0, instruments=list(Convertible=cb), num_time_steps=250,
                   default_intensity_fcn=h_fcn,
                   const_volatility = 0.4, discount_factor_fcn=pct4,
                   std_devs_width=5)

## End(Not run)

## Fitting Term Structure of Volatility
## Not Run
opts = list(m1=AmericanOption(callput=-1, strike=9.9, maturity=1/12, name="m1"),
            m2=AmericanOption(callput=-1, strike=9.8, maturity=1/6, name="m2"))
## Not run: 
vfit = fit_variance_cumulation(S0, opts, c(0.6, 0.8), default_intensity_fcn=h_fcn)
print(vfit$volatilities)

## End(Not run)

</code></pre>

<hr>
<h2 id='accelerated_coupon_value'>Present value of coupons according to an acceleration schedule</h2><span id='topic+accelerated_coupon_value'></span>

<h3>Description</h3>

<p>Compute &quot;present&quot; value as of time t for coupons that
would otherwise have been paid up to time acceleration_t, in the
case of accelerated coupon provisions for forced conversions (or
sometimes even unforced ones).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>accelerated_coupon_value(
  t,
  coupons_df,
  discount_factor_fcn,
  acceleration_t = Inf
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="accelerated_coupon_value_+3A_t">t</code></td>
<td>
<p>The time toward which all coupons should be present valued</p>
</td></tr>
<tr><td><code id="accelerated_coupon_value_+3A_coupons_df">coupons_df</code></td>
<td>
<p>A data.frame of details for each coupon.  It should have the
columns <code>payment_time</code> and <code>payment_size</code>.</p>
</td></tr>
<tr><td><code id="accelerated_coupon_value_+3A_discount_factor_fcn">discount_factor_fcn</code></td>
<td>
<p>A function specifying how the contract says future coupons should be discounted for this instrument in case the acceleration clause is triggered</p>
</td></tr>
<tr><td><code id="accelerated_coupon_value_+3A_acceleration_t">acceleration_t</code></td>
<td>
<p>Time limit, up to which coupons will be accelerated</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other Bond Coupons: 
<code><a href="#topic+coupon_value_at_exercise">coupon_value_at_exercise</a>()</code>,
<code><a href="#topic+value_from_prior_coupons">value_from_prior_coupons</a>()</code>
</p>
<p>Other Bond Coupon Acceleration: 
<code><a href="#topic+coupon_value_at_exercise">coupon_value_at_exercise</a>()</code>
</p>

<hr>
<h2 id='adjust_for_dividends'>Find the sum of time-adjusted dividend values and adjust grid prices according
to their size in the given interval</h2><span id='topic+adjust_for_dividends'></span>

<h3>Description</h3>

<p>Analyze <code>dividends</code> to find ones paid in the interval <code>(t,t+dt]</code>. Form
present value as of time <code>t</code> for them, and then use spline interpolation
to adjust instrument values accordingly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>adjust_for_dividends(grid_values, t, dt, r, h, S, S0, dividends)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="adjust_for_dividends_+3A_grid_values">grid_values</code></td>
<td>
<p>A <code>matrix</code> with one row for each level of <code>S</code> and one
column per set of <code>S</code>-associated instrument values</p>
</td></tr>
<tr><td><code id="adjust_for_dividends_+3A_t">t</code></td>
<td>
<p>Time after this timestep has been taken</p>
</td></tr>
<tr><td><code id="adjust_for_dividends_+3A_dt">dt</code></td>
<td>
<p>Interval to end of timestep</p>
</td></tr>
<tr><td><code id="adjust_for_dividends_+3A_r">r</code></td>
<td>
<p>risk-free interest rate</p>
</td></tr>
<tr><td><code id="adjust_for_dividends_+3A_h">h</code></td>
<td>
<p>Default intensities</p>
</td></tr>
<tr><td><code id="adjust_for_dividends_+3A_s">S</code></td>
<td>
<p>Underlying equity values for the grid</p>
</td></tr>
<tr><td><code id="adjust_for_dividends_+3A_s0">S0</code></td>
<td>
<p>Time zero price of the base equity</p>
</td></tr>
<tr><td><code id="adjust_for_dividends_+3A_dividends">dividends</code></td>
<td>
<p>A <code>data.frame</code> with columns <code>time</code>, <code>fixed</code>,
and <code>proportional</code>.  Dividend size at the given <code>time</code> is
then expected to be equal to <code>fixed + proportional * S / S0</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object like <code>grid_values</code> with entries modified according to the dividends
</p>


<h3>See Also</h3>

<p>Other Dividends: 
<code><a href="#topic+shift_for_dividends">shift_for_dividends</a>()</code>,
<code><a href="#topic+time_adj_dividends">time_adj_dividends</a>()</code>
</p>

<hr>
<h2 id='american'>Price one or more american-exercise options</h2><span id='topic+american'></span>

<h3>Description</h3>

<p>Use a control-variate scheme to simultaneously estimate the present
values of a collection of one or more American-exercise options under
a default model with survival probabilities not linked to equity prices.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>american(
  callput,
  S0,
  K,
  time,
  const_short_rate = 0,
  const_default_intensity = 0,
  discount_factor_fcn = function(T, t, ...) {     exp(-const_short_rate * (T - t)) },
  survival_probability_fcn = function(T, t, ...) {     exp(-const_default_intensity * (T
    - t)) },
  default_intensity_fcn = function(t, S, ...) {     const_default_intensity + 0 * S },
  ...,
  num_time_steps = 100,
  structure_constant = 2,
  std_devs_width = 5
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="american_+3A_callput">callput</code></td>
<td>
<p>1 for calls, -1 for puts (may be a vector of the same)</p>
</td></tr>
<tr><td><code id="american_+3A_s0">S0</code></td>
<td>
<p>initial underlying price</p>
</td></tr>
<tr><td><code id="american_+3A_k">K</code></td>
<td>
<p>strike (may be a vector)</p>
</td></tr>
<tr><td><code id="american_+3A_time">time</code></td>
<td>
<p>Time from <code>0</code> until expiration (may be a vector)</p>
</td></tr>
<tr><td><code id="american_+3A_const_short_rate">const_short_rate</code></td>
<td>
<p>A constant to use for the instantaneous interest rate in case <code>discount_factor_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="american_+3A_const_default_intensity">const_default_intensity</code></td>
<td>
<p>A constant to use for the instantaneous default intensity in case <code>default_intensity_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="american_+3A_discount_factor_fcn">discount_factor_fcn</code></td>
<td>
<p>A function for computing present values to
time <code>t</code> of various cashflows occurring during this timestep, with
arguments <code>T</code>, <code>t</code></p>
</td></tr>
<tr><td><code id="american_+3A_survival_probability_fcn">survival_probability_fcn</code></td>
<td>
<p>(Implied argument) A function for probability of survival, with
arguments <code>T</code>, <code>t</code> and <code>T&gt;t</code>.  E.g. with
a constant volatility <code class="reqn">s</code> this takes the form <code class="reqn">(T-t)s^2</code>. Should be matched to <code>default_intensity_fcn</code></p>
</td></tr>
<tr><td><code id="american_+3A_default_intensity_fcn">default_intensity_fcn</code></td>
<td>
<p>A function for computing default intensity
occurring at a given time, dependent on time and stock price, with
arguments <code>t</code>, <code>S</code>.  Should be matched to <code>survival_probability_fcn</code></p>
</td></tr>
<tr><td><code id="american_+3A_...">...</code></td>
<td>
<p>Further arguments passed on to <code><a href="#topic+find_present_value">find_present_value</a></code></p>
</td></tr>
<tr><td><code id="american_+3A_num_time_steps">num_time_steps</code></td>
<td>
<p>Number of steps to use in the grid solver.  Can usually be
set quite low due to the control variate scheme.</p>
</td></tr>
<tr><td><code id="american_+3A_structure_constant">structure_constant</code></td>
<td>
<p>The maximum ratio between time intervals <code>dt</code>
and the square of space intervals <code>dz^2</code></p>
</td></tr>
<tr><td><code id="american_+3A_std_devs_width">std_devs_width</code></td>
<td>
<p>The number of standard deviations, in <code>sigma * sqrt(T)</code>
units, to incorporate into the grid</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The scheme
uses find_present_value() to price the options and their European-exercise
equivalents.  It then compares the latter to black-scholes formula output
and uses the results as an error correction on the prices of the
American-exercise options.
</p>


<h3>Value</h3>

<p>A vector of estimated option present values
</p>


<h3>See Also</h3>

<p>Other Equity Independent Default Intensity: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+black_scholes_on_term_structures">black_scholes_on_term_structures</a>()</code>,
<code><a href="#topic+blackscholes">blackscholes</a>()</code>,
<code><a href="#topic+equivalent_bs_vola_to_jump">equivalent_bs_vola_to_jump</a>()</code>,
<code><a href="#topic+equivalent_jump_vola_to_bs">equivalent_jump_vola_to_bs</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>
<p>Other American Exercise Equity Options: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+control_variate_pairs">control_variate_pairs</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>american(PUT, S0=100, K=110, time=0.77, const_short_rate = 0.06,
         const_volatility=0.20, num_time_steps=200)
american(callput=-1, S0=100, K=90, time=1, const_short_rate=0.025,
         variance_cumulation_fcn = function(T, t) {  # Term structure of vola
             0.45 ^ 2 * (T - t) + 0.15^2 * max(0, T-0.25)
         })
</code></pre>

<hr>
<h2 id='american_implied_volatility'>Implied volatility of an american option with equity-independent term structures</h2><span id='topic+american_implied_volatility'></span>

<h3>Description</h3>

<p>Use the grid solver to generate american option values under
a default model with survival probabilities not linked to equity prices. and run them
through a bisective root search method until a constant volatility matching the provided
option price has been found.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>american_implied_volatility(
  option_price,
  callput,
  S0,
  K,
  time,
  const_default_intensity = 0,
  survival_probability_fcn = function(T, t, ...) {     exp(-const_default_intensity * (T
    - t)) },
  default_intensity_fcn = function(t, S, ...) {     const_default_intensity + 0 * S },
  ...,
  num_time_steps = 30,
  structure_constant = 2,
  std_devs_width = 5,
  relative_tolerance = 1e-04,
  max.iter = 100,
  max_vola = 4
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="american_implied_volatility_+3A_option_price">option_price</code></td>
<td>
<p>Option price to match</p>
</td></tr>
<tr><td><code id="american_implied_volatility_+3A_callput">callput</code></td>
<td>
<p>1 for calls, -1 for puts</p>
</td></tr>
<tr><td><code id="american_implied_volatility_+3A_s0">S0</code></td>
<td>
<p>An initial stock price, for setting grid scale</p>
</td></tr>
<tr><td><code id="american_implied_volatility_+3A_k">K</code></td>
<td>
<p>strike</p>
</td></tr>
<tr><td><code id="american_implied_volatility_+3A_time">time</code></td>
<td>
<p>Time from <code>0</code> until expiration</p>
</td></tr>
<tr><td><code id="american_implied_volatility_+3A_const_default_intensity">const_default_intensity</code></td>
<td>
<p>A constant to use for the instantaneous default intensity in case <code>default_intensity_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="american_implied_volatility_+3A_survival_probability_fcn">survival_probability_fcn</code></td>
<td>
<p>(Implied argument) A function for probability of survival, with
arguments <code>T</code>, <code>t</code> and <code>T&gt;t</code>.</p>
</td></tr>
<tr><td><code id="american_implied_volatility_+3A_default_intensity_fcn">default_intensity_fcn</code></td>
<td>
<p>A function for computing default intensity
occurring at a given time, dependent on time and stock price, with
arguments <code>t</code>, <code>S</code>.  Should be matched to <code>survival_probability_fcn</code></p>
</td></tr>
<tr><td><code id="american_implied_volatility_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed on to <code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a></code>
and <code><a href="#topic+american">american</a></code></p>
</td></tr>
<tr><td><code id="american_implied_volatility_+3A_num_time_steps">num_time_steps</code></td>
<td>
<p>Minimum number of time steps in the grid</p>
</td></tr>
<tr><td><code id="american_implied_volatility_+3A_structure_constant">structure_constant</code></td>
<td>
<p>The maximum ratio between time intervals <code>dt</code>
and the square of space intervals <code>dz^2</code></p>
</td></tr>
<tr><td><code id="american_implied_volatility_+3A_std_devs_width">std_devs_width</code></td>
<td>
<p>The number of standard deviations, in <code>sigma * sqrt(T)</code>
units, to incorporate into the grid</p>
</td></tr>
<tr><td><code id="american_implied_volatility_+3A_relative_tolerance">relative_tolerance</code></td>
<td>
<p>Relative tolerance in instrument price defining the root-finder halting condition</p>
</td></tr>
<tr><td><code id="american_implied_volatility_+3A_max.iter">max.iter</code></td>
<td>
<p>Maximum number of root-finder iterations allowed</p>
</td></tr>
<tr><td><code id="american_implied_volatility_+3A_max_vola">max_vola</code></td>
<td>
<p>Maximum volatility to try</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Estimated volatility
</p>


<h3>See Also</h3>

<p><code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a></code> for implied volatility
of European options under the same conditions, <code><a href="#topic+american">american</a></code> for the
underlying pricing algorithm
</p>
<p>Other Implied Volatilities: 
<code><a href="#topic+equivalent_bs_vola_to_jump">equivalent_bs_vola_to_jump</a>()</code>,
<code><a href="#topic+equivalent_jump_vola_to_bs">equivalent_jump_vola_to_bs</a>()</code>,
<code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a>()</code>,
<code><a href="#topic+implied_jump_process_volatility">implied_jump_process_volatility</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>
<p>Other Equity Independent Default Intensity: 
<code><a href="#topic+american">american</a>()</code>,
<code><a href="#topic+black_scholes_on_term_structures">black_scholes_on_term_structures</a>()</code>,
<code><a href="#topic+blackscholes">blackscholes</a>()</code>,
<code><a href="#topic+equivalent_bs_vola_to_jump">equivalent_bs_vola_to_jump</a>()</code>,
<code><a href="#topic+equivalent_jump_vola_to_bs">equivalent_jump_vola_to_bs</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>
<p>Other American Exercise Equity Options: 
<code><a href="#topic+american">american</a>()</code>,
<code><a href="#topic+control_variate_pairs">control_variate_pairs</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>american_implied_volatility(25,CALL,S0=100,K=100,time=2.2,
  const_short_rate=0.03, num_time_steps=5)
df250 =  function(t) ( exp(-0.02*t)*exp(-0.03*max(0,t-1.0))) # Simple term structure
df25 = function(T,t){df250(T)/df250(t)} # Relative discount factors
american_implied_volatility(25,-1,100,100,2.2,
  discount_factor_fcn=df25, num_time_steps=5)
</code></pre>

<hr>
<h2 id='AmericanOption-class'>A standard option contract allowing for <em>early</em> exercise at the choice of the option holder</h2><span id='topic+AmericanOption-class'></span><span id='topic+AmericanOption'></span>

<h3>Description</h3>

<p>A standard option contract allowing for <em>early</em> exercise at the choice of the option holder
</p>


<h3>Methods</h3>


<dl>
<dt><code>optionality_fcn(v, ...)</code></dt><dd><p>Return a version of v at time t corrected for any optionality conditions.</p>
</dd>
<dt><code>recovery_fcn(v, S, t, ...)</code></dt><dd><p>Return recovery value, given non-default values v at time t.  Subclasses may be more elaborate, this method simply returns 0.0.</p>
</dd>
</dl>

<hr>
<h2 id='black_scholes_on_term_structures'>Black-Scholes pricing of european-exercise options with term structure arguments</h2><span id='topic+black_scholes_on_term_structures'></span>

<h3>Description</h3>

<p>Price an option according to the famous Black-Scholes formula, with the
optional addition of a jump-to-default intensity and discrete dividends.  Volatility
and rates may be provided as constants or as 2+ parameter functions with
first argument <code>T</code> corresponding to maturity and second argument <code>t</code> corresponding to
model date.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>black_scholes_on_term_structures(
  callput,
  S0,
  K,
  time,
  const_volatility = 0.5,
  const_short_rate = 0,
  const_default_intensity = 0,
  discount_factor_fcn = function(T, t, ...) {     exp(-const_short_rate * (T - t)) },
  survival_probability_fcn = function(T, t, ...) {     exp(-const_default_intensity * (T
    - t)) },
  variance_cumulation_fcn = function(T, t) {     const_volatility^2 * (T - t) },
  dividends = NULL,
  borrow_cost = 0,
  dividend_rate = 0
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="black_scholes_on_term_structures_+3A_callput">callput</code></td>
<td>
<p>1 for calls, -1 for puts</p>
</td></tr>
<tr><td><code id="black_scholes_on_term_structures_+3A_s0">S0</code></td>
<td>
<p>initial underlying price</p>
</td></tr>
<tr><td><code id="black_scholes_on_term_structures_+3A_k">K</code></td>
<td>
<p>strike</p>
</td></tr>
<tr><td><code id="black_scholes_on_term_structures_+3A_time">time</code></td>
<td>
<p>Time from <code>0</code> until expiration</p>
</td></tr>
<tr><td><code id="black_scholes_on_term_structures_+3A_const_volatility">const_volatility</code></td>
<td>
<p>A constant to use for volatility in case <code>variance_cumulation_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="black_scholes_on_term_structures_+3A_const_short_rate">const_short_rate</code></td>
<td>
<p>A constant to use for the instantaneous interest rate in case <code>discount_factor_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="black_scholes_on_term_structures_+3A_const_default_intensity">const_default_intensity</code></td>
<td>
<p>A constant to use for the instantaneous default intensity in case <code>default_intensity_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="black_scholes_on_term_structures_+3A_discount_factor_fcn">discount_factor_fcn</code></td>
<td>
<p>A function for computing present values to
time <code>t</code> of various cashflows occurring during this timestep, with
arguments <code>T</code>, <code>t</code></p>
</td></tr>
<tr><td><code id="black_scholes_on_term_structures_+3A_survival_probability_fcn">survival_probability_fcn</code></td>
<td>
<p>A function for probability of survival, with
arguments <code>T</code>, <code>t</code> and <code>T&gt;t</code>.  E.g. with
a constant volatility <code class="reqn">s</code> this takes the form <code class="reqn">(T-t)s^2</code>.</p>
</td></tr>
<tr><td><code id="black_scholes_on_term_structures_+3A_variance_cumulation_fcn">variance_cumulation_fcn</code></td>
<td>
<p>A function for computing total stock variance
occurring during this timestep, with arguments <code>T</code>, <code>t</code>.  E.g. with
a constant volatility <code class="reqn">s</code> this takes the form <code class="reqn">(T-t)s^2</code>.</p>
</td></tr>
<tr><td><code id="black_scholes_on_term_structures_+3A_dividends">dividends</code></td>
<td>
<p>A <code>data.frame</code> with columns <code>time</code>, <code>fixed</code>,
and <code>proportional</code>.  Dividend size at the given <code>time</code> is
then expected to be equal to <code>fixed + proportional * S / S0</code>.  Fixed
dividends will be converted to proportional for purposes of this algorithm.</p>
</td></tr>
<tr><td><code id="black_scholes_on_term_structures_+3A_borrow_cost">borrow_cost</code></td>
<td>
<p>A continuous rate for stock borrow costs</p>
</td></tr>
<tr><td><code id="black_scholes_on_term_structures_+3A_dividend_rate">dividend_rate</code></td>
<td>
<p>A continuous rate for dividends and other cashflows such as foreign interest rates</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Any term structures will be converted to equivalent constant arguments by calling
them with the arguments <code>(time, 0)</code>.
</p>


<h3>See Also</h3>

<p>Other European Options: 
<code><a href="#topic+blackscholes">blackscholes</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>
<p>Other Equity Independent Default Intensity: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+american">american</a>()</code>,
<code><a href="#topic+blackscholes">blackscholes</a>()</code>,
<code><a href="#topic+equivalent_bs_vola_to_jump">equivalent_bs_vola_to_jump</a>()</code>,
<code><a href="#topic+equivalent_jump_vola_to_bs">equivalent_jump_vola_to_bs</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>black_scholes_on_term_structures(callput=-1, S0=100, K=90, time=1,
                                 discount_factor_fcn = function(T, t, ...) {
                                   exp(-0.03 * (T - t))
                                 },
                                 survival_probability_fcn = function(T, t, ...) {
                                   exp(-0.07 * (T - t))
                                 },
                                 variance_cumulation_fcn = function(T, t) {
                                   0.45 ^ 2 * (T - t)
                                 })
</code></pre>

<hr>
<h2 id='blackscholes'>Vectorized Black-Scholes pricing of european-exercise options</h2><span id='topic+blackscholes'></span>

<h3>Description</h3>

<p>Price options according to the famous Black-Scholes formula, with the
optional addition of a jump-to-default intensity and discrete dividends.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>blackscholes(
  callput,
  S0,
  K,
  r,
  time,
  vola,
  default_intensity = 0,
  divrate = 0,
  borrow_cost = 0,
  dividends = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="blackscholes_+3A_callput">callput</code></td>
<td>
<p>1 for calls, -1 for puts</p>
</td></tr>
<tr><td><code id="blackscholes_+3A_s0">S0</code></td>
<td>
<p>initial underlying price</p>
</td></tr>
<tr><td><code id="blackscholes_+3A_k">K</code></td>
<td>
<p>strike</p>
</td></tr>
<tr><td><code id="blackscholes_+3A_r">r</code></td>
<td>
<p>risk-free interest rate</p>
</td></tr>
<tr><td><code id="blackscholes_+3A_time">time</code></td>
<td>
<p>Time from <code>0</code> until expiration</p>
</td></tr>
<tr><td><code id="blackscholes_+3A_vola">vola</code></td>
<td>
<p>Default-free volatility of the underlying</p>
</td></tr>
<tr><td><code id="blackscholes_+3A_default_intensity">default_intensity</code></td>
<td>
<p>hazard rate of underlying default</p>
</td></tr>
<tr><td><code id="blackscholes_+3A_divrate">divrate</code></td>
<td>
<p>A continuous rate for dividends and other cashflows such as foreign interest rates</p>
</td></tr>
<tr><td><code id="blackscholes_+3A_borrow_cost">borrow_cost</code></td>
<td>
<p>A continuous rate for stock borrow costs</p>
</td></tr>
<tr><td><code id="blackscholes_+3A_dividends">dividends</code></td>
<td>
<p>A <code>data.frame</code> with columns <code>time</code>, <code>fixed</code>,
and <code>proportional</code>.  Dividend size at the given <code>time</code> is
then expected to be equal to <code>fixed + proportional * S / S0</code>.  Fixed
dividends will be converted to proportional for purposes of this algorithm.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that if the <code>default_intensity</code> is set larger than zero then
put-call parity still holds.  Greeks are reduced according to cumulated default
probability.
</p>
<p>All inputs must either be scalars or have the same nonscalar shape.
</p>


<h3>Value</h3>

<p>A list with elements </p>

<dl>
<dt><code>Price</code></dt><dd><p>The present value(s)</p>
</dd>
<dt><code>Delta</code></dt><dd><p>Sensitivity to underlying price</p>
</dd>
<dt><code>Vega</code></dt><dd><p>Sensitivity to volatility</p>
</dd>
</dl>



<h3>See Also</h3>

<p>Other European Options: 
<code><a href="#topic+black_scholes_on_term_structures">black_scholes_on_term_structures</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>
<p>Other Equity Independent Default Intensity: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+american">american</a>()</code>,
<code><a href="#topic+black_scholes_on_term_structures">black_scholes_on_term_structures</a>()</code>,
<code><a href="#topic+equivalent_bs_vola_to_jump">equivalent_bs_vola_to_jump</a>()</code>,
<code><a href="#topic+equivalent_jump_vola_to_bs">equivalent_jump_vola_to_bs</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>blackscholes(callput=-1, S0=100, K=90, r=0.03, time=1, # -1 is a PUT
             vola=0.5, default_intensity=0.07)
</code></pre>

<hr>
<h2 id='CALL'>Constant CALL for defining option contracts</h2><span id='topic+CALL'></span>

<h3>Description</h3>

<p>Constant CALL for defining option contracts
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CALL
</code></pre>


<h3>Format</h3>

<p>An object of class <code>numeric</code> of length 1.</p>

<hr>
<h2 id='CallableBond-class'>Callable (and putable) corporate or government bond.</h2><span id='topic+CallableBond-class'></span><span id='topic+CallableBond'></span>

<h3>Description</h3>

<p>When a bond is emphcallable, the issuer may choose to pay the call
price to the bond holder and end the life of the contract.
</p>


<h3>Details</h3>

<p>When a bond is emphputable, the bond holder may choose to force the
issuer pay the put price to the bond holder thus ending the life of the contract.
</p>


<h3>Fields</h3>


<dl>
<dt><code>calls</code></dt><dd><p>A data.frame of details for each call.  It should have the columns <code>call_price</code> and <code>effective_time</code>.</p>
</dd>
<dt><code>puts</code></dt><dd><p>A data.frame of details for each put.  It should have the columns <code>put_price</code> and <code>effective_time</code>.</p>
</dd>
</dl>


<h3>Methods</h3>


<dl>
<dt><code>critical_times()</code></dt><dd><p>Important times in the life of this instrument for simulation and grid solvers</p>
</dd>
</dl>

<hr>
<h2 id='construct_implicit_grid_structure'>Structure of implicit numerical integration grid</h2><span id='topic+construct_implicit_grid_structure'></span>

<h3>Description</h3>

<p>Infer a reasonable structure for our implicit grid solver based
on the voltime, structure constant, and requested grid width
in standard deviations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>construct_implicit_grid_structure(
  tenors,
  M,
  S0,
  K,
  c,
  sigma,
  structure_constant,
  std_devs_width,
  min_z_width = 0
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="construct_implicit_grid_structure_+3A_tenors">tenors</code></td>
<td>
<p>Tenors of instruments to be treated on this grid</p>
</td></tr>
<tr><td><code id="construct_implicit_grid_structure_+3A_m">M</code></td>
<td>
<p>Minimum number of timesteps on this grid</p>
</td></tr>
<tr><td><code id="construct_implicit_grid_structure_+3A_s0">S0</code></td>
<td>
<p>An initial stock price, for setting grid scale</p>
</td></tr>
<tr><td><code id="construct_implicit_grid_structure_+3A_k">K</code></td>
<td>
<p>An instrument reference stock price, for setting grid scale</p>
</td></tr>
<tr><td><code id="construct_implicit_grid_structure_+3A_c">c</code></td>
<td>
<p>A continuous stock drift rate</p>
</td></tr>
<tr><td><code id="construct_implicit_grid_structure_+3A_sigma">sigma</code></td>
<td>
<p>Volatility of diffusion process (without jumps to default)</p>
</td></tr>
<tr><td><code id="construct_implicit_grid_structure_+3A_structure_constant">structure_constant</code></td>
<td>
<p>The maximum ratio between time intervals <code>dt</code>
and the square of space intervals <code>dz^2</code></p>
</td></tr>
<tr><td><code id="construct_implicit_grid_structure_+3A_std_devs_width">std_devs_width</code></td>
<td>
<p>The number of standard deviations, in <code>sigma * sqrt(T)</code>
units, to incorporate into the grid</p>
</td></tr>
<tr><td><code id="construct_implicit_grid_structure_+3A_min_z_width">min_z_width</code></td>
<td>
<p>Minimum grid width, in log space</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Generally speaking pricing will be good to about 10bp of
relative accuracy when the ratio of timesteps to voltime
(in annualized units) is over 200.
</p>
<p>Cases with pathologically low volatility may go awry (in the sense of
yielding ultimately inaccurate PDE solutions), as the
structure_constant will force a step in z space much bigger
than the width in standard deviations.
</p>


<h3>Value</h3>

<p>A list with elements </p>

<dl>
<dt><code>T</code></dt><dd><p>The maximum time for this grid</p>
</dd>
<dt><code>dt</code></dt><dd><p>Largest permissible timestep size</p>
</dd>
<dt><code>dz</code></dt><dd><p>Distance between space grid points</p>
</dd>
<dt><code>z0</code></dt><dd><p>Center of space grid</p>
</dd>
<dt><code>z_width</code></dt><dd><p>Width in <code class="reqn">z</code> space</p>
</dd>
<dt><code>half_N</code></dt><dd><p>A misnomer, actually <code class="reqn">(N-1)/2</code></p>
</dd>
<dt><code>N</code></dt><dd><p>The number of space points</p>
</dd>
<dt><code>z</code></dt><dd><p>Locations of space points</p>
</dd>
</dl>



<h3>See Also</h3>

<p>Other Implicit Grid Solver: 
<code><a href="#topic+find_present_value">find_present_value</a>()</code>,
<code><a href="#topic+form_present_value_grid">form_present_value_grid</a>()</code>,
<code><a href="#topic+infer_conforming_time_grid">infer_conforming_time_grid</a>()</code>,
<code><a href="#topic+integrate_pde">integrate_pde</a>()</code>,
<code><a href="#topic+iterate_grid_from_timestep">iterate_grid_from_timestep</a>()</code>,
<code><a href="#topic+take_implicit_timestep">take_implicit_timestep</a>()</code>,
<code><a href="#topic+timestep_instruments">timestep_instruments</a>()</code>
</p>

<hr>
<h2 id='construct_tridiagonals'>Matrix entries for implicit numerical differentiation using Neumann boundary conditions</h2><span id='topic+construct_tridiagonals'></span>

<h3>Description</h3>

<p>Matrix entries for implicit numerical differentiation using Neumann boundary conditions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>construct_tridiagonals(sigma, structure_constant, drift)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="construct_tridiagonals_+3A_sigma">sigma</code></td>
<td>
<p>Volatility of diffusion process (without jumps to default)</p>
</td></tr>
<tr><td><code id="construct_tridiagonals_+3A_structure_constant">structure_constant</code></td>
<td>
<p>The ratio between time interval <code>dt</code>
and the square of space interval <code>dz^2</code></p>
</td></tr>
<tr><td><code id="construct_tridiagonals_+3A_drift">drift</code></td>
<td>
<p>Vector of drift rate of underlying equity grid points, including
induced drift from default intensity</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with elements <code>super</code>, <code>diag</code> and <code>sub</code>
containing the superdiagonal, diagonal and subdiagonal of the implicit
timestep differencing matrix
</p>

<hr>
<h2 id='control_variate_pairs'>Form instrument objects for vanilla options</h2><span id='topic+control_variate_pairs'></span>

<h3>Description</h3>

<p>Form a list twice as long as the longest of the arguments
<code>callput</code>, <code>K</code>, <code>time</code> whose
first half consists of AmericanOption objects and
second half consists of EuropeanOption objects
having the same exercise specification
</p>


<h3>Usage</h3>

<pre><code class='language-R'>control_variate_pairs(callput, K, time)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="control_variate_pairs_+3A_callput">callput</code></td>
<td>
<p>1 for calls, -1 for puts</p>
</td></tr>
<tr><td><code id="control_variate_pairs_+3A_k">K</code></td>
<td>
<p>strike</p>
</td></tr>
<tr><td><code id="control_variate_pairs_+3A_time">time</code></td>
<td>
<p>Time from <code>0</code> until expiration</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other American Exercise Equity Options: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+american">american</a>()</code>
</p>

<hr>
<h2 id='ConvertibleBond-class'>Convertible bond with exercise into stock</h2><span id='topic+ConvertibleBond-class'></span><span id='topic+ConvertibleBond'></span>

<h3>Description</h3>

<p>Convertible bond with exercise into stock
</p>


<h3>Fields</h3>


<dl>
<dt><code>conversion_ratio</code></dt><dd><p>The number of shares, per bond, that result from exercise</p>
</dd>
<dt><code>dividend_ceiling</code></dt><dd><p>The level of dividend protection (if any) specified in terms and conditions</p>
</dd>
</dl>


<h3>Methods</h3>


<dl>
<dt><code>exercise_decision(v, S, t, discount_factor_fctn = discount_factor_fcn, ...)</code></dt><dd><p>Find indexes where hold value v will be inferior to conversion value at each stock price level in S, adjusted to include all past coupons</p>
</dd>
<dt><code>optionality_fcn(v, S, t, discount_factor_fctn = discount_factor_fcn, ...)</code></dt><dd><p>Return the greater of hold value v or exercise value at each stock price level in S.  If the given date is beyond maturity, return value at maturity.</p>
</dd>
<dt><code>terminal_values(v, ...)</code></dt><dd><p>Return a terminal value. defaults to simply calling optionality_fcn.</p>
</dd>
<dt><code>update_cashflows(
  small_t,
  big_t,
  discount_factor_fctn = discount_factor_fcn,
  include_notional = TRUE,
  ...
)</code></dt><dd><p>Update last_computed_cash and return cashflow information for the given time period, valued at big_t</p>
</dd>
</dl>

<hr>
<h2 id='coupon_value_at_exercise'>Present value of coupons according to an acceleration schedule</h2><span id='topic+coupon_value_at_exercise'></span>

<h3>Description</h3>

<p>Compute &quot;present&quot; value as of time t for coupons that
would otherwise have been paid up to time <code>acceleration_t</code>, in the
case of accelerated coupon provisions for forced conversions (or
sometimes even unforced ones).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>coupon_value_at_exercise(
  t,
  coupons_df,
  discount_factor_fcn,
  model_t = 0,
  accelerate_future_coupons = FALSE,
  acceleration_discount_factor_fcn = discount_factor_fcn,
  acceleration_t = Inf
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coupon_value_at_exercise_+3A_t">t</code></td>
<td>
<p>The time toward which all coupons should be present valued</p>
</td></tr>
<tr><td><code id="coupon_value_at_exercise_+3A_coupons_df">coupons_df</code></td>
<td>
<p>A data.frame of details for each coupon.  It should have the
columns <code>payment_time</code> and <code>payment_size</code>.</p>
</td></tr>
<tr><td><code id="coupon_value_at_exercise_+3A_discount_factor_fcn">discount_factor_fcn</code></td>
<td>
<p>A function specifying how future cashflows should generally be discounted for this instrument</p>
</td></tr>
<tr><td><code id="coupon_value_at_exercise_+3A_model_t">model_t</code></td>
<td>
<p>Model timestamp passed to <code><a href="#topic+value_from_prior_coupons">value_from_prior_coupons</a></code></p>
</td></tr>
<tr><td><code id="coupon_value_at_exercise_+3A_accelerate_future_coupons">accelerate_future_coupons</code></td>
<td>
<p>If <code>TRUE</code>, future coupons will be accelerated on exercise to pad present value</p>
</td></tr>
<tr><td><code id="coupon_value_at_exercise_+3A_acceleration_discount_factor_fcn">acceleration_discount_factor_fcn</code></td>
<td>
<p>A function specifying how future coupons should be discounted for this instrument under coupon acceleration conditions</p>
</td></tr>
<tr><td><code id="coupon_value_at_exercise_+3A_acceleration_t">acceleration_t</code></td>
<td>
<p>The maximum time up to which future coupons will be counted for acceleration, passed on to <code><a href="#topic+accelerated_coupon_value">accelerated_coupon_value</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A scalar equal to the present value
</p>


<h3>See Also</h3>

<p>Other Bond Coupons: 
<code><a href="#topic+accelerated_coupon_value">accelerated_coupon_value</a>()</code>,
<code><a href="#topic+value_from_prior_coupons">value_from_prior_coupons</a>()</code>
</p>
<p>Other Bond Coupon Acceleration: 
<code><a href="#topic+accelerated_coupon_value">accelerated_coupon_value</a>()</code>
</p>

<hr>
<h2 id='CouponBond-class'>Standard corporate or government bond</h2><span id='topic+CouponBond-class'></span><span id='topic+CouponBond'></span>

<h3>Description</h3>

<p>A coupon bond is treated here as the entire collection of cashflows. In particular,
coupons are included in the package even after they have been paid, accruing
at the risk-free rate.
</p>


<h3>Fields</h3>


<dl>
<dt><code>coupons</code></dt><dd><p>A data.frame of details for each coupon.  It should have the
columns <code>payment_time</code> and <code>payment_size</code>.</p>
</dd>
</dl>


<h3>Methods</h3>


<dl>
<dt><code>accumulate_coupon_values_before(t, discount_factor_fctn = discount_factor_fcn)</code></dt><dd><p>Compute the sum of coupon present values as of t according to discount_factor_fctn</p>
</dd>
<dt><code>critical_times()</code></dt><dd><p>Important times in the life of this instrument for simulation and grid solvers</p>
</dd>
<dt><code>optionality_fcn(v, S, t, ...)</code></dt><dd><p>Return the notional value in the shape of S at any time on or after maturity, otherwise just return v</p>
</dd>
<dt><code>total_coupon_values_between(
  small_t,
  big_t,
  discount_factor_fctn = discount_factor_fcn
)</code></dt><dd><p>Compute the sum (as of big_t) of present values of coupons paid between small_t and big_t</p>
</dd>
<dt><code>update_cashflows(
  small_t,
  big_t,
  discount_factor_fctn = discount_factor_fcn,
  include_notional = TRUE,
  ...
)</code></dt><dd><p>Update last_computed_cash and return cashflow information for the given time period, valued at big_t</p>
</dd>
</dl>

<hr>
<h2 id='detail_from_AnnivDates'>Convert output of BondValuation::AnnivDates to inputd for Bond</h2><span id='topic+detail_from_AnnivDates'></span>

<h3>Description</h3>

<p>The BondValuation package provides day count convention treatments superior
to quantmod or any other R package known (as of May 2019).  This function
takes output from BondValuation::AnnivDates(...) and parses it into
notionals, maturity time, and coupon times and sizes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>detail_from_AnnivDates(
  anvdates,
  as_of = Sys.time(),
  normalization_factor = 365.25
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="detail_from_AnnivDates_+3A_anvdates">anvdates</code></td>
<td>
<p>Output of BondValuation::AnnivDates(), which must have included a 'Coup' argument so that the resulting list contains an entry for 'PaySched'</p>
</td></tr>
<tr><td><code id="detail_from_AnnivDates_+3A_as_of">as_of</code></td>
<td>
<p>Date or time from whose perspective times should be computed</p>
</td></tr>
<tr><td><code id="detail_from_AnnivDates_+3A_normalization_factor">normalization_factor</code></td>
<td>
<p>Factor by which raw R time differences should be multiplied.  If volatilites are going to be annualized, then this should typically be 365 or so.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note: volatilities used in 'ragtop' must have compatible time units to these times.
</p>


<h3>Value</h3>

<p>A list with some of the arguments appropriate for defining a Bond as follows:
maturity - maturity
notional - notional amount
coupons - 'data.frame' with 'payment_time', 'payment_size'
</p>

<hr>
<h2 id='EquityOption-class'>An option contract with call or put terms</h2><span id='topic+EquityOption-class'></span><span id='topic+EquityOption'></span>

<h3>Description</h3>

<p>An option contract with call or put terms
</p>


<h3>Fields</h3>


<dl>
<dt><code>strike</code></dt><dd><p>A decision price for the contract</p>
</dd>
<dt><code>callput</code></dt><dd><p>Either <code>1</code> for a call or <code>-1</code> for a put</p>
</dd>
</dl>

<hr>
<h2 id='equivalent_bs_vola_to_jump'>Find straight Black-Scholes volatility equivalent to jump process with a given default risk</h2><span id='topic+equivalent_bs_vola_to_jump'></span>

<h3>Description</h3>

<p>Find Black-Scholes volatility based on known
interest rates and hazard rates, using
an at-the-money put option at the given tenor to set the standard price.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>equivalent_bs_vola_to_jump(
  jump_process_vola,
  time,
  const_short_rate = 0,
  const_default_intensity = 0,
  discount_factor_fcn = function(T, t, ...) {     exp(-const_short_rate * (T - t)) },
  survival_probability_fcn = function(T, t, ...) {     exp(-const_default_intensity * (T
    - t)) },
  dividends = NULL,
  borrow_cost = 0,
  dividend_rate = 0,
  relative_tolerance = 1e-06,
  max.iter = 100
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="equivalent_bs_vola_to_jump_+3A_jump_process_vola">jump_process_vola</code></td>
<td>
<p>Volatility of default-free process</p>
</td></tr>
<tr><td><code id="equivalent_bs_vola_to_jump_+3A_time">time</code></td>
<td>
<p>Time to expiration of associated option contracts</p>
</td></tr>
<tr><td><code id="equivalent_bs_vola_to_jump_+3A_const_short_rate">const_short_rate</code></td>
<td>
<p>A constant to use for the instantaneous interest rate in case <code>discount_factor_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="equivalent_bs_vola_to_jump_+3A_const_default_intensity">const_default_intensity</code></td>
<td>
<p>A constant to use for the instantaneous default intensity in case <code>survival_probability_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="equivalent_bs_vola_to_jump_+3A_discount_factor_fcn">discount_factor_fcn</code></td>
<td>
<p>A function for computing present values to
time <code>t</code> of various cashflows occurring during this timestep, with
arguments <code>T</code>, <code>t</code></p>
</td></tr>
<tr><td><code id="equivalent_bs_vola_to_jump_+3A_survival_probability_fcn">survival_probability_fcn</code></td>
<td>
<p>(Implied argument) A function for probability of survival, with
arguments <code>T</code>, <code>t</code> and <code>T&gt;t</code>.</p>
</td></tr>
<tr><td><code id="equivalent_bs_vola_to_jump_+3A_dividends">dividends</code></td>
<td>
<p>A <code>data.frame</code> with columns <code>time</code>, <code>fixed</code>,
and <code>proportional</code>.  Dividend size at the given <code>time</code> is
then expected to be equal to <code>fixed + proportional * S / S0</code>.  Fixed
dividends will be converted to proportional for purposes of this algorithm.</p>
</td></tr>
<tr><td><code id="equivalent_bs_vola_to_jump_+3A_borrow_cost">borrow_cost</code></td>
<td>
<p>A continuous rate for stock borrow costs</p>
</td></tr>
<tr><td><code id="equivalent_bs_vola_to_jump_+3A_dividend_rate">dividend_rate</code></td>
<td>
<p>A continuous accumulation rate for the stock, affecting the drift</p>
</td></tr>
<tr><td><code id="equivalent_bs_vola_to_jump_+3A_relative_tolerance">relative_tolerance</code></td>
<td>
<p>Relative tolerance in instrument price defining the root-finder halting condition</p>
</td></tr>
<tr><td><code id="equivalent_bs_vola_to_jump_+3A_max.iter">max.iter</code></td>
<td>
<p>Maximum number of root-finder iterations allowed</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A scalar defaultable volatility of an option
</p>


<h3>See Also</h3>

<p>Other Implied Volatilities: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+equivalent_jump_vola_to_bs">equivalent_jump_vola_to_bs</a>()</code>,
<code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a>()</code>,
<code><a href="#topic+implied_jump_process_volatility">implied_jump_process_volatility</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>
<p>Other Equity Independent Default Intensity: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+american">american</a>()</code>,
<code><a href="#topic+black_scholes_on_term_structures">black_scholes_on_term_structures</a>()</code>,
<code><a href="#topic+blackscholes">blackscholes</a>()</code>,
<code><a href="#topic+equivalent_jump_vola_to_bs">equivalent_jump_vola_to_bs</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>

<hr>
<h2 id='equivalent_jump_vola_to_bs'>Find jump process volatility with a given default risk from a straight Black-Scholes volatility</h2><span id='topic+equivalent_jump_vola_to_bs'></span>

<h3>Description</h3>

<p>Find default-free volatility (i.e. volatility of a Wiener process with a
companion jump process to default) based on known interest rates and hazard rates, using
and at-the-money put option at the given tenor to set the standard price.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>equivalent_jump_vola_to_bs(
  bs_vola,
  time,
  const_short_rate = 0,
  const_default_intensity = 0,
  discount_factor_fcn = function(T, t, ...) {     exp(-const_short_rate * (T - t)) },
  survival_probability_fcn = function(T, t, ...) {     exp(-const_default_intensity * (T
    - t)) },
  dividends = NULL,
  borrow_cost = 0,
  dividend_rate = 0,
  relative_tolerance = 1e-06,
  max.iter = 100
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="equivalent_jump_vola_to_bs_+3A_bs_vola">bs_vola</code></td>
<td>
<p>BlackScholes volatility of an option with no default assumption</p>
</td></tr>
<tr><td><code id="equivalent_jump_vola_to_bs_+3A_time">time</code></td>
<td>
<p>Time to expiration of associated option contracts</p>
</td></tr>
<tr><td><code id="equivalent_jump_vola_to_bs_+3A_const_short_rate">const_short_rate</code></td>
<td>
<p>A constant to use for the instantaneous interest rate in case <code>discount_factor_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="equivalent_jump_vola_to_bs_+3A_const_default_intensity">const_default_intensity</code></td>
<td>
<p>A constant to use for the instantaneous default intensity in case <code>survival_probability_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="equivalent_jump_vola_to_bs_+3A_discount_factor_fcn">discount_factor_fcn</code></td>
<td>
<p>A function for computing present values to
time <code>t</code> of various cashflows occurring during this timestep, with
arguments <code>T</code>, <code>t</code></p>
</td></tr>
<tr><td><code id="equivalent_jump_vola_to_bs_+3A_survival_probability_fcn">survival_probability_fcn</code></td>
<td>
<p>(Implied argument) A function for probability of survival, with
arguments <code>T</code>, <code>t</code> and <code>T&gt;t</code>.</p>
</td></tr>
<tr><td><code id="equivalent_jump_vola_to_bs_+3A_dividends">dividends</code></td>
<td>
<p>A <code>data.frame</code> with columns <code>time</code>, <code>fixed</code>,
and <code>proportional</code>.  Dividend size at the given <code>time</code> is
then expected to be equal to <code>fixed + proportional * S / S0</code></p>
</td></tr>
<tr><td><code id="equivalent_jump_vola_to_bs_+3A_borrow_cost">borrow_cost</code></td>
<td>
<p>Stock borrow cost, affecting the drift rate</p>
</td></tr>
<tr><td><code id="equivalent_jump_vola_to_bs_+3A_dividend_rate">dividend_rate</code></td>
<td>
<p>A continuous accumulation rate for the stock, affecting the drift</p>
</td></tr>
<tr><td><code id="equivalent_jump_vola_to_bs_+3A_relative_tolerance">relative_tolerance</code></td>
<td>
<p>Relative tolerance in instrument price defining the root-finder halting condition</p>
</td></tr>
<tr><td><code id="equivalent_jump_vola_to_bs_+3A_max.iter">max.iter</code></td>
<td>
<p>Maximum number of root-finder iterations allowed</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A scalar volatility
</p>


<h3>See Also</h3>

<p>Other Implied Volatilities: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+equivalent_bs_vola_to_jump">equivalent_bs_vola_to_jump</a>()</code>,
<code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a>()</code>,
<code><a href="#topic+implied_jump_process_volatility">implied_jump_process_volatility</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>
<p>Other Equity Independent Default Intensity: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+american">american</a>()</code>,
<code><a href="#topic+black_scholes_on_term_structures">black_scholes_on_term_structures</a>()</code>,
<code><a href="#topic+blackscholes">blackscholes</a>()</code>,
<code><a href="#topic+equivalent_bs_vola_to_jump">equivalent_bs_vola_to_jump</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>

<hr>
<h2 id='EuropeanOption-class'>A standard option contract</h2><span id='topic+EuropeanOption-class'></span><span id='topic+EuropeanOption'></span>

<h3>Description</h3>

<p>At maturity, the call option holder will &quot;exercise&quot;, i.e. choose stock, with value <code>S</code>, if the
stock price is above the strike <code>K</code>, paying <code>K</code> to the option issuer,
realizing value <code>S-K</code>.  The put option holder will exercise, receiving <code>K</code> while surrendering
stock worth <code>S</code>, if the stock price is below <code>K</code>.
</p>


<h3>Details</h3>

<p>Therefore the value at maturity is equal to <code>max(0,callput*(S-K))</code>
</p>


<h3>Methods</h3>


<dl>
<dt><code>optionality_fcn(v, ...)</code></dt><dd><p>Return a version of v at time t corrected for any optionality conditions.</p>
</dd>
<dt><code>recovery_fcn(v, S, t, ...)</code></dt><dd><p>Return recovery value, given non-default values v at time t.  Subclasses may be more elaborate, this method simply returns 0.0.</p>
</dd>
</dl>

<hr>
<h2 id='find_present_value'>Use a model to estimate the present value of financial derivatives</h2><span id='topic+find_present_value'></span>

<h3>Description</h3>

<p>Use a finite difference scheme to form estimates of present values for a variety
of stock prices.  Once the grid has been created, interpolate to obtain the
value of each instrument at the present stock price <code>S0</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>find_present_value(
  S0,
  num_time_steps,
  instruments,
  const_volatility = 0.5,
  const_short_rate = 0,
  const_default_intensity = 0,
  override_Tmax = NA,
  discount_factor_fcn = function(T, t, ...) {     exp(-const_short_rate * (T - t)) },
  default_intensity_fcn = function(t, S, ...) {     const_default_intensity + 0 * S },
  variance_cumulation_fcn = function(T, t) {     const_volatility^2 * (T - t) },
  dividends = NULL,
  borrow_cost = 0,
  dividend_rate = 0,
  structure_constant = 2,
  std_devs_width = 3
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="find_present_value_+3A_s0">S0</code></td>
<td>
<p>An initial stock price, for setting grid scale</p>
</td></tr>
<tr><td><code id="find_present_value_+3A_num_time_steps">num_time_steps</code></td>
<td>
<p>Minimum number of time steps in the grid</p>
</td></tr>
<tr><td><code id="find_present_value_+3A_instruments">instruments</code></td>
<td>
<p>A list of instruments to be priced.  Each
one must have a <code>strike</code> and a <code>optionality_fcn</code>, as
with <code><a href="#topic+GridPricedInstrument">GridPricedInstrument</a></code> and its subclasses.</p>
</td></tr>
<tr><td><code id="find_present_value_+3A_const_volatility">const_volatility</code></td>
<td>
<p>A constant to use for volatility in case <code>variance_cumulation_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="find_present_value_+3A_const_short_rate">const_short_rate</code></td>
<td>
<p>A constant to use for the instantaneous interest rate in case <code>discount_factor_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="find_present_value_+3A_const_default_intensity">const_default_intensity</code></td>
<td>
<p>A constant to use for the instantaneous default intensity in case <code>default_intensity_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="find_present_value_+3A_override_tmax">override_Tmax</code></td>
<td>
<p>A different maximum time on the grid to enforce</p>
</td></tr>
<tr><td><code id="find_present_value_+3A_discount_factor_fcn">discount_factor_fcn</code></td>
<td>
<p>A function for computing present values to
time <code>t</code> of various cashflows occurring during this timestep, with
arguments <code>T</code>, <code>t</code></p>
</td></tr>
<tr><td><code id="find_present_value_+3A_default_intensity_fcn">default_intensity_fcn</code></td>
<td>
<p>A function for computing default intensity
occurring during this timestep, dependent on time and stock price, with
arguments <code>t</code>, <code>S</code>.</p>
</td></tr>
<tr><td><code id="find_present_value_+3A_variance_cumulation_fcn">variance_cumulation_fcn</code></td>
<td>
<p>A function for computing total stock variance
occurring during this timestep, with arguments <code>T</code>, <code>t</code>.  E.g. with
a constant volatility <code class="reqn">s</code> this takes the form <code class="reqn">(T-t)s^2</code>.</p>
</td></tr>
<tr><td><code id="find_present_value_+3A_dividends">dividends</code></td>
<td>
<p>A <code>data.frame</code> with columns <code>time</code>, <code>fixed</code>,
and <code>proportional</code>.  Dividend size at the given <code>time</code> is
then expected to be equal to <code>fixed + proportional * S / S0</code></p>
</td></tr>
<tr><td><code id="find_present_value_+3A_borrow_cost">borrow_cost</code></td>
<td>
<p>Stock borrow cost, affecting the drift rate</p>
</td></tr>
<tr><td><code id="find_present_value_+3A_dividend_rate">dividend_rate</code></td>
<td>
<p>Continuous dividend rate, affecting the drift rate</p>
</td></tr>
<tr><td><code id="find_present_value_+3A_structure_constant">structure_constant</code></td>
<td>
<p>The maximum ratio between time intervals <code>dt</code>
and the square of space intervals <code>dz^2</code></p>
</td></tr>
<tr><td><code id="find_present_value_+3A_std_devs_width">std_devs_width</code></td>
<td>
<p>The number of standard deviations, in <code>sigma * sqrt(T)</code>
units, to incorporate into the grid</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of present values, with the same names as <code>instruments</code>
</p>


<h3>See Also</h3>

<p>Other Equity Dependent Default Intensity: 
<code><a href="#topic+fit_to_option_market_df">fit_to_option_market_df</a>()</code>,
<code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a>()</code>,
<code><a href="#topic+form_present_value_grid">form_present_value_grid</a>()</code>,
<code><a href="#topic+implied_jump_process_volatility">implied_jump_process_volatility</a>()</code>
</p>
<p>Other Implicit Grid Solver: 
<code><a href="#topic+construct_implicit_grid_structure">construct_implicit_grid_structure</a>()</code>,
<code><a href="#topic+form_present_value_grid">form_present_value_grid</a>()</code>,
<code><a href="#topic+infer_conforming_time_grid">infer_conforming_time_grid</a>()</code>,
<code><a href="#topic+integrate_pde">integrate_pde</a>()</code>,
<code><a href="#topic+iterate_grid_from_timestep">iterate_grid_from_timestep</a>()</code>,
<code><a href="#topic+take_implicit_timestep">take_implicit_timestep</a>()</code>,
<code><a href="#topic+timestep_instruments">timestep_instruments</a>()</code>
</p>

<hr>
<h2 id='fit_to_option_market'>Calibrate volatilities and equity-linked default intensity</h2><span id='topic+fit_to_option_market'></span>

<h3>Description</h3>

<p>Given derivative instruments (subclasses of
GridPricedInstrument, though typically either <code><a href="#topic+AmericanOption">AmericanOption</a></code>
or <code><a href="#topic+EuropeanOption">EuropeanOption</a></code> objects), along with their prices and spreads, calibrate
variance cumulation (the
at-the-money volatility of the continuous process) and equity linked default
intensity of the form $h(s + (1-s)(S0/S_t)^p)$.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_to_option_market(
  variance_instruments,
  variance_instrument_prices,
  variance_instrument_spreads,
  fit_instruments,
  fit_instrument_prices,
  fit_instrument_spreads,
  fit_instrument_weights,
  S0,
  num_time_steps = 30,
  const_short_rate = 0,
  discount_factor_fcn = function(T, t) {     exp(-const_short_rate * (T - t)) },
  ...,
  base_default_intensity = 0.05,
  relative_spread_tolerance = 0.15,
  num_variance_time_steps = 30
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit_to_option_market_+3A_variance_instruments">variance_instruments</code></td>
<td>
<p>A list of instruments in strictly increasing order
of maturity, from which the volatility term structure will be inferred.  Once the
calibration is finished, the chosen parameters will reproduce the prices of
these instruments with fairly high precision.</p>
</td></tr>
<tr><td><code id="fit_to_option_market_+3A_variance_instrument_prices">variance_instrument_prices</code></td>
<td>
<p>Central price targets for the variance instruments</p>
</td></tr>
<tr><td><code id="fit_to_option_market_+3A_variance_instrument_spreads">variance_instrument_spreads</code></td>
<td>
<p>Bid-offer spreads used to normalize errors
in variance instrument prices during term structure fitting</p>
</td></tr>
<tr><td><code id="fit_to_option_market_+3A_fit_instruments">fit_instruments</code></td>
<td>
<p>A list of instruments in any order, from which the
mispricing penalties used for judging fit quality will be computed</p>
</td></tr>
<tr><td><code id="fit_to_option_market_+3A_fit_instrument_prices">fit_instrument_prices</code></td>
<td>
<p>Central price targets for the variance instruments</p>
</td></tr>
<tr><td><code id="fit_to_option_market_+3A_fit_instrument_spreads">fit_instrument_spreads</code></td>
<td>
<p>Bid-offer spreads used to normalize errors
in fit instrument prices during default intensity</p>
</td></tr>
<tr><td><code id="fit_to_option_market_+3A_fit_instrument_weights">fit_instrument_weights</code></td>
<td>
<p>Weights applied to relative errors in fit
instrument prices before summing to form the penalty</p>
</td></tr>
<tr><td><code id="fit_to_option_market_+3A_s0">S0</code></td>
<td>
<p>Current underlying price</p>
</td></tr>
<tr><td><code id="fit_to_option_market_+3A_num_time_steps">num_time_steps</code></td>
<td>
<p>Time step count passed on to <code><a href="#topic+find_present_value">find_present_value</a></code>
while fitting instrument values</p>
</td></tr>
<tr><td><code id="fit_to_option_market_+3A_const_short_rate">const_short_rate</code></td>
<td>
<p>A constant to use for the instantaneous interest rate in case <code>discount_factor_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="fit_to_option_market_+3A_discount_factor_fcn">discount_factor_fcn</code></td>
<td>
<p>A function for computing present values to
time <code>t</code> of various cashflows occurring during this timestep, with
arguments <code>T</code>, <code>t</code></p>
</td></tr>
<tr><td><code id="fit_to_option_market_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="#topic+penalty_with_intensity_link">penalty_with_intensity_link</a></code></p>
</td></tr>
<tr><td><code id="fit_to_option_market_+3A_base_default_intensity">base_default_intensity</code></td>
<td>
<p>Overall default intensity (in natural units)</p>
</td></tr>
<tr><td><code id="fit_to_option_market_+3A_relative_spread_tolerance">relative_spread_tolerance</code></td>
<td>
<p>Tolerance to apply in
calling <code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a></code></p>
</td></tr>
<tr><td><code id="fit_to_option_market_+3A_num_variance_time_steps">num_variance_time_steps</code></td>
<td>
<p>Number of time steps to use in
calling <code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>In its present form, this function uses a brain-dead grid search.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+penalty_with_intensity_link">penalty_with_intensity_link</a></code> for the penalty function used
as an optimization target
</p>

<hr>
<h2 id='fit_to_option_market_df'>Calibrate volatilities and equity-linked default intensity making many assumptions</h2><span id='topic+fit_to_option_market_df'></span>

<h3>Description</h3>

<p>This is a convenience function for calibrating variance cumulation (the
at-the-money volatility of the continuous process) and equity linked default
intensity of the form $h(s + (1-s)(S0/S_t)^p)$, using a <code>data.frame</code> of
option market data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_to_option_market_df(
  S0 = ragtop::TSLAMarket$S0,
  discount_factor_fcn = spot_to_df_fcn(ragtop::TSLAMarket$risk_free_rates),
  options_df = ragtop::TSLAMarket$options,
  min_maturity = 1/12,
  min_moneyness = 0.8,
  max_moneyness = 1.2,
  base_default_intensity = 0.05
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit_to_option_market_df_+3A_s0">S0</code></td>
<td>
<p>Current underlying price</p>
</td></tr>
<tr><td><code id="fit_to_option_market_df_+3A_discount_factor_fcn">discount_factor_fcn</code></td>
<td>
<p>A function for computing present values to
time <code>t</code> of various cashflows occurring during this timestep, with
arguments <code>T</code>, <code>t</code></p>
</td></tr>
<tr><td><code id="fit_to_option_market_df_+3A_options_df">options_df</code></td>
<td>
<p>A data frame of American option details.  It should
have columns <code>callput</code>, <code>K</code>, <code>time</code>,
<code>mid</code>, <code>bid</code>, and <code>ask</code>,</p>
</td></tr>
<tr><td><code id="fit_to_option_market_df_+3A_min_maturity">min_maturity</code></td>
<td>
<p>Minimum option maturity to allow in calibration</p>
</td></tr>
<tr><td><code id="fit_to_option_market_df_+3A_min_moneyness">min_moneyness</code></td>
<td>
<p>Maximum option strike as a proportion of S0 to allow in calibration</p>
</td></tr>
<tr><td><code id="fit_to_option_market_df_+3A_max_moneyness">max_moneyness</code></td>
<td>
<p>Maximum option strike as a proportion of S0  to allow in calibration</p>
</td></tr>
<tr><td><code id="fit_to_option_market_df_+3A_base_default_intensity">base_default_intensity</code></td>
<td>
<p>Overall default intensity (in natural units)</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+fit_to_option_market">fit_to_option_market</a></code> the underlying fit algorithm
</p>
<p>Other Equity Dependent Default Intensity: 
<code><a href="#topic+find_present_value">find_present_value</a>()</code>,
<code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a>()</code>,
<code><a href="#topic+form_present_value_grid">form_present_value_grid</a>()</code>,
<code><a href="#topic+implied_jump_process_volatility">implied_jump_process_volatility</a>()</code>
</p>

<hr>
<h2 id='fit_variance_cumulation'>Fit piecewise constant volatilities to a set of equity options</h2><span id='topic+fit_variance_cumulation'></span>

<h3>Description</h3>

<p>Given a set of equity options with increasing tenors, along with
target prices for those options, and a set of equity-lined default
SDE parameters, fit a vector of piecewise constant
volatilities and an associated cumulative variance function
to them.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_variance_cumulation(
  S0,
  eq_options,
  mid_prices,
  spreads = NULL,
  initial_vols_guess = 0.55 + 0 * mid_prices,
  use_impvol = TRUE,
  relative_spread_tolerance = 0.01,
  force_same_grid = FALSE,
  num_time_steps = 40,
  const_short_rate = 0,
  const_default_intensity = 0,
  discount_factor_fcn = function(T, t, ...) {     exp(-const_short_rate * (T - t)) },
  survival_probability_fcn = function(T, t, ...) {     exp(-const_default_intensity * (T
    - t)) },
  default_intensity_fcn = function(t, S, ...) {     const_default_intensity + 0 * S },
  dividends = NULL,
  borrow_cost = 0,
  dividend_rate = 0,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit_variance_cumulation_+3A_s0">S0</code></td>
<td>
<p>Current stock price</p>
</td></tr>
<tr><td><code id="fit_variance_cumulation_+3A_eq_options">eq_options</code></td>
<td>
<p>A list of options to find prices for.  Each must have fields <code>callput</code>,
<code>maturity</code>, and <code>strike</code>.  This list must be in strictly increasing order of maturity.</p>
</td></tr>
<tr><td><code id="fit_variance_cumulation_+3A_mid_prices">mid_prices</code></td>
<td>
<p>Prices to match</p>
</td></tr>
<tr><td><code id="fit_variance_cumulation_+3A_spreads">spreads</code></td>
<td>
<p>Spreads within which any match is tolerable</p>
</td></tr>
<tr><td><code id="fit_variance_cumulation_+3A_initial_vols_guess">initial_vols_guess</code></td>
<td>
<p>Initial set of volatilities to try in the root finder</p>
</td></tr>
<tr><td><code id="fit_variance_cumulation_+3A_use_impvol">use_impvol</code></td>
<td>
<p>Judge fit quality on implied vol distance rather than price distance</p>
</td></tr>
<tr><td><code id="fit_variance_cumulation_+3A_relative_spread_tolerance">relative_spread_tolerance</code></td>
<td>
<p>Tolerance multiplier on bid-ask spreads taken from vol normalization</p>
</td></tr>
<tr><td><code id="fit_variance_cumulation_+3A_force_same_grid">force_same_grid</code></td>
<td>
<p>Price all options on the same grid, rather than having smaller timestep sizes for earlier maturities</p>
</td></tr>
<tr><td><code id="fit_variance_cumulation_+3A_num_time_steps">num_time_steps</code></td>
<td>
<p>Minimum number of time steps in the grid</p>
</td></tr>
<tr><td><code id="fit_variance_cumulation_+3A_const_short_rate">const_short_rate</code></td>
<td>
<p>A constant to use for the instantaneous interest rate in case <code>discount_factor_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="fit_variance_cumulation_+3A_const_default_intensity">const_default_intensity</code></td>
<td>
<p>A constant to use for the instantaneous default intensity in case <code>default_intensity_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="fit_variance_cumulation_+3A_discount_factor_fcn">discount_factor_fcn</code></td>
<td>
<p>A function for computing present values to
time <code>t</code> of various cashflows occurring, with
arguments <code>T</code>, <code>t</code></p>
</td></tr>
<tr><td><code id="fit_variance_cumulation_+3A_survival_probability_fcn">survival_probability_fcn</code></td>
<td>
<p>A function for probability of survival, with
arguments <code>T</code>, <code>t</code> and <code>T&gt;t</code>.  E.g. with
a constant volatility <code class="reqn">s</code> this takes the form <code class="reqn">(T-t)s^2</code>.  This argument is
only used in normalization of prices to vols for root finder tolerance, and
is therefore entirely optional</p>
</td></tr>
<tr><td><code id="fit_variance_cumulation_+3A_default_intensity_fcn">default_intensity_fcn</code></td>
<td>
<p>A function for computing default intensity
occurring during this timestep, dependent on time and stock price, with
arguments <code>t</code>, <code>S</code>.  Should be consistent with
<code>survival_probability_fcn</code> if specified</p>
</td></tr>
<tr><td><code id="fit_variance_cumulation_+3A_dividends">dividends</code></td>
<td>
<p>A <code>data.frame</code> with columns <code>time</code>, <code>fixed</code>,
and <code>proportional</code>.  Dividend size at the given <code>time</code> is</p>
</td></tr>
<tr><td><code id="fit_variance_cumulation_+3A_borrow_cost">borrow_cost</code></td>
<td>
<p>Stock borrow cost, affecting the drift rate</p>
</td></tr>
<tr><td><code id="fit_variance_cumulation_+3A_dividend_rate">dividend_rate</code></td>
<td>
<p>Continuous dividend rate, affecting the drift rate</p>
</td></tr>
<tr><td><code id="fit_variance_cumulation_+3A_...">...</code></td>
<td>
<p>Futher arguments to <code><a href="#topic+find_present_value">find_present_value</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>By default, the fitting happens in implied Black-Scholes volatility
space for better normalization.  That is to say, the fitting does pricing
using the <em>full</em> SDE and PDE solver via <code><a href="#topic+find_present_value">find_present_value</a></code>, but
judges fit quality on the basis of running resulting prices through a
nonlinear transformation that just
happens to come from the straight Black-Scholes model.
</p>


<h3>Value</h3>

<p>A list with two elements, <code>volatilities</code> and <code>cumulation_function</code>.  The <code>cumulation_function</code> will
be a 2-parameter function giving cumulated variances, as created by code<a href="#topic+variance_cumulation_from_vols">variance_cumulation_from_vols</a>
</p>


<h3>See Also</h3>

<p>Other Implied Volatilities: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+equivalent_bs_vola_to_jump">equivalent_bs_vola_to_jump</a>()</code>,
<code><a href="#topic+equivalent_jump_vola_to_bs">equivalent_jump_vola_to_bs</a>()</code>,
<code><a href="#topic+implied_jump_process_volatility">implied_jump_process_volatility</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>
<p>Other Equity Dependent Default Intensity: 
<code><a href="#topic+find_present_value">find_present_value</a>()</code>,
<code><a href="#topic+fit_to_option_market_df">fit_to_option_market_df</a>()</code>,
<code><a href="#topic+form_present_value_grid">form_present_value_grid</a>()</code>,
<code><a href="#topic+implied_jump_process_volatility">implied_jump_process_volatility</a>()</code>
</p>

<hr>
<h2 id='form_present_value_grid'>Use a model to estimate the present value of financial derivatives on a grid of initial underlying values</h2><span id='topic+form_present_value_grid'></span>

<h3>Description</h3>

<p>Use a finite difference scheme to form estimates of present values for a variety
of stock prices on a grid of initial underlying prices, determined by constructing
a logarithmic equivalent conforming to the grid parameters <code>structure_constant</code>
and <code>structure_constant</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>form_present_value_grid(
  S0,
  num_time_steps,
  instruments,
  const_volatility = 0.5,
  const_short_rate = 0,
  const_default_intensity = 0,
  override_Tmax = NA,
  discount_factor_fcn = function(T, t, ...) {     exp(-const_short_rate * (T - t)) },
  default_intensity_fcn = function(t, S, ...) {     const_default_intensity + 0 * S },
  variance_cumulation_fcn = function(T, t) {     const_volatility^2 * (T - t) },
  dividends = NULL,
  borrow_cost = 0,
  dividend_rate = 0,
  structure_constant = 2,
  std_devs_width = 3,
  grid_center = NA
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="form_present_value_grid_+3A_s0">S0</code></td>
<td>
<p>An initial stock price, for setting grid scale</p>
</td></tr>
<tr><td><code id="form_present_value_grid_+3A_num_time_steps">num_time_steps</code></td>
<td>
<p>Minimum number of time steps in the grid</p>
</td></tr>
<tr><td><code id="form_present_value_grid_+3A_instruments">instruments</code></td>
<td>
<p>A list of instruments to be priced.  Each
one must have a <code>strike</code> and a <code>optionality_fcn</code>, as
with <code><a href="#topic+GridPricedInstrument">GridPricedInstrument</a></code> and its subclasses.</p>
</td></tr>
<tr><td><code id="form_present_value_grid_+3A_const_volatility">const_volatility</code></td>
<td>
<p>A constant to use for volatility in case <code>variance_cumulation_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="form_present_value_grid_+3A_const_short_rate">const_short_rate</code></td>
<td>
<p>A constant to use for the instantaneous interest rate in case <code>discount_factor_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="form_present_value_grid_+3A_const_default_intensity">const_default_intensity</code></td>
<td>
<p>A constant to use for the instantaneous default intensity in case <code>default_intensity_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="form_present_value_grid_+3A_override_tmax">override_Tmax</code></td>
<td>
<p>A different maximum time on the grid to enforce</p>
</td></tr>
<tr><td><code id="form_present_value_grid_+3A_discount_factor_fcn">discount_factor_fcn</code></td>
<td>
<p>A function for computing present values to
time <code>t</code> of various cashflows occurring during this timestep, with
arguments <code>T</code>, <code>t</code></p>
</td></tr>
<tr><td><code id="form_present_value_grid_+3A_default_intensity_fcn">default_intensity_fcn</code></td>
<td>
<p>A function for computing default intensity
occurring during this timestep, dependent on time and stock price, with
arguments <code>t</code>, <code>S</code>.</p>
</td></tr>
<tr><td><code id="form_present_value_grid_+3A_variance_cumulation_fcn">variance_cumulation_fcn</code></td>
<td>
<p>A function for computing total stock variance
occurring during this timestep, with arguments <code>T</code>, <code>t</code>.  E.g. with
a constant volatility <code class="reqn">s</code> this takes the form <code class="reqn">(T-t)s^2</code>.</p>
</td></tr>
<tr><td><code id="form_present_value_grid_+3A_dividends">dividends</code></td>
<td>
<p>A <code>data.frame</code> with columns <code>time</code>, <code>fixed</code>,
and <code>proportional</code>.  Dividend size at the given <code>time</code> is
then expected to be equal to <code>fixed + proportional * S / S0</code></p>
</td></tr>
<tr><td><code id="form_present_value_grid_+3A_borrow_cost">borrow_cost</code></td>
<td>
<p>Stock borrow cost, affecting the drift rate</p>
</td></tr>
<tr><td><code id="form_present_value_grid_+3A_dividend_rate">dividend_rate</code></td>
<td>
<p>Continuous dividend rate, affecting the drift rate</p>
</td></tr>
<tr><td><code id="form_present_value_grid_+3A_structure_constant">structure_constant</code></td>
<td>
<p>The maximum ratio between time intervals <code>dt</code>
and the square of space intervals <code>dz^2</code></p>
</td></tr>
<tr><td><code id="form_present_value_grid_+3A_std_devs_width">std_devs_width</code></td>
<td>
<p>The number of standard deviations, in <code>sigma * sqrt(T)</code>
units, to incorporate into the grid</p>
</td></tr>
<tr><td><code id="form_present_value_grid_+3A_grid_center">grid_center</code></td>
<td>
<p>A reasonable central value for the grid, defaults to S0 or an instrument strike</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If any instrument in the <code>instruments</code> has a strike, then the grid will be
normalized to the last such instrument's strike.
</p>


<h3>See Also</h3>

<p>Other Equity Dependent Default Intensity: 
<code><a href="#topic+find_present_value">find_present_value</a>()</code>,
<code><a href="#topic+fit_to_option_market_df">fit_to_option_market_df</a>()</code>,
<code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a>()</code>,
<code><a href="#topic+implied_jump_process_volatility">implied_jump_process_volatility</a>()</code>
</p>
<p>Other Implicit Grid Solver: 
<code><a href="#topic+construct_implicit_grid_structure">construct_implicit_grid_structure</a>()</code>,
<code><a href="#topic+find_present_value">find_present_value</a>()</code>,
<code><a href="#topic+infer_conforming_time_grid">infer_conforming_time_grid</a>()</code>,
<code><a href="#topic+integrate_pde">integrate_pde</a>()</code>,
<code><a href="#topic+iterate_grid_from_timestep">iterate_grid_from_timestep</a>()</code>,
<code><a href="#topic+take_implicit_timestep">take_implicit_timestep</a>()</code>,
<code><a href="#topic+timestep_instruments">timestep_instruments</a>()</code>
</p>

<hr>
<h2 id='GridPricedInstrument-class'>Representation of financial instrument amenable to grid pricing schemes</h2><span id='topic+GridPricedInstrument-class'></span><span id='topic+GridPricedInstrument'></span>

<h3>Description</h3>

<p>Our basic instrument defines a tenor/maturity, a method
to provide values in case of default, and a method
to correct instrument prices in light of exercise
decisions.
</p>


<h3>Fields</h3>


<dl>
<dt><code>maturity</code></dt><dd><p>The tenor, expiration date or terminal date by which the value of this security will be certain.</p>
</dd>
<dt><code>last_computed_grid</code></dt><dd><p>The most recently computed set of values from a grid pricing scheme.  Used internally for pricing chains of derivatives.</p>
</dd>
<dt><code>name</code></dt><dd><p>A mnemonic name for the instrument, not used by ragtop</p>
</dd>
</dl>


<h3>Methods</h3>


<dl>
<dt><code>optionality_fcn(v, ...)</code></dt><dd><p>Return a version of v at time t corrected for any optionality conditions.</p>
</dd>
<dt><code>recovery_fcn(v, S, t, ...)</code></dt><dd><p>Return recovery value, given non-default values v at time t.  Subclasses may be more elaborate, this method simply returns 0.0.</p>
</dd>
<dt><code>terminal_values(v, ...)</code></dt><dd><p>Return a terminal value. defaults to simply calling optionality_fcn.</p>
</dd>
</dl>

<hr>
<h2 id='implied_jump_process_volatility'>Implied volatility of any instrument</h2><span id='topic+implied_jump_process_volatility'></span>

<h3>Description</h3>

<p>Use the grid solver to generate instrument prices via <code>find_present_value</code> and run them
through a bisective root search method until a constant volatility matching the provided
instrument price has been found.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>implied_jump_process_volatility(
  instrument_price,
  instrument,
  ...,
  starting_volatility_estimate = 0.85,
  relative_tolerance = 0.005,
  max.iter = 100,
  max_vola = 4
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="implied_jump_process_volatility_+3A_instrument_price">instrument_price</code></td>
<td>
<p>Target price for root finder</p>
</td></tr>
<tr><td><code id="implied_jump_process_volatility_+3A_instrument">instrument</code></td>
<td>
<p>Instrument to search for the target price on, passed as
the sole instrument to <code><a href="#topic+find_present_value">find_present_value</a></code></p>
</td></tr>
<tr><td><code id="implied_jump_process_volatility_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed on to <code><a href="#topic+find_present_value">find_present_value</a></code></p>
</td></tr>
<tr><td><code id="implied_jump_process_volatility_+3A_starting_volatility_estimate">starting_volatility_estimate</code></td>
<td>
<p>Bisection method original guess</p>
</td></tr>
<tr><td><code id="implied_jump_process_volatility_+3A_relative_tolerance">relative_tolerance</code></td>
<td>
<p>Relative tolerance in instrument price defining the root-finder halting condition</p>
</td></tr>
<tr><td><code id="implied_jump_process_volatility_+3A_max.iter">max.iter</code></td>
<td>
<p>Maximum number of root-finder iterations allowed</p>
</td></tr>
<tr><td><code id="implied_jump_process_volatility_+3A_max_vola">max_vola</code></td>
<td>
<p>Maximum volatility to try</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Unlike <code>american_implied_volatility</code>, this routine allows for any legal
term structures and equity-linked default intensities.  For that reason, it eschews
the control variate tricks that make <code>american_implied_volatility</code> so much faster.
</p>
<p>Note that equity-linked default intensities can result in instrument prices that
are not monotonic in volatility.  This bisective root finder will find a solution
but not necessarily any particular one.
</p>


<h3>Value</h3>

<p>A list of present values, with the same names as <code>instruments</code>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+find_present_value">find_present_value</a></code> for the underlying
pricing algorithm, <code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a></code> for European options
without equity dependence of default intensity, <code><a href="#topic+american_implied_volatility">american_implied_volatility</a></code> for the same on American options
</p>
<p>Other Implied Volatilities: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+equivalent_bs_vola_to_jump">equivalent_bs_vola_to_jump</a>()</code>,
<code><a href="#topic+equivalent_jump_vola_to_bs">equivalent_jump_vola_to_bs</a>()</code>,
<code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>
<p>Other Equity Dependent Default Intensity: 
<code><a href="#topic+find_present_value">find_present_value</a>()</code>,
<code><a href="#topic+fit_to_option_market_df">fit_to_option_market_df</a>()</code>,
<code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a>()</code>,
<code><a href="#topic+form_present_value_grid">form_present_value_grid</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>implied_jump_process_volatility(
    25, AmericanOption(maturity=1.1, strike=100, callput=-1),
    S0=100, num_time_steps=50, relative_tolerance=1.e-3)

</code></pre>

<hr>
<h2 id='implied_volatilities'>Implied volatilities of european-exercise options under Black-Scholes or a jump-process extension</h2><span id='topic+implied_volatilities'></span>

<h3>Description</h3>

<p>Find default-free volatilities based on known interest rates and hazard rates, using
a given option price.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>implied_volatilities(
  option_price,
  callput,
  S0,
  K,
  r,
  time,
  const_default_intensity = 0,
  divrate = 0,
  borrow_cost = 0,
  dividends = NULL,
  relative_tolerance = 1e-06,
  max.iter = 100,
  max_vola = 4
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="implied_volatilities_+3A_option_price">option_price</code></td>
<td>
<p>Present option values (may be a vector)</p>
</td></tr>
<tr><td><code id="implied_volatilities_+3A_callput">callput</code></td>
<td>
<p>1 for calls, -1 for puts (may be a vector)</p>
</td></tr>
<tr><td><code id="implied_volatilities_+3A_s0">S0</code></td>
<td>
<p>initial underlying price (may be a vector)</p>
</td></tr>
<tr><td><code id="implied_volatilities_+3A_k">K</code></td>
<td>
<p>strike (may be a vector)</p>
</td></tr>
<tr><td><code id="implied_volatilities_+3A_r">r</code></td>
<td>
<p>risk-free interest rate (may be a vector)</p>
</td></tr>
<tr><td><code id="implied_volatilities_+3A_time">time</code></td>
<td>
<p>Time from <code>0</code> until expiration (may be a vector)</p>
</td></tr>
<tr><td><code id="implied_volatilities_+3A_const_default_intensity">const_default_intensity</code></td>
<td>
<p>hazard rate of underlying default (may be a vector)</p>
</td></tr>
<tr><td><code id="implied_volatilities_+3A_divrate">divrate</code></td>
<td>
<p>A continuous rate for dividends and other cashflows such as foreign interest rates (may be a vector)</p>
</td></tr>
<tr><td><code id="implied_volatilities_+3A_borrow_cost">borrow_cost</code></td>
<td>
<p>A continuous rate for stock borrow costs (may be a vector)</p>
</td></tr>
<tr><td><code id="implied_volatilities_+3A_dividends">dividends</code></td>
<td>
<p>A <code>data.frame</code> with columns <code>time</code>, <code>fixed</code>,
and <code>proportional</code>.  Dividend size at the given <code>time</code> is
then expected to be equal to <code>fixed + proportional * S / S0</code>.  Fixed
dividends will be converted to proprtional for purposes of this algorithm.</p>
</td></tr>
<tr><td><code id="implied_volatilities_+3A_relative_tolerance">relative_tolerance</code></td>
<td>
<p>Relative tolerance in option price to achieve before halting the search</p>
</td></tr>
<tr><td><code id="implied_volatilities_+3A_max.iter">max.iter</code></td>
<td>
<p>Number of iterations to try before abandoning the search</p>
</td></tr>
<tr><td><code id="implied_volatilities_+3A_max_vola">max_vola</code></td>
<td>
<p>Maximum volatility to try in the search</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Scalar volatilities
</p>


<h3>See Also</h3>

<p>Other Implied Volatilities: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+equivalent_bs_vola_to_jump">equivalent_bs_vola_to_jump</a>()</code>,
<code><a href="#topic+equivalent_jump_vola_to_bs">equivalent_jump_vola_to_bs</a>()</code>,
<code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a>()</code>,
<code><a href="#topic+implied_jump_process_volatility">implied_jump_process_volatility</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>
<p>Other European Options: 
<code><a href="#topic+black_scholes_on_term_structures">black_scholes_on_term_structures</a>()</code>,
<code><a href="#topic+blackscholes">blackscholes</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>
<p>Other Equity Independent Default Intensity: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+american">american</a>()</code>,
<code><a href="#topic+black_scholes_on_term_structures">black_scholes_on_term_structures</a>()</code>,
<code><a href="#topic+blackscholes">blackscholes</a>()</code>,
<code><a href="#topic+equivalent_bs_vola_to_jump">equivalent_bs_vola_to_jump</a>()</code>,
<code><a href="#topic+equivalent_jump_vola_to_bs">equivalent_jump_vola_to_bs</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>

<hr>
<h2 id='implied_volatilities_with_rates_struct'>Find the implied volatility of european-exercise options with a term structure of interest rates</h2><span id='topic+implied_volatilities_with_rates_struct'></span>

<h3>Description</h3>

<p>Use the provided discount factor function to infer constant short rates applicable to each
expiration time, then use the Black-Scholes formula to generate European option values and run them
through Newton's method until a constant volatility matching each provided
option price has been found.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>implied_volatilities_with_rates_struct(
  option_price,
  callput,
  S0,
  K,
  discount_factor_fcn,
  time,
  const_default_intensity = 0,
  divrate = 0,
  borrow_cost = 0,
  dividends = NULL,
  relative_tolerance = 1e-06,
  max.iter = 100,
  max_vola = 4
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="implied_volatilities_with_rates_struct_+3A_option_price">option_price</code></td>
<td>
<p>Present option values (may be a vector)</p>
</td></tr>
<tr><td><code id="implied_volatilities_with_rates_struct_+3A_callput">callput</code></td>
<td>
<p>1 for calls, -1 for puts (may be a vector)</p>
</td></tr>
<tr><td><code id="implied_volatilities_with_rates_struct_+3A_s0">S0</code></td>
<td>
<p>initial underlying prices (may be a vector)</p>
</td></tr>
<tr><td><code id="implied_volatilities_with_rates_struct_+3A_k">K</code></td>
<td>
<p>strikes (may be a vector)</p>
</td></tr>
<tr><td><code id="implied_volatilities_with_rates_struct_+3A_discount_factor_fcn">discount_factor_fcn</code></td>
<td>
<p>A function for computing present values to
time <code>t</code>, with arguments <code>T</code>, <code>t</code></p>
</td></tr>
<tr><td><code id="implied_volatilities_with_rates_struct_+3A_time">time</code></td>
<td>
<p>Time from <code>0</code> until expirations (may be a vector)</p>
</td></tr>
<tr><td><code id="implied_volatilities_with_rates_struct_+3A_const_default_intensity">const_default_intensity</code></td>
<td>
<p>hazard rates of underlying default  (may be a vector)</p>
</td></tr>
<tr><td><code id="implied_volatilities_with_rates_struct_+3A_divrate">divrate</code></td>
<td>
<p>A continuous rate for dividends and other cashflows such as foreign interest rates  (may be a vector)</p>
</td></tr>
<tr><td><code id="implied_volatilities_with_rates_struct_+3A_borrow_cost">borrow_cost</code></td>
<td>
<p>A continuous rate for stock borrow costs  (may be a vector)</p>
</td></tr>
<tr><td><code id="implied_volatilities_with_rates_struct_+3A_dividends">dividends</code></td>
<td>
<p>A <code>data.frame</code> with columns <code>time</code>, <code>fixed</code>,
and <code>proportional</code>.  Dividend size at the given <code>time</code> is
then expected to be equal to <code>fixed + proportional * S / S0</code>.  Fixed
dividends will be converted to proprtional for purposes of this algorithm.</p>
</td></tr>
<tr><td><code id="implied_volatilities_with_rates_struct_+3A_relative_tolerance">relative_tolerance</code></td>
<td>
<p>Relative tolerance in option price to achieve before halting the search</p>
</td></tr>
<tr><td><code id="implied_volatilities_with_rates_struct_+3A_max.iter">max.iter</code></td>
<td>
<p>Number of iterations to try before abandoning the search</p>
</td></tr>
<tr><td><code id="implied_volatilities_with_rates_struct_+3A_max_vola">max_vola</code></td>
<td>
<p>Maximum volatility to try in the search</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Differs from <code>implied_volatility_with_term_struct</code> by first computing constant interest rates
for each option, and then calling <code>implied_volatilities</code>
</p>


<h3>Value</h3>

<p>Scalar volatilities
</p>


<h3>See Also</h3>

<p><code><a href="#topic+implied_volatility">implied_volatility</a></code> for simpler cases with constant
parameters, <code><a href="#topic+implied_volatilities">implied_volatilities</a></code> for the underlying
algorithm with constant rates, <code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a></code> when
volatilities or survival probabilities also have a nontrivial term structure
</p>
<p>Other Implied Volatilities: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+equivalent_bs_vola_to_jump">equivalent_bs_vola_to_jump</a>()</code>,
<code><a href="#topic+equivalent_jump_vola_to_bs">equivalent_jump_vola_to_bs</a>()</code>,
<code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a>()</code>,
<code><a href="#topic+implied_jump_process_volatility">implied_jump_process_volatility</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>
<p>Other European Options: 
<code><a href="#topic+black_scholes_on_term_structures">black_scholes_on_term_structures</a>()</code>,
<code><a href="#topic+blackscholes">blackscholes</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>
<p>Other Equity Independent Default Intensity: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+american">american</a>()</code>,
<code><a href="#topic+black_scholes_on_term_structures">black_scholes_on_term_structures</a>()</code>,
<code><a href="#topic+blackscholes">blackscholes</a>()</code>,
<code><a href="#topic+equivalent_bs_vola_to_jump">equivalent_bs_vola_to_jump</a>()</code>,
<code><a href="#topic+equivalent_jump_vola_to_bs">equivalent_jump_vola_to_bs</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  d_fcn = function(T,t) {exp(-0.03*(T-t))}
  implied_volatilities_with_rates_struct(c(23,24,25),
         c(-1,1,1), 100, 100,
         discount_factor_fcn=d_fcn, time=c(4,4,5))

</code></pre>

<hr>
<h2 id='implied_volatility'>Implied volatility of european-exercise option under Black-Scholes or a jump-process extension</h2><span id='topic+implied_volatility'></span>

<h3>Description</h3>

<p>Find default-free volatility (not necessarily just Black-Scholes) based on
known interest rates and hazard rates, using a given option price.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>implied_volatility(
  option_price,
  callput,
  S0,
  K,
  r,
  time,
  const_default_intensity = 0,
  divrate = 0,
  borrow_cost = 0,
  dividends = NULL,
  relative_tolerance = 1e-06,
  max.iter = 100,
  max_vola = 4
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="implied_volatility_+3A_option_price">option_price</code></td>
<td>
<p>Present option value</p>
</td></tr>
<tr><td><code id="implied_volatility_+3A_callput">callput</code></td>
<td>
<p>1 for calls, -1 for puts</p>
</td></tr>
<tr><td><code id="implied_volatility_+3A_s0">S0</code></td>
<td>
<p>initial underlying price</p>
</td></tr>
<tr><td><code id="implied_volatility_+3A_k">K</code></td>
<td>
<p>strike</p>
</td></tr>
<tr><td><code id="implied_volatility_+3A_r">r</code></td>
<td>
<p>risk-free interest rate</p>
</td></tr>
<tr><td><code id="implied_volatility_+3A_time">time</code></td>
<td>
<p>Time from <code>0</code> until expiration</p>
</td></tr>
<tr><td><code id="implied_volatility_+3A_const_default_intensity">const_default_intensity</code></td>
<td>
<p>hazard rate of underlying default</p>
</td></tr>
<tr><td><code id="implied_volatility_+3A_divrate">divrate</code></td>
<td>
<p>A continuous rate for dividends and other cashflows such as foreign interest rates</p>
</td></tr>
<tr><td><code id="implied_volatility_+3A_borrow_cost">borrow_cost</code></td>
<td>
<p>A continuous rate for stock borrow costs</p>
</td></tr>
<tr><td><code id="implied_volatility_+3A_dividends">dividends</code></td>
<td>
<p>A <code>data.frame</code> with columns <code>time</code>, <code>fixed</code>,
and <code>proportional</code>.  Dividend size at the given <code>time</code> is
then expected to be equal to <code>fixed + proportional * S / S0</code>.  Fixed
dividends will be converted to proportional for purposes of this algorithm.  To handle
truly fixed dividends, see <code><a href="#topic+implied_jump_process_volatility">implied_jump_process_volatility</a></code></p>
</td></tr>
<tr><td><code id="implied_volatility_+3A_relative_tolerance">relative_tolerance</code></td>
<td>
<p>Relative tolerance in option price to achieve before halting the search</p>
</td></tr>
<tr><td><code id="implied_volatility_+3A_max.iter">max.iter</code></td>
<td>
<p>Number of iterations to try before abandoning the search</p>
</td></tr>
<tr><td><code id="implied_volatility_+3A_max_vola">max_vola</code></td>
<td>
<p>Maximum volatility to try in the search</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To get a straight Black-Scholes implied volatility, simply call this function with
<code>const_default_intensity</code> set to zero (the default).
</p>


<h3>Value</h3>

<p>A scalar volatility
</p>


<h3>See Also</h3>

<p>Other Implied Volatilities: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+equivalent_bs_vola_to_jump">equivalent_bs_vola_to_jump</a>()</code>,
<code><a href="#topic+equivalent_jump_vola_to_bs">equivalent_jump_vola_to_bs</a>()</code>,
<code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a>()</code>,
<code><a href="#topic+implied_jump_process_volatility">implied_jump_process_volatility</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>
</p>
<p>Other Equity Independent Default Intensity: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+american">american</a>()</code>,
<code><a href="#topic+black_scholes_on_term_structures">black_scholes_on_term_structures</a>()</code>,
<code><a href="#topic+blackscholes">blackscholes</a>()</code>,
<code><a href="#topic+equivalent_bs_vola_to_jump">equivalent_bs_vola_to_jump</a>()</code>,
<code><a href="#topic+equivalent_jump_vola_to_bs">equivalent_jump_vola_to_bs</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>
</p>
<p>Other European Options: 
<code><a href="#topic+black_scholes_on_term_structures">black_scholes_on_term_structures</a>()</code>,
<code><a href="#topic+blackscholes">blackscholes</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility_with_term_struct">implied_volatility_with_term_struct</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>implied_volatility(2.5, 1, 100, 105, 0.01, 0.75)
implied_volatility(option_price = 17,
                   callput = CALL, S0 = 250,  K=245,
                   r = 0.005, time = 2,
                   const_default_intensity = 0.03)
</code></pre>

<hr>
<h2 id='implied_volatility_with_term_struct'>Find the implied volatility of a european-exercise option with term structures</h2><span id='topic+implied_volatility_with_term_struct'></span>

<h3>Description</h3>

<p>Use the Black-Scholes formula to generate European option values and run them
through Newton's method until a constant volatility matching the provided
option price has been found.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>implied_volatility_with_term_struct(
  option_price,
  callput,
  S0,
  K,
  time,
  ...,
  starting_volatility_estimate = 0.5,
  relative_tolerance = 1e-06,
  max.iter = 100,
  max_vola = 4
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="implied_volatility_with_term_struct_+3A_option_price">option_price</code></td>
<td>
<p>Option price to match</p>
</td></tr>
<tr><td><code id="implied_volatility_with_term_struct_+3A_callput">callput</code></td>
<td>
<p>1 for calls, -1 for puts</p>
</td></tr>
<tr><td><code id="implied_volatility_with_term_struct_+3A_s0">S0</code></td>
<td>
<p>initial underlying price</p>
</td></tr>
<tr><td><code id="implied_volatility_with_term_struct_+3A_k">K</code></td>
<td>
<p>strike</p>
</td></tr>
<tr><td><code id="implied_volatility_with_term_struct_+3A_time">time</code></td>
<td>
<p>Time to expiration</p>
</td></tr>
<tr><td><code id="implied_volatility_with_term_struct_+3A_...">...</code></td>
<td>
<p>Further arguments to be passed on to <code>black_scholes_on_term_structures</code></p>
</td></tr>
<tr><td><code id="implied_volatility_with_term_struct_+3A_starting_volatility_estimate">starting_volatility_estimate</code></td>
<td>
<p>The Newton method's original guess</p>
</td></tr>
<tr><td><code id="implied_volatility_with_term_struct_+3A_relative_tolerance">relative_tolerance</code></td>
<td>
<p>Relative tolerance in instrument price defining the root-finder halting condition</p>
</td></tr>
<tr><td><code id="implied_volatility_with_term_struct_+3A_max.iter">max.iter</code></td>
<td>
<p>Maximum number of root-finder iterations allowed</p>
</td></tr>
<tr><td><code id="implied_volatility_with_term_struct_+3A_max_vola">max_vola</code></td>
<td>
<p>Maximum volatility to try</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Differs from <code>implied_volatility</code> by calling <code>black_scholes_on_term_structures</code> for
pricing, thereby allowing term structures of rates, and a nontrivial <code>survival_probability_fcn</code>
</p>


<h3>Value</h3>

<p>Estimated volatility
</p>


<h3>See Also</h3>

<p><code><a href="#topic+implied_volatility">implied_volatility</a></code> for simpler cases with constant
parameters, <code><a href="#topic+black_scholes_on_term_structures">black_scholes_on_term_structures</a></code> for the underlying
pricing algorithm, <code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a></code> when
neither volatilities nor survival probabilities have a nontrivial term structure
</p>
<p>Other Implied Volatilities: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+equivalent_bs_vola_to_jump">equivalent_bs_vola_to_jump</a>()</code>,
<code><a href="#topic+equivalent_jump_vola_to_bs">equivalent_jump_vola_to_bs</a>()</code>,
<code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a>()</code>,
<code><a href="#topic+implied_jump_process_volatility">implied_jump_process_volatility</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>
<p>Other Equity Independent Default Intensity: 
<code><a href="#topic+american_implied_volatility">american_implied_volatility</a>()</code>,
<code><a href="#topic+american">american</a>()</code>,
<code><a href="#topic+black_scholes_on_term_structures">black_scholes_on_term_structures</a>()</code>,
<code><a href="#topic+blackscholes">blackscholes</a>()</code>,
<code><a href="#topic+equivalent_bs_vola_to_jump">equivalent_bs_vola_to_jump</a>()</code>,
<code><a href="#topic+equivalent_jump_vola_to_bs">equivalent_jump_vola_to_bs</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>
<p>Other European Options: 
<code><a href="#topic+black_scholes_on_term_structures">black_scholes_on_term_structures</a>()</code>,
<code><a href="#topic+blackscholes">blackscholes</a>()</code>,
<code><a href="#topic+implied_volatilities_with_rates_struct">implied_volatilities_with_rates_struct</a>()</code>,
<code><a href="#topic+implied_volatilities">implied_volatilities</a>()</code>,
<code><a href="#topic+implied_volatility">implied_volatility</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Dividends
divs = data.frame(time=seq(from=0.11, to=2, by=0.25),
                  fixed=seq(1.5, 1, length.out=8),
                  proportional = seq(1, 1.5, length.out=8))
surv_prob_fcn = function(T, t, ...) {
  exp(-0.07 * (T - t)) }
disc_factor_fcn = function(T, t, ...) {
  exp(-0.03 * (T - t)) }
implied_volatility_with_term_struct(
    option_price = 12, S0 = 150, callput=PUT,
    K = 147.50, time=1.5,
    discount_factor_fcn=disc_factor_fcn,
    survival_probability_fcn=surv_prob_fcn,
    dividends=divs)
</code></pre>

<hr>
<h2 id='infer_conforming_time_grid'>A time grid with extra times inserted for coupons, calls and puts</h2><span id='topic+infer_conforming_time_grid'></span>

<h3>Description</h3>

<p>At its base, this function chooses a time grid with <code>1+min_num_time_steps</code>
elements from 0 to <code>Tmax</code>.  Any coupon, call, or put times occurring in
one of the supplied instruments are also inserted.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>infer_conforming_time_grid(min_num_time_steps, Tmax, instruments = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="infer_conforming_time_grid_+3A_min_num_time_steps">min_num_time_steps</code></td>
<td>
<p>The minimum number of timesteps the output vector should have</p>
</td></tr>
<tr><td><code id="infer_conforming_time_grid_+3A_tmax">Tmax</code></td>
<td>
<p>The maximum time on the grid</p>
</td></tr>
<tr><td><code id="infer_conforming_time_grid_+3A_instruments">instruments</code></td>
<td>
<p>A set of instruments whose maturity and terms
and conditions can introduce extra timesteps.  Each will be queried for the output of
a <code>critical_times</code> function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of times at which the grid should have nodes
</p>


<h3>See Also</h3>

<p>Other Implicit Grid Solver: 
<code><a href="#topic+construct_implicit_grid_structure">construct_implicit_grid_structure</a>()</code>,
<code><a href="#topic+find_present_value">find_present_value</a>()</code>,
<code><a href="#topic+form_present_value_grid">form_present_value_grid</a>()</code>,
<code><a href="#topic+integrate_pde">integrate_pde</a>()</code>,
<code><a href="#topic+iterate_grid_from_timestep">iterate_grid_from_timestep</a>()</code>,
<code><a href="#topic+take_implicit_timestep">take_implicit_timestep</a>()</code>,
<code><a href="#topic+timestep_instruments">timestep_instruments</a>()</code>
</p>

<hr>
<h2 id='integrate_pde'>Numerically integrate the pricing differential equation</h2><span id='topic+integrate_pde'></span>

<h3>Description</h3>

<p>Use an implicit integration scheme to numerically integrate
the pricing differential equation for each of the given instruments,
backwardating from time <code>Tmax</code> to time 0.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>integrate_pde(
  z,
  min_num_time_steps,
  S0,
  Tmax,
  instruments,
  stock_level_fcn,
  discount_factor_fcn,
  default_intensity_fcn,
  variance_cumulation_fcn,
  dividends = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="integrate_pde_+3A_z">z</code></td>
<td>
<p>Space grid value morphable to stock prices using <code>stock_level_fcn</code></p>
</td></tr>
<tr><td><code id="integrate_pde_+3A_min_num_time_steps">min_num_time_steps</code></td>
<td>
<p>The minimum number of timesteps used.  Calls,
puts and coupons may result in extra timesteps taken.</p>
</td></tr>
<tr><td><code id="integrate_pde_+3A_s0">S0</code></td>
<td>
<p>Time zero price of the base equity</p>
</td></tr>
<tr><td><code id="integrate_pde_+3A_tmax">Tmax</code></td>
<td>
<p>The maximum time on the grid, from which
all backwardation steps will take place.</p>
</td></tr>
<tr><td><code id="integrate_pde_+3A_instruments">instruments</code></td>
<td>
<p>A list of instruments to be priced.  Each
one must have a <code>strike</code> and a <code>optionality_fcn</code>, as
with <code><a href="#topic+GridPricedInstrument">GridPricedInstrument</a></code> and its subclasses.</p>
</td></tr>
<tr><td><code id="integrate_pde_+3A_stock_level_fcn">stock_level_fcn</code></td>
<td>
<p>A function for changing space grid value to stock
prices, with arguments <code>z</code> and <code>t</code></p>
</td></tr>
<tr><td><code id="integrate_pde_+3A_discount_factor_fcn">discount_factor_fcn</code></td>
<td>
<p>A function for computing present values to
time <code>t</code> of various cashflows occurring during this timestep, with
arguments <code>T</code>, <code>t</code></p>
</td></tr>
<tr><td><code id="integrate_pde_+3A_default_intensity_fcn">default_intensity_fcn</code></td>
<td>
<p>A function for computing default intensity
occurring during this timestep, dependent on time and stock price, with
arguments <code>t</code>, <code>S</code>.</p>
</td></tr>
<tr><td><code id="integrate_pde_+3A_variance_cumulation_fcn">variance_cumulation_fcn</code></td>
<td>
<p>A function for computing total stock variance
occurring during this timestep, with arguments <code>T</code>, <code>t</code>.  E.g. with
a constant volatility <code class="reqn">s</code> this takes the form <code class="reqn">(T-t)s^2</code>.</p>
</td></tr>
<tr><td><code id="integrate_pde_+3A_dividends">dividends</code></td>
<td>
<p>A <code>data.frame</code> with columns <code>time</code>, <code>fixed</code>,
and <code>proportional</code>.  Dividend size at the given <code>time</code> is
then expected to be equal to <code>fixed + proportional * S / S0</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A grid of present values of derivative prices, adapted to <code>z</code> at
each timestep.  Time zero value will appear in the first index.
</p>


<h3>See Also</h3>

<p>Other Implicit Grid Solver: 
<code><a href="#topic+construct_implicit_grid_structure">construct_implicit_grid_structure</a>()</code>,
<code><a href="#topic+find_present_value">find_present_value</a>()</code>,
<code><a href="#topic+form_present_value_grid">form_present_value_grid</a>()</code>,
<code><a href="#topic+infer_conforming_time_grid">infer_conforming_time_grid</a>()</code>,
<code><a href="#topic+iterate_grid_from_timestep">iterate_grid_from_timestep</a>()</code>,
<code><a href="#topic+take_implicit_timestep">take_implicit_timestep</a>()</code>,
<code><a href="#topic+timestep_instruments">timestep_instruments</a>()</code>
</p>

<hr>
<h2 id='is.blank'>Return TRUE if the argument is empty, NULL or NA</h2><span id='topic+is.blank'></span>

<h3>Description</h3>

<p>Return TRUE if the argument is empty, NULL or NA
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.blank(x, false.triggers = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is.blank_+3A_x">x</code></td>
<td>
<p>Argument to test</p>
</td></tr>
<tr><td><code id="is.blank_+3A_false.triggers">false.triggers</code></td>
<td>
<p>Whether to allow nonempty vectors of all FALSE to trigger this condition</p>
</td></tr>
</table>

<hr>
<h2 id='iterate_grid_from_timestep'>Iterate over a set of timesteps to integrate the pricing differential equation</h2><span id='topic+iterate_grid_from_timestep'></span>

<h3>Description</h3>

<p>Timestep an implicit integration scheme to numerically integrate
the pricing differential equation for each of the given instruments,
backwardating from time <code>Tmax</code> to time 0.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>iterate_grid_from_timestep(
  starting_time_step,
  time_pts,
  z,
  S0,
  instruments,
  stock_level_fcn,
  discount_factor_fcn,
  default_intensity_fcn,
  variance_cumulation_fcn,
  dividends = NULL,
  grid = NULL,
  original_grid_values = as.matrix(grid[1 + starting_time_step, , ])
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="iterate_grid_from_timestep_+3A_starting_time_step">starting_time_step</code></td>
<td>
<p>The index into time_pts of the first timestep
to be emplyed.  This must be no larger than the length of time_pts, minus one</p>
</td></tr>
<tr><td><code id="iterate_grid_from_timestep_+3A_time_pts">time_pts</code></td>
<td>
<p>Time nodes to be treated on the grid</p>
</td></tr>
<tr><td><code id="iterate_grid_from_timestep_+3A_z">z</code></td>
<td>
<p>Space grid value morphable to stock prices using <code>stock_level_fcn</code></p>
</td></tr>
<tr><td><code id="iterate_grid_from_timestep_+3A_s0">S0</code></td>
<td>
<p>Time zero price of the base equity</p>
</td></tr>
<tr><td><code id="iterate_grid_from_timestep_+3A_instruments">instruments</code></td>
<td>
<p>A list of instruments to be priced.  Each
one must have a <code>strike</code> and a <code>optionality_fcn</code>, as
with <code><a href="#topic+GridPricedInstrument">GridPricedInstrument</a></code> and its subclasses.</p>
</td></tr>
<tr><td><code id="iterate_grid_from_timestep_+3A_stock_level_fcn">stock_level_fcn</code></td>
<td>
<p>A function for changing space grid value to stock
prices, with arguments <code>z</code> and <code>t</code></p>
</td></tr>
<tr><td><code id="iterate_grid_from_timestep_+3A_discount_factor_fcn">discount_factor_fcn</code></td>
<td>
<p>A function for computing present values to
time <code>t</code> of various cashflows occurring during this timestep, with
arguments <code>T</code>, <code>t</code></p>
</td></tr>
<tr><td><code id="iterate_grid_from_timestep_+3A_default_intensity_fcn">default_intensity_fcn</code></td>
<td>
<p>A function for computing default intensity
occurring during this timestep, dependent on time and stock price, with
arguments <code>t</code>, <code>S</code>.</p>
</td></tr>
<tr><td><code id="iterate_grid_from_timestep_+3A_variance_cumulation_fcn">variance_cumulation_fcn</code></td>
<td>
<p>A function for computing total stock variance
occurring during this timestep, with arguments <code>T</code>, <code>t</code>.  E.g. with
a constant volatility <code class="reqn">s</code> this takes the form <code class="reqn">(T-t)s^2</code>.</p>
</td></tr>
<tr><td><code id="iterate_grid_from_timestep_+3A_dividends">dividends</code></td>
<td>
<p>A <code>data.frame</code> with columns <code>time</code>, <code>fixed</code>,
and <code>proportional</code>.  Dividend size at the given <code>time</code> is
then expected to be equal to <code>fixed + proportional * S / S0</code></p>
</td></tr>
<tr><td><code id="iterate_grid_from_timestep_+3A_grid">grid</code></td>
<td>
<p>An optional grid into which results at each timestep will
be written.  Its size should be at least
<code>(1+starting_time_step, length(z), length(instruments))</code></p>
</td></tr>
<tr><td><code id="iterate_grid_from_timestep_+3A_original_grid_values">original_grid_values</code></td>
<td>
<p>Grid values to timestep from</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Either a populated grid of present values of derivative prices, or a matrix
of values at the first time point, adapted to <code>z</code> at
each timestep.  Time zero value will appear in the first index of any grid.
</p>


<h3>See Also</h3>

<p>Other Implicit Grid Solver: 
<code><a href="#topic+construct_implicit_grid_structure">construct_implicit_grid_structure</a>()</code>,
<code><a href="#topic+find_present_value">find_present_value</a>()</code>,
<code><a href="#topic+form_present_value_grid">form_present_value_grid</a>()</code>,
<code><a href="#topic+infer_conforming_time_grid">infer_conforming_time_grid</a>()</code>,
<code><a href="#topic+integrate_pde">integrate_pde</a>()</code>,
<code><a href="#topic+take_implicit_timestep">take_implicit_timestep</a>()</code>,
<code><a href="#topic+timestep_instruments">timestep_instruments</a>()</code>
</p>

<hr>
<h2 id='penalty_with_intensity_link'>Helper function (volatility-normalized pricing error) for calibration of equity-linked default intensity</h2><span id='topic+penalty_with_intensity_link'></span>

<h3>Description</h3>

<p>Given a set SDE parameters, form a volatility term structure that fairly precisely matches
the supplied prices of the <code>variance_instruments</code>.  Then use that term structure and
the default intensity to price all the <code>fit_instruments</code>, and compare them to the
<code>fit_instrument_prices</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>penalty_with_intensity_link(
  p,
  s,
  h,
  variance_instruments,
  variance_instrument_prices,
  variance_instrument_spreads,
  fit_instruments,
  fit_instrument_prices,
  fit_instrument_spreads,
  fit_instrument_weights,
  S0,
  num_time_steps = 30,
  const_short_rate = 0,
  discount_factor_fcn = function(T, t) {     exp(-const_short_rate * (T - t)) },
  ...,
  relative_spread_tolerance = 0.15,
  num_variance_time_steps = 30
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="penalty_with_intensity_link_+3A_p">p</code></td>
<td>
<p>Power of default intensity</p>
</td></tr>
<tr><td><code id="penalty_with_intensity_link_+3A_s">s</code></td>
<td>
<p>Proportion of constant default intensity</p>
</td></tr>
<tr><td><code id="penalty_with_intensity_link_+3A_h">h</code></td>
<td>
<p>Base default intensity</p>
</td></tr>
<tr><td><code id="penalty_with_intensity_link_+3A_variance_instruments">variance_instruments</code></td>
<td>
<p>A list of instruments in strictly increasing order
of maturity, from which the volatility term structure will be inferred.  Once the
calibration is finished, the chosen parameters will reproduce the prices of
these instruments with fairly high precision.</p>
</td></tr>
<tr><td><code id="penalty_with_intensity_link_+3A_variance_instrument_prices">variance_instrument_prices</code></td>
<td>
<p>Central price targets for the variance instruments</p>
</td></tr>
<tr><td><code id="penalty_with_intensity_link_+3A_variance_instrument_spreads">variance_instrument_spreads</code></td>
<td>
<p>Bid-offer spreads used to normalize errors
in variance instrument prices during term structure fitting</p>
</td></tr>
<tr><td><code id="penalty_with_intensity_link_+3A_fit_instruments">fit_instruments</code></td>
<td>
<p>A list of instruments in any order, from which the
mispricing penalties used for judging fit quality will be computed</p>
</td></tr>
<tr><td><code id="penalty_with_intensity_link_+3A_fit_instrument_prices">fit_instrument_prices</code></td>
<td>
<p>Central price targets for the variance instruments</p>
</td></tr>
<tr><td><code id="penalty_with_intensity_link_+3A_fit_instrument_spreads">fit_instrument_spreads</code></td>
<td>
<p>Bid-offer spreads used to normalize errors
in fit instrument prices during default intensity</p>
</td></tr>
<tr><td><code id="penalty_with_intensity_link_+3A_fit_instrument_weights">fit_instrument_weights</code></td>
<td>
<p>Weights applied to relative errors in fit
instrument prices before summing to form the penalty</p>
</td></tr>
<tr><td><code id="penalty_with_intensity_link_+3A_s0">S0</code></td>
<td>
<p>Current underlying price</p>
</td></tr>
<tr><td><code id="penalty_with_intensity_link_+3A_num_time_steps">num_time_steps</code></td>
<td>
<p>Time step count passed on to <code><a href="#topic+find_present_value">find_present_value</a></code>
while fitting instrument values</p>
</td></tr>
<tr><td><code id="penalty_with_intensity_link_+3A_const_short_rate">const_short_rate</code></td>
<td>
<p>A constant to use for the instantaneous interest rate in case <code>discount_factor_fcn</code>
is not given</p>
</td></tr>
<tr><td><code id="penalty_with_intensity_link_+3A_discount_factor_fcn">discount_factor_fcn</code></td>
<td>
<p>A function for computing present values to
time <code>t</code> of various cashflows occurring during this timestep, with
arguments <code>T</code>, <code>t</code></p>
</td></tr>
<tr><td><code id="penalty_with_intensity_link_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="#topic+price_with_intensity_link">price_with_intensity_link</a></code></p>
</td></tr>
<tr><td><code id="penalty_with_intensity_link_+3A_relative_spread_tolerance">relative_spread_tolerance</code></td>
<td>
<p>Tolerance to apply in
calling <code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a></code></p>
</td></tr>
<tr><td><code id="penalty_with_intensity_link_+3A_num_variance_time_steps">num_variance_time_steps</code></td>
<td>
<p>Number of time steps to use in
calling <code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Forms implied Black-Scholes volatilities from all supplied mid prices, and their
implied bid and offer prices, as well as from the prices computed by the grid solver. Each
instrument is then assigned an error term component in proportion to its weight
and the pricing error (in implied vol terms) divided by the spread (also in implied
vol terms).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+price_with_intensity_link">price_with_intensity_link</a></code> for the pricing function
</p>

<hr>
<h2 id='price_with_intensity_link'>Helper function (instrument pricing) for calibration of equity-linked default intensity</h2><span id='topic+price_with_intensity_link'></span>

<h3>Description</h3>

<p>Given derivative instruments (subclasses of
GridPricedInstrument, though typically either <code><a href="#topic+AmericanOption">AmericanOption</a></code>
or <code><a href="#topic+EuropeanOption">EuropeanOption</a></code> objects), along with their prices and spreads, calibrate
variance cumulation (the
at-the-money volatility of the continuous process) and then price the instruments via equity linked default
intensity of the form $h(s + (1-s)(S0/S_t)^p)$.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>price_with_intensity_link(
  p,
  s,
  h,
  variance_instruments,
  variance_instrument_prices,
  variance_instrument_spreads,
  fit_instruments,
  S0,
  num_time_steps = 30,
  ...,
  relative_spread_tolerance = 0.15,
  num_variance_time_steps = 30
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="price_with_intensity_link_+3A_p">p</code></td>
<td>
<p>Power of default intensity</p>
</td></tr>
<tr><td><code id="price_with_intensity_link_+3A_s">s</code></td>
<td>
<p>Proportion of constant default intensity</p>
</td></tr>
<tr><td><code id="price_with_intensity_link_+3A_h">h</code></td>
<td>
<p>Base default intensity</p>
</td></tr>
<tr><td><code id="price_with_intensity_link_+3A_variance_instruments">variance_instruments</code></td>
<td>
<p>A list of instruments in strictly increasing order
of maturity, from which the volatility term structure will be inferred.  Once the
calibration is finished, the chosen parameters will reproduce the prices of
these instruments with fairly high precision.</p>
</td></tr>
<tr><td><code id="price_with_intensity_link_+3A_variance_instrument_prices">variance_instrument_prices</code></td>
<td>
<p>Central price targets for the variance instruments</p>
</td></tr>
<tr><td><code id="price_with_intensity_link_+3A_variance_instrument_spreads">variance_instrument_spreads</code></td>
<td>
<p>Bid-offer spreads used to normalize errors
in variance instrument prices during term structure fitting</p>
</td></tr>
<tr><td><code id="price_with_intensity_link_+3A_fit_instruments">fit_instruments</code></td>
<td>
<p>A list of instruments in any order, from which the
mispricing penalties used for judging fit quality will be computed</p>
</td></tr>
<tr><td><code id="price_with_intensity_link_+3A_s0">S0</code></td>
<td>
<p>Current underlying price</p>
</td></tr>
<tr><td><code id="price_with_intensity_link_+3A_num_time_steps">num_time_steps</code></td>
<td>
<p>Time step count passed on to <code><a href="#topic+find_present_value">find_present_value</a></code>
while fitting instrument values</p>
</td></tr>
<tr><td><code id="price_with_intensity_link_+3A_...">...</code></td>
<td>
<p>Further arguments passed to both
<code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a></code> and to
<code><a href="#topic+find_present_value">find_present_value</a></code></p>
</td></tr>
<tr><td><code id="price_with_intensity_link_+3A_relative_spread_tolerance">relative_spread_tolerance</code></td>
<td>
<p>Tolerance to apply in
calling <code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a></code></p>
</td></tr>
<tr><td><code id="price_with_intensity_link_+3A_num_variance_time_steps">num_variance_time_steps</code></td>
<td>
<p>Number of time steps to use in
calling <code><a href="#topic+fit_variance_cumulation">fit_variance_cumulation</a></code></p>
</td></tr>
</table>

<hr>
<h2 id='PUT'>Constant PUT for defining option contracts</h2><span id='topic+PUT'></span>

<h3>Description</h3>

<p>Constant PUT for defining option contracts
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PUT
</code></pre>


<h3>Format</h3>

<p>An object of class <code>numeric</code> of length 1.</p>

<hr>
<h2 id='Quandl_df_fcn_UST'>Get a US Treasury curve discount factor function</h2><span id='topic+Quandl_df_fcn_UST'></span>

<h3>Description</h3>

<p>This is a caching wrapper for <code><a href="#topic+Quandl_df_fcn_UST_raw">Quandl_df_fcn_UST_raw</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Quandl_df_fcn_UST(..., envir = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Quandl_df_fcn_UST_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="#topic+Quandl_df_fcn_UST_raw">Quandl_df_fcn_UST_raw</a></code></p>
</td></tr>
<tr><td><code id="Quandl_df_fcn_UST_+3A_envir">envir</code></td>
<td>
<p>Environment passed to <code><a href="#topic+Quandl_df_fcn_UST_raw">Quandl_df_fcn_UST_raw</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A function taking two time arguments, which returns the discount factor from the second to the first
</p>

<hr>
<h2 id='Quandl_df_fcn_UST_raw'>Get a US Treasury curve discount factor function</h2><span id='topic+Quandl_df_fcn_UST_raw'></span>

<h3>Description</h3>

<p>Get a US Treasury curve discount factor function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Quandl_df_fcn_UST_raw(on_date)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Quandl_df_fcn_UST_raw_+3A_on_date">on_date</code></td>
<td>
<p>Date for which to query Quandl for the curve</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A function taking two time arguments, which returns the discount factor from the second to the first
</p>

<hr>
<h2 id='shift_for_dividends'>Shift a set of grid values for dividends paid, using spline interpolation</h2><span id='topic+shift_for_dividends'></span>

<h3>Description</h3>

<p>Shift a set of grid values for dividends paid, using spline interpolation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>shift_for_dividends(grid_values_before_shift, stock_prices, div_sum)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="shift_for_dividends_+3A_grid_values_before_shift">grid_values_before_shift</code></td>
<td>
<p>Values on grid before accounting for
expected dividends</p>
</td></tr>
<tr><td><code id="shift_for_dividends_+3A_stock_prices">stock_prices</code></td>
<td>
<p>Stock prices for which to shift the grid</p>
</td></tr>
<tr><td><code id="shift_for_dividends_+3A_div_sum">div_sum</code></td>
<td>
<p>Sum of dividend values at each grid point</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object like <code>grid_values_before_shift</code> with entries shifted
according to the dividend sums
</p>


<h3>See Also</h3>

<p>Other Dividends: 
<code><a href="#topic+adjust_for_dividends">adjust_for_dividends</a>()</code>,
<code><a href="#topic+time_adj_dividends">time_adj_dividends</a>()</code>
</p>

<hr>
<h2 id='spot_to_df_fcn'>Create a discount factor function from a yield curve</h2><span id='topic+spot_to_df_fcn'></span>

<h3>Description</h3>

<p>Use a piecewise constant approximation to the given spot curve to
generate a function capable of returning corresponding discount factors
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spot_to_df_fcn(yield_curve)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spot_to_df_fcn_+3A_yield_curve">yield_curve</code></td>
<td>
<p>A data.frame with numeric columns <code>time</code> (in
increasing order) and <code>rate</code> (in natural units)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A function taking two time arguments, which returns the discount factor from the second to the first
</p>


<h3>Examples</h3>

<pre><code class='language-R'>disct_fcn = ragtop::spot_to_df_fcn(
  data.frame(time=c(1, 5, 10, 15),
             rate=c(0.01, 0.02, 0.03, 0.05)))
print(disct_fcn(1, 0.5))
</code></pre>

<hr>
<h2 id='take_implicit_timestep'>Backwardate grid values one timestep</h2><span id='topic+take_implicit_timestep'></span>

<h3>Description</h3>

<p>Take one timestep of an implicit solver for a given instrument
</p>


<h3>Usage</h3>

<pre><code class='language-R'>take_implicit_timestep(
  t,
  S,
  full_discount_factor,
  local_discount_factor,
  discount_factor_fcn,
  prev_grid_values,
  survival_probabilities,
  tridiag_matrix_entries,
  instrument = NULL,
  dividends = NULL,
  instr_name = "this instrument"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="take_implicit_timestep_+3A_t">t</code></td>
<td>
<p>Time after this timestep has been taken</p>
</td></tr>
<tr><td><code id="take_implicit_timestep_+3A_s">S</code></td>
<td>
<p>Underlying equity values for the grid</p>
</td></tr>
<tr><td><code id="take_implicit_timestep_+3A_full_discount_factor">full_discount_factor</code></td>
<td>
<p>A discount factor for the transform from
grid values to actual derivative prices</p>
</td></tr>
<tr><td><code id="take_implicit_timestep_+3A_local_discount_factor">local_discount_factor</code></td>
<td>
<p>A discount factor to apply to
recovery values</p>
</td></tr>
<tr><td><code id="take_implicit_timestep_+3A_discount_factor_fcn">discount_factor_fcn</code></td>
<td>
<p>A function for computing present values to
time <code>t</code> of various cashflows occurring during this timestep, with
arguments <code>T</code>, <code>t</code></p>
</td></tr>
<tr><td><code id="take_implicit_timestep_+3A_prev_grid_values">prev_grid_values</code></td>
<td>
<p>A vector of space grid values from the
previously calculated timestep</p>
</td></tr>
<tr><td><code id="take_implicit_timestep_+3A_survival_probabilities">survival_probabilities</code></td>
<td>
<p>Vector of probabilities of survival
for each space grid node</p>
</td></tr>
<tr><td><code id="take_implicit_timestep_+3A_tridiag_matrix_entries">tridiag_matrix_entries</code></td>
<td>
<p>Diagonal, superdiagonal and subdiagonal
of tridiagonal matrix from the numerical integrator</p>
</td></tr>
<tr><td><code id="take_implicit_timestep_+3A_instrument">instrument</code></td>
<td>
<p>If not NULL/NA,  must have a <code>recovery_fcn</code> and
an <code>optionality_fcn</code> though those properties are
themselves allowed to be NA.</p>
</td></tr>
<tr><td><code id="take_implicit_timestep_+3A_dividends">dividends</code></td>
<td>
<p>A <code>data.frame</code> with columns <code>time</code>, <code>fixed</code>,
and <code>proportional</code>.  Dividend size at the given <code>time</code> is
then expected to be equal to <code>fixed + proportional * S / S0</code></p>
</td></tr>
<tr><td><code id="take_implicit_timestep_+3A_instr_name">instr_name</code></td>
<td>
<p>Name of instrument to use in log messages</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Grid values for the instrument after taking the implicit timestep
</p>


<h3>See Also</h3>

<p>Other Implicit Grid Solver: 
<code><a href="#topic+construct_implicit_grid_structure">construct_implicit_grid_structure</a>()</code>,
<code><a href="#topic+find_present_value">find_present_value</a>()</code>,
<code><a href="#topic+form_present_value_grid">form_present_value_grid</a>()</code>,
<code><a href="#topic+infer_conforming_time_grid">infer_conforming_time_grid</a>()</code>,
<code><a href="#topic+integrate_pde">integrate_pde</a>()</code>,
<code><a href="#topic+iterate_grid_from_timestep">iterate_grid_from_timestep</a>()</code>,
<code><a href="#topic+timestep_instruments">timestep_instruments</a>()</code>
</p>

<hr>
<h2 id='time_adj_dividends'>Find the sum of time-adjusted dividend values</h2><span id='topic+time_adj_dividends'></span>

<h3>Description</h3>

<p>For each of the N elements of <code>S/h</code> find the sum of the
given M dividends, discounted to <code>t_final</code> by <code>r</code> and <code>h</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>time_adj_dividends(relevant_divs, t_final, r, h, S, S0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="time_adj_dividends_+3A_relevant_divs">relevant_divs</code></td>
<td>
<p>A <code>data.frame</code> with columns <code>time</code>, <code>fixed</code>,
and <code>proportional</code>.  Dividend size at the given <code>time</code> is
then expected to be equal to <code>fixed + proportional * S / S0</code></p>
</td></tr>
<tr><td><code id="time_adj_dividends_+3A_t_final">t_final</code></td>
<td>
<p>Time beyond which to ignore dividends</p>
</td></tr>
<tr><td><code id="time_adj_dividends_+3A_r">r</code></td>
<td>
<p>risk-free interest rate</p>
</td></tr>
<tr><td><code id="time_adj_dividends_+3A_h">h</code></td>
<td>
<p>Default intensities</p>
</td></tr>
<tr><td><code id="time_adj_dividends_+3A_s">S</code></td>
<td>
<p>Stock prices</p>
</td></tr>
<tr><td><code id="time_adj_dividends_+3A_s0">S0</code></td>
<td>
<p>initial underlying price</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Sum of dividends, at each grid node
</p>


<h3>See Also</h3>

<p>Other Dividends: 
<code><a href="#topic+adjust_for_dividends">adjust_for_dividends</a>()</code>,
<code><a href="#topic+shift_for_dividends">shift_for_dividends</a>()</code>
</p>

<hr>
<h2 id='TIME_RESOLUTION_FACTOR'>Constant to define when times are considered so close to each other
that they should be treated as simultaneous</h2><span id='topic+TIME_RESOLUTION_FACTOR'></span>

<h3>Description</h3>

<p>Constant to define when times are considered so close to each other
that they should be treated as simultaneous
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TIME_RESOLUTION_FACTOR
</code></pre>


<h3>Format</h3>

<p>An object of class <code>numeric</code> of length 1.</p>

<hr>
<h2 id='TIME_RESOLUTION_SIGNIF_DIGITS'>Constant to define when times are considered so close to each other
that they should be treated as simultaneous, in terms of significant
digits</h2><span id='topic+TIME_RESOLUTION_SIGNIF_DIGITS'></span>

<h3>Description</h3>

<p>Constant to define when times are considered so close to each other
that they should be treated as simultaneous, in terms of significant
digits
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TIME_RESOLUTION_SIGNIF_DIGITS
</code></pre>


<h3>Format</h3>

<p>An object of class <code>numeric</code> of length 1.</p>

<hr>
<h2 id='timestep_instruments'>Take an implicit timestep for all the given instruments</h2><span id='topic+timestep_instruments'></span>

<h3>Description</h3>

<p>Backwardate grid values for all the given instruments from a set of grid
values matched to time <code>t+dt</code> to form a new set of grid value as
of time <code>t</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>timestep_instruments(
  z,
  prev_grid_values,
  t,
  dt,
  S0,
  instruments,
  stock_level_fcn,
  discount_factor_fcn,
  default_intensity_fcn,
  variance_cumulation_fcn,
  dividends = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="timestep_instruments_+3A_z">z</code></td>
<td>
<p>Space grid value morphable to stock prices using <code>stock_level_fcn</code></p>
</td></tr>
<tr><td><code id="timestep_instruments_+3A_prev_grid_values">prev_grid_values</code></td>
<td>
<p>A matrix with one column for each
instrument and one row for each of the <code class="reqn">N</code> values of <code>z</code></p>
</td></tr>
<tr><td><code id="timestep_instruments_+3A_t">t</code></td>
<td>
<p>Time after this timestep has been taken</p>
</td></tr>
<tr><td><code id="timestep_instruments_+3A_dt">dt</code></td>
<td>
<p>Interval to the end of this timestep</p>
</td></tr>
<tr><td><code id="timestep_instruments_+3A_s0">S0</code></td>
<td>
<p>Time zero price of the base equity</p>
</td></tr>
<tr><td><code id="timestep_instruments_+3A_instruments">instruments</code></td>
<td>
<p>Instruments corresponding to layers of the value grid in <code>prev_grid_values</code></p>
</td></tr>
<tr><td><code id="timestep_instruments_+3A_stock_level_fcn">stock_level_fcn</code></td>
<td>
<p>A function for changing space grid value to stock
prices, with arguments <code>z</code> and <code>t</code></p>
</td></tr>
<tr><td><code id="timestep_instruments_+3A_discount_factor_fcn">discount_factor_fcn</code></td>
<td>
<p>A function for computing present values to
time <code>t</code> of various cashflows occurring during this timestep, with
arguments <code>T</code>, <code>t</code></p>
</td></tr>
<tr><td><code id="timestep_instruments_+3A_default_intensity_fcn">default_intensity_fcn</code></td>
<td>
<p>A function for computing default intensity
occurring during this timestep, dependent on time and stock price, with
arguments <code>t</code>, <code>S</code>.</p>
</td></tr>
<tr><td><code id="timestep_instruments_+3A_variance_cumulation_fcn">variance_cumulation_fcn</code></td>
<td>
<p>A function for computing total stock variance
occurring during this timestep, with arguments <code>T</code>, <code>t</code>.  E.g. with
a constant volatility <code class="reqn">s</code> this takes the form <code class="reqn">(T-t)s^2</code>.</p>
</td></tr>
<tr><td><code id="timestep_instruments_+3A_dividends">dividends</code></td>
<td>
<p>A <code>data.frame</code> with columns <code>time</code>, <code>fixed</code>,
and <code>proportional</code>.  Dividend size at the given <code>time</code> is
then expected to be equal to <code>fixed + proportional * S / S0</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Grid values after applying an implicit timestep
</p>


<h3>See Also</h3>

<p>Other Implicit Grid Solver: 
<code><a href="#topic+construct_implicit_grid_structure">construct_implicit_grid_structure</a>()</code>,
<code><a href="#topic+find_present_value">find_present_value</a>()</code>,
<code><a href="#topic+form_present_value_grid">form_present_value_grid</a>()</code>,
<code><a href="#topic+infer_conforming_time_grid">infer_conforming_time_grid</a>()</code>,
<code><a href="#topic+integrate_pde">integrate_pde</a>()</code>,
<code><a href="#topic+iterate_grid_from_timestep">iterate_grid_from_timestep</a>()</code>,
<code><a href="#topic+take_implicit_timestep">take_implicit_timestep</a>()</code>
</p>

<hr>
<h2 id='TSLAMarket'>Market information snapshot for TSLA options</h2><span id='topic+TSLAMarket'></span>

<h3>Description</h3>

<p>A dataset containing option contract details and a
snapshot of market prices
for Tesla Motors (TSLA) equity options, interest rates and an equity price.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TSLAMarket
</code></pre>


<h3>Format</h3>

<p>An object of class <code>list</code> of length 3.</p>


<h3>Details</h3>

<p>The TSLAMarket list contains three elements:
</p>

<ul>
<li><p><code>S0</code>: The stock price as of snapshot time
</p>
</li>
<li><p><code>risk_free_rates</code>: The spot risk-free rate curve as of snapshot time
</p>
</li>
<li><p><code>options</code>: A data frame with details of the options market
</p>
</li></ul>


<hr>
<h2 id='value_from_prior_coupons'>Present value of past coupons paid</h2><span id='topic+value_from_prior_coupons'></span>

<h3>Description</h3>

<p>Present value as of time <code>t</code> for coupons paid since the <code>model_t</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>value_from_prior_coupons(t, coupons_df, discount_factor_fcn, model_t = 0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="value_from_prior_coupons_+3A_t">t</code></td>
<td>
<p>The time toward which all coupons should be present valued</p>
</td></tr>
<tr><td><code id="value_from_prior_coupons_+3A_coupons_df">coupons_df</code></td>
<td>
<p>A data.frame of details for each coupon.  It should have the
columns <code>payment_time</code> and <code>payment_size</code>.</p>
</td></tr>
<tr><td><code id="value_from_prior_coupons_+3A_discount_factor_fcn">discount_factor_fcn</code></td>
<td>
<p>A function specifying how the contract says future coupons should be discounted for this instrument in case the acceleration clause is triggered</p>
</td></tr>
<tr><td><code id="value_from_prior_coupons_+3A_model_t">model_t</code></td>
<td>
<p>The payment time beyond which coupons will be included in this computation</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other Bond Coupons: 
<code><a href="#topic+accelerated_coupon_value">accelerated_coupon_value</a>()</code>,
<code><a href="#topic+coupon_value_at_exercise">coupon_value_at_exercise</a>()</code>
</p>

<hr>
<h2 id='variance_cumulation_from_vols'>Create a variance cumulation function from a volatility term structure</h2><span id='topic+variance_cumulation_from_vols'></span>

<h3>Description</h3>

<p>Given a volatility term structure, create a corresponding variance
cumulation function.  The function assumes piecewise constant
forward volatility, with the final such forward volatility
extending to infinity.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>variance_cumulation_from_vols(vols_df)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="variance_cumulation_from_vols_+3A_vols_df">vols_df</code></td>
<td>
<p>A data.frame with numeric columns <code>time</code> (in
increasing order) and <code>volatility</code> (not decreasing so quickly
as to give negative forward variance)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A function taking two time arguments, which returns the cumulated
variance from the second to the first
</p>


<h3>Examples</h3>

<pre><code class='language-R'>vc = variance_cumulation_from_vols(
  data.frame(time=c(0.1,2,3),
  volatility=c(0.2,0.5,1.2)))
vc(1.5, 0)

</code></pre>

<hr>
<h2 id='ZeroCouponBond-class'>A simple contract paying the <code>notional</code> amount at the <code>maturity</code></h2><span id='topic+ZeroCouponBond-class'></span><span id='topic+ZeroCouponBond'></span>

<h3>Description</h3>

<p>A simple contract paying the <code>notional</code> amount at the <code>maturity</code>
</p>


<h3>Fields</h3>


<dl>
<dt><code>notional</code></dt><dd><p>The amount that will be paid at <code>maturity</code>, conditional on survival</p>
</dd>
<dt><code>recovery_rate</code></dt><dd><p>The proportion of notional that would be expected to be paid to bond holders after bankruptcy court proceedings</p>
</dd>
<dt><code>discount_factor_fcn</code></dt><dd><p>A function specifying how cashflows should generally be discounted for this instrument</p>
</dd>
</dl>


<h3>Methods</h3>


<dl>
<dt><code>optionality_fcn(v, ...)</code></dt><dd><p>Return a version of v at time t corrected for any optionality conditions.</p>
</dd>
<dt><code>recovery_fcn(v, S, t, ...)</code></dt><dd><p>Return recovery value, given non-default values v at time t.  Subclasses may be more elaborate, this method simply returns 0.0.</p>
</dd>
</dl>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
