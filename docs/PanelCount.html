<!DOCTYPE html><html><head><title>Help for package PanelCount</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {PanelCount}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#PanelCount'><p>Panel Count Models with Random Effects and/or Sample Selection</p></a></li>
<li><a href='#PLN_RE'><p>A Poisson Lognormal Model with Random Effects</p></a></li>
<li><a href='#PoissonRE'><p>A Poisson Model with Random Effects</p></a></li>
<li><a href='#predict_ProbitRE_PLNRE'><p>Predictions of ProbitRE_PLNRE model on new sample</p></a></li>
<li><a href='#predict_ProbitRE_PoissonRE'><p>Predictions of ProbitRE_PoissonRE model on new sample</p></a></li>
<li><a href='#ProbitRE'><p>A Probit Model with Random Effects</p></a></li>
<li><a href='#ProbitRE_PLNRE'><p>Poisson Lognormal Model with Random Effects and Sample Selection</p></a></li>
<li><a href='#ProbitRE_PoissonRE'><p>Poisson RE model with Sample Selection</p></a></li>
<li><a href='#sim'><p>Simulated dataset with self-selection at both individual and individual-time level</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Random Effects and/or Sample Selection Models for Panel Count
Data</td>
</tr>
<tr>
<td>Version:</td>
<td>2.0.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-08-20</td>
</tr>
<tr>
<td>Author:</td>
<td>Jing Peng</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jing Peng &lt;jing.peng@uconn.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>A high performance package implementing random effects and/or
    sample selection models for panel count data. The details of the models are discussed in Peng and Van den Bulte (2023) &lt;<a href="https://doi.org/10.2139%2Fssrn.2702053">doi:10.2139/ssrn.2702053</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>LazyData:</td>
<td>TRUE</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp, statmod, MASS</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-08-21 00:46:08 UTC; pengj</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-08-21 04:02:38 UTC</td>
</tr>
</table>
<hr>
<h2 id='PanelCount'>Panel Count Models with Random Effects and/or Sample Selection</h2><span id='topic+PanelCount'></span>

<h3>Description</h3>

<p>A high performance package for estimating panel count models with random effects and/or sample selection. <br />
</p>


<h3>Functions</h3>

<p>ProbitRE: Probit model with random effects on individuals <br /> <br />
PoissonRE: Poisson model with random effects on individuals <br /> <br />
PLN_RE: Poisson Lognormal model with random effects on individuals <br /> <br />
ProbitRE_PoissonRE: PoissonRE and ProbitRE model with correlated random effects on individuals <br /> <br />
ProbitRE_PLNRE: PLN_RE and ProbitRE model with correlated random effects on individual level and correlated error terms on individual-time level <br /> <br />
</p>


<h3>References</h3>

<p>1. Peng, J., &amp; Van den Bulte, C. (2023). Participation vs. Effectiveness in Sponsored Tweet Campaigns: A Quality-Quantity Conundrum. Management Science (forthcoming). Available at SSRN: &lt;https://www.ssrn.com/abstract=2702053&gt;
</p>
<p>2. Peng, J., &amp; Van den Bulte, C. (2015). How to Better Target and Incent Paid Endorsers in Social Advertising Campaigns: A Field Experiment. 2015 International Conference on Information Systems. &lt;https://aisel.aisnet.org/icis2015/proceedings/SocialMedia/24/&gt;
</p>

<hr>
<h2 id='PLN_RE'>A Poisson Lognormal Model with Random Effects</h2><span id='topic+PLN_RE'></span>

<h3>Description</h3>

<p>Estimate a Poisson model with random effects at the individual and individual-time levels.
</p>
<p style="text-align: center;"><code class="reqn">E[y_{it}|x_{it},v_i,\epsilon_{it}] = exp(\boldsymbol{\beta}\mathbf{x_{it}}' + \sigma v_i + \gamma \epsilon_{it})</code>
</p>

<p>Notations:
</p>

<ul>
<li> <p><code class="reqn">x_{it}</code>: variables influencing the selection decision <code class="reqn">y_{it}</code>, which could be a mixture of time-variant variables, time-invariant variables, and time dummies
</p>
</li>
<li> <p><code class="reqn">v_i</code>: individual level random effect
</p>
</li>
<li> <p><code class="reqn">\epsilon_{it}</code>: individual-time level random effect
</p>
</li></ul>

<p><code class="reqn">v_i</code> and <code class="reqn">\epsilon_{it}</code> can both account for overdispersion.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PLN_RE(
  formula,
  data,
  id.name,
  par = NULL,
  sigma = NULL,
  gamma = NULL,
  method = "BFGS",
  adaptiveLL = TRUE,
  stopUpdate = FALSE,
  se_type = c("BHHH", "Hessian")[1],
  H = 12,
  psnH = 12,
  reltol = sqrt(.Machine$double.eps),
  verbose = 0
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PLN_RE_+3A_formula">formula</code></td>
<td>
<p>Formula of the model</p>
</td></tr>
<tr><td><code id="PLN_RE_+3A_data">data</code></td>
<td>
<p>Input data, a data.frame object</p>
</td></tr>
<tr><td><code id="PLN_RE_+3A_id.name">id.name</code></td>
<td>
<p>The name of the column representing id. Data will be sorted by id to improve estimation speed.</p>
</td></tr>
<tr><td><code id="PLN_RE_+3A_par">par</code></td>
<td>
<p>Starting values for estimates. Default to estimates of Poisson RE model.</p>
</td></tr>
<tr><td><code id="PLN_RE_+3A_sigma">sigma</code></td>
<td>
<p>Starting value for sigma. Defaults to 1 and will be ignored if par is provided.</p>
</td></tr>
<tr><td><code id="PLN_RE_+3A_gamma">gamma</code></td>
<td>
<p>Starting value for gamma. Defaults to 1 and will be ignored if par is provided.</p>
</td></tr>
<tr><td><code id="PLN_RE_+3A_method">method</code></td>
<td>
<p>Optimization method used by optim. Defaults to 'BFGS'.</p>
</td></tr>
<tr><td><code id="PLN_RE_+3A_adaptivell">adaptiveLL</code></td>
<td>
<p>Whether to use Adaptive Gaussian Quadrature. Defaults to TRUE because it is more reliable (though slower) for long panels.</p>
</td></tr>
<tr><td><code id="PLN_RE_+3A_stopupdate">stopUpdate</code></td>
<td>
<p>Whether to disable update of Adaptive Gaussian Quadrature parameters. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="PLN_RE_+3A_se_type">se_type</code></td>
<td>
<p>Report Hessian or BHHH standard errors. Defaults to BHHH.</p>
</td></tr>
<tr><td><code id="PLN_RE_+3A_h">H</code></td>
<td>
<p>Number of Quadrature points used for numerical integration using the Gaussian-Hermite Quadrature method. Defaults to 20.</p>
</td></tr>
<tr><td><code id="PLN_RE_+3A_psnh">psnH</code></td>
<td>
<p>Number of Quadrature points for Poisson RE model</p>
</td></tr>
<tr><td><code id="PLN_RE_+3A_reltol">reltol</code></td>
<td>
<p>Relative convergence tolerance. The algorithm stops if it is unable to reduce the value by a factor of reltol * (abs(val) + reltol) at a step. Defaults to sqrt(.Machine$double.eps), typically about 1e-8.</p>
</td></tr>
<tr><td><code id="PLN_RE_+3A_verbose">verbose</code></td>
<td>
<p>A integer indicating how much output to display during the estimation process.
</p>

<ul>
<li><p> &lt;0 - No ouput
</p>
</li>
<li><p> 0 - Basic output (model estimates)
</p>
</li>
<li><p> 1 - Moderate output, basic ouput + parameter and likelihood in each iteration
</p>
</li>
<li><p> 2 - Extensive output, moderate output + gradient values on each call
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the results of the estimated model, some of which are inherited from the return of optim
</p>

<ul>
<li><p> estimates: Model estimates with 95% confidence intervals
</p>
</li>
<li><p> par: Point estimates
</p>
</li>
<li><p> var_bhhh: BHHH covariance matrix, inverse of the outer product of gradient at the maximum
</p>
</li>
<li><p> var_hessian: Inverse of negative Hessian matrix (the second order derivative of likelihood at the maximum)
</p>
</li>
<li><p> se_bhhh: BHHH standard errors
</p>
</li>
<li><p> g: Gradient function at maximum
</p>
</li>
<li><p> gtHg: <code class="reqn">g'H^-1g</code>, where H^-1 is approximated by var_bhhh. A value close to zero (e.g., &lt;1e-3 or 1e-6) indicates good convergence.
</p>
</li>
<li><p> LL: Likelihood
</p>
</li>
<li><p> AIC: AIC
</p>
</li>
<li><p> BIC: BIC
</p>
</li>
<li><p> n_obs: Number of observations
</p>
</li>
<li><p> time: Time takes to estimate the model
</p>
</li>
<li><p> partial: Average partial effect at the population level
</p>
</li>
<li><p> paritalAvgObs: Partial effect for an individual with average characteristics
</p>
</li>
<li><p> predict: A list with predicted participation probability (prob), predicted potential outcome (outcome), and predicted actual outcome (actual_outcome).
</p>
</li>
<li><p> counts: From optim. A two-element integer vector giving the number of calls to fn and gr respectively. This excludes those calls needed to compute the Hessian, if requested, and any calls to fn to compute a finite-difference approximation to the gradient.
</p>
</li>
<li><p> message: From optim. A character string giving any additional information returned by the optimizer, or NULL.
</p>
</li>
<li><p> convergence: From optim. An integer code. 0 indicates successful completion.
Note that the list inherits all the complements in the output of optim. See the documentation of optim for more details.
</p>
</li></ul>



<h3>References</h3>


<ol>
<li><p> Peng, J., &amp; Van den Bulte, C. (2023). Participation vs. Effectiveness in Sponsored Tweet Campaigns: A Quality-Quantity Conundrum. Management Science (forthcoming). Available at SSRN: <a href="https://www.ssrn.com/abstract=2702053">https://www.ssrn.com/abstract=2702053</a>
</p>
</li>
<li><p> Peng, J., &amp; Van den Bulte, C. (2015). How to Better Target and Incent Paid Endorsers in Social Advertising Campaigns: A Field Experiment. 2015 International Conference on Information Systems. <a href="https://aisel.aisnet.org/icis2015/proceedings/SocialMedia/24/">https://aisel.aisnet.org/icis2015/proceedings/SocialMedia/24/</a>
</p>
</li></ol>



<h3>See Also</h3>

<p>Other PanelCount: 
<code><a href="#topic+PoissonRE">PoissonRE</a>()</code>,
<code><a href="#topic+ProbitRE_PLNRE">ProbitRE_PLNRE</a>()</code>,
<code><a href="#topic+ProbitRE_PoissonRE">ProbitRE_PoissonRE</a>()</code>,
<code><a href="#topic+ProbitRE">ProbitRE</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Use the simulated dataset, in which the true coefficient of x is 1.
# Estimated coefficient is biased due to omission of self-selection
data(sim)
res = PLN_RE(y~x, data=sim[!is.na(sim$y), ], id.name='id', verbose=-1)
res$estimates

</code></pre>

<hr>
<h2 id='PoissonRE'>A Poisson Model with Random Effects</h2><span id='topic+PoissonRE'></span>

<h3>Description</h3>

<p>Estimate a Poisson model with random effects at the individual level.
</p>
<p style="text-align: center;"><code class="reqn">E[y_{it}|x_{it},v_i] = exp(\boldsymbol{\beta}\mathbf{x_{it}}' + \sigma v_i)</code>
</p>

<p>Notations:
</p>

<ul>
<li> <p><code class="reqn">x_{it}</code>: variables influencing the outcome <code class="reqn">y_{it}</code>, which could be a mixture of time-variant variables, time-invariant variables, and time dummies
</p>
</li>
<li> <p><code class="reqn">v_i</code>: individual level random effect
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>PoissonRE(
  formula,
  data,
  id.name,
  par = NULL,
  sigma = NULL,
  method = "BFGS",
  stopUpdate = FALSE,
  se_type = c("Hessian", "BHHH")[1],
  H = 20,
  reltol = sqrt(.Machine$double.eps),
  verbose = 0
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PoissonRE_+3A_formula">formula</code></td>
<td>
<p>Formula of the model</p>
</td></tr>
<tr><td><code id="PoissonRE_+3A_data">data</code></td>
<td>
<p>Input data, a data.frame object</p>
</td></tr>
<tr><td><code id="PoissonRE_+3A_id.name">id.name</code></td>
<td>
<p>The name of the column representing id. Data will be sorted by id to improve estimation speed.</p>
</td></tr>
<tr><td><code id="PoissonRE_+3A_par">par</code></td>
<td>
<p>Starting values for estimates. Default to estimates of Poisson Model</p>
</td></tr>
<tr><td><code id="PoissonRE_+3A_sigma">sigma</code></td>
<td>
<p>Starting value for sigma. Defaults to 1 and will be ignored if par is provided.</p>
</td></tr>
<tr><td><code id="PoissonRE_+3A_method">method</code></td>
<td>
<p>Optimization method used by optim. Defaults to 'BFGS'.</p>
</td></tr>
<tr><td><code id="PoissonRE_+3A_stopupdate">stopUpdate</code></td>
<td>
<p>Whether to disable update of Adaptive Gaussian Quadrature parameters. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="PoissonRE_+3A_se_type">se_type</code></td>
<td>
<p>Report Hessian or BHHH standard errors. Defaults to Hessian.</p>
</td></tr>
<tr><td><code id="PoissonRE_+3A_h">H</code></td>
<td>
<p>Number of Quadrature points used for numerical integration using the Gaussian-Hermite Quadrature method. Defaults to 20.</p>
</td></tr>
<tr><td><code id="PoissonRE_+3A_reltol">reltol</code></td>
<td>
<p>Relative convergence tolerance. The algorithm stops if it is unable to reduce the value by a factor of reltol * (abs(val) + reltol) at a step. Defaults to sqrt(.Machine$double.eps), typically about 1e-8.</p>
</td></tr>
<tr><td><code id="PoissonRE_+3A_verbose">verbose</code></td>
<td>
<p>A integer indicating how much output to display during the estimation process.
</p>

<ul>
<li><p> &lt;0 - No ouput
</p>
</li>
<li><p> 0 - Basic output (model estimates)
</p>
</li>
<li><p> 1 - Moderate output, basic ouput + parameter and likelihood in each iteration
</p>
</li>
<li><p> 2 - Extensive output, moderate output + gradient values on each call
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the results of the estimated model, some of which are inherited from the return of optim
</p>

<ul>
<li><p> estimates: Model estimates with 95% confidence intervals
</p>
</li>
<li><p> par: Point estimates
</p>
</li>
<li><p> var_bhhh: BHHH covariance matrix, inverse of the outer product of gradient at the maximum
</p>
</li>
<li><p> var_hessian: Inverse of negative Hessian matrix (the second order derivative of likelihood at the maximum)
</p>
</li>
<li><p> se_bhhh: BHHH standard errors
</p>
</li>
<li><p> g: Gradient function at maximum
</p>
</li>
<li><p> gtHg: <code class="reqn">g'H^-1g</code>, where H^-1 is approximated by var_bhhh. A value close to zero (e.g., &lt;1e-3 or 1e-6) indicates good convergence.
</p>
</li>
<li><p> LL: Likelihood
</p>
</li>
<li><p> AIC: AIC
</p>
</li>
<li><p> BIC: BIC
</p>
</li>
<li><p> n_obs: Number of observations
</p>
</li>
<li><p> time: Time takes to estimate the model
</p>
</li>
<li><p> partial: Average partial effect at the population level
</p>
</li>
<li><p> paritalAvgObs: Partial effect for an individual with average characteristics
</p>
</li>
<li><p> predict: A list with predicted participation probability (prob), predicted potential outcome (outcome), and predicted actual outcome (actual_outcome).
</p>
</li>
<li><p> counts: From optim. A two-element integer vector giving the number of calls to fn and gr respectively. This excludes those calls needed to compute the Hessian, if requested, and any calls to fn to compute a finite-difference approximation to the gradient.
</p>
</li>
<li><p> message: From optim. A character string giving any additional information returned by the optimizer, or NULL.
</p>
</li>
<li><p> convergence: From optim. An integer code. 0 indicates successful completion.
Note that the list inherits all the complements in the output of optim. See the documentation of optim for more details.
</p>
</li></ul>



<h3>References</h3>


<ol>
<li><p> Peng, J., &amp; Van den Bulte, C. (2023). Participation vs. Effectiveness in Sponsored Tweet Campaigns: A Quality-Quantity Conundrum. Management Science (forthcoming). Available at SSRN: <a href="https://www.ssrn.com/abstract=2702053">https://www.ssrn.com/abstract=2702053</a>
</p>
</li>
<li><p> Peng, J., &amp; Van den Bulte, C. (2015). How to Better Target and Incent Paid Endorsers in Social Advertising Campaigns: A Field Experiment. 2015 International Conference on Information Systems. <a href="https://aisel.aisnet.org/icis2015/proceedings/SocialMedia/24/">https://aisel.aisnet.org/icis2015/proceedings/SocialMedia/24/</a>
</p>
</li></ol>



<h3>See Also</h3>

<p>Other PanelCount: 
<code><a href="#topic+PLN_RE">PLN_RE</a>()</code>,
<code><a href="#topic+ProbitRE_PLNRE">ProbitRE_PLNRE</a>()</code>,
<code><a href="#topic+ProbitRE_PoissonRE">ProbitRE_PoissonRE</a>()</code>,
<code><a href="#topic+ProbitRE">ProbitRE</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Use the simulated dataset, in which the true coefficient of x is 1.
# Estimated coefficient is biased primarily due to omission of self-selection
data(sim)
res = PoissonRE(y~x, data=sim[!is.na(sim$y), ], id.name='id', verbose=-1)
res$estimates
</code></pre>

<hr>
<h2 id='predict_ProbitRE_PLNRE'>Predictions of ProbitRE_PLNRE model on new sample</h2><span id='topic+predict_ProbitRE_PLNRE'></span>

<h3>Description</h3>

<p>Predictions of ProbitRE_PLNRE model on new sample. Please make sure the factor variables in the test data do not have levels not shown in the training data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predict_ProbitRE_PLNRE(
  par,
  sel_form,
  out_form,
  data,
  offset_w_name = NULL,
  offset_x_name = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict_ProbitRE_PLNRE_+3A_par">par</code></td>
<td>
<p>Model estimates</p>
</td></tr>
<tr><td><code id="predict_ProbitRE_PLNRE_+3A_sel_form">sel_form</code></td>
<td>
<p>Formula for selection equation, a Probit model with random effects</p>
</td></tr>
<tr><td><code id="predict_ProbitRE_PLNRE_+3A_out_form">out_form</code></td>
<td>
<p>Formula for outcome equation, a Poisson Lognormal model with random effects</p>
</td></tr>
<tr><td><code id="predict_ProbitRE_PLNRE_+3A_data">data</code></td>
<td>
<p>Input data, a data.frame object</p>
</td></tr>
<tr><td><code id="predict_ProbitRE_PLNRE_+3A_offset_w_name">offset_w_name</code></td>
<td>
<p>Offset variables in selection equation, if any.</p>
</td></tr>
<tr><td><code id="predict_ProbitRE_PLNRE_+3A_offset_x_name">offset_x_name</code></td>
<td>
<p>Offset variables in outcome equation, if any.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with three sets of predictions
</p>

<ul>
<li><p> prob: Predicted probability to participate
</p>
</li>
<li><p> outcome: Predicted potential outcome
</p>
</li>
<li><p> actual_outcome: Predicted actual outcome
</p>
</li></ul>


<hr>
<h2 id='predict_ProbitRE_PoissonRE'>Predictions of ProbitRE_PoissonRE model on new sample</h2><span id='topic+predict_ProbitRE_PoissonRE'></span>

<h3>Description</h3>

<p>Predictions of ProbitRE_PoissonRE model on new sample. Please make sure the factor variables in the test data do not have levels not shown in the training data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predict_ProbitRE_PoissonRE(
  par,
  sel_form,
  out_form,
  data,
  offset_w_name = NULL,
  offset_x_name = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict_ProbitRE_PoissonRE_+3A_par">par</code></td>
<td>
<p>Model estimates</p>
</td></tr>
<tr><td><code id="predict_ProbitRE_PoissonRE_+3A_sel_form">sel_form</code></td>
<td>
<p>Formula for selection equation, a Probit model with random effects</p>
</td></tr>
<tr><td><code id="predict_ProbitRE_PoissonRE_+3A_out_form">out_form</code></td>
<td>
<p>Formula for outcome equation, a Poisson Lognormal model with random effects</p>
</td></tr>
<tr><td><code id="predict_ProbitRE_PoissonRE_+3A_data">data</code></td>
<td>
<p>Input data, a data.frame object</p>
</td></tr>
<tr><td><code id="predict_ProbitRE_PoissonRE_+3A_offset_w_name">offset_w_name</code></td>
<td>
<p>Offset variables in selection equation, if any.</p>
</td></tr>
<tr><td><code id="predict_ProbitRE_PoissonRE_+3A_offset_x_name">offset_x_name</code></td>
<td>
<p>Offset variables in outcome equation, if any.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with three sets of predictions
</p>

<ul>
<li><p> prob: Predicted probability to participate
</p>
</li>
<li><p> outcome: Predicted potential outcome
</p>
</li>
<li><p> actual_outcome: Predicted actual outcome
</p>
</li></ul>


<hr>
<h2 id='ProbitRE'>A Probit Model with Random Effects</h2><span id='topic+ProbitRE'></span>

<h3>Description</h3>

<p>Estimate a Probit model with random effects at the individual level.
</p>
<p style="text-align: center;"><code class="reqn">z_{it}=1(\boldsymbol{\alpha}\mathbf{w_{it}}'+\delta u_i+\xi_{it} &gt; 0)</code>
</p>

<p>Notations:
</p>

<ul>
<li> <p><code class="reqn">w_{it}</code>: variables influencing the selection decision <code class="reqn">z_{it}</code>, which could be a mixture of time-variant variables, time-invariant variables, and time dummies
</p>
</li>
<li> <p><code class="reqn">u_i</code>: individual level random effect
</p>
</li>
<li> <p><code class="reqn">\xi_{it}</code>: error term
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>ProbitRE(
  formula,
  data,
  id.name,
  par = NULL,
  delta = NULL,
  method = "BFGS",
  se_type = c("Hessian", "BHHH")[1],
  H = 20,
  reltol = sqrt(.Machine$double.eps),
  verbose = 0
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ProbitRE_+3A_formula">formula</code></td>
<td>
<p>Formula of the model</p>
</td></tr>
<tr><td><code id="ProbitRE_+3A_data">data</code></td>
<td>
<p>Input data, a data.frame object</p>
</td></tr>
<tr><td><code id="ProbitRE_+3A_id.name">id.name</code></td>
<td>
<p>The name of the column representing id. Data will be sorted by id to improve estimation speed.</p>
</td></tr>
<tr><td><code id="ProbitRE_+3A_par">par</code></td>
<td>
<p>Starting values for estimates. Default to estimates of Probit model.</p>
</td></tr>
<tr><td><code id="ProbitRE_+3A_delta">delta</code></td>
<td>
<p>Starting value for delta. Defaults to 1 and will be ignored if par is provided.</p>
</td></tr>
<tr><td><code id="ProbitRE_+3A_method">method</code></td>
<td>
<p>Optimization method used by optim. Defaults to 'BFGS'.</p>
</td></tr>
<tr><td><code id="ProbitRE_+3A_se_type">se_type</code></td>
<td>
<p>Report Hessian or BHHH standard errors. Defaults to Hessian.</p>
</td></tr>
<tr><td><code id="ProbitRE_+3A_h">H</code></td>
<td>
<p>Number of Quadrature points used for numerical integration using the Gaussian-Hermite Quadrature method. Defaults to 20.</p>
</td></tr>
<tr><td><code id="ProbitRE_+3A_reltol">reltol</code></td>
<td>
<p>Relative convergence tolerance. The algorithm stops if it is unable to reduce the value by a factor of reltol * (abs(val) + reltol) at a step. Defaults to sqrt(.Machine$double.eps), typically about 1e-8.</p>
</td></tr>
<tr><td><code id="ProbitRE_+3A_verbose">verbose</code></td>
<td>
<p>A integer indicating how much output to display during the estimation process.
</p>

<ul>
<li><p> &lt;0 - No ouput
</p>
</li>
<li><p> 0 - Basic output (model estimates)
</p>
</li>
<li><p> 1 - Moderate output, basic ouput + parameter and likelihood in each iteration
</p>
</li>
<li><p> 2 - Extensive output, moderate output + gradient values on each call
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the results of the estimated model, some of which are inherited from the return of optim
</p>

<ul>
<li><p> estimates: Model estimates with 95% confidence intervals
</p>
</li>
<li><p> par: Point estimates
</p>
</li>
<li><p> var_bhhh: BHHH covariance matrix, inverse of the outer product of gradient at the maximum
</p>
</li>
<li><p> var_hessian: Inverse of negative Hessian matrix (the second order derivative of likelihood at the maximum)
</p>
</li>
<li><p> se_bhhh: BHHH standard errors
</p>
</li>
<li><p> g: Gradient function at maximum
</p>
</li>
<li><p> gtHg: <code class="reqn">g'H^-1g</code>, where H^-1 is approximated by var_bhhh. A value close to zero (e.g., &lt;1e-3 or 1e-6) indicates good convergence.
</p>
</li>
<li><p> LL: Likelihood
</p>
</li>
<li><p> AIC: AIC
</p>
</li>
<li><p> BIC: BIC
</p>
</li>
<li><p> n_obs: Number of observations
</p>
</li>
<li><p> time: Time takes to estimate the model
</p>
</li>
<li><p> partial: Average partial effect at the population level
</p>
</li>
<li><p> paritalAvgObs: Partial effect for an individual with average characteristics
</p>
</li>
<li><p> predict: A list with predicted participation probability (prob), predicted potential outcome (outcome), and predicted actual outcome (actual_outcome).
</p>
</li>
<li><p> counts: From optim. A two-element integer vector giving the number of calls to fn and gr respectively. This excludes those calls needed to compute the Hessian, if requested, and any calls to fn to compute a finite-difference approximation to the gradient.
</p>
</li>
<li><p> message: From optim. A character string giving any additional information returned by the optimizer, or NULL.
</p>
</li>
<li><p> convergence: From optim. An integer code. 0 indicates successful completion.
Note that the list inherits all the complements in the output of optim. See the documentation of optim for more details.
</p>
</li>
<li><p> estimates model estimates with 95% confidence intervals
</p>
</li>
<li><p> par point estimates
</p>
</li>
<li><p> var_bhhh BHHH covariance matrix, inverse of the outer product of gradient at the maximum
</p>
</li>
<li><p> var_hessian Inverse of negative Hessian matrix (the second order derivative of likelihood at the maximum)
</p>
</li>
<li><p> se_bhhh BHHH standard errors
</p>
</li>
<li><p> g graident function at maximum
</p>
</li>
<li><p> LL likelihood
</p>
</li>
<li><p> AIC AIC
</p>
</li>
<li><p> BIC BIC
</p>
</li>
<li><p> n_obs Number of observations
</p>
</li>
<li><p> counts A two-element integer vector giving the number of calls to fn and gr respectively. This excludes those calls needed to compute the Hessian, if requested, and any calls to fn to compute a finite-difference approximation to the gradient.
</p>
</li>
<li><p> time Time takes to estimate the model
</p>
</li>
<li><p> message A character string giving any additional information returned by the optimizer, or NULL.
</p>
</li>
<li><p> convergence An integer code. 0 indicates successful completion.
Note that the list inherits all the complements in the output of optim. See the documentation of optim for more details.
</p>
</li></ul>



<h3>References</h3>


<ol>
<li><p> Peng, J., &amp; Van den Bulte, C. (2023). Participation vs. Effectiveness in Sponsored Tweet Campaigns: A Quality-Quantity Conundrum. Management Science (forthcoming). Available at SSRN: <a href="https://www.ssrn.com/abstract=2702053">https://www.ssrn.com/abstract=2702053</a>
</p>
</li>
<li><p> Peng, J., &amp; Van den Bulte, C. (2015). How to Better Target and Incent Paid Endorsers in Social Advertising Campaigns: A Field Experiment. 2015 International Conference on Information Systems. <a href="https://aisel.aisnet.org/icis2015/proceedings/SocialMedia/24/">https://aisel.aisnet.org/icis2015/proceedings/SocialMedia/24/</a>
</p>
</li></ol>



<h3>See Also</h3>

<p>Other PanelCount: 
<code><a href="#topic+PLN_RE">PLN_RE</a>()</code>,
<code><a href="#topic+PoissonRE">PoissonRE</a>()</code>,
<code><a href="#topic+ProbitRE_PLNRE">ProbitRE_PLNRE</a>()</code>,
<code><a href="#topic+ProbitRE_PoissonRE">ProbitRE_PoissonRE</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Use the simulated dataset, in which the true coefficients of x and w are 1.
data(sim)
res = ProbitRE(z~x+w, data=sim, id.name='id', verbose=-1)
res$estimates
</code></pre>

<hr>
<h2 id='ProbitRE_PLNRE'>Poisson Lognormal Model with Random Effects and Sample Selection</h2><span id='topic+ProbitRE_PLNRE'></span>

<h3>Description</h3>

<p>Estimates the following two-stage model:<br /> <br />
Selection equation (ProbitRE - Probit model with individual level random effects):
</p>
<p style="text-align: center;"><code class="reqn">z_{it}=1(\boldsymbol{\alpha}\mathbf{w_{it}}'+\delta u_i+\xi_{it} &gt; 0)</code>
</p>

<p>Outcome Equation (PLN_RE - Poisson Lognormal model with individual-time level random effects):
</p>
<p style="text-align: center;"><code class="reqn">E[y_{it}|x_{it},v_i,\epsilon_{it}] = exp(\boldsymbol{\beta}\mathbf{x_{it}}' + \sigma v_i + \gamma \epsilon_{it})</code>
</p>

<p>Correlation (self-selection at both individual and individual-time level):
</p>

<ul>
<li> <p><code class="reqn">u_i</code> and <code class="reqn">v_i</code> are bivariate normally distributed with a correlation of <code class="reqn">\rho</code>.
</p>
</li>
<li> <p><code class="reqn">\xi_{it}</code> and <code class="reqn">\epsilon_{it}</code> are bivariate normally distributed with a correlation of <code class="reqn">\tau</code>.
</p>
</li></ul>

<p>Notations:
</p>

<ul>
<li> <p><code class="reqn">w_{it}</code>: variables influencing the selection decision <code class="reqn">z_{it}</code>, which could be a mixture of time-variant variables, time-invariant variables, and time dummies
</p>
</li>
<li> <p><code class="reqn">x_{it}</code>: variables influencing the outcome <code class="reqn">y_{it}</code>, which could be a mixture of time-variant variables, time-invariant variables, and time dummies
</p>
</li>
<li> <p><code class="reqn">u_i</code>: individual level random effect in the selection equation
</p>
</li>
<li> <p><code class="reqn">v_i</code>: individual level random effect in the outcome equation
</p>
</li>
<li> <p><code class="reqn">\xi_{it}</code>: error term in the selection equation
</p>
</li>
<li> <p><code class="reqn">\epsilon_{it}</code>: individual-time level random effect in the outcome equation
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>ProbitRE_PLNRE(
  sel_form,
  out_form,
  data,
  id.name,
  testData = NULL,
  par = NULL,
  disable_rho = FALSE,
  disable_tau = FALSE,
  delta = NULL,
  sigma = NULL,
  gamma = NULL,
  rho = NULL,
  tau = NULL,
  method = "BFGS",
  se_type = c("BHHH", "Hessian")[1],
  H = c(10, 10),
  psnH = 20,
  prbH = 20,
  plnreH = 20,
  reltol = sqrt(.Machine$double.eps),
  factr = 1e+07,
  verbose = 1,
  offset_w_name = NULL,
  offset_x_name = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ProbitRE_PLNRE_+3A_sel_form">sel_form</code></td>
<td>
<p>Formula for selection equation, a Probit model with random effects</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_out_form">out_form</code></td>
<td>
<p>Formula for outcome equation, a Poisson Lognormal model with random effects</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_data">data</code></td>
<td>
<p>Input data, a data.frame object</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_id.name">id.name</code></td>
<td>
<p>The name of the column representing id. Data will be sorted by id to improve estimation speed.</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_testdata">testData</code></td>
<td>
<p>Test data for prediction, a data.frame object</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_par">par</code></td>
<td>
<p>Starting values for estimates. Default to estimates of standalone selection and outcome models.</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_disable_rho">disable_rho</code></td>
<td>
<p>Whether to disable correlation at the individual level random effect. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_disable_tau">disable_tau</code></td>
<td>
<p>Whether to disable correlation at the individual-time level random effect / error term. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_delta">delta</code></td>
<td>
<p>Starting value for delta. Will be ignored if par is provided.</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_sigma">sigma</code></td>
<td>
<p>Starting value for sigma. Will be ignored if par is provided.</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_gamma">gamma</code></td>
<td>
<p>Starting value for gamma. Will be ignored if par is provided.</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_rho">rho</code></td>
<td>
<p>Starting value for rho. Defaults to 0 and will be ignored if par is provided.</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_tau">tau</code></td>
<td>
<p>Starting value for tau. Defaults to 0 and will be ignored if par is provided.</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_method">method</code></td>
<td>
<p>Optimization method used by optim. Defaults to 'BFGS'.</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_se_type">se_type</code></td>
<td>
<p>Report Hessian or BHHH standard errors. Defaults to BHHH. Hessian matrix is extremely time-consuming to calculate numerically for large datasets.</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_h">H</code></td>
<td>
<p>A integer vector of length 2, specifying the number of points for inner and outer Quadratures</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_psnh">psnH</code></td>
<td>
<p>Number of Quadrature points for Poisson RE model</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_prbh">prbH</code></td>
<td>
<p>Number of Quadrature points for Probit RE model</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_plnreh">plnreH</code></td>
<td>
<p>Number of Quadrature points for PLN_RE model</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_reltol">reltol</code></td>
<td>
<p>Relative convergence tolerance. The algorithm stops if it is unable to reduce the value by a factor of reltol * (abs(val) + reltol) at a step. Defaults to sqrt(.Machine$double.eps), typically about 1e-8.</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_factr">factr</code></td>
<td>
<p>L-BFGS-B method uses factr instead of reltol to control for precision. Default is 1e7, that is a tolerance of about 1e-8.</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_verbose">verbose</code></td>
<td>
<p>A integer indicating how much output to display during the estimation process.
</p>

<ul>
<li><p> &lt;0 - No ouput
</p>
</li>
<li><p> 0 - Basic output (model estimates)
</p>
</li>
<li><p> 1 - Moderate output, basic ouput + parameter and likelihood in each iteration
</p>
</li>
<li><p> 2 - Extensive output, moderate output + gradient values on each call
</p>
</li></ul>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_offset_w_name">offset_w_name</code></td>
<td>
<p>An offset variable whose coefficient is assumed to be 1 in the selection equation</p>
</td></tr>
<tr><td><code id="ProbitRE_PLNRE_+3A_offset_x_name">offset_x_name</code></td>
<td>
<p>An offset variable whose coefficient is assumed to be 1 in the outcome equation</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the results of the estimated model, some of which are inherited from the return of optim
</p>

<ul>
<li><p> estimates: Model estimates with 95% confidence intervals
</p>
</li>
<li><p> par: Point estimates
</p>
</li>
<li><p> var_bhhh: BHHH covariance matrix, inverse of the outer product of gradient at the maximum
</p>
</li>
<li><p> se_bhhh: BHHH standard errors
</p>
</li>
<li><p> g: Gradient function at maximum
</p>
</li>
<li><p> gtHg: <code class="reqn">g'H^-1g</code>, where H^-1 is approximated by var_bhhh. A value close to zero (e.g., &lt;1e-3 or 1e-6) indicates good convergence.
</p>
</li>
<li><p> LL: Likelihood
</p>
</li>
<li><p> AIC: AIC
</p>
</li>
<li><p> BIC: BIC
</p>
</li>
<li><p> n_obs: Number of observations
</p>
</li>
<li><p> time: Time takes to estimate the model
</p>
</li>
<li><p> partial: Average partial effect at the population level
</p>
</li>
<li><p> paritalAvgObs: Partial effect for an individual with average characteristics
</p>
</li>
<li><p> predict: A list with predicted participation probability (prob), predicted potential outcome (outcome), and predicted actual outcome (actual_outcome).
</p>
</li>
<li><p> counts: From optim. A two-element integer vector giving the number of calls to fn and gr respectively. This excludes those calls needed to compute the Hessian, if requested, and any calls to fn to compute a finite-difference approximation to the gradient.
</p>
</li>
<li><p> message: From optim. A character string giving any additional information returned by the optimizer, or NULL.
</p>
</li>
<li><p> convergence: From optim. An integer code. 0 indicates successful completion.
Note that the list inherits all the complements in the output of optim. See the documentation of optim for more details.
</p>
</li></ul>



<h3>References</h3>


<ol>
<li><p> Peng, J., &amp; Van den Bulte, C. (2023). Participation vs. Effectiveness in Sponsored Tweet Campaigns: A Quality-Quantity Conundrum. Management Science (forthcoming). Available at SSRN: <a href="https://www.ssrn.com/abstract=2702053">https://www.ssrn.com/abstract=2702053</a>
</p>
</li>
<li><p> Peng, J., &amp; Van den Bulte, C. (2015). How to Better Target and Incent Paid Endorsers in Social Advertising Campaigns: A Field Experiment. 2015 International Conference on Information Systems. <a href="https://aisel.aisnet.org/icis2015/proceedings/SocialMedia/24/">https://aisel.aisnet.org/icis2015/proceedings/SocialMedia/24/</a>
</p>
</li></ol>



<h3>See Also</h3>

<p>Other PanelCount: 
<code><a href="#topic+PLN_RE">PLN_RE</a>()</code>,
<code><a href="#topic+PoissonRE">PoissonRE</a>()</code>,
<code><a href="#topic+ProbitRE_PoissonRE">ProbitRE_PoissonRE</a>()</code>,
<code><a href="#topic+ProbitRE">ProbitRE</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Use the simulated dataset, in which the true coefficients of x and w are 1 in both stages.
# The model can recover the true parameters very well
data(sim)
res = ProbitRE_PLNRE(z~x+w, y~x, data=sim, id.name='id')
res$estimates

</code></pre>

<hr>
<h2 id='ProbitRE_PoissonRE'>Poisson RE model with Sample Selection</h2><span id='topic+ProbitRE_PoissonRE'></span>

<h3>Description</h3>

<p>Estimates the following two-stage model <br /> <br />
Selection equation (ProbitRE - Probit model with individual level random effects):
</p>
<p style="text-align: center;"><code class="reqn">z_{it}=1(\boldsymbol{\alpha}\mathbf{w_{it}}'+\delta u_i+\xi_{it} &gt; 0)</code>
</p>

<p>Outcome Equation (PoissonRE - Poisson with individual level random effects):
</p>
<p style="text-align: center;"><code class="reqn">E[y_{it}|x_{it},v_i] = exp(\boldsymbol{\beta}\mathbf{x_{it}}' + \sigma v_i)</code>
</p>

<p>Correlation (self-selection at individual level):
</p>

<ul>
<li> <p><code class="reqn">u_i</code> and <code class="reqn">v_i</code> are bivariate normally distributed with a correlation of <code class="reqn">\rho</code>.
</p>
</li></ul>

<p>Notations:
</p>

<ul>
<li> <p><code class="reqn">w_{it}</code>: variables influencing the selection decision <code class="reqn">z_{it}</code>, which could be a mixture of time-variant variables, time-invariant variables, and time dummies
</p>
</li>
<li> <p><code class="reqn">x_{it}</code>: variables influencing the outcome <code class="reqn">y_{it}</code>, which could be a mixture of time-variant variables, time-invariant variables, and time dummies
</p>
</li>
<li> <p><code class="reqn">u_i</code>: individual level random effect in the selection equation
</p>
</li>
<li> <p><code class="reqn">v_i</code>: individual level random effect in the outcome equation
</p>
</li>
<li> <p><code class="reqn">\xi_{it}</code>: error term in the selection equation
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>ProbitRE_PoissonRE(
  sel_form,
  out_form,
  data,
  id.name,
  testData = NULL,
  par = NULL,
  delta = NULL,
  sigma = NULL,
  rho = NULL,
  method = "BFGS",
  se_type = c("BHHH", "Hessian")[1],
  H = c(10, 10),
  psnH = 20,
  prbH = 20,
  reltol = sqrt(.Machine$double.eps),
  verbose = 1,
  offset_w_name = NULL,
  offset_x_name = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ProbitRE_PoissonRE_+3A_sel_form">sel_form</code></td>
<td>
<p>Formula for selection equation, a Probit model with random effects</p>
</td></tr>
<tr><td><code id="ProbitRE_PoissonRE_+3A_out_form">out_form</code></td>
<td>
<p>Formula for outcome equation, a Poisson model with random effects</p>
</td></tr>
<tr><td><code id="ProbitRE_PoissonRE_+3A_data">data</code></td>
<td>
<p>Input data, a data.frame object</p>
</td></tr>
<tr><td><code id="ProbitRE_PoissonRE_+3A_id.name">id.name</code></td>
<td>
<p>The name of the column representing id. Data will be sorted by id to improve estimation speed.</p>
</td></tr>
<tr><td><code id="ProbitRE_PoissonRE_+3A_testdata">testData</code></td>
<td>
<p>Test data for prediction, a data.frame object</p>
</td></tr>
<tr><td><code id="ProbitRE_PoissonRE_+3A_par">par</code></td>
<td>
<p>Starting values for estimates. Default to estimates of standalone selection and outcome models.</p>
</td></tr>
<tr><td><code id="ProbitRE_PoissonRE_+3A_delta">delta</code></td>
<td>
<p>Starting value for delta. Will be ignored if par is provided.</p>
</td></tr>
<tr><td><code id="ProbitRE_PoissonRE_+3A_sigma">sigma</code></td>
<td>
<p>Starting value for sigma. Will be ignored if par is provided.</p>
</td></tr>
<tr><td><code id="ProbitRE_PoissonRE_+3A_rho">rho</code></td>
<td>
<p>Starting value for rho. Defaults to 0 and will be ignored if par is provided.</p>
</td></tr>
<tr><td><code id="ProbitRE_PoissonRE_+3A_method">method</code></td>
<td>
<p>Optimization method used by optim. Defaults to 'BFGS'.</p>
</td></tr>
<tr><td><code id="ProbitRE_PoissonRE_+3A_se_type">se_type</code></td>
<td>
<p>Report Hessian or BHHH standard errors. Defaults to BHHH.</p>
</td></tr>
<tr><td><code id="ProbitRE_PoissonRE_+3A_h">H</code></td>
<td>
<p>A integer vector of length 2, specifying the number of points for inner and outer Quadratures</p>
</td></tr>
<tr><td><code id="ProbitRE_PoissonRE_+3A_psnh">psnH</code></td>
<td>
<p>Number of Quadrature points for Poisson RE model</p>
</td></tr>
<tr><td><code id="ProbitRE_PoissonRE_+3A_prbh">prbH</code></td>
<td>
<p>Number of Quddrature points for Probit RE model</p>
</td></tr>
<tr><td><code id="ProbitRE_PoissonRE_+3A_reltol">reltol</code></td>
<td>
<p>Relative convergence tolerance. The algorithm stops if it is unable to reduce the value by a factor of reltol * (abs(val) + reltol) at a step. Defaults to sqrt(.Machine$double.eps), typically about 1e-8.</p>
</td></tr>
<tr><td><code id="ProbitRE_PoissonRE_+3A_verbose">verbose</code></td>
<td>
<p>A integer indicating how much output to display during the estimation process.
</p>

<ul>
<li><p> &lt;0 - No ouput
</p>
</li>
<li><p> 0 - Basic output (model estimates)
</p>
</li>
<li><p> 1 - Moderate output, basic ouput + parameter and likelihood in each iteration
</p>
</li>
<li><p> 2 - Extensive output, moderate output + gradient values on each call
</p>
</li></ul>
</td></tr>
<tr><td><code id="ProbitRE_PoissonRE_+3A_offset_w_name">offset_w_name</code></td>
<td>
<p>An offset variable whose coefficient is assumed to be 1 in the selection equation</p>
</td></tr>
<tr><td><code id="ProbitRE_PoissonRE_+3A_offset_x_name">offset_x_name</code></td>
<td>
<p>An offset variable whose coefficient is assumed to be 1 in the outcome equation</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the results of the estimated model, some of which are inherited from the return of optim
</p>

<ul>
<li><p> estimates: Model estimates with 95% confidence intervals
</p>
</li>
<li><p> par: Point estimates
</p>
</li>
<li><p> var_bhhh: BHHH covariance matrix, inverse of the outer product of gradient at the maximum
</p>
</li>
<li><p> se_bhhh: BHHH standard errors
</p>
</li>
<li><p> g: Gradient function at maximum
</p>
</li>
<li><p> gtHg: <code class="reqn">g'H^-1g</code>, where H^-1 is approximated by var_bhhh. A value close to zero (e.g., &lt;1e-3 or 1e-6) indicates good convergence.
</p>
</li>
<li><p> LL: Likelihood
</p>
</li>
<li><p> AIC: AIC
</p>
</li>
<li><p> BIC: BIC
</p>
</li>
<li><p> n_obs: Number of observations
</p>
</li>
<li><p> time: Time takes to estimate the model
</p>
</li>
<li><p> partial: Average partial effect at the population level
</p>
</li>
<li><p> paritalAvgObs: Partial effect for an individual with average characteristics
</p>
</li>
<li><p> predict: A list with predicted participation probability (prob), predicted potential outcome (outcome), and predicted actual outcome (actual_outcome).
</p>
</li>
<li><p> counts: From optim. A two-element integer vector giving the number of calls to fn and gr respectively. This excludes those calls needed to compute the Hessian, if requested, and any calls to fn to compute a finite-difference approximation to the gradient.
</p>
</li>
<li><p> message: From optim. A character string giving any additional information returned by the optimizer, or NULL.
</p>
</li>
<li><p> convergence: From optim. An integer code. 0 indicates successful completion.
Note that the list inherits all the complements in the output of optim. See the documentation of optim for more details.
</p>
</li></ul>



<h3>References</h3>


<ol>
<li><p> Peng, J., &amp; Van den Bulte, C. (2023). Participation vs. Effectiveness in Sponsored Tweet Campaigns: A Quality-Quantity Conundrum. Management Science (forthcoming). Available at SSRN: <a href="https://www.ssrn.com/abstract=2702053">https://www.ssrn.com/abstract=2702053</a>
</p>
</li>
<li><p> Peng, J., &amp; Van den Bulte, C. (2015). How to Better Target and Incent Paid Endorsers in Social Advertising Campaigns: A Field Experiment. 2015 International Conference on Information Systems. <a href="https://aisel.aisnet.org/icis2015/proceedings/SocialMedia/24/">https://aisel.aisnet.org/icis2015/proceedings/SocialMedia/24/</a>
</p>
</li></ol>



<h3>See Also</h3>

<p>Other PanelCount: 
<code><a href="#topic+PLN_RE">PLN_RE</a>()</code>,
<code><a href="#topic+PoissonRE">PoissonRE</a>()</code>,
<code><a href="#topic+ProbitRE_PLNRE">ProbitRE_PLNRE</a>()</code>,
<code><a href="#topic+ProbitRE">ProbitRE</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Use the simulated dataset, in which the true coefficients of x and w are 1 in both stages.
# The simulated dataset includes self-selection at both individual and individual-time level,
# but this model only considers self-selection at the individual level.
data(sim)
res = ProbitRE_PoissonRE(z~x+w, y~x, data=sim, id.name='id')
res$estimates

</code></pre>

<hr>
<h2 id='sim'>Simulated dataset with self-selection at both individual and individual-time level</h2><span id='topic+sim'></span>

<h3>Description</h3>

<p>A simulated dataset with 200 individuals and 10 periods. The true data generating process is the following: <br /><br />
Selection equation (ProbitRE - Probit model with individual level random effects):
</p>
<p style="text-align: center;"><code class="reqn">z_{it}=1(1+x_{it}+w_{it}+u_i+\xi_{it} &gt; 0</code>
</p>

<p>Outcome Equation (PLN_RE - Poisson Lognormal model with individual-time level random effects):
</p>
<p style="text-align: center;"><code class="reqn">E[y_{it}|x_{it},v_i,\epsilon_{it}] = exp(-1+x_{it} + v_i + \epsilon_{it})</code>
</p>

<p>Correlation (self-selection at both individual and individual-time level):
</p>

<ul>
<li> <p><code class="reqn">u_i</code> and <code class="reqn">v_i</code> are bivariate normally distributed with a correlation of 0.25.
</p>
</li>
<li> <p><code class="reqn">\xi_{it}</code> and <code class="reqn">\epsilon_{it}</code> are bivariate normally distributed with a correlation of 0.5.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>sim
</code></pre>


<h3>Format</h3>

<p>A simulated dataset with 200 individuals and 10 periods.
</p>

<dl>
<dt>id</dt><dd><p>id, from 1-200</p>
</dd>
<dt>time</dt><dd><p>Time periods, from 1-10</p>
</dd>
<dt>z</dt><dd><p>Whether an individual is selected in a given period. Outcome is observed only when z=1</p>
</dd>
<dt>y</dt><dd><p>The outcome of an individual in a given period</p>
</dd>
<dt>x</dt><dd><p>A covariate influencing both z and y, with true effects being 1</p>
</dd>
<dt>w</dt><dd><p>A covariate influencing only z, with true effect being 1</p>
</dd>
</dl>


</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
