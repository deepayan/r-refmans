<!DOCTYPE html><html lang="en-US"><head><title>Help for package svycdiff</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {svycdiff}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#NHANES'><p>Race, SES, and Telomere Length Data</p></a></li>
<li><a href='#simdat'><p>Simulate data with varying degrees of selection and confounding bias</p></a></li>
<li><a href='#svycdiff'><p>Controlled Difference Estimation for Complex Surveys</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Controlled Difference Estimation for Complex Surveys</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.1</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Stephen Salerno &lt;ssalerno@fredhutch.org&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimates the population average controlled difference for a given outcome between levels of a binary treatment, exposure, or other group membership variable of interest for clustered, stratified survey samples where sample selection depends on the comparison group. Provides three methods for estimation, namely outcome modeling and two factorizations of inverse probability weighting. Under stronger assumptions, these methods estimate the causal population average treatment effect. Salerno et al., (2024) &lt;<a href="https://doi.org/10.48550%2FarXiv.2406.19597">doi:10.48550/arXiv.2406.19597</a>&gt;. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Imports:</td>
<td>betareg, numDeriv, stats, survey</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, markdown, spelling</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/salernos/svycdiff">https://github.com/salernos/svycdiff</a>,
<a href="https://salernos.github.io/svycdiff/">https://salernos.github.io/svycdiff/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/salernos/svycdiff/issues">https://github.com/salernos/svycdiff/issues</a></td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-07-31 20:59:37 UTC; saler</td>
</tr>
<tr>
<td>Author:</td>
<td>Stephen Salerno <a href="https://orcid.org/0000-0003-2763-0494"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre, cph],
  Emily K Roberts [aut],
  Tyler H McCormick [aut],
  Bhramar Mukherjee [aut],
  Xu Shi [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-08-20 14:40:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='NHANES'>Race, SES, and Telomere Length Data</h2><span id='topic+NHANES'></span>

<h3>Description</h3>

<p>National Health and Nutrition Examination Survey (NHANES) data on race,
socioeconomic status, and leukocyte telomere length from the 1999-2000
and 2001-2002 survey waves.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(NHANES)
</code></pre>


<h3>Format</h3>

<p>A dataset with 5,298 observations (rows) of 29 variables (columns):
</p>

<dl>
<dt>SEQN</dt><dd><p>Numeric: Respondent Sequence Number</p>
</dd>
<dt>iWTMEC4YR</dt><dd><p>Numeric: 1/WTMEC4YR (Full Sample 4 Year Probability of
Selection)</p>
</dd>
<dt>WTMEC4YR</dt><dd><p>Numeric: Full Sample 4 Year Interview Weight</p>
</dd>
<dt>SDMVPSU</dt><dd><p>Numeric: Masked Variance Pseudo-PSU</p>
</dd>
<dt>SDMVSTRA</dt><dd><p>Numeric: Masked Variance Pseudo-Stratum</p>
</dd>
<dt>TELOMEAN</dt><dd><p>Numeric: Mean T/S Ratio (See Details)</p>
</dd>
<dt>lTELOMEAN</dt><dd><p>Numeric: log(TELOMEAN)</p>
</dd>
<dt>RACE_2CAT</dt><dd><p>Numeric: 0 = Non-Hispanic White, 1 = Non-Hispanic Black
(0/1 Coded for Current Functionality)</p>
</dd>
<dt>AGE</dt><dd><p>Numeric: Age at Screening (Years)</p>
</dd>
<dt>SEX</dt><dd><p>Factor w/ 2 Levels: Self-Reported Sex - Male, Female</p>
</dd>
<dt>EDUC_3CAT</dt><dd><p>Factor w/ 3 Levels: Education - High School or GED,
Some College, College Graduate</p>
</dd>
<dt>MARTL_3CAT</dt><dd><p>Factor w/ 3 Levels: Marital Status - Never Married,
Widowed/Divorced/Separated, Married/Living with Partner</p>
</dd>
<dt>HHSIZE_3CAT</dt><dd><p>Factor w/ 5 Levels: Household Size - 1 Person,
2 People, 3 People, 4 People, 5+ People</p>
</dd>
<dt>HHINC_5CAT</dt><dd><p>Factor w/ 5 Levels: Annual Household Income -
$0 - $20,000, $20,000 - $35,000, $35,000 - $55,000,
$55,000 - $75,000, $75,000+</p>
</dd>
<dt>PIR</dt><dd><p>Factor w/ 3 Levels: Family Poverty-Income Ratio Category -
&lt; 1.3, 1.3 &lt;= PIR &lt; 3.5, &gt;= 3.5</p>
</dd>
<dt>EMPSTAT_4CAT</dt><dd><p>Factor w/ 4 Levels: Employment Status - Full-Time,
Part-Time, Retired, Not Working</p>
</dd>
<dt>OCC_5CAT</dt><dd><p>Factor w/ 5 Levels: Occupation Category - No Work,
Low Blue Collar, High Blue Collar, Low White Collar,
High White Collar</p>
</dd>
<dt>WIC_2CAT</dt><dd><p>Factor w/ 2 Levels: WIC Utilization - No WIC,
Received WIC</p>
</dd>
<dt>FDSEC_3CAT</dt><dd><p>Factor w/ 3 Levels: Food Security Status - Food Secure,
Marginally Food Secure, Food Insecure</p>
</dd>
<dt>HOD_4CAT</dt><dd><p>Factor w/ 4 Levels: Home Type - Family Home Detached,
Family Home Attached, Apartment, Other</p>
</dd>
<dt>OWNHOME_2CAT</dt><dd><p>Factor w/ 2 Levels: Home Ownership -
Does Not Own Home, Owns Home</p>
</dd>
<dt>HIQ_2CAT</dt><dd><p>Factor w/ 2 Levels: Insurance Status - Not Insured,
Insured</p>
</dd>
<dt>LBXWBCSI</dt><dd><p>Numeric: White Blood Cell Count (SI)</p>
</dd>
<dt>LBXLYPCT</dt><dd><p>Numeric: Lymphocyte Percent (%)</p>
</dd>
<dt>LBXMOPCT</dt><dd><p>Numeric: Monocyte Percent (%)</p>
</dd>
<dt>LBXNEPCT</dt><dd><p>Numeric: Segmented Neutrophils Percent (%)</p>
</dd>
<dt>LBXEOPCT</dt><dd><p>Numeric: Eosinophils Percent (%)</p>
</dd>
<dt>LBXBAPCT</dt><dd><p>Numeric: Basophils Percent (%)</p>
</dd>
<dt>LBXBPB_LOD</dt><dd><p>Numeric: Blood Lead Concentration (ug/dL; LOD = 0.3
ug/dL; Imputed by LOD / sqrt(2))</p>
</dd>
</dl>



<h3>Details</h3>

<p>Our initial sample consisted of 7,839 participants in the 1999-2002 NHANES
waves with laboratory measures recorded, including telomere length,
<code>lTELOMEAN</code>, which was assayed via quantitative polymerase chain
reaction (PCR; see Cawthorn, 2002). Our primary endpoint is the
log-transformed mean ratio of an individual's telomere length to a standard
reference DNA sample across all leukocyte cell types (mean T/S),
<code>TELOMEAN</code>. We focus on the 1999-2002 NHANES waves, as they featured
4-year adjusted survey weights, <code>WTMEC4YR</code>, designed for aggregating
data across cohorts. Among the initial 7,839 participants, 5,308 (67.7%)
self-identified as either non-Hispanic White or non-Hispanic Black.
Excluding those participants without our outcome of interest, our final
analytic sample contained 5,298 Non-Hispanic White or Non-Hispanic Black
identifying participants with measured telomere length. Race,
<code>RACE_2CAT</code>, is our variable of interest. We further included study
participant age, sex, and blood cell composition to account for known
differences in these factors, as well as twelve indicators of SES. Ten of
these, namely marital status, education level, household income, insurance
status, Special Supplemental Nutrition Program for Women, Infants, and
Children (WIC) usage, household size, home ownership, home type, food
security status, and an individual’s poverty income ratio (PIR), were
extracted directly from the NHANES demographic and occupation questionnaires.
Occupation category was constructed by mapping occupation group codes in the
NHANES 1999-2002 occupation questionnaire to the national statistics
socioeconomic job classifications, and employment status was derived from
three occupational measures: type of work done last week, hours worked last
week at all jobs, and main reason for not working last week (see Rehkopf et
al., 2008, Rose et al., 2005).
</p>


<h3>Source</h3>

<p>&lt;https://www.cdc.gov/nchs/nhanes/index.htm&gt;
</p>


<h3>References</h3>

<p>Richard M Cawthon. Telomere measurement by quantitative pcr. Nucleic acids
research, 30(10):e47–e47, 2002.
</p>
<p>David H Rehkopf, Lisa F Berkman, Brent Coull, and Nancy Krieger. The
non-linear risk of mortality by income level in a healthy population: Us
national health and nutrition examination survey mortality follow-up cohort,
1988–2001. BMC Public Health, 8(1):1–11, 2008.
</p>
<p>David Rose, David J Pevalin, and Karen O’Reilly. The National Statistics
Socio-economic Classification: origins, development and use. Palgrave
Macmillan, 2005.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(NHANES)
</code></pre>

<hr>
<h2 id='simdat'>Simulate data with varying degrees of selection and confounding bias</h2><span id='topic+simdat'></span>

<h3>Description</h3>

<p>Function to simulate data based on specified relationships between the
generated (continuous) outcome, variable of interest, confounder, and
selection mechanism.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simdat(
  N,
  X_dist = "continuous",
  S_known = FALSE,
  tau_0 = 0,
  tau_X = 1,
  beta_0 = 0,
  beta_A = 1,
  beta_X = 1,
  hetero = TRUE,
  alpha_0 = 0,
  alpha_X = 1,
  alpha_A = 1,
  alpha_AX = 0.1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="simdat_+3A_n">N</code></td>
<td>
<p>int - Number of observations to be generated</p>
</td></tr>
<tr><td><code id="simdat_+3A_x_dist">X_dist</code></td>
<td>
<p>string - Distribution of the confounding variable, X. Defaults
to &quot;continuous&quot; for a N(1, 1) variable, or &quot;binary&quot; for a Bernoulli(0.5)
variable</p>
</td></tr>
<tr><td><code id="simdat_+3A_s_known">S_known</code></td>
<td>
<p>boolean - Logical for whether the selection mechanism should
be treated as known (deterministic) or needs to be estimated (simulated with
Gaussian error; defaults to FALSE)</p>
</td></tr>
<tr><td><code id="simdat_+3A_tau_0">tau_0</code></td>
<td>
<p>double - Intercept for propensity model (defaults to 0)</p>
</td></tr>
<tr><td><code id="simdat_+3A_tau_x">tau_X</code></td>
<td>
<p>double - Coefficient for X in propensity model (defaults to 1)</p>
</td></tr>
<tr><td><code id="simdat_+3A_beta_0">beta_0</code></td>
<td>
<p>double - Intercept for selection model (defaults to 0)</p>
</td></tr>
<tr><td><code id="simdat_+3A_beta_a">beta_A</code></td>
<td>
<p>double - Coefficient for A in selection model (defaults to 1)</p>
</td></tr>
<tr><td><code id="simdat_+3A_beta_x">beta_X</code></td>
<td>
<p>double - Coefficient for X in selection model (defaults to 1)</p>
</td></tr>
<tr><td><code id="simdat_+3A_hetero">hetero</code></td>
<td>
<p>boolean - Logical for heterogeneous treatment effect in
the outcome model (defaults to TRUE)</p>
</td></tr>
<tr><td><code id="simdat_+3A_alpha_0">alpha_0</code></td>
<td>
<p>double - Intercept for outcome model (defaults to 0)</p>
</td></tr>
<tr><td><code id="simdat_+3A_alpha_x">alpha_X</code></td>
<td>
<p>double - Coefficient for X in outcome model (defaults to 1)</p>
</td></tr>
<tr><td><code id="simdat_+3A_alpha_a">alpha_A</code></td>
<td>
<p>double - Coefficient for A in outcome model (defaults to 1)</p>
</td></tr>
<tr><td><code id="simdat_+3A_alpha_ax">alpha_AX</code></td>
<td>
<p>double - Coefficient for interaction between A and X in
outcome model (only used if <code>hetero == TRUE</code>; defaults to 0.1)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data are generated as follows. For a user-given number, <code>N</code>,
observations in our so-called super population, we first generate a
confounding variable, <code>X</code>, which relates to our outcome, <code>Y</code>, our
variable of interest, <code>A</code>, and our selection indicator, <code>S</code>.
We generate population-level data with <code>X ~ N(1,1)</code> or
<code>X ~ Bern(0.5)</code> depending on whether distribution of <code>X</code> is
chosen to be <code>X_dist = "continous"</code> or <code>X_dist = "binary"</code>,
respectively.
</p>
<p>We then generate the remaining data from three models:
</p>

<dl>
<dt>1. Propensity Model</dt><dd></dd>
<dt>2. Selection Model</dt><dd></dd>
<dt>3. Outcome Model</dt><dd></dd>
</dl>



<h3>Value</h3>

<p>A <code>data.frame</code> with <code>N</code> observations of 7 variables:
</p>

<dl>
<dt>Y</dt><dd><p>Observed outcome (continuous)</p>
</dd>
<dt>A</dt><dd><p>Comparison group variable of interest (binary)</p>
</dd>
<dt>X</dt><dd><p>Confounding variable (continuous or binary)</p>
</dd>
<dt>P_A_cond_X</dt><dd><p>True probability of A = 1 conditional on X (continuous)</p>
</dd>
<dt>P_S_cond_AX</dt><dd><p>True probability of selection (S = 1) conditional on A and X (continuous)</p>
</dd>
<dt>P_S_cond_A1X</dt><dd><p>True probability of selection (S = 1) conditional on A = 1 and X (continuous)</p>
</dd>
<dt>P_S_cond_A0X</dt><dd><p>True probability of selection (S = 1) conditional on A = 0 and X (continuous)</p>
</dd>
<dt>CDIFF</dt><dd><p>True controlled difference in outcomes by comparison group (double)</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>
N &lt;- 100000

dat &lt;- simdat(N)

head(dat)

</code></pre>

<hr>
<h2 id='svycdiff'>Controlled Difference Estimation for Complex Surveys</h2><span id='topic+svycdiff'></span>

<h3>Description</h3>

<p>This is the main function to estimate population average controlled
difference (ACD), or under stronger assumptions, the population average
treatment effect (PATE), for a given outcome between levels of a binary
treatment, exposure, or other group membership variable of interest for
clustered, stratified survey samples where sample selection depends on
the comparison group.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>svycdiff(
  df,
  id_form,
  a_form,
  s_form,
  y_form,
  y_fam = NULL,
  strata = NULL,
  cluster = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="svycdiff_+3A_df">df</code></td>
<td>
<p>a data frame or tibble containing the variables in the models.</p>
</td></tr>
<tr><td><code id="svycdiff_+3A_id_form">id_form</code></td>
<td>
<p>a string indicating which identification formula to be used.
Options include &quot;OM&quot;, &quot;IPW1&quot;, or &quot;IPW2&quot;. See 'Details' for more information.</p>
</td></tr>
<tr><td><code id="svycdiff_+3A_a_form">a_form</code></td>
<td>
<p>an object of class 'formula' which describes the propensity
score model to be fit.</p>
</td></tr>
<tr><td><code id="svycdiff_+3A_s_form">s_form</code></td>
<td>
<p>an object of class 'formula' which describes the selection
model to be fit.</p>
</td></tr>
<tr><td><code id="svycdiff_+3A_y_form">y_form</code></td>
<td>
<p>an object of class 'formula' which describes the outcome model
to be fit. Only used if 'id_form' = &quot;OM&quot;, else 'y_form = y ~ 1'.</p>
</td></tr>
<tr><td><code id="svycdiff_+3A_y_fam">y_fam</code></td>
<td>
<p>a family function. Only used if 'id_form' = &quot;OM&quot;, else
'y_fam = NULL'.</p>
</td></tr>
<tr><td><code id="svycdiff_+3A_strata">strata</code></td>
<td>
<p>a string indicating strata, else 'strata = NULL' for no strata.</p>
</td></tr>
<tr><td><code id="svycdiff_+3A_cluster">cluster</code></td>
<td>
<p>a string indicating cluster IDs, else 'cluster = NULL' for no
clusters.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The argument <code>id_form</code> takes possible values &quot;OM&quot;, &quot;IPW1&quot;, or &quot;IPW2&quot;,
corresponding to the three formulas presented in Salerno et al. &quot;OM&quot; refers
to the method that uses outcome modeling and direct standardization to
estimate the controlled difference, while IPW1 and IPW2 are inverse
probability weighted methods. IPW1 and IPW2 differ with respect to how the
joint propensity and selection mechanisms are factored (see Salerno et al.
for additional details). &quot;OM&quot;, &quot;IPW1&quot;, or &quot;IPW2&quot; are useful in different
settings, which warrants some brief discussion here. &quot;OM&quot; requires you to
specify an outcome regression model, whereas &quot;IPW1&quot; and &quot;IPW2&quot; do not
require estimation, nor do they assume additivity or interactivity. However,
while OM, IPW1, and IPW2 are consistent, OM is most efficient if correctly
specified.
</p>
<p>For IPW1/IPW2, <code>y_form</code> should be of the form <code>Y ~ 1</code>.
</p>
<p>For known S, <code>s_form</code> should be of the form <code>S ~ 1</code>, where
<code>S</code> is the variable corresponding to the probability of selection.
There should be two additional variables in the dataset: P_S_cond_A1X and
P_S_cond_A0X, corresponding to the known probability of selection
conditional on A = 1 or 0 and X = x, respectively. If these quantities are
not known, s_form should contain the variables which affect sample selection
on the right hand side of the equation, including the comparison group
variable of interest.
</p>


<h3>Value</h3>

<p>'svycdiff' returns an object of class &quot;svycdiff&quot; which contains:
</p>

<dl>
<dt>id_form</dt><dd><p>A string denoting Which method was selected for estimation</p>
</dd>
<dt>cdiff</dt><dd><p>A named vector containing the point estimate (est),
standard error (err), lower confidence limit (lcl),
upper confidence limit (ucl), and p-value (pval) for
the estimated controlled difference</p>
</dd>
<dt>fit_y</dt><dd><p>An object of class inheriting from &quot;glm&quot; corresponding to
the outcome model fit, or NULL for IPW1 and IPW2</p>
</dd>
<dt>fit_a</dt><dd><p>An object of class inheriting from &quot;glm&quot; corresponding to
the propensity model fit</p>
</dd>
<dt>wtd_fit_a</dt><dd><p>An object of class inheriting from &quot;glm&quot; corresponding
to the weighted propensity model fit</p>
</dd>
<dt>fit_s</dt><dd><p>An object of class &quot;betareg&quot; corresponding to the selection
model fit, or NULL if the selection mechanism is known</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>
N &lt;- 1000

dat &lt;- simdat(N)

S &lt;- rbinom(N, 1, dat$P_S_cond_AX)

samp &lt;- dat[S == 1,]

y_mod &lt;- Y ~ A * X

a_mod &lt;- A ~ X

s_mod &lt;- P_S_cond_AX ~ A + X

fit &lt;- svycdiff(samp, "OM", a_mod, s_mod, y_mod, "gaussian")

fit

summary(fit)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
