<!DOCTYPE html><html><head><title>Help for package heatmapFit</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {heatmapFit}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#heatmapFit'><p>heatmapFit.</p></a></li>
<li><a href='#heatmap.compress'><p>Collapse a large data set for <code>heatmap.fit</code></p></a></li>
<li><a href='#heatmap.fit'><p>Heatmap Fit Statistic for Binary Dependent Variable Models</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Fit Statistic for Binary Dependent Variable Models</td>
</tr>
<tr>
<td>Version:</td>
<td>2.0.4</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Justin Esarey &lt;justin@justinesarey.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Generates a fit plot for diagnosing misspecification in models of
    binary dependent variables, and calculates the related heatmap fit
    statistic described in Esarey and Pierce (2012) &lt;<a href="https://doi.org/10.1093%2Fpan%2Fmps026">doi:10.1093/pan/mps026</a>&gt;.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1.1), stats, graphics, grDevices</td>
</tr>
<tr>
<td>Imports:</td>
<td>utils</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>5.0.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2016-06-06 16:35:43 UTC; justi</td>
</tr>
<tr>
<td>Author:</td>
<td>Justin Esarey [aut, cre],
  Andrew Pierce [aut],
  Jericho Du [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2016-06-06 20:36:28</td>
</tr>
</table>
<hr>
<h2 id='heatmapFit'>heatmapFit.</h2><span id='topic+heatmapFit'></span><span id='topic+heatmapFit-package'></span>

<h3>Description</h3>

<p>heatmapFit.
</p>

<hr>
<h2 id='heatmap.compress'>Collapse a large data set for <code>heatmap.fit</code></h2><span id='topic+heatmap.compress'></span>

<h3>Description</h3>

<p>Reduces the size of large binary data sets by binning them according to their predicted probability [0, 1].
</p>


<h3>Usage</h3>

<pre><code class='language-R'>heatmap.compress(y, pred, init.grid)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="heatmap.compress_+3A_y">y</code></td>
<td>
<p>A vector of observations of the dependent variable (in {0,1}).</p>
</td></tr>
<tr><td><code id="heatmap.compress_+3A_pred">pred</code></td>
<td>
<p>A vector of predicted Pr(y = 1) corresponding to each element of <code>y</code>.</p>
</td></tr>
<tr><td><code id="heatmap.compress_+3A_init.grid">init.grid</code></td>
<td>
<p>The number of bins on the interval [0, 1] to use for compression of <code>pred</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the elements:
</p>
<table>
<tr><td><code>y.out</code></td>
<td>
<p>The value of <code>y</code>, 0 or 1.</p>
</td></tr> 
<tr><td><code>pred.out</code></td>
<td>
<p>The (binned) predicted Pr(y = 1) matching each observation.</p>
</td></tr>
<tr><td><code>weight.out</code></td>
<td>
<p>A weight parameter indicating the proportion of observations in the bin; sums to one.</p>
</td></tr>
<tr><td><code>pred.total.out</code></td>
<td>
<p>A vector of unique Pr(y = 1) bin values.</p>
</td></tr>
<tr><td><code>n.out</code></td>
<td>
<p>The number of observations (non-empty bins) after the data are collapsed.</p>
</td></tr>
<tr><td><code>retained.obs</code></td>
<td>
<p>A vector of indices for non-empty candidate bins (for internal use by <code>heatmap.fit</code>).</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Justin Esarey &lt;justin@justinesarey.com&gt;
</p>

<hr>
<h2 id='heatmap.fit'>Heatmap Fit Statistic for Binary Dependent Variable Models</h2><span id='topic+heatmap.fit'></span>

<h3>Description</h3>

<p>Generates a fit plot for diagnosing misspecification in models of binary dependent variables, and calculates the related heatmap fit statistic (Esarey and Pierce, 2012).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>heatmap.fit(y, pred, calc.boot = TRUE, reps = 1000, span.l = "aicc",
  color = FALSE, compress.obs = TRUE, init.grid = 2000, ret.obs = FALSE,
  legend = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="heatmap.fit_+3A_y">y</code></td>
<td>
<p>A vector of observations of the dependent variable (in {0,1}).</p>
</td></tr>
<tr><td><code id="heatmap.fit_+3A_pred">pred</code></td>
<td>
<p>A vector of model-predicted Pr(y = 1) corresponding to each element of <code>y</code>.</p>
</td></tr>
<tr><td><code id="heatmap.fit_+3A_calc.boot">calc.boot</code></td>
<td>
<p>Calculate bootstrap-based p-values (default = <code>TRUE</code>) or not (= <code>FALSE</code>).</p>
</td></tr>
<tr><td><code id="heatmap.fit_+3A_reps">reps</code></td>
<td>
<p>Number of bootstrap replicates to generate (default = 1000).</p>
</td></tr>
<tr><td><code id="heatmap.fit_+3A_span.l">span.l</code></td>
<td>
<p>Bandwidth for the nonparametric fit between <code>y</code> and <code>pred</code>. Defaults to &quot;aicc&quot;, calculation of an AICc-minimizing bandwidth. Other options are &quot;gcv&quot;, which minimizes the generalized cross-validation statistic, or a numerical bandwidth.</p>
</td></tr>
<tr><td><code id="heatmap.fit_+3A_color">color</code></td>
<td>
<p>Whether the plot should be in color (<code>TRUE</code>) or grayscale (the default, <code>FALSE</code>).</p>
</td></tr>
<tr><td><code id="heatmap.fit_+3A_compress.obs">compress.obs</code></td>
<td>
<p>Whether large data sets should be compressed by pre-binning to save computing time (default <code>TRUE</code>). When true, only data sets larger than 10,000 observations will be compressed.</p>
</td></tr>
<tr><td><code id="heatmap.fit_+3A_init.grid">init.grid</code></td>
<td>
<p>If <code>compress.obs = TRUE</code>, the number of bins on the interval [0, 1] to use for compression of <code>pred</code>.</p>
</td></tr>
<tr><td><code id="heatmap.fit_+3A_ret.obs">ret.obs</code></td>
<td>
<p>Return the one-tailed bootstrap p-value for each observation in <code>y</code> (<code>TRUE</code>) or not (the default, <code>FALSE</code>).</p>
</td></tr>
<tr><td><code id="heatmap.fit_+3A_legend">legend</code></td>
<td>
<p>Print the legend on the heat map plot (the default, <code>TRUE</code>) or not (<code>FALSE</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function plots the degree to which a binary dependent variable (BDV) model generates predicted probabilities that are an accurate match for observed empirical probabilities of the BDV, in-sample or out-of-sample. For example, if a model predicts that Pr(y = 1) = k%, about k% of observations with this predicted probability should have y = 1. Loess smoothing (with an automatically-selected optimum bandwidth) is used to estimate empirical probabilities in the data set and to overcome sparseness of the data. Systematic deviations are distinguished from sampling variation via bootstrapping of the distribution under the null that the model is an accurate predictor, with p-values indicating the one-tailed proportion of bootstrap samples that are less-extreme than the observed deviation. The plot shows model predicted probabilities on the x-axis and smoothed empirical probabilities on the y-axis, with a histogram indicating the location and frequency of observations. The ideal fit is a 45-degree line. The shading of the plotted line indicates the degree to which fit deviations are larger than expected due to sampling variation.
</p>
<p>A summary statistic for fit (the &quot;heatmap statistic&quot;) is also reported. This statistic is the proportion of the sample in a region with one-tailed p-value less than or equal to 10%. Finding more than 20% of the dataset with this p-value in this region is diagnostic of misspecification in the model.
</p>
<p>More details for the technique are given in Esarey and Pierce 2012, &quot;Assessing Fit Quality and Testing for Misspecification in Binary Dependent Variable Models,&quot; <em>Political Analysis</em> 20(4): 480-500.
</p>


<h3>Value</h3>

<p>If <code>ret.obs = T</code>, a list with the element:
</p>
<table>
<tr><td><code>heatmap.obs.p</code></td>
<td>
<p>The one-tailed bootstrap p-value corresponding to each observation in <code>y</code>.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Code to calculate AICc and GCV written by Michael Friendly (http://tolstoy.newcastle.edu.au/R/help/05/11/15899.html).
</p>


<h3>Author(s)</h3>

<p>Justin Esarey &lt;justin@justinesarey.com&gt;
</p>
<p>Andrew Pierce &lt;awpierc@emory.edu&gt;
</p>
<p>Jericho Du &lt;jericho.du@gmail.com&gt;
</p>


<h3>References</h3>

<p>Esarey, Justin and Andrew Pierce (2012). &quot;Assessing Fit Quality and Testing for Misspecification in Binary Dependent Variable Models.&quot; <em>Political Analysis</em> 20(4): 480-500. DOI:10.1093/pan/mps026.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## a correctly specified model
###############################

set.seed(123456)
x &lt;- runif(20000)
y &lt;- as.numeric( runif(20000) &lt; pnorm(2*x - 1) )
mod &lt;- glm( y ~ x, family=binomial(link="probit"))
pred &lt;- predict(mod, type="response")

heatmap.fit(y, pred, reps=1000)

## out-of-sample prediction w/o bootstrap p-values

set.seed(654321)
x &lt;- runif(1000)
y &lt;- as.numeric( runif(1000) &lt; pnorm(2*x - 1) )
pred &lt;- predict(mod, type="response", newdata=data.frame(x))

heatmap.fit(y, pred, calc.boot=FALSE)



## a misspecified model
########################

set.seed(13579)
x &lt;- runif(20000)
y &lt;- as.numeric( runif(20000) &lt; pnorm(sin(10*x)) )
mod &lt;- glm( y ~ x, family=binomial(link="probit"))
pred &lt;- predict(mod, type="response")
heatmap.fit(y, pred, reps=1000)

## Comparison with and without data compression

system.time(heatmap.fit(y, pred, reps=100))
system.time(heatmap.fit(y, pred, reps=100, compress.obs=FALSE))

## End(Not run)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
