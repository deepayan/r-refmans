<!DOCTYPE html><html><head><title>Help for package gastempt</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {gastempt}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#coef.nlme_gastempt'><p>Extract coefficients from nlme_gastempt result</p></a></li>
<li><a href='#coef.stan_gastempt'><p>Extract coefficients from stan_gastempt result</p></a></li>
<li><a href='#gastemptfunc'><p>Functions for gastric emptying analysis</p></a></li>
<li><a href='#nlme_gastempt'><p>Simplified population fit of gastric emptying data</p></a></li>
<li><a href='#plot.nlme_gastempt'><p>Plot data points and fit curve of an nlme_gastempt fit</p></a></li>
<li><a href='#plot.stan_gastempt'><p>Plot data points and fit curve of an stan_gastempt fit</p></a></li>
<li><a href='#run_shiny'><p>Run shiny app demonstrating fit strategies with simulated data</p></a></li>
<li><a href='#simulate_gastempt'><p>Simulate gastric emptying data following a linexp or powexp function</p></a></li>
<li><a href='#stan_gastempt'><p>Fit gastric emptying curves with Stan</p></a></li>
<li><a href='#stan_model_names'><p>Names and descriptions of precompiled Stan models</p></a></li>
<li><a href='#t50'><p>Compute half-emptying time from nlme parameters</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>0.5.5</td>
</tr>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Analyzing Gastric Emptying from MRI or Scintigraphy</td>
</tr>
<tr>
<td>Description:</td>
<td>Fits gastric emptying time series from MRI or 'scintigraphic' measurements
   using nonlinear mixed-model population fits with 'nlme' and Bayesian methods with 
   Stan; computes derived parameters such as t50 and AUC.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/dmenne/gastempt">https://github.com/dmenne/gastempt</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/dmenne/gastempt/issues">https://github.com/dmenne/gastempt/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>nlme, Rcpp (&ge; 1.0.3), dplyr, methods, tibble (&ge; 3.0.0),
ggplot2 (&ge; 3.2.0), rstan (&ge; 2.21.0), assertthat, stringr,
shiny, utf8</td>
</tr>
<tr>
<td>Suggests:</td>
<td>rmarkdown, knitr, covr, testthat (&ge; 2.99), ragg, vdiffr,
rstantools</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>StanHeaders (&ge; 2.21.0), rstan (&ge; 2.21.0), BH (&ge;
1.72.0-1), Rcpp (&ge; 1.0.3), RcppEigen (&ge; 0.3.3.7.0),
RcppParallel (&ge; 5.0.1)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Biarch:</td>
<td>FALSE</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>GNU make</td>
</tr>
<tr>
<td>Config/testthat/parallel:</td>
<td>true</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-05-02 07:15:28 UTC; Dieter</td>
</tr>
<tr>
<td>Author:</td>
<td>Dieter Menne [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Dieter Menne &lt;dieter.menne@menne-biomed.de&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-05-02 08:20:04 UTC</td>
</tr>
</table>
<hr>
<h2 id='coef.nlme_gastempt'>Extract coefficients from nlme_gastempt result</h2><span id='topic+coef.nlme_gastempt'></span>

<h3>Description</h3>

<p>Extract coefficients from nlme_gastempt result
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'nlme_gastempt'
coef(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coef.nlme_gastempt_+3A_object">object</code></td>
<td>
<p>Result of a call to nlme_gastempt</p>
</td></tr>
<tr><td><code id="coef.nlme_gastempt_+3A_...">...</code></td>
<td>
<p>other arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data frame with coefficients. See <code><a href="#topic+nlme_gastempt">nlme_gastempt</a></code> for an example.
</p>

<hr>
<h2 id='coef.stan_gastempt'>Extract coefficients from stan_gastempt result</h2><span id='topic+coef.stan_gastempt'></span>

<h3>Description</h3>

<p>Extract coefficients from stan_gastempt result
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'stan_gastempt'
coef(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coef.stan_gastempt_+3A_object">object</code></td>
<td>
<p>Result of a call to stan_gastempt</p>
</td></tr>
<tr><td><code id="coef.stan_gastempt_+3A_...">...</code></td>
<td>
<p>other arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data frame with coefficients. See <code><a href="#topic+nlme_gastempt">nlme_gastempt</a></code> for an example.
</p>

<hr>
<h2 id='gastemptfunc'>Functions for gastric emptying analysis</h2><span id='topic+gastemptfunc'></span><span id='topic+linexp'></span><span id='topic+linexp_slope'></span><span id='topic+linexp_auc'></span><span id='topic+powexp'></span><span id='topic+powexp_slope'></span><span id='topic+linexp_log'></span><span id='topic+powexp_log'></span>

<h3>Description</h3>

<p>The <code>linexp</code> and the power exponential (<code>powexp</code>) functions can
be used to fit gastric emptying curves.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>linexp(t, v0 = 1, tempt = NULL, kappa = NULL, pars = NULL)

linexp_slope(t, v0 = 1, tempt = NULL, kappa = NULL, pars = NULL)

linexp_auc(v0 = 1, tempt = NULL, kappa = NULL, pars = NULL)

powexp(t, v0 = 1, tempt = NULL, beta = NULL, pars = NULL)

powexp_slope(t, v0 = 1, tempt = NULL, beta = NULL, pars = NULL)

linexp_log(t, v0 = 1, logtempt = NULL, logkappa = NULL, pars = NULL)

powexp_log(t, v0 = 1, logtempt = NULL, logbeta = NULL, pars = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gastemptfunc_+3A_t">t</code></td>
<td>
<p>Time after meal or start of scan, in minutes; can be a vector.</p>
</td></tr>
<tr><td><code id="gastemptfunc_+3A_v0">v0</code></td>
<td>
<p>Initial volume at t=0.</p>
</td></tr>
<tr><td><code id="gastemptfunc_+3A_tempt">tempt</code></td>
<td>
<p>Emptying time constant in minutes (scalar).</p>
</td></tr>
<tr><td><code id="gastemptfunc_+3A_kappa">kappa</code></td>
<td>
<p>Overshoot term for linexp function (scalar).</p>
</td></tr>
<tr><td><code id="gastemptfunc_+3A_pars">pars</code></td>
<td>
<p>Default NULL. If not NULL, the other parameters with exception
of <code>t</code> are not used and are retrieved as named parameters
from the numeric vector pars instead.</p>
</td></tr>
<tr><td><code id="gastemptfunc_+3A_beta">beta</code></td>
<td>
<p>Power term for power exponential function (scalar).</p>
</td></tr>
<tr><td><code id="gastemptfunc_+3A_logtempt">logtempt</code></td>
<td>
<p>Logarithm of emptying time constant in minutes (scalar).</p>
</td></tr>
<tr><td><code id="gastemptfunc_+3A_logkappa">logkappa</code></td>
<td>
<p>Logarithm of overshoot term for linexp function (scalar).</p>
</td></tr>
<tr><td><code id="gastemptfunc_+3A_logbeta">logbeta</code></td>
<td>
<p>Logarithm of power term for power exponential function (scalar).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>linexp</code> function can have an initial overshoot
to model secretion.
</p>
<p><code>vol(t) = v0 * (1 + kappa * t / tempt) * exp(-t / tempt)</code>
</p>
<p>The <code>powexp</code> function introduced by  Elashof et al. is
montonously decreasing but has more freedom to model details in the
function tail.
</p>
<p><code>vol(t) = v0 * exp(-(t / tempt) ^ beta)</code>
</p>
<p>The <code>_slope</code> functions return the first derivatives of <code>linexp</code>
and <code>powexp</code>.
Use the <code>_log</code> functions to enforce positive parameters
<code>tempt</code> and <code>beta</code>. Rarely required for gastric emptying curves.
</p>


<h3>Value</h3>

<p>Vector of <code>length(t)</code> for computed volume.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>t = seq(0,100, by=5)
kappa = 1.3
tempt = 60
v0 = 400
beta = 3
pars = c(v0 = v0, tempt = tempt, kappa = kappa)
oldpar = par(mfrow = c(1,3))
plot(t, linexp(t, v0, tempt, kappa), type = "l", ylab = "volume",
   main = "linexp\nkappa = 1.3 and 1.0")
lines(t, linexp(t, v0, tempt, 1), type = "l", col = "green")
# This should give the same plot as above
plot(t, linexp(t, pars = pars), type = "l", ylab = "volume",
   main = "linexp\nkappa = 1.3 and 1.0\nwith vectored parameters")
lines(t, linexp(t, v0, tempt, 1), type = "l", col = "green")
plot(t, powexp(t, v0, tempt, beta), type = "l", ylab = "volume",
  main = "powexp\nbeta = 2 and 1")
lines(t, powexp(t, v0, tempt, 1), type = "l", col = "green")
par(oldpar)
</code></pre>

<hr>
<h2 id='nlme_gastempt'>Simplified population fit of gastric emptying data</h2><span id='topic+nlme_gastempt'></span>

<h3>Description</h3>

<p>Compute coefficients v0, tempt and kappa of a mixed model fit to a linexp
function with one grouping variable
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nlme_gastempt(d, pnlsTol = 0.001, model = linexp, variant = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nlme_gastempt_+3A_d">d</code></td>
<td>
<p>A data frame with columns
</p>

<ul>
<li> <p><code>record</code> Record descriptor as grouping variable, e.g. patient ID
</p>
</li>
<li> <p><code>minute</code> Time after meal or start of recording.
</p>
</li>
<li> <p><code>vol</code> Volume of meal or stomach
</p>
</li></ul>
</td></tr>
<tr><td><code id="nlme_gastempt_+3A_pnlstol">pnlsTol</code></td>
<td>
<p>The value of pnlsTol at the initial iteration.
See <code><a href="nlme.html#topic+nlmeControl">nlmeControl</a></code>  When the model does not converge,
<code>pnlsTol</code> is multiplied by 5 and the iteration repeated until
convergence or <code>pnlsTol &gt;= 0.5</code>.
The effective value of  <code>pnlsTol</code> is returned in a separate list item.
When it is known that a data set converges badly,
it is recommended to set the initial <code>pnlsTol</code> to a higher value,
but below 0.5, for faster convergence.</p>
</td></tr>
<tr><td><code id="nlme_gastempt_+3A_model">model</code></td>
<td>
<p><code>linexp</code> (default) or <code>powexp</code></p>
</td></tr>
<tr><td><code id="nlme_gastempt_+3A_variant">variant</code></td>
<td>
<p>For both models, there are 3 variants
</p>

<ul>
<li> <p><code>variant = 1</code> The most generic version with independent estimates
of all three parameters per record
(<code>random = v0 + tempt + kappa ~ 1 | record</code>). The most likely to fail
for degenerate cases. If this variant converges, use it.
</p>
</li>
<li> <p><code>variant = 2 </code> Diagonal random effects
(<code>random = pdDiag(v0 + tempt + kappa) ~ 1; groups =  ~record </code>).
Better convergence in critical cases. Note:  I never found out why I have
to use the <code>groups</code> parameter instead of the <code>|</code>;
see also p. 380 of Pinheiro/Bates.
</p>
</li>
<li> <p><code>variant = 3</code> Since parameters <code>kappa</code> and
<code>beta</code> respectively are the most difficult to estimate, these are
fixed in this variant (<code>random = v0 + tempt ~ 1</code>).
This variant converges in all reasonable cases, but the estimates
of <code>kappa</code> and <code>beta</code> cannot be use for secondary
between-group analysis. If you are only interested in <code>t50</code>,
you can use this safe version.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of class nlme_gastempt with elements
<code>coef, summary, plot, pnlsTol, message</code>
</p>

<ul>
<li> <p><code>coef</code> is a data frame with columns:
</p>

<ul>
<li> <p><code>record</code> Record descriptor, e.g. patient ID
</p>
</li>
<li> <p><code>v0</code> Initial volume at t=0
</p>
</li>
<li> <p><code>tempt</code> Emptying time constant
</p>
</li>
<li> <p><code>kappa</code> Parameter <code>kappa</code> for
<code>model = linexp</code>
</p>
</li>
<li> <p><code>beta</code> Parameter <code>beta</code> for <code>model = powexp</code>
</p>
</li>
<li> <p><code>t50</code> Half-time of emptying
</p>
</li>
<li> <p><code>slope_t50</code> Slope in t50; typically in units of ml/minute
</p>
</li></ul>

<p>On error, coef is NULL
</p>
</li>
<li> <p><code>nlme_result</code> Result of the nlme fit; can be used for addition
processing, e.g. to plot residuals or via <code>summary</code> to extract AIC.
On error, nlme_result is NULL.
</p>
</li>
<li> <p><code>plot</code> A ggplot graph of data and prediction. Plot of raw data is
returned even when convergence was not achieved.
</p>
</li>
<li> <p><code>pnlsTol</code> Effective value of pnlsTo after convergence or failure.
</p>
</li>
<li> <p><code>message</code> String &quot;Ok&quot; on success, and the error message of
<code>nlme</code> on failure.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>suppressWarnings(RNGversion("3.5.0"))
set.seed(4711)
d = simulate_gastempt(n_record = 10, kappa_mean = 0.9, kappa_std = 0.3,
                      model = linexp)$data
fit_d = nlme_gastempt(d)
# fit_d$coef # direct access
coef(fit_d) # better use accessor function
coef(fit_d, signif = 3) # Can also set number of digits
# Avoid ugly ggplot shading (not really needed...)
library(ggplot2)
theme_set(theme_bw() + theme(panel.spacing = grid::unit(0,"lines")))
# fit_d$plot  # direct access is possible
plot(fit_d) # better use accessor function
</code></pre>

<hr>
<h2 id='plot.nlme_gastempt'>Plot data points and fit curve of an nlme_gastempt fit</h2><span id='topic+plot.nlme_gastempt'></span>

<h3>Description</h3>

<p>Plot data points and fit curve of an nlme_gastempt fit
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'nlme_gastempt'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.nlme_gastempt_+3A_x">x</code></td>
<td>
<p>Result of a call to nlme_gastempt</p>
</td></tr>
<tr><td><code id="plot.nlme_gastempt_+3A_...">...</code></td>
<td>
<p>other arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a ggplot object. Use <code>print()</code> if used non-interactively to show the curve
</p>

<hr>
<h2 id='plot.stan_gastempt'>Plot data points and fit curve of an stan_gastempt fit</h2><span id='topic+plot.stan_gastempt'></span>

<h3>Description</h3>

<p>Plot data points and fit curve of an stan_gastempt fit
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'stan_gastempt'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.stan_gastempt_+3A_x">x</code></td>
<td>
<p>Result of a call to stan_gastempt</p>
</td></tr>
<tr><td><code id="plot.stan_gastempt_+3A_...">...</code></td>
<td>
<p>other arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a ggplot object. Use <code>print()</code> if used
non-interactively to show the curve
</p>

<hr>
<h2 id='run_shiny'>Run shiny app demonstrating fit strategies with simulated data</h2><span id='topic+run_shiny'></span>

<h3>Description</h3>

<p>Run shiny app demonstrating fit strategies with simulated data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_shiny()
</code></pre>


<h3>Value</h3>

<p>Not used, starts shiny app
</p>

<hr>
<h2 id='simulate_gastempt'>Simulate gastric emptying data following a linexp or powexp function</h2><span id='topic+simulate_gastempt'></span>

<h3>Description</h3>

<p>Simulate gastric emptying data following a linexp or powexp function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate_gastempt(
  n_records = 10,
  v0_mean = 400,
  v0_std = 50,
  tempt_mean = ifelse(identical(model, linexp), 60, 120),
  tempt_std = tempt_mean/3,
  kappa_mean = 0.7,
  kappa_std = kappa_mean/3,
  beta_mean = 0.7,
  beta_std = beta_mean/3,
  noise = 20,
  student_t_df = NULL,
  missing = 0,
  model = linexp,
  seed = NULL,
  max_minute = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simulate_gastempt_+3A_n_records">n_records</code></td>
<td>
<p>Number of records</p>
</td></tr>
<tr><td><code id="simulate_gastempt_+3A_v0_mean">v0_mean</code>, <code id="simulate_gastempt_+3A_v0_std">v0_std</code></td>
<td>
<p>Mean and between record standard deviation of initial volume, typically in ml.</p>
</td></tr>
<tr><td><code id="simulate_gastempt_+3A_tempt_mean">tempt_mean</code>, <code id="simulate_gastempt_+3A_tempt_std">tempt_std</code></td>
<td>
<p>Mean and between record standard deviation of parameter $t_empt$, typically in minutes.</p>
</td></tr>
<tr><td><code id="simulate_gastempt_+3A_kappa_mean">kappa_mean</code>, <code id="simulate_gastempt_+3A_kappa_std">kappa_std</code></td>
<td>
<p>For linexp only: Mean and between-record
standard deviation of overshoot parameter <code>kappa</code>.
For values of <code>kappa</code> above 1, curve has an overshoot that can
be used to follow volume time series with secretion.</p>
</td></tr>
<tr><td><code id="simulate_gastempt_+3A_beta_mean">beta_mean</code>, <code id="simulate_gastempt_+3A_beta_std">beta_std</code></td>
<td>
<p>For powexp only: Mean and between-record
standard deviation of the so called lag parameter.</p>
</td></tr>
<tr><td><code id="simulate_gastempt_+3A_noise">noise</code></td>
<td>
<p>Standard deviation of normal noise when
<code>student_t_df = NULL</code>; scaling of noise when student_t_df &gt;= 2.</p>
</td></tr>
<tr><td><code id="simulate_gastempt_+3A_student_t_df">student_t_df</code></td>
<td>
<p>When NULL (default), Gaussian noise is added;
when &gt;= 2, Student_t distributed noise is added, which generates more
realistic outliers. Values from 2 to 5 are useful, when higher values
are used the result comes close to that of Gaussian noise. Values
below 2 are rounded to 2.</p>
</td></tr>
<tr><td><code id="simulate_gastempt_+3A_missing">missing</code></td>
<td>
<p>When 0 (default), all curves have the same number of data
points. When &gt; 0, this is the fraction of points that were removed randomly
to simulate missing points. Maximum value is 0.5.</p>
</td></tr>
<tr><td><code id="simulate_gastempt_+3A_model">model</code></td>
<td>
<p>linexp(default) or powexp</p>
</td></tr>
<tr><td><code id="simulate_gastempt_+3A_seed">seed</code></td>
<td>
<p>optional seed; not set if seed = NULL (default)</p>
</td></tr>
<tr><td><code id="simulate_gastempt_+3A_max_minute">max_minute</code></td>
<td>
<p>Maximal time in minutes; if NULL, a sensible
default rounded to hours is used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with 3 elements:
</p>

<dl>
<dt>record</dt><dd><p>Data frame with columns
<code>record(chr), v0, tempt, kappa/beta</code> giving the effective
<code>linexp</code> or <code>powexp</code> parameters for the individual record.
<code>v0</code> is rounded to nearest integer.</p>
</dd>
<dt>data</dt><dd><p>Data frame with columns
<code>record(chr), minute(dbl), vol(dbl)</code> giving the
time series and grouping parameters. <code>vol</code> is rounded
to nearest integer.</p>
</dd>
<dt>stan_data</dt><dd><p>A list for use as <code>data</code> in Stan-based fits
with elements <code>prior_v0, n, n_record, record, minute, volume</code>.</p>
</dd>
</dl>

<p>A comment is attached to the return value that can be used as a title
</p>


<h3>Examples</h3>

<pre><code class='language-R'>suppressWarnings(RNGversion("3.5.0"))
set.seed(4711)
library(ggplot2)
vol_linexp = simulate_gastempt(n_records = 4, noise = 20)
ggplot(vol_linexp$data, aes(x = minute, y = vol)) + geom_point() +
  facet_wrap(~record) + ggtitle("linexp, noise = 0, no missing")

vol_powexp = simulate_gastempt(n_records = 4, missing = 0.2, student_t_df = 2)
ggplot(vol_powexp$data, aes(x = minute, y = vol)) + geom_point() +
  facet_wrap(~record) + ggtitle("powexp, noise = 10 (default), 20% missing,
  Student-t (df = 2) noise")
</code></pre>

<hr>
<h2 id='stan_gastempt'>Fit gastric emptying curves with Stan</h2><span id='topic+stan_gastempt'></span>

<h3>Description</h3>

<p>Fit gastric emptying curves with Stan
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stan_gastempt(
  d,
  model_name = "linexp_gastro_2b",
  lkj = 2,
  student_df = 5L,
  init_r = 0.2,
  chains = 1,
  iter = 2000,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stan_gastempt_+3A_d">d</code></td>
<td>
<p>A data frame with columns
</p>

<ul>
<li> <p><code>rec</code> Record descriptor as grouping variable, e.g. patient ID
</p>
</li>
<li> <p><code>minute</code> Time after meal or start of recording.
</p>
</li>
<li> <p><code>vol</code> Volume of meal or stomach
</p>
</li></ul>
</td></tr>
<tr><td><code id="stan_gastempt_+3A_model_name">model_name</code></td>
<td>
<p>Name of predefined model in
<code>gastempt/exec</code>. Use <code>stan_model_names()</code> to get a list
of available models.</p>
</td></tr>
<tr><td><code id="stan_gastempt_+3A_lkj">lkj</code></td>
<td>
<p>LKJ prior for kappa/tempt correlation, only required
for model linexp_gastro_2b. Values from 1.5 (strong correlation) to 50
(almost independent) are useful.</p>
</td></tr>
<tr><td><code id="stan_gastempt_+3A_student_df">student_df</code></td>
<td>
<p>Student-t degrees of freedom for residual error;
default 5. Use 3 for strong outliers; values above 10 are close to gaussian
residual distribution.</p>
</td></tr>
<tr><td><code id="stan_gastempt_+3A_init_r">init_r</code></td>
<td>
<p>for stan, default = 0.2; Stan's own default is 2, which
often results in stuck chains.</p>
</td></tr>
<tr><td><code id="stan_gastempt_+3A_chains">chains</code></td>
<td>
<p>for stan; default = 1</p>
</td></tr>
<tr><td><code id="stan_gastempt_+3A_iter">iter</code></td>
<td>
<p>A positive integer specifying the number of iterations for
each chain (including warmup). The default is 2000.</p>
</td></tr>
<tr><td><code id="stan_gastempt_+3A_...">...</code></td>
<td>
<p>Additional parameter passed to <code>sampling</code> and <code>stan</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of class stan_gastempt with elements <code>coef, fit, plot</code>
</p>

<ul>
<li> <p><code>coef</code> is a data frame with columns:
</p>

<ul>
<li> <p><code>rec</code> Record descriptor, e.g. patient ID
</p>
</li>
<li> <p><code>v0</code> Initial volume at t=0
</p>
</li>
<li> <p><code>tempt</code> Emptying time constant
</p>
</li>
<li> <p><code>kappa</code> Parameter <code>kappa</code> for
<code>model = linexp</code>
</p>
</li>
<li> <p><code>beta</code> Parameter <code>beta</code> for <code>model = powexp</code>
</p>
</li>
<li> <p><code>t50</code> Half-time of emptying
</p>
</li>
<li> <p><code>slope_t50</code> Slope in t50; typically in units of ml/minute
On error, <code>coef</code> is NULL
</p>
</li></ul>

</li>
<li> <p><code>fit</code> Result of class 'stanfit'
</p>
</li>
<li> <p><code>plot</code> A ggplot graph of data and prediction. Plot of raw data is
returned even when convergence was not achieved.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
 # Runs 30+ seconds on CRAN
 dd = simulate_gastempt(n_records = 6, seed = 471)
 d = dd$data
 ret = stan_gastempt(d)
 print(ret$coef)
 
</code></pre>

<hr>
<h2 id='stan_model_names'>Names and descriptions of precompiled Stan models</h2><span id='topic+stan_model_names'></span>

<h3>Description</h3>

<p>By default, line 2 and 3 of comments starting
with # or // in Stan file are returned
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stan_model_names(n_lines = 2, skip = 1, sep = "\n")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stan_model_names_+3A_n_lines">n_lines</code></td>
<td>
<p>Number of comment lines to retrieve</p>
</td></tr>
<tr><td><code id="stan_model_names_+3A_skip">skip</code></td>
<td>
<p>Number of lines to skip from beginning of Stan Model file</p>
</td></tr>
<tr><td><code id="stan_model_names_+3A_sep">sep</code></td>
<td>
<p>separator for multiline strings</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with <code>model_name</code> and the first <code>n_lines</code>
comment lines in model as description
</p>

<hr>
<h2 id='t50'>Compute half-emptying time from nlme parameters</h2><span id='topic+t50'></span>

<h3>Description</h3>

<p>No closed solution known for <code><a href="#topic+linexp">linexp</a></code>, we use a Newton  approximation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>t50(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="t50_+3A_x">x</code></td>
<td>
<p>Result of a nlme fit, with named components 'tempt, beta, logbeta,
kappa, logkappa' depending on model. Function used 'logbeta' when it is present,
in 'x', otherwise beta, and similar for logkappa/kappa.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Half-emptying time. Name of evaluated function is returned as
attribute <code>fun</code>. Negative of slope is returned as attribute <code>slope</code>.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
