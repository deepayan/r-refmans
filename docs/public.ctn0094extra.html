<!DOCTYPE html><html><head><title>Help for package public.ctn0094extra</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {public.ctn0094extra}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#CreateCTN30ProtocolHistory'><p>Create a Subject History Table by Protocol</p></a></li>
<li><a href='#CreateHistory'><p>Create a Subject History Table</p></a></li>
<li><a href='#CreateProtocolHistory'><p>Create a Subject History Table by Protocol</p></a></li>
<li><a href='#derived_inductDelay'><p>Derived Induction Delay Data</p></a></li>
<li><a href='#derived_raceEthnicity'><p>Derived Patient Race and Ethnicity Data</p></a></li>
<li><a href='#derived_visitImputed'><p>Imputed Patient Visit Data</p></a></li>
<li><a href='#derived_weeklyOpioidPattern'><p>Patient UDS Opioid Weekly Pattern Data</p></a></li>
<li><a href='#derived_weeklyTLFBPattern'><p>Patient TLFB Opioid Weekly Pattern Data</p></a></li>
<li><a href='#loadRawData'><p>Load Data Sets into a List</p></a></li>
<li><a href='#MarkMissing'><p>Code Empty Visit Values as &quot;Missing&quot; as Appropriate</p></a></li>
<li><a href='#MarkUse'><p>Mark Use Day by Subject</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Helper Files for the CTN-0094 Relational Database</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.4</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-11-21</td>
</tr>
<tr>
<td>Description:</td>
<td>Engineered features and "helper" functions ancillary to the
    'public.ctn0094data' package, extending this package for ease of use (see 
    <a href="https://CRAN.R-project.org/package=public.ctn0094data">https://CRAN.R-project.org/package=public.ctn0094data</a>). This
    'public.ctn0094data' package contains harmonized datasets from some of the
    National Institute of Drug Abuse's Clinical Trials Network (NIDA's CTN)
    projects. Specifically, the CTN-0094 project is to harmonize and de-identify
    clinical trials data from the CTN-0027, CTN-0030, and CTN-51 studies for
    opioid use disorder. This current version is built from 'public.ctn0094data'
    v. 1.0.6.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10), public.ctn0094data</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, magrittr, purrr, tibble, tidyr, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, kableExtra, rmarkdown, scales, stringr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://ctn-0094.github.io/public.ctn0094extra/">https://ctn-0094.github.io/public.ctn0094extra/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/CTN-0094/public.ctn0094extra/issues">https://github.com/CTN-0094/public.ctn0094extra/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-11-21 21:21:53 UTC; gabrielodom</td>
</tr>
<tr>
<td>Author:</td>
<td>Gabriel Odom <a href="https://orcid.org/0000-0003-1341-4555"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Raymond Balise <a href="https://orcid.org/0000-0002-9856-5901"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Gabriel Odom &lt;gabriel.j.odom@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-11-22 10:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='CreateCTN30ProtocolHistory'>Create a Subject History Table by Protocol</h2><span id='topic+CreateCTN30ProtocolHistory'></span>

<h3>Description</h3>

<p>Create a Subject History Table by Protocol
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateCTN30ProtocolHistory(
  randCTN30_df,
  start_int = -30,
  phase1Len_int = 98,
  phase2Len_int = 168
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CreateCTN30ProtocolHistory_+3A_randctn30_df">randCTN30_df</code></td>
<td>
<p>A data frame of subject randomization days for CTN-0030.
This data will have columns for <code>who</code>, <code>which</code>, and <code>when</code>.</p>
</td></tr>
<tr><td><code id="CreateCTN30ProtocolHistory_+3A_start_int">start_int</code></td>
<td>
<p>When should the protocol timeline start? Defaults to 30 days
before consent (allowing for self-reported drug use via Timeline Follow-
Back data).</p>
</td></tr>
<tr><td><code id="CreateCTN30ProtocolHistory_+3A_phase1len_int">phase1Len_int</code></td>
<td>
<p>When should Phase I end per protocol? Defaults to 98
days (14 weeks).</p>
</td></tr>
<tr><td><code id="CreateCTN30ProtocolHistory_+3A_phase2len_int">phase2Len_int</code></td>
<td>
<p>When should Phase II end per protocol? Defaults to 168
days (24 weeks).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We may want to perform SQL-like operations on a set of tables. This
data table will form the &quot;backbone&quot; for future join operations. It creates
one record per person in a study for each day in that study, and it is
designed to work with subject-specific two-arm protocols (where Phase I
and Phase II treatments could start on different days for each subject).
For subjects who consented to treatment but were never randomized, we use
an &quot;intent to treat&quot; philosophy and assign them an empty protocol timeline
starting on the day of consent (day 0) until <code>phase1Len_int</code>.
</p>
<p>NOTE: We expect this function to be used specifically to create a
potential visit backbone for CTN-0030. For studies with fixed protocol
lengths, please use <code>CreateSubjectHistory()</code> instead.
</p>


<h3>Value</h3>

<p>A tibble with columns <code>who</code> and <code>when</code>. Each subject will
have one row for each day in the study range.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>   # Subject A started Phase I on day 2 and was switched from treatment
   #   Phase I to Phase II on day 45. Subject B started Phase I on day 6 and
   #   was never switched to Phase II (either because they dropped out of the
   #   study or because the treatment given to them in Phase I worked).
   rand_df &lt;- data.frame(
     who   = c("A", "A", "B", "B"),
     which = c(  1,   2,   1,   2),
     when  = c(  2,  45,   6,  NA)
   )

   # Based on this example data above, we expect to see potential contact
   #   days per the protocol for subject A to range from -30 to 45 + 168.
   #   For subject B, we expect this range to be from -30 to 6 + 98
   CreateCTN30ProtocolHistory(rand_df)

</code></pre>

<hr>
<h2 id='CreateHistory'>Create a Subject History Table</h2><span id='topic+CreateHistory'></span>

<h3>Description</h3>

<p>Create a Subject History Table
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateHistory(
  rawData_ls,
  personsTable = "everybody",
  firstDay_int = NULL,
  lastDay_int = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CreateHistory_+3A_rawdata_ls">rawData_ls</code></td>
<td>
<p>a list of tibbles returned by <code><a href="#topic+loadRawData">loadRawData</a></code></p>
</td></tr>
<tr><td><code id="CreateHistory_+3A_personstable">personsTable</code></td>
<td>
<p>What is the name of the data table that contains all the
subject IDs? Defaults to <code>"everybody"</code>. If no such table exists, then
set this value to <code>"none"</code> and the unique subject IDs will be drawn
from all tables in <code>rawData_ls</code></p>
</td></tr>
<tr><td><code id="CreateHistory_+3A_firstday_int">firstDay_int</code></td>
<td>
<p>(OPTIONAL) What should be the first &quot;day&quot; counter for all
subjects? This may be beneficial to set if you wish to have the History
ignore all days before a certain point.</p>
</td></tr>
<tr><td><code id="CreateHistory_+3A_lastday_int">lastDay_int</code></td>
<td>
<p>(OPTIONAL) What should be the last &quot;day&quot; counter for all
subjects?</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We may want to perform SQL-like operations on a set of tables. This
data table will form the &quot;backbone&quot; for future join operations. It creates
one record per person for each day in the study. The default behavior is
to set the date range to the smallest observed value for &quot;when&quot; across all
data tables to the largest observed value for &quot;when&quot; across all tables,
inclusive. Necessarily, this is <em>very</em> sensitive to outliers or
coding errors (for instance, if one subject has a &quot;first day&quot; 200 days
before Study Day 0, then this History table will include days -200 to -1
for ALL subjects, regardless of any recorded contact in this period).
</p>
<p>If this behavior is not desirable, you must specify a study range. For
example, you may have a short recruitment period followed by a 6-month
clinical trial. In this instance, you may want to ignore any data more
than 30 days prior to Study Day 0 for each subject or more than a few
weeks after the end of the trial. Thus, you would set
<code>firstDay_int = -30L</code> and <code>lastDay_int = 6 * 30 + 14</code>.
</p>


<h3>Value</h3>

<p>A tibble with columns <code>who</code> and <code>when</code>. Each subject will
have one row for each day in the study range.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>   data_ls &lt;- loadRawData(c("tlfb", "all_drugs", "everybody"))
   CreateHistory(rawData_ls = data_ls, firstDay_int = -30)
</code></pre>

<hr>
<h2 id='CreateProtocolHistory'>Create a Subject History Table by Protocol</h2><span id='topic+CreateProtocolHistory'></span>

<h3>Description</h3>

<p>Create a Subject History Table by Protocol
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateProtocolHistory(start_vec, end_vec, persons_df = "everybody")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CreateProtocolHistory_+3A_start_vec">start_vec</code></td>
<td>
<p>a named integer vector with the number of days before
subject consent when the subject history should start, per protocol</p>
</td></tr>
<tr><td><code id="CreateProtocolHistory_+3A_end_vec">end_vec</code></td>
<td>
<p>a named integer vector with the length of the study phase of
interest, per protocol</p>
</td></tr>
<tr><td><code id="CreateProtocolHistory_+3A_persons_df">persons_df</code></td>
<td>
<p>Either the name of the data frame that contains all the
subject IDs and their clinical trials (which defaults to
<code>"everybody"</code>), or a data frame with this information. See &quot;Details&quot;
for more information.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We may want to perform SQL-like operations on a set of tables. This
data table will form the &quot;backbone&quot; for future join operations. It creates
one record per person in each study for each day in those studies (when
<code>persons_df</code> is set to <code>"everybody"</code>), or it creates one record
per person contained in the table <code>persons_df</code> for each day in those
studies. The default behavior is to use the supplied <code>"everybody"</code>
table for all consenting subjects in the CTN-0027, CTN-0030, and CTN-0051
clinical trials. However, users may only care about a smaller subset of
these patients, so a subset of the <code>"everybody"</code> data frame can be
supplied to the <code>persons_df</code> argument if desired.
</p>
<p>NOTE: this function is only appropriate for trial with fixed start and
end days (such as CTN-0027 or CTN-0051). For studies with variable-length
(i.e., subject-specific) protocol lengths, please use
<code>CreateSubjectProtocolHistory()</code> instead.
</p>


<h3>Value</h3>

<p>A tibble with columns <code>who</code>, <code>project</code>, and <code>when</code>.
Each subject will have one row for each day in the study range.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>   start_int &lt;- c(`27` = -30L, `51` = -30L)
   end_int   &lt;- c(`27` = 168L, `51` = 168L)
   
   CreateProtocolHistory(
     start_vec = start_int, end_vec = end_int
   )
   
</code></pre>

<hr>
<h2 id='derived_inductDelay'>Derived Induction Delay Data</h2><span id='topic+derived_inductDelay'></span>

<h3>Description</h3>

<p>This data set measures the number of days from a participant's
randomization until they received their first dose of study drug.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(derived_inductDelay)
</code></pre>


<h3>Format</h3>

<p>A tibble with 2,492 rows and 3 variables:
</p>

<dl>
<dt>who</dt><dd><p>Patient ID</p>
</dd>
<dt>treatment</dt><dd><p>What treatment is prescribed: &quot;Inpatient BUP&quot;,
&quot;Inpatient NR-NTX&quot;, &quot;Methadone&quot;, &quot;Outpatient BUP&quot;, &quot;Outpatient BUP + EMM&quot;,
&quot;Outpatient BUP + SMM&quot;</p>
</dd>
<dt>inductDelay</dt><dd><p>How many days after being assigned to a treatment arm
did the participant receive their first dose of study drug? Missing
values indicate that the subject never received their first dose.</p>
</dd>
</dl>



<h3>Details</h3>

<p>This data set is a derived data set. The inputs are the treatment
and randomization data sets. The code to calculate the induction delay is
given in <code>scripts/create_inductDelay_20210729.R</code>. The treatment arm is
also included in this data set because the induction delay depends on the
type of treatment. For example, inpatient treatment arms may have
different protocols than outpatient treatment arms for determining how
many days the subject must wait after randomization before treatment.
</p>

<hr>
<h2 id='derived_raceEthnicity'>Derived Patient Race and Ethnicity Data</h2><span id='topic+derived_raceEthnicity'></span>

<h3>Description</h3>

<p>Summarize the patients' self-reported race and ethnicity into
four groups: &quot;Non-Hispanic White&quot;, &quot;Non-Hispanic Black&quot;, &quot;Hispanic&quot;, and
&quot;Other&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(derived_raceEthnicity)
</code></pre>


<h3>Format</h3>

<p>A tibble with 3,560
rows and columns:
</p>

<dl>
<dt>who</dt><dd><p>Patient ID</p>
</dd>
<dt>race</dt><dd><p>Self-reported race. Options are &quot;White&quot;, &quot;Black&quot;, &quot;Other&quot;,
and &quot;Refused/missing&quot;.</p>
</dd>
<dt>is_hispanic</dt><dd><p>Self-reported Hispanic/Latino ethnicity.</p>
</dd>
<dt>race_ethnicity</dt><dd><p>Derived composite marker of race and ethnicity.</p>
</dd>
</dl>



<h3>Details</h3>

<p>This data set contains a summary of self-reported race and ethnicity
in four levels. Of note, the &quot;Other&quot; category includes 2 participants who
marked &quot;no&quot; to the question of Hispanic/Latino ethnicity but refused to
answer their race. Also, the &quot;Other&quot; category includes 33 participants for
whom all information about race and ethnicity is missing. This data set is
a derived data set; the script used to create it is
<code>"scripts/create_raceEthnicity_20220816.R"</code>.
</p>

<hr>
<h2 id='derived_visitImputed'>Imputed Patient Visit Data</h2><span id='topic+derived_visitImputed'></span>

<h3>Description</h3>

<p>Given a series of weekly clinic visits described per protocol,
this data marks subjects as present or missing.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(derived_visitImputed)
</code></pre>


<h3>Format</h3>

<p>A tibble with 87,891 rows and
columns:
</p>

<dl>
<dt>who</dt><dd><p>Patient ID</p>
</dd>
<dt>when</dt><dd><p>Study day</p>
</dd>
<dt>visitImputed</dt><dd>
<p>Marked as <code>"Present"</code> if the subject visited the clinic on that day,
or <code>"Missing"</code> if the subject did not visit the clinic on a day we
would have expected them to (based on regular weekly visits).
</p>
</dd>
</dl>



<h3>Details</h3>

<p>This contains planned visits. Not all appointments were kept. We
indicate if an appointment was kept on a certain day by marking the
subject as <code>"Present"</code> on that day. If the subject goes more than 7 days
without a clinic visit, we mark the subject as <code>"Missing"</code> on days that
are multiples of 7 from the randomization day. For subjects without a
randomization day, weekly visits after day of consent are marked as
<code>"Missing"</code> instead. This data set is a derived data set; the script used
to create it is <code>"scripts/create_visitImputed_20210909.R"</code>.
</p>
<p>NOTE: because our window is a strict weekly window, a subject who shows
up for their clinic visit one or more days late will still be marked as
missing on the day they were supposed to appear. This means that some
subjects will be marked as having missed their weekly clinic visit on one
day, but be present in the clinic the next.
</p>

<hr>
<h2 id='derived_weeklyOpioidPattern'>Patient UDS Opioid Weekly Pattern Data</h2><span id='topic+derived_weeklyOpioidPattern'></span>

<h3>Description</h3>

<p>Show the pattern of positive, negative, and missing urine drug
screen (UDS) results for opioids by patient over the study protocol. Study
&quot;Week 1&quot; starts the day after randomization (for patients who were
randomized) or the day after signed consent (for patients who were not
randomized).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(derived_weeklyOpioidPattern)
</code></pre>


<h3>Format</h3>

<p>A tibble with 3,560
rows and columns:
</p>

<dl>
<dt>who</dt><dd><p>Patient ID</p>
</dd>
<dt>startWeek</dt><dd><p>The start of the &quot;word&quot; is how many weeks before
randomization? This should be -4 for most people, but can be as high
as -8. Note that week 0 is included, so a value of -4 represents data
in the 5th week before randomization; that is, 29-35 days prior to
randomization. Most subjects have timeline follow-back data 30 days
before consent, and delays between consent and randomization are
common.</p>
</dd>
<dt>randWeek1</dt><dd><p>Week of first randomization (1, if randomized; NA if
not)</p>
</dd>
<dt>randWeek2</dt><dd><p>Week of second randomization (only for CTN-0030)</p>
</dd>
<dt>endWeek</dt><dd><p>The end of the &quot;word&quot; is how many weeks after
randomization? This depends on the study protocol, but should be
close to 16 or 24 weeks for most subjects.</p>
</dd>
<dt>Baseline</dt><dd><p>A character string of symbols from <code>startWeek</code> to
the last week before <code>randWeek1</code>. Symbols are as defined in
<code>Phase_1</code>.
</p>
</dd>
<dt>Phase_1</dt><dd><p>A character string of symbols from <code>randWeek1</code>
to <code>endWeek</code> (for subjects from CTN-0027 and CTN-0051) or the
last week before <code>randWeek2</code> (for CTN-0030). These symbols are:
<code>"+"</code> = the subject's UDS showed presence of an opioid in that
week; <code>"-"</code> = the subject's UDS showed absence of an opioid in
that week; <code>"*"</code> = two or more UDS in the same week, where &gt;= 1
UDS was positive and &gt;= 1 UDS was negative; <code>"o"</code> if the
subject was supposed to visit a clinic per the study protocol but did
not visit or did not complete a UDS screen; and <code>"_"</code> to
represent weeks wherein the subject was not scheduled to provide UDS.
</p>
</dd>
<dt>Phase_2</dt><dd><p>A character string of symbols from <code>randWeek2</code>
to <code>endWeek</code> for subjects from CTN-0030 only. Symbols are as
defined in <code>Phase_1</code>.
</p>
</dd>
</dl>



<h3>Details</h3>

<p>This data set contains a &quot;word&quot; describing weekly non-study opioid
use patterns as measured by UDS. Based on the substances screened in this
data set, our list of substances classified as an opioid is: Oxymorphone,
Opium, Fentanyl, Hydromorphone, Codeine, Suboxone, Tramadol, Morphine,
Buprenorphine, Hydrocodone, Opioid, Methadone, Oxycodone, and Heroin. UDS
results indicating the presence of one or more of these substances will be
marked with <code>"+"</code> for that week. UDS results negative for these
substances will be marked with <code>"-"</code>. If, by study protocol, the
subject was supposed to visit a clinic to complete a UDS but they did not,
then the visit for that week will be marked with <code>"o"</code>. If, by study
protocol, the subject was NOT supposed to visit a clinic to complete a UDS
for a given week, then visit for that week will be marked with <code>"_"</code>.
This data set is a derived data set; the script used to create it is
<code>"scripts/create_weeklyOpioidPattern_20211123.R"</code>.
</p>
<p>NOTE: because our window is a strict weekly window, a subject could have
both positive and negative UDS within the same 7-day period. In this case,
the week is marked as <code>"*"</code>. Depending on the definition of treatment
failure or treatment success desired, these dual-status indicators can be
re-coded to <code>"+"</code> or <code>"-"</code> as appropriate. Also, some studies
include a baseline UDS in the week of consent (before the subject was
randomized to a treatment arm). Some subjects were randomized in the same
week as the week wherein consent was signed, while other subjects were
randomized weeks later. We represent the weeks before consent and the
variable number of weeks between consent and randomization with <code>"_"</code>
if there were no baseline UDS visits in those weeks (this represents the
pre-study period). For subjects who were never randomized, the weeks
before consent are also marked as pre-study (<code>"_"</code>), and all
subsequent protocol weeks are marked as missing.
</p>

<hr>
<h2 id='derived_weeklyTLFBPattern'>Patient TLFB Opioid Weekly Pattern Data</h2><span id='topic+derived_weeklyTLFBPattern'></span>

<h3>Description</h3>

<p>Show the pattern of positive and negative patient self-report
(timeline follow-back, TLFB) results for opioids by patient over the study
protocol. Study &quot;Week 1&quot; starts the day after randomization (for patients
who were randomized) or the day after signed consent (for patients who
were not randomized).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(derived_weeklyTLFBPattern)
</code></pre>


<h3>Format</h3>

<p>A tibble with 3,560
rows and columns:
</p>

<dl>
<dt>who</dt><dd><p>Patient ID</p>
</dd>
<dt>startWeek</dt><dd><p>The start of the &quot;word&quot; is how many weeks before
randomization? This should be -4 for most people, but can be as high
as -8. Note that week 0 is included, so a value of -4 represents data
in the 5th week before randomization; that is, 29-35 days prior to
randomization. Most subjects have timeline follow-back data 30 days
before consent, and delays between consent and randomization are
common.</p>
</dd>
<dt>randWeek1</dt><dd><p>Week of first randomization (1, if randomized; NA if
not)</p>
</dd>
<dt>randWeek2</dt><dd><p>Week of second randomization (only for CTN-0030)</p>
</dd>
<dt>endWeek</dt><dd><p>The end of the &quot;word&quot; is how many weeks after
randomization? This depends on the study protocol, but should be
close to 16 or 24 weeks for most subjects.</p>
</dd>
<dt>Baseline</dt><dd><p>A character string of symbols from <code>startWeek</code> to
the last week before <code>randWeek1</code>. Symbols are as defined in
<code>Phase_1</code>.
</p>
</dd>
<dt>Phase_1</dt><dd><p>A character string of symbols from <code>randWeek1</code>
to <code>endWeek</code> (for subjects from CTN-0027 and CTN-0051) or the
last week before <code>randWeek2</code> (for CTN-0030). These symbols are:
<code>"+"</code> = the subject reported the use of an opioid for two or more
days in that week; <code>"-"</code> = the subject did not report use of an
opioid in that week; <code>"*"</code> = the subject reported one day of
opioid use in that week; <code>"o"</code> if the subject was supposed to
report TLFB but did not; and <code>"_"</code> to represent weeks wherein the
subject was not scheduled to provide TLFB (for example, more than 30
days before randomization).
</p>
</dd>
<dt>Phase_2</dt><dd><p>A character string of symbols from <code>randWeek2</code>
to <code>endWeek</code> for subjects from CTN-0030 only. Symbols are as
defined in <code>Phase_1</code>.
</p>
</dd>
</dl>



<h3>Details</h3>

<p>This data set contains a &quot;word&quot; describing weekly non-study opioid
use patterns as reported by the subject in TLFB. Based on the substances
reported by the subjects, our list of substances classified as an opioid
is: non-study Buprenorphine, non-study Methadone, heroin, and &quot;opioids&quot;
(which includes Oxymorphone, Opium, Fentanyl, Hydromorphone, Codeine,
Suboxone, Tramadol, Morphine, Hydrocodone, and Oxycodone). TLFB reporting
indicating the presence of two or more use days of these substances will
be marked with <code>"+"</code> for that week. TLFB results positive for these
substances for 0 days will be marked with <code>"-"</code>. TLFB results
positive for these substances for 1 day in the week will be marked with
<code>"*"</code> for that week. This data set is a derived data set; the script
used to create it is
<code>"scripts/create_weeklyTLFBPattern_20220511.R"</code>.
</p>
<p>NOTE: some studies collected more TLFB data than others. Also, all times
are marked starting with the week of randomization. We represent the weeks
before randomization with <code>"_"</code> if no TLFB data was collected. For
subjects who were never randomized, all subsequent protocol weeks are
marked as missing (<code>"o"</code>).
</p>

<hr>
<h2 id='loadRawData'>Load Data Sets into a List</h2><span id='topic+loadRawData'></span>

<h3>Description</h3>

<p>Load Data Sets into a List
</p>


<h3>Usage</h3>

<pre><code class='language-R'>loadRawData(dataNames_char)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="loadRawData_+3A_datanames_char">dataNames_char</code></td>
<td>
<p>Names of data sets to load</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We may want to perform SQL-like operations on a set of tables
without loading each table into R's Global Environment separately. This
function loads these data sets into a self-destructing environment and
then returns a named list of these data sets.
</p>


<h3>Value</h3>

<p>Loads data sets specified into the current function environment for
further evaluation (unused) and then returns these data sets as a named
list
</p>


<h3>Examples</h3>

<pre><code class='language-R'>   loadRawData(c("tlfb", "all_drugs"))
</code></pre>

<hr>
<h2 id='MarkMissing'>Code Empty Visit Values as &quot;Missing&quot; as Appropriate</h2><span id='topic+MarkMissing'></span>

<h3>Description</h3>

<p>Given a complete timeline of potential subject visits per study
protocol, mark certain visits as &quot;Missing&quot;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MarkMissing(timeline_df, windowWidth = 7, daysGrace = 0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="MarkMissing_+3A_timeline_df">timeline_df</code></td>
<td>
<p>A data frame with columns <code>who</code>, <code>when</code>,
<code>visit</code> and <code>randomized</code>. This data frame measures on which days
the subjects visited the clinic (<code>visit</code>) and indicates when the
subjects were randomized to Phase I of their respective studies (the
<code>randomized</code> column). This data set will contain one (and only one)
record per subject per day; and enough rows to cover all potential visits
per the protocol length of the study.</p>
</td></tr>
<tr><td><code id="MarkMissing_+3A_windowwidth">windowWidth</code></td>
<td>
<p>How many days are expected between clinic visits? Defaults
to 7, representing weekly clinic visits.</p>
</td></tr>
<tr><td><code id="MarkMissing_+3A_daysgrace">daysGrace</code></td>
<td>
<p>How many days late are subjects allowed to be for their
weekly visit. Defaults to 0. Under this default behavior with weekly
visits, a subject who visits the clinic on days 8 and 14 instead of days
7 and 14 will have a missing visit imputed for day 7.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Most definitions of opioid use disorder treatment success or failure
partially depend on a tally of the number of missed clinic visits. For
example, a definition of early treatment failure could be &quot;3 or more UDS
positive for non-study opioids or missing visits within the first 28 days
of randomization&quot;. Given a table of subject visits by day over the entire
protocol timeline, this function will estimate when each subject missed a
clinic visit (unfortunately, missed visits can often be improperly
recorded in the patient logs; if such information is complete, using this
function is unnecessary).
</p>
<p>This estimation is conducted as follows: (1) first, for each subject, a
regular grid of days is spread from the randomization day to the end of
treatment by <code>windowWidth</code>; (2) next, we iterate over each day in
this regular grid, and at each step we check the next <code>windowWidth</code>
plus <code>daysGrace</code> days for a visit in that range, and we mark the day
at the end of the window as &quot;missing&quot; if there are no visits in that
range; (3) and finally, we combine these subject-specific data tables.
</p>


<h3>Value</h3>

<p>A copy of <code>timeline_df</code> with the column <code>visitYM</code> added.
This column is a copy of the <code>visit</code> column with additional cells
marking if a subject should have attended the clinic but did not.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>   # TO DO
</code></pre>

<hr>
<h2 id='MarkUse'>Mark Use Day by Subject</h2><span id='topic+MarkUse'></span>

<h3>Description</h3>

<p>Mark Use Day by Subject
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MarkUse(
  targetDrugs_char,
  drugs_df = NULL,
  reportSource = c("TFB", "UDSAB", "UDS"),
  retainEmptyRows = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="MarkUse_+3A_targetdrugs_char">targetDrugs_char</code></td>
<td>
<p>A character vector including which drugs should be
counted against the subject</p>
</td></tr>
<tr><td><code id="MarkUse_+3A_drugs_df">drugs_df</code></td>
<td>
<p>A data frame with columns <code>who</code>, <code>when</code>, and
<code>what</code>. This data frame measures which drugs were used by each
subject over all days of treatment. This data set must also include a
column <code>source</code>, which marks from which reporting source the drug use
was recorded</p>
</td></tr>
<tr><td><code id="MarkUse_+3A_reportsource">reportSource</code></td>
<td>
<p>A character vector matching the source of the reported
drug use. The options must be from Timeline Followback (<code>"TFB"</code>)
questionnaires or daily urine drug screens (<code>"UDS"</code> or<code>"UDSAB"</code>).</p>
</td></tr>
<tr><td><code id="MarkUse_+3A_retainemptyrows">retainEmptyRows</code></td>
<td>
<p>A logical flag to force rows for participants who did
not have UDS positive for the substances listed in <code>targetDrugs_char</code>
to be retained in the final results (with <code>NA</code> for <code>"when"</code> and
<code>"source"</code>). Defaults to <code>FALSE</code> because the entire point of
this function is to mark substance <em>USE</em>, not a lack thereof;
however, this flag is needed for the vignette (because we forced the
inclusion of a participant with no recorded UDS for pedagogical purposes).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is basically just a fancy wrapper around some dplyr
code. We just don't want the user to have to 1) know dplyr, or 2) write
the code themselves.
</p>


<h3>Value</h3>

<p>A modification of the <code>drugs_df</code> data set: the columns are
<code>"who"</code>, <code>"when"</code>, and <code>"source"</code>; each row corresponds
to one use day per subject per use source (if, for instance, there is drug
use for a particular day recorded in both TFB and UDS, then that day will
have two rows in the resulting data set).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>   MarkUse(c("Crack", "Pcp", "Opioid"))
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
