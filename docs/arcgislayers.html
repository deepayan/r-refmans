<!DOCTYPE html><html><head><title>Help for package arcgislayers</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {arcgislayers}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#add_features'><p>Add Features to Feature Layer</p></a></li>
<li><a href='#add_item'><p>Publish Content</p></a></li>
<li><a href='#arc_open'><p>Open connection to remote resource</p></a></li>
<li><a href='#arc_raster'><p>Read from an Image Server</p></a></li>
<li><a href='#arc_read'><p>Read an ArcGIS FeatureLayer, Table, or ImageServer</p></a></li>
<li><a href='#arc_select'><p>Query a Feature Service</p></a></li>
<li><a href='#clear_query'><p>Utility functions</p></a></li>
<li><a href='#create_feature_server'><p>Create a FeatureServer</p></a></li>
<li><a href='#get_layer'><p>Extract a layer from a Feature or Map Server</p></a></li>
<li><a href='#get_layer_estimates'><p>Get Estimates</p></a></li>
<li><a href='#prepare_spatial_filter'><p>Prepare JSON for use as a spatial filter based on feature geometry or</p>
bounding box input</a></li>
<li><a href='#query_layer_attachments'><p>Query and download attachments</p></a></li>
<li><a href='#truncate_layer'><p>Truncate a Feature Layer</p></a></li>
<li><a href='#update_params'><p>Modify query parameters</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>An Interface to ArcGIS Data Services</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Enables users of 'ArcGIS Enterprise', 'ArcGIS Online', or
    'ArcGIS Platform' to read, write, publish, or manage vector and raster
    data via ArcGIS location services REST API endpoints
    <a href="https://developers.arcgis.com/rest/">https://developers.arcgis.com/rest/</a>.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License (&ge; 2)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Imports:</td>
<td>arcgisutils (&ge; 0.2.0), arcpbf (&ge; 0.1.2), cli, httr2 (&ge;
1.0.0), jsonify, lifecycle, RcppSimdJson, rlang, sf, terra,
utils</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>dbplyr, dplyr, rmarkdown, testthat (&ge; 3.0.0), tidyselect,
vctrs</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://r.esri.com/arcgislayers/">https://r.esri.com/arcgislayers/</a>,
<a href="https://github.com/R-ArcGIS/arcgislayers">https://github.com/R-ArcGIS/arcgislayers</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/R-ArcGIS/arcgislayers/issues">https://github.com/R-ArcGIS/arcgislayers/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-07-05 14:28:14 UTC; josiahparry</td>
</tr>
<tr>
<td>Author:</td>
<td>Josiah Parry <a href="https://orcid.org/0000-0001-9910-865X"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Eli Pousson <a href="https://orcid.org/0000-0001-8280-1706"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [ctb],
  Kenneth Vernon <a href="https://orcid.org/0000-0003-0098-5092"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Martha Bass <a href="https://orcid.org/0009-0004-0268-5426"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Josiah Parry &lt;josiah.parry@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-07-05 15:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='add_features'>Add Features to Feature Layer</h2><span id='topic+add_features'></span><span id='topic+update_features'></span><span id='topic+delete_features'></span>

<h3>Description</h3>

<p>Delete features from a feature layer based on object ID, a where clause, or a
spatial filter.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_features(
  x,
  .data,
  chunk_size = 2000,
  match_on = c("name", "alias"),
  rollback_on_failure = TRUE,
  token = arc_token()
)

update_features(
  x,
  .data,
  match_on = c("name", "alias"),
  token = arc_token(),
  rollback_on_failure = TRUE,
  ...
)

delete_features(
  x,
  object_ids = NULL,
  where = NULL,
  filter_geom = NULL,
  predicate = "intersects",
  rollback_on_failure = TRUE,
  token = arc_token(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="add_features_+3A_x">x</code></td>
<td>
<p>an object of class <code>FeatureLayer</code></p>
</td></tr>
<tr><td><code id="add_features_+3A_.data">.data</code></td>
<td>
<p>an object of class <code>sf</code> or <code>data.frame</code></p>
</td></tr>
<tr><td><code id="add_features_+3A_chunk_size">chunk_size</code></td>
<td>
<p>the maximum number of features to add at a time</p>
</td></tr>
<tr><td><code id="add_features_+3A_match_on">match_on</code></td>
<td>
<p>whether to match on the alias or the field name. Default,
the alias. See Details for more.</p>
</td></tr>
<tr><td><code id="add_features_+3A_rollback_on_failure">rollback_on_failure</code></td>
<td>
<p>default <code>TRUE</code>. Specifies whether the edits should be
applied only if all submitted edits succeed.</p>
</td></tr>
<tr><td><code id="add_features_+3A_token">token</code></td>
<td>
<p>default <code>arc_token()</code>. An <code>httr2_token</code>.</p>
</td></tr>
<tr><td><code id="add_features_+3A_...">...</code></td>
<td>
<p>additional query parameters passed to the API.</p>
</td></tr>
<tr><td><code id="add_features_+3A_object_ids">object_ids</code></td>
<td>
<p>a numeric vector of object IDs to be deleted.</p>
</td></tr>
<tr><td><code id="add_features_+3A_where">where</code></td>
<td>
<p>a simple SQL where statement indicating which features should be
deleted. When the where statement evaluates to <code>TRUE</code>, those values will be
deleted.</p>
</td></tr>
<tr><td><code id="add_features_+3A_filter_geom">filter_geom</code></td>
<td>
<p>an object of class <code>bbox</code>, <code>sfc</code> or <code>sfg</code> used to filter
query results based on a predicate function.</p>
</td></tr>
<tr><td><code id="add_features_+3A_predicate">predicate</code></td>
<td>
<p>Spatial predicate to use with <code>filter_geom</code>. Default
<code>"intersects"</code>. Possible options are <code>"intersects"</code>, <code>"contains"</code>,
<code>"crosses"</code>,  <code>"overlaps"</code>,  <code>"touches"</code>, and <code>"within"</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>
<p>For a more detailed guide to adding, updating, and deleting features, view the
tutorial on the <a href="https://r.esri.com/r-bridge-site/location-services/workflows/add-delete-update.html">R-ArcGIS Bridge website</a>.
</p>
<p>Regarding the <code>match_on</code> argument:when publishing an object to an ArcGIS Portal
from R, the object's names are provided as the alias. The object's names are
subject to change according to the standards of the ArcGIS REST API. For example.
<code>"Sepal.Length"</code> is changed to <code>"Sepal_Width"</code> in the <code>name</code> field but the alias
remains <code>"Sepal.Length"</code>. For that reason, we match on the alias name by default.
Change this argument to match based on the field name.
</p>


<h3>Value</h3>


<ul>
<li> <p><code>add_features()</code> returns a <code>data.frame</code> with columns <code>objectId</code>, <code>uniqueId</code>, <code>globalId</code>, <code>success</code>
</p>
</li>
<li> <p><code>update_features()</code> returns a list with an element named <code>updateResults</code> which is a <code>data.frame</code> with columns <code>objectId</code>, <code>uniqueId</code>, <code>globalId</code>, <code>success</code>
</p>
</li>
<li> <p><code>delete_features()</code> returns a list with an element named <code>deleteResults</code> which is a <code>data.frame</code> with columns <code>objectId</code>, <code>uniqueId</code>, <code>globalId</code>, <code>success</code>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  # this is pseudo-code and will not work
  flayer &lt;- arc_open(furl)

  # add sf objects to existing feature service
  add_features(flayer, sfobj)

  # delete all features
  delete_features(flayer, where = "1 = 1")

  # update features
  update_features(flayer, dfobj)

## End(Not run)
</code></pre>

<hr>
<h2 id='add_item'>Publish Content</h2><span id='topic+add_item'></span><span id='topic+publish_item'></span><span id='topic+publish_layer'></span><span id='topic+.publish_params'></span>

<h3>Description</h3>

<p>Publishes an <code>sf</code> or <code>data.frame</code> object to an ArcGIS Portal as a
FeatureCollection.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_item(
  x,
  title,
  description = "",
  tags = character(0),
  snippet = "",
  categories = character(0),
  async = FALSE,
  type = "Feature Service",
  token = arc_token()
)

publish_item(
  item_id,
  publish_params = .publish_params(),
  file_type = "featureCollection",
  token = arc_token()
)

publish_layer(
  x,
  title,
  ...,
  publish_params = .publish_params(title, target_crs = sf::st_crs(x)),
  token = arc_token()
)

.publish_params(
  name = NULL,
  description = NULL,
  copyright = NULL,
  target_crs = 3857,
  max_record_count = 2000L
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="add_item_+3A_x">x</code></td>
<td>
<p>an object of class <code>data.frame</code>. This can be an <code>sf</code> object or <code>tibble</code> or
any other subclass of <code>data.frame</code>.</p>
</td></tr>
<tr><td><code id="add_item_+3A_title">title</code></td>
<td>
<p>A user-friendly string title for the layer that can be used in
a table of contents.</p>
</td></tr>
<tr><td><code id="add_item_+3A_description">description</code></td>
<td>
<p>a length 1 character vector containing the description of
the item that is being added. Note that the value cannot be larger than 64kb.</p>
</td></tr>
<tr><td><code id="add_item_+3A_tags">tags</code></td>
<td>
<p>a character vector of tags to add to the item.</p>
</td></tr>
<tr><td><code id="add_item_+3A_snippet">snippet</code></td>
<td>
<p>a length 1 character vector with no more than 2048 characters.</p>
</td></tr>
<tr><td><code id="add_item_+3A_categories">categories</code></td>
<td>
<p>a character vector of the categories of the item.</p>
</td></tr>
<tr><td><code id="add_item_+3A_async">async</code></td>
<td>
<p>default <code>FALSE</code>. Cannot be changed at this time.</p>
</td></tr>
<tr><td><code id="add_item_+3A_type">type</code></td>
<td>
<p>default <code>"Feature Service"</code>. Must not be changed at this time.</p>
</td></tr>
<tr><td><code id="add_item_+3A_token">token</code></td>
<td>
<p>an <code>httr2_token</code> as created by <code>auth_code()</code> or similar</p>
</td></tr>
<tr><td><code id="add_item_+3A_item_id">item_id</code></td>
<td>
<p>the ID of the item to be published.</p>
</td></tr>
<tr><td><code id="add_item_+3A_publish_params">publish_params</code></td>
<td>
<p>a list of named values of the <code>publishParameters</code>. Must match
the values in the <a href="https://developers.arcgis.com/rest/users-groups-and-items/publish-item.htm#GUID-9E8F8526-5D58-4706-95F3-432905CC3303">/publish endpoint documentation</a>.</p>
</td></tr>
<tr><td><code id="add_item_+3A_file_type">file_type</code></td>
<td>
<p>default <code>"featureCollection"</code>. Cannot be changed.</p>
</td></tr>
<tr><td><code id="add_item_+3A_...">...</code></td>
<td>
<p>arguments passed into <code>add_item()</code>.</p>
</td></tr>
<tr><td><code id="add_item_+3A_name">name</code></td>
<td>
<p>a scalar character of the name of the layer. Must be unique.</p>
</td></tr>
<tr><td><code id="add_item_+3A_copyright">copyright</code></td>
<td>
<p>an optional character scalar containing copyright text to
add to the published Feature Service.</p>
</td></tr>
<tr><td><code id="add_item_+3A_target_crs">target_crs</code></td>
<td>
<p>the CRS of the Feature Service to be created. By default,
<code>EPSG:3857</code>.</p>
</td></tr>
<tr><td><code id="add_item_+3A_max_record_count">max_record_count</code></td>
<td>
<p>the maximum number of records that can be returned
from the created Feature Service.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>

<ul>
<li> <p><code>add_item()</code> takes a data.frame like object and uploads it as an item in
your portal.
</p>
</li>
<li> <p><code>publish_item()</code> takes an ID of an item in your portal and publishes it
as a feature service.
</p>
</li>
<li> <p><code>publish_layer()</code> is a high-level wrapper that first adds an object as
an item in your portal and subsequently publishes it for you.
</p>
</li>
<li> <p><code>.publish_params()</code> is a utility function to specify optional publish
parameters such as copyright text, and the spatial reference of the
published feature collection.
</p>
</li></ul>

<p>Note that there is <em>only</em> support for feature services meaning that only
tables and feature layers can be made by these functions.
</p>


<h4>Publish Parameters</h4>

<p>When publishing an item to a portal, a number of <a href="https://developers.arcgis.com/rest/users-groups-and-items/publish-item.htm#GUID-9E8F8526-5D58-4706-95F3-432905CC3303">publish parameters</a> can be provided. Most importantly is the <code>targetSR</code> which will be
the CRS of the hosted feature service. By default this is <code>EPSG:3857</code>.
</p>
<p><code>publish_layer()</code> will use the CRS of the input object, <code>x</code>, by default. If
publishing content in two steps with <code>add_item()</code> and <code>publish_item()</code>, use
<code>.publish_params()</code> to craft your publish parameters. Ensure that the CRS
provided to <code>target_crs</code> matches that of the item you added with
<code>add_item()</code>.
</p>



<h3>Value</h3>

<p>A named list containing the url of the newly published service.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  nc &lt;- sf::st_read(system.file("shape/nc.shp", package = "sf"))
  x &lt;- nc[1:5, 13]

  token &lt;- auth_code()
  set_arc_token(token)

  publish_res &lt;- publish_layer(
    x, "North Carolina SIDS sample"
  )

## End(Not run)
</code></pre>

<hr>
<h2 id='arc_open'>Open connection to remote resource</h2><span id='topic+arc_open'></span>

<h3>Description</h3>

<p>Provided a URL, create an object referencing the remote resource.
The resultant object acts as a reference to the remote data source.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>arc_open(url, token = arc_token())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="arc_open_+3A_url">url</code></td>
<td>
<p>The url of the remote resource. Must be of length one.</p>
</td></tr>
<tr><td><code id="arc_open_+3A_token">token</code></td>
<td>
<p>your authorization token.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To extract data from the remote resource utilize <code><a href="#topic+arc_select">arc_select()</a></code> for objects of class
<code>FeatureLayer</code> or <code>Table</code>. For <code>ImageServer</code>s, utilize <code><a href="#topic+arc_raster">arc_raster()</a></code>.
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Value</h3>

<p>Depending on the provided URL returns a <code>FeatureLayer</code>, <code>Table</code>, <code>FeatureServer</code>, <code>ImageServer</code>, or <code>MapServer</code>. Each of these objects is a named list containing the properties of the service.
</p>


<h3>See Also</h3>

<p>arc_select arc_raster
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
 # FeatureLayer
 furl &lt;- paste0(
   "https://services3.arcgis.com/ZvidGQkLaDJxRSJ2/arcgis/rest/services/",
   "PLACES_LocalData_for_BetterHealth/FeatureServer/0"
 )

 arc_open(furl)

 # Table
 furl &lt;- paste0(
   "https://services.arcgis.com/P3ePLMYs2RVChkJx/arcgis/rest/services/",
   "USA_Wetlands/FeatureServer/1"
 )

 arc_open(furl)

 # ImageServer
 arc_open(
   "https://landsat2.arcgis.com/arcgis/rest/services/Landsat/MS/ImageServer"
   )

 # FeatureServer
 furl &lt;- paste0(
   "https://services3.arcgis.com/ZvidGQkLaDJxRSJ2/arcgis/rest/services/",
   "PLACES_LocalData_for_BetterHealth/FeatureServer"
 )

 arc_open(furl)

 # MapServer
 map_url &lt;- paste0(
   "https://services.arcgisonline.com/ArcGIS/rest/services/",
   "World_Imagery/MapServer"
 )

 arc_open(map_url)


## End(Not run)
</code></pre>

<hr>
<h2 id='arc_raster'>Read from an Image Server</h2><span id='topic+arc_raster'></span>

<h3>Description</h3>

<p>Given an <code>ImageServer</code> export an image as a terra <code>SpatRaster</code> object.
See <code><a href="terra.html#topic+rast">terra::rast</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>arc_raster(
  x,
  xmin,
  xmax,
  ymin,
  ymax,
  bbox_crs = NULL,
  crs = sf::st_crs(x),
  width = NULL,
  height = NULL,
  format = "tiff",
  token = arc_token()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="arc_raster_+3A_x">x</code></td>
<td>
<p>an <code>ImageServer</code> as created with <code>arc_open()</code>.</p>
</td></tr>
<tr><td><code id="arc_raster_+3A_xmin">xmin</code></td>
<td>
<p>the minimum bounding longitude value.</p>
</td></tr>
<tr><td><code id="arc_raster_+3A_xmax">xmax</code></td>
<td>
<p>the maximum bounding longitude value.</p>
</td></tr>
<tr><td><code id="arc_raster_+3A_ymin">ymin</code></td>
<td>
<p>that minimum bounding latitude value.</p>
</td></tr>
<tr><td><code id="arc_raster_+3A_ymax">ymax</code></td>
<td>
<p>the maximum bounding latitude value.</p>
</td></tr>
<tr><td><code id="arc_raster_+3A_bbox_crs">bbox_crs</code></td>
<td>
<p>the CRS of the values passed to <code>xmin</code>, <code>xmax</code>, <code>ymin</code>, and <code>ymax</code>.
If not specified, uses the CRS of <code>x</code>.</p>
</td></tr>
<tr><td><code id="arc_raster_+3A_crs">crs</code></td>
<td>
<p>the CRS of the resultant raster image and the provided bounding box defined by <code>xmin</code>, <code>xmax</code>, <code>ymin</code>, <code>ymax</code> (passed <code>outSR</code> query parameter).</p>
</td></tr>
<tr><td><code id="arc_raster_+3A_width">width</code></td>
<td>
<p>default <code>NULL</code>. Cannot exceed <code>x[["maxImageWidth"]]</code>.</p>
</td></tr>
<tr><td><code id="arc_raster_+3A_height">height</code></td>
<td>
<p>default <code>NULL</code>. Cannot exceed <code>x[["maxImageHeight"]]</code>.</p>
</td></tr>
<tr><td><code id="arc_raster_+3A_format">format</code></td>
<td>
<p>default <code>"tiff"</code>. Must be one of &quot;jpgpng&quot;, &quot;png&quot;, &quot;png8&quot;, &quot;png24&quot;, &quot;jpg&quot;, &quot;bmp&quot;, &quot;gif&quot;, &quot;tiff&quot;, &quot;png32&quot;, &quot;bip&quot;, &quot;bsq&quot;, &quot;lerc&quot;.</p>
</td></tr>
<tr><td><code id="arc_raster_+3A_token">token</code></td>
<td>
<p>default <code>arc_token()</code> authorization token.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Value</h3>

<p>An object of class <code>SpatRaster</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
img_url &lt;- "https://landsat2.arcgis.com/arcgis/rest/services/Landsat/MS/ImageServer"

landsat &lt;- arc_open(img_url)

arc_raster(
  landsat,
  xmin = -71,
  ymin = 43,
  xmax = -67,
  ymax = 47.5,
  bbox_crs = 4326,
  width = 100,
  height = 100
)

## End(Not run)

</code></pre>

<hr>
<h2 id='arc_read'>Read an ArcGIS FeatureLayer, Table, or ImageServer</h2><span id='topic+arc_read'></span>

<h3>Description</h3>

<p><code><a href="#topic+arc_read">arc_read()</a></code> combines the functionality of <code><a href="#topic+arc_open">arc_open()</a></code> with <code><a href="#topic+arc_select">arc_select()</a></code>
or <code><a href="#topic+arc_raster">arc_raster()</a></code> to read an ArcGIS <code>FeatureLayer</code>, <code>Table</code>, or <code>ImageServer</code>
to an <code>sf</code> or <code>SpatRaster</code> object. Optionally, set, check, or modify names
for the returned data frame or sf object using the <code>col_names</code> and
<code>name_repair</code> parameters. For ease of use and convenience, <code><a href="#topic+arc_read">arc_read()</a></code>
allows users to access and query a FeatureLayer, Table, or ImageServer with a
single function call instead of combining <code><a href="#topic+arc_open">arc_open()</a></code> and <code><a href="#topic+arc_select">arc_select()</a></code>.
The conventions of <code>col_select</code> are based on functions for reading tabular
data in the <code>{readr}</code> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>arc_read(
  url,
  col_names = TRUE,
  col_select = NULL,
  n_max = Inf,
  name_repair = "unique",
  crs = NULL,
  ...,
  fields = NULL,
  alias = c("drop", "label", "replace"),
  token = arc_token()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="arc_read_+3A_url">url</code></td>
<td>
<p>The url of the remote resource. Must be of length one.</p>
</td></tr>
<tr><td><code id="arc_read_+3A_col_names">col_names</code></td>
<td>
<p>Default <code>TRUE</code>. Column names or name handling rule.
<code>col_names</code> can be <code>TRUE</code>, <code>FALSE</code>, <code>NULL</code>, or a character vector:
</p>

<ul>
<li><p> If <code>TRUE</code>, use existing default column names for the layer or table.
If <code>FALSE</code> or <code>NULL</code>, column names will be generated automatically: X1, X2,
X3 etc.
</p>
</li>
<li><p> If <code>col_names</code> is a character vector, values replace the existing column
names. <code>col_names</code> can't be length 0 or longer than the number of fields in
the returned layer.
</p>
</li></ul>
</td></tr>
<tr><td><code id="arc_read_+3A_col_select">col_select</code></td>
<td>
<p>Default <code>NULL</code>. A character vector of the field names to be
returned. By default, all fields are returned.</p>
</td></tr>
<tr><td><code id="arc_read_+3A_n_max">n_max</code></td>
<td>
<p>Defaults to <code>Inf</code> or an option set with
<code style="white-space: pre;">&#8288;options("arcgislayers.n_max" = &lt;max records&gt;)&#8288;</code>. Maximum number of records
to return.</p>
</td></tr>
<tr><td><code id="arc_read_+3A_name_repair">name_repair</code></td>
<td>
<p>Default <code>"unique"</code>. See <code><a href="vctrs.html#topic+vec_as_names">vctrs::vec_as_names()</a></code> for
details. If <code>name_repair = NULL</code>, names are set directly.</p>
</td></tr>
<tr><td><code id="arc_read_+3A_crs">crs</code></td>
<td>
<p>the spatial reference to be returned. If the CRS is different than
the CRS for the input <code>FeatureLayer</code>, a transformation will occur
server-side. Ignored if x is a <code>Table</code>.</p>
</td></tr>
<tr><td><code id="arc_read_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="#topic+arc_select">arc_select()</a></code> if URL is a
<code>FeatureLayer</code> or <code>Table</code> or <code><a href="#topic+arc_raster">arc_raster()</a></code> if URL is an <code>ImageLayer</code>.</p>
</td></tr>
<tr><td><code id="arc_read_+3A_fields">fields</code></td>
<td>
<p>Default <code>NULL</code>. a character vector of the field names to
returned. By default all fields are returned. Ignored if <code>col_names</code> is
supplied.</p>
</td></tr>
<tr><td><code id="arc_read_+3A_alias">alias</code></td>
<td>
<p>Use of field alias values. Default <code style="white-space: pre;">&#8288;c("drop", "label", "replace"),&#8288;</code>. There are three options:
</p>

<ul>
<li> <p><code>"drop"</code>, field alias values are ignored.
</p>
</li>
<li> <p><code>"label"</code>: field alias values are assigned as a label attribute for each field.
</p>
</li>
<li> <p><code>"replace"</code>: field alias values replace existing column names. <code>col_names</code>
must <code>TRUE</code> for this option to be applied.
</p>
</li></ul>
</td></tr>
<tr><td><code id="arc_read_+3A_token">token</code></td>
<td>
<p>your authorization token.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Value</h3>

<p>An sf object, a <code>data.frame</code>, or an object of class <code>SpatRaster</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+arc_select">arc_select()</a></code>; <code><a href="#topic+arc_raster">arc_raster()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  furl &lt;- "https://sampleserver6.arcgisonline.com/arcgis/rest/services/Census/MapServer/3"

  # read entire service
  arc_read(furl)

  # apply tolower() to column names
  arc_read(url, name_repair = tolower)

  # use paste0 to prevent CRAN check NOTE
  furl &lt;- paste0(
    "https://sampleserver6.arcgisonline.com/arcgis/rest/services/",
    "EmergencyFacilities/FeatureServer/0"
  )

 # use field aliases as column names
 arc_read(furl, col_names = "alias")

 # read an ImageServer directly
 img_url &lt;- "https://landsat2.arcgis.com/arcgis/rest/services/Landsat/MS/ImageServer"

 arc_read(
   img_url,
   width = 100, height = 100,
   xmin = -71, ymin = 43,
   xmax = -67, ymax = 47.5,
   bbox_crs = 4326
 )


## End(Not run)
</code></pre>

<hr>
<h2 id='arc_select'>Query a Feature Service</h2><span id='topic+arc_select'></span>

<h3>Description</h3>

<p><code><a href="#topic+arc_select">arc_select()</a></code> takes a <code>FeatureLayer</code>, <code>Table</code>, of <code>ImageServer</code> object and
returns data from the layer as an <code>sf</code> object or <code>data.frame</code> respectively.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>arc_select(
  x,
  ...,
  fields = NULL,
  where = NULL,
  crs = sf::st_crs(x),
  geometry = TRUE,
  filter_geom = NULL,
  predicate = "intersects",
  n_max = Inf,
  page_size = NULL,
  token = arc_token()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="arc_select_+3A_x">x</code></td>
<td>
<p>an object of class <code>FeatureLayer</code>, <code>Table</code>, or <code>ImageServer</code>.</p>
</td></tr>
<tr><td><code id="arc_select_+3A_...">...</code></td>
<td>
<p>additional query parameters passed to the API.</p>
</td></tr>
<tr><td><code id="arc_select_+3A_fields">fields</code></td>
<td>
<p>a character vector of the field names that you wish to be
returned. By default all fields are returned.</p>
</td></tr>
<tr><td><code id="arc_select_+3A_where">where</code></td>
<td>
<p>a simple SQL where statement indicating which features should be
selected.</p>
</td></tr>
<tr><td><code id="arc_select_+3A_crs">crs</code></td>
<td>
<p>the spatial reference to be returned. If the CRS is different than
the CRS for the input <code>FeatureLayer</code>, a transformation will occur
server-side. Ignored if x is a <code>Table</code>.</p>
</td></tr>
<tr><td><code id="arc_select_+3A_geometry">geometry</code></td>
<td>
<p>default <code>TRUE</code>. If geometries should be returned. Ignored for
<code>Table</code> objects.</p>
</td></tr>
<tr><td><code id="arc_select_+3A_filter_geom">filter_geom</code></td>
<td>
<p>an object of class <code>bbox</code>, <code>sfc</code> or <code>sfg</code> used to filter
query results based on a predicate function.</p>
</td></tr>
<tr><td><code id="arc_select_+3A_predicate">predicate</code></td>
<td>
<p>Spatial predicate to use with <code>filter_geom</code>. Default
<code>"intersects"</code>. Possible options are <code>"intersects"</code>, <code>"contains"</code>,
<code>"crosses"</code>,  <code>"overlaps"</code>,  <code>"touches"</code>, and <code>"within"</code>.</p>
</td></tr>
<tr><td><code id="arc_select_+3A_n_max">n_max</code></td>
<td>
<p>the maximum number of features to return. By default returns
every feature available. Unused at the moment.</p>
</td></tr>
<tr><td><code id="arc_select_+3A_page_size">page_size</code></td>
<td>
<p>the maximum number of features to return per request. Useful when requests return a 500 error code. See Details.</p>
</td></tr>
<tr><td><code id="arc_select_+3A_token">token</code></td>
<td>
<p>your authorization token.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <a href="https://developers.arcgis.com/rest/services-reference/enterprise/query-feature-service-layer-.htm#GUID-BC2AD141-3386-49FB-AA09-FF341145F614">reference documentation</a> for possible arguments.
</p>
<p><code>FeatureLayers</code> can contain very dense geometries with a lot of coordinates.
In those cases, the feature service may time out before all geometries can
be returned. To address this issue, we can reduce the number of features
returned per each request by reducing the value of the <code>page_size</code> parameter.
</p>
<p><code>arc_select()</code> works by sending a single request that counts the number of
features that will be returned by the current query. That number is then used
to calculate how many &quot;pages&quot; of responses are needed to fetch all the results.
The number of features returned (page size) is set to the <code>maxRecordCount</code>
property of the layer by default. However, by setting <code>page_size</code> to be
smaller than the <code>maxRecordCount</code> we can return fewer geometries per page and
avoid time outs.
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Value</h3>

<p>An sf object, or a data.frame
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# define the feature layer url
furl &lt;- paste0(
  "https://services3.arcgis.com/ZvidGQkLaDJxRSJ2/arcgis/rest",
  "/services/PLACES_LocalData_for_BetterHealth/FeatureServer/0"
)

flayer &lt;- arc_open(furl)

arc_select(
  flayer,
  fields = c("StateAbbr", "TotalPopulation")
)

arc_select(
  flayer,
  fields = c("OBJECTID", "PlaceName"),
  where = "TotalPopulation &gt; 1000000"
)

## End(Not run)
</code></pre>

<hr>
<h2 id='clear_query'>Utility functions</h2><span id='topic+clear_query'></span><span id='topic+list_fields'></span><span id='topic+pull_field_aliases'></span><span id='topic+list_items'></span><span id='topic+refresh_layer'></span>

<h3>Description</h3>

<p>Utility functions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>clear_query(x)

list_fields(x)

pull_field_aliases(x)

list_items(x)

refresh_layer(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="clear_query_+3A_x">x</code></td>
<td>
<p>an object of class <code>FeatureLayer</code>, <code>Table</code>, or <code>ImageServer</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>

<ul>
<li> <p><code>list_fields()</code> returns a data.frame of the fields in a <code>FeatureLayer</code> or <code>Table</code>
</p>
</li>
<li> <p><code>list_items()</code> returns a data.frame containing the layers or tables in a <code>FeatureServer</code> or <code>MapServer</code>
</p>
</li>
<li> <p><code>clear_query()</code> removes any saved query in a <code>FeatureLayer</code> or <code>Table</code> object
</p>
</li>
<li> <p><code>refresh_layer()</code> syncs a <code>FeatureLayer</code> or <code>Table</code> with the remote
resource picking up any changes that may have been made upstream.
Returns an object of class <code>x</code>.
</p>
</li>
<li> <p><code>pull_field_aliases()</code> returns a named list of the field aliases from a <code>FeatureLayer</code> or <code>Table</code>
</p>
</li></ul>



<h3>Value</h3>

<p>See Details.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
furl &lt;- paste0(
  "https://services3.arcgis.com/ZvidGQkLaDJxRSJ2/arcgis/rest/services/",
  "PLACES_LocalData_for_BetterHealth/FeatureServer/0"
)

flayer &lt;- arc_open(furl)

# list fields available in a layer
list_fields(flayer)

# remove any queries stored in the query attribute
clear_query(update_params(flayer, outFields = "*"))

# refresh metadata of an object
refresh_layer(flayer)

map_url &lt;- paste0(
  "https://services.arcgisonline.com/ArcGIS/rest/services/",
  "World_Imagery/MapServer"
)

# list all items in a server object
list_items(arc_open(map_url))

## End(Not run)
</code></pre>

<hr>
<h2 id='create_feature_server'>Create a FeatureServer</h2><span id='topic+create_feature_server'></span><span id='topic+xss_defaults'></span>

<h3>Description</h3>

<p>Creates an empty FeatureServer with no additional layers.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_feature_server(
  service_name,
  description = "",
  crs = 3857,
  capabilities = c("create", "delete", "query", "update", "editing"),
  query_formats = c("json", "geojson"),
  initial_extent = list(xmin = NULL, xmax = NULL, ymin = NULL, ymax = NULL),
  max_record_count = 1000L,
  allow_updates = TRUE,
  copyright = "",
  has_static_data = FALSE,
  xss_prevention = xss_defaults(),
  token = arc_token()
)

xss_defaults()
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_feature_server_+3A_service_name">service_name</code></td>
<td>
<p>Feature Service name.</p>
</td></tr>
<tr><td><code id="create_feature_server_+3A_description">description</code></td>
<td>
<p>default blank. The description of the feature server.</p>
</td></tr>
<tr><td><code id="create_feature_server_+3A_crs">crs</code></td>
<td>
<p>default <code>3857</code>. A coordinate reference system to set for the feature server.
Must be compatible with <code>sf::st_crs()</code>.</p>
</td></tr>
<tr><td><code id="create_feature_server_+3A_capabilities">capabilities</code></td>
<td>
<p>default full capabilities. Character vector of capabilities.</p>
</td></tr>
<tr><td><code id="create_feature_server_+3A_query_formats">query_formats</code></td>
<td>
<p>default json and geojson. May be restricted by site-wide settings.</p>
</td></tr>
<tr><td><code id="create_feature_server_+3A_initial_extent">initial_extent</code></td>
<td>
<p>optional. A named list with element of
<code>xmin</code>, <code>xmax</code>, <code>ymin</code>, and <code>ymax</code>. Values must be in the same CRS as <code>crs</code>.</p>
</td></tr>
<tr><td><code id="create_feature_server_+3A_max_record_count">max_record_count</code></td>
<td>
<p>default <code>1000</code>. The maximum number of records that can be
retrieved from a layer in one request.</p>
</td></tr>
<tr><td><code id="create_feature_server_+3A_allow_updates">allow_updates</code></td>
<td>
<p>default <code>TRUE</code>. Determine if geometries can be updated.</p>
</td></tr>
<tr><td><code id="create_feature_server_+3A_copyright">copyright</code></td>
<td>
<p>default blank. Copyright notice to provide in the Feature Server</p>
</td></tr>
<tr><td><code id="create_feature_server_+3A_has_static_data">has_static_data</code></td>
<td>
<p>default <code>FALSE</code>. Indicates if data is changing.</p>
</td></tr>
<tr><td><code id="create_feature_server_+3A_xss_prevention">xss_prevention</code></td>
<td>
<p>cross-site-scripting prevention is enabled by default.
See details for more.</p>
</td></tr>
<tr><td><code id="create_feature_server_+3A_token">token</code></td>
<td>
<p>an <code>httr2_token</code> as created by <code>auth_code()</code> or similar</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Value</h3>

<p>If a <code>FeatureServer</code> is created successfully, a <code>FeatureServer</code> object is returned
based on the newly created feature server's url.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  set_arc_token(auth_code())
  create_feature_server("My empty feature server")

## End(Not run)
</code></pre>

<hr>
<h2 id='get_layer'>Extract a layer from a Feature or Map Server</h2><span id='topic+get_layer'></span><span id='topic+get_all_layers'></span><span id='topic+get_layers'></span>

<h3>Description</h3>

<p>These helpers provide easy access to the layers contained in a
<code>FeatureServer</code> or <code>MapServer</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_layer(x, id = NULL, name = NULL, token = arc_token())

get_all_layers(x, token = arc_token())

get_layers(x, id = NULL, name = NULL, token = arc_token())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_layer_+3A_x">x</code></td>
<td>
<p>an object of class <code>FeatureServer</code> or <code>MapServer</code></p>
</td></tr>
<tr><td><code id="get_layer_+3A_id">id</code></td>
<td>
<p>default <code>NULL</code>. A numeric vector of unique ID of the layer you want to retrieve. This is a scalar in <code>get_layer()</code>.</p>
</td></tr>
<tr><td><code id="get_layer_+3A_name">name</code></td>
<td>
<p>default <code>NULL</code>. The name associated with the layer you want to retrieve. <code>name</code> is mutually exclusive with <code>id</code>. This is a scalar in <code>get_layer()</code>.</p>
</td></tr>
<tr><td><code id="get_layer_+3A_token">token</code></td>
<td>
<p>your authorization token.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>
<p>The <code>id</code> and <code>name</code> arguments must match the field values of the respective names as seen in the output of <code>list_items()</code>
</p>


<h3>Value</h3>


<ul>
<li> <p><code>get_layer()</code> returns a single <code>FeatureLayer</code> or <code>Table</code> based on its ID
</p>
</li>
<li> <p><code>get_layers()</code> returns a list of the items specified by the <code>id</code> or <code>name</code> argument
</p>
</li>
<li> <p><code>get_all_layers()</code> returns a named <code>list</code> with an element <code>layers</code> and <code>tables</code>.
Each a list containing <code>FeatureLayer</code> and <code>Table</code>s respectively.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  # FeatureServer
  furl &lt;- paste0(
    "https://services3.arcgis.com/ZvidGQkLaDJxRSJ2/arcgis/rest/services/",
    "PLACES_LocalData_for_BetterHealth/FeatureServer"
  )

  fserv &lt;- arc_open(furl)

  fserv
  get_layer(fserv, 0)
  get_layers(fserv, name = c("Tracts", "ZCTAs"))
  get_all_layers(fserv)

## End(Not run)
</code></pre>

<hr>
<h2 id='get_layer_estimates'>Get Estimates</h2><span id='topic+get_layer_estimates'></span>

<h3>Description</h3>

<p>Get Estimates
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_layer_estimates(x, token = arc_token())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_layer_estimates_+3A_x">x</code></td>
<td>
<p>an object of class <code>FeatureLayer</code>, <code>Table</code>, or <code>ImageServer</code>.</p>
</td></tr>
<tr><td><code id="get_layer_estimates_+3A_token">token</code></td>
<td>
<p>your authorization token.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A named list containing all estimate info. If <code>extent</code> is present,
it is available as an object of class <code>bbox</code>.
</p>


<h3>References</h3>

<p><a href="https://developers.arcgis.com/rest/services-reference/enterprise/get-estimates-feature-service-layer-.htm">ArcGIS REST Doc</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>furl &lt;- paste0(
  "https://services.arcgis.com/P3ePLMYs2RVChkJx/ArcGIS/rest/services/",
  "USA_Counties_Generalized_Boundaries/FeatureServer/0"
)

county_fl &lt;- arc_open(furl)
get_layer_estimates(county_fl)
</code></pre>

<hr>
<h2 id='prepare_spatial_filter'>Prepare JSON for use as a spatial filter based on feature geometry or
bounding box input</h2><span id='topic+prepare_spatial_filter'></span><span id='topic+match_spatial_rel'></span>

<h3>Description</h3>

<p><code><a href="#topic+prepare_spatial_filter">prepare_spatial_filter()</a></code> prepares a named list with ESRI JSON geometry for
use as a spatial filter based on a a <code>sfc</code>, <code>sfg</code>, or <code>bbox</code> input object.
</p>
<p><code><a href="#topic+match_spatial_rel">match_spatial_rel()</a></code> takes a scalar character vector with a predicate name
to a type of ESRI spatial relation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prepare_spatial_filter(
  filter_geom,
  crs,
  predicate,
  error_call = rlang::caller_env()
)

match_spatial_rel(predicate, error_call = rlang::caller_env())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="prepare_spatial_filter_+3A_filter_geom">filter_geom</code></td>
<td>
<p>an object of class <code>bbox</code>, <code>sfc</code> or <code>sfg</code> used to filter
query results based on a predicate function.</p>
</td></tr>
<tr><td><code id="prepare_spatial_filter_+3A_crs">crs</code></td>
<td>
<p>a representation of a coordinate reference system.</p>
</td></tr>
<tr><td><code id="prepare_spatial_filter_+3A_predicate">predicate</code></td>
<td>
<p>Spatial predicate to use with <code>filter_geom</code>. Default
<code>"intersects"</code>. Possible options are <code>"intersects"</code>, <code>"contains"</code>,
<code>"crosses"</code>,  <code>"overlaps"</code>,  <code>"touches"</code>, and <code>"within"</code>.</p>
</td></tr>
<tr><td><code id="prepare_spatial_filter_+3A_error_call">error_call</code></td>
<td>
<p>default <code>rlang::caller_env()</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Using <code>sfc</code> objects as <code>filter_geom</code>
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>
<p>If an <code>sfc</code> object is provided it will be transformed to the layers spatial
reference. If the <code>sfc</code> is missing a CRS (or is an <code>sfg</code> object) it is
assumed to use the same spatial reference as the FeatureLayer. If the <code>sfc</code>
object has multiple features, the features are unioned with
<code><a href="sf.html#topic+geos_combine">sf::st_union()</a></code>. If an <code>sfc</code> object has <code>MULTIPOLYGON</code> geometry, the features
are unioned before being cast to <code>POLYGON</code> geometry with <code><a href="sf.html#topic+st_cast">sf::st_cast()</a></code>. All
geometries are checked for validity before conversion.
</p>


<h3>Value</h3>

<p><code><a href="#topic+prepare_spatial_filter">prepare_spatial_filter()</a></code> returns a named list with the
<code>geometryType</code>, <code>geometry</code> (as Esri JSON), and spatial relation predicate.
</p>
<p><code><a href="#topic+match_spatial_rel">match_spatial_rel()</a></code> returns one of the following spatial binary predicates:
</p>

<ul>
<li><p> esriSpatialRelIntersects
</p>
</li>
<li><p> esriSpatialRelContains
</p>
</li>
<li><p> esriSpatialRelCrosses
</p>
</li>
<li><p> esriSpatialRelOverlaps
</p>
</li>
<li><p> esriSpatialRelTouches
</p>
</li>
<li><p> esriSpatialRelWithin
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>prepare_spatial_filter(sf::st_point(c(0, 5)), 4326, "intersects")
</code></pre>

<hr>
<h2 id='query_layer_attachments'>Query and download attachments</h2><span id='topic+query_layer_attachments'></span><span id='topic+download_attachments'></span>

<h3>Description</h3>

<p>Get metadata about attachments associated with features in a layer.
Query attachment information using <code>query_layer_attachments()</code> and
download attachments using <code>download_attachments()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>query_layer_attachments(
  x,
  definition_expression = "1=1",
  attachments_definition_expression = NULL,
  object_ids = NULL,
  global_ids = NULL,
  attachment_types = NULL,
  keywords = NULL,
  ...,
  token = arc_token()
)

download_attachments(
  attachments,
  out_dir,
  ...,
  overwrite = FALSE,
  .progress = TRUE,
  token = arc_token()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="query_layer_attachments_+3A_x">x</code></td>
<td>
<p>an object of class <code>FeatureLayer</code>, <code>Table</code>, or <code>ImageServer</code>.</p>
</td></tr>
<tr><td><code id="query_layer_attachments_+3A_definition_expression">definition_expression</code></td>
<td>
<p>default <code>1 = 1</code>. A SQL where clause that is applied to the layer. Only those records that conform to this expression will be returned. This parameter is required if neither <code>object_ids</code> or <code>global_ids</code> have been defined.</p>
</td></tr>
<tr><td><code id="query_layer_attachments_+3A_attachments_definition_expression">attachments_definition_expression</code></td>
<td>
<p>default <code>NULL</code>. A SQL where calsue that is applied to the attachment metadata.
only attachments that conform to this expression will be returned.</p>
</td></tr>
<tr><td><code id="query_layer_attachments_+3A_object_ids">object_ids</code></td>
<td>
<p>mutually exclusive with <code>definition_expression</code> and <code>global_ids</code>. The object IDs of the features to query attachments of.</p>
</td></tr>
<tr><td><code id="query_layer_attachments_+3A_global_ids">global_ids</code></td>
<td>
<p>mutally exclusive with <code>definition_expression</code> and <code>object_ids</code>. The global IDs of the features to query attachments of.</p>
</td></tr>
<tr><td><code id="query_layer_attachments_+3A_attachment_types">attachment_types</code></td>
<td>
<p>default <code>NULL</code>. A character vector of attachment types to filter on.</p>
</td></tr>
<tr><td><code id="query_layer_attachments_+3A_keywords">keywords</code></td>
<td>
<p>default <code>NULL</code>. A character vector of the keywords to filter on.</p>
</td></tr>
<tr><td><code id="query_layer_attachments_+3A_...">...</code></td>
<td>
<p>unused</p>
</td></tr>
<tr><td><code id="query_layer_attachments_+3A_token">token</code></td>
<td>
<p>your authorization token.</p>
</td></tr>
<tr><td><code id="query_layer_attachments_+3A_attachments">attachments</code></td>
<td>
<p>a <code>data.frame</code> created by <code>query_layer_attachments()</code>. Must contain the columns <code>name</code>, <code>url</code>, and <code>contentType</code>.</p>
</td></tr>
<tr><td><code id="query_layer_attachments_+3A_out_dir">out_dir</code></td>
<td>
<p>the path to the folder to download the file</p>
</td></tr>
<tr><td><code id="query_layer_attachments_+3A_overwrite">overwrite</code></td>
<td>
<p>default <code>FALSE</code>. A</p>
</td></tr>
<tr><td><code id="query_layer_attachments_+3A_.progress">.progress</code></td>
<td>
<p>default <code>TRUE.</code> Whether a progress bar should be provided.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>query_layer_attachments()</code> returns a data.frame.
</p>
<p><code>download_attachments()</code> returns a list. If an error occurs, the condition is captured and returned in the list.
Otherwise the path to the file that was downloaded is returned.
</p>


<h3>References</h3>

<p><a href="https://developers.arcgis.com/rest/services-reference/enterprise/query-attachments-feature-service-layer/">ArcGIS REST API Documentation</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# create a url path that isn't too wide for CRAN
furl &lt;- paste(
  c(
    "https://services1.arcgis.com/hLJbHVT9ZrDIzK0I",
    "arcgis/rest/services/v8_Wide_Area_Search_Form_Feature_Layer___a2fe9c",
    "FeatureServer/0"
  ),
  collapse = "/"
)
# connect to the layer
layer &lt;- arc_open(furl)

# get the attachment info
att &lt;- query_layer_attachments(layer)

# download them to a path
download_attachments(att, "layer_attachments")

## End(Not run)
</code></pre>

<hr>
<h2 id='truncate_layer'>Truncate a Feature Layer</h2><span id='topic+truncate_layer'></span>

<h3>Description</h3>

<p>Removes all features in a Feature Layer or Table and resets the object ID
counter. Truncating a Feature Layer does not change the schema of the data
(does not add, remove, or alter existing database columns, constraints,
or indexes).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>truncate_layer(x, async = FALSE, attachment_only = FALSE, token = arc_token())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="truncate_layer_+3A_x">x</code></td>
<td>
<p>an object of class <code>FeatureLayer</code>, <code>Table</code>, or <code>ImageServer</code>.</p>
</td></tr>
<tr><td><code id="truncate_layer_+3A_async">async</code></td>
<td>
<p>default <code>FALSE</code>. It is recommended to set <code>TRUE</code> for
larger datasets.</p>
</td></tr>
<tr><td><code id="truncate_layer_+3A_attachment_only">attachment_only</code></td>
<td>
<p>default <code>FALSE</code>. Deletes all the attachments for this
layer. None of the layer features will be deleted when <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="truncate_layer_+3A_token">token</code></td>
<td>
<p>your authorization token.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a named list with the name &quot;success&quot; and a value of <code>TRUE</code> or <code>FALSE</code>
</p>


<h3>References</h3>

<p><a href="https://developers.arcgis.com/rest/services-reference/online/truncate-feature-layer-.htm">ArcGIS Developers Rest API Doc</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

  # authorize using code flow
  set_arc_token(auth_code())

  # create a FeatureLayer object
  flayer &lt;- arc_open("your-feature-layer-url")

  # truncate it
  truncate_layer(flayer)

## End(Not run)
</code></pre>

<hr>
<h2 id='update_params'>Modify query parameters</h2><span id='topic+update_params'></span>

<h3>Description</h3>

<p><code><a href="#topic+update_params">update_params()</a></code> takes named arguments and updates the query.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>update_params(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="update_params_+3A_x">x</code></td>
<td>
<p>a <code>FeatureLayer</code> or <code>Table</code> object</p>
</td></tr>
<tr><td><code id="update_params_+3A_...">...</code></td>
<td>
<p>key value pairs of query parameters and values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of the same class as <code>x</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
furl &lt;- paste0(
  "https://services.arcgis.com/P3ePLMYs2RVChkJx/ArcGIS/rest/services/",
  "USA_Major_Cities_/FeatureServer/0"
)

flayer &lt;- arc_open(furl)
update_params(flayer, outFields = "NAME")

## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
