<!DOCTYPE html><html><head><title>Help for package qpNCA</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {qpNCA}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#calc.ctmax'><p>Calculate Cmax and Tmax</p></a></li>
<li><a href='#calc.par'><p>Calculate NCA Parameters</p></a></li>
<li><a href='#calc.par.th'><p>Calculate Lambda_z Parameters</p></a></li>
<li><a href='#check.input'><p>Check qpNCA function arguments for validity</p></a></li>
<li><a href='#correct.conc'><p>Correct Missing Concentration</p></a></li>
<li><a href='#correct.loq'><p>Impute Concentrations Below the Limit of Quantitation</p></a></li>
<li><a href='#correct.time'><p>Correct Concentrations for Time Deviations</p></a></li>
<li><a href='#est.thalf'><p>Calculate Lambda_z and Elimination Half-life</p></a></li>
<li><a href='#filenamefun'><p>Create File Name for Regression Plots</p></a></li>
<li><a href='#interpol'><p>Interpolate Concentrations</p></a></li>
<li><a href='#lag_lead'><p>Estimate Lagging and Leading Times and Concentrations</p></a></li>
<li><a href='#plot_reg'><p>Plot Regression Curves</p></a></li>
<li><a href='#qpNCA'><p>Perform Non-compartmental Analysis</p></a></li>
<li><a href='#tab.corr'><p>Tabulate Corrections</p></a></li>
<li><a href='#titlefun'><p>Create Title for Regression Plots</p></a></li>
<li><a href='#trap'><p>Calculate Area Under the Curve Using Trapezoids</p></a></li>
<li><a href='#trapm'><p>Calculate Area Under the Moment Curve Using Trapezoids</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Noncompartmental Pharmacokinetic Analysis by qPharmetra</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.6</td>
</tr>
<tr>
<td>Author:</td>
<td>Jan Huisman [aut, cre],
  Koen Jolling [ctb],
  Krina Mehta [ctb],
  Tim Bergsma [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jan Huisman &lt;jan.huisman@qpharmetra.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Computes noncompartmental pharmacokinetic parameters
 for drug concentration profiles.  For each profile, data
 imputations and adjustments are made as necessary and
 basic parameters are estimated. Supports single dose, multi-dose,
 and multi-subject data.  Supports steady-state calculations
 and various routes of drug administration. See ?qpNCA and vignettes.
 Methodology follows Rowland and Tozer (2011, ISBN:978-0-683-07404-8), 
 Gabrielsson and Weiner (1997, ISBN:978-91-9765-100-4), and
 Gibaldi and Perrier (1982, ISBN:978-0824710422).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Suggests:</td>
<td>rmarkdown, markdown, covr, testthat (&ge; 2.1.0)</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.3.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr(&ge; 0.7.0), tidyr (&ge; 0.8.2), magrittr, ggplot2, knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-08-16 12:22:01 UTC; rstudio</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-08-16 12:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='calc.ctmax'>Calculate Cmax and Tmax</h2><span id='topic+calc.ctmax'></span>

<h3>Description</h3>

<p>Calculates Cmax and Tmax from raw data for each PK curve defined using <code>by</code>. <br />
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calc.ctmax(x, by = character(0), timevar = "time", depvar = "dv")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calc.ctmax_+3A_x">x</code></td>
<td>
<p>data.frame</p>
</td></tr>
<tr><td><code id="calc.ctmax_+3A_by">by</code></td>
<td>
<p>column names in x indicating grouping variables</p>
</td></tr>
<tr><td><code id="calc.ctmax_+3A_timevar">timevar</code></td>
<td>
<p>variable name containing the actual sampling time after dose</p>
</td></tr>
<tr><td><code id="calc.ctmax_+3A_depvar">depvar</code></td>
<td>
<p>variable name containing the dependent variable (e.g., concentration)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Input dataset can contain all uncorrected data, including LOQ;
estimate first occurence of maximum concentration for each PK curve;
if all concentrations are NA, sets Cmax and Tmax also to NA.
</p>


<h3>Value</h3>

<p>A dataset with estimates for the Cmax (maximum concentration)
and Tmax (time of first occurence of cmax) parameters: one observation per subject
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
example(est.thalf)
ctmax &lt;- x %&gt;% calc.ctmax(by = 'subject')
ctmax %&gt;% head

</code></pre>

<hr>
<h2 id='calc.par'>Calculate NCA Parameters</h2><span id='topic+calc.par'></span>

<h3>Description</h3>

<p>Calculates PK parameters for which half-life is not needed in the calculation for each PK curve defined using <code>by</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calc.par(
  x,
  by = character(0),
  tau = NA,
  tstart = NA,
  tend = NA,
  teval = NA,
  route = "EV",
  method = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calc.par_+3A_x">x</code></td>
<td>
<p>contains all data after time/concentration deviation corrections obtained from <code><a href="#topic+correct.time">correct.time</a></code> and <code><a href="#topic+correct.conc">correct.conc</a></code></p>
</td></tr>
<tr><td><code id="calc.par_+3A_by">by</code></td>
<td>
<p>column names in x indicating grouping variables</p>
</td></tr>
<tr><td><code id="calc.par_+3A_tau">tau</code></td>
<td>
<p>dosing interval (for multiple dosing); NA (default) for if single dose; x$tau overrides</p>
</td></tr>
<tr><td><code id="calc.par_+3A_tstart">tstart</code></td>
<td>
<p>start time of partial AUC (start&gt;0); NA (default) if not requested; x$tstart overrides</p>
</td></tr>
<tr><td><code id="calc.par_+3A_tend">tend</code></td>
<td>
<p>end time of partial AUC; NA (default) if not requested; x$tend overrides</p>
</td></tr>
<tr><td><code id="calc.par_+3A_teval">teval</code></td>
<td>
<p>user selected AUC interval; NA (default) if not requested; x$teval overrides</p>
</td></tr>
<tr><td><code id="calc.par_+3A_route">route</code></td>
<td>
<p>route of drug administration (&quot;EV&quot;,&quot;IVB&quot;,&quot;IVI&quot;); x$route overrides</p>
</td></tr>
<tr><td><code id="calc.par_+3A_method">method</code></td>
<td>
<p>method for trapezoidal rule
</p>

<ul>
<li><p> 1: linear up - linear down
</p>
</li>
<li><p> 2: linear up - logarithmic down
</p>
</li>
<li><p> 3: linear before first Tmax, logarithmic after first Tmax
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>A dataset with estimates for the following parameters,
one observation per subject:</p>

<table>
<tr>
 <td style="text-align: left;">
   <strong>Parameter</strong> </td><td style="text-align: left;"> <strong>Description</strong> </td>
</tr>
<tr>
 <td style="text-align: left;">
   t0.ok </td><td style="text-align: left;"> flags if t=0 concentration could be corrected/imputes. If not, no AUCs starting at t=0 are calculated </td>
</tr>
<tr>
 <td style="text-align: left;">
   tlast.ok </td><td style="text-align: left;"> flags if there is at least one measurable concentration. If not, no AUClast can be calculated </td>
</tr>
<tr>
 <td style="text-align: left;">
   tlast </td><td style="text-align: left;"> time of last sample with measurable concentration </td>
</tr>
<tr>
 <td style="text-align: left;">
   clast.obs </td><td style="text-align: left;"> observed concentration at tlast </td>
</tr>
<tr>
 <td style="text-align: left;">
   aucall </td><td style="text-align: left;"> auc calculated over all observations, including values below LOQ (which are set to 0) </td>
</tr>
<tr>
 <td style="text-align: left;">
   auclast </td><td style="text-align: left;"> auc calculated using all observations up to and including the last measurable concentration (clast.obs at tlast) </td>
</tr>
<tr>
 <td style="text-align: left;">
   aumcall </td><td style="text-align: left;"> aumc calculated over all observations, including values below LOQ (which are set to 0) </td>
</tr>
<tr>
 <td style="text-align: left;">
   aumclast </td><td style="text-align: left;"> aumc calculated using all observations up to and including the last measurable concentration (clast.obs at tlast) </td>
</tr>
<tr>
 <td style="text-align: left;">
   tau </td><td style="text-align: left;"> the dosing interval (if specified) </td>
</tr>
<tr>
 <td style="text-align: left;">
   calc.tau </td><td style="text-align: left;"> flags if AUCtau could be calculated </td>
</tr>
<tr>
 <td style="text-align: left;">
   auctau </td><td style="text-align: left;"> auc calculated over the dosing interval, only calculated if tau is specified </td>
</tr>
<tr>
 <td style="text-align: left;">
   aumctau </td><td style="text-align: left;"> aumc calculated over the dosing interval, only calculated if tau is specified </td>
</tr>
<tr>
 <td style="text-align: left;">
   teval </td><td style="text-align: left;"> user selected AUC interval starting at t=0 (if specified) </td>
</tr>
<tr>
 <td style="text-align: left;">
   calc.teval </td><td style="text-align: left;"> flags if AUCteval could be calculated </td>
</tr>
<tr>
 <td style="text-align: left;">
   aucxx </td><td style="text-align: left;"> auc calculated from t=0 up to/including teval, only calculated if teval is specified (xx is substituted by teval) </td>
</tr>
<tr>
 <td style="text-align: left;">
   calc.part </td><td style="text-align: left;"> flags if AUCpart could be calculated </td>
</tr>
<tr>
 <td style="text-align: left;">
   tstart </td><td style="text-align: left;"> start time of partial AUC (if specified) </td>
</tr>
<tr>
 <td style="text-align: left;">
   tend </td><td style="text-align: left;"> end time of partial AUC (if specified) </td>
</tr>
<tr>
 <td style="text-align: left;">
   aucx_y </td><td style="text-align: left;"> partial auc from time=x up to/including time=y, where x&gt;0, only calculated if tstart and tend are specified </td>
</tr>
<tr>
 <td style="text-align: left;">
   c0 </td><td style="text-align: left;"> back-extrapolated concentration at t=0 for IV bolus administration </td>
</tr>
<tr>
 <td style="text-align: left;">
   area.back.extr </td><td style="text-align: left;"> area back-extrapolated to 0 </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Examples</h3>

<pre><code class='language-R'>
example(correct.conc)
par &lt;- x %&gt;% calc.par(by = 'subject')
par %&gt;% head

</code></pre>

<hr>
<h2 id='calc.par.th'>Calculate Lambda_z Parameters</h2><span id='topic+calc.par.th'></span>

<h3>Description</h3>

<p>Calculates PK parameters that need lambda_z.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calc.par.th(
  x,
  by = character(0),
  th = th,
  covariates = NA,
  dose = "dose",
  factor = 1,
  reg = "SD",
  ss = "N",
  route = "EV"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calc.par.th_+3A_x">x</code></td>
<td>
<p>result parameter dataset from <code><a href="#topic+calc.par">calc.par</a></code></p>
</td></tr>
<tr><td><code id="calc.par.th_+3A_by">by</code></td>
<td>
<p>column names in x indicating grouping variables</p>
</td></tr>
<tr><td><code id="calc.par.th_+3A_th">th</code></td>
<td>
<p>result dataset from <code><a href="#topic+est.thalf">est.thalf</a></code></p>
</td></tr>
<tr><td><code id="calc.par.th_+3A_covariates">covariates</code></td>
<td>
<p>covariates dataset (containing at least dose for CL calculation); defaults to unique combinations of <code>by</code> and <code>dose</code> evaluated on <code>x</code>; can be character name of csv file or local object</p>
</td></tr>
<tr><td><code id="calc.par.th_+3A_dose">dose</code></td>
<td>
<p>variable containing the dose amount; default 'dose' set to 1 if not in <code>names(x)</code></p>
</td></tr>
<tr><td><code id="calc.par.th_+3A_factor">factor</code></td>
<td>
<p>conversion factor for CL and V calculation (e.g. dose in mg, conc in ng/mL, factor=1000); x$factor overrides</p>
</td></tr>
<tr><td><code id="calc.par.th_+3A_reg">reg</code></td>
<td>
<p>regimen, &quot;sd&quot; or &quot;md&quot;; x$reg overrides</p>
</td></tr>
<tr><td><code id="calc.par.th_+3A_ss">ss</code></td>
<td>
<p>is steady state reached (y/n); x$ss overrides</p>
</td></tr>
<tr><td><code id="calc.par.th_+3A_route">route</code></td>
<td>
<p>of drug administration (&quot;EV&quot;,&quot;IVB&quot;,&quot;IVI&quot;); x$route overrides</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A dataset containing all parameters calculated in <code><a href="#topic+est.thalf">est.thalf</a></code> and <code><a href="#topic+calc.par">calc.par</a></code> <br />
with estimates for the following parameters added, one observation per subject:</p>

<table>
<tr>
 <td style="text-align: left;">
   <strong>Parameter</strong> </td><td style="text-align: left;"> <strong>Description</strong> </td>
</tr>
<tr>
 <td style="text-align: left;">
   clast.pred </td><td style="text-align: left;"> predicted concentration at tlast </td>
</tr>
<tr>
 <td style="text-align: left;">
   aucinf.obs </td><td style="text-align: left;"> aucinf based on observed concentration at tlast </td>
</tr>
<tr>
 <td style="text-align: left;">
   aucinf.pred </td><td style="text-align: left;"> aucinf based on predicted concentration at tlast </td>
</tr>
<tr>
 <td style="text-align: left;">
   aumcinf.obs </td><td style="text-align: left;"> area under the first moment curve extrapolated to infinity, based on observed concentration at tlast </td>
</tr>
<tr>
 <td style="text-align: left;">
   aumcinf.pred </td><td style="text-align: left;"> area under the first moment curve extrapolated to infinity, based on predicted concentration at tlast </td>
</tr>
<tr>
 <td style="text-align: left;">
   cl.obs, cl.f.obs </td><td style="text-align: left;"> clearance based on aucinf.obs, at steady state based on auctau </td>
</tr>
<tr>
 <td style="text-align: left;">
   cl.pred, cl.f.pred </td><td style="text-align: left;"> clearance based on aucinf.pred </td>
</tr>
<tr>
 <td style="text-align: left;">
   cl.ss, cl.f.ss </td><td style="text-align: left;"> clearance at steady state, based on auctau </td>
</tr>
<tr>
 <td style="text-align: left;">
   mrt.obs </td><td style="text-align: left;"> mean residence time based on aumcinf.obs and aucinf.obs </td>
</tr>
<tr>
 <td style="text-align: left;">
   mrt.pred </td><td style="text-align: left;"> mean residence time based on aumcinf.pred and aucinf.pred </td>
</tr>
<tr>
 <td style="text-align: left;">
   vz.obs, vz.f.obs </td><td style="text-align: left;"> distribution volume based on cl.f.obs, at steady state based on auctau </td>
</tr>
<tr>
 <td style="text-align: left;">
   vz.pred, vz.f.pred </td><td style="text-align: left;"> distribution based on cl.pred/cl.f.pred </td>
</tr>
<tr>
 <td style="text-align: left;">
   vss.obs </td><td style="text-align: left;"> steady-state volume based on cl.obs and mrt.obs </td>
</tr>
<tr>
 <td style="text-align: left;">
   vss.pred </td><td style="text-align: left;"> steady-state volume based on cl.pred and mrt.pred </td>
</tr>
<tr>
 <td style="text-align: left;">
   pctextr.pred </td><td style="text-align: left;"> percentage of AUC extrapolated to infinity, based on aucinf.pred </td>
</tr>
<tr>
 <td style="text-align: left;">
   pctextr.obs </td><td style="text-align: left;"> percentage of AUC extrapolated to infinity, based on aucinf.obs </td>
</tr>
<tr>
 <td style="text-align: left;">
   pctback.pred </td><td style="text-align: left;"> percentage of AUC extrapolated back to 0, based on aucinf.pred </td>
</tr>
<tr>
 <td style="text-align: left;">
   pctback.obs </td><td style="text-align: left;"> percentage of AUC extrapolated back to 0, based on aucinf.obs </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>Note: ctmax must be merged separately as those were calculated from uncorrected data.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
example(calc.par) # creates par
# notice x includes (optional) loqrule, includeCmax, reg, method, route, ss
covs &lt;- Theoph %&gt;%
  select(subject = Subject, Wt, dose = Dose) %&gt;%
  unique %&gt;%
  mutate(dose = dose * Wt, subject=as.numeric(as.character(subject))) # see ?Theoph
y &lt;- x %&gt;% select(subject, reg, ss, loqrule) %&gt;% unique
y %&lt;&gt;% mutate(factor = 1)
par %&lt;&gt;% left_join(y, by = 'subject')
par %&lt;&gt;% calc.par.th(by = 'subject', th = th, covariates = covs)
par %&lt;&gt;% left_join(ctmax, ., by = 'subject')
par %&gt;% head
par %&gt;% data.frame %&gt;% head(2)

</code></pre>

<hr>
<h2 id='check.input'>Check qpNCA function arguments for validity</h2><span id='topic+check.input'></span>

<h3>Description</h3>

<p>Checks whether all function arguments are valid and entered column names are present in input data <br />
See <code><a href="#topic+qpNCA">qpNCA</a></code> for description of the arguments
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check.input(
  x,
  by = NA,
  nomtimevar = NA,
  timevar = NA,
  depvar = NA,
  bloqvar = NA,
  loqvar = NA,
  loqrule = NA,
  includeCmax = NA,
  exclvar = NA,
  plotdir = NA,
  timelab = NA,
  deplab = NA,
  tau = NA,
  tstart = NA,
  tend = NA,
  teval = NA,
  covariates = NA,
  dose = NA,
  factor = NA,
  reg = NA,
  ss = NA,
  route = NA,
  method = NA
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check.input_+3A_x">x</code></td>
<td>
<p>data.frame</p>
</td></tr>
<tr><td><code id="check.input_+3A_by">by</code></td>
<td>
<p>column names in x indicating grouping variables</p>
</td></tr>
<tr><td><code id="check.input_+3A_nomtimevar">nomtimevar</code></td>
<td>
<p>variable name containing the nominal sampling time after dose</p>
</td></tr>
<tr><td><code id="check.input_+3A_timevar">timevar</code></td>
<td>
<p>variable name containing the actual sampling time after dose</p>
</td></tr>
<tr><td><code id="check.input_+3A_depvar">depvar</code></td>
<td>
<p>variable name containing the dependent variable (e.g., concentration)</p>
</td></tr>
<tr><td><code id="check.input_+3A_bloqvar">bloqvar</code></td>
<td>
<p>variable name containing the BLOQ flag (0: no, 1: yes)</p>
</td></tr>
<tr><td><code id="check.input_+3A_loqvar">loqvar</code></td>
<td>
<p>variable name containing the LOQ value</p>
</td></tr>
<tr><td><code id="check.input_+3A_loqrule">loqrule</code></td>
<td>
<p>rule number to be applied to the LOQ values in the curve; x$loqrule overrides if provided</p>
</td></tr>
<tr><td><code id="check.input_+3A_includecmax">includeCmax</code></td>
<td>
<p>include Cmax in half-life estimation? (y/n); x$includeCmax overrides if provided</p>
</td></tr>
<tr><td><code id="check.input_+3A_exclvar">exclvar</code></td>
<td>
<p>variable name indicating points to be excluded in half-life estimation (these should have exclvar = 1)</p>
</td></tr>
<tr><td><code id="check.input_+3A_plotdir">plotdir</code></td>
<td>
<p>directory where regression plots (.PNG) will be saved; NA gives default location, NULL skips regression plots</p>
</td></tr>
<tr><td><code id="check.input_+3A_timelab">timelab</code></td>
<td>
<p>label for time axis in regression plots</p>
</td></tr>
<tr><td><code id="check.input_+3A_deplab">deplab</code></td>
<td>
<p>label for dependent variable axis in regression plots</p>
</td></tr>
<tr><td><code id="check.input_+3A_tau">tau</code></td>
<td>
<p>dosing interval (for multiple dosing); NA (default) if single dose; x$tau overrides</p>
</td></tr>
<tr><td><code id="check.input_+3A_tstart">tstart</code></td>
<td>
<p>start time of partial AUC (start&gt;0); NA (default) if not requested; x$tstart overrides</p>
</td></tr>
<tr><td><code id="check.input_+3A_tend">tend</code></td>
<td>
<p>end time of partial AUC; NA (default) if not requested; x$tend overrides</p>
</td></tr>
<tr><td><code id="check.input_+3A_teval">teval</code></td>
<td>
<p>user selected AUC interval (starting at t=0); NA (default) if not requested; x$teval overrides</p>
</td></tr>
<tr><td><code id="check.input_+3A_covariates">covariates</code></td>
<td>
<p>covariates dataset; Must contain the dose variable</p>
</td></tr>
<tr><td><code id="check.input_+3A_dose">dose</code></td>
<td>
<p>variable containing the dose amount</p>
</td></tr>
<tr><td><code id="check.input_+3A_factor">factor</code></td>
<td>
<p>conversion factor for CL and V calculation (e.g. dose in mg, conc in ng/mL, factor=1000); x$factor overrides if provided</p>
</td></tr>
<tr><td><code id="check.input_+3A_reg">reg</code></td>
<td>
<p>regimen, &quot;SD&quot; or &quot;MD&quot;; x$reg overrides if provided</p>
</td></tr>
<tr><td><code id="check.input_+3A_ss">ss</code></td>
<td>
<p>is steady state reached (y/n); x$ss overrides if provided</p>
</td></tr>
<tr><td><code id="check.input_+3A_route">route</code></td>
<td>
<p>route of drug administration (&quot;EV&quot;,&quot;IVB&quot;, &quot;IVI&quot;); x$route overrides if provided</p>
</td></tr>
<tr><td><code id="check.input_+3A_method">method</code></td>
<td>
<p>method for trapezoidal rule; x$method overrides if provided</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Check results
</p>

<hr>
<h2 id='correct.conc'>Correct Missing Concentration</h2><span id='topic+correct.conc'></span>

<h3>Description</h3>

<p>Corrects missing concentration at critical time points
(e.g, predose, TAU, start and end of user selected AUC interval).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>correct.conc(
  x,
  by = character(0),
  nomtimevar = "ntad",
  tau = NA,
  tstart = NA,
  tend = NA,
  teval = NA,
  th = NA,
  reg = "SD",
  ss = "N",
  route = "EV",
  method = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="correct.conc_+3A_x">x</code></td>
<td>
<p>input dataset name (after Time Deviation Correction Rules have been applied by <code><a href="#topic+correct.time">correct.time</a></code>)</p>
</td></tr>
<tr><td><code id="correct.conc_+3A_by">by</code></td>
<td>
<p>column names in x indicating grouping variables</p>
</td></tr>
<tr><td><code id="correct.conc_+3A_nomtimevar">nomtimevar</code></td>
<td>
<p>variable name containing the nominal sampling time after dose</p>
</td></tr>
<tr><td><code id="correct.conc_+3A_tau">tau</code></td>
<td>
<p>dosing interval (for multiple dosing); NA (default) for if single dose; x$tau overrides</p>
</td></tr>
<tr><td><code id="correct.conc_+3A_tstart">tstart</code></td>
<td>
<p>start time of partial AUC (start&gt;0); NA (default) if not requested; x$tstart overrides</p>
</td></tr>
<tr><td><code id="correct.conc_+3A_tend">tend</code></td>
<td>
<p>end time of partial AUC; NA (default) if not requested; x$tend overrides</p>
</td></tr>
<tr><td><code id="correct.conc_+3A_teval">teval</code></td>
<td>
<p>user selected AUC interval; NA (default) if not requested; x$teval overrides</p>
</td></tr>
<tr><td><code id="correct.conc_+3A_th">th</code></td>
<td>
<p>lamdba_z information for each curve; like output of <code><a href="#topic+est.thalf">est.thalf</a></code></p>
</td></tr>
<tr><td><code id="correct.conc_+3A_reg">reg</code></td>
<td>
<p>regimen, &quot;sd&quot; or &quot;md&quot;; x$reg overrides</p>
</td></tr>
<tr><td><code id="correct.conc_+3A_ss">ss</code></td>
<td>
<p>is steady state reached (y/n); x$ss overrides</p>
</td></tr>
<tr><td><code id="correct.conc_+3A_route">route</code></td>
<td>
<p>route of drug administration (&quot;EV&quot;,&quot;IVB&quot;,&quot;IVI&quot;); x$route overrides</p>
</td></tr>
<tr><td><code id="correct.conc_+3A_method">method</code></td>
<td>
<p>method for trapezoidal rule;  x$method overrides
</p>

<ul>
<li><p> 1: linear up - linear down
</p>
</li>
<li><p> 2: linear up - logarithmic down
</p>
</li>
<li><p> 3: linear before first Tmax, logarithmic after first Tmax
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li><p> Use interpolation if there is a measurable concentration BEFORE and AFTER the missing concentration
</p>
</li>
<li><p> Use extrapolation if there is NO measurable concentration AFTER the missing concentration
</p>
</li>
<li><p> Set missing concentration at predose to 0 (SD, non-endogenous) or value at t=TAU (steady state only)
</p>
</li>
<li><p> Set missing concentration at t=TAU to value at t=0 (steady state only)
</p>
</li></ul>

<p>The following Concentration Deviation Correction Rules will be applied to critical time points (t=0, tau, tstart, tend, teval), if needed:</p>

<table>
<tr>
 <td style="text-align: left;">
   <strong>Rule</strong> </td><td style="text-align: left;"> <strong>Regimen</strong> </td><td style="text-align: left;"> <strong>Description</strong> </td><td style="text-align: left;"> <strong>Applied to</strong> </td>
</tr>
<tr>
 <td style="text-align: left;">
   SDC-1 </td><td style="text-align: left;"> sd </td><td style="text-align: left;"> Set concentration to 0 (only non-endogenous compounds) </td><td style="text-align: left;"> t=0 </td>
</tr>
<tr>
 <td style="text-align: left;">
   SDC-2 </td><td style="text-align: left;"> sd </td><td style="text-align: left;"> impute missing concentration by interpolation </td><td style="text-align: left;"> t=tau,tstart,tend,teval </td>
</tr>
<tr>
 <td style="text-align: left;">
   SDC-3 </td><td style="text-align: left;"> sd </td><td style="text-align: left;"> impute missing concentration by extrapolation </td><td style="text-align: left;"> t=tau,tend,teval </td>
</tr>
<tr>
 <td style="text-align: left;">
   SDC-4 </td><td style="text-align: left;"> sd (IVB) </td><td style="text-align: left;"> impute missing concentration by back-extrapolation </td><td style="text-align: left;"> t=0 </td>
</tr>
<tr>
 <td style="text-align: left;">
   MDC-1 </td><td style="text-align: left;"> md </td><td style="text-align: left;"> impute missing concentration by existing conc at t=0 or t=tau (only if steady state has been reached) </td><td style="text-align: left;"> t=0,tau </td>
</tr>
<tr>
 <td style="text-align: left;">
   MDC-2 </td><td style="text-align: left;"> md </td><td style="text-align: left;"> impute missing concentration by interpolation </td><td style="text-align: left;"> t=tau,tstart,tend,teval </td>
</tr>
<tr>
 <td style="text-align: left;">
   MDC-3 </td><td style="text-align: left;"> md </td><td style="text-align: left;"> impute missing concentration by extrapolation </td><td style="text-align: left;"> t=tau,tend,teval </td>
</tr>
<tr>
 <td style="text-align: left;">
   MDC-4 </td><td style="text-align: left;"> md (IVB) </td><td style="text-align: left;"> impute missing concentration by back-extrapolation </td><td style="text-align: left;"> t=0 </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Value</h3>

<p>a dataset with missing concentrations imputed. The following variables are added:</p>

<table>
<tr>
 <td style="text-align: left;">
   <strong>Variable</strong> </td><td style="text-align: left;"> <strong>Description</strong> </td>
</tr>
<tr>
 <td style="text-align: left;">
   crule.nr </td><td style="text-align: left;"> correction rule number </td>
</tr>
<tr>
 <td style="text-align: left;">
   crule.txt </td><td style="text-align: left;"> text explaining what was altered </td>
</tr>
<tr>
 <td style="text-align: left;">
   applies.to.conc </td><td style="text-align: left;"> lists all critical time points to which the concentration correction rule applies </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Examples</h3>

<pre><code class='language-R'>
example(correct.time)
x %&lt;&gt;% mutate(ss = 'N', route = 'EV')
# route redefined for completeness
x %&lt;&gt;% correct.conc(by = 'subject') # ignoring th
x %&gt;% head

</code></pre>

<hr>
<h2 id='correct.loq'>Impute Concentrations Below the Limit of Quantitation</h2><span id='topic+correct.loq'></span>

<h3>Description</h3>

<p>Imputes LOQ values according to the chosen LOQ substitution rule.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>correct.loq(
  x,
  by = character(0),
  nomtimevar = "ntad",
  timevar = "time",
  depvar = "dv",
  bloqvar = "bloq",
  loqvar = "loq",
  loqrule = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="correct.loq_+3A_x">x</code></td>
<td>
<p>input dataset name contains all uncorrected data, including LOQ</p>
</td></tr>
<tr><td><code id="correct.loq_+3A_by">by</code></td>
<td>
<p>column names in x indicating grouping variables</p>
</td></tr>
<tr><td><code id="correct.loq_+3A_nomtimevar">nomtimevar</code></td>
<td>
<p>variable name containing the nominal sampling time after dose</p>
</td></tr>
<tr><td><code id="correct.loq_+3A_timevar">timevar</code></td>
<td>
<p>variable name containing the actual sampling time after dose</p>
</td></tr>
<tr><td><code id="correct.loq_+3A_depvar">depvar</code></td>
<td>
<p>variable name containing the dependent variable (e.g., concentration)</p>
</td></tr>
<tr><td><code id="correct.loq_+3A_bloqvar">bloqvar</code></td>
<td>
<p>variable name containing the BLOQ flag (0: no, 1: yes)</p>
</td></tr>
<tr><td><code id="correct.loq_+3A_loqvar">loqvar</code></td>
<td>
<p>variable name containing the LOQ value</p>
</td></tr>
<tr><td><code id="correct.loq_+3A_loqrule">loqrule</code></td>
<td>
<p>rule number to be applied to the LOQ values in the curve. x$loqrule overrides if provided
</p>

<ul>
<li><p> 1: 0 before first measurable concentration (FMC); NA after FMC
</p>
</li>
<li><p> 2: 0 before FMC; 0 after FMC
</p>
</li>
<li><p> 3: 0 before FMC; 0.5xLOQ for first consecutive LOQ after FMC, NA for other LOQ
</p>
</li>
<li><p> 4: 0 before FMC; 0.5xLOQ for first consecutive LOQ after FMC, 0 for other LOQ
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>Imputations will be applied to the original depvar (no new concentration
variable will be created).
</p>


<h3>Value</h3>

<p>A dataset with imputed BLOQ concentrations using the chosen imputation rule
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(magrittr)
library(dplyr)
library(qpNCA)
x &lt;- Theoph
ntad &lt;- c(0,0.25,0.5,1,2,4,5,7,9,12,24)
for(i in 1:nrow(x)){
  time  &lt;- x$Time[[i]]
  delta &lt;- abs(ntad - time)
  best  &lt;- min(delta)
  index &lt;- match(best, delta)
  nom   &lt;- ntad[[index]]
  x$ntad[[i]] &lt;- nom
}
rm(list = c('time','delta','best','index','nom', 'i','ntad'))
x %&lt;&gt;% rename(time = Time, dv = conc)
x %&lt;&gt;% mutate(bloq = ifelse(dv==0,1,0), loq = 0.01, tad = time, loqrule = 1, 
              subject=as.numeric(Subject), ntad=as.numeric(ntad))
x %&gt;% head
x %&lt;&gt;% correct.loq('subject')
x %&gt;%  head

</code></pre>

<hr>
<h2 id='correct.time'>Correct Concentrations for Time Deviations</h2><span id='topic+correct.time'></span>

<h3>Description</h3>

<p>Corrects concentrations at critical, but deviating time points
(e.g, predose, TAU, start and end of user selected AUC interval),
and adds missing records at these critical time points.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>correct.time(
  x,
  by = character(0),
  nomtimevar = "ntad",
  timevar = "time",
  depvar = "dv",
  tau = NA,
  tstart = NA,
  tend = NA,
  teval = NA,
  th = NA,
  reg = "SD",
  method = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="correct.time_+3A_x">x</code></td>
<td>
<p>input dataset name (after LOQ values have been imputed by <code><a href="#topic+correct.loq">correct.loq</a></code>)</p>
</td></tr>
<tr><td><code id="correct.time_+3A_by">by</code></td>
<td>
<p>column names in x indicating grouping variables</p>
</td></tr>
<tr><td><code id="correct.time_+3A_nomtimevar">nomtimevar</code></td>
<td>
<p>variable name containing the nominal sampling time after dose</p>
</td></tr>
<tr><td><code id="correct.time_+3A_timevar">timevar</code></td>
<td>
<p>variable name containing the actual sampling time after dose</p>
</td></tr>
<tr><td><code id="correct.time_+3A_depvar">depvar</code></td>
<td>
<p>variable name containing the dependent variable (e.g., concentration)</p>
</td></tr>
<tr><td><code id="correct.time_+3A_tau">tau</code></td>
<td>
<p>dosing interval (for multiple dosing); NA (default) if single dose; x$tau overrides</p>
</td></tr>
<tr><td><code id="correct.time_+3A_tstart">tstart</code></td>
<td>
<p>start time of partial AUC (start&gt;0); NA (default) if not requested; x$tstart overrides</p>
</td></tr>
<tr><td><code id="correct.time_+3A_tend">tend</code></td>
<td>
<p>end time of partial AUC; NA (default) if not requested; x$tend overrides</p>
</td></tr>
<tr><td><code id="correct.time_+3A_teval">teval</code></td>
<td>
<p>user selected AUC interval, starting at t=0; NA (default) if not requested; x$teval overrides</p>
</td></tr>
<tr><td><code id="correct.time_+3A_th">th</code></td>
<td>
<p>lamdba_z information for each curve; like output of <code><a href="#topic+est.thalf">est.thalf</a></code></p>
</td></tr>
<tr><td><code id="correct.time_+3A_reg">reg</code></td>
<td>
<p>regimen, &quot;sd&quot; or &quot;md&quot;; x$reg overrides</p>
</td></tr>
<tr><td><code id="correct.time_+3A_method">method</code></td>
<td>
<p>method for trapezoidal rule;  x$method overrides if provided
</p>

<ul>
<li><p> 1: linear up - linear down
</p>
</li>
<li><p> 2: linear up - logarithmic down
</p>
</li>
<li><p> 3: linear before first Tmax, logarithmic after first Tmax
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li><p> Records with missing NOMINAL time will be removed and this must be corrected before the function is called
</p>
</li>
<li><p> If a record at the critical time point is missing, add it and set time to nominal time and set dv conc to NA
</p>
</li>
<li><p> Use interpolation if there is a measurable concentration AFTER the nominal time point (i.e. sample is taken too late)
</p>
</li>
<li><p> Use extrapolation if there is NO measurable concentration AFTER the nominal time point (i.e. sample is taken too early)
</p>
</li>
<li><p> Set deviating time at predose after single dose to 0
</p>
</li>
<li><p> Original time and conc will be kept in original variables.
</p>
</li></ul>

<p>The following Time Deviation Correction Rules will be applied to critical time points (t = 0, tau, tstart, tend, teval), if needed:</p>

<table>
<tr>
 <td style="text-align: left;">
   <strong>Rule</strong> </td><td style="text-align: left;"> <strong>Regimen</strong> </td><td style="text-align: left;"> <strong>Description</strong> </td><td style="text-align: left;"> <strong>Applied to</strong> </td>
</tr>
<tr>
 <td style="text-align: left;">
   SDT-1 </td><td style="text-align: left;"> sd </td><td style="text-align: left;"> Set actual time to 0 </td><td style="text-align: left;"> t = 0 </td>
</tr>
<tr>
 <td style="text-align: left;">
   SDT-2 </td><td style="text-align: left;"> sd </td><td style="text-align: left;"> Correct concentration at deviating time by interpolation </td><td style="text-align: left;"> t = tau,tstart,tend,teval </td>
</tr>
<tr>
 <td style="text-align: left;">
   SDT-3 </td><td style="text-align: left;"> sd </td><td style="text-align: left;"> Correct concentration at deviating time by extrapolation </td><td style="text-align: left;"> t = tau,tend,teval </td>
</tr>
<tr>
 <td style="text-align: left;">
   MDT-1 </td><td style="text-align: left;"> md </td><td style="text-align: left;"> If predose sample taken after dosing, set actual time to 0 and conc to NA </td><td style="text-align: left;"> t = 0 </td>
</tr>
<tr>
 <td style="text-align: left;">
   MDT-2 </td><td style="text-align: left;"> md </td><td style="text-align: left;"> Correct concentration at deviating time by interpolation (too late) </td><td style="text-align: left;"> t = tau,tstart,tend,teval </td>
</tr>
<tr>
 <td style="text-align: left;">
   MDT-3 </td><td style="text-align: left;"> md </td><td style="text-align: left;"> Correct concentration at deviating time by extrapolation (too early) </td><td style="text-align: left;"> t = 0,tau,tend,teval </td>
</tr>
<tr>
 <td style="text-align: left;">
   MDT-3a </td><td style="text-align: left;"> md </td><td style="text-align: left;"> Set actual time to zero if concentration is BLOQ (too early) </td><td style="text-align: left;"> t = 0 </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Value</h3>

<p>a dataset with time deviation corrections applied (timevar and depvar adapted).
The following variables are added:</p>

<table>
<tr>
 <td style="text-align: left;">
   <strong>Variable</strong> </td><td style="text-align: left;"> <strong>Description</strong> </td>
</tr>
<tr>
 <td style="text-align: left;">
   create.nr </td><td style="text-align: left;"> is a missing record created? </td>
</tr>
<tr>
 <td style="text-align: left;">
   create.txt </td><td style="text-align: left;"> explanation of what is created </td>
</tr>
<tr>
 <td style="text-align: left;">
   trule.nr </td><td style="text-align: left;"> correction rule number </td>
</tr>
<tr>
 <td style="text-align: left;">
   trule.txt </td><td style="text-align: left;"> text explaining what was altered </td>
</tr>
<tr>
 <td style="text-align: left;">
   applies.to.time </td><td style="text-align: left;"> lists all critical time points to which the time deviation rule applies </td>
</tr>
<tr>
 <td style="text-align: left;">
   time.tau, conc.tau </td><td style="text-align: left;"> time and conc, corrected for AUCtau calculation </td>
</tr>
<tr>
 <td style="text-align: left;">
   time.teval, conc.teval </td><td style="text-align: left;"> time and conc, corrected for AUCteval calculation (AUC0-teval) </td>
</tr>
<tr>
 <td style="text-align: left;">
   time.part, conc.part </td><td style="text-align: left;"> time and conc, corrected for partial AUC calculation (AUCstart-end, start&gt;0) </td>
</tr>
<tr>
 <td style="text-align: left;">
   time.lastall, conc.lastall </td><td style="text-align: left;"> time and conc, corrected for AUClast and AUCall calculation </td>
</tr>
<tr>
 <td style="text-align: left;">
   t0.flag, tau.flag, tstart.flag, tend.flag, teval.flag </td><td style="text-align: left;"> flags for what timepoint the correction was needed </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>The following are preserved if present in x: tau, tstart, tend, teval, reg, ss, route, method.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
example(calc.ctmax)
x %&lt;&gt;% mutate(reg = 'SD', method = 1, route = 'EV')
# route not used yet, but still preserved
x %&lt;&gt;% correct.time(by = 'subject', th = th)
x %&gt;% head

</code></pre>

<hr>
<h2 id='est.thalf'>Calculate Lambda_z and Elimination Half-life</h2><span id='topic+est.thalf'></span>

<h3>Description</h3>

<p>Calculates lambda_z and thalf for each PK curve identified using <code>by</code>. <br />
</p>


<h3>Usage</h3>

<pre><code class='language-R'>est.thalf(
  x,
  by = character(0),
  timevar = "time",
  depvar = "dv",
  includeCmax = "Y",
  exclvar = NA
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="est.thalf_+3A_x">x</code></td>
<td>
<p>a dataset</p>
</td></tr>
<tr><td><code id="est.thalf_+3A_by">by</code></td>
<td>
<p>column names in x indicating grouping variables</p>
</td></tr>
<tr><td><code id="est.thalf_+3A_timevar">timevar</code></td>
<td>
<p>variable name containing the actual sampling time after dose</p>
</td></tr>
<tr><td><code id="est.thalf_+3A_depvar">depvar</code></td>
<td>
<p>variable name containing the dependent variable (e.g., concentration)</p>
</td></tr>
<tr><td><code id="est.thalf_+3A_includecmax">includeCmax</code></td>
<td>
<p>include results of regression including Cmax in selection? (y/n); x$includeCmax overrides if provided</p>
</td></tr>
<tr><td><code id="est.thalf_+3A_exclvar">exclvar</code></td>
<td>
<p>a variable name containing information about points to be excluded (these should have exclvar = 1)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function starts with the last three sample points and performs
log-linear regression on it. It then adds one sampling point at a time
(including and ending at tmax) and performs the regression again.
The results of the regression with the highest adjusted R-squared are returned. <br />
<br />
Visual outliers can be excluded from the regression analysis.
</p>


<h3>Value</h3>

<p>a dataset with estimates for each regression analysis in one observation.
The following parameters are available.
</p>

<ul>
<li> <p><strong>no.points</strong> number of data points used in the regression analysis
</p>
</li>
<li> <p><strong>intercept</strong> estimated intercept
</p>
</li>
<li> <p><strong>lambda_z</strong> -1*estimated slope
</p>
</li>
<li> <p><strong>r.squared</strong> square of the correlation coefficient
</p>
</li>
<li> <p><strong>adj.r.squared</strong> adjusted square of the correlation coefficient
</p>
</li>
<li> <p><strong>thalf</strong> elimination half-life
</p>
</li>
<li> <p><strong>start_th</strong> time of first sample included in the thalf estimation
</p>
</li>
<li> <p><strong>end_th time</strong> of last sample included in the thalf estimation
</p>
</li>
<li> <p><strong>includeCmax</strong> include results of regression including Cmax in selection? (y/n)
</p>
</li>
<li> <p><strong>points_excluded</strong> are time points excluded from the half-life estimation? (y/n)
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
example(correct.loq)
x %&lt;&gt;% mutate(includeCmax = 'Y')
th &lt;- x %&gt;% est.thalf(by='subject',exclvar=)
th %&gt;%  head

</code></pre>

<hr>
<h2 id='filenamefun'>Create File Name for Regression Plots</h2><span id='topic+filenamefun'></span>

<h3>Description</h3>

<p>Creates file name for regression plots (*.png) from by-variables in plot_reg function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>filenamefun(x, by)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="filenamefun_+3A_x">x</code></td>
<td>
<p>data.frame</p>
</td></tr>
<tr><td><code id="filenamefun_+3A_by">by</code></td>
<td>
<p>column names in x indicating grouping variables</p>
</td></tr>
</table>


<h3>Value</h3>

<p>character
</p>

<hr>
<h2 id='interpol'>Interpolate Concentrations</h2><span id='topic+interpol'></span>

<h3>Description</h3>

<p>Interpolates concentrations.
Used by correct.xx functions to interpolate concentrations.
Uses linear interpolation unless method is 2 (log down), c1 &gt; c2,
and both concentrations are non-zero.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>interpol(c1 = NA, c2 = NA, t1 = NA, t2 = NA, t3 = NA, method = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="interpol_+3A_c1">c1</code></td>
<td>
<p>concentration 1 lagconc</p>
</td></tr>
<tr><td><code id="interpol_+3A_c2">c2</code></td>
<td>
<p>concentration 2 leadconc</p>
</td></tr>
<tr><td><code id="interpol_+3A_t1">t1</code></td>
<td>
<p>time 1 tiem where conc should be calculated</p>
</td></tr>
<tr><td><code id="interpol_+3A_t2">t2</code></td>
<td>
<p>time 2 lagtime</p>
</td></tr>
<tr><td><code id="interpol_+3A_t3">t3</code></td>
<td>
<p>time 3 leadtime</p>
</td></tr>
<tr><td><code id="interpol_+3A_method">method</code></td>
<td>
<p>calculation method (1, 2, or 3)</p>
</td></tr>
</table>

<hr>
<h2 id='lag_lead'>Estimate Lagging and Leading Times and Concentrations</h2><span id='topic+lag_lead'></span>

<h3>Description</h3>

<p>Estimates lagging and leading times and concentrations.
Used by correct.xx functions to estimate lagging and leading timepoints
and concentrations for each timepoint.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lag_lead(
  x,
  nomtimevar1 = NA,
  depvar1 = NA,
  timevar1 = NA,
  lagc = NA,
  lagt = NA,
  leadc = NA,
  leadt = NA,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lag_lead_+3A_x">x</code></td>
<td>
<p>data.frame</p>
</td></tr>
<tr><td><code id="lag_lead_+3A_nomtimevar1">nomtimevar1</code></td>
<td>
<p>column name in x indicating nominal time after dose</p>
</td></tr>
<tr><td><code id="lag_lead_+3A_depvar1">depvar1</code></td>
<td>
<p>column name in x indicating concentration</p>
</td></tr>
<tr><td><code id="lag_lead_+3A_timevar1">timevar1</code></td>
<td>
<p>column name in x indicating actual time after dose</p>
</td></tr>
<tr><td><code id="lag_lead_+3A_lagc">lagc</code></td>
<td>
<p>concentration at previous sampling time</p>
</td></tr>
<tr><td><code id="lag_lead_+3A_lagt">lagt</code></td>
<td>
<p>previous sampling time</p>
</td></tr>
<tr><td><code id="lag_lead_+3A_leadc">leadc</code></td>
<td>
<p>concentration at next sampling time</p>
</td></tr>
<tr><td><code id="lag_lead_+3A_leadt">leadt</code></td>
<td>
<p>next sampling time</p>
</td></tr>
<tr><td><code id="lag_lead_+3A_...">...</code></td>
<td>
<p>ignored</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame
</p>

<hr>
<h2 id='plot_reg'>Plot Regression Curves</h2><span id='topic+plot_reg'></span>

<h3>Description</h3>

<p>Plots regression curves for each set of records defined using <code>by</code>.
A log-linear plot will be made for each curve.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_reg(
  x,
  by = character(0),
  th = NA,
  bloqvar = "bloq",
  timevar = "tad",
  depvar = "dv",
  timelab = "timevar",
  deplab = "depvar",
  exclvar = NA,
  plotdir = NA,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_reg_+3A_x">x</code></td>
<td>
<p>input dataset name</p>
</td></tr>
<tr><td><code id="plot_reg_+3A_by">by</code></td>
<td>
<p>column names in x indicating grouping variables</p>
</td></tr>
<tr><td><code id="plot_reg_+3A_th">th</code></td>
<td>
<p>file name of file with half-life estimation information for each curve</p>
</td></tr>
<tr><td><code id="plot_reg_+3A_bloqvar">bloqvar</code></td>
<td>
<p>variable name containing the BLOQ flag (0: no, 1: yes)</p>
</td></tr>
<tr><td><code id="plot_reg_+3A_timevar">timevar</code></td>
<td>
<p>variable name containing the actual sampling time after dose</p>
</td></tr>
<tr><td><code id="plot_reg_+3A_depvar">depvar</code></td>
<td>
<p>variable name containing the dependent variable (e.g., concentration)</p>
</td></tr>
<tr><td><code id="plot_reg_+3A_timelab">timelab</code></td>
<td>
<p>X-axis label (default: &quot;timevar&quot;)</p>
</td></tr>
<tr><td><code id="plot_reg_+3A_deplab">deplab</code></td>
<td>
<p>Y-axis label (default: &quot;depvar&quot;)</p>
</td></tr>
<tr><td><code id="plot_reg_+3A_exclvar">exclvar</code></td>
<td>
<p>variable name containing information about points to be excluded (these should have exclvar = 1)</p>
</td></tr>
<tr><td><code id="plot_reg_+3A_plotdir">plotdir</code></td>
<td>
<p>directory where individual plot files will be saved</p>
</td></tr>
<tr><td><code id="plot_reg_+3A_...">...</code></td>
<td>
<p>ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If elimination half-life was estimated for that curve,
the following will be indicated in the plot:
</p>

<ul>
<li><p> Cmax (Yellow, even if no half-life was estimated)
</p>
</li>
<li><p> points used in regression and resulting regression line (green)
</p>
</li>
<li><p> points excluded from regression (red crossed)
</p>
</li>
<li><p> estimate of elimination half-life and adjusted R-squared
</p>
</li></ul>

<p>Input dataset:
</p>

<ul>
<li><p> uncorrected dataset, used for half-life estimation
</p>
</li>
<li><p> dataset containing results of the half-life estimation
</p>
</li></ul>



<h3>Value</h3>

<p>(invisible) plotdir.  If the attribute 'plotdir' is empty, plots will be generated in standard output, otherwise plots will be saved as
PNG file in the designated directory.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
example(est.thalf)
x %&gt;% filter(dv &gt; 0) %&gt;% plot_reg(by = 'subject', th = th)

</code></pre>

<hr>
<h2 id='qpNCA'>Perform Non-compartmental Analysis</h2><span id='topic+qpNCA'></span>

<h3>Description</h3>

<p>Consecutively executes the following NCA steps:
</p>

<ul>
<li> <p><a href="#topic+correct.loq">correct.loq</a> impute LOQ values
</p>
</li>
<li> <p><a href="#topic+est.thalf">est.thalf</a> calculate lambda_z and half-life
</p>
</li>
<li> <p><a href="#topic+plot_reg">plot_reg</a> plot each regression curve
</p>
</li>
<li> <p><a href="#topic+calc.ctmax">calc.ctmax</a> calculate Cmax and Tmax
</p>
</li>
<li> <p><a href="#topic+correct.time">correct.time</a> correct time deviations at critical time points
</p>
</li>
<li> <p><a href="#topic+correct.conc">correct.conc</a> impute missing concentrations at critical time points
</p>
</li>
<li> <p><a href="#topic+tab.corr">tab.corr</a> tabulate data alterations
</p>
</li>
<li> <p><a href="#topic+calc.par">calc.par</a> calculates parameters not dependent on lambda_z
</p>
</li>
<li> <p><a href="#topic+calc.par.th">calc.par.th</a> calculates parameters dependent on lambda_z
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>qpNCA(
  x,
  by = character(0),
  nomtimevar = "ntad",
  timevar = "time",
  depvar = "dv",
  bloqvar = "bloq",
  loqvar = "loq",
  loqrule = 1,
  includeCmax = "Y",
  exclvar = NA,
  plotdir = NA,
  timelab = "timevar",
  deplab = "depvar",
  tau = NA,
  tstart = NA,
  tend = NA,
  teval = NA,
  covariates = NA,
  dose = "dose",
  factor = 1,
  reg = "SD",
  ss = "N",
  route = "EV",
  method = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="qpNCA_+3A_x">x</code></td>
<td>
<p>input dataset name</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_by">by</code></td>
<td>
<p>column names in x indicating grouping variables</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_nomtimevar">nomtimevar</code></td>
<td>
<p>variable name containing the nominal sampling time after dose</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_timevar">timevar</code></td>
<td>
<p>variable name containing the actual sampling time after dose</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_depvar">depvar</code></td>
<td>
<p>variable name containing the dependent variable (e.g., concentration)</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_bloqvar">bloqvar</code></td>
<td>
<p>variable name containing the BLOQ flag (0: no, 1: yes)</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_loqvar">loqvar</code></td>
<td>
<p>variable name containing the LOQ value</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_loqrule">loqrule</code></td>
<td>
<p>rule number to be applied to the LOQ values in the curve; x$loqrule overrides if provided</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_includecmax">includeCmax</code></td>
<td>
<p>include Cmax in half-life estimation? (y/n); x$includeCmax overrides if provided</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_exclvar">exclvar</code></td>
<td>
<p>variable name indicating points to be excluded in half-life estimation (these should have exclvar = 1)</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_plotdir">plotdir</code></td>
<td>
<p>directory where regression plots (.PNG) will be saved; NA gives default location, NULL skips regression plots</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_timelab">timelab</code></td>
<td>
<p>label for time axis in regression plots</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_deplab">deplab</code></td>
<td>
<p>label for dependent variable axis in regression plots</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_tau">tau</code></td>
<td>
<p>dosing interval (for multiple dosing); NA (default) if single dose; x$tau overrides</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_tstart">tstart</code></td>
<td>
<p>start time of partial AUC (start&gt;0); NA (default) if not requested; x$tstart overrides</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_tend">tend</code></td>
<td>
<p>end time of partial AUC; NA (default) if not requested; x$tend overrides</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_teval">teval</code></td>
<td>
<p>user selected AUC interval (starting at t=0); NA (default) if not requested; x$teval overrides</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_covariates">covariates</code></td>
<td>
<p>covariates dataset; Must contain the dose variable</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_dose">dose</code></td>
<td>
<p>variable containing the dose amount</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_factor">factor</code></td>
<td>
<p>conversion factor for CL and V calculation (e.g. dose in mg, conc in ng/mL, factor=1000); x$factor overrides if provided</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_reg">reg</code></td>
<td>
<p>regimen, &quot;SD&quot; or &quot;MD&quot;; x$reg overrides if provided</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_ss">ss</code></td>
<td>
<p>is steady state reached (y/n); x$ss overrides if provided</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_route">route</code></td>
<td>
<p>route of drug administration (&quot;EV&quot;,&quot;IVB&quot;, &quot;IVI&quot;); x$route overrides if provided</p>
</td></tr>
<tr><td><code id="qpNCA_+3A_method">method</code></td>
<td>
<p>method for trapezoidal rule; x$method overrides if provided
</p>

<ul>
<li><p> 1: linear up - linear down
</p>
</li>
<li><p> 2: linear up - logarithmic down
</p>
</li>
<li><p> 3: linear before first Tmax, logarithmic after first Tmax
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>(list)
</p>

<ul>
<li> <p><strong>covariates</strong> covariates selected with the <code>covariates</code> argument
</p>
</li>
<li> <p><strong>half_life</strong> linear regression parameters
</p>
</li>
<li> <p><strong>ct_corr</strong> the time and concentration corrected dataset
</p>
</li>
<li> <p><strong>corrections</strong> descriptions of the corrections applied
</p>
</li>
<li> <p><strong>pkpar</strong> all estimated PK parameters
</p>
</li>
<li> <p><strong>plots</strong> generated plots
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
library(magrittr)
library(dplyr)
library(qpNCA)
x &lt;- Theoph
ntad &lt;- c(0,0.25,0.5,1,2,4,5,7,9,12,24)
for(i in 1:nrow(x)){
  time  &lt;- x$Time[[i]]
  delta &lt;- abs(ntad - time)
  best  &lt;- min(delta)
  index &lt;- match(best, delta)
  nom   &lt;- ntad[[index]]
  x$ntad[[i]] &lt;- nom
}
rm(list = c('time','delta','best','index','nom', 'i','ntad'))
x %&lt;&gt;% rename(time = Time, dv = conc, subject = Subject)
x %&lt;&gt;% mutate(bloq = 0, loq = 0.01, tad = time,excl_th=0,
              subject=as.numeric(subject),ntad=as.numeric(ntad))
x %&lt;&gt;% filter(dv &gt; 0)
covs &lt;- x %&gt;%
  select(subject, Wt, dose = Dose) %&gt;%
  distinct(subject,.keep_all=TRUE) %&gt;%
  mutate(dose = dose * Wt) # see ?Theoph
z &lt;- qpNCA(x, by = 'subject', covariates = covs, exclvar='excl_th')

</code></pre>

<hr>
<h2 id='tab.corr'>Tabulate Corrections</h2><span id='topic+tab.corr'></span>

<h3>Description</h3>

<p>Tabulates what records were added, time deviations and
concentration imputations were applied, for each subject.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tab.corr(x, by = character(0), nomtimevar = "time")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tab.corr_+3A_x">x</code></td>
<td>
<p>concentration dataset created by the correct.time and correct.conc functions, containing time and conc corrected data</p>
</td></tr>
<tr><td><code id="tab.corr_+3A_by">by</code></td>
<td>
<p>column names in x indicating grouping variables</p>
</td></tr>
<tr><td><code id="tab.corr_+3A_nomtimevar">nomtimevar</code></td>
<td>
<p>column in x containing the nominal time after dose</p>
</td></tr>
</table>


<h3>Value</h3>

<p>dataset with applied corrections (rule number and rule text) listed by by-variable(s) and nominal time
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
example(correct.conc)
corrtab &lt;- x %&gt;% tab.corr(by = 'subject')
corrtab %&gt;% head

</code></pre>

<hr>
<h2 id='titlefun'>Create Title for Regression Plots</h2><span id='topic+titlefun'></span>

<h3>Description</h3>

<p>Creates title for regression plots in plot_reg() using by-variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>titlefun(x, by)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="titlefun_+3A_x">x</code></td>
<td>
<p>dataset containing concentration-time information of the current curve</p>
</td></tr>
<tr><td><code id="titlefun_+3A_by">by</code></td>
<td>
<p>column names in x indicating grouping variables</p>
</td></tr>
</table>


<h3>Value</h3>

<p>character
</p>

<hr>
<h2 id='trap'>Calculate Area Under the Curve Using Trapezoids</h2><span id='topic+trap'></span>

<h3>Description</h3>

<p>Calculates AUC using the trapezoidal method. Assumes data represent a single profile.
Despite choice of method, only linear interpolation is used
for areas of intervals beginning or ending with y: 0.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trap(x = NA, y = NA, method = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trap_+3A_x">x</code></td>
<td>
<p>x variable, i.e. time</p>
</td></tr>
<tr><td><code id="trap_+3A_y">y</code></td>
<td>
<p>y variable, i.e. concentration</p>
</td></tr>
<tr><td><code id="trap_+3A_method">method</code></td>
<td>
<p>method:
</p>

<ul>
<li><p> 1: linear up - linear down
</p>
</li>
<li><p> 2: linear up - logarithmic down
</p>
</li>
<li><p> 3: linear before Tmax, logarithmic after Tmax
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>area (length-one numeric)
</p>

<hr>
<h2 id='trapm'>Calculate Area Under the Moment Curve Using Trapezoids</h2><span id='topic+trapm'></span>

<h3>Description</h3>

<p>Calculates AUMC using the trapezoidal method.
Assumes data represent a single profile.
Despite choice of method, only linear interpolation is used
for areas of intervals beginning or ending with y: 0.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trapm(x = NA, y = NA, method = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trapm_+3A_x">x</code></td>
<td>
<p>variable names of x coordinates</p>
</td></tr>
<tr><td><code id="trapm_+3A_y">y</code></td>
<td>
<p>variable names of y coordinates</p>
</td></tr>
<tr><td><code id="trapm_+3A_method">method</code></td>
<td>
<p>method:
</p>

<ul>
<li><p> 1: linear up - linear down
</p>
</li>
<li><p> 2: linear up - logarithmic down
</p>
</li>
<li><p> 3: linear before Tmax, logarithmic after Tmax
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>area (length-one numeric)
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
