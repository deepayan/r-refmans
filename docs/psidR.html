<!DOCTYPE html><html lang="en"><head><title>Help for package psidR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {psidR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#psidR'><p>psidR</p></a></li>
<li><a href='#build.panel'><p>build.panel: Build PSID panel data set</p></a></li>
<li><a href='#build.psid'><p>Build example PSID</p></a></li>
<li><a href='#get.psid'><p>get.psid connects to PSID database and downloads into Rda</p></a></li>
<li><a href='#getNamesPSID'><p>GetPSID variables names from various years</p></a></li>
<li><a href='#make.char'><p>Convert factor to character</p></a></li>
<li><a href='#makeids'><p>ID list for mergeing PSID</p></a></li>
<li><a href='#medium.test.ind'><p>three year test, ind file</p></a></li>
<li><a href='#medium.test.ind.NA'><p>three year test, ind file and one NA variable</p></a></li>
<li><a href='#medium.test.ind.NA.wealth'><p>three year test, ind file and one NA variable and wealth</p></a></li>
<li><a href='#medium.test.noind'><p>three year test, no ind file</p></a></li>
<li><a href='#small.test.ind'><p>one year test, ind file</p></a></li>
<li><a href='#small.test.noind'><p>one year test, no ind file</p></a></li>
<li><a href='#testPSID'><p>Create a test PSID dataset</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Build Panel Data Sets from PSID Raw Data</td>
</tr>
<tr>
<td>Version:</td>
<td>2.3</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-11-05</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Florian Oswald &lt;florian.oswald@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Makes it easy to build panel data in wide format from Panel Survey
    of Income Dynamics (PSID) delivered raw data. Downloads data directly from
    the PSID server using the 'SAScii' package. 'psidR' takes care of merging
    data from each wave onto a cross-period index file, so that individuals can be
    followed over time. The user must specify which years they are interested in,
    and the 'PSID' variable names (e.g. ER21003) for each year (they differ in each
    year). The package offers helper functions to retrieve variable names from different
    waves. There are different panel data designs and sample subsetting criteria
    implemented ("SRC", "SEO", "immigrant" and "latino" samples). More information about 
    the PSID can be obtained at <a href="https://simba.isr.umich.edu/data/data.aspx">https://simba.isr.umich.edu/data/data.aspx</a>.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/floswald/psidR">https://github.com/floswald/psidR</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>data.table, RCurl, foreign, SAScii, openxlsx, futile.logger</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Collate:</td>
<td>'build.panel.r' 'makeids.r' 'psidR-package.r'</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-11-05 13:50:37 UTC; floswald</td>
</tr>
<tr>
<td>Author:</td>
<td>Florian Oswald [aut, cre]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-11-06 21:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='psidR'>psidR</h2><span id='topic+psidR-package'></span><span id='topic+psidR'></span>

<h3>Description</h3>

<p>psidR is a package that helps the task of building longitudinal datasets from the Panel Study of Income Dynamics (PSID). 
The user must supply the PSID variable names that correspond to the variables of interest in each desired wave. Data can be supplied via Stata, or directly downloaded from PSID servers without any need for STATA.
data.frame.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Florian Oswald <a href="mailto:florian.oswald@gmail.com">florian.oswald@gmail.com</a>
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/floswald/psidR">https://github.com/floswald/psidR</a>
</p>
</li></ul>


<hr>
<h2 id='build.panel'>build.panel: Build PSID panel data set</h2><span id='topic+build.panel'></span>

<h3>Description</h3>

<p>Builds a panel data set with id variables <code>pid</code> (unique person identifier) and <code>year</code> from individual PSID family files and supplemental wealth files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>build.panel(
  datadir = NULL,
  fam.vars,
  ind.vars = NULL,
  heads.only = FALSE,
  current.heads.only = FALSE,
  sample = NULL,
  design = "balanced",
  loglevel = INFO
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="build.panel_+3A_datadir">datadir</code></td>
<td>
<p>either <code>NULL</code>, in which case saves to tmpdir or path to directory containing family files (&quot;FAMyyyy.RData&quot;) and individual file (&quot;IND2009ER.RData&quot;).</p>
</td></tr>
<tr><td><code id="build.panel_+3A_fam.vars">fam.vars</code></td>
<td>
<p>data.frame of variable to retrieve from family files. Can contain see example for required format.</p>
</td></tr>
<tr><td><code id="build.panel_+3A_ind.vars">ind.vars</code></td>
<td>
<p>data.frame of variables to get from individual file. In almost all cases this will be the type of survey weights you want to use. don't include id variables ER30001 and ER30002.</p>
</td></tr>
<tr><td><code id="build.panel_+3A_heads.only">heads.only</code></td>
<td>
<p>logical TRUE if user wants household heads only. Household heads in sample year.</p>
</td></tr>
<tr><td><code id="build.panel_+3A_current.heads.only">current.heads.only</code></td>
<td>
<p>logical TRUE if user wants current household heads only. Distinguishes mover outs heads.</p>
</td></tr>
<tr><td><code id="build.panel_+3A_sample">sample</code></td>
<td>
<p>string indicating which sample to select: &quot;SRC&quot; (survey research center), &quot;SEO&quot; (survey for economic opportunity), &quot;immigrant&quot; (immigrant sample), &quot;latino&quot; (Latino family sample). Defaults to NULL, so no subsetting takes place.</p>
</td></tr>
<tr><td><code id="build.panel_+3A_design">design</code></td>
<td>
<p>either character <em>balanced</em> or <em>all</em> or integer. <em>balanced</em> means only individuals who appear in each wave are considered. <em>All</em> means all are taken. An integer value stands for minimum consecutive years of participation, i.e. design=3 means present in at least 3 consecutive waves.</p>
</td></tr>
<tr><td><code id="build.panel_+3A_loglevel">loglevel</code></td>
<td>
<p>one of INFO, WARN and DEBUG. INFO by default.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>There are several supported approches. Approach one downloads stata data, uses stata to build each wave, then puts it together with 'psidR'. The second (recommended) approach downloads all data directly from the psid servers (no Stata needed). For this approach you need to supply the precise names of psid variables - those variable names vary by year. E.g. <em>total family income</em> will have different names in different waves. The function <code><a href="#topic+getNamesPSID">getNamesPSID</a></code> greatly helps collecting names for all waves.
</p>


<h3>Value</h3>

<p>resulting <code>data.table</code>. the variable <code>pid</code> is the unique person identifier, constructed from ID1968 and pernum
</p>


<h3>Merging</h3>

<p>The variables <code>interview number</code> in each family file map to 
the <code>interview number</code> variable of a given year in the individual file. Run <code>example(build.panel)</code> for a demonstration.
</p>


<h3>Supplements</h3>

<p><em>Notice that support for wealth supplements is disabled!</em> Recent releases of the main family file have wealth data included. Earlier waves must be merged manually, again by variable <code>interview number</code> as above.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# ######################################
# reproducible example on artifical data. 
# run this with example(build.panel).
# ######################################

## make reproducible family data sets for 2 years
## variables are: family income (Money) and age

## Data acquisition step:
## run build.panel with sascii=TRUE

# testPSID creates artifical PSID data
td &lt;- testPSID(N=12,N.attr=0)
fam1985 &lt;- data.table::copy(td$famvars1985)
fam1986 &lt;- data.table::copy(td$famvars1986)
IND2019ER &lt;- data.table::copy(td$IND2019ER)

# create a temporary datadir
my.dir &lt;- tempdir()
#save those in the datadir
# notice different R formats admissible
save(fam1985,file=paste0(my.dir,"/FAM1985ER.rda"))
save(fam1986,file=paste0(my.dir,"/FAM1986ER.RData"))
save(IND2019ER,file=paste0(my.dir,"/IND2019ER.RData"))

## end Data acquisition step.

# now define which famvars
famvars &lt;- data.frame(year=c(1985,1986),
                      money=c("Money85","Money86"),
                      age=c("age85","age86"))

# create ind.vars
indvars &lt;- data.frame(year=c(1985,1986),ind.weight=c("ER30497","ER30534"))

# call the builder
# data will contain column "relation.head" holding the relationship code.

d &lt;- build.panel(datadir=my.dir,fam.vars=famvars,
                 ind.vars=indvars,
                 heads.only=FALSE)	

# see what happens if we drop non-heads
# only the ones who are heads in BOTH years 
# are present (since design='balanced' by default)
d &lt;- build.panel(datadir=my.dir,fam.vars=famvars,
                 ind.vars=indvars,
                 heads.only=TRUE)	
print(d[order(pid)],nrow=Inf)

# change sample design to "all": 
# we'll keep individuals if they are head in one year,
# and drop in the other
d &lt;- build.panel(datadir=my.dir,fam.vars=famvars,
                 ind.vars=indvars,heads.only=TRUE,
                 design="all")	
print(d[order(pid)],nrow=Inf)

file.remove(paste0(my.dir,"/FAM1985ER.rda"),
            paste0(my.dir,"/FAM1986ER.RData"),
            paste0(my.dir,"/IND2019ER.RData"))

# END psidR example

# #####################################################################
# Please go to https://github.com/floswald/psidR for more example usage
# #####################################################################
</code></pre>

<hr>
<h2 id='build.psid'>Build example PSID</h2><span id='topic+build.psid'></span>

<h3>Description</h3>

<p>Builds a panel from the full PSID dataset
</p>


<h3>Usage</h3>

<pre><code class='language-R'>build.psid(datadr = "~/datasets/psid/", small = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="build.psid_+3A_datadr">datadr</code></td>
<td>
<p>string of the data directory</p>
</td></tr>
<tr><td><code id="build.psid_+3A_small">small</code></td>
<td>
<p>logical TRUE if only use years 2013 and 2015.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data.table with panel data
</p>

<hr>
<h2 id='get.psid'>get.psid connects to PSID database and downloads into Rda</h2><span id='topic+get.psid'></span>

<h3>Description</h3>

<p>see <a href="https://asdfree.com/">https://asdfree.com/</a> for other usage and <a href="https://stackoverflow.com/questions/15853204/how-to-login-and-then-download-a-file-from-aspx-web-pages-with-r">https://stackoverflow.com/questions/15853204/how-to-login-and-then-download-a-file-from-aspx-web-pages-with-r</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.psid(file, name, params, curl)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get.psid_+3A_file">file</code></td>
<td>
<p>string psid file number</p>
</td></tr>
<tr><td><code id="get.psid_+3A_name">name</code></td>
<td>
<p>string of filename on disc</p>
</td></tr>
<tr><td><code id="get.psid_+3A_params">params</code></td>
<td>
<p>'postForm' (RCurl) parameters</p>
</td></tr>
<tr><td><code id="get.psid_+3A_curl">curl</code></td>
<td>
<p>'postForm' (RCurl) curl handle</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Anthony Damico &lt;ajdamico@gmail.com&gt;
</p>

<hr>
<h2 id='getNamesPSID'>GetPSID variables names from various years</h2><span id='topic+getNamesPSID'></span>

<h3>Description</h3>

<p>The user can specify one variable name from any year. This function
will find that variable's correct name in any of the years
specified by the user. If user does not specify the <code>years</code>
variable, return will represent all years in which variable was
present.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getNamesPSID(aname, cwf, years = NULL, file = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="getNamesPSID_+3A_aname">aname</code></td>
<td>
<p>A variable name in any of the PSID years</p>
</td></tr>
<tr><td><code id="getNamesPSID_+3A_cwf">cwf</code></td>
<td>
<p>A data.frame representation of the cross-walk file,
(the psid.xlsx file).</p>
</td></tr>
<tr><td><code id="getNamesPSID_+3A_years">years</code></td>
<td>
<p>A vector of years. If NULL, all years in which that
variable existed are returned</p>
</td></tr>
<tr><td><code id="getNamesPSID_+3A_file">file</code></td>
<td>
<p>optional file name to write csv</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This uses the psid.xlsx crosswalk file from UMich, which is
available at http://psidonline.isr.umich.edu/help/xyr/psid.xlsx. In the 
example, the package openxlsx's read.xlsx is used to import the crosswalk
file.
</p>
<p>Ask for one variable at a time.
</p>


<h3>Value</h3>

<p>A vector of names, one for each year.
</p>


<h3>Author(s)</h3>

<p>Paul Johnson &lt;pauljohn@ku.edu&gt; and Florian Oswald
</p>


<h3>Examples</h3>

<pre><code class='language-R'># read UMich crosswalk from installed file
r = system.file(package="psidR")
cwf = openxlsx::read.xlsx(file.path(r,"psid-lists","psid.xlsx"))

# or download directly
# cwf &lt;- read.xlsx("http://psidonline.isr.umich.edu/help/xyr/psid.xlsx")

# then get names with
getNamesPSID("ER17013", cwf, years = 2001)
getNamesPSID("ER17013", cwf, years = 2003)
getNamesPSID("ER17013", cwf, years = NULL)
getNamesPSID("ER17013", cwf, years = c(2005, 2007, 2009))
</code></pre>

<hr>
<h2 id='make.char'>Convert factor to character</h2><span id='topic+make.char'></span>

<h3>Description</h3>

<p>helper function to convert factor to character in a data.table
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make.char(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="make.char_+3A_x">x</code></td>
<td>
<p>a <code>factor</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a character
</p>

<hr>
<h2 id='makeids'>ID list for mergeing PSID</h2><span id='topic+makeids'></span>

<h3>Description</h3>

<p>this list is taken from http://ideas.repec.org/c/boc/bocode/s457040.html
</p>


<h3>Usage</h3>

<pre><code class='language-R'>makeids()
</code></pre>


<h3>Details</h3>

<p>this function hardcodes the PSID variable names of &quot;interview number&quot; from both family and individual file for each wave, as well as &quot;sequence number&quot;, &quot;relation to head&quot; and numeric value x of that variable such that &quot;relation to head&quot; == x means the individual is the head. Varies over time.
</p>

<hr>
<h2 id='medium.test.ind'>three year test, ind file</h2><span id='topic+medium.test.ind'></span>

<h3>Description</h3>

<p>three year test, ind file
</p>


<h3>Usage</h3>

<pre><code class='language-R'>medium.test.ind(dd = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="medium.test.ind_+3A_dd">dd</code></td>
<td>
<p>Data Dictionary location. If NULL, 
use temp dir and force download</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects
</p>

<hr>
<h2 id='medium.test.ind.NA'>three year test, ind file and one NA variable</h2><span id='topic+medium.test.ind.NA'></span>

<h3>Description</h3>

<p>three year test, ind file and one NA variable
</p>


<h3>Usage</h3>

<pre><code class='language-R'>medium.test.ind.NA(dd = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="medium.test.ind.NA_+3A_dd">dd</code></td>
<td>
<p>Data Dictionary location. If NULL, 
use temp dir and force download</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects
</p>

<hr>
<h2 id='medium.test.ind.NA.wealth'>three year test, ind file and one NA variable and wealth</h2><span id='topic+medium.test.ind.NA.wealth'></span>

<h3>Description</h3>

<p>three year test, ind file and one NA variable and wealth
</p>


<h3>Usage</h3>

<pre><code class='language-R'>medium.test.ind.NA.wealth(dd = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="medium.test.ind.NA.wealth_+3A_dd">dd</code></td>
<td>
<p>Data Dictionary location. If NULL, 
use temp dir and force download</p>
</td></tr>
</table>


<h3>Value</h3>

<p>description No return value, called for side effects
</p>

<hr>
<h2 id='medium.test.noind'>three year test, no ind file</h2><span id='topic+medium.test.noind'></span>

<h3>Description</h3>

<p>three year test, no ind file
</p>


<h3>Usage</h3>

<pre><code class='language-R'>medium.test.noind(dd = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="medium.test.noind_+3A_dd">dd</code></td>
<td>
<p>Data Dictionary location</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects
</p>

<hr>
<h2 id='small.test.ind'>one year test, ind file</h2><span id='topic+small.test.ind'></span>

<h3>Description</h3>

<p>one year test, ind file
</p>


<h3>Usage</h3>

<pre><code class='language-R'>small.test.ind(dd = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="small.test.ind_+3A_dd">dd</code></td>
<td>
<p>Data Dictionary location. If NULL, 
use temp dir and force download</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects
</p>

<hr>
<h2 id='small.test.noind'>one year test, no ind file</h2><span id='topic+small.test.noind'></span>

<h3>Description</h3>

<p>one year test, no ind file
</p>


<h3>Usage</h3>

<pre><code class='language-R'>small.test.noind(dd = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="small.test.noind_+3A_dd">dd</code></td>
<td>
<p>Data Dictionary location. If NULL, 
use temp dir and force download</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects
</p>

<hr>
<h2 id='testPSID'>Create a test PSID dataset</h2><span id='topic+testPSID'></span>

<h3>Description</h3>

<p>makes artifical PSID data with variables <code>age</code> and <code>income</code>
for two consecutive years 1985 and 1986.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>testPSID(N = 100, N.attr = 0)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="testPSID_+3A_n">N</code></td>
<td>
<p>number of people in each wave</p>
</td></tr>
<tr><td><code id="testPSID_+3A_n.attr">N.attr</code></td>
<td>
<p>number of people lost to attrition</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with (fake) individual index file IND2009ER and
family files for 1985 and 1986
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
