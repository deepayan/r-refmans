<!DOCTYPE html><html lang="en-US"><head><title>Help for package FLORAL</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {FLORAL}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#a.FLORAL'><p>Comparing prediction performances under different choices of weights for lasso/ridge penalty</p></a></li>
<li><a href='#FLORAL'><p>Fit Log-ratio lasso regression for compositional covariates</p></a></li>
<li><a href='#mcv.FLORAL'><p>Summarizing selected compositional features over multiple cross validations</p></a></li>
<li><a href='#phy_to_floral_data'><p>Create data input list from phyloseq object</p></a></li>
<li><a href='#simu'><p>Simulate data following log-ratio model</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Fit Log-Ratio Lasso Regression for Compositional Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.4.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2025-02-16</td>
</tr>
<tr>
<td>Description:</td>
<td>Log-ratio Lasso regression for continuous, binary, and survival outcomes with (longitudinal) compositional features. See Fei and others (2024) &lt;<a href="https://doi.org/10.1016%2Fj.crmeth.2024.100899">doi:10.1016/j.crmeth.2024.100899</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://vdblab.github.io/FLORAL/">https://vdblab.github.io/FLORAL/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/vdblab/FLORAL/issues">https://github.com/vdblab/FLORAL/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>C++17</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp (&ge; 1.0.9), stats, survival, ggplot2, survcomp, reshape,
dplyr, glmnet, caret, grDevices, utils, mvtnorm, doParallel,
doRNG, foreach, msm, phyloseq</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo, RcppProgress, ast2ast</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, knitr, rmarkdown, spelling, testthat (&ge; 3.0.0),
patchwork, tidyverse</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-02-17 04:18:28 UTC; feit1</td>
</tr>
<tr>
<td>Author:</td>
<td>Teng Fei <a href="https://orcid.org/0000-0001-7888-1715"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre, cph],
  Tyler Funnell <a href="https://orcid.org/0000-0003-1612-5644"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Nicholas Waters <a href="https://orcid.org/0000-0002-9035-2143"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Sandeep Raj <a href="https://orcid.org/0000-0003-4629-0528"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Teng Fei &lt;feit1@mskcc.org&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-02-17 07:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='a.FLORAL'>Comparing prediction performances under different choices of weights for lasso/ridge penalty</h2><span id='topic+a.FLORAL'></span>

<h3>Description</h3>

<p>Summarizing <code>FLORAL</code> outputs from various choices of <code>a</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>a.FLORAL(
  a = c(0.1, 0.5, 1),
  ncore = 1,
  seed = NULL,
  x,
  y,
  ncov = 0,
  family = "gaussian",
  longitudinal = FALSE,
  id = NULL,
  tobs = NULL,
  failcode = NULL,
  corstr = "exchangeable",
  scalefix = FALSE,
  scalevalue = 1,
  pseudo = 1,
  length.lambda = 100,
  lambda.min.ratio = NULL,
  ncov.lambda.weight = 0,
  mu = 1,
  pfilter = 0,
  maxiter = 100,
  ncv = 5,
  intercept = FALSE,
  step2 = FALSE,
  progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="a.FLORAL_+3A_a">a</code></td>
<td>
<p>vector of scalars between 0 and 1 for comparison.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_ncore">ncore</code></td>
<td>
<p>Number of cores used for parallel computation. Default is to use only 1 core.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_seed">seed</code></td>
<td>
<p>A random seed for reproducibility of the results. By default the seed is the numeric form of <code>Sys.Date()</code>.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_x">x</code></td>
<td>
<p>Feature matrix, where rows specify subjects and columns specify features. The first <code>ncov</code> columns should be patient characteristics and the rest columns are microbiome absolute counts corresponding to various taxa. If <code>x</code> contains longitudinal data, the rows must be sorted in the same order of the subject IDs used in <code>y</code>.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_y">y</code></td>
<td>
<p>Outcome. For a continuous or binary outcome, <code>y</code> is a vector. For survival outcome, <code>y</code> is a <code>Surv</code> object.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_ncov">ncov</code></td>
<td>
<p>An integer indicating the number of first <code>ncov</code> columns in <code>x</code> that will not be subject to the zero-sum constraint.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_family">family</code></td>
<td>
<p>Available options are <code>gaussian</code>, <code>binomial</code>, <code>cox</code>, <code>finegray</code>.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_longitudinal">longitudinal</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>, indicating whether longitudinal data matrix is specified for input <code>x</code>. (<code>Longitudinal=TRUE</code> and <code>family="cox"</code> or <code>"finegray"</code> will fit a time-dependent covariate model. <code>Longitudinal=TRUE</code> and <code>family="gaussian"</code> or <code>"binomial"</code> will fit a GEE model.)</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_id">id</code></td>
<td>
<p>If <code>longitudinal</code> is <code>TRUE</code>, <code>id</code> specifies subject IDs corresponding to the rows of input <code>x</code>.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_tobs">tobs</code></td>
<td>
<p>If <code>longitudinal</code> is <code>TRUE</code>, <code>tobs</code> specifies time points corresponding to the rows of input <code>x</code>.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_failcode">failcode</code></td>
<td>
<p>If <code>family = finegray</code>, <code>failcode</code> specifies the failure type of interest. This must be a positive integer.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_corstr">corstr</code></td>
<td>
<p>If a GEE model is specified, then <code>corstr</code> is the corresponding working correlation structure. Options are <code>independence</code>, <code>exchangeable</code>, <code>AR-1</code> and <code>unstructured</code>.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_scalefix">scalefix</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>, indicating whether the scale parameter is estimated or fixed if a GEE model is specified.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_scalevalue">scalevalue</code></td>
<td>
<p>Specify the scale parameter if <code>scalefix=TRUE</code>.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_pseudo">pseudo</code></td>
<td>
<p>Pseudo count to be added to <code>x</code> before taking log-transformation</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_length.lambda">length.lambda</code></td>
<td>
<p>Number of penalty parameters used in the path</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_lambda.min.ratio">lambda.min.ratio</code></td>
<td>
<p>Ratio between the minimum and maximum choice of lambda. Default is <code>NULL</code>, where the ratio is chosen as 1e-2.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_ncov.lambda.weight">ncov.lambda.weight</code></td>
<td>
<p>Weight of the penalty lambda applied to the first <code>ncov</code> covariates. Default is 0 such that the first <code>ncov</code> covariates are not penalized.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_mu">mu</code></td>
<td>
<p>Value of penalty for the augmented Lagrangian</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_pfilter">pfilter</code></td>
<td>
<p>A pre-specified threshold to force coefficients with absolute values less than pfilter times the maximum value of absolute coefficient as zeros in the GEE model. Default is zero, such that all coefficients will be reported.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_maxiter">maxiter</code></td>
<td>
<p>Number of iterations needed for the outer loop of the augmented Lagrangian algorithm.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_ncv">ncv</code></td>
<td>
<p>Folds of cross-validation. Use <code>NULL</code> if cross-validation is not wanted.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_intercept">intercept</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>, indicating whether an intercept should be estimated.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_step2">step2</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>, indicating whether a second-stage feature selection for specific ratios should be performed for the features selected by the main lasso algorithm. Will only be performed if cross validation is enabled.</p>
</td></tr>
<tr><td><code id="a.FLORAL_+3A_progress">progress</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>, indicating whether printing progress bar as the algorithm runs.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot2</code> object of cross-validated prediction metric versus <code>lambda</code>, stratified by <code>a</code>. Detailed data can be retrieved from the <code>ggplot2</code> object itself.
</p>


<h3>Author(s)</h3>

<p>Teng Fei. Email: feit1@mskcc.org
</p>


<h3>References</h3>

<p>Fei T, Funnell T, Waters N, Raj SS et al. Scalable Log-ratio Lasso Regression Enhances Microbiome Feature Selection for Predictive Models. bioRxiv 2023.05.02.538599.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(23420)

dat &lt;- simu(n=50,p=30,model="linear")
pmetric &lt;- a.FLORAL(a=c(0.1,1),ncore=1,x=dat$xcount,y=dat$y,family="gaussian",ncv=2,progress=FALSE)

</code></pre>

<hr>
<h2 id='FLORAL'>Fit Log-ratio lasso regression for compositional covariates</h2><span id='topic+FLORAL'></span>

<h3>Description</h3>

<p>Conduct log-ratio lasso regression for continuous, binary and survival outcomes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>FLORAL(
  x,
  y,
  ncov = 0,
  family = "gaussian",
  longitudinal = FALSE,
  id = NULL,
  tobs = NULL,
  failcode = NULL,
  corstr = "exchangeable",
  scalefix = FALSE,
  scalevalue = 1,
  pseudo = 1,
  length.lambda = 100,
  lambda.min.ratio = NULL,
  ncov.lambda.weight = 0,
  a = 1,
  mu = 1,
  pfilter = 0,
  maxiter = 100,
  ncv = 5,
  ncore = 1,
  intercept = FALSE,
  foldid = NULL,
  step2 = TRUE,
  progress = TRUE,
  plot = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="FLORAL_+3A_x">x</code></td>
<td>
<p>Feature matrix, where rows specify subjects and columns specify features. The first <code>ncov</code> columns should be patient characteristics and the rest columns are microbiome absolute counts corresponding to various taxa. If <code>x</code> contains longitudinal data, the rows must be sorted in the same order of the subject IDs used in <code>y</code>.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_y">y</code></td>
<td>
<p>Outcome. For a continuous or binary outcome, <code>y</code> is a vector. For survival outcome, <code>y</code> is a <code>Surv</code> object.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_ncov">ncov</code></td>
<td>
<p>An integer indicating the number of first <code>ncov</code> columns in <code>x</code> that will not be subject to the zero-sum constraint.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_family">family</code></td>
<td>
<p>Available options are <code>gaussian</code>, <code>binomial</code>, <code>cox</code>, <code>finegray</code>.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_longitudinal">longitudinal</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>, indicating whether longitudinal data matrix is specified for input <code>x</code>. (<code>Longitudinal=TRUE</code> and <code>family="cox"</code> or <code>"finegray"</code> will fit a time-dependent covariate model. <code>Longitudinal=TRUE</code> and <code>family="gaussian"</code> or <code>"binomial"</code> will fit a GEE model.)</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_id">id</code></td>
<td>
<p>If <code>longitudinal</code> is <code>TRUE</code>, <code>id</code> specifies subject IDs corresponding to the rows of input <code>x</code>.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_tobs">tobs</code></td>
<td>
<p>If <code>longitudinal</code> is <code>TRUE</code>, <code>tobs</code> specifies time points corresponding to the rows of input <code>x</code>.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_failcode">failcode</code></td>
<td>
<p>If <code>family = finegray</code>, <code>failcode</code> specifies the failure type of interest. This must be a positive integer.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_corstr">corstr</code></td>
<td>
<p>If a GEE model is specified, then <code>corstr</code> is the corresponding working correlation structure. Options are <code>independence</code>, <code>exchangeable</code>, <code>AR-1</code> and <code>unstructured</code>.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_scalefix">scalefix</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>, indicating whether the scale parameter is estimated or fixed if a GEE model is specified.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_scalevalue">scalevalue</code></td>
<td>
<p>Specify the scale parameter if <code>scalefix=TRUE</code>.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_pseudo">pseudo</code></td>
<td>
<p>Pseudo count to be added to <code>x</code> before taking log-transformation. If unspecified, then the log-transformation will not be performed.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_length.lambda">length.lambda</code></td>
<td>
<p>Number of penalty parameters used in the path</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_lambda.min.ratio">lambda.min.ratio</code></td>
<td>
<p>Ratio between the minimum and maximum choice of lambda. Default is <code>NULL</code>, where the ratio is chosen as 1e-2.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_ncov.lambda.weight">ncov.lambda.weight</code></td>
<td>
<p>Weight of the penalty lambda applied to the first <code>ncov</code> covariates. Default is 0 such that the first <code>ncov</code> covariates are not penalized.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_a">a</code></td>
<td>
<p>A scalar between 0 and 1: <code>a</code> is the weight for lasso penalty while <code>1-a</code> is the weight for ridge penalty.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_mu">mu</code></td>
<td>
<p>Value of penalty for the augmented Lagrangian</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_pfilter">pfilter</code></td>
<td>
<p>A pre-specified threshold to force coefficients with absolute values less than pfilter times the maximum value of absolute coefficient as zeros in the GEE model. Default is zero, such that all coefficients will be reported.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_maxiter">maxiter</code></td>
<td>
<p>Number of iterations needed for the outer loop of the augmented Lagrangian algorithm.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_ncv">ncv</code></td>
<td>
<p>Folds of cross-validation. Use <code>NULL</code> if cross-validation is not wanted.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_ncore">ncore</code></td>
<td>
<p>Number of cores for parallel computing for cross-validation. Default is 1.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_intercept">intercept</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>, indicating whether an intercept should be estimated.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_foldid">foldid</code></td>
<td>
<p>A vector of fold indicator. Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_step2">step2</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>, indicating whether a second-stage feature selection for specific ratios should be performed for the features selected by the main lasso algorithm. Will only be performed if cross validation is enabled.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_progress">progress</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>, indicating whether printing progress bar as the algorithm runs.</p>
</td></tr>
<tr><td><code id="FLORAL_+3A_plot">plot</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>, indicating whether returning plots of model fitting.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with path-specific estimates (beta), path (lambda), and others. Details can be found in <code>README.md</code>.
</p>


<h3>Author(s)</h3>

<p>Teng Fei. Email: feit1@mskcc.org
</p>


<h3>References</h3>

<p>Fei T, Funnell T, Waters N, Raj SS et al. Enhanced Feature Selection for Microbiome Data using FLORAL: Scalable Log-ratio Lasso Regression bioRxiv 2023.05.02.538599.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(23420)

# Continuous outcome
dat &lt;- simu(n=50,p=30,model="linear")
fit &lt;- FLORAL(dat$xcount,dat$y,family="gaussian",ncv=2,progress=FALSE,step2=TRUE)

# Binary outcome
# dat &lt;- simu(n=50,p=30,model="binomial")
# fit &lt;- FLORAL(dat$xcount,dat$y,family="binomial",progress=FALSE,step2=TRUE)

# Survival outcome
# dat &lt;- simu(n=50,p=30,model="cox")
# fit &lt;- FLORAL(dat$xcount,survival::Surv(dat$t,dat$d),family="cox",progress=FALSE,step2=TRUE)

# Competing risks outcome
# dat &lt;- simu(n=50,p=30,model="finegray")
# fit &lt;- FLORAL(dat$xcount,survival::Surv(dat$t,dat$d,type="mstate"),failcode=1,
#               family="finegray",progress=FALSE,step2=FALSE)

# Longitudinal continuous outcome
#  dat &lt;- simu(n=50,p=30,model="gee",geetype="gaussian",m=3,corstr="exchangeable",sdvec=rep(1,3))
#  fit &lt;- FLORAL(x=cbind(dat$tvec, dat$xcount),y=dat$y,id=dat$id,family="gaussian",
#                ncov=1,longitudinal = TRUE,corstr = "exchangeable",lambda.min.ratio=1e-3,
#                progress=FALSE,step2=FALSE)

</code></pre>

<hr>
<h2 id='mcv.FLORAL'>Summarizing selected compositional features over multiple cross validations</h2><span id='topic+mcv.FLORAL'></span>

<h3>Description</h3>

<p>Summarizing <code>FLORAL</code> outputs from multiple random k-fold cross validations
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mcv.FLORAL(
  mcv = 10,
  ncore = 1,
  seed = NULL,
  x,
  y,
  ncov = 0,
  family = "gaussian",
  longitudinal = FALSE,
  id = NULL,
  tobs = NULL,
  failcode = NULL,
  corstr = "exchangeable",
  scalefix = FALSE,
  scalevalue = 1,
  pseudo = 1,
  length.lambda = 100,
  lambda.min.ratio = NULL,
  ncov.lambda.weight = 0,
  a = 1,
  mu = 1,
  pfilter = 0,
  maxiter = 100,
  ncv = 5,
  intercept = FALSE,
  step2 = TRUE,
  progress = TRUE,
  plot = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mcv.FLORAL_+3A_mcv">mcv</code></td>
<td>
<p>Number of random 'ncv'-fold cross-validation to be performed.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_ncore">ncore</code></td>
<td>
<p>Number of cores used for parallel computation. Default is to use only 1 core.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_seed">seed</code></td>
<td>
<p>A random seed for reproducibility of the results. By default the seed is the numeric form of <code>Sys.Date()</code>.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_x">x</code></td>
<td>
<p>Feature matrix, where rows specify subjects and columns specify features. The first <code>ncov</code> columns should be patient characteristics and the rest columns are microbiome absolute counts corresponding to various taxa. If <code>x</code> contains longitudinal data, the rows must be sorted in the same order of the subject IDs used in <code>y</code>.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_y">y</code></td>
<td>
<p>Outcome. For a continuous or binary outcome, <code>y</code> is a vector. For survival outcome, <code>y</code> is a <code>Surv</code> object.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_ncov">ncov</code></td>
<td>
<p>An integer indicating the number of first <code>ncov</code> columns in <code>x</code> that will not be subject to the zero-sum constraint.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_family">family</code></td>
<td>
<p>Available options are <code>gaussian</code>, <code>binomial</code>, <code>cox</code>, <code>finegray</code>.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_longitudinal">longitudinal</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>, indicating whether longitudinal data matrix is specified for input <code>x</code>. (<code>Longitudinal=TRUE</code> and <code>family="cox"</code> or <code>"finegray"</code> will fit a time-dependent covariate model. <code>Longitudinal=TRUE</code> and <code>family="gaussian"</code> or <code>"binomial"</code> will fit a GEE model.)</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_id">id</code></td>
<td>
<p>If <code>longitudinal</code> is <code>TRUE</code>, <code>id</code> specifies subject IDs corresponding to the rows of input <code>x</code>.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_tobs">tobs</code></td>
<td>
<p>If <code>longitudinal</code> is <code>TRUE</code>, <code>tobs</code> specifies time points corresponding to the rows of input <code>x</code>.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_failcode">failcode</code></td>
<td>
<p>If <code>family = finegray</code>, <code>failcode</code> specifies the failure type of interest. This must be a positive integer.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_corstr">corstr</code></td>
<td>
<p>If a GEE model is specified, then <code>corstr</code> is the corresponding working correlation structure. Options are <code>independence</code>, <code>exchangeable</code>, <code>AR-1</code> and <code>unstructured</code>.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_scalefix">scalefix</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>, indicating whether the scale parameter is estimated or fixed if a GEE model is specified.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_scalevalue">scalevalue</code></td>
<td>
<p>Specify the scale parameter if <code>scalefix=TRUE</code>.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_pseudo">pseudo</code></td>
<td>
<p>Pseudo count to be added to <code>x</code> before taking log-transformation</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_length.lambda">length.lambda</code></td>
<td>
<p>Number of penalty parameters used in the path</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_lambda.min.ratio">lambda.min.ratio</code></td>
<td>
<p>Ratio between the minimum and maximum choice of lambda. Default is <code>NULL</code>, where the ratio is chosen as 1e-2.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_ncov.lambda.weight">ncov.lambda.weight</code></td>
<td>
<p>Weight of the penalty lambda applied to the first <code>ncov</code> covariates. Default is 0 such that the first <code>ncov</code> covariates are not penalized.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_a">a</code></td>
<td>
<p>A scalar between 0 and 1: <code>a</code> is the weight for lasso penalty while <code>1-a</code> is the weight for ridge penalty.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_mu">mu</code></td>
<td>
<p>Value of penalty for the augmented Lagrangian</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_pfilter">pfilter</code></td>
<td>
<p>A pre-specified threshold to force coefficients with absolute values less than pfilter times the maximum value of absolute coefficient as zeros in the GEE model. Default is zero, such that all coefficients will be reported.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_maxiter">maxiter</code></td>
<td>
<p>Number of iterations needed for the outer loop of the augmented Lagrangian algorithm.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_ncv">ncv</code></td>
<td>
<p>Folds of cross-validation. Use <code>NULL</code> if cross-validation is not wanted.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_intercept">intercept</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>, indicating whether an intercept should be estimated.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_step2">step2</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>, indicating whether a second-stage feature selection for specific ratios should be performed for the features selected by the main lasso algorithm. Will only be performed if cross validation is enabled.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_progress">progress</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>, indicating whether printing progress bar as the algorithm runs.</p>
</td></tr>
<tr><td><code id="mcv.FLORAL_+3A_plot">plot</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>, indicating whether returning summary plots of selection probability for taxa features.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with relative frequencies of a certain feature being selected over <code>mcv</code> <code>ncv</code>-fold cross-validations.
</p>


<h3>Author(s)</h3>

<p>Teng Fei. Email: feit1@mskcc.org
</p>


<h3>References</h3>

<p>Fei T, Funnell T, Waters N, Raj SS et al. Scalable Log-ratio Lasso Regression Enhances Microbiome Feature Selection for Predictive Models. bioRxiv 2023.05.02.538599.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(23420)

dat &lt;- simu(n=50,p=30,model="linear")
fit &lt;- mcv.FLORAL(mcv=2,ncore=1,x=dat$xcount,y=dat$y,ncv=2,progress=FALSE,step2=TRUE,plot=FALSE)

</code></pre>

<hr>
<h2 id='phy_to_floral_data'>Create data input list from phyloseq object</h2><span id='topic+phy_to_floral_data'></span>

<h3>Description</h3>

<p>Create data input list from phyloseq object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phy_to_floral_data(phy, y = NULL, covariates = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phy_to_floral_data_+3A_phy">phy</code></td>
<td>
<p>Phyloseq object</p>
</td></tr>
<tr><td><code id="phy_to_floral_data_+3A_y">y</code></td>
<td>
<p>Outcome column of interest from phy's sample_data</p>
</td></tr>
<tr><td><code id="phy_to_floral_data_+3A_covariates">covariates</code></td>
<td>
<p>Covariate column names from phy's sample_data</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(phyloseq)
data(GlobalPatterns)
# add a covariate
sample_data(GlobalPatterns)$test &lt;- rep(c(1, 0), nsamples(GlobalPatterns)/2)
# GlobalPatterns &lt;- tax_glom(GlobalPatterns, "Phylum")
dat &lt;- phy_to_floral_data(GlobalPatterns, y = "test", covariates = c("SampleType"))
# res &lt;- FLORAL(x = dat$xcount, y=dat$y, ncov=dat$ncov, family = "binomial", ncv=NULL)

</code></pre>

<hr>
<h2 id='simu'>Simulate data following log-ratio model</h2><span id='topic+simu'></span>

<h3>Description</h3>

<p>Simulate a dataset from log-ratio model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simu(
  n = 100,
  p = 200,
  model = "linear",
  weak = 4,
  strong = 6,
  weaksize = 0.125,
  strongsize = 0.25,
  pct.sparsity = 0.5,
  rho = 0,
  timedep_slope = NULL,
  timedep_cor = NULL,
  geetype = "gaussian",
  m = 4,
  corstr = "exchangeable",
  sdvec = NULL,
  rhogee = 0.8,
  geeslope = 2.5,
  longitudinal_stability = TRUE,
  ncov = 0,
  betacov = 0,
  intercept = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="simu_+3A_n">n</code></td>
<td>
<p>An integer of sample size</p>
</td></tr>
<tr><td><code id="simu_+3A_p">p</code></td>
<td>
<p>An integer of number of features (taxa).</p>
</td></tr>
<tr><td><code id="simu_+3A_model">model</code></td>
<td>
<p>Type of models associated with outcome variable, can be &quot;linear&quot;, &quot;binomial&quot;, &quot;cox&quot;, &quot;finegray&quot;, &quot;gee&quot; (scalar outcome with time-dependent features), or &quot;timedep&quot; (survival endpoint with time-dependent features).</p>
</td></tr>
<tr><td><code id="simu_+3A_weak">weak</code></td>
<td>
<p>Number of features with <code>weak</code> effect size.</p>
</td></tr>
<tr><td><code id="simu_+3A_strong">strong</code></td>
<td>
<p>Number of features with <code>strong</code> effect size.</p>
</td></tr>
<tr><td><code id="simu_+3A_weaksize">weaksize</code></td>
<td>
<p>Actual effect size for <code>weak</code> effect size. Must be positive.</p>
</td></tr>
<tr><td><code id="simu_+3A_strongsize">strongsize</code></td>
<td>
<p>Actual effect size for <code>strong</code> effect size. Must be positive.</p>
</td></tr>
<tr><td><code id="simu_+3A_pct.sparsity">pct.sparsity</code></td>
<td>
<p>Percentage of zero counts for each sample.</p>
</td></tr>
<tr><td><code id="simu_+3A_rho">rho</code></td>
<td>
<p>Parameter controlling the correlated structure between taxa. Ranges between 0 and 1.</p>
</td></tr>
<tr><td><code id="simu_+3A_timedep_slope">timedep_slope</code></td>
<td>
<p>If <code>model</code> is &quot;timedep&quot;, this parameter specifies the slope for the feature trajectories. Please refer to the Simulation section of the manuscript for more details.</p>
</td></tr>
<tr><td><code id="simu_+3A_timedep_cor">timedep_cor</code></td>
<td>
<p>If <code>model</code> is &quot;timedep&quot;, this parameter specifies the sample-wise correlations between longitudinal features. Please refer to the Simulation section of the manuscript for more details.</p>
</td></tr>
<tr><td><code id="simu_+3A_geetype">geetype</code></td>
<td>
<p>If <code>model</code> is &quot;gee&quot;, <code>geetype</code> is the type of GEE outcomes. Now support &quot;gaussian&quot; and &quot;binomial&quot;.</p>
</td></tr>
<tr><td><code id="simu_+3A_m">m</code></td>
<td>
<p>If <code>model</code> is &quot;gee&quot;, <code>m</code> is the number of repeated measurements per subject.</p>
</td></tr>
<tr><td><code id="simu_+3A_corstr">corstr</code></td>
<td>
<p>If <code>model</code> is &quot;gee&quot;, <code>corstr</code> is the working correlation structure. Now support &quot;independence&quot;, &quot;exchangeable&quot;, and &quot;AR-1&quot;.</p>
</td></tr>
<tr><td><code id="simu_+3A_sdvec">sdvec</code></td>
<td>
<p>If <code>model</code> is &quot;gee&quot; and <code>geetype</code> is &quot;gaussian&quot;, <code>sdvec</code> is the vector of standard deviations of each outcome variable.</p>
</td></tr>
<tr><td><code id="simu_+3A_rhogee">rhogee</code></td>
<td>
<p>If <code>model</code> is &quot;gee&quot;, <code>rhogee</code> is the correlation parameter between longitudinal outcomes under the selected working correlation structure.</p>
</td></tr>
<tr><td><code id="simu_+3A_geeslope">geeslope</code></td>
<td>
<p>If <code>model</code> is &quot;gee&quot;, <code>geeslope</code> is the linear time effect.</p>
</td></tr>
<tr><td><code id="simu_+3A_longitudinal_stability">longitudinal_stability</code></td>
<td>
<p>If <code>model</code> is &quot;timedep&quot;, this is a binary indicator which determines whether the trajectories are more stable (<code>TRUE</code>) or more volatile (<code>FALSE</code>).</p>
</td></tr>
<tr><td><code id="simu_+3A_ncov">ncov</code></td>
<td>
<p>Number of covariates that are not compositional features.</p>
</td></tr>
<tr><td><code id="simu_+3A_betacov">betacov</code></td>
<td>
<p>Coefficients corresponding to the covariates that are not compositional features.</p>
</td></tr>
<tr><td><code id="simu_+3A_intercept">intercept</code></td>
<td>
<p>Boolean. If TRUE, then a random intercept will be generated in the model. Only works for <code>linear</code> or <code>binomial</code> models.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with simulated count matrix <code>xcount</code>, log1p-transformed count matrix <code>x</code>, outcome (continuous <code>y</code>, continuous centered <code>y0</code>, binary <code>y</code>, or survival <code>t</code>, <code>d</code>), true coefficient vector <code>beta</code>, list of non-zero features <code>idx</code>, value of intercept <code>intercept</code> (if applicable).
</p>


<h3>Author(s)</h3>

<p>Teng Fei. Email: feit1@mskcc.org
</p>


<h3>References</h3>

<p>Fei T, Funnell T, Waters N, Raj SS et al. Enhanced Feature Selection for Microbiome Data using FLORAL: Scalable Log-ratio Lasso Regression bioRxiv 2023.05.02.538599.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(23420)
dat &lt;- simu(n=50,p=30,model="linear")

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
