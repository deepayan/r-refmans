<!DOCTYPE html><html><head><title>Help for package rpsftm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {rpsftm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#cox.zph'><p>Test the proportional hazards assumption of an RPSFTM/Cox Regression</p></a></li>
<li><a href='#est_eqn'><p>Estimating Equations for <code>rpsftm()</code></p></a></li>
<li><a href='#extract_z'><p>Extracting the z-statistic from a survival object</p></a></li>
<li><a href='#immdef'><p>immdef</p></a></li>
<li><a href='#plot.rpsftm'><p>Plot Method</p></a></li>
<li><a href='#print.rand'><p>Print method</p></a></li>
<li><a href='#print.rpsftm'><p>Print Method</p></a></li>
<li><a href='#print.rpsftm.coxph'><p>modified version of print.coxph</p></a></li>
<li><a href='#print.rpsftm.summary.coxph'><p>modified version of print.summary.coxph</p></a></li>
<li><a href='#print.rpsftm.summary.survreg'><p>modified version of print.summary.survreg</p></a></li>
<li><a href='#print.rpsftm.survreg'><p>modified version of print.survreg</p></a></li>
<li><a href='#rand'><p>rand functions to use in the rpsftm() formula</p></a></li>
<li><a href='#residuals.rpsftm'><p>residual() method for rpsftm objects</p></a></li>
<li><a href='#rpsftm'><p>Rank Preserving Structural Failure Time Model</p></a></li>
<li><a href='#rpsftm-package'><p>rpsftm: a package to fit Rank Preserving Structural Failure Time Model</p></a></li>
<li><a href='#summary.rpsftm'><p>summary Method</p></a></li>
<li><a href='#survfit.rpsftm'><p>survfit() method for rpsftm objects</p></a></li>
<li><a href='#termsinner'><p>termsinner</p></a></li>
<li><a href='#uniroot_all'><p>Finds many (all) roots of one equation within an interval</p></a></li>
<li><a href='#untreated'><p>Untreated Event Time</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Rank Preserving Structural Failure Time Models</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2.9</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-03-12</td>
</tr>
<tr>
<td>Description:</td>
<td>Implements methods described by the paper Robins and Tsiatis (1991) &lt;<a href="https://doi.org/10.1080%2F03610929108830654">doi:10.1080/03610929108830654</a>&gt;. These use g-estimation to estimate the causal effect of a treatment in a two-armed randomised control trial where non-compliance exists and is measured, under an assumption of an accelerated failure time model and no unmeasured confounders.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2, stats, survival</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, tableone, testthat</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Language:</td>
<td>en-GB</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-03-12 16:54:57 UTC; rstudio</td>
</tr>
<tr>
<td>Author:</td>
<td>Simon Bond [aut, cre] (primary author of code, secondary author of
    vignette),
  Annabel Allison [aut] (primary author of vignette, secondary author of
    code)</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Simon Bond &lt;simon.bond7@nhs.net&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-03-12 17:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='cox.zph'>Test the proportional hazards assumption of an RPSFTM/Cox Regression</h2><span id='topic+cox.zph'></span>

<h3>Description</h3>

<p>If the the <code>fit</code> inherits *both* <code>rpsftm</code> and <code>coxph</code> then this pulls out the genuine 
<code>survival::coxph</code> object that is deeply nested in the object, and then runs <code>survival::cox.zph</code> on it.
Or it avoids overwriting the function from <code>survival</code> by calling <code>survival::cox.zph</code> directly if the object 
does not inherit <code>rpsftm</code>. Or it fails.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cox.zph(fit, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cox.zph_+3A_fit">fit</code></td>
<td>
<p>the result of fitting a rpsftm model using <code><a href="survival.html#topic+coxph">coxph</a></code> as the inner estimation tool.</p>
</td></tr>
<tr><td><code id="cox.zph_+3A_...">...</code></td>
<td>
<p>any other arguments to pass to <code><a href="survival.html#topic+cox.zph">cox.zph</a></code>.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This does rely on the order of loading packages. The <code>rpsftm</code> package must be loaded after <code>survival</code>, 
if both are required, to avoid the masking of synonymous functions causing errors.
</p>


<h3>See Also</h3>

<p><code><a href="survival.html#topic+cox.zph">cox.zph</a></code>
</p>

<hr>
<h2 id='est_eqn'>Estimating Equations for <code>rpsftm()</code></h2><span id='topic+est_eqn'></span>

<h3>Description</h3>

<p>Calculates the Estimating Equation to be solved in RPSFTM models
</p>


<h3>Usage</h3>

<pre><code class='language-R'>est_eqn(psi, data, formula, target = 0, test = "survdiff", autoswitch, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="est_eqn_+3A_psi">psi</code></td>
<td>
<p>the parameter that measures how more rapidly the lifetime is expended under treatment</p>
</td></tr>
<tr><td><code id="est_eqn_+3A_data">data</code></td>
<td>
<p>the data set that contains the variables. 
Must contain columns named: time, censor_time,rx, arm.
Optionally a column named: treat_modifier</p>
</td></tr>
<tr><td><code id="est_eqn_+3A_formula">formula</code></td>
<td>
<p>a formula object of covariates to adjust for: <code>~strata(A)+B*C</code></p>
</td></tr>
<tr><td><code id="est_eqn_+3A_target">target</code></td>
<td>
<p>the value to subtract off from the z-statistic</p>
</td></tr>
<tr><td><code id="est_eqn_+3A_test">test</code></td>
<td>
<p>the survival regression function to calculate the z-statistic: survdiff, coxph, survreg</p>
</td></tr>
<tr><td><code id="est_eqn_+3A_autoswitch">autoswitch</code></td>
<td>
<p>a logical to autodetect cases of no switching. If TRUE, then if all observations in an arm
have perfect compliance then recensoring is not applied in that arm. If FALSE the recensoring is applied
regardless of perfect compliance.</p>
</td></tr>
<tr><td><code id="est_eqn_+3A_...">...</code></td>
<td>
<p>arguments to supply to the test function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A scalar value of the estimating equation: the z-statistics from a test minus a target value
</p>


<h3>Author(s)</h3>

<p>Simon Bond
</p>


<h3>See Also</h3>

<p><code><a href="#topic+untreated">untreated</a></code>
</p>

<hr>
<h2 id='extract_z'>Extracting the z-statistic from a survival object</h2><span id='topic+extract_z'></span><span id='topic+extract_z.survdiff'></span><span id='topic+extract_z.coxph'></span><span id='topic+extract_z.survreg'></span>

<h3>Description</h3>

<p>Generic S3 methods to extract the z-statistic from a set of survival fit objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_z(fit, ...)

## S3 method for class 'survdiff'
extract_z(fit, ...)

## S3 method for class 'coxph'
extract_z(fit, arm, ...)

## S3 method for class 'survreg'
extract_z(fit, arm, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_z_+3A_fit">fit</code></td>
<td>
<p>a fitted survival object : survdiff, coxph, survreg</p>
</td></tr>
<tr><td><code id="extract_z_+3A_...">...</code></td>
<td>
<p>extendible arguments to the S3 method</p>
</td></tr>
<tr><td><code id="extract_z_+3A_arm">arm</code></td>
<td>
<p>a character vector giving the name of the covariate representing the treatment arm.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a numeric value, the z statistic for the independence test of the treatment arm
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>extract_z(survdiff)</code>: Method for survdiff
</p>
</li>
<li> <p><code>extract_z(coxph)</code>: Method for coxph objects
</p>
</li>
<li> <p><code>extract_z(survreg)</code>: Method for survreg objects
</p>
</li></ul>


<h3>Author(s)</h3>

<p>Simon Bond
</p>

<hr>
<h2 id='immdef'>immdef</h2><span id='topic+immdef'></span>

<h3>Description</h3>

<p>Simulated data to use with the <code><a href="#topic+rpsftm">rpsftm</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>immdef
</code></pre>


<h3>Format</h3>

<p>A simulated data frame with 9 variables and 1000 observations representing a study where participants 
were randomly assigned to receive treatment immediately or deferred. Participants in the deferred 
arm could crossover and receive treatment. The primary endpoint was time to disease progression.
</p>
<p>The data are based on a randomized controlled trial Concorde <a href="https://doi.org/10.1016/S0140-6736%2894%2990006-X">doi:10.1016/S0140-6736(94)90006-X</a>
</p>

<dl>
<dt>id</dt><dd><p>participant ID number</p>
</dd>
<dt>def</dt><dd><p>indicator that the participant was assigned to the Deferred treatment arm</p>
</dd>
<dt>imm</dt><dd><p>indicator that the participant was assigned to the Immediate treatment arm</p>
</dd>
<dt>censyrs</dt><dd><p>censoring time, in years, corresponding to the close of study minus the time of entry for each participant</p>
</dd>
<dt>xo</dt><dd><p>an indicator that crossover occurred</p>
</dd>
<dt>xoyrs</dt><dd><p>the time, in years, from entry to switching, or 0 for participants in the Immediate arm</p>
</dd>
<dt>prog</dt><dd><p>an indicator of disease progression (1), or censoring (0)</p>
</dd>
<dt>progyrs</dt><dd><p>time, in years, from entry to disease progression or censoring</p>
</dd>
<dt>entry</dt><dd><p>the time of entry into the study, measured in years from the date of randomisation</p>
</dd>
</dl>


<hr>
<h2 id='plot.rpsftm'>Plot Method</h2><span id='topic+plot.rpsftm'></span>

<h3>Description</h3>

<p>Function used to plot the KM curves of the treatment-free transformed times
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'rpsftm'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.rpsftm_+3A_x">x</code></td>
<td>
<p>an object returned from the <code><a href="#topic+rpsftm">rpsftm</a></code> function.</p>
</td></tr>
<tr><td><code id="plot.rpsftm_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a ggplot plot of the fitted KM curves. The underlying data.frame has variables
</p>

<ul>
<li><p> time: failure time
</p>
</li>
<li><p> survival: estimated treatment-free survival probability 
</p>
</li>
<li><p> upper: upper confidence interval at level defined by alpha in the call to rpsftm
</p>
</li>
<li><p> lower: lower confidence interval at level defined by alpha in the call to rpsftm
</p>
</li>
<li><p> group: randomised treatment arm
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Simon Bond
</p>


<h3>Examples</h3>

<pre><code class='language-R'>fit &lt;- rpsftm(Surv(progyrs, prog)~rand(imm,1-xoyrs/progyrs),immdef, censyrs)
plot(fit)
library(ggplot2)
plot(fit)+
   scale_linetype_discrete(labels=c("Control","Experimental"))+
   ylim(0.5,1)+
   geom_ribbon(aes(ymin=lower, ymax=upper, fill=group), alpha=0.3)+
   labs(x="Time (years)", title=NULL, lty="Arm", fill="Arm")
</code></pre>

<hr>
<h2 id='print.rand'>Print method</h2><span id='topic+print.rand'></span>

<h3>Description</h3>

<p>print method for rand() objects - to display the summary of rx, by arm
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'rand'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.rand_+3A_x">x</code></td>
<td>
<p>a rand() object</p>
</td></tr>
<tr><td><code id="print.rand_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a summary of rx values broken down by arm for a rand() object
</p>


<h3>Author(s)</h3>

<p>Simon Bond
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rand">rand</a></code>, <code><a href="#topic+rpsftm">rpsftm</a></code>
</p>

<hr>
<h2 id='print.rpsftm'>Print Method</h2><span id='topic+print.rpsftm'></span>

<h3>Description</h3>

<p>Function used to print of the underlying test object at the point estimate of a rpsftm object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'rpsftm'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.rpsftm_+3A_x">x</code></td>
<td>
<p>an object returned from the <code><a href="#topic+rpsftm">rpsftm</a></code> function.</p>
</td></tr>
<tr><td><code id="print.rpsftm_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a print of the underlying test object at the point estimate.
</p>


<h3>Author(s)</h3>

<p>Simon Bond
</p>

<hr>
<h2 id='print.rpsftm.coxph'>modified version of print.coxph</h2><span id='topic+print.rpsftm.coxph'></span>

<h3>Description</h3>

<p>this drops the &quot;arm&quot; term as this is not a real parameter
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'rpsftm.coxph'
print(x, digits = max(options()$digits - 4, 3), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.rpsftm.coxph_+3A_x">x</code></td>
<td>
<p>an coxph()</p>
</td></tr>
<tr><td><code id="print.rpsftm.coxph_+3A_digits">digits</code></td>
<td>
<p>the number of digits to print out</p>
</td></tr>
<tr><td><code id="print.rpsftm.coxph_+3A_...">...</code></td>
<td>
<p>further arguments</p>
</td></tr>
</table>

<hr>
<h2 id='print.rpsftm.summary.coxph'>modified version of print.summary.coxph</h2><span id='topic+print.rpsftm.summary.coxph'></span>

<h3>Description</h3>

<p>this drops the &quot;arm&quot; term as this is not a real parameter
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'rpsftm.summary.coxph'
print(
  x,
  digits = max(getOption("digits") - 3, 3),
  signif.stars = getOption("show.signif.stars"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.rpsftm.summary.coxph_+3A_x">x</code></td>
<td>
<p>the result of a call to <code>summary.coxph</code></p>
</td></tr>
<tr><td><code id="print.rpsftm.summary.coxph_+3A_digits">digits</code></td>
<td>
<p>significant digits to print</p>
</td></tr>
<tr><td><code id="print.rpsftm.summary.coxph_+3A_signif.stars">signif.stars</code></td>
<td>
<p>show star to highlight small p-values</p>
</td></tr>
<tr><td><code id="print.rpsftm.summary.coxph_+3A_...">...</code></td>
<td>
<p>further arguments for future methods</p>
</td></tr>
</table>

<hr>
<h2 id='print.rpsftm.summary.survreg'>modified version of print.summary.survreg</h2><span id='topic+print.rpsftm.summary.survreg'></span>

<h3>Description</h3>

<p>this drops the &quot;arm&quot; term as this is not a real parameter
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'rpsftm.summary.survreg'
print(x, digits = max(options()$digits - 4, 3), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.rpsftm.summary.survreg_+3A_x">x</code></td>
<td>
<p>the result of a call to <code>summary.survreg</code></p>
</td></tr>
<tr><td><code id="print.rpsftm.summary.survreg_+3A_digits">digits</code></td>
<td>
<p>significant digits to print</p>
</td></tr>
<tr><td><code id="print.rpsftm.summary.survreg_+3A_...">...</code></td>
<td>
<p>further arguments for future methods</p>
</td></tr>
</table>

<hr>
<h2 id='print.rpsftm.survreg'>modified version of print.survreg</h2><span id='topic+print.rpsftm.survreg'></span>

<h3>Description</h3>

<p>this drops the &quot;arm&quot; term as this is not a real parameter
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'rpsftm.survreg'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.rpsftm.survreg_+3A_x">x</code></td>
<td>
<p>a survreg() object</p>
</td></tr>
<tr><td><code id="print.rpsftm.survreg_+3A_...">...</code></td>
<td>
<p>further arguments</p>
</td></tr>
</table>

<hr>
<h2 id='rand'>rand functions to use in the rpsftm() formula</h2><span id='topic+rand'></span>

<h3>Description</h3>

<p>A function that is defined to be used in the formula argument, 
and identified as specials in the terms() object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rand(arm, rx)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rand_+3A_arm">arm</code></td>
<td>
<p>the randomised treatment arm. a factor with 2 levels, or numeric variable with values 0/1.</p>
</td></tr>
<tr><td><code id="rand_+3A_rx">rx</code></td>
<td>
<p>the proportion of time on active treatment (arm=1 or the non-reference level of the factor)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>matrix with two columns named arm and rx. These can be used in the formula argument to rpsftm()
</p>


<h3>Author(s)</h3>

<p>Simon Bond
</p>


<h3>See Also</h3>

<p><code><a href="#topic+print.rand">print.rand</a></code>, <code><a href="#topic+rpsftm">rpsftm</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- with(immdef, rand(imm , 1 - xoyrs / progyrs ) )
x
class(x)
y &lt;- as.data.frame(x)
head(y)
</code></pre>

<hr>
<h2 id='residuals.rpsftm'>residual() method for rpsftm objects</h2><span id='topic+residuals.rpsftm'></span>

<h3>Description</h3>

<p>Function to apply residual method to rpsftm objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'rpsftm'
residuals(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="residuals.rpsftm_+3A_object">object</code></td>
<td>
<p>an object returned from the <code>rpsftm()</code> function.</p>
</td></tr>
<tr><td><code id="residuals.rpsftm_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a residuals object.
</p>


<h3>Author(s)</h3>

<p>Simon Bond
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+residuals">residuals</a></code> <code><a href="survival.html#topic+residuals.coxph">residuals.coxph</a></code>  <code><a href="survival.html#topic+residuals.survreg">residuals.survreg</a></code>
</p>

<hr>
<h2 id='rpsftm'>Rank Preserving Structural Failure Time Model</h2><span id='topic+rpsftm'></span>

<h3>Description</h3>

<p>Main Function used for estimating causal parameters under the Rank Preserving Structural Failure Time Model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rpsftm(
  formula,
  data,
  censor_time,
  subset,
  na.action,
  test = survdiff,
  low_psi = -1,
  hi_psi = 1,
  alpha = 0.05,
  treat_modifier = 1,
  autoswitch = TRUE,
  n_eval_z = 100,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rpsftm_+3A_formula">formula</code></td>
<td>
<p>a formula with a minimal structure of <code>Surv(time, status)~rand(arm,rx)</code>.
Further terms can be added to the right hand side to adjust for covariates and use strata or 
cluster arguments.</p>
</td></tr>
<tr><td><code id="rpsftm_+3A_data">data</code></td>
<td>
<p>an optional data frame that contains variables</p>
</td></tr>
<tr><td><code id="rpsftm_+3A_censor_time">censor_time</code></td>
<td>
<p>variable or constant giving the time at which censoring would, or has occurred. 
This should be provided for all observations unlike standard Kaplan-Meier or Cox regression where 
it is only given for censored observations. If no value is given then re-censoring is not applied.</p>
</td></tr>
<tr><td><code id="rpsftm_+3A_subset">subset</code></td>
<td>
<p>expression indicating which subset of the rows of data should be used in the fit. 
This can be a logical vector (which is replicated to have length equal to the number of observations),
a numeric vector indicating which observation numbers are to be included (or excluded if negative), 
or a character vector of row names to be included. All observations are included by default.</p>
</td></tr>
<tr><td><code id="rpsftm_+3A_na.action">na.action</code></td>
<td>
<p>a missing-data filter function. This is applied to the model.frame after any subset 
argument has been used. Default is options()$na.action.</p>
</td></tr>
<tr><td><code id="rpsftm_+3A_test">test</code></td>
<td>
<p>the survival regression function to calculate the z-statistic: survdiff, coxph, survreg</p>
</td></tr>
<tr><td><code id="rpsftm_+3A_low_psi">low_psi</code></td>
<td>
<p>the lower limit of the range to search for the causal parameter</p>
</td></tr>
<tr><td><code id="rpsftm_+3A_hi_psi">hi_psi</code></td>
<td>
<p>the upper limit of the range to search for the causal parameter</p>
</td></tr>
<tr><td><code id="rpsftm_+3A_alpha">alpha</code></td>
<td>
<p>the significance level used to calculate confidence intervals</p>
</td></tr>
<tr><td><code id="rpsftm_+3A_treat_modifier">treat_modifier</code></td>
<td>
<p>an optional variable that psi is multiplied by on an individual observation level to give
differing impact to treatment.</p>
</td></tr>
<tr><td><code id="rpsftm_+3A_autoswitch">autoswitch</code></td>
<td>
<p>a logical to autodetect cases of no switching. If TRUE, then if all observations in an arm
have perfect compliance then recensoring is not applied in that arm. If FALSE the recensoring is applied
regardless of perfect compliance.</p>
</td></tr>
<tr><td><code id="rpsftm_+3A_n_eval_z">n_eval_z</code></td>
<td>
<p>The number of points between hi_psi and low_psi at which to evaluate the Z-statistics
in the estimating equation. Default  is 100.</p>
</td></tr>
<tr><td><code id="rpsftm_+3A_...">...</code></td>
<td>
<p>arguments to supply to the test function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>the formula object <code>Surv(time, status)~rand(arm,rx)</code>. <code>rand()</code> stands 
for randomisation, both the randomly assigned and actual observed treatment. 
</p>

<ul>
<li><p> arm: the randomised treatment arm. a factor with 2 levels, or numeric variable with values 0/1.
</p>
</li>
<li><p> rx: the proportion of time on active treatment (arm=1 or the non-reference level of the factor)
</p>
</li></ul>

<p>Further adjustment terms can be added on the right hand side of the formula if desired, included <code>strata()</code>
or <code>cluster()</code> terms.
</p>


<h3>Value</h3>

<p>a rpsftm method object that is a list of the following:
</p>

<ul>
<li><p> psi: the estimated parameter
</p>
</li>
<li><p> fit: a survdiff object to produce Kaplan-Meier curves of the estimated counterfactual untreated failure times for each treatment arm
</p>
</li>
<li><p> CI: a vector of the confidence interval around psi
</p>
</li>
<li><p> Sstar: the recensored <code>Surv()</code> data using the estimate value of psi to give counterfactual untreated failure times.
</p>
</li>
<li><p> rand: the rand() object used to specify the allocated and observed amount of treatment.
</p>
</li>
<li><p> ans: the values from <code><a href="#topic+uniroot_all">uniroot_all</a></code> used to solve the estimating equation, 
but embedded within a list as per <code><a href="stats.html#topic+uniroot">uniroot</a></code>, with an extra element <code>root_all</code>,
a vector of all roots found in the case of multiple solutions. The first element of <code>root_all</code> 
is subsequently used.
</p>
</li>
<li><p> eval_z: a data frame with the Z-statistics from the estimating equation evaluated at
a sequence of values of psi. Used to plot and check if the range of values to search for solution
and limits of confidence intervals need to be modified.
</p>
</li>
<li><p> Further elements corresponding to either a <code>survdiff</code>, <code>coxph</code>, or <code>survreg</code> object. This will always include:
</p>

<ul>
<li><p> call: the R call object
</p>
</li>
<li><p> formula: a formula representing any adjustments, strata or clusters- used for the <code>update()</code> function
</p>
</li>
<li><p> terms: a more detailed representation of the model formula
</p>
</li></ul>

</li></ul>



<h3>Author(s)</h3>

<p>Simon Bond
</p>


<h3>See Also</h3>

<p><code><a href="survival.html#topic+survdiff">survdiff</a></code>, <code><a href="survival.html#topic+coxph.object">coxph.object</a></code>, <code><a href="survival.html#topic+survreg.object">survreg.object</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>?immdef
fit &lt;- rpsftm(Surv(progyrs, prog)~rand(imm,1-xoyrs/progyrs),immdef, censyrs)
print(fit)
summary(fit)
plot(fit)

</code></pre>

<hr>
<h2 id='rpsftm-package'>rpsftm: a package to fit Rank Preserving Structural Failure Time Model</h2><span id='topic+rpsftm-package'></span>

<h3>Description</h3>

<p>This implements the method of Robins JM, Tsiatis AA. 
The key function is <code><a href="#topic+rpsftm">rpsftm</a></code>, which provides estimates of the causal parameter of interest.
</p>


<h3>Details</h3>

<p>rpfstm: a package to fit Rank Preserving Structural Failure Time Model
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Simon Bond <a href="mailto:simon.bond7@nhs.net">simon.bond7@nhs.net</a> (primary author of code, secondary author of vignette)
</p>
<p>Authors:
</p>

<ul>
<li><p> Annabel Allison (primary author of vignette, secondary author of code)
</p>
</li></ul>



<h3>References</h3>

<p>Robins JM, Tsiatis AA. Correcting for non-compliance in randomized trials 
using rank preserving structural failure time models. 
Communications in Statistics&ndash;Theory and Methods 1991; 20: 2609&ndash;2631
</p>


<h3>See Also</h3>

<p><code><a href="survival.html#topic+survdiff">survdiff</a></code>
</p>
<p><code><a href="survival.html#topic+coxph">coxph</a></code>
</p>
<p><code><a href="survival.html#topic+survreg">survreg</a></code>
</p>

<hr>
<h2 id='summary.rpsftm'>summary Method</h2><span id='topic+summary.rpsftm'></span>

<h3>Description</h3>

<p>Function used to summarise the fitted model to an rpsftm object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'rpsftm'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.rpsftm_+3A_object">object</code></td>
<td>
<p>an object returned from the <code>rpsftm()</code> function.</p>
</td></tr>
<tr><td><code id="summary.rpsftm_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a summary of the fitted regression model.
</p>


<h3>Author(s)</h3>

<p>Simon Bond
</p>

<hr>
<h2 id='survfit.rpsftm'>survfit() method for rpsftm objects</h2><span id='topic+survfit.rpsftm'></span>

<h3>Description</h3>

<p>Function to apply survfit method to rpsftm objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'rpsftm'
survfit(formula, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="survfit.rpsftm_+3A_formula">formula</code></td>
<td>
<p>an object returned from the <code>rpsftm()</code> function. (with the name &quot;formula&quot; to agree with generic argument names)</p>
</td></tr>
<tr><td><code id="survfit.rpsftm_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a survfit object.
</p>


<h3>Author(s)</h3>

<p>Simon Bond
</p>


<h3>See Also</h3>

<p><code><a href="survival.html#topic+survfit">survfit</a></code>
</p>

<hr>
<h2 id='termsinner'>termsinner</h2><span id='topic+termsinner'></span>

<h3>Description</h3>

<p>A function taken from the survival library - it is not exported from there hence a local copy
</p>


<h3>Usage</h3>

<pre><code class='language-R'>termsinner(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="termsinner_+3A_x">x</code></td>
<td>
<p>an R object</p>
</td></tr>
<tr><td><code id="termsinner_+3A_...">...</code></td>
<td>
<p>extendible arguments to the S3 method</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of variables referred to in a formula or call object
</p>
<p>a character vector
</p>

<hr>
<h2 id='uniroot_all'>Finds many (all) roots of one equation within an interval</h2><span id='topic+uniroot_all'></span>

<h3>Description</h3>

<p>The function uniroot_all searches the interval from lower to upper for several roots  of a function f with respect to its first argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>uniroot_all(
  f,
  interval,
  lower = min(interval),
  upper = max(interval),
  tol = .Machine$double.eps^0.2,
  maxiter = 1000,
  trace = 0,
  n = 100,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="uniroot_all_+3A_f">f</code></td>
<td>
<p>the function for which the root is sought. This function needs to accept a vector of  input values.</p>
</td></tr>
<tr><td><code id="uniroot_all_+3A_interval">interval</code></td>
<td>
<p>a vector containing the end-points of the interval to be searched for the root.</p>
</td></tr>
<tr><td><code id="uniroot_all_+3A_lower">lower</code></td>
<td>
<p>the lower end point of the interval to be searched.</p>
</td></tr>
<tr><td><code id="uniroot_all_+3A_upper">upper</code></td>
<td>
<p>the upper end poitn of the interval to be searched.</p>
</td></tr>
<tr><td><code id="uniroot_all_+3A_tol">tol</code></td>
<td>
<p>the desired accuracy (convergence tolerance). Passed to function <code><a href="stats.html#topic+uniroot">uniroot</a></code>.</p>
</td></tr>
<tr><td><code id="uniroot_all_+3A_trace">trace</code></td>
<td>
<p>integer numberl if positive, tracing information is produced. Higher values giving more details. Passed to function <code><a href="stats.html#topic+uniroot">uniroot</a></code>.</p>
</td></tr>
<tr><td><code id="uniroot_all_+3A_n">n</code></td>
<td>
<p>number of subintervals in which the root is sought.</p>
</td></tr>
<tr><td><code id="uniroot_all_+3A_...">...</code></td>
<td>
<p>additional named or unnamed arguments to be passed to <code>f</code> (but beware of parital matching to other arguments).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>this is a copy taken from the package <code>rootSolve</code> but imported here to avoid dependency
</p>


<h3>Value</h3>

<p>a vector with the roots found in the interval.
</p>


<h3>Author(s)</h3>

<p>Karline Soetaert &lt;karline.soetaert@nioz.nl&gt; - original . Copied by Simon Bond.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+uniroot">uniroot</a></code>
</p>

<hr>
<h2 id='untreated'>Untreated Event Time</h2><span id='topic+untreated'></span>

<h3>Description</h3>

<p>Calculates the counterfactual untreated event time, possibly using the recensoring method, assuming a given parameter value and returns a Surv() object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>untreated(psi, time, delta, censor_time, rx, arm, autoswitch)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="untreated_+3A_psi">psi</code></td>
<td>
<p>the parameter that measures how more rapidly the lifetime is expended under treatment</p>
</td></tr>
<tr><td><code id="untreated_+3A_time">time</code></td>
<td>
<p>the observed failure or censoring time.</p>
</td></tr>
<tr><td><code id="untreated_+3A_delta">delta</code></td>
<td>
<p>the status of the time: 1 = observed, 0 = censored.</p>
</td></tr>
<tr><td><code id="untreated_+3A_censor_time">censor_time</code></td>
<td>
<p>the theoretical censoring time, either observed or set after time. Set to Inf to ignore recensoring.</p>
</td></tr>
<tr><td><code id="untreated_+3A_rx">rx</code></td>
<td>
<p>the proportion of time spent on treatment</p>
</td></tr>
<tr><td><code id="untreated_+3A_arm">arm</code></td>
<td>
<p>the randomised arm. Either a numerical indicator, with 0 as the placebo, or a factor with the lowest level as placebo.</p>
</td></tr>
<tr><td><code id="untreated_+3A_autoswitch">autoswitch</code></td>
<td>
<p>a logical to autodetect cases of no switching. If TRUE, then if all observations in an arm
have perfect compliance then recensoring is not applied in that arm. If FALSE the recensoring is applied
regardless of perfect compliance.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A Surv() object
</p>


<h3>Author(s)</h3>

<p>Simon Bond
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
