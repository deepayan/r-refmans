<!DOCTYPE html><html lang="en"><head><title>Help for package rddensity</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {rddensity}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#rddensity-package'><p>rddensity: Manipulation Testing Based on Density Discontinuity</p></a></li>
<li><a href='#Cgenerate'><p>Internal function, generate matrices.</p></a></li>
<li><a href='#Cminusgenerate'><p>Internal function, generate matrices.</p></a></li>
<li><a href='#Cplusgenerate'><p>Internal function, generate matrices.</p></a></li>
<li><a href='#Ggenerate'><p>Internal function, generate matrices.</p></a></li>
<li><a href='#Gminusgenerate'><p>Internal function, generate matrices.</p></a></li>
<li><a href='#Gplusgenerate'><p>Internal function, generate matrices.</p></a></li>
<li><a href='#h_opt_density'><p>Internal function, calculates theoretical optimal bandwidth.</p></a></li>
<li><a href='#h_opt_density_res'><p>Internal function, calculates theoretical optimal bandwidth.</p></a></li>
<li><a href='#print.CJMrdbwdensity'><p>Internal function.</p></a></li>
<li><a href='#print.CJMrddensity'><p>Internal function.</p></a></li>
<li><a href='#Psigenerate'><p>Internal function, generate matrices.</p></a></li>
<li><a href='#rdbwdensity'><p>Bandwidth Selection for Manipulation Testing</p></a></li>
<li><a href='#rddensity'><p>Manipulation Testing Using Local Polynomial Density Estimation</p></a></li>
<li><a href='#rddensity_fV'><p>Internal function, implements density test.</p></a></li>
<li><a href='#rddensity_H'><p>Internal function, normal distribution related quantities.</p></a></li>
<li><a href='#rddensity_senate'><p>RD Senate Data</p></a></li>
<li><a href='#rddensityUnique'><p>Internal function.</p></a></li>
<li><a href='#rdplotdensity'><p>Density Plotting for Manipulation Testing</p></a></li>
<li><a href='#Sgenerate'><p>Internal function, generate matrices.</p></a></li>
<li><a href='#Sminusgenerate'><p>Internal function, generate matrices.</p></a></li>
<li><a href='#Splusgenerate'><p>Internal function, generate matrices.</p></a></li>
<li><a href='#summary.CJMrdbwdensity'><p>Internal function.</p></a></li>
<li><a href='#summary.CJMrddensity'><p>Internal function.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Manipulation Testing Based on Density Discontinuity</td>
</tr>
<tr>
<td>Description:</td>
<td>Density discontinuity testing (a.k.a. manipulation testing) is commonly employed in regression discontinuity designs and other program evaluation settings to detect perfect self-selection (manipulation) around a cutoff where treatment/policy assignment changes. This package implements manipulation testing procedures using the local polynomial density estimators: rddensity() to construct test statistics and p-values given a prespecified cutoff, rdbwdensity() to perform data-driven bandwidth selection, and rdplotdensity() to construct density plots.</td>
</tr>
<tr>
<td>Version:</td>
<td>2.6</td>
</tr>
<tr>
<td>Author:</td>
<td>Matias D. Cattaneo [aut],
  Michael Jansson [aut],
  Xinwei Ma [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Xinwei Ma &lt;x1ma@ucsd.edu&gt;</td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2, lpdensity (&ge; 2.2)</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.0</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-10-06 05:13:09 UTC; xinweima</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-10-06 08:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='rddensity-package'>rddensity: Manipulation Testing Based on Density Discontinuity</h2><span id='topic+rddensity-package'></span><span id='topic+_PACKAGE'></span>

<h3>Description</h3>

<p>Density discontinuity testing (a.k.a. manipulation testing) is commonly
employed in regression discontinuity designs and other program evaluation settings
to detect perfect self-selection (manipulation) around a cutoff where
treatment/policy assignment changes.
</p>
<p>This package implements manipulation testing procedures using the
local polynomial density estimators proposed in Cattaneo, Jansson and Ma (2020),
and implements graphical procedures with valid confidence bands using the results
in Cattaneo, Jansson and Ma (2022, 2023).  In addition, this package provides complementary
manipulation testing based on finite sample exact binomial testing following the
esults in Cattaneo, Frandsen and Titiunik (2015) and Cattaneo, Frandsen and
Vazquez-Bare (2017).
</p>
<p>A companion <code>Stata</code> package is described in Cattaneo, Jansson and Ma (2018).
</p>
<p>Commands: <code><a href="#topic+rddensity">rddensity</a></code> for manipulation (density discontinuity) testing.
<code><a href="#topic+rdbwdensity">rdbwdensity</a></code> for data-driven bandwidth selection, and
<code><a href="#topic+rdplotdensity">rdplotdensity</a></code> for density plots.
</p>
<p>Related Stata and R packages useful for inference in regression discontinuity (RD)
designs are described in the website: <a href="https://rdpackages.github.io/">https://rdpackages.github.io/</a>.
</p>


<h3>Author(s)</h3>

<p>Matias D. Cattaneo, Princeton University  <a href="mailto:cattaneo@princeton.edu">cattaneo@princeton.edu</a>.
</p>
<p>Michael Jansson, University of California Berkeley.  <a href="mailto:mjansson@econ.berkeley.edu">mjansson@econ.berkeley.edu</a>.
</p>
<p>Xinwei Ma (maintainer), University of California San Diego. <a href="mailto:x1ma@ucsd.edu">x1ma@ucsd.edu</a>.
</p>


<h3>References</h3>

<p>Calonico, S., M. D. Cattaneo, and M. H. Farrell. 2018. On the Effect of Bias Estimation on Coverage Accuracy in Nonparametric Inference. <em>Journal of the American Statistical Association</em> 113(522): 767-779. <a href="https://doi.org/10.1080/01621459.2017.1285776">doi:10.1080/01621459.2017.1285776</a>
</p>
<p>Calonico, S., M. D. Cattaneo, and M. H. Farrell. 2022. Coverage Error Optimal Confidence Intervals for Local Polynomial Regression. <em>Bernoulli</em>, 28(4): 2998-3022. <a href="https://doi.org/10.3150/21-BEJ1445">doi:10.3150/21-BEJ1445</a>
</p>
<p>Cattaneo, M. D., B. Frandsen, and R. Titiunik. 2015. Randomization Inference in the Regression Discontinuity Design: An Application to the Study of Party Advantages in the U.S. Senate. <em>Journal of Causal Inference</em> 3(1): 1-24. <a href="https://doi.org/10.1515/jci-2013-0010">doi:10.1515/jci-2013-0010</a>
</p>
<p>Cattaneo, M. D., M. Jansson, and X. Ma. 2018. Manipulation Testing based on Density Discontinuity. <em>Stata Journal</em> 18(1): 234-261. <a href="https://doi.org/10.1177/1536867X1801800115">doi:10.1177/1536867X1801800115</a>
</p>
<p>Cattaneo, M. D., M. Jansson, and X. Ma. 2020. Simple Local Polynomial Density Estimators. <em>Journal of the American Statistical Association</em>, 115(531): 1449-1455. <a href="https://doi.org/10.1080/01621459.2019.1635480">doi:10.1080/01621459.2019.1635480</a>
</p>
<p>Cattaneo, M. D., M. Jansson, and X. Ma. 2022. lpdensity: Local Polynomial Density Estimation and Inference. <em>Journal of Statistical Software</em>, 101(2): 1–25. <a href="https://doi.org/10.18637/jss.v101.i02">doi:10.18637/jss.v101.i02</a>
</p>
<p>Cattaneo, M. D., M. Jansson, and X. Ma. 2023. Local Regression Distribution Estimators. <em>Journal of Econometrics</em>, 240(2): 105074. <a href="https://doi.org/10.1016/j.jeconom.2021.01.006">doi:10.1016/j.jeconom.2021.01.006</a>
</p>
<p>Cattaneo, M. D., R. Titiunik and G. Vazquez-Bare. 2017. Comparing Inference Approaches for RD Designs: A Reexamination of the Effect of Head Start on Child Mortality. <em>Journal of Policy Analysis and Management</em> 36(3): 643-681. <a href="https://doi.org/10.1002/pam.21985">doi:10.1002/pam.21985</a>
</p>
<p>McCrary, J. 2008. Manipulation of the Running Variable in the Regression Discontinuity Design: A Density Test. <em>Journal of Econometrics</em> 142(2): 698-714. <a href="https://doi.org/10.1016/j.jeconom.2007.05.005">doi:10.1016/j.jeconom.2007.05.005</a>
</p>

<hr>
<h2 id='Cgenerate'>Internal function, generate matrices.</h2><span id='topic+Cgenerate'></span>

<h3>Description</h3>

<p><code>Cgenerate</code> generates a matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Cgenerate(k, p, low = -1, up = 1, kernel = "triangular")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Cgenerate_+3A_k">k</code>, <code id="Cgenerate_+3A_p">p</code></td>
<td>
<p>Integer, polynomial order.</p>
</td></tr>
<tr><td><code id="Cgenerate_+3A_kernel">kernel</code></td>
<td>
<p>String, the kernel function, can be <code>triangular</code> (default),
<code>uniform</code> or <code>epanechnikov</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is an internal function, and should not be called by users.
</p>


<h3>Value</h3>

<p>Returns a matrix.
</p>

<hr>
<h2 id='Cminusgenerate'>Internal function, generate matrices.</h2><span id='topic+Cminusgenerate'></span>

<h3>Description</h3>

<p><code>Cminusgenerate</code> generates a matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Cminusgenerate(k, p, kernel = "triangular")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Cminusgenerate_+3A_k">k</code>, <code id="Cminusgenerate_+3A_p">p</code></td>
<td>
<p>Integer, polynomial order.</p>
</td></tr>
<tr><td><code id="Cminusgenerate_+3A_kernel">kernel</code></td>
<td>
<p>String, the kernel function, can be <code>triangular</code> (default),
<code>uniform</code> or <code>epanechnikov</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is an internal function, and should not be called by users.
</p>


<h3>Value</h3>

<p>Returns a matrix.
</p>

<hr>
<h2 id='Cplusgenerate'>Internal function, generate matrices.</h2><span id='topic+Cplusgenerate'></span>

<h3>Description</h3>

<p><code>Cminusgenerate</code> generates a matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Cplusgenerate(k, p, kernel = "triangular")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Cplusgenerate_+3A_k">k</code>, <code id="Cplusgenerate_+3A_p">p</code></td>
<td>
<p>Integer, polynomial order.</p>
</td></tr>
<tr><td><code id="Cplusgenerate_+3A_kernel">kernel</code></td>
<td>
<p>String, the kernel function, can be <code>triangular</code> (default),
<code>uniform</code> or <code>epanechnikov</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is an internal function, and should not be called by users.
</p>


<h3>Value</h3>

<p>Returns a matrix.
</p>

<hr>
<h2 id='Ggenerate'>Internal function, generate matrices.</h2><span id='topic+Ggenerate'></span>

<h3>Description</h3>

<p><code>Ggenerate</code> generates a matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Ggenerate(p, low = -1, up = 1, kernel = "triangular")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Ggenerate_+3A_p">p</code></td>
<td>
<p>Integer, polynomial order.</p>
</td></tr>
<tr><td><code id="Ggenerate_+3A_low">low</code>, <code id="Ggenerate_+3A_up">up</code></td>
<td>
<p>Numeric, lower and upper limits of integration, -1 and 1 by
default.</p>
</td></tr>
<tr><td><code id="Ggenerate_+3A_kernel">kernel</code></td>
<td>
<p>String, the kernel function, can be <code>triangular</code> (default),
<code>uniform</code> or <code>epanechnikov</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is an internal function, and should not be called by users.
</p>


<h3>Value</h3>

<p>Returns a matrix.
</p>

<hr>
<h2 id='Gminusgenerate'>Internal function, generate matrices.</h2><span id='topic+Gminusgenerate'></span>

<h3>Description</h3>

<p><code>Gminusgenerate</code> generates a matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Gminusgenerate(p, kernel = "triangular")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Gminusgenerate_+3A_p">p</code></td>
<td>
<p>Integer, polynomial order.</p>
</td></tr>
<tr><td><code id="Gminusgenerate_+3A_kernel">kernel</code></td>
<td>
<p>String, the kernel function, can be <code>triangular</code> (default),
<code>uniform</code> or <code>epanechnikov</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is an internal function, and should not be called by users.
</p>


<h3>Value</h3>

<p>Returns a matrix.
</p>

<hr>
<h2 id='Gplusgenerate'>Internal function, generate matrices.</h2><span id='topic+Gplusgenerate'></span>

<h3>Description</h3>

<p><code>Gplusgenerate</code> generates a matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Gplusgenerate(p, kernel = "triangular")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Gplusgenerate_+3A_p">p</code></td>
<td>
<p>Integer, polynomial order.</p>
</td></tr>
<tr><td><code id="Gplusgenerate_+3A_kernel">kernel</code></td>
<td>
<p>String, the kernel function, can be <code>triangular</code> (default),
<code>uniform</code> or <code>epanechnikov</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is an internal function, and should not be called by users.
</p>


<h3>Value</h3>

<p>Returns a matrix.
</p>

<hr>
<h2 id='h_opt_density'>Internal function, calculates theoretical optimal bandwidth.</h2><span id='topic+h_opt_density'></span>

<h3>Description</h3>

<p><code>h_opt_density</code> calculates theoretical optimal bandwidth.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>h_opt_density(x, p, N, dgp_F1, dgp_Fp1, f_low, f_up, kernel = "triangular")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="h_opt_density_+3A_x">x</code></td>
<td>
<p>Numeric vector or data matrix, the running variable.</p>
</td></tr>
<tr><td><code id="h_opt_density_+3A_p">p</code></td>
<td>
<p>Integer, polynomial order.</p>
</td></tr>
<tr><td><code id="h_opt_density_+3A_n">N</code></td>
<td>
<p>Integer, sample size.</p>
</td></tr>
<tr><td><code id="h_opt_density_+3A_dgp_f1">dgp_F1</code>, <code id="h_opt_density_+3A_dgp_fp1">dgp_Fp1</code></td>
<td>
<p>Numeric, theoretical d.g.p.</p>
</td></tr>
<tr><td><code id="h_opt_density_+3A_f_low">f_low</code>, <code id="h_opt_density_+3A_f_up">f_up</code></td>
<td>
<p>Numeric, lower and upper boundaries.</p>
</td></tr>
<tr><td><code id="h_opt_density_+3A_kernel">kernel</code></td>
<td>
<p>String, the kernel function, can be <code>triangular</code> (default),
<code>uniform</code> or <code>epanechnikov</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is an internal function, and should not be called by users.
</p>


<h3>Value</h3>

<p>Returns MSE optimal bandwidth.
</p>

<hr>
<h2 id='h_opt_density_res'>Internal function, calculates theoretical optimal bandwidth.</h2><span id='topic+h_opt_density_res'></span>

<h3>Description</h3>

<p><code>h_opt_density_res</code> calculates theoretical optimal bandwidth for restricted
model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>h_opt_density_res(
  p,
  N,
  dgp_F1_l,
  dgp_F1_r,
  dgp_Fp1_l,
  dgp_Fp1_r,
  kernel = "triangular"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="h_opt_density_res_+3A_p">p</code></td>
<td>
<p>Integer, polynomial order.</p>
</td></tr>
<tr><td><code id="h_opt_density_res_+3A_n">N</code></td>
<td>
<p>Integer, sample size.</p>
</td></tr>
<tr><td><code id="h_opt_density_res_+3A_dgp_f1_l">dgp_F1_l</code>, <code id="h_opt_density_res_+3A_dgp_f1_r">dgp_F1_r</code>, <code id="h_opt_density_res_+3A_dgp_fp1_l">dgp_Fp1_l</code>, <code id="h_opt_density_res_+3A_dgp_fp1_r">dgp_Fp1_r</code></td>
<td>
<p>Numeric, theoretical d.g.p.</p>
</td></tr>
<tr><td><code id="h_opt_density_res_+3A_kernel">kernel</code></td>
<td>
<p>String, the kernel function, can be <code>triangular</code> (default),
<code>uniform</code> or <code>epanechnikov</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is an internal function, and should not be called by users.
</p>


<h3>Value</h3>

<p>Returns MSE optimal bandwidth.
</p>

<hr>
<h2 id='print.CJMrdbwdensity'>Internal function.</h2><span id='topic+print.CJMrdbwdensity'></span>

<h3>Description</h3>

<p>Internal function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'CJMrdbwdensity'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.CJMrdbwdensity_+3A_x">x</code></td>
<td>
<p>Class <code>CJMrdbwdensity</code> objects.</p>
</td></tr>
</table>

<hr>
<h2 id='print.CJMrddensity'>Internal function.</h2><span id='topic+print.CJMrddensity'></span>

<h3>Description</h3>

<p>Internal function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'CJMrddensity'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.CJMrddensity_+3A_x">x</code></td>
<td>
<p>Class <code>CJMrddensity</code> objects.</p>
</td></tr>
</table>

<hr>
<h2 id='Psigenerate'>Internal function, generate matrices.</h2><span id='topic+Psigenerate'></span>

<h3>Description</h3>

<p><code>Psigenerate</code> generates a matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Psigenerate(p)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Psigenerate_+3A_p">p</code></td>
<td>
<p>Integer, polynomial order.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is an internal function, and should not be called by users.
</p>


<h3>Value</h3>

<p>Returns a matrix.
</p>

<hr>
<h2 id='rdbwdensity'>Bandwidth Selection for Manipulation Testing</h2><span id='topic+rdbwdensity'></span>

<h3>Description</h3>

<p><code>rdbwdensity</code> implements several data-driven bandwidth selection
methods useful to construct manipulation testing procedures using the local
polynomial density estimators proposed in Cattaneo, Jansson and Ma (2020).
</p>
<p>A companion <code>Stata</code> package is described in Cattaneo, Jansson and Ma (2018).
</p>
<p>Companion command: <code><a href="#topic+rddensity">rddensity</a></code> for manipulation (density discontinuity)
testing.
</p>
<p>Related Stata and R packages useful for inference in regression discontinuity (RD)
designs are described in the website: <a href="https://rdpackages.github.io/">https://rdpackages.github.io/</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rdbwdensity(
  X,
  c = 0,
  p = 2,
  fitselect = "",
  kernel = "",
  vce = "",
  massPoints = TRUE,
  regularize = TRUE,
  nLocalMin = NULL,
  nUniqueMin = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rdbwdensity_+3A_x">X</code></td>
<td>
<p>Numeric vector or one dimensional matrix/data frame, the running variable.</p>
</td></tr>
<tr><td><code id="rdbwdensity_+3A_c">c</code></td>
<td>
<p>Numeric, specifies the threshold or cutoff value in the support of <code>X</code>,
which determines the two samples (e.g., control and treatment units in RD settings).
Default is <code>0</code>.</p>
</td></tr>
<tr><td><code id="rdbwdensity_+3A_p">p</code></td>
<td>
<p>Nonnegative integer, specifies the local polynomial order used to construct
the density estimators. Default is <code>2</code> (local quadratic approximation).</p>
</td></tr>
<tr><td><code id="rdbwdensity_+3A_fitselect">fitselect</code></td>
<td>
<p>String, specifies the density estimation method.
<code>"unrestricted"</code> for density estimation without any restrictions (two-sample,
unrestricted inference). This is the default option.
<code>"restricted"</code> for density estimation assuming equal distribution function and
higher-order derivatives.</p>
</td></tr>
<tr><td><code id="rdbwdensity_+3A_kernel">kernel</code></td>
<td>
<p>String, specifies the kernel function used to construct the local
polynomial estimators.
<code>"triangular"</code>: <code>K(u)=(1-|u|)*(|u|&lt;=1)</code>. This is the
default option.
<code>"epanechnikov"</code>: <code>K(u) = 0.75*(1-u^2)*(|u|&lt;=1)</code>.
<code>"uniform"</code>: <code>K(u) = 0.5 * (|u|&lt;=1)</code>.</p>
</td></tr>
<tr><td><code id="rdbwdensity_+3A_vce">vce</code></td>
<td>
<p>String, specifies the procedure used to compute the variance-covariance matrix estimator.
<code>"plugin"</code> for asymptotic plug-in standard errors.
<code>"jackknife"</code> for jackknife standard errors. This is the default option.</p>
</td></tr>
<tr><td><code id="rdbwdensity_+3A_masspoints">massPoints</code></td>
<td>
<p><code>TRUE</code> (default) or <code>FALSE</code>, specifies whether to adjust for
mass points in the data.</p>
</td></tr>
<tr><td><code id="rdbwdensity_+3A_regularize">regularize</code></td>
<td>
<p><code>TRUE</code> (default) or <code>FALSE</code>, specifies whether to conduct local sample size checking.
When set to <code>TRUE</code>, the bandwidth is chosen such that the local region includes
at least <code>nLocalMin</code> observations and at least <code>nUniqueMin</code> unique observations.</p>
</td></tr>
<tr><td><code id="rdbwdensity_+3A_nlocalmin">nLocalMin</code></td>
<td>
<p>Nonnegative integer, specifies the minimum number of observations in each local neighborhood.
This option will be ignored if set to <code>0</code>, or if <code>regularize=FALSE</code> is used. Default is <code>20+p+1</code>.</p>
</td></tr>
<tr><td><code id="rdbwdensity_+3A_nuniquemin">nUniqueMin</code></td>
<td>
<p>Nonnegative integer, specifies the minimum number of unique observations in
each local neighborhood. This option will be ignored if set to <code>0</code>, or if <code>regularize=FALSE</code> is used.
Default is <code>20+p+1</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>h</code></td>
<td>
<p>Bandwidths for density discontinuity test, left and right to the cutoff, and asymptotic variance and bias.</p>
</td></tr>
<tr><td><code>N</code></td>
<td>
<p><code>full</code>: full sample size; <code>left</code>/<code>right</code>: sample size to the left/right of the cutoff.</p>
</td></tr>
<tr><td><code>opt</code></td>
<td>
<p>Options passed to the function.</p>
</td></tr>
<tr><td><code>X_min</code></td>
<td>
<p>Smallest observations to the left and right of the cutoff.</p>
</td></tr>
<tr><td><code>X_max</code></td>
<td>
<p>Largest observations to the left and right of the cutoff.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Matias D. Cattaneo, Princeton University  <a href="mailto:cattaneo@princeton.edu">cattaneo@princeton.edu</a>.
</p>
<p>Michael Jansson, University of California Berkeley.  <a href="mailto:mjansson@econ.berkeley.edu">mjansson@econ.berkeley.edu</a>.
</p>
<p>Xinwei Ma (maintainer), University of California San Diego. <a href="mailto:x1ma@ucsd.edu">x1ma@ucsd.edu</a>.
</p>


<h3>References</h3>

<p>Cattaneo, M. D., M. Jansson, and X. Ma. 2018. Manipulation Testing based on Density Discontinuity. <em>Stata Journal</em> 18(1): 234-261. <a href="https://doi.org/10.1177/1536867X1801800115">doi:10.1177/1536867X1801800115</a>
</p>
<p>Cattaneo, M. D., M. Jansson, and X. Ma. 2020. Simple Local Polynomial Density Estimators. <em>Journal of the American Statistical Association</em>, 115(531): 1449-1455. <a href="https://doi.org/10.1080/01621459.2019.1635480">doi:10.1080/01621459.2019.1635480</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rddensity">rddensity</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Generate a random sample
set.seed(42)
x &lt;- rnorm(2000, mean = -0.5)

# Bandwidth selection
summary(rdbwdensity(X = x, vce="jackknife"))

</code></pre>

<hr>
<h2 id='rddensity'>Manipulation Testing Using Local Polynomial Density Estimation</h2><span id='topic+rddensity'></span>

<h3>Description</h3>

<p><code>rddensity</code> implements manipulation testing procedures using the
local polynomial density estimators proposed in Cattaneo, Jansson and Ma (2020),
and implements graphical procedures with valid confidence bands using the results
in Cattaneo, Jansson and Ma (2022, 2023).  In addition, the command provides complementary
manipulation testing based on finite sample exact binomial testing following the
esults in Cattaneo, Frandsen and Titiunik (2015) and Cattaneo, Frandsen and
Vazquez-Bare (2017). For an introduction to manipulation testing see McCrary (2008).
</p>
<p>A companion <code>Stata</code> package is described in Cattaneo, Jansson and Ma (2018).
</p>
<p>Companion commands: <code><a href="#topic+rdbwdensity">rdbwdensity</a></code> for data-driven bandwidth selection, and
<code><a href="#topic+rdplotdensity">rdplotdensity</a></code> for density plots.
</p>
<p>Related Stata and R packages useful for inference in regression discontinuity (RD)
designs are described in the website: <a href="https://rdpackages.github.io/">https://rdpackages.github.io/</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rddensity(
  X,
  c = 0,
  p = 2,
  q = 0,
  fitselect = "",
  kernel = "",
  vce = "",
  massPoints = TRUE,
  h = c(),
  bwselect = "",
  all = FALSE,
  regularize = TRUE,
  nLocalMin = NULL,
  nUniqueMin = NULL,
  bino = TRUE,
  binoW = NULL,
  binoN = NULL,
  binoWStep = NULL,
  binoNStep = NULL,
  binoNW = 10,
  binoP = 0.5
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rddensity_+3A_x">X</code></td>
<td>
<p>Numeric vector or one dimensional matrix/data frame, the running variable.</p>
</td></tr>
<tr><td><code id="rddensity_+3A_c">c</code></td>
<td>
<p>Numeric, specifies the threshold or cutoff value in the support of <code>X</code>,
which determines the two samples (e.g., control and treatment units in RD settings).
Default is <code>0</code>.</p>
</td></tr>
<tr><td><code id="rddensity_+3A_p">p</code></td>
<td>
<p>Nonnegative integer, specifies the local polynomial order used to construct
the density estimators. Default is <code>2</code> (local quadratic approximation).</p>
</td></tr>
<tr><td><code id="rddensity_+3A_q">q</code></td>
<td>
<p>Nonnegative integer, specifies the local polynomial order used to construct
the bias-corrected density estimators. Default is <code>p+1</code> (local cubic approximation
for default <code>p=2</code>).</p>
</td></tr>
<tr><td><code id="rddensity_+3A_fitselect">fitselect</code></td>
<td>
<p>String, specifies the density estimation method.
<code>"unrestricted"</code> for density estimation without any restrictions (two-sample,
unrestricted inference). This is the default option.
<code>"restricted"</code> for density estimation assuming equal distribution function and
higher-order derivatives.</p>
</td></tr>
<tr><td><code id="rddensity_+3A_kernel">kernel</code></td>
<td>
<p>String, specifies the kernel function used to construct the local
polynomial estimators.
<code>"triangular"</code>: <code>K(u)=(1-|u|)*(|u|&lt;=1)</code>. This is the
default option.
<code>"epanechnikov"</code>: <code>K(u) = 0.75*(1-u^2)*(|u|&lt;=1)</code>.
<code>"uniform"</code>: <code>K(u) = 0.5 * (|u|&lt;=1)</code>.</p>
</td></tr>
<tr><td><code id="rddensity_+3A_vce">vce</code></td>
<td>
<p>String, specifies the procedure used to compute the variance-covariance matrix estimator.
<code>"plugin"</code> for asymptotic plug-in standard errors.
<code>"jackknife"</code> for jackknife standard errors. This is the default option.</p>
</td></tr>
<tr><td><code id="rddensity_+3A_masspoints">massPoints</code></td>
<td>
<p><code>TRUE</code> (default) or <code>FALSE</code>, specifies whether to adjust for
mass points in the data.</p>
</td></tr>
<tr><td><code id="rddensity_+3A_h">h</code></td>
<td>
<p>Numeric, specifies the bandwidth used to construct the density estimators on the two
sides of the cutoff.  If not specified, the bandwidth h is computed by the companion command
<code><a href="#topic+rdbwdensity">rdbwdensity</a></code>  If two bandwidths are specified, the first bandwidth is used
for the data below the cutoff and the second bandwidth is used for the data above the cutoff.</p>
</td></tr>
<tr><td><code id="rddensity_+3A_bwselect">bwselect</code></td>
<td>
<p>String, specifies the bandwidth selection procedure to be used.
<code>"each"</code> based on MSE of each density estimator separately (two distinct bandwidths, <code>hl</code> and <code>hr</code>).
<code>"diff"</code> based on MSE of difference of two density estimators (one common bandwidth, <code>hl=hr</code>).
<code>"sum"</code> based on MSE of sum of two density estimators (one common bandwidth, <code>hl=hr</code>).
<code>"comb"</code> bandwidth is selected as a combination of the alternatives above. This is the default option.
For <code>fitselect="unrestricted"</code>, it selects <code>median(each,diff,sum)</code>. For <code>fitselect = "restricted"</code>,
it selects <code>min(diff,sum)</code>.</p>
</td></tr>
<tr><td><code id="rddensity_+3A_all">all</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code> (default), if specified, will report two
testing procedures: conventional test statistic (not valid when using MSE-optimal bandwidth choice)
and robust bias-corrected statistic.</p>
</td></tr>
<tr><td><code id="rddensity_+3A_regularize">regularize</code></td>
<td>
<p><code>TRUE</code> (default) or <code>FALSE</code>, specifies whether to conduct local sample size checking.
When set to <code>TRUE</code>, the bandwidth is chosen such that the local region includes
at least <code>nLocalMin</code> observations and at least <code>nUniqueMin</code> unique observations.</p>
</td></tr>
<tr><td><code id="rddensity_+3A_nlocalmin">nLocalMin</code></td>
<td>
<p>Nonnegative integer, specifies the minimum number of observations in each local neighborhood.
This option will be ignored if set to <code>0</code>, or if <code>regularize=FALSE</code> is used. Default is <code>20+p+1</code>.</p>
</td></tr>
<tr><td><code id="rddensity_+3A_nuniquemin">nUniqueMin</code></td>
<td>
<p>Nonnegative integer, specifies the minimum number of unique observations in
each local neighborhood. This option will be ignored if set to <code>0</code>, or if <code>regularize=FALSE</code> is used.
Default is <code>20+p+1</code>.</p>
</td></tr>
<tr><td><code id="rddensity_+3A_bino">bino</code></td>
<td>
<p><code>TRUE</code> (default) or <code>FALSE</code>, specifies whether to conduct binomial tests. By default,
the initial (smallest) window contains at least 20 observations on each side, and its length is also used as the increment
for subsequent windows. This feature is based on the <code><a href="stats.html#topic+binom.test">binom.test</a></code> function.</p>
</td></tr>
<tr><td><code id="rddensity_+3A_binow">binoW</code></td>
<td>
<p>Numeric, specifies the half length(s) of the initial window. If two values are provided, they will
be used for the data below and above the cutoff separately.</p>
</td></tr>
<tr><td><code id="rddensity_+3A_binon">binoN</code></td>
<td>
<p>Nonnegative integer, specifies the minimum number of observations on each side of the cutoff used for
the binomial test. This option will be ignored if <code>binoW</code> is provided.</p>
</td></tr>
<tr><td><code id="rddensity_+3A_binowstep">binoWStep</code></td>
<td>
<p>Numeric, specifies the increment in half length(s).</p>
</td></tr>
<tr><td><code id="rddensity_+3A_binonstep">binoNStep</code></td>
<td>
<p>Nonnegative integer, specifies the minimum increment in sample size (on each side of the cutoff).
This option will be ignored if <code>binoWStep</code> is provided.</p>
</td></tr>
<tr><td><code id="rddensity_+3A_binonw">binoNW</code></td>
<td>
<p>Nonnegative integer, specifies the total number of windows. Default is <code>10</code>.</p>
</td></tr>
<tr><td><code id="rddensity_+3A_binop">binoP</code></td>
<td>
<p>Numeric, specifies the null hypothesis of the binomial test. Default is <code>0.5</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>hat</code></td>
<td>
<p><code>left</code>/<code>right</code>: density estimate to the left/right of cutoff; <code>diff</code>: difference in
estimated densities on the two sides of cutoff.</p>
</td></tr>
<tr><td><code>sd_asy</code></td>
<td>
<p><code>left</code>/<code>right</code>: standard error for the estimated density to the left/right of the
cutoff; <code>diff</code>: standard error for the difference in estimated densities. (Based on
asymptotic formula.)</p>
</td></tr>
<tr><td><code>sd_jk</code></td>
<td>
<p><code>left</code>/<code>right</code>: standard error for the estimated density to the left/right of the
cutoff; <code>diff</code>: standard error for the difference in estimated densities. (Based on the
jackknife method.)</p>
</td></tr>
<tr><td><code>test</code></td>
<td>
<p><code>t_asy</code>/<code>t_jk</code>: t-statistic for the density discontinuity test, with standard error
based on asymptotic formula or the jackknife; <code>p_asy</code>/<code>p_jk</code>: p-value for the density
discontinuity test, with standard error based on asymptotic formula or the jackknife.</p>
</td></tr>
<tr><td><code>hat_p</code></td>
<td>
<p>Same as <code>hat</code>, without bias correction (only available when <code>all=TRUE</code>).</p>
</td></tr>
<tr><td><code>sd_asy_p</code></td>
<td>
<p>Same as <code>sd_asy</code>, without bias correction (only available when <code>all=TRUE</code>).</p>
</td></tr>
<tr><td><code>sd_jk_p</code></td>
<td>
<p>Same as <code>sd_jk</code>, without bias correction (only available when <code>all=TRUE</code>).</p>
</td></tr>
<tr><td><code>test_p</code></td>
<td>
<p>Same as <code>test</code>, without bias correction (only available when <code>all=TRUE</code>).</p>
</td></tr>
<tr><td><code>N</code></td>
<td>
<p><code>full</code>: full sample size; <code>left</code>/<code>right</code>: sample size to the left/right of the cutoff;
<code>eff_left</code>/<code>eff_right</code>: effective sample size to the left/right of the cutoff (this depends
on the bandwidth).</p>
</td></tr>
<tr><td><code>h</code></td>
<td>
<p><code>left</code>/<code>right</code>: bandwidth used to the left/right of the cutoff.</p>
</td></tr>
<tr><td><code>opt</code></td>
<td>
<p>Options passed to the function.</p>
</td></tr>
<tr><td><code>bino</code></td>
<td>
<p>Binomial test results. <code>leftWindow</code>/<code>rightWindow</code>: window lengths.
<code>leftN</code>/<code>rightN</code>: number of observations. <code>pval</code>: p-values.</p>
</td></tr>
<tr><td><code>X_min</code></td>
<td>
<p><code>left</code>/<code>right</code>: the samllest observation to the left/right of the cutoff.</p>
</td></tr>
<tr><td><code>X_max</code></td>
<td>
<p><code>left</code>/<code>right</code>: the largest observation to the left/right of the cutoff.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Matias D. Cattaneo, Princeton University  <a href="mailto:cattaneo@princeton.edu">cattaneo@princeton.edu</a>.
</p>
<p>Michael Jansson, University of California Berkeley.  <a href="mailto:mjansson@econ.berkeley.edu">mjansson@econ.berkeley.edu</a>.
</p>
<p>Xinwei Ma (maintainer), University of California San Diego. <a href="mailto:x1ma@ucsd.edu">x1ma@ucsd.edu</a>.
</p>


<h3>References</h3>

<p>Cattaneo, M. D., B. Frandsen, and R. Titiunik. 2015. Randomization Inference in the Regression Discontinuity Design: An Application to the Study of Party Advantages in the U.S. Senate. <em>Journal of Causal Inference</em> 3(1): 1-24. <a href="https://doi.org/10.1515/jci-2013-0010">doi:10.1515/jci-2013-0010</a>
</p>
<p>Cattaneo, M. D., M. Jansson, and X. Ma. 2018. Manipulation Testing based on Density Discontinuity. <em>Stata Journal</em> 18(1): 234-261. <a href="https://doi.org/10.1177/1536867X1801800115">doi:10.1177/1536867X1801800115</a>
</p>
<p>Cattaneo, M. D., M. Jansson, and X. Ma. 2020. Simple Local Polynomial Density Estimators. <em>Journal of the American Statistical Association</em>, 115(531): 1449-1455. <a href="https://doi.org/10.1080/01621459.2019.1635480">doi:10.1080/01621459.2019.1635480</a>
</p>
<p>Cattaneo, M. D., M. Jansson, and X. Ma. 2022. lpdensity: Local Polynomial Density Estimation and Inference. <em>Journal of Statistical Software</em>, 101(2): 1–25. <a href="https://doi.org/10.18637/jss.v101.i02">doi:10.18637/jss.v101.i02</a>
</p>
<p>Cattaneo, M. D., M. Jansson, and X. Ma. 2023. Local Regression Distribution Estimators. <em>Journal of Econometrics</em>, 240(2): 105074. <a href="https://doi.org/10.1016/j.jeconom.2021.01.006">doi:10.1016/j.jeconom.2021.01.006</a>
</p>
<p>Cattaneo, M. D., R. Titiunik and G. Vazquez-Bare. 2017. Comparing Inference Approaches for RD Designs: A Reexamination of the Effect of Head Start on Child Mortality. <em>Journal of Policy Analysis and Management</em> 36(3): 643-681. <a href="https://doi.org/10.1002/pam.21985">doi:10.1002/pam.21985</a>
</p>
<p>McCrary, J. 2008. Manipulation of the Running Variable in the Regression Discontinuity Design: A Density Test. <em>Journal of Econometrics</em> 142(2): 698-714. <a href="https://doi.org/10.1016/j.jeconom.2007.05.005">doi:10.1016/j.jeconom.2007.05.005</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rdbwdensity">rdbwdensity</a></code>, <code><a href="#topic+rdplotdensity">rdplotdensity</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>### Continuous Density
set.seed(42)
x &lt;- rnorm(2000, mean = -0.5)
rdd &lt;- rddensity(X = x, vce = "jackknife")
summary(rdd)

### Bandwidth selection using rdbwdensity()
rddbw &lt;- rdbwdensity(X = x, vce = "jackknife")
summary(rddbw)

### Plotting using rdplotdensity()
# 1. From -2 to 2 with 25 evaluation points at each side
plot1 &lt;- rdplotdensity(rdd, x, plotRange = c(-2, 2), plotN = 25)

# 2. Plotting a uniform confidence band
set.seed(42) # fix the seed for simulating critical values
plot2 &lt;- rdplotdensity(rdd, x, plotRange = c(-2, 2), plotN = 25, CIuniform = TRUE)

### Density discontinuity at 0
x[x &gt; 0] &lt;- x[x &gt; 0] * 2
rdd2 &lt;- rddensity(X = x, vce = "jackknife")
summary(rdd2)
plot3 &lt;- rdplotdensity(rdd2, x, plotRange = c(-2, 2), plotN = 25)

</code></pre>

<hr>
<h2 id='rddensity_fV'>Internal function, implements density test.</h2><span id='topic+rddensity_fV'></span>

<h3>Description</h3>

<p><code>rddensity_fV</code> generates primitive results for the density test.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rddensity_fV(
  Y,
  X,
  Nl,
  Nr,
  Nlh,
  Nrh,
  hl,
  hr,
  p,
  s,
  kernel,
  fitselect,
  vce,
  massPoints
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rddensity_fV_+3A_y">Y</code></td>
<td>
<p>Numeric vector or data matrix, the estimated c.d.f.</p>
</td></tr>
<tr><td><code id="rddensity_fV_+3A_x">X</code></td>
<td>
<p>Numeric vector or data matrix, the running variable</p>
</td></tr>
<tr><td><code id="rddensity_fV_+3A_nl">Nl</code>, <code id="rddensity_fV_+3A_nr">Nr</code></td>
<td>
<p>Integers, sample sizes to the left and right of cutoff.</p>
</td></tr>
<tr><td><code id="rddensity_fV_+3A_nlh">Nlh</code>, <code id="rddensity_fV_+3A_nrh">Nrh</code></td>
<td>
<p>Integers, sample sizes to the left and right of cutoff,
within bandwidth</p>
</td></tr>
<tr><td><code id="rddensity_fV_+3A_hl">hl</code>, <code id="rddensity_fV_+3A_hr">hr</code></td>
<td>
<p>Numeric, bandwidth to the left and right of cutoff.</p>
</td></tr>
<tr><td><code id="rddensity_fV_+3A_p">p</code></td>
<td>
<p>Integer, polynomial order</p>
</td></tr>
<tr><td><code id="rddensity_fV_+3A_s">s</code></td>
<td>
<p>Integer, higher order derivative estimate</p>
</td></tr>
<tr><td><code id="rddensity_fV_+3A_kernel">kernel</code></td>
<td>
<p>String, the kernel function, can be <code>triangular</code> (default),
<code>uniform</code> or <code>epanechnikov</code>.</p>
</td></tr>
<tr><td><code id="rddensity_fV_+3A_fitselect">fitselect</code></td>
<td>
<p>String, the model, can be <code>restricted</code> or <code>unrestricted</code></p>
</td></tr>
<tr><td><code id="rddensity_fV_+3A_vce">vce</code></td>
<td>
<p>String, specifies the procedure used to compute the variance-covariance matrix estimator. Options are:
<code>"plugin"</code> for asymptotic plug-in standard errors. <code>"jackknife"</code> for jackknife standard errors.</p>
</td></tr>
<tr><td><code id="rddensity_fV_+3A_masspoints">massPoints</code></td>
<td>
<p>Boolean, whether whether point estimates and standard errors</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is an internal function, and should not be called by users.
NOTE: data is assumed to be on ascending order.
</p>


<h3>Value</h3>

<p>Returns a data frame for further use.
</p>

<hr>
<h2 id='rddensity_H'>Internal function, normal distribution related quantities.</h2><span id='topic+rddensity_H'></span>

<h3>Description</h3>

<p><code>rddensity_H</code> calculates normal densities and derivatives.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rddensity_H(x, p)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rddensity_H_+3A_x">x</code></td>
<td>
<p>Numeric, point of evaluation.</p>
</td></tr>
<tr><td><code id="rddensity_H_+3A_p">p</code></td>
<td>
<p>Integer, polynomial order</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is an internal function, and should not be called by users.
</p>


<h3>Value</h3>

<p>Returns density or derivatives.
</p>

<hr>
<h2 id='rddensity_senate'>RD Senate Data</h2><span id='topic+rddensity_senate'></span><span id='topic+margin'></span>

<h3>Description</h3>

<p>Extract of the dataset constructed by Cattaneo, Frandsen, and Titiunik (2015),
which include measures of incumbency advantage in the U.S. Senate for the
period 1914-2010.
</p>


<h3>Format</h3>

<p>Numeric vector containing 1390 observations:
</p>

<dl>
<dt>margin</dt><dd><p>Numeric vector. See Cattaneo, Frandsen and Titiunik (2015) regarding details about this dataset.</p>
</dd>
</dl>



<h3>Source</h3>

<p>Cattaneo, M. D., B. Frandsen, and R. Titiunik. 2015. Randomization Inference in the Regression Discontinuity Design: An Application to the Study of Party Advantages in the U.S. Senate. <em>Journal of Causal Inference</em> 3(1): 1-24. <a href="https://doi.org/10.1515/jci-2013-0010">doi:10.1515/jci-2013-0010</a>
</p>

<hr>
<h2 id='rddensityUnique'>Internal function.</h2><span id='topic+rddensityUnique'></span>

<h3>Description</h3>

<p>Find unique elements and their frequencies in a numeric vector. This function
has a similar performance as the built-in R function <code>unique</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rddensityUnique(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rddensityUnique_+3A_x">x</code></td>
<td>
<p>Numeric vector, already sorted in ascending order.</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>unique</code></td>
<td>
<p>A vector containing unique elements in <code>x</code>.</p>
</td></tr>
<tr><td><code>freq</code></td>
<td>
<p>The frequency of each element in <code>x</code>.</p>
</td></tr>
<tr><td><code>index</code></td>
<td>
<p>The last occurrence of each element in <code>x</code>.</p>
</td></tr>
</table>

<hr>
<h2 id='rdplotdensity'>Density Plotting for Manipulation Testing</h2><span id='topic+rdplotdensity'></span>

<h3>Description</h3>

<p><code>rdplotdensity</code> constructs density plots. It is based on the
local polynomial density estimator proposed in Cattaneo, Jansson and Ma (2020, 2023).
A companion <code>Stata</code> package is described in Cattaneo, Jansson and Ma (2018).
</p>
<p>Companion command: <code><a href="#topic+rddensity">rddensity</a></code> for manipulation (density discontinuity) testing.
</p>
<p>Related Stata and R packages useful for inference in regression discontinuity (RD)
designs are described in the website: <a href="https://rdpackages.github.io/">https://rdpackages.github.io/</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rdplotdensity(
  rdd,
  X,
  plotRange = NULL,
  plotN = 10,
  plotGrid = c("es", "qs"),
  alpha = 0.05,
  type = NULL,
  lty = NULL,
  lwd = NULL,
  lcol = NULL,
  pty = NULL,
  pwd = NULL,
  pcol = NULL,
  CItype = NULL,
  CIuniform = FALSE,
  CIsimul = 2000,
  CIshade = NULL,
  CIcol = NULL,
  bwselect = NULL,
  hist = TRUE,
  histBreaks = NULL,
  histFillCol = 3,
  histFillShade = 0.2,
  histLineCol = "white",
  title = "",
  xlabel = "",
  ylabel = "",
  legendTitle = NULL,
  legendGroups = NULL,
  noPlot = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rdplotdensity_+3A_rdd">rdd</code></td>
<td>
<p>Object returned by <code><a href="#topic+rddensity">rddensity</a></code></p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_x">X</code></td>
<td>
<p>Numeric vector or one dimensional matrix/data frame, the running variable.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_plotrange">plotRange</code></td>
<td>
<p>Numeric, specifies the lower and upper bound of the plotting region.  Default is
<code>[c-3*hl,c+3*hr]</code> (three bandwidths around the cutoff).</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_plotn">plotN</code></td>
<td>
<p>Numeric, specifies the number of grid points used for plotting on the two sides of the cutoff.
Default is <code>c(10,10)</code> (i.e., 10 points are used on each side).</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_plotgrid">plotGrid</code></td>
<td>
<p>String, specifies how the grid points are positioned.  Options are <code>es</code> (evenly spaced)
and <code>qs</code> (quantile spaced).</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_alpha">alpha</code></td>
<td>
<p>Numeric scalar between 0 and 1, the significance level for plotting
confidence regions. If more than one is provided, they will be applied to the two sides
accordingly.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_type">type</code></td>
<td>
<p>String, one of <code>"line"</code> (default), <code>"points"</code> or <code>"both"</code>, how
the point estimates are plotted. If more than one is provided, they will be applied to the two sides
accordingly.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_lty">lty</code></td>
<td>
<p>Line type for point estimates, only effective if <code>type</code> is <code>"line"</code> or
<code>"both"</code>. <code>1</code> for solid line, <code>2</code> for dashed line, <code>3</code> for dotted line.
For other options, see the instructions for <code>ggplot2</code> or <code><a href="graphics.html#topic+par">par</a></code>. If
more than one is provided, they will be applied to the two sides accordingly.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_lwd">lwd</code></td>
<td>
<p>Line width for point estimates, only effective if <code>type</code> is <code>"line"</code> or
<code>"both"</code>. Should be strictly positive. For other options, see the instructions for
<code>ggplot2</code> or <code><a href="graphics.html#topic+par">par</a></code>. If more than one is provided, they will be applied
to the two sides accordingly.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_lcol">lcol</code></td>
<td>
<p>Line color for point estimates, only effective if <code>type</code> is <code>"line"</code> or
<code>"both"</code>. <code>1</code> for black, <code>2</code> for red, <code>3</code> for green, <code>4</code> for blue.
For other options, see the instructions for <code>ggplot2</code> or <code><a href="graphics.html#topic+par">par</a></code>. If
more than one is provided, they will be applied to the two sides
accordingly.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_pty">pty</code></td>
<td>
<p>Scatter plot type for point estimates, only effective if <code>type</code> is <code>"points"</code> or
<code>"both"</code>. For options, see the instructions for <code>ggplot2</code> or <code><a href="graphics.html#topic+par">par</a></code>. If
more than one is provided, they will be applied to the two sides
accordingly.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_pwd">pwd</code></td>
<td>
<p>Scatter plot size for point estimates, only effective if <code>type</code> is <code>"points"</code> or
<code>"both"</code>. Should be strictly positive. If more than one is provided, they will be applied to the two sides
accordingly.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_pcol">pcol</code></td>
<td>
<p>Scatter plot color for point estimates, only effective if <code>type</code> is <code>"points"</code> or
<code>"both"</code>. <code>1</code> for black, <code>2</code> for red, <code>3</code>
for green, <code>4</code> for blue.
For other options, see the instructions for <code>ggplot2</code> or <code><a href="graphics.html#topic+par">par</a></code>. If
more than one is provided, they will be applied to the two sides
accordingly.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_citype">CItype</code></td>
<td>
<p>String, one of <code>"region"</code> (shaded region, default), <code>"line"</code> (dashed lines),
<code>"ebar"</code> (error bars), <code>"all"</code> (all of the previous) or <code>"none"</code> (no confidence region),
how the confidence region should be plotted. If more than one is provided, they will be applied to the two sides
accordingly.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_ciuniform">CIuniform</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code> (default), plotting either pointwise confidence intervals (<code>FALSE</code>) or
uniform confidence bands (<code>TRUE</code>).</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_cisimul">CIsimul</code></td>
<td>
<p>Positive integer, the number of simulations used to construct critical values (default is 2000). This
option is ignored if <code>CIuniform=FALSE</code>.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_cishade">CIshade</code></td>
<td>
<p>Numeric, opaqueness of the confidence region, should be between 0 (transparent) and
1. Default is 0.2. If more than one is provided, they will be applied to the two sides
accordingly.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_cicol">CIcol</code></td>
<td>
<p>Color of the confidence region. <code>1</code> for black, <code>2</code> for red, <code>3</code>
for green, <code>4</code> for blue.
For other options, see the instructions for <code>ggplot2</code> or <code><a href="graphics.html#topic+par">par</a></code>. If
more than one is provided, they will be applied to the two sides
accordingly.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_bwselect">bwselect</code></td>
<td>
<p>String, the method for data-driven bandwidth selection. Available options
are (1) <code>"mse-dpi"</code> (mean squared error-optimal bandwidth selected for each grid point);
(2) <code>"imse-dpi"</code> (integrated MSE-optimal bandwidth, common for all grid points);
(3) <code>"mse-rot"</code> (rule-of-thumb bandwidth with Gaussian reference model);
and (4) <code>"imse-rot"</code> (integrated rule-of-thumb bandwidth with Gaussian reference model).
If omitted, bandwidths returned by <code>rddensity</code> will be used.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_hist">hist</code></td>
<td>
<p><code>TRUE</code> (default) or <code>FALSE</code>, whether adding a histogram to the background.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_histbreaks">histBreaks</code></td>
<td>
<p>Numeric vector, giving the breakpoints between histogram cells.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_histfillcol">histFillCol</code></td>
<td>
<p>Color of the histogram cells.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_histfillshade">histFillShade</code></td>
<td>
<p>Opaqueness of the histogram cells, should be between 0 (transparent) and
1. Default is 0.2.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_histlinecol">histLineCol</code></td>
<td>
<p>Color of the histogram lines.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_title">title</code>, <code id="rdplotdensity_+3A_xlabel">xlabel</code>, <code id="rdplotdensity_+3A_ylabel">ylabel</code></td>
<td>
<p>Strings, title of the plot and labels for x- and y-axis.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_legendtitle">legendTitle</code></td>
<td>
<p>String, title of legend.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_legendgroups">legendGroups</code></td>
<td>
<p>String Vector, group names used in legend.</p>
</td></tr>
<tr><td><code id="rdplotdensity_+3A_noplot">noPlot</code></td>
<td>
<p>No density plot will be generated if set to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Bias correction is only used for the construction of confidence intervals/bands, but not for point
estimation. The point estimates, denoted by <code>f_p</code>, are constructed using local polynomial estimates of order
<code>p</code>, while the centering of the confidence intervals/bands, denoted by <code>f_q</code>, are constructed using local
polynomial estimates of order <code>q</code>. The confidence intervals/bands take the form:
<code>[f_q - cv * SE(f_q) , f_q + cv * SE(f_q)]</code>, where <code>cv</code> denotes the appropriate critical value and
<code>SE(f_q)</code> denotes a standard error estimate
for the centering of the confidence interval/band. As a result, the confidence intervals/bands may not be
centered at the point estimates because they have been bias-corrected. Setting <code>q</code> and <code>p</code> to be equal
results on centered at the point estimate confidence intervals/bands, but requires undersmoothing for valid
inference (i.e., (I)MSE-optimal bandwdith for the density point estimator cannot be used).  Hence the bandwidth
would need to be specified manually when <code>q=p</code>, and the point estimates will not be (I)MSE optimal. See
Cattaneo, Jansson and Ma (2022, 2023) for details, and also Calonico, Cattaneo, and Farrell (2018, 2022) for
robust bias correction methods.
</p>
<p>Sometimes the density point estimates may lie outside of the confidence intervals/bands, which can happen if
the underlying distribution exhibits high curvature at some evaluation point(s).  One possible solution in this
case is to increase the polynomial order <code>p</code> or to employ a smaller bandwidth.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>Estl</code>, <code>Estr</code></td>
<td>
<p>Matrices containing estimation results:
(1) <code>grid</code> (grid points),
(2) <code>bw</code> (bandwidths),
(3) <code>nh</code> (number of observations in each local neighborhood),
(4) <code>nhu</code> (number of unique observations in each local neighborhood),
(5) <code>f_p</code> (point estimates with p-th order local polynomial),
(6) <code>f_q</code> (point estimates with q-th order local polynomial, only if option <code>q</code> is nonzero),
(7) <code>se_p</code> (standard error corresponding to <code>f_p</code>), and (8) <code>se_q</code> (standard error
corresponding to <code>f_q</code>).
Variance-covariance matrix corresponding to <code>f_p</code>.
Variance-covariance matrix corresponding to <code>f_q</code>.
A list containing options passed to the function.</p>
</td></tr>
<tr><td><code>Estplot</code></td>
<td>
<p>A stadnard <code>ggplot</code> object is returned, hence can be used for further customization.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Matias D. Cattaneo, Princeton University  <a href="mailto:cattaneo@princeton.edu">cattaneo@princeton.edu</a>.
</p>
<p>Michael Jansson, University of California Berkeley.  <a href="mailto:mjansson@econ.berkeley.edu">mjansson@econ.berkeley.edu</a>.
</p>
<p>Xinwei Ma (maintainer), University of California San Diego. <a href="mailto:x1ma@ucsd.edu">x1ma@ucsd.edu</a>.
</p>


<h3>References</h3>

<p>Calonico, S., M. D. Cattaneo, and M. H. Farrell. 2018. On the Effect of Bias Estimation on Coverage Accuracy in Nonparametric Inference. <em>Journal of the American Statistical Association</em> 113(522): 767-779. <a href="https://doi.org/10.1080/01621459.2017.1285776">doi:10.1080/01621459.2017.1285776</a>
</p>
<p>Calonico, S., M. D. Cattaneo, and M. H. Farrell. 2022. Coverage Error Optimal Confidence Intervals for Local Polynomial Regression. <em>Bernoulli</em>, 28(4): 2998-3022. <a href="https://doi.org/10.3150/21-BEJ1445">doi:10.3150/21-BEJ1445</a>
</p>
<p>Cattaneo, M. D., M. Jansson, and X. Ma. 2018. Manipulation Testing based on Density Discontinuity. <em>Stata Journal</em> 18(1): 234-261. <a href="https://doi.org/10.1177/1536867X1801800115">doi:10.1177/1536867X1801800115</a>
</p>
<p>Cattaneo, M. D., M. Jansson, and X. Ma. 2020. Simple Local Polynomial Density Estimators. <em>Journal of the American Statistical Association</em>, 115(531): 1449-1455. <a href="https://doi.org/10.1080/01621459.2019.1635480">doi:10.1080/01621459.2019.1635480</a>
</p>
<p>Cattaneo, M. D., M. Jansson, and X. Ma. 2022. lpdensity: Local Polynomial Density Estimation and Inference. <em>Journal of Statistical Software</em>, 101(2): 1–25. <a href="https://doi.org/10.18637/jss.v101.i02">doi:10.18637/jss.v101.i02</a>
</p>
<p>Cattaneo, M. D., M. Jansson, and X. Ma. 2023. Local Regression Distribution Estimators. <em>Journal of Econometrics</em>, 240(2): 105074. <a href="https://doi.org/10.1016/j.jeconom.2021.01.006">doi:10.1016/j.jeconom.2021.01.006</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rddensity">rddensity</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Generate a random sample with a density discontinuity at 0
set.seed(42)
x &lt;- rnorm(2000, mean = -0.5)
x[x &gt; 0] &lt;- x[x &gt; 0] * 2

# Estimation
rdd &lt;- rddensity(X = x)
summary(rdd)

# Density plot (from -2 to 2 with 25 evaluation points at each side)
plot1 &lt;- rdplotdensity(rdd, x, plotRange = c(-2, 2), plotN = 25)

# Plotting a uniform confidence band
set.seed(42) # fix the seed for simulating critical values
plot3 &lt;- rdplotdensity(rdd, x, plotRange = c(-2, 2), plotN = 25, CIuniform = TRUE)

</code></pre>

<hr>
<h2 id='Sgenerate'>Internal function, generate matrices.</h2><span id='topic+Sgenerate'></span>

<h3>Description</h3>

<p><code>Sgenerate</code> generates a matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Sgenerate(p, low = -1, up = 1, kernel = "triangular")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Sgenerate_+3A_p">p</code></td>
<td>
<p>Integer, polynomial order.</p>
</td></tr>
<tr><td><code id="Sgenerate_+3A_low">low</code>, <code id="Sgenerate_+3A_up">up</code></td>
<td>
<p>Numeric, lower and upper limits of integration, -1 and 1 by
default.</p>
</td></tr>
<tr><td><code id="Sgenerate_+3A_kernel">kernel</code></td>
<td>
<p>String, the kernel function, can be <code>triangular</code> (default),
<code>uniform</code> or <code>epanechnikov</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is an internal function, and should not be called by users.
</p>


<h3>Value</h3>

<p>Returns a matrix.
</p>

<hr>
<h2 id='Sminusgenerate'>Internal function, generate matrices.</h2><span id='topic+Sminusgenerate'></span>

<h3>Description</h3>

<p><code>Sminusgenerate</code> generates a matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Sminusgenerate(p, kernel = "triangular")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Sminusgenerate_+3A_p">p</code></td>
<td>
<p>Integer, polynomial order.</p>
</td></tr>
<tr><td><code id="Sminusgenerate_+3A_kernel">kernel</code></td>
<td>
<p>String, the kernel function, can be <code>triangular</code> (default),
<code>uniform</code> or <code>epanechnikov</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is an internal function, and should not be called by users.
</p>


<h3>Value</h3>

<p>Returns a matrix.
</p>

<hr>
<h2 id='Splusgenerate'>Internal function, generate matrices.</h2><span id='topic+Splusgenerate'></span>

<h3>Description</h3>

<p><code>Splusgenerate</code> generates a matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Splusgenerate(p, kernel = "triangular")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Splusgenerate_+3A_p">p</code></td>
<td>
<p>Integer, polynomial order.</p>
</td></tr>
<tr><td><code id="Splusgenerate_+3A_kernel">kernel</code></td>
<td>
<p>String, the kernel function, can be <code>triangular</code> (default),
<code>uniform</code> or <code>epanechnikov</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is an internal function, and should not be called by users.
</p>


<h3>Value</h3>

<p>Returns a matrix.
</p>

<hr>
<h2 id='summary.CJMrdbwdensity'>Internal function.</h2><span id='topic+summary.CJMrdbwdensity'></span>

<h3>Description</h3>

<p>Internal function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'CJMrdbwdensity'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.CJMrdbwdensity_+3A_object">object</code></td>
<td>
<p>Class <code>CJMrdbwdensity</code> objects.</p>
</td></tr>
</table>

<hr>
<h2 id='summary.CJMrddensity'>Internal function.</h2><span id='topic+summary.CJMrddensity'></span>

<h3>Description</h3>

<p>Internal function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'CJMrddensity'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.CJMrddensity_+3A_object">object</code></td>
<td>
<p>Class <code>CJMrddensity</code> objects.</p>
</td></tr>
</table>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
