<!DOCTYPE html><html><head><title>Help for package shapviz</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {shapviz}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#shapviz-package'><p>shapviz: SHAP Visualizations</p></a></li>
<li><a href='#+5B.shapviz'><p>Subsets &quot;shapviz&quot; Object</p></a></li>
<li><a href='#+2B.shapviz'><p>Rowbinds two &quot;shapviz&quot; Objects</p></a></li>
<li><a href='#c.shapviz'><p>Concatenates &quot;shapviz&quot; Objects</p></a></li>
<li><a href='#collapse_shap'><p>Collapse SHAP values</p></a></li>
<li><a href='#dim.shapviz'><p>Dimensions of &quot;shapviz&quot; Object</p></a></li>
<li><a href='#dimnames.shapviz'><p>Dimnames of &quot;shapviz&quot; Object</p></a></li>
<li><a href='#dimnames+26lt+3B-.shapviz'><p>Dimnames (Replacement Method) of &quot;shapviz&quot; Object</p></a></li>
<li><a href='#extractors'><p>Extractor Functions</p></a></li>
<li><a href='#format_max'><p>Number Formatter</p></a></li>
<li><a href='#is.mshapviz'><p>Check for mshapviz</p></a></li>
<li><a href='#is.shapviz'><p>Check for shapviz</p></a></li>
<li><a href='#miami'><p>Miami-Dade County House Prices</p></a></li>
<li><a href='#mshapviz'><p>Combines compatible &quot;shapviz&quot; Objects</p></a></li>
<li><a href='#potential_interactions'><p>Interaction Strength</p></a></li>
<li><a href='#print.mshapviz'><p>Prints &quot;mshapviz&quot; Object</p></a></li>
<li><a href='#print.shapviz'><p>Prints &quot;shapviz&quot; Object</p></a></li>
<li><a href='#rbind.shapviz'><p>Rowbinds Multiple &quot;shapviz&quot; or &quot;mshapviz&quot; Objects</p></a></li>
<li><a href='#shapviz'><p>Initialize &quot;shapviz&quot; Object</p></a></li>
<li><a href='#split.shapviz'><p>Splits &quot;shapviz&quot; Object</p></a></li>
<li><a href='#summary.shapviz'><p>Summarizes &quot;shapviz&quot; Object</p></a></li>
<li><a href='#sv_dependence'><p>SHAP Dependence Plot</p></a></li>
<li><a href='#sv_dependence2D'><p>2D SHAP Dependence Plot</p></a></li>
<li><a href='#sv_force'><p>SHAP Force Plot</p></a></li>
<li><a href='#sv_importance'><p>SHAP Importance Plots</p></a></li>
<li><a href='#sv_interaction'><p>SHAP Interaction Plot</p></a></li>
<li><a href='#sv_waterfall'><p>SHAP Waterfall Plot</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>SHAP Visualizations</td>
</tr>
<tr>
<td>Version:</td>
<td>0.9.3</td>
</tr>
<tr>
<td>Description:</td>
<td>Visualizations for SHAP (SHapley Additive exPlanations), such
    as waterfall plots, force plots, various types of importance plots,
    dependence plots, and interaction plots.  These plots act on a
    'shapviz' object created from a matrix of SHAP values and a
    corresponding feature dataset. Wrappers for the R packages 'xgboost',
    'lightgbm', 'fastshap', 'shapr', 'h2o', 'treeshap', 'DALEX', and
    'kernelshap' are added for convenience.  By separating visualization
    and computation, it is possible to display factor variables in graphs,
    even if the SHAP values are calculated by a model that requires
    numerical features. The plots are inspired by those provided by the
    'shap' package in Python, but there is no dependency on it.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6.0)</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Imports:</td>
<td>ggfittext (&ge; 0.8.0), gggenes, ggplot2 (&ge; 3.4.0), ggrepel,
grid, patchwork, rlang (&ge; 0.3.0), stats, utils, xgboost</td>
</tr>
<tr>
<td>Enhances:</td>
<td>fastshap, h2o, lightgbm</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/ModelOriented/shapviz">https://github.com/ModelOriented/shapviz</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ModelOriented/shapviz/issues">https://github.com/ModelOriented/shapviz/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-12 11:20:24 UTC; Michael</td>
</tr>
<tr>
<td>Author:</td>
<td>Michael Mayer [aut, cre],
  Adrian Stando [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Michael Mayer &lt;mayermichael79@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-12 11:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='shapviz-package'>shapviz: SHAP Visualizations</h2><span id='topic+shapviz-package'></span><span id='topic+_PACKAGE'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Visualizations for SHAP (SHapley Additive exPlanations), such as waterfall plots, force plots, various types of importance plots, dependence plots, and interaction plots. These plots act on a 'shapviz' object created from a matrix of SHAP values and a corresponding feature dataset. Wrappers for the R packages 'xgboost', 'lightgbm', 'fastshap', 'shapr', 'h2o', 'treeshap', 'DALEX', and 'kernelshap' are added for convenience. By separating visualization and computation, it is possible to display factor variables in graphs, even if the SHAP values are calculated by a model that requires numerical features. The plots are inspired by those provided by the 'shap' package in Python, but there is no dependency on it.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Michael Mayer <a href="mailto:mayermichael79@gmail.com">mayermichael79@gmail.com</a>
</p>
<p>Other contributors:
</p>

<ul>
<li><p> Adrian Stando <a href="mailto:adrian.j.stando@gmail.com">adrian.j.stando@gmail.com</a> [contributor]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/ModelOriented/shapviz">https://github.com/ModelOriented/shapviz</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/ModelOriented/shapviz/issues">https://github.com/ModelOriented/shapviz/issues</a>
</p>
</li></ul>


<hr>
<h2 id='+5B.shapviz'>Subsets &quot;shapviz&quot; Object</h2><span id='topic++5B.shapviz'></span>

<h3>Description</h3>

<p>Use standard square bracket subsetting to select rows and/or columns of
SHAP values, feature values, and SHAP interaction values of a &quot;shapviz&quot; object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'shapviz'
x[i, j, ...]
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="+2B5B.shapviz_+3A_x">x</code></td>
<td>
<p>An object of class &quot;shapviz&quot;.</p>
</td></tr>
<tr><td><code id="+2B5B.shapviz_+3A_i">i</code></td>
<td>
<p>Row subsetting.</p>
</td></tr>
<tr><td><code id="+2B5B.shapviz_+3A_j">j</code></td>
<td>
<p>Column subsetting.</p>
</td></tr>
<tr><td><code id="+2B5B.shapviz_+3A_...">...</code></td>
<td>
<p>Currently unused.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A new object of class &quot;shapviz&quot;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+shapviz">shapviz()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>S &lt;- matrix(c(1, -1, -1, 1), ncol = 2, dimnames = list(NULL, c("x", "y")))
X &lt;- data.frame(x = c("a", "b"), y = c(100, 10))
x &lt;- shapviz(S, X, baseline = 4)
x[1, "x"]
x[1]
x[c(FALSE, TRUE), ]
x[, "x"]
</code></pre>

<hr>
<h2 id='+2B.shapviz'>Rowbinds two &quot;shapviz&quot; Objects</h2><span id='topic++2B.shapviz'></span><span id='topic++2B.mshapviz'></span>

<h3>Description</h3>

<p>Rowbinds two &quot;shapviz&quot; objects using <code>+</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'shapviz'
e1 + e2

## S3 method for class 'mshapviz'
e1 + e2
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="+2B2B.shapviz_+3A_e1">e1</code></td>
<td>
<p>The first object of class &quot;shapviz&quot;.</p>
</td></tr>
<tr><td><code id="+2B2B.shapviz_+3A_e2">e2</code></td>
<td>
<p>The second object of class &quot;shapviz&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A new object of class &quot;shapviz&quot;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+shapviz">shapviz()</a></code>, <code><a href="#topic+rbind.shapviz">rbind.shapviz()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>S &lt;- matrix(c(1, -1, -1, 1), ncol = 2, dimnames = list(NULL, c("x", "y")))
X &lt;- data.frame(x = c("a", "b"), y = c(100, 10))
s1 &lt;- shapviz(S, X, baseline = 4)[1]
s2 &lt;- shapviz(S, X, baseline = 4)[2]
s &lt;- s1 + s2
s
# mshapviz
S &lt;- matrix(c(1, -1, -1, 1), ncol = 2, dimnames = list(NULL, c("x", "y")))
X &lt;- data.frame(x = c("a", "b"), y = c(100, 10))
s1 &lt;- shapviz(S, X, baseline = 4)[1L]
s2 &lt;- shapviz(S, X, baseline = 4)[2L]
s &lt;- mshapviz(c(shp1 = s1, shp2 = s2))
s + s

</code></pre>

<hr>
<h2 id='c.shapviz'>Concatenates &quot;shapviz&quot; Objects</h2><span id='topic+c.shapviz'></span>

<h3>Description</h3>

<p>This function combines two or more (usually named) &quot;shapviz&quot; objects
to an object of class &quot;mshapviz&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'shapviz'
c(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="c.shapviz_+3A_...">...</code></td>
<td>
<p>Any number of (optionally named) &quot;shapviz&quot; objects.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A &quot;mshapviz&quot; object.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mshapviz">mshapviz()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>S &lt;- matrix(c(1, -1, -1, 1), ncol = 2, dimnames = list(NULL, c("x", "y")))
X &lt;- data.frame(x = c("a", "b"), y = c(100, 10))
s1 &lt;- shapviz(S, X, baseline = 4)[1]
s2 &lt;- shapviz(S, X, baseline = 4)[2]
s &lt;- c(shp1 = s1, shp2 = s2)
s
</code></pre>

<hr>
<h2 id='collapse_shap'>Collapse SHAP values</h2><span id='topic+collapse_shap'></span>

<h3>Description</h3>

<p>This function sums up SHAP values (or SHAP interaction values) of feature groups.
Typical application: SHAP values have been generated by a model with one or multiple
one-hot encoded variables, but the explanations should be done using the
original factor.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>collapse_shap(S, collapse = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="collapse_shap_+3A_s">S</code></td>
<td>
<p>Either a (n x p) matrix of SHAP values or a (n x p x p) array of SHAP
interaction values.</p>
</td></tr>
<tr><td><code id="collapse_shap_+3A_collapse">collapse</code></td>
<td>
<p>A named list of character vectors. Each vector specifies the
feature names whose SHAP values need to be summed up.
The names determine the resulting collapsed column/dimension names.</p>
</td></tr>
<tr><td><code id="collapse_shap_+3A_...">...</code></td>
<td>
<p>Currently unused.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix of SHAP values, or an array of SHAP interaction values.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>S &lt;- cbind(
  x = c(0.1, 0.1, 0.1),
  `age low` = c(0.2, -0.1, 0.1),
  `age mid` = c(0, 0.2, -0.2),
  `age high` = c(1, -1, 0)
)
collapse &lt;- list(age = c("age low", "age mid", "age high"))
collapse_shap(S, collapse)

# Arrays (as with SHAP interactions)
S_inter &lt;- array(1, dim = c(2, 4, 4), dimnames = list(NULL, letters[1:4], letters[1:4]))
collapse_shap(S_inter, collapse = list(cd = c("c", "d"), ab = c("a", "b")))
</code></pre>

<hr>
<h2 id='dim.shapviz'>Dimensions of &quot;shapviz&quot; Object</h2><span id='topic+dim.shapviz'></span>

<h3>Description</h3>

<p>Dimensions of &quot;shapviz&quot; Object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'shapviz'
dim(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dim.shapviz_+3A_x">x</code></td>
<td>
<p>An object of class &quot;shapviz&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector of length two providing the number of rows and columns
of the SHAP matrix stored in <code>x</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+shapviz">shapviz()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>S &lt;- matrix(c(1, -1, -1, 1), ncol = 2, dimnames = list(NULL, c("x", "y")))
X &lt;- data.frame(x = c("a", "b"), y = c(100, 10))
x &lt;- shapviz(S, X)
dim(x)
nrow(x)
ncol(x)
</code></pre>

<hr>
<h2 id='dimnames.shapviz'>Dimnames of &quot;shapviz&quot; Object</h2><span id='topic+dimnames.shapviz'></span>

<h3>Description</h3>

<p>This implies to use <code>colnames(x)</code> to get the column names of the SHAP and feature
matrix (and optional SHAP interaction values).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'shapviz'
dimnames(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dimnames.shapviz_+3A_x">x</code></td>
<td>
<p>An object of class &quot;shapviz&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Dimnames of the SHAP matrix.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+shapviz">shapviz()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>S &lt;- matrix(c(1, -1, -1, 1), ncol = 2, dimnames = list(NULL, c("x", "y")))
X &lt;- data.frame(x = c("a", "b"), y = c(100, 10))
x &lt;- shapviz(S, X, baseline = 4)
dimnames(x)
colnames(x)
</code></pre>

<hr>
<h2 id='dimnames+26lt+3B-.shapviz'>Dimnames (Replacement Method) of &quot;shapviz&quot; Object</h2><span id='topic+dimnames+3C-.shapviz'></span>

<h3>Description</h3>

<p>This implies <code>colnames(x) &lt;- ...</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 replacement method for class 'shapviz'
dimnames(x) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dimnames+2B26lt+2B3B-.shapviz_+3A_x">x</code></td>
<td>
<p>An object of class &quot;shapviz&quot;.</p>
</td></tr>
<tr><td><code id="dimnames+2B26lt+2B3B-.shapviz_+3A_value">value</code></td>
<td>
<p>A list with rownames and column names compliant with SHAP matrix.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Like <code>x</code>, but with replaced dimnames.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+shapviz">shapviz()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>S &lt;- matrix(c(1, -1, -1, 1), ncol = 2, dimnames = list(NULL, c("x", "y")))
X &lt;- data.frame(x = c("a", "b"), y = c(100, 10))
x &lt;- shapviz(S, X, baseline = 4)
dimnames(x) &lt;- list(1:2, c("a", "b"))
dimnames(x)
colnames(x) &lt;- c("x", "y")
colnames(x)
</code></pre>

<hr>
<h2 id='extractors'>Extractor Functions</h2><span id='topic+extractors'></span><span id='topic+get_shap_values'></span><span id='topic+get_shap_values.shapviz'></span><span id='topic+get_shap_values.mshapviz'></span><span id='topic+get_shap_values.default'></span><span id='topic+get_feature_values'></span><span id='topic+get_feature_values.shapviz'></span><span id='topic+get_feature_values.mshapviz'></span><span id='topic+get_feature_values.default'></span><span id='topic+get_baseline'></span><span id='topic+get_baseline.shapviz'></span><span id='topic+get_baseline.mshapviz'></span><span id='topic+get_baseline.default'></span><span id='topic+get_shap_interactions'></span><span id='topic+get_shap_interactions.shapviz'></span><span id='topic+get_shap_interactions.mshapviz'></span><span id='topic+get_shap_interactions.default'></span>

<h3>Description</h3>

<p>Functions to extract SHAP values, feature values, the baseline,
or SHAP interactions from a &quot;(m)shapviz&quot; object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_shap_values(object, ...)

## S3 method for class 'shapviz'
get_shap_values(object, ...)

## S3 method for class 'mshapviz'
get_shap_values(object, ...)

## Default S3 method:
get_shap_values(object, ...)

get_feature_values(object, ...)

## S3 method for class 'shapviz'
get_feature_values(object, ...)

## S3 method for class 'mshapviz'
get_feature_values(object, ...)

## Default S3 method:
get_feature_values(object, ...)

get_baseline(object, ...)

## S3 method for class 'shapviz'
get_baseline(object, ...)

## S3 method for class 'mshapviz'
get_baseline(object, ...)

## Default S3 method:
get_baseline(object, ...)

get_shap_interactions(object, ...)

## S3 method for class 'shapviz'
get_shap_interactions(object, ...)

## S3 method for class 'mshapviz'
get_shap_interactions(object, ...)

## Default S3 method:
get_shap_interactions(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extractors_+3A_object">object</code></td>
<td>
<p>Object to extract something.</p>
</td></tr>
<tr><td><code id="extractors_+3A_...">...</code></td>
<td>
<p>Currently unused.</p>
</td></tr>
</table>


<h3>Value</h3>


<ul>
<li> <p><code>get_shap_values()</code> returns the matrix of SHAP values,
</p>
</li>
<li> <p><code>get_feature_values()</code> the <code>data.frame</code> of feature values,
</p>
</li>
<li> <p><code>get_baseline()</code> the numeric baseline value, and
</p>
</li>
<li> <p><code>get_shap_interactions()</code> the SHAP interactions of the input.
</p>
</li></ul>

<p>For objects of class &quot;mshapviz&quot;, these functions return lists of those elements.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>S &lt;- matrix(c(1, -1, -1, 1), ncol = 2, dimnames = list(NULL, c("x", "y")))
X &lt;- data.frame(x = c("a", "b"), y = c(100, 10))
shp &lt;- shapviz(S, X, baseline = 4)
get_shap_values(shp)
</code></pre>

<hr>
<h2 id='format_max'>Number Formatter</h2><span id='topic+format_max'></span>

<h3>Description</h3>

<p>Formats a numeric vector in a way that its largest absolute value determines
the number of digits after the decimal separator. This function is helpful in
perfectly aligning numbers on plots. Does not use scientific formatting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>format_max(x, digits = 4L, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="format_max_+3A_x">x</code></td>
<td>
<p>A numeric vector to be formatted.</p>
</td></tr>
<tr><td><code id="format_max_+3A_digits">digits</code></td>
<td>
<p>Number of significant digits of the largest absolute value.</p>
</td></tr>
<tr><td><code id="format_max_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="base.html#topic+format">format()</a></code>, e.g., <code>big.mark = "'"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character vector of formatted numbers.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- c(100, 1, 0.1)
format_max(x)

y &lt;- c(100, 1.01)
format_max(y)
format_max(y, digits = 5)
</code></pre>

<hr>
<h2 id='is.mshapviz'>Check for mshapviz</h2><span id='topic+is.mshapviz'></span>

<h3>Description</h3>

<p>Is object of class &quot;mshapviz&quot;?
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.mshapviz(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is.mshapviz_+3A_object">object</code></td>
<td>
<p>An R object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns <code>TRUE</code> if <code>object</code> has &quot;mshapviz&quot; among its classes,
and <code>FALSE</code> otherwise.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mshapviz">mshapviz()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>S &lt;- matrix(c(1, -1, -1, 1), ncol = 2, dimnames = list(NULL, c("x", "y")))
X &lt;- data.frame(x = c("a", "b"), y = c(100, 10))
s1 &lt;- shapviz(S, X, baseline = 4)[1]
s2 &lt;- shapviz(S, X, baseline = 4)
x &lt;- c(s1 = s1, s2 = s2)
is.mshapviz(x)
is.mshapviz(s1)
</code></pre>

<hr>
<h2 id='is.shapviz'>Check for shapviz</h2><span id='topic+is.shapviz'></span>

<h3>Description</h3>

<p>Is object of class &quot;shapviz&quot;?
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.shapviz(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is.shapviz_+3A_object">object</code></td>
<td>
<p>An R object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns <code>TRUE</code> if <code>object</code> has &quot;shapviz&quot; among its classes,
and <code>FALSE</code> otherwise.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+shapviz">shapviz()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>S &lt;- matrix(c(1, -1, -1, 1), ncol = 2, dimnames = list(NULL, c("x", "y")))
X &lt;- data.frame(x = c("a", "b"), y = c(100, 10))
shp &lt;- shapviz(S, X)
is.shapviz(shp)
is.shapviz("a")
</code></pre>

<hr>
<h2 id='miami'>Miami-Dade County House Prices</h2><span id='topic+miami'></span>

<h3>Description</h3>

<p>The dataset contains information on 13,932 single-family homes sold in
Miami-Dade County in 2016.
Besides publicly available information, the dataset creator Steven C. Bourassa has
added distance variables, aviation noise as well as latitude and longitude.
</p>
<p>More information can be found open-access on <a href="https://www.mdpi.com/1595920">https://www.mdpi.com/1595920</a>.
</p>
<p>The dataset can also be downloaded via <code>miami &lt;- OpenML::getOMLDataSet(43093)$data</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>miami
</code></pre>


<h3>Format</h3>

<p>A data frame with 13,932 rows and 17 columns:
</p>

<dl>
<dt>PARCELNO</dt><dd><p>unique identifier for each property. About 1% appear multiple times.</p>
</dd>
<dt>SALE_PRC</dt><dd><p>sale price ($)</p>
</dd>
<dt>LND_SQFOOT</dt><dd><p>land area (square feet)</p>
</dd>
<dt>TOT_LVG_AREA</dt><dd><p>floor area (square feet)</p>
</dd>
<dt>SPEC_FEAT_VAL</dt><dd><p>value of special features (e.g., swimming pools) ($)</p>
</dd>
<dt>RAIL_DIST</dt><dd><p>distance to the nearest rail line (an indicator of noise) (feet)</p>
</dd>
<dt>OCEAN_DIST</dt><dd><p>distance to the ocean (feet)</p>
</dd>
<dt>WATER_DIST</dt><dd><p>distance to the nearest body of water (feet)</p>
</dd>
<dt>CNTR_DIST</dt><dd><p>distance to the Miami central business district (feet)</p>
</dd>
<dt>SUBCNTR_DI</dt><dd><p>distance to the nearest subcenter (feet)</p>
</dd>
<dt>HWY_DIST</dt><dd><p>distance to the nearest highway (an indicator of noise) (feet)</p>
</dd>
<dt>age</dt><dd><p>age of the structure</p>
</dd>
<dt>avno60plus</dt><dd><p>dummy variable for airplane noise exceeding an acceptable level</p>
</dd>
<dt>structure_quality</dt><dd><p>quality of the structure</p>
</dd>
<dt>month_sold</dt><dd><p>sale month in 2016 (1 = jan)</p>
</dd>
<dt>LATITUDE, LONGITUDE</dt><dd><p>Coordinates</p>
</dd>
</dl>


<hr>
<h2 id='mshapviz'>Combines compatible &quot;shapviz&quot; Objects</h2><span id='topic+mshapviz'></span>

<h3>Description</h3>

<p>This function combines a list of compatible &quot;shapviz&quot; objects to an object of class
&quot;mshapviz&quot;. The elements can be named.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mshapviz(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mshapviz_+3A_object">object</code></td>
<td>
<p>List of &quot;shapviz&quot; objects to be concatenated.</p>
</td></tr>
<tr><td><code id="mshapviz_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A &quot;mshapviz&quot; object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>S &lt;- matrix(c(1, -1, -1, 1), ncol = 2, dimnames = list(NULL, c("x", "y")))
X &lt;- data.frame(x = c("a", "b"), y = c(100, 10))
s1 &lt;- shapviz(S, X, baseline = 4)[1L]
s2 &lt;- shapviz(S, X, baseline = 4)[2L]
s &lt;- mshapviz(c(shp1 = s1, shp2 = s2))
s
</code></pre>

<hr>
<h2 id='potential_interactions'>Interaction Strength</h2><span id='topic+potential_interactions'></span>

<h3>Description</h3>

<p>Returns a vector of interaction strengths between variable <code>v</code> and all other
variables, see Details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>potential_interactions(
  obj,
  v,
  nbins = NULL,
  color_num = TRUE,
  scale = FALSE,
  adjusted = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="potential_interactions_+3A_obj">obj</code></td>
<td>
<p>An object of class &quot;shapviz&quot;.</p>
</td></tr>
<tr><td><code id="potential_interactions_+3A_v">v</code></td>
<td>
<p>Variable name to calculate potential SHAP interactions for.</p>
</td></tr>
<tr><td><code id="potential_interactions_+3A_nbins">nbins</code></td>
<td>
<p>Into how many quantile bins should a numeric <code>v</code> be binned?
The default <code>NULL</code> equals the smaller of <code class="reqn">n/20</code> and <code class="reqn">\sqrt n</code> (rounded up),
where <code class="reqn">n</code> is the sample size. Ignored if <code>obj</code> contains SHAP interactions.</p>
</td></tr>
<tr><td><code id="potential_interactions_+3A_color_num">color_num</code></td>
<td>
<p>Should other (&quot;color&quot;) features <code style="white-space: pre;">&#8288;v'&#8288;</code> be converted to numeric,
even if they are factors/characters? Default is <code>TRUE</code>.
Ignored if <code>obj</code> contains SHAP interactions.</p>
</td></tr>
<tr><td><code id="potential_interactions_+3A_scale">scale</code></td>
<td>
<p>Should adjusted R-squared be multiplied with the sample variance of
within-bin SHAP values? If <code>TRUE</code>, bins with stronger vertical scatter will get
higher weight. The default is <code>FALSE</code>. Ignored if <code>obj</code> contains SHAP interactions.</p>
</td></tr>
<tr><td><code id="potential_interactions_+3A_adjusted">adjusted</code></td>
<td>
<p>Should <em>adjusted</em> R-squared be used? Default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If SHAP interaction values are available, the interaction strength
between feature <code>v</code> and another feature <code style="white-space: pre;">&#8288;v'&#8288;</code> is measured by twice their
mean absolute SHAP interaction values.
</p>
<p>Otherwise, we use a heuristic calculated as follows:
</p>

<ol>
<li><p> If <code>v</code> is numeric, it is binned into <code>nbins</code> bins.
</p>
</li>
<li><p> Per bin, the SHAP values of <code>v</code> are regressed onto <code>v</code>, and the R-squared
is calculated. Rows with missing <code style="white-space: pre;">&#8288;v'&#8288;</code> are discarded.
</p>
</li>
<li><p> The R-squared are averaged over bins, weighted by the number of
non-missing <code style="white-space: pre;">&#8288;v'&#8288;</code> values.
</p>
</li></ol>

<p>This measures how much variability in the SHAP values of <code>v</code> is explained by <code style="white-space: pre;">&#8288;v'&#8288;</code>,
after accounting for <code>v</code>.
</p>
<p>Set <code>scale = TRUE</code> to multiply the R-squared by the within-bin variance
of the SHAP values. This will put higher weight to bins with larger scatter.
</p>
<p>Set <code>color_num = FALSE</code> to <em>not</em> turn the values of the &quot;color&quot; feature <code style="white-space: pre;">&#8288;v'&#8288;</code>
to numeric.
</p>
<p>Finally, set <code>adjusted = TRUE</code> to use <em>adjusted</em> R-squared.
</p>
<p>The algorithm does not consider observations with missing <code style="white-space: pre;">&#8288;v'&#8288;</code> values.
</p>


<h3>Value</h3>

<p>A named vector of decreasing interaction strengths.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sv_dependence">sv_dependence()</a></code>
</p>

<hr>
<h2 id='print.mshapviz'>Prints &quot;mshapviz&quot; Object</h2><span id='topic+print.mshapviz'></span>

<h3>Description</h3>

<p>Prints &quot;mshapviz&quot; Object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mshapviz'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.mshapviz_+3A_x">x</code></td>
<td>
<p>An object of class &quot;mshapviz&quot;.</p>
</td></tr>
<tr><td><code id="print.mshapviz_+3A_...">...</code></td>
<td>
<p>Further arguments passed from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly, the input is returned.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mshapviz">mshapviz()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>S &lt;- matrix(c(1, -1, -1, 1), ncol = 2, dimnames = list(NULL, c("x", "y")))
X &lt;- data.frame(x = c("a", "b"), y = c(100, 10))
s1 &lt;- shapviz(S, X, baseline = 4)[1]
s2 &lt;- shapviz(S, X, baseline = 4)
x &lt;- c(s1 = s1, s2 = s2)
x
</code></pre>

<hr>
<h2 id='print.shapviz'>Prints &quot;shapviz&quot; Object</h2><span id='topic+print.shapviz'></span>

<h3>Description</h3>

<p>Prints &quot;shapviz&quot; Object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'shapviz'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.shapviz_+3A_x">x</code></td>
<td>
<p>An object of class &quot;shapviz&quot;.</p>
</td></tr>
<tr><td><code id="print.shapviz_+3A_...">...</code></td>
<td>
<p>Further arguments passed from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly, the input is returned.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+shapviz">shapviz()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>S &lt;- matrix(c(1, -1, -1, 1), ncol = 2, dimnames = list(NULL, c("x", "y")))
X &lt;- data.frame(x = c("a", "b"), y = c(100, 10))
x &lt;- shapviz(S, X, baseline = 4)
x
</code></pre>

<hr>
<h2 id='rbind.shapviz'>Rowbinds Multiple &quot;shapviz&quot; or &quot;mshapviz&quot; Objects</h2><span id='topic+rbind.shapviz'></span><span id='topic+rbind.mshapviz'></span>

<h3>Description</h3>

<p>Rowbinds multiple &quot;shapviz&quot; objects based on the <code>+</code> operator.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'shapviz'
rbind(...)

## S3 method for class 'mshapviz'
rbind(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rbind.shapviz_+3A_...">...</code></td>
<td>
<p>Any number of &quot;shapviz&quot; or &quot;mshapviz&quot; objects.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A new object of class &quot;shapviz&quot; or &quot;mshapviz&quot;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+shapviz">shapviz()</a></code>, <code><a href="#topic+mshapviz">mshapviz()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>S &lt;- matrix(c(1, -1, -1, 1), ncol = 2, dimnames = list(NULL, c("x", "y")))
X &lt;- data.frame(x = c("a", "b"), y = c(100, 10))
s1 &lt;- shapviz(S, X, baseline = 4)[1]
s2 &lt;- shapviz(S, X, baseline = 4)[2]
s &lt;- rbind(s1, s2)
s
# mshapviz
S &lt;- matrix(c(1, -1, -1, 1), ncol = 2, dimnames = list(NULL, c("x", "y")))
X &lt;- data.frame(x = c("a", "b"), y = c(100, 10))
s1 &lt;- shapviz(S, X, baseline = 4)[1L]
s2 &lt;- shapviz(S, X, baseline = 4)[2L]
s &lt;- mshapviz(c(shp1 = s1, shp2 = s2))
rbind(s, s)

</code></pre>

<hr>
<h2 id='shapviz'>Initialize &quot;shapviz&quot; Object</h2><span id='topic+shapviz'></span><span id='topic+shapviz.default'></span><span id='topic+shapviz.matrix'></span><span id='topic+shapviz.xgb.Booster'></span><span id='topic+shapviz.lgb.Booster'></span><span id='topic+shapviz.explain'></span><span id='topic+shapviz.treeshap'></span><span id='topic+shapviz.predict_parts'></span><span id='topic+shapviz.shapr'></span><span id='topic+shapviz.kernelshap'></span><span id='topic+shapviz.permshap'></span><span id='topic+shapviz.H2ORegressionModel'></span><span id='topic+shapviz.H2OBinomialModel'></span><span id='topic+shapviz.H2OModel'></span>

<h3>Description</h3>

<p>This function creates an object of class &quot;shapviz&quot; from a matrix of SHAP values, or
from a fitted model of type
</p>

<ul>
<li><p> XGBoost,
</p>
</li>
<li><p> LightGBM, or
</p>
</li>
<li><p> H2O (tree-based regression or binary classification model).
</p>
</li></ul>

<p>Furthermore, <code><a href="#topic+shapviz">shapviz()</a></code> can digest the results of
</p>

<ul>
<li> <p><code>fastshap::explain()</code>,
</p>
</li>
<li> <p><code>shapr::explain()</code>,
</p>
</li>
<li> <p><code>treeshap::treeshap()</code>,
</p>
</li>
<li> <p><code>DALEX::predict_parts()</code>,
</p>
</li>
<li> <p><code>kernelshap::kernelshap()</code>, and
</p>
</li>
<li> <p><code>kernelshap::permshap()</code>,
</p>
</li></ul>

<p>check the vignettes for examples.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>shapviz(object, ...)

## Default S3 method:
shapviz(object, ...)

## S3 method for class 'matrix'
shapviz(object, X, baseline = 0, collapse = NULL, S_inter = NULL, ...)

## S3 method for class 'xgb.Booster'
shapviz(
  object,
  X_pred,
  X = X_pred,
  which_class = NULL,
  collapse = NULL,
  interactions = FALSE,
  ...
)

## S3 method for class 'lgb.Booster'
shapviz(object, X_pred, X = X_pred, which_class = NULL, collapse = NULL, ...)

## S3 method for class 'explain'
shapviz(object, X = NULL, baseline = NULL, collapse = NULL, ...)

## S3 method for class 'treeshap'
shapviz(
  object,
  X = object[["observations"]],
  baseline = 0,
  collapse = NULL,
  ...
)

## S3 method for class 'predict_parts'
shapviz(object, ...)

## S3 method for class 'shapr'
shapviz(object, X = object[["x_test"]], collapse = NULL, ...)

## S3 method for class 'kernelshap'
shapviz(object, X = object[["X"]], which_class = NULL, collapse = NULL, ...)

## S3 method for class 'permshap'
shapviz(object, X = object[["X"]], which_class = NULL, collapse = NULL, ...)

## S3 method for class 'H2ORegressionModel'
shapviz(object, X_pred, X = as.data.frame(X_pred), collapse = NULL, ...)

## S3 method for class 'H2OBinomialModel'
shapviz(object, X_pred, X = as.data.frame(X_pred), collapse = NULL, ...)

## S3 method for class 'H2OModel'
shapviz(object, X_pred, X = as.data.frame(X_pred), collapse = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="shapviz_+3A_object">object</code></td>
<td>
<p>For XGBoost, LightGBM, and H2O, this is the fitted model used to
calculate SHAP values from <code>X_pred</code>.
In the other cases, it is the object containing the SHAP values.</p>
</td></tr>
<tr><td><code id="shapviz_+3A_...">...</code></td>
<td>
<p>Parameters passed to other methods (currently only used by
the <code>predict()</code> functions of XGBoost, LightGBM, and H2O).</p>
</td></tr>
<tr><td><code id="shapviz_+3A_x">X</code></td>
<td>
<p>Matrix or data.frame of feature values used for visualization.
Must contain at least the same column names as the SHAP matrix represented by
<code>object</code>/<code>X_pred</code> (after optionally collapsing some of the SHAP columns).</p>
</td></tr>
<tr><td><code id="shapviz_+3A_baseline">baseline</code></td>
<td>
<p>Optional baseline value, representing the average response at the
scale of the SHAP values. It will be used for plot methods that explain single
predictions.</p>
</td></tr>
<tr><td><code id="shapviz_+3A_collapse">collapse</code></td>
<td>
<p>A named list of character vectors. Each vector specifies the
feature names whose SHAP values need to be summed up.
The names determine the resulting collapsed column/dimension names.</p>
</td></tr>
<tr><td><code id="shapviz_+3A_s_inter">S_inter</code></td>
<td>
<p>Optional 3D array of SHAP interaction values.
If <code>object</code> has shape n x p, then <code>S_inter</code> needs to be of
shape n x p x p. Summation over the second (or third) dimension should yield the
usual SHAP values. Furthermore, dimensions 2 and 3 are expected to be symmetric.
Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="shapviz_+3A_x_pred">X_pred</code></td>
<td>
<p>Data set as expected by the <code>predict()</code> function of
XGBoost, LightGBM, or H2O. For XGBoost, a matrix or <code>xgb.DMatrix</code>,
for LightGBM a matrix, and for H2O a <code>data.frame</code> or an <code>H2OFrame</code>.
Only used for XGBoost, LightGBM, or H2O objects.</p>
</td></tr>
<tr><td><code id="shapviz_+3A_which_class">which_class</code></td>
<td>
<p>In case of a multiclass or multioutput setting,
which class/output (&gt;= 1) to explain. Currently relevant for XGBoost, LightGBM,
kernelshap, and permshap.</p>
</td></tr>
<tr><td><code id="shapviz_+3A_interactions">interactions</code></td>
<td>
<p>Should SHAP interactions be calculated (default is <code>FALSE</code>)?
Only available for XGBoost.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Together with the main input, a data set <code>X</code> of feature values is required,
used only for visualization. It can therefore contain character or factor
variables, even if the SHAP values were calculated from a purely numerical feature
matrix. In addition, to improve visualization, it can sometimes be useful to truncate
gross outliers, logarithmize certain columns, or replace missing values with an
explicit value.
</p>
<p>SHAP values of dummy variables can be combined using the convenient
<code>collapse</code> argument.
Multi-output models created from XGBoost, LightGBM, &quot;kernelshap&quot;, or &quot;permshap&quot;
return a &quot;mshapviz&quot; object, containing a &quot;shapviz&quot; object per output.
</p>


<h3>Value</h3>

<p>An object of class &quot;shapviz&quot; with the following elements:
</p>

<ul>
<li> <p><code>S</code>: Numeric matrix of SHAP values.
</p>
</li>
<li> <p><code>X</code>: <code>data.frame</code> containing the feature values corresponding to <code>S</code>.
</p>
</li>
<li> <p><code>baseline</code>: Baseline value, representing the average prediction at the
scale of the SHAP values.
</p>
</li>
<li> <p><code>S_inter</code>: Numeric array of SHAP interaction values (or <code>NULL</code>).
</p>
</li></ul>



<h3>Methods (by class)</h3>


<ul>
<li> <p><code>shapviz(default)</code>: Default method to initialize a &quot;shapviz&quot; object.
</p>
</li>
<li> <p><code>shapviz(matrix)</code>: Creates a &quot;shapviz&quot; object from a matrix of SHAP values.
</p>
</li>
<li> <p><code>shapviz(xgb.Booster)</code>: Creates a &quot;shapviz&quot; object from an XGBoost model.
</p>
</li>
<li> <p><code>shapviz(lgb.Booster)</code>: Creates a &quot;shapviz&quot; object from a LightGBM model.
</p>
</li>
<li> <p><code>shapviz(explain)</code>: Creates a &quot;shapviz&quot; object from <code>fastshap::explain()</code>.
</p>
</li>
<li> <p><code>shapviz(treeshap)</code>: Creates a &quot;shapviz&quot; object from <code>treeshap::treeshap()</code>.
</p>
</li>
<li> <p><code>shapviz(predict_parts)</code>: Creates a &quot;shapviz&quot; object from <code>DALEX::predict_parts()</code>.
</p>
</li>
<li> <p><code>shapviz(shapr)</code>: Creates a &quot;shapviz&quot; object from <code>shapr::explain()</code>.
</p>
</li>
<li> <p><code>shapviz(kernelshap)</code>: Creates a &quot;shapviz&quot; object from <code>kernelshap::kernelshap()</code>.
</p>
</li>
<li> <p><code>shapviz(permshap)</code>: Creates a &quot;shapviz&quot; object from <code>kernelshap::permshap()</code>.
</p>
</li>
<li> <p><code>shapviz(H2ORegressionModel)</code>: Creates a &quot;shapviz&quot; object from a (tree-based) H2O regression model.
</p>
</li>
<li> <p><code>shapviz(H2OBinomialModel)</code>: Creates a &quot;shapviz&quot; object from a (tree-based) H2O binary classification model.
</p>
</li>
<li> <p><code>shapviz(H2OModel)</code>: Creates a &quot;shapviz&quot; object from a (tree-based) H2O model (base class).
</p>
</li></ul>


<h3>See Also</h3>

<p><code><a href="#topic+sv_importance">sv_importance()</a></code>, <code><a href="#topic+sv_dependence">sv_dependence()</a></code>, <code><a href="#topic+sv_dependence2D">sv_dependence2D()</a></code>, <code><a href="#topic+sv_interaction">sv_interaction()</a></code>,
<code><a href="#topic+sv_waterfall">sv_waterfall()</a></code>, <code><a href="#topic+sv_force">sv_force()</a></code>, <code><a href="#topic+collapse_shap">collapse_shap()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>S &lt;- matrix(c(1, -1, -1, 1), ncol = 2, dimnames = list(NULL, c("x", "y")))
X &lt;- data.frame(x = c("a", "b"), y = c(100, 10))
shapviz(S, X, baseline = 4)
# XGBoost models
X_pred &lt;- data.matrix(iris[, -1])
dtrain &lt;- xgboost::xgb.DMatrix(X_pred, label = iris[, 1], nthread = 1)
fit &lt;- xgboost::xgb.train(data = dtrain, nrounds = 10, nthread = 1)

# Will use numeric matrix "X_pred" as feature matrix
x &lt;- shapviz(fit, X_pred = X_pred)
x
sv_dependence(x, "Species")

# Will use original values as feature matrix
x &lt;- shapviz(fit, X_pred = X_pred, X = iris)
sv_dependence(x, "Species")

# "X_pred" can also be passed as xgb.DMatrix, but only if X is passed as well!
x &lt;- shapviz(fit, X_pred = dtrain, X = iris)

# Multiclass setting
params &lt;- list(objective = "multi:softprob", num_class = 3)
X_pred &lt;- data.matrix(iris[, -5])
dtrain &lt;- xgboost::xgb.DMatrix(
  X_pred, label = as.integer(iris[, 5]) - 1, nthread = 1
)
fit &lt;- xgboost::xgb.train(params = params, data = dtrain, nrounds = 10, nthread = 1)

# Select specific class
x &lt;- shapviz(fit, X_pred = X_pred, which_class = 3)
x

# Or combine all classes to "mshapviz" object
x &lt;- shapviz(fit, X_pred = X_pred)
x

# What if we would have one-hot-encoded values and want to explain the original column?
X_pred &lt;- stats::model.matrix(~ . -1, iris[, -1])
dtrain &lt;- xgboost::xgb.DMatrix(X_pred, label = as.integer(iris[, 1]), nthread = 1)
fit &lt;- xgboost::xgb.train(data = dtrain, nrounds = 10, nthread = 1)
x &lt;- shapviz(
  fit,
  X_pred = X_pred,
  X = iris,
  collapse = list(Species = c("Speciessetosa", "Speciesversicolor", "Speciesvirginica"))
)
summary(x)

# Similarly with LightGBM
if (requireNamespace("lightgbm", quietly = TRUE)) {
  fit &lt;- lightgbm::lgb.train(
    params = list(objective = "regression", num_thread = 1),
    data = lightgbm::lgb.Dataset(X_pred, label = iris[, 1]),
    nrounds = 10,
    verbose = -2
  )

  x &lt;- shapviz(fit, X_pred = X_pred)
  x

  # Multiclass
  params &lt;- list(objective = "multiclass", num_class = 3, num_thread = 1)
  X_pred &lt;- data.matrix(iris[, -5])
  dtrain &lt;- lightgbm::lgb.Dataset(X_pred, label = as.integer(iris[, 5]) - 1)
  fit &lt;- lightgbm::lgb.train(params = params, data = dtrain, nrounds = 10)

  # Select specific class
  x &lt;- shapviz(fit, X_pred = X_pred, which_class = 3)
  x

  # Or combine all classes to a "mshapviz" object
  mx &lt;- shapviz(fit, X_pred = X_pred)
  mx
  all.equal(mx[[3]], x)
}
</code></pre>

<hr>
<h2 id='split.shapviz'>Splits &quot;shapviz&quot; Object</h2><span id='topic+split.shapviz'></span>

<h3>Description</h3>

<p>Splits &quot;shapviz&quot; object along a vector <code>f</code> into an object of class &quot;mshapviz&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'shapviz'
split(x, f, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="split.shapviz_+3A_x">x</code></td>
<td>
<p>Object of class &quot;shapviz&quot;.</p>
</td></tr>
<tr><td><code id="split.shapviz_+3A_f">f</code></td>
<td>
<p>Vector used to split feature values and SHAP (interaction) values.
Empty factor levels are dropped.</p>
</td></tr>
<tr><td><code id="split.shapviz_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code>split()</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A &quot;mshapviz&quot; object.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+shapviz">shapviz()</a></code>, <code><a href="#topic+rbind.shapviz">rbind.shapviz()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
dtrain &lt;- xgboost::xgb.DMatrix(data.matrix(iris[, -1]), label = iris[, 1])
fit &lt;- xgboost::xgb.train(data = dtrain, nrounds = 10, nthread = 1)
sv &lt;- shapviz(fit, X_pred = dtrain, X = iris)
mx &lt;- split(sv, f = iris$Species)
sv_dependence(mx, "Petal.Length")

## End(Not run)
</code></pre>

<hr>
<h2 id='summary.shapviz'>Summarizes &quot;shapviz&quot; Object</h2><span id='topic+summary.shapviz'></span>

<h3>Description</h3>

<p>Summarizes &quot;shapviz&quot; Object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'shapviz'
summary(object, n = 2L, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.shapviz_+3A_object">object</code></td>
<td>
<p>An object of class &quot;shapviz&quot;.</p>
</td></tr>
<tr><td><code id="summary.shapviz_+3A_n">n</code></td>
<td>
<p>Maximum number of rows of SHAP values and feature values to show.</p>
</td></tr>
<tr><td><code id="summary.shapviz_+3A_...">...</code></td>
<td>
<p>Further arguments passed from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly, the input is returned.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+shapviz">shapviz()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>S &lt;- matrix(c(1, -1, -1, 1), ncol = 2, dimnames = list(NULL, c("x", "y")))
X &lt;- data.frame(x = c("a", "b"), y = c(100, 10))
object &lt;- shapviz(S, X, baseline = 4)
summary(object)
</code></pre>

<hr>
<h2 id='sv_dependence'>SHAP Dependence Plot</h2><span id='topic+sv_dependence'></span><span id='topic+sv_dependence.default'></span><span id='topic+sv_dependence.shapviz'></span><span id='topic+sv_dependence.mshapviz'></span>

<h3>Description</h3>

<p>Scatterplot of the SHAP values of a feature against its feature values.
If SHAP interaction values are available, setting <code>interactions = TRUE</code> allows
to focus on pure interaction effects (multiplied by two) or on pure main effects.
By default, the feature on the color scale is selected via SHAP interactions
(if available) or an interaction heuristic, see <code><a href="#topic+potential_interactions">potential_interactions()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sv_dependence(object, ...)

## Default S3 method:
sv_dependence(object, ...)

## S3 method for class 'shapviz'
sv_dependence(
  object,
  v,
  color_var = "auto",
  color = "#3b528b",
  viridis_args = getOption("shapviz.viridis_args"),
  jitter_width = NULL,
  interactions = FALSE,
  ih_nbins = NULL,
  ih_color_num = TRUE,
  ih_scale = FALSE,
  ih_adjusted = FALSE,
  ...
)

## S3 method for class 'mshapviz'
sv_dependence(
  object,
  v,
  color_var = "auto",
  color = "#3b528b",
  viridis_args = getOption("shapviz.viridis_args"),
  jitter_width = NULL,
  interactions = FALSE,
  ih_nbins = NULL,
  ih_color_num = TRUE,
  ih_scale = FALSE,
  ih_adjusted = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sv_dependence_+3A_object">object</code></td>
<td>
<p>An object of class &quot;(m)shapviz&quot;.</p>
</td></tr>
<tr><td><code id="sv_dependence_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="ggplot2.html#topic+geom_jitter">ggplot2::geom_jitter()</a></code>.</p>
</td></tr>
<tr><td><code id="sv_dependence_+3A_v">v</code></td>
<td>
<p>Column name of feature to be plotted. Can be a vector/list if <code>object</code> is
of class &quot;shapviz&quot;.</p>
</td></tr>
<tr><td><code id="sv_dependence_+3A_color_var">color_var</code></td>
<td>
<p>Feature name to be used on the color scale to investigate
interactions. The default (&quot;auto&quot;) uses SHAP interaction values (if available),
or a heuristic to select the strongest interacting feature. Set to <code>NULL</code> to not
use the color axis. Can be a vector/list if <code>object</code> is of class &quot;shapviz&quot;.</p>
</td></tr>
<tr><td><code id="sv_dependence_+3A_color">color</code></td>
<td>
<p>Color to be used if <code>color_var = NULL</code>. Can be a vector/list if <code>v</code>
is a vector.</p>
</td></tr>
<tr><td><code id="sv_dependence_+3A_viridis_args">viridis_args</code></td>
<td>
<p>List of viridis color scale arguments, see
<code>?ggplot2::scale_color_viridis_c</code>. The default points to the global option
<code>shapviz.viridis_args</code>, which corresponds to
<code>list(begin = 0.25, end = 0.85, option = "inferno")</code>.
These values are passed to <code style="white-space: pre;">&#8288;ggplot2::scale_color_viridis_*()&#8288;</code>.
For example, to switch to a standard viridis scale, you can either change the
default via <code>options(shapviz.viridis_args = list())</code>, or set
<code>viridis_args = list()</code>. Only relevant if <code>color_var</code> is not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="sv_dependence_+3A_jitter_width">jitter_width</code></td>
<td>
<p>The amount of horizontal jitter. The default (<code>NULL</code>) will
use a value of 0.2 in case <code>v</code> is discrete, and no jitter otherwise.
(Numeric variables are considered discrete if they have at most 7 unique values.)
Can be a vector/list if <code>v</code> is a vector.</p>
</td></tr>
<tr><td><code id="sv_dependence_+3A_interactions">interactions</code></td>
<td>
<p>Should SHAP interaction values be plotted? Default is <code>FALSE</code>.
Requires SHAP interaction values. If <code>color_var = NULL</code> (or it is equal to <code>v</code>),
the pure main effect of <code>v</code> is visualized. Otherwise, twice the SHAP interaction
values between <code>v</code> and the <code>color_var</code> are plotted.</p>
</td></tr>
<tr><td><code id="sv_dependence_+3A_ih_nbins">ih_nbins</code>, <code id="sv_dependence_+3A_ih_color_num">ih_color_num</code>, <code id="sv_dependence_+3A_ih_scale">ih_scale</code>, <code id="sv_dependence_+3A_ih_adjusted">ih_adjusted</code></td>
<td>
<p>Interaction heuristic (ih)
parameters used to select the color variable, see <code><a href="#topic+potential_interactions">potential_interactions()</a></code>.
Only used if <code>color_var = "auto"</code> and if there are no SHAP interaction values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class &quot;ggplot&quot; (or &quot;patchwork&quot;) representing a dependence plot.
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>sv_dependence(default)</code>: Default method.
</p>
</li>
<li> <p><code>sv_dependence(shapviz)</code>: SHAP dependence plot for &quot;shapviz&quot; object.
</p>
</li>
<li> <p><code>sv_dependence(mshapviz)</code>: SHAP dependence plot for &quot;mshapviz&quot; object.
</p>
</li></ul>


<h3>See Also</h3>

<p><code><a href="#topic+potential_interactions">potential_interactions()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dtrain &lt;- xgboost::xgb.DMatrix(
  data.matrix(iris[, -1]), label = iris[, 1], nthread = 1
)
fit &lt;- xgboost::xgb.train(data = dtrain, nrounds = 10, nthread = 1)
x &lt;- shapviz(fit, X_pred = dtrain, X = iris)
sv_dependence(x, "Petal.Length")
sv_dependence(x, "Petal.Length", color_var = "Species")
sv_dependence(x, "Petal.Length", color_var = NULL)
sv_dependence(x, c("Species", "Petal.Length"))
sv_dependence(x, "Petal.Width", color_var = c("Species", "Petal.Length"))

# SHAP interaction values/main effects
x2 &lt;- shapviz(fit, X_pred = dtrain, X = iris, interactions = TRUE)
sv_dependence(x2, "Petal.Length", interactions = TRUE)
sv_dependence(
  x2, c("Petal.Length", "Species"), color_var = NULL, interactions = TRUE
)
</code></pre>

<hr>
<h2 id='sv_dependence2D'>2D SHAP Dependence Plot</h2><span id='topic+sv_dependence2D'></span><span id='topic+sv_dependence2D.default'></span><span id='topic+sv_dependence2D.shapviz'></span><span id='topic+sv_dependence2D.mshapviz'></span>

<h3>Description</h3>

<p>Scatterplot of two features, showing the sum of their SHAP values on the color scale.
This allows to visualize the combined effect of two features, including interactions.
A typical application are models with latitude and longitude as features (plus
maybe other regional features that can be passed via <code>add_vars</code>).
</p>
<p>If SHAP interaction values are available, setting <code>interactions = TRUE</code> allows
to focus on pure interaction effects (multiplied by two). In this case, <code>add_vars</code>
has no effect.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sv_dependence2D(object, ...)

## Default S3 method:
sv_dependence2D(object, ...)

## S3 method for class 'shapviz'
sv_dependence2D(
  object,
  x,
  y,
  viridis_args = getOption("shapviz.viridis_args"),
  jitter_width = NULL,
  jitter_height = NULL,
  interactions = FALSE,
  add_vars = NULL,
  ...
)

## S3 method for class 'mshapviz'
sv_dependence2D(
  object,
  x,
  y,
  viridis_args = getOption("shapviz.viridis_args"),
  jitter_width = NULL,
  jitter_height = NULL,
  interactions = FALSE,
  add_vars = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sv_dependence2D_+3A_object">object</code></td>
<td>
<p>An object of class &quot;(m)shapviz&quot;.</p>
</td></tr>
<tr><td><code id="sv_dependence2D_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="ggplot2.html#topic+geom_jitter">ggplot2::geom_jitter()</a></code>.</p>
</td></tr>
<tr><td><code id="sv_dependence2D_+3A_x">x</code></td>
<td>
<p>Feature name for x axis. Can be a vector/list if <code>object</code> is
of class &quot;shapviz&quot;.</p>
</td></tr>
<tr><td><code id="sv_dependence2D_+3A_y">y</code></td>
<td>
<p>Feature name for y axis. Can be a vector/list if <code>object</code> is
of class &quot;shapviz&quot;.</p>
</td></tr>
<tr><td><code id="sv_dependence2D_+3A_viridis_args">viridis_args</code></td>
<td>
<p>List of viridis color scale arguments, see
<code>?ggplot2::scale_color_viridis_c</code>. The default points to the global option
<code>shapviz.viridis_args</code>, which corresponds to
<code>list(begin = 0.25, end = 0.85, option = "inferno")</code>.
These values are passed to <code style="white-space: pre;">&#8288;ggplot2::scale_color_viridis_*()&#8288;</code>.
For example, to switch to a standard viridis scale, you can either change the
default via <code>options(shapviz.viridis_args = list())</code>, or set
<code>viridis_args = list()</code>. Only relevant if <code>color_var</code> is not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="sv_dependence2D_+3A_jitter_width">jitter_width</code></td>
<td>
<p>The amount of horizontal jitter. The default (<code>NULL</code>) will
use a value of 0.2 in case <code>v</code> is discrete, and no jitter otherwise.
(Numeric variables are considered discrete if they have at most 7 unique values.)
Can be a vector/list if <code>v</code> is a vector.</p>
</td></tr>
<tr><td><code id="sv_dependence2D_+3A_jitter_height">jitter_height</code></td>
<td>
<p>Similar to <code>jitter_width</code> for vertical scatter.</p>
</td></tr>
<tr><td><code id="sv_dependence2D_+3A_interactions">interactions</code></td>
<td>
<p>Should SHAP interaction values be plotted? The default (<code>FALSE</code>)
will show the rowwise sum of the SHAP values of <code>x</code> and <code>y</code>. If <code>TRUE</code>, will
use twice the SHAP interaction value (requires SHAP interactions).</p>
</td></tr>
<tr><td><code id="sv_dependence2D_+3A_add_vars">add_vars</code></td>
<td>
<p>Optional vector of feature names, whose SHAP values should be added
to the sum of the SHAP values of <code>x</code> and <code>y</code> (only if <code>interactions = FALSE</code>).
A use case would be a model with geographic x and y coordinates, along with some
additional locational features like distance to the next train station.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class &quot;ggplot&quot; (or &quot;patchwork&quot;) representing a dependence plot.
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>sv_dependence2D(default)</code>: Default method.
</p>
</li>
<li> <p><code>sv_dependence2D(shapviz)</code>: 2D SHAP dependence plot for &quot;shapviz&quot; object.
</p>
</li>
<li> <p><code>sv_dependence2D(mshapviz)</code>: 2D SHAP dependence plot for &quot;mshapviz&quot; object.
</p>
</li></ul>


<h3>See Also</h3>

<p><code><a href="#topic+sv_dependence">sv_dependence()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dtrain &lt;- xgboost::xgb.DMatrix(
  data.matrix(iris[, -1]), label = iris[, 1], nthread = 1
)
fit &lt;- xgboost::xgb.train(data = dtrain, nrounds = 10, nthread = 1)
sv &lt;- shapviz(fit, X_pred = dtrain, X = iris)
sv_dependence2D(sv, x = "Petal.Length", y = "Species")
sv_dependence2D(sv, x = c("Petal.Length", "Species"), y = "Sepal.Width")

# SHAP interaction values
sv2 &lt;- shapviz(fit, X_pred = dtrain, X = iris, interactions = TRUE)
sv_dependence2D(sv2, x = "Petal.Length", y = "Species", interactions = TRUE)
sv_dependence2D(
  sv2, x = "Petal.Length", y = c("Species", "Petal.Width"), interactions = TRUE
)

# mshapviz object
mx &lt;- split(sv, f = iris$Species)
sv_dependence2D(mx, x = "Petal.Length", y = "Sepal.Width")
</code></pre>

<hr>
<h2 id='sv_force'>SHAP Force Plot</h2><span id='topic+sv_force'></span><span id='topic+sv_force.default'></span><span id='topic+sv_force.shapviz'></span><span id='topic+sv_force.mshapviz'></span>

<h3>Description</h3>

<p>Creates a force plot of SHAP values of one observation. If multiple
observations are selected, their SHAP values and predictions are averaged.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sv_force(object, ...)

## Default S3 method:
sv_force(object, ...)

## S3 method for class 'shapviz'
sv_force(
  object,
  row_id = 1L,
  max_display = 6L,
  fill_colors = c("#f7d13d", "#a52c60"),
  format_shap = getOption("shapviz.format_shap"),
  format_feat = getOption("shapviz.format_feat"),
  contrast = TRUE,
  bar_label_size = 3.2,
  show_annotation = TRUE,
  annotation_size = 3.2,
  ...
)

## S3 method for class 'mshapviz'
sv_force(
  object,
  row_id = 1L,
  max_display = 6L,
  fill_colors = c("#f7d13d", "#a52c60"),
  format_shap = getOption("shapviz.format_shap"),
  format_feat = getOption("shapviz.format_feat"),
  contrast = TRUE,
  bar_label_size = 3.2,
  show_annotation = TRUE,
  annotation_size = 3.2,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sv_force_+3A_object">object</code></td>
<td>
<p>An object of class &quot;(m)shapviz&quot;.</p>
</td></tr>
<tr><td><code id="sv_force_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="ggfittext.html#topic+geom_fit_text">ggfittext::geom_fit_text()</a></code>.
For example, <code>size = 9</code> will use fixed text size in the bars and <code>size = 0</code>
will altogether suppress adding text to the bars.</p>
</td></tr>
<tr><td><code id="sv_force_+3A_row_id">row_id</code></td>
<td>
<p>Subset of observations to plot, typically a single row number.
If more than one row is selected, SHAP values are averaged, and feature values
are shown only when they are unique.</p>
</td></tr>
<tr><td><code id="sv_force_+3A_max_display">max_display</code></td>
<td>
<p>Maximum number of features (with largest absolute SHAP values)
should be plotted? If there are more features, they will be collapsed to one
feature. Set to <code>Inf</code> to show all features.</p>
</td></tr>
<tr><td><code id="sv_force_+3A_fill_colors">fill_colors</code></td>
<td>
<p>A vector of exactly two fill colors: the first for positive
SHAP values, the other for negative ones.</p>
</td></tr>
<tr><td><code id="sv_force_+3A_format_shap">format_shap</code></td>
<td>
<p>Function used to format SHAP values. The default uses the
global option <code>shapviz.format_shap</code>, which equals to
<code>function(z) prettyNum(z, digits = 3, scientific = FALSE)</code> by default.</p>
</td></tr>
<tr><td><code id="sv_force_+3A_format_feat">format_feat</code></td>
<td>
<p>Function used to format numeric feature values. The default uses
the global option <code>shapviz.format_feat</code>, which equals to
<code>function(z) prettyNum(z, digits = 3, scientific = FALSE)</code> by default.</p>
</td></tr>
<tr><td><code id="sv_force_+3A_contrast">contrast</code></td>
<td>
<p>Logical flag that detemines whether to use white text in dark arrows.
Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="sv_force_+3A_bar_label_size">bar_label_size</code></td>
<td>
<p>Size of text used to describe bars
(via <code><a href="ggrepel.html#topic+geom_text_repel">ggrepel::geom_text_repel()</a></code>).</p>
</td></tr>
<tr><td><code id="sv_force_+3A_show_annotation">show_annotation</code></td>
<td>
<p>Should &quot;f(x)&quot; and &quot;E(f(x))&quot; be plotted? Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="sv_force_+3A_annotation_size">annotation_size</code></td>
<td>
<p>Size of the annotation text (f(x)=... and E(f(x))=...).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>f(x) denotes the prediction on the SHAP scale, while E(f(x)) refers to the
baseline SHAP value.
</p>


<h3>Value</h3>

<p>An object of class &quot;ggplot&quot; (or &quot;patchwork&quot;) representing a force plot.
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>sv_force(default)</code>: Default method.
</p>
</li>
<li> <p><code>sv_force(shapviz)</code>: SHAP force plot for object of class &quot;shapviz&quot;.
</p>
</li>
<li> <p><code>sv_force(mshapviz)</code>: SHAP force plot for object of class &quot;mshapviz&quot;.
</p>
</li></ul>


<h3>See Also</h3>

<p><code><a href="#topic+sv_waterfall">sv_waterfall()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dtrain &lt;- xgboost::xgb.DMatrix(
  data.matrix(iris[, -1]), label = iris[, 1], nthread = 1
)
fit &lt;- xgboost::xgb.train(data = dtrain, nrounds = 20, nthread = 1)
x &lt;- shapviz(fit, X_pred = dtrain, X = iris[, -1])
sv_force(x)
sv_force(x, row_id = 65, max_display = 3, size = 9, fill_colors = 4:5)

# Aggregate over all observations with Petal.Length == 1.4
sv_force(x, row_id = x$X$Petal.Length == 1.4)
</code></pre>

<hr>
<h2 id='sv_importance'>SHAP Importance Plots</h2><span id='topic+sv_importance'></span><span id='topic+sv_importance.default'></span><span id='topic+sv_importance.shapviz'></span><span id='topic+sv_importance.mshapviz'></span>

<h3>Description</h3>

<p>This function provides two types of SHAP importance plots: a bar plot
and a beeswarm plot (sometimes called &quot;SHAP summary plot&quot;).
The two types of plots can also be combined.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sv_importance(object, ...)

## Default S3 method:
sv_importance(object, ...)

## S3 method for class 'shapviz'
sv_importance(
  object,
  kind = c("bar", "beeswarm", "both", "no"),
  max_display = 15L,
  fill = "#fca50a",
  bar_width = 2/3,
  bee_width = 0.4,
  bee_adjust = 0.5,
  viridis_args = getOption("shapviz.viridis_args"),
  color_bar_title = "Feature value",
  show_numbers = FALSE,
  format_fun = format_max,
  number_size = 3.2,
  ...
)

## S3 method for class 'mshapviz'
sv_importance(
  object,
  kind = c("bar", "beeswarm", "both", "no"),
  max_display = 15L,
  fill = "#fca50a",
  bar_width = 2/3,
  bar_type = c("dodge", "stack", "facets", "separate"),
  bee_width = 0.4,
  bee_adjust = 0.5,
  viridis_args = getOption("shapviz.viridis_args"),
  color_bar_title = "Feature value",
  show_numbers = FALSE,
  format_fun = format_max,
  number_size = 3.2,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sv_importance_+3A_object">object</code></td>
<td>
<p>An object of class &quot;(m)shapviz&quot;.</p>
</td></tr>
<tr><td><code id="sv_importance_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="ggplot2.html#topic+geom_bar">ggplot2::geom_bar()</a></code> (if <code>kind = "bar"</code>) or to
<code><a href="ggplot2.html#topic+geom_point">ggplot2::geom_point()</a></code> otherwise. For instance, passing <code>alpha = 0.2</code> will produce
semi-transparent beeswarms, and setting <code>size = 3</code> will produce larger dots.</p>
</td></tr>
<tr><td><code id="sv_importance_+3A_kind">kind</code></td>
<td>
<p>Should a &quot;bar&quot; plot (the default), a &quot;beeswarm&quot; plot, or &quot;both&quot; be shown?
Set to &quot;no&quot; in order to suppress plotting. In that case, the sorted
SHAP feature importances of all variables are returned.</p>
</td></tr>
<tr><td><code id="sv_importance_+3A_max_display">max_display</code></td>
<td>
<p>Maximum number of features (with highest importance) to plot.
Set to <code>Inf</code> to show all features. Has no effect if <code>kind = "no"</code>.</p>
</td></tr>
<tr><td><code id="sv_importance_+3A_fill">fill</code></td>
<td>
<p>Color used to fill the bars (only used if bars are shown).</p>
</td></tr>
<tr><td><code id="sv_importance_+3A_bar_width">bar_width</code></td>
<td>
<p>Relative width of the bars (only used if bars are shown).</p>
</td></tr>
<tr><td><code id="sv_importance_+3A_bee_width">bee_width</code></td>
<td>
<p>Relative width of the beeswarms.</p>
</td></tr>
<tr><td><code id="sv_importance_+3A_bee_adjust">bee_adjust</code></td>
<td>
<p>Relative bandwidth adjustment factor used in
estimating the density of the beeswarms.</p>
</td></tr>
<tr><td><code id="sv_importance_+3A_viridis_args">viridis_args</code></td>
<td>
<p>List of viridis color scale arguments. The default points to the
global option <code>shapviz.viridis_args</code>, which corresponds to
<code>list(begin = 0.25, end = 0.85, option = "inferno")</code>. These values are passed to
<code><a href="ggplot2.html#topic+scale_viridis">ggplot2::scale_color_viridis_c()</a></code>. For example, to switch to standard viridis,
either change the default with <code>options(shapviz.viridis_args = list())</code> or set
<code>viridis_args = list()</code>.</p>
</td></tr>
<tr><td><code id="sv_importance_+3A_color_bar_title">color_bar_title</code></td>
<td>
<p>Title of color bar of the beeswarm plot. Set to <code>NULL</code>
to hide the color bar altogether.</p>
</td></tr>
<tr><td><code id="sv_importance_+3A_show_numbers">show_numbers</code></td>
<td>
<p>Should SHAP feature importances be printed? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="sv_importance_+3A_format_fun">format_fun</code></td>
<td>
<p>Function used to format SHAP feature importances
(only if <code>show_numbers = TRUE</code>). To change to scientific notation, use
<code style="white-space: pre;">&#8288;function(x) = prettyNum(x, scientific = TRUE)&#8288;</code>.</p>
</td></tr>
<tr><td><code id="sv_importance_+3A_number_size">number_size</code></td>
<td>
<p>Text size of the numbers (if <code>show_numbers = TRUE</code>).</p>
</td></tr>
<tr><td><code id="sv_importance_+3A_bar_type">bar_type</code></td>
<td>
<p>For &quot;mshapviz&quot; objects with <code>kind = "bar"</code>: How should bars be
represented? The default is &quot;dodge&quot; for dodged bars. Other options are &quot;stack&quot;,
&quot;wrap&quot;, or &quot;separate&quot; (via &quot;patchwork&quot;). Note that &quot;separate&quot; is currently
the only option that supports <code>show_numbers = TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The bar plot shows SHAP feature importances, calculated as the average absolute SHAP
value per feature. The beeswarm plot displays SHAP values per feature, using min-max
scaled feature values on the color axis. Non-numeric features are transformed
to numeric by calling <code><a href="base.html#topic+data.matrix">data.matrix()</a></code> first. For both types of plots, the features
are sorted in decreasing order of importance.
</p>


<h3>Value</h3>

<p>A &quot;ggplot&quot; (or &quot;patchwork&quot;) object representing an importance plot, or - if
<code>kind = "no"</code> - a named numeric vector of sorted SHAP feature importances
(or a matrix in case of an object of class &quot;mshapviz&quot;).
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>sv_importance(default)</code>: Default method.
</p>
</li>
<li> <p><code>sv_importance(shapviz)</code>: SHAP importance plot for an object of class &quot;shapviz&quot;.
</p>
</li>
<li> <p><code>sv_importance(mshapviz)</code>: SHAP importance plot for an object of class &quot;mshapviz&quot;.
</p>
</li></ul>


<h3>See Also</h3>

<p><code><a href="#topic+sv_interaction">sv_interaction</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>X_train &lt;- data.matrix(iris[, -1])
dtrain &lt;- xgboost::xgb.DMatrix(X_train, label = iris[, 1], nthread = 1)
fit &lt;- xgboost::xgb.train(data = dtrain, nrounds = 10, nthread = 1)
x &lt;- shapviz(fit, X_pred = X_train)
sv_importance(x)
sv_importance(x, kind = "no")
sv_importance(x, kind = "beeswarm", show_numbers = TRUE)
</code></pre>

<hr>
<h2 id='sv_interaction'>SHAP Interaction Plot</h2><span id='topic+sv_interaction'></span><span id='topic+sv_interaction.default'></span><span id='topic+sv_interaction.shapviz'></span><span id='topic+sv_interaction.mshapviz'></span>

<h3>Description</h3>

<p>Plots a beeswarm plot for each feature pair. Diagonals represent the main effects,
while off-diagonals show interactions (multiplied by two due to symmetry).
The colors on the beeswarm plots represent min-max scaled feature values.
Non-numeric features are transformed to numeric by calling <code><a href="base.html#topic+data.matrix">data.matrix()</a></code> first.
The features are sorted in decreasing order of usual SHAP importance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sv_interaction(object, ...)

## Default S3 method:
sv_interaction(object, ...)

## S3 method for class 'shapviz'
sv_interaction(
  object,
  kind = c("beeswarm", "no"),
  max_display = 7L,
  alpha = 0.3,
  bee_width = 0.3,
  bee_adjust = 0.5,
  viridis_args = getOption("shapviz.viridis_args"),
  color_bar_title = "Row feature value",
  ...
)

## S3 method for class 'mshapviz'
sv_interaction(
  object,
  kind = c("beeswarm", "no"),
  max_display = 7L,
  alpha = 0.3,
  bee_width = 0.3,
  bee_adjust = 0.5,
  viridis_args = getOption("shapviz.viridis_args"),
  color_bar_title = "Row feature value",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sv_interaction_+3A_object">object</code></td>
<td>
<p>An object of class &quot;(m)shapviz&quot; containing element <code>S_inter</code>.</p>
</td></tr>
<tr><td><code id="sv_interaction_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="ggplot2.html#topic+geom_point">ggplot2::geom_point()</a></code>. For instance,
passing <code>size = 1</code> will produce smaller dots.</p>
</td></tr>
<tr><td><code id="sv_interaction_+3A_kind">kind</code></td>
<td>
<p>Set to &quot;no&quot; to return the matrix of average absolute SHAP
interactions (or a list of such matrices in case of object of class &quot;mshapviz&quot;).
Due to symmetry, off-diagonals are multiplied by two. The default is &quot;beeswarm&quot;.</p>
</td></tr>
<tr><td><code id="sv_interaction_+3A_max_display">max_display</code></td>
<td>
<p>Maximum number of features (with highest importance) to plot.
Set to <code>Inf</code> to show all features. Has no effect if <code>kind = "no"</code>.</p>
</td></tr>
<tr><td><code id="sv_interaction_+3A_alpha">alpha</code></td>
<td>
<p>Transparency of the beeswarm dots. Defaults to 0.3.</p>
</td></tr>
<tr><td><code id="sv_interaction_+3A_bee_width">bee_width</code></td>
<td>
<p>Relative width of the beeswarms.</p>
</td></tr>
<tr><td><code id="sv_interaction_+3A_bee_adjust">bee_adjust</code></td>
<td>
<p>Relative bandwidth adjustment factor used in
estimating the density of the beeswarms.</p>
</td></tr>
<tr><td><code id="sv_interaction_+3A_viridis_args">viridis_args</code></td>
<td>
<p>List of viridis color scale arguments. The default points to the
global option <code>shapviz.viridis_args</code>, which corresponds to
<code>list(begin = 0.25, end = 0.85, option = "inferno")</code>. These values are passed to
<code><a href="ggplot2.html#topic+scale_viridis">ggplot2::scale_color_viridis_c()</a></code>. For example, to switch to standard viridis,
either change the default with <code>options(shapviz.viridis_args = list())</code> or set
<code>viridis_args = list()</code>.</p>
</td></tr>
<tr><td><code id="sv_interaction_+3A_color_bar_title">color_bar_title</code></td>
<td>
<p>Title of color bar of the beeswarm plot. Set to <code>NULL</code>
to hide the color bar altogether.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A &quot;ggplot&quot; (or &quot;patchwork&quot;) object, or - if <code>kind = "no"</code> - a named
numeric matrix of average absolute SHAP interactions sorted by the average
absolute SHAP values (or a list of such matrices in case of &quot;mshapviz&quot; object).
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>sv_interaction(default)</code>: Default method.
</p>
</li>
<li> <p><code>sv_interaction(shapviz)</code>: SHAP interaction plot for an object of class &quot;shapviz&quot;.
</p>
</li>
<li> <p><code>sv_interaction(mshapviz)</code>: SHAP interaction plot for an object of class &quot;mshapviz&quot;.
</p>
</li></ul>


<h3>See Also</h3>

<p><code><a href="#topic+sv_importance">sv_importance()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dtrain &lt;- xgboost::xgb.DMatrix(
  data.matrix(iris[, -1]), label = iris[, 1], nthread = 1
)
fit &lt;- xgboost::xgb.train(data = dtrain, nrounds = 10, nthread = 1)
x &lt;- shapviz(fit, X_pred = dtrain, X = iris, interactions = TRUE)
sv_interaction(x, kind = "no")
sv_interaction(x, max_display = 2, size = 3)
</code></pre>

<hr>
<h2 id='sv_waterfall'>SHAP Waterfall Plot</h2><span id='topic+sv_waterfall'></span><span id='topic+sv_waterfall.default'></span><span id='topic+sv_waterfall.shapviz'></span><span id='topic+sv_waterfall.mshapviz'></span>

<h3>Description</h3>

<p>Creates a waterfall plot of SHAP values of one observation. If multiple
observations are selected, their SHAP values and predictions are averaged.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sv_waterfall(object, ...)

## Default S3 method:
sv_waterfall(object, ...)

## S3 method for class 'shapviz'
sv_waterfall(
  object,
  row_id = 1L,
  max_display = 10L,
  order_fun = function(s) order(abs(s)),
  fill_colors = c("#f7d13d", "#a52c60"),
  format_shap = getOption("shapviz.format_shap"),
  format_feat = getOption("shapviz.format_feat"),
  contrast = TRUE,
  show_connection = TRUE,
  show_annotation = TRUE,
  annotation_size = 3.2,
  ...
)

## S3 method for class 'mshapviz'
sv_waterfall(
  object,
  row_id = 1L,
  max_display = 10L,
  order_fun = function(s) order(abs(s)),
  fill_colors = c("#f7d13d", "#a52c60"),
  format_shap = getOption("shapviz.format_shap"),
  format_feat = getOption("shapviz.format_feat"),
  contrast = TRUE,
  show_connection = TRUE,
  show_annotation = TRUE,
  annotation_size = 3.2,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sv_waterfall_+3A_object">object</code></td>
<td>
<p>An object of class &quot;(m)shapviz&quot;.</p>
</td></tr>
<tr><td><code id="sv_waterfall_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="ggfittext.html#topic+geom_fit_text">ggfittext::geom_fit_text()</a></code>.
For example, <code>size = 9</code> will use fixed text size in the bars and <code>size = 0</code>
will altogether suppress adding text to the bars.</p>
</td></tr>
<tr><td><code id="sv_waterfall_+3A_row_id">row_id</code></td>
<td>
<p>Subset of observations to plot, typically a single row number.
If more than one row is selected, SHAP values are averaged, and feature values
are shown only when they are unique.</p>
</td></tr>
<tr><td><code id="sv_waterfall_+3A_max_display">max_display</code></td>
<td>
<p>Maximum number of features (with largest absolute SHAP values)
should be plotted? If there are more features, they will be collapsed to one
feature. Set to <code>Inf</code> to show all features.</p>
</td></tr>
<tr><td><code id="sv_waterfall_+3A_order_fun">order_fun</code></td>
<td>
<p>Function specifying the order of the variables/SHAP values.
It maps the vector <code>s</code> of SHAP values to sort indices from 1 to <code>length(s)</code>.
The default is <code>function(s) order(abs(s))</code>. To plot without sorting, use
<code>function(s) 1:length(s)</code> or <code>function(s) length(s):1</code>.</p>
</td></tr>
<tr><td><code id="sv_waterfall_+3A_fill_colors">fill_colors</code></td>
<td>
<p>A vector of exactly two fill colors: the first for positive
SHAP values, the other for negative ones.</p>
</td></tr>
<tr><td><code id="sv_waterfall_+3A_format_shap">format_shap</code></td>
<td>
<p>Function used to format SHAP values. The default uses the
global option <code>shapviz.format_shap</code>, which equals to
<code>function(z) prettyNum(z, digits = 3, scientific = FALSE)</code> by default.</p>
</td></tr>
<tr><td><code id="sv_waterfall_+3A_format_feat">format_feat</code></td>
<td>
<p>Function used to format numeric feature values. The default uses
the global option <code>shapviz.format_feat</code>, which equals to
<code>function(z) prettyNum(z, digits = 3, scientific = FALSE)</code> by default.</p>
</td></tr>
<tr><td><code id="sv_waterfall_+3A_contrast">contrast</code></td>
<td>
<p>Logical flag that detemines whether to use white text in dark arrows.
Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="sv_waterfall_+3A_show_connection">show_connection</code></td>
<td>
<p>Should connecting lines be shown? Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="sv_waterfall_+3A_show_annotation">show_annotation</code></td>
<td>
<p>Should &quot;f(x)&quot; and &quot;E(f(x))&quot; be plotted? Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="sv_waterfall_+3A_annotation_size">annotation_size</code></td>
<td>
<p>Size of the annotation text (f(x)=... and E(f(x))=...).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>f(x) denotes the prediction on the SHAP scale, while E(f(x)) refers to the
baseline SHAP value.
</p>


<h3>Value</h3>

<p>An object of class &quot;ggplot&quot; (or &quot;patchwork&quot;) representing a waterfall plot.
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>sv_waterfall(default)</code>: Default method.
</p>
</li>
<li> <p><code>sv_waterfall(shapviz)</code>: SHAP waterfall plot for an object of class &quot;shapviz&quot;.
</p>
</li>
<li> <p><code>sv_waterfall(mshapviz)</code>: SHAP waterfall plot for an object of class &quot;mshapviz&quot;.
</p>
</li></ul>


<h3>See Also</h3>

<p><code><a href="#topic+sv_force">sv_force()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dtrain &lt;- xgboost::xgb.DMatrix(
  data.matrix(iris[, -1]), label = iris[, 1], nthread = 1
)
fit &lt;- xgboost::xgb.train(data = dtrain, nrounds = 20, nthread = 1)
x &lt;- shapviz(fit, X_pred = dtrain, X = iris[, -1])
sv_waterfall(x)
sv_waterfall(x, row_id = 123, max_display = 2, size = 9, fill_colors = 4:5)

# Ordered by colnames(x), combined with max_display
sv_waterfall(
  x[, sort(colnames(x))], order_fun = function(s) length(s):1, max_display = 3
)

# Aggregate over all observations with Petal.Length == 1.4
sv_waterfall(x, row_id = x$X$Petal.Length == 1.4)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
