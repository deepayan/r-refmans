<!DOCTYPE html><html><head><title>Help for package prevtoinc</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {prevtoinc}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#prevtoinc'><p>prevtoinc:</p></a></li>
<li><a href='#A_to_X_dist'><p>function to transform the distribution of stays to a fixed</p>
point to the distribution of the staying times</a></li>
<li><a href='#calculate_CI_I_pp'><p>Calculate confidence intervals for Grenander estimator of Ipp based on asymptotics</p></a></li>
<li><a href='#calculate_I'><p>Function to calculate different estimators for I from PPS data.</p></a></li>
<li><a href='#calculate_I_mixed'><p>Function to calculate incidence from PPS data using a mix of two estimators</p></a></li>
<li><a href='#calculate_I_rhame'><p>Function to calculate incidence from PPS data using a Rhame-Sudderth like approach</p>
with estimates for x.loi and x.los supplied.</a></li>
<li><a href='#calculate_I_smooth'><p>Estimate the incidence based on PPS data using monotone estimators for the distribution of A.</p></a></li>
<li><a href='#CI_np_bs'><p>Function to calculate confidence intervals I.pp for gren estimator with bootstrap method based on Grenander estimator</p></a></li>
<li><a href='#create_dist_vec'><p>Create vector of probabilities for a finite positive discrete distribution</p></a></li>
<li><a href='#create_patient_history_add'><p>Function to simulate a single hospital bed trajectory</p></a></li>
<li><a href='#epmf'><p>Calculate empirical probability mass function</p>
for a discrete positive distribution starting at 1</a></li>
<li><a href='#generate_I_fast'><p>Function to simulate PPS and data and calculate a number of estimators</p></a></li>
<li><a href='#geom_dist_fct'><p>Probability mass function for a geometric distribution shifted by one and resulting expected value 8</p></a></li>
<li><a href='#length_biased_dist'><p>Calculate length-biased distribution from discrete length-unbiased distribution</p>
starting at 1</a></li>
<li><a href='#length_unbiased_mean'><p>Calculate mean of length-unbiased distribution from discrete length-biased distribution</p>
starting at 1</a></li>
<li><a href='#monotone_smoother'><p>Calculate a monotone probability mass function estimate</p></a></li>
<li><a href='#pois_dist_fct'><p>Probability mass function for a Poisson distribution shifted by one and resulting expected value 8</p></a></li>
<li><a href='#simulate_incidence_stats'><p>Calculate theoretical values like</p>
x.los, x.loi and other characteristics of the patient population</a></li>
<li><a href='#simulate_incidence_stats_fast'><p>Function to calculate theoretical value for x.loi and I</p></a></li>
<li><a href='#simulate_pps_data'><p>Function to simulate PPS data</p></a></li>
<li><a href='#simulate_pps_fast'><p>Faster method to generate data for PPS with only length of nosocomial infections as output</p></a></li>
<li><a href='#X_to_A_dist'><p>Transform a distribution of times of stay to a</p>
distribution of staying-time up to observation point under
assumption of steady state.</a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Prevalence to Incidence Calculations for Point-Prevalence
Studies in a Nosocomial Setting</td>
</tr>
<tr>
<td>Version:</td>
<td>0.12.0</td>
</tr>
<tr>
<td>Author:</td>
<td>Niklas Willrich [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Niklas Willrich &lt;WillrichN@rki.de&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Functions to simulate point prevalence studies (PPSs) of healthcare-associated infections (HAIs) and to convert prevalence to incidence in steady state setups. 
    Companion package to the preprint Willrich et al., From prevalence to incidence - a new approach in the hospital setting;
    &lt;<a href="https://doi.org/10.1101%2F554725">doi:10.1101/554725</a>&gt; , where methods are explained in detail.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.2.2)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.1.1</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, rlang, tibble, purrr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat, ggplot2, gridExtra, tidyr</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2019-06-18 11:05:37 UTC; WillrichN</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2019-06-18 13:50:04 UTC</td>
</tr>
</table>
<hr>
<h2 id='prevtoinc'>prevtoinc:</h2><span id='topic+prevtoinc'></span><span id='topic+prevtoinc-package'></span>

<h3>Description</h3>

<p>The <strong>prevtoinc</strong> package implements functionality to simulate 
point-prevalence studies (PPSs) for healtcare-associated infections (HAIs) and estimate incidence based on the PPS data. It 
is a companion package to the preprint Willrich et al., From prevalence to incidence - a new approach in the hospital setting;
&lt;doi:10.1101/554725&gt; , where methods are explained in detail.
</p>

<hr>
<h2 id='A_to_X_dist'>function to transform the distribution of stays to a fixed
point to the distribution of the staying times</h2><span id='topic+A_to_X_dist'></span>

<h3>Description</h3>

<p>function to transform the distribution of stays to a fixed
point to the distribution of the staying times
</p>


<h3>Usage</h3>

<pre><code class='language-R'>A_to_X_dist(dist.point)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="A_to_X_dist_+3A_dist.point">dist.point</code></td>
<td>
<p>vector of probabilities of staying
1:length(dist.point) days</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of probabilities
of being at the hospital for 1:length(dist.point) days at
random time of observation
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# generate vector of probabilities for truncated Poisson distribution for 
# distribution of times of stay X
dist.X &lt;- dpois(1:70, 4)
plot(dist.X)
# transform to distribution of distribution of staying-time up to observation point under
# assumption of steady state
dist.A &lt;- X_to_A_dist(dist.X)
plot(dist.A)
# transform back to get original distribution
dist.X.2 &lt;- A_to_X_dist(dist.A)
plot(dist.X.2)

</code></pre>

<hr>
<h2 id='calculate_CI_I_pp'>Calculate confidence intervals for Grenander estimator of Ipp based on asymptotics</h2><span id='topic+calculate_CI_I_pp'></span>

<h3>Description</h3>

<p>Asymptotic or bootstrap approximation of confidence intervals for estimates of Ipp with gren method
Can use output of calculate_I_* functions as input. The asymptotic method uses 
the asymptotic normality of the estimator of I.pp to calculate the confidence interval and
the method &quot;bs&quot; uses a parametric bootstrap approximation based on the &quot;naive&quot; estimator.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_CI_I_pp(data, method = "asymptotic", alpha = 0.05,
  n_bs = 10000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calculate_CI_I_pp_+3A_data">data</code></td>
<td>
<p>data frame which contains at least the following columns
</p>

<ul>
<li><p>n - number of patients sampled 
</p>
</li>
<li><p>n.noso - number of HAIs
</p>
</li>
<li><p>P.hat - estimate of prevalence P
</p>
</li>
<li><p>x.loi.hat - estimate of x.loi
</p>
</li>
<li><p>x.los.hat - estimate of x.los
</p>
</li>
<li><p>I.pp.hat - estimate of incidence proportion per admission I.pp
</p>
</li></ul>
</td></tr>
<tr><td><code id="calculate_CI_I_pp_+3A_method">method</code></td>
<td>
<p>either &quot;asymptotic&quot; for asymptotic confidence interval or &quot;bs&quot; for bootstrap-based confidence interval</p>
</td></tr>
<tr><td><code id="calculate_CI_I_pp_+3A_alpha">alpha</code></td>
<td>
<p>confidence level</p>
</td></tr>
<tr><td><code id="calculate_CI_I_pp_+3A_n_bs">n_bs</code></td>
<td>
<p>number of bootstrap replications if method is &quot;bs&quot;</p>
</td></tr>
</table>


<h3>Value</h3>

<p>tibble with columns CI.lower.Ipp and CI.upper.Ipp
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
example.dist &lt;- create_dist_vec(function(x) dpois(x-1, 7), max.dist = 70)
example.dist.los &lt;- create_dist_vec(function(x) dpois(x-1, lambda = 12),
                                    max.dist = 70)
data.pps.fast &lt;- simulate_pps_fast(n.sample=5000,
                                   P=0.05,
                                   dist.X.loi = example.dist,
                                   dist.X.los = example.dist.los)
gren_est &lt;- calculate_I_smooth(data = data.pps.fast, method = "gren")
gren_est
calculate_CI_I_pp(gren_est, method = "asymptotic", alpha = 0.05)

</code></pre>

<hr>
<h2 id='calculate_I'>Function to calculate different estimators for I from PPS data.</h2><span id='topic+calculate_I'></span>

<h3>Description</h3>

<p>Function to calculate different estimators for I from PPS data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_I(data, data.theo = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calculate_I_+3A_data">data</code></td>
<td>
<p>data frame as generated by 'simulate_pps_data' or 'simulate_pps_fast'</p>
</td></tr>
<tr><td><code id="calculate_I_+3A_data.theo">data.theo</code></td>
<td>
<p>data frame as generated by 'simulate_incidence_stats' or 'simulate incidence_stats_fast&ldquo;</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data frame with following columns </p>

<ul>
<li><p>n - number of patients sampled 
</p>
</li>
<li><p>n.noso - number of HAIs
</p>
</li>
<li><p>P.hat - estimate of prevalence P
</p>
</li>
<li><p>I.hat - estimate of incidence rate I
</p>
</li>
<li><p>I.pp.hat - estimate of incidence proportion per admission I.pp
</p>
</li>
<li><p>x.loi.hat - estimate of x.loi
</p>
</li>
<li><p>x.los.hat - estimate of x.los
</p>
</li>
<li><p>method - name of the method
</p>
</li></ul>

<p>and rows for the estimators gren, rear, pps.median, pps.mean, pps.mixed, 
rhame.theo, L.full 
(for a description of the estimators see vignette).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# create example data for PPS
example.dist &lt;- create_dist_vec(function(x) dpois(x-1, 7), max.dist = 70)
example.dist.los &lt;- create_dist_vec(function(x) dpois(x-1, lambda = 12),
                                    max.dist = 70)
data.pps.fast &lt;- simulate_pps_fast(n.sample=200,
                                   P=0.05,
                                   dist.X.loi = example.dist,
                                   dist.X.los = example.dist.los)
head(data.pps.fast)

# estimate incidence based on Rhame-Sudderth formula
calculate_I(data = data.pps.fast)

</code></pre>

<hr>
<h2 id='calculate_I_mixed'>Function to calculate incidence from PPS data using a mix of two estimators</h2><span id='topic+calculate_I_mixed'></span>

<h3>Description</h3>

<p>A sigmoid function with parameters a and b (see below) is used to get weights
for a combination of the two estimator for x.loi and x.los.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_I_mixed(I.pps.1, I.pps.2, a = 0.01, b = 500,
  method = "pps.mixed")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calculate_I_mixed_+3A_i.pps.1">I.pps.1</code></td>
<td>
<p>resulting data frame for first estimator</p>
</td></tr>
<tr><td><code id="calculate_I_mixed_+3A_i.pps.2">I.pps.2</code></td>
<td>
<p>resulting data frame for second estimator</p>
</td></tr>
<tr><td><code id="calculate_I_mixed_+3A_a">a</code></td>
<td>
<p>parameter a for the sigmoid function</p>
</td></tr>
<tr><td><code id="calculate_I_mixed_+3A_b">b</code></td>
<td>
<p>parameter b for the sigmoid function</p>
</td></tr>
<tr><td><code id="calculate_I_mixed_+3A_method">method</code></td>
<td>
<p>name of the method</p>
</td></tr>
</table>


<h3>Details</h3>

<p>is achieved in the following way for estimation of x.loi
alpha = exp(a*(n.noso-b))/(1+exp(a*(n.noso-b)))
x.loi.hat.mixed = alpha*x.loi.hat.1 + (1-alpha)*x.loi.hat.2
</p>
<p>alpha = exp(a*(n-b))/(1+exp(a*(n-b)))
x.los.hat.mixed = alpha*x.los.hat.1 + (1-alpha)*x.los.hat.2
</p>


<h3>Value</h3>

<p>one-row data frame with following columns </p>

<ul>
<li><p>n - number of patients sampled 
</p>
</li>
<li><p>n.noso - number of HAIs
</p>
</li>
<li><p>P.hat - estimate of prevalence P
</p>
</li>
<li><p>I.hat - estimate of incidence rate I
</p>
</li>
<li><p>I.pp.hat - estimate of incidence proportion per admission I.pp
</p>
</li>
<li><p>x.loi.hat - estimate of x.loi
</p>
</li>
<li><p>x.los.hat - estimate of x.los
</p>
</li>
<li><p>method - name of the method
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
# create example data for PPS
example.dist &lt;- create_dist_vec(function(x) dpois(x-1, 7), max.dist = 70)
example.dist.los &lt;- create_dist_vec(function(x) dpois(x-1, lambda = 12),
                                    max.dist = 70)
data.pps.fast &lt;- simulate_pps_fast(n.sample=200,
                                   P=0.05,
                                   dist.X.loi = example.dist,
                                   dist.X.los = example.dist.los)
head(data.pps.fast)

# estimate of incidence
I.1 &lt;- calculate_I_smooth(data = data.pps.fast,
                   method = "gren")
                   
# estimate incidence based on Rhame-Sudderth formula
I.2 &lt;- calculate_I_rhame(data = data.pps.fast,
                   x.loi.hat = 8,
                   x.los.hat = 13)

# mixed estimator                                      
calculate_I_mixed(I.1, I.2)

</code></pre>

<hr>
<h2 id='calculate_I_rhame'>Function to calculate incidence from PPS data using a Rhame-Sudderth like approach 
with estimates for x.loi and x.los supplied.</h2><span id='topic+calculate_I_rhame'></span>

<h3>Description</h3>

<p>Function to calculate incidence from PPS data using a Rhame-Sudderth like approach 
with estimates for x.loi and x.los supplied.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_I_rhame(data, x.loi.hat, x.los.hat = NA, method = "rhame")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calculate_I_rhame_+3A_data">data</code></td>
<td>
<p>one-row data frame which contains a column A.loi (only used to calculate P.hat) 
with lengths of nosocomial infections up to survey (a 0 indicates no HAI present)</p>
</td></tr>
<tr><td><code id="calculate_I_rhame_+3A_x.loi.hat">x.loi.hat</code></td>
<td>
<p>value for estimated expected length of infection x_loi</p>
</td></tr>
<tr><td><code id="calculate_I_rhame_+3A_x.los.hat">x.los.hat</code></td>
<td>
<p>value for estimated expected length of stay x_los (optional)</p>
</td></tr>
<tr><td><code id="calculate_I_rhame_+3A_method">method</code></td>
<td>
<p>a string with associated name for method</p>
</td></tr>
</table>


<h3>Value</h3>

<p>one-row data frame with following columns </p>

<ul>
<li><p>n - number of patients sampled 
</p>
</li>
<li><p>n.noso - number of HAIs
</p>
</li>
<li><p>P.hat - estimate of prevalence P
</p>
</li>
<li><p>I.hat - estimate of incidence rate I
</p>
</li>
<li><p>I.pp.hat - estimate of incidence proportion per admission I.pp
</p>
</li>
<li><p>x.loi.hat - estimate of x.loi
</p>
</li>
<li><p>x.los.hat - estimate of x.los
</p>
</li>
<li><p>method - name of the method
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
# create example data for PPS
example.dist &lt;- create_dist_vec(function(x) dpois(x-1, 7), max.dist = 70)
example.dist.los &lt;- create_dist_vec(function(x) dpois(x-1, lambda = 12),
                                    max.dist = 70)
data.pps.fast &lt;- simulate_pps_fast(n.sample=200,
                                   P=0.05,
                                   dist.X.loi = example.dist,
                                   dist.X.los = example.dist.los)
head(data.pps.fast)

# estimate incidence based on Rhame-Sudderth formula
calculate_I_rhame(data = data.pps.fast,
                   x.loi.hat = 8,
                   x.los.hat = 13)

</code></pre>

<hr>
<h2 id='calculate_I_smooth'>Estimate the incidence based on PPS data using monotone estimators for the distribution of A.</h2><span id='topic+calculate_I_smooth'></span>

<h3>Description</h3>

<p>Estimate incidence from PPS by the method proposed in the companion paper.
'data' should be supplied as a data frame with at least a column named 'A.loi'
giving lengths of infection up to date of PPS.
Values of zero for 'A.loi' indicate absence of a HAI. Optionally,
the data frame can also contain a column 'A.los' supplying lengths
of stay up to PPS to estimate x.los with the same method as well.
If 'correct.one' is 'TRUE', the number infections on their first day
will be augmented to be at least as high as the number of infections
on their second day for the estimation of x.loi .
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_I_smooth(data, method = "gren", correct.one.loi = "no",
  correct.one.los = "no")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calculate_I_smooth_+3A_data">data</code></td>
<td>
<p>data frame which contains a column 'A.loi' 
with lengths of nosocomial infections up to survey point ( zero if none) and
possibly a column 'A.los' with length of stay up to survey point</p>
</td></tr>
<tr><td><code id="calculate_I_smooth_+3A_method">method</code></td>
<td>
<p>method to use for smoothing (&quot;gren&quot; ( Grenander ) or &quot;rear&quot; (rearrangement))</p>
</td></tr>
<tr><td><code id="calculate_I_smooth_+3A_correct.one.loi">correct.one.loi</code></td>
<td>
<p>use correction for underreporting of one day LOIs:
&quot;no&quot; if none, &quot;fill.ones&quot; to set the one-day cases to be at least the number
of two-day cases, &quot;start.two&quot; to only use P(A=2| A &gt; 1) as a proxy for P(A=1)</p>
</td></tr>
<tr><td><code id="calculate_I_smooth_+3A_correct.one.los">correct.one.los</code></td>
<td>
<p>use correction for underreporting of one day LOSs:
&quot;no&quot; if none, &quot;fill.ones&quot; to set the one-day cases to be at least the number
of two-day cases, &quot;start.two&quot; to only use P(A=2| A &gt; 1) as a proxy for P(A=1)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>one-row data frame with following columns </p>

<ul>
<li><p>n - number of patients sampled 
</p>
</li>
<li><p>n.noso - number of HAIs
</p>
</li>
<li><p>P.hat - estimate of prevalence P
</p>
</li>
<li><p>I.hat - estimate of incidence rate I
</p>
</li>
<li><p>I.pp.hat - estimate of incidence proportion per admission I.pp
</p>
</li>
<li><p>x.loi.hat - estimate of x.loi
</p>
</li>
<li><p>x.los.hat - estimate of x.los
</p>
</li>
<li><p>method - name of the method
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
# create example data for PPS
example.dist &lt;- create_dist_vec(function(x) dpois(x-1, 7), max.dist = 70)
example.dist.los &lt;- create_dist_vec(function(x) dpois(x-1, lambda = 12),
                                    max.dist = 70)
data.pps.fast &lt;- simulate_pps_fast(n.sample=200,
                                   P=0.05,
                                   dist.X.loi = example.dist,
                                   dist.X.los = example.dist.los)
head(data.pps.fast)

# estimate of incidence
calculate_I_smooth(data = data.pps.fast,
                   method = "gren")


</code></pre>

<hr>
<h2 id='CI_np_bs'>Function to calculate confidence intervals I.pp for gren estimator with bootstrap method based on Grenander estimator</h2><span id='topic+CI_np_bs'></span>

<h3>Description</h3>

<p>Implements a bootstrap procedure for estimation of confidence intervals for I.pp based on boostrapping 
from the length of stay/infection distributions estimated by the gren method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CI_np_bs(data, n_bs = 1000, alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CI_np_bs_+3A_data">data</code></td>
<td>
<p>data frame which contains a column 'A.loi' 
with lengths of nosocomial infections up to survey point ( zero if none) and
a column 'A.los' with length of stay up to survey point</p>
</td></tr>
<tr><td><code id="CI_np_bs_+3A_n_bs">n_bs</code></td>
<td>
<p>number of bootstrap samples to use for calculations</p>
</td></tr>
<tr><td><code id="CI_np_bs_+3A_alpha">alpha</code></td>
<td>
<p>confidence level</p>
</td></tr>
</table>


<h3>Value</h3>

<p>single-row tibble with columns CI.lower.Ipp and CI.upper.Ipp
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
example.dist &lt;- create_dist_vec(function(x) dpois(x-1, 7), max.dist = 70)
example.dist.los &lt;- create_dist_vec(function(x) dpois(x-1, lambda = 12),
                                    max.dist = 70)
data.pps.fast &lt;- simulate_pps_fast(n.sample=5000,
                                   P=0.05,
                                   dist.X.loi = example.dist,
                                   dist.X.los = example.dist.los)
gren_est &lt;- calculate_I_smooth(data = data.pps.fast, method = "gren")
gren_est
CI_np_bs(data.pps.fast, n_bs = 500)
</code></pre>

<hr>
<h2 id='create_dist_vec'>Create vector of probabilities for a finite positive discrete distribution</h2><span id='topic+create_dist_vec'></span>

<h3>Description</h3>

<p>Cuts-off the (possibly unbounded) probability distribution at 'max.dist'
and normalizes the resulting vector of probability to sum up to 1.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_dist_vec(dist, max.dist)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_dist_vec_+3A_dist">dist</code></td>
<td>
<p>probability mass function to use</p>
</td></tr>
<tr><td><code id="create_dist_vec_+3A_max.dist">max.dist</code></td>
<td>
<p>maximum value at which to cutoff distribution</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of probabilites for values 1:max.dist
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

geom_dist_fct(1:70)
create_dist_vec(geom_dist_fct, max.dist = 70)

</code></pre>

<hr>
<h2 id='create_patient_history_add'>Function to simulate a single hospital bed trajectory</h2><span id='topic+create_patient_history_add'></span>

<h3>Description</h3>

<p>Simulates the occupation of bed and incidence of HAIs of a single bed. 
Length of HAI is assumed to be additive to length of stay without HAI.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_patient_history_add(X_los_dist, X_loi_dist, I, steps)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_patient_history_add_+3A_x_los_dist">X_los_dist</code></td>
<td>
<p>vector of probabilities for values 1:length(dist.X.los) of X.los</p>
</td></tr>
<tr><td><code id="create_patient_history_add_+3A_x_loi_dist">X_loi_dist</code></td>
<td>
<p>vector of probabilities for values 1:length(dist.X.loi) of X.loi</p>
</td></tr>
<tr><td><code id="create_patient_history_add_+3A_i">I</code></td>
<td>
<p>incidence rate per patient-day at risk</p>
</td></tr>
<tr><td><code id="create_patient_history_add_+3A_steps">steps</code></td>
<td>
<p>number of days to evolve trajectory of bed</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data frame with following columns </p>

<ul>
<li><p>pat_nbr - sequential patient number
</p>
</li>
<li><p>hai_nbr - sequential HAI number
</p>
</li>
<li><p>X_los -  predicted total length of stay for patient on current day
</p>
</li>
<li><p>X_los_wo_hai - 
</p>
</li>
<li><p>X_loi - total length of current HAI
</p>
</li>
<li><p>X_loi_tot - added total lengths of all HAIs up to day
</p>
</li>
<li><p>A_los -  length of stay up to day
</p>
</li>
<li><p>X_lnint - length of stay after acquiring first HAI
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>

example.dist &lt;- create_dist_vec(function(x) dpois(x-1, 7), max.dist = 70)
example.dist.los &lt;- create_dist_vec(function(x) dpois(x-1, lambda = 12),
                                    max.dist = 70)
bed_hist &lt;- create_patient_history_add(example.dist.los, example.dist, I = 0.08, 1000)
tail(bed_hist)


</code></pre>

<hr>
<h2 id='epmf'>Calculate empirical probability mass function
for a discrete positive distribution starting at 1</h2><span id='topic+epmf'></span>

<h3>Description</h3>

<p>Calculate empirical probability mass function
for a discrete positive distribution starting at 1
</p>


<h3>Usage</h3>

<pre><code class='language-R'>epmf(values)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="epmf_+3A_values">values</code></td>
<td>
<p>used for the calculation of the empirical pmf</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of probabilities for epmf for the range 1:length(values)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# generate random sample of independent draws from Poisson distribution
x &lt;- rpois(200,4)
# calculate empirical probability mass function and true probability mass function
y.emp  &lt;- epmf(x)
y.theo &lt;- dpois(1:max(x), 4)
plot(y.emp)
points(y.theo, col = "red")

</code></pre>

<hr>
<h2 id='generate_I_fast'>Function to simulate PPS and data and calculate a number of estimators</h2><span id='topic+generate_I_fast'></span>

<h3>Description</h3>

<p>Function to simulate PPS and data and calculate a number of estimators
</p>


<h3>Usage</h3>

<pre><code class='language-R'>generate_I_fast(n.sample, P, dist.X.loi, data.theo = NULL,
  dist.X.los = NA, one.factor.loi = 1, one.factor.los = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="generate_I_fast_+3A_n.sample">n.sample</code></td>
<td>
<p>number of beds to simulate</p>
</td></tr>
<tr><td><code id="generate_I_fast_+3A_p">P</code></td>
<td>
<p>average prevalence of nosocomial infections</p>
</td></tr>
<tr><td><code id="generate_I_fast_+3A_dist.x.loi">dist.X.loi</code></td>
<td>
<p>vector of probabilities for values 1:length(dist.X.loi) of X.loi</p>
</td></tr>
<tr><td><code id="generate_I_fast_+3A_data.theo">data.theo</code></td>
<td>
<p>data frame with theoretical info generated by simulate_incidence_stats_* function</p>
</td></tr>
<tr><td><code id="generate_I_fast_+3A_dist.x.los">dist.X.los</code></td>
<td>
<p>vector of probabilities for values 1:length(dist.X.los) of X.los</p>
</td></tr>
<tr><td><code id="generate_I_fast_+3A_one.factor.loi">one.factor.loi</code></td>
<td>
<p>factor by which to approx. reduce number of one day observations for A.loi</p>
</td></tr>
<tr><td><code id="generate_I_fast_+3A_one.factor.los">one.factor.los</code></td>
<td>
<p>factor by which to approx. reduce number of one day observations for A.los</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data frame with following columns </p>

<ul>
<li><p>n - number of patients sampled 
</p>
</li>
<li><p>n.noso - number of HAIs
</p>
</li>
<li><p>P.hat - estimate of prevalence P
</p>
</li>
<li><p>I.hat - estimate of incidence rate I
</p>
</li>
<li><p>I.pp.hat - estimate of incidence proportion per admission I.pp
</p>
</li>
<li><p>x.loi.hat - estimate of x.loi
</p>
</li>
<li><p>x.los.hat - estimate of x.los
</p>
</li>
<li><p>method - name of the method
</p>
</li></ul>

<p>and rows for the estimators gren, rear, pps.median, pps.mean, pps.mixed, 
rhame.theo, L.full 
(for a description of the estimators see vignette).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>example.dist &lt;- create_dist_vec(function(x) dpois(x-1, 7), max.dist = 70)
generate_I_fast(200, P = 0.05, example.dist )

</code></pre>

<hr>
<h2 id='geom_dist_fct'>Probability mass function for a geometric distribution shifted by one and resulting expected value 8</h2><span id='topic+geom_dist_fct'></span>

<h3>Description</h3>

<p>Probability mass function for a geometric distribution shifted by one and resulting expected value 8
</p>


<h3>Usage</h3>

<pre><code class='language-R'>geom_dist_fct(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="geom_dist_fct_+3A_x">x</code></td>
<td>
<p>vector of positive integer values to evaluate</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
plot(geom_dist_fct(1:100)) 

</code></pre>

<hr>
<h2 id='length_biased_dist'>Calculate length-biased distribution from discrete length-unbiased distribution
starting at 1</h2><span id='topic+length_biased_dist'></span>

<h3>Description</h3>

<p>Calculate length-biased distribution from discrete length-unbiased distribution
starting at 1
</p>


<h3>Usage</h3>

<pre><code class='language-R'>length_biased_dist(dist)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="length_biased_dist_+3A_dist">dist</code></td>
<td>
<p>vector of probabilities of distribution to transform</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of probabilities of transformed distribution
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# geometric distribution starting in 1 and cutoff at 70 with mean at about 8.
geom.dist &lt;- create_dist_vec(geom_dist_fct, max.dist = 70)
# calculate mean
sum(1:length(geom.dist)*geom.dist)
# plot original distribution
plot(geom.dist)
geom.dist.lb &lt;- length_biased_dist(geom.dist)
# plot length biased distribution
plot(geom.dist.lb)

</code></pre>

<hr>
<h2 id='length_unbiased_mean'>Calculate mean of length-unbiased distribution from discrete length-biased distribution 
starting at 1</h2><span id='topic+length_unbiased_mean'></span>

<h3>Description</h3>

<p>Calculate mean of length-unbiased distribution from discrete length-biased distribution 
starting at 1
</p>


<h3>Usage</h3>

<pre><code class='language-R'>length_unbiased_mean(dist)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="length_unbiased_mean_+3A_dist">dist</code></td>
<td>
<p>vector of probabilities of length-biased distribution</p>
</td></tr>
</table>


<h3>Value</h3>

<p>mean of length-unbiased distribution
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# geometric distribution starting in 1 and cutoff at 70 with mean at about 8.
geom.dist &lt;- create_dist_vec(geom_dist_fct, max.dist = 70)
# calculate mean of distribution
sum(1:length(geom.dist)*geom.dist)
# create length-biased distribution in same format
geom.dist.lb &lt;- length_biased_dist(geom.dist)

# recalculate mean of original distribution based on length-biased distribution
length_unbiased_mean(geom.dist.lb)

</code></pre>

<hr>
<h2 id='monotone_smoother'>Calculate a monotone probability mass function estimate</h2><span id='topic+monotone_smoother'></span>

<h3>Description</h3>

<p>using a  rearrangement or a Grenander estimator as described in Jankoswski,
Wellner, 2009 &lt;doi:10.1214/09-EJS526&gt;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>monotone_smoother(values, method = "rear", range = c(1, max(values)))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="monotone_smoother_+3A_values">values</code></td>
<td>
<p>observed values of distribution</p>
</td></tr>
<tr><td><code id="monotone_smoother_+3A_method">method</code></td>
<td>
<p>method of estimation &quot;rear&quot; rearrangement or &quot;gren&quot; Grenander</p>
</td></tr>
<tr><td><code id="monotone_smoother_+3A_range">range</code></td>
<td>
<p>boundaries of the support of the distribution</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of estimated pmf (support of distribution is by default assumed to be min(values):max(values) )
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# generate sample from geometric distribution
A &lt;- rgeom(50, 0.2)
# plot empirical probability mass function
plot(epmf(A))
dist.A.gren &lt;- monotone_smoother(A, method = "gren")
# plot estimated probability mass function
points(dist.A.gren, col = "red")

</code></pre>

<hr>
<h2 id='pois_dist_fct'>Probability mass function for a Poisson distribution shifted by one and resulting expected value 8</h2><span id='topic+pois_dist_fct'></span>

<h3>Description</h3>

<p>Probability mass function for a Poisson distribution shifted by one and resulting expected value 8
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pois_dist_fct(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pois_dist_fct_+3A_x">x</code></td>
<td>
<p>vector of positive integer values to evaluate</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
plot(pois_dist_fct(1:100))

</code></pre>

<hr>
<h2 id='simulate_incidence_stats'>Calculate theoretical values like 
x.los, x.loi and other characteristics of the patient population</h2><span id='topic+simulate_incidence_stats'></span>

<h3>Description</h3>

<p>Calculate theoretical values like 
x.los, x.loi and other characteristics of the patient population
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate_incidence_stats(hospital, steps = 365 * 10000,
  n.sim.pat = 5000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simulate_incidence_stats_+3A_hospital">hospital</code></td>
<td>
<p>type of hospital as a list-object (see vignette for details)</p>
</td></tr>
<tr><td><code id="simulate_incidence_stats_+3A_steps">steps</code></td>
<td>
<p>number of steps to evolve process</p>
</td></tr>
<tr><td><code id="simulate_incidence_stats_+3A_n.sim.pat">n.sim.pat</code></td>
<td>
<p>size of simulations to estimate individual characteristics of patients</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with following components </p>

<ul>
<li><p>x.los - average length of stay x_los 
</p>
</li>
<li><p>x.loi - average length of infection x_loi
</p>
</li>
<li><p>x.los.noso.only - average length of stay for patients with HAI
</p>
</li>
<li><p>x.los.wo.noso - average length of stay for patients discounting time with HAI    
</p>
</li>
<li><p>I -  theoretical incidence rate per patient day
</p>
</li>
<li><p>I.pp - list of theoretical incidences for patient types
</p>
</li>
<li><p>patient.stats - list with 'x.los' and 'x.loi' for different patient types
</p>
</li>
<li><p>patient.risk.times - list of patient days at risk for different patient types
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>pat.1 &lt;- list(dist.X.los = create_dist_vec(
                               function(x) dpois(x-1, lambda = 12), 70),
I.p = 0.008,
dist.X.loi = create_dist_vec(function(x) dpois(x-1, lambda = 10), 70))

pat.2 &lt;- list(dist.X.los = 
                create_dist_vec(function(x) dpois(x-1, lambda = 10), 70),
              I.p = 0.02,
              dist.X.loi = 
                create_dist_vec(function(x) dpois(x-1, lambda = 7), 70))

patient.list &lt;- list(pat.1, pat.2)


# define distribution of patients
pat.1.prob &lt;- 0.4; pat.2.prob &lt;- 0.6
pat.dist.hosp &lt;- c(pat.1.prob, pat.2.prob)
hospital.1 &lt;- list(inc.factor = 1,
                   pat.dist = pat.dist.hosp,
                   patient.list = patient.list)
data.pps &lt;- simulate_pps_data(n.sample=1000, steps=200, hospital=hospital.1) 
data.inc.theo &lt;- simulate_incidence_stats(hospital.1, 365 * 1000)
# gives incidence rate I
data.inc.theo$I
# gives incidence proportion per admission
data.inc.theo$I.pp
</code></pre>

<hr>
<h2 id='simulate_incidence_stats_fast'>Function to calculate theoretical value for x.loi and I</h2><span id='topic+simulate_incidence_stats_fast'></span>

<h3>Description</h3>

<p>Function to calculate theoretical value for x.loi and I
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate_incidence_stats_fast(P, dist.X.loi, dist.X.los = NA)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simulate_incidence_stats_fast_+3A_p">P</code></td>
<td>
<p>prevalence of HAIs</p>
</td></tr>
<tr><td><code id="simulate_incidence_stats_fast_+3A_dist.x.loi">dist.X.loi</code></td>
<td>
<p>probability mass function of distribution of lengths of infection</p>
</td></tr>
<tr><td><code id="simulate_incidence_stats_fast_+3A_dist.x.los">dist.X.los</code></td>
<td>
<p>vector of probabilities for values 1:length(dist.X.los) of X.los</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with following components </p>

<ul>
<li><p>x.loi - average length of infection
</p>
</li>
<li><p>x.los - average length of stay
</p>
</li>
<li><p>I - theoretical incidence rate per patient day
</p>
</li>
<li><p>I.pp - theoretical incidence proportion per admission
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>example.dist &lt;- create_dist_vec(function(x) dpois(x-1, 7), 70)
data.fast.inc.theo &lt;- simulate_incidence_stats_fast(P=0.05, dist.X.loi = example.dist)
data.fast.inc.theo$x.loi
data.fast.inc.theo$I
</code></pre>

<hr>
<h2 id='simulate_pps_data'>Function to simulate PPS data</h2><span id='topic+simulate_pps_data'></span>

<h3>Description</h3>

<p>Simulates PPS data for a prespecified hospital according to a steady state model of
incidence ( see vignette &quot;Overview of prevtoinc-Package&quot; for details.)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate_pps_data(n.sample, steps, hospital)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simulate_pps_data_+3A_n.sample">n.sample</code></td>
<td>
<p>number of beds to simulate</p>
</td></tr>
<tr><td><code id="simulate_pps_data_+3A_steps">steps</code></td>
<td>
<p>number of steps to evolve the process</p>
</td></tr>
<tr><td><code id="simulate_pps_data_+3A_hospital">hospital</code></td>
<td>
<p>type of hospital as a list-object (see vignette for details)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data frame with following columns </p>

<ul>
<li><p>A.loi - length of infection up to PPS
</p>
</li>
<li><p>L.loi - total length of infection
</p>
</li>
<li><p>A.los - length of stay up to PPS
</p>
</li>
<li><p>L.los - total length of stay
</p>
</li>
<li><p>patient.type - patient type
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
pat.1 &lt;- list(dist.X.los = 
                   create_dist_vec(function(x) dpois(x-1, lambda = 12), 70),
              I.p = 0.008,
              dist.X.loi = 
                   create_dist_vec(function(x) dpois(x-1, lambda = 10), 70))

pat.2 &lt;- list(dist.X.los = 
                   create_dist_vec(function(x) dpois(x-1, lambda = 10), 70),
              I.p = 0.02,
              dist.X.loi =
                   create_dist_vec(function(x) dpois(x-1, lambda = 7), 70))

patient.list &lt;- list(pat.1, pat.2)


# define distribution of patients
pat.1.prob &lt;- 0.4; pat.2.prob &lt;- 0.6
pat.dist.hosp &lt;- c(pat.1.prob, pat.2.prob)
hospital.1 &lt;- list(inc.factor = 1,
                   pat.dist = pat.dist.hosp,
                   patient.list = patient.list)
data.pps &lt;- simulate_pps_data(n.sample=1000, steps=200, hospital=hospital.1)                    

</code></pre>

<hr>
<h2 id='simulate_pps_fast'>Faster method to generate data for PPS with only length of nosocomial infections as output</h2><span id='topic+simulate_pps_fast'></span>

<h3>Description</h3>

<p>The function 'simulate_pps_fast' can be used to generate PPS data.
This functions simulates a PPS on the basis of a given prevalence 'P' using
a vector of probabilities 'dist.X.loi' for the values 1:length(dist.X.loi) of X.loi.
It directly samples the time of infection up to date based on 'dist.X.loi'.
Optionally, the length of stay is sampled independently ( treating the marginal
distributions of length of stay and length of infection as independent
by assumption) using 'dist.X.los' which is in the same format as 'dist.X.loi'. 
Because of this non-joint sampling rows should not be interpreted as individual 
patients.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate_pps_fast(n.sample, P, dist.X.loi, dist.X.los = NA,
  one.factor.loi = 1, one.factor.los = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simulate_pps_fast_+3A_n.sample">n.sample</code></td>
<td>
<p>number of beds to simulate</p>
</td></tr>
<tr><td><code id="simulate_pps_fast_+3A_p">P</code></td>
<td>
<p>prevalence of nosocomial infections</p>
</td></tr>
<tr><td><code id="simulate_pps_fast_+3A_dist.x.loi">dist.X.loi</code></td>
<td>
<p>vector of probabilities for values 1:length(dist.X.loi) of X.loi</p>
</td></tr>
<tr><td><code id="simulate_pps_fast_+3A_dist.x.los">dist.X.los</code></td>
<td>
<p>vector of probabilities for values 1:length(dist.X.los) of X.los</p>
</td></tr>
<tr><td><code id="simulate_pps_fast_+3A_one.factor.loi">one.factor.loi</code></td>
<td>
<p>factor by which to approx. reduce number of one day observations for A.loi</p>
</td></tr>
<tr><td><code id="simulate_pps_fast_+3A_one.factor.los">one.factor.los</code></td>
<td>
<p>factor by which to approx. reduce number of one day observations for A.los</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data frame with a row for a each simulated patient and  the following columns 
</p>
 
<ul>
<li><p>A.loi - length of infection up to PPS
</p>
</li>
<li><p>L.loi - total length of infection  
</p>
</li>
<li><p>A.los - length of stay up to PPS 
</p>
</li>
<li><p>L.los - total length of stay 
</p>
</li>
<li><p>patient.type - patient type (fixed to 1 for fast method)
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>example.dist &lt;- create_dist_vec(function(x) dpois(x-1, 7), 70)
data.pps.fast &lt;- simulate_pps_fast(n.sample=5000,
                                  P=0.05,
                                  dist.X.loi = example.dist)
head(data.pps.fast)
</code></pre>

<hr>
<h2 id='X_to_A_dist'>Transform a distribution of times of stay to a
distribution of staying-time up to observation point under
assumption of steady state.</h2><span id='topic+X_to_A_dist'></span>

<h3>Description</h3>

<p>Transform a distribution of times of stay to a
distribution of staying-time up to observation point under
assumption of steady state.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>X_to_A_dist(dist.stays)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="X_to_A_dist_+3A_dist.stays">dist.stays</code></td>
<td>
<p>vector of probabilities of being at the
hospital for 1:length(dist.stays) days at random time of
observation</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of probabilities of staying
1:length(dist.point) days
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# generate vector of probabilities for truncated Poisson distribution for 
# distribution of times of stay X
dist.X &lt;- dpois(1:70, 4)
plot(dist.X)
# transform to distribution of distribution of staying-time up to observation point under
# assumption of steady state
dist.A &lt;- X_to_A_dist(dist.X)
plot(dist.A)
# transform back to get original distribution
dist.X.2 &lt;- A_to_X_dist(dist.A)
plot(dist.X.2)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
