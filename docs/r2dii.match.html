<!DOCTYPE html><html><head><title>Help for package r2dii.match</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {r2dii.match}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#r2dii.match-package'><p>r2dii.match: Tools to Match Corporate Lending Portfolios with Climate Data</p></a></li>
<li><a href='#+25+26gt+3B+25'><p>Pipe operator</p></a></li>
<li><a href='#crucial_lbk'><p>Crucial <code>loanbook</code> columns for <code>match_name()</code></p></a></li>
<li><a href='#match_name'><p>Match a loanbook to asset-based company data (abcd) by the <code style="white-space: pre;">&#8288;name_*&#8288;</code> columns</p></a></li>
<li><a href='#prioritize'><p>Pick rows where <code>score</code> is 1 and <code>level</code> per loan is of highest <code>priority</code></p></a></li>
<li><a href='#prioritize_level'><p>Arrange unique <code>level</code> values in default order of <code>priority</code></p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Tools to Match Corporate Lending Portfolios with Climate Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.0</td>
</tr>
<tr>
<td>Description:</td>
<td>These tools implement in R a fundamental part of the software
    'PACTA' (Paris Agreement Capital Transition Assessment), which is a
    free tool that calculates the alignment between financial portfolios
    and climate scenarios (<a href="https://www.transitionmonitor.com/">https://www.transitionmonitor.com/</a>). Financial
    institutions use 'PACTA' to study how their capital allocation
    decisions align with climate change mitigation goals. This package
    matches data from corporate lending portfolios to asset level data
    from market-intelligence databases (e.g. power plant capacities,
    emission factors, etc.). This is the first step to assess if a
    financial portfolio aligns with climate goals.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://rmi-pacta.github.io/r2dii.match/">https://rmi-pacta.github.io/r2dii.match/</a>,
<a href="https://github.com/RMI-PACTA/r2dii.match">https://github.com/RMI-PACTA/r2dii.match</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/RMI-PACTA/r2dii.match/issues">https://github.com/RMI-PACTA/r2dii.match/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.4)</td>
</tr>
<tr>
<td>Imports:</td>
<td>data.table, dplyr (&ge; 0.8.5), glue, lifecycle, magrittr,
purrr, r2dii.data (&ge; 0.4.0), rlang, stringdist, stringi,
tibble, tidyr, tidyselect, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, rmarkdown, spelling, testthat (&ge; 2.1.0)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Config/Needs/website:</td>
<td>rmi-pacta/pacta.pkgdown.rmitemplate</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-03-22 14:39:00 UTC; jdhoffa</td>
</tr>
<tr>
<td>Author:</td>
<td>Alex Axthelm <a href="https://orcid.org/0000-0001-8579-8565"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Jackson Hoffart <a href="https://orcid.org/0000-0002-8600-5042"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, ctr],
  Mauro Lepore <a href="https://orcid.org/0000-0002-1986-7988"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, ctr],
  Klaus Hagedorn [aut],
  Florence Palandri [aut],
  Evgeny Petrovsky [aut],
  Rocky Mountain Institute [cph, fnd]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Alex Axthelm &lt;aaxthelm@rmi.org&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-03-25 11:30:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='r2dii.match-package'>r2dii.match: Tools to Match Corporate Lending Portfolios with Climate Data</h2><span id='topic+r2dii.match'></span><span id='topic+r2dii.match-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>These tools implement in R a fundamental part of the software 'PACTA' (Paris Agreement Capital Transition Assessment), which is a free tool that calculates the alignment between financial portfolios and climate scenarios (<a href="https://www.transitionmonitor.com/">https://www.transitionmonitor.com/</a>). Financial institutions use 'PACTA' to study how their capital allocation decisions align with climate change mitigation goals. This package matches data from corporate lending portfolios to asset level data from market-intelligence databases (e.g. power plant capacities, emission factors, etc.). This is the first step to assess if a financial portfolio aligns with climate goals.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Alex Axthelm <a href="mailto:aaxthelm@rmi.org">aaxthelm@rmi.org</a> (<a href="https://orcid.org/0000-0001-8579-8565">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Jackson Hoffart <a href="mailto:jackson.hoffart@gmail.com">jackson.hoffart@gmail.com</a> (<a href="https://orcid.org/0000-0002-8600-5042">ORCID</a>) [contractor]
</p>
</li>
<li><p> Mauro Lepore <a href="mailto:maurolepore@gmail.com">maurolepore@gmail.com</a> (<a href="https://orcid.org/0000-0002-1986-7988">ORCID</a>) [contractor]
</p>
</li>
<li><p> Klaus Hagedorn <a href="mailto:klaus@2degrees-investing.org">klaus@2degrees-investing.org</a>
</p>
</li>
<li><p> Florence Palandri <a href="mailto:florence@2degrees-investing.org">florence@2degrees-investing.org</a>
</p>
</li>
<li><p> Evgeny Petrovsky
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Rocky Mountain Institute <a href="mailto:PACTA4banks@rmi.org">PACTA4banks@rmi.org</a> [copyright holder, funder]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://rmi-pacta.github.io/r2dii.match/">https://rmi-pacta.github.io/r2dii.match/</a>
</p>
</li>
<li> <p><a href="https://github.com/RMI-PACTA/r2dii.match">https://github.com/RMI-PACTA/r2dii.match</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/RMI-PACTA/r2dii.match/issues">https://github.com/RMI-PACTA/r2dii.match/issues</a>
</p>
</li></ul>


<hr>
<h2 id='+25+26gt+3B+25'>Pipe operator</h2><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>See <code>magrittr::<a href="magrittr.html#topic+pipe">%&gt;%</a></code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lhs %&gt;% rhs
</code></pre>

<hr>
<h2 id='crucial_lbk'>Crucial <code>loanbook</code> columns for <code>match_name()</code></h2><span id='topic+crucial_lbk'></span>

<h3>Description</h3>

<p>This is a helper to select the minimum <code>loanbook</code> columns you need to run
<code>match_name()</code>. Using more columns may use too much time and memory.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>crucial_lbk()
</code></pre>


<h3>Value</h3>

<p>A character vector.
</p>


<h3>See Also</h3>

<p>Other helpers: 
<code><a href="#topic+prioritize_level">prioritize_level</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>crucial_lbk()
</code></pre>

<hr>
<h2 id='match_name'>Match a loanbook to asset-based company data (abcd) by the <code style="white-space: pre;">&#8288;name_*&#8288;</code> columns</h2><span id='topic+match_name'></span>

<h3>Description</h3>

<p><code>match_name()</code> scores the match between names in a loanbook dataset (columns
can be <code>name_direct_loantaker</code>, <code style="white-space: pre;">&#8288;name_intermediate_parent*&#8288;</code> and
<code>name_ultimate_parent</code>) with names in an asset-based company data (column
<code>name_company</code>). The raw names are first internally transformed, and aliases
are assigned. The similarity between aliases in each of the loanbook and abcd
is scored using <code><a href="stringdist.html#topic+stringsim">stringdist::stringsim()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>match_name(
  loanbook,
  abcd,
  by_sector = TRUE,
  min_score = 0.8,
  method = "jw",
  p = 0.1,
  overwrite = NULL,
  join_id = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="match_name_+3A_loanbook">loanbook</code>, <code id="match_name_+3A_abcd">abcd</code></td>
<td>
<p>data frames structured like <a href="r2dii.data.html#topic+loanbook_demo">r2dii.data::loanbook_demo</a>
and <a href="r2dii.data.html#topic+abcd_demo">r2dii.data::abcd_demo</a>.</p>
</td></tr>
<tr><td><code id="match_name_+3A_by_sector">by_sector</code></td>
<td>
<p>Should names only be compared if companies belong to the
same <code>sector</code>?</p>
</td></tr>
<tr><td><code id="match_name_+3A_min_score">min_score</code></td>
<td>
<p>A number between 0-1, to set the minimum <code>score</code> threshold.
A <code>score</code> of 1 is a perfect match.</p>
</td></tr>
<tr><td><code id="match_name_+3A_method">method</code></td>
<td>
<p>Method for distance calculation. One of <code>c("osa", "lv", "dl", "hamming", "lcs", "qgram", "cosine", "jaccard", "jw", "soundex")</code>. See
<a href="stringdist.html#topic+stringdist-metrics">stringdist::stringdist-metrics</a>.</p>
</td></tr>
<tr><td><code id="match_name_+3A_p">p</code></td>
<td>
<p>Prefix factor for Jaro-Winkler distance. The valid range for 
<code>p</code> is <code>0 &lt;= p &lt;= 0.25</code>. If <code>p=0</code> (default), the
Jaro-distance is returned. Applies only to <code>method='jw'</code>.</p>
</td></tr>
<tr><td><code id="match_name_+3A_overwrite">overwrite</code></td>
<td>
<p>A data frame used to overwrite the <code>sector</code> and/or <code>name</code>
columns of a particular direct loantaker or ultimate parent. To overwrite
only <code>sector</code>, the value in the <code>name</code> column should be <code>NA</code> and
vice-versa. This file can be used to manually match loanbook companies to
abcd.</p>
</td></tr>
<tr><td><code id="match_name_+3A_join_id">join_id</code></td>
<td>
<p>A join specification passed to <code><a href="dplyr.html#topic+mutate-joins">dplyr::inner_join()</a></code>. If a
character string, it assumes identical join columns between <code>loanbook</code> and
<code>abcd</code>. If a named character vector, it uses the name as the join column of <code>loanbook</code> and
the value as the join column of <code>abcd</code>.</p>
</td></tr>
<tr><td><code id="match_name_+3A_...">...</code></td>
<td>
<p>Arguments passed on to <code><a href="stringdist.html#topic+stringsim">stringdist::stringsim()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with the same groups (if any) and columns as <code>loanbook</code>,
and the additional columns:
</p>

<ul>
<li> <p><code>id_2dii</code> - an id used internally by <code>match_name()</code> to distinguish
companies
</p>
</li>
<li> <p><code>level</code> - the level of granularity that the loan was matched at
(e.g <code>direct_loantaker</code> or <code>ultimate_parent</code>)
</p>
</li>
<li> <p><code>sector</code> - the sector of the <code>loanbook</code> company
</p>
</li>
<li> <p><code>sector_abcd</code> - the sector of the <code>abcd</code> company
</p>
</li>
<li> <p><code>name</code> - the name of the <code>loanbook</code> company
</p>
</li>
<li> <p><code>name_abcd</code> - the name of the <code>abcd</code> company
</p>
</li>
<li> <p><code>score</code> - the score of the match (manually set this to <code>1</code>
prior to calling <code>prioritize()</code> to validate the match)
</p>
</li>
<li> <p><code>source</code> - determines the source of the match. (equal to <code>loanbook</code>
unless the match is from <code>overwrite</code>
</p>
</li></ul>

<p>The returned rows depend on the argument <code>min_value</code> and the result of the
column <code>score</code> for each loan: * If any row has <code>score</code> equal to 1,
<code>match_name()</code> returns all rows where <code>score</code> equals 1, dropping all other
rows. * If no row has <code>score</code> equal to 1,<code>match_name()</code> returns all rows
where <code>score</code> is equal to or greater than <code>min_score</code>. * If there is no
match the output is a 0-row tibble with the expected column names &ndash; for
type stability.
</p>


<h3>Package options</h3>

<p><code>r2dii.match.sector_classifications</code>: Allows you to use your own
<code>sector_classififications</code> instead of the default. This feature is
experimental and may be dropped and/or become a new argument to
<code>match_name()</code>.
</p>


<h3>Assigning aliases</h3>

<p>The transformation process used to compare names between loanbook and abcd
datasets applies best practices commonly used in name matching algorithms:
</p>

<ul>
<li><p> Remove special characters.
</p>
</li>
<li><p> Replace language specific characters.
</p>
</li>
<li><p> Abbreviate certain names to reduce their importance in the matching.
</p>
</li>
<li><p> Spell out numbers to increase their importance.
</p>
</li></ul>



<h3>Handling grouped data</h3>

<p>This function ignores but preserves existing groups.
</p>


<h3>See Also</h3>

<p>Other main functions: 
<code><a href="#topic+prioritize">prioritize</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(r2dii.data)
library(tibble)

# Small data for examples
loanbook &lt;- head(loanbook_demo, 50)
abcd &lt;- head(abcd_demo, 50)

match_name(loanbook, abcd)

match_name(loanbook, abcd, min_score = 0.9)

# Use your own `sector_classifications`
your_classifications &lt;- tibble(
  sector = "power",
  borderline = FALSE,
  code = "D35.11",
  code_system = "XYZ"
)

# match on LEI
loanbook &lt;- tibble(
  sector_classification_system = "XYZ",
  sector_classification_direct_loantaker = "D35.11",
  id_ultimate_parent = "UP15",
  name_ultimate_parent = "Won't fuzzy match",
  id_direct_loantaker = "C294",
  name_direct_loantaker = "Won't fuzzy match",
  lei_direct_loantaker = "LEI123"
)

abcd &lt;- tibble(
  name_company = "alpine knits india pvt. limited",
  sector = "power",
  lei = "LEI123"
)

match_name(loanbook, abcd, join_by = c(lei_direct_loantaker = "lei"))

restore &lt;- options(r2dii.match.sector_classifications = your_classifications)

loanbook &lt;- tibble(
  sector_classification_system = "XYZ",
  sector_classification_direct_loantaker = "D35.11",
  id_ultimate_parent = "UP15",
  name_ultimate_parent = "Alpine Knits India Pvt. Limited",
  id_direct_loantaker = "C294",
  name_direct_loantaker = "Yuamen Xinneng Thermal Power Co Ltd"
)

abcd &lt;- tibble(
  name_company = "alpine knits india pvt. limited",
  sector = "power"
)

match_name(loanbook, abcd)

# Cleanup
options(restore)

## End(Not run)
</code></pre>

<hr>
<h2 id='prioritize'>Pick rows where <code>score</code> is 1 and <code>level</code> per loan is of highest <code>priority</code></h2><span id='topic+prioritize'></span>

<h3>Description</h3>

<p>When multiple perfect matches are found per loan (e.g. a match at
<code>direct_loantaker</code> level and <code>ultimate_parent</code> level), we must prioritize the
desired match. By default, the highest <code>priority</code> is the most granular match
(i.e. <code>direct_loantaker</code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prioritize(data, priority = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="prioritize_+3A_data">data</code></td>
<td>
<p>A data frame like the validated output of <code><a href="#topic+match_name">match_name()</a></code>. See
<em>Details</em> on how to validate <code>data</code>.</p>
</td></tr>
<tr><td><code id="prioritize_+3A_priority">priority</code></td>
<td>
<p>One of:
</p>

<ul>
<li> <p><code>NULL</code>: defaults to the default level priority as returned by
<code><a href="#topic+prioritize_level">prioritize_level()</a></code>.
</p>
</li>
<li><p> A character vector giving a custom priority.
</p>
</li>
<li><p> A function to apply to the output of <code><a href="#topic+prioritize_level">prioritize_level()</a></code>, e.g. <code>rev</code>.
</p>
</li>
<li><p> A quosure-style lambda function, e.g. <code>~ rev(.x)</code>.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>How to validate <code>data</code></strong>
</p>
<p>Write the output of <code>match_name()</code> into a .csv file with:
</p>
<div class="sourceCode r"><pre># Writting to current working directory
matched %&gt;%
  readr::write_csv("matched.csv")
</pre></div>
<p>Compare, edit, and save the data manually:
</p>

<ul>
<li><p> Open <em>matched.csv</em> with any spreadsheet editor (Excel, Google Sheets,
etc.).
</p>
</li>
<li><p> Compare the columns <code>name</code> and <code>name_abcd</code> manually to determine if
the match is valid. Other information can be used in conjunction with
just the names to ensure the two entities match (sector, internal
information on the company structure, etc.)
</p>
</li>
<li><p> Edit the data:
</p>

<ul>
<li><p> If you are happy with the match, set the <code>score</code> value to <code>1</code>.
</p>
</li>
<li><p> Otherwise set or leave the <code>score</code> value to anything other than <code>1</code>.
</p>
</li></ul>

</li>
<li><p> Save the edited file as, say, <em>valid_matches.csv</em>.
</p>
</li></ul>

<p>Re-read the edited file (validated) with:
</p>
<div class="sourceCode r"><pre># Reading from current working directory
valid_matches &lt;- readr::read_csv("valid_matches.csv")
</pre></div>


<h3>Value</h3>

<p>A data frame with a single row per loan, where <code>score</code> is 1 and
priority level is highest.
</p>


<h3>Handling grouped data</h3>

<p>This function ignores but preserves existing groups.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+match_name">match_name()</a></code>, <code><a href="#topic+prioritize_level">prioritize_level()</a></code>.
</p>
<p>Other main functions: 
<code><a href="#topic+match_name">match_name</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)

# styler: off
matched &lt;- tribble(
  ~sector, ~sector_abcd,  ~score, ~id_loan,                ~level,
   "coal",      "coal",       1,     "aa",     "ultimate_parent",
   "coal",      "coal",       1,     "aa",    "direct_loantaker",
   "coal",      "coal",       1,     "bb", "intermediate_parent",
   "coal",      "coal",       1,     "bb",     "ultimate_parent",
)
# styler: on

prioritize_level(matched)

# Using default priority
prioritize(matched)

# Using the reverse of the default priority
prioritize(matched, priority = rev)

# Same
prioritize(matched, priority = ~ rev(.x))

# Using a custom priority
bad_idea &lt;- c("intermediate_parent", "ultimate_parent", "direct_loantaker")

prioritize(matched, priority = bad_idea)
</code></pre>

<hr>
<h2 id='prioritize_level'>Arrange unique <code>level</code> values in default order of <code>priority</code></h2><span id='topic+prioritize_level'></span>

<h3>Description</h3>

<p>Arrange unique <code>level</code> values in default order of <code>priority</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prioritize_level(data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="prioritize_level_+3A_data">data</code></td>
<td>
<p>A data frame, commonly the output of <code><a href="#topic+match_name">match_name()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character vector of the default level priority per loan.
</p>


<h3>See Also</h3>

<p>Other helpers: 
<code><a href="#topic+crucial_lbk">crucial_lbk</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>matched &lt;- tibble::tibble(
  level = c(
    "intermediate_parent_1",
    "direct_loantaker",
    "direct_loantaker",
    "direct_loantaker",
    "ultimate_parent",
    "intermediate_parent_2"
  )
)
prioritize_level(matched)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
