<!DOCTYPE html><html><head><title>Help for package eiExpand</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {eiExpand}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#%&gt;%'><p>Pipe operator</p></a></li>
<li><a href='#example_performance_results'><p>Example performance analysis results</p></a></li>
<li><a href='#example_rpvDF'><p>Example RPV analysis results in Washington State</p></a></li>
<li><a href='#mt_block_data'><p>Example block-level population data from Montana for split precinct analysis</p></a></li>
<li><a href='#percent_intersect'><p>Calculate percent land area intersections</p></a></li>
<li><a href='#performance'><p>Performance Analysis Calculation</p></a></li>
<li><a href='#performance_plot'><p>Performance Analysis Plotting Function</p></a></li>
<li><a href='#planShp'><p>Example district plan shape for split precinct analysis</p></a></li>
<li><a href='#rpv_coef_plot'><p>Racially Polarized Voting Analysis (RPV) Coefficient Plot</p></a></li>
<li><a href='#rpv_normalize'><p>Normalize RPV results</p></a></li>
<li><a href='#rpv_plot'><p>Racially Polarized Voting Analysis (RPV) Plot</p></a></li>
<li><a href='#rpv_toDF'><p>Transform RPV results from <code>eiCompare</code> into a simple dataframe</p>
object</a></li>
<li><a href='#south_carolina'><p>Example election and demographic data from South Carolina 2020 General Elections</p></a></li>
<li><a href='#split_precinct_analysis'><p>Split precinct analysis - VAP Adjusted Election Data</p></a></li>
<li><a href='#vtd'><p>Example vtd-level sf dataframe with election results for split precinct analysis</p></a></li>
<li><a href='#wa_block_data'><p>Example block-level population data from Washington for BISG</p></a></li>
<li><a href='#wa_geocoded'><p>Example geocoded voter file from Washington for BISG</p></a></li>
<li><a href='#washington'><p>Example election data with BISG demographics from Washington 2020 General Presidential Election</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Utilities for Expanding Functionality of 'eiCompare'</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.5</td>
</tr>
<tr>
<td>Description:</td>
<td>Augments the 'eiCompare' package's Racially Polarized Voting (RPV) 
  functionality to streamline analyses and visualizations used to support 
  voting rights and redistricting litigation. The package implements methods 
  described in Barreto, M., Collingwood, L., Garcia-Rios, S., &amp; Oskooii, K. A. (2022). 
  "Estimating Candidate Support in Voting Rights Act Cases: Comparing Iterative 
  EI and EI-RÃ—C Methods" &lt;<a href="https://doi.org/10.1177%2F0049124119852394">doi:10.1177/0049124119852394</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, tidyr, tidyselect (&ge; 1.2.0), stringr, ggplot2, ggmap,
viridis, sf, magrittr, rlang</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, markdown, rmarkdown, roxygen2, testthat</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.1</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Rachel Carroll &lt;rachelcarroll4@gmail.com&gt;</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>LazyDataCompression:</td>
<td>xz</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-03-13 21:52:22 UTC; rachelcarroll</td>
</tr>
<tr>
<td>Author:</td>
<td>Rachel Carroll [aut, cre],
  Loren Collingwood <a href="https://orcid.org/0000-0002-4447-8204"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-03-14 18:50:08 UTC</td>
</tr>
</table>
<hr>
<h2 id='+25+26gt+3B+25'>Pipe operator</h2><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>See <code>magrittr::<a href="magrittr.html#topic+pipe">%&gt;%</a></code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lhs %&gt;% rhs
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="+2B25+2B26gt+2B3B+2B25_+3A_lhs">lhs</code></td>
<td>
<p>A value or the magrittr placeholder.</p>
</td></tr>
<tr><td><code id="+2B25+2B26gt+2B3B+2B25_+3A_rhs">rhs</code></td>
<td>
<p>A function call using the magrittr semantics.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The result of calling 'rhs(lhs)'.
</p>

<hr>
<h2 id='example_performance_results'>Example performance analysis results</h2><span id='topic+example_performance_results'></span>

<h3>Description</h3>

<p>Example performance analysis results
</p>


<h3>Usage</h3>

<pre><code class='language-R'>example_performance_results
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 12 rows and 7 columns.
</p>

<hr>
<h2 id='example_rpvDF'>Example RPV analysis results in Washington State</h2><span id='topic+example_rpvDF'></span>

<h3>Description</h3>

<p>Example RPV analysis results in Washington State
</p>


<h3>Usage</h3>

<pre><code class='language-R'>example_rpvDF
</code></pre>


<h3>Format</h3>

<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 72 rows and 13 columns.
</p>

<hr>
<h2 id='mt_block_data'>Example block-level population data from Montana for split precinct analysis</h2><span id='topic+mt_block_data'></span>

<h3>Description</h3>

<p>Example block-level population data from Montana for split precinct analysis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mt_block_data
</code></pre>


<h3>Format</h3>

<p>An object of class <code>sf</code> (inherits from <code>data.frame</code>) with 3880 rows and 2 columns.
</p>

<hr>
<h2 id='percent_intersect'>Calculate percent land area intersections</h2><span id='topic+percent_intersect'></span>

<h3>Description</h3>

<p>Calculates the percent area 
intersection between the geometries in a sf data.frame and a 
single boundary shape.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>percent_intersect(sfdf, shp)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="percent_intersect_+3A_sfdf">sfdf</code></td>
<td>
<p>sf dataframe with one or more geometries.</p>
</td></tr>
<tr><td><code id="percent_intersect_+3A_shp">shp</code></td>
<td>
<p>sf dataframe with a single shape boundary.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>sfdf dataframe with pct_intersect column
</p>


<h3>Author(s)</h3>

<p>Rachel Carroll &lt;rachelcarroll4@gmail.com&gt;
</p>

<hr>
<h2 id='performance'>Performance Analysis Calculation</h2><span id='topic+performance'></span>

<h3>Description</h3>

<p>Performance Analysis calculates election outcomes of past 
contests given hypothetical voting district(s). This analysis has been used to 
determine if a Gingles III violation occurs due to how a district map is drawn.
It can also be used to demonstrate that a more equitable alternative map exists.
This function assumes RPV so it should only be used with contests where RPV 
has been established.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>performance(
  data = NULL,
  cands = "",
  candidate = "",
  preferred_candidate = "",
  total = "",
  contest = "",
  year = "",
  election_type = "",
  map = "",
  jurisdiction = "",
  includeTotal = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="performance_+3A_data">data</code></td>
<td>
<p>A data.frame object containing precinct-level election results 
for contests of interest. It must include candidate vote counts and contest 
total votes fields and must be subsetted to the relevant precincts. This 
data.frame will likely be the output of a &quot;Split Precinct Analysis&quot;.</p>
</td></tr>
<tr><td><code id="performance_+3A_cands">cands</code></td>
<td>
<p>A character vector of the candidate vote counts field names 
from <code>data</code> that are relevant to the given year and contest being analyzed.</p>
</td></tr>
<tr><td><code id="performance_+3A_candidate">candidate</code></td>
<td>
<p>A character vector of candidate names. The names must be listed 
in the same order <code>cands</code>. The values will appear in the output 
data.frame exactly as they are written in this argument.</p>
</td></tr>
<tr><td><code id="performance_+3A_preferred_candidate">preferred_candidate</code></td>
<td>
<p>A character vector of preferred racial groups 
associated with the candidates. The values must be listed in the correct 
order with respect to the <code>cands</code>/<code>candidate</code> arguments. The values
will appear in the output data.frame exactly as they are written in this 
argument.</p>
</td></tr>
<tr><td><code id="performance_+3A_total">total</code></td>
<td>
<p>A character vector of the the contest total vote count field names 
from <code>data</code>.</p>
</td></tr>
<tr><td><code id="performance_+3A_contest">contest</code></td>
<td>
<p>The name of the contest being analyzed</p>
</td></tr>
<tr><td><code id="performance_+3A_year">year</code></td>
<td>
<p>The year of the contest being analyzed</p>
</td></tr>
<tr><td><code id="performance_+3A_election_type">election_type</code></td>
<td>
<p>The election type the contest being analyzed (e.g 
&quot;General&quot; or &quot;Primary&quot;)</p>
</td></tr>
<tr><td><code id="performance_+3A_map">map</code></td>
<td>
<p>String containing the name of the district map being 
analyzed (e.g &quot;remedial&quot; or &quot;adopted&quot;). This is an optional field that 
defaults to blank.</p>
</td></tr>
<tr><td><code id="performance_+3A_jurisdiction">jurisdiction</code></td>
<td>
<p>String containing the name of the jurisdiction being 
analyzed (i.e a district number or &quot;County&quot;). Be sure that <code>data</code> is 
subsetted only to this jurisdiction.</p>
</td></tr>
<tr><td><code id="performance_+3A_includetotal">includeTotal</code></td>
<td>
<p>Boolean indicating if a total number of votes row should 
be appended to the output data.frame</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame of Performance Analysis results by candidate
</p>


<h3>Author(s)</h3>

<p>Rachel Carroll &lt;rachelcarroll4@gmail.com&gt;
</p>
<p>Loren Collingwood &lt;lcollingwood@unm.edu&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(eiExpand)
data(south_carolina)

# Get sample election data
D5_election &lt;- south_carolina %&gt;%
   dplyr::filter(District == 5)

# Run performance Analysis on 2018 Governor contest
perf_results &lt;- performance(
  data = D5_election,
  cands = c("R_mcmaster", "D_smith"), 
  candidate = c("McMaster (R)", "Smith (D)"), # formatted candidate names
  preferred_candidate = c("White", "Black"), # race preference of candidates respectively
  total = "total_gov",
  contest = "Governor",
  year = 2018,	
  election_type = "General",	
  jurisdiction = "District 5"
) 
</code></pre>

<hr>
<h2 id='performance_plot'>Performance Analysis Plotting Function</h2><span id='topic+performance_plot'></span>

<h3>Description</h3>

<p>Uses output from <code>performance()</code> to create a ggplot
performance analysis visualization.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>performance_plot(
  perfDF,
  title = "Performance Analysis Results",
  subtitle = NULL,
  legend_name = "Preferred Candidate:",
  preferred_cand_races = NULL,
  colors = NULL,
  breaks = seq(0, 100, 20),
  lims = c(0, 100),
  bar_size = 5,
  label_size = 4,
  position_dodge_width = 0.8,
  cand_name_size = 6,
  cand_name_pad = -1,
  contest_name_size = 20,
  contest_name_pad = NULL,
  panel_spacing = 0.7,
  panelBy = "Jurisdiction",
  includeCandName = TRUE,
  includeMeanDiff = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="performance_plot_+3A_perfdf">perfDF</code></td>
<td>
<p>A data.frame object containing performance analysis results 
from <code>performance()</code></p>
</td></tr>
<tr><td><code id="performance_plot_+3A_title">title</code></td>
<td>
<p>The plot title</p>
</td></tr>
<tr><td><code id="performance_plot_+3A_subtitle">subtitle</code></td>
<td>
<p>The plot subtitle</p>
</td></tr>
<tr><td><code id="performance_plot_+3A_legend_name">legend_name</code></td>
<td>
<p>The legend title</p>
</td></tr>
<tr><td><code id="performance_plot_+3A_preferred_cand_races">preferred_cand_races</code></td>
<td>
<p>A character vector of the unique races contained 
in the <code>preferred_candidate</code> column of <code>perfDF</code>. This argument is
optional and is used with <code>colors</code> to indicate the color of the plot 
associated with the race preferences.</p>
</td></tr>
<tr><td><code id="performance_plot_+3A_colors">colors</code></td>
<td>
<p>Plot colors for the voter race groups. Colors must 
be listed in the desired order with respect <code>preferred_cand_races</code> if 
arguments are used together.</p>
</td></tr>
<tr><td><code id="performance_plot_+3A_breaks">breaks</code></td>
<td>
<p>Numeric vector containing x axis breaks</p>
</td></tr>
<tr><td><code id="performance_plot_+3A_lims">lims</code></td>
<td>
<p>Numeric vector containing x axis limits</p>
</td></tr>
<tr><td><code id="performance_plot_+3A_bar_size">bar_size</code></td>
<td>
<p>The size of plot bars. Passed to <code>geom_linerange()</code>.</p>
</td></tr>
<tr><td><code id="performance_plot_+3A_label_size">label_size</code></td>
<td>
<p>The size of vote share labels</p>
</td></tr>
<tr><td><code id="performance_plot_+3A_position_dodge_width">position_dodge_width</code></td>
<td>
<p>The width value passed to <code>position_dodge()</code>.
Affects spacing between the plot bars.</p>
</td></tr>
<tr><td><code id="performance_plot_+3A_cand_name_size">cand_name_size</code></td>
<td>
<p>Text size of candidate names if <code>includeCandName = TRUE</code></p>
</td></tr>
<tr><td><code id="performance_plot_+3A_cand_name_pad">cand_name_pad</code></td>
<td>
<p>Padding between candidate name and y axis if 
<code>includeCandName = TRUE</code>.</p>
</td></tr>
<tr><td><code id="performance_plot_+3A_contest_name_size">contest_name_size</code></td>
<td>
<p>Text size of contest name</p>
</td></tr>
<tr><td><code id="performance_plot_+3A_contest_name_pad">contest_name_pad</code></td>
<td>
<p>Padding between contest name and y axis</p>
</td></tr>
<tr><td><code id="performance_plot_+3A_panel_spacing">panel_spacing</code></td>
<td>
<p>space between panels. This argument is relevant only if 
there are multiple jurisdictions in <code>perfDF</code>.</p>
</td></tr>
<tr><td><code id="performance_plot_+3A_panelby">panelBy</code></td>
<td>
<p>Column name from perfDF passed to <code>facet_grid()</code> to 
create panels. Recommended options are Jurisdiction and Map. 
Defaults to Jurisdiction.</p>
</td></tr>
<tr><td><code id="performance_plot_+3A_includecandname">includeCandName</code></td>
<td>
<p>Logical indicating if candidate names should appear 
on the left side of the plot.</p>
</td></tr>
<tr><td><code id="performance_plot_+3A_includemeandiff">includeMeanDiff</code></td>
<td>
<p>Logical indicating if the mean difference between 
preferred_candidate  across all elections should appear in the plot.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot visualization of performance analysis
</p>


<h3>Author(s)</h3>

<p>Rachel Carroll &lt;rachelcarroll4@gmail.com&gt;
</p>


<h3>See Also</h3>

<p><a href="#topic+performance">performance</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(eiExpand)
data(example_performance_results)
performance_plot(example_performance_results)

#ggplot2::ggsave("perf_plot.png", width = 12, height = 7)
</code></pre>

<hr>
<h2 id='planShp'>Example district plan shape for split precinct analysis</h2><span id='topic+planShp'></span>

<h3>Description</h3>

<p>Example district plan shape for split precinct analysis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>planShp
</code></pre>


<h3>Format</h3>

<p>An object of class <code>sf</code> (inherits from <code>data.frame</code>) with 1 rows and 18 columns.
</p>

<hr>
<h2 id='rpv_coef_plot'>Racially Polarized Voting Analysis (RPV) Coefficient Plot</h2><span id='topic+rpv_coef_plot'></span>

<h3>Description</h3>

<p>Creates a coefficient plot showing of RPV results estimate ranges
of all contests by voter race
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rpv_coef_plot(
  rpvDF = NULL,
  title = "Racially Polarized Voting Analysis Estimates",
  caption = "Data: eiCompare RPV estimates",
  ylab = NULL,
  colors = NULL,
  race_order = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rpv_coef_plot_+3A_rpvdf">rpvDF</code></td>
<td>
<p>A data.frame containing RPV results</p>
</td></tr>
<tr><td><code id="rpv_coef_plot_+3A_title">title</code></td>
<td>
<p>The plot title</p>
</td></tr>
<tr><td><code id="rpv_coef_plot_+3A_caption">caption</code></td>
<td>
<p>The plot caption</p>
</td></tr>
<tr><td><code id="rpv_coef_plot_+3A_ylab">ylab</code></td>
<td>
<p>Label along y axis</p>
</td></tr>
<tr><td><code id="rpv_coef_plot_+3A_colors">colors</code></td>
<td>
<p>Character vector of colors, one for each racial group. The order 
of colors will be respective to the order of racial groups.</p>
</td></tr>
<tr><td><code id="rpv_coef_plot_+3A_race_order">race_order</code></td>
<td>
<p>Character vector of racial groups from the <code>voter_race</code> column of
<code>rpvDF</code> in the order they should appear in the plot. If not specified, 
the race groups will appear in alphabetical order.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Coefficient plot of RPV analysis as a ggplot2 object
</p>


<h3>Author(s)</h3>

<p>Rachel Carroll &lt;rachelcarroll4@gmail.com&gt;
</p>
<p>Stephen El-Khatib &lt;stevekhatib@gmail.com&gt;
</p>
<p>Loren Collingwood &lt;lcollingwood@unm.edu&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(eiExpand)
data(example_rpvDF)

dem_rpv_results &lt;- example_rpvDF %&gt;% dplyr::filter(Party == "Democratic")
rpv_coef_plot(dem_rpv_results)
</code></pre>

<hr>
<h2 id='rpv_normalize'>Normalize RPV results</h2><span id='topic+rpv_normalize'></span>

<h3>Description</h3>

<p>Create a dataframe of normalized RPV results when using the 
cvap, vap, or bisg denominator method, i.e., take RPV results only among 
people estimated to have voted.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rpv_normalize(ei_object, cand_cols, race_cols)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rpv_normalize_+3A_ei_object">ei_object</code></td>
<td>
<p>Output from <code>ei_iter()</code> or <code>ei_rxc()</code></p>
</td></tr>
<tr><td><code id="rpv_normalize_+3A_cand_cols">cand_cols</code></td>
<td>
<p>A character vector of the candidate column names to be 
normalized from <code>ei_object</code>. Only use candidate column name columns, 
not the No Vote column.</p>
</td></tr>
<tr><td><code id="rpv_normalize_+3A_race_cols">race_cols</code></td>
<td>
<p>A character vector of the racial group column names to
be normalized from <code>ei_object</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Normalized RPV results in a data.frame
</p>


<h3>Author(s)</h3>

<p>Rachel Carroll &lt;rachelcarroll4@gmail.com&gt;
</p>
<p>Loren Collingwood &lt;lcollingwood@unm.edu&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#library(eiExpand)
#data("south_carolina")
#prec_election_demog &lt;- south_carolina[1:50,]

## run rpv using eiCompare (rxc method)
#rxcVote &lt;-  eiCompare::ei_rxc(
#  data = prec_election_demog,
#  cand_cols = c('pct_mcmaster', 'pct_smith', 'pct_other_gov', 'pct_NoVote_gov'),
#  race_cols = c('pct_white', 'pct_black', 'pct_race_other'),
#  totals_col = "total_vap")

## normalize results accounting for no vote using rpv_normalize()
## only include the candidate and race cols of interest for the rpv analysis
#rpv_results &lt;- rpv_normalize(
 # ei_object = rxcVote,
 # cand_cols = c('pct_mcmaster', 'pct_smith', 'pct_other_gov'), 
 # race_cols = c('pct_white', 'pct_black')
#)

</code></pre>

<hr>
<h2 id='rpv_plot'>Racially Polarized Voting Analysis (RPV) Plot</h2><span id='topic+rpv_plot'></span>

<h3>Description</h3>

<p>Creates a custom visualization of RPV results
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rpv_plot(
  rpvDF = NULL,
  title = "Racially Polarized Voting Analysis Results",
  subtitle = "Estimated Vote for Candidates by Race",
  legend_name = "Voters' Race:",
  voter_races = NULL,
  colors = NULL,
  position_dodge_width = 0.8,
  bar_size = NULL,
  label_size = 4,
  contest_name_size = 20,
  cand_name_size = 6,
  contest_name_pad = NULL,
  cand_name_pad = -1.5,
  contest_sep = NULL,
  shade_col = "grey75",
  shade_alpha = 0.1,
  panel_spacing = NULL,
  breaks = seq(0, 100, 20),
  lims = c(0, 110),
  includeErrorBand = FALSE,
  includeCandName = TRUE,
  panelBy = NULL,
  txtInBar = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rpv_plot_+3A_rpvdf">rpvDF</code></td>
<td>
<p>A data.frame containing RPV results</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_title">title</code></td>
<td>
<p>The plot title</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_subtitle">subtitle</code></td>
<td>
<p>The plot subtitle</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_legend_name">legend_name</code></td>
<td>
<p>The legend title</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_voter_races">voter_races</code></td>
<td>
<p>A vector of the unique voter races contained in the 
<code>Voter_Race</code> column of <code>rpvDF</code>. This argument will set the order 
in which voter races are displayed in the plot and legend. Can be used with 
<code>colors</code>, to indicate the which color of the plot to associate with each  
voter race.</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_colors">colors</code></td>
<td>
<p>Defines the plot colors for the voter race groups. Colors must 
be listed in the desired order with respect <code>voter_races</code> if arguments 
are used together.</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_position_dodge_width">position_dodge_width</code></td>
<td>
<p>The width value indicating  spacing between the 
plot bars. Passed to <code>position_dodge()</code>.</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_bar_size">bar_size</code></td>
<td>
<p>The size of plot bars. Passed to <code>geom_linerange()</code>.</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_label_size">label_size</code></td>
<td>
<p>The size of RPV estimate label</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_contest_name_size">contest_name_size</code></td>
<td>
<p>Text size of contest name</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_cand_name_size">cand_name_size</code></td>
<td>
<p>Text size of candidate names if 
<code>includeCandName = TRUE</code></p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_contest_name_pad">contest_name_pad</code></td>
<td>
<p>Padding between contest name and y axis</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_cand_name_pad">cand_name_pad</code></td>
<td>
<p>Padding between candidate name and y axis if 
<code>includeCandName = TRUE</code>.</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_contest_sep">contest_sep</code></td>
<td>
<p>String indicating how to separate contest. Options &quot;s&quot;, 
&quot;shade&quot;, or &quot;shading&quot; shade the background of every other contest. 
Options &quot;l&quot;, &quot;line&quot;, &quot;lines&quot; create light grey double lines between contests.</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_shade_col">shade_col</code></td>
<td>
<p>color to shade contest separation bands when
<code>contest_sep = "s"</code>. Defaults to light grey.</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_shade_alpha">shade_alpha</code></td>
<td>
<p>alpha parameter passed to <code>geom_tile()</code> to indicate 
transparency of contest separation bands when <code>contest_sep = "s"</code></p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_panel_spacing">panel_spacing</code></td>
<td>
<p>Space between facet grid panels</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_breaks">breaks</code></td>
<td>
<p>Numeric vector containing x axis breaks</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_lims">lims</code></td>
<td>
<p>Numeric vector containing x axis limits</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_includeerrorband">includeErrorBand</code></td>
<td>
<p>Logical indicating if the confidence interval band 
should appear on the plot. If <code>TRUE</code>, the RPV estimate labels will
appear in the middle of each bar instead of at the ends so they don't cover 
the error bands.</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_includecandname">includeCandName</code></td>
<td>
<p>Logical indicating if candidate names should appear on
the left side of the plot.</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_panelby">panelBy</code></td>
<td>
<p>Column name from rpvDF passed to <code>facet_grid()</code> to create panels.</p>
</td></tr>
<tr><td><code id="rpv_plot_+3A_txtinbar">txtInBar</code></td>
<td>
<p>Logical indicating location of the RPV estimate labels. If, TRUE,
estimates will be in the middle of the plot bars. If FALSE, they will be at the end
of the bars.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Bar plot visualization of RPV analysis as a ggplot2 object
</p>


<h3>Author(s)</h3>

<p>Rachel Carroll &lt;rachelcarroll4@gmail.com&gt;
</p>
<p>Loren Collingwood &lt;lcollingwood@unm.edu&gt;
</p>
<p>Kassra Oskooii  &lt;kassrao@gmail.com&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(eiExpand)
data(example_rpvDF)

# Note that these plots are designed to be 
# saved as a png using ggplot2::ggsave(). See first example for recommending 
# sizing, noting that height and weight arguments may need adjusting 
# depending on plot attributes such as number of contests and paneling 

# plot county-level results with all defaults
rpvDF_county &lt;- example_rpvDF %&gt;% dplyr::filter(Jurisdiction == "County")
rpv_plot(rpvDF_county)

# save to png with recommended sizing
# ggplot2::ggsave("rpv_plot_default.png", height = 10, width = 15)

# include CI bands
rpv_plot(rpvDF_county, includeErrorBand = TRUE)

# include CI bands with estimate labels outside bar
rpv_plot(
  rpvDF_county, 
  includeErrorBand = TRUE,
  txtInBar = FALSE
)

# panel by preferred candidate
rpvDF_county$Year &lt;- paste(rpvDF_county$Year,
                           "\n") # so contest and year are on different lines
rpvDF_county$Preferred_Candidate &lt;- paste(rpvDF_county$Preferred_Candidate, 
                                          "\nPreferred Candidate")
rpv_plot(
  rpvDF_county,
  panel_spacing = 6,
  panelBy = "Preferred_Candidate"
)

# plot all jurisdictions with panels
rpv_plot(example_rpvDF, panelBy = "Jurisdiction")
# add contest separation shading
rpv_plot(
  example_rpvDF, 
  panelBy = "Jurisdiction",
  contest_sep = "s"
)

# plot panels by voter_race and remove legend
rpv_plot(rpvDF_county,
panel_spacing = 6, 
panelBy = "Voter_Race") + 
  ggplot2::theme(legend.position="none")
  

</code></pre>

<hr>
<h2 id='rpv_toDF'>Transform RPV results from <code>eiCompare</code> into a simple dataframe
object</h2><span id='topic+rpv_toDF'></span>

<h3>Description</h3>

<p>Create a dataframe from RPV analysis output to facilitate 
RPV visualizations. The output dataframe of this function can be used directly 
in <code>rpv_plot()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rpv_toDF(
  rpv_results = NULL,
  model = NULL,
  jurisdiction = "",
  preferred_candidate = "",
  party = "",
  election_type = "",
  year = "",
  contest = "",
  candidate = ""
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rpv_toDF_+3A_rpv_results">rpv_results</code></td>
<td>
<p>RPV analysis results either from the output of 
<code>ei_iter()</code> or <code>ei_rxc()</code> from the <code>eiCompare</code> package or from 
the internal function <code>ci_cvap_full()</code>.</p>
</td></tr>
<tr><td><code id="rpv_toDF_+3A_model">model</code></td>
<td>
<p>A string indicating the model used to create <code>rpv_results</code>. 
Examples include &quot;ei&quot;, &quot;rxc&quot;, &quot;ei cvap&quot;, etc.</p>
</td></tr>
<tr><td><code id="rpv_toDF_+3A_jurisdiction">jurisdiction</code></td>
<td>
<p>A string of the jurisdiction.</p>
</td></tr>
<tr><td><code id="rpv_toDF_+3A_preferred_candidate">preferred_candidate</code></td>
<td>
<p>A character vector of races indicating racial
preference of each candidate. The racial preferences must be listed 
in the correct order with respect to <code>candidate</code>.</p>
</td></tr>
<tr><td><code id="rpv_toDF_+3A_party">party</code></td>
<td>
<p>A character vector containing the political parties of the 
candidates. Must be listed in the correct order with respect to 
<code>candidate</code>.</p>
</td></tr>
<tr><td><code id="rpv_toDF_+3A_election_type">election_type</code></td>
<td>
<p>A string on the election type (usually &quot;General&quot; or 
&quot;Primary&quot;)</p>
</td></tr>
<tr><td><code id="rpv_toDF_+3A_year">year</code></td>
<td>
<p>The year of the contest</p>
</td></tr>
<tr><td><code id="rpv_toDF_+3A_contest">contest</code></td>
<td>
<p>A string of contest name as it would appear in an rpv visualization
(e.g. &quot;President&quot; or &quot;Sec. of State&quot;)</p>
</td></tr>
<tr><td><code id="rpv_toDF_+3A_candidate">candidate</code></td>
<td>
<p>A character vector of candidate names written as they would 
appear on a visualization. The candidate names must be listed in the same order
as the candidate estimates appear in <code>rpv_results</code>, i.e the same order 
as the <code>cands</code> argument in <code>eiCompare::ei_iter()</code> or 
<code>eiCompare::ei_rxc()</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>rpv results in a data.frame
</p>


<h3>Author(s)</h3>

<p>Rachel Carroll &lt;rachelcarroll4@gmail.com&gt;
</p>
<p>Kassra Oskooii  &lt;kassrao@gmail.com&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#library(eiExpand)
#data("south_carolina")
#prec_election_demog &lt;- south_carolina[1:50,]

## run rpv analysis
#eiVote &lt;- eiCompare::ei_iter(
 # data = prec_election_demog,
 # cand_cols = c('pct_mcmaster', 'pct_smith'),
 # race_cols = c('pct_white', 'pct_black'),
 # totals_col = "total_vap"
#) %&gt;%
 # rpv_normalize(
 #   cand_cols = c('pct_mcmaster', 'pct_smith'), 
 #   race_cols = c('pct_white', 'pct_black')
 # )

## use function to create dataframe from rpv results
#plotDF &lt;- rpv_toDF(
#   rpv_results = eiVote,
#   model = "ei vap", #since we used ei_iter model normalized with vap denominator       
#   jurisdiction = "Statewide",
#   candidate = c("McMaster", "Smith"), #must be in correct order relative to rpv_results                             
#   preferred_candidate = c("White", "Black"), #must be in correct order rpv_results  
#   party = c("Republican", "Democratic"),
#   election_type = "General",  
#   year = "2020",
#   contest = "Governor"
# )

</code></pre>

<hr>
<h2 id='south_carolina'>Example election and demographic data from South Carolina 2020 General Elections</h2><span id='topic+south_carolina'></span>

<h3>Description</h3>

<p>Example election and demographic data from South Carolina 2020 General Elections
</p>


<h3>Usage</h3>

<pre><code class='language-R'>south_carolina
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 750 rows and 42 columns.
</p>

<hr>
<h2 id='split_precinct_analysis'>Split precinct analysis - VAP Adjusted Election Data</h2><span id='topic+split_precinct_analysis'></span>

<h3>Description</h3>

<p>Run Split Precinct Analysis using precinct-level geometries and 
election data, a district shape, and block-level vap data. This function 
calculates the percent vap of a precinct contained in the district boundary
of interest. Then, if specified, multiplies election vote counts by percent
vap.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>split_precinct_analysis(
  vtd,
  planShp,
  block_pop_data,
  vote_col_names = NULL,
  lower_thresh = 0.02,
  upper_thresh = 0.98,
  keepOrigElection = TRUE,
  generatePlots = FALSE,
  ggmap_object = NULL,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="split_precinct_analysis_+3A_vtd">vtd</code></td>
<td>
<p>A sf dataframe with precinct-level geometries potentially in the 
district from <code>planShp</code>. For election adjustments, it should also 
contain election results in columns defined in <code>vote_col_names</code>.</p>
</td></tr>
<tr><td><code id="split_precinct_analysis_+3A_planshp">planShp</code></td>
<td>
<p>A sf dataframe with one row containing district plan shape
boundary (one district).</p>
</td></tr>
<tr><td><code id="split_precinct_analysis_+3A_block_pop_data">block_pop_data</code></td>
<td>
<p>A sf object of blocks covering the region, with vap 
column</p>
</td></tr>
<tr><td><code id="split_precinct_analysis_+3A_vote_col_names">vote_col_names</code></td>
<td>
<p>Character vector containing the name of the columns to 
be adjusted based on percent vap. This should include election results 
columns names in <code>vtd</code>.</p>
</td></tr>
<tr><td><code id="split_precinct_analysis_+3A_lower_thresh">lower_thresh</code></td>
<td>
<p>A decimal. If the percent area of a precinct
inside the <code>planShp</code> is equal to or below this threshold, the precinct
will be removed. Defaults to .02.</p>
</td></tr>
<tr><td><code id="split_precinct_analysis_+3A_upper_thresh">upper_thresh</code></td>
<td>
<p>A decimal. If the percent area of a precinct
inside the <code>planShp</code> is equal to or above this threshold, the precinct
will be considered to be fully contained in the district. Defaults to .98.</p>
</td></tr>
<tr><td><code id="split_precinct_analysis_+3A_keeporigelection">keepOrigElection</code></td>
<td>
<p>A boolean indicating if original election vote counts
should be preserved in the output dataset for comparison purposes.</p>
</td></tr>
<tr><td><code id="split_precinct_analysis_+3A_generateplots">generatePlots</code></td>
<td>
<p>Boolean indicating if function should generate
a list of map checking plots. If TRUE, the function output will include a list 
of plots that show split precincts and intersecting blocks within and outside 
of the district.</p>
</td></tr>
<tr><td><code id="split_precinct_analysis_+3A_ggmap_object">ggmap_object</code></td>
<td>
<p>A ggmap object of the area on interest to be the background
of plots if <code>generatePlots = TRUE</code>. If this argument is not specified, 
plots will be generated without a map background.</p>
</td></tr>
<tr><td><code id="split_precinct_analysis_+3A_verbose">verbose</code></td>
<td>
<p>A boolean indicating whether to print out status messages.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>generatePlots = FALSE</code>, returns a split precinct results
data.frame with vap percentages and adjusted election data. If 
<code>generatePlots = TRUE</code>, returns a list with the result data.frame in the 
first element and the list of plots in the second.
</p>


<h3>Author(s)</h3>

<p>Rachel Carroll &lt;rachelcarroll4@gmail.com&gt;
</p>
<p>Loren Collingwood &lt;lcollingwood@unm.edu&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(eiExpand)
library(sf)

# load data and shps
data(planShp); data(vtd); data(mt_block_data)

# filter to a few vtds for this example
vtd &lt;- vtd %&gt;% 
  dplyr::filter(
    GEOID20 %in% c("30091000002", "30085000012", "30085000018", "30085000010")
  )

# run split precinct analysis without plots
spa_results &lt;- split_precinct_analysis(
  vtd = vtd, 
  planShp = planShp, 
  block_pop_data = mt_block_data,
  vote_col_names = c('G16HALRZIN', 'G16HALDJUN', 'G16HALLBRE', 
                     'G16GOVRGIA', 'G16GOVDBUL', "G16GOVLDUN"),
  keepOrigElection = TRUE,
  generatePlots = FALSE) 

# run with plots
spa_list &lt;- split_precinct_analysis(
  vtd = vtd, 
  planShp = planShp, 
  block_pop_data = mt_block_data,
  vote_col_names = c('G16HALRZIN', 'G16HALDJUN', 'G16HALLBRE', 
                     'G16GOVRGIA', 'G16GOVDBUL', "G16GOVLDUN"),
  lower_thresh = 0,
  keepOrigElection = TRUE,
  generatePlots = TRUE) 

# View results
spa_list[["results"]]

# View plots
#library(gridExtra)
#do.call("grid.arrange", c(spa_list[["plots"]], ncol=1))

</code></pre>

<hr>
<h2 id='vtd'>Example vtd-level sf dataframe with election results for split precinct analysis</h2><span id='topic+vtd'></span>

<h3>Description</h3>

<p>Example vtd-level sf dataframe with election results for split precinct analysis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vtd
</code></pre>


<h3>Format</h3>

<p>An object of class <code>sf</code> (inherits from <code>data.frame</code>) with 19 rows and 12 columns.
</p>

<hr>
<h2 id='wa_block_data'>Example block-level population data from Washington for BISG</h2><span id='topic+wa_block_data'></span>

<h3>Description</h3>

<p>Example block-level population data from Washington for BISG
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wa_block_data
</code></pre>


<h3>Format</h3>

<p>An object of class <code>sf</code> (inherits from <code>data.frame</code>) with 821 rows and 8 columns.
</p>

<hr>
<h2 id='wa_geocoded'>Example geocoded voter file from Washington for BISG</h2><span id='topic+wa_geocoded'></span>

<h3>Description</h3>

<p>Example geocoded voter file from Washington for BISG
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wa_geocoded
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 1000 rows and 6 columns.
</p>

<hr>
<h2 id='washington'>Example election data with BISG demographics from Washington 2020 General Presidential Election</h2><span id='topic+washington'></span>

<h3>Description</h3>

<p>Example election data with BISG demographics from Washington 2020 General Presidential Election
</p>


<h3>Usage</h3>

<pre><code class='language-R'>washington
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 637 rows and 27 columns.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
