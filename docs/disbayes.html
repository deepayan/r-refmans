<!DOCTYPE html><html><head><title>Help for package disbayes</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {disbayes}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ci2num'><p>Convert a proportion and credible interval to a numerator and denominator</p></a></li>
<li><a href='#conflict_disbayes'><p>Conflict p-values</p></a></li>
<li><a href='#disbayes'><p>Bayesian estimation of chronic disease epidemiology from incomplete data</p></a></li>
<li><a href='#disbayes_hier'><p>Bayesian estimation of chronic disease epidemiology from incomplete data -</p>
hierarchical model for case fatalities.</a></li>
<li><a href='#disbayes-package'><p>The 'disbayes' package.</p></a></li>
<li><a href='#ihdengland'><p>Ischemic heart disease in England</p></a></li>
<li><a href='#ihdtrends'><p>Trends in ischemic heart disease in England</p></a></li>
<li><a href='#loo_indiv'><p>Extract observation-specific contributions from a disbayes leave-one-out cross validation</p></a></li>
<li><a href='#loo.disbayes'><p>Leave-one-out cross validation for disbayes models</p></a></li>
<li><a href='#plot.disbayes'><p>Quick and dirty plot of estimates from disbayes models against age</p></a></li>
<li><a href='#plot.disbayes_hier'><p>Quick plot of estimates from hierarchical disbayes models against age</p></a></li>
<li><a href='#plotfit_data_disbayes'><p>Create tidy data for a check of observed against fitted outcome probability estimates</p>
from disbayes</a></li>
<li><a href='#plotfit_disbayes'><p>Graphical check of observed against fitted outcome probabilities from disbayes</p></a></li>
<li><a href='#reexports'><p>Objects exported from other packages</p></a></li>
<li><a href='#tidy_obsdat'><p>Extract observed data from a disbayes model fit</p></a></li>
<li><a href='#tidy.disbayes'><p>Form a tidy data frame from the estimates from a disbayes fit</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Bayesian Multi-State Modelling of Chronic Disease Burden Data</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-09-09</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimation of incidence and case fatality for a chronic disease, given partial information, using a multi-state model. Given data on age-specific mortality and either incidence or prevalence, Bayesian inference is used to estimate the posterior distributions of incidence, case fatality, and functions of these such as prevalence.  The methods are described in Jackson et al. (2023) &lt;<a href="https://doi.org/10.1093%2Fjrsssa%2Fqnac015">doi:10.1093/jrsssa/qnac015</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Biarch:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, tidyr, magrittr, tibble, generics, methods, Rcpp (&ge;
0.12.0), rstan (&ge; 2.26.0), mgcv, SHELF, ggplot2, loo,
matrixStats</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>BH (&ge; 1.66.0), Rcpp (&ge; 0.12.0), RcppParallel, RcppEigen
(&ge; 0.3.3.3.0), rstan (&ge; 2.26.0), StanHeaders (&ge; 2.26.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, rstantools (&ge; 2.0.0.9000), tempdisagg,
testthat</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>GNU make</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://chjackson.github.io/disbayes/">https://chjackson.github.io/disbayes/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/chjackson/disbayes/issues">https://github.com/chjackson/disbayes/issues</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-09-09 15:12:59 UTC; Chris</td>
</tr>
<tr>
<td>Author:</td>
<td>Christopher Jackson
    <a href="https://orcid.org/0000-0002-6656-8913"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre,
    cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Christopher Jackson &lt;chris.jackson@mrc-bsu.cam.ac.uk&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-09-09 20:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='ci2num'>Convert a proportion and credible interval to a numerator and denominator</h2><span id='topic+ci2num'></span>

<h3>Description</h3>

<p>Estimate the number of events and denominator that contain roughly equivalent information to an estimate and uncertainty interval for a proportion, by interpreting the estimate and interval as a Beta posterior arising from a vague Beta(0.5,0.5) prior updated with the data consisting of that number and denominator.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ci2num(est, lower, upper, epsilon = 0.5, denom0 = 1000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ci2num_+3A_est">est</code></td>
<td>
<p>Point estimate</p>
</td></tr>
<tr><td><code id="ci2num_+3A_lower">lower</code></td>
<td>
<p>Lower 95% credible limit</p>
</td></tr>
<tr><td><code id="ci2num_+3A_upper">upper</code></td>
<td>
<p>Upper 95% credible limit</p>
</td></tr>
<tr><td><code id="ci2num_+3A_epsilon">epsilon</code></td>
<td>
<p>If any of <code>lower</code> are zero, then they are replaced by the minimum of <code>epsilon</code> and <code>est/2</code>.  Similarly values of 1 for <code>upper</code> are replaced by the maximum of <code>1-epsilon</code> and <code>(1+est)/2</code>.</p>
</td></tr>
<tr><td><code id="ci2num_+3A_denom0">denom0</code></td>
<td>
<p>Denominator to use as a default when the point estimate is exactly 0 or 1 (which is not compatible with the beta distribution).  Should correspond to a guess of the population size used to produce the estimate,
which should be no greater than the actual population of the area, and usually less.  Should be either a scalar, or a vector of the same length as <code>est</code> (though note if it is a vector, then only the elements where <code>est</code> is 1 or 0 get used).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Based on fitting a Beta distribution by least squares, using the method provided by the <span class="pkg">SHELF</span> package.
</p>
<p>Requires that the estimate and upper and lower limits are all distinct (except that <code>est=0</code> is allowed and handled specially for convenience, see <code>denom0</code>).  Vectors of estimates and limits may be supplied.
</p>


<h3>Value</h3>

<p>A data frame with elements <code>num</code> and <code>denom</code> corresponding to the supplied estimate and limits.
</p>


<h3>References</h3>

<p>Oakley (2020). SHELF: Tools to Support the Sheffield Elicitation Framework. R package version 1.7.0. <a href="https://CRAN.R-project.org/package=SHELF">https://CRAN.R-project.org/package=SHELF</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>est &lt;- 3.00 / 100 
upper &lt;- 3.52 / 100 
lower &lt;- 2.60 / 100 
ci2num(est, lower, upper)

</code></pre>

<hr>
<h2 id='conflict_disbayes'>Conflict p-values</h2><span id='topic+conflict_disbayes'></span>

<h3>Description</h3>

<p>A test of the hypothesis that the direct data on a disease outcome give the same 
information about that outcome as an indirect evidence synthesis obtained from a fitted <code><a href="#topic+disbayes">disbayes</a></code>
model.   The outcome may be annual incidence, mortality, remission probabilities, 
or prevalence.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>conflict_disbayes(x, varname)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="conflict_disbayes_+3A_x">x</code></td>
<td>
<p>A fitted <code><a href="#topic+disbayes">disbayes</a></code> model.</p>
</td></tr>
<tr><td><code id="conflict_disbayes_+3A_varname">varname</code></td>
<td>
<p>Either <code>inc</code>, <code>prev</code>, <code>mort</code> or <code>rem</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Hierarchical models are not currently supported in this function.
</p>


<h3>Value</h3>

<p>A data frame with columns indicating age, gender and area. 
</p>
<p><code>p1</code> is a &quot;one-sided&quot; p-value for the null hypothesis that <code class="reqn">r_{obs}=r_{fit}</code> against 
the alternative that <code class="reqn">r_{obs} &gt; r_{fit}</code>,
</p>
<p><code>p2</code> is the two-sided p-value for the null hypothesis that <code class="reqn">r_{obs}=r_{fit}</code> against 
the alternative that <code class="reqn">r_{obs}</code> is not equal to <code class="reqn">r_{fit}</code>,
</p>
<p>where <code class="reqn">r_{obs}</code> is the rate informed only by direct data, and <code class="reqn">r_{fit}</code> is the rate
informed by evidence synthesis.  Therefore if the evidence synthesis excludes the 
direct data, then these are interpreted as &quot;conflict&quot; p-values (see Presanis et al. 2013). 
</p>
<p>In each case, a small p-value favours the alternative hypothesis.
</p>


<h3>References</h3>

<p>Presanis, A. M., Ohlssen, D., Spiegelhalter, D. J. and De Angelis, D. (2013) 
Conflict diagnostics in directed acyclic graphs, with applications in Bayesian evidence 
synthesis. Statistical Science, 28, 376-397.
</p>

<hr>
<h2 id='disbayes'>Bayesian estimation of chronic disease epidemiology from incomplete data</h2><span id='topic+disbayes'></span>

<h3>Description</h3>

<p>Estimates a three-state disease model from incomplete data.
It is designed to estimate case fatality and incidence, given
data on mortality and at least one of incidence and prevalence.
Remission may also be included in the data and modelled.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>disbayes(
  data,
  inc_num = NULL,
  inc_denom = NULL,
  inc_prob = NULL,
  inc_lower = NULL,
  inc_upper = NULL,
  prev_num = NULL,
  prev_denom = NULL,
  prev_prob = NULL,
  prev_lower = NULL,
  prev_upper = NULL,
  mort_num = NULL,
  mort_denom = NULL,
  mort_prob = NULL,
  mort_lower = NULL,
  mort_upper = NULL,
  rem_num = NULL,
  rem_denom = NULL,
  rem_prob = NULL,
  rem_lower = NULL,
  rem_upper = NULL,
  age = "age",
  cf_model = "smooth",
  inc_model = "smooth",
  rem_model = "const",
  prev_zero = FALSE,
  inc_trend = NULL,
  cf_trend = NULL,
  cf_init = 0.01,
  eqage = 30,
  eqagehi = NULL,
  sprior = c(1, 1, 1),
  hp_fixed = NULL,
  rem_prior = c(1.1, 1),
  inc_prior = c(2, 0.1),
  cf_prior = c(2, 0.1),
  method = "opt",
  draws = 1000,
  iter = 10000,
  stan_control = NULL,
  bias_model = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="disbayes_+3A_data">data</code></td>
<td>
<p>Data frame containing some of the variables below.  The
variables below are provided as character strings naming columns in this
data frame.   For each disease measure available, one of the following three
combinations of variables must be specified:
</p>
<p>(1) numerator and denominator (2) estimate and denominator (3) estimate
with lower and upper credible limits.
</p>
<p>Mortality must be supplied, and at least one of incidence and prevalence.
If remission is assumed to be possible, then remission data should also be supplied (see below).
</p>
<p>Estimates refer to the probability of having some event within a year, rather than rates.  Rates per year $r$ can be
converted to probabilities $p$ as $p = 1 - exp(-r)$, assuming the rate is constant
within the year.
</p>
<p>For estimates based on registry data assumed to cover the whole
population, then the denominator will be the population size.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_inc_num">inc_num</code></td>
<td>
<p>Numerator for the incidence data, assumed to represent the
observed number of new cases within a year among a population of size
<code>inc_denom</code>.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_inc_denom">inc_denom</code></td>
<td>
<p>Denominator for the incidence data.
</p>
<p>The function <code><a href="#topic+ci2num">ci2num</a></code> can be used to convert a published
estimate and interval for a proportion to an implicit numerator and
denominator.
</p>
<p>Note that to include extra uncertainty beyond that implied by a published
interval, the numerator and denominator could be multiplied by a constant,
for example, multiplying both the numerator and denominator by 0.5 would
give the data source half its original weight.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_inc_prob">inc_prob</code></td>
<td>
<p>Estimate of the incidence probability</p>
</td></tr>
<tr><td><code id="disbayes_+3A_inc_lower">inc_lower</code></td>
<td>
<p>Lower credible limit for the incidence estimate</p>
</td></tr>
<tr><td><code id="disbayes_+3A_inc_upper">inc_upper</code></td>
<td>
<p>Upper credible limit for the incidence estimate</p>
</td></tr>
<tr><td><code id="disbayes_+3A_prev_num">prev_num</code></td>
<td>
<p>Numerator for the estimate of prevalence, i.e.
number of people currently with a disease.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_prev_denom">prev_denom</code></td>
<td>
<p>Denominator for the estimate of prevalence (e.g. the size
of the survey used to obtain the prevalence estimate)</p>
</td></tr>
<tr><td><code id="disbayes_+3A_prev_prob">prev_prob</code></td>
<td>
<p>Estimate of the prevalence probability</p>
</td></tr>
<tr><td><code id="disbayes_+3A_prev_lower">prev_lower</code></td>
<td>
<p>Lower credible limit for the prevalence estimate</p>
</td></tr>
<tr><td><code id="disbayes_+3A_prev_upper">prev_upper</code></td>
<td>
<p>Upper credible limit for the prevalence estimate</p>
</td></tr>
<tr><td><code id="disbayes_+3A_mort_num">mort_num</code></td>
<td>
<p>Numerator for the estimate of the mortality probability, i.e
number of deaths attributed to the disease under study within a year</p>
</td></tr>
<tr><td><code id="disbayes_+3A_mort_denom">mort_denom</code></td>
<td>
<p>Denominator for the estimate of the mortality probability (e.g.
the population size, if the estimates were obtained from a comprehensive
register)</p>
</td></tr>
<tr><td><code id="disbayes_+3A_mort_prob">mort_prob</code></td>
<td>
<p>Estimate of the mortality probability</p>
</td></tr>
<tr><td><code id="disbayes_+3A_mort_lower">mort_lower</code></td>
<td>
<p>Lower credible limit for the mortality estimate</p>
</td></tr>
<tr><td><code id="disbayes_+3A_mort_upper">mort_upper</code></td>
<td>
<p>Upper credible limit for the mortality estimate</p>
</td></tr>
<tr><td><code id="disbayes_+3A_rem_num">rem_num</code></td>
<td>
<p>Numerator for the estimate of the remission probability, i.e number
of people observed to recover from the disease within a year.
</p>
<p>Remission
data should be supplied if remission is permitted in the model, either as
a numerator and denominator or as an estimate and lower credible interval.
Conversely, if no remission data are supplied, then remission is assumed
to be impossible.  These &quot;data&quot; may represent a prior judgement rather than
observation - lower denominators or wider credible limits represent
weaker prior information.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_rem_denom">rem_denom</code></td>
<td>
<p>Denominator for the estimate of the remission probability</p>
</td></tr>
<tr><td><code id="disbayes_+3A_rem_prob">rem_prob</code></td>
<td>
<p>Estimate of the remission probability</p>
</td></tr>
<tr><td><code id="disbayes_+3A_rem_lower">rem_lower</code></td>
<td>
<p>Lower credible limit for the remission estimate</p>
</td></tr>
<tr><td><code id="disbayes_+3A_rem_upper">rem_upper</code></td>
<td>
<p>Upper credible limit for the remission estimate</p>
</td></tr>
<tr><td><code id="disbayes_+3A_age">age</code></td>
<td>
<p>Variable in the data indicating the year of age.  This must
start at age zero, but can end at any age.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_cf_model">cf_model</code></td>
<td>
<p>Model for how case fatality rate varies with age.
</p>
<p><code>"smooth"</code> (the default). Case fatality rate is modelled as a smooth function of age,
using a spline.
</p>
<p><code>"indep"</code> Case fatality rates are estimated independently for each year of age.  This may be
useful for determining how much information is in
the data. That is, if the posterior from this model is identical to the
prior for a certain age, then there is no information in the data alone
about case fatality at that age, indicating that some other structural
assumption (such as a smooth function of age) or external data are equired
to give more precise estimates.
</p>
<p><code>"increasing"</code> Case fatality rate is modelled as a smooth and increasing
function of age.
</p>
<p><code>"const"</code> Case fatality rate is modelled as constant with age.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_inc_model">inc_model</code></td>
<td>
<p>Model for how incidence rates vary with age.
</p>
<p><code>"smooth"</code> (the default). Incidence rates are modelled as a smooth spline function of age.
</p>
<p><code>"indep"</code> Incidence rates for each year of age are estimated independently.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_rem_model">rem_model</code></td>
<td>
<p>Model for how remission rates vary with age, which are typically
less well-informed by data, compared to incidence and case fatality.
</p>
<p><code>"const"</code> (the default). Constant remission rate over all ages.
</p>
<p><code>"smooth"</code> Remission rates are modelled as a smooth spline function of age.
</p>
<p><code>"indep"</code> Remission rates estimated independently over all ages.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_prev_zero">prev_zero</code></td>
<td>
<p>If <code>TRUE</code>, attempt to estimate prevalence at age zero
from the data, as part of the Bayesian model, even if the observed prevalence is zero.
Otherwise (the default) this is assumed to be zero if the count is zero, and estimated
otherwise.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_inc_trend">inc_trend</code></td>
<td>
<p>Matrix of constants representing trends in incidence
through calendar time by year of age.  There are <code>nage</code> rows and
<code>nage</code> columns, where <code>nage</code> is the number of years of age
represented in the data. The entry in the ith row and jth column
represents the ratio between the incidence <code>nage+j</code> years prior to
the year of the data, year, and the incidence in the year of the data, for
a person i-1 years of age. For example, if <code>nage=100</code> and the data
refer to the year 2017, then the first column refers to the year 1918 and
the last (100th) column refers to 2017.  The last column should be all 1,
unless the current data are supposed to be biased.
</p>
<p>To produce this format from a long data frame, filter to the appropriate
outcome and subgroup, and use <code><a href="tidyr.html#topic+pivot_wider">pivot_wider</a></code>, e.g.
</p>
<p><code>trends &lt;- ihdtrends 
           filter(outcome=="Incidence", gender=="Female") 
            pivot_wider(names_from="year", values_from="p2017") 
            select(-age, -gender, -outcome) 
            as.matrix()</code></p>
</td></tr>
<tr><td><code id="disbayes_+3A_cf_trend">cf_trend</code></td>
<td>
<p>Matrix of constants representing trends in case fatality
through calendar time by year of age, in the same format as
<code>inc_trend</code>.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_cf_init">cf_init</code></td>
<td>
<p>Initial guess at a typical case fatality value, for an
average age.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_eqage">eqage</code></td>
<td>
<p>Case fatalities (and incidence and remission rates) are assumed to be equal for
all ages below this age, inclusive, when using the smoothed model.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_eqagehi">eqagehi</code></td>
<td>
<p>Case fatalities (and incidence and remission rates) are assumed to be equal for
all ages above this age, inclusive, when using the smoothed model.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_sprior">sprior</code></td>
<td>
<p>Rates of the exponential prior distributions used to penalise
the coefficients of the spline model.   The default of 1 should adapt
appropriately to the data, but Higher values give stronger smoothing, or
lower values give weaker smoothing,  if required.
</p>
<p>This can be a named vector with names <code>"inc","cf","rem"</code> in any
order, giving the prior smoothness rates for incidence, case fatality and
remission.  If any of these are not smoothed they can be excluded, e.g.
<code>sprior = c(cf=10, inc=1)</code>.
</p>
<p>This can also be an unnamed vector of three elements, where the first
refers to the spline model for incidence, the second for case fatality,
the third for remission. If one of the rates (e.g. remission) is not being
modelled with a spline, any number can be supplied here and it is just
ignored.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_hp_fixed">hp_fixed</code></td>
<td>
<p>A list with one named element for each hyperparameter
to be fixed.  The value should be either
</p>

<ul>
<li><p> a number (to fix the hyperparameter at this number)
</p>
</li>
<li> <p><code>TRUE</code> (to fix the hyperparameter at the posterior mode from a training run
where it is not fixed)
</p>
</li></ul>

<p>If the element is either <code>NULL</code>, <code>FALSE</code>, or omitted from the list,
then the hyperparameter is given a prior and estimated as part of the Bayesian model.
</p>
<p>The hyperparameters that can be fixed are
</p>

<ul>
<li> <p><code>scf</code> Smoothness parameter for the spline relating case fatality to age.
</p>
</li>
<li> <p><code>sinc</code> Smoothness parameter for the spline relating incidence to age.
</p>
</li></ul>

<p>For example, to fix the case fatality smoothness to 1.2 and fix the incidence
smoothness to its posterior mode,
specify <code>hp_fixed = list(scf=1.2, sinc=TRUE)</code>.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_rem_prior">rem_prior</code></td>
<td>
<p>Vector of two elements giving the Gamma shape and rate parameters of the
prior for the remission rate, used in both <code>rem_model="const"</code> and <code>rem_model="indep"</code>.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_inc_prior">inc_prior</code></td>
<td>
<p>Vector of two elements giving the Gamma shape and rate parameters of the
prior for the incidence rate.  Only used if <code>inc_model="indep"</code>, for each age-specific rate.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_cf_prior">cf_prior</code></td>
<td>
<p>Vector of two elements giving the Gamma shape and rate parameters of the
prior for the case fatality rate.  Only used if <code>cf_model="const"</code>, or if <code>cf_model="indep"</code>, for each age-specific rate,
and for the rate at <code>eqage</code> in <code>cf_model="increasing"</code>.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_method">method</code></td>
<td>
<p>String indicating the inference method, defaulting to
<code>"opt"</code>.
</p>
<p>If <code>method="mcmc"</code> then a sample from the posterior is drawn using Markov Chain Monte Carlo
sampling, via <span class="pkg">rstan</span>'s <code><a href="rstan.html#topic+stanmodel-method-sampling">rstan::sampling()</a></code> function.   This is the most
accurate but the slowest method.
</p>
<p>If <code>method="opt"</code>, then instead of an MCMC sample from the posterior,
<code>disbayes</code> returns the posterior mode calculated using optimisation, via
<span class="pkg">rstan</span>'s <code><a href="rstan.html#topic+stanmodel-method-optimizing">rstan::optimizing()</a></code> function.
A sample from a normal approximation to the (real-line-transformed)
posterior distribution is drawn in order to obtain credible intervals.
</p>
<p>If the optimisation fails to converge (non-zero return code), try increasing the
number of iterations from the default 1000, e.g. <code>disbayes(..., iter=10000, ...)</code>, or changing the algorithm to <code>disbayes(..., algorithm="Newton", ...)</code>.
</p>
<p>If there is an error message that mentions <code>chol</code>, then
the computed Hessian matrix is not positive definite at the reported optimum, hence credible intervals
cannot be computed.
This can occur either because of numerical error in computation of the Hessian, or because the
reported optimum is wrong.  If you are willing to believe
the optimum and live without credible intervals, then set <code>draws=0</code> to skip
computation of the Hessian.   To examine the problematic Hessian, set
<code>hessian=TRUE,draws=0</code>, then look at the <code>$fit$hessian</code> component of the
<code>disbayes</code> return object.   If it can be inverted, do <code>sqrt(diag(solve()))</code> on the Hessian, and
check for <code>NaN</code>s, indicating the problematic parameters.
Otherwise, diagonal entries of the Hessian matrix that are very small
may indicate parameters that are poorly identified from the data, leading to computational
problems.
</p>
<p>If <code>method="vb"</code>, then variational Bayes methods are used, via <span class="pkg">rstan</span>'s
<code><a href="rstan.html#topic+stanmodel-method-vb">rstan::vb()</a></code> function.  This is labelled as &quot;experimental&quot; by
<span class="pkg">rstan</span>.  It might give a better approximation to the posterior
than <code>method="opt"</code>, but has not been investigated much for <code>disbayes</code> models.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_draws">draws</code></td>
<td>
<p>Number of draws from the normal approximation to the posterior
when using <code>method="opt"</code>.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_iter">iter</code></td>
<td>
<p>Number of iterations for MCMC sampling, or maximum number of iterations for optimization.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_stan_control">stan_control</code></td>
<td>
<p>(<code>method="mcmc"</code> only). List of options supplied as the <code>control</code> argument
to <code><a href="rstan.html#topic+stanmodel-method-sampling">rstan::sampling()</a></code> in <span class="pkg">rstan</span> for the main model fit.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_bias_model">bias_model</code></td>
<td>
<p>Experimental model for bias in the incidence estimates due
to conflicting information between the different data sources.  If
<code>bias_model=NULL</code> (the default) no bias is assumed, and all data are
assumed to be generated from the same age-specific incidences.
</p>
<p>Otherwise there are assumed to be two alternative curves of incidence by
age (denoted 2 and 1) where curve 2 is related to curve 1 via a constant
hazard ratio that is estimated from the data, given a standard normal
prior on the log scale.  Three distinct curves would not be identifiable
from the data.
</p>
<p>If <code>bias_model="inc"</code> then the incidence data is assumed to be
generated from curve 2, and the prevalence and mortality data from curve
1.
</p>
<p><code>bias_model="prev"</code> then the prevalence data is generated from curve
2, and the incidence and mortality data from curve 1.
</p>
<p>If <code>bias_model="incprev"</code> then both incidence and prevalence data are
generated from curve 2, and the mortality data from curve 1.</p>
</td></tr>
<tr><td><code id="disbayes_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="rstan.html#topic+stanmodel-method-sampling">rstan::sampling()</a></code> to
control MCMC sampling, or <code><a href="rstan.html#topic+stanmodel-method-optimizing">rstan::optimizing()</a></code> to control
optimisation, in Stan.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list including the following components
</p>
<p><code>call</code>: Function call that was used.
</p>
<p><code>fit</code>: An object containing posterior samples from the fitted model,
in the <code>stanfit</code> format returned by the <code><a href="rstan.html#topic+stan">stan</a></code>
function in the <span class="pkg">rstan</span> package.
</p>
<p><code>method</code>:  Optimisation method that was chosen.
</p>
<p><code>nage</code>: Number of years of age in the data
</p>
<p><code>dat</code>: A list containing the input data in the form of numerators
and denominators.
</p>
<p><code>stan_data</code>: Full list of data supplied to Stan
</p>
<p><code>stan_inits</code>: Full list of parameter initial values supplied to Stan
</p>
<p><code>hp_fixed</code> Values of any hyperparameters that are fixed during the main model fit.
</p>
<p>Use the <code><a href="#topic+tidy.disbayes">tidy.disbayes</a></code> method to return summary statistics
from the fitted models, simply by calling <code>tidy()</code> on the fitted model.
</p>


<h3>References</h3>

<p>Jackson C, Zapata-Diomedi B, Woodcock J. (2023)
&quot;Bayesian multistate modelling of incomplete chronic disease burden data&quot;
Journal of the Royal Statistical Society, Series A, 186(1), 1-19
<a href="https://doi.org/10.1093/jrsssa/qnac015">doi:10.1093/jrsssa/qnac015</a>
</p>

<hr>
<h2 id='disbayes_hier'>Bayesian estimation of chronic disease epidemiology from incomplete data -
hierarchical model for case fatalities.</h2><span id='topic+disbayes_hier'></span>

<h3>Description</h3>

<p>A variant of <code><a href="#topic+disbayes">disbayes</a></code> in which data from different areas can be
related in a hierarchical model and, optionally, the effect of gender can be
treated as additive with the effect of area.  This is much more computationally
intensive than the basic model in <code><a href="#topic+disbayes">disbayes</a></code>.  Time trends are not
supported in this function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>disbayes_hier(
  data,
  group,
  gender = NULL,
  inc_num = NULL,
  inc_denom = NULL,
  inc_prob = NULL,
  inc_lower = NULL,
  inc_upper = NULL,
  prev_num = NULL,
  prev_denom = NULL,
  prev_prob = NULL,
  prev_lower = NULL,
  prev_upper = NULL,
  mort_num = NULL,
  mort_denom = NULL,
  mort_prob = NULL,
  mort_lower = NULL,
  mort_upper = NULL,
  rem_num = NULL,
  rem_denom = NULL,
  rem_prob = NULL,
  rem_lower = NULL,
  rem_upper = NULL,
  age = "age",
  cf_init = 0.01,
  eqage = 30,
  eqagehi = NULL,
  cf_model = "default",
  inc_model = "smooth",
  rem_model = "const",
  prev_zero = FALSE,
  sprior = c(1, 1, 1),
  hp_fixed = NULL,
  nfold_int_guess = 5,
  nfold_int_upper = 100,
  nfold_slope_guess = 5,
  nfold_slope_upper = 100,
  mean_int_prior = c(0, 10),
  mean_slope_prior = c(5, 5),
  gender_int_priorsd = 0.82,
  gender_slope_priorsd = 0.82,
  inc_prior = c(1.1, 0.1),
  rem_prior = c(1.1, 1),
  method = "opt",
  draws = 1000,
  iter = 10000,
  stan_control = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="disbayes_hier_+3A_data">data</code></td>
<td>
<p>Data frame containing some of the variables below.  The
variables below are provided as character strings naming columns in this
data frame.   For each disease measure available, one of the following three
combinations of variables must be specified:
</p>
<p>(1) numerator and denominator (2) estimate and denominator (3) estimate
with lower and upper credible limits.
</p>
<p>Mortality must be supplied, and at least one of incidence and prevalence.
If remission is assumed to be possible, then remission data should also be supplied (see below).
</p>
<p>Estimates refer to the probability of having some event within a year, rather than rates.  Rates per year $r$ can be
converted to probabilities $p$ as $p = 1 - exp(-r)$, assuming the rate is constant
within the year.
</p>
<p>For estimates based on registry data assumed to cover the whole
population, then the denominator will be the population size.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_group">group</code></td>
<td>
<p>Variable in the data representing the area (or other grouping
factor).</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_gender">gender</code></td>
<td>
<p>If <code>NULL</code> (the default) then the data are one homogenous
gender, and there should be one row per year of age.  Otherwise, set
<code>gender</code> to a character string naming the variable in the data
representing gender (or other categorical grouping factor).  Gender will then
treated as a fixed additive effect, so the linear effect of gender on log
case fatality is the same in each area.  The data should have one row per
year of age and gender.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_inc_num">inc_num</code></td>
<td>
<p>Numerator for the incidence data, assumed to represent the
observed number of new cases within a year among a population of size
<code>inc_denom</code>.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_inc_denom">inc_denom</code></td>
<td>
<p>Denominator for the incidence data.
</p>
<p>The function <code><a href="#topic+ci2num">ci2num</a></code> can be used to convert a published
estimate and interval for a proportion to an implicit numerator and
denominator.
</p>
<p>Note that to include extra uncertainty beyond that implied by a published
interval, the numerator and denominator could be multiplied by a constant,
for example, multiplying both the numerator and denominator by 0.5 would
give the data source half its original weight.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_inc_prob">inc_prob</code></td>
<td>
<p>Estimate of the incidence probability</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_inc_lower">inc_lower</code></td>
<td>
<p>Lower credible limit for the incidence estimate</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_inc_upper">inc_upper</code></td>
<td>
<p>Upper credible limit for the incidence estimate</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_prev_num">prev_num</code></td>
<td>
<p>Numerator for the estimate of prevalence, i.e.
number of people currently with a disease.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_prev_denom">prev_denom</code></td>
<td>
<p>Denominator for the estimate of prevalence (e.g. the size
of the survey used to obtain the prevalence estimate)</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_prev_prob">prev_prob</code></td>
<td>
<p>Estimate of the prevalence probability</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_prev_lower">prev_lower</code></td>
<td>
<p>Lower credible limit for the prevalence estimate</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_prev_upper">prev_upper</code></td>
<td>
<p>Upper credible limit for the prevalence estimate</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_mort_num">mort_num</code></td>
<td>
<p>Numerator for the estimate of the mortality probability, i.e
number of deaths attributed to the disease under study within a year</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_mort_denom">mort_denom</code></td>
<td>
<p>Denominator for the estimate of the mortality probability (e.g.
the population size, if the estimates were obtained from a comprehensive
register)</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_mort_prob">mort_prob</code></td>
<td>
<p>Estimate of the mortality probability</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_mort_lower">mort_lower</code></td>
<td>
<p>Lower credible limit for the mortality estimate</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_mort_upper">mort_upper</code></td>
<td>
<p>Upper credible limit for the mortality estimate</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_rem_num">rem_num</code></td>
<td>
<p>Numerator for the estimate of the remission probability, i.e number
of people observed to recover from the disease within a year.
</p>
<p>Remission
data should be supplied if remission is permitted in the model, either as
a numerator and denominator or as an estimate and lower credible interval.
Conversely, if no remission data are supplied, then remission is assumed
to be impossible.  These &quot;data&quot; may represent a prior judgement rather than
observation - lower denominators or wider credible limits represent
weaker prior information.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_rem_denom">rem_denom</code></td>
<td>
<p>Denominator for the estimate of the remission probability</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_rem_prob">rem_prob</code></td>
<td>
<p>Estimate of the remission probability</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_rem_lower">rem_lower</code></td>
<td>
<p>Lower credible limit for the remission estimate</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_rem_upper">rem_upper</code></td>
<td>
<p>Upper credible limit for the remission estimate</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_age">age</code></td>
<td>
<p>Variable in the data indicating the year of age.  This must
start at age zero, but can end at any age.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_cf_init">cf_init</code></td>
<td>
<p>Initial guess at a typical case fatality value, for an
average age.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_eqage">eqage</code></td>
<td>
<p>Case fatalities (and incidence and remission rates) are assumed to be equal for
all ages below this age, inclusive, when using the smoothed model.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_eqagehi">eqagehi</code></td>
<td>
<p>Case fatalities (and incidence and remission rates) are assumed to be equal for
all ages above this age, inclusive, when using the smoothed model.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_cf_model">cf_model</code></td>
<td>
<p>The following alternative models for case fatality are
supported:
</p>
<p><code>"default"</code> (the default). Random intercepts and slopes, and no
further restriction.
</p>
<p><code>"interceptonly"</code>.  Random intercepts, but common slopes.
</p>
<p><code>"increasing"</code>. Case fatality is assumed to be an increasing function
of age (note it is constant below <code>"eqage"</code> in all models) with a
common slope for all groups.
</p>
<p><code>"common"</code> Case fatality is an unconstrained function of age
which is common to all areas, i.e. it has the same parameter values in
every area.  This and <code>"increasing_common"</code> are used in situations
where you want to compare a model with area-specific rates with a single model for
the data aggregated over areas.  Modelling the area-disaggregated data using
a common function for all areas is equivalent to a model for the aggregated data,
and can be statistically compared (using cross-validation) with a model with
area-specific rates.
</p>
<p><code>"increasing_common"</code> Case fatality is an increasing function of age
which is common to all areas.
</p>
<p><code>"const"</code> Case fatality is assumed to be constant with age, for all
ages, but different in each area.
</p>
<p><code>"const_common"</code> Case fatality is a constant over all ages and areas.
</p>
<p>In all models, case fatality is a smooth function of age.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_inc_model">inc_model</code></td>
<td>
<p>Model for how incidence varies with age.
</p>
<p><code>"smooth"</code> (the default). Incidence is modelled as a smooth spline
function of age, independently for each area (and gender).
</p>
<p><code>"indep"</code> Incidence rates for each year of age, area (and gender) are
estimated independently.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_rem_model">rem_model</code></td>
<td>
<p>Model for how remission varies with age.  Currently
supported models are <code>"const"</code> for a constant remission rate over all
ages, <code>"const"</code> for a smooth spline,  or <code>"indep"</code> for a different remission rates estimated
independently for each age with no smoothing.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_prev_zero">prev_zero</code></td>
<td>
<p>If <code>TRUE</code>, attempt to estimate prevalence at age zero
from the data, as part of the Bayesian model, even if the observed prevalence is zero.
Otherwise (the default) this is assumed to be zero if the count is zero, and estimated
otherwise.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_sprior">sprior</code></td>
<td>
<p>Rates of the exponential prior distributions used to penalise
the coefficients of the spline model.   The default of 1 should adapt
appropriately to the data, but Higher values give stronger smoothing, or
lower values give weaker smoothing,  if required.
</p>
<p>This can be a named vector with names <code>"inc","cf","rem"</code> in any
order, giving the prior smoothness rates for incidence, case fatality and
remission.  If any of these are not smoothed they can be excluded, e.g.
<code>sprior = c(cf=10, inc=1)</code>.
</p>
<p>This can also be an unnamed vector of three elements, where the first
refers to the spline model for incidence, the second for case fatality,
the third for remission. If one of the rates (e.g. remission) is not being
modelled with a spline, any number can be supplied here and it is just
ignored.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_hp_fixed">hp_fixed</code></td>
<td>
<p>A list with one named element for each hyperparameter
to be fixed.  The value should be either
</p>

<ul>
<li><p> a number (to fix the hyperparameter at this number)
</p>
</li>
<li> <p><code>TRUE</code> (to fix the hyperparameter at the posterior mode from a training run
where it is not fixed)
</p>
</li></ul>

<p>If the element is either <code>NULL</code>, <code>FALSE</code>, or omitted from the list,
then the hyperparameter is given a prior and estimated as part of the Bayesian model.
</p>
<p>The hyperparameters that can be fixed are
</p>

<ul>
<li> <p><code>scf</code> Smoothness parameter for the spline relating case fatality to age.
</p>
</li>
<li> <p><code>sinc</code> Smoothness parameter for the spline relating incidence to age.
</p>
</li>
<li> <p><code>scfmale</code> Smoothness parameter for the spline defining how the gender
effect relates to age.  Only for models with additive gender and area effects.
</p>
</li>
<li> <p><code>sd_int</code> Standard deviation of random intercepts for case fatality.
</p>
</li>
<li> <p><code>sd_slope</code> Standard deviation of random slopes for case fatality.
</p>
</li></ul>

<p>For example, to fix the case fatality smoothness to 1.2, fix the incidence
smoothness to its posterior mode, and estimate all the other hyperparameters,
specify <code>hp_fixed = list(scf=1.2, sinc=TRUE)</code>.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_nfold_int_guess">nfold_int_guess</code></td>
<td>
<p>Prior guess at the ratio of case fatality between a
high risk (97.5% quantile) and low risk (2.5% quantile) area.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_nfold_int_upper">nfold_int_upper</code></td>
<td>
<p>Prior upper 95% credible limit for the ratio in
average case fatality between a high risk (97.5% quantile) and low risk
(2.5% quantile) area.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_nfold_slope_guess">nfold_slope_guess</code>, <code id="disbayes_hier_+3A_nfold_slope_upper">nfold_slope_upper</code></td>
<td>
<p>This argument and the next
argument define the prior distribution for the variance in the random
linear effects of age on log case fatality.   They define a prior guess
and upper 95% credible limit for the ratio of case fatality slopes
between a high trend (97.5% quantile) and low risk (2.5% quantile) area.
(Note that the model is not exactly linear, since departures from
linearity are defined through a spline model.  See the Jackson et al.
paper for details.).</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_mean_int_prior">mean_int_prior</code></td>
<td>
<p>Vector of two elements giving the prior mean and
standard deviation respectively for the mean random intercept for log case
fatality.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_mean_slope_prior">mean_slope_prior</code></td>
<td>
<p>Vector of two elements giving the prior mean and
standard deviation respectively for the mean random slope for log case
fatality.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_gender_int_priorsd">gender_int_priorsd</code></td>
<td>
<p>Prior standard deviation for the additive effect
of gender on log case fatality</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_gender_slope_priorsd">gender_slope_priorsd</code></td>
<td>
<p>Prior standard deviation for the additive effect
of gender on the linear age slope of log case fatality</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_inc_prior">inc_prior</code></td>
<td>
<p>Vector of two elements giving the Gamma shape and rate parameters of the
prior for the incidence rate.  Only used if <code>inc_model="indep"</code>, for each age-specific rate.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_rem_prior">rem_prior</code></td>
<td>
<p>Vector of two elements giving the Gamma shape and rate parameters of the
prior for the remission rate, used in both <code>rem_model="const"</code> and <code>rem_model="indep"</code>.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_method">method</code></td>
<td>
<p>String indicating the inference method, defaulting to
<code>"opt"</code>.
</p>
<p>If <code>method="mcmc"</code> then a sample from the posterior is drawn using Markov Chain Monte Carlo
sampling, via <span class="pkg">rstan</span>'s <code><a href="rstan.html#topic+stanmodel-method-sampling">rstan::sampling()</a></code> function.   This is the most
accurate but the slowest method.
</p>
<p>If <code>method="opt"</code>, then instead of an MCMC sample from the posterior,
<code>disbayes</code> returns the posterior mode calculated using optimisation, via
<span class="pkg">rstan</span>'s <code><a href="rstan.html#topic+stanmodel-method-optimizing">rstan::optimizing()</a></code> function.
A sample from a normal approximation to the (real-line-transformed)
posterior distribution is drawn in order to obtain credible intervals.
</p>
<p>If the optimisation fails to converge (non-zero return code), try increasing the
number of iterations from the default 1000, e.g. <code>disbayes(..., iter=10000, ...)</code>, or changing the algorithm to <code>disbayes(..., algorithm="Newton", ...)</code>.
</p>
<p>If there is an error message that mentions <code>chol</code>, then
the computed Hessian matrix is not positive definite at the reported optimum, hence credible intervals
cannot be computed.
This can occur either because of numerical error in computation of the Hessian, or because the
reported optimum is wrong.  If you are willing to believe
the optimum and live without credible intervals, then set <code>draws=0</code> to skip
computation of the Hessian.   To examine the problematic Hessian, set
<code>hessian=TRUE,draws=0</code>, then look at the <code>$fit$hessian</code> component of the
<code>disbayes</code> return object.   If it can be inverted, do <code>sqrt(diag(solve()))</code> on the Hessian, and
check for <code>NaN</code>s, indicating the problematic parameters.
Otherwise, diagonal entries of the Hessian matrix that are very small
may indicate parameters that are poorly identified from the data, leading to computational
problems.
</p>
<p>If <code>method="vb"</code>, then variational Bayes methods are used, via <span class="pkg">rstan</span>'s
<code><a href="rstan.html#topic+stanmodel-method-vb">rstan::vb()</a></code> function.  This is labelled as &quot;experimental&quot; by
<span class="pkg">rstan</span>.  It might give a better approximation to the posterior
than <code>method="opt"</code>, but has not been investigated much for <code>disbayes</code> models.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_draws">draws</code></td>
<td>
<p>Number of draws from the normal approximation to the posterior
when using <code>method="opt"</code>.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_iter">iter</code></td>
<td>
<p>Number of iterations for MCMC sampling, or maximum number of iterations for optimization.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_stan_control">stan_control</code></td>
<td>
<p>(<code>method="mcmc"</code> only). List of options supplied as the <code>control</code> argument
to <code><a href="rstan.html#topic+stanmodel-method-sampling">rstan::sampling()</a></code> in <span class="pkg">rstan</span> for the main model fit.</p>
</td></tr>
<tr><td><code id="disbayes_hier_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="rstan.html#topic+stanmodel-method-sampling">rstan::sampling()</a></code> to
control MCMC sampling, or <code><a href="rstan.html#topic+stanmodel-method-optimizing">rstan::optimizing()</a></code> to control
optimisation, in Stan.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list including the following components
</p>
<p><code>call</code>: Function call that was used.
</p>
<p><code>fit</code>: An object containing posterior samples from the fitted model,
in the <code>stanfit</code> format returned by the <code><a href="rstan.html#topic+stan">stan</a></code>
function in the <span class="pkg">rstan</span> package.
</p>
<p><code>method</code>:  Optimisation method that was chosen.
</p>
<p><code>nage</code>: Number of years of age in the data
</p>
<p><code>narea</code>: Number of areas (or other grouping variable that defines the hierarchical model).
</p>
<p><code>ng</code>: Number of genders (or other categorical variable whose effect is treated as
additive with the area effect).
</p>
<p><code>groups</code>: Names of the areas (or other grouping variable), taken from the factor levels in the
original data.
</p>
<p><code>genders</code>: Names of the genders (or other categorical variable), taken from the factor levels in the
original data.
</p>
<p><code>dat</code>: A list containing the input data in the form of numerators
and denominators.
</p>
<p><code>stan_data</code>: Full list of data supplied to Stan
</p>
<p><code>stan_inits</code>: Full list of parameter initial values supplied to Stan
</p>
<p><code>trend</code>: Whether a time trend was modelled
</p>
<p><code>hp_fixed</code> Values of any hyperparameters that are fixed during the main model fit.
</p>


<h3>References</h3>

<p>Jackson C, Zapata-Diomedi B, Woodcock J.
&quot;Bayesian multistate modelling of incomplete chronic disease burden data&quot;
<a href="https://arxiv.org/abs/2111.14100">https://arxiv.org/abs/2111.14100</a>
</p>

<hr>
<h2 id='disbayes-package'>The 'disbayes' package.</h2><span id='topic+disbayes-package'></span>

<h3>Description</h3>

<p>Bayesian evidence synthesis for chronic disease epidemiology
</p>


<h3>References</h3>

<p>Stan Development Team (2019). RStan: the R interface to Stan. R package version 2.19.2. https://mc-stan.org
</p>

<hr>
<h2 id='ihdengland'>Ischemic heart disease in England</h2><span id='topic+ihdengland'></span>

<h3>Description</h3>

<p>Ischemic heart disease in England
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ihdengland
</code></pre>


<h3>Format</h3>

<p>A data frame with columns:
</p>
<p><code>sex</code>: <code>"male"</code> or <code>"female"</code>. 
</p>
<p><code>ageyr</code>. Year of age. 
</p>
<p><code>location</code>. Name of the location, which is either a city region or region in England. 
</p>
<p><code>num_mort</code>. Numerator behind the estimate of mortality 
</p>
<p><code>num_inc</code>. Numerator behind the estimate of incidence
</p>
<p><code>num_prev</code>. Numerator behind the estimate of prevalence
</p>
<p><code>denom_mort</code>. Denominator behind the estimate of mortality 
</p>
<p><code>denom_inc</code>.  Denominator behind the estimate of incidence
</p>
<p><code>denom_prev</code>. Denominator behind the estimate of prevalence
</p>


<h3>Details</h3>

<p>The data were processed to
</p>
<p>* change the geography to refer to England city regions and the remaining English regions,
</p>
<p>* change counts by 5-year age groups to estimated 1-year counts,
</p>
<p>* obtain estimated numerators and denominators from the published point estimates and uncertainty intervals.
A point estimate of the risk is equivalent to the numerator divided by the denominator. The denominator is
related to the extent of uncertainty around this estimate, and obtained using the Bayesian method
implemented in <code><a href="#topic+ci2num">ci2num</a></code>. 
</p>
<p>The script given in <a href="https://github.com/chjackson/disbayes/blob/master/data-raw/gbd_process.Rmd">https://github.com/chjackson/disbayes/blob/master/data-raw/gbd_process.Rmd</a> shows
these steps.
</p>


<h3>Source</h3>

<p>Global Burden of Disease, 2017
</p>


<h3>References</h3>

<p>Jackson C, Zapata-Diomedi B, Woodcock J. &quot;Bayesian multistate modelling of incomplete chronic disease burden data&quot; <a href="https://arxiv.org/abs/2111.14100">https://arxiv.org/abs/2111.14100</a>.
</p>

<hr>
<h2 id='ihdtrends'>Trends in ischemic heart disease in England</h2><span id='topic+ihdtrends'></span>

<h3>Description</h3>

<p>Trends in ischemic heart disease in England
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ihdtrends
</code></pre>


<h3>Format</h3>

<p>A data frame with columns:
</p>
<p><code>gender</code>: <code>"male"</code> or <code>"female"</code>. 
</p>
<p><code>age</code>: Year of age. 
</p>
<p><code>year</code>: Calendar year.
</p>
<p><code>p2017</code>: Estimated ratio between the outcome in the calendar
year and the outcome in 2017.
</p>
<p><code>outcome</code>: Outcome referred to (incidence or case fatality).
</p>


<h3>Details</h3>

<p>The data were interpolated and smoothed to produce a matrix by year of age and
calendar year, using the script at <a href="https://github.com/chjackson/disbayes/blob/master/data-raw/trends.r">https://github.com/chjackson/disbayes/blob/master/data-raw/trends.r</a>.
</p>


<h3>Source</h3>

<p>Scarborough, P., Wickramasinghe, K., Bhatnagar, P. and Rayner, M. (2011) Trends in coronary heart disease, 1961-2001. British Heart Foundation.
</p>
<p>Smolina, K., Wright, F. L., Rayner, M. and Goldacre, M. J. (2012) Determinants of the decline in mortality from acute myocardial infarction in England between 2002 and 2010: linked national database study. BMJ, 344.
</p>
<p>British Heart Foundation (2020) Heart and Circulatory Disease Statistics 2020. British Heart Foundation.
</p>

<hr>
<h2 id='loo_indiv'>Extract observation-specific contributions from a disbayes leave-one-out cross validation</h2><span id='topic+loo_indiv'></span><span id='topic+looi_disbayes'></span>

<h3>Description</h3>

<p>Extract observation-specific contributions from a disbayes leave-one-out cross validation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>loo_indiv(x, agg = FALSE)

looi_disbayes(x, agg = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="loo_indiv_+3A_x">x</code></td>
<td>
<p>For <code>loo_indiv</code>, an object returned by <code><a href="#topic+loo.disbayes">loo.disbayes</a></code>.   For <code>looi_disbayes</code>, an object returned by <code><a href="#topic+disbayes">disbayes</a></code>.</p>
</td></tr>
<tr><td><code id="loo_indiv_+3A_agg">agg</code></td>
<td>
<p>If <code>TRUE</code> then the observation-specific contributions are aggregated over
outcome type, returning a data frame with one row for each of incidence, prevalence, mortality
and remission (if remission is included in the model), and one column for each of <code>"elpd_loo"</code>,
<code>"p_loo"</code> and <code>"looic"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with one row per observed age-specific mortality, incidence, prevalence and/or
remission age-specific data-point, containing leave-one-out cross validation statistics representing how
well the model would predict that observation if it were left out of the fit. 
</p>
<p>These are computed with the <span class="pkg">loo</span> package.
</p>
<p><code>loo_indiv</code> acts on the objects that are returned by running <code><a href="#topic+loo">loo</a></code> on <code><a href="#topic+disbayes">disbayes</a></code>
objects.  <code><a href="#topic+looi_disbayes">looi_disbayes</a></code> acts directly on  <code><a href="#topic+disbayes">disbayes</a></code>
objects.  Both of those functions return a data frame with LOO contributions for each data point.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>looi_disbayes()</code>: Observation-level leave-one-out cross validation statistics for a disbayes model
</p>
</li></ul>

<hr>
<h2 id='loo.disbayes'>Leave-one-out cross validation for disbayes models</h2><span id='topic+loo.disbayes'></span>

<h3>Description</h3>

<p>Leave-one-out cross validation for disbayes models
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'disbayes'
loo(x, outcome = "overall", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="loo.disbayes_+3A_x">x</code></td>
<td>
<p>A model fitted by <code><a href="#topic+disbayes">disbayes</a></code>.  Any of the computation methods
are supported.</p>
</td></tr>
<tr><td><code id="loo.disbayes_+3A_outcome">outcome</code></td>
<td>
<p>Either <code>"overall"</code>, to assess the fit to all data, or 
one of <code>"inc"</code>, <code>"prev"</code>, <code>"mort"</code> or <code>"rem"</code>, to assess the fit
to the incidence data, prevalence data, mortalidy data or remission data, respectively.</p>
</td></tr>
<tr><td><code id="loo.disbayes_+3A_...">...</code></td>
<td>
<p>Other arguments (currently unused).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>"loo"</code> as defined by the <span class="pkg">loo</span> package.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+loo_indiv">loo_indiv</a></code> to return tidied observation-specific contributions
to the overall model fit computed here.
</p>

<hr>
<h2 id='plot.disbayes'>Quick and dirty plot of estimates from disbayes models against age</h2><span id='topic+plot.disbayes'></span>

<h3>Description</h3>

<p>Posterior medians and 95
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'disbayes'
plot(x, variable = "cf", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.disbayes_+3A_x">x</code></td>
<td>
<p>Object returned by <code><a href="#topic+disbayes">disbayes</a></code></p>
</td></tr>
<tr><td><code id="plot.disbayes_+3A_variable">variable</code></td>
<td>
<p>Name of the variable of interest to plot against age, by default case fatality rates.</p>
</td></tr>
<tr><td><code id="plot.disbayes_+3A_...">...</code></td>
<td>
<p>Other arguments. Currently unused</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot2</code> object that can be printed to show the plot, or customised by adding <code>geom</code>s.
</p>
<p>Better plots can be drawn by <code>tidy</code>ing the object returned by <code>disbayes</code>, and using <code>ggplot2</code> directly on the tidy data frame that this produces. See the vignette for examples.
</p>

<hr>
<h2 id='plot.disbayes_hier'>Quick plot of estimates from hierarchical disbayes models against age</h2><span id='topic+plot.disbayes_hier'></span>

<h3>Description</h3>

<p>Posterior medians and 95% credible intervals for a quantity of interest are plotted against year of age.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'disbayes_hier'
plot(x, variable = "cf", ci = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.disbayes_hier_+3A_x">x</code></td>
<td>
<p>Object returned by <code><a href="#topic+disbayes_hier">disbayes_hier</a></code></p>
</td></tr>
<tr><td><code id="plot.disbayes_hier_+3A_variable">variable</code></td>
<td>
<p>Name of the variable of interest to plot against age, by default case fatality rates.</p>
</td></tr>
<tr><td><code id="plot.disbayes_hier_+3A_ci">ci</code></td>
<td>
<p>Show 95% credible intervals with ribbons.</p>
</td></tr>
<tr><td><code id="plot.disbayes_hier_+3A_...">...</code></td>
<td>
<p>Other arguments. Currently unused</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot2</code> object that can be printed to show the plot, or
customised by adding <code>geom</code>s.
</p>
<p>Better plots can be drawn by <code>tidy</code>ing the object returned by <code>disbayes</code>, and using <code>ggplot2</code> directly on the tidy data frame that this produces.  See the vignette for examples.
</p>

<hr>
<h2 id='plotfit_data_disbayes'>Create tidy data for a check of observed against fitted outcome probability estimates
from disbayes</h2><span id='topic+plotfit_data_disbayes'></span>

<h3>Description</h3>

<p>Create tidy data for a check of observed against fitted outcome probability estimates
from disbayes
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotfit_data_disbayes(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotfit_data_disbayes_+3A_x">x</code></td>
<td>
<p>Fitted model from <code><a href="#topic+disbayes">disbayes</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame containing observed data in the form of outcome probabilities, as extracted by <code><a href="#topic+tidy_obsdat">tidy_obsdat</a></code>, and estimates of the corresponding probability parameters from the fitted model.
</p>

<hr>
<h2 id='plotfit_disbayes'>Graphical check of observed against fitted outcome probabilities from disbayes</h2><span id='topic+plotfit_disbayes'></span>

<h3>Description</h3>

<p>The data behind the plot can be produced using <code><a href="#topic+plotfit_data_disbayes">plotfit_data_disbayes</a></code>,
to enable customised plots to be produced by hand with <code>ggplot2</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotfit_disbayes(x, agemin = 50)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotfit_disbayes_+3A_x">x</code></td>
<td>
<p>Fitted model from <code><a href="#topic+disbayes">disbayes</a></code></p>
</td></tr>
<tr><td><code id="plotfit_disbayes_+3A_agemin">agemin</code></td>
<td>
<p>Minimum age to show on the horizontal axis.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot2</code> object containing the plot.
</p>

<hr>
<h2 id='reexports'>Objects exported from other packages</h2><span id='topic+reexports'></span><span id='topic+tidy'></span><span id='topic+loo'></span>

<h3>Description</h3>

<p>These objects are imported from other packages. Follow the links
below to see their documentation.
</p>

<dl>
<dt>generics</dt><dd><p><code><a href="generics.html#topic+tidy">tidy</a></code></p>
</dd>
<dt>loo</dt><dd><p><code><a href="loo.html#topic+loo">loo</a></code></p>
</dd>
</dl>

<hr>
<h2 id='tidy_obsdat'>Extract observed data from a disbayes model fit</h2><span id='topic+tidy_obsdat'></span>

<h3>Description</h3>

<p>Extract observed data from a disbayes model fit
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tidy_obsdat(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tidy_obsdat_+3A_x">x</code></td>
<td>
<p>Fitted <code><a href="#topic+disbayes">disbayes</a></code> model</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with columns <code>num</code> and <code>denom</code> giving the incidence, prevalence and mortality (and remission if used) numerators and denominators used in the model fit.  The column <code>var</code> indicates which of incidence, prevalence etc. the numbers refer to.   The column <code>prob</code> is derived as <code>num</code> divided by <code>denom</code>.  Columns <code>lower</code> and <code>upper</code> define credible intervals for the &quot;data-based&quot; point estimate <code>prob</code>, obtained from the Beta posterior assuming a Beta(0.5, 0.5) prior.
</p>
<p>This &quot;data-based&quot; point estimate can be compared with estimates from the model using the functions <code><a href="#topic+plotfit_data_disbayes">plotfit_data_disbayes</a></code> and <code><a href="#topic+plotfit_disbayes">plotfit_disbayes</a></code>.
</p>

<hr>
<h2 id='tidy.disbayes'>Form a tidy data frame from the estimates from a disbayes fit</h2><span id='topic+tidy.disbayes'></span><span id='topic+tidy.disbayes_hier'></span>

<h3>Description</h3>

<p>Simply call this after fitting disbayes, as, e.g.
</p>
<div class="sourceCode"><pre>res &lt;- disbayes(...)
tidy(res)
</pre></div>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'disbayes'
tidy(x, startyear = 1, ...)

## S3 method for class 'disbayes_hier'
tidy(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tidy.disbayes_+3A_x">x</code></td>
<td>
<p>Object returned by <code><a href="#topic+disbayes">disbayes</a></code></p>
</td></tr>
<tr><td><code id="tidy.disbayes_+3A_startyear">startyear</code></td>
<td>
<p>Only used for models with time trends.  Numeric year represented by year 1 in the data. For example, set this to 1918 to convert years 1-100 to years 1918-2017.</p>
</td></tr>
<tr><td><code id="tidy.disbayes_+3A_...">...</code></td>
<td>
<p>Other arguments (currently unused)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with one row per model parameter, giving summary statistics
for the posterior distribution for that parameter.   For array parameters, e.g. those
that depend on age or area, then the age and area are returned in separate columns,
to make it easier to summarise and plot the results, e.g. using <span class="pkg">ggplot2</span>.
</p>
<p>Model parameters might include, depending on the model specification,
</p>

<ul>
<li> <p><code>cf</code>, <code>inc</code>, <code>rem</code>: Case fatality, incidence, remission rates
</p>
</li>
<li> <p><code>inc_prob</code>, <code>rem_prob</code>, <code>mort_prob</code>, <code>cf_prob</code>:  Annual incidence, remission, mortality and case fatality risks (probabilities).
</p>
</li>
<li> <p><code>prev_prob</code> Prevalence (probability).
</p>
</li>
<li> <p><code>state_probs</code> State occupancy probabilities.
</p>
</li>
<li> <p><code>beta</code>, <code>beta_inc</code> Coefficients of the spline basis for case fatality and incidence respectively.
</p>
</li>
<li> <p><code>lambda_cf</code>, <code>lambda_inc</code> Smoothness parameters of the spline functions.
</p>
</li>
<li> <p><code>prevzero</code> Prevalence at age zero
</p>
</li>
<li> <p><code>cfbase</code> Case fatality at the baseline age (only in models where case fatality is increasing).
</p>
</li>
<li> <p><code>dcf</code> Annual increments in case fatality (only in models where case fatality is increasing).
</p>
</li>
<li> <p><code>bias_loghr</code> Log hazard ratio describing bias in case fatality between datasets (only in models where <code>bias_model</code> has been set).
</p>
</li></ul>

<p>For models with time trends:
</p>

<ul>
<li> <p><code>cf_yr</code>, <code>inc_yr</code>, <code>state_probs_yr</code> Case fatality rates, incidence rates and state occupancy probabilities in years prior to the current year.  <code>cf</code> and <code>inc</code> refer to the rates for the current year, the one represented in the data.
</p>
</li></ul>

<p>Only for hierarchical models:
</p>

<ul>
<li> <p><code>mean_inter</code>, <code>mean_slope</code>,<code>sd_inter</code>,<code>sd_slope</code>.  Mean and standard deviation for random effects distribution for the intercept and slope of log case fatality.
</p>
</li>
<li> <p><code>lambda_cf_male</code>, <code>lambda_inc_male</code>.  Smoothness of the additive gender effect on case fatality and incidence.
</p>
</li>
<li> <p><code>bareat</code> Area-level contribution to spline basis coefficients.
</p>
</li>
<li> <p><code>barea</code>  Normalised spline basis coefficients.
</p>
</li></ul>



<h3>Functions</h3>


<ul>
<li> <p><code>tidy(disbayes_hier)</code>: Tidy method for hierarchical disbayes models
</p>
</li></ul>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
