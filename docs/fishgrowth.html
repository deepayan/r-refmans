<!DOCTYPE html><html lang="en"><head><title>Help for package fishgrowth</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {fishgrowth}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#fishgrowth-package'><p>Fit Growth Curves to Fish Data</p></a></li>
<li><a href='#gcm'><p>Growth Cessation Model</p></a></li>
<li><a href='#gompertz'><p>Gompertz Growth Model</p></a></li>
<li><a href='#gompertzo'><p>Gompertz Growth Model (Old Style)</p></a></li>
<li><a href='#otoliths_had'><p>Otolith Data (Haddock)</p></a></li>
<li><a href='#otoliths_skj'><p>Otolith Data (Skipjack)</p></a></li>
<li><a href='#pred_band'><p>Prediction Band</p></a></li>
<li><a href='#richards'><p>Richards Growth Model</p></a></li>
<li><a href='#richardso'><p>Richards Growth Model (Old Style)</p></a></li>
<li><a href='#schnute3'><p>Schnute Case 3 Model</p></a></li>
<li><a href='#tags_skj'><p>Tagging Data (Skipjack)</p></a></li>
<li><a href='#vonbert'><p>Von Bertalanffy Growth Model</p></a></li>
<li><a href='#vonberto'><p>Von Bertalanffy Growth Model (Old Style)</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Version:</td>
<td>1.0.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2025-02-18</td>
</tr>
<tr>
<td>Title:</td>
<td>Fit Growth Curves to Fish Data</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10), RTMB</td>
</tr>
<tr>
<td>Suggests:</td>
<td>areaplot</td>
</tr>
<tr>
<td>LazyData:</td>
<td>yes</td>
</tr>
<tr>
<td>Description:</td>
<td>Fit growth models to otoliths and/or tagging data, using the 'RTMB'
  package and maximum likelihood. The otoliths (or similar measurements of age)
  provide direct observed coordinates of age and length. The tagging data
  provide information about the observed length at release and length at
  recapture at a later time, where the age at release is unknown and estimated
  as a vector of parameters. The growth models provided by this package can be
  fitted to otoliths only, tagging data only, or a combination of the two.
  Growth variability can be modelled as constant or increasing with length.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/arni-magnusson/fishgrowth">https://github.com/arni-magnusson/fishgrowth</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-02-18 03:53:41 UTC; arnim</td>
</tr>
<tr>
<td>Author:</td>
<td>Arni Magnusson [aut, cre],
  Mark Maunder [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Arni Magnusson &lt;thisisarni@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-02-18 11:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='fishgrowth-package'>Fit Growth Curves to Fish Data</h2><span id='topic+fishgrowth-package'></span><span id='topic+fishgrowth'></span>

<h3>Description</h3>

<p>Fit growth models to otoliths and/or tagging data, using the
<code><a href="RTMB.html#topic+RTMB">RTMB</a></code> package and maximum likelihood.
</p>
<p>The otoliths (or similar measurements of age) provide direct observed
coordinates of age and length. The tagging data provide information about the
observed length at release and length at recapture at a later time, where the
age at release is unknown and estimated as a vector of parameters.
</p>
<p>The growth models provided by this package can be fitted to otoliths only,
tagging data only, or a combination of the two. Growth variability can be
modelled as constant or increasing with length.
</p>


<h3>Details</h3>

<p><em>Growth models:</em>
</p>

<table>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+gcm">gcm</a></code>       </td><td style="text-align: left;"> growth cessation</td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+gompertz">gompertz</a></code>  </td><td style="text-align: left;"> Gompertz</td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+gompertzo">gompertzo</a></code> </td><td style="text-align: left;"> Gompertz (old style)</td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+richards">richards</a></code>  </td><td style="text-align: left;"> Richards</td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+richardso">richardso</a></code> </td><td style="text-align: left;"> Richards (old style)</td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+schnute3">schnute3</a></code>  </td><td style="text-align: left;"> Schnute Case 3</td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+vonbert">vonbert</a></code>   </td><td style="text-align: left;"> von Bertalanffy</td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+vonberto">vonberto</a></code>  </td><td style="text-align: left;"> von Bertalanffy (old style)
</td>
</tr>

</table>

<p><em>Utilities:</em>
</p>

<table>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+pred_band">pred_band</a></code>  </td><td style="text-align: left;"> prediction band
</td>
</tr>

</table>

<p><em>Example data:</em>
</p>

<table>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+otoliths_had">otoliths_had</a></code> </td><td style="text-align: left;"> otoliths (haddock)</td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+otoliths_skj">otoliths_skj</a></code> </td><td style="text-align: left;"> otoliths (skipjack)</td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+tags_skj">tags_skj</a></code>     </td><td style="text-align: left;"> tags (skipjack)
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Arni Magnusson and Mark Maunder.
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/arni-magnusson/fishgrowth">https://github.com/arni-magnusson/fishgrowth</a>
</p>
</li></ul>


<hr>
<h2 id='gcm'>Growth Cessation Model</h2><span id='topic+gcm'></span><span id='topic+gcm_curve'></span><span id='topic+gcm_objfun'></span>

<h3>Description</h3>

<p>Fit a growth cessation model (GCM) to otoliths and/or tags.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gcm(par, data, silent = TRUE, ...)

gcm_curve(t, L0, rmax, k, t50)

gcm_objfun(par, data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gcm_+3A_par">par</code></td>
<td>
<p>a parameter list.</p>
</td></tr>
<tr><td><code id="gcm_+3A_data">data</code></td>
<td>
<p>a data list.</p>
</td></tr>
<tr><td><code id="gcm_+3A_silent">silent</code></td>
<td>
<p>passed to <code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.</p>
</td></tr>
<tr><td><code id="gcm_+3A_...">...</code></td>
<td>
<p>passed to <code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.</p>
</td></tr>
<tr><td><code id="gcm_+3A_t">t</code></td>
<td>
<p>age (vector).</p>
</td></tr>
<tr><td><code id="gcm_+3A_l0">L0</code></td>
<td>
<p>predicted length at age 0.</p>
</td></tr>
<tr><td><code id="gcm_+3A_rmax">rmax</code></td>
<td>
<p>shape parameter that determines the initial slope.</p>
</td></tr>
<tr><td><code id="gcm_+3A_k">k</code></td>
<td>
<p>shape parameter that determines how quickly the growth curve reaches
the asymptotic maximum.</p>
</td></tr>
<tr><td><code id="gcm_+3A_t50">t50</code></td>
<td>
<p>shape parameter that determines the logistic function midpoint.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The main function <code>gcm</code> creates a model object, ready for parameter
estimation. The auxiliary functions <code>gcm_curve</code> and <code>gcm_objfun</code>
are called by the main function to calculate the regression curve and
objective function value. The user can also call the auxiliary functions
directly for plotting and model exploration.
</p>
<p>The <code>par</code> list contains the following elements:
</p>

<ul>
<li> <p><code>L0</code>, predicted length at age 0
</p>
</li>
<li> <p><code>log_rmax</code>, shape parameter that determines the initial slope
</p>
</li>
<li> <p><code>log_k</code>, shape parameter that determines how quickly the growth
curve reaches the asymptotic maximum
</p>
</li>
<li> <p><code>t50</code>, shape parameter that determines the logistic function
midpoint
</p>
</li>
<li> <p><code>log_sigma_min</code>, growth variability at the shortest observed
length in the data
</p>
</li>
<li> <p><code>log_sigma_max</code> (*), growth variability at the longest observed
length in the data
</p>
</li>
<li> <p><code>log_age</code> (*), age at release of tagged individuals (vector)
</p>
</li></ul>

<p>*: The parameter <code>log_sigma_max</code> can be omitted to estimate growth
variability that does not vary with length. The parameter vector
<code>log_age</code> can be omitted to fit to otoliths only.
</p>
<p>The <code>data</code> list contains the following elements:
</p>

<ul>
<li> <p><code>Aoto</code> (*), age from otoliths (vector)
</p>
</li>
<li> <p><code>Loto</code> (*), length from otoliths (vector)
</p>
</li>
<li> <p><code>Lrel</code> (*), length at release of tagged individuals (vector)
</p>
</li>
<li> <p><code>Lrec</code> (*), length at recapture of tagged individuals (vector)
</p>
</li>
<li> <p><code>liberty</code> (*), time at liberty of tagged individuals in years
(vector)
</p>
</li></ul>

<p>*: The data vectors <code>Aoto</code> and <code>Loto</code> can be omitted to fit to
tagging data only. The data vectors <code>Lrel</code>, <code>Lrec</code>, and
<code>liberty</code> can be omitted to fit to otoliths only.
</p>


<h3>Value</h3>

<p>The <code>gcm</code> function returns a TMB model object, produced by
<code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.
</p>
<p>The <code>gcm_curve</code> function returns a numeric vector of predicted length at
age.
</p>
<p>The <code>gcm_objfun</code> function returns the negative log-likelihood as a
single number, describing the goodness of fit of <code>par</code> to the
<code>data</code>.
</p>


<h3>Note</h3>

<p>The growth cessation model (Maunder et al. 2018) predicts length at age as:
</p>
<p style="text-align: center;"><code class="reqn">\hat L_t ~=~ r_{\max}\!\left[\,\frac{\log\left(1+e^{-kt_{50}}
      \right) \;-\;\log\left(1+e^{k(t-t_{50})}\right)}{k}\;+\;t\:\right]</code>
</p>

<p>The variability of length at age increases linearly with length,
</p>
<p style="text-align: center;"><code class="reqn">\sigma_L ~=~ \alpha \,+\, \beta \hat L</code>
</p>

<p>where the slope is <code class="reqn">\beta=(\sigma_{\max}-\sigma_{\min}) /
(L_{\max}-L_{\min})</code>, the
intercept is <code class="reqn">\alpha=\sigma_{\min} - \beta L_{\min}</code>, and <code class="reqn">L_{\min}</code> and <code class="reqn">L_{\max}</code> are the
shortest and longest observed lengths in the data. Alternatively, growth
variability can be modelled as a constant
<code class="reqn">\sigma_L=\sigma_{\min}</code> that does not vary with
length, by omitting <code>log_sigma_max</code> from the parameter list (see above).
</p>
<p>The negative log-likelihood is calculated by comparing the observed and
predicted lengths:
</p>
<pre>
  nll_Loto &lt;- -dnorm(Loto, Loto_hat, sigma_Loto, TRUE)
  nll_Lrel &lt;- -dnorm(Lrel, Lrel_hat, sigma_Lrel, TRUE)
  nll_Lrec &lt;- -dnorm(Lrec, Lrec_hat, sigma_Lrec, TRUE)
  nll &lt;- sum(nll_Loto) + sum(nll_Lrel) + sum(nll_Lrec)
</pre>


<h3>References</h3>

<p>Maunder, M.N., Deriso, R.B., Schaefer, K.M., Fuller, D.W., Aires-da-Silva,
A.M., Minte-Vera, C.V., and Campana, S.E. (2018).
The growth cessation model: a growth model for species showing a near
cessation in growth with application to bigeye tuna (<em>Thunnus obesus</em>).
<em>Marine Biology</em>, <b>165</b>, 76.
<a href="https://doi.org/10.1007/s00227-018-3336-9">doi:10.1007/s00227-018-3336-9</a>.
</p>


<h3>See Also</h3>

<p><code>gcm</code>, <code><a href="#topic+gompertz">gompertz</a></code>, <code><a href="#topic+gompertzo">gompertzo</a></code>,
<code><a href="#topic+richards">richards</a></code>, <code><a href="#topic+richardso">richardso</a></code>, <code><a href="#topic+schnute3">schnute3</a></code>,
<code><a href="#topic+vonbert">vonbert</a></code>, and <code><a href="#topic+vonberto">vonberto</a></code> are alternative growth
models.
</p>
<p><code><a href="#topic+pred_band">pred_band</a></code> calculates a prediction band for a fitted growth
model.
</p>
<p><code><a href="#topic+otoliths_had">otoliths_had</a></code>, <code><a href="#topic+otoliths_skj">otoliths_skj</a></code>, and
<code><a href="#topic+tags_skj">tags_skj</a></code> are example datasets.
</p>
<p><code><a href="#topic+fishgrowth-package">fishgrowth-package</a></code> gives an overview of the package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Model 1: Fit to haddock otoliths

# Explore initial parameter values
plot(len~age, otoliths_had, xlim=c(0,18), ylim=c(0,105), pch=16,
     col="#0080a010")
x &lt;- seq(1, 18, 0.1)
lines(x, gcm_curve(x, L0=5, rmax=20, k=0.15, t50=0), lty=3)

# Prepare parameters and data
init &lt;- list(L0=5, log_rmax=log(20), log_k=log(0.15), t50=-1,
             log_sigma_min=log(3), log_sigma_max=log(3))
dat &lt;- list(Aoto=otoliths_had$age, Loto=otoliths_had$len)
gcm_objfun(init, dat)

# Fit model
model &lt;- gcm(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
report &lt;- model$report()
sdreport &lt;- sdreport(model)

# Plot results
Lhat &lt;- with(report, gcm_curve(x, L0, rmax, k, t50))
lines(x, Lhat, lwd=2, col=2)
legend("bottomright", c("initial curve","model fit"), col=c(1,2), lty=c(3,1),
       lwd=c(1,2), bty="n", inset=0.02, y.intersp=1.25)

# Model summary
report[c("L0", "rmax", "k", "t50", "sigma_min", "sigma_max")]
fit[-1]
summary(sdreport)

# Plot 95% prediction band
band &lt;- pred_band(x, model)
areaplot::confplot(cbind(lower,upper)~age, band, xlim=c(0,18), ylim=c(0,100),
         ylab="len", col="mistyrose")
points(len~age, otoliths_had, xlim=c(0,18), ylim=c(0,100),
       pch=16, col="#0080a010")
lines(x, Lhat, lwd=2, col=2)
lines(lower~age, band, lty=1, lwd=0.5, col=2)
lines(upper~age, band, lty=1, lwd=0.5, col=2)

#############################################################################

# Model 2: Fit to skipjack otoliths and tags

# Explore initial parameter values
plot(len~age, otoliths_skj, xlim=c(0,4), ylim=c(0,100))
x &lt;- seq(0, 4, 0.1)
points(lenRel~I(lenRel/60), tags_skj, col=4)
points(lenRec~I(lenRel/60+liberty), tags_skj, col=3)
lines(x, gcm_curve(x, L0=20, rmax=120, k=2, t50=0), lty=2)
legend("bottomright", c("otoliths","tag releases","tac recaptures",
       "initial curve"), col=c(1,4,3,1), pch=c(1,1,1,NA), lty=c(0,0,0,2),
       lwd=c(1.2,1.2,1.2,1), bty="n", inset=0.02, y.intersp=1.25)

# Prepare parameters and data
init &lt;- list(L0=20, log_rmax=log(120), log_k=log(4), t50=0,
             log_sigma_min=log(3), log_sigma_max=log(3),
             log_age=log(tags_skj$lenRel/60))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len,
            Lrel=tags_skj$lenRel, Lrec=tags_skj$lenRec,
            liberty=tags_skj$liberty)
gcm_objfun(init, dat)

# Fit model
model &lt;- gcm(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
report &lt;- model$report()
sdreport &lt;- sdreport(model)

# Plot results
plot(len~age, otoliths_skj, xlim=c(0,4), ylim=c(0,100))
points(report$age, report$Lrel, col=4)
points(report$age+report$liberty, report$Lrec, col=3)
Lhat &lt;- with(report, gcm_curve(x, L0, rmax, k, t50))
lines(x, Lhat, lwd=2)
legend("bottomright", c("otoliths","tag releases","tac recaptures",
       "model fit"), col=c(1,4,3,1), pch=c(1,1,1,NA), lty=c(0,0,0,1),
       lwd=c(1.2,1.2,1.2,2), bty="n", inset=0.02, y.intersp=1.25)

# Model summary
report[c("L0", "rmax", "k", "t50", "sigma_min", "sigma_max")]
fit[-1]
head(summary(sdreport), 6)

#############################################################################

# Model 3: Stepwise estimation procedure, described by Maunder et al. (2018)
# - estimate L0 and rmax using linear regression on younger fish
# - estimate k and t0 using GCM and all data, keeping L0 and rmax fixed

# Estimate L0 and rmax
plot(otoliths_skj, xlim=c(0,4), ylim=c(0,100))
fm &lt;- lm(len~age, otoliths_skj)
abline(fm)
L0 &lt;- coef(fm)[[1]]
rmax &lt;- coef(fm)[[2]]

# Explore initial parameter values (k, t50, age)
t &lt;- seq(0, 4, by=0.1)
points(t, gcm_curve(t, L0, rmax, k=3, t50=2), col="gray")
points(lenRel~I(lenRel/50), tags_skj, col=4)
points(lenRec~I(lenRel/50+liberty), tags_skj, col=3)
legend("bottomright", c("otoliths","tag releases","tac recaptures",
       "linear regression (otoliths)"), col=c(1,4,3,1), pch=c(1,1,1,NA),
       lty=c(0,0,0,1), lwd=c(1.2,1.2,1.2,2), bty="n", inset=0.02,
       y.intersp=1.25)

# Prepare parameters
init &lt;- list(L0=L0, log_rmax=log(rmax), log_k=log(3), t50=2,
             log_sigma_min=log(3), log_sigma_max=log(3),
             log_age=log(tags_skj$lenRel/50))

# Fit model
map &lt;- list(L0=factor(NA), log_rmax=factor(NA))  # fix L0 and rmax
model &lt;- gcm(init, dat, map=map)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4,iter.max=1e4))
report &lt;- model$report()
sdreport &lt;- sdreport(model)

# Plot results
plot(len~age, otoliths_skj, xlim=c(0,4), ylim=c(0,100))
points(report$age, report$Lrel, col=4)
points(report$age+report$liberty, report$Lrec, col=3)
Lhat &lt;- with(report, gcm_curve(x, L0, rmax, k, t50))
lines(x, Lhat, lwd=2)
legend("bottomright", c("otoliths","tag releases","tac recaptures",
       "model fit"), col=c(1,4,3,1), pch=c(1,1,1,NA), lty=c(0,0,0,1),
       lwd=c(1.2,1.2,1.2,2), bty="n", inset=0.02, y.intersp=1.25)

# Model summary
report[c("L0", "rmax", "k", "t50", "sigma_min", "sigma_max")]
fit[-1]
head(summary(sdreport), 6)

</code></pre>

<hr>
<h2 id='gompertz'>Gompertz Growth Model</h2><span id='topic+gompertz'></span><span id='topic+gompertz_curve'></span><span id='topic+gompertz_objfun'></span>

<h3>Description</h3>

<p>Fit a Gompertz growth model to otoliths and/or tags, using the Schnute
parametrization.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gompertz(par, data, silent = TRUE, ...)

gompertz_curve(t, L1, L2, k, t1, t2)

gompertz_objfun(par, data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gompertz_+3A_par">par</code></td>
<td>
<p>a parameter list.</p>
</td></tr>
<tr><td><code id="gompertz_+3A_data">data</code></td>
<td>
<p>a data list.</p>
</td></tr>
<tr><td><code id="gompertz_+3A_silent">silent</code></td>
<td>
<p>passed to <code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.</p>
</td></tr>
<tr><td><code id="gompertz_+3A_...">...</code></td>
<td>
<p>passed to <code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.</p>
</td></tr>
<tr><td><code id="gompertz_+3A_t">t</code></td>
<td>
<p>age (vector).</p>
</td></tr>
<tr><td><code id="gompertz_+3A_l1">L1</code></td>
<td>
<p>predicted length at age <code>t1</code>.</p>
</td></tr>
<tr><td><code id="gompertz_+3A_l2">L2</code></td>
<td>
<p>predicted length at age <code>t2</code>.</p>
</td></tr>
<tr><td><code id="gompertz_+3A_k">k</code></td>
<td>
<p>growth coefficient.</p>
</td></tr>
<tr><td><code id="gompertz_+3A_t1">t1</code></td>
<td>
<p>age where predicted length is <code>L1</code>.</p>
</td></tr>
<tr><td><code id="gompertz_+3A_t2">t2</code></td>
<td>
<p>age where predicted length is <code>L2</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The main function <code>gompertz</code> creates a model object, ready for parameter
estimation. The auxiliary functions <code>gompertz_curve</code> and
<code>gompertz_objfun</code> are called by the main function to calculate the
regression curve and objective function value. The user can also call the
auxiliary functions directly for plotting and model exploration.
</p>
<p>The <code>par</code> list contains the following elements:
</p>

<ul>
<li> <p><code>log_L1</code>, predicted length at age <code>t1</code>
</p>
</li>
<li> <p><code>log_L2</code>, predicted length at age <code>t2</code>
</p>
</li>
<li> <p><code>log_k</code>, growth coefficient
</p>
</li>
<li> <p><code>log_sigma_min</code>, growth variability at the shortest observed
length in the data
</p>
</li>
<li> <p><code>log_sigma_max</code> (*), growth variability at the longest observed
length in the data
</p>
</li>
<li> <p><code>log_age</code> (*), age at release of tagged individuals (vector)
</p>
</li></ul>

<p>*: The parameter <code>log_sigma_max</code> can be omitted to estimate growth
variability that does not vary with length. The parameter vector
<code>log_age</code> can be omitted to fit to otoliths only.
</p>
<p>The <code>data</code> list contains the following elements:
</p>

<ul>
<li> <p><code>Aoto</code> (*), age from otoliths (vector)
</p>
</li>
<li> <p><code>Loto</code> (*), length from otoliths (vector)
</p>
</li>
<li> <p><code>Lrel</code> (*), length at release of tagged individuals (vector)
</p>
</li>
<li> <p><code>Lrec</code> (*), length at recapture of tagged individuals (vector)
</p>
</li>
<li> <p><code>liberty</code> (*), time at liberty of tagged individuals in years
(vector)
</p>
</li>
<li> <p><code>t1</code>, age where predicted length is <code>L1</code>
</p>
</li>
<li> <p><code>t2</code>, age where predicted length is <code>L2</code>
</p>
</li></ul>

<p>*: The data vectors <code>Aoto</code> and <code>Loto</code> can be omitted to fit to
tagging data only. The data vectors <code>Lrel</code>, <code>Lrec</code>, and
<code>liberty</code> can be omitted to fit to otoliths only.
</p>


<h3>Value</h3>

<p>The <code>gompertz</code> function returns a TMB model object, produced by
<code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.
</p>
<p>The <code>gompertz_curve</code> function returns a numeric vector of predicted
length at age.
</p>
<p>The <code>gompertz_objfun</code> function returns the negative log-likelihood as a
single number, describing the goodness of fit of <code>par</code> to the
<code>data</code>.
</p>


<h3>Note</h3>

<p>The Schnute parametrization used in <code>gompertz</code> reduces parameter
correlation and improves convergence reliability compared to the traditional
parametrization used in <code><a href="#topic+gompertzo">gompertzo</a></code>. Therefore, the
<code>gompertz</code> parametrization can be recommended for general usage, as both
parametrizations produce the same growth curve. However, there can be some
use cases where the traditional parametrization (<code>Linf</code>, <code>k</code>,
<code>tau</code>) is preferred over the Schnute parametrization (<code>L1</code>,
<code>L2</code>, <code>k</code>).
</p>
<p>Gompertz is a special case of the Richards (1959) model, where <code class="reqn">b=0</code>. If
the best model fit of a <code><a href="#topic+richards">richards</a></code> model to a particular dataset
involves a very small estimated value of <code class="reqn">b</code>, then the <code>gompertz</code>
model offers a preferable parametrization, as it produces the same curve
using fewer parameters.
</p>
<p>The Gompertz (1825) growth model, as parametrized by Schnute (1981, Eq. 16)
predicts length at age as:
</p>
<p style="text-align: center;"><code class="reqn">L ~=~ L_1\exp\!\left[\,\log(L_2/L_1)\,
      \frac{1-e^{-k(t-t_1)}}{1-e^{-k(t_2-t_1)}}\,\right]</code>
</p>

<p>The variability of length at age increases linearly with length,
</p>
<p style="text-align: center;"><code class="reqn">\sigma_L ~=~ \alpha \,+\, \beta \hat L</code>
</p>

<p>where the slope is <code class="reqn">\beta=(\sigma_{\max}-\sigma_{\min}) /
(L_{\max}-L_{\min})</code>, the
intercept is <code class="reqn">\alpha=\sigma_{\min} - \beta L_{\min}</code>, and <code class="reqn">L_{\min}</code> and <code class="reqn">L_{\max}</code> are the
shortest and longest observed lengths in the data. Alternatively, growth
variability can be modelled as a constant
<code class="reqn">\sigma_L=\sigma_{\min}</code> that does not vary with
length, by omitting <code>log_sigma_max</code> from the parameter list (see above).
</p>
<p>The negative log-likelihood is calculated by comparing the observed and
predicted lengths:
</p>
<pre>
  nll_Loto &lt;- -dnorm(Loto, Loto_hat, sigma_Loto, TRUE)
  nll_Lrel &lt;- -dnorm(Lrel, Lrel_hat, sigma_Lrel, TRUE)
  nll_Lrec &lt;- -dnorm(Lrec, Lrec_hat, sigma_Lrec, TRUE)
  nll &lt;- sum(nll_Loto) + sum(nll_Lrel) + sum(nll_Lrec)
</pre>


<h3>References</h3>

<p>Gompertz, B. (1825).
On the nature of the function expressive of the law of human mortality, and
on a new mode of determining the value of life contingencies.
<em>Philosophical Transactions of the Royal Society</em>, <b>115</b>, 513-583.
</p>
<p>Schnute, J. (1981).
A versatile growth model with statistically stable parameters.
<em>Canadian Journal of Fisheries and Aquatic Science</em>, <b>38</b>,
1128-1140.
<a href="https://doi.org/10.1139/f81-153">doi:10.1139/f81-153</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gcm">gcm</a></code>, <code>gompertz</code>, <code><a href="#topic+gompertzo">gompertzo</a></code>,
<code><a href="#topic+richards">richards</a></code>, <code><a href="#topic+richards">richards</a></code>, <code><a href="#topic+schnute3">schnute3</a></code>,
<code><a href="#topic+vonbert">vonbert</a></code>, and <code><a href="#topic+vonberto">vonberto</a></code> are alternative growth
models.
</p>
<p><code><a href="#topic+pred_band">pred_band</a></code> calculates a prediction band for a fitted growth
model.
</p>
<p><code><a href="#topic+otoliths_had">otoliths_had</a></code>, <code><a href="#topic+otoliths_skj">otoliths_skj</a></code>, and
<code><a href="#topic+tags_skj">tags_skj</a></code> are example datasets.
</p>
<p><code><a href="#topic+fishgrowth-package">fishgrowth-package</a></code> gives an overview of the package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Model 1: Fit to haddock otoliths

# Explore initial parameter values
plot(len~age, otoliths_had, xlim=c(0,18), ylim=c(0,105), pch=16,
     col="#0080a010")
x &lt;- seq(1, 18, 0.1)
lines(x, gompertz_curve(x, L1=15, L2=70, k=0.4, t1=1, t2=10), lty=3)

# Prepare parameters and data
init &lt;- list(log_L1=log(20), log_L2=log(70), log_k=log(0.1),
             log_sigma_min=log(3), log_sigma_max=log(3))
dat &lt;- list(Aoto=otoliths_had$age, Loto=otoliths_had$len, t1=1, t2=10)
gompertz_objfun(init, dat)

# Fit model
model &lt;- gompertz(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
report &lt;- model$report()
sdreport &lt;- sdreport(model)

# Plot results
Lhat &lt;- with(report, gompertz_curve(x, L1, L2, k, t1, t2))
lines(x, Lhat, lwd=2, col=2)
legend("bottomright", c("initial curve","model fit"), col=c(1,2), lty=c(3,1),
       lwd=c(1,2), bty="n", inset=0.02, y.intersp=1.25)

# Model summary
report[c("L1", "L2", "k", "sigma_min", "sigma_max")]
fit[-1]
summary(sdreport)

# Plot 95% prediction band
band &lt;- pred_band(x, model)
areaplot::confplot(cbind(lower,upper)~age, band, xlim=c(0,18), ylim=c(0,100),
         ylab="len", col="mistyrose")
points(len~age, otoliths_had, xlim=c(0,18), ylim=c(0,100),
       pch=16, col="#0080a010")
lines(x, Lhat, lwd=2, col=2)
lines(lower~age, band, lty=1, lwd=0.5, col=2)
lines(upper~age, band, lty=1, lwd=0.5, col=2)

#############################################################################

# Model 2: Fit to skipjack otoliths and tags

# Explore initial parameter values
plot(len~age, otoliths_skj, xlim=c(0,4), ylim=c(0,100))
x &lt;- seq(0, 4, 0.1)
points(lenRel~I(lenRel/60), tags_skj, col=4)
points(lenRec~I(lenRel/60+liberty), tags_skj, col=3)
lines(x, gompertz_curve(x, L1=28, L2=74, k=1, t1=0, t2=4), lty=2)
legend("bottomright", c("otoliths","tag releases","tac recaptures",
       "initial curve"), col=c(1,4,3,1), pch=c(1,1,1,NA), lty=c(0,0,0,2),
       lwd=c(1.2,1.2,1.2,1), bty="n", inset=0.02, y.intersp=1.25)

# Prepare parameters and data
init &lt;- list(log_L1=log(28), log_L2=log(74), log_k=log(1),
             log_sigma_min=log(3), log_sigma_max=log(3),
             log_age=log(tags_skj$lenRel/60))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len,
            Lrel=tags_skj$lenRel, Lrec=tags_skj$lenRec,
            liberty=tags_skj$liberty, t1=0, t2=4)
gompertz_objfun(init, dat)

# Fit model
model &lt;- gompertz(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
report &lt;- model$report()
sdreport &lt;- sdreport(model)

# Plot results
plot(len~age, otoliths_skj, xlim=c(0,4), ylim=c(0,100))
points(report$age, report$Lrel, col=4)
points(report$age+report$liberty, report$Lrec, col=3)
Lhat &lt;- with(report, gompertz_curve(x, L1, L2, k, t1, t2))
lines(x, Lhat, lwd=2)
legend("bottomright", c("otoliths","tag releases","tac recaptures",
       "model fit"), col=c(1,4,3,1), pch=c(1,1,1,NA), lty=c(0,0,0,1),
       lwd=c(1.2,1.2,1.2,2), bty="n", inset=0.02, y.intersp=1.25)

# Model summary
report[c("L1", "L2", "k", "sigma_min", "sigma_max")]
fit[-1]
head(summary(sdreport), 5)

#############################################################################

# Model 3: Fit to skipjack otoliths only

init &lt;- list(log_L1=log(28), log_L2=log(74), log_k=log(1),
             log_sigma_min=log(3), log_sigma_max=log(3))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len, t1=0, t2=4)
model &lt;- gompertz(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("L1", "L2", "k", "sigma_min", "sigma_max")]

#############################################################################

# Model 4: Fit to skipjack otoliths only,
# but now estimating constant sigma instead of sigma varying by length

# We do this by omitting log_sigma_max
init &lt;- list(log_L1=log(28), log_L2=log(74), log_k=log(1),
             log_sigma_min=log(3))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len, t1=0, t2=4)
model &lt;- gompertz(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
                    control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("L1", "L2", "k", "sigma_min")]

#############################################################################

# Model 5: Fit to skipjack tags only

init &lt;- list(log_L1=log(28), log_L2=log(74), log_k=log(1),
             log_sigma_min=log(3), log_sigma_max=log(3),
             log_age=log(tags_skj$lenRel/60))
dat &lt;- list(Lrel=tags_skj$lenRel, Lrec=tags_skj$lenRec,
            liberty=tags_skj$liberty, t1=0, t2=4)
model &lt;- gompertz(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
                   control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("L1", "L2", "k", "sigma_min", "sigma_max")]

</code></pre>

<hr>
<h2 id='gompertzo'>Gompertz Growth Model (Old Style)</h2><span id='topic+gompertzo'></span><span id='topic+gompertzo_curve'></span><span id='topic+gompertzo_objfun'></span>

<h3>Description</h3>

<p>Fit a Gompertz growth model to otoliths and/or tags, using a traditional
parametrization.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gompertzo(par, data, silent = TRUE, ...)

gompertzo_curve(t, Linf, k, tau)

gompertzo_objfun(par, data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gompertzo_+3A_par">par</code></td>
<td>
<p>a parameter list.</p>
</td></tr>
<tr><td><code id="gompertzo_+3A_data">data</code></td>
<td>
<p>a data list.</p>
</td></tr>
<tr><td><code id="gompertzo_+3A_silent">silent</code></td>
<td>
<p>passed to <code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.</p>
</td></tr>
<tr><td><code id="gompertzo_+3A_...">...</code></td>
<td>
<p>passed to <code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.</p>
</td></tr>
<tr><td><code id="gompertzo_+3A_t">t</code></td>
<td>
<p>age (vector).</p>
</td></tr>
<tr><td><code id="gompertzo_+3A_linf">Linf</code></td>
<td>
<p>asymptotic maximum length.</p>
</td></tr>
<tr><td><code id="gompertzo_+3A_k">k</code></td>
<td>
<p>growth coefficient.</p>
</td></tr>
<tr><td><code id="gompertzo_+3A_tau">tau</code></td>
<td>
<p>location parameter.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The main function <code>gompertzo</code> creates a model object, ready for
parameter estimation. The auxiliary functions <code>gompertzo_curve</code> and
<code>gompertzo_objfun</code> are called by the main function to calculate the
regression curve and objective function value. The user can also call the
auxiliary functions directly for plotting and model exploration.
</p>
<p>The <code>par</code> list contains the following elements:
</p>

<ul>
<li> <p><code>log_Linf</code>, asymptotic maximum length
</p>
</li>
<li> <p><code>log_k</code>, growth coefficient
</p>
</li>
<li> <p><code>tau</code>, location parameter
</p>
</li>
<li> <p><code>log_sigma_min</code>, growth variability at the shortest observed
length in the data
</p>
</li>
<li> <p><code>log_sigma_max</code> (*), growth variability at the longest observed
length in the data
</p>
</li>
<li> <p><code>log_age</code> (*), age at release of tagged individuals (vector)
</p>
</li></ul>

<p>*: The parameter <code>log_sigma_max</code> can be omitted to estimate growth
variability that does not vary with length. The parameter vector
<code>log_age</code> can be omitted to fit to otoliths only.
</p>
<p>The <code>data</code> list contains the following elements:
</p>

<ul>
<li> <p><code>Aoto</code> (*), age from otoliths (vector)
</p>
</li>
<li> <p><code>Loto</code> (*), length from otoliths (vector)
</p>
</li>
<li> <p><code>Lrel</code> (*), length at release of tagged individuals (vector)
</p>
</li>
<li> <p><code>Lrec</code> (*), length at recapture of tagged individuals (vector)
</p>
</li>
<li> <p><code>liberty</code> (*), time at liberty of tagged individuals in years
(vector)
</p>
</li></ul>

<p>*: The data vectors <code>Aoto</code> and <code>Loto</code> can be omitted to fit to
tagging data only. The data vectors <code>Lrel</code>, <code>Lrec</code>, and
<code>liberty</code> can be omitted to fit to otoliths only.
</p>


<h3>Value</h3>

<p>The <code>gompertzo</code> function returns a TMB model object, produced by
<code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.
</p>
<p>The <code>gompertzo_curve</code> function returns a numeric vector of predicted
length at age.
</p>
<p>The <code>gompertzo_objfun</code> function returns the negative log-likelihood as a
single number, describing the goodness of fit of <code>par</code> to the
<code>data</code>.
</p>


<h3>Note</h3>

<p>The Schnute parametrization used in <code><a href="#topic+gompertz">gompertz</a></code> reduces parameter
correlation and improves convergence reliability compared to the traditional
parametrization used in <code>gompertzo</code>. Therefore, the <code>gompertz</code>
parametrization can be recommended for general usage, as both
parametrizations produce the same growth curve. However, there can be some
use cases where the traditional parametrization (<code>Linf</code>, <code>k</code>,
<code>tau</code>) is preferred over the Schnute parametrization (<code>L1</code>,
<code>L2</code>, <code>k</code>).
</p>
<p>Gompertz is a special case of the Richards (1959) model, where <code class="reqn">b=0</code>. If
the best model fit of a <code><a href="#topic+richards">richards</a></code> model to a particular dataset
involves a very small estimated value of <code class="reqn">b</code>, then the <code>gompertz</code>
model offers a preferable parametrization, as it produces the same curve
using fewer parameters.
</p>
<p>The Gompertz (1825) growth model, as parametrized by Ricker (1979, Eq. 23)
predicts length at age as:
</p>
<p style="text-align: center;"><code class="reqn">L ~=~ L_\infty\exp\!\big(\!\!-\!e^{-k(t-\tau)}\big)</code>
</p>

<p>The variability of length at age increases linearly with length,
</p>
<p style="text-align: center;"><code class="reqn">\sigma_L ~=~ \alpha \,+\, \beta \hat L</code>
</p>

<p>where the slope is <code class="reqn">\beta=(\sigma_{\max}-\sigma_{\min}) /
(L_{\max}-L_{\min})</code>, the
intercept is <code class="reqn">\alpha=\sigma_{\min} - \beta L_{\min}</code>, and <code class="reqn">L_{\min}</code> and <code class="reqn">L_{\max}</code> are the
shortest and longest observed lengths in the data. Alternatively, growth
variability can be modelled as a constant
<code class="reqn">\sigma_L=\sigma_{\min}</code> that does not vary with
length, by omitting <code>log_sigma_max</code> from the parameter list (see above).
</p>
<p>The negative log-likelihood is calculated by comparing the observed and
predicted lengths:
</p>
<pre>
  nll_Loto &lt;- -dnorm(Loto, Loto_hat, sigma_Loto, TRUE)
  nll_Lrel &lt;- -dnorm(Lrel, Lrel_hat, sigma_Lrel, TRUE)
  nll_Lrec &lt;- -dnorm(Lrec, Lrec_hat, sigma_Lrec, TRUE)
  nll &lt;- sum(nll_Loto) + sum(nll_Lrel) + sum(nll_Lrec)
</pre>


<h3>References</h3>

<p>Gompertz, B. (1825).
On the nature of the function expressive of the law of human mortality, and
on a new mode of determining the value of life contingencies.
<em>Philosophical Transactions of the Royal Society</em>, <b>115</b>, 513-583.
</p>
<p>Ricker, W.E. (1979).
Growth rates and models.
In: W.S. Hoar et al. (eds.) <em>Fish physiology 8: Bioenergetics and
growth</em>. New York: Academic Press, pp. 677-743.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gcm">gcm</a></code>, <code><a href="#topic+gompertz">gompertz</a></code>, <code>gompertzo</code>,
<code><a href="#topic+richards">richards</a></code>, <code><a href="#topic+richards">richards</a></code>, <code><a href="#topic+schnute3">schnute3</a></code>,
<code><a href="#topic+vonbert">vonbert</a></code>, and <code><a href="#topic+vonberto">vonberto</a></code> are alternative growth
models.
</p>
<p><code><a href="#topic+pred_band">pred_band</a></code> calculates a prediction band for a fitted growth
model.
</p>
<p><code><a href="#topic+otoliths_had">otoliths_had</a></code>, <code><a href="#topic+otoliths_skj">otoliths_skj</a></code>, and
<code><a href="#topic+tags_skj">tags_skj</a></code> are example datasets.
</p>
<p><code><a href="#topic+fishgrowth-package">fishgrowth-package</a></code> gives an overview of the package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Model 1: Fit to haddock otoliths

# Explore initial parameter values
plot(len~age, otoliths_had, xlim=c(0,18), ylim=c(0,105), pch=16,
     col="#0080a010")
x &lt;- seq(1, 18, 0.1)
lines(x, gompertzo_curve(x, Linf=73, k=0.4, tau=2), lty=3)

# Prepare parameters and data
init &lt;- list(log_Linf=log(73), log_k=log(0.4), tau=2,
             log_sigma_min=log(3), log_sigma_max=log(3))
dat &lt;- list(Aoto=otoliths_had$age, Loto=otoliths_had$len)
gompertzo_objfun(init, dat)

# Fit model
model &lt;- gompertzo(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
report &lt;- model$report()
sdreport &lt;- sdreport(model)

# Plot results
Lhat &lt;- with(report, gompertzo_curve(x, Linf, k, tau))
lines(x, Lhat, lwd=2, col=2)
legend("bottomright", c("initial curve","model fit"), col=c(1,2), lty=c(3,1),
       lwd=c(1,2), bty="n", inset=0.02, y.intersp=1.25)

# Model summary
report[c("Linf", "k", "tau", "sigma_min", "sigma_max")]
fit[-1]
summary(sdreport)

# Plot 95% prediction band
band &lt;- pred_band(x, model)
areaplot::confplot(cbind(lower,upper)~age, band, xlim=c(0,18), ylim=c(0,100),
         ylab="len", col="mistyrose")
points(len~age, otoliths_had, xlim=c(0,18), ylim=c(0,100),
       pch=16, col="#0080a010")
lines(x, Lhat, lwd=2, col=2)
lines(lower~age, band, lty=1, lwd=0.5, col=2)
lines(upper~age, band, lty=1, lwd=0.5, col=2)

#############################################################################

# Model 2: Fit to skipjack otoliths and tags

# Explore initial parameter values
plot(len~age, otoliths_skj, xlim=c(0,4), ylim=c(0,100))
x &lt;- seq(0, 4, 0.1)
points(lenRel~I(lenRel/60), tags_skj, col=4)
points(lenRec~I(lenRel/60+liberty), tags_skj, col=3)
lines(x, gompertzo_curve(x, Linf=75, k=1, tau=0), lty=2)
legend("bottomright", c("otoliths","tag releases","tac recaptures",
       "initial curve"), col=c(1,4,3,1), pch=c(1,1,1,NA), lty=c(0,0,0,2),
       lwd=c(1.2,1.2,1.2,1), bty="n", inset=0.02, y.intersp=1.25)

# Prepare parameters and data
init &lt;- list(log_Linf=log(75), log_k=log(1), tau=0,
             log_sigma_min=log(3), log_sigma_max=log(3),
             log_age=log(tags_skj$lenRel/60))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len,
            Lrel=tags_skj$lenRel, Lrec=tags_skj$lenRec,
            liberty=tags_skj$liberty)
gompertzo_objfun(init, dat)

# Fit model
model &lt;- gompertzo(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
report &lt;- model$report()
sdreport &lt;- sdreport(model)

# Plot results
plot(len~age, otoliths_skj, xlim=c(0,4), ylim=c(0,100))
points(report$age, report$Lrel, col=4)
points(report$age+report$liberty, report$Lrec, col=3)
Lhat &lt;- with(report, gompertzo_curve(x, Linf, k, tau))
lines(x, Lhat, lwd=2)
legend("bottomright", c("otoliths","tag releases","tac recaptures",
       "model fit"), col=c(1,4,3,1), pch=c(1,1,1,NA), lty=c(0,0,0,1),
       lwd=c(1.2,1.2,1.2,2), bty="n", inset=0.02, y.intersp=1.25)

# Model summary
report[c("Linf", "k", "tau", "sigma_min", "sigma_max")]
fit[-1]
head(summary(sdreport), 5)

#############################################################################

# Model 3: Fit to skipjack otoliths only

init &lt;- list(log_Linf=log(75), log_k=log(1), tau=0,
             log_sigma_min=log(3), log_sigma_max=log(3))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len)
model &lt;- gompertzo(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
                  control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("Linf", "k", "tau", "sigma_min", "sigma_max")]

#############################################################################

# Model 4: Fit to skipjack otoliths only,
# but now estimating constant sigma instead of sigma varying by length

# We do this by omitting log_sigma_max
init &lt;- list(log_Linf=log(75), log_k=log(1), tau=0,
             log_sigma_min=log(3))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len)
model &lt;- gompertzo(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("Linf", "k", "tau", "sigma_min")]

#############################################################################

# Model 5: Fit to skipjack tags only

init &lt;- list(log_Linf=log(75), log_k=log(1), tau=0,
             log_sigma_min=log(3), log_sigma_max=log(3),
             log_age=log(tags_skj$lenRel/60))
dat &lt;- list(Lrel=tags_skj$lenRel, Lrec=tags_skj$lenRec,
            liberty=tags_skj$liberty)
model &lt;- gompertzo(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("Linf", "k", "tau", "sigma_min", "sigma_max")]

</code></pre>

<hr>
<h2 id='otoliths_had'>Otolith Data (Haddock)</h2><span id='topic+otoliths_had'></span>

<h3>Description</h3>

<p>Otolith data for Icelandic haddock from the Icelandic spring bottom trawl
survey 2011-2020.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>otoliths_had
</code></pre>


<h3>Format</h3>

<p>Data frame containing two columns:
</p>

<table>
<tr>
 <td style="text-align: left;">
  <code>age</code> </td><td style="text-align: left;"> age (years)</td>
</tr>
<tr>
 <td style="text-align: left;">
  <code>len</code> </td><td style="text-align: left;"> length (cm)
</td>
</tr>

</table>



<h3>Note</h3>

<p>The data were contributed by the Icelandic Marine and Freshwater Research
Institute. The otoliths were collected following the sampling protocol
described in the survey manual (Sólmundsson et al. 2020).
</p>


<h3>Source</h3>

<p>Sólmundsson, J., Karlsson, H., Björnsson, H., Jónsdóttir, I.G., Jakobsdóttir,
K.B., and Bogason, V. (2020).
<em>A manual for the Icelandic groundfish survey in spring 2020</em>.
Marine and Freshwater Research in Iceland HV 2020-08.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gcm">gcm</a></code>, <code><a href="#topic+gompertz">gompertz</a></code>, <code><a href="#topic+gompertzo">gompertzo</a></code>,
<code><a href="#topic+richards">richards</a></code>, <code><a href="#topic+richardso">richardso</a></code>, <code><a href="#topic+schnute3">schnute3</a></code>,
<code><a href="#topic+vonbert">vonbert</a></code>, and <code><a href="#topic+vonberto">vonberto</a></code> are alternative growth
models.
</p>
<p><code>otoliths_had</code>, <code><a href="#topic+otoliths_skj">otoliths_skj</a></code>, and <code><a href="#topic+tags_skj">tags_skj</a></code>
are example datasets.
</p>
<p><code><a href="#topic+fishgrowth-package">fishgrowth-package</a></code> gives an overview of the package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>head(otoliths_had)
</code></pre>

<hr>
<h2 id='otoliths_skj'>Otolith Data (Skipjack)</h2><span id='topic+otoliths_skj'></span>

<h3>Description</h3>

<p>Simulated otolith data, loosely based on a skipjack tuna dataset analyzed by
Macdonald et al. (2022).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>otoliths_skj
</code></pre>


<h3>Format</h3>

<p>Data frame containing two columns:
</p>

<table>
<tr>
 <td style="text-align: left;">
  <code>age</code> </td><td style="text-align: left;"> age (years)</td>
</tr>
<tr>
 <td style="text-align: left;">
  <code>len</code> </td><td style="text-align: left;"> length (cm)
</td>
</tr>

</table>



<h3>Details</h3>

<p>The simulation code that was used to produce this dataset is included in the
package:
</p>
<pre>file.show(system.file(package="fishgrowth", "sim/simulate.R"))</pre>


<h3>Source</h3>

<p>Macdonald, J., Day, J., Magnusson, A., Maunder, M., Aoki, Y., Matsubara, N.,
Tsuda, Y., McKechnie, S., Teears, T., Leroy, B., Castillo-Jordán, C.,
Hampton, J., and Hamer, P. (2022).
<em>Review and new analyses of skipjack growth in the Western and Central
Pacific Ocean</em>.
Western and Central Pacific Fisheries Commission Report
WCPFC-SC18-2022/SA-IP-06.
<a href="https://meetings.wcpfc.int/node/16254">https://meetings.wcpfc.int/node/16254</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gcm">gcm</a></code>, <code><a href="#topic+gompertz">gompertz</a></code>, <code><a href="#topic+gompertzo">gompertzo</a></code>,
<code><a href="#topic+richards">richards</a></code>, <code><a href="#topic+richardso">richardso</a></code>, <code><a href="#topic+schnute3">schnute3</a></code>,
<code><a href="#topic+vonbert">vonbert</a></code>, and <code><a href="#topic+vonberto">vonberto</a></code> are alternative growth
models.
</p>
<p><code><a href="#topic+otoliths_had">otoliths_had</a></code>, <code>otoliths_skj</code>, and <code><a href="#topic+tags_skj">tags_skj</a></code>
are example datasets.
</p>
<p><code><a href="#topic+fishgrowth-package">fishgrowth-package</a></code> gives an overview of the package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>otoliths_skj
</code></pre>

<hr>
<h2 id='pred_band'>Prediction Band</h2><span id='topic+pred_band'></span>

<h3>Description</h3>

<p>Calculate a prediction band for a fitted growth curve.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pred_band(age, model, level = 0.95)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pred_band_+3A_age">age</code></td>
<td>
<p>a vector of ages to calculate the prediction band.</p>
</td></tr>
<tr><td><code id="pred_band_+3A_model">model</code></td>
<td>
<p>a fitted growth model.</p>
</td></tr>
<tr><td><code id="pred_band_+3A_level">level</code></td>
<td>
<p>significance level.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame containing five columns:
</p>
<table role = "presentation">
<tr><td><code>age</code></td>
<td>
<p>age</p>
</td></tr>
<tr><td><code>Lhat</code></td>
<td>
<p>predicted length</p>
</td></tr>
<tr><td><code>sigma</code></td>
<td>
<p>growth variability</p>
</td></tr>
<tr><td><code>lower</code></td>
<td>
<p>lower limit of prediction band</p>
</td></tr>
<tr><td><code>upper</code></td>
<td>
<p>upper limit of prediction band</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The variability of length at age (<code>sigma</code>) increases linearly with
length:
</p>
<p style="text-align: center;"><code class="reqn">\sigma_L ~=~ \alpha \,+\, \beta \hat L</code>
</p>

<p>This calculation of <code>sigma</code> is demonstrated in the example below.
</p>
<p>The <code>lower</code> and <code>upper</code> limits of the prediction band are
calculated as <code class="reqn">\hat L \pm 1.96\sigma_L</code> at the
95% significance level.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gcm">gcm</a></code>, <code><a href="#topic+gompertz">gompertz</a></code>, <code><a href="#topic+gompertzo">gompertzo</a></code>,
<code><a href="#topic+richards">richards</a></code>, <code><a href="#topic+richardso">richardso</a></code>, <code><a href="#topic+schnute3">schnute3</a></code>,
<code><a href="#topic+vonbert">vonbert</a></code>, and <code><a href="#topic+vonberto">vonberto</a></code> are alternative growth
models.
</p>
<p><code><a href="#topic+fishgrowth-package">fishgrowth-package</a></code> gives an overview of the package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Fit a model
init &lt;- list(log_L1=log(20), log_L2=log(70), log_k=log(0.1),
             log_sigma_min=log(3), log_sigma_max=log(3))
dat &lt;- list(Aoto=otoliths_had$age, Loto=otoliths_had$len, t1=1, t2=10)
model &lt;- vonbert(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))

# Calculate 95% prediction band
x &lt;- seq(1, 18, 0.5)
band &lt;- pred_band(x, model)

# Plot 95% prediction band
areaplot::confplot(cbind(lower,upper)~age, band, xlim=c(0,18), ylim=c(0,100),
         ylab="len", col="mistyrose")
points(len~age, otoliths_had, xlim=c(0,18), ylim=c(0,100),
       pch=16, col="#0080a010")
lines(Lhat~age, band, lwd=2, col=2)
lines(lower~age, band, lty=1, lwd=0.5, col=2)
lines(upper~age, band, lty=1, lwd=0.5, col=2)

# Calculate sigma by hand
report &lt;- model$report()
alpha &lt;- report$sigma_intercept
beta &lt;- report$sigma_slope
Lhat &lt;- band$Lhat
alpha + beta * Lhat  # same values as band$sigma calculated by pred_band()

</code></pre>

<hr>
<h2 id='richards'>Richards Growth Model</h2><span id='topic+richards'></span><span id='topic+richards_curve'></span><span id='topic+richards_objfun'></span>

<h3>Description</h3>

<p>Fit a Richards growth model to otoliths and/or tags, using the Schnute
parametrization.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>richards(par, data, silent = TRUE, ...)

richards_curve(t, L1, L2, k, b, t1, t2)

richards_objfun(par, data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="richards_+3A_par">par</code></td>
<td>
<p>a parameter list.</p>
</td></tr>
<tr><td><code id="richards_+3A_data">data</code></td>
<td>
<p>a data list.</p>
</td></tr>
<tr><td><code id="richards_+3A_silent">silent</code></td>
<td>
<p>passed to <code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.</p>
</td></tr>
<tr><td><code id="richards_+3A_...">...</code></td>
<td>
<p>passed to <code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.</p>
</td></tr>
<tr><td><code id="richards_+3A_t">t</code></td>
<td>
<p>age (vector).</p>
</td></tr>
<tr><td><code id="richards_+3A_l1">L1</code></td>
<td>
<p>predicted length at age <code>t1</code>.</p>
</td></tr>
<tr><td><code id="richards_+3A_l2">L2</code></td>
<td>
<p>predicted length at age <code>t2</code>.</p>
</td></tr>
<tr><td><code id="richards_+3A_k">k</code></td>
<td>
<p>growth coefficient.</p>
</td></tr>
<tr><td><code id="richards_+3A_b">b</code></td>
<td>
<p>shape parameter.</p>
</td></tr>
<tr><td><code id="richards_+3A_t1">t1</code></td>
<td>
<p>age where predicted length is <code>L1</code>.</p>
</td></tr>
<tr><td><code id="richards_+3A_t2">t2</code></td>
<td>
<p>age where predicted length is <code>L2</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The main function <code>richards</code> creates a model object, ready for parameter
estimation. The auxiliary functions <code>richards_curve</code> and
<code>richards_objfun</code> are called by the main function to calculate the
regression curve and objective function value. The user can also call the
auxiliary functions directly for plotting and model exploration.
</p>
<p>The <code>par</code> list contains the following elements:
</p>

<ul>
<li> <p><code>log_L1</code>, predicted length at age <code>t1</code>
</p>
</li>
<li> <p><code>log_L2</code>, predicted length at age <code>t2</code>
</p>
</li>
<li> <p><code>log_k</code>, growth coefficient
</p>
</li>
<li> <p><code>b</code>, shape parameter
</p>
</li>
<li> <p><code>log_sigma_min</code>, growth variability at the shortest observed
length in the data
</p>
</li>
<li> <p><code>log_sigma_max</code> (*), growth variability at the longest observed
length in the data
</p>
</li>
<li> <p><code>log_age</code> (*), age at release of tagged individuals (vector)
</p>
</li></ul>

<p>*: The parameter <code>log_sigma_max</code> can be omitted to estimate growth
variability that does not vary with length. The parameter vector
<code>log_age</code> can be omitted to fit to otoliths only.
</p>
<p>The <code>data</code> list contains the following elements:
</p>

<ul>
<li> <p><code>Aoto</code> (*), age from otoliths (vector)
</p>
</li>
<li> <p><code>Loto</code> (*), length from otoliths (vector)
</p>
</li>
<li> <p><code>Lrel</code> (*), length at release of tagged individuals (vector)
</p>
</li>
<li> <p><code>Lrec</code> (*), length at recapture of tagged individuals (vector)
</p>
</li>
<li> <p><code>liberty</code> (*), time at liberty of tagged individuals in years
(vector)
</p>
</li>
<li> <p><code>t1</code>, age where predicted length is <code>L1</code>
</p>
</li>
<li> <p><code>t2</code>, age where predicted length is <code>L2</code>
</p>
</li></ul>

<p>*: The data vectors <code>Aoto</code> and <code>Loto</code> can be omitted to fit to
tagging data only. The data vectors <code>Lrel</code>, <code>Lrec</code>, and
<code>liberty</code> can be omitted to fit to otoliths only.
</p>


<h3>Value</h3>

<p>The <code>richards</code> function returns a TMB model object, produced by
<code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.
</p>
<p>The <code>richards_curve</code> function returns a numeric vector of predicted
length at age.
</p>
<p>The <code>richards_objfun</code> function returns the negative log-likelihood as a
single number, describing the goodness of fit of <code>par</code> to the
<code>data</code>.
</p>


<h3>Note</h3>

<p>The Schnute parametrization used in <code>richards</code> reduces parameter
correlation and improves convergence reliability compared to the traditional
parametrization used in <code><a href="#topic+richardso">richardso</a></code>. Therefore, the
<code>richards</code> parametrization can be recommended for general usage, as both
parametrizations produce the same growth curve. However, there can be some
use cases where the traditional parametrization (<code>Linf</code>, <code>k</code>,
<code>tau</code>, <code>b</code>) is preferred over the Schnute parametrization
(<code>L1</code>, <code>L2</code>, <code>k</code>, <code>b</code>).
</p>
<p>The Richards (1959) growth model, as parametrized by Schnute (1981, Eq. 15),
predicts length at age as:
</p>
<p style="text-align: center;"><code class="reqn">\hat L_t ~=~ \left[\:L_1^b\;+\;(L_2^b-L_1^b)\,
      \frac{1-e^{-k(t-t_1)}}{1-e^{-k(t_2-t_1)}}\,\right]^{1/b}</code>
</p>

<p>The variability of length at age increases linearly with length,
</p>
<p style="text-align: center;"><code class="reqn">\sigma_L ~=~ \alpha \,+\, \beta \hat L</code>
</p>

<p>where the slope is <code class="reqn">\beta=(\sigma_{\max}-\sigma_{\min}) /
(L_{\max}-L_{\min})</code>, the
intercept is <code class="reqn">\alpha=\sigma_{\min} - \beta L_{\min}</code>, and <code class="reqn">L_{\min}</code> and <code class="reqn">L_{\max}</code> are the
shortest and longest observed lengths in the data. Alternatively, growth
variability can be modelled as a constant
<code class="reqn">\sigma_L=\sigma_{\min}</code> that does not vary with
length, by omitting <code>log_sigma_max</code> from the parameter list (see above).
</p>
<p>The negative log-likelihood is calculated by comparing the observed and
predicted lengths:
</p>
<pre>
  nll_Loto &lt;- -dnorm(Loto, Loto_hat, sigma_Loto, TRUE)
  nll_Lrel &lt;- -dnorm(Lrel, Lrel_hat, sigma_Lrel, TRUE)
  nll_Lrec &lt;- -dnorm(Lrec, Lrec_hat, sigma_Lrec, TRUE)
  nll &lt;- sum(nll_Loto) + sum(nll_Lrel) + sum(nll_Lrec)
</pre>


<h3>References</h3>

<p>Richards, F.J. (1959).
A flexible growth function for empirical use.
<em>Journal of Experimental Botany</em>, <b>10</b>, 290-300.
<a href="https://www.jstor.org/stable/23686557">https://www.jstor.org/stable/23686557</a>.
</p>
<p>Schnute, J. (1981).
A versatile growth model with statistically stable parameters.
<em>Canadian Journal of Fisheries and Aquatic Science</em>, <b>38</b>,
1128-1140.
<a href="https://doi.org/10.1139/f81-153">doi:10.1139/f81-153</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gcm">gcm</a></code>, <code><a href="#topic+gompertz">gompertz</a></code>, <code><a href="#topic+gompertzo">gompertzo</a></code>,
<code>richards</code>, <code><a href="#topic+richardso">richardso</a></code>, <code><a href="#topic+schnute3">schnute3</a></code>,
<code><a href="#topic+vonbert">vonbert</a></code>, and <code><a href="#topic+vonberto">vonberto</a></code> are alternative growth
models.
</p>
<p><code><a href="#topic+pred_band">pred_band</a></code> calculates a prediction band for a fitted growth
model.
</p>
<p><code><a href="#topic+otoliths_had">otoliths_had</a></code>, <code><a href="#topic+otoliths_skj">otoliths_skj</a></code>, and
<code><a href="#topic+tags_skj">tags_skj</a></code> are example datasets.
</p>
<p><code><a href="#topic+fishgrowth-package">fishgrowth-package</a></code> gives an overview of the package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Model 1: Fit to haddock otoliths

# Explore initial parameter values
plot(len~age, otoliths_had, xlim=c(0,18), ylim=c(0,105), pch=16,
     col="#0080a010")
x &lt;- seq(1, 18, 0.1)
lines(x, richards_curve(x, L1=18, L2=67, k=0.1, b=1, t1=1, t2=10), lty=3)

# Prepare parameters and data
init &lt;- list(log_L1=log(18), log_L2=log(67), log_k=log(0.1), b=1,
             log_sigma_min=log(3), log_sigma_max=log(3))
dat &lt;- list(Aoto=otoliths_had$age, Loto=otoliths_had$len, t1=1, t2=10)
richards_objfun(init, dat)

# Fit model
model &lt;- richards(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
report &lt;- model$report()
sdreport &lt;- sdreport(model)

# Plot results
Lhat &lt;- with(report, richards_curve(x, L1, L2, k, b, t1, t2))
lines(x, Lhat, lwd=2, col=2)
legend("bottomright", c("initial curve","model fit"), col=c(1,2), lty=c(3,1),
       lwd=c(1,2), bty="n", inset=0.02, y.intersp=1.25)

# Model summary
report[c("L1", "L2", "k", "b", "sigma_min", "sigma_max")]
fit[-1]
summary(sdreport)

# Plot 95% prediction band
band &lt;- pred_band(x, model)
areaplot::confplot(cbind(lower,upper)~age, band, xlim=c(0,18), ylim=c(0,100),
         ylab="len", col="mistyrose")
points(len~age, otoliths_had, xlim=c(0,18), ylim=c(0,100),
       pch=16, col="#0080a010")
lines(x, Lhat, lwd=2, col=2)
lines(lower~age, band, lty=1, lwd=0.5, col=2)
lines(upper~age, band, lty=1, lwd=0.5, col=2)

#############################################################################

# Model 2: Fit to skipjack otoliths and tags

# Explore initial parameter values
plot(len~age, otoliths_skj, xlim=c(0,4), ylim=c(0,100))
x &lt;- seq(0, 4, 0.1)
points(lenRel~I(lenRel/60), tags_skj, col=4)
points(lenRec~I(lenRel/60+liberty), tags_skj, col=3)
lines(x, richards_curve(x, L1=25, L2=75, k=0.8, b=1, t1=0, t2=4), lty=2)
legend("bottomright", c("otoliths","tag releases","tac recaptures",
       "initial curve"), col=c(1,4,3,1), pch=c(1,1,1,NA), lty=c(0,0,0,2),
       lwd=c(1.2,1.2,1.2,1), bty="n", inset=0.02, y.intersp=1.25)

# Prepare parameters and data
init &lt;- list(log_L1=log(25), log_L2=log(75), log_k=log(0.8), b=1,
             log_sigma_min=log(3), log_sigma_max=log(3),
             log_age=log(tags_skj$lenRel/60))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len,
            Lrel=tags_skj$lenRel, Lrec=tags_skj$lenRec,
            liberty=tags_skj$liberty, t1=0, t2=4)
richards_objfun(init, dat)

# Fit model
model &lt;- richards(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
report &lt;- model$report()
sdreport &lt;- sdreport(model)

# Plot results
plot(len~age, otoliths_skj, xlim=c(0,4), ylim=c(0,100))
points(report$age, report$Lrel, col=4)
points(report$age+report$liberty, report$Lrec, col=3)
Lhat &lt;- with(report, richards_curve(x, L1, L2, k, b, t1, t2))
lines(x, Lhat, lwd=2)
legend("bottomright", c("otoliths","tag releases","tac recaptures",
       "model fit"), col=c(1,4,3,1), pch=c(1,1,1,NA), lty=c(0,0,0,1),
       lwd=c(1.2,1.2,1.2,2), bty="n", inset=0.02, y.intersp=1.25)

# Model summary
report[c("L1", "L2", "k", "b", "sigma_min", "sigma_max")]
fit[-1]
head(summary(sdreport), 6)

#############################################################################

# Model 3: Fit to skipjack otoliths only

init &lt;- list(log_L1=log(25), log_L2=log(75), log_k=log(0.8), b=1,
             log_sigma_min=log(3), log_sigma_max=log(3))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len, t1=0, t2=4)
model &lt;- richards(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("L1", "L2", "k", "b", "sigma_min", "sigma_max")]

#############################################################################

# Model 4: Fit to skipjack otoliths only,
# but now estimating constant sigma instead of sigma varying by length

# We do this by omitting log_sigma_max
init &lt;- list(log_L1=log(25), log_L2=log(75), log_k=log(0.8), b=1,
             log_sigma_min=log(3))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len, t1=0, t2=4)
model &lt;- richards(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("L1", "L2", "k", "b", "sigma_min")]

#############################################################################

# Model 5: Fit to skipjack tags only

init &lt;- list(log_L1=log(25), log_L2=log(75), log_k=log(0.8), b=1,
             log_sigma_min=log(3), log_sigma_max=log(3),
             log_age=log(tags_skj$lenRel/60))
dat &lt;- list(Lrel=tags_skj$lenRel, Lrec=tags_skj$lenRec,
            liberty=tags_skj$liberty, t1=0, t2=4)
model &lt;- richards(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("L1", "L2", "k", "b", "sigma_min", "sigma_max")]

</code></pre>

<hr>
<h2 id='richardso'>Richards Growth Model (Old Style)</h2><span id='topic+richardso'></span><span id='topic+richardso_curve'></span><span id='topic+richardso_objfun'></span>

<h3>Description</h3>

<p>Fit a Richards growth model to otoliths and/or tags, using a traditional
parametrization.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>richardso(par, data, silent = TRUE, ...)

richardso_curve(t, Linf, k, tau, b)

richardso_objfun(par, data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="richardso_+3A_par">par</code></td>
<td>
<p>a parameter list.</p>
</td></tr>
<tr><td><code id="richardso_+3A_data">data</code></td>
<td>
<p>a data list.</p>
</td></tr>
<tr><td><code id="richardso_+3A_silent">silent</code></td>
<td>
<p>passed to <code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.</p>
</td></tr>
<tr><td><code id="richardso_+3A_...">...</code></td>
<td>
<p>passed to <code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.</p>
</td></tr>
<tr><td><code id="richardso_+3A_t">t</code></td>
<td>
<p>age (vector).</p>
</td></tr>
<tr><td><code id="richardso_+3A_linf">Linf</code></td>
<td>
<p>asymptotic maximum length.</p>
</td></tr>
<tr><td><code id="richardso_+3A_k">k</code></td>
<td>
<p>growth coefficient.</p>
</td></tr>
<tr><td><code id="richardso_+3A_tau">tau</code></td>
<td>
<p>location parameter.</p>
</td></tr>
<tr><td><code id="richardso_+3A_b">b</code></td>
<td>
<p>shape parameter.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The main function <code>richardso</code> creates a model object, ready for
parameter estimation. The auxiliary functions <code>richardso_curve</code> and
<code>richardso_objfun</code> are called by the main function to calculate the
regression curve and objective function value. The user can also call the
auxiliary functions directly for plotting and model exploration.
</p>
<p>The <code>par</code> list contains the following elements:
</p>

<ul>
<li> <p><code>log_Linf</code>, asymptotic maximum length
</p>
</li>
<li> <p><code>log_k</code>, growth coefficient
</p>
</li>
<li> <p><code>tau</code>, location parameter
</p>
</li>
<li> <p><code>b</code>, shape parameter
</p>
</li>
<li> <p><code>log_sigma_min</code>, growth variability at the shortest observed
length in the data
</p>
</li>
<li> <p><code>log_sigma_max</code> (*), growth variability at the longest observed
length in the data
</p>
</li>
<li> <p><code>log_age</code> (*), age at release of tagged individuals (vector)
</p>
</li></ul>

<p>*: The parameter <code>log_sigma_max</code> can be omitted to estimate growth
variability that does not vary with length. The parameter vector
<code>log_age</code> can be omitted to fit to otoliths only.
</p>
<p>The <code>data</code> list contains the following elements:
</p>

<ul>
<li> <p><code>Aoto</code> (*), age from otoliths (vector)
</p>
</li>
<li> <p><code>Loto</code> (*), length from otoliths (vector)
</p>
</li>
<li> <p><code>Lrel</code> (*), length at release of tagged individuals (vector)
</p>
</li>
<li> <p><code>Lrec</code> (*), length at recapture of tagged individuals (vector)
</p>
</li>
<li> <p><code>liberty</code> (*), time at liberty of tagged individuals in years
(vector)
</p>
</li></ul>

<p>*: The data vectors <code>Aoto</code> and <code>Loto</code> can be omitted to fit to
tagging data only. The data vectors <code>Lrel</code>, <code>Lrec</code>, and
<code>liberty</code> can be omitted to fit to otoliths only.
</p>


<h3>Value</h3>

<p>The <code>richardso</code> function returns a TMB model object, produced by
<code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.
</p>
<p>The <code>richardso_curve</code> function returns a numeric vector of predicted
length at age.
</p>
<p>The <code>richardso_objfun</code> function returns the negative log-likelihood as a
single number, describing the goodness of fit of <code>par</code> to the
<code>data</code>.
</p>


<h3>Note</h3>

<p>The Schnute parametrization used in <code><a href="#topic+richards">richards</a></code> reduces parameter
correlation and improves convergence reliability compared to the traditional
parametrization used in <code>richardso</code>. Therefore, the
<code>richards</code> parametrization can be recommended for general usage, as both
parametrizations produce the same growth curve. However, there can be some
use cases where the traditional parametrization (<code>Linf</code>, <code>k</code>,
<code>tau</code>, <code>b</code>) is preferred over the Schnute parametrization
(<code>L1</code>, <code>L2</code>, <code>k</code>, <code>b</code>).
</p>
<p>The Richards (1959) growth model, as parametrized by Tjørve and Tjørve (2010,
Eq. 4), predicts length at age as:
</p>
<p style="text-align: center;"><code class="reqn">\hat L_t ~=~ L_\infty\left(1\,-\,\frac{1}{b}\,
      e^{-k(t-\tau)}\right)^{\!b}</code>
</p>

<p>The variability of length at age increases linearly with length,
</p>
<p style="text-align: center;"><code class="reqn">\sigma_L ~=~ \alpha \,+\, \beta \hat L</code>
</p>

<p>where the slope is <code class="reqn">\beta=(\sigma_{\max}-\sigma_{\min}) /
(L_{\max}-L_{\min})</code>, the
intercept is <code class="reqn">\alpha=\sigma_{\min} - \beta L_{\min}</code>, and <code class="reqn">L_{\min}</code> and <code class="reqn">L_{\max}</code> are the
shortest and longest observed lengths in the data. Alternatively, growth
variability can be modelled as a constant
<code class="reqn">\sigma_L=\sigma_{\min}</code> that does not vary with
length, by omitting <code>log_sigma_max</code> from the parameter list (see above).
</p>
<p>The negative log-likelihood is calculated by comparing the observed and
predicted lengths:
</p>
<pre>
  nll_Loto &lt;- -dnorm(Loto, Loto_hat, sigma_Loto, TRUE)
  nll_Lrel &lt;- -dnorm(Lrel, Lrel_hat, sigma_Lrel, TRUE)
  nll_Lrec &lt;- -dnorm(Lrec, Lrec_hat, sigma_Lrec, TRUE)
  nll &lt;- sum(nll_Loto) + sum(nll_Lrel) + sum(nll_Lrec)
</pre>


<h3>References</h3>

<p>Richards, F.J. (1959).
A flexible growth function for empirical use.
<em>Journal of Experimental Botany</em>, <b>10</b>, 290-300.
<a href="https://www.jstor.org/stable/23686557">https://www.jstor.org/stable/23686557</a>.
</p>
<p>Tjørve, E. and Tjørve, K.M.C. (2010).
A unified approach to the Richards-model family for use in growth analyses:
Why we need only two model forms.
<em>Journal of Theoretical Biology</em>, <b>267</b>, 417-425.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gcm">gcm</a></code>, <code><a href="#topic+gompertz">gompertz</a></code>, <code><a href="#topic+gompertzo">gompertzo</a></code>,
<code><a href="#topic+richards">richards</a></code>, <code>richardso</code>, <code><a href="#topic+schnute3">schnute3</a></code>,
<code><a href="#topic+vonbert">vonbert</a></code>, and <code><a href="#topic+vonberto">vonberto</a></code> are alternative growth
models.
</p>
<p><code><a href="#topic+pred_band">pred_band</a></code> calculates a prediction band for a fitted growth
model.
</p>
<p><code><a href="#topic+otoliths_had">otoliths_had</a></code>, <code><a href="#topic+otoliths_skj">otoliths_skj</a></code>, and
<code><a href="#topic+tags_skj">tags_skj</a></code> are example datasets.
</p>
<p><code><a href="#topic+fishgrowth-package">fishgrowth-package</a></code> gives an overview of the package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Model 1: Fit to haddock otoliths

# Explore initial parameter values
plot(len~age, otoliths_had, xlim=c(0,18), ylim=c(0,105), pch=16,
     col="#0080a010")
x &lt;- seq(1, 18, 0.1)
lines(x, richardso_curve(x, Linf=100, k=0.1, tau=-1, b=1), lty=3)

# Prepare parameters and data
init &lt;- list(log_Linf=log(100), log_k=log(0.1), tau=-1, b=1,
             log_sigma_min=log(3), log_sigma_max=log(3))
dat &lt;- list(Aoto=otoliths_had$age, Loto=otoliths_had$len)
richardso_objfun(init, dat)

# Fit model
model &lt;- richardso(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
report &lt;- model$report()
sdreport &lt;- sdreport(model)

# Plot results
Lhat &lt;- with(report, richardso_curve(x, Linf, k, tau, b))
lines(x, Lhat, lwd=2, col=2)
legend("bottomright", c("initial curve","model fit"), col=c(1,2), lty=c(3,1),
       lwd=c(1,2), bty="n", inset=0.02, y.intersp=1.25)

# Model summary
report[c("Linf", "k", "tau", "b", "sigma_min", "sigma_max")]
fit[-1]
summary(sdreport)

# Plot 95% prediction band
band &lt;- pred_band(x, model)
areaplot::confplot(cbind(lower,upper)~age, band, xlim=c(0,18), ylim=c(0,100),
         ylab="len", col="mistyrose")
points(len~age, otoliths_had, xlim=c(0,18), ylim=c(0,100),
       pch=16, col="#0080a010")
lines(x, Lhat, lwd=2, col=2)
lines(lower~age, band, lty=1, lwd=0.5, col=2)
lines(upper~age, band, lty=1, lwd=0.5, col=2)

#############################################################################

# Model 2: Fit to skipjack otoliths and tags

# Explore initial parameter values
plot(len~age, otoliths_skj, xlim=c(0,4), ylim=c(0,100))
x &lt;- seq(0, 4, 0.1)
points(lenRel~I(lenRel/60), tags_skj, col=4)
points(lenRec~I(lenRel/60+liberty), tags_skj, col=3)
lines(x, richardso_curve(x, Linf=80, k=0.8, tau=-0.5, b=1), lty=2)
legend("bottomright", c("otoliths","tag releases","tac recaptures",
       "initial curve"), col=c(1,4,3,1), pch=c(1,1,1,NA), lty=c(0,0,0,2),
       lwd=c(1.2,1.2,1.2,1), bty="n", inset=0.02, y.intersp=1.25)

# Prepare parameters and data
init &lt;- list(log_Linf=log(80), log_k=log(0.8), tau=-0.5, b=1,
             log_sigma_min=log(3), log_sigma_max=log(3),
             log_age=log(tags_skj$lenRel/60))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len,
            Lrel=tags_skj$lenRel, Lrec=tags_skj$lenRec,
            liberty=tags_skj$liberty)
richardso_objfun(init, dat)

# Fit model
model &lt;- richardso(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
report &lt;- model$report()
sdreport &lt;- sdreport(model)

# Plot results
plot(len~age, otoliths_skj, xlim=c(0,4), ylim=c(0,100))
points(report$age, report$Lrel, col=4)
points(report$age+report$liberty, report$Lrec, col=3)
Lhat &lt;- with(report, richardso_curve(x, Linf, k, tau, b))
lines(x, Lhat, lwd=2)
legend("bottomright", c("otoliths","tag releases","tac recaptures",
       "model fit"), col=c(1,4,3,1), pch=c(1,1,1,NA), lty=c(0,0,0,1),
       lwd=c(1.2,1.2,1.2,2), bty="n", inset=0.02, y.intersp=1.25)

# Model summary
report[c("Linf", "k", "tau", "b", "sigma_min", "sigma_max")]
fit[-1]
head(summary(sdreport), 6)

#############################################################################

# Model 3: Fit to skipjack otoliths only

init &lt;- list(log_Linf=log(80), log_k=log(0.8), tau=-0.5, b=1,
             log_sigma_min=log(3), log_sigma_max=log(3))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len)
model &lt;- richardso(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("Linf", "k", "tau", "b", "sigma_min", "sigma_max")]

#############################################################################

# Model 4: Fit to skipjack otoliths only,
# but now estimating constant sigma instead of sigma varying by length

# We do this by omitting log_sigma_max
init &lt;- list(log_Linf=log(80), log_k=log(0.8), tau=-0.5, b=1,
             log_sigma_min=log(3))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len)
model &lt;- richardso(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("Linf", "k", "tau", "b", "sigma_min")]

#############################################################################

# Model 5: Fit to skipjack tags only

init &lt;- list(log_Linf=log(80), log_k=log(0.8), tau=-0.5, b=1,
             log_sigma_min=log(3), log_sigma_max=log(3),
             log_age=log(tags_skj$lenRel/60))
dat &lt;- list(Lrel=tags_skj$lenRel, Lrec=tags_skj$lenRec,
            liberty=tags_skj$liberty)
model &lt;- richardso(init, dat)           # using 1e3 to keep CRAN checks fast,
fit &lt;- nlminb(model$par, model$fn, model$gr,             # but try 1e4 to get
              control=list(eval.max=1e3, iter.max=1e3))  # better convergence
model$report()[c("Linf", "k", "tau", "b", "sigma_min", "sigma_max")]

</code></pre>

<hr>
<h2 id='schnute3'>Schnute Case 3 Model</h2><span id='topic+schnute3'></span><span id='topic+schnute3_curve'></span><span id='topic+schnute3_objfun'></span>

<h3>Description</h3>

<p>Fit a Schnute Case 3 model to otoliths and/or tags.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>schnute3(par, data, silent = TRUE, ...)

schnute3_curve(t, L1, L2, b, t1, t2)

schnute3_objfun(par, data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="schnute3_+3A_par">par</code></td>
<td>
<p>a parameter list.</p>
</td></tr>
<tr><td><code id="schnute3_+3A_data">data</code></td>
<td>
<p>a data list.</p>
</td></tr>
<tr><td><code id="schnute3_+3A_silent">silent</code></td>
<td>
<p>passed to <code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.</p>
</td></tr>
<tr><td><code id="schnute3_+3A_...">...</code></td>
<td>
<p>passed to <code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.</p>
</td></tr>
<tr><td><code id="schnute3_+3A_t">t</code></td>
<td>
<p>age (vector).</p>
</td></tr>
<tr><td><code id="schnute3_+3A_l1">L1</code></td>
<td>
<p>predicted length at age <code>t1</code>.</p>
</td></tr>
<tr><td><code id="schnute3_+3A_l2">L2</code></td>
<td>
<p>predicted length at age <code>t2</code>.</p>
</td></tr>
<tr><td><code id="schnute3_+3A_b">b</code></td>
<td>
<p>shape parameter.</p>
</td></tr>
<tr><td><code id="schnute3_+3A_t1">t1</code></td>
<td>
<p>age where predicted length is <code>L1</code>.</p>
</td></tr>
<tr><td><code id="schnute3_+3A_t2">t2</code></td>
<td>
<p>age where predicted length is <code>L2</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The main function <code>schnute3</code> creates a model object, ready for parameter
estimation. The auxiliary functions <code>schnute3_curve</code> and
<code>schnute3_objfun</code> are called by the main function to calculate the
regression curve and objective function value. The user can also call the
auxiliary functions directly for plotting and model exploration.
</p>
<p>The <code>par</code> list contains the following elements:
</p>

<ul>
<li> <p><code>log_L1</code>, predicted length at age <code>t1</code>
</p>
</li>
<li> <p><code>log_L2</code>, predicted length at age <code>t2</code>
</p>
</li>
<li> <p><code>b</code>, shape parameter
</p>
</li>
<li> <p><code>log_sigma_min</code>, growth variability at the shortest observed
length in the data
</p>
</li>
<li> <p><code>log_sigma_max</code> (*), growth variability at the longest observed
length in the data
</p>
</li>
<li> <p><code>log_age</code> (*), age at release of tagged individuals (vector)
</p>
</li></ul>

<p>*: The parameter <code>log_sigma_max</code> can be omitted to estimate growth
variability that does not vary with length. The parameter vector
<code>log_age</code> can be omitted to fit to otoliths only.
</p>
<p>The <code>data</code> list contains the following elements:
</p>

<ul>
<li> <p><code>Aoto</code> (*), age from otoliths (vector)
</p>
</li>
<li> <p><code>Loto</code> (*), length from otoliths (vector)
</p>
</li>
<li> <p><code>Lrel</code> (*), length at release of tagged individuals (vector)
</p>
</li>
<li> <p><code>Lrec</code> (*), length at recapture of tagged individuals (vector)
</p>
</li>
<li> <p><code>liberty</code> (*), time at liberty of tagged individuals in years
(vector)
</p>
</li>
<li> <p><code>t1</code>, age where predicted length is <code>L1</code>
</p>
</li>
<li> <p><code>t2</code>, age where predicted length is <code>L2</code>
</p>
</li></ul>

<p>*: The data vectors <code>Aoto</code> and <code>Loto</code> can be omitted to fit to
tagging data only. The data vectors <code>Lrel</code>, <code>Lrec</code>, and
<code>liberty</code> can be omitted to fit to otoliths only.
</p>


<h3>Value</h3>

<p>The <code>schnute3</code> function returns a TMB model object, produced by
<code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.
</p>
<p>The <code>schnute3_curve</code> function returns a numeric vector of predicted
length at age.
</p>
<p>The <code>schnute3_objfun</code> function returns the negative log-likelihood as a
single number, describing the goodness of fit of <code>par</code> to the
<code>data</code>.
</p>


<h3>Note</h3>

<p>The Schnute Case 3 model is a special case of the Richards (1959) model,
where <code class="reqn">k=0</code>. If the best model fit of a <code><a href="#topic+richards">richards</a></code> model to a
particular dataset involves a very small estimated value of <code class="reqn">k</code>, then the
<code>schnute3</code> model offers a preferable parametrization, as it produces the
same curve using fewer parameters.
</p>
<p>The Schnute Case 3 model (Schnute 1981, Eq. 17) predicts length at age as:
</p>
<p style="text-align: center;"><code class="reqn">L ~=~ \left[\;L_1^b\;+\;(L_2^b-L_1^b)\,
      \frac{t-t_1}{t_2-t_1}\,\right]^{1/b}</code>
</p>

<p>The variability of length at age increases linearly with length,
</p>
<p style="text-align: center;"><code class="reqn">\sigma_L ~=~ \alpha \,+\, \beta \hat L</code>
</p>

<p>where the slope is <code class="reqn">\beta=(\sigma_{\max}-\sigma_{\min}) /
(L_{\max}-L_{\min})</code>, the
intercept is <code class="reqn">\alpha=\sigma_{\min} - \beta L_{\min}</code>, and <code class="reqn">L_{\min}</code> and <code class="reqn">L_{\max}</code> are the
shortest and longest observed lengths in the data. Alternatively, growth
variability can be modelled as a constant
<code class="reqn">\sigma_L=\sigma_{\min}</code> that does not vary with
length, by omitting <code>log_sigma_max</code> from the parameter list (see above).
</p>
<p>The negative log-likelihood is calculated by comparing the observed and
predicted lengths:
</p>
<pre>
  nll_Loto &lt;- -dnorm(Loto, Loto_hat, sigma_Loto, TRUE)
  nll_Lrel &lt;- -dnorm(Lrel, Lrel_hat, sigma_Lrel, TRUE)
  nll_Lrec &lt;- -dnorm(Lrec, Lrec_hat, sigma_Lrec, TRUE)
  nll &lt;- sum(nll_Loto) + sum(nll_Lrel) + sum(nll_Lrec)
</pre>


<h3>References</h3>

<p>Richards, F.J. (1959).
A flexible growth function for empirical use.
<em>Journal of Experimental Botany</em>, <b>10</b>, 290-300.
<a href="https://www.jstor.org/stable/23686557">https://www.jstor.org/stable/23686557</a>.
</p>
<p>Schnute, J. (1981).
A versatile growth model with statistically stable parameters.
<em>Canadian Journal of Fisheries and Aquatic Science</em>, <b>38</b>,
1128-1140.
<a href="https://doi.org/10.1139/f81-153">doi:10.1139/f81-153</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gcm">gcm</a></code>, <code><a href="#topic+gompertz">gompertz</a></code>, <code><a href="#topic+gompertzo">gompertzo</a></code>,
<code><a href="#topic+richards">richards</a></code>, <code><a href="#topic+richardso">richardso</a></code>, <code>schnute3</code>,
<code><a href="#topic+vonbert">vonbert</a></code>, and <code><a href="#topic+vonberto">vonberto</a></code> are alternative growth
models.
</p>
<p><code><a href="#topic+pred_band">pred_band</a></code> calculates a prediction band for a fitted growth
model.
</p>
<p><code><a href="#topic+otoliths_had">otoliths_had</a></code>, <code><a href="#topic+otoliths_skj">otoliths_skj</a></code>, and
<code><a href="#topic+tags_skj">tags_skj</a></code> are example datasets.
</p>
<p><code><a href="#topic+fishgrowth-package">fishgrowth-package</a></code> gives an overview of the package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Model 1: Fit to haddock otoliths

# Explore initial parameter values
plot(len~age, otoliths_had, xlim=c(0,18), ylim=c(0,105), pch=16,
     col="#0080a010")
x &lt;- seq(1, 18, 0.1)
lines(x, schnute3_curve(x, L1=15, L2=70, b=2, t1=1, t2=10), lty=3)

# Prepare parameters and data
init &lt;- list(log_L1=log(15), log_L2=log(70), b=2,
             log_sigma_min=log(3), log_sigma_max=log(3))
dat &lt;- list(Aoto=otoliths_had$age, Loto=otoliths_had$len, t1=1, t2=10)
schnute3_objfun(init, dat)

# Fit model
model &lt;- schnute3(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
report &lt;- model$report()
sdreport &lt;- sdreport(model)

# Plot results
Lhat &lt;- with(report, schnute3_curve(x, L1, L2, b, t1, t2))
lines(x, Lhat, lwd=2, col=2)
legend("bottomright", c("initial curve","model fit"), col=c(1,2), lty=c(3,1),
       lwd=c(1,2), bty="n", inset=0.02, y.intersp=1.25)

# Model summary
report[c("L1", "L2", "b", "sigma_min", "sigma_max")]
fit[-1]
summary(sdreport)

# Plot 95% prediction band
band &lt;- pred_band(x, model)
areaplot::confplot(cbind(lower,upper)~age, band, xlim=c(0,18), ylim=c(0,100),
         ylab="len", col="mistyrose")
points(len~age, otoliths_had, xlim=c(0,18), ylim=c(0,100),
       pch=16, col="#0080a010")
lines(x, Lhat, lwd=2, col=2)
lines(lower~age, band, lty=1, lwd=0.5, col=2)
lines(upper~age, band, lty=1, lwd=0.5, col=2)

#############################################################################

# Model 2: Fit to skipjack otoliths and tags

# Explore initial parameter values
plot(len~age, otoliths_skj, xlim=c(0,4), ylim=c(0,100))
x &lt;- seq(0, 4, 0.1)
points(lenRel~I(lenRel/60), tags_skj, col=4)
points(lenRec~I(lenRel/60+liberty), tags_skj, col=3)
lines(x, schnute3_curve(x, L1=25, L2=75, b=3, t1=0, t2=4), lty=2)
legend("bottomright", c("otoliths","tag releases","tac recaptures",
       "initial curve"), col=c(1,4,3,1), pch=c(1,1,1,NA), lty=c(0,0,0,2),
       lwd=c(1.2,1.2,1.2,1), bty="n", inset=0.02, y.intersp=1.25)

# Prepare parameters and data
init &lt;- list(log_L1=log(25), log_L2=log(75), b=3,
             log_sigma_min=log(3), log_sigma_max=log(3),
             log_age=log(tags_skj$lenRel/60))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len,
            Lrel=tags_skj$lenRel, Lrec=tags_skj$lenRec,
            liberty=tags_skj$liberty, t1=0, t2=4)
schnute3_objfun(init, dat)

# Fit model
model &lt;- schnute3(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
report &lt;- model$report()
sdreport &lt;- sdreport(model)

# Plot results
plot(len~age, otoliths_skj, xlim=c(0,4), ylim=c(0,100))
points(report$age, report$Lrel, col=4)
points(report$age+report$liberty, report$Lrec, col=3)
Lhat &lt;- with(report, schnute3_curve(x, L1, L2, b, t1, t2))
lines(x, Lhat, lwd=2)
legend("bottomright", c("otoliths","tag releases","tac recaptures",
       "model fit"), col=c(1,4,3,1), pch=c(1,1,1,NA), lty=c(0,0,0,1),
       lwd=c(1.2,1.2,1.2,2), bty="n", inset=0.02, y.intersp=1.25)

# Model summary
report[c("L1", "L2", "b", "sigma_min", "sigma_max")]
fit[-1]
head(summary(sdreport), 5)

#############################################################################

# Model 3: Fit to skipjack otoliths only

init &lt;- list(log_L1=log(25), log_L2=log(75), b=3,
             log_sigma_min=log(3), log_sigma_max=log(3))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len, t1=0, t2=4)
model &lt;- schnute3(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("L1", "L2", "b", "sigma_min", "sigma_max")]

#############################################################################

# Model 4: Fit to skipjack otoliths only,
# but now estimating constant sigma instead of sigma varying by length

# We do this by omitting log_sigma_max
init &lt;- list(log_L1=log(25), log_L2=log(75), b=3,
             log_sigma_min=log(3))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len, t1=0, t2=4)
model &lt;- schnute3(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("L1", "L2", "b", "sigma_min")]

#############################################################################

# Model 5: Fit to skipjack tags only

init &lt;- list(log_L1=log(25), log_L2=log(75), b=3,
             log_sigma_min=log(3), log_sigma_max=log(3),
             log_age=log(tags_skj$lenRel/60))
dat &lt;- list(Lrel=tags_skj$lenRel, Lrec=tags_skj$lenRec,
            liberty=tags_skj$liberty, t1=0, t2=4)
model &lt;- schnute3(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("L1", "L2", "b", "sigma_min", "sigma_max")]

</code></pre>

<hr>
<h2 id='tags_skj'>Tagging Data (Skipjack)</h2><span id='topic+tags_skj'></span>

<h3>Description</h3>

<p>Simulated tagging data, loosely based on a skipjack tuna dataset analyzed by
Macdonald et al. (2022).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tags_skj
</code></pre>


<h3>Format</h3>

<p>Data frame containing three columns:
</p>

<table>
<tr>
 <td style="text-align: left;">
  <code>lenRel</code>  </td><td style="text-align: left;"> length at release (cm)</td>
</tr>
<tr>
 <td style="text-align: left;">
  <code>lenRec</code>  </td><td style="text-align: left;"> length at recapture (cm)</td>
</tr>
<tr>
 <td style="text-align: left;">
  <code>liberty</code> </td><td style="text-align: left;"> time at liberty (years)
</td>
</tr>

</table>



<h3>Details</h3>

<p>The simulation code that was used to produce this dataset is included in the
package:
</p>
<pre>file.show(system.file(package="fishgrowth", "sim/simulate.R"))</pre>


<h3>Source</h3>

<p>Macdonald, J., Day, J., Magnusson, A., Maunder, M., Aoki, Y., Matsubara, N.,
Tsuda, Y., McKechnie, S., Teears, T., Leroy, B., Castillo-Jordán, C.,
Hampton, J., and Hamer, P. (2022).
<em>Review and new analyses of skipjack growth in the Western and Central
Pacific Ocean</em>.
Western and Central Pacific Fisheries Commission Report
WCPFC-SC18-2022/SA-IP-06.
<a href="https://meetings.wcpfc.int/node/16254">https://meetings.wcpfc.int/node/16254</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gcm">gcm</a></code>, <code><a href="#topic+gompertz">gompertz</a></code>, <code><a href="#topic+gompertzo">gompertzo</a></code>,
<code><a href="#topic+richards">richards</a></code>, <code><a href="#topic+richardso">richardso</a></code>, <code><a href="#topic+schnute3">schnute3</a></code>,
<code><a href="#topic+vonbert">vonbert</a></code>, and <code><a href="#topic+vonberto">vonberto</a></code> are alternative growth
models.
</p>
<p><code><a href="#topic+otoliths_had">otoliths_had</a></code>, <code><a href="#topic+otoliths_skj">otoliths_skj</a></code>, and <code>tags_skj</code>
are example datasets.
</p>
<p><code><a href="#topic+fishgrowth-package">fishgrowth-package</a></code> gives an overview of the package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>head(tags_skj)
</code></pre>

<hr>
<h2 id='vonbert'>Von Bertalanffy Growth Model</h2><span id='topic+vonbert'></span><span id='topic+vonbert_curve'></span><span id='topic+vonbert_objfun'></span>

<h3>Description</h3>

<p>Fit a von Bertalanffy growth model to otoliths and/or tags, using the
Schnute-Fournier parametrization.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vonbert(par, data, silent = TRUE, ...)

vonbert_curve(t, L1, L2, k, t1, t2)

vonbert_objfun(par, data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vonbert_+3A_par">par</code></td>
<td>
<p>a parameter list.</p>
</td></tr>
<tr><td><code id="vonbert_+3A_data">data</code></td>
<td>
<p>a data list.</p>
</td></tr>
<tr><td><code id="vonbert_+3A_silent">silent</code></td>
<td>
<p>passed to <code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.</p>
</td></tr>
<tr><td><code id="vonbert_+3A_...">...</code></td>
<td>
<p>passed to <code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.</p>
</td></tr>
<tr><td><code id="vonbert_+3A_t">t</code></td>
<td>
<p>age (vector).</p>
</td></tr>
<tr><td><code id="vonbert_+3A_l1">L1</code></td>
<td>
<p>predicted length at age <code>t1</code>.</p>
</td></tr>
<tr><td><code id="vonbert_+3A_l2">L2</code></td>
<td>
<p>predicted length at age <code>t2</code>.</p>
</td></tr>
<tr><td><code id="vonbert_+3A_k">k</code></td>
<td>
<p>growth coefficient.</p>
</td></tr>
<tr><td><code id="vonbert_+3A_t1">t1</code></td>
<td>
<p>age where predicted length is <code>L1</code>.</p>
</td></tr>
<tr><td><code id="vonbert_+3A_t2">t2</code></td>
<td>
<p>age where predicted length is <code>L2</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The main function <code>vonbert</code> creates a model object, ready for parameter
estimation. The auxiliary functions <code>vonbert_curve</code> and
<code>vonbert_objfun</code> are called by the main function to calculate the
regression curve and objective function value. The user can also call the
auxiliary functions directly for plotting and model exploration.
</p>
<p>The <code>par</code> list contains the following elements:
</p>

<ul>
<li> <p><code>log_L1</code>, predicted length at age <code>t1</code>
</p>
</li>
<li> <p><code>log_L2</code>, predicted length at age <code>t2</code>
</p>
</li>
<li> <p><code>log_k</code>, growth coefficient
</p>
</li>
<li> <p><code>log_sigma_min</code>, growth variability at the shortest observed
length in the data
</p>
</li>
<li> <p><code>log_sigma_max</code> (*), growth variability at the longest observed
length in the data
</p>
</li>
<li> <p><code>log_age</code> (*), age at release of tagged individuals (vector)
</p>
</li></ul>

<p>*: The parameter <code>log_sigma_max</code> can be omitted to estimate growth
variability that does not vary with length. The parameter vector
<code>log_age</code> can be omitted to fit to otoliths only.
</p>
<p>The <code>data</code> list contains the following elements:
</p>

<ul>
<li> <p><code>Aoto</code> (*), age from otoliths (vector)
</p>
</li>
<li> <p><code>Loto</code> (*), length from otoliths (vector)
</p>
</li>
<li> <p><code>Lrel</code> (*), length at release of tagged individuals (vector)
</p>
</li>
<li> <p><code>Lrec</code> (*), length at recapture of tagged individuals (vector)
</p>
</li>
<li> <p><code>liberty</code> (*), time at liberty of tagged individuals in years
(vector)
</p>
</li>
<li> <p><code>t1</code>, age where predicted length is <code>L1</code>
</p>
</li>
<li> <p><code>t2</code>, age where predicted length is <code>L2</code>
</p>
</li></ul>

<p>*: The data vectors <code>Aoto</code> and <code>Loto</code> can be omitted to fit to
tagging data only. The data vectors <code>Lrel</code>, <code>Lrec</code>, and
<code>liberty</code> can be omitted to fit to otoliths only.
</p>


<h3>Value</h3>

<p>The <code>vonbert</code> function returns a TMB model object, produced by
<code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.
</p>
<p>The <code>vonbert_curve</code> function returns a numeric vector of predicted
length at age.
</p>
<p>The <code>vonbert_objfun</code> function returns the negative log-likelihood as a
single number, describing the goodness of fit of <code>par</code> to the
<code>data</code>.
</p>


<h3>Note</h3>

<p>The Schnute-Fournier parametrization used in <code>vonbert</code> reduces parameter
correlation and improves convergence reliability compared to the traditional
parametrization used in <code><a href="#topic+vonberto">vonberto</a></code>. Therefore, the <code>vonbert</code>
parametrization can be recommended for general usage, as both
parametrizations produce the same growth curve. However, there can be some
use cases where the traditional parametrization (<code>Linf</code>, <code>k</code>,
<code>t0</code>) is preferred over the Schnute-Fournier parametrization (<code>L1</code>,
<code>L2</code>, <code>k</code>).
</p>
<p>The von Bertalanffy (1938) growth model, as parametrized by Schnute and
Fournier (1980), predicts length at age as:
</p>
<p style="text-align: center;"><code class="reqn">\hat L_t ~=~ L_1 \;+\; (L_2-L_1)\,
      \frac{1\,-\,e^{-k(t-t_1)}}{\,1\,-\,e^{-k(t_2-t_1)}\,}</code>
</p>

<p>The variability of length at age increases linearly with length,
</p>
<p style="text-align: center;"><code class="reqn">\sigma_L ~=~ \alpha \,+\, \beta \hat L</code>
</p>

<p>where the slope is <code class="reqn">\beta=(\sigma_{\max}-\sigma_{\min}) /
(L_{\max}-L_{\min})</code>, the
intercept is <code class="reqn">\alpha=\sigma_{\min} - \beta L_{\min}</code>, and <code class="reqn">L_{\min}</code> and <code class="reqn">L_{\max}</code> are the
shortest and longest observed lengths in the data. Alternatively, growth
variability can be modelled as a constant
<code class="reqn">\sigma_L=\sigma_{\min}</code> that does not vary with
length, by omitting <code>log_sigma_max</code> from the parameter list (see above).
</p>
<p>The negative log-likelihood is calculated by comparing the observed and
predicted lengths:
</p>
<pre>
  nll_Loto &lt;- -dnorm(Loto, Loto_hat, sigma_Loto, TRUE)
  nll_Lrel &lt;- -dnorm(Lrel, Lrel_hat, sigma_Lrel, TRUE)
  nll_Lrec &lt;- -dnorm(Lrec, Lrec_hat, sigma_Lrec, TRUE)
  nll &lt;- sum(nll_Loto) + sum(nll_Lrel) + sum(nll_Lrec)
</pre>


<h3>References</h3>

<p>von Bertalanffy, L. (1938).
A quantitative theory of organic growth.
<em>Human Biology</em>, <b>10</b>, 181-213.
<a href="https://www.jstor.org/stable/41447359">https://www.jstor.org/stable/41447359</a>.
</p>
<p>Schnute, J. and Fournier, D. (1980).
A new approach to length-frequency analysis: Growth structure.
<em>Canadian Journal of Fisheries and Aquatic Science</em>, <b>37</b>,
1337-1351.
<a href="https://doi.org/10.1139/f80-172">doi:10.1139/f80-172</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gcm">gcm</a></code>, <code><a href="#topic+gompertz">gompertz</a></code>, <code><a href="#topic+gompertzo">gompertzo</a></code>,
<code><a href="#topic+richards">richards</a></code>, <code><a href="#topic+richardso">richardso</a></code>, <code><a href="#topic+schnute3">schnute3</a></code>,
<code>vonbert</code>, and <code><a href="#topic+vonberto">vonberto</a></code> are alternative growth models.
</p>
<p><code><a href="#topic+pred_band">pred_band</a></code> calculates a prediction band for a fitted growth
model.
</p>
<p><code><a href="#topic+otoliths_had">otoliths_had</a></code>, <code><a href="#topic+otoliths_skj">otoliths_skj</a></code>, and
<code><a href="#topic+tags_skj">tags_skj</a></code> are example datasets.
</p>
<p><code><a href="#topic+fishgrowth-package">fishgrowth-package</a></code> gives an overview of the package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Model 1: Fit to haddock otoliths

# Explore initial parameter values
plot(len~age, otoliths_had, xlim=c(0,18), ylim=c(0,105), pch=16,
     col="#0080a010")
x &lt;- seq(1, 18, 0.1)
lines(x, vonbert_curve(x, L1=18, L2=67, k=0.1, t1=1, t2=10), lty=3)

# Prepare parameters and data
init &lt;- list(log_L1=log(18), log_L2=log(67), log_k=log(0.1),
             log_sigma_min=log(3), log_sigma_max=log(3))
dat &lt;- list(Aoto=otoliths_had$age, Loto=otoliths_had$len, t1=1, t2=10)
vonbert_objfun(init, dat)

# Fit model
model &lt;- vonbert(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
report &lt;- model$report()
sdreport &lt;- sdreport(model)

# Plot results
Lhat &lt;- with(report, vonbert_curve(x, L1, L2, k, t1, t2))
lines(x, Lhat, lwd=2, col=2)
legend("bottomright", c("initial curve","model fit"), col=c(1,2), lty=c(3,1),
       lwd=c(1,2), bty="n", inset=0.02, y.intersp=1.25)

# Model summary
report[c("L1", "L2", "k", "sigma_min", "sigma_max")]
fit[-1]
summary(sdreport)

# Plot 95% prediction band
band &lt;- pred_band(x, model)
areaplot::confplot(cbind(lower,upper)~age, band, xlim=c(0,18), ylim=c(0,100),
         ylab="len", col="mistyrose")
points(len~age, otoliths_had, xlim=c(0,18), ylim=c(0,100),
       pch=16, col="#0080a010")
lines(x, Lhat, lwd=2, col=2)
lines(lower~age, band, lty=1, lwd=0.5, col=2)
lines(upper~age, band, lty=1, lwd=0.5, col=2)

#############################################################################

# Model 2: Fit to skipjack otoliths and tags

# Explore initial parameter values
plot(len~age, otoliths_skj, xlim=c(0,4), ylim=c(0,100))
x &lt;- seq(0, 4, 0.1)
points(lenRel~I(lenRel/60), tags_skj, col=4)
points(lenRec~I(lenRel/60+liberty), tags_skj, col=3)
lines(x, vonbert_curve(x, L1=25, L2=75, k=0.8, t1=0, t2=4), lty=2)
legend("bottomright", c("otoliths","tag releases","tac recaptures",
       "initial curve"), col=c(1,4,3,1), pch=c(1,1,1,NA), lty=c(0,0,0,2),
       lwd=c(1.2,1.2,1.2,1), bty="n", inset=0.02, y.intersp=1.25)

# Prepare parameters and data
init &lt;- list(log_L1=log(25), log_L2=log(75), log_k=log(0.8),
             log_sigma_min=log(3), log_sigma_max=log(3),
             log_age=log(tags_skj$lenRel/60))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len,
            Lrel=tags_skj$lenRel, Lrec=tags_skj$lenRec,
            liberty=tags_skj$liberty, t1=0, t2=4)
vonbert_objfun(init, dat)

# Fit model
model &lt;- vonbert(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
report &lt;- model$report()
sdreport &lt;- sdreport(model)

# Plot results
plot(len~age, otoliths_skj, xlim=c(0,4), ylim=c(0,100))
points(report$age, report$Lrel, col=4)
points(report$age+report$liberty, report$Lrec, col=3)
Lhat &lt;- with(report, vonbert_curve(x, L1, L2, k, t1, t2))
lines(x, Lhat, lwd=2)
legend("bottomright", c("otoliths","tag releases","tac recaptures",
       "model fit"), col=c(1,4,3,1), pch=c(1,1,1,NA), lty=c(0,0,0,1),
       lwd=c(1.2,1.2,1.2,2), bty="n", inset=0.02, y.intersp=1.25)

# Model summary
report[c("L1", "L2", "k", "sigma_min", "sigma_max")]
fit[-1]
head(summary(sdreport), 5)

#############################################################################

# Model 3: Fit to skipjack otoliths only

init &lt;- list(log_L1=log(25), log_L2=log(75), log_k=log(0.8),
             log_sigma_min=log(3), log_sigma_max=log(3))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len, t1=0, t2=4)
model &lt;- vonbert(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("L1", "L2", "k", "sigma_min", "sigma_max")]

#############################################################################

# Model 4: Fit to skipjack otoliths only,
# but now estimating constant sigma instead of sigma varying by length

# We do this by omitting log_sigma_max
init &lt;- list(log_L1=log(25), log_L2=log(75), log_k=log(0.8),
             log_sigma_min=log(3))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len, t1=0, t2=4)
model &lt;- vonbert(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("L1", "L2", "k", "sigma_min")]

#############################################################################

# Model 5: Fit to skipjack tags only

init &lt;- list(log_L1=log(25), log_L2=log(75), log_k=log(0.8),
             log_sigma_min=log(3), log_sigma_max=log(3),
             log_age=log(tags_skj$lenRel/60))
dat &lt;- list(Lrel=tags_skj$lenRel, Lrec=tags_skj$lenRec,
            liberty=tags_skj$liberty, t1=0, t2=4)
model &lt;- vonbert(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("L1", "L2", "k", "sigma_min", "sigma_max")]

</code></pre>

<hr>
<h2 id='vonberto'>Von Bertalanffy Growth Model (Old Style)</h2><span id='topic+vonberto'></span><span id='topic+vonberto_curve'></span><span id='topic+vonberto_objfun'></span>

<h3>Description</h3>

<p>Fit a von Bertalanffy growth model to otoliths and/or tags, using a
traditional parametrization.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vonberto(par, data, silent = TRUE, ...)

vonberto_curve(t, Linf, k, t0)

vonberto_objfun(par, data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vonberto_+3A_par">par</code></td>
<td>
<p>a parameter list.</p>
</td></tr>
<tr><td><code id="vonberto_+3A_data">data</code></td>
<td>
<p>a data list.</p>
</td></tr>
<tr><td><code id="vonberto_+3A_silent">silent</code></td>
<td>
<p>passed to <code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.</p>
</td></tr>
<tr><td><code id="vonberto_+3A_...">...</code></td>
<td>
<p>passed to <code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.</p>
</td></tr>
<tr><td><code id="vonberto_+3A_t">t</code></td>
<td>
<p>age (vector).</p>
</td></tr>
<tr><td><code id="vonberto_+3A_linf">Linf</code></td>
<td>
<p>asymptotic maximum length.</p>
</td></tr>
<tr><td><code id="vonberto_+3A_k">k</code></td>
<td>
<p>growth coefficient.</p>
</td></tr>
<tr><td><code id="vonberto_+3A_t0">t0</code></td>
<td>
<p>age where the predicted length is zero, the x-intercept.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The main function <code>vonberto</code> creates a model object, ready for parameter
estimation. The auxiliary functions <code>vonberto_curve</code> and
<code>vonberto_objfun</code> are called by the main function to calculate the
regression curve and objective function value. The user can also call the
auxiliary functions directly for plotting and model exploration.
</p>
<p>The <code>par</code> list contains the following elements:
</p>

<ul>
<li> <p><code>log_Linf</code>, asymptotic maximum length
</p>
</li>
<li> <p><code>log_k</code>, growth coefficient
</p>
</li>
<li> <p><code>to</code>, age where the predicted length is zero, the x-intercept
</p>
</li>
<li> <p><code>log_sigma_min</code>, growth variability at the shortest observed
length in the data
</p>
</li>
<li> <p><code>log_sigma_max</code> (*), growth variability at the longest observed
length in the data
</p>
</li>
<li> <p><code>log_age</code> (*), age at release of tagged individuals (vector)
</p>
</li></ul>

<p>*: The parameter <code>log_sigma_max</code> can be omitted to estimate growth
variability that does not vary with length. The parameter vector
<code>log_age</code> can be omitted to fit to otoliths only.
</p>
<p>The <code>data</code> list contains the following elements:
</p>

<ul>
<li> <p><code>Aoto</code> (*), age from otoliths (vector)
</p>
</li>
<li> <p><code>Loto</code> (*), length from otoliths (vector)
</p>
</li>
<li> <p><code>Lrel</code> (*), length at release of tagged individuals (vector)
</p>
</li>
<li> <p><code>Lrec</code> (*), length at recapture of tagged individuals (vector)
</p>
</li>
<li> <p><code>liberty</code> (*), time at liberty of tagged individuals in years
(vector)
</p>
</li></ul>

<p>*: The data vectors <code>Aoto</code> and <code>Loto</code> can be omitted to fit to
tagging data only. The data vectors <code>Lrel</code>, <code>Lrec</code>, and
<code>liberty</code> can be omitted to fit to otoliths only.
</p>


<h3>Value</h3>

<p>The <code>vonberto</code> function returns a TMB model object, produced by
<code><a href="RTMB.html#topic+MakeADFun">MakeADFun</a></code>.
</p>
<p>The <code>vonberto_curve</code> function returns a numeric vector of predicted
length at age.
</p>
<p>The <code>vonberto_objfun</code> function returns the negative log-likelihood as a
single number, describing the goodness of fit of <code>par</code> to the
<code>data</code>.
</p>


<h3>Note</h3>

<p>The Schnute-Fournier parametrization used in <code><a href="#topic+vonbert">vonbert</a></code> reduces
parameter correlation and improves convergence reliability compared to the
traditional parametrization used in <code>vonberto</code>. Therefore, the
<code>vonbert</code> parametrization can be recommended for general usage, as both
parametrizations produce the same growth curve. However, there can be some
use cases where the traditional parametrization (<code>Linf</code>, <code>k</code>,
<code>t0</code>) is preferred over the Schnute-Fournier parametrization (<code>L1</code>,
<code>L2</code>, <code>k</code>).
</p>
<p>The von Bertalanffy (1938) growth model, as parametrized by Beverton and Holt
(1957), predicts length at age as:
</p>
<p style="text-align: center;"><code class="reqn">\hat L_t ~=~ L_\infty\left(1\,-\,e^{-k(t-t_0)}\right)</code>
</p>

<p>The variability of length at age increases linearly with length,
</p>
<p style="text-align: center;"><code class="reqn">\sigma_L ~=~ \alpha \,+\, \beta \hat L</code>
</p>

<p>where the slope is <code class="reqn">\beta=(\sigma_{\max}-\sigma_{\min}) /
(L_{\max}-L_{\min})</code>, the
intercept is <code class="reqn">\alpha=\sigma_{\min} - \beta L_{\min}</code>, and <code class="reqn">L_{\min}</code> and <code class="reqn">L_{\max}</code> are the
shortest and longest observed lengths in the data. Alternatively, growth
variability can be modelled as a constant
<code class="reqn">\sigma_L=\sigma_{\min}</code> that does not vary with
length, by omitting <code>log_sigma_max</code> from the parameter list (see above).
</p>
<p>The negative log-likelihood is calculated by comparing the observed and
predicted lengths:
</p>
<pre>
  nll_Loto &lt;- -dnorm(Loto, Loto_hat, sigma_Loto, TRUE)
  nll_Lrel &lt;- -dnorm(Lrel, Lrel_hat, sigma_Lrel, TRUE)
  nll_Lrec &lt;- -dnorm(Lrec, Lrec_hat, sigma_Lrec, TRUE)
  nll &lt;- sum(nll_Loto) + sum(nll_Lrel) + sum(nll_Lrec)
</pre>


<h3>References</h3>

<p>von Bertalanffy, L. (1938).
A quantitative theory of organic growth.
<em>Human Biology</em>, <b>10</b>, 181-213.
<a href="https://www.jstor.org/stable/41447359">https://www.jstor.org/stable/41447359</a>.
</p>
<p>Beverton, R.J.H. and Holt, S.J. (1957).
<em>On the dynamics of exploited fish populations</em>.
London: Her Majesty's Stationery Office.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gcm">gcm</a></code>, <code><a href="#topic+gompertz">gompertz</a></code>, <code><a href="#topic+gompertzo">gompertzo</a></code>,
<code><a href="#topic+richards">richards</a></code>, <code><a href="#topic+richards">richards</a></code>, <code><a href="#topic+schnute3">schnute3</a></code>,
<code><a href="#topic+vonbert">vonbert</a></code>, and <code>vonberto</code> are alternative growth models.
</p>
<p><code><a href="#topic+pred_band">pred_band</a></code> calculates a prediction band for a fitted growth
model.
</p>
<p><code><a href="#topic+otoliths_had">otoliths_had</a></code>, <code><a href="#topic+otoliths_skj">otoliths_skj</a></code>, and
<code><a href="#topic+tags_skj">tags_skj</a></code> are example datasets.
</p>
<p><code><a href="#topic+fishgrowth-package">fishgrowth-package</a></code> gives an overview of the package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Model 1: Fit to haddock otoliths

# Explore initial parameter values
plot(len~age, otoliths_had, xlim=c(0,18), ylim=c(0,105), pch=16,
     col="#0080a010")
x &lt;- seq(1, 18, 0.1)
lines(x, vonberto_curve(x, Linf=100, k=0.1, t0=-1), lty=3)

# Prepare parameters and data
init &lt;- list(log_Linf=log(100), log_k=log(0.1), t0=-1,
             log_sigma_min=log(3), log_sigma_max=log(3))
dat &lt;- list(Aoto=otoliths_had$age, Loto=otoliths_had$len)
vonberto_objfun(init, dat)

# Fit model
model &lt;- vonberto(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
report &lt;- model$report()
sdreport &lt;- sdreport(model)

# Plot results
Lhat &lt;- with(report, vonberto_curve(x, Linf, k, t0))
lines(x, Lhat, lwd=2, col=2)
legend("bottomright", c("initial curve","model fit"), col=c(1,2), lty=c(3,1),
       lwd=c(1,2), bty="n", inset=0.02, y.intersp=1.25)

# Model summary
report[c("Linf", "k", "t0", "sigma_min", "sigma_max")]
fit[-1]
summary(sdreport)

# Plot 95% prediction band
band &lt;- pred_band(x, model)
areaplot::confplot(cbind(lower,upper)~age, band, xlim=c(0,18), ylim=c(0,100),
         ylab="len", col="mistyrose")
points(len~age, otoliths_had, xlim=c(0,18), ylim=c(0,100),
       pch=16, col="#0080a010")
lines(x, Lhat, lwd=2, col=2)
lines(lower~age, band, lty=1, lwd=0.5, col=2)
lines(upper~age, band, lty=1, lwd=0.5, col=2)

#############################################################################

# Model 2: Fit to skipjack otoliths and tags

# Explore initial parameter values
plot(len~age, otoliths_skj, xlim=c(0,4), ylim=c(0,100))
x &lt;- seq(0, 4, 0.1)
points(lenRel~I(lenRel/60), tags_skj, col=4)
points(lenRec~I(lenRel/60+liberty), tags_skj, col=3)
lines(x, vonberto_curve(x, Linf=80, k=0.8, t0=-0.5), lty=2)
legend("bottomright", c("otoliths","tag releases","tac recaptures",
       "initial curve"), col=c(1,4,3,1), pch=c(1,1,1,NA), lty=c(0,0,0,2),
       lwd=c(1.2,1.2,1.2,1), bty="n", inset=0.02, y.intersp=1.25)

# Prepare parameters and data
init &lt;- list(log_Linf=log(80), log_k=log(0.8), t0=-0.5,
             log_sigma_min=log(3), log_sigma_max=log(3),
             log_age=log(tags_skj$lenRel/60))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len,
            Lrel=tags_skj$lenRel, Lrec=tags_skj$lenRec,
            liberty=tags_skj$liberty)
vonberto_objfun(init, dat)

# Fit model
model &lt;- vonberto(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
report &lt;- model$report()
sdreport &lt;- sdreport(model)

# Plot results
plot(len~age, otoliths_skj, xlim=c(0,4), ylim=c(0,100))
points(report$age, report$Lrel, col=4)
points(report$age+report$liberty, report$Lrec, col=3)
Lhat &lt;- with(report, vonberto_curve(x, Linf, k, t0))
lines(x, Lhat, lwd=2)
legend("bottomright", c("otoliths","tag releases","tac recaptures",
       "model fit"), col=c(1,4,3,1), pch=c(1,1,1,NA), lty=c(0,0,0,1),
       lwd=c(1.2,1.2,1.2,2), bty="n", inset=0.02, y.intersp=1.25)

# Model summary
report[c("Linf", "k", "t0", "sigma_min", "sigma_max")]
fit[-1]
head(summary(sdreport), 5)

#############################################################################

# Model 3: Fit to skipjack otoliths only

init &lt;- list(log_Linf=log(80), log_k=log(0.8), t0=-0.5,
             log_sigma_min=log(3), log_sigma_max=log(3))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len)
model &lt;- vonberto(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("Linf", "k", "t0", "sigma_min", "sigma_max")]

#############################################################################

# Model 4: Fit to skipjack otoliths only,
# but now estimating constant sigma instead of sigma varying by length

# We do this by omitting log_sigma_max
init &lt;- list(log_Linf=log(80), log_k=log(0.8), t0=-0.5,
             log_sigma_min=log(3))
dat &lt;- list(Aoto=otoliths_skj$age, Loto=otoliths_skj$len)
model &lt;- vonberto(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("Linf", "k", "t0", "sigma_min")]

#############################################################################

# Model 5: Fit to skipjack tags only

init &lt;- list(log_Linf=log(80), log_k=log(0.8), t0=-0.5,
             log_sigma_min=log(3), log_sigma_max=log(3),
             log_age=log(tags_skj$lenRel/60))
dat &lt;- list(Lrel=tags_skj$lenRel, Lrec=tags_skj$lenRec,
            liberty=tags_skj$liberty)
model &lt;- vonberto(init, dat)
fit &lt;- nlminb(model$par, model$fn, model$gr,
              control=list(eval.max=1e4, iter.max=1e4))
model$report()[c("Linf", "k", "t0", "sigma_min", "sigma_max")]

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
