<!DOCTYPE html><html><head><title>Help for package simodels</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {simodels}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#simodels-package'><p>simodels: Flexible Framework for Developing Spatial Interaction Models</p></a></li>
<li><a href='#od_aus'><p>Example OD dataset: flows between regions in Australia</p></a></li>
<li><a href='#si_calculate'><p>Calculate flow using a pre-existing function</p></a></li>
<li><a href='#si_od_census'><p>Example OD dataset</p></a></li>
<li><a href='#si_predict'><p>Predict spatial interaction based on pre-trained model</p></a></li>
<li><a href='#si_pubs'><p>Example destinations dataset: pubs in Leeds</p></a></li>
<li><a href='#si_to_od'><p>Prepare OD data frame</p></a></li>
<li><a href='#si_zones'><p>Example zones and centroids</p></a></li>
<li><a href='#zones_aus'><p>Example zones dataset: regions of Australia</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Flexible Framework for Developing Spatial Interaction Models</td>
</tr>
<tr>
<td>Version:</td>
<td>0.0.5</td>
</tr>
<tr>
<td>Description:</td>
<td>Develop spatial interaction models (SIMs).  SIMs predict the
    amount of interaction, for example number of trips per day, between
    geographic entities representing trip origins and destinations.
    Contains functions for creating origin-destination datasets
    from geographic input datasets and calculating movement between
    origin-destination pairs with constrained, production-constrained,
    and attraction-constrained models (Wilson 1979) &lt;<a href="https://doi.org/10.1068%2Fa030001">doi:10.1068/a030001</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/AGPL-3">AGPL (&ge; 3)</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/robinlovelace/simodels">https://github.com/robinlovelace/simodels</a>,
<a href="https://robinlovelace.github.io/simodels/">https://robinlovelace.github.io/simodels/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/robinlovelace/simodels/issues">https://github.com/robinlovelace/simodels/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, geodist, od (&ge; 0.4.0), rlang, sf</td>
</tr>
<tr>
<td>Suggests:</td>
<td>ggplot2, knitr, minpack.lm, rmarkdown, tmap</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-08-31 20:56:36 UTC; robin</td>
</tr>
<tr>
<td>Author:</td>
<td>Robin Lovelace <a href="https://orcid.org/0000-0001-5679-6536"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Jakub Nowosad <a href="https://orcid.org/0000-0002-1057-3721"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Robin Lovelace &lt;rob00x@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-08-31 21:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='simodels-package'>simodels: Flexible Framework for Developing Spatial Interaction Models</h2><span id='topic+simodels'></span><span id='topic+simodels-package'></span>

<h3>Description</h3>

<p>Develop spatial interaction models (SIMs). SIMs predict the amount of interaction, for example number of trips per day, between geographic entities representing trip origins and destinations. Contains functions for creating origin-destination datasets from geographic input datasets and calculating movement between origin-destination pairs with constrained, production-constrained, and attraction-constrained models (Wilson 1979) <a href="https://doi.org/10.1068/a030001">doi:10.1068/a030001</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Robin Lovelace <a href="mailto:rob00x@gmail.com">rob00x@gmail.com</a> (<a href="https://orcid.org/0000-0001-5679-6536">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Jakub Nowosad <a href="mailto:nowosad.jakub@gmail.com">nowosad.jakub@gmail.com</a> (<a href="https://orcid.org/0000-0002-1057-3721">ORCID</a>)
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/robinlovelace/simodels">https://github.com/robinlovelace/simodels</a>
</p>
</li>
<li> <p><a href="https://robinlovelace.github.io/simodels/">https://robinlovelace.github.io/simodels/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/robinlovelace/simodels/issues">https://github.com/robinlovelace/simodels/issues</a>
</p>
</li></ul>


<hr>
<h2 id='od_aus'>Example OD dataset: flows between regions in Australia</h2><span id='topic+od_aus'></span>

<h3>Description</h3>

<p>Example dataset from Australia
</p>


<h3>Note</h3>

<p>Regenerate the data with scripts in the <code>data-raw</code> directory.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>head(od_aus)
</code></pre>

<hr>
<h2 id='si_calculate'>Calculate flow using a pre-existing function</h2><span id='topic+si_calculate'></span>

<h3>Description</h3>

<p>Executes a spatial interaction model based on an OD data frame
and user-specified function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>si_calculate(
  od,
  fun,
  constraint_production,
  constraint_attraction,
  constraint_total,
  output_col = "interaction",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="si_calculate_+3A_od">od</code></td>
<td>
<p>A data frame representing origin-destination data, e.g. as created by
<code><a href="#topic+si_to_od">si_to_od()</a></code></p>
</td></tr>
<tr><td><code id="si_calculate_+3A_fun">fun</code></td>
<td>
<p>A function that calculates the interaction (e.g. the number of trips)
between each OD pair</p>
</td></tr>
<tr><td><code id="si_calculate_+3A_constraint_production">constraint_production</code></td>
<td>
<p>Character representing column in <code>od</code>.
This argument, when set, ensures that the outputs are 'production constrained':
the total 'interaction' (e.g. n. trips) for all OD pairs is set such that
the total for each zone of origin cannot go above this value.</p>
</td></tr>
<tr><td><code id="si_calculate_+3A_constraint_attraction">constraint_attraction</code></td>
<td>
<p>Character representing column in <code>od</code>.
This argument, when set, ensures that the outputs are 'attraction constrained':
the total 'interaction' (e.g. n. trips) for all OD pairs is set such that
the sum of trips to destination is equal to the mean value per destination.</p>
</td></tr>
<tr><td><code id="si_calculate_+3A_constraint_total">constraint_total</code></td>
<td>
<p>Single number representing the total interaction.
This argument, when set, ensures that the sum of the interaction
calculated will equal the value given.</p>
</td></tr>
<tr><td><code id="si_calculate_+3A_output_col">output_col</code></td>
<td>
<p>Character string containing the name of the new output
column. <code>"interaction"</code> by default.</p>
</td></tr>
<tr><td><code id="si_calculate_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code>fun</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>An sf data frame
</p>


<h3>Examples</h3>

<pre><code class='language-R'>od = si_to_od(si_zones, si_zones, max_dist = 4000)
fun_dd = function(d = "distance_euclidean", beta = 0.3) exp(-beta * d / 1000)
fun_dd(d = (1:5)*1000)
od_dd = si_calculate(od, fun = fun_dd, d = distance_euclidean)
plot(od$distance_euclidean, od_dd$interaction)
fun = function(O, n, d, beta) O * n * exp(-beta * d / 1000)
od_output = si_calculate(od, fun = fun, beta = 0.3, O = origin_all, 
  n = destination_all, d = distance_euclidean)
head(od_output)
plot(od$distance_euclidean, od_output$interaction)
od_pconst = si_calculate(od, fun = fun, beta = 0.3, O = origin_all,
  n = destination_all, d = distance_euclidean, constraint_production = origin_all)
plot(od_pconst$distance_euclidean, od_pconst$interaction)
plot(od_pconst["interaction"], logz = TRUE)
od_dd = si_calculate(od, fun = fun_dd, d = distance_euclidean, output_col = "res")
head(od_dd$res)
od_dd = si_calculate(od, fun = fun_dd, d = distance_euclidean, constraint_total = 10)
sum(od_dd$interaction)
</code></pre>

<hr>
<h2 id='si_od_census'>Example OD dataset</h2><span id='topic+si_od_census'></span>

<h3>Description</h3>

<p>Example OD dataset from the 2011 UK Census
</p>


<h3>Note</h3>

<p>Regenerate the data with scripts in the <code>data-raw</code> directory.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>head(si_od_census)
</code></pre>

<hr>
<h2 id='si_predict'>Predict spatial interaction based on pre-trained model</h2><span id='topic+si_predict'></span>

<h3>Description</h3>

<p>Predict spatial interaction based on pre-trained model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>si_predict(
  od,
  model,
  constraint_production,
  constraint_attraction,
  constraint_total,
  output_col = "interaction",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="si_predict_+3A_od">od</code></td>
<td>
<p>A data frame representing origin-destination data, e.g. as created by
<code><a href="#topic+si_to_od">si_to_od()</a></code></p>
</td></tr>
<tr><td><code id="si_predict_+3A_model">model</code></td>
<td>
<p>A model object, e.g. from <code><a href="stats.html#topic+lm">lm()</a></code> or <code><a href="stats.html#topic+glm">glm()</a></code></p>
</td></tr>
<tr><td><code id="si_predict_+3A_constraint_production">constraint_production</code></td>
<td>
<p>Character representing column in <code>od</code>.
This argument, when set, ensures that the outputs are 'production constrained':
the total 'interaction' (e.g. n. trips) for all OD pairs is set such that
the total for each zone of origin cannot go above this value.</p>
</td></tr>
<tr><td><code id="si_predict_+3A_constraint_attraction">constraint_attraction</code></td>
<td>
<p>Character representing column in <code>od</code>.
This argument, when set, ensures that the outputs are 'attraction constrained':
the total 'interaction' (e.g. n. trips) for all OD pairs is set such that
the sum of trips to destination is equal to the mean value per destination.</p>
</td></tr>
<tr><td><code id="si_predict_+3A_constraint_total">constraint_total</code></td>
<td>
<p>Single number representing the total interaction.
This argument, when set, ensures that the sum of the interaction
calculated will equal the value given.</p>
</td></tr>
<tr><td><code id="si_predict_+3A_output_col">output_col</code></td>
<td>
<p>Character string containing the name of the new output
column. <code>"interaction"</code> by default.</p>
</td></tr>
<tr><td><code id="si_predict_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code>fun</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>An sf data frame
</p>


<h3>See Also</h3>

<p>si_calculate
</p>


<h3>Examples</h3>

<pre><code class='language-R'>od = si_to_od(si_zones, si_zones, max_dist = 4000)
m = lm(od$origin_all ~ od$origin_bicycle)
od_updated = si_predict(od, m)
</code></pre>

<hr>
<h2 id='si_pubs'>Example destinations dataset: pubs in Leeds</h2><span id='topic+si_pubs'></span>

<h3>Description</h3>

<p>Example dataset from Leeds, UK
</p>


<h3>Note</h3>

<p>Regenerate the data with scripts in the <code>data-raw</code> directory.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>head(si_pubs)
</code></pre>

<hr>
<h2 id='si_to_od'>Prepare OD data frame</h2><span id='topic+si_to_od'></span>

<h3>Description</h3>

<p>Prepares an OD data frame that next could be used to
estimate movement between origins and destinations
with a spatial interaction model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>si_to_od(origins, destinations, max_dist = Inf, intrazonal = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="si_to_od_+3A_origins">origins</code></td>
<td>
<p><code>sf</code> object representing origin locations/zones</p>
</td></tr>
<tr><td><code id="si_to_od_+3A_destinations">destinations</code></td>
<td>
<p><code>sf</code> object representing destination locations/zones</p>
</td></tr>
<tr><td><code id="si_to_od_+3A_max_dist">max_dist</code></td>
<td>
<p>Euclidean distance in meters (numeric).
Only OD pairs that are this distance apart or less will be returned
and therefore included in the SIM.</p>
</td></tr>
<tr><td><code id="si_to_od_+3A_intrazonal">intrazonal</code></td>
<td>
<p>Include intrazonal OD pairs?
Intrazonal OD pairs represent movement from one
place in a zone to another place in the same zone.
<code>TRUE</code> by default.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In most origin-destination datasets the spatial entities that constitute
origins (typically administrative zones) also represent destinations.
In this 'unipartite' case <code>origins</code> and <code>destinations</code> should be passed
the same object, an <code>sf</code> data frame representing administrative zones.
</p>
<p>'Bipartite' datasets, by contrast, represent
&quot;spatial interaction systems where origins cannot act as
destinations and vice versa&quot; (Hasova et al. <a href="https://lenkahas.com/files/preprint.pdf">2022</a>).
</p>
<p>a different
<code>sf</code> object can be passed to the <code>destinations</code> argument.
</p>


<h3>Value</h3>

<p>An sf data frame
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(sf)
origins = si_centroids[c(1, 2, 99), ]
destinations = origins
plot(origins$geometry)
odsf = si_to_od(origins, destinations, max_dist = 1200)
plot(odsf)
# note: result contains intrazonal flows represented by linestrings
# with a length of 0, e.g.:
sf::st_coordinates(odsf$geometry[1])
# With different destinations compared with origins
library(sf)
origins = si_centroids[c(2, 99), c(1, 6, 7)]
destinations = si_centroids[1, c(1, 6, 8)]
odsf = si_to_od(origins, destinations)
nrow(odsf) # no intrazonal flows
plot(odsf)
</code></pre>

<hr>
<h2 id='si_zones'>Example zones and centroids</h2><span id='topic+si_zones'></span><span id='topic+si_centroids'></span>

<h3>Description</h3>

<p><code>si_zones</code> and <code>si_centroids</code> represent administrative zones between which
flows are to be estimated.
</p>


<h3>Note</h3>

<p>The schema data can be (re-)generated using code in <code>data-raw</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>si_zones
plot(si_zones$geometry)
plot(si_centroids$geometry, add = TRUE)
</code></pre>

<hr>
<h2 id='zones_aus'>Example zones dataset: regions of Australia</h2><span id='topic+zones_aus'></span>

<h3>Description</h3>

<p>Example dataset from Australia
</p>


<h3>Note</h3>

<p>Regenerate the data with scripts in the <code>data-raw</code> directory.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>head(zones_aus)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
