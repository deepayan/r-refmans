<!DOCTYPE html><html><head><title>Help for package ruminate</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ruminate}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ruminate'><p>ruminate: Shiny app and module to facilitate pharamacometrics analysis</p></a></li>
<li><a href='#apply_route_map'><p>Applies Route Mapping to Dataset</p></a></li>
<li><a href='#dose_records_builder'><p>Builds Dose Records Dataframe</p></a></li>
<li><a href='#mk_figure_ind_obs'><p>Creates Figures of Individual Observations from PKNCA Result</p></a></li>
<li><a href='#mk_table_ind_obs'><p>Creates Tables of Individual Observations from PKNCA Result</p></a></li>
<li><a href='#mk_table_nca_params'><p>Create Tabular Output from PKNCA Results</p></a></li>
<li><a href='#NCA_add_int'><p>Adds Analysis Interval to Current Analysis</p></a></li>
<li><a href='#NCA_append_report'><p>Append Report Elements</p></a></li>
<li><a href='#nca_builder'><p>Builds NCA Code from ui Elements</p></a></li>
<li><a href='#NCA_fetch_ana_ds'><p>Fetch Analysis Dataset</p></a></li>
<li><a href='#NCA_fetch_ana_pknca'><p>Fetch PKNCA Results Object</p></a></li>
<li><a href='#NCA_fetch_code'><p>Fetch Module Code</p></a></li>
<li><a href='#NCA_fetch_current_ana'><p>Fetches Current Analysis</p></a></li>
<li><a href='#NCA_fetch_current_obj'><p>Fetches the Current Analysis Object</p></a></li>
<li><a href='#NCA_fetch_data_format'><p>Fetches Details About Data Requirements</p></a></li>
<li><a href='#NCA_fetch_ds'><p>Fetch Module Datasets</p></a></li>
<li><a href='#NCA_fetch_np_meta'><p>Fetches NCA Parameter Meta Information</p></a></li>
<li><a href='#NCA_fetch_PKNCA_meta'><p>Fetches PKNCA Metadata</p></a></li>
<li><a href='#NCA_fetch_state'><p>Fetch ruminate State</p></a></li>
<li><a href='#NCA_find_col'><p>Determines Default Column Name</p></a></li>
<li><a href='#NCA_init_state'><p>Initialize NCA Module State</p></a></li>
<li><a href='#NCA_load_scenario'><p>Loads Pre-Defined Scenario</p></a></li>
<li><a href='#NCA_mkactive_ana'><p>Fetch PKNCA Results Object</p></a></li>
<li><a href='#NCA_new_ana'><p>Initialize New Analysis</p></a></li>
<li><a href='#NCA_process_current_ana'><p>Processes Current Analysis to be Run</p></a></li>
<li><a href='#NCA_Server'><p>Fetch Non-Compartmental Analysis State</p></a></li>
<li><a href='#NCA_set_current_ana'><p>Sets Current Analysis</p></a></li>
<li><a href='#NCA_test_mksession'><p>Populate Session Data for Module Testing</p></a></li>
<li><a href='#ruminate_check'><p>Checks <code>ruminate</code> Dependencies</p></a></li>
<li><a href='#run_nca_components'><p>Runs NCA for the Current Analysis</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>A Pharmacometrics Data Transformation and Analysis Tool</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.4</td>
</tr>
<tr>
<td>Description:</td>
<td>Exploration of pharmacometrics data involves both general tools (transformation and plotting) and specific techniques (non-compartmental analysis). This kind of exploration is generally accomplished by utilizing different packages. The purpose of 'ruminate' is to create a 'shiny' interface to make these tools more broadly available while creating reproducible results.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/BSD-2-Clause">BSD_2_clause</a> + file LICENSE</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/john-harrold/ruminate/issues">https://github.com/john-harrold/ruminate/issues</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://ruminate.ubiquity.tools/">https://ruminate.ubiquity.tools/</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.2.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>digest, dplyr, DT, flextable, formods (&ge; 0.1.6), ggplot2,
onbrand (&ge; 1.0.3), PKNCA (&ge; 0.10.2), plotly, rhandsontable,
rlang, shiny, shinyAce, shinyWidgets, rxode2 (&ge; 2.1.2), stats,
stringr, tidyr, utils, yaml</td>
</tr>
<tr>
<td>Suggests:</td>
<td>cli, clipr, gridExtra, knitr, nlmixr2lib, nonmem2rx,
prompter, rmarkdown, readxl, rxode2et, shinydashboard, testthat
(&ge; 3.0.0), ubiquity</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-05-27 05:13:29 UTC; jmh</td>
</tr>
<tr>
<td>Author:</td>
<td>John Harrold <a href="https://orcid.org/0000-0003-2052-4373"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>John Harrold &lt;john.m.harrold@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-05-28 02:20:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='ruminate'>ruminate: Shiny app and module to facilitate pharamacometrics analysis</h2><span id='topic+ruminate-package'></span><span id='topic+ruminate'></span>

<h3>Description</h3>

<p>This is done by creating a Shiny interface to different tools for data
transformation (<code>dplyr</code> and <code>tidyr</code>), plotting (<code>ggplot2</code>), and
noncompartmental analysis (<code>PKNCA</code>). These results can be reported in Excel,
Word or PowerPoint. The state of the app can be saved and loaded at a later
date. When saved, a script is generated to reproduce the different actions in
the Shiny interface.
</p>
<p>Runs the pharmacometrics ruminate app.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ruminate(
  host = "127.0.0.1",
  port = 3838,
  server_opts = list(shiny.maxRequestSize = 30 * 1024^2),
  mksession = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ruminate_+3A_host">host</code></td>
<td>
<p>Hostname of the server (&quot;127.0.0.1&quot;)</p>
</td></tr>
<tr><td><code id="ruminate_+3A_port">port</code></td>
<td>
<p>Port number for the app (3838)</p>
</td></tr>
<tr><td><code id="ruminate_+3A_server_opts">server_opts</code></td>
<td>
<p>List of options (names) and their vlues (value) e.g.
<code>list(shiny.maxRequestSize = 30 * 1024^2)</code>.</p>
</td></tr>
<tr><td><code id="ruminate_+3A_mksession">mksession</code></td>
<td>
<p>Boolean value, when TRUE will load test session data
for app testing</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing is returned, this function just runs the built-in ruminate
app.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: John Harrold <a href="mailto:john.m.harrold@gmail.com">john.m.harrold@gmail.com</a> (<a href="https://orcid.org/0000-0003-2052-4373">ORCID</a>)
</p>


<h3>See Also</h3>

<p><a href="https://ruminate.ubiquity.tools/">https://ruminate.ubiquity.tools/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if (interactive()) {
ruminate()
}
</code></pre>

<hr>
<h2 id='apply_route_map'>Applies Route Mapping to Dataset</h2><span id='topic+apply_route_map'></span>

<h3>Description</h3>

<p>Used to convert nonstandard dose route values (i.e. &quot;IV&quot;) to
standard values (&quot;intravascular&quot;).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apply_route_map(route_map = list(), route_col = NULL, DS = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apply_route_map_+3A_route_map">route_map</code></td>
<td>
<p>List with names corresponding to the route replacement and
a vector of regular expressions to match.</p>
</td></tr>
<tr><td><code id="apply_route_map_+3A_route_col">route_col</code></td>
<td>
<p>Column name with the route data.</p>
</td></tr>
<tr><td><code id="apply_route_map_+3A_ds">DS</code></td>
<td>
<p>Dataframe containing the dataset.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Dataset with the route mapping applied.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(system.file(package="readxl") !=""){
library(readxl)
#loading a dataset
data_file =  system.file(package="formods","test_data","TEST_DATA.xlsx")
myDS = readxl::read_excel(path=data_file, sheet="DATA")

 route_map = list(
   intravascular = c("^(?i)iv$"),
   extravascular = c("^(?i)sc$", "^(?i)oral")
 )

utils::head(myDS[["ROUTE"]])

myDS = apply_route_map(route_map = route_map,
                       route_col = "ROUTE",
                       DS        = myDS)

utils::head(myDS[["ROUTE"]])
}
</code></pre>

<hr>
<h2 id='dose_records_builder'>Builds Dose Records Dataframe</h2><span id='topic+dose_records_builder'></span>

<h3>Description</h3>

<p>Takes information about columns in dataset and constructs the
dosing records.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dose_records_builder(
  NCA_DS = NULL,
  dose_from = NULL,
  col_id = NULL,
  col_time = NULL,
  col_ntime = NULL,
  col_route = NULL,
  col_dose = NULL,
  col_cycle = NULL,
  col_dur = NULL,
  col_evid = NULL,
  col_analyte = NULL,
  col_group = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dose_records_builder_+3A_nca_ds">NCA_DS</code></td>
<td>
<p>Dataset containing dosing records.</p>
</td></tr>
<tr><td><code id="dose_records_builder_+3A_dose_from">dose_from</code></td>
<td>
<p>Method of dose extraction either &quot;cols&quot; or &quot;rows&quot;.</p>
</td></tr>
<tr><td><code id="dose_records_builder_+3A_col_id">col_id</code></td>
<td>
<p>Name of column with subject ID.</p>
</td></tr>
<tr><td><code id="dose_records_builder_+3A_col_time">col_time</code></td>
<td>
<p>Name of column with time since first dose.</p>
</td></tr>
<tr><td><code id="dose_records_builder_+3A_col_ntime">col_ntime</code></td>
<td>
<p>Name of column with time since the last dose (required with <code>dose_from="cols"</code>).</p>
</td></tr>
<tr><td><code id="dose_records_builder_+3A_col_route">col_route</code></td>
<td>
<p>Name of column with route information.</p>
</td></tr>
<tr><td><code id="dose_records_builder_+3A_col_dose">col_dose</code></td>
<td>
<p>Name of column with last dose given.</p>
</td></tr>
<tr><td><code id="dose_records_builder_+3A_col_cycle">col_cycle</code></td>
<td>
<p>Name of column with dose cycle (required with <code>dose_from="cols"</code>).</p>
</td></tr>
<tr><td><code id="dose_records_builder_+3A_col_dur">col_dur</code></td>
<td>
<p>Name of column with dose duration.</p>
</td></tr>
<tr><td><code id="dose_records_builder_+3A_col_evid">col_evid</code></td>
<td>
<p>Name of column with event ID (required with <code>dose_from="rows"</code>).</p>
</td></tr>
<tr><td><code id="dose_records_builder_+3A_col_analyte">col_analyte</code></td>
<td>
<p>Name of column with analyte (optional).</p>
</td></tr>
<tr><td><code id="dose_records_builder_+3A_col_group">col_group</code></td>
<td>
<p>Names of columns with grouping information (optionl).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list containing the following elements
</p>

<ul>
<li><p>isgood:           Return status of the function.
</p>
</li>
<li><p>msgs:             Messages to be passed back to the user.
</p>
</li>
<li><p>dose_rec:
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
if(system.file(package="readxl") !=""){
library(dplyr)
library(readxl)
library(stringr)

# Example data file:
data_file =  system.file(package="formods","test_data","TEST_DATA.xlsx")

# Dataset formatted to extract dosing from columns
DS_cols = readxl::read_excel(path=data_file, sheet="DATA")        |&gt;
 dplyr::filter(EVID == 0)                                |&gt;
 dplyr::filter(DOSE %in% c(3))                           |&gt;
 dplyr::filter(str_detect(string=Cohort, "^MD"))         |&gt;
 dplyr::filter(CMT == "C_ng_ml")

drb_res = dose_records_builder(
 NCA_DS     = DS_cols,
 dose_from  = "cols",
 col_id     = "ID",
 col_time   = "TIME_DY",
 col_ntime  = "NTIME_DY",
 col_route  = "ROUTE",
 col_cycle  = "DOSE_NUM",
 col_dose   = "DOSE",
 col_group  = "Cohort")

utils::head(drb_res$dose_rec)

# Dataset formatted to extract dosing from rows (records)
DS_rows = readxl::read_excel(path=data_file, sheet="DATA")        |&gt;
 dplyr::filter(DOSE %in% c(3))                                   |&gt;
 dplyr::filter(str_detect(string=Cohort, "^MD"))                 |&gt;
 dplyr::filter(CMT %in% c("Ac", "C_ng_ml"))

drb_res = dose_records_builder(
 NCA_DS     = DS_rows,
 dose_from  = "rows",
 col_id     = "ID",
 col_time   = "TIME_DY",
 col_ntime  = "NTIME_DY",
 col_route  = "ROUTE",
 col_dose   = "AMT",
 col_evid   = "EVID",
 col_group  = "Cohort")

utils::head(drb_res$dose_rec)
}
</code></pre>

<hr>
<h2 id='mk_figure_ind_obs'>Creates Figures of Individual Observations from PKNCA Result</h2><span id='topic+mk_figure_ind_obs'></span>

<h3>Description</h3>

<p>Takes the output of PKNCA and creates <code>ggplot</code> figures faceted
by subject id highlighting of certain NCA aspects (e.g. points used for half-life)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mk_figure_ind_obs(
  nca_res,
  OBS_LAB = "Concentration ===CONCUNITS===",
  TIME_LAB = "Time ===TIMEUNITS===",
  OBS_STRING = "Observation",
  BLQ_STRING = "BLQ",
  NA_STRING = "Missing",
  log_scale = TRUE,
  scales = "fixed",
  nfrows = 4,
  nfcols = 3
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mk_figure_ind_obs_+3A_nca_res">nca_res</code></td>
<td>
<p>Output of PKNCA.</p>
</td></tr>
<tr><td><code id="mk_figure_ind_obs_+3A_obs_lab">OBS_LAB</code></td>
<td>
<p>Label of the observation axis with optional ===CONCUNITS=== placeholder for units.</p>
</td></tr>
<tr><td><code id="mk_figure_ind_obs_+3A_time_lab">TIME_LAB</code></td>
<td>
<p>Label of the time axis with optional ===TIMEUNITS=== placeholder for units.</p>
</td></tr>
<tr><td><code id="mk_figure_ind_obs_+3A_obs_string">OBS_STRING</code></td>
<td>
<p>Label for observation data.</p>
</td></tr>
<tr><td><code id="mk_figure_ind_obs_+3A_blq_string">BLQ_STRING</code></td>
<td>
<p>Label for BLQ data.</p>
</td></tr>
<tr><td><code id="mk_figure_ind_obs_+3A_na_string">NA_STRING</code></td>
<td>
<p>Label for missing data.</p>
</td></tr>
<tr><td><code id="mk_figure_ind_obs_+3A_log_scale">log_scale</code></td>
<td>
<p>Boolean variable to control y-scale (<code>TRUE</code>: Log 10, <code>FALSE</code>: linear).</p>
</td></tr>
<tr><td><code id="mk_figure_ind_obs_+3A_scales">scales</code></td>
<td>
<p>String to determine the scales used when faceting. Can be either <code>"fixed"</code>, <code>"free"</code>, <code>"free_x"</code>, or <code>"free_y"</code>.</p>
</td></tr>
<tr><td><code id="mk_figure_ind_obs_+3A_nfrows">nfrows</code></td>
<td>
<p>Number of facet rows per page.</p>
</td></tr>
<tr><td><code id="mk_figure_ind_obs_+3A_nfcols">nfcols</code></td>
<td>
<p>Number of facet cols per page.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List containing the element <code>figures</code> which is a list of figure
pages (<code>"Figure 1"</code>, <code>"Figure 2"</code>, etc.). Each of these is
a also a list containing two elements:
</p>

<ul>
<li><p>gg:    A ggplot object for that page.
</p>
</li>
<li><p>notes: Placeholder for future notes, but NULL now.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>id     = "NCA"
id_UD  = "UD"
id_DW  = "DW"
id_ASM = "ASM"

# We need a state variable to be define
sess_res = NCA_test_mksession(session=list(),
     id     = id,
     id_UD  = id_UD,
     id_DW  = id_DW,
     id_ASM = id_ASM,
     full_session=FALSE)

state = sess_res$state

# Pulls out the active analysis
current_ana = NCA_fetch_current_ana(state)

# This is the raw PKNCA output
pknca_res = NCA_fetch_ana_pknca(state, current_ana)

# Building the figure
mk_res = mk_figure_ind_obs(nca_res = pknca_res)
mk_res$figures$Figure_1$gg
</code></pre>

<hr>
<h2 id='mk_table_ind_obs'>Creates Tables of Individual Observations from PKNCA Result</h2><span id='topic+mk_table_ind_obs'></span>

<h3>Description</h3>

<p>Takes the output of PKNCA and creates a tabular view of the
individual observation data. This can be spread out of over several tables
(pages) if necessary.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mk_table_ind_obs(
  nca_res,
  obnd = NULL,
  not_sampled = "NS",
  blq = "BLQ",
  digits = 3,
  text_format = "text",
  max_height = 7,
  max_width = 6.5,
  max_row = NULL,
  max_col = 9,
  notes_detect = NULL,
  rows_by = "time"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mk_table_ind_obs_+3A_nca_res">nca_res</code></td>
<td>
<p>Output of PKNCA.</p>
</td></tr>
<tr><td><code id="mk_table_ind_obs_+3A_obnd">obnd</code></td>
<td>
<p>onbrand reporting object.</p>
</td></tr>
<tr><td><code id="mk_table_ind_obs_+3A_not_sampled">not_sampled</code></td>
<td>
<p>Character string to use for missing data when pivoting.</p>
</td></tr>
<tr><td><code id="mk_table_ind_obs_+3A_blq">blq</code></td>
<td>
<p>Character string to use to indicate data below the level of quantification (value of 0 in the dataset).</p>
</td></tr>
<tr><td><code id="mk_table_ind_obs_+3A_digits">digits</code></td>
<td>
<p>Number of significant figures to report (set to <code>NULL</code> to disable rounding)</p>
</td></tr>
<tr><td><code id="mk_table_ind_obs_+3A_text_format">text_format</code></td>
<td>
<p>Either <code>"md"</code> for markdown or <code>"text"</code> (default) for plain text.</p>
</td></tr>
<tr><td><code id="mk_table_ind_obs_+3A_max_height">max_height</code></td>
<td>
<p>Maximum height of the final table in inches (A value of <code>NULL</code> will use 100 inches).</p>
</td></tr>
<tr><td><code id="mk_table_ind_obs_+3A_max_width">max_width</code></td>
<td>
<p>Maximum width of the final table in inches (A value of <code>NULL</code> will use 100 inches).</p>
</td></tr>
<tr><td><code id="mk_table_ind_obs_+3A_max_row">max_row</code></td>
<td>
<p>Maximum number of rows to have on a page. Spillover will hang over the side of the page..</p>
</td></tr>
<tr><td><code id="mk_table_ind_obs_+3A_max_col">max_col</code></td>
<td>
<p>Maximum number of columns to have on a page. Spillover will be wrapped to multiple pages.</p>
</td></tr>
<tr><td><code id="mk_table_ind_obs_+3A_notes_detect">notes_detect</code></td>
<td>
<p>Vector of strings to detect in output tables (example <code>c("NC", "BLQ")</code>).</p>
</td></tr>
<tr><td><code id="mk_table_ind_obs_+3A_rows_by">rows_by</code></td>
<td>
<p>Can be either &quot;time&quot; or &quot;id&quot;. If it is &quot;time&quot;, there will be a
column for time and separate column for each subject ID. If rows_by is set
to &quot;id&quot; there will be a column for ID and a column for each individual time.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List containing the following elements
</p>

<ul>
<li><p>isgood:      Boolean indicating the exit status of the function.
</p>
</li>
<li><p>one_table:   Dataframe of the entire table with the first lines containing the header.
</p>
</li>
<li><p>one_body:    Dataframe of the entire table (data only).
</p>
</li>
<li><p>one_header:  Dataframe of the entire header (row and body, no data).
</p>
</li>
<li><p>tables:      Named list of tables. Each list element is of the output
</p>
</li>
<li><p>msgs:        Vector of text messages describing any errors that were found.
format from <code><a href="onbrand.html#topic+build_span">build_span</a></code>.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>id     = "NCA"
id_UD  = "UD"
id_DW  = "DW"
id_ASM = "ASM"

# We need a state variable to be define
sess_res = NCA_test_mksession(session=list(),
     id     = id,
     id_UD  = id_UD,
     id_DW  = id_DW,
     id_ASM = id_ASM,
     full_session=FALSE)

state = sess_res$state

# Pulls out the active analysis
current_ana = NCA_fetch_current_ana(state)

# This is the raw PKNCA output
pknca_res = NCA_fetch_ana_pknca(state, current_ana)

# Building the figure
mk_res = mk_table_ind_obs(nca_res = pknca_res)
mk_res$tables[["Table 1"]]$ft
</code></pre>

<hr>
<h2 id='mk_table_nca_params'>Create Tabular Output from PKNCA Results</h2><span id='topic+mk_table_nca_params'></span>

<h3>Description</h3>

<p>Create paginated tables from PKNCA to use in reports and Shiny
apps.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mk_table_nca_params(
  nca_res,
  type = "individual",
  grouping = "interval",
  not_calc = "NC",
  obnd = NULL,
  nps = NULL,
  mult_str = "*",
  infinity = "inf",
  digits = NULL,
  text_format = "text",
  notes_detect = NULL,
  max_height = 7,
  max_width = 6.5,
  max_row = NULL,
  max_col = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mk_table_nca_params_+3A_nca_res">nca_res</code></td>
<td>
<p>Output of PKNCA.</p>
</td></tr>
<tr><td><code id="mk_table_nca_params_+3A_type">type</code></td>
<td>
<p>Type of table to generate. Can be either <code>"individual"</code> or <code>"summary"]</code>.</p>
</td></tr>
<tr><td><code id="mk_table_nca_params_+3A_grouping">grouping</code></td>
<td>
<p>How to group columns in tables. Can be either <code>"interval"</code> or <code>"parameter"]</code>.</p>
</td></tr>
<tr><td><code id="mk_table_nca_params_+3A_not_calc">not_calc</code></td>
<td>
<p>Text string to replace NA values with to indicated values were not calculated.</p>
</td></tr>
<tr><td><code id="mk_table_nca_params_+3A_obnd">obnd</code></td>
<td>
<p>onbrand reporting object.</p>
</td></tr>
<tr><td><code id="mk_table_nca_params_+3A_nps">nps</code></td>
<td>
<p>NCA parameter summary table with the following columns.
</p>

<ul>
<li><p>parameter:      PKNCA Paramter name.
</p>
</li>
<li><p>text:           Name used in text output.
</p>
</li>
<li><p>md:             Name used markdown output.
</p>
</li>
<li><p>latex:          Name used in latex output.
</p>
</li>
<li><p>description:    Verbose textual description of the parameter.
</p>
</li></ul>
</td></tr>
<tr><td><code id="mk_table_nca_params_+3A_mult_str">mult_str</code></td>
<td>
<p>Text string to replace * values in units.</p>
</td></tr>
<tr><td><code id="mk_table_nca_params_+3A_infinity">infinity</code></td>
<td>
<p>Text string to replace infinity in time intervals in column headers.</p>
</td></tr>
<tr><td><code id="mk_table_nca_params_+3A_digits">digits</code></td>
<td>
<p>Number of significant figures to report (set to <code>NULL</code> to disable rounding)</p>
</td></tr>
<tr><td><code id="mk_table_nca_params_+3A_text_format">text_format</code></td>
<td>
<p>Either <code>"md"</code> for markdown or <code>"text"</code> (default) for plain text.</p>
</td></tr>
<tr><td><code id="mk_table_nca_params_+3A_notes_detect">notes_detect</code></td>
<td>
<p>Vector of strings to detect in output tables (example <code>c("NC", "BLQ")</code>).</p>
</td></tr>
<tr><td><code id="mk_table_nca_params_+3A_max_height">max_height</code></td>
<td>
<p>Maximum height of the final table in inches (A value of <code>NULL</code> will use 100 inches).</p>
</td></tr>
<tr><td><code id="mk_table_nca_params_+3A_max_width">max_width</code></td>
<td>
<p>Maximum width of the final table in inches (A value of <code>NULL</code> will use 100 inches).</p>
</td></tr>
<tr><td><code id="mk_table_nca_params_+3A_max_row">max_row</code></td>
<td>
<p>Maximum number of rows to have on a page. Spillover will hang over the side of the page..</p>
</td></tr>
<tr><td><code id="mk_table_nca_params_+3A_max_col">max_col</code></td>
<td>
<p>Maximum number of columns to have on a page. Spillover will be wrapped to multiple pages.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list containing the following elements
</p>

<ul>
<li><p>raw_nca:     Raw PKNCA output.
</p>
</li>
<li><p>isgood:      Boolean indicating the exit status of the function.
</p>
</li>
<li><p>one_table:   Dataframe of the entire table with the first lines containing the header.
</p>
</li>
<li><p>one_body:    Dataframe of the entire table (data only).
</p>
</li>
<li><p>one_header:  Dataframe of the entire header (row and body, no data).
</p>
</li>
<li><p>tables:      Named list of tables. Each list element is of the output
</p>
</li>
<li><p>msgs:        Vector of text messages describing any errors that were found.
format from <code><a href="onbrand.html#topic+build_span">build_span</a></code>.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>id     = "NCA"
id_UD  = "UD"
id_DW  = "DW"
id_ASM = "ASM"

# We need a state variable to be define
sess_res = NCA_test_mksession(session=list(),
     id     = id,
     id_UD  = id_UD,
     id_DW  = id_DW,
     id_ASM = id_ASM,
     full_session=FALSE)

state = sess_res$state

# Pulls out the active analysis
current_ana = NCA_fetch_current_ana(state)

# This is the raw PKNCA output
pknca_res = NCA_fetch_ana_pknca(state, current_ana)

# Parameter reporting details from the ruminate configuration
nps  = state[["NCA"]][["nca_parameters"]][["summary"]]

# Building the figure
mk_res = mk_table_nca_params(nca_res = pknca_res, nps=nps, digits=3)
mk_res$tables[["Table 1"]]$ft
</code></pre>

<hr>
<h2 id='NCA_add_int'>Adds Analysis Interval to Current Analysis</h2><span id='topic+NCA_add_int'></span>

<h3>Description</h3>

<p>Takes the start time, stop time, and NCA parameters and adds
them to the intervals table
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_add_int(state, interval_start, interval_stop, nca_parameters)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_add_int_+3A_state">state</code></td>
<td>
<p>NCA state from <code>NCA_fetch_state()</code></p>
</td></tr>
<tr><td><code id="NCA_add_int_+3A_interval_start">interval_start</code></td>
<td>
<p>Interval start time (numeric).</p>
</td></tr>
<tr><td><code id="NCA_add_int_+3A_interval_stop">interval_stop</code></td>
<td>
<p>Interval stop time (numeric).</p>
</td></tr>
<tr><td><code id="NCA_add_int_+3A_nca_parameters">nca_parameters</code></td>
<td>
<p>list of NCA parameters in the interval</p>
</td></tr>
</table>


<h3>Value</h3>

<p>State with interval added to the current analysis.
</p>

<hr>
<h2 id='NCA_append_report'>Append Report Elements</h2><span id='topic+NCA_append_report'></span>

<h3>Description</h3>

<p>Takes an NCA state object and appends any reportable elements
for the specified report type. On NCA analyses that are in a &quot;good&quot; state
will be reported. Those not in a good state will be ignored.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_append_report(state, rpt, rpttype, gen_code_only = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_append_report_+3A_state">state</code></td>
<td>
<p>NCA state from <code>NCA_fetch_state()</code></p>
</td></tr>
<tr><td><code id="NCA_append_report_+3A_rpt">rpt</code></td>
<td>
<p>Report with the current content of the report which will be appended to in
this function. For details on the structure see the documentation for <code><a href="formods.html#topic+FM_generate_report">FM_generate_report</a></code>.</p>
</td></tr>
<tr><td><code id="NCA_append_report_+3A_rpttype">rpttype</code></td>
<td>
<p>Type of report to generate (supported &quot;xlsx&quot;, &quot;pptx&quot;, &quot;docx&quot;).</p>
</td></tr>
<tr><td><code id="NCA_append_report_+3A_gen_code_only">gen_code_only</code></td>
<td>
<p>Boolean value indicating that only code should be
generated (<code>FALSE</code>).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list containing the following elements
</p>

<ul>
<li><p>isgood:    Return status of the function.
</p>
</li>
<li><p>hasrptele: Boolean indicator if the module has any reportable elements.
</p>
</li>
<li><p>code:      Code to create report elements.
</p>
</li>
<li><p>msgs:      Messages to be passed back to the user.
</p>
</li>
<li><p>rpt:       Report with any additions passed back to the user.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="formods.html#topic+FM_generate_report">FM_generate_report</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># We need a state object to use below
sess_res = NCA_test_mksession(session=list(), full_session=FALSE)
state = sess_res$state

# here we need an empty report object for tabular data
rpt = list(summary = list(), sheets=list())

# Now we append the report indicating we want
# Excel output:
rpt_res = NCA_append_report(state,
 rpt           = rpt,
 rpttype       = "xlsx",
 gen_code_only = TRUE)

# Shows if report elements are present
rpt_res$hasrptele

# Code chunk to generate report element
cat(paste(rpt_res$code, collapse="\n"))
</code></pre>

<hr>
<h2 id='nca_builder'>Builds NCA Code from ui Elements</h2><span id='topic+nca_builder'></span>

<h3>Description</h3>

<p>Takes the current analysis in the state object and creates the
code to run the analysis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nca_builder(state)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nca_builder_+3A_state">state</code></td>
<td>
<p>NCA state from <code>NCA_fetch_state()</code>
JMH update the return list below</p>
</td></tr>
</table>


<h3>Value</h3>

<p>NCA state with the NCA for the current analysis built.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Module IDs
id     = "NCA"
id_UD  = "UD"
id_DW  = "DW"
id_ASM = "ASM"

# We need a module variables to be defined
sess_res = NCA_test_mksession(session=list(),
     id     = id,
     id_UD  = id_UD,
     id_DW  = id_DW,
     id_ASM = id_ASM,
     full_session=FALSE)

state = sess_res$state

state = nca_builder(state)
</code></pre>

<hr>
<h2 id='NCA_fetch_ana_ds'>Fetch Analysis Dataset</h2><span id='topic+NCA_fetch_ana_ds'></span>

<h3>Description</h3>

<p>Fetches the dataset used for the specified analysis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_fetch_ana_ds(state, current_ana)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_fetch_ana_ds_+3A_state">state</code></td>
<td>
<p>NCA state from <code>NCA_fetch_state()</code></p>
</td></tr>
<tr><td><code id="NCA_fetch_ana_ds_+3A_current_ana">current_ana</code></td>
<td>
<p>Current value in the analysis</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Dataset from the <code>ds</code> field of FM_fetch_ds()
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ruminate)
# Module IDs                                                                   
id     = "NCA"                                                                 
id_UD  = "UD"                                                                  
id_DW  = "DW"                                                                  
id_ASM = "ASM"                                                                 
# We need session and input variables to be define                             
 sess_res = NCA_test_mksession(session=list(),                                 
      id     = id,                                                             
      id_UD  = id_UD,                                                          
      id_DW  = id_DW,                                                          
      id_ASM = id_ASM,
      full_session=FALSE)
                                                                               
# Extracting the session and input variables                                   
session      = sess_res$session                                                
input        = sess_res$input                                                  
react_state  = list()                                                          
                                                                               
# We also need configuration files                                             
FM_yaml_file  = system.file(package = "formods",  "templates", "formods.yaml") 
MOD_yaml_file = system.file(package = "ruminate", "templates", "NCA.yaml")     
                                                                               
# Getting the current module state                                             
state = NCA_fetch_state(id             = id,                                   
                       input           = input,                                
                       session         = session,                              
                       FM_yaml_file    = FM_yaml_file,                         
                       MOD_yaml_file   = MOD_yaml_file,                        
                       id_ASM          = id_ASM,                               
                       id_UD           = id_UD,                                
                       id_DW           = id_DW,                                
                       react_state     = react_state)                          
                                                                               
# Pulls out the active analysis                                                
current_ana = NCA_fetch_current_ana(state)

# This will get the dataset associated with this analysis
ds = NCA_fetch_ana_ds(state, current_ana)

# After making changes you can update those in the state
state = NCA_set_current_ana(state, current_ana)

# You can use this to check the current analysis
current_ana = NCA_process_current_ana(state)

# This will pull out the code for the module
fc_res = NCA_fetch_code(state)

# This will use patterns defined for the site to detect
# columns. In this example we are detecting the id column:
id_col = NCA_find_col(
  patterns = state[["MC"]][["detect_col"]][["id"]],
  dscols   = names(ds$DS))

# This creates a new analysis
state = NCA_new_ana(state)
</code></pre>

<hr>
<h2 id='NCA_fetch_ana_pknca'>Fetch PKNCA Results Object</h2><span id='topic+NCA_fetch_ana_pknca'></span>

<h3>Description</h3>

<p>Fetches the PKNCA output for a specified analysis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_fetch_ana_pknca(state, current_ana)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_fetch_ana_pknca_+3A_state">state</code></td>
<td>
<p>NCA state from <code>NCA_fetch_state()</code></p>
</td></tr>
<tr><td><code id="NCA_fetch_ana_pknca_+3A_current_ana">current_ana</code></td>
<td>
<p>Current value in the analysis</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Dataset from the <code>ds</code> field of FM_fetch_ds()
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ruminate)
# Module IDs                                                                   
id     = "NCA"                                                                 
id_UD  = "UD"                                                                  
id_DW  = "DW"                                                                  
id_ASM = "ASM"                                                                 
# We need session and input variables to be define                             
 sess_res = NCA_test_mksession(session=list(),                                 
      id     = id,                                                             
      id_UD  = id_UD,                                                          
      id_DW  = id_DW,                                                          
      id_ASM = id_ASM,
      full_session=FALSE)
                                                                               
# Extracting the session and input variables                                   
session      = sess_res$session                                                
input        = sess_res$input                                                  
react_state  = list()                                                          
                                                                               
# We also need configuration files                                             
FM_yaml_file  = system.file(package = "formods",  "templates", "formods.yaml") 
MOD_yaml_file = system.file(package = "ruminate", "templates", "NCA.yaml")     
                                                                               
# Getting the current module state                                             
state = NCA_fetch_state(id             = id,                                   
                       input           = input,                                
                       session         = session,                              
                       FM_yaml_file    = FM_yaml_file,                         
                       MOD_yaml_file   = MOD_yaml_file,                        
                       id_ASM          = id_ASM,                               
                       id_UD           = id_UD,                                
                       id_DW           = id_DW,                                
                       react_state     = react_state)                          
                                                                               
# Pulls out the active analysis                                                
current_ana = NCA_fetch_current_ana(state)

# This will get the dataset associated with this analysis
ds = NCA_fetch_ana_ds(state, current_ana)

# After making changes you can update those in the state
state = NCA_set_current_ana(state, current_ana)

# You can use this to check the current analysis
current_ana = NCA_process_current_ana(state)

# This will pull out the code for the module
fc_res = NCA_fetch_code(state)

# This will use patterns defined for the site to detect
# columns. In this example we are detecting the id column:
id_col = NCA_find_col(
  patterns = state[["MC"]][["detect_col"]][["id"]],
  dscols   = names(ds$DS))

# This creates a new analysis
state = NCA_new_ana(state)
</code></pre>

<hr>
<h2 id='NCA_fetch_code'>Fetch Module Code</h2><span id='topic+NCA_fetch_code'></span>

<h3>Description</h3>

<p>Fetches the code to generate results seen in the app
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_fetch_code(state)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_fetch_code_+3A_state">state</code></td>
<td>
<p>NCA state from <code>NCA_fetch_state()</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Character object vector with the lines of code
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ruminate)
# Module IDs                                                                   
id     = "NCA"                                                                 
id_UD  = "UD"                                                                  
id_DW  = "DW"                                                                  
id_ASM = "ASM"                                                                 
# We need session and input variables to be define                             
 sess_res = NCA_test_mksession(session=list(),                                 
      id     = id,                                                             
      id_UD  = id_UD,                                                          
      id_DW  = id_DW,                                                          
      id_ASM = id_ASM,
      full_session=FALSE)
                                                                               
# Extracting the session and input variables                                   
session      = sess_res$session                                                
input        = sess_res$input                                                  
react_state  = list()                                                          
                                                                               
# We also need configuration files                                             
FM_yaml_file  = system.file(package = "formods",  "templates", "formods.yaml") 
MOD_yaml_file = system.file(package = "ruminate", "templates", "NCA.yaml")     
                                                                               
# Getting the current module state                                             
state = NCA_fetch_state(id             = id,                                   
                       input           = input,                                
                       session         = session,                              
                       FM_yaml_file    = FM_yaml_file,                         
                       MOD_yaml_file   = MOD_yaml_file,                        
                       id_ASM          = id_ASM,                               
                       id_UD           = id_UD,                                
                       id_DW           = id_DW,                                
                       react_state     = react_state)                          
                                                                               
# Pulls out the active analysis                                                
current_ana = NCA_fetch_current_ana(state)

# This will get the dataset associated with this analysis
ds = NCA_fetch_ana_ds(state, current_ana)

# After making changes you can update those in the state
state = NCA_set_current_ana(state, current_ana)

# You can use this to check the current analysis
current_ana = NCA_process_current_ana(state)

# This will pull out the code for the module
fc_res = NCA_fetch_code(state)

# This will use patterns defined for the site to detect
# columns. In this example we are detecting the id column:
id_col = NCA_find_col(
  patterns = state[["MC"]][["detect_col"]][["id"]],
  dscols   = names(ds$DS))

# This creates a new analysis
state = NCA_new_ana(state)
</code></pre>

<hr>
<h2 id='NCA_fetch_current_ana'>Fetches Current Analysis</h2><span id='topic+NCA_fetch_current_ana'></span>

<h3>Description</h3>

<p>Takes an NCA state and returns the current active analysis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_fetch_current_ana(state)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_fetch_current_ana_+3A_state">state</code></td>
<td>
<p>NCA state from <code>NCA_fetch_state()</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>List containing the details of the current analysis. The structure
of this list is the same as the structure of <code>state$NCA$anas</code> in the output of
<code>NCA_fetch_state()</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ruminate)
# Module IDs                                                                   
id     = "NCA"                                                                 
id_UD  = "UD"                                                                  
id_DW  = "DW"                                                                  
id_ASM = "ASM"                                                                 
# We need session and input variables to be define                             
 sess_res = NCA_test_mksession(session=list(),                                 
      id     = id,                                                             
      id_UD  = id_UD,                                                          
      id_DW  = id_DW,                                                          
      id_ASM = id_ASM,
      full_session=FALSE)
                                                                               
# Extracting the session and input variables                                   
session      = sess_res$session                                                
input        = sess_res$input                                                  
react_state  = list()                                                          
                                                                               
# We also need configuration files                                             
FM_yaml_file  = system.file(package = "formods",  "templates", "formods.yaml") 
MOD_yaml_file = system.file(package = "ruminate", "templates", "NCA.yaml")     
                                                                               
# Getting the current module state                                             
state = NCA_fetch_state(id             = id,                                   
                       input           = input,                                
                       session         = session,                              
                       FM_yaml_file    = FM_yaml_file,                         
                       MOD_yaml_file   = MOD_yaml_file,                        
                       id_ASM          = id_ASM,                               
                       id_UD           = id_UD,                                
                       id_DW           = id_DW,                                
                       react_state     = react_state)                          
                                                                               
# Pulls out the active analysis                                                
current_ana = NCA_fetch_current_ana(state)

# This will get the dataset associated with this analysis
ds = NCA_fetch_ana_ds(state, current_ana)

# After making changes you can update those in the state
state = NCA_set_current_ana(state, current_ana)

# You can use this to check the current analysis
current_ana = NCA_process_current_ana(state)

# This will pull out the code for the module
fc_res = NCA_fetch_code(state)

# This will use patterns defined for the site to detect
# columns. In this example we are detecting the id column:
id_col = NCA_find_col(
  patterns = state[["MC"]][["detect_col"]][["id"]],
  dscols   = names(ds$DS))

# This creates a new analysis
state = NCA_new_ana(state)
</code></pre>

<hr>
<h2 id='NCA_fetch_current_obj'>Fetches the Current Analysis Object</h2><span id='topic+NCA_fetch_current_obj'></span>

<h3>Description</h3>

<p>Takes the current state and object type and returns the
currently selected object. For example if you have specified figure, it will
look at the output figure selected and the figure number of that figure and
return the ggplot object for that.
by subject id highlighting of certain NCA aspects (e.g. points used for half-life)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_fetch_current_obj(state, obj_type)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_fetch_current_obj_+3A_state">state</code></td>
<td>
<p>NCA state from <code>NCA_fetch_state()</code></p>
</td></tr>
<tr><td><code id="NCA_fetch_current_obj_+3A_obj_type">obj_type</code></td>
<td>
<p>Type of object to return (either &quot;table&quot; or &quot;figure&quot;).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with a format that depends on the obj_type.
For figures:
</p>

<ul>
<li><p>ggplot:   ggplot object of the figure.
</p>
</li>
<li><p>isgood:   Return status of the function.
</p>
</li>
<li><p>msgs:     Messages to be passed back to the user.
</p>
</li></ul>

<p>For tables:
</p>

<ul>
<li><p>df:       Dataframe of the current table.
</p>
</li>
<li><p>ft:       Flextable object of the current table.
</p>
</li>
<li><p>notes:    Any table notes to be included.
</p>
</li>
<li><p>isgood:   Return status of the function.
</p>
</li>
<li><p>msgs:     Messages to be passed back to the user.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># We need a state object to use below
sess_res = NCA_test_mksession(session=list(), full_session=FALSE)
state = sess_res$state

# Current active table:
res = NCA_fetch_current_obj(state, "table")
res$ft

# Current active figure:
res = NCA_fetch_current_obj(state, "figure")
res$ggplot
</code></pre>

<hr>
<h2 id='NCA_fetch_data_format'>Fetches Details About Data Requirements</h2><span id='topic+NCA_fetch_data_format'></span>

<h3>Description</h3>

<p>Use this to get information about data formats.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_fetch_data_format(
  MOD_yaml_file = system.file(package = "ruminate", "templates", "NCA.yaml")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_fetch_data_format_+3A_mod_yaml_file">MOD_yaml_file</code></td>
<td>
<p>Module configuration file with MC as main section.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with details about the data formats
</p>


<h3>Examples</h3>

<pre><code class='language-R'>NCA_fetch_data_format()
</code></pre>

<hr>
<h2 id='NCA_fetch_ds'>Fetch Module Datasets</h2><span id='topic+NCA_fetch_ds'></span>

<h3>Description</h3>

<p>Fetches the datasets contained in the module
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_fetch_ds(state)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_fetch_ds_+3A_state">state</code></td>
<td>
<p>NCA state from <code>NCA_fetch_state()</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>list containing the following elements
</p>

<ul>
<li><p>isgood:    Return status of the function.
</p>
</li>
<li><p>hasds:     Boolean indicator if the module has any datasets
</p>
</li>
<li><p>msgs:      Messages to be passed back to the user.
</p>
</li>
<li><p>ds:        List with datasets. Each list element has the name of
the R-object for that dataset. Each element has the following structure:
</p>

<ul>
<li><p>label: Text label for the dataset
</p>
</li>
<li><p>MOD_TYPE: Short name for the type of module.
</p>
</li>
<li><p>id: module ID
</p>
</li>
<li><p>DS: Dataframe containing the actual dataset.
</p>
</li>
<li><p>DSMETA: Metadata describing DS
</p>
</li>
<li><p>code: Complete code to build dataset.
</p>
</li>
<li><p>checksum: Module checksum.
</p>
</li>
<li><p>DSchecksum: Dataset checksum.
</p>
</li></ul>

</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># We need a state object to use below
sess_res = NCA_test_mksession(session=list(), full_session=FALSE)
state = sess_res$state

myDs = NCA_fetch_ds(state)
</code></pre>

<hr>
<h2 id='NCA_fetch_np_meta'>Fetches NCA Parameter Meta Information</h2><span id='topic+NCA_fetch_np_meta'></span>

<h3>Description</h3>

<p>This provides meta information about NCA parameters. This
includes parameter names, text descriptions, formatting (md and LaTeX).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_fetch_np_meta(
  MOD_yaml_file = system.file(package = "ruminate", "templates", "NCA.yaml")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_fetch_np_meta_+3A_mod_yaml_file">MOD_yaml_file</code></td>
<td>
<p>Module configuration file with MC as main section.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with the following elements:
</p>

<ul>
<li><p>choices: List parameter choices grouped by values specified in the module configuration file.
</p>
</li>
<li><p>summary: Data frame with meta data about the NCA parameters with
the following columns:
</p>

<ul>
<li><p>parameter:   Name of parameter in PKNCA.
</p>
</li>
<li><p>text:        Name of parameter in plain text.
</p>
</li>
<li><p>md:          Parameter name formatted in Markdown.
</p>
</li>
<li><p>latex:       Parameter name formatted using LaTeX.
</p>
</li>
<li><p>description: Verbose description in plain text for the parameter.
</p>
</li></ul>

</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>NCA_fetch_np_meta()
</code></pre>

<hr>
<h2 id='NCA_fetch_PKNCA_meta'>Fetches PKNCA Metadata</h2><span id='topic+NCA_fetch_PKNCA_meta'></span>

<h3>Description</h3>

<p>Compiles Metadata from PKNCA
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_fetch_PKNCA_meta()
</code></pre>


<h3>Value</h3>

<p>Dataframe containing PKCNA metadata for NCA parameters.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>PKNCA_meta = NCA_fetch_PKNCA_meta()
utils::head(PKNCA_meta)
</code></pre>

<hr>
<h2 id='NCA_fetch_state'>Fetch ruminate State</h2><span id='topic+NCA_fetch_state'></span>

<h3>Description</h3>

<p>Merges default app options with the changes made in the UI
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_fetch_state(
  id,
  input,
  session,
  FM_yaml_file,
  MOD_yaml_file,
  id_ASM,
  id_UD,
  id_DW,
  react_state
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_fetch_state_+3A_id">id</code></td>
<td>
<p>Shiny module ID</p>
</td></tr>
<tr><td><code id="NCA_fetch_state_+3A_input">input</code></td>
<td>
<p>Shiny input variable</p>
</td></tr>
<tr><td><code id="NCA_fetch_state_+3A_session">session</code></td>
<td>
<p>Shiny session variable</p>
</td></tr>
<tr><td><code id="NCA_fetch_state_+3A_fm_yaml_file">FM_yaml_file</code></td>
<td>
<p>App configuration file with FM as main section.</p>
</td></tr>
<tr><td><code id="NCA_fetch_state_+3A_mod_yaml_file">MOD_yaml_file</code></td>
<td>
<p>Module configuration file with MC as main section.</p>
</td></tr>
<tr><td><code id="NCA_fetch_state_+3A_id_asm">id_ASM</code></td>
<td>
<p>ID string for the app state management module used to save and load app states</p>
</td></tr>
<tr><td><code id="NCA_fetch_state_+3A_id_ud">id_UD</code></td>
<td>
<p>ID string for the upload data module used to save and load app states</p>
</td></tr>
<tr><td><code id="NCA_fetch_state_+3A_id_dw">id_DW</code></td>
<td>
<p>ID string for the data wrangling module used to save and load app states</p>
</td></tr>
<tr><td><code id="NCA_fetch_state_+3A_react_state">react_state</code></td>
<td>
<p>Variable passed to server to allow reaction outside of module (<code>NULL</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list containing the current state of the app including default
values from the yaml file as well as any changes made by the user. The list
has the following structure:
</p>

<ul>
<li><p>yaml: Full contents of the supplied yaml file.
</p>
</li>
<li><p>MC: Module components of the yaml file.
</p>
</li>
<li><p>NCA:
</p>

<ul>
<li><p>ana_cntr:       Analysis counter.
</p>
</li>
<li><p>anas:                    List of analyses: Each analysis has the following  structure:
</p>

<ul>
<li><p>ana_dsview:       Dataset view/ID (name from DSV) selected as a data source for this analysis.
</p>
</li>
<li><p>ana_scenario:     Analysis scenario selected in the UI
</p>
</li>
<li><p>checksum:         checksum of the analysis (used to detect changes in the analysis).
</p>
</li>
<li><p>code:             Code to generate analysis from start to finish or error messages if code generation/analysis failed.
</p>
</li>
<li><p>code_components:  List containing the different components from code
</p>
</li>
<li><p>col_conc:         Column from ana_dsview containing the concentration data.
</p>
</li>
<li><p>col_dose:         Column from ana_dsview containing the dose amount.
</p>
</li>
<li><p>col_dur:          Column from ana_dsview containing the infusion duration or N/A if unused.
</p>
</li>
<li><p>col_group:        Columns from ana_dsview containing other grouping variables.
</p>
</li>
<li><p>col_id:           Column from ana_dsview containing the subject IDs.
</p>
</li>
<li><p>col_ntime:        Column from ana_dsview containing the nominal time values
</p>
</li>
<li><p>col_route:        Column from ana_dsview containing the dosing route.
</p>
</li>
<li><p>col_time:         Column from ana_dsview containing the time values.
</p>
</li>
<li><p>id:               Character id (<code>ana_idx</code>).
</p>
</li>
<li><p>idx:              Numeric id (<code>1</code>).
</p>
</li>
<li><p>include_units:    Boolean variable indicating in units should included in the analysis.
</p>
</li>
<li><p>interval_range:   Vector with the first element representing he beginning of the interval
and the second element containing the end of the interval.
</p>
</li>
<li><p>intervals:        List of the intervals to include.
</p>
</li>
<li><p>isgood:           Current status of the analysis.
</p>
</li>
<li><p>key:              Analysis key acts as a title/caption (user editable)
</p>
</li>
<li><p>msgs:             Messages generated when checking configuration and analysis options.
</p>
</li>
<li><p>nca_config:       List of NCA configuration options for this analysis.
</p>
</li>
<li><p>nca_object_name:  Prefix for NCA objects associated with this analyis.
</p>
</li>
<li><p>nca_parameters:   NCA parameters selected for calculation in the UI.
</p>
</li>
<li><p>notes:            Analysis notes  (user editable)
</p>
</li>
<li><p>objs:             List of names and values for objects created with generated code.
</p>
</li>
<li><p>sampling:         Sampling method either &quot;sparse&quot; or &quot;serial&quot;
</p>
</li>
<li><p>units_amt:        Amount units.
</p>
</li>
<li><p>units_conc:       Concentration units.
</p>
</li>
<li><p>units_dose:       Dosing units.
</p>
</li>
<li><p>units_time:       Time units.
</p>
</li></ul>

</li>
<li><p>current_ana:           Currently selected analysis (list name element from anas).
</p>
</li>
<li><p>DSV:                   Available data source views (see <code><a href="formods.html#topic+FM_fetch_ds">FM_fetch_ds</a></code>)
</p>
</li>
<li><p>checksum:              This is an MD5 sum of the module (checksum of the analysis checksums).
</p>
</li>
<li><p>nca_config:            List of PKNCA configuration options for this analysis.
</p>
</li>
<li><p>nca_parameters:        List with two elements
</p>

<ul>
<li><p>choices:          List consisting of &quot;Common Parameters&quot; and
&quot;Other&quot; (used for grouping in the UI).
Each of these is a list of text parameter
names with a value of the PKNCA parameter
name.
</p>
</li>
<li><p>summary:          Summary table with the following columns:
</p>

<ul>
<li><p>parameter:      PKNCA Paramter name.
</p>
</li>
<li><p>text:           Name used in text output.
</p>
</li>
<li><p>md:             Name used markdown output.
</p>
</li>
<li><p>latex:          Name used in latex output.
</p>
</li>
<li><p>description:    Verbose textual description of the parameter.
</p>
</li></ul>

</li></ul>

</li>
<li><p>ui:                    Current value of form elements in the UI.
</p>
</li>
<li><p>ui_ana_map:            Map between UI element names and analysis in the object you get from <code><a href="#topic+NCA_fetch_current_ana">NCA_fetch_current_ana</a></code>
</p>
</li>
<li><p>ui_ids:                Vector of UI elements for the module.
</p>
</li>
<li><p>ui_hold:               List of hold elements to disable updates before a full ui referesh is complete.
</p>
</li></ul>

</li>
<li><p>MOD_TYPE: Character data containing the type of module <code>"NCA"</code>
</p>
</li>
<li><p>id: Character data containing the module id module in the session variable.
</p>
</li>
<li><p>FM_yaml_file: App configuration file with FM as main section.
</p>
</li>
<li><p>MOD_yaml_file:  Module configuration file with MC as main section.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(ruminate)
# Module IDs                                                                   
id     = "NCA"                                                                 
id_UD  = "UD"                                                                  
id_DW  = "DW"                                                                  
id_ASM = "ASM"                                                                 
# We need session and input variables to be define                             
 sess_res = NCA_test_mksession(session=list(),                                 
      id     = id,                                                             
      id_UD  = id_UD,                                                          
      id_DW  = id_DW,                                                          
      id_ASM = id_ASM,
      full_session=FALSE)
                                                                               
# Extracting the session and input variables                                   
session      = sess_res$session                                                
input        = sess_res$input                                                  
react_state  = list()                                                          
                                                                               
# We also need configuration files                                             
FM_yaml_file  = system.file(package = "formods",  "templates", "formods.yaml") 
MOD_yaml_file = system.file(package = "ruminate", "templates", "NCA.yaml")     
                                                                               
# Getting the current module state                                             
state = NCA_fetch_state(id             = id,                                   
                       input           = input,                                
                       session         = session,                              
                       FM_yaml_file    = FM_yaml_file,                         
                       MOD_yaml_file   = MOD_yaml_file,                        
                       id_ASM          = id_ASM,                               
                       id_UD           = id_UD,                                
                       id_DW           = id_DW,                                
                       react_state     = react_state)                          
                                                                               
# Pulls out the active analysis                                                
current_ana = NCA_fetch_current_ana(state)

# This will get the dataset associated with this analysis
ds = NCA_fetch_ana_ds(state, current_ana)

# After making changes you can update those in the state
state = NCA_set_current_ana(state, current_ana)

# You can use this to check the current analysis
current_ana = NCA_process_current_ana(state)

# This will pull out the code for the module
fc_res = NCA_fetch_code(state)

# This will use patterns defined for the site to detect
# columns. In this example we are detecting the id column:
id_col = NCA_find_col(
  patterns = state[["MC"]][["detect_col"]][["id"]],
  dscols   = names(ds$DS))

# This creates a new analysis
state = NCA_new_ana(state)
</code></pre>

<hr>
<h2 id='NCA_find_col'>Determines Default Column Name</h2><span id='topic+NCA_find_col'></span>

<h3>Description</h3>

<p>Based on the current analysis, value from the UI, an optional
list of patterns to search, and column names from a dataset this function
tries to find a default value for a column in the analysis (e.g. subject id,
dose, concentration, etc).
</p>
<p>Generally the following is done:
</p>

<ul>
<li><p> If curr_ui has a non-NULL, non-&quot;&quot; value it is compared to dscols. If it
is found there that value is returned.
</p>
</li>
<li><p> If not then the patterns are considered. If the patterns from the YAML
file are not NULL they are compared sequentially to the columns names.
The first match found is returned.
</p>
</li>
<li><p> If nothing is found then the first value of dscols is returned.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>NCA_find_col(
  curr_ana = NULL,
  curr_ui = NULL,
  patterns = NULL,
  dscols,
  null_ok = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_find_col_+3A_curr_ana">curr_ana</code></td>
<td>
<p>Current value in the analysis</p>
</td></tr>
<tr><td><code id="NCA_find_col_+3A_curr_ui">curr_ui</code></td>
<td>
<p>Current value in UI</p>
</td></tr>
<tr><td><code id="NCA_find_col_+3A_patterns">patterns</code></td>
<td>
<p>List of regular expression patterns to consider.</p>
</td></tr>
<tr><td><code id="NCA_find_col_+3A_dscols">dscols</code></td>
<td>
<p>Columns from the dataset.</p>
</td></tr>
<tr><td><code id="NCA_find_col_+3A_null_ok">null_ok</code></td>
<td>
<p>Logical value indicating if a null result (nothing found) is
OK (default: <code>FALSE</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Name of column found based on the rules above.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ruminate)
# Module IDs                                                                   
id     = "NCA"                                                                 
id_UD  = "UD"                                                                  
id_DW  = "DW"                                                                  
id_ASM = "ASM"                                                                 
# We need session and input variables to be define                             
 sess_res = NCA_test_mksession(session=list(),                                 
      id     = id,                                                             
      id_UD  = id_UD,                                                          
      id_DW  = id_DW,                                                          
      id_ASM = id_ASM,
      full_session=FALSE)
                                                                               
# Extracting the session and input variables                                   
session      = sess_res$session                                                
input        = sess_res$input                                                  
react_state  = list()                                                          
                                                                               
# We also need configuration files                                             
FM_yaml_file  = system.file(package = "formods",  "templates", "formods.yaml") 
MOD_yaml_file = system.file(package = "ruminate", "templates", "NCA.yaml")     
                                                                               
# Getting the current module state                                             
state = NCA_fetch_state(id             = id,                                   
                       input           = input,                                
                       session         = session,                              
                       FM_yaml_file    = FM_yaml_file,                         
                       MOD_yaml_file   = MOD_yaml_file,                        
                       id_ASM          = id_ASM,                               
                       id_UD           = id_UD,                                
                       id_DW           = id_DW,                                
                       react_state     = react_state)                          
                                                                               
# Pulls out the active analysis                                                
current_ana = NCA_fetch_current_ana(state)

# This will get the dataset associated with this analysis
ds = NCA_fetch_ana_ds(state, current_ana)

# After making changes you can update those in the state
state = NCA_set_current_ana(state, current_ana)

# You can use this to check the current analysis
current_ana = NCA_process_current_ana(state)

# This will pull out the code for the module
fc_res = NCA_fetch_code(state)

# This will use patterns defined for the site to detect
# columns. In this example we are detecting the id column:
id_col = NCA_find_col(
  patterns = state[["MC"]][["detect_col"]][["id"]],
  dscols   = names(ds$DS))

# This creates a new analysis
state = NCA_new_ana(state)
</code></pre>

<hr>
<h2 id='NCA_init_state'>Initialize NCA Module State</h2><span id='topic+NCA_init_state'></span>

<h3>Description</h3>

<p>Creates a list of the initialized module state
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_init_state(FM_yaml_file, MOD_yaml_file, id, id_UD, id_DW, session)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_init_state_+3A_fm_yaml_file">FM_yaml_file</code></td>
<td>
<p>App configuration file with FM as main section.</p>
</td></tr>
<tr><td><code id="NCA_init_state_+3A_mod_yaml_file">MOD_yaml_file</code></td>
<td>
<p>Module configuration file with MC as main section.</p>
</td></tr>
<tr><td><code id="NCA_init_state_+3A_id">id</code></td>
<td>
<p>ID string for the module.</p>
</td></tr>
<tr><td><code id="NCA_init_state_+3A_id_ud">id_UD</code></td>
<td>
<p>ID string for the upload data module used to handle uploads or the name of the list element in react_state where the data set is stored.</p>
</td></tr>
<tr><td><code id="NCA_init_state_+3A_id_dw">id_DW</code></td>
<td>
<p>ID string for the data wrangling module to process any uploaded data</p>
</td></tr>
<tr><td><code id="NCA_init_state_+3A_session">session</code></td>
<td>
<p>Shiny session variable (in app) or a list (outside of app)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list containing an empty NCA state
</p>

<hr>
<h2 id='NCA_load_scenario'>Loads Pre-Defined Scenario</h2><span id='topic+NCA_load_scenario'></span>

<h3>Description</h3>

<p>Loads a pre-defined analysis scneario from the NCA YAML config
file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_load_scenario(state, ana_scenario)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_load_scenario_+3A_state">state</code></td>
<td>
<p>NCA state from <code>NCA_fetch_state()</code></p>
</td></tr>
<tr><td><code id="NCA_load_scenario_+3A_ana_scenario">ana_scenario</code></td>
<td>
<p>Short name of the analysis scenario to load from the config file.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>NCA state object with the scenario loaded and relevant notifications
set.
</p>

<hr>
<h2 id='NCA_mkactive_ana'>Fetch PKNCA Results Object</h2><span id='topic+NCA_mkactive_ana'></span>

<h3>Description</h3>

<p>Fetches the PKNCA output for a specified analysis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_mkactive_ana(state, ana_id)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_mkactive_ana_+3A_state">state</code></td>
<td>
<p>NCA state from <code>NCA_fetch_state()</code></p>
</td></tr>
<tr><td><code id="NCA_mkactive_ana_+3A_ana_id">ana_id</code></td>
<td>
<p>Analysis ID to make active.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>State with the analysis ID made active.
JMH add to example script below
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ruminate)
# Module IDs                                                                   
id     = "NCA"                                                                 
id_UD  = "UD"                                                                  
id_DW  = "DW"                                                                  
id_ASM = "ASM"                                                                 
# We need session and input variables to be define                             
 sess_res = NCA_test_mksession(session=list(),                                 
      id     = id,                                                             
      id_UD  = id_UD,                                                          
      id_DW  = id_DW,                                                          
      id_ASM = id_ASM,
      full_session=FALSE)
                                                                               
# Extracting the session and input variables                                   
session      = sess_res$session                                                
input        = sess_res$input                                                  
react_state  = list()                                                          
                                                                               
# We also need configuration files                                             
FM_yaml_file  = system.file(package = "formods",  "templates", "formods.yaml") 
MOD_yaml_file = system.file(package = "ruminate", "templates", "NCA.yaml")     
                                                                               
# Getting the current module state                                             
state = NCA_fetch_state(id             = id,                                   
                       input           = input,                                
                       session         = session,                              
                       FM_yaml_file    = FM_yaml_file,                         
                       MOD_yaml_file   = MOD_yaml_file,                        
                       id_ASM          = id_ASM,                               
                       id_UD           = id_UD,                                
                       id_DW           = id_DW,                                
                       react_state     = react_state)                          
                                                                               
# Pulls out the active analysis                                                
current_ana = NCA_fetch_current_ana(state)

# This will get the dataset associated with this analysis
ds = NCA_fetch_ana_ds(state, current_ana)

# After making changes you can update those in the state
state = NCA_set_current_ana(state, current_ana)

# You can use this to check the current analysis
current_ana = NCA_process_current_ana(state)

# This will pull out the code for the module
fc_res = NCA_fetch_code(state)

# This will use patterns defined for the site to detect
# columns. In this example we are detecting the id column:
id_col = NCA_find_col(
  patterns = state[["MC"]][["detect_col"]][["id"]],
  dscols   = names(ds$DS))

# This creates a new analysis
state = NCA_new_ana(state)
</code></pre>

<hr>
<h2 id='NCA_new_ana'>Initialize New Analysis</h2><span id='topic+NCA_new_ana'></span>

<h3>Description</h3>

<p>Creates a new NCA analysis in an NCA module
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_new_ana(state)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_new_ana_+3A_state">state</code></td>
<td>
<p>NCA state from <code>NCA_fetch_state()</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>NCA state object containing a new empty analysis and that analysis
is set as the current active analyisis
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ruminate)
# Module IDs                                                                   
id     = "NCA"                                                                 
id_UD  = "UD"                                                                  
id_DW  = "DW"                                                                  
id_ASM = "ASM"                                                                 
# We need session and input variables to be define                             
 sess_res = NCA_test_mksession(session=list(),                                 
      id     = id,                                                             
      id_UD  = id_UD,                                                          
      id_DW  = id_DW,                                                          
      id_ASM = id_ASM,
      full_session=FALSE)
                                                                               
# Extracting the session and input variables                                   
session      = sess_res$session                                                
input        = sess_res$input                                                  
react_state  = list()                                                          
                                                                               
# We also need configuration files                                             
FM_yaml_file  = system.file(package = "formods",  "templates", "formods.yaml") 
MOD_yaml_file = system.file(package = "ruminate", "templates", "NCA.yaml")     
                                                                               
# Getting the current module state                                             
state = NCA_fetch_state(id             = id,                                   
                       input           = input,                                
                       session         = session,                              
                       FM_yaml_file    = FM_yaml_file,                         
                       MOD_yaml_file   = MOD_yaml_file,                        
                       id_ASM          = id_ASM,                               
                       id_UD           = id_UD,                                
                       id_DW           = id_DW,                                
                       react_state     = react_state)                          
                                                                               
# Pulls out the active analysis                                                
current_ana = NCA_fetch_current_ana(state)

# This will get the dataset associated with this analysis
ds = NCA_fetch_ana_ds(state, current_ana)

# After making changes you can update those in the state
state = NCA_set_current_ana(state, current_ana)

# You can use this to check the current analysis
current_ana = NCA_process_current_ana(state)

# This will pull out the code for the module
fc_res = NCA_fetch_code(state)

# This will use patterns defined for the site to detect
# columns. In this example we are detecting the id column:
id_col = NCA_find_col(
  patterns = state[["MC"]][["detect_col"]][["id"]],
  dscols   = names(ds$DS))

# This creates a new analysis
state = NCA_new_ana(state)
</code></pre>

<hr>
<h2 id='NCA_process_current_ana'>Processes Current Analysis to be Run</h2><span id='topic+NCA_process_current_ana'></span>

<h3>Description</h3>

<p>Takes the current analysis and checks different aspects to for
any issues to make sure it's good to go.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_process_current_ana(state)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_process_current_ana_+3A_state">state</code></td>
<td>
<p>NCA state from <code>NCA_fetch_state()</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Current analysis list with isgood and msgs set
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ruminate)
# Module IDs                                                                   
id     = "NCA"                                                                 
id_UD  = "UD"                                                                  
id_DW  = "DW"                                                                  
id_ASM = "ASM"                                                                 
# We need session and input variables to be define                             
 sess_res = NCA_test_mksession(session=list(),                                 
      id     = id,                                                             
      id_UD  = id_UD,                                                          
      id_DW  = id_DW,                                                          
      id_ASM = id_ASM,
      full_session=FALSE)
                                                                               
# Extracting the session and input variables                                   
session      = sess_res$session                                                
input        = sess_res$input                                                  
react_state  = list()                                                          
                                                                               
# We also need configuration files                                             
FM_yaml_file  = system.file(package = "formods",  "templates", "formods.yaml") 
MOD_yaml_file = system.file(package = "ruminate", "templates", "NCA.yaml")     
                                                                               
# Getting the current module state                                             
state = NCA_fetch_state(id             = id,                                   
                       input           = input,                                
                       session         = session,                              
                       FM_yaml_file    = FM_yaml_file,                         
                       MOD_yaml_file   = MOD_yaml_file,                        
                       id_ASM          = id_ASM,                               
                       id_UD           = id_UD,                                
                       id_DW           = id_DW,                                
                       react_state     = react_state)                          
                                                                               
# Pulls out the active analysis                                                
current_ana = NCA_fetch_current_ana(state)

# This will get the dataset associated with this analysis
ds = NCA_fetch_ana_ds(state, current_ana)

# After making changes you can update those in the state
state = NCA_set_current_ana(state, current_ana)

# You can use this to check the current analysis
current_ana = NCA_process_current_ana(state)

# This will pull out the code for the module
fc_res = NCA_fetch_code(state)

# This will use patterns defined for the site to detect
# columns. In this example we are detecting the id column:
id_col = NCA_find_col(
  patterns = state[["MC"]][["detect_col"]][["id"]],
  dscols   = names(ds$DS))

# This creates a new analysis
state = NCA_new_ana(state)
</code></pre>

<hr>
<h2 id='NCA_Server'>Fetch Non-Compartmental Analysis State</h2><span id='topic+NCA_Server'></span>

<h3>Description</h3>

<p>Merges default app options with the changes made in the UI
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_Server(
  id,
  FM_yaml_file = system.file(package = "formods", "templates", "formods.yaml"),
  MOD_yaml_file = system.file(package = "ruminate", "templates", "NCA.yaml"),
  id_ASM = "ASM",
  id_UD = "UD",
  id_DW = "DW",
  deployed = FALSE,
  react_state = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_Server_+3A_id">id</code></td>
<td>
<p>An ID string that corresponds with the ID used to call the modules UI elements</p>
</td></tr>
<tr><td><code id="NCA_Server_+3A_fm_yaml_file">FM_yaml_file</code></td>
<td>
<p>App configuration file with FM as main section.</p>
</td></tr>
<tr><td><code id="NCA_Server_+3A_mod_yaml_file">MOD_yaml_file</code></td>
<td>
<p>Module configuration file with MC as main section.</p>
</td></tr>
<tr><td><code id="NCA_Server_+3A_id_asm">id_ASM</code></td>
<td>
<p>ID string for the app state management module used to save and load app states</p>
</td></tr>
<tr><td><code id="NCA_Server_+3A_id_ud">id_UD</code></td>
<td>
<p>ID string for the upload data module used to save and load app states</p>
</td></tr>
<tr><td><code id="NCA_Server_+3A_id_dw">id_DW</code></td>
<td>
<p>ID string for the data wrangling module used to save and load app states</p>
</td></tr>
<tr><td><code id="NCA_Server_+3A_deployed">deployed</code></td>
<td>
<p>Boolean variable indicating whether the app is deployed or not.</p>
</td></tr>
<tr><td><code id="NCA_Server_+3A_react_state">react_state</code></td>
<td>
<p>Variable passed to server to allow reaction outside of module (<code>NULL</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list containing the current state of the app including default
values from the yaml file as well as any changes made by the user. The list
has the following structure:
</p>

<ul>
<li><p>yaml: Full contents of the supplied yaml file.
</p>
</li>
<li><p>MC: Module components of the yaml file.
</p>
</li>
<li><p>NCA:
</p>

<ul>
<li><p>isgood: Boolean object indicating if the file was successfully loaded.
</p>
</li>
<li><p>checksum: This is an MD5 sum of the contents element and can be
used to detect changes in the state.
</p>
</li></ul>

</li>
<li><p>MOD_TYPE: Character data containing the type of module <code>"NCA"</code>
</p>
</li>
<li><p>id: Character data containing the module id module in the session variable.
</p>
</li>
<li><p>FM_yaml_file: App configuration file with FM as main section.
</p>
</li>
<li><p>MOD_yaml_file:  Module configuration file with MC as main section.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>if(interactive()){
# original file: inst/templates/ruminate.R
library(formods)
library(ruminate)

# These are suggested packages
library(shinydashboard)
#library(ggpubr)
#library(plotly)
#library(shinybusy)
library(prompter)
#library(utils)

tags$style("@import url(https://use.fontawesome.com/releases/v6.4.0/css/all.css);")

# You can copy these locally and customize them for your own needs. Simply
# change the assignment to the local copy you've modified.
formods.yaml  = system.file(package="formods",  "templates",  "formods.yaml")
ASM.yaml      = system.file(package="formods",  "templates",  "ASM.yaml")
UD.yaml       = system.file(package="formods",  "templates",  "UD.yaml")
DW.yaml       = system.file(package="formods",  "templates",  "DW.yaml")
FG.yaml       = system.file(package="formods",  "templates",  "FG.yaml")
NCA.yaml      = system.file(package="ruminate", "templates",  "NCA.yaml")


# Name of  file to indicate we need to load testing data
ftmptest = file.path(tempdir(), "ruminate.test")


# Making sure that the deployed object is created
if(!exists("deployed")){
  deployed = FALSE
}

# Making sure that the run_dev object is created
if(file.exists(file.path(tempdir(), "RUMINTE_DEVELOPMENT"))){
  run_dev  = TRUE
}else{
  run_dev  = FALSE
}

# If the SETUP.R file exists we source it 
if(file.exists("SETUP.R")){
  source("SETUP.R")
}


# If the DEPLOYED file marker existrs we set deployed to TRUE
if(file.exists("DEPLOYED")){
  deployed = TRUE
}

CSS &lt;- "
.wrapfig {
  float: right;
  shape-margin: 20px;
  margin-right: 20px;
  margin-bottom: 20px;
}
"

#https://fontawesome.com/icons?from=io
logo_url =
  "https://raw.githubusercontent.com/john-harrold/ruminate/main/man/figures/logo.png"
data_url =
  "https://github.com/john-harrold/formods/raw/master/inst/test_data/TEST_DATA.xlsx"
run_url  =
  "https://runruminate.ubiquity.tools/"
use_url  =
  "https://useruminate.ubiquity.tools/"
main_url =
  "https://ruminate.ubiquity.tools/"
issue_url =
  "https://github.com/john-harrold/ruminate/issues"

intro_text = tags$p(
"Ruminate is a shiny module for pharmacometric data processing,
visualization, and analysis. It consists of separate shiny modules that
provide interfaces into common R packages and provides the underlying code.
This is done to facilitate usage of those packages and to provide reproducible
analyses." ,
tags$li( "To find out more visit  ",
        tags$a("ruminate.ubiquity.tools", href=main_url),""),
tags$li( "To give it a try you can download a test dataset ",
        tags$a("here", href=data_url),""),
tags$li( "Go to  ",
        tags$a("useruminate.ubiquity.tools", href=use_url)," for a video
        demonstrating how to use ruminate"),
tags$li( "If you run into any problems, have questions, or want a feature please
        visit the ",
        tags$a("issues", href=issue_url)," page")
)


ui &lt;- shinydashboard::dashboardPage(
  skin="black",
  shinydashboard::dashboardHeader(title="ruminate"),
  shinydashboard::dashboardSidebar(
     shinydashboard::sidebarMenu(
       shinydashboard::menuItem("Load/Save",
                                tabName="loadsave",
                                icon=icon("arrow-down-up-across-line")) ,
       shinydashboard::menuItem("Transform Data", tabName="wrangle", icon=icon("shuffle")),
       shinydashboard::menuItem("Visualize",      tabName="plot",    icon=icon("chart-line")),
       shinydashboard::menuItem("NCA",            tabName="nca",     icon=icon("chart-area")),
       shinydashboard::menuItem("App Info",       tabName="sysinfo", icon=icon("book-medical"))
     )
  ),
  shinydashboard::dashboardBody(
  tags$head(
    tags$style(HTML(CSS))
  ),
    shinydashboard::tabItems(
       shinydashboard::tabItem(tabName="nca",
               shinydashboard::box(title="Run Non-Compartmental Analysis", width=12,
               fluidRow( prompter::use_prompt(),
               column(width=12,
               htmlOutput(NS("NCA",  "NCA_ui_compact")))))
               ),
       shinydashboard::tabItem(tabName="loadsave",
         #     shinydashboard::box(title=NULL, width=12,
               shinydashboard::tabBox(
                 width = 12,
                 title = NULL,
                 shiny::tabPanel(id="load_data",
                          title=tagList(shiny::icon("file-arrow-up"),
                                        "Load Data"),
                   fluidRow(
                     column(width=6,
                       div(style="display:inline-block;width:100%",
                       htmlOutput(NS("UD", "ui_ud_load_data"))),
                       htmlOutput(NS("UD", "ui_ud_clean")),
                       htmlOutput(NS("UD", "ui_ud_select_sheets")),
                       htmlOutput(NS("UD", "ui_ud_text_load_result"))),
                     column(width=6,
                         tags$p(
                             tags$img(
                             class = "wrapfig",
                             src   = logo_url,
                             width = 150,
                             alt = "formods logo" ),
                         intro_text
                         ))
                   ),
                 fluidRow(
                   column(width=12,
                          div(style="display:inline-block;vertical-align:top",
                                    htmlOutput(NS("UD", "ui_ud_data_preview")))
                          ))
                 ),
                 shiny::tabPanel(id="save_state",
                          title=tagList(shiny::icon("arrow-down-up-across-line"),
                                        "Save or Load Analysis"),
                 fluidRow(
                   column(width=5,
                          div(style="display:inline-block;vertical-align:top",
                   htmlOutput(NS("ASM", "ui_asm_compact"))
                   ))
                   )
                 )
               )
         #     ),
               ),
       shinydashboard::tabItem(tabName="wrangle",
               shinydashboard::box(title="Transform and Create Views of Your Data", width=12,
               fluidRow(
               column(width=12,
               htmlOutput(NS("DW",  "DW_ui_compact")))))
               ),
       shinydashboard::tabItem(tabName="plot",
               shinydashboard::box(title="Visualize Data", width=12,
               htmlOutput(NS("FG",  "FG_ui_compact")))),
       shinydashboard::tabItem(tabName="sysinfo",
         #     box(title="System Details", width=12,
               shinydashboard::tabBox(
                 width = 12,
                 title = NULL,
                 shiny::tabPanel(id="sys_packages",
                          title=tagList(shiny::icon("box-open"),
                                        "Installed Packages"),
                 htmlOutput(NS("ASM", "ui_asm_sys_packages"))
                 ),
                 shiny::tabPanel(id="sys_modules",
                          title=tagList(shiny::icon("cubes"),
                                        "Loaded Modules"),
                 htmlOutput(NS("ASM", "ui_asm_sys_modules"))
                 ),
                 shiny::tabPanel(id="sys_log",
                          title=tagList(shiny::icon("clipboard-list"),
                                        "Log"),
                 verbatimTextOutput(NS("ASM", "ui_asm_sys_log"))
                 ),
                 shiny::tabPanel(id="sys_options",
                          title=tagList(shiny::icon("sliders"),
                                        "R Options"),
                 htmlOutput(NS("ASM", "ui_asm_sys_options"))
                 )
         #       )
               ))
      )
    )
  )

# Main app server
server &lt;- function(input, output, session) {

  # Empty reactive object to track and react to
  # changes in the module state outside of the module
  react_FM = reactiveValues()

  # Module IDs and the order they are needed for code generation
  mod_ids = c("UD", "DW", "FG", "NCA", "MB")

  # If the ftmptest file is present we load test data
  if(file.exists(ftmptest)){
    NCA_test_mksession(
      session,
      id     = "NCA",
      id_UD  = "UD",
      id_DW  = "DW",
      id_ASM = "ASM"
    )
  }

  # Module servers
  formods::ASM_Server( id="ASM",
                       deployed      = deployed,
                       react_state   = react_FM,
                       FM_yaml_file  = formods.yaml,
                       MOD_yaml_file = ASM.yaml,
                       mod_ids       = mod_ids)
  formods::UD_Server(  id ="UD", id_ASM = "ASM",
                       deployed         = deployed,
                       react_state      = react_FM,
                       MOD_yaml_file    = UD.yaml,
                       FM_yaml_file     = formods.yaml)
  formods::DW_Server(  id="DW",       id_ASM = "ASM",
                       id_UD = "UD",
                       deployed         = deployed,
                       react_state      = react_FM,
                       MOD_yaml_file    = DW.yaml,
                       FM_yaml_file     = formods.yaml)
  formods::FG_Server(  id="FG",     id_ASM = "ASM",
                       id_UD = "UD", id_DW = "DW",
                       deployed         = deployed,
                       react_state      = react_FM,
                       MOD_yaml_file    = FG.yaml,
                       FM_yaml_file     = formods.yaml)
  ruminate::NCA_Server(id    ="NCA", id_ASM = "ASM",
                       id_UD = "UD", id_DW  = "DW",
                       deployed         = deployed,
                       react_state      = react_FM,
                       MOD_yaml_file    = NCA.yaml,
                       FM_yaml_file     = formods.yaml)

}

shinyApp(ui, server)
}
</code></pre>

<hr>
<h2 id='NCA_set_current_ana'>Sets Current Analysis</h2><span id='topic+NCA_set_current_ana'></span>

<h3>Description</h3>

<p>Takes an NCA state and an analysis list and sets that figure list
as the value for the active figure
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_set_current_ana(state, ana)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_set_current_ana_+3A_state">state</code></td>
<td>
<p>NCA state from <code>NCA_fetch_state()</code></p>
</td></tr>
<tr><td><code id="NCA_set_current_ana_+3A_ana">ana</code></td>
<td>
<p>Analysis list from <code>NCA_fetch_current_ana</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>State with the current analysis updated
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ruminate)
# Module IDs                                                                   
id     = "NCA"                                                                 
id_UD  = "UD"                                                                  
id_DW  = "DW"                                                                  
id_ASM = "ASM"                                                                 
# We need session and input variables to be define                             
 sess_res = NCA_test_mksession(session=list(),                                 
      id     = id,                                                             
      id_UD  = id_UD,                                                          
      id_DW  = id_DW,                                                          
      id_ASM = id_ASM,
      full_session=FALSE)
                                                                               
# Extracting the session and input variables                                   
session      = sess_res$session                                                
input        = sess_res$input                                                  
react_state  = list()                                                          
                                                                               
# We also need configuration files                                             
FM_yaml_file  = system.file(package = "formods",  "templates", "formods.yaml") 
MOD_yaml_file = system.file(package = "ruminate", "templates", "NCA.yaml")     
                                                                               
# Getting the current module state                                             
state = NCA_fetch_state(id             = id,                                   
                       input           = input,                                
                       session         = session,                              
                       FM_yaml_file    = FM_yaml_file,                         
                       MOD_yaml_file   = MOD_yaml_file,                        
                       id_ASM          = id_ASM,                               
                       id_UD           = id_UD,                                
                       id_DW           = id_DW,                                
                       react_state     = react_state)                          
                                                                               
# Pulls out the active analysis                                                
current_ana = NCA_fetch_current_ana(state)

# This will get the dataset associated with this analysis
ds = NCA_fetch_ana_ds(state, current_ana)

# After making changes you can update those in the state
state = NCA_set_current_ana(state, current_ana)

# You can use this to check the current analysis
current_ana = NCA_process_current_ana(state)

# This will pull out the code for the module
fc_res = NCA_fetch_code(state)

# This will use patterns defined for the site to detect
# columns. In this example we are detecting the id column:
id_col = NCA_find_col(
  patterns = state[["MC"]][["detect_col"]][["id"]],
  dscols   = names(ds$DS))

# This creates a new analysis
state = NCA_new_ana(state)
</code></pre>

<hr>
<h2 id='NCA_test_mksession'>Populate Session Data for Module Testing</h2><span id='topic+NCA_test_mksession'></span>

<h3>Description</h3>

<p>Populates the supplied session variable for testing.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCA_test_mksession(
  session,
  id = "NCA",
  id_UD = "UD",
  id_DW = "DW",
  id_ASM = "ASM",
  full_session = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NCA_test_mksession_+3A_session">session</code></td>
<td>
<p>Shiny session variable (in app) or a list (outside of app)</p>
</td></tr>
<tr><td><code id="NCA_test_mksession_+3A_id">id</code></td>
<td>
<p>An ID string that corresponds with the ID used to call the modules UI elements</p>
</td></tr>
<tr><td><code id="NCA_test_mksession_+3A_id_ud">id_UD</code></td>
<td>
<p>An ID string that corresponds with the ID used to call the UD modules UI elements</p>
</td></tr>
<tr><td><code id="NCA_test_mksession_+3A_id_dw">id_DW</code></td>
<td>
<p>An ID string that corresponds with the ID used to call the DW modules UI elements</p>
</td></tr>
<tr><td><code id="NCA_test_mksession_+3A_id_asm">id_ASM</code></td>
<td>
<p>An ID string that corresponds with the ID used to call the ASM modules UI elements</p>
</td></tr>
<tr><td><code id="NCA_test_mksession_+3A_full_session">full_session</code></td>
<td>
<p>Boolean to indicate if the full test session should be created (default <code>TRUE</code>).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with the following elements
</p>

<ul>
<li><p>isgood: Boolean indicating the exit status of the function.
</p>
</li>
<li><p>session: The value Shiny session variable (in app) or a list (outside of app) after initialization.
</p>
</li>
<li><p>input: The value of the shiny input at the end of the session initialization.
</p>
</li>
<li><p>state: App state.
</p>
</li>
<li><p>rsc: The <code>react_state</code> components.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>sess_res = NCA_test_mksession(session=list(), full_session=FALSE)
</code></pre>

<hr>
<h2 id='ruminate_check'>Checks <code>ruminate</code> Dependencies</h2><span id='topic+ruminate_check'></span>

<h3>Description</h3>

<p>Looks at the suggested dependencies and checks to make sure
they are installed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ruminate_check(verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ruminate_check_+3A_verbose">verbose</code></td>
<td>
<p>Logical indicating if messages should be displayed</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with the following elements:
</p>

<ul>
<li><p>all_found:    Boolean indicating if all packages were found
</p>
</li>
<li><p>found_pkgs:   Character vector of found packages
</p>
</li>
<li><p>missing_pkgs: Character vector of missing packages
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>fcres =ruminate_check()
</code></pre>

<hr>
<h2 id='run_nca_components'>Runs NCA for the Current Analysis</h2><span id='topic+run_nca_components'></span>

<h3>Description</h3>

<p>Takes the current state and runs the current analysis in that
state.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_nca_components(
  state,
  components = c("nca", "fg_ind_obs", "tb_ind_obs", "tb_ind_params")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="run_nca_components_+3A_state">state</code></td>
<td>
<p>NCA state from <code>NCA_fetch_state()</code></p>
</td></tr>
<tr><td><code id="run_nca_components_+3A_components">components</code></td>
<td>
<p>List of components to run. By default it will run all of
the following. If you just need to regenerate a figure based on the current
nca results you can just specify that component. These are the valid
components:
</p>

<ul>
<li><p>nca:               Run NCA analysis
</p>
</li>
<li><p>fg_ind_obs:        Build the figure(s) with the indiviudal observations.
</p>
</li>
<li><p>tb_ind_obs:        Build the table(s) with the indiviudal observations.
</p>
</li>
<li><p>tb_ind_params:     Build the table(s) with the indiviudal parameters.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>List with the following components:
</p>

<ul>
<li><p>isgood:    Return status of the function.
</p>
</li>
<li><p>msgs:      Error messages if any issues were encountered.
</p>
</li>
<li><p>nca_res:   PKNCA results if run was successful.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># We need a state object to use below
sess_res = NCA_test_mksession(session=list(), full_session=FALSE)
state = sess_res$state

state = run_nca_components(state, components="tb_ind_params")
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
