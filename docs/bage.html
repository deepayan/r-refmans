<!DOCTYPE html><html lang="en"><head><title>Help for package bage</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {bage}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#bage-package'><p>Package 'bage'</p></a></li>
<li><a href='#AR'><p>Autoregressive Prior</p></a></li>
<li><a href='#AR1'><p>Autoregressive Prior of Order 1</p></a></li>
<li><a href='#augment.bage_mod'><p>Extract Data and Modelled Values</p></a></li>
<li><a href='#components.bage_mod'><p>Extract Values for Hyper-Parameters</p></a></li>
<li><a href='#components.bage_ssvd'><p>Extract Components used by SVD Summary</p></a></li>
<li><a href='#computations'><p>Information on Computations Performed Duration Model Fitting</p></a></li>
<li><a href='#datamods'><p>Data Models</p></a></li>
<li><a href='#fit.bage_mod'><p>Fit a Model</p></a></li>
<li><a href='#forecast.bage_mod'><p>Use a Model to Make a Forecast</p></a></li>
<li><a href='#generate.bage_prior_ar'><p>Generate Values from Priors</p></a></li>
<li><a href='#generate.bage_ssvd'><p>Generate Random Age or Age-Sex Profiles</p></a></li>
<li><a href='#HFD'><p>Components from Human Fertility Database</p></a></li>
<li><a href='#HMD'><p>Components from Human Mortality Database</p></a></li>
<li><a href='#is_fitted'><p>Test Whether a Model has Been Fitted</p></a></li>
<li><a href='#isl_deaths'><p>Deaths in Iceland</p></a></li>
<li><a href='#Known'><p>Known Prior</p></a></li>
<li><a href='#kor_births'><p>Births in South Korea</p></a></li>
<li><a href='#LFP'><p>Components from OECD Labor Force Participation Data</p></a></li>
<li><a href='#Lin'><p>Linear Prior with Independent Normal Errors</p></a></li>
<li><a href='#Lin_AR'><p>Linear Prior with Autoregressive Errors</p></a></li>
<li><a href='#Lin_AR1'><p>Linear Prior with Autoregressive Errors of Order 1</p></a></li>
<li><a href='#mod_binom'><p>Specify a Binomial Model</p></a></li>
<li><a href='#mod_norm'><p>Specify a Normal Model</p></a></li>
<li><a href='#mod_pois'><p>Specify a Poisson Model</p></a></li>
<li><a href='#N'><p>Normal Prior</p></a></li>
<li><a href='#NFix'><p>Normal Prior with Fixed Variance</p></a></li>
<li><a href='#nld_expenditure'><p>Per Capita Health Expenditure in the Netherlands, 2003-2011</p></a></li>
<li><a href='#nzl_divorces'><p>Divorces in New Zealand</p></a></li>
<li><a href='#nzl_households'><p>People in One-Person Households in New Zealand</p></a></li>
<li><a href='#nzl_injuries'><p>Fatal Injuries in New Zealand</p></a></li>
<li><a href='#print.bage_mod'><p>Printing a Model</p></a></li>
<li><a href='#priors'><p>Priors for Intercept, Main Effects, Interactions</p></a></li>
<li><a href='#reexports'><p>Objects exported from other packages</p></a></li>
<li><a href='#replicate_data'><p>Create Replicate Data</p></a></li>
<li><a href='#report_sim'><p>Simulation Study of a Model</p></a></li>
<li><a href='#RW'><p>Random Walk Prior</p></a></li>
<li><a href='#RW_Seas'><p>Random Walk Prior with Seasonal Effect</p></a></li>
<li><a href='#RW2'><p>Second-Order Random Walk Prior</p></a></li>
<li><a href='#RW2_Infant'><p>Second-Order Random Walk Prior with 'Infant' Indicator</p></a></li>
<li><a href='#RW2_Seas'><p>Second-Order Random Walk Prior with Seasonal Effect</p></a></li>
<li><a href='#set_datamod_outcome_rr3'><p>Specify RR3 Data Model</p></a></li>
<li><a href='#set_disp'><p>Specify Prior for Dispersion or Standard Deviation</p></a></li>
<li><a href='#set_n_draw'><p>Specify Number of Draws from Prior or Posterior Distribution</p></a></li>
<li><a href='#set_prior'><p>Specify Prior for Model Term</p></a></li>
<li><a href='#set_var_age'><p>Specify Age Variable</p></a></li>
<li><a href='#set_var_sexgender'><p>Specify Sex or Gender Variable</p></a></li>
<li><a href='#set_var_time'><p>Specify Time Variable</p></a></li>
<li><a href='#Sp'><p>P-Spline Prior</p></a></li>
<li><a href='#SVD'><p>SVD-Based Prior for Age or Age-Sex Profiles</p></a></li>
<li><a href='#SVD_AR'><p>Dynamic SVD-Based Priors for Age Profiles or Age-Sex Profiles</p></a></li>
<li><a href='#swe_infant'><p>Infant Mortality in Sweden</p></a></li>
<li><a href='#tidy.bage_mod'><p>Summarize Terms from a Fitted Model</p></a></li>
<li><a href='#unfit'><p>Unfit a Model</p></a></li>
<li><a href='#usa_deaths'><p>Accidental Deaths in the USA</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Bayesian Estimation and Forecasting of Age-Specific Rates</td>
</tr>
<tr>
<td>Version:</td>
<td>0.9.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Fast Bayesian estimation and forecasting of age-specific
    rates, probabilities, and means, based on 'Template Model Builder'.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.3.0), rvec (&ge; 0.0.7)</td>
</tr>
<tr>
<td>Imports:</td>
<td>cli, generics, Matrix, methods, parallel, poputils (&ge; 0.3.3),
sparseMVN, stats, tibble, TMB, utils, vctrs</td>
</tr>
<tr>
<td>Suggests:</td>
<td>bookdown, dplyr, ggplot2, knitr, lifecycle, rmarkdown,
testthat (&ge; 3.0.0), tidyr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>TMB, RcppEigen</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://bayesiandemography.github.io/bage/">https://bayesiandemography.github.io/bage/</a>,
<a href="https://github.com/bayesiandemography/bage">https://github.com/bayesiandemography/bage</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/bayesiandemography/bage/issues">https://github.com/bayesiandemography/bage/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-08 04:30:37 UTC; johnbryant</td>
</tr>
<tr>
<td>Author:</td>
<td>John Bryant [aut, cre],
  Junni Zhang [aut],
  Bayesian Demography Limited [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>John Bryant &lt;john@bayesiandemography.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-08 05:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='bage-package'>Package 'bage'</h2><span id='topic+bage'></span><span id='topic+bage-package'></span>

<h3>Description</h3>

<p>Bayesian estimation and forecasting of age-specific rates.
Estimation uses <a href="https://CRAN.R-project.org/package=TMB">TMB</a>,
and is fast.
</p>


<h3>Example workflow</h3>


<ol>
<li><p> Specify model using <code><a href="#topic+mod_pois">mod_pois()</a></code>
</p>
</li>
<li><p> Fit model using <code><a href="#topic+fit">fit()</a></code>
</p>
</li>
<li><p> Extract results using <code><a href="#topic+augment">augment()</a></code>
</p>
</li>
<li><p> Check model using <code><a href="#topic+replicate_data">replicate_data()</a></code>
</p>
</li></ol>



<h3>Functions</h3>

<p><strong>Specify model</strong>
</p>

<ul>
<li> <p><code><a href="#topic+mod_pois">mod_pois()</a></code> Specify a Poisson model
</p>
</li>
<li> <p><code><a href="#topic+mod_binom">mod_binom()</a></code> Specify a binomial model
</p>
</li>
<li> <p><code><a href="#topic+mod_norm">mod_norm()</a></code> Specify a normal model
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for main effect or interaction
</p>
</li>
<li> <p><a href="#topic+priors">priors</a> List of available priors for main effects or interactions
</p>
</li>
<li> <p><code><a href="#topic+set_disp">set_disp()</a></code> Specify prior for dispersion/variance
</p>
</li>
<li> <p><code><a href="#topic+set_var_age">set_var_age()</a></code> Identify age variable in data
</p>
</li>
<li> <p><code><a href="#topic+set_var_sexgender">set_var_sexgender()</a></code> Identify sex or gender variable in data
</p>
</li>
<li> <p><code><a href="#topic+set_var_time">set_var_time()</a></code> Identify time variable in data
</p>
</li></ul>

<p><strong>Fit model</strong>
</p>

<ul>
<li> <p><code><a href="#topic+fit">fit()</a></code> Derive posterior distribution
</p>
</li>
<li> <p><code><a href="#topic+is_fitted">is_fitted()</a></code> See if model has been fitted
</p>
</li></ul>

<p><strong>Extract results</strong>
</p>

<ul>
<li> <p><code><a href="#topic+augment">augment()</a></code> Add cell-level estimates to data
</p>
</li>
<li> <p><a href="#topic+components.bage_mod">components()</a> Hyper-parameters
</p>
</li>
<li> <p><code><a href="#topic+tidy">tidy()</a></code> One-line summary
</p>
</li>
<li> <p><code><a href="#topic+set_n_draw">set_n_draw()</a></code> Specify number of prior or posterior draws
</p>
</li></ul>

<p><strong>Forecast</strong>
</p>

<ul>
<li> <p><code><a href="#topic+forecast">forecast()</a></code> Use model to obtain estimates for future periods
</p>
</li></ul>

<p><strong>Check model</strong>
</p>

<ul>
<li> <p><code><a href="#topic+replicate_data">replicate_data()</a></code> Compare real and simulated data
</p>
</li>
<li> <p><code><a href="#topic+report_sim">report_sim()</a></code> Simulation study of model
</p>
</li></ul>

<p><strong>SVD-based modelling of age profiles</strong>
</p>

<ul>
<li> <p><a href="#topic+components.bage_ssvd">components()</a> Matrices and offsets from scaled SVD
</p>
</li>
<li> <p><a href="#topic+generate.bage_ssvd">generate()</a> Random profiles
</p>
</li>
<li> <p><a href="#topic+HFD">HFD</a> Scaled SVD of fertility rates from Human Fertility Database
</p>
</li>
<li> <p><a href="#topic+HMD">HMD</a> Scaled SVD of mortality rates from Human Mortality Database
</p>
</li>
<li> <p><a href="#topic+LFP">LFP</a> Scaled SVD of labor force participation rates from OECD
</p>
</li></ul>

<p><strong>Data</strong>
</p>

<ul>
<li> <p><a href="#topic+isl_deaths">isl_deaths</a> Deaths in Iceland
</p>
</li>
<li> <p><a href="#topic+kor_births">kor_births</a> Births in South Korea
</p>
</li>
<li> <p><a href="#topic+nld_expenditure">nld_expenditure</a> Health expenditure in the Netherlands
</p>
</li>
<li> <p><a href="#topic+nzl_divorces">nzl_divorces</a> Divorces in New Zealand
</p>
</li>
<li> <p><a href="#topic+nzl_households">nzl_households</a> One-person households in New Zealand
</p>
</li>
<li> <p><a href="#topic+nzl_injuries">nzl_injuries</a> Fatal injuries in New Zealand
</p>
</li>
<li> <p><a href="#topic+swe_infant">swe_infant</a> Infant mortality in Sweden
</p>
</li>
<li> <p><a href="#topic+usa_deaths">usa_deaths</a> Accidental deaths in the USA
</p>
</li></ul>



<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: John Bryant <a href="mailto:john@bayesiandemography.com">john@bayesiandemography.com</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Junni Zhang <a href="mailto:junnizhang@163.com">junnizhang@163.com</a>
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Bayesian Demography Limited [copyright holder]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://bayesiandemography.github.io/bage/">https://bayesiandemography.github.io/bage/</a>
</p>
</li>
<li> <p><a href="https://github.com/bayesiandemography/bage">https://github.com/bayesiandemography/bage</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/bayesiandemography/bage/issues">https://github.com/bayesiandemography/bage/issues</a>
</p>
</li></ul>


<hr>
<h2 id='AR'>Autoregressive Prior</h2><span id='topic+AR'></span>

<h3>Description</h3>

<p>Use an autoregressive process to model
a main effect, or use multiple autoregressive
processes to model an interaction.
Typically used with time effects or with
interactions that involve time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AR(
  n_coef = 2,
  s = 1,
  shape1 = 5,
  shape2 = 5,
  along = NULL,
  con = c("none", "by")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="AR_+3A_n_coef">n_coef</code></td>
<td>
<p>Number of lagged terms in the
model, ie the order of the model. Default is <code>2</code>.</p>
</td></tr>
<tr><td><code id="AR_+3A_s">s</code></td>
<td>
<p>Scale for the prior for the innovations.
Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="AR_+3A_shape1">shape1</code>, <code id="AR_+3A_shape2">shape2</code></td>
<td>
<p>Parameters for beta-distribution prior
for coefficients. Defaults are <code>5</code> and <code>5</code>.</p>
</td></tr>
<tr><td><code id="AR_+3A_along">along</code></td>
<td>
<p>Name of the variable to be used
as the 'along' variable. Only used with
interactions.</p>
</td></tr>
<tr><td><code id="AR_+3A_con">con</code></td>
<td>
<p>Constraints on parameters.
Current choices are <code>"none"</code> and <code>"by"</code>.
Default is <code>"none"</code>. See below for details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>AR()</code> is used with an interaction, then
separate AR processes are constructed along
the 'along' variable, within each combination of the
'by' variables.
</p>
<p>By default, the autoregressive processes
have order 2. Alternative choices can be
specified through the <code>n_coef</code> argument.
</p>
<p>Argument <code>s</code> controls the size of innovations.
Smaller values for <code>s</code> tend to give smoother estimates.
</p>


<h3>Value</h3>

<p>An object of class <code>"bage_prior_ar"</code>.
</p>


<h3>Mathematical details</h3>

<p>When <code>AR()</code> is used with a main effect,
</p>
<p style="text-align: center;"><code class="reqn">\beta_j = \phi_1 \beta_{j-1} + \cdots + \phi_{\mathtt{n\_coef}} \beta_{j-\mathtt{n\_coef}} + \epsilon_j</code>
</p>

<p style="text-align: center;"><code class="reqn">\epsilon_j \sim \text{N}(0, \omega^2),</code>
</p>

<p>and when it is used with an interaction,
</p>
<p style="text-align: center;"><code class="reqn">\beta_{u,v} = \phi_1 \beta_{u,v-1} + \cdots + \phi_{\mathtt{n\_coef}} \beta_{u,v-\mathtt{n\_coef}} + \epsilon_{u,v}</code>
</p>

<p style="text-align: center;"><code class="reqn">\epsilon_{u,v} \sim \text{N}(0, \omega^2),</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\pmb{\beta}</code> is the main effect or interaction;
</p>
</li>
<li> <p><code class="reqn">j</code> denotes position within the main effect;
</p>
</li>
<li> <p><code class="reqn">v</code> denotes position within the 'along' variable of the interaction; and
</p>
</li>
<li> <p><code class="reqn">u</code> denotes position within the 'by' variable(s) of the interaction.
</p>
</li></ul>

<p>Internally, <code>AR()</code> derives a value for <code class="reqn">\omega</code> that
gives every element of <code class="reqn">\beta</code> a marginal
variance of <code class="reqn">\tau^2</code>. Parameter <code class="reqn">\tau</code>
has a half-normal prior
</p>
<p style="text-align: center;"><code class="reqn">\tau \sim \text{N}^+(0, \mathtt{s}^2).</code>
</p>

<p>The correlation coefficients <code class="reqn">\phi_1, \cdots, \phi_{\mathtt{n\_coef}}</code>
each have prior
</p>
<p style="text-align: center;"><code class="reqn">\phi_k \sim \text{Beta}(\mathtt{shape1}, \mathtt{shape2}).</code>
</p>



<h3>Constraints</h3>

<p>With some combinations of terms and priors, the values of
the intercept, main effects, and interactions are
are only weakly identified.
For instance, it may be possible to increase the value of the
intercept and reduce the value of the remaining terms in
the model with no effect on predicted rates and only a tiny
effect on prior probabilities. This weak identifiability is
typically harmless. However, in some applications, such as
forecasting, or when trying to obtain interpretable values
for main effects and interactions, it can be helpful to increase
identifiability through the use of constraints.
</p>
<p>Current options for constraints are:
</p>

<ul>
<li> <p><code>"none"</code> No constraints. The default.
</p>
</li>
<li> <p><code>"by"</code> Only used in interaction terms that include 'along' and
'by' dimensions. Within each value of the 'along'
dimension, terms across each 'by' dimension are constrained
to sum to 0.
</p>
</li></ul>



<h3>References</h3>


<ul>
<li> <p><code>AR()</code> is based on the TMB function
<a href="http://kaskr.github.io/adcomp/classdensity_1_1ARk__t.html#details">ARk</a>
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+AR1">AR1()</a></code> Special case of <code>AR()</code>. Can be more
numerically stable than higher-order models.
</p>
</li>
<li> <p><code><a href="#topic+Lin_AR">Lin_AR()</a></code>, <code><a href="#topic+Lin_AR1">Lin_AR1()</a></code> Straight line with AR errors
</p>
</li>
<li> <p><a href="#topic+priors">priors</a> Overview of priors implemented in <strong>bage</strong>
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for intercept,
main effect, or interaction
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>AR(n_coef = 3)
AR(n_coef = 3, s = 2.4)
AR(along = "cohort")
</code></pre>

<hr>
<h2 id='AR1'>Autoregressive Prior of Order 1</h2><span id='topic+AR1'></span>

<h3>Description</h3>

<p>Use an autoregressive process
of order 1 to model
a main effect, or use multiple AR1
processes to model an interaction.
Typically used with time effects or with
interactions that involve time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AR1(
  s = 1,
  shape1 = 5,
  shape2 = 5,
  min = 0.8,
  max = 0.98,
  along = NULL,
  con = c("none", "by")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="AR1_+3A_s">s</code></td>
<td>
<p>Scale for the prior for the innovations.
Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="AR1_+3A_shape1">shape1</code>, <code id="AR1_+3A_shape2">shape2</code></td>
<td>
<p>Parameters for beta-distribution prior
for coefficients. Defaults are <code>5</code> and <code>5</code>.</p>
</td></tr>
<tr><td><code id="AR1_+3A_min">min</code>, <code id="AR1_+3A_max">max</code></td>
<td>
<p>Minimum and maximum values
for autocorrelation coefficient.
Defaults are <code>0.8</code> and <code>0.98</code>.</p>
</td></tr>
<tr><td><code id="AR1_+3A_along">along</code></td>
<td>
<p>Name of the variable to be used
as the 'along' variable. Only used with
interactions.</p>
</td></tr>
<tr><td><code id="AR1_+3A_con">con</code></td>
<td>
<p>Constraints on parameters.
Current choices are <code>"none"</code> and <code>"by"</code>.
Default is <code>"none"</code>. See below for details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>AR()</code> is used with an interaction,
separate AR processes are constructed along
the 'along' variable, within each combination of the
'by' variables.
</p>
<p>Arguments <code>min</code> and <code>max</code> can be used to specify
the permissible range for autocorrelation.
</p>
<p>Argument <code>s</code> controls the size of innovations. Smaller values
for <code>s</code> tend to give smoother estimates.
</p>


<h3>Value</h3>

<p>An object of class <code>"bage_prior_ar"</code>.
</p>


<h3>Mathematical details</h3>

<p>When <code>AR1()</code> is used with a main effect,
</p>
<p style="text-align: center;"><code class="reqn">\beta_j = \phi \beta_{j-1} + \epsilon_j</code>
</p>

<p style="text-align: center;"><code class="reqn">\epsilon_j \sim \text{N}(0, \omega^2),</code>
</p>

<p>and when it is used with an interaction,
</p>
<p style="text-align: center;"><code class="reqn">\beta_{u,v} = \phi \beta_{u,v-1} + \epsilon_{u,v}</code>
</p>

<p style="text-align: center;"><code class="reqn">\epsilon_{u,v} \sim \text{N}(0, \omega^2),</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\pmb{\beta}</code> is the main effect or interaction;
</p>
</li>
<li> <p><code class="reqn">j</code> denotes position within the main effect;
</p>
</li>
<li> <p><code class="reqn">v</code> denotes position within the 'along' variable of the interaction; and
</p>
</li>
<li> <p><code class="reqn">u</code> denotes position within the 'by' variable(s) of the interaction.
</p>
</li></ul>

<p>Internally, <code>AR1()</code> derives a value for <code class="reqn">\omega</code> that
gives every element of <code class="reqn">\beta</code> a marginal
variance of <code class="reqn">\tau^2</code>. Parameter <code class="reqn">\tau</code>
has a half-normal prior
</p>
<p style="text-align: center;"><code class="reqn">\tau \sim \text{N}^+(0, \mathtt{s}^2),</code>
</p>

<p>where <code>s</code> is provided by the user.
</p>
<p>Coefficient <code class="reqn">\phi</code> is constrained
to lie between <code>min</code> and <code>max</code>.
Its prior distribution is
</p>
<p style="text-align: center;"><code class="reqn">\phi = (\mathtt{max} - \mathtt{min}) \phi' - \mathtt{min}</code>
</p>

<p>where
</p>
<p style="text-align: center;"><code class="reqn">\phi' \sim \text{Beta}(\mathtt{shape1}, \mathtt{shape2}).</code>
</p>



<h3>Constraints</h3>

<p>With some combinations of terms and priors, the values of
the intercept, main effects, and interactions are
are only weakly identified.
For instance, it may be possible to increase the value of the
intercept and reduce the value of the remaining terms in
the model with no effect on predicted rates and only a tiny
effect on prior probabilities. This weak identifiability is
typically harmless. However, in some applications, such as
forecasting, or when trying to obtain interpretable values
for main effects and interactions, it can be helpful to increase
identifiability through the use of constraints.
</p>
<p>Current options for constraints are:
</p>

<ul>
<li> <p><code>"none"</code> No constraints. The default.
</p>
</li>
<li> <p><code>"by"</code> Only used in interaction terms that include 'along' and
'by' dimensions. Within each value of the 'along'
dimension, terms across each 'by' dimension are constrained
to sum to 0.
</p>
</li></ul>



<h3>References</h3>


<ul>
<li> <p><code>AR1()</code> is based on the TMB function
<a href="http://kaskr.github.io/adcomp/classdensity_1_1AR1__t.html#details">AR1</a>
</p>
</li>
<li><p> The defaults for <code>min</code> and <code>max</code> are based on the
defaults for <code>forecast::ets()</code>.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+AR">AR()</a></code> Generalization of <code>AR1()</code>
</p>
</li>
<li> <p><code><a href="#topic+Lin_AR">Lin_AR()</a></code>, <code><a href="#topic+Lin_AR1">Lin_AR1()</a></code> Line with AR errors
</p>
</li>
<li> <p><a href="#topic+priors">priors</a> Overview of priors implemented in <strong>bage</strong>
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for intercept,
main effect, or interaction
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>AR1()
AR1(min = 0, max = 1, s = 2.4)
AR1(along = "cohort")
</code></pre>

<hr>
<h2 id='augment.bage_mod'>Extract Data and Modelled Values</h2><span id='topic+augment.bage_mod'></span>

<h3>Description</h3>

<p>Extract data and rates, probabilities, or means
from a model object.
The return value consists of the original
data and one or more columns of modelled values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bage_mod'
augment(x, quiet = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="augment.bage_mod_+3A_x">x</code></td>
<td>
<p>Object of class <code>"bage_mod"</code>, typically
created with <code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>,
or <code><a href="#topic+mod_norm">mod_norm()</a></code>.</p>
</td></tr>
<tr><td><code id="augment.bage_mod_+3A_quiet">quiet</code></td>
<td>
<p>Whether to suppress messages.
Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="augment.bage_mod_+3A_...">...</code></td>
<td>
<p>Unused. Included for generic consistency only.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <a href="tibble.html#topic+tibble-package">tibble</a>, with the original
data plus one or more of the following columns:
</p>

<ul>
<li> <p><code style="white-space: pre;">&#8288;.&lt;outcome&gt;&#8288;</code> Corrected or extended version of
the outcome variable, in applications where the
outcome variable has missing values, or a data model
is being used.
</p>
</li>
<li> <p><code>.observed</code> 'Direct' estimates of rates or
probabilities, ie counts divided by exposure or size
(in Poisson and binomial models.)
</p>
</li>
<li> <p><code>.fitted</code> Draws of rates, probabilities,
or means.
</p>
</li>
<li> <p><code>.expected</code> Draws of expected values for
rates or probabilities (in Poisson
that include exposure, or in binomial models.)
</p>
</li></ul>

<p>Uncertain quantities are represented using
<a href="rvec.html#topic+rvec">rvecs</a>.
</p>


<h3>Fitted vs unfitted models</h3>

<p><code>augment()</code> is typically called on a <a href="#topic+fit">fitted</a>
model. In this case, the modelled values are
draws from the joint posterior distribution for rates,
probabilities, or means.
</p>
<p><code>augment()</code> can, however, be called on an
unfitted model. In this case, the modelled values
are draws from the joint prior distribution.
In other words, the modelled values are informed by
model priors, and by values for <code>exposure</code>, <code>size</code>, or <code>weights</code>,
but not by observed outcomes.
</p>


<h3>Imputed values for outcome variable</h3>

<p><code>augment()</code> automatically imputes any missing
values for the outcome variable. If outcome variable
<code>var</code> has one or more <code>NA</code>s, then <code>augment</code>
creates a variable <code>.var</code>
holding original and imputed values.
</p>


<h3>Data model for outcome variable</h3>

<p>If the overall model includes a data model
for the outcome variable <code>var</code>,
then <code>augment()</code> creates a new variable <code>.var</code> containing
estimates of the true value for the outcome.
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+components">components()</a></code> Extract values for hyper-parameters from a model
</p>
</li>
<li> <p><code><a href="#topic+tidy">tidy()</a></code> Short summary of a model
</p>
</li>
<li> <p><code><a href="#topic+mod_pois">mod_pois()</a></code> Specify a Poisson model
</p>
</li>
<li> <p><code><a href="#topic+mod_binom">mod_binom()</a></code> Specify a binomial model
</p>
</li>
<li> <p><code><a href="#topic+mod_norm">mod_norm()</a></code> Specify a normal model
</p>
</li>
<li> <p><code><a href="#topic+fit">fit()</a></code> Fit a model
</p>
</li>
<li> <p><code><a href="#topic+is_fitted">is_fitted()</a></code> See if a model has been fitted
</p>
</li>
<li> <p><code><a href="#topic+unfit">unfit()</a></code> Reset a model
</p>
</li>
<li> <p><a href="#topic+datamods">datamods</a> Overview of data models implemented in <strong>bage</strong>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## specify model
mod &lt;- mod_pois(divorces ~ age + sex + time,
                data = nzl_divorces,
                exposure = population) |&gt;
  set_n_draw(n_draw = 100) ## smaller sample, so 'augment' faster

## draw from the prior distribution
mod |&gt; augment()

## fit model
mod &lt;- mod |&gt;
  fit()

## draw from the posterior distribution
mod |&gt; augment()

## insert a missing value into outcome variable
divorces_missing &lt;- nzl_divorces
divorces_missing$divorces[1] &lt;- NA

## fitting model and calling 'augument'
## creates a new variable called '.divorces'
## holding observed and imputed values
mod_pois(divorces ~ age + sex + time,
         data = divorces_missing,
         exposure = population) |&gt;
  fit() |&gt;
  augment()

## specifying a data model for the
## original data also leads to a new
## variable called '.divorces'
mod_pois(divorces ~ age + sex + time,
         data = nzl_divorces,
         exposure = population) |&gt;
  set_datamod_outcome_rr3() |&gt;
  fit() |&gt;
  augment()
</code></pre>

<hr>
<h2 id='components.bage_mod'>Extract Values for Hyper-Parameters</h2><span id='topic+components.bage_mod'></span>

<h3>Description</h3>

<p>Extract values for hyper-parameters
from a model object. Hyper-parameters include
main effects and interactions,
dispersion and variance terms,
and SVD or spline coefficients.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bage_mod'
components(object, quiet = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="components.bage_mod_+3A_object">object</code></td>
<td>
<p>Object of class <code>"bage_mod"</code>,
typically created with <code><a href="#topic+mod_pois">mod_pois()</a></code>,
<code><a href="#topic+mod_binom">mod_binom()</a></code>, or <code><a href="#topic+mod_norm">mod_norm()</a></code>.</p>
</td></tr>
<tr><td><code id="components.bage_mod_+3A_quiet">quiet</code></td>
<td>
<p>Whether to suppress messages.
Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="components.bage_mod_+3A_...">...</code></td>
<td>
<p>Unused. Included for generic consistency only.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <a href="tibble.html#topic+tibble-package">tibble</a>
with four columns columns:
</p>
<p>The return value contains the following columns:
</p>

<ul>
<li> <p><code>term</code> Model term that the hyper-parameter belongs to.
</p>
</li>
<li> <p><code>component</code> Component within term.
</p>
</li>
<li> <p><code>level</code> Element within component .
</p>
</li>
<li> <p><code>.fitted</code> An <a href="rvec.html#topic+rvec">rvec</a> containing
draws from the posterior distribution.
</p>
</li></ul>



<h3>Fitted vs unfitted models</h3>

<p><code>components()</code> is typically called on a <a href="#topic+fit">fitted</a>
model. In this case, the modelled values are
draws from the joint posterior distribution for the
hyper-parameters in the model.
</p>
<p><code>components()</code> can, however, be called on an
unfitted model. In this case, the modelled values
are draws from the joint prior distribution.
In other words, the modelled values are informed by
model priors, and by any <code>exposure</code>, <code>size</code>, or <code>weights</code>
argument in the model, but not by the observed outcomes.
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+augment">augment()</a></code> Extract data and values for rates,
means, or probabilities
</p>
</li>
<li> <p><code><a href="#topic+tidy">tidy()</a></code> Extract a one-line summary of a model
</p>
</li>
<li> <p><code><a href="#topic+mod_pois">mod_pois()</a></code> Specify a Poisson model
</p>
</li>
<li> <p><code><a href="#topic+mod_binom">mod_binom()</a></code> Specify a binomial model
</p>
</li>
<li> <p><code><a href="#topic+mod_norm">mod_norm()</a></code> Specify a normal model
</p>
</li>
<li> <p><code><a href="#topic+fit">fit()</a></code> Fit a model
</p>
</li>
<li> <p><code><a href="#topic+is_fitted">is_fitted()</a></code> See if a model has been fitted
</p>
</li>
<li> <p><code><a href="#topic+unfit">unfit()</a></code> Reset a model
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## specify model
mod &lt;- mod_pois(injuries ~ age + sex + year,
                data = nzl_injuries,
                exposure = popn)

## extract prior distribution
## of hyper-parameters
mod |&gt;
  components()

## fit model
mod &lt;- mod |&gt;
  fit()

## extract posterior distribution
## of hyper-parameters
mod |&gt;
  components()
</code></pre>

<hr>
<h2 id='components.bage_ssvd'>Extract Components used by SVD Summary</h2><span id='topic+components.bage_ssvd'></span>

<h3>Description</h3>

<p>Extract the matrix and offset used by a scaled SVD
summary of a demographic database.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bage_ssvd'
components(object, n_comp = NULL, indep = NULL, age_labels = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="components.bage_ssvd_+3A_object">object</code></td>
<td>
<p>An object of class <code>"bage_ssvd"</code>.</p>
</td></tr>
<tr><td><code id="components.bage_ssvd_+3A_n_comp">n_comp</code></td>
<td>
<p>The number of components.
The default is half the total number of
components of <code>object</code>.</p>
</td></tr>
<tr><td><code id="components.bage_ssvd_+3A_indep">indep</code></td>
<td>
<p>Whether to use independent or
joint SVDs for each sex/gender. If
no value is supplied, an SVD with no
sex/gender dimension is used. Note that the
default is different from <code><a href="#topic+SVD">SVD()</a></code>.</p>
</td></tr>
<tr><td><code id="components.bage_ssvd_+3A_age_labels">age_labels</code></td>
<td>
<p>Age labels for the
desired age or age-sex profile.
If no labels are supplied, the
most detailed profile available is used.</p>
</td></tr>
<tr><td><code id="components.bage_ssvd_+3A_...">...</code></td>
<td>
<p>Not currently used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble with the offset and components.
</p>


<h3>Scaled SVDs of demographic databases in bage</h3>


<ul>
<li> <p><code><a href="#topic+HMD">HMD</a></code> Mortality rates from the
<a href="https://www.mortality.org">Human Mortality Database</a>.
</p>
</li>
<li> <p><code><a href="#topic+HFD">HFD</a></code> Fertility rates from the
<a href="https://www.humanfertility.org">Human Fertility Database</a>.
</p>
</li>
<li> <p><code><a href="#topic+LFP">LFP</a></code> Labor forcce participation
rates from the <a href="https://data-explorer.oecd.org">OECD</a>.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><a href="#topic+generate">generate()</a> Randomly generate
age-profiles, or age-sex profiles, based on a
scaled SVD summary.
</p>
</li>
<li> <p><code><a href="#topic+SVD">SVD()</a></code> SVD prior for terms involving age.
</p>
</li>
<li> <p><code><a href="#topic+SVD_AR1">SVD_AR1()</a></code>, <code><a href="#topic+SVD_AR">SVD_AR()</a></code>, <code><a href="#topic+SVD_RW">SVD_RW()</a></code>, <code><a href="#topic+SVD_RW2">SVD_RW2()</a></code>
Dynamic SVD priors for terms involving age and time.
</p>
</li>
<li> <p><code><a href="poputils.html#topic+age_labels">poputils::age_labels()</a></code> Generate age labels.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## females and males combined
components(LFP, n_comp = 3)

## females and males modelled independently
components(LFP, indep = TRUE, n_comp = 3)

## joint model for females and males
components(LFP, indep = FALSE, n_comp = 3)

## specify age groups
labels &lt;- poputils::age_labels(type = "five", min = 15, max = 60)
components(LFP, age_labels = labels)
</code></pre>

<hr>
<h2 id='computations'>Information on Computations Performed Duration Model Fitting</h2><span id='topic+computations'></span>

<h3>Description</h3>

<p>Get information on computations performed by function <code><a href="#topic+fit">fit()</a></code>.
The information includes the total time used for fitting, and
the time used for two particular tasks that can be slow:
running the optimizer <code><a href="stats.html#topic+nlminb">stats::nlminb()</a></code>,
and drawing from the multivariate normal returned
by the TMB. It also includes values returned by the optimizer:
the number of iterations needed, and messages about convergence.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>computations(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="computations_+3A_object">object</code></td>
<td>
<p>A fitted object of class <code>"bage_mod"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <a href="tibble.html#topic+tibble-package">tibble</a> with the following
variables:
</p>

<ul>
<li> <p><code>time_total</code> Seconds used for whole fitting process.
</p>
</li>
<li> <p><code>time_optim</code> Seconds used for optimisiation.
</p>
</li>
<li> <p><code>time_report</code> Seconds used by function <code><a href="TMB.html#topic+sdreport">TMB::sdreport()</a></code>.
</p>
</li>
<li> <p><code>iter</code> Number of iterations required for optimization.
</p>
</li>
<li> <p><code>message</code> Message about convergence returned by optimizer.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+mod_pois">mod_pois()</a></code>,<code><a href="#topic+mod_binom">mod_binom()</a></code>,<code><a href="#topic+mod_norm">mod_norm()</a></code> Specify a model
</p>
</li>
<li> <p><code><a href="#topic+fit">fit()</a></code> Fit a model
</p>
</li>
<li> <p><code><a href="#topic+tidy">tidy()</a></code> Summarise a model
</p>
</li>
<li> <p><code><a href="#topic+set_n_draw">set_n_draw()</a></code> Specify number of posterior draws
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>mod &lt;- mod_pois(divorces ~ age + sex + time,
                data = nzl_divorces,
                exposure = population) |&gt;
  fit()

computations(mod)
</code></pre>

<hr>
<h2 id='datamods'>Data Models</h2><span id='topic+datamods'></span>

<h3>Description</h3>

<p>The models for rates, probabilities, or means
created with functions <code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>,
and <code><a href="#topic+mod_norm">mod_norm()</a></code> can be extended by adding data models,
also referred to as measurement error models.
Data models can be applied to the outcome variable,
the exposure variable (in Poisson models), or the
size variable (in binomial models).
</p>


<h3>Details</h3>

<p><strong>Data models for outcome variable</strong></p>

<table>
<tr>
 <td style="text-align: left;">
   <strong>Function</strong> </td><td style="text-align: left;"> <strong>Assumptions about data</strong> </td><td style="text-align: left;"> <strong>pois</strong> </td><td style="text-align: left;"> <strong>binom</strong> </td><td style="text-align: left;"> <strong>norm</strong> </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+set_datamod_outcome_rr3">set_datamod_outcome_rr3()</a></code> </td><td style="text-align: left;"> Outcome randomly rounded to base 3 </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> No </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p><strong>Data models for exposure or size variable</strong>
</p>
<p><em>None implemented yet</em>
</p>

<hr>
<h2 id='fit.bage_mod'>Fit a Model</h2><span id='topic+fit.bage_mod'></span>

<h3>Description</h3>

<p>Calculate the posterior distribution for a model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bage_mod'
fit(
  object,
  method = c("standard", "inner-outer"),
  vars_inner = NULL,
  optimizer = c("multi", "nlminb", "BFGS", "CG"),
  quiet = TRUE,
  start_oldpar = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fit.bage_mod_+3A_object">object</code></td>
<td>
<p>A <code>bage_mod</code> object,
created with <code><a href="#topic+mod_pois">mod_pois()</a></code>,
<code><a href="#topic+mod_binom">mod_binom()</a></code>, or <code><a href="#topic+mod_norm">mod_norm()</a></code>.</p>
</td></tr>
<tr><td><code id="fit.bage_mod_+3A_method">method</code></td>
<td>
<p>Estimation method. Current
choices are <code>"standard"</code> (the default)
and <code>"inner-outer"</code>.
See below for details.</p>
</td></tr>
<tr><td><code id="fit.bage_mod_+3A_vars_inner">vars_inner</code></td>
<td>
<p>Names of variables to use
for inner model when <code>method</code> is <code style="white-space: pre;">&#8288;"inner-outer". If &#8288;</code>NULL<code style="white-space: pre;">&#8288;(the default)&#8288;</code>vars_inner' is the
<a href="#topic+set_var_age">age</a>, <a href="#topic+set_var_sexgender">sex/gender</a>,
and <a href="#topic+set_var_time">time</a> variables.</p>
</td></tr>
<tr><td><code id="fit.bage_mod_+3A_optimizer">optimizer</code></td>
<td>
<p>Which optimizer to use.
Current choices are <code>"multi"</code>,
<code>"nlminb"</code>, <code>"BFGS"</code>, and &quot;GC&quot;. Default
is <code>"multi"</code>. See below for details.</p>
</td></tr>
<tr><td><code id="fit.bage_mod_+3A_quiet">quiet</code></td>
<td>
<p>Whether to suppress warnings and
progress messages from the optimizer.
Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="fit.bage_mod_+3A_start_oldpar">start_oldpar</code></td>
<td>
<p>Whether the optimizer should start
at previous estimates. Used only
when <code>fit()</code> is being called on a fitted
model. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="fit.bage_mod_+3A_...">...</code></td>
<td>
<p>Not currently used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>bage_mod</code> object
</p>


<h3>Estimation methods</h3>


<ul>
<li> <p><code>"standard"</code> All parameters, other than
the lowest-level rates, probabilities, or
means are jointly estimated within TMB.
The default.
</p>
</li>
<li> <p><code>"inner-outer"</code>. Multiple-stage estimation,
which can be faster than <code>"standard"</code> for
models with many parameters. In Step 1, the
data is aggregated across all dimensions other
than those specified in <code>var_inner</code>, and a model
for the <code>inner</code> variables is fitted to the data.
In Step 2, the data is aggregated across the
remaining variables, and a model for the
<code>outer</code> variables is fitted to the data.
In Step 3, values for dispersion are calculated.
Parameter estimtes from steps 1, 2, and 3
are then combined. <code>"inner-outer"</code> methods are
still experimental, and may change in future,
eg dividing calculations into chunks in Step 2.
</p>
</li></ul>



<h3>Optimizer</h3>

<p>The choices for the <code>optimizer</code> argument are:
</p>

<ul>
<li> <p><code>"multi"</code> Try <code>"nlminb"</code>, and if that fails,
retart from the value where <code>"nlminb"</code> stopped,
using <code>"BFGS"</code>. The default.
</p>
</li>
<li> <p><code>"nlminb"</code> <code><a href="stats.html#topic+nlminb">stats::nlminb()</a></code>
</p>
</li>
<li> <p><code>"BFGS"</code> <code><a href="stats.html#topic+optim">stats::optim()</a></code> using method <code>"BFGS"</code>.
</p>
</li>
<li> <p><code>"GC"</code> <code><a href="stats.html#topic+optim">stats::optim()</a></code> using method <code>"CG"</code> (conjugate gradient).
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>, <code><a href="#topic+mod_norm">mod_norm()</a></code> Specify a model
</p>
</li>
<li> <p><code><a href="#topic+augment">augment()</a></code>, <code><a href="#topic+components">components()</a></code>, <code><a href="#topic+tidy">tidy()</a></code> Examine
output from a model
</p>
</li>
<li> <p><code><a href="#topic+forecast">forecast()</a></code> Forecast, based on a model
</p>
</li>
<li> <p><code><a href="#topic+report_sim">report_sim()</a></code> Simulation study of a model
</p>
</li>
<li> <p><code><a href="#topic+unfit">unfit()</a></code> Reset a model
</p>
</li>
<li> <p><code><a href="#topic+is_fitted">is_fitted()</a></code> Check if a model has been fitted
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## specify model
mod &lt;- mod_pois(injuries ~ age + sex + year,
                data = nzl_injuries,
                exposure = popn)

## examine unfitted model
mod

## fit model
mod &lt;- fit(mod)

## examine fitted model
mod

## extract rates
aug &lt;- augment(mod)
aug

## extract hyper-parameters
comp &lt;- components(mod)
comp
</code></pre>

<hr>
<h2 id='forecast.bage_mod'>Use a Model to Make a Forecast</h2><span id='topic+forecast.bage_mod'></span>

<h3>Description</h3>

<p>Forecast rates, probabilities, means, and
other model parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bage_mod'
forecast(
  object,
  newdata = NULL,
  output = c("augment", "components"),
  include_estimates = FALSE,
  labels = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="forecast.bage_mod_+3A_object">object</code></td>
<td>
<p>A <code>bage_mod</code> object,
typically created with <code><a href="#topic+mod_pois">mod_pois()</a></code>,
<code><a href="#topic+mod_binom">mod_binom()</a></code>, or <code><a href="#topic+mod_norm">mod_norm()</a></code>.</p>
</td></tr>
<tr><td><code id="forecast.bage_mod_+3A_newdata">newdata</code></td>
<td>
<p>Data frame with data for
future periods.</p>
</td></tr>
<tr><td><code id="forecast.bage_mod_+3A_output">output</code></td>
<td>
<p>Type of output returned</p>
</td></tr>
<tr><td><code id="forecast.bage_mod_+3A_include_estimates">include_estimates</code></td>
<td>
<p>Whether to
include historical estimates along
with the forecasts. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="forecast.bage_mod_+3A_labels">labels</code></td>
<td>
<p>Labels for future values.</p>
</td></tr>
<tr><td><code id="forecast.bage_mod_+3A_...">...</code></td>
<td>
<p>Not currently used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <a href="tibble.html#topic+tibble-package">tibble</a>.
</p>


<h3>How the forecasts are constructed</h3>

<p>Internally, the steps involved in a forecast are:
</p>

<ol>
<li><p> Forecast time-varying main effects and interactions,
e.g. a time main effect, or an age-time interaction.
</p>
</li>
<li><p> Combine forecasts for the time-varying main effects and
interactions with non-time-varying parameters, e.g.
age effects or dispersion.
</p>
</li>
<li><p> Use the combined parameters to generate values for
rates, probabilities or means.
</p>
</li>
<li><p> If a <code>newdata</code> argument has been provided,
and <code>output</code> is <code>"augment"</code>,
draw values for outcome.
</p>
</li></ol>

<p><code>vignette("vig2_math")</code> has the technical details.
</p>


<h3>Output</h3>

<p>When <code>output</code> is <code>"augment"</code> (the default),
the return value from <code>forecast()</code>
looks like output from function <code><a href="#topic+augment">augment()</a></code>. When <code>output</code> is
<code>"components"</code>, the return value looks like output
from <code><a href="#topic+components">components()</a></code>.
</p>
<p>When <code>include_estimates</code> is <code>FALSE</code> (the default),
the output of <code>forecast()</code> excludes values for
time-varying parameters for the period covered by the data.
When <code>include_estimates</code> is <code>TRUE</code>, the output
includes these values.
Setting <code>include_estimates</code> to <code>TRUE</code> can be helpful
when creating graphs that combine estimates and forecasts.
</p>


<h3>Fitted and unfitted models</h3>

<p><code>forecast()</code> is typically used with a
<a href="#topic+fit">fitted</a> model, i.e. a model in which parameter
values have been estimated from the data.
The resulting forecasts reflect data and priors.
</p>
<p><code>forecast()</code> can, however, be used with an
unfitted model. In this case, the forecasts
are based entirely on the priors. See below for
an example. Experimenting with forecasts
based entirely on the priors can be helpful for
choosing an appropriate model.
</p>


<h3>Warning</h3>

<p>The interface for <code>forecast()</code> has not been finalised.
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>, <code><a href="#topic+mod_norm">mod_norm()</a></code> to specify a model
</p>
</li>
<li> <p><code><a href="#topic+fit">fit()</a></code> to fit a model
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## specify and fit model
mod &lt;- mod_pois(injuries ~ age * sex + ethnicity + year,
                data = nzl_injuries,
                exposure = popn) |&gt;
  fit()
mod

## forecasts
mod |&gt;
  forecast(labels = 2019:2024)

## combined estimates and forecasts
mod |&gt;
  forecast(labels = 2019:2024,
           include_estimates = TRUE)

## hyper-parameters
mod |&gt;
  forecast(labels = 2019:2024,
           output = "components")

## hold back some data and forecast
library(dplyr, warn.conflicts = FALSE)
data_historical &lt;- nzl_injuries |&gt;
  filter(year &lt;= 2015)
data_forecast &lt;- nzl_injuries |&gt;
  filter(year &gt; 2015) |&gt;
  mutate(injuries = NA)
mod_pois(injuries ~ age * sex + ethnicity + year,
         data = data_historical,
         exposure = popn) |&gt;
  fit() |&gt;
  forecast(newdata = data_forecast)

## forecast based on priors only
mod_unfitted &lt;- mod_pois(injuries ~ age * sex + ethnicity + year,
                         data = nzl_injuries,
                         exposure = popn)
mod_unfitted |&gt;
  forecast(labels = 2019:2024)
</code></pre>

<hr>
<h2 id='generate.bage_prior_ar'>Generate Values from Priors</h2><span id='topic+generate.bage_prior_ar'></span><span id='topic+generate.bage_prior_known'></span><span id='topic+generate.bage_prior_lin'></span><span id='topic+generate.bage_prior_linar'></span><span id='topic+generate.bage_prior_linex'></span><span id='topic+generate.bage_prior_norm'></span><span id='topic+generate.bage_prior_normfixed'></span><span id='topic+generate.bage_prior_rwrandom'></span><span id='topic+generate.bage_prior_rwrandomseasfix'></span><span id='topic+generate.bage_prior_rwrandomseasvary'></span><span id='topic+generate.bage_prior_rwzero'></span><span id='topic+generate.bage_prior_rwzeroseasfix'></span><span id='topic+generate.bage_prior_rwzeroseasvary'></span><span id='topic+generate.bage_prior_rw2random'></span><span id='topic+generate.bage_prior_rw2randomseasfix'></span><span id='topic+generate.bage_prior_rw2randomseasvary'></span><span id='topic+generate.bage_prior_rw2zero'></span><span id='topic+generate.bage_prior_rw2zeroseasfix'></span><span id='topic+generate.bage_prior_rw2zeroseasvary'></span><span id='topic+generate.bage_prior_spline'></span><span id='topic+generate.bage_prior_svd'></span><span id='topic+generate.bage_prior_svd_ar'></span><span id='topic+generate.bage_prior_svd_rwrandom'></span><span id='topic+generate.bage_prior_svd_rwzero'></span><span id='topic+generate.bage_prior_svd_rw2random'></span><span id='topic+generate.bage_prior_svd_rw2zero'></span>

<h3>Description</h3>

<p>Generate draws from priors for model terms.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bage_prior_ar'
generate(x, n_along = 20, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_known'
generate(x, n_element = 20, n_draw = 25, ...)

## S3 method for class 'bage_prior_lin'
generate(x, n_along = 20, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_linar'
generate(x, n_along = 20, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_linex'
generate(x, n_along = 20, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_norm'
generate(x, n_element = 20, n_draw = 25, ...)

## S3 method for class 'bage_prior_normfixed'
generate(x, n_element = 20, n_draw = 25, ...)

## S3 method for class 'bage_prior_rwrandom'
generate(x, n_along = 20, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_rwrandomseasfix'
generate(x, n_along = 20, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_rwrandomseasvary'
generate(x, n_along = 20, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_rwzero'
generate(x, n_along = 20, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_rwzeroseasfix'
generate(x, n_along = 20, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_rwzeroseasvary'
generate(x, n_along = 20, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_rw2random'
generate(x, n_along = 20, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_rw2randomseasfix'
generate(x, n_along = 20, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_rw2randomseasvary'
generate(x, n_along = 20, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_rw2zero'
generate(x, n_along = 20, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_rw2zeroseasfix'
generate(x, n_along = 20, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_rw2zeroseasvary'
generate(x, n_along = 20, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_spline'
generate(x, n_along = 20, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_svd'
generate(x, n_element = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_svd_ar'
generate(x, n_along = 5, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_svd_rwrandom'
generate(x, n_along = 5, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_svd_rwzero'
generate(x, n_along = 5, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_svd_rw2random'
generate(x, n_along = 5, n_by = 1, n_draw = 25, ...)

## S3 method for class 'bage_prior_svd_rw2zero'
generate(x, n_along = 5, n_by = 1, n_draw = 25, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="generate.bage_prior_ar_+3A_x">x</code></td>
<td>
<p>Object of class <code>"bage_prior"</code></p>
</td></tr>
<tr><td><code id="generate.bage_prior_ar_+3A_n_along">n_along</code></td>
<td>
<p>Number of elements of
'along' dimension. Default is <code>20</code>.</p>
</td></tr>
<tr><td><code id="generate.bage_prior_ar_+3A_n_by">n_by</code></td>
<td>
<p>Number of combinations of
'by' variables. Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="generate.bage_prior_ar_+3A_n_draw">n_draw</code></td>
<td>
<p>Number of draws. Default
is <code>25</code>.</p>
</td></tr>
<tr><td><code id="generate.bage_prior_ar_+3A_...">...</code></td>
<td>
<p>Unused. Included for generic consistency only.</p>
</td></tr>
<tr><td><code id="generate.bage_prior_ar_+3A_n_element">n_element</code></td>
<td>
<p>Number of elements in term,
in priors that do not distinguish
'along' and 'by' dimensions.
Default is <code>20</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Some priors distinguish between 'along' and 'by'
dimensions, while others do not: see <a href="#topic+priors">priors</a>
for a complete list. Arguments <code>n_along</code> and <code>n_by</code>
are used with priors that make the distinction,
and argument <code>n_element</code> is used with priors that do not.
</p>


<h3>Value</h3>

<p>A <a href="tibble.html#topic+tibble">tibble</a>
</p>


<h3>See Also</h3>


<ul>
<li> <p><a href="#topic+priors">priors</a> Overview of priors implemented in <strong>bage</strong>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## prior that distinguishes 'along' and 'by'
x &lt;- RW()
generate(x, n_along = 10, n_by = 2)

## prior that does not distinguish
x &lt;- N()
generate(x, n_element = 20)

## SVD_AR(), SVD_RW(), and SVD_RW2()
## distinguish 'along' and 'by'
x &lt;- SVD_AR(HFD)
generate(x, n_along = 5, n_by = 2)

## SVD() does not
x &lt;- SVD(HFD)
generate(x, n_element = 10)
</code></pre>

<hr>
<h2 id='generate.bage_ssvd'>Generate Random Age or Age-Sex Profiles</h2><span id='topic+generate.bage_ssvd'></span>

<h3>Description</h3>

<p>Generate random age or age-sex profiles from
an object of class <code>"bage_ssvd"</code>. An object
of class <code>"bage_ssvd"</code> holds results from
an <a href="base.html#topic+svd">SVD</a> decomposition of demographic
data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bage_ssvd'
generate(x, n_draw = 20, n_comp = NULL, indep = NULL, age_labels = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="generate.bage_ssvd_+3A_x">x</code></td>
<td>
<p>An object of class <code>"bage_ssvd"</code>.</p>
</td></tr>
<tr><td><code id="generate.bage_ssvd_+3A_n_draw">n_draw</code></td>
<td>
<p>Number of random draws to generate.</p>
</td></tr>
<tr><td><code id="generate.bage_ssvd_+3A_n_comp">n_comp</code></td>
<td>
<p>The number of components.
The default is half the total number of
components of <code>object</code>.</p>
</td></tr>
<tr><td><code id="generate.bage_ssvd_+3A_indep">indep</code></td>
<td>
<p>Whether to use independent or
joint SVDs for each sex/gender. If
no value is supplied, an SVD with no
sex/gender dimension is used. Note that the
default is different from <code><a href="#topic+SVD">SVD()</a></code>.</p>
</td></tr>
<tr><td><code id="generate.bage_ssvd_+3A_age_labels">age_labels</code></td>
<td>
<p>Age labels for the
desired age or age-sex profile.
If no labels are supplied, the
most detailed profile available is used.</p>
</td></tr>
<tr><td><code id="generate.bage_ssvd_+3A_...">...</code></td>
<td>
<p>Unused. Included for generic consistency only.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble
</p>


<h3>Scaled SVDs of demographic databases in bage</h3>


<ul>
<li> <p><code><a href="#topic+HMD">HMD</a></code> Mortality rates from the
<a href="https://www.mortality.org">Human Mortality Database</a>.
</p>
</li>
<li> <p><code><a href="#topic+HFD">HFD</a></code> Fertility rates from the
<a href="https://www.humanfertility.org">Human Fertility Database</a>.
</p>
</li>
<li> <p><code><a href="#topic+LFP">LFP</a></code> Labor forcce participation
rates from the <a href="https://data-explorer.oecd.org">OECD</a>.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><a href="#topic+components">components()</a> Components
used by SVD prior.
</p>
</li>
<li> <p><code><a href="#topic+SVD">SVD()</a></code> SVD prior for term involving age.
</p>
</li>
<li> <p><code><a href="#topic+SVD_AR1">SVD_AR1()</a></code>, <code><a href="#topic+SVD_AR">SVD_AR()</a></code>, <code><a href="#topic+SVD_RW">SVD_RW()</a></code>, <code><a href="#topic+SVD_RW2">SVD_RW2()</a></code>
Dynamic SVD priors for terms involving age and time.
</p>
</li>
<li> <p><code><a href="poputils.html#topic+age_labels">poputils::age_labels()</a></code> Generate age labels.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## SVD for females and males combined
generate(HMD)

## separate SVDs for females and males
generate(HMD, indep = TRUE) 

## specify age groups
labels &lt;- poputils::age_labels(type = "lt", max = 60)
generate(HMD, age_labels = labels)
</code></pre>

<hr>
<h2 id='HFD'>Components from Human Fertility Database</h2><span id='topic+HFD'></span>

<h3>Description</h3>

<p>An object of class <code>"bage_ssvd"</code>
holding components extracted from mortality
data from the
<a href="https://www.humanfertility.org">Human Fertility Database</a>.
The object holds 5 components.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HFD
</code></pre>


<h3>Format</h3>

<p>Object of class <code>"bage_ssvd"</code>.
</p>


<h3>Source</h3>

<p>Derived from data from the
Human Fertility Database.Max Planck Institute
for Demographic Research (Germany) and Vienna
Institute of Demography (Austria). .
Code to create <code>HFD</code>
is in folder 'data-raw/ssvd_hfd'
in the source code for <strong>bage</strong>
package.
</p>

<hr>
<h2 id='HMD'>Components from Human Mortality Database</h2><span id='topic+HMD'></span>

<h3>Description</h3>

<p>An object of class <code>"bage_ssvd"</code>
holding components extracted from mortality
data from the
<a href="https://www.mortality.org">Human Mortality Database</a>.
The object holds 5 components.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HMD
</code></pre>


<h3>Format</h3>

<p>Object of class <code>"bage_ssvd"</code>.
</p>


<h3>Source</h3>

<p>Derived from data from the
Human Mortality Database. Max Planck Institute for
Demographic Research (Germany), University of California,
Berkeley (USA), and French Institute for Demographic Studies
(France). Code to create <code>HMD</code>
is in folder 'data-raw/ssvd_hmd'
in the source code for <strong>bage</strong>
package.
</p>

<hr>
<h2 id='is_fitted'>Test Whether a Model has Been Fitted</h2><span id='topic+is_fitted'></span>

<h3>Description</h3>

<p>Test whether <a href="#topic+fit.bage_mod">fit()</a> has been
called on a model object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_fitted(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="is_fitted_+3A_x">x</code></td>
<td>
<p>An object of class <code>"bage_mod"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>TRUE</code> or <code>FALSE</code>
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>, <code><a href="#topic+mod_norm">mod_norm()</a></code> to specify a model
</p>
</li>
<li> <p><code><a href="#topic+fit">fit()</a></code> to fit a model
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>mod &lt;- mod_pois(injuries ~ age + sex + year,
                data = nzl_injuries,
                exposure = popn)
is_fitted(mod)
mod &lt;- fit(mod)
is_fitted(mod)
</code></pre>

<hr>
<h2 id='isl_deaths'>Deaths in Iceland</h2><span id='topic+isl_deaths'></span>

<h3>Description</h3>

<p>Deaths and mid-year populations in Iceland,
by age, sex, and calendar year.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>isl_deaths
</code></pre>


<h3>Format</h3>

<p>A <a href="tibble.html#topic+tibble-package">tibble</a> with 5,300 rows and the following
columns:
</p>

<ul>
<li> <p><code>age</code> Single year of age, up to <code>"105+"</code>
</p>
</li>
<li> <p><code>sex</code> <code>"Female"</code> and <code>"Male"</code>
</p>
</li>
<li> <p><code>time</code> Calendar year, 1998-2022
</p>
</li>
<li> <p><code>deaths</code> Counts of deaths
</p>
</li>
<li> <p><code>popn</code> Mid-year population
</p>
</li></ul>



<h3>Source</h3>

<p>Tables &quot;Deaths by municipalities, sex and age 1981-2022&quot;,
and &quot;Average annual population by municipality,
age and sex 1998-2022 - Current municipalities&quot;,
on the Statistics Iceland website. Data downloaded
on 12 July 2023.
</p>

<hr>
<h2 id='Known'>Known Prior</h2><span id='topic+Known'></span>

<h3>Description</h3>

<p>Treat an intercept, a main effect, or an interaction
as fixed and known.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Known(values)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Known_+3A_values">values</code></td>
<td>
<p>A numeric vector</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>"bage_prior_known"</code>.
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+NFix">NFix()</a></code> Prior where level unknown, but variability known.
</p>
</li>
<li> <p><a href="#topic+priors">priors</a> Overview of priors implemented in <strong>bage</strong>
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for intercept,
main effect, or interaction
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>Known(-2.3)
Known(c(0.1, 2, -0.11))
</code></pre>

<hr>
<h2 id='kor_births'>Births in South Korea</h2><span id='topic+kor_births'></span>

<h3>Description</h3>

<p>Births by age of mother, region, and calendar year,
2011-2023.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>kor_births
</code></pre>


<h3>Format</h3>

<p>A <a href="tibble.html#topic+tibble-package">tibble</a> with 1,872 rows and the following
columns:
</p>

<ul>
<li> <p><code>age</code> Five-year age groups from <code style="white-space: pre;">&#8288;"10-14" to &#8288;</code>&quot;50-54&quot;'
</p>
</li>
<li> <p><code>region</code> Administrative region
</p>
</li>
<li> <p><code>time</code> Calendar year, 2011-2023
</p>
</li>
<li> <p><code>births</code> Counts of births
</p>
</li>
<li> <p><code>popn</code> Mid-year population
</p>
</li></ul>



<h3>Source</h3>

<p>Tables &quot;Live Births by Age Group of Mother,
Sex and Birth Order for Provinces&quot;,
and &quot;Resident Population in Five-Year Age Groups&quot;,
on the Korean Statistical Information Service website.
Data downloaded on 24 September 2024.
</p>

<hr>
<h2 id='LFP'>Components from OECD Labor Force Participation Data</h2><span id='topic+LFP'></span>

<h3>Description</h3>

<p>An object of class <code>"bage_ssvd"</code>
holding components extracted from labor force participation
data from the
<a href="https://data-explorer.oecd.org">OECD Data Explorer</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LFP
</code></pre>


<h3>Format</h3>

<p>Object of class <code>"bage_ssvd"</code>.
</p>


<h3>Source</h3>

<p>Derived from data in the &quot;Labor Force Indicators&quot;
table of the OECD Data Explorer.
Code to create <code>LFS</code>
is in folder 'data-raw/ssvd_lfp' in
the source code for the <strong>bage</strong>
package.
</p>

<hr>
<h2 id='Lin'>Linear Prior with Independent Normal Errors</h2><span id='topic+Lin'></span>

<h3>Description</h3>

<p>Use a line or lines with independent
normal errors to model a main effect
or interaction. Typically used with time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Lin(s = 1, mean_slope = 0, sd_slope = 1, along = NULL, con = c("none", "by"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Lin_+3A_s">s</code></td>
<td>
<p>Scale for the prior for the errors.
Default is <code>1</code>. Can be <code>0</code>.</p>
</td></tr>
<tr><td><code id="Lin_+3A_mean_slope">mean_slope</code></td>
<td>
<p>Mean in prior for slope
of line. Default is 0.</p>
</td></tr>
<tr><td><code id="Lin_+3A_sd_slope">sd_slope</code></td>
<td>
<p>Standard deviation in prior for slope
of line. Default is 1.</p>
</td></tr>
<tr><td><code id="Lin_+3A_along">along</code></td>
<td>
<p>Name of the variable to be used
as the 'along' variable. Only used with
interactions.</p>
</td></tr>
<tr><td><code id="Lin_+3A_con">con</code></td>
<td>
<p>Constraints on parameters.
Current choices are <code>"none"</code> and <code>"by"</code>.
Default is <code>"none"</code>. See below for details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>Lin()</code> is used with an interaction,
then separate lines are constructed along
the 'along' variable, within each combination
of the 'by' variables.
</p>
<p>Argument <code>s</code> controls the size of the errors.
Smaller values tend to give smoother estimates.
<code>s</code> can be zero.
</p>
<p>Argument <code>sd_slope</code> controls the size of the slopes of
the lines. Larger values can give more steeply
sloped lines.
</p>


<h3>Value</h3>

<p>An object of class <code>"bage_prior_lin"</code>.
</p>


<h3>Mathematical details</h3>

<p>When <code>Lin()</code> is used with a main effect,
</p>
<p style="text-align: center;"><code class="reqn">\beta_j = \alpha + j \eta + \epsilon_j</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha \sim \text{N}(0, 1)</code>
</p>

<p style="text-align: center;"><code class="reqn">\epsilon_j \sim \text{N}(0, \tau^2),</code>
</p>

<p>and when it is used with an interaction,
</p>
<p style="text-align: center;"><code class="reqn">\beta_{u,v} \sim  \alpha_u + v \eta_u + \epsilon_{u,v}</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha_u \sim \text{N}(0, 1)</code>
</p>

<p style="text-align: center;"><code class="reqn">\epsilon_{u,v} \sim \text{N}(0, \tau^2),</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\pmb{\beta}</code> is the main effect or interaction;
</p>
</li>
<li> <p><code class="reqn">j</code> denotes position within the main effect;
</p>
</li>
<li> <p><code class="reqn">v</code> denotes position within the 'along' variable of the interaction; and
</p>
</li>
<li> <p><code class="reqn">u</code> denotes position within the 'by' variable(s) of the interaction.
</p>
</li></ul>

<p>The slopes have priors
</p>
<p style="text-align: center;"><code class="reqn">\eta \sim \text{N}(\mathtt{mean_slope}, \mathtt{sd_slope}^2)</code>
</p>

<p>and
</p>
<p style="text-align: center;"><code class="reqn">\eta_u \sim \text{N}(\mathtt{mean_slope}, \mathtt{sd_slope}^2).</code>
</p>

<p>Parameter <code class="reqn">\tau</code> has a half-normal prior
</p>
<p style="text-align: center;"><code class="reqn">\tau \sim \text{N}^+(0, \mathtt{s}^2).</code>
</p>



<h3>Constraints</h3>

<p>With some combinations of terms and priors, the values of
the intercept, main effects, and interactions are
are only weakly identified.
For instance, it may be possible to increase the value of the
intercept and reduce the value of the remaining terms in
the model with no effect on predicted rates and only a tiny
effect on prior probabilities. This weak identifiability is
typically harmless. However, in some applications, such as
forecasting, or when trying to obtain interpretable values
for main effects and interactions, it can be helpful to increase
identifiability through the use of constraints.
</p>
<p>Current options for constraints are:
</p>

<ul>
<li> <p><code>"none"</code> No constraints. The default.
</p>
</li>
<li> <p><code>"by"</code> Only used in interaction terms that include 'along' and
'by' dimensions. Within each value of the 'along'
dimension, terms across each 'by' dimension are constrained
to sum to 0.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+Lin_AR">Lin_AR()</a></code> Linear with AR errors
</p>
</li>
<li> <p><code><a href="#topic+Lin_AR1">Lin_AR1()</a></code> Linear with AR1 errors
</p>
</li>
<li> <p><code><a href="#topic+RW2">RW2()</a></code> Second-order random walk
</p>
</li>
<li> <p><a href="#topic+priors">priors</a> Overview of priors implemented in <strong>bage</strong>
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for intercept,
main effect, or interaction
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>Lin()
Lin(s = 0.5, sd_slope = 2)
Lin(s = 0)
Lin(along = "cohort")
</code></pre>

<hr>
<h2 id='Lin_AR'>Linear Prior with Autoregressive Errors</h2><span id='topic+Lin_AR'></span>

<h3>Description</h3>

<p>Use a line or lines with autoregressive
errors to model a main effect
or interaction. Typically used with time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Lin_AR(
  n_coef = 2,
  s = 1,
  shape1 = 5,
  shape2 = 5,
  mean_slope = 0,
  sd_slope = 1,
  along = NULL,
  con = c("none", "by")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Lin_AR_+3A_n_coef">n_coef</code></td>
<td>
<p>Number of lagged terms in the
model, ie the order of the model. Default is <code>2</code>.</p>
</td></tr>
<tr><td><code id="Lin_AR_+3A_s">s</code></td>
<td>
<p>Scale for the innovations in the
AR process. Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="Lin_AR_+3A_shape1">shape1</code>, <code id="Lin_AR_+3A_shape2">shape2</code></td>
<td>
<p>Parameters for beta-distribution prior
for coefficients. Defaults are <code>5</code> and <code>5</code>.</p>
</td></tr>
<tr><td><code id="Lin_AR_+3A_mean_slope">mean_slope</code></td>
<td>
<p>Mean in prior for slope
of line. Default is 0.</p>
</td></tr>
<tr><td><code id="Lin_AR_+3A_sd_slope">sd_slope</code></td>
<td>
<p>Standard deviation in the prior for
the slope of the line. Larger values imply
steeper slopes. Default is 1.</p>
</td></tr>
<tr><td><code id="Lin_AR_+3A_along">along</code></td>
<td>
<p>Name of the variable to be used
as the 'along' variable. Only used with
interactions.</p>
</td></tr>
<tr><td><code id="Lin_AR_+3A_con">con</code></td>
<td>
<p>Constraints on parameters.
Current choices are <code>"none"</code> and <code>"by"</code>.
Default is <code>"none"</code>. See below for details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>Lin_AR()</code> is used with an interaction,
separate lines are constructed along
the 'along' variable, within each combination
of the 'by' variables.
</p>
<p>The order of the autoregressive errors is
controlled by the <code>n_coef</code> argument. The
default is 2.
</p>
<p>Argument <code>s</code> controls the size of the innovations.
Smaller values tend to give smoother estimates.
</p>
<p>Argument <code>sd_slope</code> controls the slopes of
the lines. Larger values can give more steeply
sloped lines.
</p>


<h3>Value</h3>

<p>An object of class <code>"bage_prior_linar"</code>.
</p>


<h3>Mathematical details</h3>

<p>When <code>Lin_AR()</code> is used with a main effect,
</p>
<p style="text-align: center;"><code class="reqn">\beta_1 = \alpha + \epsilon_1</code>
</p>

<p style="text-align: center;"><code class="reqn">\beta_j = \alpha + (j - 1) \eta + \epsilon_j, \quad j &gt; 1</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha \sim \text{N}(0, 1)</code>
</p>

<p style="text-align: center;"><code class="reqn">\epsilon_j = \phi_1 \epsilon_{j-1} + \cdots + \phi_{\mathtt{n\_coef}} \epsilon_{j-\mathtt{n\_coef}} + \varepsilon_j</code>
</p>

<p style="text-align: center;"><code class="reqn">\varepsilon_j \sim \text{N}(0, \omega^2),</code>
</p>

<p>and when it is used with an interaction,
</p>
<p style="text-align: center;"><code class="reqn">\beta_{u,1} = \alpha_u + \epsilon_{u,1}</code>
</p>

<p style="text-align: center;"><code class="reqn">\beta_{u,v} = \eta (v - 1) + \epsilon_{u,v}, \quad v = 2, \cdots, V</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha_u \sim \text{N}(0, 1)</code>
</p>

<p style="text-align: center;"><code class="reqn">\epsilon_{u,v} = \phi_1 \epsilon_{u,v-1} + \cdots + \phi_{\mathtt{n\_coef}} \epsilon_{u,v-\mathtt{n\_coef}} + \varepsilon_{u,v},</code>
</p>

<p style="text-align: center;"><code class="reqn">\varepsilon_{u,v} \sim \text{N}(0, \omega^2).</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\pmb{\beta}</code> is the main effect or interaction;
</p>
</li>
<li> <p><code class="reqn">j</code> denotes position within the main effect;
</p>
</li>
<li> <p><code class="reqn">u</code> denotes position within the 'along' variable of the interaction; and
</p>
</li>
<li> <p><code class="reqn">u</code> denotes position within the 'by' variable(s) of the interaction.
</p>
</li></ul>

<p>The slopes have priors
</p>
<p style="text-align: center;"><code class="reqn">\eta \sim \text{N}(\mathtt{mean\_slope}, \mathtt{sd\_slope}^2)</code>
</p>

<p>and
</p>
<p style="text-align: center;"><code class="reqn">\eta_u \sim \text{N}(\mathtt{mean\_slope}, \mathtt{sd\_slope}^2).</code>
</p>

<p>Internally, <code>Lin_AR()</code> derives a value for <code class="reqn">\omega</code> that
gives <code class="reqn">\epsilon_j</code> or <code class="reqn">\epsilon_{u,v}</code> a marginal
variance of <code class="reqn">\tau^2</code>. Parameter <code class="reqn">\tau</code>
has a half-normal prior
</p>
<p style="text-align: center;"><code class="reqn">\tau \sim \text{N}^+(0, \mathtt{s}^2).</code>
</p>

<p>The correlation coefficients <code class="reqn">\phi_1, \cdots, \phi_{\mathtt{n\_coef}}</code>
each have prior
</p>
<p style="text-align: center;"><code class="reqn">0.5 \phi_k - 0.5 \sim \text{Beta}(\mathtt{shape1}, \mathtt{shape2}).</code>
</p>



<h3>Constraints</h3>

<p>With some combinations of terms and priors, the values of
the intercept, main effects, and interactions are
are only weakly identified.
For instance, it may be possible to increase the value of the
intercept and reduce the value of the remaining terms in
the model with no effect on predicted rates and only a tiny
effect on prior probabilities. This weak identifiability is
typically harmless. However, in some applications, such as
forecasting, or when trying to obtain interpretable values
for main effects and interactions, it can be helpful to increase
identifiability through the use of constraints.
</p>
<p>Current options for constraints are:
</p>

<ul>
<li> <p><code>"none"</code> No constraints. The default.
</p>
</li>
<li> <p><code>"by"</code> Only used in interaction terms that include 'along' and
'by' dimensions. Within each value of the 'along'
dimension, terms across each 'by' dimension are constrained
to sum to 0.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+Lin_AR1">Lin_AR1()</a></code> Special case of <code>Lin_AR()</code>
</p>
</li>
<li> <p><code><a href="#topic+Lin">Lin()</a></code> Line with independent normal errors
</p>
</li>
<li> <p><code><a href="#topic+AR">AR()</a></code> AR process with no line
</p>
</li>
<li> <p><a href="#topic+priors">priors</a> Overview of priors implemented in <strong>bage</strong>
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for intercept,
main effect, or interaction
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>Lin_AR()
Lin_AR(n_coef = 3, s = 0.5, sd_slope = 2)
</code></pre>

<hr>
<h2 id='Lin_AR1'>Linear Prior with Autoregressive Errors of Order 1</h2><span id='topic+Lin_AR1'></span>

<h3>Description</h3>

<p>Use a line or lines with AR1
errors to model a main effect
or interaction. Typically used with time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Lin_AR1(
  s = 1,
  shape1 = 5,
  shape2 = 5,
  min = 0.8,
  max = 0.98,
  mean_slope = 0,
  sd_slope = 1,
  along = NULL,
  con = c("none", "by")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Lin_AR1_+3A_s">s</code></td>
<td>
<p>Scale for the innovations in the
AR process. Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="Lin_AR1_+3A_shape1">shape1</code>, <code id="Lin_AR1_+3A_shape2">shape2</code></td>
<td>
<p>Parameters for beta-distribution prior
for coefficients. Defaults are <code>5</code> and <code>5</code>.</p>
</td></tr>
<tr><td><code id="Lin_AR1_+3A_min">min</code>, <code id="Lin_AR1_+3A_max">max</code></td>
<td>
<p>Minimum and maximum values
for autocorrelation coefficient.
Defaults are <code>0.8</code> and <code>0.98</code>.</p>
</td></tr>
<tr><td><code id="Lin_AR1_+3A_mean_slope">mean_slope</code></td>
<td>
<p>Mean in prior for slope
of line. Default is 0.</p>
</td></tr>
<tr><td><code id="Lin_AR1_+3A_sd_slope">sd_slope</code></td>
<td>
<p>Standard deviation in the prior for
the slope of the line. Larger values imply
steeper slopes. Default is 1.</p>
</td></tr>
<tr><td><code id="Lin_AR1_+3A_along">along</code></td>
<td>
<p>Name of the variable to be used
as the 'along' variable. Only used with
interactions.</p>
</td></tr>
<tr><td><code id="Lin_AR1_+3A_con">con</code></td>
<td>
<p>Constraints on parameters.
Current choices are <code>"none"</code> and <code>"by"</code>.
Default is <code>"none"</code>. See below for details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>Lin_AR1()</code> is used with an interaction,
separate lines are constructed along
the 'along' variable, within each combination
of the 'by' variables.
</p>
<p>Arguments <code>min</code> and <code>max</code> can be used to specify
the permissible range for autocorrelation.
</p>
<p>Argument <code>s</code> controls the size of the innovations.
Smaller values tend to give smoother estimates.
</p>
<p>Argument <code>sd_slope</code> controls the slopes of
the lines. Larger values can give more steeply
sloped lines.
</p>


<h3>Value</h3>

<p>An object of class <code>"bage_prior_linar"</code>.
</p>


<h3>Mathematical details</h3>

<p>When <code>Lin_AR1()</code> is being used with a main effect,
</p>
<p style="text-align: center;"><code class="reqn">\beta_1 = \alpha + \epsilon_1</code>
</p>

<p style="text-align: center;"><code class="reqn">\beta_j = \alpha + (j - 1) \eta + \epsilon_j, \quad j &gt; 1</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha \sim \text{N}(0, 1)</code>
</p>

<p style="text-align: center;"><code class="reqn">\epsilon_j = \phi \epsilon_{j-1} + \varepsilon_j</code>
</p>

<p style="text-align: center;"><code class="reqn">\varepsilon \sim \text{N}(0, \omega^2),</code>
</p>

<p>and when it is used with an interaction,
</p>
<p style="text-align: center;"><code class="reqn">\beta_{u,1} = \alpha_u + \epsilon_{u,1}</code>
</p>

<p style="text-align: center;"><code class="reqn">\beta_{u,v} = \eta (v - 1) + \epsilon_{u,v}, \quad v = 2, \cdots, V</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha_u \sim \text{N}(0, 1)</code>
</p>

<p style="text-align: center;"><code class="reqn">\epsilon_{u,v} = \phi \epsilon_{u,v-1} + \varepsilon_{u,v},</code>
</p>

<p style="text-align: center;"><code class="reqn">\varepsilon_{u,v} \sim \text{N}(0, \omega^2).</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\pmb{\beta}</code> is the main effect or interaction;
</p>
</li>
<li> <p><code class="reqn">j</code> denotes position within the main effect;
</p>
</li>
<li> <p><code class="reqn">u</code> denotes position within the 'along' variable of the interaction; and
</p>
</li>
<li> <p><code class="reqn">u</code> denotes position within the 'by' variable(s) of the interaction.
</p>
</li></ul>

<p>The slopes have priors
</p>
<p style="text-align: center;"><code class="reqn">\eta \sim \text{N}(\mathtt{mean\_slope}, \mathtt{sd\_slope}^2)</code>
</p>

<p>and
</p>
<p style="text-align: center;"><code class="reqn">\eta_u \sim \text{N}(\mathtt{mean\_slope}, \mathtt{sd\_slope}^2).</code>
</p>

<p>Internally, <code>Lin_AR1()</code> derives a value for <code class="reqn">\omega</code> that
gives <code class="reqn">\epsilon_j</code> or <code class="reqn">\epsilon_{u,v}</code> a marginal
variance of <code class="reqn">\tau^2</code>. Parameter <code class="reqn">\tau</code>
has a half-normal prior
</p>
<p style="text-align: center;"><code class="reqn">\tau \sim \text{N}^+(0, \mathtt{s}^2),</code>
</p>

<p>where a value for <code>s</code> is provided by the user.
</p>
<p>Coefficient <code class="reqn">\phi</code> is constrained
to lie between <code>min</code> and <code>max</code>.
Its prior distribution is
</p>
<p style="text-align: center;"><code class="reqn">\phi = (\mathtt{max} - \mathtt{min}) \phi' - \mathtt{min}</code>
</p>

<p>where
</p>
<p style="text-align: center;"><code class="reqn">\phi' \sim \text{Beta}(\mathtt{shape1}, \mathtt{shape2}).</code>
</p>



<h3>Constraints</h3>

<p>With some combinations of terms and priors, the values of
the intercept, main effects, and interactions are
are only weakly identified.
For instance, it may be possible to increase the value of the
intercept and reduce the value of the remaining terms in
the model with no effect on predicted rates and only a tiny
effect on prior probabilities. This weak identifiability is
typically harmless. However, in some applications, such as
forecasting, or when trying to obtain interpretable values
for main effects and interactions, it can be helpful to increase
identifiability through the use of constraints.
</p>
<p>Current options for constraints are:
</p>

<ul>
<li> <p><code>"none"</code> No constraints. The default.
</p>
</li>
<li> <p><code>"by"</code> Only used in interaction terms that include 'along' and
'by' dimensions. Within each value of the 'along'
dimension, terms across each 'by' dimension are constrained
to sum to 0.
</p>
</li></ul>



<h3>References</h3>


<ul>
<li><p> The defaults for <code>min</code> and <code>max</code> are based on the
defaults for <code>forecast::ets()</code>.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+Lin_AR">Lin_AR()</a></code> Generalization of <code>Lin_AR1()</code>
</p>
</li>
<li> <p><code><a href="#topic+Lin">Lin()</a></code> Line with independent normal errors
</p>
</li>
<li> <p><code><a href="#topic+AR1">AR1()</a></code> AR1 process with no line
</p>
</li>
<li> <p><a href="#topic+priors">priors</a> Overview of priors implemented in <strong>bage</strong>
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for intercept,
main effect, or interaction
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>Lin_AR1()
Lin_AR1(min = 0, s = 0.5, sd_slope = 2)
</code></pre>

<hr>
<h2 id='mod_binom'>Specify a Binomial Model</h2><span id='topic+mod_binom'></span>

<h3>Description</h3>

<p>Specify a model where the outcome is drawn from
a binomial distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mod_binom(formula, data, size)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mod_binom_+3A_formula">formula</code></td>
<td>
<p>An R <a href="stats.html#topic+formula">formula</a>,
specifying the outcome and predictors.</p>
</td></tr>
<tr><td><code id="mod_binom_+3A_data">data</code></td>
<td>
<p>A data frame containing the outcome
and predictor variables, and the number of trials.</p>
</td></tr>
<tr><td><code id="mod_binom_+3A_size">size</code></td>
<td>
<p>Name of the variable giving
the number of trials, or a formula.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model is hierarchical. The probabilities in the binomial distribution
are described by a prior model formed from dimensions such
as age, sex, and time. The terms for these dimension themselves
have models, as described in <a href="#topic+priors">priors</a>. These priors all have defaults,
which depend on the type of term (eg an intercept, an age main effect,
or an age-time interaction.)
</p>


<h3>Value</h3>

<p>An object of class <code>bage_mod</code>.
</p>


<h3>Mathematical details</h3>

<p>The likelihood is
</p>
<p style="text-align: center;"><code class="reqn">y_i \sim \text{binomial}(\gamma_i; w_i)</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">y_i</code> is a count, such of number of births, for some
combination <code class="reqn">i</code> of classifying variables,
such as age, sex, and region;
</p>
</li>
<li> <p><code class="reqn">\gamma_i</code> is a probability of 'success'; and
</p>
</li>
<li> <p><code class="reqn">w_i</code> is the number of trials.
</p>
</li></ul>

<p>The probabilities <code class="reqn">\gamma_i</code> are assumed to be drawn
a beta distribution
</p>
<p style="text-align: center;"><code class="reqn">y_i \sim \text{Beta}(\xi^{-1} \mu_i, \xi^{-1} (1 - \mu_i))</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\mu_i</code> is the expected value for <code class="reqn">\gamma_i</code>; and
</p>
</li>
<li> <p><code class="reqn">\xi</code> governs dispersion (ie variance.)
</p>
</li></ul>

<p>Expected value <code class="reqn">\mu_i</code> equals, on a logit scale,
the sum of terms formed from classifying variables,
</p>
<p style="text-align: center;"><code class="reqn">\text{logit} \mu_i = \sum_{m=0}^{M} \beta_{j_i^m}^{(m)}</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\beta^{0}</code> is an intercept;
</p>
</li>
<li> <p><code class="reqn">\beta^{(m)}</code>, <code class="reqn">m = 1, \dots, M</code>, is a main effect
or interaction; and
</p>
</li>
<li> <p><code class="reqn">j_i^m</code> is the element of <code class="reqn">\beta^{(m)}</code> associated with
cell <code class="reqn">i</code>.
</p>
</li></ul>

<p>The <code class="reqn">\beta^{(m)}</code> are given priors, as described in <a href="#topic+priors">priors</a>.
</p>
<p>The prior for <code class="reqn">\xi</code> is described in <code><a href="#topic+set_disp">set_disp()</a></code>.
</p>


<h3>Specifying size</h3>

<p>The <code>size</code> argument can take two forms:
</p>

<ul>
<li><p> the name of a variable in <code>data</code>, with or without
quote marks, eg <code>"population"</code> or <code>population</code>; or
</p>
</li>
<li><p> a formula, which is evaluated with <code>data</code> as its
environment (see below for example).
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+mod_pois">mod_pois()</a></code> Specify Poisson model
</p>
</li>
<li> <p><code><a href="#topic+mod_norm">mod_norm()</a></code> Specify normal model
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify non-default prior for term
</p>
</li>
<li> <p><code><a href="#topic+set_disp">set_disp()</a></code> Specify non-default prior for dispersion
</p>
</li>
<li> <p><code><a href="#topic+fit">fit()</a></code> Fit a model
</p>
</li>
<li> <p><code><a href="#topic+forecast">forecast()</a></code> Forecast a model
</p>
</li>
<li> <p><code><a href="#topic+report_sim">report_sim()</a></code> Do a simulation study on a model
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>mod &lt;- mod_binom(oneperson ~ age:region + age:year,
                 data = nzl_households,
                 size = total)

## use formula to specify size
mod &lt;- mod_binom(ncases ~ agegp + tobgp + alcgp,
                 data = esoph,
                 size = ~ ncases + ncontrols)
</code></pre>

<hr>
<h2 id='mod_norm'>Specify a Normal Model</h2><span id='topic+mod_norm'></span>

<h3>Description</h3>

<p>Specify a model where the outcome is drawn from
a normal distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mod_norm(formula, data, weights)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mod_norm_+3A_formula">formula</code></td>
<td>
<p>An R <a href="stats.html#topic+formula">formula</a>,
specifying the outcome and predictors.</p>
</td></tr>
<tr><td><code id="mod_norm_+3A_data">data</code></td>
<td>
<p>A data frame containing outcome,
predictor, and, optionally, weights variables.</p>
</td></tr>
<tr><td><code id="mod_norm_+3A_weights">weights</code></td>
<td>
<p>Name of the weights variable,
a <code>1</code>, or a formula. See below for details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model is hierarchical. The means in the normal distribution
are described by a prior model formed from dimensions such
as age, sex, and time. The terms for these dimension themselves
have models, as described in <a href="#topic+priors">priors</a>. These priors all have defaults,
which depend on the type of term (eg an intercept, an age main effect,
or an age-time interaction.)
</p>
<p>Internally, the outcome
variable scaled to have mean 0 and sd 1.
</p>


<h3>Value</h3>

<p>An object of class <code>bage_mod_norm</code>.
</p>


<h3>Mathematical details</h3>

<p>The likelihood is
</p>
<p style="text-align: center;"><code class="reqn">y_i \sim \text{N}(\mu_i, \xi^2 / w_i)</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">y_i</code> is a scaled value for an, such of the log of income, for some
combination <code class="reqn">i</code> of classifying variables,
such as age, sex, and region;
</p>
</li>
<li> <p><code class="reqn">\mu_i</code> is a mean;
</p>
</li>
<li> <p><code class="reqn">\xi</code> is a standard deviation parameter; and
</p>
</li>
<li> <p><code class="reqn">w_i</code> is a weight.
</p>
</li></ul>

<p>The scaling of the outcome variable is done internally.
If <code class="reqn">y_i^*</code> is the original, then <code class="reqn">y_i = (y_i^* - m)/s</code>
where <code class="reqn">m</code> and <code class="reqn">s</code> are the sample mean and standard
deviation of <code class="reqn">y_i^*</code>.
</p>
<p>In some applications, <code class="reqn">w_i</code> is set to 1
for all <code class="reqn">i</code>.
</p>
<p>The means <code class="reqn">\mu_i</code> equal the sum of terms formed
from classifying variables,
</p>
<p style="text-align: center;"><code class="reqn">\mu_i = \sum_{m=0}^{M} \beta_{j_i^m}^{(m)}</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\beta^{0}</code> is an intercept;
</p>
</li>
<li> <p><code class="reqn">\beta^{(m)}</code>, <code class="reqn">m = 1, \dots, M</code>, is a main effect
or interaction; and
</p>
</li>
<li> <p><code class="reqn">j_i^m</code> is the element of <code class="reqn">\beta^{(m)}</code> associated with
cell <code class="reqn">i</code>.
</p>
</li></ul>

<p>The <code class="reqn">\beta^{(m)}</code> are given priors, as described in <a href="#topic+priors">priors</a>.
</p>
<p>The prior for <code class="reqn">\xi</code> is described in <code><a href="#topic+set_disp">set_disp()</a></code>.
</p>


<h3>Specifying weights</h3>

<p>The <code>weights</code> argument can take three forms:
</p>

<ul>
<li><p> the name of a variable in <code>data</code>, with or without
quote marks, eg <code>"wt"</code> or <code>wt</code>;
</p>
</li>
<li><p> the number <code>1</code>, in which no weights are used; or
</p>
</li>
<li><p> a formula, which is evaluated with <code>data</code> as its
environment (see below for example).
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+mod_pois">mod_pois()</a></code> Specify Poisson model
</p>
</li>
<li> <p><code><a href="#topic+mod_binom">mod_binom()</a></code> Specify binomial model
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify non-default prior for term
</p>
</li>
<li> <p><code><a href="#topic+set_disp">set_disp()</a></code> Specify non-default prior for standard deviation
</p>
</li>
<li> <p><code><a href="#topic+fit">fit()</a></code> Fit a model
</p>
</li>
<li> <p><code><a href="#topic+forecast">forecast()</a></code> Forecast a model
</p>
</li>
<li> <p><code><a href="#topic+report_sim">report_sim()</a></code> Do a simulation study on a model
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>mod &lt;- mod_norm(value ~ diag:age + year,
                data = nld_expenditure,
                weights = 1)

## use formula to specify weights
mod &lt;- mod_norm(value ~ diag:age + year,
                data = nld_expenditure,
                weights = ~sqrt(value))
</code></pre>

<hr>
<h2 id='mod_pois'>Specify a Poisson Model</h2><span id='topic+mod_pois'></span>

<h3>Description</h3>

<p>Specify a model where the outcome is drawn from a Poisson distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mod_pois(formula, data, exposure)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mod_pois_+3A_formula">formula</code></td>
<td>
<p>An R <a href="stats.html#topic+formula">formula</a>,
specifying the outcome and predictors.</p>
</td></tr>
<tr><td><code id="mod_pois_+3A_data">data</code></td>
<td>
<p>A data frame containing outcome,
predictor, and, optionally, exposure variables.</p>
</td></tr>
<tr><td><code id="mod_pois_+3A_exposure">exposure</code></td>
<td>
<p>Name of the exposure variable,
or a <code>1</code>, or a formula. See below for details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model is hierarchical. The rates in the Poisson distribution
are described by a prior model formed from dimensions such
as age, sex, and time. The terms for these dimension themselves
have models, as described in <a href="#topic+priors">priors</a>. These priors all have defaults,
which depend on the type of term (eg an intercept, an age main effect,
or an age-time interaction.)
</p>


<h3>Value</h3>

<p>An object of class <code>bage_mod_pois</code>.
</p>


<h3>Mathematical details</h3>

<p>The likelihood is
</p>
<p style="text-align: center;"><code class="reqn">y_i \sim \text{Poisson}(\gamma_i w_i)</code>
</p>

<p>where
</p>

<ul>
<li><p> subscript <code class="reqn">i</code> identifies some combination of
classifying variables, such as age, sex, and time;
</p>
</li>
<li> <p><code class="reqn">y_i</code> is an outcome, such as deaths;
</p>
</li>
<li> <p><code class="reqn">\gamma_i</code> is rates; and
</p>
</li>
<li> <p><code class="reqn">w_i</code> is exposure.
</p>
</li></ul>

<p>In some applications, there is no obvious population at risk.
In these cases, exposure <code class="reqn">w_i</code> can be set to 1
for all <code class="reqn">i</code>.
</p>
<p>The rates <code class="reqn">\gamma_i</code> are assumed to be drawn
a gamma distribution
</p>
<p style="text-align: center;"><code class="reqn">y_i \sim \text{Gamma}(\xi^{-1}, (\xi \mu_i)^{-1})</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\mu_i</code> is the expected value for <code class="reqn">\gamma_i</code>; and
</p>
</li>
<li> <p><code class="reqn">\xi</code> governs dispersion (ie variance.)
</p>
</li></ul>

<p>Expected value <code class="reqn">\mu_i</code> equals, on the log scale,
the sum of terms formed from classifying variables,
</p>
<p style="text-align: center;"><code class="reqn">\log \mu_i = \sum_{m=0}^{M} \beta_{j_i^m}^{(m)}</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\beta^{0}</code> is an intercept;
</p>
</li>
<li> <p><code class="reqn">\beta^{(m)}</code>, <code class="reqn">m = 1, \dots, M</code>, is a main effect
or interaction; and
</p>
</li>
<li> <p><code class="reqn">j_i^m</code> is the element of <code class="reqn">\beta^{(m)}</code> associated with
cell <code class="reqn">i</code>.
</p>
</li></ul>

<p>The <code class="reqn">\beta^{(m)}</code> are given priors, as described in <a href="#topic+priors">priors</a>.
</p>
<p>The prior for <code class="reqn">\xi</code> is described in <code><a href="#topic+set_disp">set_disp()</a></code>.
</p>


<h3>Specifying exposure</h3>

<p>The <code>exposure</code> argument can take three forms:
</p>

<ul>
<li><p> the name of a variable in <code>data</code>, with or without
quote marks, eg <code>"population"</code> or <code>population</code>;
</p>
</li>
<li><p> the number <code>1</code>, in which case a pure &quot;counts&quot; model
with no exposure, is produced; or
</p>
</li>
<li><p> a formula, which is evaluated with <code>data</code> as its
environment (see below for example).
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+mod_binom">mod_binom()</a></code> Specify binomial model
</p>
</li>
<li> <p><code><a href="#topic+mod_norm">mod_norm()</a></code> Specify normal model
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify non-default prior for term
</p>
</li>
<li> <p><code><a href="#topic+set_disp">set_disp()</a></code> Specify non-default prior for dispersion
</p>
</li>
<li> <p><code><a href="#topic+fit">fit()</a></code> Fit a model
</p>
</li>
<li> <p><code><a href="#topic+forecast">forecast()</a></code> Forecast a model
</p>
</li>
<li> <p><code><a href="#topic+report_sim">report_sim()</a></code> Do a simulation study on a model
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## specify a model with exposure
mod &lt;- mod_pois(injuries ~ age:sex + ethnicity + year,
                data = nzl_injuries,
                exposure = popn)

## specify a model without exposure
mod &lt;- mod_pois(injuries ~ age:sex + ethnicity + year,
                data = nzl_injuries,
                exposure = 1)

## use a formula to specify exposure
mod &lt;- mod_pois(injuries ~ age:sex + ethnicity + year,
                data = nzl_injuries,
                exposure = ~ pmax(popn, 1))
</code></pre>

<hr>
<h2 id='N'>Normal Prior</h2><span id='topic+N'></span>

<h3>Description</h3>

<p>Use independent draws from a normal
distribution to model a main effect or interaction.
Typically used with variables other than
age or time, such as region or ethnicity,
where there is no natural ordering.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>N(s = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="N_+3A_s">s</code></td>
<td>
<p>Scale for the standard deviation.
Default is <code>1</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Argument <code>s</code> controls the size of errors. Smaller values
for <code>s</code> tend to give more tightly clustered estimates.
</p>


<h3>Value</h3>

<p>An object of class <code>"bage_prior_norm"</code>.
</p>


<h3>Mathematical details</h3>

<p style="text-align: center;"><code class="reqn">\beta_j \sim \text{N}(0, \tau^2)</code>
</p>

<p>where <code class="reqn">\beta</code> is the main effect or interaction.
</p>
<p>Parameter <code class="reqn">\tau</code>
has a half-normal prior
</p>
<p style="text-align: center;"><code class="reqn">\tau \sim \text{N}^+(0, \mathtt{s}^2),</code>
</p>

<p>where <code>s</code> is provided by the user.
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+NFix">NFix()</a></code> Similar to <code>N()</code> but standard deviation
parameter is supplied rather than estimated from data
</p>
</li>
<li> <p><a href="#topic+priors">priors</a> Overview of priors implemented in <strong>bage</strong>
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for intercept,
main effect, or interaction
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>N()
N(s = 0.5)
</code></pre>

<hr>
<h2 id='NFix'>Normal Prior with Fixed Variance</h2><span id='topic+NFix'></span>

<h3>Description</h3>

<p>Normal prior where, in contrast to <code><a href="#topic+N">N()</a></code>, the
variance is treated as fixed and known. Typically
used for main effects or interactions where there
are too few elements to reliably estimate variance
from the available data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NFix(sd = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="NFix_+3A_sd">sd</code></td>
<td>
<p>Standard deviation. Default is <code>1</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>NFix()</code> is the default prior for the intercept.
</p>


<h3>Value</h3>

<p>An object of class <code>"bage_prior_normfixed"</code>.
</p>


<h3>Mathematical details</h3>

<p style="text-align: center;"><code class="reqn">\beta_j \sim \text{N}(0, \tau^2)</code>
</p>

<p>where <code class="reqn">\beta</code> is the main effect or interaction,
and a value for <code>sd</code> is supplied by the user.
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+N">N()</a></code> Similar to <code>NFix()</code>, but standard deviation
parameter is estimated from the data rather
than being fixed in advance
</p>
</li>
<li> <p><a href="#topic+priors">priors</a> Overview of priors implemented in <strong>bage</strong>
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for intercept,
main effect, or interaction
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>NFix()
NFix(sd = 10)
</code></pre>

<hr>
<h2 id='nld_expenditure'>Per Capita Health Expenditure in the Netherlands, 2003-2011</h2><span id='topic+nld_expenditure'></span>

<h3>Description</h3>

<p>Per capita health expenditure, in Euros,
by diagnostic group, age group, and year, in the Netherlands.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nld_expenditure
</code></pre>


<h3>Format</h3>

<p>A <a href="tibble.html#topic+tibble-package">tibble</a> with 1,296 rows and the
following columns:
</p>

<ul>
<li> <p><code>diag</code> Diagnostic group
</p>
</li>
<li> <p><code>age</code> 5-year age groups, with open age
group of 85+
</p>
</li>
<li> <p><code>year</code> 2003, 2005, 2007, and 2011
</p>
</li></ul>



<h3>Source</h3>

<p>Calculated from data in table
&quot;Expenditure by disease, age and gender under the System
of Health Accounts (SHA) Framework :
Current health spending by age&quot;
from OECD database 'OECD.Stat' (downloaded on 25 May 2016)
and in table &quot;Historical population data and projections
(1950-2050)&quot; from OECD database 'OECD.Stat' (downloaded
5 June 2016).
</p>

<hr>
<h2 id='nzl_divorces'>Divorces in New Zealand</h2><span id='topic+nzl_divorces'></span>

<h3>Description</h3>

<p>Counts of divorces and population, by age, sex,
and calendar year, in New Zealand, 2011-2021.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nzl_divorces
</code></pre>


<h3>Format</h3>

<p>A <a href="tibble.html#topic+tibble-package">tibble</a> with 242 rows
and the following columns:
</p>

<ul>
<li> <p><code>age</code>: 5-year age groups, <code>"15-19"</code> to <code>"65+"</code>
</p>
</li>
<li> <p><code>sex</code>: <code>"Female"</code> or <code>"Male"</code>
</p>
</li>
<li> <p><code>time</code>: Calendar year
</p>
</li>
<li> <p><code>divorces</code>: Numbers of divorces during year
</p>
</li>
<li> <p><code>population</code>: Person-years lived during year
</p>
</li></ul>



<h3>Source</h3>

<p>Divorce counts from data in table &quot;Age at divorces by
sex (marriages and civil unions) (Annual-Dec)&quot;
in the online database Infoshare
on the Statistics New Zealand website.
Data downloaded on 22 March 2023.
Population estimates derived from data in table
&quot;Estimated Resident Population by Age and Sex (1991+)
(Annual-Dec)&quot; in the online
database Infoshare
on the Statistics New Zealand website.
Data downloaded on 26 March 2023.
</p>

<hr>
<h2 id='nzl_households'>People in One-Person Households in New Zealand</h2><span id='topic+nzl_households'></span>

<h3>Description</h3>

<p>Counts of people in one-person households, and
counts of people living in any household, by
age, region, and year.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nzl_households
</code></pre>


<h3>Format</h3>

<p>A <a href="tibble.html#topic+tibble-package">tibble</a> with 528 rows and the
following columns:
</p>

<ul>
<li> <p><code>age</code>: 5-year age groups, with open age
group of 65+
</p>
</li>
<li> <p><code>region</code>: Region within New Zealand
</p>
</li>
<li> <p><code>year</code>: Calendar year
</p>
</li>
<li> <p><code>oneperson</code>: Count of people living in one-person
households
</p>
</li>
<li> <p><code>total</code>: Count of people living in all types of
household
</p>
</li></ul>



<h3>Source</h3>

<p>Derived from data in table
&quot;Household composition by age group, for people in
households in occupied private dwellings,
2006, 2013, and 2018 Censuses (RC, TA, DHB, SA2)&quot;
in the online database NZ.Stat,
on the Statistics New Zealand website.
Data downloaded on 3 January 2023.
</p>

<hr>
<h2 id='nzl_injuries'>Fatal Injuries in New Zealand</h2><span id='topic+nzl_injuries'></span>

<h3>Description</h3>

<p>Counts of fatal injuries in New Zealand, by age, sex,
ethnicity, and year, plus estimates of the population
at risk.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nzl_injuries
</code></pre>


<h3>Format</h3>

<p>A <a href="tibble.html#topic+tibble-package">tibble</a>
with 912 rows and the following columns:
</p>

<ul>
<li> <p><code>age</code>: 5-year age groups, up to age 55-59
</p>
</li>
<li> <p><code>sex</code>: <code>"Female"</code> or <code>"Male"</code>
</p>
</li>
<li> <p><code>ethnicity</code>: <code>"Maori"</code> or <code>"Non Maori"</code>
</p>
</li>
<li> <p><code>year</code>: Calendar year
</p>
</li>
<li> <p><code>injuries</code>: Count of injuries, randomly rounded to base 3
</p>
</li>
<li> <p><code>popn</code>: Population on 30 June
</p>
</li></ul>



<h3>Source</h3>

<p>Derived from data in tables &quot;Estimated Resident
Population by Age and Sex (1991+) (Annual-Jun)&quot; and
&quot;Maori Ethnic Group Estimated Resident Population
by Age and Sex (1991+) (Annual-Jun)&quot; in the online
database Infoshare, and table
&quot;Count of fatal and serious non-fatal
injuries by sex, age group, ethnicity, cause, and severity
of injury, 2000-2021&quot; in the online database NZ.Stat,
on the Statistics New Zealand website.
Data downloaded on 1 January 2023.
</p>

<hr>
<h2 id='print.bage_mod'>Printing a Model</h2><span id='topic+print.bage_mod'></span>

<h3>Description</h3>

<p>After calling a function such as <code><a href="#topic+mod_pois">mod_pois()</a></code> or
<code><a href="#topic+set_prior">set_prior()</a></code> it is good practice to print the
model object at the console, to check the model's
structure. The output from <code>print()</code> has
the following components:
</p>

<ul>
<li><p> A header giving the class of the model
and noting whether the model has been fitted.
</p>
</li>
<li><p> A <a href="stats.html#topic+formula">formula</a> giving the
outcome variable and terms for the model.
</p>
</li>
<li><p> A table giving the number of parameters, and
(fitted models only) the standard
deviation across those parameters,
a measure of the term's importance.
See <code><a href="#topic+priors">priors()</a></code> and <code><a href="#topic+tidy">tidy()</a></code>.
</p>
</li>
<li><p> Values for other model settings. See <code><a href="#topic+set_disp">set_disp()</a></code>,
<code><a href="#topic+set_var_age">set_var_age()</a></code>, <code><a href="#topic+set_var_sexgender">set_var_sexgender()</a></code>, <code><a href="#topic+set_var_time">set_var_time()</a></code>,
<code><a href="#topic+set_n_draw">set_n_draw()</a></code>
</p>
</li>
<li><p> Details on computations (fitted models only).
See <code><a href="#topic+computations">computations()</a></code>.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bage_mod'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.bage_mod_+3A_x">x</code></td>
<td>
<p>Object of class <code>"bage_mod"</code>, typically
created with <code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>,
or <code><a href="#topic+mod_norm">mod_norm()</a></code>.</p>
</td></tr>
<tr><td><code id="print.bage_mod_+3A_...">...</code></td>
<td>
<p>Unused. Included for generic consistency only.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>x</code>, invisibly.
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>, <code><a href="#topic+mod_norm">mod_norm()</a></code> Model specification and class
</p>
</li>
<li> <p><a href="#topic+fit">fit.bage_mod()</a> and <code><a href="#topic+is_fitted">is_fitted()</a></code> Model fitting
</p>
</li>
<li> <p><a href="#topic+priors">priors</a> Overview of priors for model terms
</p>
</li>
<li> <p><a href="#topic+tidy">tidy.bage_mod()</a> Number of parameters,
and standard deviations
</p>
</li>
<li> <p><code><a href="#topic+set_disp">set_disp()</a></code> Dispersion
</p>
</li>
<li> <p><code><a href="#topic+set_var_age">set_var_age()</a></code>, <code><a href="#topic+set_var_sexgender">set_var_sexgender()</a></code>, <code><a href="#topic+set_var_time">set_var_time()</a></code>
Age, sex/gender and time variables
</p>
</li>
<li> <p><code><a href="#topic+set_n_draw">set_n_draw()</a></code> Model draws
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>mod &lt;- mod_pois(injuries ~ age + sex + year,
                data = nzl_injuries,
                exposure = popn)

## print unfitted model
mod

mod &lt;- fit(mod)

## print fitted model
mod
</code></pre>

<hr>
<h2 id='priors'>Priors for Intercept, Main Effects, Interactions</h2><span id='topic+priors'></span>

<h3>Description</h3>

<p>The models created with functions <code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>,
and <code><a href="#topic+mod_norm">mod_norm()</a></code> always include an intercept,
and typically include main effects
and interactions formed from variables in input data.
Most models, for instance
include an age effect, and many include
an interaction between age and sex/gender,
or age and time.
</p>
<p>The intercept, main effects, and interactions
all have prior models that capture the expected
behavior of the term. Current choices for priors
summarised in the table below.
</p>
<p>Priors where 'forecast' is yes can be used
in forecasts for a time-varying
terms such as an age-time interactions.
</p>
<p>Priors where 'along' is yes distinguish
between 'along' and 'by' dimensions.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
   <strong>Prior</strong> </td><td style="text-align: left;"> <strong>Description</strong> </td><td style="text-align: left;"> <strong>Uses</strong> </td><td style="text-align: left;"> <strong>Forecast</strong> </td><td style="text-align: left;"> <strong>Along</strong> </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+N">N()</a></code> </td><td style="text-align: left;"> Elements drawn from normal distribution </td><td style="text-align: left;"> Term with no natural order </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> No </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+NFix">NFix()</a></code> </td><td style="text-align: left;"> As for <code>N()</code>, but standard deviation fixed </td><td style="text-align: left;"> Term with few elements </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> No </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+Known">Known()</a></code> </td><td style="text-align: left;"> Values  treated as known </td><td style="text-align: left;"> Simulations,  prior knowledge </td><td style="text-align: left;"> No </td><td style="text-align: left;"> No </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+RW">RW()</a></code> </td><td style="text-align: left;"> Random walk </td><td style="text-align: left;"> Smoothing </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Yes </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+RW2">RW2()</a></code> </td><td style="text-align: left;"> Second-order random walk </td><td style="text-align: left;"> Like <code>RW()</code>, but smoother </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Yes </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+RW_Seas">RW_Seas()</a></code> </td><td style="text-align: left;"> Random walk, with seasonal effect </td><td style="text-align: left;"> Terms involving time </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Yes </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+RW2_Seas">RW2_Seas()</a></code> </td><td style="text-align: left;"> Second-order random walk, with seasonal effect </td><td style="text-align: left;"> Term involving time </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Yes </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+AR">AR()</a></code> </td><td style="text-align: left;"> Auto-regressive prior of order <em>k</em> </td><td style="text-align: left;"> Mean reversion </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Yes </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+AR1">AR1()</a></code> </td><td style="text-align: left;"> Auto-regressive prior of order 1 Special case of <code>AR()</code> </td><td style="text-align: left;"> Mean reversion </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Yes </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+Lin">Lin()</a></code> </td><td style="text-align: left;"> Linear trend, with independent normal </td><td style="text-align: left;"> Parsimonious model for time </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Yes </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+Lin_AR">Lin_AR()</a></code> </td><td style="text-align: left;"> Linear trend, with autoregressive errors </td><td style="text-align: left;"> Term involving time </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Yes </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+Lin_AR1">Lin_AR1()</a></code> </td><td style="text-align: left;"> Linear trend, with AR1 errors </td><td style="text-align: left;"> Terms involving time </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Yes </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+Sp">Sp()</a></code> </td><td style="text-align: left;"> P-Spline (penalised spline) </td><td style="text-align: left;"> Smoothing, eg over age </td><td style="text-align: left;"> No </td><td style="text-align: left;"> Yes </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+SVD">SVD()</a></code> </td><td style="text-align: left;"> Age or age-sex profile based on SVD of database </td><td style="text-align: left;"> Age or age-sex </td><td style="text-align: left;"> No </td><td style="text-align: left;"> No </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+SVD_AR">SVD_AR()</a></code> </td><td style="text-align: left;"> <code>SVD()</code>, but coefficients follow <code>AR()</code> </td><td style="text-align: left;"> Age or age-sex and time </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Yes </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+SVD_AR1">SVD_AR1()</a></code> </td><td style="text-align: left;"> <code>SVD()</code>, but coefficients follow <code>AR1()</code> </td><td style="text-align: left;"> Age or age-sex and time </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Yes </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+SVD_RW">SVD_RW()</a></code> </td><td style="text-align: left;"> <code>SVD()</code>, but coefficients follow <code>RW()</code> </td><td style="text-align: left;"> Age or age-sex and time </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Yes </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+SVD_RW2">SVD_RW2()</a></code> </td><td style="text-align: left;"> <code>SVD()</code>, but coefficients follow <code>RW2()</code> </td><td style="text-align: left;"> Age or age-sex and time </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Yes </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Default prior</h3>

<p>The rule for selecting a default prior for a term is:
</p>

<ul>
<li><p> if term has less than 3 elements, use <code><a href="#topic+NFix">NFix()</a></code>;
</p>
</li>
<li><p> otherwise, if the term involves time, use <code><a href="#topic+RW">RW()</a></code>, with time as the &lsquo;along&rsquo; dimension;
</p>
</li>
<li><p> otherwise, if the term involves age, use <code><a href="#topic+RW">RW()</a></code>, with age as the &lsquo;along&rsquo; dimension;
</p>
</li>
<li><p> otherwise, use <code><a href="#topic+N">N()</a></code>.
</p>
</li></ul>


<hr>
<h2 id='reexports'>Objects exported from other packages</h2><span id='topic+reexports'></span><span id='topic+augment'></span><span id='topic+components'></span><span id='topic+equation'></span><span id='topic+fit'></span><span id='topic+forecast'></span><span id='topic+tidy'></span><span id='topic+generate'></span>

<h3>Description</h3>

<p>These objects are imported from other packages. Follow the links
below to see their documentation.
</p>

<dl>
<dt>generics</dt><dd><p><code><a href="generics.html#topic+augment">augment</a></code>, <code><a href="generics.html#topic+components">components</a></code>, <code><a href="generics.html#topic+equation">equation</a></code>, <code><a href="generics.html#topic+fit">fit</a></code>, <code><a href="generics.html#topic+forecast">forecast</a></code>, <code><a href="generics.html#topic+generate">generate</a></code>, <code><a href="generics.html#topic+tidy">tidy</a></code></p>
</dd>
</dl>

<hr>
<h2 id='replicate_data'>Create Replicate Data</h2><span id='topic+replicate_data'></span>

<h3>Description</h3>

<p>Use a fitted model to create replicate datasets,
typically as a way of checking a model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>replicate_data(x, condition_on = NULL, n = 19)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="replicate_data_+3A_x">x</code></td>
<td>
<p>A fitted model, typically created by
calling <code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>, or <code><a href="#topic+mod_norm">mod_norm()</a></code>,
and then <code><a href="#topic+fit">fit()</a></code>.</p>
</td></tr>
<tr><td><code id="replicate_data_+3A_condition_on">condition_on</code></td>
<td>
<p>Parameters to condition
on. Either <code>"expected"</code> or <code>"fitted"</code>. See
details.</p>
</td></tr>
<tr><td><code id="replicate_data_+3A_n">n</code></td>
<td>
<p>Number of replicate datasets to create.
Default is 19.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Use <code>n</code> draws from the posterior distribution
for model parameters to generate <code>n</code> simulated datasets.
If the model is working well, these simulated
datasets should look similar to the actual dataset.
</p>


<h3>Value</h3>

<p>A <a href="tibble.html#topic+tibble-package">tibble</a>
with the following structure:</p>

<table>
<tr>
 <td style="text-align: left;">
   <code>.replicate</code> </td><td style="text-align: left;"> data </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code>"Original"</code> </td><td style="text-align: left;"> Original data supplied to <code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>, <code><a href="#topic+mod_norm">mod_norm()</a></code> </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code>"Replicate 1"</code> </td><td style="text-align: left;"> Simulated data. </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code>"Replicate 2"</code> </td><td style="text-align: left;"> Simulated data. </td>
</tr>
<tr>
 <td style="text-align: left;">
   ... </td><td style="text-align: left;"> ... </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code>"Replicate &lt;n&gt;"</code> </td><td style="text-align: left;"> Simulated data. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>The <code>condition_on</code> argument</h3>

<p>With Poisson and binomial models that include
dispersion terms (which is the default), there are
two options for constructing replicate data.
</p>

<ul>
<li><p> When <code>condition_on</code> is <code>"fitted"</code>,
the replicate data is created by (i) drawing values
from the posterior distribution for rates or probabilities
(the <code class="reqn">\gamma_i</code> defined in <code><a href="#topic+mod_pois">mod_pois()</a></code>
and <code><a href="#topic+mod_binom">mod_binom()</a></code>), and (ii)  conditional on these
rates or probabilities, drawing values for the
outcome variable.
</p>
</li>
<li><p> When <code>condition_on</code> is <code>"expected"</code>,
the replicate data is created by (i) drawing
values from hyper-parameters governing
the rates or probabilities
(the <code class="reqn">\mu_i</code> and <code class="reqn">\xi</code> defined
in <code><a href="#topic+mod_pois">mod_pois()</a></code> and <code><a href="#topic+mod_binom">mod_binom()</a></code>),
then (ii) conditional on these hyper-parameters,
drawing values for the rates or probabilities,
and finally (iii) conditional on these
rates or probabilities, drawing values for the
outcome variable.
</p>
</li></ul>

<p>The default for <code>condition_on</code> is <code>"expected"</code>.
The <code>"expected"</code> option
provides a more severe test for
a model than the <code>"fitted"</code> option,
since &quot;fitted&quot; values are weighted averages
of the &quot;expected&quot; values and the original
data.
</p>
<p>As described in <code><a href="#topic+mod_norm">mod_norm()</a></code>, normal models
have a different structure from Poisson
and binomial models, and the distinction between
<code>"fitted"</code> and <code>"expected"</code> does not apply.
</p>


<h3>Data models for outcomes</h3>

<p>If a <a href="#topic+datamods">data model</a> has been provided for
the outcome variable, then creation of replicate
data will include a step where errors are added
to outcomes. For instance, the a <a href="#topic+set_datamod_outcome_rr3">rr3</a>
data model is used, then <code>replicate_data()</code> rounds
the outcomes to base 3.
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>, <code><a href="#topic+mod_norm">mod_norm()</a></code> Create model.
</p>
</li>
<li> <p><code><a href="#topic+fit">fit()</a></code> Fit model.
</p>
</li>
<li> <p><code><a href="#topic+report_sim">report_sim()</a></code> Simulation study of model.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>mod &lt;- mod_pois(injuries ~ age:sex + ethnicity + year,
                data = nzl_injuries,
                exposure = 1) |&gt;
  fit()

rep_data &lt;- mod |&gt;
  replicate_data()

library(dplyr)
rep_data |&gt;
  group_by(.replicate) |&gt;
  count(wt = injuries)

## when the overall model includes an rr3 data model,
## replicate data are rounded to base 3
mod_pois(injuries ~ age:sex + ethnicity + year,
         data = nzl_injuries,
         exposure = popn) |&gt;
  set_datamod_outcome_rr3() |&gt;
  fit() |&gt;
  replicate_data()
</code></pre>

<hr>
<h2 id='report_sim'>Simulation Study of a Model</h2><span id='topic+report_sim'></span>

<h3>Description</h3>

<p>Use simulated data to assess the performance of
an estimation model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>report_sim(
  mod_est,
  mod_sim = NULL,
  method = c("standard", "inner-outer"),
  vars_inner = NULL,
  n_sim = 100,
  point_est_fun = c("median", "mean"),
  widths = c(0.5, 0.95),
  report_type = c("short", "long", "full"),
  n_core = 1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="report_sim_+3A_mod_est">mod_est</code></td>
<td>
<p>The model whose performance is being
assessed. An object of class <code>bage_mod</code>.</p>
</td></tr>
<tr><td><code id="report_sim_+3A_mod_sim">mod_sim</code></td>
<td>
<p>The model used to generate the simulated
data. If no value is supplied, <code>mod_est</code> is used.</p>
</td></tr>
<tr><td><code id="report_sim_+3A_method">method</code></td>
<td>
<p>Estimation method used for <code>mod_est</code>.
See <code><a href="#topic+fit">fit()</a></code>.</p>
</td></tr>
<tr><td><code id="report_sim_+3A_vars_inner">vars_inner</code></td>
<td>
<p>Variables used in inner model
with <code>"inner-outer"</code>estimation method.
See <code><a href="#topic+fit">fit()</a></code>.</p>
</td></tr>
<tr><td><code id="report_sim_+3A_n_sim">n_sim</code></td>
<td>
<p>Number of sets of simulated data to use.
Default is 100.</p>
</td></tr>
<tr><td><code id="report_sim_+3A_point_est_fun">point_est_fun</code></td>
<td>
<p>Name of the function to use
to calculate point estimates. The options are <code>"mean"</code>
and <code>"median"</code>. The default is <code>"mean"</code>.</p>
</td></tr>
<tr><td><code id="report_sim_+3A_widths">widths</code></td>
<td>
<p>Widths of credible intervals.
A vector of values in the interval <code style="white-space: pre;">&#8288;(0, 1]&#8288;</code>.
Default is <code>c(0.5, 0.95)</code>.</p>
</td></tr>
<tr><td><code id="report_sim_+3A_report_type">report_type</code></td>
<td>
<p>Amount of detail in return value.
Options are <code>"short"</code> and <code>"long"</code>. Default is <code>"short"</code>.</p>
</td></tr>
<tr><td><code id="report_sim_+3A_n_core">n_core</code></td>
<td>
<p>Number of cores to use for parallel
processing. If <code>n_core</code> is <code>1</code> (the default),
no parallel processing is done.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A named list with a tibble called <code>"components"</code> and a
tibble called <code>"augment"</code>.
</p>


<h3>Warning</h3>

<p>The interface for <code>report_sim()</code> is still under development
and may change in future.
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>, <code><a href="#topic+mod_norm">mod_norm()</a></code> Specify a
model
</p>
</li>
<li> <p><code><a href="#topic+components">components()</a></code>, <code><a href="#topic+augment">augment()</a></code> Draw from joint prior
or posterior distribution of model
</p>
</li>
<li> <p><code><a href="#topic+replicate_data">replicate_data()</a></code> Generate replicate
data for a model
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## results random, so set seed
set.seed(0)

## make data - outcome variable (deaths here)
## needs to be present, but is not used
data &lt;- data.frame(region = c("A", "B", "C", "D", "E"),
                   population = c(100, 200, 300, 400, 500),
                   deaths = NA)

## simulation with estimation model same as
## data-generating model
mod_est &lt;- mod_pois(deaths ~ region,
                    data = data,
                    exposure = population) |&gt;
  set_prior(`(Intercept)` ~ Known(0))
report_sim(mod_est = mod_est,
           n_sim = 10) ## in practice should use larger value

## simulation with estimation model different
## from data-generating model
mod_sim &lt;- mod_est |&gt;
  set_prior(region ~ N(s = 2))
report_sim(mod_est = mod_est,
           mod_sim = mod_sim,
           n_sim = 10)
</code></pre>

<hr>
<h2 id='RW'>Random Walk Prior</h2><span id='topic+RW'></span>

<h3>Description</h3>

<p>Use a random walk as a model for
a main effect, or use multiple random walks
as a model for an interaction.
Typically used with terms that involve age or time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RW(s = 1, sd = 1, along = NULL, con = c("none", "by"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RW_+3A_s">s</code></td>
<td>
<p>Scale for the prior for the innovations.
Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="RW_+3A_sd">sd</code></td>
<td>
<p>Standard deviation
of initial value. Default is <code>1</code>.
Can be <code>0</code>.</p>
</td></tr>
<tr><td><code id="RW_+3A_along">along</code></td>
<td>
<p>Name of the variable to be used
as the 'along' variable. Only used with
interactions.</p>
</td></tr>
<tr><td><code id="RW_+3A_con">con</code></td>
<td>
<p>Constraints on parameters.
Current choices are <code>"none"</code> and <code>"by"</code>.
Default is <code>"none"</code>. See below for details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>RW2()</code> is used with an interaction,
a separate random walk is constructed
within each combination of the
'by' variables.
</p>
<p>Argument <code>s</code> controls the size of innovations.
Smaller values for <code>s</code> tend to produce smoother series.
</p>
<p>Argument <code>sd</code> controls variance in
initial values. Setting <code>sd</code> to <code>0</code> fixes initial
values at 0.
</p>


<h3>Value</h3>

<p>An object of class <code>"bage_prior_rwrandom"</code>
or <code>"bage_prior_rwzero"</code>.
</p>


<h3>Mathematical details</h3>

<p>When <code>RW()</code> is used with a main effect,
</p>
<p style="text-align: center;"><code class="reqn">\beta_1 \sim \text{N}(0, \mathtt{sd}^2)</code>
</p>

<p style="text-align: center;"><code class="reqn">\beta_j \sim \text{N}(\beta_{j-1}, \tau^2), \quad j &gt; 1</code>
</p>

<p>and when it is used with an interaction,
</p>
<p style="text-align: center;"><code class="reqn">\beta_{u,1} \sim \text{N}(0, \mathtt{sd}^2)</code>
</p>

<p style="text-align: center;"><code class="reqn">\beta_{u,v} \sim \text{N}(\beta_{u,v-1}, \tau^2), \quad v &gt; 1</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\pmb{\beta}</code> is the main effect or interaction;
</p>
</li>
<li> <p><code class="reqn">j</code> denotes position within the main effect;
</p>
</li>
<li> <p><code class="reqn">v</code> denotes position within the 'along' variable of the interaction; and
</p>
</li>
<li> <p><code class="reqn">u</code> denotes position within the 'by' variable(s) of the interaction.
</p>
</li></ul>

<p>Parameter <code class="reqn">\tau</code>
has a half-normal prior
</p>
<p style="text-align: center;"><code class="reqn">\tau \sim \text{N}^+(0, \mathtt{s}^2),</code>
</p>

<p>where <code>s</code> is provided by the user.
</p>


<h3>Constraints</h3>

<p>With some combinations of terms and priors, the values of
the intercept, main effects, and interactions are
are only weakly identified.
For instance, it may be possible to increase the value of the
intercept and reduce the value of the remaining terms in
the model with no effect on predicted rates and only a tiny
effect on prior probabilities. This weak identifiability is
typically harmless. However, in some applications, such as
forecasting, or when trying to obtain interpretable values
for main effects and interactions, it can be helpful to increase
identifiability through the use of constraints.
</p>
<p>Current options for constraints are:
</p>

<ul>
<li> <p><code>"none"</code> No constraints. The default.
</p>
</li>
<li> <p><code>"by"</code> Only used in interaction terms that include 'along' and
'by' dimensions. Within each value of the 'along'
dimension, terms across each 'by' dimension are constrained
to sum to 0.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+RW_Seas">RW_Seas()</a></code> Random walk with seasonal effect
</p>
</li>
<li> <p><code><a href="#topic+RW2">RW2()</a></code> Second-order random walk
</p>
</li>
<li> <p><code><a href="#topic+AR">AR()</a></code> Autoregressive with order k
</p>
</li>
<li> <p><code><a href="#topic+AR1">AR1()</a></code> Autoregressive with order 1
</p>
</li>
<li> <p><code><a href="#topic+Sp">Sp()</a></code> Smoothing via splines
</p>
</li>
<li> <p><code><a href="#topic+SVD">SVD()</a></code> Smoothing over age using singular value decomposition
</p>
</li>
<li> <p><a href="#topic+priors">priors</a> Overview of priors implemented in <strong>bage</strong>
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for intercept,
main effect, or interaction
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>RW()
RW(s = 0.5)
RW(sd = 0)
RW(along = "cohort")
</code></pre>

<hr>
<h2 id='RW_Seas'>Random Walk Prior with Seasonal Effect</h2><span id='topic+RW_Seas'></span>

<h3>Description</h3>

<p>Use a random walk with seasonal effects as a model for
a main effect, or use multiple random walks,
each with their own seasonal effects,
as a model for an interaction.
Typically used with terms that involve time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RW_Seas(
  n_seas,
  s = 1,
  sd = 1,
  s_seas = 0,
  sd_seas = 1,
  along = NULL,
  con = c("none", "by")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RW_Seas_+3A_n_seas">n_seas</code></td>
<td>
<p>Number of seasons</p>
</td></tr>
<tr><td><code id="RW_Seas_+3A_s">s</code></td>
<td>
<p>Scale for prior for innovations in
random walk. Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="RW_Seas_+3A_sd">sd</code></td>
<td>
<p>Standard deviation
of initial value. Default is <code>1</code>.
Can be <code>0</code>.</p>
</td></tr>
<tr><td><code id="RW_Seas_+3A_s_seas">s_seas</code></td>
<td>
<p>Scale for innovations
in seasonal effects. Default is <code>0</code>.</p>
</td></tr>
<tr><td><code id="RW_Seas_+3A_sd_seas">sd_seas</code></td>
<td>
<p>Standard deviation for
initial values of seasonal effects.
Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="RW_Seas_+3A_along">along</code></td>
<td>
<p>Name of the variable to be used
as the 'along' variable. Only used with
interactions.</p>
</td></tr>
<tr><td><code id="RW_Seas_+3A_con">con</code></td>
<td>
<p>Constraints on parameters.
Current choices are <code>"none"</code> and <code>"by"</code>.
Default is <code>"none"</code>. See below for details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>RW_Seas()</code> is used with an interaction,
a separate series is constructed
within each combination of the
'by' variables.
</p>
<p>Argument <code>s</code> controls the size of innovations in the random walk.
Smaller values for <code>s</code> tend to produce smoother series.
</p>
<p>Argument <code>sd</code> controls variance in
initial values of the random walk. <code>sd</code> can be <code>0</code>.
</p>
<p>Argument <code>n_seas</code> controls the number of seasons.
When using quarterly data, for instance,
<code>n_seas</code> should be <code>4</code>.
</p>
<p>By default, the magnitude of seasonal effects
is fixed. However, setting <code>s_seas</code> to a value
greater than zero produces seasonal effects
that evolve over time.
</p>


<h3>Value</h3>

<p>Object of class
<code>"bage_prior_rwrandomseasvary"</code>,
<code>"bage_prior_rwrandomseasfix"</code>,
<code>"bage_prior_rwzeroseasvary"</code>, or
<code>"bage_prior_rwzeroseasfix"</code>.
</p>


<h3>Mathematical details</h3>

<p>When <code>RW_Seas()</code> is used with a main effect,
</p>
<p style="text-align: center;"><code class="reqn">\beta_j = \alpha_j + \lambda_j, \quad j = 1, \cdots, J</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha_1 \sim \text{N}(0, \mathtt{sd}^2)</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha_j \sim \text{N}(\alpha_{j-1}, \tau^2), \quad j = 2, \cdots, J</code>
</p>

<p style="text-align: center;"><code class="reqn">\lambda_j \sim \text{N}(0, \mathtt{sd\_seas}^2), \quad j = 1, \cdots, \mathtt{n\_seas} - 1</code>
</p>

<p style="text-align: center;"><code class="reqn">\lambda_j = -\sum_{s=1}^{\mathtt{n\_seas} - 1} \lambda_{j - s}, \quad j = \mathtt{n\_seas}, 2 \mathtt{n\_seas}, \cdots</code>
</p>

<p style="text-align: center;"><code class="reqn">\lambda_j \sim \text{N}(\lambda_{j-\mathtt{n\_seas}}, \omega^2), \quad \text{otherwise},</code>
</p>

<p>and when it is used with an interaction,
</p>
<p style="text-align: center;"><code class="reqn">\beta_{u,v} = \alpha_{u,v} + \lambda_{u,v}, \quad v = 1, \cdots, V</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha_{u,1} \sim \text{N}(0, \mathtt{sd}^2)</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha_{u,v} \sim \text{N}(\alpha_{u,v-1}, \tau^2), \quad v = 2, \cdots, V</code>
</p>

<p style="text-align: center;"><code class="reqn">\lambda_{u,v} \sim \text{N}(0, \mathtt{sd\_seas}^2), \quad v = 1, \cdots, \mathtt{n\_seas} - 1</code>
</p>

<p style="text-align: center;"><code class="reqn">\lambda_{u,v} = -\sum_{s=1}^{\mathtt{n\_seas} - 1} \lambda_{u,v - s}, \quad v = \mathtt{n\_seas}, 2 \mathtt{n\_seas}, \cdots</code>
</p>

<p style="text-align: center;"><code class="reqn">\lambda_{u,v} \sim \text{N}(\lambda_{u,v-\mathtt{n\_seas}}, \omega^2), \quad \text{otherwise},</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\pmb{\beta}</code> is the main effect or interaction;
</p>
</li>
<li> <p><code class="reqn">\alpha_j</code> or <code class="reqn">\alpha_{u,v}</code> is an element of the random walk;
</p>
</li>
<li> <p><code class="reqn">\lambda_j</code> or <code class="reqn">\lambda_{u,v}</code> is an element of the seasonal effect;
</p>
</li>
<li> <p><code class="reqn">j</code> denotes position within the main effect;
</p>
</li>
<li> <p><code class="reqn">v</code> denotes position within the 'along' variable of the interaction; and
</p>
</li>
<li> <p><code class="reqn">u</code> denotes position within the 'by' variable(s) of the interaction.
</p>
</li></ul>

<p>Parameter <code class="reqn">\omega</code> has a half-normal prior
</p>
<p style="text-align: center;"><code class="reqn">\omega \sim \text{N}^+(0, \mathtt{s\_seas}^2).</code>
</p>

<p>If <code>s_seas</code> is set to 0, then <code class="reqn">\omega</code> is 0,
and seasonal effects are time-invariant.
</p>
<p>Parameter <code class="reqn">\tau</code> has a half-normal prior
</p>
<p style="text-align: center;"><code class="reqn">\tau \sim \text{N}^+(0, \mathtt{s}^2).</code>
</p>



<h3>Constraints</h3>

<p>With some combinations of terms and priors, the values of
the intercept, main effects, and interactions are
are only weakly identified.
For instance, it may be possible to increase the value of the
intercept and reduce the value of the remaining terms in
the model with no effect on predicted rates and only a tiny
effect on prior probabilities. This weak identifiability is
typically harmless. However, in some applications, such as
forecasting, or when trying to obtain interpretable values
for main effects and interactions, it can be helpful to increase
identifiability through the use of constraints.
</p>
<p>Current options for constraints are:
</p>

<ul>
<li> <p><code>"none"</code> No constraints. The default.
</p>
</li>
<li> <p><code>"by"</code> Only used in interaction terms that include 'along' and
'by' dimensions. Within each value of the 'along'
dimension, terms across each 'by' dimension are constrained
to sum to 0.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+RW">RW()</a></code> Random walk without seasonal effect
</p>
</li>
<li> <p><code><a href="#topic+RW2_Seas">RW2_Seas()</a></code> Second-order random walk with seasonal effect
</p>
</li>
<li> <p><a href="#topic+priors">priors</a> Overview of priors implemented in <strong>bage</strong>
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for intercept,
main effect, or interaction
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>RW_Seas(n_seas = 4)               ## seasonal effects fixed
RW_Seas(n_seas = 4, s_seas = 0.5) ## seasonal effects evolve
RW_Seas(n_seas = 4, sd = 0)       ## first term in random walk fixed at 0
</code></pre>

<hr>
<h2 id='RW2'>Second-Order Random Walk Prior</h2><span id='topic+RW2'></span>

<h3>Description</h3>

<p>Use a second-order random walk as a model for
a main effect, or use multiple second-order random walks
as a model for an interaction.
A second-order random walk is
a random walk with drift where the
drift term varies. It is typically
used with terms that involve age or time,
where there are sustained
trends upward or downward.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RW2(s = 1, sd = 1, sd_slope = 1, along = NULL, con = c("none", "by"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RW2_+3A_s">s</code></td>
<td>
<p>Scale for the prior for the innovations.
Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="RW2_+3A_sd">sd</code></td>
<td>
<p>Standard deviation
of initial value. Default is <code>1</code>. Can be <code>0</code>.</p>
</td></tr>
<tr><td><code id="RW2_+3A_sd_slope">sd_slope</code></td>
<td>
<p>Standard deviation
of initial slope. Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="RW2_+3A_along">along</code></td>
<td>
<p>Name of the variable to be used
as the 'along' variable. Only used with
interactions.</p>
</td></tr>
<tr><td><code id="RW2_+3A_con">con</code></td>
<td>
<p>Constraints on parameters.
Current choices are <code>"none"</code> and <code>"by"</code>.
Default is <code>"none"</code>. See below for details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>RW2()</code> is used with an interaction,
a separate random walk is constructed
within each combination of the
'by' variables.
</p>
<p>Argument <code>s</code> controls the size of innovations.
Smaller values for <code>s</code> tend to give smoother series.
</p>
<p>Argument <code>sd</code> controls variance in
initial values. Setting <code>sd</code> to <code>0</code> fixes
initial values at <code>0</code>.
</p>
<p>Argument <code>sd_slope</code> controls variance in the
initial slope.
</p>


<h3>Value</h3>

<p>An object of class <code>"bage_prior_rw2random"</code>
or <code>"bage_prior_rw2zero"</code>.
</p>


<h3>Mathematical details</h3>

<p>When <code>RW2()</code> is used with a main effect,
</p>
<p style="text-align: center;"><code class="reqn">\beta_1 \sim \text{N}(0, \mathtt{sd}^2)</code>
</p>

<p style="text-align: center;"><code class="reqn">\beta_2 \sim \text{N}(\beta_1, \mathtt{sd\_slope}^2)</code>
</p>

<p style="text-align: center;"><code class="reqn">\beta_j \sim \text{N}(2 \beta_{j-1} - \beta_{j-2}, \tau^2), \quad j = 2, \cdots, J</code>
</p>

<p>and when it is used with an interaction,
</p>
<p style="text-align: center;"><code class="reqn">\beta_{u,1} \sim \text{N}(0, \mathtt{sd}^2)</code>
</p>

<p style="text-align: center;"><code class="reqn">\beta_{u,2} \sim \text{N}(\beta_{u,1}, \mathtt{sd\_slope}^2)</code>
</p>

<p style="text-align: center;"><code class="reqn">\beta_{u,v} \sim \text{N}(2\beta_{u,v-1} - \beta_{u,v-2}, \tau^2), \quad v = 3, \cdots, V</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\pmb{\beta}</code> is the main effect or interaction;
</p>
</li>
<li> <p><code class="reqn">j</code> denotes position within the main effect;
</p>
</li>
<li> <p><code class="reqn">v</code> denotes position within the 'along' variable of the interaction; and
</p>
</li>
<li> <p><code class="reqn">u</code> denotes position within the 'by' variable(s) of the interaction.
</p>
</li></ul>

<p>Parameter <code class="reqn">\tau</code>
has a half-normal prior
</p>
<p style="text-align: center;"><code class="reqn">\tau \sim \text{N}^+(0, \mathtt{s}^2)</code>
</p>
<p>.
</p>


<h3>Constraints</h3>

<p>With some combinations of terms and priors, the values of
the intercept, main effects, and interactions are
are only weakly identified.
For instance, it may be possible to increase the value of the
intercept and reduce the value of the remaining terms in
the model with no effect on predicted rates and only a tiny
effect on prior probabilities. This weak identifiability is
typically harmless. However, in some applications, such as
forecasting, or when trying to obtain interpretable values
for main effects and interactions, it can be helpful to increase
identifiability through the use of constraints.
</p>
<p>Current options for constraints are:
</p>

<ul>
<li> <p><code>"none"</code> No constraints. The default.
</p>
</li>
<li> <p><code>"by"</code> Only used in interaction terms that include 'along' and
'by' dimensions. Within each value of the 'along'
dimension, terms across each 'by' dimension are constrained
to sum to 0.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+RW">RW()</a></code> Random walk
</p>
</li>
<li> <p><code><a href="#topic+RW2_Seas">RW2_Seas()</a></code> Second order random walk with seasonal effect
</p>
</li>
<li> <p><code><a href="#topic+AR">AR()</a></code> Autoregressive with order k
</p>
</li>
<li> <p><code><a href="#topic+AR1">AR1()</a></code> Autoregressive with order 1
</p>
</li>
<li> <p><code><a href="#topic+Sp">Sp()</a></code> Smoothing via splines
</p>
</li>
<li> <p><code><a href="#topic+SVD">SVD()</a></code> Smoothing over age via singular value decomposition
</p>
</li>
<li> <p><a href="#topic+priors">priors</a> Overview of priors implemented in <strong>bage</strong>
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for intercept,
main effect, or interaction
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>RW2()
RW2(s = 0.5)
</code></pre>

<hr>
<h2 id='RW2_Infant'>Second-Order Random Walk Prior with 'Infant' Indicator</h2><span id='topic+RW2_Infant'></span>

<h3>Description</h3>

<p>Use a second-order random walk to model variation
over age, with an indicator variable for the first age group.
Designed for use in models of mortality rates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RW2_Infant(s = 1, sd_slope = 1, con = c("none", "by"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RW2_Infant_+3A_s">s</code></td>
<td>
<p>Scale for the prior for the innovations.
Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="RW2_Infant_+3A_sd_slope">sd_slope</code></td>
<td>
<p>Standard deviation
for initial slope of random walk. Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="RW2_Infant_+3A_con">con</code></td>
<td>
<p>Constraints on parameters.
Current choices are <code>"none"</code> and <code>"by"</code>.
Default is <code>"none"</code>. See below for details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A second-order random walk prior <code><a href="#topic+RW2">RW2()</a></code>
works well for smoothing
mortality rates over age, except at age 0, where there
is a sudden jump in rates, reflecting the
special risks of infancy. The <code>RW2_Infant()</code>
extends the <code><a href="#topic+RW2">RW2()</a></code> prior by adding an indicator
variable for the first age group.
</p>
<p>If <code>RW2_Infant()</code> is used in an interaction,
the 'along' dimension is always age, implying that
there is a separate random walk along age within each
combination of the 'by' variables.
</p>
<p>Argument <code>s</code> controls the size of innovations in the random walk.
Smaller values for <code>s</code> tend to give smoother series.
</p>
<p>Argument <code>sd</code> controls the sl size of innovations in the random walk.
Smaller values for <code>s</code> tend to give smoother series.
</p>


<h3>Value</h3>

<p>Object of class <code>"bage_prior_rw2infant"</code>.
</p>


<h3>Mathematical details</h3>

<p>When <code>RW2_Infant()</code> is used with a main effect,
</p>
<p style="text-align: center;"><code class="reqn">\beta_1 \sim \text{N}(0, 1)</code>
</p>

<p style="text-align: center;"><code class="reqn">\beta_2 \sim \text{N}(0, \mathtt{sd\_slope}^2)</code>
</p>

<p style="text-align: center;"><code class="reqn">\beta_3 \sim \text{N}(2 \beta_2, \tau^2)</code>
</p>

<p style="text-align: center;"><code class="reqn">\beta_j \sim \text{N}(2 \beta_{j-1} - \beta_{j-2}, \tau^2), \quad j = 3, \cdots, J</code>
</p>

<p>and when it is used with an interaction,
</p>
<p style="text-align: center;"><code class="reqn">\beta_{u,1} \sim \text{N}(0, 1)</code>
</p>

<p style="text-align: center;"><code class="reqn">\beta_{u,2} \sim \text{N}(0, \mathtt{sd\_slope}^2)</code>
</p>

<p style="text-align: center;"><code class="reqn">\beta_{u,3} \sim \text{N}(2 \beta_{u,2}, \tau^2)</code>
</p>

<p style="text-align: center;"><code class="reqn">\beta_{u,v} \sim \text{N}(2 \beta_{u,v-1} - \beta_{u,v-2}, \tau^2), \quad v = 3, \cdots, V</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\pmb{\beta}</code> is a main effect or interaction;
</p>
</li>
<li> <p><code class="reqn">j</code> denotes position within the main effect;
</p>
</li>
<li> <p><code class="reqn">v</code> denotes position within the 'along' variable of the interaction; and
</p>
</li>
<li> <p><code class="reqn">u</code> denotes position within the 'by' variable(s) of the interaction.
</p>
</li></ul>

<p>Parameter <code class="reqn">\tau</code> has a half-normal prior
</p>
<p style="text-align: center;"><code class="reqn">\tau \sim \text{N}^+(0, \mathtt{s}^2)</code>
</p>
<p>.
</p>


<h3>Constraints</h3>

<p>With some combinations of terms and priors, the values of
the intercept, main effects, and interactions are
are only weakly identified.
For instance, it may be possible to increase the value of the
intercept and reduce the value of the remaining terms in
the model with no effect on predicted rates and only a tiny
effect on prior probabilities. This weak identifiability is
typically harmless. However, in some applications, such as
forecasting, or when trying to obtain interpretable values
for main effects and interactions, it can be helpful to increase
identifiability through the use of constraints.
</p>
<p>Current options for constraints are:
</p>

<ul>
<li> <p><code>"none"</code> No constraints. The default.
</p>
</li>
<li> <p><code>"by"</code> Only used in interaction terms that include 'along' and
'by' dimensions. Within each value of the 'along'
dimension, terms across each 'by' dimension are constrained
to sum to 0.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+RW2">RW2()</a></code> Second-order random walk, without infant indicator
</p>
</li>
<li> <p><code><a href="#topic+Sp">Sp()</a></code> Smoothing via splines
</p>
</li>
<li> <p><code><a href="#topic+SVD">SVD()</a></code> Smoothing over age via singular value decomposition
</p>
</li>
<li> <p><a href="#topic+priors">priors</a> Overview of priors implemented in <strong>bage</strong>
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for intercept,
main effect, or interaction
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>RW2_Infant()
RW2_Infant(s = 0.1)
</code></pre>

<hr>
<h2 id='RW2_Seas'>Second-Order Random Walk Prior with Seasonal Effect</h2><span id='topic+RW2_Seas'></span>

<h3>Description</h3>

<p>Use a second-oder random walk with
seasonal effects as a model for
a main effect, or use multiple second-order random walks,
each with their own seasonal effects,
as a model for an interaction.
Typically used with temrs that involve time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RW2_Seas(
  n_seas,
  s = 1,
  sd = 1,
  sd_slope = 1,
  s_seas = 0,
  sd_seas = 1,
  along = NULL,
  con = c("none", "by")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RW2_Seas_+3A_n_seas">n_seas</code></td>
<td>
<p>Number of seasons</p>
</td></tr>
<tr><td><code id="RW2_Seas_+3A_s">s</code></td>
<td>
<p>Scale for prior for innovations in
random walk. Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="RW2_Seas_+3A_sd">sd</code></td>
<td>
<p>Standard deviation
of initial value. Default is <code>1</code>.
Can be <code>0</code>.</p>
</td></tr>
<tr><td><code id="RW2_Seas_+3A_sd_slope">sd_slope</code></td>
<td>
<p>Standard deviation
for initial slope of random walk. Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="RW2_Seas_+3A_s_seas">s_seas</code></td>
<td>
<p>Scale for innovations
in seasonal effects. Default is <code>0</code>.</p>
</td></tr>
<tr><td><code id="RW2_Seas_+3A_sd_seas">sd_seas</code></td>
<td>
<p>Standard deviation for
initial values of seasonal effects.
Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="RW2_Seas_+3A_along">along</code></td>
<td>
<p>Name of the variable to be used
as the 'along' variable. Only used with
interactions.</p>
</td></tr>
<tr><td><code id="RW2_Seas_+3A_con">con</code></td>
<td>
<p>Constraints on parameters.
Current choices are <code>"none"</code> and <code>"by"</code>.
Default is <code>"none"</code>. See below for details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>RW2_Seas()</code> is used with an interaction,
a separate series is constructed within each
combination of the 'by' variables.
</p>
<p>Argument <code>s</code> controls the size of innovations in the random walk.
Smaller values for <code>s</code> tend to produce smoother series.
</p>
<p>Argument <code>n_seas</code> controls the number of seasons.
When using quarterly data, for instance,
<code>n_seas</code> should be <code>4</code>.
</p>
<p>By default, the magnitude of seasonal effects
is fixed. However, setting <code>s_seas</code> to a value
greater than zero produces seasonal effects
that evolve over time.
</p>


<h3>Value</h3>

<p>Object of class
<code>"bage_prior_rw2randomseasvary"</code>,
<code>"bage_prior_rw2randomseasfix"</code>,
<code>"bage_prior_rw2zeroseasvary"</code>, or
<code>"bage_prior_rw2zeroseasfix"</code>.
</p>


<h3>Mathematical details</h3>

<p>When <code>RW2_Seas()</code> is used with a main effect,
</p>
<p style="text-align: center;"><code class="reqn">\beta_j = \alpha_j + \lambda_j, \quad j = 1, \cdots, J</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha_1 \sim \text{N}(0, \mathtt{sd}^2)</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha_2 \sim \text{N}(0, \mathtt{sd\_slope}^2)</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha_j \sim \text{N}(2 \alpha_{j-1} - \alpha_{j-2}, \tau^2), \quad j = 3, \cdots, J</code>
</p>

<p style="text-align: center;"><code class="reqn">\lambda_j \sim \text{N}(0, \mathtt{sd\_seas}^2), \quad j = 1, \cdots, \mathtt{n\_seas} - 1</code>
</p>

<p style="text-align: center;"><code class="reqn">\lambda_j = -\sum_{s=1}^{\mathtt{n\_seas} - 1} \lambda_{j - s}, \quad j = \mathtt{n\_seas}, 2 \mathtt{n\_seas}, \cdots</code>
</p>

<p style="text-align: center;"><code class="reqn">\lambda_j \sim \text{N}(\lambda_{j-\mathtt{n\_seas}}, \omega^2), \quad \text{otherwise},</code>
</p>

<p>and when it is used with an interaction,
</p>
<p style="text-align: center;"><code class="reqn">\beta_{u,v} = \alpha_{u,v} + \lambda_{u,v}, \quad v = 1, \cdots, V</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha_{u,1} \sim \text{N}(0, \mathtt{sd}^2)</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha_{u,2} \sim \text{N}(0, \mathtt{sd\_slope}^2)</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha_{u,v} \sim \text{N}(2 \alpha_{u,v-1} - \alpha_{u,v-2}, \tau^2), \quad v = 3, \cdots, V</code>
</p>

<p style="text-align: center;"><code class="reqn">\lambda_{u,v} \sim \text{N}(0, \mathtt{sd\_seas}^2), \quad v = 1, \cdots, \mathtt{n\_seas} - 1</code>
</p>

<p style="text-align: center;"><code class="reqn">\lambda_{u,v} = -\sum_{s=1}^{\mathtt{n\_seas} - 1} \lambda_{u,v - s}, \quad v = \mathtt{n\_seas}, 2 \mathtt{n\_seas}, \cdots</code>
</p>

<p style="text-align: center;"><code class="reqn">\lambda_{u,v} \sim \text{N}(\lambda_{u,v-\mathtt{n\_seas}}, \omega^2), \quad \text{otherwise},</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\pmb{\beta}</code> is the main effect or interaction;
</p>
</li>
<li> <p><code class="reqn">\alpha_j</code> or <code class="reqn">\alpha_{u,v}</code> is an element of the random walk;
</p>
</li>
<li> <p><code class="reqn">\lambda_j</code> or <code class="reqn">\lambda_{u,v}</code> is an element of the seasonal effect;
</p>
</li>
<li> <p><code class="reqn">j</code> denotes position within the main effect;
</p>
</li>
<li> <p><code class="reqn">v</code> denotes position within the 'along' variable of the interaction; and
</p>
</li>
<li> <p><code class="reqn">u</code> denotes position within the 'by' variable(s) of the interaction.
</p>
</li></ul>

<p>Parameter <code class="reqn">\omega</code> has a half-normal prior
</p>
<p style="text-align: center;"><code class="reqn">\omega \sim \text{N}^+(0, \mathtt{s\_seas}^2)</code>
</p>
<p>.
If <code>s_seas</code> is set to 0, then <code class="reqn">\omega</code> is 0,
and the seasonal effects are fixed over time.
</p>
<p>Parameter <code class="reqn">\tau</code> has a half-normal prior
</p>
<p style="text-align: center;"><code class="reqn">\tau \sim \text{N}^+(0, \mathtt{s}^2)</code>
</p>
<p>.
</p>


<h3>Constraints</h3>

<p>With some combinations of terms and priors, the values of
the intercept, main effects, and interactions are
are only weakly identified.
For instance, it may be possible to increase the value of the
intercept and reduce the value of the remaining terms in
the model with no effect on predicted rates and only a tiny
effect on prior probabilities. This weak identifiability is
typically harmless. However, in some applications, such as
forecasting, or when trying to obtain interpretable values
for main effects and interactions, it can be helpful to increase
identifiability through the use of constraints.
</p>
<p>Current options for constraints are:
</p>

<ul>
<li> <p><code>"none"</code> No constraints. The default.
</p>
</li>
<li> <p><code>"by"</code> Only used in interaction terms that include 'along' and
'by' dimensions. Within each value of the 'along'
dimension, terms across each 'by' dimension are constrained
to sum to 0.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+RW2">RW2()</a></code> Second-order random walk without seasonal effect
</p>
</li>
<li> <p><code><a href="#topic+RW_Seas">RW_Seas()</a></code> Random walk with seasonal effect
</p>
</li>
<li> <p><a href="#topic+priors">priors</a> Overview of priors implemented in <strong>bage</strong>
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for intercept,
main effect, or interaction
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>RW2_Seas(n_seas = 4)               ## seasonal effects fixed
RW2_Seas(n_seas = 4, s_seas = 0.5) ## seasonal effects evolve
RW2_Seas(n_seas = 4, sd = 0)       ## first term in random walk fixed at 0
</code></pre>

<hr>
<h2 id='set_datamod_outcome_rr3'>Specify RR3 Data Model</h2><span id='topic+set_datamod_outcome_rr3'></span>

<h3>Description</h3>

<p>Specify a data model where the outcome variable
has been randomly rounded to base 3.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_datamod_outcome_rr3(mod)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_datamod_outcome_rr3_+3A_mod">mod</code></td>
<td>
<p>An object of class <code>"bage_mod"</code>,
created with <code><a href="#topic+mod_pois">mod_pois()</a></code>,
<code><a href="#topic+mod_binom">mod_binom()</a></code>, or <code><a href="#topic+mod_norm">mod_norm()</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>set_datamod_outcome_rr3()</code> can only be used with
Poisson and binomial models (created with
<code><a href="#topic+mod_pois">mod_pois()</a></code> and <code><a href="#topic+mod_binom">mod_binom()</a></code>.)
</p>
<p>Random rounding to base 3 (RR3) is a confidentialization
technique that is sometimes applied by statistical
agencies. RR3 is applied to integer data. The
procedure for rounding value <code class="reqn">n</code> is as follows:
</p>

<ul>
<li><p> If <code class="reqn">n</code> is divisible by 3, leave it unchanged
</p>
</li>
<li><p> If dividing <code class="reqn">n</code> by 3 leaves a remainder of 1, then
round down (subtract 1) with probability 2/3,
and round up (add 2) with probability 1/3.
</p>
</li>
<li><p> If dividing <code class="reqn">n</code> by 3 leaves a remainder of 1,
then round down (subtract 2)
with probability 1/3, and round up (add 1)
with probability 2/3.
</p>
</li></ul>

<p>If <code>set_datamod_outcome_rr3()</code> is applied to
a fitted model, it 'unfits'
the model, deleting existing estimates.
</p>


<h3>Value</h3>

<p>A modified version of <code>mod</code>.
</p>


<h3>See Also</h3>


<ul>
<li> <p><a href="#topic+datamods">datamods</a> Overview of data models implemented in <strong>bage</strong>
</p>
</li>
<li> <p><code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>, <code><a href="#topic+mod_norm">mod_norm()</a></code> Specify a
model for rates, probabilities, or means
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## 'injuries' variable in 'nzl_injuries' dataset
## has been randomly rounded to base 3
mod &lt;- mod_pois(injuries ~ age:sex + ethnicity + year,
                data = nzl_injuries,
                exposure = popn) |&gt;
  set_datamod_outcome_rr3() |&gt;
  fit()
</code></pre>

<hr>
<h2 id='set_disp'>Specify Prior for Dispersion or Standard Deviation</h2><span id='topic+set_disp'></span>

<h3>Description</h3>

<p>Specify the mean of prior for the dispersion
parameter (in Poisson and binomial models) or the
standard deviation parameter (in normal models.)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_disp(mod, mean)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_disp_+3A_mod">mod</code></td>
<td>
<p>An object of class <code>"bage_mod"</code>,
created with <code><a href="#topic+mod_pois">mod_pois()</a></code>,
<code><a href="#topic+mod_binom">mod_binom()</a></code>, or <code><a href="#topic+mod_norm">mod_norm()</a></code>.</p>
</td></tr>
<tr><td><code id="set_disp_+3A_mean">mean</code></td>
<td>
<p>Mean value for the exponential prior.
In Poisson and binomial models, can be set to 0.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The dispersion or mean parameter has an exponential
distribution with mean <code class="reqn">\mu</code>,
</p>
<p style="text-align: center;"><code class="reqn">p(\xi) = \frac{1}{\mu}\exp\left(\frac{-\xi}{\mu}\right).</code>
</p>

<p>In Poisson and binomial models,
<code>mean</code> can be set to <code>0</code>, implying
that the dispersion term is also <code>0</code>.
In normal models, <code>mean</code> must be non-negative.
</p>
<p>If <code>set_disp()</code> is applied to
a fitted model, it 'unfits'
the model, deleting existing estimates.
</p>


<h3>Value</h3>

<p>A <code>bage_mod</code> object
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>, <code><a href="#topic+mod_norm">mod_norm()</a></code> Specify a
model for rates, probabilities, or means
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for a term
</p>
</li>
<li> <p><code><a href="#topic+set_n_draw">set_n_draw()</a></code> Specify the number of draws
</p>
</li>
<li> <p><code><a href="#topic+is_fitted">is_fitted()</a></code> Test whether a model is fitted
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>mod &lt;- mod_pois(injuries ~ age:sex + ethnicity + year,
                data = nzl_injuries,
                exposure = popn)
mod
mod |&gt; set_disp(mean = 0.1)
mod |&gt; set_disp(mean = 0)
</code></pre>

<hr>
<h2 id='set_n_draw'>Specify Number of Draws from Prior or Posterior Distribution</h2><span id='topic+set_n_draw'></span>

<h3>Description</h3>

<p>Specify the number of draws from the posterior
distribution to be used in model output.
A newly-created <code>bage_mod</code> object has an
<code>n_draw</code> value of 1000. Higher values
may be appropriate for characterizing
the tails of distributions, or for
publication-quality graphics and summaries.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_n_draw(mod, n_draw = 1000L)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_n_draw_+3A_mod">mod</code></td>
<td>
<p>An object of class <code>"bage_mod"</code>,
created with <code><a href="#topic+mod_pois">mod_pois()</a></code>,
<code><a href="#topic+mod_binom">mod_binom()</a></code>, or <code><a href="#topic+mod_norm">mod_norm()</a></code>.</p>
</td></tr>
<tr><td><code id="set_n_draw_+3A_n_draw">n_draw</code></td>
<td>
<p>Number of draws.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the new value for <code>n_draw</code> is greater than
the old value, and the model has already been fitted,
then the model is <a href="#topic+unfit">unfitted</a>, and
function <code><a href="#topic+fit">fit()</a></code> may need to be called again.
</p>


<h3>Value</h3>

<p>A <code>bage_mod</code> object
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+augment">augment()</a></code>, <code><a href="#topic+components">components()</a></code> functions for
drawing from prior or posterior distribution - the output
of which is affected by the value of <code>n_draw</code>.
</p>
</li>
<li> <p><code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>, <code><a href="#topic+mod_norm">mod_norm()</a></code> Specify a
model
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for a term
</p>
</li>
<li> <p><code><a href="#topic+set_disp">set_disp()</a></code> Specify prior for dispersion
</p>
</li>
<li> <p><code><a href="#topic+fit">fit()</a></code> Fit a model
</p>
</li>
<li> <p><code><a href="#topic+unfit">unfit()</a></code> Reset a model
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>mod &lt;- mod_pois(injuries ~ age:sex + ethnicity + year,
                data = nzl_injuries,
                exposure = popn)
mod

mod |&gt;
  set_n_draw(n_draw = 5000)
</code></pre>

<hr>
<h2 id='set_prior'>Specify Prior for Model Term</h2><span id='topic+set_prior'></span>

<h3>Description</h3>

<p>Specify a prior distribution for an intercept,
a main effect, or an interaction.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_prior(mod, formula)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_prior_+3A_mod">mod</code></td>
<td>
<p>A <code>bage_mod</code> object, created with
<code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>, or <code><a href="#topic+mod_norm">mod_norm()</a></code>.</p>
</td></tr>
<tr><td><code id="set_prior_+3A_formula">formula</code></td>
<td>
<p>A formula giving the term
and a function for creating a prior.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>set_prior()</code> is applied to
a fitted model, it 'unfits'
the model, deleting existing estimates.
</p>


<h3>Value</h3>

<p>A modified <code>bage_mod</code> object.
</p>


<h3>See Also</h3>


<ul>
<li> <p><a href="#topic+priors">priors</a> Current choices for prior distributions
</p>
</li>
<li> <p><code><a href="#topic+is_fitted">is_fitted()</a></code> Test whether a model is fitted
</p>
</li>
<li> <p><code><a href="#topic+set_disp">set_disp()</a></code> Specify prior for dispersion
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>mod &lt;- mod_pois(injuries ~ age + year,
                data = nzl_injuries,
                exposure = popn)
mod
mod |&gt; set_prior(age ~ RW2())
</code></pre>

<hr>
<h2 id='set_var_age'>Specify Age Variable</h2><span id='topic+set_var_age'></span>

<h3>Description</h3>

<p>Specify which variable (if any) represents age.
Functions <code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>,
and <code><a href="#topic+mod_norm">mod_norm()</a></code> try to infer the age variable
from variable names, but do not always get it right.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_var_age(mod, name)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_var_age_+3A_mod">mod</code></td>
<td>
<p>An object of class <code>"bage_mod"</code>,
created with <code><a href="#topic+mod_pois">mod_pois()</a></code>,
<code><a href="#topic+mod_binom">mod_binom()</a></code>, or <code><a href="#topic+mod_norm">mod_norm()</a></code>.</p>
</td></tr>
<tr><td><code id="set_var_age_+3A_name">name</code></td>
<td>
<p>The name of the age variable.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In an R <code><a href="stats.html#topic+formula">formula</a></code>, a 'variable' is different
from a 'term'. For instance,
</p>
<p><code>~ age + region + age:region</code>
</p>
<p>contains variables <code>age</code> and <code>region</code>,
and terms <code>age</code>, <code>region</code>, and <code>age:region</code>.
</p>
<p>By default, <strong>bage</strong> gives a term involving age a
(<code><a href="#topic+RW">RW()</a></code>) prior. Changing the age variable
via <code>set_var_age()</code> can change priors:
see below for an example.
</p>
<p>If <code>set_var_age()</code> is applied to
a fitted model, it 'unfits'
the model, deleting existing estimates.
</p>


<h3>Value</h3>

<p>A <code>bage_mod</code> object
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+set_var_sexgender">set_var_sexgender()</a></code> Set sex or gender variable
</p>
</li>
<li> <p><code><a href="#topic+set_var_time">set_var_time()</a></code> Set time variable
</p>
</li>
<li> <p><code><a href="#topic+is_fitted">is_fitted()</a></code> Test whether a model is fitted
</p>
</li>
<li><p> internally, <strong>bage</strong> uses <code><a href="poputils.html#topic+find_var_age">poputils::find_var_age()</a></code>
to locate age variables
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## rename 'age' variable to something unusual
injuries2 &lt;- nzl_injuries
injuries2$age_last_birthday &lt;- injuries2$age

## mod_pois does not recognize age variable
mod &lt;- mod_pois(injuries ~ age_last_birthday * ethnicity + year,
                data = injuries2,
                exposure = popn)
mod

## so we set the age variable explicitly
## (which, as a side effect, changes the prior on
## the age main effect)
mod |&gt;
  set_var_age(name = "age_last_birthday")
</code></pre>

<hr>
<h2 id='set_var_sexgender'>Specify Sex or Gender Variable</h2><span id='topic+set_var_sexgender'></span>

<h3>Description</h3>

<p>Specify which variable (if any) represents sex or gender.
Functions <code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>,
and <code><a href="#topic+mod_norm">mod_norm()</a></code> try to infer the sex/gender variable
from variable names, but do not always get it right.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_var_sexgender(mod, name)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_var_sexgender_+3A_mod">mod</code></td>
<td>
<p>An object of class <code>"bage_mod"</code>,
created with <code><a href="#topic+mod_pois">mod_pois()</a></code>,
<code><a href="#topic+mod_binom">mod_binom()</a></code>, or <code><a href="#topic+mod_norm">mod_norm()</a></code>.</p>
</td></tr>
<tr><td><code id="set_var_sexgender_+3A_name">name</code></td>
<td>
<p>The name of the sex or gender variable.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In an R <code><a href="stats.html#topic+formula">formula</a></code>, a 'variable' is different
from a 'term'. For instance,
</p>
<p><code>~ gender + region + gender:region</code>
</p>
<p>contains variables <code>gender</code> and <code>region</code>,
and terms <code>gender</code>, <code>region</code>, and <code>gender:region</code>.
</p>
<p>If <code>set_var_sexgender()</code> is applied to
a fitted model, it 'unfits'
the model, deleting existing estimates.
</p>


<h3>Value</h3>

<p>A <code>"bage_mod"</code> object
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+set_var_age">set_var_age()</a></code> Set age variable
</p>
</li>
<li> <p><code><a href="#topic+set_var_time">set_var_time()</a></code> Set time variable
</p>
</li>
<li> <p><code><a href="#topic+is_fitted">is_fitted()</a></code> Test whether model is fitted
</p>
</li>
<li><p> internally, <strong>bage</strong> uses <code><a href="poputils.html#topic+find_var_sexgender">poputils::find_var_sexgender()</a></code>
to locate sex or gender variables
</p>
</li>
<li><p> internally, <strong>bage</strong> uses <code><a href="poputils.html#topic+find_label_female">poputils::find_label_female()</a></code>
to locate female categories within a sex or gender variable
</p>
</li>
<li><p> internally, <strong>bage</strong> uses <code><a href="poputils.html#topic+find_label_male">poputils::find_label_male()</a></code>
to locate male categories within a sex or gender variable
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## rename 'sex' variable to something unexpected
injuries2 &lt;- nzl_injuries
injuries2$biological_sex &lt;- injuries2$sex

## mod_pois does not recognize sex variable
mod &lt;- mod_pois(injuries ~ age * biological_sex + year,
                data = injuries2,
                exposure = popn)
mod

## so we set the sex variable explicitly
mod |&gt;
  set_var_sexgender(name = "biological_sex")
</code></pre>

<hr>
<h2 id='set_var_time'>Specify Time Variable</h2><span id='topic+set_var_time'></span>

<h3>Description</h3>

<p>Specify which variable (if any) represents time.
Functions <code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>,
and <code><a href="#topic+mod_norm">mod_norm()</a></code> try to infer the time variable
from variable names, but do not always get it right.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_var_time(mod, name)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_var_time_+3A_mod">mod</code></td>
<td>
<p>An object of class <code>"bage_mod"</code>,
created with <code><a href="#topic+mod_pois">mod_pois()</a></code>,
<code><a href="#topic+mod_binom">mod_binom()</a></code>, or <code><a href="#topic+mod_norm">mod_norm()</a></code>.</p>
</td></tr>
<tr><td><code id="set_var_time_+3A_name">name</code></td>
<td>
<p>The name of the time variable.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In an R <code><a href="stats.html#topic+formula">formula</a></code>, a 'variable' is different
from a 'term'. For instance,
</p>
<p><code>~ time + region + time:region</code>
</p>
<p>contains variables <code>time</code> and <code>region</code>,
and terms <code>time</code>, <code>region</code>, and <code>time:region</code>.
</p>
<p>By default, <strong>bage</strong> gives a term involving time a
(<code><a href="#topic+RW">RW()</a></code>) prior. Changing the time variable
via <code>set_var_time()</code> can change priors:
see below for an example.
</p>
<p>If <code>set_var_time()</code> is applied to
a fitted model, it 'unfits'
the model, deleting existing estimates.
</p>


<h3>Value</h3>

<p>A <code>bage_mod</code> object
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+set_var_age">set_var_age()</a></code> Set age variable
</p>
</li>
<li> <p><code><a href="#topic+set_var_sexgender">set_var_sexgender()</a></code> Sex sex or gender variable
</p>
</li>
<li> <p><code><a href="#topic+is_fitted">is_fitted()</a></code> Test if model has been fitted
</p>
</li>
<li><p> internally, <strong>bage</strong> uses <code><a href="poputils.html#topic+find_var_time">poputils::find_var_time()</a></code>
to locate time variables
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## rename time variable to something unusual
injuries2 &lt;- nzl_injuries
injuries2$calendar_year &lt;- injuries2$year

## mod_pois does not recognize time variable
mod &lt;- mod_pois(injuries ~ age * ethnicity + calendar_year,
                data = injuries2,
                exposure = popn)
mod

## so we set the time variable explicitly
## (which, as a side effect, changes the prior on
## the time main effect)
mod |&gt;
  set_var_time(name = "calendar_year")
</code></pre>

<hr>
<h2 id='Sp'>P-Spline Prior</h2><span id='topic+Sp'></span>

<h3>Description</h3>

<p>Use a p-spline (penalised spline) to model main
effects or interactions. Typically used with age,
but can be used with any variable where outcomes are
expected to vary smoothly from one element to the next.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Sp(
  n_comp = NULL,
  s = 1,
  sd = 1,
  sd_slope = 1,
  along = NULL,
  con = c("none", "by")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Sp_+3A_n_comp">n_comp</code></td>
<td>
<p>Number of spline basis functions (components)
to use.</p>
</td></tr>
<tr><td><code id="Sp_+3A_s">s</code></td>
<td>
<p>Scale for the prior for the innovations.
Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="Sp_+3A_sd">sd</code></td>
<td>
<p>Standard deviation in prior for first
element of random walk.</p>
</td></tr>
<tr><td><code id="Sp_+3A_sd_slope">sd_slope</code></td>
<td>
<p>Standard deviation in prior
for initial slope of random walk. Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="Sp_+3A_along">along</code></td>
<td>
<p>Name of the variable to be used
as the 'along' variable. Only used with
interactions.</p>
</td></tr>
<tr><td><code id="Sp_+3A_con">con</code></td>
<td>
<p>Constraints on parameters.
Current choices are <code>"none"</code> and <code>"by"</code>.
Default is <code>"none"</code>. See below for details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>Sp()</code> is used with an interaction,
separate splines are used for the 'along' variable within
each combination of the
'by' variables.
</p>


<h3>Value</h3>

<p>An object of class <code>"bage_prior_spline"</code>.
</p>


<h3>Mathematical details</h3>

<p>When <code>Sp()</code> is used with a main effect,
</p>
<p style="text-align: center;"><code class="reqn">\pmb{\beta} = \pmb{X} \pmb{\alpha}</code>
</p>

<p>and when it is used with an interaction,
</p>
<p style="text-align: center;"><code class="reqn">\pmb{\beta}_u = \pmb{X} \pmb{\alpha}_u</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\pmb{\beta}</code> is the main effect or interaction, with <code class="reqn">J</code> elements;
</p>
</li>
<li> <p><code class="reqn">\pmb{\beta}_u</code> is a subvector of <code class="reqn">\pmb{\beta}</code> holding
values for the  <code class="reqn">u</code>th combination of the 'by' variables;
</p>
</li>
<li> <p><code class="reqn">J</code> is the number of elements of <code class="reqn">\pmb{\beta}</code>;
</p>
</li>
<li> <p><code class="reqn">U</code> is the number of elements of <code class="reqn">\pmb{\beta}_u</code>;
</p>
</li>
<li> <p><code class="reqn">X</code> is a <code class="reqn">J \times n</code> or <code class="reqn">V \times n</code> matrix of
spline basis functions; and
</p>
</li>
<li> <p><code class="reqn">n</code> is <code>n_comp</code>.
</p>
</li></ul>

<p>The elements of <code class="reqn">\pmb{\alpha}</code> or <code class="reqn">\pmb{\alpha}_u</code> are assumed
to follow a <a href="#topic+RW2">second-order random walk</a>.
</p>


<h3>Constraints</h3>

<p>With some combinations of terms and priors, the values of
the intercept, main effects, and interactions are
are only weakly identified.
For instance, it may be possible to increase the value of the
intercept and reduce the value of the remaining terms in
the model with no effect on predicted rates and only a tiny
effect on prior probabilities. This weak identifiability is
typically harmless. However, in some applications, such as
forecasting, or when trying to obtain interpretable values
for main effects and interactions, it can be helpful to increase
identifiability through the use of constraints.
</p>
<p>Current options for constraints are:
</p>

<ul>
<li> <p><code>"none"</code> No constraints. The default.
</p>
</li>
<li> <p><code>"by"</code> Only used in interaction terms that include 'along' and
'by' dimensions. Within each value of the 'along'
dimension, terms across each 'by' dimension are constrained
to sum to 0.
</p>
</li></ul>



<h3>References</h3>


<ul>
<li><p> Eilers, P.H.C. and Marx B. (1996).
&quot;Flexible smoothing with B-splines and penalties&quot;.
Statistical Science. 11 (2): 89121.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+RW">RW()</a></code> Smoothing via random walk
</p>
</li>
<li> <p><code><a href="#topic+RW2">RW2()</a></code> Smoothing via second-order random walk
</p>
</li>
<li> <p><code><a href="#topic+SVD">SVD()</a></code> Smoothing of age via singular value decomposition
</p>
</li>
<li> <p><a href="#topic+priors">priors</a> Overview of priors implemented in <strong>bage</strong>
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for intercept,
main effect, or interaction
</p>
</li>
<li> <p><code><a href="splines.html#topic+bs">splines::bs()</a></code> Function used by <strong>bage</strong> to construct
spline basis functions
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>Sp()
Sp(n_comp = 10)
</code></pre>

<hr>
<h2 id='SVD'>SVD-Based Prior for Age or Age-Sex Profiles</h2><span id='topic+SVD'></span>

<h3>Description</h3>

<p>Use components from a Singular Value Decomposition (SVD)
to model a main effect or interaction involving age.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SVD(ssvd, n_comp = NULL, indep = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="SVD_+3A_ssvd">ssvd</code></td>
<td>
<p>Object of class <code>"bage_ssvd"</code>
holding a scaled SVD. See below for scaled SVDs
of databases currently available in <strong>bage</strong>.</p>
</td></tr>
<tr><td><code id="SVD_+3A_n_comp">n_comp</code></td>
<td>
<p>Number of components from scaled SVD
to use in modelling. The default is half
the number of components of <code>ssvd</code>.</p>
</td></tr>
<tr><td><code id="SVD_+3A_indep">indep</code></td>
<td>
<p>Whether to use separate or
combined SVDs in terms involving sex or gender.
Default is <code>TRUE</code>.
See below for details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A <code>SVD()</code> prior assumes that the age, age-sex, or age-gender
profiles for the quantity
being modelled looks like they were drawn at random
from an external demographic database. For instance,
the prior obtained via
</p>
<div class="sourceCode"><pre>SVD(HMD)
</pre></div>
<p>assumes that age or age-sex profiles look like
they were drawn from the
<a href="https://www.mortality.org">Human Mortality Database</a>.
</p>
<p>If <code>SVD()</code> is used with an interaction involving
variables other than age and sex/gender,
separate profiles are constructed
within each combination of other variables.
</p>
<p><strong>bage</strong> chooses the appropriate age-specific
or age-sex-specific SVD values internally.
The choice depends on the model term that the
<code>SVD()</code> prior is applied to, and on the
age labels used in <code>data</code> argument to
<code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code> or <code><a href="#topic+mod_norm">mod_norm()</a></code>.
<strong>bage</strong> makes its choice when <code><a href="#topic+set_prior">set_prior()</a></code>
is called.
</p>


<h3>Value</h3>

<p>An object of class <code>"bage_prior_svd"</code>.
</p>


<h3>Joint or independent SVDs</h3>

<p>Two possible ways of extracting patterns
from age-sex-specific data are
</p>

<ol>
<li><p> carry out separate SVDs on separate datasets for
each sex/gender; or
</p>
</li>
<li><p> carry out a single SVD on dataset that has separate
entries for each sex/gender.
</p>
</li></ol>

<p>Option 1 is more flexible. Option 2 is
more robust to sampling or measurement errors.
Option 1 is obtained by setting the <code>joint</code>
argument  to <code>FALSE</code>. Option 1
is obtained by setting the <code>indep</code> argument to <code>TRUE</code>.
The default is <code>TRUE</code>.
</p>


<h3>Mathematical details</h3>

<p><strong>Case 1: Term involving age and no other variables</strong>
</p>
<p>When <code>SVD()</code> is used with an age main effect,
</p>
<p style="text-align: center;"><code class="reqn">\pmb{\beta} = \pmb{F} \pmb{\alpha} + \pmb{g},</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\pmb{\beta}</code> is a main effect or interaction involving age;
</p>
</li>
<li> <p><code class="reqn">J</code> is the number of elements of <code class="reqn">\pmb{\beta}</code>;
</p>
</li>
<li> <p><code class="reqn">n</code> is the number of components from the SVD;
</p>
</li>
<li> <p><code class="reqn">\pmb{F}</code> is a known matrix with dimension <code class="reqn">J \times n</code>; and
</p>
</li>
<li> <p><code class="reqn">\pmb{g}</code> is a known vector with <code class="reqn">J</code> elements.
</p>
</li></ul>

<p><code class="reqn">\pmb{F}</code> and <code class="reqn">\pmb{g}</code> are constructed from
a large database of age-specific demographic estimates
by performing an SVD and standardizing.
</p>
<p>The elements of <code class="reqn">\pmb{\alpha}</code> have prior
</p>
<p style="text-align: center;"><code class="reqn">\alpha_k \sim \text{N}(0, 1), \quad k = 1, \cdots, K.</code>
</p>

<p><strong>Case 2: Term involving age and non-sex, non-gender variable(s)</strong>
</p>
<p>When <code>SVD()</code> is used with an interaction that involves age but that
does not involve sex or gender,
</p>
<p style="text-align: center;"><code class="reqn">\pmb{\beta}_u = \pmb{F} \pmb{\alpha}_u + \pmb{g},</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\pmb{\beta}_u</code> is a subvector of <code class="reqn">\pmb{\beta}</code> holding
values for the  <code class="reqn">u</code>th combination of the non-age variables;
</p>
</li>
<li> <p><code class="reqn">V</code> is the number of elements of <code class="reqn">\pmb{\beta}_u</code>;
</p>
</li>
<li> <p><code class="reqn">n</code> is the number of components from the SVD;
</p>
</li>
<li> <p><code class="reqn">\pmb{F}</code> is a known matrix with dimension <code class="reqn">V \times n</code>; and
</p>
</li>
<li> <p><code class="reqn">\pmb{g}</code> is a known vector with <code class="reqn">V</code> elements.
</p>
</li></ul>

<p><strong>Case 3: Term involving age, sex/gender, and no other variables</strong>
</p>
<p>When <code>SVD()</code> is used with an interaction that involves
age and sex or gender, there are two sub-cases, depending on
the value of <code>indep</code>.
</p>
<p>When <code>indep</code> is <code>TRUE</code>,
</p>
<p style="text-align: center;"><code class="reqn">\pmb{\beta}_{s} = \pmb{F}_s \pmb{\alpha}_{s} + \pmb{g}_s,</code>
</p>

<p>and when <code>indep</code> is <code>FALSE</code>,
</p>
<p style="text-align: center;"><code class="reqn">\pmb{\beta} = \pmb{F} \pmb{\alpha} + \pmb{g},</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\pmb{\beta}</code> is an interaction involving age and sex/gender;
</p>
</li>
<li> <p><code class="reqn">\pmb{\beta}_{s}</code> is a subvector of <code class="reqn">\pmb{\beta}</code>,
holding values for sex/gender <code class="reqn">s</code>;
</p>
</li>
<li> <p><code class="reqn">J</code> is the number of elements in <code class="reqn">\pmb{\beta}</code>;
</p>
</li>
<li> <p><code class="reqn">S</code> is the number of sexes/genders;
</p>
</li>
<li> <p><code class="reqn">n</code> is the number of components from the SVD;
</p>
</li>
<li> <p><code class="reqn">\pmb{F}_s</code> is a known <code class="reqn">(J/S) \times n</code> matrix, specific
to sex/gender <code class="reqn">s</code>;
</p>
</li>
<li> <p><code class="reqn">\pmb{g}_s</code> is a known vector with <code class="reqn">J/S</code> elements,
specific to sex/gender <code class="reqn">s</code>;
</p>
</li>
<li> <p><code class="reqn">\pmb{F}</code> is a known <code class="reqn">J \times n</code> matrix, with values
for all sexes/genders; and
</p>
</li>
<li> <p><code class="reqn">\pmb{g}</code> is a known vector with <code class="reqn">J</code> elements, with values
for all sexes/genders.
</p>
</li></ul>

<p>The elements of <code class="reqn">\pmb{\alpha}_s</code> and <code class="reqn">\pmb{\alpha}</code> have prior
</p>
<p style="text-align: center;"><code class="reqn">\alpha_k \sim \text{N}(0, 1).</code>
</p>

<p><strong>Case 4: Term involving age, sex/gender, and other variable(s)</strong>
</p>
<p>When <code>SVD()</code> is used with an interaction that involves
age, sex or gender, and other variables, there are two sub-cases,
depending on the value of <code>indep</code>.
</p>
<p>When <code>indep</code> is <code>TRUE</code>,
</p>
<p style="text-align: center;"><code class="reqn">\pmb{\beta}_{u,s} = \pmb{F}_s \pmb{\alpha}_{u,s} + \pmb{g}_s,</code>
</p>

<p>and when <code>indep</code> is <code>FALSE</code>,
</p>
<p style="text-align: center;"><code class="reqn">\pmb{\beta}_u = \pmb{F} \pmb{\alpha}_u + \pmb{g},</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\pmb{\beta}</code> is an interaction involving sex/gender;
</p>
</li>
<li> <p><code class="reqn">\pmb{\beta}_{u,s}</code> is a subvector of <code class="reqn">\pmb{\beta}</code>,
holding values for sex/gender <code class="reqn">s</code> for the <code class="reqn">u</code>th
combination of the other variables;
</p>
</li>
<li> <p><code class="reqn">V</code> is the number of elements in <code class="reqn">\pmb{\beta}_u</code>;
</p>
</li>
<li> <p><code class="reqn">S</code> is the number of sexes/genders;
</p>
</li>
<li> <p><code class="reqn">n</code> is the number of components from the SVD;
</p>
</li>
<li> <p><code class="reqn">\pmb{F}_s</code> is a known <code class="reqn">(V/S) \times n</code> matrix, specific
to sex/gender <code class="reqn">s</code>;
</p>
</li>
<li> <p><code class="reqn">\pmb{g}_s</code> is a known vector with <code class="reqn">V/S</code> elements,
specific to sex/gender <code class="reqn">s</code>;
</p>
</li>
<li> <p><code class="reqn">\pmb{F}</code> is a known <code class="reqn">V \times n</code> matrix, with values
for all sexes/genders; and
</p>
</li>
<li> <p><code class="reqn">\pmb{g}</code> is a known vector with <code class="reqn">V</code> elements, with values
for all sexes/genders.
</p>
</li></ul>



<h3>Scaled SVDs of demographic databases in bage</h3>


<ul>
<li> <p><code><a href="#topic+HMD">HMD</a></code> Mortality rates from the
<a href="https://www.mortality.org">Human Mortality Database</a>.
</p>
</li>
<li> <p><code><a href="#topic+HFD">HFD</a></code> Fertility rates from the
<a href="https://www.humanfertility.org">Human Fertility Database</a>.
</p>
</li>
<li> <p><code><a href="#topic+LFP">LFP</a></code> Labor forcce participation
rates from the <a href="https://data-explorer.oecd.org">OECD</a>.
</p>
</li></ul>



<h3>References</h3>


<ul>
<li><p> For details of the construction of
scaled SVDS see the vignette
<a href="https://bayesiandemography.github.io/bage/articles/vig2_math.html">here</a>.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+SVD_AR">SVD_AR()</a></code>, <code><a href="#topic+SVD_AR1">SVD_AR1()</a></code>, <code><a href="#topic+SVD_RW">SVD_RW()</a></code>, <code><a href="#topic+SVD_RW2">SVD_RW2()</a></code> SVD priors for
for time-varying age profiles;
</p>
</li>
<li> <p><code><a href="#topic+RW">RW()</a></code> Smoothing via random walk
</p>
</li>
<li> <p><code><a href="#topic+RW2">RW2()</a></code> Smoothing via second-order random walk
</p>
</li>
<li> <p><code><a href="#topic+Sp">Sp()</a></code> Smoothing via splines
</p>
</li>
<li> <p><a href="#topic+priors">priors</a> Overview of priors implemented in <strong>bage</strong>
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for intercept,
main effect, or interaction
</p>
</li>
<li> <p><code><a href="#topic+set_var_sexgender">set_var_sexgender()</a></code> Identify sex or gender variable in data
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>SVD(HMD) 
SVD(HMD, n_comp = 3)
</code></pre>

<hr>
<h2 id='SVD_AR'>Dynamic SVD-Based Priors for Age Profiles or Age-Sex Profiles</h2><span id='topic+SVD_AR'></span><span id='topic+SVD_AR1'></span><span id='topic+SVD_RW'></span><span id='topic+SVD_RW2'></span>

<h3>Description</h3>

<p>Use components from a Singular Value Decomposition (SVD)
to model an interaction involving age and time, or age,
sex/gender and time, where the coefficients evolve over time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SVD_AR(
  ssvd,
  n_comp = NULL,
  indep = TRUE,
  n_coef = 2,
  s = 1,
  shape1 = 5,
  shape2 = 5,
  con = c("none", "by")
)

SVD_AR1(
  ssvd,
  n_comp = NULL,
  indep = TRUE,
  min = 0.8,
  max = 0.98,
  s = 1,
  shape1 = 5,
  shape2 = 5,
  con = c("none", "by")
)

SVD_RW(ssvd, n_comp = NULL, indep = TRUE, s = 1, sd = 1, con = c("none", "by"))

SVD_RW2(
  ssvd,
  n_comp = NULL,
  indep = TRUE,
  s = 1,
  sd = 1,
  sd_slope = 1,
  con = c("none", "by")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="SVD_AR_+3A_ssvd">ssvd</code></td>
<td>
<p>Object of class <code>"bage_ssvd"</code>
holding a scaled SVD. See below for scaled SVDs
of databases currently available in <strong>bage</strong>.</p>
</td></tr>
<tr><td><code id="SVD_AR_+3A_n_comp">n_comp</code></td>
<td>
<p>Number of components from scaled SVD
to use in modelling. The default is half
the number of components of <code>ssvd</code>.</p>
</td></tr>
<tr><td><code id="SVD_AR_+3A_indep">indep</code></td>
<td>
<p>Whether to use separate or
combined SVDs in terms involving sex or gender.
Default is <code>TRUE</code>.
See below for details.</p>
</td></tr>
<tr><td><code id="SVD_AR_+3A_n_coef">n_coef</code></td>
<td>
<p>Number of AR coefficients in <code>SVD_RW()</code>.</p>
</td></tr>
<tr><td><code id="SVD_AR_+3A_s">s</code></td>
<td>
<p>Scale for standard deviations terms.</p>
</td></tr>
<tr><td><code id="SVD_AR_+3A_shape1">shape1</code>, <code id="SVD_AR_+3A_shape2">shape2</code></td>
<td>
<p>Parameters for prior
for coefficients in <code>SVD_AR()</code>.
Defaults are <code>5</code> and <code>5</code>.</p>
</td></tr>
<tr><td><code id="SVD_AR_+3A_con">con</code></td>
<td>
<p>Constraints on parameters.
Current choices are <code>"none"</code> and <code>"by"</code>.
Default is <code>"none"</code>. See below for details.</p>
</td></tr>
<tr><td><code id="SVD_AR_+3A_min">min</code>, <code id="SVD_AR_+3A_max">max</code></td>
<td>
<p>Minimum and maximum values
for autocorrelation coefficient in <code>SVD_AR1()</code>.
Defaults are <code>0.8</code> and <code>0.98</code>.</p>
</td></tr>
<tr><td><code id="SVD_AR_+3A_sd">sd</code></td>
<td>
<p>Standard deviation
of initial value for random walks. Default is <code>1</code>.
Can be <code>0</code>.</p>
</td></tr>
<tr><td><code id="SVD_AR_+3A_sd_slope">sd_slope</code></td>
<td>
<p>Standard deviation in prior
for initial slope. Default is <code>1</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>SVD_AR()</code>, <code>SVD_AR1()</code>, <code>SVD_RW()</code>, and <code>SVD_RW2()</code>
priors assume that, in any given period,
the age profiles or age-sex profiles for the quantity
being modelled looks like they were drawn at random
from an external demographic database. For instance,
the <code>SVD_AR()</code> prior obtained via
</p>
<div class="sourceCode"><pre>SVD_AR(HMD)
</pre></div>
<p>assumes that profiles look like
they were obtained from the
<a href="https://www.mortality.org">Human Mortality Database</a>.
</p>


<h3>Value</h3>

<p>An object of class <code>"bage_prior_svd_ar"</code>,
<code>"bage_prior_svd_rw"</code>, or <code>"bage_prior_svd_rw2"</code>.
</p>


<h3>Mathematical details</h3>

<p>When the interaction being modelled only involves
age and time, or age, sex/gender, and time
</p>
<p style="text-align: center;"><code class="reqn">\pmb{\beta}_t = \pmb{F} \pmb{\alpha}_t + \pmb{g},</code>
</p>

<p>and when it involves other variables besides age, sex/gender, and time,
</p>
<p style="text-align: center;"><code class="reqn">\pmb{\beta}_{u,t} = \pmb{F} \pmb{\alpha}_{u,t} + \pmb{g},</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\pmb{\beta}</code> is an interaction involving age, time, possibly sex/gender,
and possibly other variables;
</p>
</li>
<li> <p><code class="reqn">\pmb{\beta}_t</code> is a subvector of <code class="reqn">\pmb{\beta}</code> holding
values for period <code class="reqn">t</code>;
</p>
</li>
<li> <p><code class="reqn">\pmb{\beta}_{u,t}</code> is a subvector of <code class="reqn">\pmb{\beta}_t</code> holding
values for the  <code class="reqn">u</code>th combination of the non-age, non-time,
non-sex/gender variables for period <code class="reqn">t</code>;
</p>
</li>
<li> <p><code class="reqn">\pmb{F}</code> is a known matrix; and
</p>
</li>
<li> <p><code class="reqn">\pmb{g}</code> is a known vector.
</p>
</li></ul>

<p><code class="reqn">\pmb{F}</code> and <code class="reqn">\pmb{g}</code> are constructed from
a large database of age-specific demographic estimates
by applying the singular value decomposition, and then standardizing.
</p>
<p>With <code>SVD_AR()</code>, the prior for the <code class="reqn">k</code>th element
of <code class="reqn">\pmb{\alpha}_t</code> or <code class="reqn">\pmb{\alpha}_{u,t}</code> is
</p>
<p style="text-align: center;"><code class="reqn">\alpha_{k,t} = \phi_1 \alpha_{k,t-1} + \cdots + \phi_n \beta_{k,t-n} + \epsilon_{k,t}</code>
</p>

<p>or
</p>
<p style="text-align: center;"><code class="reqn">\alpha_{k,u,t} = \phi_1 \alpha_{k,u,t-1} + \cdots + \phi_n \beta_{k,u,t-n} + \epsilon_{k,u,t};</code>
</p>

<p>with <code>SVD_AR1()</code>, it is
</p>
<p style="text-align: center;"><code class="reqn">\alpha_{k,t} = \phi \alpha_{k,t-1} + \epsilon_{k,t}</code>
</p>

<p>or
</p>
<p style="text-align: center;"><code class="reqn">\alpha_{k,u,t} = \phi \alpha_{k,u,t-1} + \epsilon_{k,u,t};</code>
</p>

<p>with <code>SVD_RW()</code>, it is
</p>
<p style="text-align: center;"><code class="reqn">\alpha_{k,t} = \alpha_{k,t-1} + \epsilon_{k,t}</code>
</p>

<p>or
</p>
<p style="text-align: center;"><code class="reqn">\alpha_{k,u,t} = \alpha_{k,u,t-1} + \epsilon_{k,u,t};</code>
</p>

<p>and with <code>SVD_RW2()</code>, it is
</p>
<p style="text-align: center;"><code class="reqn">\alpha_{k,t} = 2 \alpha_{k,t-1} - \alpha_{k,t-2} + \epsilon_{k,t}</code>
</p>

<p>or
</p>
<p style="text-align: center;"><code class="reqn">\alpha_{k,u,t} = 2 \alpha_{k,u,t-1} - \alpha_{k,u,t-2} + \epsilon_{k,u,t}.</code>
</p>

<p>For details, see <code><a href="#topic+AR">AR()</a></code>, <code><a href="#topic+AR1">AR1()</a></code>,
<code><a href="#topic+RW">RW()</a></code>, and <code><a href="#topic+RW2">RW2()</a></code>.
</p>


<h3>Constraints</h3>

<p>With some combinations of terms and priors, the values of
the intercept, main effects, and interactions are
are only weakly identified.
For instance, it may be possible to increase the value of the
intercept and reduce the value of the remaining terms in
the model with no effect on predicted rates and only a tiny
effect on prior probabilities. This weak identifiability is
typically harmless. However, in some applications, such as
forecasting, or when trying to obtain interpretable values
for main effects and interactions, it can be helpful to increase
identifiability through the use of constraints.
</p>
<p>Current options for constraints are:
</p>

<ul>
<li> <p><code>"none"</code> No constraints. The default.
</p>
</li>
<li> <p><code>"by"</code> Only used in interaction terms that include 'along' and
'by' dimensions. Within each value of the 'along'
dimension, terms across each 'by' dimension are constrained
to sum to 0.
</p>
</li></ul>



<h3>Scaled SVDs of demographic databases in bage</h3>


<ul>
<li> <p><code><a href="#topic+HMD">HMD</a></code> Mortality rates from the
<a href="https://www.mortality.org">Human Mortality Database</a>.
</p>
</li>
<li> <p><code><a href="#topic+HFD">HFD</a></code> Fertility rates from the
<a href="https://www.humanfertility.org">Human Fertility Database</a>.
</p>
</li>
<li> <p><code><a href="#topic+LFP">LFP</a></code> Labor forcce participation
rates from the <a href="https://data-explorer.oecd.org">OECD</a>.
</p>
</li></ul>



<h3>References</h3>


<ul>
<li><p> For details of the construction of
scaled SVDS see the vignette
<a href="https://bayesiandemography.github.io/bage/articles/vig2_math.html">here</a>.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+SVD">SVD()</a></code> SVD prior for non-time-varying terms
</p>
</li>
<li> <p><code><a href="#topic+RW">RW()</a></code> Smoothing via random walk
</p>
</li>
<li> <p><code><a href="#topic+RW2">RW2()</a></code> Smoothing via second-order random walk
</p>
</li>
<li> <p><code><a href="#topic+Sp">Sp()</a></code> Smoothing via splines
</p>
</li>
<li> <p><a href="#topic+priors">priors</a> Overview of priors implemented in <strong>bage</strong>
</p>
</li>
<li> <p><code><a href="#topic+set_prior">set_prior()</a></code> Specify prior for intercept,
main effect, or interaction
</p>
</li>
<li> <p><code><a href="#topic+set_var_sexgender">set_var_sexgender()</a></code> Identify sex or gender variable in data
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>SVD_AR1(HMD)
SVD_RW(HMD, n_comp = 3)
SVD_RW2(HMD, indep = FALSE)
</code></pre>

<hr>
<h2 id='swe_infant'>Infant Mortality in Sweden</h2><span id='topic+swe_infant'></span>

<h3>Description</h3>

<p>Counts of births and infant deaths in Sweden by county and year, 1995-2015
</p>


<h3>Usage</h3>

<pre><code class='language-R'>swe_infant
</code></pre>


<h3>Format</h3>

<p>A tibble with 441 rows and the following columns:
</p>

<ul>
<li> <p><code>county</code>: A factor with 21 levels, where the levels are
ordered by number of births, from <code>"Stockholm"</code> down to <code>"Gotland"</code>
</p>
</li>
<li><p> 'time: Calendar year
</p>
</li>
<li> <p><code>births</code>: Count of births
</p>
</li>
<li> <p><code>deaths</code>: Count of infant deaths
</p>
</li></ul>



<h3>Details</h3>

<p>Dataset used in Chapter 11 of the book
<em>Bayesian Demographic Estimation and Forecasting</em>.
</p>


<h3>Source</h3>

<p>Database &quot;Live births by region, mother's age and child's sex.
Year 1968 - 2017&quot; and database &quot;Deaths by region, age (during the year) and sex.
Year 1968 - 2017&quot; on the Statistics Sweden website. Downloaded on 13 July 2018.
</p>


<h3>References</h3>

<p>Bryant J and Zhang J. 2018.
<em>Bayesian Demographic Estimation and Forecasting</em>. CRC Press.
</p>

<hr>
<h2 id='tidy.bage_mod'>Summarize Terms from a Fitted Model</h2><span id='topic+tidy.bage_mod'></span>

<h3>Description</h3>

<p>Summarize the intercept, main effects, and interactions
from a fitted model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bage_mod'
tidy(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tidy.bage_mod_+3A_x">x</code></td>
<td>
<p>Object of class <code>"bage_mod"</code>, typically
created with <code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>,
or <code><a href="#topic+mod_norm">mod_norm()</a></code>.</p>
</td></tr>
<tr><td><code id="tidy.bage_mod_+3A_...">...</code></td>
<td>
<p>Unused. Included for generic consistency only.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <a href="tibble.html#topic+tibble-package">tibble</a> returned by <code>tidy()</code>
contains the following columns:
</p>

<ul>
<li> <p><code>term</code> Name of the intercept, main effect, or interaction
</p>
</li>
<li> <p><code>prior</code> Specification for prior
</p>
</li>
<li> <p><code>n_par</code> Number of parameters
</p>
</li>
<li> <p><code>n_par_free</code> Number of free parameters
</p>
</li>
<li> <p><code>std_dev</code> Standard deviation for point estimates.
</p>
</li></ul>

<p>With some priors, the number of free parameters is less than
the number of parameters for that term. For instance, an <code><a href="#topic+SVD">SVD()</a></code>
prior might use three vectors to represent 101 age groups
so that the number of parameters is 101, but the number of
free parameters is 3.
</p>
<p><code>std_dev</code> is the standard deviation across elements of a
term, based on point estimates of those elements.
For instance, if the point
estimates for a term with three elements are
0.3, 0.5, and 0.1,  then the value for <code>std_dev</code> is
</p>
<div class="sourceCode"><pre>sd(c(0.3, 0.5, 0.1))
</pre></div>
<p><code>std_dev</code> is a measure of the contribution of a term to
variation in the outcome variable.
</p>


<h3>Value</h3>

<p>A <a href="tibble.html#topic+tibble-package">tibble</a>
</p>


<h3>References</h3>

<p><code>std_dev</code> is modified from Gelman et al. (2014)
<em>Bayesian Data Analysis. Third Edition</em>. pp396&ndash;397.
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+augment">augment()</a></code> Extract data, and values for rates,
probabilities, or means
</p>
</li>
<li> <p><code><a href="#topic+components">components()</a></code> Extract values for hyper-parameters
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>mod &lt;- mod_pois(injuries ~ age + sex + year,
                data = nzl_injuries,
                exposure = popn)
mod &lt;- fit(mod)
tidy(mod)
</code></pre>

<hr>
<h2 id='unfit'>Unfit a Model</h2><span id='topic+unfit'></span>

<h3>Description</h3>

<p>Reset a model, deleting all estimates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>unfit(mod)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="unfit_+3A_mod">mod</code></td>
<td>
<p>A fitted object of class <code>"bage_mod"</code>,
object, created through a call to <code><a href="#topic+mod_pois">mod_pois()</a></code>,
<code><a href="#topic+mod_binom">mod_binom()</a></code>, or <code><a href="#topic+mod_norm">mod_norm()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An unfitted version of <code>mod</code>.
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+fit">fit()</a></code> Fit a model
</p>
</li>
<li> <p><code><a href="#topic+mod_pois">mod_pois()</a></code>, <code><a href="#topic+mod_binom">mod_binom()</a></code>, <code><a href="#topic+mod_norm">mod_norm()</a></code> Specify a model
</p>
</li>
<li><p> Functions such as <code><a href="#topic+set_prior">set_prior()</a></code>, <code><a href="#topic+set_disp">set_disp()</a></code> and
<code><a href="#topic+set_var_age">set_var_age()</a></code> unfit models as side effects.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## create a model, which starts out unfitted
mod &lt;- mod_pois(injuries ~ age + sex + year,
                data = nzl_injuries,
                exposure = popn)
is_fitted(mod)

## calling 'fit' produces a fitted version
mod &lt;- fit(mod)
is_fitted(mod)

## calling 'unfit' resets the model
mod &lt;- unfit(mod)
is_fitted(mod)
</code></pre>

<hr>
<h2 id='usa_deaths'>Accidental Deaths in the USA</h2><span id='topic+usa_deaths'></span>

<h3>Description</h3>

<p>Counts of accidental deaths in the USA,
by month, for 1973-1978.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>usa_deaths
</code></pre>


<h3>Format</h3>

<p>A <a href="tibble.html#topic+tibble-package">tibble</a>
with 72 rows and the following columns:
</p>

<ul>
<li> <p><code>month</code>: Year and month.
</p>
</li>
<li> <p><code>deaths</code>: Count of deaths.
</p>
</li></ul>



<h3>Source</h3>

<p>Reformatted version of
<code>datasets::USAccDeaths</code>.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
