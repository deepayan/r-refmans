<!DOCTYPE html><html><head><title>Help for package tongfen</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {tongfen}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#add_census_ca_base_variables'><p>Generate metadata from Candian census vectors</p></a></li>
<li><a href='#aggregate_data_with_meta'><p>Aggregate variables in grouped data</p></a></li>
<li><a href='#check_tongfen_areas'><p>Check geographic integrety</p></a></li>
<li><a href='#check_tongfen_single_areas'><p>Check geographic integrety</p></a></li>
<li><a href='#estimate_tongfen_correspondence'><p>Generate togfen correspondence for list of geographies</p></a></li>
<li><a href='#estimate_tongfen_single_correspondence'><p>Generate togfen correspondence for two geographies</p></a></li>
<li><a href='#get_correspondence_ca_census_for'><p>Get StatCan DA or DB level correspondence file</p></a></li>
<li><a href='#get_single_correspondence_ca_census_for'><p>Get StatCan DA or DB level correspondence file</p></a></li>
<li><a href='#get_tongfen_ca_census'><p>Togfen data from several Canadian censuses</p></a></li>
<li><a href='#get_tongfen_ca_census_ct_from_da'><p>Canadian census CT level tongfen via DA correspondence</p></a></li>
<li><a href='#get_tongfen_census_ct'><p>Canadian census CT level tongfen</p></a></li>
<li><a href='#get_tongfen_census_da'><p>Canadian Census DA level tongfen</p></a></li>
<li><a href='#get_tongfen_correspondence_ca_census'><p>Get StatCan correspondence data</p></a></li>
<li><a href='#get_tongfen_us_census'><p>Get US census data for 2000 and 2010 census on common census tract based geography</p></a></li>
<li><a href='#meta_for_additive_variables'><p>Generate tongfen metadata for additive variables</p></a></li>
<li><a href='#meta_for_ca_census_vectors'><p>Generate metadata from Candian census vectors</p></a></li>
<li><a href='#proportional_reaggregate'><p>Dasymetric downsampling</p></a></li>
<li><a href='#tongfen_aggregate'><p>Perform tongfen according to correspondence</p></a></li>
<li><a href='#tongfen_ca_census_ct'><p>Canadian census CT level tongfen via identifier matching</p></a></li>
<li><a href='#tongfen_estimate'><p>Estimate variable values for custom geography</p></a></li>
<li><a href='#tongfen_estimate_ca_census'><p>Tongfen estimate data for given geometry</p></a></li>
<li><a href='#tongfen_tag_largest_overlap'><p>Tag regions by largest overlap</p></a></li>
<li><a href='#vancouver_elections_data_2015'><p>A dataset with polling station votes data from the 2015 federal election in the Vancouver area</p></a></li>
<li><a href='#vancouver_elections_data_2019'><p>A dataset with polling station votes data from the 2019 federal election in the Vancouver area</p></a></li>
<li><a href='#vancouver_elections_geos_2015'><p>A dataset with polling district geographies from the 2015 federal election in the Vancouver area</p></a></li>
<li><a href='#vancouver_elections_geos_2019'><p>A dataset with polling district geographies from the 2019 federal election in the Vancouver area</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Make Data Based on Different Geographies Comparable</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.5</td>
</tr>
<tr>
<td>Description:</td>
<td>Several functions to allow comparisons of data across different geographies, in particular for Canadian census data from different censuses.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>ByteCompile:</td>
<td>yes</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr (&ge; 1.0), tidyr (&ge; 1.0), sf, tibble, rlang, purrr,
stringr, readr, utils, lifecycle</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, RColorBrewer, ggplot2, geojsonsf,
cancensus, tidycensus, spelling, readxl, scales</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/mountainMath/tongfen">https://github.com/mountainMath/tongfen</a>,
<a href="https://mountainmath.github.io/tongfen/">https://mountainmath.github.io/tongfen/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/mountainMath/tongfen/issues">https://github.com/mountainMath/tongfen/issues</a></td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>RdMacros:</td>
<td>lifecycle</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-04-28 18:14:19 UTC; jens</td>
</tr>
<tr>
<td>Author:</td>
<td>Jens von Bergmann [aut, cre] (creator and maintainer)</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jens von Bergmann &lt;jens@mountainmath.ca&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-04-28 18:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='add_census_ca_base_variables'>Generate metadata from Candian census vectors</h2><span id='topic+add_census_ca_base_variables'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
</p>
<p>Add Population, Dwellings, and Household counts to metadata
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_census_ca_base_variables(meta)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="add_census_ca_base_variables_+3A_meta">meta</code></td>
<td>
<p>ribble with metadata as for example provided by 'meta_for_ca_census_vectors'</p>
</td></tr>
</table>


<h3>Value</h3>

<p>tibble with metadata
</p>

<hr>
<h2 id='aggregate_data_with_meta'>Aggregate variables in grouped data</h2><span id='topic+aggregate_data_with_meta'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
</p>
<p>Aggregate census data up, assumes data is grouped for aggregation
Uses data from meta to determine how to aggregate up
</p>


<h3>Usage</h3>

<pre><code class='language-R'>aggregate_data_with_meta(data, meta, geo = FALSE, na.rm = TRUE, quiet = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="aggregate_data_with_meta_+3A_data">data</code></td>
<td>
<p>census data as obtained from get_census call, grouped by TongfenID</p>
</td></tr>
<tr><td><code id="aggregate_data_with_meta_+3A_meta">meta</code></td>
<td>
<p>list with variables and aggregation information as obtained from meta_for_vectors</p>
</td></tr>
<tr><td><code id="aggregate_data_with_meta_+3A_geo">geo</code></td>
<td>
<p>logical, should also aggregate geographic data</p>
</td></tr>
<tr><td><code id="aggregate_data_with_meta_+3A_na.rm">na.rm</code></td>
<td>
<p>logical, should NA values be ignored or carried through.</p>
</td></tr>
<tr><td><code id="aggregate_data_with_meta_+3A_quiet">quiet</code></td>
<td>
<p>logical, don't emit messages if set to 'TRUE'</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data frame with variables aggregated to new common geography
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Aggregate population from DA level to grouped by CT_UID
## Not run: 
geo &lt;- cancensus::get_census("CA06",regions=list(CSD="5915022"),level='DA')
meta &lt;- meta_for_additive_variables("CA06","Population")
result &lt;- aggregate_data_with_meta(geo %&gt;% group_by(CT_UID),meta)

## End(Not run)
</code></pre>

<hr>
<h2 id='check_tongfen_areas'>Check geographic integrety</h2><span id='topic+check_tongfen_areas'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
</p>
<p>Sanity check for areas of estimated tongfen correspondence. This is useful if for example the total extent
of geo1 and geo2 differ and there are regions at the edges with large difference in overlap.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_tongfen_areas(data, correspondence)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_tongfen_areas_+3A_data">data</code></td>
<td>
<p>alist of geogrpahic data of class sf</p>
</td></tr>
<tr><td><code id="check_tongfen_areas_+3A_correspondence">correspondence</code></td>
<td>
<p>Correspondence table with columns the unique geographic identifiers for each of the
geographies and the TongfenID (and optionally TongfenUID and TongfenMethod)
returned by 'estimate_tongfen_correspondence'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A table with columns 'TongfenID', geo_identifiers, the areas of the aggregated regions
corresponding to each geographic identifier column, the tongfen estimation method and the maximum log ratio
of the areas.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Estimate a common geography for 2006 and 2016 dissemination areas in the City of Vancouver
# based on the geographic data and check estimation errors
## Not run: 
regions &lt;- list(CSD="5915022")

data_06 &lt;- cancensus::get_census("CA06",regions=regions,geo_format='sf',level="DA") %&gt;%
  rename(GeoUID_06=GeoUID)
data_16 &lt;- cancensus::get_census("CA16",regions=regions,geo_format="sf",level="DA") %&gt;%
  rename(GeoUID_16=GeoUID)

correspondence &lt;- estimate_tongfen_correspondence(list(data_06, data_16),
                                                  c("GeoUID_06","GeoUID_16"))

area_check &lt;- check_tongfen_areas(list(data_06, data_16),correspondence)

## End(Not run)
</code></pre>

<hr>
<h2 id='check_tongfen_single_areas'>Check geographic integrety</h2><span id='topic+check_tongfen_single_areas'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>
<p>Sanity check for areas of estimated tongfen correspondence. This is useful if for example the total extent
of geo1 and geo2 differ and there are regions at the edges with large difference in overlap.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_tongfen_single_areas(geo1, geo2, correspondence)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_tongfen_single_areas_+3A_geo1">geo1</code></td>
<td>
<p>input geometry 1 of class sf</p>
</td></tr>
<tr><td><code id="check_tongfen_single_areas_+3A_geo2">geo2</code></td>
<td>
<p>input geometry 2 of class sf</p>
</td></tr>
<tr><td><code id="check_tongfen_single_areas_+3A_correspondence">correspondence</code></td>
<td>
<p>Correspondence table between 'geo1' and 'geo2' as e.g.
returned by 'estimate_tongfen_correspondence'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A table with columns 'TongfenID', 'area1' and 'area2', where each row corresponds to a unique
'TongfenID' from them 'correspondence' table and the other columns hold the areas of the regions
aggregated from 'geo1' and 'geo2'.'
</p>

<hr>
<h2 id='estimate_tongfen_correspondence'>Generate togfen correspondence for list of geographies</h2><span id='topic+estimate_tongfen_correspondence'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
</p>
<p>Get correspondence data for arbitrary congruent geometries. Congruent means that one can obtain a common
tiling by aggregating several sub-geometries in each of the two input geo data. Worst case scenario the
only common tiling is given by unioning all sub-geometries and there is no finer common tiling.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_tongfen_correspondence(
  data,
  geo_identifiers,
  method = "estimate",
  tolerance = 50,
  computation_crs = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimate_tongfen_correspondence_+3A_data">data</code></td>
<td>
<p>list of geometries of class sf</p>
</td></tr>
<tr><td><code id="estimate_tongfen_correspondence_+3A_geo_identifiers">geo_identifiers</code></td>
<td>
<p>vector of unique geographic identifiers for each list entry in data.</p>
</td></tr>
<tr><td><code id="estimate_tongfen_correspondence_+3A_method">method</code></td>
<td>
<p>aggregation method. Possible values are &quot;estimate&quot; or &quot;identifier&quot;. &quot;estimate&quot; estimates the
correspondence purely from the geographic data. &quot;identifier&quot; assumes that regions with identical geo_identifiers are the same,
and uses the &quot;estimate&quot; method for the remaining regions. Default is &quot;estimate&quot;.</p>
</td></tr>
<tr><td><code id="estimate_tongfen_correspondence_+3A_tolerance">tolerance</code></td>
<td>
<p>tolerance (in projected coordinate units of 'computation_crs') for feature matching</p>
</td></tr>
<tr><td><code id="estimate_tongfen_correspondence_+3A_computation_crs">computation_crs</code></td>
<td>
<p>optional crs in which the computation should be carried out,
defaults to crs of the first entry in the data parameter.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A correspondence table linking geo1_uid and geo2_uid with unique TongfenID and TongfenUID columns
that enumerate the common geometry.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Estimate a common geography for 2006 and 2016 dissemination areas in the City of Vancouver
# based on the geographic data.
## Not run: 
regions &lt;- list(CSD="5915022")

data_06 &lt;- cancensus::get_census("CA06",regions=regions,geo_format='sf',level="DA") %&gt;%
 rename(GeoUID_06=GeoUID)
data_16 &lt;- cancensus::get_census("CA16",regions=regions,geo_format="sf",level="DA") %&gt;%
  rename(GeoUID_16=GeoUID)

correspondence &lt;- estimate_tongfen_correspondence(list(data_06, data_16),
                                                  c("GeoUID_06","GeoUID_16"))


## End(Not run)
</code></pre>

<hr>
<h2 id='estimate_tongfen_single_correspondence'>Generate togfen correspondence for two geographies</h2><span id='topic+estimate_tongfen_single_correspondence'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
</p>
<p>Get correspondence data for arbitrary congruent geometries. Congruent means that one can obtain a common
tiling by aggregating several sub-geometries in each of the two input geo data. Worst case scenario the
only common tiling is given by unioning all sub-geometries and there is no finer common tiling.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_tongfen_single_correspondence(
  geo1,
  geo2,
  geo1_uid,
  geo2_uid,
  tolerance = 1,
  computation_crs = NULL,
  robust = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimate_tongfen_single_correspondence_+3A_geo1">geo1</code></td>
<td>
<p>input geometry 1 of class sf</p>
</td></tr>
<tr><td><code id="estimate_tongfen_single_correspondence_+3A_geo2">geo2</code></td>
<td>
<p>input geometry 2 of class sf</p>
</td></tr>
<tr><td><code id="estimate_tongfen_single_correspondence_+3A_geo1_uid">geo1_uid</code></td>
<td>
<p>(unique) identifier column for geo1</p>
</td></tr>
<tr><td><code id="estimate_tongfen_single_correspondence_+3A_geo2_uid">geo2_uid</code></td>
<td>
<p>(unique) identifier column for geo2</p>
</td></tr>
<tr><td><code id="estimate_tongfen_single_correspondence_+3A_tolerance">tolerance</code></td>
<td>
<p>tolerance (in projected coordinate units) for feature matching</p>
</td></tr>
<tr><td><code id="estimate_tongfen_single_correspondence_+3A_computation_crs">computation_crs</code></td>
<td>
<p>optional crs in which the computation should be carried out,
defaults to crs of geo1</p>
</td></tr>
<tr><td><code id="estimate_tongfen_single_correspondence_+3A_robust">robust</code></td>
<td>
<p>boolean parameter, will ensure geometries are valid if set to TRUE</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A correspondence table linking geo1_uid and geo2_uid with unique TongfenID and TongfenUID columns
that enumerate the common geometry.
</p>

<hr>
<h2 id='get_correspondence_ca_census_for'>Get StatCan DA or DB level correspondence file</h2><span id='topic+get_correspondence_ca_census_for'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
Joins the StatCan correspodence files for several census years
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_correspondence_ca_census_for(years, level, refresh = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_correspondence_ca_census_for_+3A_years">years</code></td>
<td>
<p>list of census years</p>
</td></tr>
<tr><td><code id="get_correspondence_ca_census_for_+3A_level">level</code></td>
<td>
<p>geographic level, DA or DB</p>
</td></tr>
<tr><td><code id="get_correspondence_ca_census_for_+3A_refresh">refresh</code></td>
<td>
<p>reload the correspondence files, default is 'FALSE'</p>
</td></tr>
</table>


<h3>Value</h3>

<p>tibble with correspondence table'spanning all years
</p>

<hr>
<h2 id='get_single_correspondence_ca_census_for'>Get StatCan DA or DB level correspondence file</h2><span id='topic+get_single_correspondence_ca_census_for'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_single_correspondence_ca_census_for(
  year,
  level = c("DA", "DB"),
  refresh = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_single_correspondence_ca_census_for_+3A_year">year</code></td>
<td>
<p>census year, only 2006 through 2021 are supported</p>
</td></tr>
<tr><td><code id="get_single_correspondence_ca_census_for_+3A_level">level</code></td>
<td>
<p>geographic level, DA or DB</p>
</td></tr>
<tr><td><code id="get_single_correspondence_ca_census_for_+3A_refresh">refresh</code></td>
<td>
<p>reload the correspondence files, default is 'FALSE'</p>
</td></tr>
</table>


<h3>Value</h3>

<p>tibble with correspondence table'
</p>

<hr>
<h2 id='get_tongfen_ca_census'>Togfen data from several Canadian censuses</h2><span id='topic+get_tongfen_ca_census'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
</p>
<p>Get data from several Candian censuses on a common geography. Requires sf and cancensus package to be available
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_tongfen_ca_census(
  regions,
  meta,
  level = "CT",
  method = "statcan",
  base_geo = NULL,
  na.rm = FALSE,
  tolerance = 50,
  area_mismatch_cutoff = 0.1,
  quiet = FALSE,
  refresh = FALSE,
  crs = NULL,
  data_transform = function(d) d
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_tongfen_ca_census_+3A_regions">regions</code></td>
<td>
<p>census region list, should be inclusive list of GeoUIDs across censuses</p>
</td></tr>
<tr><td><code id="get_tongfen_ca_census_+3A_meta">meta</code></td>
<td>
<p>metadata for the census veraiables to aggregate, for example as returned
by <code>meta_for_ca_census_vectors</code>.</p>
</td></tr>
<tr><td><code id="get_tongfen_ca_census_+3A_level">level</code></td>
<td>
<p>aggregation level to return data on (default is &quot;CT&quot;)</p>
</td></tr>
<tr><td><code id="get_tongfen_ca_census_+3A_method">method</code></td>
<td>
<p>tongfen method, options are &quot;statcan&quot; (the default), &quot;estimate&quot;, &quot;identifier&quot;.
* &quot;statcan&quot; method builds up the common geography using Statistics Canada correspondence files, at this point
this method only works for &quot;DB&quot;, &quot;DA&quot; and &quot;CT&quot; levels.
* &quot;estimate&quot; uses 'estimate_tongfen_correspondence' to build up the common geography from scratch based on geographies.
* &quot;identifier&quot; assumes regions with identical geographic identifier are identical, and builds up the the correspondence for regions with unmatched geographic identifiers.</p>
</td></tr>
<tr><td><code id="get_tongfen_ca_census_+3A_base_geo">base_geo</code></td>
<td>
<p>base census year to build up common geography from, 'NULL' (the default) to not return
any geographi data</p>
</td></tr>
<tr><td><code id="get_tongfen_ca_census_+3A_na.rm">na.rm</code></td>
<td>
<p>logical, determines how NA values should be treated when aggregating variables</p>
</td></tr>
<tr><td><code id="get_tongfen_ca_census_+3A_tolerance">tolerance</code></td>
<td>
<p>tolerance for 'estimate_tongen_correspondence' in metres, default value is 50 metres,
only used when method is 'estimate' or 'identifier'</p>
</td></tr>
<tr><td><code id="get_tongfen_ca_census_+3A_area_mismatch_cutoff">area_mismatch_cutoff</code></td>
<td>
<p>discard areas returned by 'estimate_tongfen_correspondence' with area mismatch (log ratio) greater than cutoff,
only used when method is 'estimate' or 'identifier'</p>
</td></tr>
<tr><td><code id="get_tongfen_ca_census_+3A_quiet">quiet</code></td>
<td>
<p>suppress download progress output, default is 'FALSE'</p>
</td></tr>
<tr><td><code id="get_tongfen_ca_census_+3A_refresh">refresh</code></td>
<td>
<p>optional character, refresh data cache for this call, (default 'FALSE')</p>
</td></tr>
<tr><td><code id="get_tongfen_ca_census_+3A_crs">crs</code></td>
<td>
<p>optional CRS to transform data to, and use for spatial intersections if method is
'identifier' or 'estimate'</p>
</td></tr>
<tr><td><code id="get_tongfen_ca_census_+3A_data_transform">data_transform</code></td>
<td>
<p>optional transform function to be applied to census data after being returned from cancensus</p>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe with variables on common geography
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Get rent data for census years 2001 through 2016
## Not run: 
rent_variables &lt;- c(rent_2001="v_CA01_1667",rent_2016="v_CA16_4901",
                    rent_2011="v_CA11N_2292",rent_2006="v_CA06_2050")
meta &lt;- meta_for_ca_census_vectors(rent_variables)

regions=list(CMA="59933")
rent_data &lt;- get_tongfen_ca_census(regions=regions, meta=meta, quiet=TRUE,
                                   method="estimate", level="CT", base_geo = "CA16")


## End(Not run)
</code></pre>

<hr>
<h2 id='get_tongfen_ca_census_ct_from_da'>Canadian census CT level tongfen via DA correspondence</h2><span id='topic+get_tongfen_ca_census_ct_from_da'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>
<p>Grab variables from several censuses on a common geography. Requires sf package to be available
Will return CT level data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_tongfen_ca_census_ct_from_da(
  regions,
  vectors,
  geo_format = NA,
  use_cache = TRUE,
  na.rm = TRUE,
  quiet = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_tongfen_ca_census_ct_from_da_+3A_regions">regions</code></td>
<td>
<p>census region list, should be inclusive list of GeoUIDs across censuses</p>
</td></tr>
<tr><td><code id="get_tongfen_ca_census_ct_from_da_+3A_vectors">vectors</code></td>
<td>
<p>List of cancensus vectors, can come from different census years</p>
</td></tr>
<tr><td><code id="get_tongfen_ca_census_ct_from_da_+3A_geo_format">geo_format</code></td>
<td>
<p>&lsquo;NA' to only get the variables or &rsquo;sf' to also get geographic data</p>
</td></tr>
<tr><td><code id="get_tongfen_ca_census_ct_from_da_+3A_use_cache">use_cache</code></td>
<td>
<p>logical, passed to 'cancensus::get_census' to regulate caching</p>
</td></tr>
<tr><td><code id="get_tongfen_ca_census_ct_from_da_+3A_na.rm">na.rm</code></td>
<td>
<p>logical, determines how NA values should be treated when aggregating variables</p>
</td></tr>
<tr><td><code id="get_tongfen_ca_census_ct_from_da_+3A_quiet">quiet</code></td>
<td>
<p>suppress download progress output, default is 'TRUE'</p>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe with variables on common geography
</p>

<hr>
<h2 id='get_tongfen_census_ct'>Canadian census CT level tongfen</h2><span id='topic+get_tongfen_census_ct'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>
<p>Grab variables from several censuses on a common geography. Requires sf package to be available
Will return CT level data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_tongfen_census_ct(
  regions,
  vectors,
  geo_format = NA,
  na.rm = TRUE,
  quiet = TRUE,
  refresh = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_tongfen_census_ct_+3A_regions">regions</code></td>
<td>
<p>census region list, should be inclusive list of GeoUIDs across censuses</p>
</td></tr>
<tr><td><code id="get_tongfen_census_ct_+3A_vectors">vectors</code></td>
<td>
<p>List of cancensus vectors, can come from different census years</p>
</td></tr>
<tr><td><code id="get_tongfen_census_ct_+3A_geo_format">geo_format</code></td>
<td>
<p>geographic format for returned data, 'sf' for sf format and 'NA&ldquo;</p>
</td></tr>
<tr><td><code id="get_tongfen_census_ct_+3A_na.rm">na.rm</code></td>
<td>
<p>remove NA values when aggregating up values, default is 'TRUE'</p>
</td></tr>
<tr><td><code id="get_tongfen_census_ct_+3A_quiet">quiet</code></td>
<td>
<p>suppress download progress output, default is 'FALSE'</p>
</td></tr>
<tr><td><code id="get_tongfen_census_ct_+3A_refresh">refresh</code></td>
<td>
<p>optional character, refresh data cache for this call</p>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe with census variables on common geography
</p>

<hr>
<h2 id='get_tongfen_census_da'>Canadian Census DA level tongfen</h2><span id='topic+get_tongfen_census_da'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>
<p>Grab variables from several censuses on a common geography. Requires sf package to be available
Will return CT level data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_tongfen_census_da(
  regions,
  vectors,
  geo_format = NA,
  use_cache = TRUE,
  na.rm = TRUE,
  quiet = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_tongfen_census_da_+3A_regions">regions</code></td>
<td>
<p>census region list, should be inclusive list of GeoUIDs across censuses</p>
</td></tr>
<tr><td><code id="get_tongfen_census_da_+3A_vectors">vectors</code></td>
<td>
<p>List of cancensus vectors, can come from different census years</p>
</td></tr>
<tr><td><code id="get_tongfen_census_da_+3A_geo_format">geo_format</code></td>
<td>
<p>&lsquo;NA' to only get the variables or &rsquo;sf' to also get geographic data</p>
</td></tr>
<tr><td><code id="get_tongfen_census_da_+3A_use_cache">use_cache</code></td>
<td>
<p>logical, passed to 'cancensus::get_census' to regulate caching</p>
</td></tr>
<tr><td><code id="get_tongfen_census_da_+3A_na.rm">na.rm</code></td>
<td>
<p>logical, determines how NA values should be treated when aggregating variables</p>
</td></tr>
<tr><td><code id="get_tongfen_census_da_+3A_quiet">quiet</code></td>
<td>
<p>suppress download progress output, default is 'TRUE'</p>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe with variables on common geography
</p>

<hr>
<h2 id='get_tongfen_correspondence_ca_census'>Get StatCan correspondence data</h2><span id='topic+get_tongfen_correspondence_ca_census'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
</p>
<p>Get correspondence file for several Candian censuses on a common geography. Requires sf and cancensus package to be available
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_tongfen_correspondence_ca_census(
  geo_datasets,
  regions,
  level = "CT",
  method = "statcan",
  tolerance = 50,
  area_mismatch_cutoff = 0.1,
  quiet = FALSE,
  refresh = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_tongfen_correspondence_ca_census_+3A_geo_datasets">geo_datasets</code></td>
<td>
<p>vector of census geography dataset identifiers</p>
</td></tr>
<tr><td><code id="get_tongfen_correspondence_ca_census_+3A_regions">regions</code></td>
<td>
<p>census region list, should be inclusive list of GeoUIDs across censuses</p>
</td></tr>
<tr><td><code id="get_tongfen_correspondence_ca_census_+3A_level">level</code></td>
<td>
<p>aggregation level to return data on (default is &quot;CT&quot;)</p>
</td></tr>
<tr><td><code id="get_tongfen_correspondence_ca_census_+3A_method">method</code></td>
<td>
<p>tongfen method, options are &quot;statcan&quot; (the default), &quot;estimate&quot;, &quot;identifier&quot;.
* &quot;statcan&quot; method builds up the common geography using Statistics Canada correspondence files, at this point
this method only works for &quot;DB&quot;, &quot;DA&quot; and &quot;CT&quot; levels.
* &quot;estimate&quot; uses 'estimate_tongfen_correspondence' to build up the common geography from scratch based on geographies.
* &quot;identifier&quot; assumes regions with identical geographic identifier are identical, and builds up the the correspondence for regions with unmatched geographic identifiers.</p>
</td></tr>
<tr><td><code id="get_tongfen_correspondence_ca_census_+3A_tolerance">tolerance</code></td>
<td>
<p>tolerance for 'estimate_tongen_correspondence' in metres, default value is 50 metres.</p>
</td></tr>
<tr><td><code id="get_tongfen_correspondence_ca_census_+3A_area_mismatch_cutoff">area_mismatch_cutoff</code></td>
<td>
<p>discard areas returned by 'estimate_tongfen_correspondence' with area mismatch (log ratio) greater than cutoff.</p>
</td></tr>
<tr><td><code id="get_tongfen_correspondence_ca_census_+3A_quiet">quiet</code></td>
<td>
<p>suppress download progress output, default is 'FALSE'</p>
</td></tr>
<tr><td><code id="get_tongfen_correspondence_ca_census_+3A_refresh">refresh</code></td>
<td>
<p>optional character, refresh data cache for this call, (default 'FALSE')</p>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe with the multi-census correspondence file
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Get correspondance files between CTs in 2006 and 2016 censuses in Vancouver CMA
## Not run: 
correspondence &lt;- get_tongfen_correspondence_ca_census(geo_datasets=c('CA06','CA16'),
                                                       regions=list(CMA="59933"),level='CT')

## End(Not run)
</code></pre>

<hr>
<h2 id='get_tongfen_us_census'>Get US census data for 2000 and 2010 census on common census tract based geography</h2><span id='topic+get_tongfen_us_census'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
</p>
<p>This wraps data acquisition via the tidycensus package and tongfen on a common geography into
a single convenience function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_tongfen_us_census(
  regions,
  meta,
  level = "tract",
  survey = "census",
  base_geo = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_tongfen_us_census_+3A_regions">regions</code></td>
<td>
<p>list with regions to query the data for. At this stage, the only
valid list is a vector of states, i.e. 'regions = list(state=c(&quot;CA&quot;,&quot;OR&quot;))&ldquo;</p>
</td></tr>
<tr><td><code id="get_tongfen_us_census_+3A_meta">meta</code></td>
<td>
<p>metadata for variables to retrieve</p>
</td></tr>
<tr><td><code id="get_tongfen_us_census_+3A_level">level</code></td>
<td>
<p>aggregation level to return the data on. At this stage, the only valid levels are 'tract' and 'county subdivision'.</p>
</td></tr>
<tr><td><code id="get_tongfen_us_census_+3A_survey">survey</code></td>
<td>
<p>survey to get data for, supported options is &quot;census&quot;</p>
</td></tr>
<tr><td><code id="get_tongfen_us_census_+3A_base_geo">base_geo</code></td>
<td>
<p>census year to use as base geography, default is '2010'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>sf object with (wide form) census variables with census year as suffix (separated by underdcore &quot;_&quot;).
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Get US census data on population and households for 2000 and 2010 censuses on a uniform geography
# based on census tracts.
## Not run: 
variables=c(population="H011001",households="H013001")

meta &lt;- c(2000,2010) %&gt;%
  lapply(function(year){
    v &lt;- variables %&gt;% setNames(paste0(names(.),"_",year))
    meta_for_additive_variables(paste0("dec",year),v)
  }) %&gt;%
  bind_rows()
census_data &lt;- get_tongfen_us_census(regions = list(state="CA"), meta=meta, level="tract") %&gt;%
  mutate(change=population_2010/households_2010-population_2000/households_2000)


## End(Not run)
</code></pre>

<hr>
<h2 id='meta_for_additive_variables'>Generate tongfen metadata for additive variables</h2><span id='topic+meta_for_additive_variables'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
</p>
<p>Generates metadata to be used in tongfen_aggregate. Variables need to be additive like counts.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>meta_for_additive_variables(dataset, variables)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="meta_for_additive_variables_+3A_dataset">dataset</code></td>
<td>
<p>identifier for the dataset contianing the variable</p>
</td></tr>
<tr><td><code id="meta_for_additive_variables_+3A_variables">variables</code></td>
<td>
<p>(named) vecotor with additive variables</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a tibble to be used in tongfen_aggregate
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Get metadata for additive variable Population for the CA16 and CA06 datasets
## Not run: 
meta &lt;- meta_for_additive_variables(c("CA06","CA16"),"Population")

## End(Not run)
</code></pre>

<hr>
<h2 id='meta_for_ca_census_vectors'>Generate metadata from Candian census vectors</h2><span id='topic+meta_for_ca_census_vectors'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
</p>
<p>Build tibble with information on how to aggregate variables given vectors
Queries list_census_variables to obtain needed information and add in vectors needed for aggregation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>meta_for_ca_census_vectors(vectors)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="meta_for_ca_census_vectors_+3A_vectors">vectors</code></td>
<td>
<p>list of variables to query</p>
</td></tr>
</table>


<h3>Value</h3>

<p>tidy dataframe with metadata information for requested variables and additional variables
needed for tongfen operations
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Build metadata for vectors
## Not run: 
meta &lt;- meta_for_ca_census_vectors("v_CA16_4836","v_CA16_4838","v_CA16_4899")

## End(Not run)
</code></pre>

<hr>
<h2 id='proportional_reaggregate'>Dasymetric downsampling</h2><span id='topic+proportional_reaggregate'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
</p>
<p>Proportionally re-aggregate hierarchical data to lower-level w.r.t. values of the *base* variable
Also handles cases where lower level data may be available but blinded at times by filling in data from higher level
</p>
<p>Data at lower aggregation levels may not add up to the more accurate aggregate counts.
This function distributes the aggregate level counts proportionally (by population) to the containing lower
level geographic regions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>proportional_reaggregate(
  data,
  parent_data,
  geo_match,
  categories,
  base = "Population"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="proportional_reaggregate_+3A_data">data</code></td>
<td>
<p>The base geographic data</p>
</td></tr>
<tr><td><code id="proportional_reaggregate_+3A_parent_data">parent_data</code></td>
<td>
<p>Higher level geographic data</p>
</td></tr>
<tr><td><code id="proportional_reaggregate_+3A_geo_match">geo_match</code></td>
<td>
<p>A named string informing on what column names to match data and parent_data</p>
</td></tr>
<tr><td><code id="proportional_reaggregate_+3A_categories">categories</code></td>
<td>
<p>Vector of column names to re-aggregate</p>
</td></tr>
<tr><td><code id="proportional_reaggregate_+3A_base">base</code></td>
<td>
<p>Column name to use for proportional weighting when re-aggregating</p>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe with downsampled variables from parent_data
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Proportionally reaggregate visible minority data from dissemination area 2016
# census data to dissemination block geography, proportionally based on dissemination
# block population
## Not run: 
regions &lt;- list(CSD="5915022")
variables &lt;- cancensus::child_census_vectors("v_CA16_3954")

da_data &lt;- cancensus::get_census("CA16",regions=regions,
                                 vectors=setNames(variables$vector,variables$label),
                                 level="DA")
geo_data &lt;- cancensus::get_census("CA16",regions=regions,geo_format="sf",level="DB")

db_data &lt;- geo_data %&gt;% proportional_reaggregate(da_data,c("DA_UID"="GeoUID"),variables$label)


## End(Not run)
</code></pre>

<hr>
<h2 id='tongfen_aggregate'>Perform tongfen according to correspondence</h2><span id='topic+tongfen_aggregate'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
</p>
<p>Aggregate variables secified in meta for several datasets according to correspondence.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tongfen_aggregate(data, correspondence, meta = NULL, base_geo = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tongfen_aggregate_+3A_data">data</code></td>
<td>
<p>list of datasets to be aggregated</p>
</td></tr>
<tr><td><code id="tongfen_aggregate_+3A_correspondence">correspondence</code></td>
<td>
<p>correspondence data for gluing up the datasets</p>
</td></tr>
<tr><td><code id="tongfen_aggregate_+3A_meta">meta</code></td>
<td>
<p>metadata containing aggregation rules as for example returned by 'meta_for_ca_census_vectors'</p>
</td></tr>
<tr><td><code id="tongfen_aggregate_+3A_base_geo">base_geo</code></td>
<td>
<p>identifier for which data element to base the final geography on,
uses the first data element if  'NULL' (default),
expects that 'base_geo' is an element of 'names(data)'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>aggregated dataset of class sf if base_geo is not NULL and data is of type sf or tibble otherwise.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># aggregate census tract level 2006 population data on common gepgraphy build through
# correspondence from 2006 and 2016 census tracts in the City of Vancouver.
## Not run: 
regions &lt;- list(CSD="5915022")
geo1 &lt;- cancensus::get_census("CA06",regions=regions,geo_format='sf',level='CT')
geo2 &lt;- cancensus::get_census("CA16",regions=regions,geo_format='sf',level='CT')
meta &lt;- meta_for_additive_variables("CA06","Population")
correspondence &lt;- get_tongfen_correspondence_ca_census(geo_datasets=c('CA06','CA16'),
                                                       regions=regions,level='CT')
result &lt;- tongfen_aggregate(list(geo1 %&gt;% rename(GeoUIDCA06=GeoUID),
                                 geo2 %&gt;% rename(GeoUIDCA16=GeoUID)),correspondence,meta)

## End(Not run)
</code></pre>

<hr>
<h2 id='tongfen_ca_census_ct'>Canadian census CT level tongfen via identifier matching</h2><span id='topic+tongfen_ca_census_ct'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>
<p>Aggregate variables to common CTs, returns data2 on new tiling matching data1 geography
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tongfen_ca_census_ct(
  data1,
  data2,
  data2_sum_vars,
  data2_group_vars = c(),
  na.rm = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tongfen_ca_census_ct_+3A_data1">data1</code></td>
<td>
<p>cancensus CT level datatset for year1 &lt; year2 to serve as base for common geography</p>
</td></tr>
<tr><td><code id="tongfen_ca_census_ct_+3A_data2">data2</code></td>
<td>
<p>cancensus CT level datatset for year2 to be aggregated to common geography</p>
</td></tr>
<tr><td><code id="tongfen_ca_census_ct_+3A_data2_sum_vars">data2_sum_vars</code></td>
<td>
<p>vector of variable names to by summed up when aggregating geographies</p>
</td></tr>
<tr><td><code id="tongfen_ca_census_ct_+3A_data2_group_vars">data2_group_vars</code></td>
<td>
<p>optional vector of grouping variables</p>
</td></tr>
<tr><td><code id="tongfen_ca_census_ct_+3A_na.rm">na.rm</code></td>
<td>
<p>optional parameter to remove NA values when summing, default = 'TRUE'</p>
</td></tr>
</table>

<hr>
<h2 id='tongfen_estimate'>Estimate variable values for custom geography</h2><span id='topic+tongfen_estimate'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
</p>
<p>Estimates data from source geometry onto target geometry
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tongfen_estimate(target, source, meta, na.rm = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tongfen_estimate_+3A_target">target</code></td>
<td>
<p>custom geography to estimate values for</p>
</td></tr>
<tr><td><code id="tongfen_estimate_+3A_source">source</code></td>
<td>
<p>input geography with values</p>
</td></tr>
<tr><td><code id="tongfen_estimate_+3A_meta">meta</code></td>
<td>
<p>metadata for variable aggregation</p>
</td></tr>
<tr><td><code id="tongfen_estimate_+3A_na.rm">na.rm</code></td>
<td>
<p>remove NA values when aggregating, default is FALSE</p>
</td></tr>
</table>


<h3>Value</h3>

<p>'target' with estimated quantities from 'source' as specified by 'meta'
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Estimate 2006 Populatino in the City of Vancouver dissemination ares on 2016 census geoographies
## Not run: 
geo1 &lt;- cancensus::get_census("CA06",regions=list(CSD="5915022"),geo_format='sf',level='DA')
geo2 &lt;- cancensus::get_census("CA16",regions=list(CSD="5915022"),geo_format='sf',level='DA')
meta &lt;- meta_for_additive_variables("CA06","Population")
result &lt;- tongfen_estimate(geo2 %&gt;% rename(Population_2016=Population),geo1,meta)

## End(Not run)
</code></pre>

<hr>
<h2 id='tongfen_estimate_ca_census'>Tongfen estimate data for given geometry</h2><span id='topic+tongfen_estimate_ca_census'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
</p>
<p>Estimates values for the given census vectors for the given geometry using
data from the specified level range
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tongfen_estimate_ca_census(
  geometry,
  meta,
  level,
  intersection_level = level,
  downsample_level = NULL,
  na.rm = FALSE,
  quiet = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tongfen_estimate_ca_census_+3A_geometry">geometry</code></td>
<td>
<p>geometry</p>
</td></tr>
<tr><td><code id="tongfen_estimate_ca_census_+3A_meta">meta</code></td>
<td>
<p>metadata for the census variables to aggregate, for example as returned by 'meta_for_ca_census_vectors'.
At this point this function only accepts variables from the same census geography year. We will expand this to also
allow estimates across multiple census geography years, but this requires further attention to detail. It is
recommended to apply due caution when running this function separately across several census geography years with
the purpose of comparing data across time as a naive application can lead to systematic biases.</p>
</td></tr>
<tr><td><code id="tongfen_estimate_ca_census_+3A_level">level</code></td>
<td>
<p>level to use for tongfen</p>
</td></tr>
<tr><td><code id="tongfen_estimate_ca_census_+3A_intersection_level">intersection_level</code></td>
<td>
<p>level to use for geometry intersection, if different from tongfen level
by <code>meta_for_ca_census_vectors</code>. This can be set at a higher aggregation level to conserve API points
for the 'get_intersecting_geometries' call.</p>
</td></tr>
<tr><td><code id="tongfen_estimate_ca_census_+3A_downsample_level">downsample_level</code></td>
<td>
<p>default 'NULL', can be a geographic level lower than 'level', in which case the data is downsamples
to that geography level proportionally using the value of the 'downsample' column (must be supplied) in the 'meta'
argument before intersecting the geometries. This can lead to more accurate results. At this point the only allowed
variables for the 'downsample' column in 'meta' are &quot;Population&quot;, &quot;Households&quot; or &quot;Dwellings&quot;, and it can only be
one of these for all variables.</p>
</td></tr>
<tr><td><code id="tongfen_estimate_ca_census_+3A_na.rm">na.rm</code></td>
<td>
<p>how to deal with NA values, default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="tongfen_estimate_ca_census_+3A_quiet">quiet</code></td>
<td>
<p>suppress progress messages</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'># Estimate a common geography for 2006 and 2016 dissemination areas in the City of Vancouver
# based on the geographic data and check estimation errors
## Not run: 
toronto_city_hall &lt;- sf::st_point(c(-79.3839,43.6534)) %&gt;%
  sf::st_sfc(crs=4326) %&gt;%
  sf::st_transform(3348) %&gt;%
  sf::st_buffer(1000) %&gt;%
  sf::st_sf()

meta &lt;- meta_for_additive_variables("CA16","Population")

data &lt;- tongfen_estimate_ca_census(toronto_city_hall,meta,level="DA",intersection_level="CT")

print(paste0("Approximately ",scales::comma(data$Population,accuracy=100),
             " people live within a 1 km radius of Toronto City."))


## End(Not run)
</code></pre>

<hr>
<h2 id='tongfen_tag_largest_overlap'>Tag regions by largest overlap</h2><span id='topic+tongfen_tag_largest_overlap'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
</p>
<p>tags regions in 'source' by 'target_id' of region in 'target' with the largest overlap
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tongfen_tag_largest_overlap(source, target, target_id)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tongfen_tag_largest_overlap_+3A_source">source</code></td>
<td>
<p>input geography</p>
</td></tr>
<tr><td><code id="tongfen_tag_largest_overlap_+3A_target">target</code></td>
<td>
<p>custom geography</p>
</td></tr>
<tr><td><code id="tongfen_tag_largest_overlap_+3A_target_id">target_id</code></td>
<td>
<p>name of the column in 'target' table with unique id (character)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>'source' with extra column with name '&quot;target_id&quot;' and column '...overlap_fraction' with
the proportion of overlap of the target geometry with the respective 'target_id'
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Estimate 2006 Populatino in the City of Vancouver dissemination ares on 2016 census geoographies
## Not run: 
geo1 &lt;- cancensus::get_census("CA06",regions=list(CSD="5915022"),geo_format='sf',level='DA')
geo2 &lt;- cancensus::get_census("CA16",regions=list(CSD="5915022"),geo_format='sf',level='DA')
meta &lt;- meta_for_additive_variables("CA06","Population")
result &lt;- tongfen_estimate(geo2 %&gt;% rename(Population_2016=Population),geo1,meta)

## End(Not run)
</code></pre>

<hr>
<h2 id='vancouver_elections_data_2015'>A dataset with polling station votes data from the 2015 federal election in the Vancouver area</h2><span id='topic+vancouver_elections_data_2015'></span>

<h3>Description</h3>

<p>A dataset with polling station votes data from the 2015 federal election in the Vancouver area
</p>


<h3>Author(s)</h3>

<p>Elections Canada
</p>


<h3>References</h3>

<p><a href="https://www.elections.ca/content.aspx?section=res&amp;dir=rep/off&amp;document=index&amp;lang=e#42GE">https://www.elections.ca/content.aspx?section=res&amp;dir=rep/off&amp;document=index&amp;lang=e#42GE</a>
</p>

<hr>
<h2 id='vancouver_elections_data_2019'>A dataset with polling station votes data from the 2019 federal election in the Vancouver area</h2><span id='topic+vancouver_elections_data_2019'></span>

<h3>Description</h3>

<p>A dataset with polling station votes data from the 2019 federal election in the Vancouver area
</p>


<h3>Author(s)</h3>

<p>Elections Canada
</p>


<h3>References</h3>

<p><a href="https://www.elections.ca/content.aspx?section=res&amp;dir=rep/off&amp;document=index&amp;lang=e#43GE">https://www.elections.ca/content.aspx?section=res&amp;dir=rep/off&amp;document=index&amp;lang=e#43GE</a>
</p>

<hr>
<h2 id='vancouver_elections_geos_2015'>A dataset with polling district geographies from the 2015 federal election in the Vancouver area</h2><span id='topic+vancouver_elections_geos_2015'></span>

<h3>Description</h3>

<p>A dataset with polling district geographies from the 2015 federal election in the Vancouver area
</p>


<h3>Author(s)</h3>

<p>Elections Canada
</p>


<h3>References</h3>

<p><a href="https://www.elections.ca/content.aspx?section=res&amp;dir=rep/off&amp;document=index&amp;lang=e#42GE">https://www.elections.ca/content.aspx?section=res&amp;dir=rep/off&amp;document=index&amp;lang=e#42GE</a>
</p>

<hr>
<h2 id='vancouver_elections_geos_2019'>A dataset with polling district geographies from the 2019 federal election in the Vancouver area</h2><span id='topic+vancouver_elections_geos_2019'></span>

<h3>Description</h3>

<p>A dataset with polling district geographies from the 2019 federal election in the Vancouver area
</p>


<h3>Author(s)</h3>

<p>Elections Canada
</p>


<h3>References</h3>

<p><a href="https://www.elections.ca/content.aspx?section=res&amp;dir=rep/off&amp;document=index&amp;lang=e#43GE">https://www.elections.ca/content.aspx?section=res&amp;dir=rep/off&amp;document=index&amp;lang=e#43GE</a>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
