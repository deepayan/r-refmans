<!DOCTYPE html><html lang="en"><head><title>Help for package cctest</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {cctest}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#cctest'><p>Tests of Independence Based on Canonical Correlations</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Version:</td>
<td>1.2.1</td>
</tr>
<tr>
<td>Title:</td>
<td>Canonical Correlations and Tests of Independence</td>
</tr>
<tr>
<td>Description:</td>
<td>A simple interface for multivariate correlation analysis that unifies various classical
  statistical procedures including t-tests, tests in univariate and multivariate linear models,
  parametric and nonparametric tests for correlation, Kruskal-Wallis tests, common approximate
  versions of Wilcoxon rank-sum and signed rank tests, chi-squared tests of independence, score
  tests of particular hypotheses in generalized linear models, canonical correlation analysis and
  linear discriminant analysis.</td>
</tr>
<tr>
<td>Author:</td>
<td>Robert Schlicht [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Robert Schlicht &lt;robert.schlicht@tu-dresden.de&gt;</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://joinup.ec.europa.eu/software/page/eupl">EUPL version 1.1</a> | <a href="https://joinup.ec.europa.eu/software/page/eupl">EUPL version 1.2</a> [expanded from: EUPL (&ge; 1.1)]</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-03-06 12:19:19 UTC; Schlicht</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-03-06 13:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='cctest'>Tests of Independence Based on Canonical Correlations</h2><span id='topic+cctest'></span>

<h3>Description</h3>

<p><code>cctest</code> estimates canonical correlations between two sets of 
variables, possibly after removing effects of a third set of variables, and 
performs a classical multivariate test of (conditional) independence based 
on Pillai’s statistic.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  cctest(formula, data = NULL, df = formula[-2L], ..., tol = 1e-07)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cctest_+3A_formula">formula</code></td>
<td>
<p>A <code><a href="stats.html#topic+formula">formula</a></code> object of the form 
<code>Y ~ X ~ A</code>, where <code>Y</code> represents dependent variables, <code>X</code> 
represents a second set of dependent variables or explanatory variables 
not present under the null hypothesis, and <code>A</code> represents 
explanatory variables that remain under the null hypothesis. The 
<a href="stats.html#topic+formula">operators</a> (like <code>+</code>) and 
<a href="stats.html#topic+model.matrix">expansion</a> rules defined for the <code>model</code> 
part of a <code>formula</code> object here apply to all three parts alike. 
Typically, <code>A</code> includes at least the constant <code>1</code> to specify a 
model with intercepts; unlike <code><a href="stats.html#topic+lm">lm</a></code>, the function never 
adds this automatically.
</p>
</td></tr>
<tr><td><code id="cctest_+3A_data">data</code></td>
<td>
<p>An optional data frame, list or environment (or object 
coercible by <code><a href="base.html#topic+as.data.frame">as.data.frame</a></code> to a data frame) 
containing the variables in the model.
</p>
</td></tr>
<tr><td><code id="cctest_+3A_df">df</code></td>
<td>
<p>An optional <code><a href="stats.html#topic+formula">formula</a></code> object of the form 
<code>~ A0</code>, where <code>A0</code> is a replacement of <code>A</code> for the 
degrees of freedom computation. If not specified, this is the same as 
<code>A</code>.
</p>
</td></tr>
<tr><td><code id="cctest_+3A_...">...</code></td>
<td>
<p>Additional optional arguments passed to 
<code><a href="stats.html#topic+model.frame">model.frame</a></code>. In particular, <code>subset</code> specifies 
which rows of data to include, <code>na.action</code> how to handle missing 
values (e.g., <code><a href="stats.html#topic+na.exclude">na.exclude</a></code>), and <code>weights</code> is a 
vector of any nonnegative numbers that specify how many identical 
observations each row represents.
</p>
</td></tr>
<tr><td><code id="cctest_+3A_tol">tol</code></td>
<td>
<p>The tolerance in the QR decomposition for detecting linear 
dependencies (i.e., collinearities) of the variables.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>cctest</code> unifies various classical statistical procedures that involve 
the same underlying computations, including t-tests, tests in univariate and 
multivariate linear models, parametric and nonparametric tests for 
correlation, Kruskal&ndash;Wallis tests, common approximate versions of Wilcoxon 
rank-sum and signed rank tests, chi-squared tests of independence, score 
tests of particular hypotheses in generalized linear models, canonical 
correlation analysis and linear discriminant analysis (see Examples).
</p>
<p>Specifically, for the matrices with ranks <code class="reqn">r_{x}</code> and <code class="reqn">r_{y}</code> 
obtained from <code class="reqn">X</code> and <code class="reqn">Y</code> by subtracting from each column its 
orthogonal projection on the column space of <code class="reqn">A</code>, the function computes 
factorizations <code class="reqn">\tilde{X}U</code> and <code class="reqn">\tilde{Y}V</code> with <code class="reqn">\tilde{X}</code> and 
<code class="reqn">\tilde{Y}</code> having <code class="reqn">r_{x}</code> and <code class="reqn">r_{y}</code> columns, respectively, 
such that both <code class="reqn">\tilde{X}^\top \tilde{X}=rI</code> and 
<code class="reqn">\tilde{Y}^\top \tilde{Y}=rI</code>, and <code class="reqn">\tilde{X}^\top \tilde{Y}=rD</code> is a 
rectangular diagonal matrix with decreasing diagonal elements. The scaling 
factor <code class="reqn">r</code>, which should be nonzero, is the dimension of the orthogonal 
complement of the column space of <code class="reqn">A_{0}</code>.
</p>
<p>The function realizes this variant of the singular value decomposition by 
first computing preliminary QR factorizations of the stated form (taking 
<code class="reqn">r=1</code>) without the requirement on <code class="reqn">D</code>, and then, in a second step, 
modifying these based on a standard singular value decomposition of that 
matrix. The main work is done in a rotated coordinate system where the column 
space of <code class="reqn">A</code> aligns with the coordinate axes. The basic approach and the 
rank detection algorithm are inspired by the implementations in 
<code><a href="stats.html#topic+cancor">cancor</a></code> and in <code><a href="stats.html#topic+lm">lm</a></code>, respectively.
</p>
<p>The diagonal elements of <code class="reqn">D</code>, or singular values, are the estimated 
<em>canonical correlations</em> (Hotelling 1936) of the variables 
represented by <code class="reqn">X</code> and <code class="reqn">Y</code> if these follow a linear model 
<code class="reqn">(X\;\;Y)=A(\alpha\;\;\beta)+(\delta\;\;\epsilon)</code> with known <code class="reqn">A</code>, 
unknown <code class="reqn">(\alpha\;\;\beta)</code> and error terms <code class="reqn">(\delta\;\;\epsilon)</code> 
that have uncorrelated rows with expectation zero and an identical unknown 
covariance matrix. In the most common case, where <code>A</code> is given as a 
constant <code>1</code>, these are the sample canonical correlations (i.e., based 
on simple centering) most often presented in the literature for full column 
ranks <code class="reqn">r_{x}</code> and <code class="reqn">r_{y}</code>. They are always decreasing and between 0 
and 1.
</p>
<p>In the case of the linear model with independent normally distributed rows 
and <code class="reqn">A_{0}=A</code>, the ranks <code class="reqn">r_{x}</code> and <code class="reqn">r_{y}</code> equal, with 
probability 1, the ranks of the covariance matrices of the rows of <code class="reqn">X</code> 
and <code class="reqn">Y</code>, respectively, or <code class="reqn">r</code>, whichever is smaller. Under the 
hypothesis of independence of <code class="reqn">X</code> and <code class="reqn">Y</code>, given those ranks, the 
joint distribution of the <code class="reqn">s</code> squared singular values, where <code class="reqn">s</code> is 
the smaller of the two ranks, is then known and in the case 
<code class="reqn">r\geq r_{x}+r_{y}</code> has a probability density (Hsu 1939, Anderson 2003, 
Anderson 2007) given by
</p>
<p style="text-align: center;"><code class="reqn">\rho (t_{1},...,t_{s})\propto \prod _{i=1}^{s}t_{i}^{(\left|r_{x}-r_{y}
\right|-1)/2}(1-t_{i})^{(r-r_{x}-r_{y}-1)/2}\prod _{i&lt;j}(t_{i}-t_{j}),</code>
</p>
 
<p><code class="reqn">1\geq t_{1}\geq \cdots \geq t_{s}\geq 0</code>. For <code class="reqn">s=1</code> this reduces 
to the well-known case of a single beta distributed <code class="reqn">R^{2}</code> or 
equivalently an F distributed 
<code class="reqn">R^{2}/(r_{x}r_{y}) \over (1-R^{2})/(r-r_{x}r_{y})</code>, with the divisors in 
the numerator and denominator representing the degrees of freedom, or twice 
the parameters of the beta distribution.
</p>
<p>Pillai’s statistic is the sum of squares of the canonical correlations, which 
equals, even without the requirement on <code class="reqn">D</code>, the squared Frobenius norm 
of that matrix (or trace of <code class="reqn">D^\top D</code>). Replacing the distribution of 
that statistic divided by <code class="reqn">s</code> (i.e., of the mean of squares) with beta or 
gamma distributions with first or shape parameter <code class="reqn">r_{x}r_{y}/2</code> and 
expectation <code class="reqn">r_{x}r_{y}/(rs)</code> leads to the F and chi-squared 
approximations that the p-values returned by <code>cctest</code> are based on.
</p>
<p>The F or beta approximation (Pillai 1954, p. 99, p. 44) is usually used with 
<code class="reqn">A_{0}=A</code> and then is exact if <code class="reqn">s=1</code>. The chi-squared approximation 
represents Rao’s (1948) score test (with a test statistic that is <code class="reqn">r</code> 
times Pillai’s statistic) in the model obtained after removing (or 
conditioning on) the orthogonal projections on the column space of 
<code class="reqn">A_{0}</code> provided that is a subset of the column space of <code class="reqn">A</code>.
</p>


<h3>Value</h3>

<p>A list with class <code>htest</code> containing the following components:
</p>
<table role = "presentation">
<tr><td><code>x</code>, <code>y</code></td>
<td>
<p>matrices <code class="reqn">\tilde{X}</code> and <code class="reqn">\tilde{Y}</code> of new transformed 
variables</p>
</td></tr>
<tr><td><code>xinv</code>, <code>yinv</code></td>
<td>
<p>matrices <code class="reqn">U</code> and <code class="reqn">V</code> representing the inverse 
coordinate transformations</p>
</td></tr>
<tr><td><code>estimate</code></td>
<td>
<p>vector of canonical correlations, i.e., the 
diagonal elements of <code class="reqn">D</code></p>
</td></tr>
<tr><td><code>statistic</code></td>
<td>
<p>vector of p-values based on Pillai’s statistic and 
classical chi-squared and F approximations</p>
</td></tr>
<tr><td><code>df.residual</code></td>
<td>
<p>the number <code class="reqn">r</code></p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>the name of the function</p>
</td></tr>
<tr><td><code>data.name</code></td>
<td>
<p>a character string representation of <code>formula</code> 
(possibly shortened)</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The handling of <code>weights</code> differs from that in <code><a href="stats.html#topic+lm">lm</a></code> 
unless the nonzero weights are scaled so as to have a mean of 1. Also, to 
facilitate predictions for rows with zero weights (see Examples and the code 
marked as optional), the square roots of the weights, used internally for 
scaling the data, are always computed as nonzero numbers, even for zero 
weights, where they are so small that their square is still numerically zero 
and hence without effect on the correlation analysis. An <code>offset</code>, if 
included in <code>A</code> or <code>...</code>, is subtracted from all columns in 
<code>X</code> and <code>Y</code>.
</p>


<h3>Author(s)</h3>

<p>Robert Schlicht</p>


<h3>References</h3>

<p>Hotelling, H. (1936). Relations between two sets of variates. 
<em>Biometrika</em> 28, 321–377.
<a href="https://doi.org/10.1093/biomet/28.3-4.321">doi:10.1093/biomet/28.3-4.321</a>, <a href="https://doi.org/10.2307/2333955">doi:10.2307/2333955</a>
</p>
<p>Hsu, P.L. (1939). On the distribution of roots of certain determinantal 
equations. <em>Annals of Eugenics</em> 9, 250–258.
<a href="https://doi.org/10.1111/j.1469-1809.1939.tb02212.x">doi:10.1111/j.1469-1809.1939.tb02212.x</a>
</p>
<p>Rao, C.R. (1948). Large sample tests of statistical hypotheses 
concerning several parameters with applications to problems of estimation. 
<em>Mathematical Proceedings of the Cambridge Philosophical Society</em> 44, 
50–57.
<a href="https://doi.org/10.1017/S0305004100023987">doi:10.1017/S0305004100023987</a>
</p>
<p>Pillai, K.C.S. (1954). <em>On some distribution problems in multivariate 
analysis</em> (Institute of Statistics mimeo series 88). North Carolina State 
University, Dept. of Statistics.
</p>
<p>Anderson, T.W. (2003). <em>An introduction to multivariate statistical 
analysis</em>, 3rd edition, Ch. 12–13. Wiley.
</p>
<p>Anderson, T.W. (2007). Multiple discoveries: distribution of roots of 
determinantal equations. <em>Journal of Statistical Planning and 
Inference</em> 137, 3240–3248.
<a href="https://doi.org/10.1016/j.jspi.2007.03.008">doi:10.1016/j.jspi.2007.03.008</a>
</p>


<h3>See Also</h3>

<p>Functions <code><a href="stats.html#topic+cancor">cancor</a></code>, <code><a href="stats.html#topic+anova.mlm">anova.mlm</a></code> in 
package <code>stats</code> and implementations of canonical correlation analysis in 
other packages such as <code>CCP</code> (tests only), <code>MVar</code>, <code>candisc</code> 
(both including tests based on Wilks’ statistic), <code>yacca</code>, <code>CCA</code>, 
<code>acca</code>, <code>whitening</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Artificial observations in 5-by-5 meter quadrats in a forest for
## comparing cctest analyses with equivalent 'stats' methods:
set.seed(0)
dat &lt;- within(data.frame(row.names=1:150), {
  plot &lt;- sample(factor(c("a","b")), 150, TRUE)         # plot a or b
  x    &lt;- as.integer(runif(150,1,31) + 81*(plot=="b"))  # x position on grid
  y    &lt;- as.integer(runif(150,1,31) + 61*(plot=="b"))  # y position on grid
  ori  &lt;- sample(factor(c("E","N","S","W")), 150, TRUE) # orientation of slope
  elev &lt;- runif(150,605,645) + 5*(plot=="b")            # elevation (in meters)
  h    &lt;- rnorm(150, 125-.17*elev, 3.5)                 # tree height (in meters)
  h5   &lt;- rnorm(150, h, 2)                              # tree height 5 years earlier
  h10  &lt;- rnorm(150, h5, 2)                             # tree height 10 years earlier
  c15  &lt;- as.integer(rnorm(150, h10, 2) &gt; 20)           # 0-1 coded, 15 years earlier
  sapl &lt;- rnbinom(150, 2.6, mu=.02*elev)                # number of saplings
})
dat[1:8,]

## t-tests:
cctest(h~plot~1, dat)
  t.test(h~plot, dat, var.equal=TRUE)
  summary(lm(h~plot, dat))
cctest(I(h-20)~1~0, dat)
  t.test(dat$h, mu=20)
  t.test(h~1, dat, mu=20)
cctest(I(h-h5)~1~0, dat)
  t.test(dat$h, dat$h5, paired=TRUE)
  t.test(Pair(h,h5)~1, dat)

## Test for correlation:
cctest(h~elev~1, dat)
  cor.test(~h+elev, dat)

## One-way analysis of variance:
cctest(h~ori~1, dat)
  anova(lm(h~ori, dat))

## F-tests in linear models:
cctest(h~ori~1+elev, dat)
  anova(lm(h~1+elev, dat), lm(h~ori+elev, dat))
cctest(h~h10~0, dat, subset=1:5)
  anova(lm(h~0,dat,subset=1:5), lm(h~0+h10,dat,subset=1:5))

## Test in multivariate linear model based on Pillai's statistic:
cctest(h+h5+h10~x+y~1+elev, dat)
  anova(lm(cbind(h,h5,h10)~elev, dat),
    lm(cbind(h,h5,h10)~elev+x+y, dat))

## Test based on Spearman's rank correlation coefficient:
cctest(rank(h)~rank(elev)~1, dat)
  cor.test(~h+elev, dat, method="spearman", exact=FALSE)

## Kruskal-Wallis and Wilcoxon rank-sum tests:
cctest(rank(h)~ori~1, dat)
  kruskal.test(h~ori, dat)
cctest(rank(h)~plot~1, dat)
  wilcox.test(h~plot, dat, exact=FALSE, correct=FALSE)

## Wilcoxon signed rank test:
cctest(rank(abs(h-h5))~sign(h-h5)~0, subset(dat, h-h5 != 0))
  wilcox.test(h-h5 ~ 1, dat, exact=FALSE, correct=FALSE)

## Chi-squared test of independence:
cctest(ori~plot~1, dat, ~0)
cctest(ori~plot~1, xtabs(~ori+plot,dat), ~0, weights=Freq)
  summary(xtabs(~ori+plot, dat, drop.unused.levels=TRUE))
  chisq.test(dat$ori, dat$plot, correct=FALSE)

## Score test in logistic regression (logit model, ...~1 only):
cctest(c15~x+y~1, dat, ~0)
  anova(glm(c15~1, binomial, dat, epsilon=1e-12),
    glm(c15~1+x+y, binomial, dat), test="Rao")

## Score test in multinomial logit model (...~1 only):
cctest(ori~x+y~1, dat, ~0)
  with(list(d=dat, e=expand.grid(stringsAsFactors=FALSE,
    i=row.names(dat), j=levels(dat$ori))
  ), anova(
    glm(d[i,"ori"]==j ~ j+d[i,"x"]+d[i,"y"], poisson, e, epsilon=1e-12),
    glm(d[i,"ori"]==j ~ j*(d[i,"x"]+d[i,"y"]), poisson, e), test="Rao"
  ))

## Absolute values of (partial) correlation coefficients:
cctest(h~elev~1, dat)$est
  cor(dat$h, dat$elev)
cctest(h~elev~1+x+y, dat)$est
  cov2cor(estVar(lm(cbind(h,elev)~1+x+y, dat)))
cctest(h~x+y+elev~1, dat)$est^2
  summary(lm(h~1+x+y+elev, dat))$r.squared

## Canonical correlations:
cctest(h+h5+h10~x+y~1, dat)$est
  cancor(dat[c("x","y")],dat[c("h","h5","h10")])$cor

## Linear discriminant analysis:
with(list(
  cc = cctest(h+h5+h10~ori~1, dat, ~ori)
), cc$y / sqrt(1-cc$est^2)[col(cc$y)])[1:7,]
  #predict(MASS::lda(ori~h+h5+h10,dat))$x[1:7,]

## Correspondence analysis:
cctest(ori~plot~1, xtabs(~ori+plot,dat), ~0, weights=Freq)[1:2]
  #MASS::corresp(~plot+ori, dat, nf=2)

## Prediction in multivariate linear model:
with(list(
  cc = cctest(h+h5+h10~1+x+y~0, dat, weights=plot=="a")
), cc$x %*% diag(cc$est,ncol(cc$x),ncol(cc$y)) %*% cc$yinv)[1:7,]
  predict(lm(cbind(h,h5,h10)~1+x+y, dat, subset=plot=="a"), dat)[1:7,]

## Not run: 
## Handling of additional arguments and edge cases:
cctest(h~h10~offset(h5), dat)
  anova(lm(h~0+offset(h5), dat), lm(h~0+I(h10-h5)+offset(h5), dat))
cctest(h~x~1, dat, weights=sapl/mean(sapl[sapl!=0]))
  anova(lm(h~1, dat, weights=sapl),
    lm(h~1+x, dat, weights=sapl))
cctest(sqrt(h-17)~elev~1, dat[1:5,], na.action=na.exclude)[1:2]
  scale(resid(lm(cbind(elev,sqrt(h-17))~1, dat[1:5,],
    na.action=na.exclude)), FALSE)
cctest(ori:I(sum(Freq)/Freq)~I(0*Freq)~offset(Freq^0), xtabs(~ori,dat),
    weights=Freq^2/sum(Freq)/c(.4,.1,.2,.3), na.action=na.fail)
  chisq.test(xtabs(~ori,dat), p=c(.4,.1,.2,.3))
cctest(c15~h~1, dat,     tol=0.999*sqrt(1-cctest(h~1~0,dat)$est^2))
  summary(lm(c15~h, dat, tol=0.999*sqrt(1-cctest(h~1~0,dat)$est^2)))
cctest(c15~h~1, dat,     tol=1.001*sqrt(1-cctest(h~1~0,dat)$est^2))
  summary(lm(c15~h, dat, tol=1.001*sqrt(1-cctest(h~1~0,dat)$est^2)))
cctest(c(1)~c(0)~c(0))
  anova(lm(1~0),lm(1~0))
cctest(0~0~0, dat, na.action=na.fail)
  NaN
cctest(1~0~1, dat)
  anova(lm(h^0~1, dat), lm(h^0~0+1, dat))
cctest(1~1~0, dat)
  anova(lm(h^0~0, dat), lm(h^0~1, dat))
## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
