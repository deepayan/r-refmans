<!DOCTYPE html><html><head><title>Help for package MatchThem</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {MatchThem}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#cbind'><p>Combine <code>mimids</code> and <code>wimids</code> Objects by Columns</p></a></li>
<li><a href='#complete'><p>Extracts Multiply Imputed Datasets</p></a></li>
<li><a href='#is.mimids'><p>Checks for the <code>mimids</code> Class</p></a></li>
<li><a href='#is.mimipo'><p>Checks for the <code>mimipo</code> Class</p></a></li>
<li><a href='#is.mimira'><p>Checks for the <code>mimira</code> Class</p></a></li>
<li><a href='#is.wimids'><p>Checks for the <code>wimids</code> Class</p></a></li>
<li><a href='#matchthem'><p>Matches Multiply Imputed Datasets</p></a></li>
<li><a href='#mimids'><p>Matched Multiply Imputed Datasets</p></a></li>
<li><a href='#mimipo'><p>Multiply Imputed Pooled Outcome</p></a></li>
<li><a href='#mimira'><p>Multiply Imputed Repeated Analyses</p></a></li>
<li><a href='#osteoarthritis'><p>Data of 2,585 Participants in the Osteoarthritis Initiative (OAI) Project</p></a></li>
<li><a href='#pool'><p>Pools Estimates by Rubin's Rules</p></a></li>
<li><a href='#trim'><p>Trim Weights</p></a></li>
<li><a href='#weightthem'><p>Weights Multiply Imputed Datasets</p></a></li>
<li><a href='#wimids'><p>Weighted Multiply Imputed Datasets</p></a></li>
<li><a href='#with'><p>Evaluates an Expression in Matched or Weighted Multiply Imputed Datasets</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Matching and Weighting Multiply Imputed Datasets</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides essential tools for the pre-processing techniques of matching and weighting multiply imputed datasets. The package includes functions for matching within and across multiply imputed datasets using various methods, estimating weights for units in the imputed datasets using multiple weighting methods, calculating causal effect estimates in each matched or weighted dataset using parametric or non-parametric statistical models, and pooling the resulting estimates according to Rubin's rules (please see <a href="https://journal.r-project.org/archive/2021/RJ-2021-073/">https://journal.r-project.org/archive/2021/RJ-2021-073/</a> for more details).</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.0</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Farhad Pishgar &lt;Farhad.Pishgar@Gmail.com&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>MatchIt (&ge; 4.0.0), mice, rlang, survey, WeightIt</td>
</tr>
<tr>
<td>Suggests:</td>
<td>Amelia, cobalt (&ge; 4.0.0), R.rsp</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/FarhadPishgar/MatchThem">https://github.com/FarhadPishgar/MatchThem</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/FarhadPishgar/MatchThem/issues">https://github.com/FarhadPishgar/MatchThem/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>R.rsp</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Author:</td>
<td>Farhad Pishgar [aut, cre],
  Noah Greifer [aut],
  Clémence Leyrat [ctb],
  Elizabeth Stuart [ctb]</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-06-14 23:34:29 UTC; farhadpishgar</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-06-14 23:52:07 UTC</td>
</tr>
</table>
<hr>
<h2 id='cbind'>Combine <code>mimids</code> and <code>wimids</code> Objects by Columns</h2><span id='topic+cbind'></span><span id='topic+cbind.mimids'></span><span id='topic+cbind.wimids'></span>

<h3>Description</h3>

<p>This function combines a <code>mimids</code> or <code>wimids</code> object columnwise with additional datasets or variables. Typically these would be variables not included in the original multiple imputation and therefore absent in the <code>mimids</code> or <code>wimids</code> object. <code>with()</code> can then be used on the output to run models with the added variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cbind(..., deparse.level = 1)

## S3 method for class 'mimids'
cbind(..., deparse.level = 1)

## S3 method for class 'wimids'
cbind(..., deparse.level = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cbind_+3A_...">...</code></td>
<td>
<p>Objects to combine columnwise. The first argument should be a <code>mimids</code> or <code>wimids</code> object. Additional <code>data.frame</code>s, <code>matrix</code>es, <code>factor</code>s, or <code>vector</code>s can be supplied. These can be given as named arguments.</p>
</td></tr>
<tr><td><code id="cbind_+3A_deparse.level">deparse.level</code></td>
<td>
<p>Ignored.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object with the same class as the first input object with the additional datasets or variables added to the components.
</p>


<h3>Author(s)</h3>

<p>Farhad Pishgar and Noah Greifer
</p>


<h3>See Also</h3>

<p><code><a href="#topic+cbind">cbind</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Loading libraries
library(MatchThem)
library(survey)

#Loading the dataset
data(osteoarthritis)

#Multiply imputing the missing values
imputed.datasets &lt;- mice::mice(osteoarthritis, m = 5)

#Weighting the multiply imputed datasets
weighted.datasets &lt;- weightthem(OSP ~ AGE + SEX + BMI + RAC + SMK,
                                imputed.datasets,
                                approach = 'within')

#Adding additional variables
weighted.datasets &lt;- cbind(weighted.datasets,
                           logAGE = log(osteoarthritis$AGE))

#Using the additional variables in an analysis
models &lt;- with(weighted.datasets,
               svyglm(KOA ~ OSP + logAGE, family = quasibinomial))

#Pooling results obtained from analyzing the datasets
results &lt;- pool(models)
summary(results)
</code></pre>

<hr>
<h2 id='complete'>Extracts Multiply Imputed Datasets</h2><span id='topic+complete'></span><span id='topic+complete.mimids'></span><span id='topic+complete.wimids'></span>

<h3>Description</h3>

<p><code>complete()</code> function extracts data from an object of the <code>mimids</code> or <code>wimids</code> class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mimids'
complete(data, action = 1, include = FALSE, mild = FALSE, all = TRUE, ...)

## S3 method for class 'wimids'
complete(data, action = 1, include = FALSE, mild = FALSE, all = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="complete_+3A_data">data</code></td>
<td>
<p>A <code>mimids</code> or <code>wimids</code> object.</p>
</td></tr>
<tr><td><code id="complete_+3A_action">action</code></td>
<td>
<p>The imputed dataset number, intended to extract its data, or an action. The input must be a positive integer or a keyword. The keywords include <code>"all"</code> (produces a <code>mild</code> object of the multiply imputed datasets), <code>"long"</code> (produces a dataset with multiply imputed datasets stacked vertically), and <code>"broad"</code> (produces a dataset with multiply imputed datasets stacked horizontally). The default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="complete_+3A_include">include</code></td>
<td>
<p>Whether the original data with the missing values should be included. The input must be a logical value. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="complete_+3A_mild">mild</code></td>
<td>
<p>Whether the return value should be an object of <code>mild</code> class. Please note that setting <code>mild = TRUE</code> overrides <code>action</code> keywords of <code>"long"</code>, <code>"broad"</code>, and <code>"repeated"</code>. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="complete_+3A_all">all</code></td>
<td>
<p>Whether to include observations with a zero estimated weight. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="complete_+3A_...">...</code></td>
<td>
<p>Ignored.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>complete()</code> works by running <code><a href="mice.html#topic+complete">mice::complete()</a></code> on the <code>mids</code> object stored within the <code>mimids</code> or <code>wimids</code> object and appending the outputs of the matching or weighting procedure. For <code>mimids</code> objects, the appended outputs include the matching weights, the propensity score (if included), pair membership (if included), and whether each unit was discarded. For <code>wimids</code> objects, the appended output is the estimated weights.
</p>


<h3>Value</h3>

<p>This function returns the imputed dataset within the supplied <code>mimids</code> or <code>wimids</code> objects.
</p>


<h3>References</h3>

<p>Stef van Buuren and Karin Groothuis-Oudshoorn (2011). <code>mice</code>: Multivariate Imputation by Chained Equations in <code>R</code>. <em>Journal of Statistical Software</em>, 45(3): 1-67. <a href="https://doi.org/10.18637/jss.v045.i03">doi:10.18637/jss.v045.i03</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mimids">mimids</a></code>
</p>
<p><code><a href="#topic+wimids">wimids</a></code>
</p>
<p><code><a href="mice.html#topic+complete">mice::complete</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Loading libraries
library(MatchThem)

#Loading the dataset
data(osteoarthritis)

#Multiply imputing the missing values
imputed.datasets &lt;- mice::mice(osteoarthritis, m = 5)

#Matching the multiply imputed datasets
matched.datasets &lt;- matchthem(OSP ~ AGE + SEX + BMI + RAC + SMK,
                              imputed.datasets,
                              approach = 'within',
                              method = 'nearest')

#Extracting the first imputed dataset
matched.dataset.1 &lt;- complete(matched.datasets, n = 1)
</code></pre>

<hr>
<h2 id='is.mimids'>Checks for the <code>mimids</code> Class</h2><span id='topic+is.mimids'></span>

<h3>Description</h3>

<p><code>is.mimids()</code> function checks whether class of objects is <code>mimids</code> or not.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.mimids(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is.mimids_+3A_object">object</code></td>
<td>
<p>This argument specifies the object that should be checked to see if it is of the <code>mimids</code> class or not.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The class of objects is checked to be of the <code>mimids</code>.
</p>


<h3>Value</h3>

<p>This function returns a logical value indicating whether <code>object</code> is of the <code>mimids</code> class.
</p>


<h3>Author(s)</h3>

<p>Farhad Pishgar
</p>


<h3>See Also</h3>

<p><code><a href="#topic+matchthem">matchthem</a></code>
</p>
<p><code><a href="#topic+mimids">mimids</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Loading libraries
library(MatchThem)

#Loading the dataset
data(osteoarthritis)

#Multiply imputing the missing values
imputed.datasets &lt;- mice::mice(osteoarthritis, m = 5)

#Matching the multiply imputed datasets
matched.datasets &lt;- matchthem(OSP ~ AGE + SEX + BMI + RAC + SMK,
                              imputed.datasets,
                              approach = 'within',
                              method = 'nearest')

#Checking the 'matched.datasets' object
is.mimids(matched.datasets)
is(matched.datasets)
</code></pre>

<hr>
<h2 id='is.mimipo'>Checks for the <code>mimipo</code> Class</h2><span id='topic+is.mimipo'></span>

<h3>Description</h3>

<p><code>is.mimipo()</code> function checks whether class of objects is <code>mimipo</code> or not.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.mimipo(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is.mimipo_+3A_object">object</code></td>
<td>
<p>This argument specifies the object that should be checked to see if it is of the <code>mimipo</code> class or not.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The class of objects is checked to be of the <code>mimipo</code>.
</p>


<h3>Value</h3>

<p>This function returns a logical value indicating whether <code>object</code> is of the <code>mimipo</code> class.
</p>


<h3>Author(s)</h3>

<p>Farhad Pishgar
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pool">pool</a></code>
</p>
<p><code><a href="#topic+mimipo">mimipo</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Loading libraries
library(MatchThem)
library(survey)

#Loading the dataset
data(osteoarthritis)

#Multiply imputing the missing values
imputed.datasets &lt;- mice::mice(osteoarthritis, m = 5)

#Estimating weights of observations in the multiply imputed datasets
weighted.datasets &lt;- weightthem(OSP ~ AGE + SEX + BMI + RAC + SMK,
                                imputed.datasets,
                                approach = 'within',
                                method = 'ps',
                                estimand = "ATT")

#Analyzing the weighted datasets
models &lt;- with(data = weighted.datasets,
               exp = svyglm(KOA ~ OSP, family = binomial))

#Pooling results obtained from analysing the datasets
results &lt;- pool(models)

#Checking the 'results' object
is.mimipo(results)
is(results)
</code></pre>

<hr>
<h2 id='is.mimira'>Checks for the <code>mimira</code> Class</h2><span id='topic+is.mimira'></span>

<h3>Description</h3>

<p><code>is.mimira()</code> function checks whether class of objects is <code>mimira</code> or not.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.mimira(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is.mimira_+3A_object">object</code></td>
<td>
<p>This argument specifies the object that should be checked to see if it is of the <code>mimira</code> class or not.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The class of objects is checked to be of the <code>mimira</code>.
</p>


<h3>Value</h3>

<p>This function returns a logical value indicating whether <code>object</code> is of the <code>mimira</code> class.
</p>


<h3>Author(s)</h3>

<p>Farhad Pishgar
</p>


<h3>See Also</h3>

<p><code><a href="#topic+with">with</a></code>
</p>
<p><code><a href="#topic+mimira">mimira</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Loading libraries
library(MatchThem)
library(survey)

#Loading the dataset
data(osteoarthritis)

#Multiply imputing the missing values
imputed.datasets &lt;- mice::mice(osteoarthritis, m = 5)

#Estimating weights of observations in the multiply imputed datasets
weighted.datasets &lt;- weightthem(OSP ~ AGE + SEX + BMI + RAC + SMK,
                                imputed.datasets,
                                approach = 'within',
                                method = 'ps',
                                estimand = "ATT")

#Analyzing the weighted datasets
models &lt;- with(data = weighted.datasets,
               exp = svyglm(KOA ~ OSP, family = binomial))

#Checking the 'models' object
is.mimira(models)
is(models)
</code></pre>

<hr>
<h2 id='is.wimids'>Checks for the <code>wimids</code> Class</h2><span id='topic+is.wimids'></span>

<h3>Description</h3>

<p><code>is.wimids()</code> function checks whether class of objects is <code>wimids</code> or not.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.wimids(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is.wimids_+3A_object">object</code></td>
<td>
<p>This argument specifies the object that should be checked to see if it is of the <code>wimids</code> class or not.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The class of objects is checked to be of the <code>wimids</code>.
</p>


<h3>Value</h3>

<p>This function returns a logical value indicating whether <code>object</code> is of the <code>wimids</code> class.
</p>


<h3>Author(s)</h3>

<p>Farhad Pishgar
</p>


<h3>See Also</h3>

<p><code><a href="#topic+weightthem">weightthem</a></code>
</p>
<p><code><a href="#topic+wimids">wimids</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Loading libraries
library(MatchThem)

#Loading the dataset
data(osteoarthritis)

#Multiply imputing the missing values
imputed.datasets &lt;- mice::mice(osteoarthritis, m = 5)

#Estimating weights of observations in the multiply imputed datasets
weighted.datasets &lt;- weightthem(OSP ~ AGE + SEX + BMI + RAC + SMK,
                                imputed.datasets,
                                approach = 'within',
                                method = 'ps',
                                estimand = "ATT")

#Checking the 'weighted.datasets' object
is.wimids(weighted.datasets)
is(weighted.datasets)
</code></pre>

<hr>
<h2 id='matchthem'>Matches Multiply Imputed Datasets</h2><span id='topic+matchthem'></span>

<h3>Description</h3>

<p><code>matchthem()</code> performs matching in the supplied multiply imputed datasets, given as <code>mids</code> or <code>amelia</code> objects, by running <code><a href="MatchIt.html#topic+matchit">MatchIt::matchit()</a></code> on each of the multiply imputed datasets with the supplied arguments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>matchthem(
  formula,
  datasets,
  approach = "within",
  method = "nearest",
  distance = "glm",
  link = "logit",
  distance.options = list(),
  discard = "none",
  reestimate = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="matchthem_+3A_formula">formula</code></td>
<td>
<p>A <code>formula</code> of the form <code>z ~ x1 + x2</code>, where <code>z</code> is the exposure and <code>x1</code> and <code>x2</code> are the covariates to be balanced, which is passed directly to <code><a href="MatchIt.html#topic+matchit">MatchIt::matchit()</a></code> to specify the propensity score model or treatment and covariates to be used in matching. See <code><a href="MatchIt.html#topic+matchit">matchit()</a></code> for details.</p>
</td></tr>
<tr><td><code id="matchthem_+3A_datasets">datasets</code></td>
<td>
<p>This argument specifies the datasets containing the exposure and the potential confounders called in the <code>formula</code>. This argument must be an object of the <code>mids</code> or <code>amelia</code> class, which is typically produced by a previous call to <code>mice()</code> function from the <span class="pkg">mice</span> package or to <code>amelia()</code> function from the <span class="pkg">Amelia</span> package (the <span class="pkg">Amelia</span> package is designed to impute missing data in a single cross-sectional dataset or in a time-series dataset, currently, the <span class="pkg">MatchThem</span> package only supports the former datasets).</p>
</td></tr>
<tr><td><code id="matchthem_+3A_approach">approach</code></td>
<td>
<p>The approach that should be used to combine information in multiply imputed datasets. Currently, <code>"within"</code> (performing matching within each dataset) and <code>"across"</code> (estimating propensity scores within each dataset, averaging them across datasets, and performing matching using the averaged propensity scores in each dataset) approaches are available. The default is <code>"within"</code>, which has been shown to have superior performance in most cases.</p>
</td></tr>
<tr><td><code id="matchthem_+3A_method">method</code></td>
<td>
<p>This argument specifies a matching method. Currently, <code>"nearest"</code> (nearest neighbor matching), <code>"exact"</code> (exact matching), <code>"full"</code> (optimal full matching), <code>"genetic"</code> (genetic matching), <code>"subclass"</code> (subclassication), <code>"cem"</code> (coarsened exact matching), <code>"optimal"</code> (optimal pair matching), <code>"quick"</code> (generalized full matching), and <code>("cardinality")</code> (cardinality and profile matching) methods are available. Only methods that produce a propensity score (<code>"nearest"</code>, <code>"full"</code>, <code>"genetic"</code>, <code>"subclass"</code>, <code>"optimal"</code>, and <code>"quick"</code>) are compatible with the <code>"across"</code> approach. The default is <code>"nearest"</code> for nearest neighbor matching. See <code><a href="MatchIt.html#topic+matchit">matchit()</a></code> for details.</p>
</td></tr>
<tr><td><code id="matchthem_+3A_distance">distance</code></td>
<td>
<p>The method used to estimate the distance measure (e.g., propensity scores) used in matching, if any. Only options that specify a method of estimating propensity scores (i.e., not <code>"mahalanobis"</code>) are compatible with the <code>"across"</code> approach. The default is <code>"glm"</code> for estimating propensity scores using logistic regression. See <code><a href="MatchIt.html#topic+matchit">matchit()</a></code> and <code><a href="MatchIt.html#topic+distance">distance</a></code> for details and allowable options.</p>
</td></tr>
<tr><td><code id="matchthem_+3A_link">link</code>, <code id="matchthem_+3A_distance.options">distance.options</code>, <code id="matchthem_+3A_discard">discard</code>, <code id="matchthem_+3A_reestimate">reestimate</code></td>
<td>
<p>Arguments passed to <code><a href="MatchIt.html#topic+matchit">matchit()</a></code> to control estimation of the distance measure (e.g., propensity scores).</p>
</td></tr>
<tr><td><code id="matchthem_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="MatchIt.html#topic+matchit">matchit()</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If an <code>amelia</code> object is supplied to <code>datasets</code>, it will be transformed into a <code>mids</code> object for further use. <code>matchthem()</code> works by calling <code><a href="mice.html#topic+complete">mice::complete()</a></code> on the <code>mids</code> object to extract a complete dataset, and then calls <code><a href="MatchIt.html#topic+matchit">MatchIt::matchit()</a></code> on each one, storing the output of each <code>matchit()</code> call and the <code>mids</code> in the output. All arguments supplied to <code>matchthem()</code> except <code>datasets</code> and <code>approach</code> are passed directly to <code>matchit()</code>. With the <code>"across"</code> approach, the estimated propensity scores are averaged across multiply imputed datasets and re-supplied to another set of calls to <code>matchit()</code>.
</p>


<h3>Value</h3>

<p>An object of the <code><a href="#topic+mimids">mimids</a></code> (matched multiply imputed datasets) class, which includes the supplied <code>mids</code> object (or an <code>amelia</code> object transformed into a <code>mids</code> object if supplied) and the output of the calls to <code>matchit()</code> on each multiply imputed dataset.
</p>


<h3>Author(s)</h3>

<p>Farhad Pishgar and Noah Greifer
</p>


<h3>References</h3>

<p>Daniel Ho, Kosuke Imai, Gary King, and Elizabeth Stuart (2007). Matching as Nonparametric Preprocessing for Reducing Model Dependence in Parametric Causal Inference. <em>Political Analysis</em>, 15(3): 199-236. <a href="https://gking.harvard.edu/files/abs/matchp-abs.shtml">https://gking.harvard.edu/files/abs/matchp-abs.shtml</a>
</p>
<p>Stef van Buuren and Karin Groothuis-Oudshoorn (2011). <code>mice</code>: Multivariate Imputation by Chained Equations in <code>R</code>. <em>Journal of Statistical Software</em>, 45(3): 1-67. <a href="https://doi.org/10.18637/jss.v045.i03">doi:10.18637/jss.v045.i03</a>
</p>
<p>Gary King, James Honaker, Anne Joseph, and Kenneth Scheve (2001). Analyzing Incomplete Political Science Data: An Alternative Algorithm for Multiple Imputation. <em>American Political Science Review</em>, 95: 49–69. <a href="https://gking.harvard.edu/files/abs/evil-abs.shtml">https://gking.harvard.edu/files/abs/evil-abs.shtml</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mimids">mimids</a></code>
</p>
<p><code><a href="#topic+with">with</a></code>
</p>
<p><code><a href="#topic+pool">pool</a></code>
</p>
<p><code><a href="#topic+weightthem">weightthem</a></code>
</p>
<p><code><a href="MatchIt.html#topic+matchit">MatchIt::matchit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#1

#Loading libraries
library(MatchThem)

#Loading the dataset
data(osteoarthritis)

#Multiply imputing the missing values
imputed.datasets &lt;- mice::mice(osteoarthritis, m = 5)

#Matching the multiply imputed datasets
matched.datasets &lt;- matchthem(OSP ~ AGE + SEX + BMI + RAC + SMK,
                              imputed.datasets,
                              approach = 'within',
                              method = 'nearest')

#2

#Loading libraries
library(MatchThem)

#Loading the dataset
data(osteoarthritis)

#Multiply imputing the missing values
imputed.datasets &lt;- Amelia::amelia(osteoarthritis, m = 5,
                                   noms = c("SEX", "RAC", "SMK", "OSP", "KOA"))

#Matching the multiply imputed datasets
matched.datasets &lt;- matchthem(OSP ~ AGE + SEX + BMI + RAC + SMK,
                              imputed.datasets,
                              approach = 'across',
                              method = 'nearest')
</code></pre>

<hr>
<h2 id='mimids'>Matched Multiply Imputed Datasets</h2><span id='topic+mimids'></span>

<h3>Description</h3>

<p><code>mimids</code> object contains data of matched multiply imputed datasets. <code>mimids</code> objects are generated by calls to <code>matchthem()</code>.
</p>


<h3>Details</h3>

<p><code>mimids</code> objects have methods for <code>print()</code>, <code>summary()</code>, <code>plot()</code>, and <code><a href="#topic+cbind.mimids">cbind()</a></code>.
</p>


<h3>Note</h3>

<p>The <span class="pkg">MatchThem</span> package does not use the S4 class definitions and instead relies on the S3 list equivalents.
</p>


<h3>Author(s)</h3>

<p>Farhad Pishgar
</p>


<h3>References</h3>

<p>Stef van Buuren and Karin Groothuis-Oudshoorn (2011). <code>mice</code>: Multivariate Imputation by Chained Equations in <code>R</code>. <em>Journal of Statistical Software</em>, 45(3): 1-67. <a href="https://doi.org/10.18637/jss.v045.i03">doi:10.18637/jss.v045.i03</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+matchthem">matchthem</a></code>
</p>

<hr>
<h2 id='mimipo'>Multiply Imputed Pooled Outcome</h2><span id='topic+mimipo'></span>

<h3>Description</h3>

<p><code>mimipo</code> object contains data of multiply imputed pooled outcome. <code>mimipo</code> objects are generated by calls to <code>pool()</code>.
</p>


<h3>Details</h3>

<p><code>mimipo</code> objects has methods for the <code>print()</code> and <code>summary()</code> functions (please see <span class="pkg">mice</span> package reference manual for details).
</p>


<h3>Note</h3>

<p>The <span class="pkg">MatchThem</span> package does not use the S4 class definitions and instead relies on the S3 list equivalents.
</p>


<h3>Author(s)</h3>

<p>Farhad Pishgar
</p>


<h3>References</h3>

<p>Stef van Buuren and Karin Groothuis-Oudshoorn (2011). <code>mice</code>: Multivariate Imputation by Chained Equations in <code>R</code>. <em>Journal of Statistical Software</em>, 45(3): 1-67. <a href="https://doi.org/10.18637/jss.v045.i03">doi:10.18637/jss.v045.i03</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pool">pool</a></code>
</p>

<hr>
<h2 id='mimira'>Multiply Imputed Repeated Analyses</h2><span id='topic+mimira'></span>

<h3>Description</h3>

<p><code>mimira</code> object contains data of multiply imputed repeated analyses. <code>mimira</code> objects are generated by calls to <code>with()</code>.
</p>


<h3>Details</h3>

<p><code>mimira</code> objects has methods for the <code>print()</code> and <code>summary()</code> functions (please see <span class="pkg">mice</span> package reference manual for details).
</p>


<h3>Note</h3>

<p>The <span class="pkg">MatchThem</span> package does not use the S4 class definitions and instead relies on the S3 list equivalents.
</p>


<h3>Author(s)</h3>

<p>Farhad Pishgar
</p>


<h3>References</h3>

<p>Stef van Buuren and Karin Groothuis-Oudshoorn (2011). <code>mice</code>: Multivariate Imputation by Chained Equations in <code>R</code>. <em>Journal of Statistical Software</em>, 45(3): 1-67. <a href="https://doi.org/10.18637/jss.v045.i03">doi:10.18637/jss.v045.i03</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+with">with</a></code>
</p>

<hr>
<h2 id='osteoarthritis'>Data of 2,585 Participants in the Osteoarthritis Initiative (OAI) Project</h2><span id='topic+osteoarthritis'></span>

<h3>Description</h3>

<p><code>osteoarthritis</code> includes demographic data of 2,585 units (individuals) with or at risk of knee osteoarthritis. The recorded data has missing values in body mass index (<code>BMI</code>, a quantitative variable), race (<code>RAC</code>, a categorical qualitative variable), smoking status (<code>SMK</code>, a binary qualitative variable), and knee osteoarthritis status at follow-up (<code>KOA</code>, a binary qualitative variable).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>osteoarthritis
</code></pre>


<h3>Format</h3>

<p>This dataset contains 2,585 rows and 7 columns. Each row presents data of an unit (individual) and each column presents data of a characteristic of that unit. The columns are:
</p>

<dl>
<dt>AGE</dt><dd><p>Age of each unit (individual);</p>
</dd>
<dt>SEX</dt><dd><p>Gender of each unit (individual), coded as <code>0</code> (female) and <code>1</code> (male);</p>
</dd>
<dt>BMI</dt><dd><p>Estimated body mass index of each unit (individual);</p>
</dd>
<dt>RAC</dt><dd><p>Race of each unit (individual), coded as <code>0</code> (other), <code>1</code> (Caucasian), <code>2</code> (African American), and <code>3</code> (Asian);</p>
</dd>
<dt>SMK</dt><dd><p>The smoking status of each unit (individual), coded as <code>0</code> (non-smoker) and <code>1</code> (smoker);</p>
</dd>
<dt>OSP</dt><dd><p>Osteoporosis status of each unit (individual) at baseline, coded as <code>0</code> (negative) and <code>1</code> (positive); and</p>
</dd>
<dt>KOA</dt><dd><p>Knee osteoarthritis status of each unit (individual) in the follow-up, coded as <code>0</code> (at risk) and <code>1</code> (diagnosed).</p>
</dd>
</dl>



<h3>Source</h3>

<p>The information presented in the <code>osteoarthritis</code> dataset is based on the publicly available data of the Osteoarthritis Initiative (OAI) project (see <a href="https://nda.nih.gov/oai/">https://nda.nih.gov/oai/</a> for details), with changes.
</p>

<hr>
<h2 id='pool'>Pools Estimates by Rubin's Rules</h2><span id='topic+pool'></span>

<h3>Description</h3>

<p><code>pool()</code> pools estimates from the analyses done within each multiply imputed dataset. The typical sequence of steps to do a matching or weighting procedure on multiply imputed datasets are:
</p>

<ol>
<li><p> Multiply impute the missing values using the <code>mice()</code> function (from the <span class="pkg">mice</span> package) or the <code>amelia()</code> function (from the <span class="pkg">Amelia</span> package), resulting in a multiply imputed dataset (an object of the <code>mids</code> or <code>amelia</code> class);
</p>
</li>
<li><p> Match or weight each multiply imputed dataset using <code>matchthem()</code> or <code>weightthem()</code>, resulting in an object of the <code>mimids</code> or <code>wimids</code> class;
</p>
</li>
<li><p> Check the extent of balance of covariates in the datasets (using functions from the <span class="pkg">cobalt</span> package);
</p>
</li>
<li><p> Fit the statistical model of interest on each dataset by the <code>with()</code> function, resulting in an object of the <code>mimira</code> class; and
</p>
</li>
<li><p> Pool the estimates from each model into a single set of estimates and standard errors, resulting in an object of the <code>mimipo</code> class.
</p>
</li></ol>



<h3>Usage</h3>

<pre><code class='language-R'>pool(object, dfcom = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pool_+3A_object">object</code></td>
<td>
<p>An object of the <code>mimira</code> class (produced by a previous call to <code>with()</code>).</p>
</td></tr>
<tr><td><code id="pool_+3A_dfcom">dfcom</code></td>
<td>
<p>A positive number representing the degrees of freedom in the data analysis. The default is <code>NULL</code>, which means to extract this information from the fitted model with the lowest number of observations or the first fitted model (when that fails the parameter is set to <code>999999</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>pool()</code> function averages the estimates of the model and computes the total variance over the repeated analyses by Rubin’s rules. It calls <code><a href="mice.html#topic+pool">mice::pool()</a></code> after computing the model degrees of freedom.
</p>


<h3>Value</h3>

<p>This function returns an object from the <code>mimipo</code> class. Methods for <code>mimipo</code> objects (e.g., <code>print()</code>, <code>summary()</code>, etc.) are imported from the <span class="pkg">mice</span> package.
</p>


<h3>References</h3>

<p>Stef van Buuren and Karin Groothuis-Oudshoorn (2011). <code>mice</code>: Multivariate Imputation by Chained Equations in <code>R</code>. <em>Journal of Statistical Software</em>, 45(3): 1-67. <a href="https://doi.org/10.18637/jss.v045.i03">doi:10.18637/jss.v045.i03</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+with">with()</a></code>
</p>
<p><code><a href="mice.html#topic+pool">mice::pool()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Loading libraries
library(MatchThem)
library(survey)

#Loading the dataset
data(osteoarthritis)

#Multiply imputing the missing values
imputed.datasets &lt;- mice::mice(osteoarthritis, m = 5)

#Weighting the multiply imputed datasets
weighted.datasets &lt;- weightthem(OSP ~ AGE + SEX + BMI + RAC + SMK,
                                imputed.datasets,
                                approach = 'within',
                                method = 'ps')

#Analyzing the weighted datasets
models &lt;- with(weighted.datasets,
               svyglm(KOA ~ OSP, family = quasibinomial))

#Pooling results obtained from analyzing the datasets
results &lt;- pool(models)
summary(results)
</code></pre>

<hr>
<h2 id='trim'>Trim Weights</h2><span id='topic+trim'></span><span id='topic+trim.wimids'></span>

<h3>Description</h3>

<p>Trims (i.e., truncates) large weights by setting all weights higher than that at a given quantile to the weight at the quantile. This can be useful in controlling extreme weights, which can reduce effective sample size by enlarging the variability of the weights.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'wimids'
trim(w, at = 0, lower = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trim_+3A_w">w</code></td>
<td>
<p>A <code>wimids</code> object; the output of a call to <code><a href="#topic+weightthem">weightthem()</a></code>.</p>
</td></tr>
<tr><td><code id="trim_+3A_at">at</code></td>
<td>
<p>Either the quantile of the weights above which weights are to be trimmed (given as a single number between 0.5 and 1) or the number of weights to be trimmed (e.g., <code>at = 3</code> for the top 3 weights to be set to the 4th largest weight). The input must be a numeric value. The default is <code>0</code>.</p>
</td></tr>
<tr><td><code id="trim_+3A_lower">lower</code></td>
<td>
<p>Whether also to trim at the lower quantile (e.g., for <code>at = 0.9</code>, trimming at both the 0.1 and 0.9 quantiles, or for <code>at = 3</code>, trimming the top and bottom 3 weights). The input must be a logical value. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="trim_+3A_...">...</code></td>
<td>
<p>Ignored.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>trim.wimids()</code> works by calling <code><a href="WeightIt.html#topic+trim">WeightIt::trim()</a></code> on each <code>weightit</code> object stored in the <code>models</code> component of the <code>wimids</code> object. Because <code>trim()</code> itself is not exported from <span class="pkg">MatchThem</span>, it must be called using <code>WeightIt::trim()</code> or by attaching <span class="pkg">WeightIt</span> (i.e., running <code>library(WeightIt)</code>) before use.
</p>


<h3>Value</h3>

<p>An object from the <code>wimids</code> class, identical to the original object except with <code>trim()</code> applied to each of the <code>weightit</code> objects in the <code>models</code> component.
</p>


<h3>Author(s)</h3>

<p>Noah Greifer
</p>


<h3>See Also</h3>

<p><code><a href="WeightIt.html#topic+trim">WeightIt::trim()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Loading libraries
library(MatchThem)

#Loading the dataset
data(osteoarthritis)

#Multiply imputing the missing values
imputed.datasets &lt;- mice::mice(osteoarthritis, m = 5)

#Estimating weights of observations in the multiply imputed datasets
weighted.datasets &lt;- weightthem(OSP ~ AGE + SEX + BMI + RAC + SMK,
                                imputed.datasets,
                                approach = 'within',
                                method = 'ps',
                                estimand = "ATE")

#Trimming the top 10% of weights in each dataset
#to the 90th percentile
trimmed.datasets &lt;- trim(weighted.datasets, at = 0.9)
</code></pre>

<hr>
<h2 id='weightthem'>Weights Multiply Imputed Datasets</h2><span id='topic+weightthem'></span>

<h3>Description</h3>

<p><code>weightthem()</code> performs weighting in the supplied multiply imputed datasets, given as <code>mids</code> or <code>amelia</code> objects, by running <code><a href="WeightIt.html#topic+weightit">WeightIt::weightit()</a></code> on each of the multiply imputed datasets with the supplied arguments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>weightthem(formula, datasets, approach = "within", method = "ps", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="weightthem_+3A_formula">formula</code></td>
<td>
<p>A <code>formula</code> of the form <code>z ~ x1 + x2</code>, where <code>z</code> is the exposure and <code>x1</code> and <code>x2</code> are the covariates to be balanced, which is passed directly to <code><a href="WeightIt.html#topic+weightit">WeightIt::weightit()</a></code> to specify the propensity score model or treatment and covariates to be used to estimate the weights. See <code><a href="WeightIt.html#topic+weightit">weightit()</a></code> for details.</p>
</td></tr>
<tr><td><code id="weightthem_+3A_datasets">datasets</code></td>
<td>
<p>The datasets containing the exposure and covariates mentioned in the <code>formula</code>. This argument must be an object of the <code>mids</code> or <code>amelia</code> class, which is typically produced by a previous call to <code>mice()</code> from the <span class="pkg">mice</span> package or to <code>amelia()</code> from the <span class="pkg">Amelia</span> package (the <span class="pkg">Amelia</span> package is designed to impute missing data in a single cross-sectional dataset or in a time-series dataset, currently, the <span class="pkg">MatchThem</span> package only supports the former datasets).</p>
</td></tr>
<tr><td><code id="weightthem_+3A_approach">approach</code></td>
<td>
<p>The approach used to combine information in multiply imputed datasets. Currently, <code>"within"</code> (estimating weights within each dataset), <code>"across"</code> (estimating propensity scores within each dataset, averaging them across datasets, and computing a single set of weights based on that to be applied to all datasets), and <code>"apw"</code> (or averaging the probability weights, estimating weights within each dataset and averaging them across datasets) approaches are available. The default is <code>"within"</code>, which has been shown to have superior performance in most cases.</p>
</td></tr>
<tr><td><code id="weightthem_+3A_method">method</code></td>
<td>
<p>The method used to estimate weights. See <code><a href="WeightIt.html#topic+weightit">weightit()</a></code> for allowable options. Only methods that produce a propensity score (<code>"ps"</code>, <code>"gbm"</code>, <code>"cbps"</code>, <code>"super"</code>, and <code>"bart"</code>) are compatible with the <code>"across"</code> approach). The default is <code>"ps"</code> propensity score weighting using logistic regression propensity scores.</p>
</td></tr>
<tr><td><code id="weightthem_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed to <code>weightit()</code>. see <code><a href="WeightIt.html#topic+weightit">weightit()</a></code> for more details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If an <code>amelia</code> object is supplied to <code>datasets</code>, it will be transformed into a <code>mids</code> object for further use. <code>weightthem()</code> works by calling <code><a href="mice.html#topic+complete">mice::complete()</a></code> on the <code>mids</code> object to extract a complete dataset, and then calls <code><a href="WeightIt.html#topic+weightit">WeightIt::weightit()</a></code> on each dataset, storing the output of each <code>weightit()</code> call and the <code>mids</code> in the output. All arguments supplied to <code>weightthem()</code> except <code>datasets</code> and <code>approach</code> are passed directly to <code>weightit()</code>. With the <code>"across"</code> approach, the estimated propensity scores are averaged across imputations and re-supplied to another set of calls to <code>weightit()</code>.
</p>


<h3>Value</h3>

<p>An object of the <code><a href="#topic+wimids">wimids</a></code> (weighted multiply imputed datasets) class, which includes the supplied <code>mids</code> object (or an <code>amelia</code> object transformed into a <code>mids</code> object if supplied) and the output of the calls to <code>weightit()</code> on each multiply imputed dataset.
</p>


<h3>Author(s)</h3>

<p>Farhad Pishgar and Noah Greifer
</p>


<h3>References</h3>

<p>Stef van Buuren and Karin Groothuis-Oudshoorn (2011). <code>mice</code>: Multivariate Imputation by Chained Equations in <code>R</code>. <em>Journal of Statistical Software</em>, 45(3): 1-67. <a href="https://doi.org/10.18637/jss.v045.i03">doi:10.18637/jss.v045.i03</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+wimids">wimids</a></code>
</p>
<p><code><a href="#topic+with">with</a></code>
</p>
<p><code><a href="#topic+pool">pool</a></code>
</p>
<p><code><a href="#topic+matchthem">matchthem</a></code>
</p>
<p><code><a href="WeightIt.html#topic+weightit">WeightIt::weightit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#1

#Loading libraries
library(MatchThem)

#Loading the dataset
data(osteoarthritis)

#Multiply imputing the missing values
imputed.datasets &lt;- mice::mice(osteoarthritis, m = 5)

#Estimating weights of observations in the multiply imputed datasets
weighted.datasets &lt;- weightthem(OSP ~ AGE + SEX + BMI + RAC + SMK,
                                imputed.datasets,
                                approach = 'within',
                                method = 'ps',
                                estimand = "ATT")

#2

#Loading libraries
library(MatchThem)

#Loading the dataset
data(osteoarthritis)

#Multiply imputing the missing values
imputed.datasets &lt;- Amelia::amelia(osteoarthritis, m = 5,
                                   noms = c("SEX", "RAC", "SMK", "OSP", "KOA"))

#Estimating weights of observations in the multiply imputed datasets
weighted.datasets &lt;- weightthem(OSP ~ AGE + SEX + BMI + RAC + SMK,
                                imputed.datasets,
                                approach = 'within',
                                method = 'ps',
                                estimand = "ATT")
</code></pre>

<hr>
<h2 id='wimids'>Weighted Multiply Imputed Datasets</h2><span id='topic+wimids'></span>

<h3>Description</h3>

<p><code>wimids</code> object contains data of weighted multiply imputed datasets. The <code>wimids</code> object is generated by calls to the <code>weightthem()</code>.
</p>


<h3>Details</h3>

<p><code>wimids</code> objects have methods for <code>print()</code>, <code>summary()</code>, and <code><a href="#topic+cbind.mimids">cbind()</a></code>.
</p>


<h3>Note</h3>

<p>The <span class="pkg">MatchThem</span> package does not use the S4 class definitions and instead relies on the S3 list equivalents.
</p>


<h3>Author(s)</h3>

<p>Farhad Pishgar
</p>


<h3>References</h3>

<p>Stef van Buuren and Karin Groothuis-Oudshoorn (2011). <code>mice</code>: Multivariate Imputation by Chained Equations in <code>R</code>. <em>Journal of Statistical Software</em>, 45(3): 1-67. <a href="https://doi.org/10.18637/jss.v045.i03">doi:10.18637/jss.v045.i03</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+weightthem">weightthem</a></code>
</p>

<hr>
<h2 id='with'>Evaluates an Expression in Matched or Weighted Multiply Imputed Datasets</h2><span id='topic+with'></span><span id='topic+with.mimids'></span><span id='topic+with.wimids'></span>

<h3>Description</h3>

<p><code>with()</code> runs a model on the <code>n</code> multiply imputed datasets of the supplied <code>mimids</code> or <code>wimids</code> object. The typical sequence of steps to do a matching or weighting procedure on multiply imputed datasets are:
</p>

<ol>
<li><p> Multiply impute the missing values using the <code>mice()</code> function (from the <span class="pkg">mice</span> package) or the <code>amelia()</code> function (from the <span class="pkg">Amelia</span> package), resulting in a multiply imputed dataset (an object of the <code>mids</code> or <code>amelia</code> class);
</p>
</li>
<li><p> Match or weight each multiply imputed dataset using <code>matchthem()</code> or <code>weightthem()</code>, resulting in an object of the <code>mimids</code> or <code>wimids</code> class;
</p>
</li>
<li><p> Check the extent of balance of covariates in the datasets (using functions from the <span class="pkg">cobalt</span> package);
</p>
</li>
<li><p> Fit the statistical model of interest on each dataset by the <code>with()</code> function, resulting in an object of the <code>mimira</code> class; and
</p>
</li>
<li><p> Pool the estimates from each model into a single set of estimates and standard errors, resulting in an object of the <code>mimipo</code> class.
</p>
</li></ol>



<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mimids'
with(data, expr, cluster, ...)

## S3 method for class 'wimids'
with(data, expr, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_+3A_data">data</code></td>
<td>
<p>A <code>mimids</code> or <code>wimids</code> object, typically produced by a previous call to the <code>matchthem()</code> or <code>weightthem()</code>.</p>
</td></tr>
<tr><td><code id="with_+3A_expr">expr</code></td>
<td>
<p>An expression (usually a call to a modeling function like <code>glm()</code>, <code>coxph()</code>, <code>svyglm()</code>, etc.) to evaluate in each (matched or weighted) multiply imputed dataset. See Details.</p>
</td></tr>
<tr><td><code id="with_+3A_cluster">cluster</code></td>
<td>
<p>When a function from <span class="pkg">survey</span> (e.g., <code><a href="survey.html#topic+svyglm">svyglm()</a></code>) is supplied in <code>expr</code>, whether the standard errors should incorporate clustering due to dependence between matched pairs. This is done by supplying the variable containing pair membership to the <code>ids</code> argument of <code>link[survey:svydesign]{svydesign()}</code>. If unspecified, it will be set to <code>TRUE</code> if subclasses (i.e., pairs) are present in the output and there are 20 or more unique subclasses. It will be ignored for matching methods that don't return subclasses (e.g., matching with replacement).</p>
</td></tr>
<tr><td><code id="with_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed to <code>expr</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>with()</code> applies the supplied model in <code>expr</code> to the (matched or weighted) multiply imputed datasets, automatically incorporating the (matching) weights when possible. The argument to <code>expr</code> should be of the form <code>glm(y ~ z, family = quasibinomial)</code>, for example, excluding the data or weights argument, which are automatically supplied. <br />
Functions from the <span class="pkg">survey</span> package, such as <code>svyglm()</code>, are treated a bit differently. No <code>svydesign</code> object needs to be supplied because <code>with()</code> automatically constructs and supplies it with the imputed dataset and estimated weights. When <code>cluster = TRUE</code> (or <code>with()</code> detects that pairs should be clustered; see the <code>cluster</code> argument above), pair membership is supplied to the <code>ids</code> argument of <code>svydesign()</code>. <br />
For generalized linear models, it is always recommended to use <code>svyglm()</code> rather than <code>glm()</code> in order to correctly compute standard errors. For Cox models, <code>coxph()</code> will produce correct standard errors when used with weighting but <code>svycoxph()</code> will produce more accurate standard errors when matching is used.
</p>


<h3>Value</h3>

<p>An object from the <code>mimira</code> class containing the output of the analyses.
</p>


<h3>Author(s)</h3>

<p>Farhad Pishgar and Noah Greifer
</p>


<h3>References</h3>

<p>Stef van Buuren and Karin Groothuis-Oudshoorn (2011). <code>mice</code>: Multivariate Imputation by Chained Equations in <code>R</code>. <em>Journal of Statistical Software</em>, 45(3): 1-67. <a href="https://doi.org/10.18637/jss.v045.i03">doi:10.18637/jss.v045.i03</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+matchthem">matchthem()</a></code>
</p>
<p><code><a href="#topic+weightthem">weightthem()</a></code>
</p>
<p><code><a href="mice.html#topic+with.mids">mice::with.mids()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Loading libraries
library(MatchThem)
library(survey)

#Loading the dataset
data(osteoarthritis)

#Multiply imputing the missing values
imputed.datasets &lt;- mice::mice(osteoarthritis, m = 5)

#Matching in the multiply imputed datasets
matched.datasets &lt;- matchthem(OSP ~ AGE + SEX + BMI + RAC + SMK,
                              imputed.datasets,
                              approach = 'within',
                              method = 'nearest')

#Analyzing the matched datasets
models &lt;- with(matched.datasets,
               svyglm(KOA ~ OSP, family = binomial),
               cluster = TRUE)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
