<!DOCTYPE html><html lang="en"><head><title>Help for package drgee</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {drgee}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#drgee-package'>
<p>Doubly Robust Generalized Estimating Equations</p></a></li>
<li><a href='#centerX'><p>Cluster-center a design matrix around cluster means</p></a></li>
<li><a href='#drgee'><p>Doubly Robust Generalized Estimating Equations</p></a></li>
<li><a href='#drgeeData'>
<p>Extracting Variables and Model Matrices for Generalized Estimating equations</p></a></li>
<li><a href='#findRoots'>
<p>Non Linear Equation System Solving</p></a></li>
<li><a href='#gee'><p>Generalized Estimating Equations</p></a></li>
<li><a href='#getScoreResidualsFromClogit'>
<p>Get the (conditional) score residuals from conditional logistic regression</p></a></li>
<li><a href='#robVcov'>
<p>Robust Variance Calculation</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Doubly Robust Generalized Estimating Equations</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.10</td>
</tr>
<tr>
<td>Date:</td>
<td>2020-01-08</td>
</tr>
<tr>
<td>Author:</td>
<td>Johan Zetterqvist &lt;drjohanzetterqvist at gmail.com&gt; , Arvid Sjölander &lt;arvid.sjolander at ki.se&gt; with contributions from Alexander Ploner.</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Johan Zetterqvist &lt;drjohanzetterqvist@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Fit restricted mean models for the conditional association
  between an exposure and an outcome, given covariates. Three methods
  are implemented: O-estimation, where a nuisance model for the
  association between the covariates and the outcome is used;
  E-estimation where a nuisance model for the association
  between the covariates and the exposure is used, and doubly robust (DR)
  estimation where both nuisance models are used. In DR-estimation,
  the estimates will be consistent when at least one of the nuisance
  models is correctly specified, not necessarily both. For more information, see Zetterqvist and Sjölander (2015) &lt;<a href="https://doi.org/10.1515%2Fem-2014-0021">doi:10.1515/em-2014-0021</a>&gt;.</td>
</tr>
<tr>
<td>Imports:</td>
<td>nleqslv, survival, Rcpp, data.table</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-01-08 20:27:30 UTC; johan</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-01-09 07:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='drgee-package'>
Doubly Robust Generalized Estimating Equations
</h2><span id='topic+drgee-package'></span>

<h3>Description</h3>

<p>The main function is <code>drgee</code>, which estimates a parameter
<code class="reqn">\beta</code> in a model defined as
<code class="reqn">g\{E(Y|A,L)\}-g\{E(Y|A=0,L)\}=\beta^T \{A\cdot X(L)\}</code>. By supplying (nuisance) models for
<code class="reqn">g\{E(Y|A=0,L)</code>
and <code class="reqn">E(A|L)</code>, a consistent estimate of <code class="reqn">\beta</code> is
obtained when at least one of these models is correctly specified.
</p>
<p>In the function <code>drgee</code>, three estimation methods are
implemented:
O-estimation, where a model for <code class="reqn">g\{E(Y|A=0,L)</code> is used;
E-estimation, where a model for <code class="reqn">E(A|L)</code> is used; and
DR-estimation where models for both <code class="reqn">g\{E(Y|A=0,L)</code> and
<code class="reqn">E(A|L)</code> are used.
</p>
<p>The function <code>gee</code> is an implementation of standard GEE with
independent working correlation matrix.
</p>
<p>For conditional methods with clustered data, cluster-specific
intercepts are assumed in all models.
</p>
<p>The function <code>drgeeData</code> is used for extraction and manipulation
of data, and is called by <code>drgee</code> and <code>gee</code>.
</p>
<p>The function <code>RobVcov</code> is used to calculate standard errors of
the estimates, given a vector of the residuals from estimating
equations, the Jacobian, and a cluster-identifying variable.
</p>
<p>The function <code>findRoots</code> solves a system of non linear equations.
</p>


<h3>Author(s)</h3>

<p>Johan Zetterqvist, Arvid Sjölander with contributions from Alexander Ploner.
</p>

<hr>
<h2 id='centerX'>Cluster-center a design matrix around cluster means</h2><span id='topic+centerX'></span>

<h3>Description</h3>

<p>Given a design matrix and a cluster identification
variable. A new design matrix is returned, where each column
is centered around its cluster mean. Using C++ code for speed.</p>


<h3>Usage</h3>

<pre><code class='language-R'>centerX(x, id)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="centerX_+3A_x">x</code></td>
<td>
<p>A design matrix</p>
</td></tr>
<tr><td><code id="centerX_+3A_id">id</code></td>
<td>
<p>A cluster identifying variable.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>centerX</code> is written as a help function with the aim of being fast.</p>


<h3>Value</h3>

<p> A matrix with cluster centered columns.</p>


<h3>Author(s)</h3>

<p>Johan Zetterqvist, Arvid Sjölander
</p>

<hr>
<h2 id='drgee'>Doubly Robust Generalized Estimating Equations</h2><span id='topic+drgee'></span><span id='topic+coef.drgee'></span><span id='topic+vcov.drgee'></span><span id='topic+print.drgee'></span><span id='topic+summary.drgee'></span><span id='topic+print.summary.drgee'></span><span id='topic+clusterRobustVcov.drgee'></span>

<h3>Description</h3>

<p><code>drgee</code> is used to estimate an exposure-outcome effect adjusted
for  additional covariates. The estimation is based on regression
models for the outcome, exposure or a combination of both.
For clustered data the models may
have cluster-specific intercepts.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>drgee(outcome, exposure,
      oformula, eformula, iaformula = formula(~1),
      olink = c("identity", "log", "logit"),
      elink = c("identity", "log", "logit"),
      data, subset = NULL, estimation.method = c("dr", "o", "e"),
      cond = FALSE, clusterid, clusterid.vcov, rootFinder = findRoots,
      intercept = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="drgee_+3A_outcome">outcome</code></td>
<td>

<p>The outcome as variable or as a character string naming a variable
in the <code>data</code> argument. If missing, the outcome is assumed
to be the response of <code>oformula</code>.
</p>
</td></tr>
<tr><td><code id="drgee_+3A_exposure">exposure</code></td>
<td>

<p>The exposure as variable or as a character string naming a variable
in the <code>data</code> argument. If missing, the exposure is assumed
to be the response of <code>eformula</code>.
</p>
</td></tr>
<tr><td><code id="drgee_+3A_oformula">oformula</code></td>
<td>

<p>An expression or formula for the outcome nuisance model.
</p>
</td></tr>
<tr><td><code id="drgee_+3A_eformula">eformula</code></td>
<td>

<p>An expression or formula for the exposure nuisance model.
</p>
</td></tr>
<tr><td><code id="drgee_+3A_iaformula">iaformula</code></td>
<td>

<p>An expression or formula where the RHS should contain the variables
that &quot;interact&quot; (i.e. are supposed to be multiplied with) with the
exposure in the main model. &quot;1&quot; will always added. Default value is no
interactions, i.e. <code>iaformula = formula(~1)</code>.
</p>
</td></tr>
<tr><td><code id="drgee_+3A_olink">olink</code></td>
<td>

<p>A character string naming the link function in the outcome nuisance
model. Has to be <code>"identity"</code>, <code>"log"</code> or
<code>"logit"</code>.Default is <code>"identity"</code>.
</p>
</td></tr>
<tr><td><code id="drgee_+3A_elink">elink</code></td>
<td>

<p>A character string naming the link function in the exposure nuisance
model. Has to be <code>"identity"</code>, <code>"log"</code> or
<code>"logit"</code>. Default is <code>"identity"</code>.
</p>
</td></tr>
<tr><td><code id="drgee_+3A_data">data</code></td>
<td>

<p>A data frame or environment containing the variables used.
If missing, variables are expected to be found in the
calling environment of the calling environment.
</p>
</td></tr>
<tr><td><code id="drgee_+3A_subset">subset</code></td>
<td>

<p>An optional vector defining a subset of the data to be used.
</p>
</td></tr>
<tr><td><code id="drgee_+3A_estimation.method">estimation.method</code></td>
<td>

<p>A character string naming the desired estimation method. Choose
<code>"o"</code> for O-estimation,
<code>"e"</code> for E-estimation or
<code>"dr"</code> for DR-estimation. Default is <code>"dr"</code>.
</p>
</td></tr>
<tr><td><code id="drgee_+3A_cond">cond</code></td>
<td>

<p>A logical value indicating whether the nuisance models should have
cluster-specific intercepts. Requires a <code>clusterid</code> argument.
</p>
</td></tr>
<tr><td><code id="drgee_+3A_rootfinder">rootFinder</code></td>
<td>

<p>A function to solve a system of non-linear equations. Default
is <code>findRoots</code>.
</p>
</td></tr>
<tr><td><code id="drgee_+3A_clusterid">clusterid</code></td>
<td>

<p>A cluster-defining variable or a character string naming a
cluster-defining variable in the <code>data</code> argument. If it is not
found in the <code>data</code> argument, it will be searched for in the
calling frame. If missing, each observation will be considered to be
a separate cluster. This argument is required when <code>cond = TRUE</code>.
</p>
</td></tr>
<tr><td><code id="drgee_+3A_clusterid.vcov">clusterid.vcov</code></td>
<td>

<p>A cluster-defining variable or a character string naming a
cluster-defining variable in the <code>data</code> argument to be used for
adding contributions from the same cluster. These clusters can be
different from the clusters defined by <code>clusterid</code>. However,
each cluster defined by <code>clusterid</code> needs to be contained in
exactly one cluster defined by <code>clusterid.vcov</code>. This variable
is useful when the clusters are hierarchical.
</p>
</td></tr>
<tr><td><code id="drgee_+3A_intercept">intercept</code></td>
<td>

<p>A boolean to choose whether the nuisance parameters in doubly robust
conditional logistic regression should be fitted with a model with an
intercept. Only used for doubly robust condtional logistic regression.
</p>
</td></tr>
<tr><td><code id="drgee_+3A_...">...</code></td>
<td>

<p>Further arguments to be passed to the function <code>rootFinder</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>drgee</code> estimates the parameter <code class="reqn">\beta</code> in a main
model <code class="reqn">g\{E(Y|A,L)\}-g\{E(Y|A=0,L)\}=\beta^T \{A\cdot X(L)\}</code>,
where <code class="reqn">Y</code> is the outcome of interest, <code class="reqn">A</code> is the exposure of
interest, and <code class="reqn">L</code> is a vector of covariates that we wish to
adjust for. <code class="reqn">X(L)</code> is a vector valued function of <code class="reqn">L</code>. Note that <code class="reqn">A
    \cdot X(L)</code> should be interpreted as a columnwise
multiplication and that <code class="reqn">X(L)</code> will always contain a column of 1's.
Given a specification of an outcome nuisance model <code class="reqn">g\{E(Y|A=0,L)=\gamma^T
    V(L)</code> (where <code class="reqn">V(L)</code> is a function of <code class="reqn">L</code>)
O-estimation is performed. Alternatively, leaving <code class="reqn">g\{E(Y|A=0,L)</code>
unspecified and using an exposure nuisance model <code class="reqn">h\{E(A|L)\}=\alpha^T
    Z(L)</code> (where <code class="reqn">h</code> is a link
function and <code class="reqn">Z(L)</code> is a function of <code class="reqn">L</code>) E-estimation
is performed.  When <code class="reqn">g</code> is logit, the exposure nuisance
model is required be of the form
<code class="reqn">logit\{E(A|Y=0,L)\}=\alpha^T Z(L)</code>.
In this case the exposure needs to binary.
</p>
<p>Given both an outcome and an exposure nuisance model, DR-estimation can be
performed. DR-estimation gives a consistent estimate of the parameter
<code class="reqn">\beta</code> when either the outcome nuisance model or
the exposure nuisance model
is correctly specified, not necessarily both.
</p>
<p>Usage is best explained through an example. Suppose that we are
interested in the parameter vector <code class="reqn">(\beta_0,
    \beta_1)</code> in a main model
<code class="reqn">logit\{E(Y|A,L_1,L_2)\}-logit\{E(Y|A=0,L_1,L_2)\}=\beta_0 A + \beta_1
    A \cdot L_1</code> where <code class="reqn">L_1</code> and <code class="reqn">L_2</code> are the covariates that we wish
to adjust for. To adjust for  <code class="reqn">L_1</code> and <code class="reqn">L_2</code>, we can use an outcome
nuisance model <code class="reqn">E(Y|A=0,L_1,L_2;\gamma_0, \gamma_1)=\gamma_0 + \gamma_1
  L_1</code> or an
exposure nuisance model <code class="reqn">logit\{E(A|Y=0,L_1,L_2)\}=\alpha_0+\alpha_1
  L_1+\alpha_2 L_2</code> to calculate estimates of <code class="reqn">\beta_0</code> and <code class="reqn">\beta_1</code>
in the main model. We specify the outcome nuisance model as <code>oformula=Y~L_1</code>
and <code>olink = "logit"</code>. The exposure nuisance model is specified as
<code>eformula = A~L_1+L_2</code> and <code>elink = "logit"</code>.
Since the outcome <code class="reqn">Y</code> and the exposure <code class="reqn">A</code> are
identified as the LHS of <code>oformula</code> and <code>eformla</code>
respectively and since the outcome link is specified in the
<code>olink</code> argument,
the only thing left to specify for the main model is the
(multiplicative) interactions <code class="reqn">A\cdot X(L)=A\cdot
  (1,L_1)^T</code>. This
is done by specifying <code class="reqn">X(L)</code> as
<code>iaformula = ~L_1</code>, since <code class="reqn">1</code> is always included in <code class="reqn">X(L)</code>.
We can then perform O-estimation, E-estimation or DR-estimation by
setting <code>estimation.method</code> to <code>"o"</code>,
<code>"e"</code> or <code>"dr"</code> respectively. O-estimation uses only the
outcome nuisance model, and E-estimation uses only the exposure
nuisance model. DR-estimation uses both nuisance models, and gives a
consistent estimate of <code class="reqn">(\beta_0,\beta_1)</code> if either nuisance model is correct, not necessarily both.
</p>
<p>When <code>estimation.method = "o"</code>, the RHS of <code>eformula</code> will be
ignored. The <code>eformula</code> argument can also be replaced by an <code>exposure</code>
argument specifying what the exposure of interest is.
</p>
<p>When <code>estimation.method = "e"</code>, the RHS of <code>oformula</code> will be
ignored.  The <code>oformula</code> argument can also be replaced by an <code>outcome</code>
argument specifying what the outcome of interest is.
</p>
<p>When <code>cond = TRUE</code> the nuisance models will be assumed to have
cluster-specific intercept. These intercepts will not estimated.
</p>
<p>When E-estimation or DR-estimation is chosen with
<code>olink = "logit"</code>, the exposure link will be
changed to <code>"logit"</code>. Note that this choice
of outcome link does not work for DR-estimation
when <code>cond = TRUE</code>.
</p>
<p>Robust variance for the estimated parameter is calculated
using the function <code>robVcov</code>. A cluster robust variance is calculated when
a character string naming a cluster variable is
supplied in the <code>clusterid</code> argument.
</p>
<p>For E-estimation when <code>cond = FALSE</code> and <code class="reqn">g</code> is the identity
or log link, see Robins et al. (1992).
</p>
<p>For DR-estimation when <code>cond = TRUE</code> and <code class="reqn">g</code> is the identity
or log link, see Robins (1999). For DR-estimation when
<code class="reqn">g</code> is the logit link, see Tchetgen et al. (2010).
</p>
<p>O-estimation can also be performed using the <code>gee</code> function.
</p>


<h3>Value</h3>

<p><code>drgee</code> returns an object of class <code>drgee</code> containing:
</p>
<table role = "presentation">
<tr><td><code>coefficients</code></td>
<td>
<p>Estimates of the parameters in the main model.</p>
</td></tr>
<tr><td><code>vcov</code></td>
<td>
<p>Robust variance for all main model parameters.</p>
</td></tr>
<tr><td><code>coefficients.all</code></td>
<td>
<p>Estimates of all estimated parameters.</p>
</td></tr>
<tr><td><code>vcov.all</code></td>
<td>
<p>Robust variance of the all parameter estimates.</p>
</td></tr>
<tr><td><code>optim.object</code></td>
<td>
<p>An estimation object returned from the function specified
in the <code>rootFinder</code>, if this function is called for the
estimation of the main model parameters.</p>
</td></tr>
<tr><td><code>optim.object.o</code></td>
<td>
<p>An estimation object returned from the function specified
in the <code>rootFinder</code>, if this function is called for the
estimation of the outcome nuisance parameters.</p>
</td></tr>
<tr><td><code>optim.object.e</code></td>
<td>
<p>An estimation object returned from the function specified
in the <code>rootFinder</code>, if this function is called for the
estimation of the outcome nuisance parameters.</p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p>The matched call.</p>
</td></tr>
<tr><td><code>estimation.method</code></td>
<td>
<p>The value of the input argument <code>estimation.method</code>.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>The original data object, if given as an input argument</p>
</td></tr>
<tr><td><code>oformula</code></td>
<td>
<p>The original oformula object, if given as an input argument</p>
</td></tr>
<tr><td><code>eformula</code></td>
<td>
<p>The original eformula object, if given as an input argument</p>
</td></tr>
<tr><td><code>iaformula</code></td>
<td>
<p>The original iaformula object, if given as an input argument</p>
</td></tr>
</table>
<p>The class methods <code>coef</code> and <code>vcov</code> can be used to extract
the estimated parameters and their covariance matrix from a
<code>drgee</code> object. <code>summary.drgee</code> produces a summary of the
calculations.
</p>


<h3>Author(s)</h3>

<p>Johan Zetterqvist, Arvid Sjölander
</p>


<h3>References</h3>

<p>Orsini N., Belocco R., Sjölander A. (2013), Doubly
Robust Estimation in Generalized Linear Models, <em>Stata Journal</em>,
<b>13</b>, 1, pp. 185&ndash;205
</p>
<p>Robins J.M., Mark S.D., Newey W.K. (1992), Estimating Exposure
Effects by Modelling the Expectation of Exposure Conditional
on Confounders, <em>Biometrics</em>, <b>48</b>, pp. 479&ndash;495
</p>
<p>Robins JM (1999), Robust Estimation in Sequentially Ignorable
Missing Data and Causal Inference Models, <em>Proceedings of the
American Statistical Association Section on Bayesian Statistical
Science</em>, pp. 6&ndash;10
</p>
<p>Tchetgen E.J.T., Robins J.M., Rotnitzky A. (2010), On Doubly Robust
Estimation in a Semiparametric Odds Ratio Model, <em>Biometrika</em>,
<b>97</b>, 1, 171&ndash;180
</p>
<p>Zetterqvist J., Vansteelandt S., Pawitan Y.,
Sjölander (2016), Doubly Robust Methods for Handling
Confounding by Cluster, <em>Biostatistics</em>, <b>17</b>, 2, 264&ndash;276
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gee">gee</a></code> for O-estimation, <code><a href="#topic+findRoots">findRoots</a></code> for
nonlinear equation solving and <code><a href="#topic+robVcov">robVcov</a></code> for
estimation of variance.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## DR-estimation when
## the main model is
## E(Y|A,L1,L2)-E(Y|A=0,L1,L2)=beta0*A+beta1*A*L1
## and the outcome nuisance model is
## E(Y|A=0,L1,L2)=gamma0+gamma1*L1+gamma2*L2
## and the exposure nuisance model is
## E(A|Y=0,L1,L2)=expit(alpha0+alpha1*L1+alpha2*l2)

library(drgee)

expit&lt;-function(x) exp(x)/(1+exp(x))

n&lt;-5000

## nuisance
l1&lt;-rnorm(n, mean = 0, sd = 1)
l2&lt;-rnorm(n, mean = 0, sd = 1)

beta0&lt;-1.5
beta1&lt;-1
gamma0&lt;--1
gamma1&lt;--2
gamma2&lt;-2
alpha0&lt;-1
alpha1&lt;-5
alpha2&lt;-3

## Exposure generated from the exposure nuisance model
a&lt;-rbinom(n,1,expit(alpha0 + alpha1*l1 + alpha2*l2))
## Outcome generated from the main model and the
## outcome nuisance model
y&lt;-rnorm(n,
mean = beta0 * a + beta1 * a * l1 + gamma0 + gamma1 * l1 + gamma2 * l2,
sd = 1)

simdata&lt;-data.frame(y,a,l1,l2)

## outcome nuisance model misspecified and
## exposure nuisance model correctly specified

## DR-estimation
dr.est &lt;- drgee(oformula = formula(y~l1),
eformula = formula(a~l1+l2),
iaformula = formula(~l1),
olink = "identity", elink = "logit",
data = simdata, estimation.method = "dr")
summary(dr.est)

## O-estimation
o.est &lt;- drgee(exposure = "a", oformula = formula(y~l1),
iaformula = formula(~l1), olink = "identity",
data = simdata, estimation.method = "o")
summary(o.est)

## E-estimation
e.est &lt;- drgee(outcome = "y", eformula = formula(a~l1+l2),
iaformula = formula(~l1), elink="logit",
data = simdata, estimation.method = "e")
summary(e.est)
</code></pre>

<hr>
<h2 id='drgeeData'>
Extracting Variables and Model Matrices for Generalized Estimating equations
</h2><span id='topic+drgeeData'></span><span id='topic+summary.drgeeData'></span><span id='topic+print.summary.drgeeData'></span>

<h3>Description</h3>

<p>Given a main model, an outcome nuisance model and an
exposure nuisance model <code>drgeeData</code> extracts the model
variables and matrices from a <code>data.frame</code> or an <code>environment</code>
object. It also performs some data cleaning and error checking.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>drgeeData(outcome, exposure,
          oformula, eformula, iaformula = formula(~1),
          olink = c("identity", "log", "logit"),
          elink = c("identity", "log", "logit"),
          data, subset = NULL,
          estimation.method = c("dr", "o", "e"),
          cond = FALSE, clusterid, clusterid.vcov)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="drgeeData_+3A_outcome">outcome</code></td>
<td>

<p>The outcome as a variable or as a character string naming a variable in the
<code>data</code> argument. If it is not found in the <code>data</code>
argument, it will be searched for in the calling frame. If missing,
the outcome is assumed to be the response of <code>oformula</code>.
</p>
</td></tr>
<tr><td><code id="drgeeData_+3A_exposure">exposure</code></td>
<td>

<p>The exposure as a variable or as a character string naming a variable in the
<code>data</code> argument. If it is not found in the <code>data</code>
argument, it will be searched for in the calling frame. If missing,
the outcome is assumed to be the response of <code>eformula</code>.
</p>
</td></tr>
<tr><td><code id="drgeeData_+3A_oformula">oformula</code></td>
<td>

<p>An expression or formula for the outcome nuisance model. The outcome
is identified as the response in this formula.
</p>
</td></tr>
<tr><td><code id="drgeeData_+3A_eformula">eformula</code></td>
<td>

<p>An expression or formula for the exposure nuisance model. The
exposure is identified as the response in this formula.
</p>
</td></tr>
<tr><td><code id="drgeeData_+3A_iaformula">iaformula</code></td>
<td>

<p>An expression or formula where the RHS should contain the variables
that &quot;interact&quot; (i.e. are supposed to be multiplied with) with the
exposure in the main model to create the terms associated with the
parameters of interest. &quot;1&quot; will always added. Default value is no
interactions, i.e. <code>formula(~1)</code>.
</p>
</td></tr>
<tr><td><code id="drgeeData_+3A_olink">olink</code></td>
<td>

<p>A character string naming the link function in the outcome nuisance
model. Have to be <code>"identity"</code>, <code>"log"</code> or
<code>"logit"</code>. Default is <code>"identity"</code>.
</p>
</td></tr>
<tr><td><code id="drgeeData_+3A_elink">elink</code></td>
<td>

<p>A character string naming the link function in the exposure nuisance
model. Have to be <code>"identity"</code>, <code>"log"</code> or
<code>"logit"</code>. Default is <code>"identity"</code>. When
<code>olink="logit"</code> this is replaced by <code>"logit"</code>.
</p>
</td></tr>
<tr><td><code id="drgeeData_+3A_data">data</code></td>
<td>

<p>A data frame or environment containing the variables in <code>iaformula</code>,
<code>oformula</code> and <code>eformula</code>. If missing, variables are
expected to be found in the calling frame.
</p>
</td></tr>
<tr><td><code id="drgeeData_+3A_subset">subset</code></td>
<td>

<p>An optional vector defining a subset of the data to be used.
</p>
</td></tr>
<tr><td><code id="drgeeData_+3A_estimation.method">estimation.method</code></td>
<td>

<p>A character string naming the desired estimation method. Choose
<code>"o"</code> for O-estimation,
<code>"e"</code> for E-estimation or
<code>"dr"</code> for DR-estimation. Default is <code>"dr"</code>.
</p>
</td></tr>
<tr><td><code id="drgeeData_+3A_cond">cond</code></td>
<td>

<p>A logical value indicating whether the nuisance models should have
cluster-specific intercepts. If <code>cond=TRUE</code> the design matrices
for the nuisance models do not have an intercept. Requires a
<code>clusterid</code> argument.
</p>
</td></tr>
<tr><td><code id="drgeeData_+3A_clusterid">clusterid</code></td>
<td>

<p>A cluster-defining variable or a character string naming a cluster-defining variable in the
<code>data</code> argument. If it is not found in the <code>data</code>
argument, it will be searched for in the calling frame. If missing,
each observation will be considered to be a separate cluster. This
argument is required when <code>cond = TRUE</code>.
</p>
</td></tr>
<tr><td><code id="drgeeData_+3A_clusterid.vcov">clusterid.vcov</code></td>
<td>

<p>A cluster-defining variable or a character string naming a
cluster-defining variable in the <code>data</code> argument to be used for
adding contributions from the same cluster. These clusters can be
different from the clusters defined by <code>clusterid</code>. However,
each cluster defined by <code>clusterid</code> needs to be contained in
exactly one cluster defined by <code>clusterid.vcov</code>. This variable
is useful when the clusters are hierarchical.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>drgeeData</code> is called by <code>drgee</code> and <code>gee</code> to extract
data from a <code>data.frame</code> or <code>environment</code>
object. The data can then be used to for O-estimation, E-estimation or
DR-estimation. <code>drgeeData</code> uses
<code>model.frame</code> and <code>model.matrix</code> to remove incomplete
observations and to convert factors to dummy variables. It also
performs check the supplied data for errors or inconsistencies.
</p>
<p>The class method <code>summary.drgeeData</code> produces strings for the
formulas with terms referring to the columns in the produced design
matrices.
</p>


<h3>Value</h3>

<p><code>drgee.data </code> returns an object of class <code>drgeeData</code>
containing
</p>
<table role = "presentation">
<tr><td><code>used.rows</code></td>
<td>
<p>The rows numbers in the original data for the used
rows (after subset selection and exlusions). </p>
</td></tr>
<tr><td><code>orig.order</code></td>
<td>
<p>The original order of the observations. </p>
</td></tr>
<tr><td><code>y</code></td>
<td>
<p>The outcome matrix.</p>
</td></tr>
<tr><td><code>a</code></td>
<td>
<p>The exposure matrix.</p>
</td></tr>
<tr><td><code>x</code></td>
<td>
<p>The matrix of of interactions defined in <code>iaformula</code>.
This matrix will always contain a column with 1's.</p>
</td></tr>
<tr><td><code>ax</code></td>
<td>
<p>The matrix of elementwise product(s) of <code>a</code> and
each column in <code>x</code>.</p>
</td></tr>
<tr><td><code>v</code></td>
<td>
<p>The matrix of terms in the outcome nuisance model.</p>
</td></tr>
<tr><td><code>z</code></td>
<td>
<p>The matrix of terms in the exposure nuisance model.</p>
</td></tr>
<tr><td><code>yx</code></td>
<td>
<p>The matrix of elementwise product(s) of <code>y</code> and each
column in <code>x</code>. </p>
</td></tr>
<tr><td><code>id</code></td>
<td>
<p>A factor defining clusters. For independent observations,
the number of levels equals the number of complete observations.</p>
</td></tr>
<tr><td><code>clustname</code></td>
<td>
<p>A string for the name of the cluster defining variable.</p>
</td></tr>
<tr><td><code>y.names</code></td>
<td>
<p>A string for the name of the outcome.</p>
</td></tr>
<tr><td><code>a.names</code></td>
<td>
<p>A string for the name of the exposure.</p>
</td></tr>
<tr><td><code>x.names</code></td>
<td>
<p>A string vector for the variable names in <code>x</code>.</p>
</td></tr>
<tr><td><code>ax.names</code></td>
<td>
<p>A string vector for the variable names in <code>ax</code>.</p>
</td></tr>
<tr><td><code>v.names</code></td>
<td>
<p>A string vector for the variable names in <code>v</code>.</p>
</td></tr>
<tr><td><code>z.names</code></td>
<td>
<p>A string vector for the variable names in <code>z</code>.</p>
</td></tr>
<tr><td><code>yx.names</code></td>
<td>
<p>A string vector for the variable names in <code>yx</code>.</p>
</td></tr>
<tr><td><code>olink</code></td>
<td>
<p>A character string naming the link function in the outcome nuisance
model.</p>
</td></tr>
<tr><td><code>elink</code></td>
<td>
<p>A character string naming the link function in the outcome nuisance
model.</p>
</td></tr>
<tr><td><code>cond</code></td>
<td>
<p>A logical value indicating whether cluster-specific intercepts should
be assumed. If <code>TRUE</code>, the is no column for the intercept in
<code>v</code> and <code>z</code>. Outcome concordant will also be removed.</p>
</td></tr>
<tr><td><code>oterms</code></td>
<td>
<p>The <code>terms</code> object corresponding to the outcome
nuisance model.</p>
</td></tr>
<tr><td><code>eterms</code></td>
<td>
<p>The <code>terms</code> object corresponding to the exposure
nuisance model.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Johan Zetterqvist, Arvid Sjölander
</p>


<h3>See Also</h3>

<p><code><a href="#topic+drgee">drgee</a></code>, <code><a href="#topic+gee">gee</a></code>, <code><a href="stats.html#topic+model.frame">model.frame</a></code> and <code><a href="stats.html#topic+model.matrix">model.matrix</a></code>.
</p>

<hr>
<h2 id='findRoots'>
Non Linear Equation System Solving
</h2><span id='topic+findRoots'></span>

<h3>Description</h3>

<p>A wrapper around <code>nleqslv</code> from the <span class="pkg">nleqslv</span> package
to solve a non linear system of equations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>findRoots(beta.init, eq.func, d.eq.func = NULL, arg.list, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="findRoots_+3A_beta.init">beta.init</code></td>
<td>

<p>An initial guess for the zero.
</p>
</td></tr>
<tr><td><code id="findRoots_+3A_eq.func">eq.func</code></td>
<td>

<p>A function of two variables for which the zero are sought. Its first
argument <code>beta</code> should be a vector over which the zeros are sought and
the second argument <code>arg.list</code> a list of additional arguments.
</p>
</td></tr>
<tr><td><code id="findRoots_+3A_d.eq.func">d.eq.func</code></td>
<td>

<p>A function to return the Jacobian of <code>eq.func</code> taking the same
arguments as <code>eq.func</code>. Supplying this function can speed up
calculations. Default is <code>NULL</code>.
</p>
</td></tr>
<tr><td><code id="findRoots_+3A_arg.list">arg.list</code></td>
<td>

<p>The second argument to <code>eq.func</code> and <code>d.eq.func</code></p>
</td></tr>
<tr><td><code id="findRoots_+3A_...">...</code></td>
<td>

<p>A list of additional arguments to be passed to <code>nleqslv</code>
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>findRoots</code> calculates zeros fo the function <code>eq.func</code>
and is the default equation solving function in <code>drgee</code>.
It is supplied as a separate function in order to allow users
to use other equation solvers by writing their own wrapper
with the same interface as <code>findRoots</code>.
</p>


<h3>Value</h3>

<p>The value is a list containing the following arguments:
</p>
<table role = "presentation">
<tr><td><code>roots</code></td>
<td>
<p>The zero(s) of the function <code>eq.func</code>.
</p>
</td></tr>
<tr><td><code>optim.object</code></td>
<td>
<p>The optimization object returned from <code>nleqslv</code>.
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Johan Zetterqvist, Arvid Sjölander
</p>


<h3>See Also</h3>

<p><code>nleqslv</code> in package <span class="pkg">nleqslv</span>.
</p>

<hr>
<h2 id='gee'>Generalized Estimating Equations</h2><span id='topic+gee'></span><span id='topic+coef.gee'></span><span id='topic+vcov.gee'></span><span id='topic+print.gee'></span><span id='topic+summary.gee'></span><span id='topic+print.summary.gee'></span><span id='topic+naiveVcov.gee'></span><span id='topic+clusterRobustVcov.gee'></span>

<h3>Description</h3>

<p><code>gee</code> performs estimation of parameters in a restricted mean
model using standard GEEs with independent working correlation matrix. For
clustered data, cluster-robust standard errors are calculated. When
<code>cond=TRUE</code>, cluster-specific
intercepts are assumed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gee(formula, link = c("identity", "log", "logit"), data, subset, cond = FALSE,
clusterid, clusterid.vcov, rootFinder = findRoots, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gee_+3A_formula">formula</code></td>
<td>

<p>An expression or formula representing the expected outcome
conditional on covariates.
</p>
</td></tr>
<tr><td><code id="gee_+3A_link">link</code></td>
<td>

<p>A character string naming the link function to use. Has to be
<code>"identity"</code>, <code>"log"</code> or <code>"logit"</code>. Default is <code>"identity"</code>.
</p>
</td></tr>
<tr><td><code id="gee_+3A_data">data</code></td>
<td>

<p>A data frame or environment containing the variables appearing in
<code>formula</code>. If missing, the variables are expected to be found
in the environment of the <code>formula</code> argument.
</p>
</td></tr>
<tr><td><code id="gee_+3A_subset">subset</code></td>
<td>

<p>An optional vector defining a subset of the data to be used.
</p>
</td></tr>
<tr><td><code id="gee_+3A_cond">cond</code></td>
<td>

<p>A logical value indicating whether cluster-specific intercepts should
be assumed. Requires a <code>clusterid</code> argument.
</p>
</td></tr>
<tr><td><code id="gee_+3A_clusterid">clusterid</code></td>
<td>

<p>A cluster-defining variable or a character string naming a
cluster-defining variable in the <code>data</code> argument. If it is not
found in the <code>data</code> argument, it will be searched for in the
calling frame. If missing, each observation will be considered to be
a separate cluster. This argument is required when <code>cond = TRUE</code>.
</p>
</td></tr>
<tr><td><code id="gee_+3A_clusterid.vcov">clusterid.vcov</code></td>
<td>

<p>A cluster-defining variable or a character string naming a
cluster-defining variable in the <code>data</code> argument to be used for
adding contributions from the same cluster. These clusters can be
different from the clusters defined by <code>clusterid</code>. However,
each cluster defined by <code>clusterid</code> needs to be contained in
exactly one cluster defined by <code>clusterid.vcov</code>. This variable
is useful when the clusters are hierarchical.
</p>
</td></tr>
<tr><td><code id="gee_+3A_rootfinder">rootFinder</code></td>
<td>

<p>A function to solve a system of non linear equations. Default
is <code>findRoots</code>.
</p>
</td></tr>
<tr><td><code id="gee_+3A_...">...</code></td>
<td>

<p>Further arguments to be passed to the function <code>rootFinder</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Estimates parameters in a regression model, defined by
<code>formula</code>. When <code>cond=FALSE</code>, the estimated coefficients are
identical to those obtained with <code>glm</code>, but since no
distributional assumptions are made, a robust variance is
calculated. When <code>cond=TRUE</code> and <code>link</code> is <code>"identity"</code>
or <code>"log"</code>, the coefficients will be calculated
using conditional estimating equations as described in Goetgeluk and
Vansteelandt (2008). When <code>cond=TRUE</code> and <code>link="logit"</code>,
the coefficients will be calculated by conditional logistic regression
(with robust standard errors).
</p>


<h3>Value</h3>

<p><code>gee</code> return an object of class <code>gee</code> containing:
</p>
<table role = "presentation">
<tr><td><code>coefficients</code></td>
<td>
<p>Estimates of the parameters.</p>
</td></tr>
<tr><td><code>vcov</code></td>
<td>
<p>Robust variance of the estimates.</p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p>The matched call.</p>
</td></tr>
<tr><td><code>y</code></td>
<td>
<p>The outcome vector.</p>
</td></tr>
<tr><td><code>x</code></td>
<td>
<p>The design matrix. For conditional methods there is no
column corresponding to the intercept. </p>
</td></tr>
<tr><td><code>optim.object</code></td>
<td>
<p>An estimation object returned from the function specified
in the <code>rootFinder</code>, if this function is called.</p>
</td></tr>
<tr><td><code>res</code></td>
<td>
<p>The residuals from the estimating equations.</p>
</td></tr>
<tr><td><code>d.res</code></td>
<td>
<p>The derivative of the residuals from the estimating
equations.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>The original data object, if given as an input argument</p>
</td></tr>
<tr><td><code>formula</code></td>
<td>
<p>The original formula object, if given as an input argument</p>
</td></tr>
</table>
<p>The class methods <code>coef</code> and <code>vcov</code> can be used to extract
the estimated parameters and their covariance matrix from a
<code>gee</code> object. To obtain the 'naive' variance, i.e. the variance
obtained from maximum likelihood estimation assuming correct
parameteric model and no clustering, use the class method
<code>naiveVcov</code>. The class method <code>summary.drgee</code> produces a
summary of the calculations.
</p>


<h3>Author(s)</h3>

<p>Johan Zetterqvist, Arvid Sjölander
</p>


<h3>References</h3>

<p>Goetgeluk S., &amp; Vansteelandt S. (2008), Conditional generalized
estimating equations for the analysis of clustered and longitudinal
data. <em>Biometrics</em>, <b>64</b>(3), pp. 772&ndash;780.
</p>


<h3>See Also</h3>

<p><code>glm</code>
</p>

<hr>
<h2 id='getScoreResidualsFromClogit'>
Get the (conditional) score residuals from conditional logistic regression
</h2><span id='topic+getScoreResidualsFromClogit'></span>

<h3>Description</h3>

<p>A function to obtain the conditional score residuals from conditional
logistic regression as well as the sum of derivatives of these
residuals with respect to the parameters evaluated at the estimated
parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getScoreResidualsFromClogit(fit, coefs, y, x, id)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="getScoreResidualsFromClogit_+3A_fit">fit</code></td>
<td>

<p>A fitted object. Could be any object that has a
class.function <code>coefficients</code>, but is intended to be used with
<code>clogit</code> in the <code>survival</code> package.
</p>
</td></tr>
<tr><td><code id="getScoreResidualsFromClogit_+3A_coefs">coefs</code></td>
<td>

<p>An estimate of the parameters. If the argument <code>fit</code> is supplied,
this will be replaced by <code>coefficients(fit)</code>.
</p>
</td></tr>
<tr><td><code id="getScoreResidualsFromClogit_+3A_y">y</code></td>
<td>

<p>The observed outcomes.
</p>
</td></tr>
<tr><td><code id="getScoreResidualsFromClogit_+3A_x">x</code></td>
<td>

<p>The design matrix.
</p>
</td></tr>
<tr><td><code id="getScoreResidualsFromClogit_+3A_id">id</code></td>
<td>

<p>The cluster identification variable.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>getScoreResidualsFromClogit</code> calculates the residuals from the
conditional score equations used in conditional logistic regression as
we as the sums of  their derivatives with respect to the paramaters.
</p>
<p>This is useful if one wants to use a calculate the sandwich estimate
of a variance where the uncertainty in the estimation of a
conditional odds ratio needs to be taken into account.
</p>


<h3>Value</h3>

<p><code>getScoreResidualsFromClogit</code> return a list containing:
</p>
<table role = "presentation">
<tr><td><code>U</code></td>
<td>

<p>An <code class="reqn">n</code> x <code class="reqn">p</code> matrix, where <code class="reqn">n</code> is the number of observations
and <code class="reqn">p</code> is the length of the estimated parameter.</p>
</td></tr>
<tr><td><code>dU.sum</code></td>
<td>

<p>An <code class="reqn">p</code> x <code class="reqn">p</code> matrix containing the sums of the
derivatives. The rows correspond to the estimating equations and
the columns correspond to the partial derivatives.</p>
</td></tr>
<tr><td><code>dU.mean</code></td>
<td>
<p>The mean cluster sum of the derivatives of the score
residuals from the conditional likelihood. 
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Johan Zetterqvist, Arvid Sjölander
</p>


<h3>See Also</h3>

<p><code><a href="#topic+robVcov">robVcov</a></code>.
</p>

<hr>
<h2 id='robVcov'>
Robust Variance Calculation
</h2><span id='topic+robVcov'></span><span id='topic+robustVcov'></span><span id='topic+naiveVcov'></span>

<h3>Description</h3>

<p><code>robVcov</code> and <code>robustVcov</code> calculates the asymptotic variance for Z-estimators.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>robustVcov(U, d.U.sum, id = NULL)
robVcov(U, d.U, id = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="robVcov_+3A_u">U</code></td>
<td>

<p>A n x q matrix of the estimating equations evaluated at the estimated
model parameters,
where n is the number of observations and q is the number of estimating equations.
</p>
</td></tr>
<tr><td><code id="robVcov_+3A_d.u.sum">d.U.sum</code></td>
<td>

<p>The sum of the jacobian of <code>U</code> evaluated at the solution to the
estimating equations, with rows corresponding to the estimating
equations and columns corresponding to the model parameters. The
number of model parameters is assumed to equal the number of
estimating equations such that <code>d.U.sum</code> is a q x q square matrix.
</p>
</td></tr>
<tr><td><code id="robVcov_+3A_d.u">d.U</code></td>
<td>

<p>The mean of <code>d.U.sum</code> taken over all observations.
</p>
</td></tr>
<tr><td><code id="robVcov_+3A_id">id</code></td>
<td>

<p>A factor with levels corresponding the clusters in the data. Default
is <code>NULL</code> in which case all observations are considered to be independent.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For robust variance estimation, see van der Vaart (2000).
</p>
<p>For clustered data, the rows in <code>U</code> are added clusterwise
resulting in a cluster robust estimate of the variance.
</p>


<h3>Value</h3>

<p>The estimated covariance matrix.
</p>


<h3>Author(s)</h3>

<p>Johan Zetterqvist, Arvid Sjölander
</p>


<h3>References</h3>

<p>van der Vaart, A.W. (2000), <em>Asymptotic Statistics</em>,
Cambridge University Press, pp. 52&ndash;53.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
