<!DOCTYPE html><html><head><title>Help for package mastif</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {mastif}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#mastClimate'><p>Covariates for mast data</p></a></li>
<li><a href='#mastFillCensus'><p>Interpolate census data for seed trap years</p></a></li>
<li><a href='#mastif'><p>Gibbs sampler for mast data</p></a></li>
<li><a href='#mastif-package'><p>Mast Inference and Forecasting</p></a></li>
<li><a href='#mastMap'><p>Map data and predictions for mastif model</p></a></li>
<li><a href='#mastPlot'><p>Plot mast model</p></a></li>
<li><a href='#mastPriors'><p>Obtain prior parameter values for mastif from file</p></a></li>
<li><a href='#mastSim'><p>Data simulation for mast model</p></a></li>
<li><a href='#mastSpectralDensity'><p>Volatility and period for mast data</p></a></li>
<li><a href='#mastVolatility'><p>Volatility and period for mast data, combining trees in populations</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Mast Inference and Forecasting</td>
</tr>
<tr>
<td>Version:</td>
<td>2.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-2-16</td>
</tr>
<tr>
<td>Author:</td>
<td>James S. Clark</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>James S. Clark &lt;jimclark@duke.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Analyzes production and dispersal of seeds dispersed from trees and recovered in seed traps.  Motivated by long-term inventory plots where seed collections are used to infer seed production by each individual plant. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp (&ge; 0.11.5), RANN, cluster, corrplot, xtable, repmis,
robustbase, stringi, stringr</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-16 13:39:40 UTC; jimclark</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-02-16 15:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='mastClimate'>Covariates for mast data</h2><span id='topic+mastClimate'></span>

<h3>Description</h3>

<p>Annotates <code>treeData</code> for <code>mastif</code> to include covariates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  mastClimate( file, plots, years, months = 1:12, FUN = 'mean', 
                         vname = '', normYr = c( 1990:2020 ), lastYear = 2021 )
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mastClimate_+3A_file">file</code></td>
<td>
<p><code>character</code> giving the path and file name where covariate is stored in <code>mastif</code> covariate format (see Details).</p>
</td></tr>
<tr><td><code id="mastClimate_+3A_plots">plots</code></td>
<td>
<p><code>character vector</code> from <code>treeData$plot</code>.</p>
</td></tr>
<tr><td><code id="mastClimate_+3A_years">years</code></td>
<td>
<p><code>numeric vector</code> from <code>treeData$year</code>.</p>
</td></tr>
<tr><td><code id="mastClimate_+3A_months">months</code></td>
<td>
<p><code>numeric vector</code> of months to include in annual values.</p>
</td></tr>
<tr><td><code id="mastClimate_+3A_fun">FUN</code></td>
<td>
<p><code>character</code> specifies how monthly covariate values are combined into annual values.</p>
</td></tr>
<tr><td><code id="mastClimate_+3A_vname">vname</code></td>
<td>
<p>name to use for a variable in the model that comes from <code>file</code>.</p>
</td></tr>
<tr><td><code id="mastClimate_+3A_normyr">normYr</code></td>
<td>
<p>years for climate norm for calculating anomalies.</p>
</td></tr>
<tr><td><code id="mastClimate_+3A_lastyear">lastYear</code></td>
<td>
<p>last data year to include.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The version of <code>treeData</code> used in <code>mastif</code> can have additional tree years included when there are seed trap years that were not censused or when AR(p) effects extend observations to impute the p years before and after a tree was observed.  The <code>function mastFillCensus</code> makes this version of <code>treeData</code> available to the user.  The <code>function mastClimate</code> provides a quick way to add plot-year covariates to <code>treeData</code>. 
</p>
<p>A covariate like minimum monthly temperature is stored in a <code>plot</code> by <code>year_month</code> format, where <code>rownames</code> of <code>file</code> are plot names matching <code>treeData$plot</code>, and <code>colnames</code> of <code>file</code> could be <code>2012_1, 2012_2, ...</code> for the 12 months in the year.  The <code>numeric vector months</code> holds the months to be included in the annual values, e.g., <code>c(3, 4)</code> for minimum winter temperatures during the period from March through April.  To find the minimum for this period, set <code>FUN</code> to <code>'min'</code>.
</p>
<p>More detailed vignettes can be obtained with: <code>browseVignettes('mastif')</code>
</p>


<h3>Value</h3>

<p>A <code>numeric vector</code> equal in length to the number of rows in <code>treeData</code> that can be added as a <code>column</code> and included in <code>formulaFec</code>.
</p>


<h3>Author(s)</h3>

<p>James S Clark, <a href="mailto:jimclark@duke.edu">jimclark@duke.edu</a>
</p>


<h3>References</h3>

<p>Clark, J.S., C. Nunes, and B. Tomasek. 2019. Foodwebs based on unreliable foundations: spatio-temporal masting merged with consumer movement, storage, and diet. Ecological Monographs, e01381.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mastFillCensus">mastFillCensus</a></code> to fill tree census
</p>
<p><code><a href="#topic+mastif">mastif</a></code> for analysis
</p>
<p>A more detailed vignette is can be obtained with:
</p>
<p><code>browseVignettes('mastif')</code>
</p>
<p>website 'http://sites.nicholas.duke.edu/clarklab/code/'.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
d &lt;- "https://github.com/jimclarkatduke/mast/blob/master/liriodendronExample.rData?raw=True"
repmis::source_data(d)

inputs   &lt;- list( specNames = specNames, seedNames = seedNames, 
                  treeData = treeData, seedData = seedData, 
                  xytree = xytree, xytrap = xytrap)
                  
# interpolate census, add years for AR(p) model
inputs   &lt;- mastFillCensus(inputs, p = 3)
treeData &lt;- inputs$treeData               #now includes additional years

# include minimum spring temperature of previous year
cfile &lt;- tempfile(fileext = '.csv')
d &lt;- "https://github.com/jimclarkatduke/mast/blob/master/tmin.csv?raw=True"
download.file(d, destfile=cfile)

tyears &lt;- treeData$year - 1
tplots &lt;- treeData$plot
  
tmp &lt;- mastClimate( file = cfile, plots = tplots, 
                    years = tyears, months = 1:4, FUN = 'min')
treeData$tminSprAnomaly &lt;- tmp$x[,3]                             
inputs$treeData &lt;- treeData
  
formulaRep &lt;- as.formula( ~ diam )
formulaFec &lt;- as.formula( ~ diam + tminSprAnomaly )        
  
inputs$yearEffect &lt;- list(groups ='species', p = 3)  # AR(3) model, species are lag groups
  
output &lt;- mastif(inputs = inputs, formulaFec, formulaRep, ng = 1000, burnin = 400)

</code></pre>

<hr>
<h2 id='mastFillCensus'>Interpolate census data for seed trap years</h2><span id='topic+mastFillCensus'></span>

<h3>Description</h3>

<p>Provides interpolated census data to include years when seed data are available.  This is used when tree sampling is at a lower frequency than seed-trap collections.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
  mastFillCensus(inputs, beforeFirst = 15, afterLast = 15, p = 0, verbose = FALSE)
  
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mastFillCensus_+3A_inputs">inputs</code></td>
<td>
<p><code>list</code> used as input to <code><a href="#topic+mastif">mastif</a></code> that must include two <code>character vector</code>s, (<code>specNames</code>, <code>seedNames</code>) and four <code>data.frame</code>s (<code>treeData</code>, <code>seedData</code>, <code>xytree</code>, <code>xytrap</code>).  See details.</p>
</td></tr>
<tr><td><code id="mastFillCensus_+3A_beforefirst">beforeFirst</code></td>
<td>
<p>number of years before a tree is first observed in a census that it should be considered as potentially present.</p>
</td></tr>
<tr><td><code id="mastFillCensus_+3A_afterlast">afterLast</code></td>
<td>
<p>number of years after a tree is last observed in a census that it should be considered as potentially present.</p>
</td></tr>
<tr><td><code id="mastFillCensus_+3A_p">p</code></td>
<td>
<p>if AR(p) model is used (in <code>yearEffect</code>), the number of lag terms.</p>
</td></tr>
<tr><td><code id="mastFillCensus_+3A_verbose">verbose</code></td>
<td>
<p>if verbose = TRUE information is provided on filling progress.</p>
</td></tr> 
</table>


<h3>Details</h3>

<p>Masting data sets contain tree census data, held in <code>treeData</code>, and seed trap data, help in <code>seedData</code>. Most studies monitor seed rain frequently (e.g., annual), while tree censuses occur at intervals of 2 to 5 years.  <code>mastFillCensus</code> 'fills in' the tree census so that the annual seed data can be used.  It is made available to the user so covariates can be added, e.g., with <code><a href="#topic+mastClimate">mastClimate</a></code>.
</p>
<p><code>mastFillCensus</code> accepts the <code>list</code> of <code>inputs</code> used in <code><a href="#topic+mastif">mastif</a></code>.  The missing years are inserted for each tree with interpolated diameters.  <code>inputs</code> is returned with objects updated to include the missing census years and modified slightly for analysis by <code><a href="#topic+mastif">mastif</a></code>.
</p>
<p>The function <code>mastFillCensus</code> is made accessible to the user, because covariates may be needed for the missing census years.  For example, models often include climate variables that change annually.  The version of <code>treeData</code> returned by <code>mastFillCensus</code> can be annotated with additional columns that can then be included in the model, as specified in <code>formulaFec</code>, <code>formulaRep</code>, and/or <code>randomEffect$formulaRan</code>.
</p>
<p><code>beforeFirst</code> and <code>afterLast</code> allow the user to control the assumptions about treatment of trees between (and before and after) tree census years. Seed trap data may begin before the first tree census or after the last tree census.  Trees may appear in the middle of the study due to ingrowth.  They may be lost to mortality.  In other words, census data can be left-, right-, and interval-censored.  
</p>
<p>For the AR(p) model, values are imputed for <code>p</code> years before a tree is first observed and <code>p</code> years after the tree is last observed (<code><a href="#topic+mastif">mastif</a></code>). These years are inserted by <code>mastFillCensus</code>, such that they too can then be annotated with covariate data.
</p>
<p>More detailed vignettes can be obtained with:
</p>
<p><code>browseVignettes('mastif')</code>
</p>


<h3>Value</h3>

<table>
<tr><td><code>inputs</code></td>
<td>
<p><code>list</code> includes all inputs to the model, cleaned for <code><a href="#topic+mastif">mastif</a></code>, with years inserted to <code>treeData</code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>James S Clark, <a href="mailto:jimclark@duke.edu">jimclark@duke.edu</a>
</p>


<h3>References</h3>

<p>Clark, J.S., C. Nunes, and B. Tomasek. 2019. Foodwebs based on unreliable foundations: spatio-temporal masting merged with consumer movement, storage, and diet. Ecological Monographs, e01381.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mastSim">mastSim</a></code> simulates data
</p>
<p>A more detailed vignette can be obtained with:
</p>
<p><code>browseVignettes('mastif')</code>
</p>
<p>website 'http://sites.nicholas.duke.edu/clarklab/code/'.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
d &lt;- "https://github.com/jimclarkatduke/mast/blob/master/liriodendronExample.rData?raw=True"
repmis::source_data(d)

inputs   &lt;- list( specNames = specNames, seedNames = seedNames, 
                  treeData = treeData, seedData = seedData, 
                  xytree = xytree, xytrap = xytrap)
inputs &lt;- mastFillCensus(inputs)

formulaFec &lt;- formulaRep &lt;- as.formula(~ diam)
                  
output &lt;- mastif(inputs = inputs, formulaFec, formulaRep, ng = 1000, 
                 burnin = 400)

</code></pre>

<hr>
<h2 id='mastif'>Gibbs sampler for mast data</h2><span id='topic+mastif'></span><span id='topic+print.mastif'></span><span id='topic+summary.mastif'></span>

<h3>Description</h3>

<p>Estimates productivity and dispersion of seeds observed at seed traps, using information on locations, and covariates that could explain source strength.  Data can be simulated with <code><a href="#topic+mastSim">mastSim</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
  mastif( inputs, formulaFec = NULL, formulaRep = as.formula("~diam"), 
           ng = NULL, burnin = NULL )
  
  ## S3 method for class 'mastif'
print(x, ...)
  
  ## S3 method for class 'mastif'
summary(object, verbose = TRUE, latex = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mastif_+3A_inputs">inputs</code></td>
<td>
<p><code>list</code> that must include two <code>character vector</code>s, (<code>specNames</code>, <code>seedNames</code>) and four <code>data.frame</code>s (<code>treeData</code>, <code>seedData</code>, <code>xytree</code>, <code>xytrap</code>).  See details.</p>
</td></tr>
<tr><td><code id="mastif_+3A_formulafec">formulaFec</code></td>
<td>
<p>R <code>formula</code> for fecundity model, e.g., <code>~ diam + x1</code>.</p>
</td></tr>
<tr><td><code id="mastif_+3A_formularep">formulaRep</code></td>
<td>
<p>R <code>formula</code> for maturation model, e.g., <code>~ diam</code>.</p>
</td></tr>
<tr><td><code id="mastif_+3A_ng">ng</code></td>
<td>
<p><code>numeric</code> number of Gibbs steps.</p>
</td></tr>
<tr><td><code id="mastif_+3A_burnin">burnin</code></td>
<td>
<p><code>numeric</code> number of burnin steps, before predictions are saved.</p>
</td></tr>
<tr><td><code id="mastif_+3A_object">object</code></td>
<td>
<p>currently, also an object of <code>class mastif</code>.</p>
</td></tr>
<tr><td><code id="mastif_+3A_verbose">verbose</code></td>
<td>
<p>if <code>TRUE</code> summary sent to screen.</p>
</td></tr>
<tr><td><code id="mastif_+3A_latex">latex</code></td>
<td>
<p>if <code>TRUE</code> tables written to screen in latex format.</p>
</td></tr>
<tr><td><code id="mastif_+3A_x">x</code></td>
<td>
<p>object of <code>class mastif</code>.</p>
</td></tr>
<tr><td><code id="mastif_+3A_...">...</code></td>
<td>
<p>further arguments not used here.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>inputs</code> includes the following: 
</p>
<p><code>specNames</code> is a <code>character vector</code> containing names of species, <code>specNames</code>, that appear in the <code>treeData$species</code> column.
</p>
<p><code>seedNames</code> is a <code>character vector</code> of seed types that appear as column names in <code>seedData</code>.
</p>
<p><code>treeData</code> is a <code>data.frame</code> holding tree information, including predictors and tree-year identification.  Required columns are <code>plot</code>, <code>tree</code>, <code>species</code>, <code>year</code>, <code>diam</code>, and any other predictors for fecundity or maturation. 
</p>
<p><code>seedData</code> is a <code>data.frame</code> holding seed counts with seed trap and year identification.  Required columns are <code>plot</code>, <code>trap</code>, <code>year</code>, and <code>seedNames</code>, the latter holding seed counts.
</p>
<p><code>xytree</code> is a <code>data.frame</code> holding tree locations.  Required columns are <code>plot</code>, <code>tree</code>, <code>x</code>, and <code>y</code>.
</p>
<p><code>xytrap</code> is <code>data.frame</code> holding seed trap locations.  Required columns are <code>plot</code>, <code>trap</code>, <code>x</code>, and <code>y</code>.
</p>
<p><code>formulaFec</code> and <code>formulaRep</code> specify the models for plant fecundity and maturation.  Variables listed in formulas appear as column headings in <code>treeData</code>.  Note that <code>formulaFec</code> and <code>formulaRep</code> begin with <code>~</code>, not <code>y ~</code>.  The response <code>matrix</code> is constructed from seed types in <code>seedData</code>. 
</p>
<p>The <code>treeData$tree</code> column has values that are unique for a tree within a <code>plot</code>.  These reference the same unique identifiers in <code>xytree$tree</code>.  In addition to these identifiers, the <code>data.frame xytree</code> holds columns <code>x</code> and <code>y</code> for map locations.
</p>
<p>The <code>character vector seedNames</code> holds the names of columns in <code>seedData</code> for seed counts.  The elements of <code>seedNames</code> are seed types produced by one or more of the species in <code>specNames</code>.  <code>seedData</code> must also include columns for <code>trap</code>, <code>plot</code>, and <code>year</code>, which link with  columns in <code>xytrap</code>, which additionally includes columns <code>x</code> and <code>y</code>.
</p>
<p><code>predList</code> includes the names of <code>plots</code> and <code>years</code> to be predicted.  It can include a <code>numeric</code> value <code>mapMeters</code> for the distance between lattice points in the prediction grid.  See examples.
</p>
<p><code>yearEffect</code> is a <code>list</code> indicating the column names in <code>treeData</code> for random groups in year effects or AR(p) models.  See examples.
</p>
<p><code>randomEffect</code> is a <code>list</code> indicating the column names in <code>treeData</code> for random groups in fecundity estimates, the <code>character randGroups</code> and the <code>formulaRan</code> for random effects.  The <code>formulaRan</code> must be a subset of predictors from <code>formulaFec</code>.  See examples.
</p>
<p><code>modelYears</code> is a <code>numeric vector</code> of years to include in the analysis.
</p>
<p><code>ng</code> is the number of Gibbs steps.  <code>burnin</code> is the number of initial steps, must be less than <code>ng</code>.  
</p>
<p>Additional arguments to <code>inputs</code> can include prior parameters; default values are:
</p>
<p><code>priorDist = 10</code> is a prior mean dispersal distance in meters.
</p>
<p><code>priorVDist = 1</code> is the prior variance on mean dispersal distance in meters. 
</p>
<p><code>minDist = 2</code> and <code>maxDist = 60</code> are the minimum and maximum values for the mean dispersal kernel in meters.
</p>
<p><code>minDiam = 2</code> is the minimum diameter that a tree could be reproductively mature, in cm. 
</p>
<p><code>sigmaMu = .5</code>  and <code>sigmaWt = nrow(inputs$treeData)</code> are the prior mean and the prior weight on log fecundity variance.
</p>
<p><code>maxF = 1e+8</code>, maximum fecundity, helps stabilize analysis of especially noisy data.
</p>
<p>More detailed vignettes can be obtained with:
</p>
<p><code>browseVignettes('mastif')</code>
</p>


<h3>Value</h3>

<p>Returns an object of <code><a href="base.html#topic+class">class</a> "mast"</code>, which is a list containing the following components:
</p>
<table>
<tr><td><code>inputs</code></td>
<td>
<p><code>list</code> includes all inputs to the model, including transformations not resulting from posterior simulation.</p>
</td></tr>
<tr><td><code>chains</code></td>
<td>
<p><code>list</code> of MCMC matrices, each with <code>ng</code> rows, includes:
</p>
<p><code>bfec</code>: fecundity coefficients 
</p>
<p><code>brep</code>: maturation coefficients
</p>
<p><code>ugibbs</code>: dispersal parameters
</p>
<p><code>sgibbs</code>: residual variance and, after <code>burnin</code>, rmspe (root mean square prediction error)
</p>
<p><code>rgibbs</code>: if multiple seed types, then rows are the <code>specNames</code> to <code>seedNames matrix R</code>.  
</p>
<p><code>bygibbsF, bygibbsR</code>: if <code>yearEffects</code> are included in the model, these are fixed year/lag and random year/lag effects by random group.
</p>
<p><code>agibbs</code>: if <code>randomEffects</code> on individuals, rows are covariance matrix.
</p>
</td></tr>
<tr><td><code>parameters</code></td>
<td>
<p><code>list</code> of parameter estimates summarized from <code>chains</code>.
</p>
<p><code>acfMat</code>: autocorrelation on fecundity by random group.
</p>
<p><code>betaFec</code>: fecundity regression coefficients (log scale).
</p>
<p><code>betaRep</code>: maturation regression coefficients (probit scale).
</p>
<p><code>dpars</code>: dispersal kernel coefficient, by random group, on meter scale.
</p>
<p><code>omegaList</code>: fecundity covariance between trees for the same plot-year.
</p>
<p><code>pacfMat</code>: partial autocorrelation on fecundity.
</p>
<p><code>pacfSe</code>: standard errors for <code>pacfMat</code>.
</p>
<p><code>pacsMat</code>: partial autocorrelation on seed counts.
</p>
<p><code>sigma</code>: estimate of residual log fecundity variance.
</p>
<p><code>sigmaList</code>: fecundity covariance over years.
</p>
<p><code>upars</code>: dispersal kernel coefficient, by random group, on meter^2 scale.
</p>
<p><code>rMu, rSe</code>: if more than one <code>seedName</code>, posterior mean and standard error on <code>R</code> matrix
</p>
<p>If <code>yearEffects</code>, then the following will be included in <code>$parameters</code>:
</p>
<p><code>betaYrMu, betaYrSe</code>: posterior mean and standard errors on fixed year effects.
</p>
<p><code>betaYrRand, betaYrRandSE</code>: posterior mean and standard errors on random year effects.
</p>
<p><code>alphaMu, alphaSe</code>: posterior mean and standard errors on random tree effects.
</p>
<p><code>aMu, aSe</code>: posterior mean and standard errors on random effects covariance.
</p>
</td></tr>
<tr><td><code>prediction</code></td>
<td>
<p><code>list</code> of latent variable estimates and prediction:
</p>
<p><code>fecPred</code> includes <code>matrEst, fecEstMu, fecEstSe</code> maturation and fecundity estimates and <code>matrPred, fecPred, fecEst</code> maturation and fecundity predictions.
</p>
<p><code>seedPred</code> includes seed predictions by species, from estimates of latent fecundity and maturation (<code>_estMean, _estSe</code>) and from the fully generative model (<code>_predMean, _predSe</code>).
</p>
<p>If <code>predictList</code> is passed to <code>mast</code>, then predictions are returned as seeds per m^2 (not per trap) for the regular prediction grid spaced <code>mapMeters</code> apart in the <code>data.frame seedPredGrid</code>.  Tree predictions are returned in<code> treePredGrid</code> are included. If the AR(p) model is used (<code>yearEffect$p</code> is supplied), then both <code>data.frames</code> include <code>p</code>-yr hind casts and <code>p</code>-yr forecasts.
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>James S Clark, <a href="mailto:jimclark@duke.edu">jimclark@duke.edu</a>
</p>


<h3>References</h3>

<p>Clark, J.S., C. Nunes, and B. Tomasek. 2019. Foodwebs based on unreliable foundations: spatio-temporal masting merged with consumer movement, storage, and diet. Ecological Monographs, e01381.
Qiu, T., ..., and J. S. Clark. 2023. Mutualist dispersers and the global distribution of masting: mediation by climate and fertility. Nature Plants, https://doi.org/10.1038/s41477-023-01446-5.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mastSim">mastSim</a></code> simulates data
</p>
<p>A more detailed vignette is can be obtained with:
</p>
<p><code>browseVignettes('mastif')</code>
</p>
<p>website 'http://sites.nicholas.duke.edu/clarklab/code/'.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# simulate data (see \link{\code{mastSim}})
seedNames  &lt;- specNames  &lt;- 'acerRubr'
sim &lt;- list(nyr=10, ntree=20, nplot=5, ntrap=40,
               specNames = specNames, seedNames = seedNames)
               
inputs   &lt;- mastSim(sim)        # simulate data
inputs$predList &lt;- list( mapMeters = 3, plots = inputs$plots[1], 
                         years = inputs$years ) 
output   &lt;- mastif( inputs = inputs, ng = 3000, burnin = 2000 )
# mastPlot(output)

# for Liriodendron
d &lt;- "https://github.com/jimclarkatduke/mast/blob/master/liriodendronExample.rData?raw=True"
repmis::source_data(d)

formulaFec &lt;- as.formula( ~ diam )   # fecundity model
formulaRep &lt;- as.formula( ~ diam )   # maturation model

yearEffect   &lt;- list(groups = 'species') 
randomEffect &lt;- list(randGroups = 'treeID', 
                     formulaRan = as.formula( ~ 1 ) )
inputs   &lt;- list( specNames = specNames, seedNames = seedNames, 
                  treeData = treeData, seedData = seedData, 
                  xytree = xytree, xytrap = xytrap, 
                  yearEffect = yearEffect, randomEffect = randomEffect )
output &lt;- mastif(inputs = inputs, formulaFec, formulaRep, ng = 1000, 
                 burnin = 400 )
summary(output)
# plot output:
# mastPlot(output)

</code></pre>

<hr>
<h2 id='mastif-package'>Mast Inference and Forecasting</h2><span id='topic+mastif-package'></span>

<h3>Description</h3>

<p>Seed production is estimated from censuses of trees and seed collections from traps.  From locations of known trees and seed traps, infers source strength, coefficients for predictor variables, and parameters for a dispersal kernel.  Fecundity is a state-space model allowing for random individual (tree) effects, random year effects and random AR(p) lag effects.  Estimates unknown redistribution of seed types to known species identities of trees.  Functions begin with 'mast' to avoid conflicts with other packages.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
  Package: </td><td style="text-align: left;"> mastif</td>
</tr>
<tr>
 <td style="text-align: left;">
  Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
  Version: </td><td style="text-align: left;"> 2.2</td>
</tr>
<tr>
 <td style="text-align: left;">
  Date: </td><td style="text-align: left;"> 2024-2-16</td>
</tr>
<tr>
 <td style="text-align: left;">
  License: </td><td style="text-align: left;"> GPL (&gt;= 2)</td>
</tr>
<tr>
 <td style="text-align: left;">
  URL: </td><td style="text-align: left;"> http://sites.nicholas.duke.edu/clarklab/code/</td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>

<p>The package mastif estimates fecundity of trees and dispersion of seed observed at seed traps, using information on locations of sources and detectors, and covariates that could explain source strength.  Data sets of this type are common and used to understand a range of processes related to seed dispersal, masting, environmental controls on reproduction, sex ratio, and allocation.
</p>
<p>Posterior simulation is done by Gibbs sampling.  Analysis is done by these functions:
</p>
<p><code><a href="#topic+mastif">mastif</a></code> fits model with Gibbs sampling.
</p>
<p><code><a href="#topic+mastSim">mastSim</a></code> simulates data for analysis by <code>mastif</code>.
</p>
<p><code><a href="#topic+mastFillCensus">mastFillCensus</a></code> aligns sample years in tree census data with seed trap data.
</p>
<p><code><a href="#topic+mastClimate">mastClimate</a></code> annotates tree data with covariates for fecundity modeling.
</p>
<p><code><a href="#topic+mastPlot">mastPlot</a></code> generates plots of the output from <code><a href="#topic+mastif">mastif</a></code>.
</p>


<h3>Author(s)</h3>

<p>Author: James S Clark, <a href="mailto:jimclark@duke.edu">jimclark@duke.edu</a>
</p>


<h3>References</h3>

<p>Clark, JS, C Nunes, and B Tomasek. 2019. Masting as an unreliable resource: spatio-temporal host diversity merged with consumer movement, storage, and diet. Ecological Monographs, e01381.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mastif">mastif</a></code>, 
<code><a href="#topic+mastSim">mastSim</a></code>
</p>
<p>A more detailed vignette is can be obtained with:
</p>
<p><code>browseVignettes('mastif')</code>
</p>

<hr>
<h2 id='mastMap'>Map data and predictions for mastif model</h2><span id='topic+mastMap'></span>

<h3>Description</h3>

<p>Maps dispersal data (trees and seed traps) with predictions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  mastMap(mapList)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mastMap_+3A_maplist">mapList</code></td>
<td>
<p><code>list</code> that includes <code>data.frame</code>s described in the <code>mastif</code> help page: <code>treeData</code>, <code>seedData</code>, <code>xytree</code>, <code>xytrap</code>. Alternatively, <code>mapList</code> can be an object of <code>class mastif</code> simulated by <code>mastSim</code> or fitted by <code>mast</code>.  If a <code>class mastif</code> object is used, it must have appended <code>mapPlot</code> (name of plot to map) and <code>mapYears</code> (years to map).  These and additional objects in <code>mapList</code> are summarized here:
</p>
<p><code>mapPlot</code>: <code>character</code> for the plot name, which appears in <code>treeData$plot</code> and <code>seedData$plot</code>.
</p>
<p><code>mapYears</code>: <code>numeric vector</code> containing years to plot, which appear in <code>treeData$year</code> and <code>seedData$year</code>.
</p>
<p><code>treeSymbol</code>: <code>character</code> indicating a column name in <code>treeData</code> holding numeric values that scale the sizes of trees in the map, e.g., <code>diam</code> for diameter.
</p>
<p><code>PREDICT</code>: if <code>TRUE</code>, then predicted seed will be mapped.  Must be predicted in <code>mastif</code>.
</p>
<p><code>xlim</code>: <code>vector</code> with upper and lower plot limits.
</p>
<p><code>ylim</code>: <code>vector</code> with upper and lower plot limits.
</p>
<p><code>MAPTRAPS</code>: include seed traps in map.
</p>
<p><code>MAPTREES</code>: include trees in map.
</p>
<p><code>seedMax</code>: <code>numeric</code> value can be used to set maximum seed symbol/prediction contour.
</p>
<p><code>fecMax</code>: <code>numeric</code> value can be used to set maximum fecundity symbol size.
</p>
<p><code>mfrow</code>: <code>numeric vector</code> of length-2 to set arrangement of maps on plot, as in <code>pars()</code>.
</p>
<p><code>LEGEND</code>: add <code>legend</code> with species names to map.
</p>
<p><code>plotScale</code>: some level of control on size of plot is possible with values &gt; 1.
</p>
<p><code>treeScale</code>: relative scale for tree symbols, default value = 1.
</p>
<p><code>trapScale</code>: relative scale for trap symbols, default value = 1.
</p>
<p><code>SCALEBAR</code>: add a scale bar with distance to bottom of map.
</p>
<p><code>scaleValue</code>: <code>numeric</code> value in meters used if <code>SCALEBAR = TRUE</code>.
</p>
<p><code>mfrow</code>: <code>numeric vector</code> of length-2, giving numbers of rows and columns for plots, see <code>help(pars)</code>. 
</p>
<p><code>COLORSCALE</code>: if <code>TRUE</code>, then a color scale is added for predicted seed.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Generates of map of seed traps and trees, with symbols scaled to the sizes relative to seed counts in <code>sdata$seedNames</code> and <code>treeSymbol</code>.  Sizes are adjusted with <code>scaleTree</code> and <code>scaleTrap</code>.
</p>
<p>If <code>PREDICT = TRUE</code>, then predictions come in the object fitted in <code>mastif</code> with <code>predictList</code> used to specify prediction plots and years.  See the help page for <code>mastif</code>. 
</p>
<p>More detailed vignettes can be obtained with:
</p>
<p><code>browseVignettes('mastif')</code>
</p>


<h3>Value</h3>

<p>Only graphical outputs.
</p>


<h3>Author(s)</h3>

<p>James S Clark, <a href="mailto:jimclark@duke.edu">jimclark@duke.edu</a>
</p>


<h3>References</h3>

<p>Clark, J.S., C. Nunes, and B. Tomasek. 2019. Foodwebs based on unreliable foundations: spatio-temporal masting merged with consumer movement, storage, and diet. Ecological Monographs, e01381.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mastSim">mastSim</a></code> simulates data
</p>
<p>A more detailed vignette is can be obtained with:
</p>
<p><code>browseVignettes('mastif')</code>
</p>
<p>website 'http://sites.nicholas.duke.edu/clarklab/code/'.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# simulate data (see \link{\code{mastSim}})
seedNames  &lt;- specNames  &lt;- 'acerRubr'
sim    &lt;- list(nyr=10, ntree=30, nplot=5,
          specNames = specNames, seedNames = seedNames)
inputs &lt;- mastSim(sim)

inputs$mapPlot &lt;- 'p1'
inputs$mapYears = inputs$years[1]

mastMap( inputs )

# for Pinus
d &lt;- "https://github.com/jimclarkatduke/mast/blob/master/pinusExample.rdata?raw=True"
repmis::source_data(d)

specNames &lt;- c("pinuEchi","pinuRigi","pinuStro","pinuTaed","pinuVirg")
seedNames &lt;- c(specNames, "pinuUNKN")

mapList &lt;- list( treeData = treeData, seedData = seedData, 
                 specNames = specNames, seedNames = seedNames, 
                 xytree = xytree, xytrap = xytrap, mapPlot = 'DUKE_BW', 
                 mapYears = c(2004:2007), treeScale = .5, trapScale=1.2, 
                 plotScale = 1.2, LEGEND=TRUE)
mastMap(mapList) 

</code></pre>

<hr>
<h2 id='mastPlot'>Plot mast model</h2><span id='topic+mastPlot'></span>

<h3>Description</h3>

<p>Plots data fitted with <code><a href="#topic+mastif">mastif</a></code> in package <code>mastif</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  mastPlot(output, plotPars = NULL)
  
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mastPlot_+3A_output">output</code></td>
<td>
<p><code>list</code> of class <code>mast</code>.</p>
</td></tr>
<tr><td><code id="mastPlot_+3A_plotpars">plotPars</code></td>
<td>
<p><code>list</code> of inputs for plotting can include:
</p>
<p><code>outFolder</code>:  if <code>SAVEPLOTS = TRUE</code> path to saved files.
</p>
<p><code>SAVEPLOTS = FALSE</code>: if <code>TRUE</code> writes plots to <code>.pdf</code> files.
</p>
<p><code>trueValues</code>:  if passed from <code>mastSim</code> output then <code>trueValues</code> will be included in plots.
</p>
<p><code>RMD</code>:  if set to <code>"pdf"</code> or <code>"html"</code> writes output to R markdown file in working directory.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>SAVEPLOTS = TRUE</code> plots are saved to files in <code>outFolder</code>. If <code>RMD = "pdf"</code>, output is written to a R markdown file that can be edited and knitted.  Maps are not included in this option.  Otherwise, plots are rendered to the screen.
</p>
<p>More detailed vignettes can be obtained with:
</p>
<p><code>browseVignettes('mastif')</code>
</p>


<h3>Value</h3>

<p>Currently, there are graphical outputs.
</p>


<h3>Author(s)</h3>

<p>James S Clark, <a href="mailto:jimclark@duke.edu">jimclark@duke.edu</a>
</p>


<h3>References</h3>

<p>Clark, J.S., C. Nunes, and B. Tomasek. 2019. Foodwebs based on unreliable foundations: spatio-temporal masting merged with consumer movement, storage, and diet. Ecological Monographs, e01381.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mastSim">mastSim</a></code> simulates data
</p>
<p>A more detailed vignette is can be obtained with:
</p>
<p><code>browseVignettes('mast')</code>
</p>
<p>website 'http://sites.nicholas.duke.edu/clarklab/code/'.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# simulate data 
seedNames  &lt;- specNames  &lt;- 'acerRubr'
sim &lt;- list(nyr=10, ntree=30, nplot=5, specNames = specNames, seedNames = seedNames)
inputs &lt;- mastSim(sim)
output &lt;- mastif( inputs = inputs, ng = 4000, burnin = 2000 )

# plot output 
# mastPlot( output, plotPars = list(trueValues = inputs$trueValues) )

</code></pre>

<hr>
<h2 id='mastPriors'>Obtain prior parameter values for mastif from file</h2><span id='topic+mastPriors'></span>

<h3>Description</h3>

<p>Prior parameter values may be saved in a file by species or by genus. <code>mastPriors</code> looks for a species-level prior first.  If not found, it can substutitute a genus-level prior.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  mastPriors(file, specNames, code, genus = 'NULL')
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mastPriors_+3A_file">file</code></td>
<td>
<p><code>character</code> giving the path and file name where parameters are stored (see Details).</p>
</td></tr>
<tr><td><code id="mastPriors_+3A_specnames">specNames</code></td>
<td>
<p><code>character vector</code> if names in <code>treeData$species</code>.</p>
</td></tr>
<tr><td><code id="mastPriors_+3A_code">code</code></td>
<td>
<p><code>character</code> name of column holding <code>specNames</code> in parameter <code>file</code>.</p>
</td></tr>
<tr><td><code id="mastPriors_+3A_genus">genus</code></td>
<td>
<p><code>character</code> name of genus held in &quot;genus&quot; column of parameter <code>file</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>file</code> includes rows with genera, given in column &quot;genus&quot;, or &quot;species&quot;.  Species rows also have an entry for genus, with the species code given in the column named <code>code</code>.  Additional columns are names of prior parameters, including:
</p>
<p><code>priorDist</code>: mean parameter for dispersal kernel (m), related to kernel parameter <code>u</code> as <code>d &lt;- pi*sqrt(u)/2</code>.  The estimated values for these parameters are found in <code>output$parameters$upars</code> and <code>output$parameters$dpars</code>, where <code>output</code> is an object fitted by <code>mastif</code>.
</p>
<p><code>minDist</code>: the lower bound for the mean parameter <code>d</code> of the dispersal kernel (m).  
</p>
<p><code>maxDist</code>: the upper bound for the mean parameter <code>d</code> of the dispersal kernel (m).  
</p>
<p><code>priorVDist</code>: variance on the mean parameter for dispersal kernel (m^2).  For large values, the prior distribution of <code>d</code> (and by variable change, <code>u</code>) becomes <code>dunif(d, minDist, maxDist)</code>.
</p>
<p><code>minDiam</code>: below this diameter trees of unknown status are assumed immature (cm). 
</p>
<p><code>maxDiam</code>: above this diameter trees of unknown status are assumed mature (cm).  
</p>
<p><code>maxFec</code>: maximum seeds per tree per year
</p>
<p>More detailed vignettes can be obtained with: <code>browseVignettes('mastif')</code>
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> with a row for each <code>specNames</code> and columns for prior parameter values.  Where <code>file</code> contains species-level parameter values, they will be used.  If a separate row in <code>file</code> holds genus-level parameters, with the entry for <code>code == 'NA'</code>, then genus-level parameters will be substituted.  In other words, these genus rows are default values.
</p>


<h3>Author(s)</h3>

<p>James S Clark, <a href="mailto:jimclark@duke.edu">jimclark@duke.edu</a>
</p>


<h3>References</h3>

<p>Clark, J.S., C. Nunes, and B. Tomasek. 2019. Foodwebs based on unreliable foundations: spatio-temporal masting merged with consumer movement, storage, and diet. Ecological Monographs, e01381.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mastFillCensus">mastFillCensus</a></code> to fill tree census
</p>
<p><code><a href="#topic+mastif">mastif</a></code> for analysis
</p>
<p>A more detailed vignette is can be obtained with:
</p>
<p><code>browseVignettes('mastif')</code>
</p>
<p>website 'http://sites.nicholas.duke.edu/clarklab/code/'.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
d &lt;- "https://github.com/jimclarkatduke/mast/blob/master/pinusExample.rdata?raw=True"
repmis::source_data(d)

# prior parameter values
pfile &lt;- tempfile(fileext = '.txt')
d &lt;- "https://github.com/jimclarkatduke/mast/blob/master/priorParameters.txt?raw=True"
download.file(d, destfile = pfile)

specNames &lt;- c("pinuEchi","pinuRigi","pinuStro","pinuTaed","pinuVirg")
seedNames &lt;- c(specNames, "pinuUNKN")

priorTable &lt;- mastPriors(file = pfile, specNames, 
                         code = 'code4', genus = 'pinus')

inputs   &lt;- list( specNames = specNames, seedNames = seedNames, 
                  treeData = treeData, seedData = seedData, 
                  xytree = xytree, xytrap = xytrap, 
                  priorTable = priorTable, seedTraits = seedTraits)

formulaRep &lt;- as.formula( ~ diam )
formulaFec &lt;- as.formula( ~ diam )        
  
output &lt;- mastif(inputs = inputs, formulaFec, formulaRep,
                 ng = 1000, burnin = 400)

</code></pre>

<hr>
<h2 id='mastSim'>Data simulation for mast model</h2><span id='topic+mastSim'></span>

<h3>Description</h3>

<p>Simulates data for analysis by <code><a href="#topic+mastif">mastif</a></code> in package <code>mastif</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  mastSim(sim)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mastSim_+3A_sim">sim</code></td>
<td>
<p><code>list</code> of inputs for simulation, see Details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>list</code> <code>sim</code> contains the following:
</p>
<p><code>specNames</code>: <code>character vector</code> of species names.
</p>
<p><code>seedNames</code>: <code>character vector</code> of seed names.
</p>
<p><code>nyr = 5</code>:  average number of years for a plot
</p>
<p><code>ntree = 10</code>:  average number of trees in <code>specNames</code> on a plot
</p>
<p><code>plotWide = 100</code>:  diameter of plot
</p>
<p><code>nplot = 3</code>:  number of plots
</p>
<p><code>ntrap = 20</code>:  average number of seed traps on a plot
</p>
<p><code>meanDist = 25</code>:  mean dispersal (meters)
</p>


<h3>Value</h3>

<p>Returns an object of <code><a href="base.html#topic+class">class</a> "mastif"</code>, a list containing the following components:
</p>
<table>
<tr><td><code>distall</code></td>
<td>
<p><code>matrix</code> of distances between all seed traps (rows) and trees (columns).  Block diagonal structure by plot, padded with the value <code>10000</code> for tree/trap combinations on different plots.</p>
</td></tr>
<tr><td><code>distall</code></td>
<td>
<p>seed trap by tree <code>matrix</code> of distances.</p>
</td></tr>
<tr><td><code>formulaFec</code></td>
<td>
<p><code>formula</code> for the fecundity model.</p>
</td></tr>
<tr><td><code>formulaRep</code></td>
<td>
<p><code>formula</code> for the maturation model.</p>
</td></tr>
<tr><td><code>plots</code></td>
<td>
<p><code>character vector</code> of plot names.</p>
</td></tr>
<tr><td><code>R</code></td>
<td>
<p>species to seed type matrix.</p>
</td></tr>
<tr><td><code>seedData</code></td>
<td>
<p><code>data.frame</code> of seed data needed for <code>mastif</code>.</p>
</td></tr>
<tr><td><code>seedNames</code></td>
<td>
<p><code>character vector</code> of seed types.</p>
</td></tr>
<tr><td><code>sim</code></td>
<td>
<p>inputs to <code>mastSim</code>.</p>
</td></tr>
<tr><td><code>specNames</code></td>
<td>
<p><code>character vector</code> of species.</p>
</td></tr>
<tr><td><code>treeData</code></td>
<td>
<p><code>data.frame</code> of tree data needed for <code>mastif</code>.</p>
</td></tr>
<tr><td><code>trueValues</code></td>
<td>
<p><code>list</code> holding true parameter values includes:
</p>
<p><code>fec</code>: <code>vector</code> of log fecundity states. 
</p>
<p><code>repr</code>: vector of maturation states.
</p>
<p><code>betaFec</code>: fecundity parameter values.
</p>
<p><code>betaRep</code>: maturation parameter values.
</p>
<p><code>upar</code>: dispersal parameter, m^2.
</p>
</td></tr>
<tr><td><code>xytrap</code></td>
<td>
<p><code>data.frame</code> of seed locations needed for <code>mastif</code>.</p>
</td></tr>
<tr><td><code>xytree</code></td>
<td>
<p><code>data.frame</code> of tree locations needed for <code>mastif</code>.</p>
</td></tr>
<tr><td><code>years</code></td>
<td>
<p><code>numeric vector</code> years.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>James S Clark, <a href="mailto:jimclark@duke.edu">jimclark@duke.edu</a>
</p>


<h3>References</h3>

<p>Clark, J.S., C. Nunes, and B. Tomasek. 2019. Foodwebs based on unreliable foundations: spatio-temporal masting merged with consumer movement, storage, and diet. Ecological Monographs, in press.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mastSim">mastSim</a></code> simulates data
</p>
<p>A more detailed vignette is can be obtained with:
</p>
<p><code>browseVignettes('mastif')</code>
</p>
<p>website 'http://sites.nicholas.duke.edu/clarklab/code/'.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# simulate data 
seedNames  &lt;- specNames  &lt;- 'acerRubr'
sim &lt;- list(nyr = 10, ntree = 30, nplot = 5, ntrap = 40, 
            specNames = specNames, seedNames = seedNames)
inputs &lt;- mastSim(sim)
output &lt;- mastif( inputs = inputs, ng = 500, burnin = 200 ) 

# increase iterations, then plot:
# output   &lt;- mastif( inputs = output, ng = 2000, burnin = 1000 ) 
# plot output
# mastPlot(output, plotPars = list(trueValues = inputs$trueValues) )

</code></pre>

<hr>
<h2 id='mastSpectralDensity'>Volatility and period for mast data</h2><span id='topic+mastSpectralDensity'></span>

<h3>Description</h3>

<p>Extracts time series attributes for tree or population fecundity.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  mastSpectralDensity( x, maxPeriod = length(x)/2, PLOT = FALSE, ylim = NULL )
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mastSpectralDensity_+3A_x">x</code></td>
<td>
<p><code>numeric vector</code> of sequential fecundity values.</p>
</td></tr>
<tr><td><code id="mastSpectralDensity_+3A_maxperiod">maxPeriod</code></td>
<td>
<p>the number of frequencies/periods to include.</p>
</td></tr>
<tr><td><code id="mastSpectralDensity_+3A_plot">PLOT</code></td>
<td>
<p><code>logical</code> to plot spectrum.</p>
</td></tr>
<tr><td><code id="mastSpectralDensity_+3A_ylim">ylim</code></td>
<td>
<p>if <code>PLOT</code>, values for lower and upper bounds.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Returns attributes of volatility and period for a sequence of fecundity values for a single tree (or population) in <code>x</code>, which may often be on a log scale.  
</p>
<p>More detailed examples can be obtained with: <code>browseVignettes('mastif')</code>
</p>


<h3>Value</h3>

<p>Returns a <code>list</code> that includes <code>spect</code>, a <code>matrix</code> of power values ordered by frequency (1/period). To permit comparisons between series that differ in length, <code>totVar</code> (total variance) and <code>volatility</code> (period-weighted variance) are divided by the length of the series. Mean and standard deviation for the weighted period are <code>periodMu</code> and <code>periodSd</code>.
</p>


<h3>Author(s)</h3>

<p>James S Clark, <a href="mailto:jimclark@duke.edu">jimclark@duke.edu</a>
</p>


<h3>References</h3>

<p>Qiu, T, ..., and J.S. Clark. 2023. Mutualist dispersers and the global distribution of masting: mediation by climate and fertility. in review.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mastif">mastif</a></code> for analysis
</p>
<p>A more detailed vignette is can be obtained with:
</p>
<p><code>browseVignettes('mastif')</code>
</p>
<p>website 'http://sites.nicholas.duke.edu/clarklab/code/'.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
d &lt;- "https://github.com/jimclarkatduke/mast/blob/master/outputAbies.rdata?raw=True"
repmis::source_data( d )

# single Abies tree from fitted output$prediction$fecPred:

wt &lt;- which( fecPred$treeID == "BAMT1-1" )
s  &lt;- mastSpectralDensity( log(fecPred$fecEstMu[ wt ]), PLOT = TRUE )

# population year effects (log scale) for an ecoRegion_species in output$parameters$betaYrRand:

x &lt;- betaYrRand['3_abiesAmabilis', ]    
x &lt;- x[ x != 0 ]                        # ecoRegion_species vary in observation years
s &lt;- mastSpectralDensity( x, PLOT = TRUE )

</code></pre>

<hr>
<h2 id='mastVolatility'>Volatility and period for mast data, combining trees in populations</h2><span id='topic+mastVolatility'></span>

<h3>Description</h3>

<p>Synthesis of volatility and period at the population scale.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  mastVolatility( treeID, year, fec, minLength = 6, minFrequency = 1/20 )
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mastVolatility_+3A_treeid">treeID</code></td>
<td>
<p><code>vector</code> of labels for individual trees</p>
</td></tr>
<tr><td><code id="mastVolatility_+3A_year">year</code></td>
<td>
<p><code>numeric vector</code> for year</p>
</td></tr>
<tr><td><code id="mastVolatility_+3A_fec">fec</code></td>
<td>
<p><code>numeric vector</code> for fecundity values</p>
</td></tr>
<tr><td><code id="mastVolatility_+3A_minlength">minLength</code></td>
<td>
<p>determines the minimum number of years to a tree to be included in population estimates</p>
</td></tr>
<tr><td><code id="mastVolatility_+3A_minfrequency">minFrequency</code></td>
<td>
<p>lowest frequency to include in volatility, period evaluation</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The three vectors <code>treeID, year, fec</code> are aligned by tree and year and, thus, of the same length. Tree fecundity values in the <code>numeric vector fec</code> can differ in number of years due to maturation times, deaths, and observation years.  Trees having fewer than <code>minLength</code> observations are omitted from the analysis. <code>minFrequency</code> is high enough to omit low frequencies that are missing in the shortest series to be compared.
</p>
<p>More detailed examples can be obtained with: <code>browseVignettes('mastif')</code>
</p>


<h3>Value</h3>

<p>Returns a <code>list</code> that includes <code>stats</code>, which holds the period- and fecundity-weighted estimates of volatility and period at the population scale. The <code>matrix statsDensity</code> holds the means and standard deviations by period (1/frequency). The <code>matrix mastMatrix</code> holds for each tree the number of years, mean log fecundity, variance, volatility, and period mean and standard deviation. Returned as tree by frequency are <code>density</code> and <code>frequency</code>.
</p>


<h3>Author(s)</h3>

<p>James S Clark, <a href="mailto:jimclark@duke.edu">jimclark@duke.edu</a>
</p>


<h3>References</h3>

<p>Qiu, T, ..., and J.S. Clark. 2023. Mutualist dispersers and the global distribution of masting: mediation by climate and fertility. in review.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mastif">mastif</a></code> for analysis
</p>
<p>A more detailed vignette is can be obtained with:
</p>
<p><code>browseVignettes('mastif')</code>
</p>
<p>website 'http://sites.nicholas.duke.edu/clarklab/code/'.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
d &lt;- "https://github.com/jimclarkatduke/mast/blob/master/outputAbies.rdata?raw=True"
repmis::source_data( d )

# all trees in a plot:

wi  &lt;- which( fecPred$plotSpec == 'BERK28 abiesGrandis' ) # tree-years in plot-species group
tmp &lt;- mastVolatility( treeID = fecPred$treeID[wi], year = fecPred$year[wi], 
                       fec = fecPred$fecEstMu[wi], minLength = 10 )
period  &lt;- 1/tmp$frequency
density &lt;- tmp$density

plot( NA, xlim = range( period, na.rm = TRUE ), ylim = range( density, na.rm = TRUE ),
      xlab = 'Period (yr)', ylab = 'Density', log = 'xy' )
      
for( i in 1:nrow(density) )lines( period[i,], density[i, ], col = 'grey' )
  lines( tmp$statsDensity['Period', ], tmp$statsDensity['Mean', ], lwd = 2 )

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
