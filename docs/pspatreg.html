<!DOCTYPE html><html lang="en"><head><title>Help for package pspatreg</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {pspatreg}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#pspatreg'><p>pspatreg: A package to estimate and make inference for spatial</p>
and spatio-temporal econometric regression models</a></li>
<li><a href='#fit_terms'><p>Compute terms of the non-parametric covariates in the</p>
semiparametric regression models.</a></li>
<li><a href='#impactsnopar'><p>Compute direct, indirect and total impacts functions</p>
for continous non-parametric covariates in semiparametric spatial
regression models.</a></li>
<li><a href='#impactspar'><p>Compute direct, indirect and total impacts</p>
for continous parametric covariates.</a></li>
<li><a href='#lwsp_it'><p>Spatial weight matrix for Italian provinces</p></a></li>
<li><a href='#map_it'><p>map of Italian provinces</p></a></li>
<li><a href='#methods_pspatreg'><p>Methods for class pspatreg</p></a></li>
<li><a href='#plot_impactsnopar'><p>Plot direct, indirect and total impacts  functions</p>
for continous non-parametric covariates in semiparametric spatial regression models.</a></li>
<li><a href='#plot_sp2d'><p>Plot and mapping spatial trends.</p></a></li>
<li><a href='#plot_sp3d'><p>Plot and mapping spatio-temporal trends.</p></a></li>
<li><a href='#plot_sptime'><p>Plot of time trends for spatio-temporal models in 3d.</p></a></li>
<li><a href='#plot_terms'><p>Plot terms of the non-parametric covariates in the</p>
semiparametric regression models.</a></li>
<li><a href='#print.summary.impactspar.pspatreg'><p>Print method for objects of class summary.impactspar.pspatreg</p></a></li>
<li><a href='#print.summary.pspatreg'><p>Print method for objects of class summary.pspatreg.</p></a></li>
<li><a href='#prod_it'><p>Productivity growth and internal net migration - Italian provinces</p></a></li>
<li><a href='#pspatfit'><p>Estimate spatial or spatio-temporal semiparametric</p>
regression models from a spatial econometric perspective.</a></li>
<li><a href='#pspl_terms'><p>Functions to include non-parametric continous covariates</p>
and spatial or spatio-temporal trends in semiparametric
regression models.</a></li>
<li><a href='#summary.impactspar.pspatreg'><p>Summary method for object of class impactspar.pspatreg.</p></a></li>
<li><a href='#summary.pspatreg'><p>Summary method for objects of class pspatreg.</p></a></li>
<li><a href='#unemp_it'><p>Regional unemployment rates Italian provinces</p></a></li>
<li><a href='#Wsp_it'><p>Spatial weight matrix for Italian provinces</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Spatial and Spatio-Temporal Semiparametric Regression Models
with Spatial Lags</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-10-06</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Roman Minguez &lt;roman.minguez@uclm.es&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimation and inference of spatial and spatio-temporal 
    semiparametric models including spatial or spatio-temporal non-parametric 
    trends, parametric and non-parametric covariates and, possibly, a spatial 
    lag for the dependent variable and temporal correlation in the noise.
    The spatio-temporal trend can be decomposed in ANOVA way including main and 
    interaction functional terms. Use of SAP algorithm to estimate the spatial 
    or spatio-temporal trend and non-parametric covariates. The methodology of 
    these models can be found in next references
    Basile, R. et al. (2014), &lt;<a href="https://doi.org/10.1016%2Fj.jedc.2014.06.011">doi:10.1016/j.jedc.2014.06.011</a>&gt;;
    Rodriguez-Alvarez, M.X. et al. (2015) &lt;<a href="https://doi.org/10.1007%2Fs11222-014-9464-2">doi:10.1007/s11222-014-9464-2</a>&gt; and,
    particularly referred to the focus of the package, Minguez, R., 
    Basile, R. and Durban, M. (2020) &lt;<a href="https://doi.org/10.1007%2Fs10260-019-00492-8">doi:10.1007/s10260-019-00492-8</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.2), methods (&ge; 4.2), stats (&ge; 4.2), graphics (&ge;
4.2)</td>
</tr>
<tr>
<td>Imports:</td>
<td>AmesHousing (&ge; 0.0.4), dplyr (&ge; 1.0.10), fields (&ge; 14.1),
ggplot2 (&ge; 3.3.6), grDevices (&ge; 4.1), MBA (&ge; 0.0-9), MASS
(&ge; 7.3-54), minqa (&ge; 1.2.5), Matrix (&ge; 1.4-1), numDeriv (&ge;
2016.8-1.1), plm (&ge; 2.6-2), Rdpack (&ge; 2.4), sf (&ge; 1.0-8),
spatialreg (&ge; 1.2-6), spdep (&ge; 1.2-7), splines (&ge; 4.2.2),
stringr (&ge; 1.4.1)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr (&ge; 1.40), rmarkdown (&ge; 2.18)</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RdMacros:</td>
<td>Rdpack</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/rominsal/pspatreg">https://github.com/rominsal/pspatreg</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/rominsal/pspatreg/issues">https://github.com/rominsal/pspatreg/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-06 09:43:24 UTC; Roman.Minguez</td>
</tr>
<tr>
<td>Author:</td>
<td>Roman Minguez <a href="https://orcid.org/0000-0002-0490-3181"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Roberto Basile <a href="https://orcid.org/0000-0002-4531-2820"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Maria Durban <a href="https://orcid.org/0000-0002-4272-7895"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Gonzalo Espana-Heredia [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-06 10:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='pspatreg'>pspatreg: A package to estimate and make inference for spatial
and spatio-temporal econometric regression models</h2><span id='topic+pspatreg'></span><span id='topic+pspatreg-package'></span>

<h3>Description</h3>

<p><span class="pkg">pspatreg</span> offers the user a collection of functions to
estimate and make inference of geoadditive spatial or spatio-temporal
semiparametric regression models of type <em>ps-sim</em>, <em>ps-sar</em>,
<em>ps-sem</em>, <em>ps-sarar</em>, <em>ps-sdm</em>, <em>ps-sdem</em> or
<em>ps-slx</em>. These type of specifications are very general and they can
include parametric and non-parametric covariates, spatial or
spatio-temporal non-parametric trends and spatial lags of the dependent and
independent variables and/or the noise of the model. The non-parametric
terms (either trends or covariates) are modeled using P-Splines. The
non-parametric trend can be decomposed in an ANOVA way including main and
interactions effects of 2nd and 3rd order. The estimation method can be
restricted maximum likelihood (REML) or maximum likelihood (ML).
</p>


<h3>Details</h3>

<p>Some functionalities that have been included in <span class="pkg">pspatreg</span>
package are:
</p>


<h3>1. Estimation of the semiparametric regression model</h3>

<p><span class="pkg">pspatreg</span>
allows the estimation of geoadditive spatial or spatio-temporal
semiparametric regression models which could include: </p>
 <ul>
<li><p> An
spatial or spatio-temporal trend, that is, a geoadditive model either for
cross-section data or for panel data. This trend can be decomposed in main
and interaction functions in an ANOVA way. The spatial (or spatio-temporal)
trend gather the potential spatial heterogeneity of the data. </p>
</li>
<li>
<p>Parametric covariates as usual in regression models. </p>
</li>
<li><p> Non-parametric
covariates in which the functional relationship is estimated from the data.
Both the trends and non-parametric covariates are modelled using P-splines.
</p>
</li>
<li><p> Spatial dependence adding spatial lags of the dependent and
independent variables as usual in spatial econometric models. These models
gather the potential spatial spillovers. </p>
</li></ul>
<p> Once specified, the whole model
can be estimated using either restricted maximum-likelihood (REML) or
maximum likelihood (ML). The spatial econometric specifications allowed in
<span class="pkg">pspatreg</span> are the following ones: </p>
 <ul>
<li> <p><em>ps-sim</em>:
geoadditive semiparametric model without spatial effects (in addition to
the spatial or spatio-temporal trend, if it is included). </p>
<p style="text-align: center;"><code class="reqn"> y =
  f(s_1,s_2,\tau_{t}) y + X \beta + + \sum_{i=1}^k g(z_i) + \epsilon </code>
</p>
<p> where:
</p>
 <ul>
<li> <p><code class="reqn">f(s_1,s_2,\tau_t)</code> is a smooth spatio-temporal trend
of the spatial coordinates <code class="reqn">s1,s_2</code> and of the temporal coordinates
<code class="reqn">\tau_t</code>. </p>
</li>
<li> <p><code class="reqn">X</code> is a matrix including values of parametric
covariates. </p>
</li>
<li> <p><code class="reqn">g(z_i)</code> are non-parametric smooth functions of the
covariates <code class="reqn">z_i</code>. </p>
</li>
<li> <p><code class="reqn">\epsilon ~ N(0,R)</code> where <code class="reqn"> R =
  \sigma^2 I_T</code> if errors are uncorrelated or it follows an AR(1) temporal
autoregressive structure for serially correlated errors. </p>
</li></ul>
 </li>
<li>
<p><em>ps-slx</em>: geoadditive semiparametric model with spatial lags of the
regresors (either parametric or non-parametric): </p>
<p style="text-align: center;"><code class="reqn"> y =
  f(s_1,s_2,\tau_{t}) + X \beta + (W_{N} \otimes I_T) X \theta + \sum_{i
  =1}^k g(z_i) + \sum_{i = 1}^k g((\gamma_i*W_{N} \otimes I_T) z_i) +
  \epsilon </code>
</p>
<p> where: </p>
 <ul>
<li> <p><code class="reqn">W_N</code> is the spatial weights matrix.
</p>
</li>
<li> <p><code class="reqn">I_T</code> is an identity matrix of order <code class="reqn">T</code> (<em>T = 1</em> for
pure spatial data). </p>
</li></ul>
 </li>
<li> <p><em>ps-sar</em>: geoadditive semiparametric model
with spatial lag of the dependent variable </p>
<p style="text-align: center;"><code class="reqn"> y = (\rho*W_{N} \otimes
  I_T) y + f(s_1,s_2,\tau_{t}) + X \beta + \sum_{i =1}^k g(z_i) + \epsilon </code>
</p>

</li>
<li> <p><em>ps-sem</em>: geoadditive semiparametric model with a spatial lag of
the noise of the model </p>
<p style="text-align: center;"><code class="reqn"> y = f(s_1,s_2,\tau_{t}) + X \beta + \sum_{i
  =1}^k g(z_i) + u </code>
</p>
 <p style="text-align: center;"><code class="reqn"> u = (\delta*W_{N} \otimes I_T) u + \epsilon </code>
</p>

</li>
<li> <p><em>ps-sdm</em>: geoadditive semiparametric model with spatial lags of
the endogenous variable and of the regressors (spatial durbin model) </p>
<p style="text-align: center;"><code class="reqn">
  y = (\rho*W_{N} \otimes I_T) y + f(s_1,s_2,\tau_{t}) + X \beta + (W_{N}
  \otimes I_T) X \theta + \sum_{i = 1}^k g(z_i) + \sum_{i = 1}^k
  g((\gamma_i*W_{N} \otimes I_T) z_i) + \epsilon </code>
</p>
 </li>
<li> <p><em>ps-sdem</em>:
geoadditive semiparametric model with spatial errors and spatial lags of
the endogenous variable and of the regressors </p>
<p style="text-align: center;"><code class="reqn"> y =
  f(s_1,s_2,\tau_{t}) + X \beta + (W_{N} \otimes I_T) X \theta + \sum_{i =
  1}^k g(z_i) + \sum_{i = 1}^k g((\gamma_i*W_{N} \otimes I_T) z_i) + u </code>
</p>

<p style="text-align: center;"><code class="reqn"> u = (\delta*W_{N} \otimes I_T) u + \epsilon </code>
</p>
 </li>
<li> <p><em>ps-sarar</em>:
geoadditive semiparametric model with a spatial lag for: both dependent
variable and errors </p>
<p style="text-align: center;"><code class="reqn"> y = (\rho*W_{N} \otimes I_T) y +
  f(s_1,s_2,\tau_{t}) + X \beta + (W_{N} \otimes I_T) X \theta + \sum_{i =
  1}^k g(z_i) + \sum_{i = 1}^k g((\gamma_i*W_{N} \otimes I_T) z_i) + u </code>
</p>

<p style="text-align: center;"><code class="reqn"> u = (\delta*W_{N} \otimes I_T) u + \epsilon </code>
</p>
 </li></ul>



<h3>2. Plot of the spatial and spatio-temporal trends</h3>

<p>Once estimated
the geoadditive semiparametric model, some functions of <span class="pkg">pspatreg</span> are
suited to make plots of the spatial or spatio-temporal trends. These
functions, named <code><a href="#topic+plot_sp2d">plot_sp2d</a></code> and <code><a href="#topic+plot_sp3d">plot_sp3d</a></code>, can deal
either with 'sf' objects or 'dataframe' objects including spatial coordinates
(see the examples of the functions). 
The function <code><a href="#topic+plot_sptime">plot_sptime</a></code> allows
to examine temporal trends for each spatial unit. Eventually, it is also
possible to get the plots on nonparametric covariates using
<code><a href="#topic+plot_terms">plot_terms</a></code>.
</p>


<h3>3. Impacts and spatial spillovers</h3>

<p>It is very common in spatial econometrics to
evaluate the multiplier impacts that a change in the value of a regressor,
in a point in the space, has on the explained variable. The <span class="pkg">pspatreg</span>
package allows the computation and inference of spatial impacts (direct,
indirect and total) either for parametric covariates or nonparametric
covariates (in the last case, the output are impact functions). The function
named <code><a href="#topic+impactspar">impactspar</a></code> compute the impacts for parametric
covariates in the usual way using simulation. On the other hand, the
function <code><a href="#topic+impactsnopar">impactsnopar</a></code> allows the computation of impact
functions for nonparametric covariates. For parametric covariates, 
the method to compute the impacts is the same than the
exposed in LeSage and Page (2009). For nonparametric covariates the 
method is described in the help of the function <code><a href="#topic+impactsnopar">impactsnopar</a></code>.
Both impact functions have dedicated methods to
get a summary, for the parametric covariates, and 
plots, for the nonparametric covariates, of the 
direct, indirect and total impacts.
</p>


<h3>4. Additional methods</h3>

<p>The package <span class="pkg">pspatreg</span> provides the usual
methods to extract information of the fitted models. The methods included
are: 
</p>
 
<ul>
<li> <p><code><a href="#topic+anova">anova</a></code>: provides tables of fitted
'pspatreg' models including information criteria (AIC and BIC),
log-likelihood and degrees of freedom of each fitted model.
Also allows to perform LR tests between nested  models.
</p>
</li>
<li> <p><code><a href="#topic+print">print</a></code> method is used to print short tables 
including the values of beta and spatial coefficients 
as well as p-values of significance test for each 
coefficient.
</p>
</li>
<li> <p><code><a href="base.html#topic+summary">summary</a></code> method displays the results of
the estimation for spatial and spatio-temporal trends, 
parametric and nonparametric covariates and spatial parameters.
</p>
</li>
<li> <p><code><a href="#topic+coef">coef</a></code> extractor function of the parametric and 
spatial coefficientes.
</p>
</li>
<li> <p><code><a href="#topic+fitted">fitted</a></code> extractor function of the  fitted values.
</p>
</li>
<li> <p><code><a href="#topic+logLik">logLik</a></code> extractor function of the log-likelihood.
</p>
</li>
<li> <p><code><a href="#topic+residuals">residuals</a></code> extractor function of the residuals.
</p>
</li>
<li> <p><code><a href="#topic+vcov">vcov</a></code> extractor function of the covariance matrix
of the estimated parameters. The argument <code>bayesian</code> 
(default = 'TRUE') allows to choose between sandwich 
(frequentist) or bayesian method to compute the variances and 
covariances. See Fahrmeir et al. (2021) for details.
</p>
</li></ul>



<h3>Datasets</h3>

<p><span class="pkg">pspatreg</span> includes a spatio-temporal panel database
including observations of unemployment,  economic variables 
and spatial coordinates (centroids) for 103 Italian provinces
in the period 1996-2019. 
This database is provided in RData  format and can be loaded 
using the command <code>data(unemp_it, package = "pspatreg")</code>. 
The database also includes a <em>W</em> spatial neighborhood matrix 
of the Italian provinces (computed using queen criterium). 
Furthermore, a map of Italian provinces is also included as an sf object. 
This map can be used to plot spatial and spatio-temporal trends estimated 
for each province. Some examples of spatial and spatio-temporal 
fitted trends are included in the help of the main function of 
<span class="pkg">pspatreg</span> package (see especially <code>?pspatfit</code>). 
See Minguez, Basile and Durban (2020) for additional details about 
this database. 
<br />
source: Italian National Institute of Statistics (ISTAT)
<em>https://www.istat.it</em>
<br /> <br />       
</p>
<p>For the spatial pure case, the examples included use the 
household database <code>ames</code> included in <span class="pkg">AmesHousing</span> package. 
See the help of <code>?AmesHousing::make_ames</code> for an explanation of the 
variables included in this database.
Examples of hedonic models including geoadditive spatial econometric
regressions are included in the examples of <span class="pkg">pspatreg</span> package.
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;"> 
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roberto Basile </td><td style="text-align: left;"> <a href="mailto:roberto.basile@univaq.it">roberto.basile@univaq.it</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Maria Durban </td><td style="text-align: left;">
  <a href="mailto:mdurban@est-econ.uc3m.es">mdurban@est-econ.uc3m.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Gonzalo Espana-Heredia </td><td style="text-align: left;">
  <a href="mailto:gehllanza@gmail.com">gehllanza@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> 
 </td>
</tr>

</table>



<h3>References</h3>

 
<ul>
<li><p> Basile, R.; Durban, M.; Minguez, R.; Montero, J. M.; and 
Mur, J. (2014). Modeling regional economic dynamics: Spatial
dependence, spatial heterogeneity and nonlinearities. 
<em>Journal of Economic Dynamics and Control</em>, (48), 229-245.
&lt;doi:10.1016/j.jedc.2014.06.011&gt;
</p>
</li>
<li><p> Eilers, P. and Marx, B. (1996). Flexible Smoothing with 
B-Splines and Penalties. <em>Statistical Science</em>, (11), 89-121.
</p>
</li>
<li><p> Eilers, P. and Marx, B. (2021). <em>Practical Smoothing. 
The Joys of P-Splines</em>. Cambridge University Press.
</p>
</li>
<li><p> Fahrmeir, L.; Kneib, T.;  Lang, S.; and Marx, B. (2021). 
<em>Regression. Models, Methods and Applications (2nd Ed.)</em>.
Springer.
</p>
</li>
<li><p> Lee, D. and Durban, M. (2011). P-Spline ANOVA Type Interaction 
Models for Spatio-Temporal Smoothing. <em>Statistical Modelling</em>, 
(11), 49-69. &lt;doi:10.1177/1471082X1001100104&gt;
</p>
</li>
<li><p> Lee, D. J., Durban, M., and Eilers, P. (2013). Efficient
two-dimensional smoothing with P-spline ANOVA mixed models 
and nested bases. <em>Computational Statistics &amp; Data Analysis</em>, 
(61), 22-37. &lt;doi:10.1016/j.csda.2012.11.013&gt;
</p>
</li>
<li><p> LeSage, J. and Pace, K. (2009). <em>Introduction to 
Spatial Econometrics</em>. CRC Press, Boca Raton.
</p>
</li>
<li><p> Minguez, R.; Basile, R. and Durban, M. (2020). An Alternative 
Semiparametric Model for Spatial Panel Data. <em>Statistical Methods and Applications</em>,
(29), 669-708. &lt;doi:	10.1007/s10260-019-00492-8&gt;
</p>
</li>
<li><p> Montero, J., Minguez, R., and Durban, M. (2012). SAR models 
with nonparametric spatial trends: A P-Spline approach. 
<em>Estadistica Espanola</em>, (54:177), 89-111.
</p>
</li>
<li><p> Rodriguez-Alvarez, M. X.; Kneib, T.; Durban, M.; Lee, D.J.
and Eilers, P. (2015). Fast smoothing parameter separation 
in multidimensional generalized P-splines: the SAP algorithm.
<em>Statistics and Computing</em> 25 (5), 941-957. 
&lt;doi:10.1007/s11222-014-9464-2&gt;
</p>
</li>
<li><p> Wood, S.N. (2017). <em>Generalized Additive Models. 
An Introduction with <code>R</code></em> (second edition). CRC Press, Boca Raton.
</p>
</li></ul>


<hr>
<h2 id='fit_terms'>Compute terms of the non-parametric covariates in the
semiparametric regression models.</h2><span id='topic+fit_terms'></span>

<h3>Description</h3>

<p>The <code>fit_terms</code> function compute both:
</p>

<ul>
<li><p> Non-parametric spatial (2d) or spatio-temporal (3d) trends 
including the decomposition in main and interaction trends 
when the model is ANOVA.
</p>
</li>
<li><p> Smooth functions <code class="reqn">f(x_i)</code> for non-parametric covariates 
in semiparametric models. It also includes standard errors and the 
decomposition of each non-parametric
term in fixed and random parts.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>fit_terms(object, variables, intercept = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fit_terms_+3A_object">object</code></td>
<td>
<p>object fitted using <code><a href="#topic+pspatfit">pspatfit</a></code> function.</p>
</td></tr>
<tr><td><code id="fit_terms_+3A_variables">variables</code></td>
<td>
<p>vector including names of non-parametric covariates. 
To fit the terms of non-parametric spatial (2d) or spatio-temporal 
(3d) trend this argument must be set equal to 'spttrend'. 
See <code>examples</code> in this function.</p>
</td></tr>
<tr><td><code id="fit_terms_+3A_intercept">intercept</code></td>
<td>
<p>add intercept to fitted term. Default = FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list including:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>fitted_terms</em> </td><td style="text-align: left;"> Matrix including terms in columns. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>se_fitted_terms</em> </td><td style="text-align: left;"> Matrix including standard errors of terms 
      in columns. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>fitted_terms_fixed</em> </td><td style="text-align: left;"> Matrix including fixed part of terms 
      in columns. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>se_fitted_terms_fixed</em> </td><td style="text-align: left;"> Matrix including standard errors of 
      fixed part of terms in columns. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>fitted_terms_random</em> </td><td style="text-align: left;"> Matrix including random part of terms 
      in columns. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>se_fitted_terms_random</em> </td><td style="text-align: left;"> Matrix including standard errors of 
      random part of terms in columns.</td>
</tr>
<tr>
 <td style="text-align: left;">
 </td>
</tr>

</table>

<p>This object can be used as an argument of <code><a href="#topic+plot_terms">plot_terms</a></code> function
to make plots of both non-parametric trends and smooth functions of 
covariates. See <em>examples</em> below.
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;"> 
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roberto Basile </td><td style="text-align: left;"> <a href="mailto:roberto.basile@univaq.it">roberto.basile@univaq.it</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Maria Durban </td><td style="text-align: left;">
  <a href="mailto:mdurban@est-econ.uc3m.es">mdurban@est-econ.uc3m.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Gonzalo Espana-Heredia </td><td style="text-align: left;">
  <a href="mailto:gehllanza@gmail.com">gehllanza@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> 
 </td>
</tr>

</table>



<h3>References</h3>

 
<ul>
<li><p> Lee, D. and Durban, M. (2011). P-Spline ANOVA Type Interaction 
Models for Spatio-Temporal Smoothing. <em>Statistical Modelling</em>, 
(11), 49-69. &lt;doi:10.1177/1471082X1001100104&gt;
</p>
</li>
<li><p> Eilers, P. and Marx, B. (2021). <em>Practical Smoothing. 
The Joys of P-Splines</em>. Cambridge University Press.
</p>
</li>
<li><p> Fahrmeir, L.; Kneib, T.;  Lang, S.; and Marx, B. (2021). 
<em>Regression. Models, Methods and Applications (2nd Ed.)</em>.
Springer.
</p>
</li>
<li><p> Wood, S.N. (2017). <em>Generalized Additive Models. 
An Introduction with <code>R</code></em> (second edition). CRC Press, Boca Raton.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+pspatfit">pspatfit</a></code> estimate spatial or spatio-temporal 
semiparametric regression models. The model can be of type <em>ps-sim</em>,
<em>ps-sar</em>, <em>ps-slx</em>, <em>ps-sem</em>, <em>ps-sdm</em> or 
<em>ps-sarar</em>.
</p>
</li>
<li> <p><code><a href="#topic+plot_terms">plot_terms</a></code> plot smooth functions of non-parametric
covariates.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>###################### Examples using a panel data of rate of unemployment 
###################### in 103 Italian provinces during the period 1996-2014.
library(pspatreg)
data(unemp_it, package = "pspatreg")
lwsp_it &lt;- spdep::mat2listw(Wsp_it)
#######  No Spatial Trend: PSAR including a spatial 
#######  lag of the dependent variable
form1 &lt;- unrate ~ partrate + agri + cons + 
                  pspl(serv, nknots = 15) +
                  pspl(empgrowth, nknots = 20)  
gamsar &lt;- pspatfit(form1, data = unemp_it, 
                    type = "sar", listw = lwsp_it)
summary(gamsar)

######  Fit non-parametric terms 
######  (spatial trend must be name "spttrend")
list_varnopar &lt;- c("serv", "empgrowth")
terms_nopar &lt;- fit_terms(gamsar, list_varnopar)

######################  Plot non-parametric terms
plot_terms(terms_nopar, unemp_it)
 
</code></pre>

<hr>
<h2 id='impactsnopar'>Compute direct, indirect and total impacts functions 
for continous non-parametric covariates in semiparametric spatial 
regression models.</h2><span id='topic+impactsnopar'></span>

<h3>Description</h3>

<p>Compute and plot direct, indirect and total impact functions 
for non-parametric covariates included in a semiparametric spatial
or spatio-temporal econometric model. This model must include a 
spatial lag of the dependent variable and/or non-parametric covariates, 
to have indirect impacts different from 0, otherwise, total and direct 
function impacts are the same. The models can be of type <em>ps-sar</em>, 
<em>ps-sarar</em>, <em>ps-sdm</em>, <em>ps-sdem</em> or
<em>ps-slx</em>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>impactsnopar(
  obj,
  variables = NULL,
  listw = NULL,
  alpha = 0.05,
  viewplot = TRUE,
  smooth = TRUE,
  span = c(0.1, 0.1, 0.2)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="impactsnopar_+3A_obj">obj</code></td>
<td>
<p><em>pspatfit</em> object fitted using <code><a href="#topic+pspatfit">pspatfit</a></code> function.</p>
</td></tr>
<tr><td><code id="impactsnopar_+3A_variables">variables</code></td>
<td>
<p>vector including names of non-parametric covariates to 
obtain impulse functions. If NULL all the nonparametric covariates are 
included. Default = NULL.</p>
</td></tr>
<tr><td><code id="impactsnopar_+3A_listw">listw</code></td>
<td>
<p>should be a spatial neighbours list object created for example by <code>nb2listw</code> from <code>spdep</code> package. 
It can also be a spatial weighting matrix of order (NxN) instead of a listw neighbours list object.</p>
</td></tr>
<tr><td><code id="impactsnopar_+3A_alpha">alpha</code></td>
<td>
<p>numerical value for the significance level of the pointwise 
confidence interval of the impact functions. Default 0.05.</p>
</td></tr>
<tr><td><code id="impactsnopar_+3A_viewplot">viewplot</code></td>
<td>
<p>Default 'TRUE' to plot impacts. If FALSE use <code><a href="#topic+plot_impactsnopar">plot_impactsnopar</a></code> to plot impacts</p>
</td></tr>
<tr><td><code id="impactsnopar_+3A_smooth">smooth</code></td>
<td>
<p>Default 'TRUE'. Whether to smooth fitted impacts or not.</p>
</td></tr>
<tr><td><code id="impactsnopar_+3A_span">span</code></td>
<td>
<p>span for the kernel of the smoothing (see <code><a href="stats.html#topic+loess">loess</a></code> 
for details). Default c(0.1, 0.1, 0.2)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To compute the impact functions of the non-parametric covariates, first 
it is used the function 
<code><a href="#topic+fit_terms">fit_terms</a></code> to get fitted values of the terms and 
standard errors of the fitted values for each non-parametric covariate. 
Then, the intervals for the fitted term are computed as <br />
</p>
<p><em> fitted_values plus/minus quantile*standard errors </em> <br />
</p>
<p>where <em>quantile</em> is the corresponding quantile of the N(0,1) 
distribution. The total impact function is computed as: <br />
</p>
<p><code>solve(kronecker((I_N - rho*W_N), It), fitted_values) </code> <br />
</p>
<p>where <em>(I_N - rho*W_N)</em> matrix is the spatial lag matrix and 
<em>It</em> is an identity matrix of order equals to the temporal periods 
(<em>t</em>). Obviously, <em>t = 1</em> for pure spatial econometric models. 
The upper and lower bounds of the total impact functions are computed 
using the previous formula but using 
<em>fitted_values plus/minus quantile*standard errors</em> instead
of <em>fitted_values</em>. <br />
</p>
<p>The direct impacts function is computed using the formula: <br />
</p>
<p><code>diag(solve(kronecker((I_N - rho*W_N), It),
                              diag(fitted_values))</code> <br />
</p>
<p>that is, the fitted values are put in the main diagonal of 
a diagonal matrix and, afterwards, the spatial lag is applied over 
this diagonal matrix. Finally, the main diagonal of the resulting
matrix is considered the direct impact function. 
The upper and lower bounds of the direct impact functions are computed 
using the previous formula but using 
<em>fitted_values plus/minus quantile*standard errors</em> instead
of <em>fitted_values</em>. <br />
</p>
<p>Eventually, the indirect impacts function are computed as the 
difference between both total and direct impact functions, that is: <br />
</p>
<p><em>indirect impact function = total impacts function -
direct impacts function</em> <br />
</p>
<p>In this way we can get both, the indirect impact functions and upper and
lower bounds of the indirect impact functions. <br />
</p>
<p>It is important to remark that, usually, the indirect impact functions 
are very wiggly. To get ride of this problem, the argument <code>smooth</code> 
(default = 'TRUE') allows to smooth the impacts function using the 
<code><a href="stats.html#topic+loess">loess</a></code> 
function available in <span class="pkg">stats</span>. This is very convenient when the 
indirect impacts function is plotted.
</p>


<h3>Value</h3>

<p>A list including
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>impnopar_tot</em> </td><td style="text-align: left;"> Matrix including total impacts in columns. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>impnopar_dir</em> </td><td style="text-align: left;"> Matrix including direct impacts in columns. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>impnopar_ind</em> </td><td style="text-align: left;"> Matrix including indirect 
                             impacts in columns. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>impnopar_tot_up</em> </td><td style="text-align: left;"> Matrix including upper bounds of 
                                total impacts in columns. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>impnopar_dir_up</em> </td><td style="text-align: left;"> Matrix including upper bounds of 
                                direct impacts in columns. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>impnopar_ind_up</em> </td><td style="text-align: left;"> Matrix including upper bounds of 
                                indirect impacts in columns. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>impnopar_tot_low</em> </td><td style="text-align: left;"> Matrix including lower bounds of 
                                 total impacts in columns. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>impnopar_dir_low</em> </td><td style="text-align: left;"> Matrix including lower bounds of 
                                 direct impacts in columns. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>impnopar_ind_low</em> </td><td style="text-align: left;"> Matrix including lower bounds of 
                                 indirect impacts in columns. </td>
</tr>
<tr>
 <td style="text-align: left;">
 </td>
</tr>

</table>



<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;"> 
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roberto Basile </td><td style="text-align: left;"> <a href="mailto:roberto.basile@univaq.it">roberto.basile@univaq.it</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Maria Durban </td><td style="text-align: left;">
  <a href="mailto:mdurban@est-econ.uc3m.es">mdurban@est-econ.uc3m.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Gonzalo Espana-Heredia </td><td style="text-align: left;">
  <a href="mailto:gehllanza@gmail.com">gehllanza@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> 
 </td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Basile, R.; Durban, M.; Minguez, R.; Montero, J. M.; and 
Mur, J. (2014). Modeling regional economic dynamics: Spatial
dependence, spatial heterogeneity and nonlinearities. 
<em>Journal of Economic Dynamics and Control</em>, (48), 229-245.
&lt;doi:10.1016/j.jedc.2014.06.011&gt;
</p>
</li>
<li><p> Eilers, P. and Marx, B. (2021). <em>Practical Smoothing. 
The Joys of P-Splines</em>. Cambridge University Press.
</p>
</li>
<li><p> Fahrmeir, L.; Kneib, T.;  Lang, S.; and Marx, B. (2021). 
<em>Regression. Models, Methods and Applications (2nd Ed.)</em>.
Springer.
</p>
</li>
<li><p> LeSage, J. and Pace, K. (2009). <em>Introduction to 
Spatial Econometrics</em>. CRC Press, Boca Raton.
</p>
</li>
<li><p> Minguez, R.; Basile, R. and Durban, M. (2020). An Alternative 
Semiparametric Model for Spatial Panel Data. <em>Statistical Methods and Applications</em>,
(29), 669-708. &lt;doi:	10.1007/s10260-019-00492-8&gt;
</p>
</li>
<li><p> Montero, J., Minguez, R., and Durban, M. (2012). SAR models 
with nonparametric spatial trends: A P-Spline approach. 
<em>Estadistica Espanola</em>, (54:177), 89-111.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+pspatfit">pspatfit</a></code> estimate spatial or spatio-temporal semiparametric 
regression models.
</p>
</li>
<li> <p><code><a href="#topic+impactspar">impactspar</a></code> compute and simulate total, direct and indirect impacts
for parametric continuous covariates.
</p>
</li>
<li> <p><code><a href="#topic+fit_terms">fit_terms</a></code> compute terms for smooth functions for non-parametric
continuous covariates and for non-parametric trends.
</p>
</li>
<li> <p><code><a href="#topic+plot_impactsnopar">plot_impactsnopar</a></code> plot the non-parametric impacts functions
allowing for previous smoothing.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>################################################
# Examples using spatial data of Ames Houses.
###############################################
# Getting and preparing the data
library(pspatreg)
library(spdep)
library(sf)
ames &lt;- AmesHousing::make_ames() # Raw Ames Housing Data
ames_sf &lt;- st_as_sf(ames, coords = c("Longitude", "Latitude"))
ames_sf$Longitude &lt;- ames$Longitude
ames_sf$Latitude &lt;- ames$Latitude
ames_sf$lnSale_Price &lt;- log(ames_sf$Sale_Price)
ames_sf$lnLot_Area &lt;- log(ames_sf$Lot_Area)
ames_sf$lnTotal_Bsmt_SF &lt;- log(ames_sf$Total_Bsmt_SF+1)
ames_sf$lnGr_Liv_Area &lt;- log(ames_sf$Gr_Liv_Area)
ames_sf1 &lt;- ames_sf[(duplicated(ames_sf$Longitude) == FALSE), ]
form1 &lt;- lnSale_Price ~ Fireplaces + Garage_Cars +
          pspl(lnLot_Area, nknots = 20) + 
          pspl(lnTotal_Bsmt_SF, nknots = 20) +
          pspl(lnGr_Liv_Area, nknots = 20)    


########### Constructing the spatial weights matrix
coord_sf1 &lt;- cbind(ames_sf1$Longitude, ames_sf1$Latitude)
k5nb &lt;- knn2nb(knearneigh(coord_sf1, k = 5, 
                          longlat = TRUE, use_kd_tree = FALSE), sym = TRUE)
lw_ames &lt;- nb2listw(k5nb, style = "W", 
                  zero.policy = FALSE)
gamsar &lt;- pspatfit(form1, data = ames_sf1, 
                   type = "sar", listw = lw_ames,
                   method = "Chebyshev")
summary(gamsar)
nparimpacts &lt;- impactsnopar(gamsar, listw = lw_ames, viewplot = TRUE)
################################################
 ######## Examples using a panel data of rate of
 ######## unemployment for 103 Italian provinces in period 1996-2014.
library(pspatreg)
data(unemp_it, package = "pspatreg") 
## Wsp_it is a matrix. Create a neighboord list 
lwsp_it &lt;- spdep::mat2listw(Wsp_it)
######  No Spatial Trend: PSAR including a spatial 
######  lag of the dependent variable
form1 &lt;- unrate ~ partrate + agri + cons + empgrowth +
                 pspl(serv, nknots = 15)
gamsar &lt;- pspatfit(form1, 
                    data = unemp_it, 
                    type = "sar", 
                    listw = lwsp_it)
 summary(gamsar)
 ###### Non-Parametric Total, Direct and Indirect impacts
 imp_nparvar &lt;- impactsnopar(gamsar, 
                             listw = lwsp_it, 
                             viewplot = TRUE)
                              

</code></pre>

<hr>
<h2 id='impactspar'>Compute direct, indirect and total impacts
for continous parametric covariates.</h2><span id='topic+impactspar'></span>

<h3>Description</h3>

<p>Compute direct, indirect and total 
impacts for parametric covariates included in a semiparametric spatial
or spatio-temporal model. The models can be of type <em>ps-sar</em>, 
<em>ps-sarar</em>, <em>ps-sdm</em>, <em>ps-sdem</em> or
<em>ps-slx</em>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>impactspar(obj, ..., tr = NULL, R = 1000, listw = NULL, tol = 1e-06, Q = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="impactspar_+3A_obj">obj</code></td>
<td>
<p>A 'pspatreg' object created by <code><a href="#topic+pspatfit">pspatfit</a></code>.</p>
</td></tr>
<tr><td><code id="impactspar_+3A_...">...</code></td>
<td>
<p>Arguments passed through to methods in the <span class="pkg">coda</span> package</p>
</td></tr>
<tr><td><code id="impactspar_+3A_tr">tr</code></td>
<td>
<p>A vector of traces of powers of the spatial weights matrix created using <code>trW</code>, for approximate impact measures; if not given, <code>listw</code> must be given for exact measures (for small to moderate spatial weights matrices); the traces must be for the same spatial weights as were used in fitting the spatial regression, and must be row-standardised</p>
</td></tr>
<tr><td><code id="impactspar_+3A_r">R</code></td>
<td>
<p>If given, simulations are used to compute distributions for the impact measures, returned as <code>mcmc</code> objects; the objects are used for convenience but are not output by an MCMC process</p>
</td></tr>
<tr><td><code id="impactspar_+3A_listw">listw</code></td>
<td>
<p>If <code>tr</code> is not given, a spatial weights object as created by <code>nb2listw</code>; they must be the same spatial weights as were used in fitting the spatial regression, but do not have to be row-standardised</p>
</td></tr>
<tr><td><code id="impactspar_+3A_tol">tol</code></td>
<td>
<p>Argument passed to <code>mvrnorm</code>: tolerance (relative to largest variance) for numerical lack of positive-definiteness in the coefficient covariance matrix</p>
</td></tr>
<tr><td><code id="impactspar_+3A_q">Q</code></td>
<td>
<p>default NULL, else an integer number of cumulative power series impacts to calculate if <code>tr</code> is given</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is similar to the 
<code><a href="spatialreg.html#topic+impacts">impacts</a></code> method used in <span class="pkg">spatialreg</span>.
package. The function
<code><a href="#topic+impactspar">impactspar</a></code> obtains the three type of impacts (total, direct
and indirect) together with a measure of statistical 
significance, according to the randomization approach described in 
LeSage and Pace (2009). Briefly, they suggest to obtain a 
sequence of <em>nsim</em> random matrices using a multivariate normal 
distribution N(0; <em>Sigma</em>), being <em>Sigma</em> the estimated 
covariance matrix of the fitted <em>beta</em> for parametric covariates
and spatial parameters of the model. 
These random matrices, combined with the values of the fitted 
<em>beta</em> for parametric covariates and the estimated 
values of the spatial parameters, are used to obtain simulated values. 
The function <code><a href="#topic+impactspar">impactspar</a></code> obtains the standard 
deviations using the <em>nsim</em> simulated impacts in the randomization 
procedure, which are used to test the significance of the estimated 
impacts for the original data.
Finally, if the spatial model is type = &quot;slx&quot; or &quot;sdem&quot;, then there is no
need to simulate to make inference of the impacts. The standard errors of the 
impacts are computed directly using the <em>Sigma</em> matrix of the estimated
covariances of <em>beta</em> and spatial parameters.
</p>


<h3>Value</h3>

<p>An object of class <em>impactspar.pspatreg</em>. Can be printed
with <code>summary</code>.
</p>
<p>If <code>type = "sar", "sdm", "sarar"</code>, the object returned is a list 
with 4 objects including the type of model and three matrices including the simulated
total, direct and indirect impacts:         
</p>

<table>
<tr>
 <td style="text-align: left;">
   <em>type</em> </td><td style="text-align: left;"> Type of spatial econometric model. </td>
</tr>
<tr>
 <td style="text-align: left;">
   <em>mimpactstot</em> </td><td style="text-align: left;"> Matrix including simulated total impacts 
                           for each variable in rows. </td>
</tr>
<tr>
 <td style="text-align: left;">
   <em>mimpactsdir</em> </td><td style="text-align: left;"> Matrix including simulated direct impacts 
                           for each variable in rows. </td>
</tr>
<tr>
 <td style="text-align: left;">
   <em>mimpactsind</em> </td><td style="text-align: left;"> Matrix including simulated indirect impacts 
                           for each variable in rows. </td>
</tr>
<tr>
 <td style="text-align: left;">
   </td>
</tr>

</table>

<p>If <code>type = "slx", "sdem"</code> the object returned is a list 
with 5 objects including the type of model and four matrices including 
the computed total, direct and indirect impacts, the standard errors,
the z-values and p-values of each type of impact:
</p>

<table>
<tr>
 <td style="text-align: left;">
   <em>type</em> </td><td style="text-align: left;"> Type of spatial econometric model. </td>
</tr>
<tr>
 <td style="text-align: left;">
   <em>mimpact</em> </td><td style="text-align: left;"> Matrix including computed total, direct and indirect
                       impacts for each variable in rows. </td>
</tr>
<tr>
 <td style="text-align: left;">
   <em>semimpact</em> </td><td style="text-align: left;"> Matrix including standard errors of total, direct 
                         and indirect impacts for each variable 
                         in rows. </td>
</tr>
<tr>
 <td style="text-align: left;">
   <em>zvalmimpact</em> </td><td style="text-align: left;"> Matrix including z-values of total, direct 
                         and indirect impacts for each variable 
                         in rows. </td>
</tr>
<tr>
 <td style="text-align: left;">
   <em>pvalmimpact</em> </td><td style="text-align: left;"> Matrix including p-values of total, direct 
                         and indirect impacts for each variable 
                         in rows. </td>
</tr>
<tr>
 <td style="text-align: left;">
   </td>
</tr>

</table>



<h3>References</h3>

 
<ul>
<li><p> LeSage, J. and Pace, K. (2009). <em>Introduction to 
Spatial Econometrics</em>. CRC Press, Boca Raton.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+pspatfit">pspatfit</a></code> estimate spatial or spatio-temporal 
semiparametric ps-sar, ps-sem, ps-sarar, ps-slx or 
ps-durbin regression models.
</p>
</li>
<li> <p><code><a href="#topic+impactsnopar">impactsnopar</a></code> compute total, direct and indirect impact
functions for non-parametric continuous covariates.
</p>
</li>
<li> <p><code><a href="#topic+fit_terms">fit_terms</a></code> compute smooth term functions for 
non-parametric continuous covariates.
</p>
</li>
<li> <p><code><a href="spdep.html#topic+impacts">impacts</a></code> similar function in <span class="pkg">spdep</span> 
package to compute impacts in spatial parametric econometric 
models.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>################################################
#### Examples using a panel data of rate of
##### unemployment for 103 Italian provinces in period 1996-2014.
library(pspatreg)
data(unemp_it, package = "pspatreg")
## Wsp_it is a matrix. Create a neighboord list 
lwsp_it &lt;- spdep::mat2listw(Wsp_it)
## short sample for spatial pure case (2d)
########  No Spatial Trend: PSAR including a spatial 
########  lag of the dependent variable
form1 &lt;- unrate ~ partrate + agri + cons + empgrowth +
                 pspl(serv, nknots = 15) 
### example with type = "sar"                   
gamsar &lt;- pspatfit(form1, 
                   data = unemp_it, 
                   type = "sar", 
                   listw = lwsp_it)
summary(gamsar)
###### Parametric Total, Direct and Indirect Effects
imp_parvar &lt;- impactspar(gamsar, listw = lwsp_it)
summary(imp_parvar)

### example with type = "slx"                   

gamslx &lt;- pspatfit(form1, 
                   data = unemp_it, 
                   type = "slx", 
                   listw = lwsp_it)
                   
summary(gamslx)
###### Parametric Total, Direct and Indirect Effects
imp_parvarslx &lt;- impactspar(gamslx, listw = lwsp_it)
summary(imp_parvarslx)

</code></pre>

<hr>
<h2 id='lwsp_it'>Spatial weight matrix for Italian provinces</h2><span id='topic+lwsp_it'></span>

<h3>Description</h3>

<p>A spatial weight matrix row-standardized for Italian NUTS-3 provinces
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lwsp_it
</code></pre>


<h3>Format</h3>

<p>A row-standardized squared matrix with 107 rows and columns. 
The rows and columns follow the same order than provinces included in 
<em>unemp_it</em> data frame.
</p>


<h3>Source</h3>

<p>Italian National Institute of Statistics (ISTAT)
<em>https://www.istat.it</em>
</p>

<hr>
<h2 id='map_it'>map of Italian provinces</h2><span id='topic+map_it'></span>

<h3>Description</h3>

<p>An sf object including a map of Italian NUTS-3 provinces
</p>


<h3>Usage</h3>

<pre><code class='language-R'>map_it
</code></pre>


<h3>Format</h3>

<p>An sf object with 103 rows and 2 columns:
</p>

<dl>
<dt>COD_PRO</dt><dd><p>province (NUTS-3) coded as a number.</p>
</dd>
<dt>geometry</dt><dd><p>geometry (polygons) of the sf object.</p>
</dd>
</dl>



<h3>Source</h3>

<p>Italian National Institute of Statistics (ISTAT)
<em>https://www.istat.it</em>
</p>

<hr>
<h2 id='methods_pspatreg'>Methods for class pspatreg</h2><span id='topic+methods_pspatreg'></span><span id='topic+anova'></span><span id='topic+anova.pspatreg'></span><span id='topic+coef'></span><span id='topic+coef.pspatreg'></span><span id='topic+fitted'></span><span id='topic+fitted.pspatreg'></span><span id='topic+logLik'></span><span id='topic+logLik.pspatreg'></span><span id='topic+residuals'></span><span id='topic+residuals.pspatreg'></span><span id='topic+vcov'></span><span id='topic+vcov.pspatreg'></span><span id='topic+print'></span><span id='topic+print.pspatreg'></span>

<h3>Description</h3>

<p>The <code><a href="#topic+anova">anova</a></code> function provides tables of fitted 
'pspatreg' models including information criteria (AIC and BIC), 
log-likelihood and degrees of freedom of each fitted model. The 
argument 'lrtest' allows to perform LR tests between nested models.
The <code><a href="#topic+print">print</a></code> function is used to print short tables including the 
values of beta and spatial coefficients as well as p-values of significance test for each 
coefficient. This can be used as an alternative to 
<code><a href="#topic+summary.pspatreg">summary.pspatreg</a></code> when a brief output is needed. 
The rest of methods works in the usual way.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'pspatreg'
anova(object, ..., lrtest = TRUE)

## S3 method for class 'pspatreg'
coef(object, ...)

## S3 method for class 'pspatreg'
fitted(object, ...)

## S3 method for class 'pspatreg'
logLik(object, ..., REML = FALSE)

## S3 method for class 'pspatreg'
residuals(object, ...)

## S3 method for class 'pspatreg'
vcov(object, ..., bayesian = TRUE)

## S3 method for class 'pspatreg'
print(x, digits = max(3L, getOption("digits") - 3L), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="methods_pspatreg_+3A_object">object</code></td>
<td>
<p>a 'pspatreg' object created by 
<code><a href="#topic+pspatfit">pspatfit</a></code>.</p>
</td></tr>
<tr><td><code id="methods_pspatreg_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="methods_pspatreg_+3A_lrtest">lrtest</code></td>
<td>
<p>logical value to compute likelihood ratio
test for nested models in 'anova' method. Default = 'TRUE'</p>
</td></tr>
<tr><td><code id="methods_pspatreg_+3A_reml">REML</code></td>
<td>
<p>logical value to get restricted log-likelihood 
instead of the usual log-likelihood. Default = 'FALSE'</p>
</td></tr>
<tr><td><code id="methods_pspatreg_+3A_bayesian">bayesian</code></td>
<td>
<p>logical value to get bayesian or frequentist
covariance matrix for parametric terms. Default = 'FALSE'</p>
</td></tr>
<tr><td><code id="methods_pspatreg_+3A_x">x</code></td>
<td>
<p>similar to <code>object</code> argument for <code>print()</code> 
and <code>plot</code> functions.</p>
</td></tr>
<tr><td><code id="methods_pspatreg_+3A_digits">digits</code></td>
<td>
<p>number of digits to show in printed tables.
Default: max(3L, getOption(&quot;digits&quot;) - 3L).</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>anova:</code> An object of class <em>anova</em>. Can be printed
with <code>summary</code>. 
If argument <code>lrtest = TRUE</code> (default), the object 
returned includes an LR test for nested models. 
In this case, a warning message is printed to emphasize 
that the LR test remains valid only for nested models.
</p>
<p><code>coef:</code> A numeric vector including spatial parameters and
parameters corresponding to parametric covariates. 
Also includes fixed parameters for non-parametric 
covariates. Can be printed with <code>print</code>.
</p>
<p><code>fitted:</code> A numeric vector including fitted values for the 
dependent variable.
</p>
<p><code>logLik:</code> An object of class <em>logLik</em>. Can be printed
with <code>print</code>.
If argument <code>REML = FALSE</code> (default), the object returns 
the value of log-likelihood function in the optimum. 
If argument <code>REML = TRUE</code>, the object returns 
the value of restricted log-likelihood function in 
the optimum.
</p>
<p><code>residuals:</code> A numeric vector including residuals of the model.
</p>
<p><code>vcov:</code> A matrix including the covariance matrix for the
estimated parameters.
If argument <code>bayesian = TRUE</code> (default), the 
covariance matrix is computed using bayesian
method. 
If argument <code>bayesian = FALSE</code> , the 
covariance matrix is computed using sandwich method. 
See Fahrmeir et al. (2021) for details.
</p>
<p><code>print:</code> No return value
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
    Roman Minguez </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
    Roberto Basile </td><td style="text-align: left;"> <a href="mailto:roberto.basile@univaq.it">roberto.basile@univaq.it</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
    Maria Durban </td><td style="text-align: left;"> <a href="mailto:mdurban@est-econ.uc3m.es">mdurban@est-econ.uc3m.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
    Gonzalo Espana-Heredia </td><td style="text-align: left;"> <a href="mailto:gehllanza@gmail.com">gehllanza@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>References</h3>

 
<ul>
<li><p> Fahrmeir, L.; Kneib, T.;  Lang, S.; and Marx, B. (2021). 
<em>Regression. Models, Methods and Applications (2nd Ed.)</em>.
Springer.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(pspatreg)
###############################################
# Examples using spatial data of Ames Houses.
###############################################
# Getting and preparing the data
library(spdep)
library(sf)
ames &lt;- AmesHousing::make_ames() # Raw Ames Housing Data
ames_sf &lt;- st_as_sf(ames, coords = c("Longitude", "Latitude"))
ames_sf$Longitude &lt;- ames$Longitude
ames_sf$Latitude &lt;- ames$Latitude
ames_sf$lnSale_Price &lt;- log(ames_sf$Sale_Price)
ames_sf$lnLot_Area &lt;- log(ames_sf$Lot_Area)
ames_sf$lnTotal_Bsmt_SF &lt;- log(ames_sf$Total_Bsmt_SF+1)
ames_sf$lnGr_Liv_Area &lt;- log(ames_sf$Gr_Liv_Area)
ames_sf1 &lt;- ames_sf[(duplicated(ames_sf$Longitude) == FALSE), ]
####  GAM pure with pspatreg
form1 &lt;- lnSale_Price ~ Fireplaces + Garage_Cars +
          pspl(lnLot_Area, nknots = 20) + 
          pspl(lnTotal_Bsmt_SF, nknots = 20) +
          pspl(lnGr_Liv_Area, nknots = 20)    
gampure &lt;- pspatfit(form1, data = ames_sf1)
summary(gampure)

#' ########### Constructing the spatial weights matrix
coord_sf1 &lt;- cbind(ames_sf1$Longitude, ames_sf1$Latitude)
k5nb &lt;- knn2nb(knearneigh(coord_sf1, k = 5, 
                          longlat = TRUE, use_kd_tree = FALSE), sym = TRUE)
lw_ames &lt;- nb2listw(k5nb, style = "W", 
                  zero.policy = FALSE)

#####################  GAM + SAR Model
gamsar &lt;- pspatfit(form1, data = ames_sf1, 
                   type = "sar", listw = lw_ames,
                   method = "Chebyshev")
summary(gamsar)

### Compare Models
anova(gampure, gamsar, lrtest = FALSE)
## logLikelihood 
logLik(gamsar)
## Restricted logLikelihood
logLik(gamsar, REML = TRUE)
## Parametric and spatial coefficients
print(gamsar)
coef(gamsar)
## Frequentist (sandwich) covariance matrix 
## (parametric terms)
vcov(gamsar, bayesian = FALSE)      
## Bayesian covariance matrix (parametric terms)
vcov(gamsar)
#####################################
#### Fitted Values and Residuals
plot(gamsar$fitted.values, 
     ames_sf1$lnSale_Price, 
     xlab = 'fitted values', 
     ylab = "unrate",
     type = "p", cex.lab = 1.3, 
     cex.main = 1.3,
     main = "Fitted Values gamsar model")      
plot(gamsar$fitted.values, gamsar$residuals, 
     xlab = 'fitted values', ylab = "residuals",
     type = "p", cex.lab = 1.3, cex.main=1.3,
     main = "Residuals geospsar model")

     
</code></pre>

<hr>
<h2 id='plot_impactsnopar'>Plot direct, indirect and total impacts  functions 
for continous non-parametric covariates in semiparametric spatial regression models.</h2><span id='topic+plot_impactsnopar'></span>

<h3>Description</h3>

<p>Plot direct, indirect and total impacts functions for 
non-parametric covariates included in a semiparametric spatial
or spatio-temporal SAR model. This model must include a spatial
lag of the dependent variable (SAR) to have indirect effects 
different from 0, otherwise, total and direct function effects 
are the same. The effect functions can be smoothed to overcome 
the instabilities created by the premultiplication of matrix
<code class="reqn">(I - \rho W)^{-1}</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_impactsnopar(
  impactsnopar,
  data,
  smooth = TRUE,
  span = c(0.1, 0.1, 0.2),
  dynamic = FALSE,
  nt = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_impactsnopar_+3A_impactsnopar">impactsnopar</code></td>
<td>
<p>object returned from <code><a href="#topic+impactsnopar">impactsnopar</a></code> function.</p>
</td></tr>
<tr><td><code id="plot_impactsnopar_+3A_data">data</code></td>
<td>
<p>dataframe with the data.</p>
</td></tr>
<tr><td><code id="plot_impactsnopar_+3A_smooth">smooth</code></td>
<td>
<p>logical value to choose smoothing of the effects function
prior to plot. Default TRUE.</p>
</td></tr>
<tr><td><code id="plot_impactsnopar_+3A_span">span</code></td>
<td>
<p>span for the kernel of the smoothing (see <code><a href="stats.html#topic+loess">loess</a></code> 
for details). Default c(0.1, 0.1, 0.2).</p>
</td></tr>
<tr><td><code id="plot_impactsnopar_+3A_dynamic">dynamic</code></td>
<td>
<p>Logical value to set a dynamic model.
Dynamic models include a temporal lag of the dependent
variable in the right-hand side of the equation.
Default = 'FALSE'.</p>
</td></tr>
<tr><td><code id="plot_impactsnopar_+3A_nt">nt</code></td>
<td>
<p>Number of temporal periods. It is needed
for dynamic models.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>plot of the direct, indirect and total impacts  function for each non-parametric
covariate included in the object returned from <code><a href="#topic+impactsnopar">impactsnopar</a></code>.
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;"> 
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roberto Basile </td><td style="text-align: left;"> <a href="mailto:roberto.basile@univaq.it">roberto.basile@univaq.it</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> 
  Maria Durban </td><td style="text-align: left;"> <a href="mailto:mdurban@est-econ.uc3m.es">mdurban@est-econ.uc3m.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> 
  Gonzalo Espana-Heredia </td><td style="text-align: left;"> <a href="mailto:gehllanza@gmail.com">gehllanza@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> 
 </td>
</tr>

</table>



<h3>References</h3>

 
<ul>
<li><p> Basile, R.; Durban, M.; Minguez, R.; Montero, J. M.; and 
Mur, J. (2014). Modeling regional economic dynamics: Spatial
dependence, spatial heterogeneity and nonlinearities. 
<em>Journal of Economic Dynamics and Control</em>, (48), 229-245.
&lt;doi:10.1016/j.jedc.2014.06.011&gt;               
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+impactsnopar">impactsnopar</a></code> compute total, direct and indirect effect
functions for non-parametric continuous covariates.
</p>
</li>
<li> <p><code><a href="#topic+fit_terms">fit_terms</a></code> compute smooth functions for non-parametric
continuous covariates.
</p>
</li>
<li> <p><code><a href="#topic+plot_terms">plot_terms</a></code> plot the terms of non-parametric covariates.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>################################################
# Examples using spatial data of Ames Houses.
###############################################
# Getting and preparing the data
library(pspatreg)
library(spdep)
library(sf)
ames &lt;- AmesHousing::make_ames() # Raw Ames Housing Data
ames_sf &lt;- st_as_sf(ames, coords = c("Longitude", "Latitude"))
ames_sf$Longitude &lt;- ames$Longitude
ames_sf$Latitude &lt;- ames$Latitude
ames_sf$lnSale_Price &lt;- log(ames_sf$Sale_Price)
ames_sf$lnLot_Area &lt;- log(ames_sf$Lot_Area)
ames_sf$lnTotal_Bsmt_SF &lt;- log(ames_sf$Total_Bsmt_SF+1)
ames_sf$lnGr_Liv_Area &lt;- log(ames_sf$Gr_Liv_Area)
ames_sf1 &lt;- ames_sf[(duplicated(ames_sf$Longitude) == FALSE), ]
                    
form1 &lt;- lnSale_Price ~ Fireplaces + Garage_Cars +
          pspl(lnLot_Area, nknots = 20) + 
          pspl(lnTotal_Bsmt_SF, nknots = 20) +
          pspl(lnGr_Liv_Area, nknots = 20)    


########### Constructing the spatial weights matrix
coord_sf1 &lt;- cbind(ames_sf1$Longitude, ames_sf1$Latitude)
k5nb &lt;- knn2nb(knearneigh(coord_sf1, k = 5, 
                          longlat = TRUE, use_kd_tree = FALSE), sym = TRUE)
lw_ames &lt;- nb2listw(k5nb, style = "W", 
                  zero.policy = FALSE)
gamsar &lt;- pspatfit(form1, data = ames_sf1, 
                   type = "sar", listw = lw_ames,
                   method = "Chebyshev")
summary(gamsar)
nparimpacts &lt;- impactsnopar(gamsar, listw = lw_ames, viewplot = FALSE)
plot_impactsnopar(nparimpacts, data = ames_sf1, smooth = TRUE)
###### Examples using a panel data of rate of
###### unemployment for 103 Italian provinces in period 1996-2014.
library(pspatreg)
data(unemp_it)
## Wsp_it is a matrix. Create a neighboord list 
lwsp_it &lt;- spdep::mat2listw(Wsp_it)
## short sample for spatial pure case (2d)
########  No Spatial Trend: PSAR including a spatial 
########  lag of the dependent variable
form1 &lt;- unrate ~ partrate + agri + cons + empgrowth +
                  pspl(serv, nknots = 15) 
gamsar &lt;- pspatfit(form1, data = unemp_it, 
                   type = "sar", 
                   listw = lwsp_it)
summary(gamsar)
###### Non-Parametric Total, Direct and Indirect impacts
imp_nparvar &lt;- impactsnopar(gamsar, alpha = 0.05,
                            listw = lwsp_it, 
                            viewplot = TRUE)  
##### This returns the same result but using plot_impactsnopar()
imp_nparvar &lt;- impactsnopar(gamsar, listw = lwsp_it, alpha = 0.05,
                            viewplot = FALSE)
plot_impactsnopar(imp_nparvar, data = unemp_it, 
                   smooth = TRUE)
                    

</code></pre>

<hr>
<h2 id='plot_sp2d'>Plot and mapping spatial trends.</h2><span id='topic+plot_sp2d'></span>

<h3>Description</h3>

<p>Make plots and maps of the spatial trends 
in 2d of the objects fitted with <code><a href="#topic+pspatfit">pspatfit</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_sp2d(
  object,
  data,
  coordinates = NULL,
  npoints = 300,
  cexpoints = 0.25,
  addcontour = TRUE,
  addpoints = TRUE,
  addmain = TRUE,
  addint = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_sp2d_+3A_object">object</code></td>
<td>
<p>object returned from <code><a href="#topic+pspatfit">pspatfit</a></code></p>
</td></tr>
<tr><td><code id="plot_sp2d_+3A_data">data</code></td>
<td>
<p>either sf or dataframe with the data.</p>
</td></tr>
<tr><td><code id="plot_sp2d_+3A_coordinates">coordinates</code></td>
<td>
<p>coordinates matrix if <code>data</code> is not an sf object.</p>
</td></tr>
<tr><td><code id="plot_sp2d_+3A_npoints">npoints</code></td>
<td>
<p>number of points to use in the interpolation.</p>
</td></tr>
<tr><td><code id="plot_sp2d_+3A_cexpoints">cexpoints</code></td>
<td>
<p>size of the points. Default = 0.25</p>
</td></tr>
<tr><td><code id="plot_sp2d_+3A_addcontour">addcontour</code></td>
<td>
<p>Logical value to add contour lines.</p>
</td></tr>
<tr><td><code id="plot_sp2d_+3A_addpoints">addpoints</code></td>
<td>
<p>Logical value to add spatial points to the graphics.</p>
</td></tr>
<tr><td><code id="plot_sp2d_+3A_addmain">addmain</code></td>
<td>
<p>Add f1_main and f2_main plots in psanova case.</p>
</td></tr>
<tr><td><code id="plot_sp2d_+3A_addint">addint</code></td>
<td>
<p>Add f12_int in psanova case.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>plots and maps of the spatial trends
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;"> 
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roberto Basile </td><td style="text-align: left;"> <a href="mailto:roberto.basile@univaq.it">roberto.basile@univaq.it</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Maria Durban </td><td style="text-align: left;">
  <a href="mailto:mdurban@est-econ.uc3m.es">mdurban@est-econ.uc3m.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Gonzalo Espana-Heredia </td><td style="text-align: left;">
  <a href="mailto:gehllanza@gmail.com">gehllanza@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> 
 </td>
</tr>

</table>



<h3>References</h3>

 
<ul>
<li><p> Lee, D. and Durban, M. (2011). P-Spline ANOVA Type Interaction 
Models for Spatio-Temporal Smoothing. <em>Statistical Modelling</em>, 
(11), 49-69. &lt;doi:10.1177/1471082X1001100104&gt;
</p>
</li>
<li><p> Eilers, P. and Marx, B. (2021). <em>Practical Smoothing. 
The Joys of P-Splines</em>. Cambridge University Press.
</p>
</li>
<li><p> Fahrmeir, L.; Kneib, T.;  Lang, S.; and Marx, B. (2021). 
<em>Regression. Models, Methods and Applications (2nd Ed.)</em>.
Springer.
</p>
</li>
<li><p> Wood, S.N. (2017). <em>Generalized Additive Models. 
An Introduction with <code>R</code></em> (second edition). CRC Press, Boca Raton.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(pspatreg)
######## EXAMPLE 2D WITH AMES DATA 
######## getting and preparing the data
library(spdep)
ames &lt;- AmesHousing::make_ames() # Raw Ames Housing Data
ames_sf &lt;- st_as_sf(ames, coords = c("Longitude", "Latitude"))
ames_sf$Longitude &lt;- ames$Longitude
ames_sf$Latitude &lt;- ames$Latitude
ames_sf$lnSale_Price &lt;- log(ames_sf$Sale_Price)
ames_sf$lnLot_Area &lt;- log(ames_sf$Lot_Area)
ames_sf$lnTotal_Bsmt_SF &lt;- log(ames_sf$Total_Bsmt_SF+1)
ames_sf$lnGr_Liv_Area &lt;- log(ames_sf$Gr_Liv_Area)
ames_sf1 &lt;- ames_sf[(duplicated(ames_sf$Longitude) == FALSE), ]

######## formula of the model in Ames
form2d &lt;- lnSale_Price ~ Fireplaces + Garage_Cars +
          pspl(lnLot_Area, nknots = 20) + 
          pspl(lnTotal_Bsmt_SF, nknots = 20) +
          pspl(lnGr_Liv_Area, nknots = 20) +
          pspt(Longitude, Latitude, 
               nknots = c(10, 10), 
               psanova = FALSE)

########### Constructing the spatial weights matrix
coord_sf1 &lt;- cbind(ames_sf1$Longitude, ames_sf1$Latitude)
k5nb &lt;- knn2nb(knearneigh(coord_sf1, k = 5, 
                          longlat = TRUE, use_kd_tree = FALSE), sym = TRUE)
lw_ames &lt;- nb2listw(k5nb, style = "W", 
                  zero.policy = FALSE)

######## fit the model
sp2dsar &lt;- pspatfit(form2d, data = ames_sf1, 
                    listw = lw_ames, 
                    method = "Chebyshev", 
                    type = "sar")
summary(sp2dsar)

####### plot spatial trend for spatial point coordinate
plot_sp2d(sp2dsar, data = ames_sf1)

###### MODEL WITH ANOVA DESCOMPOSITION
 form2d_psanova &lt;- lnSale_Price ~ Fireplaces + Garage_Cars +
                   pspl(lnLot_Area, nknots = 20) + 
                   pspl(lnTotal_Bsmt_SF, nknots = 20) +
                   pspl(lnGr_Liv_Area, nknots = 20) +
                   pspt(Longitude, Latitude, 
                        nknots = c(10, 10), 
                        psanova = TRUE)
      
sp2danovasar &lt;- pspatfit(form2d_psanova, 
                        data = ames_sf1, 
                        listw = lw_ames,
                        method = "Chebyshev", 
                        type = "sar")
summary(sp2danovasar)                         
                        
###### PLOT ANOVA DESCOMPOSITION MODEL
plot_sp2d(sp2danovasar, data = ames_sf1, 
          addmain = TRUE, addint = TRUE)
           
</code></pre>

<hr>
<h2 id='plot_sp3d'>Plot and mapping spatio-temporal trends.</h2><span id='topic+plot_sp3d'></span>

<h3>Description</h3>

<p>Make plots and maps of the spatio-temporal trends 
in 3d of the objects fitted with <code><a href="#topic+pspatfit">pspatfit</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_sp3d(object, data, time_var, time_index, addmain = TRUE, addint = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_sp3d_+3A_object">object</code></td>
<td>
<p>object returned from <code><a href="#topic+pspatfit">pspatfit</a></code></p>
</td></tr>
<tr><td><code id="plot_sp3d_+3A_data">data</code></td>
<td>
<p>sf object.</p>
</td></tr>
<tr><td><code id="plot_sp3d_+3A_time_var">time_var</code></td>
<td>
<p>name of the temporal variable in data.</p>
</td></tr>
<tr><td><code id="plot_sp3d_+3A_time_index">time_index</code></td>
<td>
<p>vector of time points to plot.</p>
</td></tr>
<tr><td><code id="plot_sp3d_+3A_addmain">addmain</code></td>
<td>
<p>Add f1_main and f2_main plots in psanova case.</p>
</td></tr>
<tr><td><code id="plot_sp3d_+3A_addint">addint</code></td>
<td>
<p>Add f12_int in psanova case.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>plots and maps of the spatial trends
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;"> 
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roberto Basile </td><td style="text-align: left;"> <a href="mailto:roberto.basile@univaq.it">roberto.basile@univaq.it</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Maria Durban </td><td style="text-align: left;">
  <a href="mailto:mdurban@est-econ.uc3m.es">mdurban@est-econ.uc3m.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Gonzalo Espana-Heredia </td><td style="text-align: left;">
  <a href="mailto:gehllanza@gmail.com">gehllanza@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> 
</td>
</tr>

</table>



<h3>References</h3>

 
<ul>
<li><p> Lee, D. and Durban, M. (2011). P-Spline ANOVA Type Interaction 
Models for Spatio-Temporal Smoothing. <em>Statistical Modelling</em>, 
(11), 49-69. &lt;doi:10.1177/1471082X1001100104&gt;
</p>
</li>
<li><p> Eilers, P. and Marx, B. (2021). <em>Practical Smoothing. 
The Joys of P-Splines</em>. Cambridge University Press.
</p>
</li>
<li><p> Fahrmeir, L.; Kneib, T.;  Lang, S.; and Marx, B. (2021). 
<em>Regression. Models, Methods and Applications (2nd Ed.)</em>.
Springer.
</p>
</li>
<li><p> Wood, S.N. (2017). <em>Generalized Additive Models. 
An Introduction with <code>R</code></em> (second edition). CRC Press, Boca Raton.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(pspatreg)
library(sf)
data(unemp_it, package = "pspatreg")
lwsp_it &lt;- spdep::mat2listw(Wsp_it)
unemp_it_sf &lt;- st_as_sf(dplyr::left_join(
                               unemp_it, map_it,  
                        by = c("prov" = "COD_PRO")))
######## FORMULA of the model
form3d_psanova_restr &lt;- unrate ~ partrate + agri + cons +
                        pspl(serv, nknots = 15) + 
                        pspl(empgrowth, nknots = 20) +
                        pspt(long, lat, year, 
                             nknots = c(18, 18, 8),
                             psanova = TRUE, 
                             nest_sp1 = c(1, 2, 3), 
                             nest_sp2 = c(1, 2, 3),
                             nest_time = c(1, 2, 2),
                             f1t = FALSE, f2t = FALSE)


####### FIT the model
sp3danova &lt;- pspatfit(form3d_psanova_restr, 
                      data = unemp_it_sf)
summary(sp3danova)                          

###### Plot spatio-temporal trends for different years
plot_sp3d(sp3danova, data = unemp_it_sf, 
          time_var = "year", 
          time_index = c(1996, 2005, 2019),
          addmain = FALSE, addint = FALSE)
###### Plot of spatio-temporal trend, main effects 
######      and interaction effect for a year
plot_sp3d(sp3danova, data = unemp_it_sf, 
          time_var = "year", 
          time_index = c(2019),
          addmain = TRUE, addint = TRUE)
          
#### Plot of temporal trend for each province
plot_sptime(sp3danova, 
            data = unemp_it, 
            time_var = "year", 
            reg_var = "prov") 

             
</code></pre>

<hr>
<h2 id='plot_sptime'>Plot of time trends for spatio-temporal models in 3d.</h2><span id='topic+plot_sptime'></span>

<h3>Description</h3>

<p>Make plots of the temporal trends for each region
fitted with <code><a href="#topic+pspatfit">pspatfit</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_sptime(object, data, time_var, reg_var)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_sptime_+3A_object">object</code></td>
<td>
<p>object returned from <code><a href="#topic+pspatfit">pspatfit</a></code></p>
</td></tr>
<tr><td><code id="plot_sptime_+3A_data">data</code></td>
<td>
<p>either sf or dataframe with the data.</p>
</td></tr>
<tr><td><code id="plot_sptime_+3A_time_var">time_var</code></td>
<td>
<p>name of the temporal variable in data.</p>
</td></tr>
<tr><td><code id="plot_sptime_+3A_reg_var">reg_var</code></td>
<td>
<p>name of the regional variable in data.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>time series plots of the temporal trend for each region
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;"> 
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roberto Basile </td><td style="text-align: left;"> <a href="mailto:roberto.basile@univaq.it">roberto.basile@univaq.it</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Maria Durban </td><td style="text-align: left;">
  <a href="mailto:mdurban@est-econ.uc3m.es">mdurban@est-econ.uc3m.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Gonzalo Espana-Heredia </td><td style="text-align: left;">
  <a href="mailto:gehllanza@gmail.com">gehllanza@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> 
 </td>
</tr>

</table>



<h3>References</h3>

 
<ul>
<li><p> Lee, D. and Durban, M. (2011). P-Spline ANOVA Type Interaction 
Models for Spatio-Temporal Smoothing. <em>Statistical Modelling</em>, 
(11), 49-69. &lt;doi:10.1177/1471082X1001100104&gt;
</p>
</li>
<li><p> Eilers, P. and Marx, B. (2021). <em>Practical Smoothing. 
The Joys of P-Splines</em>. Cambridge University Press.
</p>
</li>
<li><p> Fahrmeir, L.; Kneib, T.;  Lang, S.; and Marx, B. (2013). 
<em>Regression. Models, Methods and Applications</em>.
Springer.
</p>
</li>
<li><p> Wood, S.N. (2017). <em>Generalized Additive Models. 
An Introduction with <code>R</code></em> (second edition). CRC Press, Boca Raton.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(pspatreg)
data(unemp_it, package = "pspatreg")
lwsp_it &lt;- spdep::mat2listw(Wsp_it)

###### FORMULA OF THE MODEL
form3d_psanova &lt;- unrate ~ partrate + agri + cons +
                  pspl(serv, nknots = 15) + 
                  pspl(empgrowth, nknots = 20) +
                  pspt(long, lat, year, 
                       nknots = c(18, 18, 8),
                       psanova = TRUE, 
                       nest_sp1 = c(1, 2, 3), 
                       nest_sp2 = c(1, 2, 3),
                       nest_time = c(1, 2, 2))


####### FIT the model
sp3danova &lt;- pspatfit(form3d_psanova, 
                      data = unemp_it, 
                      listw = lwsp_it, 
                      method = "Chebyshev") 

summary(sp3danova)

######## Plot of temporal trend for each province 
plot_sptime(sp3danova, 
            data = unemp_it, 
            time_var = "year", 
            reg_var = "prov")


</code></pre>

<hr>
<h2 id='plot_terms'>Plot terms of the non-parametric covariates in the
semiparametric regression models.</h2><span id='topic+plot_terms'></span>

<h3>Description</h3>

<p>For each non-parametric covariate the plot of the term
includes confidence intervals and the decomposition in fixed and 
random part when the term is reparameterized as a mixed model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_terms(
  fitterms,
  data,
  type = "global",
  alpha = 0.05,
  listw = NULL,
  dynamic = FALSE,
  nt = NULL,
  decomposition = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_terms_+3A_fitterms">fitterms</code></td>
<td>
<p>object returned from <code><a href="#topic+fit_terms">fit_terms</a></code> function.</p>
</td></tr>
<tr><td><code id="plot_terms_+3A_data">data</code></td>
<td>
<p>dataframe or sf with the data.</p>
</td></tr>
<tr><td><code id="plot_terms_+3A_type">type</code></td>
<td>
<p>type of term plotted between &quot;global&quot; (Default), 
&quot;fixed&quot; or &quot;random&quot;.</p>
</td></tr>
<tr><td><code id="plot_terms_+3A_alpha">alpha</code></td>
<td>
<p>numerical value for the significance level of the pointwise 
confidence intervals of the nonlinear terms. Default 0.05.</p>
</td></tr>
<tr><td><code id="plot_terms_+3A_listw">listw</code></td>
<td>
<p>used to compute spatial lags for Durbin specifications. 
Default =  'NULL'</p>
</td></tr>
<tr><td><code id="plot_terms_+3A_dynamic">dynamic</code></td>
<td>
<p>Logical value to set a dynamic model.
Dynamic models include a temporal lag of the dependent
variable in the right-hand side of the equation.
Default = 'FALSE'.</p>
</td></tr>
<tr><td><code id="plot_terms_+3A_nt">nt</code></td>
<td>
<p>Number of temporal periods. It is needed
for dynamic models.</p>
</td></tr>
<tr><td><code id="plot_terms_+3A_decomposition">decomposition</code></td>
<td>
<p>Plot the decomposition of term in
random and fixed effects.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with the plots of the terms for each non-parametric 
covariate included in the object returned from <code><a href="#topic+fit_terms">fit_terms</a></code>.
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;"> 
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roberto Basile </td><td style="text-align: left;"> <a href="mailto:roberto.basile@univaq.it">roberto.basile@univaq.it</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Maria Durban </td><td style="text-align: left;">
  <a href="mailto:mdurban@est-econ.uc3m.es">mdurban@est-econ.uc3m.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Gonzalo Espana-Heredia </td><td style="text-align: left;">
  <a href="mailto:gehllanza@gmail.com">gehllanza@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> 
 </td>
</tr>

</table>



<h3>References</h3>

 
<ul>
<li><p> Wood, S.N. (2017). <em>Generalized Additive Models. 
An Introduction with <code>R</code></em> (second edition). CRC Press, Boca Raton.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+fit_terms">fit_terms</a></code> compute smooth functions for non-parametric
continuous covariates.
</p>
</li>
<li> <p><code><a href="#topic+impactsnopar">impactsnopar</a></code> plot the effects functions 
of non-parametric covariates.
</p>
</li>
<li> <p><code><a href="mgcv.html#topic+vis.gam">vis.gam</a></code> plot the terms fitted by 
<code><a href="mgcv.html#topic+gam">gam</a></code> function in <span class="pkg">mgcv</span> package.   
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>################################################
# Examples using spatial data of Ames Houses.
###############################################
# Getting and preparing the data
library(pspatreg)
library(spdep)
library(sf)
ames &lt;- AmesHousing::make_ames() # Raw Ames Housing Data
ames_sf &lt;- st_as_sf(ames, coords = c("Longitude", "Latitude"))
ames_sf$Longitude &lt;- ames$Longitude
ames_sf$Latitude &lt;- ames$Latitude
ames_sf$lnSale_Price &lt;- log(ames_sf$Sale_Price)
ames_sf$lnLot_Area &lt;- log(ames_sf$Lot_Area)
ames_sf$lnTotal_Bsmt_SF &lt;- log(ames_sf$Total_Bsmt_SF+1)
ames_sf$lnGr_Liv_Area &lt;- log(ames_sf$Gr_Liv_Area)
ames_sf1 &lt;- ames_sf[(duplicated(ames_sf$Longitude) == FALSE), ]
                    
form1 &lt;- lnSale_Price ~ Fireplaces + Garage_Cars +
          pspl(lnLot_Area, nknots = 20) + 
          pspl(lnTotal_Bsmt_SF, nknots = 20) +
          pspl(lnGr_Liv_Area, nknots = 20)    

 
########### Constructing the spatial weights matrix
coord_sf1 &lt;- cbind(ames_sf1$Longitude, ames_sf1$Latitude)
k5nb &lt;- knn2nb(knearneigh(coord_sf1, k = 5, 
                          longlat = TRUE, use_kd_tree = FALSE), sym = TRUE)
lw_ames &lt;- nb2listw(k5nb, style = "W", 
                  zero.policy = FALSE)
gamsar &lt;- pspatfit(form1, data = ames_sf1, 
                   type = "sar", listw = lw_ames,
                   method = "Chebyshev")
summary(gamsar)
list_varnopar &lt;- c("lnLot_Area", "lnTotal_Bsmt_SF", 
"lnGr_Liv_Area")
terms_nopar &lt;- fit_terms(gamsar, list_varnopar)
######################  Plot non-parametric terms
plot_terms(terms_nopar, ames_sf1)

###### Examples using a panel data of rate of
###### unemployment for 103 Italian provinces in period 1996-2014.
library(pspatreg)
data(unemp_it, package = "pspatreg")
lwsp_it &lt;- spdep::mat2listw(Wsp_it)

########  No Spatial Trend: ps-sar including a spatial 
########  lag of the dependent variable
form1 &lt;- unrate ~ partrate + agri + cons + 
                  pspl(serv,nknots = 15) +
                  pspl(empgrowth,nknots = 20) 
gamsar &lt;- pspatfit(form1, data = unemp_it, 
                   type = "sar", listw = Wsp_it)
summary(gamsar)
########  Fit non-parametric terms (spatial trend must be name "spttrend")
list_varnopar &lt;- c("serv", "empgrowth")
terms_nopar &lt;- fit_terms(gamsar, list_varnopar)
#######  Plot non-parametric terms
plot_terms(terms_nopar, unemp_it)
  
</code></pre>

<hr>
<h2 id='print.summary.impactspar.pspatreg'>Print method for objects of class summary.impactspar.pspatreg</h2><span id='topic+print.summary.impactspar.pspatreg'></span>

<h3>Description</h3>

<p>Print method for objects of class summary.impactspar.pspatreg
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'summary.impactspar.pspatreg'
print(x, digits = max(3L, getOption("digits") - 3L), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.summary.impactspar.pspatreg_+3A_x">x</code></td>
<td>
<p>object of class <em>summary.impactspar.pspatreg</em>.</p>
</td></tr>
<tr><td><code id="print.summary.impactspar.pspatreg_+3A_digits">digits</code></td>
<td>
<p>number of digits to show in printed tables.
Default: max(3L, getOption(&quot;digits&quot;) - 3L).</p>
</td></tr>
<tr><td><code id="print.summary.impactspar.pspatreg_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects.
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;"> 
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roberto Basile </td><td style="text-align: left;"> <a href="mailto:roberto.basile@univaq.it">roberto.basile@univaq.it</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Maria Durban </td><td style="text-align: left;">
  <a href="mailto:mdurban@est-econ.uc3m.es">mdurban@est-econ.uc3m.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Gonzalo Espana-Heredia </td><td style="text-align: left;">
  <a href="mailto:gehllanza@gmail.com">gehllanza@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> 
 </td>
</tr>

</table>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+impactspar">impactspar</a></code> Compute direct, indirect and
total impacts for continous parametric covariates.
</p>
</li>
<li> <p><code><a href="#topic+summary.impactspar.pspatreg">summary.impactspar.pspatreg</a></code> Summary method
for <em>summary.pspatreg</em> objects.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># See examples for \code{\link{impactspar}} function.
</code></pre>

<hr>
<h2 id='print.summary.pspatreg'>Print method for objects of class summary.pspatreg.</h2><span id='topic+print.summary.pspatreg'></span>

<h3>Description</h3>

<p>Print method for objects of class summary.pspatreg.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'summary.pspatreg'
print(x, digits = max(3L, getOption("digits") - 3L), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.summary.pspatreg_+3A_x">x</code></td>
<td>
<p>object of class <em>summary.pspatreg</em>.</p>
</td></tr>
<tr><td><code id="print.summary.pspatreg_+3A_digits">digits</code></td>
<td>
<p>number of digits to show in printed tables.
Default: max(3L, getOption(&quot;digits&quot;) - 3L).</p>
</td></tr>
<tr><td><code id="print.summary.pspatreg_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects.
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;"> 
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roberto Basile </td><td style="text-align: left;"> <a href="mailto:roberto.basile@univaq.it">roberto.basile@univaq.it</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Maria Durban </td><td style="text-align: left;">
  <a href="mailto:mdurban@est-econ.uc3m.es">mdurban@est-econ.uc3m.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Gonzalo Espana-Heredia </td><td style="text-align: left;">
  <a href="mailto:gehllanza@gmail.com">gehllanza@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> 
 </td>
</tr>

</table>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+summary.pspatreg">summary.pspatreg</a></code> Summary method for <em>pspatreg</em> objects.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># See examples for \code{\link{pspatfit}} function.
</code></pre>

<hr>
<h2 id='prod_it'>Productivity growth and internal net migration - Italian provinces</h2><span id='topic+prod_it'></span>

<h3>Description</h3>

<p>A spatial dataframe including a map of Italian NUTS-3 provinces and 
cross-sectional dataset on provincial labor productivity growth rates,
internal net migration rates, and other economic variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prod_it
</code></pre>


<h3>Format</h3>

<p>An sf object with 107 rows and 9 columns:
</p>

<dl>
<dt>COD_PROV</dt><dd><p>province (NUTS-3) coded as a number.</p>
</dd>
<dt>DEN_PROV</dt><dd><p>province (NUTS-3) coded as a name.</p>
</dd>
<dt>longitude</dt><dd><p>longitude of the centroid of the province.</p>
</dd>
<dt>latitude</dt><dd><p>latitude of the centroid of the province.</p>
</dd>
<dt>lnPROD_0</dt><dd><p>log of labor productivity in 2002
(measured as gross value added per worker).</p>
</dd>
<dt>growth_PROD</dt><dd><p>Average annual growth rate of labor productivity 
over the period 2002-2018.</p>
</dd>
<dt>lnoccgr</dt><dd><p>Average annual growth rate of employment over the period 2002-2018.</p>
</dd>
<dt>net</dt><dd><p>Average annual provincial internal net migration rate 
(computed as the difference between internal immigration and 
emigration flows of the working-age population, i.e. 
people aged 15-65, divided by the total population).</p>
</dd>
<dt>geometry</dt><dd><p>geometry (polygons) of the sf object.</p>
</dd>
</dl>



<h3>Source</h3>

<p>Italian National Institute of Statistics (ISTAT)
<em>https://www.istat.it</em>
</p>

<hr>
<h2 id='pspatfit'>Estimate spatial or spatio-temporal semiparametric 
regression models from a spatial econometric perspective.</h2><span id='topic+pspatfit'></span>

<h3>Description</h3>

<p>Estimate geoadditive spatial or spatio-temporal 
semiparametric regression models of type <em>ps-sar</em>, <em>ps-sem</em>, <em>ps-sarar</em>, 
<em>ps-sdm</em>, <em>ps-sdem</em> or
<em>ps-slx</em>. These type of specifications are very
general and they can include parametric and non-parametric 
covariates, spatial or spatio-temporal non-parametric
trends and spatial lags of the dependent and independent variables and/or 
the noise of the model. 
The non-parametric terms (either trends or covariates) 
are modeled using P-Splines. 
The non-parametric trend can be decomposed in an ANOVA way 
including main and interactions effects of 2nd and 3rd order. 
The estimation method can be restricted maximum likelihood (REML)
or maximum likelihood (ML).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pspatfit(
  formula,
  data,
  na.action,
  listw = NULL,
  type = "sim",
  method = "eigen",
  Durbin = NULL,
  zero.policy = NULL,
  interval = NULL,
  trs = NULL,
  cor = "none",
  dynamic = FALSE,
  demean = FALSE,
  eff_demean = "individual",
  index = NULL,
  control = list()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pspatfit_+3A_formula">formula</code></td>
<td>
<p>A formula similar to GAM specification including
parametric and non-parametric terms. Parametric covariates
are included in the usual way and non-parametric P-spline smooth terms are
specified using <code>pspl(.)</code> and <code>pspt(.)</code> for the non-parametric 
covariates and spatial   or spatio-temporal trend, respectively.
More details in <em>Details</em> and <em>Examples</em>.</p>
</td></tr>
<tr><td><code id="pspatfit_+3A_data">data</code></td>
<td>
<p>A data frame containing the parametric and non-parametric
covariates included in the model. Also, if a <code>pspt(.)</code> term is 
included in formula, the data frame must include the spatial and temporal
coordinates specified in <code>pspt(.)</code>. In this case coordinates
must be ordered choosing time as fast index and spatial coordinates
as low indexes. See <code>head(unemp_it)</code> as an example.</p>
</td></tr>
<tr><td><code id="pspatfit_+3A_na.action">na.action</code></td>
<td>
<p>A function (default <code>options("na.action")</code>),
can also be 'na.omit' or 'na.exclude' with consequences 
for residuals and fitted values. It may be necessary to set 
'zero.policy' to 'TRUE' because this subsetting may 
create no-neighbour observations.</p>
</td></tr>
<tr><td><code id="pspatfit_+3A_listw">listw</code></td>
<td>
<p>Default = 'NULL' This will create a model with no spatial dependency.
To include spatial dependency, <code>listw</code> should be a spatial neighbours list object 
created for example by <code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> from <span class="pkg">spdep</span>
package; if <code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> not given, set to 
the same spatial weights as the <code>listw</code> argument. It can
also be a spatial weighting matrix of order <em>(NxN)</em> instead of
a <code>listw</code> neighbours list object.</p>
</td></tr>
<tr><td><code id="pspatfit_+3A_type">type</code></td>
<td>
<p>Type of spatial model specification following 
the usual spatial econometric terminology. 
Default = <code>"sim"</code> this creates
a model with no type of spatial dependency. 
Types of spatial models available (similar to 
<span class="pkg">spsur</span> package):
<code>"sar"</code>, <code>"sem"</code>, <code>"sdm"</code>, 
<code>"sdem"</code>, <code>"sarar"</code>, or <code>"slx"</code>. 
When creating a <code>"slx"</code>, <code>"sdem"</code>
or <code>"sdm"</code> model, it is necessary to include the formula of the Durbin part in 
the <code>Durbin</code> argument in the same way than 
<span class="pkg">spsur</span> or <span class="pkg">spatialreg</span> packages.
There are examples on how to create these models 
in <em>Examples</em> section.</p>
</td></tr>
<tr><td><code id="pspatfit_+3A_method">method</code></td>
<td>
<p>Similar to the corresponding parameter of 
<code><a href="spatialreg.html#topic+lagsarlm">lagsarlm</a></code> function in <span class="pkg">spatialreg</span> package. 
&quot;eigen&quot; (default) - the Jacobian is computed as the product of 
(1 - rho*eigenvalue) using <code><a href="spatialreg.html#topic+eigenw">eigenw</a></code> from package
spatialreg. For big samples (&gt; 500) method = &quot;eigen&quot; is not recommended.
Use &quot;spam&quot; or &quot;Matrix_J&quot; for strictly symmetric weights lists of 
styles &quot;B&quot; and &quot;C&quot;, or made symmetric by similarity 
(Ord, 1975, Appendix C) if possible for styles &quot;W&quot; and &quot;S&quot;, 
using code from the spam or Matrix packages to calculate the 
determinant; &quot;Matrix&quot; and &quot;spam_update&quot; provide updating Cholesky 
decomposition methods; &quot;LU&quot; provides an alternative sparse matrix 
decomposition approach. In addition, there are &quot;Chebyshev&quot; and 
Monte Carlo &quot;MC&quot; approximate log-determinant methods; 
the Smirnov/Anselin (2009) trace approximation is available 
as &quot;moments&quot;. Three methods: &quot;SE_classic&quot;, &quot;SE_whichMin&quot;, 
and &quot;SE_interp&quot; are provided experimentally, the first to 
attempt to emulate the behaviour of Spatial Econometrics 
toolbox ML fitting functions. All use grids of log determinant 
values, and the latter two attempt to ameliorate some features 
of &quot;SE_classic&quot;.</p>
</td></tr>
<tr><td><code id="pspatfit_+3A_durbin">Durbin</code></td>
<td>
<p>Default = 'NULL'. 
If model is of <code>type = "sdm"</code>, <code>"sdem"</code> or 
<code>"slx"</code> then this argument should be a formula
of the subset of explanatory variables to be 
spatially lagged in the right hand side part of 
the model. See <code><a href="spsur.html#topic+spsurml">spsurml</a></code> for 
a similar argument.</p>
</td></tr>
<tr><td><code id="pspatfit_+3A_zero.policy">zero.policy</code></td>
<td>
<p>Similar to the corresponding parameter of 
<code><a href="spatialreg.html#topic+lagsarlm">lagsarlm</a></code> function in <span class="pkg">spatialreg</span> package. 
If 'TRUE' assign zero to the lagged value of zones without 
neighbours, if 'FALSE' assign 'NA' - causing 
<code>pspatfit()</code> to terminate with an error. Default = 'NULL'.</p>
</td></tr>
<tr><td><code id="pspatfit_+3A_interval">interval</code></td>
<td>
<p>Search interval for autoregressive parameter.
Default = 'NULL'.</p>
</td></tr>
<tr><td><code id="pspatfit_+3A_trs">trs</code></td>
<td>
<p>Similar to the corresponding parameter of 
<code><a href="spatialreg.html#topic+lagsarlm">lagsarlm</a></code> function in <span class="pkg">spatialreg</span> package.
Default 'NULL', if given, a vector of powered spatial weights 
matrix traces output by <code><a href="spdep.html#topic+trW">trW</a></code>.</p>
</td></tr>
<tr><td><code id="pspatfit_+3A_cor">cor</code></td>
<td>
<p>Type of temporal correlation for temporal data. Possible values 
are <code>"none"</code> (default) or <code>"ar1"</code>.</p>
</td></tr>
<tr><td><code id="pspatfit_+3A_dynamic">dynamic</code></td>
<td>
<p>Logical value to set a dynamic model.
Dynamic models include a temporal lag of the dependent
variable in the right-hand side of the equation.
Default = 'FALSE'.</p>
</td></tr>
<tr><td><code id="pspatfit_+3A_demean">demean</code></td>
<td>
<p>Logical value to include a demeaning 
for panel data. Default = 'FALSE'. 
The demeaning is done previously to the estimation for
both parametric and nonparametric terms. It is not possible
to set <code>demean = TRUE</code> when spatio-temporal trends
are included.</p>
</td></tr>
<tr><td><code id="pspatfit_+3A_eff_demean">eff_demean</code></td>
<td>
<p>Type of demeaning for panel data.
Possible values are <code>"individual"</code> (default), 
<code>"time"</code> or <code>"twoways"</code>.</p>
</td></tr>
<tr><td><code id="pspatfit_+3A_index">index</code></td>
<td>
<p>Vector of variables indexing panel data. 
First variable corresponds to individuals and second 
variable corresponds to temporal coordinate (fast index). 
It follows the same rules than <code><a href="plm.html#topic+plm">plm</a></code> function
in package <span class="pkg">plm</span>.</p>
</td></tr>
<tr><td><code id="pspatfit_+3A_control">control</code></td>
<td>
<p>List of extra control arguments. See 
<em>Control Arguments</em> section below.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function to estimate the model:
</p>
<p style="text-align: center;"><code class="reqn"> y = (\rho*W_{N} \otimes I_T) y 
    + f(s_1,s_2,\tau_{t}) 
    + X \beta 
    + (W_{N} \otimes I_T) X \theta  
    + \sum_{i = 1}^k g(z_i) 
    + \sum_{i = 1}^k g((\gamma_i*W_{N} \otimes I_T) z_i)  
    + \epsilon </code>
</p>

<p>where:
</p>

<ul>
<li> <p><code class="reqn">f(s_1,s_2,\tau_t)</code> is a smooth spatio-temporal trend
of the spatial coordinates <code class="reqn">s1,s_2</code> and of the temporal
coordinates <code class="reqn">\tau_t</code>.
</p>
</li>
<li> <p><code class="reqn">X</code> is a matrix including values of parametric covariates.
</p>
</li>
<li> <p><code class="reqn">g(z_i)</code> are non-parametric smooth functions of the
covariates <code class="reqn">z_i</code>.
</p>
</li>
<li> <p><code class="reqn">W_N</code> is the spatial weights matrix.
</p>
</li>
<li> <p><code class="reqn">\rho</code> is the spatial spillover parameter.
</p>
</li>
<li> <p><code class="reqn">I_T</code> is an identity matrix of order <code class="reqn">T</code> (<em>T=1</em>
for pure spatial data).
</p>
</li>
<li> <p><code class="reqn">\epsilon ~ N(0,R)</code> where <code class="reqn">R = \sigma^2 I_T</code> if errors
are uncorrelated or it follows an AR(1) temporal autoregressive 
structure for serially correlated errors.
</p>
</li></ul>


<dl>
<dt>Including non-parametric terms</dt><dd>
<p>The non-parametric terms are included in <code>formula</code> using
<code>pspt(.)</code> for spatial or spatio-temporal trends and 
<code>pspl(.)</code> for other non-parametric smooth additive terms.
For example, if a model includes:
</p>

<ul>
<li><p> An spatio-temporal trend with 
variables <em>long</em> and <em>lat</em> 
as spatial coordinates,and <em>year</em> 
as temporal coordinate.
</p>
</li>
<li><p> Two non-parametric covariates named 
<em>empgrowth</em> and <em>serv</em>.
</p>
</li>
<li><p>  Three parametric covariates named 
<em>partrate</em>, <em>agri</em> and <em>cons</em>.
</p>
</li></ul>

<p>Then, the formula should be written as (choosing default values
for each term): <br />
</p>
<p><code> unrate ~ partrate + agri + cons +
                   pspl(serv) + pspl(empgrowth) +
                   pspt(long,lat,year) </code> <br />
</p>
<p>For a spatial trend case, the term <code>pspt(.)</code> does not include a 
temporal coordinate, that is, in the previous example would be 
specified as <code>pspt(long,lat)</code>.
</p>
</dd>
<dt>How to use <code>pspl()</code> and <code>pspt()</code></dt><dd>   
<p>Note that both in <code>pspl(.)</code> and <code>pspt(.)</code>, we have 
to include the number of knots, named <code>nknots</code>, 
which is the dimension of the basis used to represent the smooth term.
The value of <code>nknots</code> should not be less than the dimension of the null space of the penalty
for the term, see <code><a href="mgcv.html#topic+null.space.dimension">null.space.dimension</a></code> 
and <code><a href="mgcv.html#topic+choose.k">choose.k</a></code> from <span class="pkg">mgcv</span> 
package to know how to choose <code>nknots</code>.
</p>
<p>In <code>pspl(.)</code> the default is <code>nknots = 10</code>, see the help of <code><a href="#topic+pspl">pspl</a></code> function.
In this term we can only include single variables, so if we want more than one 
non-parametric variable we will use a <code>pspl(.)</code> term for each nonparametric variable.
</p>
<p>On the other hand, <code>pspt(.)</code> is used for spatial smoothing 
(when temporal coordinate is 'NULL')  or 
spatio-temporal smoothing (when a variable is provided for
the temporal coordinate). 
The default for the temporal coordinate is <code>time = NULL</code>, 
see the help of <code><a href="#topic+pspt">pspt</a></code>, and the default number of knots
are <code>nknots = c(10, 10, 5)</code>. If only 
include spatial smoothing, <code>nknots</code> will be a length 2 vector 
indicating the basis for each spatial coordinate. 
For spatio-temporal smoothing, it will be a length 3 vector.
</p>
</dd>
<dt>ANOVA descomposition</dt><dd>
<p>In many situations the  spatio-temporal trend, given by 
<code class="reqn">f(s_1,s_2,\tau_t)</code>, can be very complex and the use of a 
multidimensional smooth function may not be flexible enough to 
capture the structure in the data. Furthermore, the estimation of 
this trend can become computationally intensive especially for 
large databases.<br />
To solve this problem, Lee and Durban (2011) proposed an ANOVA-type
decomposition of this spatio-temporal trend where spatial and 
temporal main effects, and second- and third-order interaction 
effects can be identified as:
</p>
<p style="text-align: center;"><code class="reqn"> f(s_1, s_2, \tau_t) = f_1(s_1) + f_2(s_2) + f_t(\tau_t) +
         f_{1,2}(s_1, s_2) +  f_{1,t}(s_1, \tau_t) +
         f_{2,t}(s_2, \tau_t) + f_{1,2,t}(s_1, s_2, \tau_t) </code>
</p>

<p>In this equation the decomposition of the spatio-temporal trend 
is as follows:
</p>

<ul>
<li><p> Main effects given by the functions 
<code class="reqn">f_1(s_1), f_2(s_2)</code> and <code class="reqn">f_t(\tau_t)</code>.
</p>
</li>
<li><p> Second-order interaction effects given by the functions 
<code class="reqn">f_{1,2}(s_1,s_2), f_{1,t}(s_1,\tau_t)</code> 
and <code class="reqn">f_{2,t}(s_2,\tau_t)</code>.
</p>
</li>
<li><p> Third-order interaction effect given by the 
function <code class="reqn">f_{1,2,t}(s_1,s_2,\tau_t)</code>.    
</p>
</li></ul>

<p>In this case, each effect can have its own 
degree of smoothing allowing a greater flexibility for the 
spatio-temporal trend. The ANOVA decomposition of the trend
can be set as an argument in <code>pspt(.)</code> terms choosing
<code>psanova = TRUE</code>.
</p>
<p>For example to choose an ANOVA decomposition in the 
previous case we can set: <br />
</p>
<p><code>pspt(long, lat, year, nknots = c(18,18,8),
  psanova = TRUE)</code>
<br />
</p>
<p>In most empirical cases main effects functions are more flexible than 
interaction effects functions and therefore, the number of knots in B-Spline 
bases for interaction effects do not need to be as big as the 
number of knots for main effects. 
<em>Lee et al.</em>, (2013) proposed a nested basis procedure
in which the number of knots for the interaction effects functions are 
reduced using <em>divisors</em> such that the space spanned by 
B-spline bases used for interaction effects are a subset of the 
space spanned by B-spline bases used for main effects. 
The <em>divisors</em> can be specified as an argument in 
<code>pspt(.)</code> terms. <br /> 
To do this, there are three
arguments available inside <code>pspt()</code> to define the divisors.
These arguments are named <code>nest_sp1</code>, <code>nest_sp2</code> and 
<code>nest_time</code>, respectively. 
The value for these arguments
are vector parameters including divisors of
the <code>nknots</code> values. <br />
</p>
<p>For example, if we set <code>nest_sp1 =
  c(1,2,2)</code> between the arguments of <code>pspl(.)</code>, 
we will have all knots for main effect of <em>s_1</em>, 
<em>18/2=9</em> knots for each second-order effect including <em>s_1</em>, 
and <em>8/2=4</em> knots for the third order effect including <em>s_1</em>. It
is important that the vector of numbers will be integer divisors 
of the values in <code>nknots</code>.
See section <em>Examples</em> for more details.
</p>
<p>Eventually, any effect function can be excluded of the ps-anova
spatio-temporal trend. To exclude main effects, the arguments  
<code>f1_main</code>, <code>f2_main</code> or <code>ft_main</code> have to be set to
'FALSE' (default='TRUE').
We can also exclude the second- and third-order
effects functions setting to 'FALSE' the arguments <code>f12_int</code>, <code>f1t_int</code>, 
<code>f2t_int</code> or <code>f12t_int</code> in <code>pspl(.)</code>.
</p>
</dd>
</dl>

<p>All the terms included in the model are jointly fitted using Separation of Anisotropic 
Penalties (SAP) algorithm (see <em>Rodriguez-Alvarez et al., (2015)</em>) 
which allows to the mixed model reparameterization of the model. 
For type of models <code>"sar", "sem", "sdm", "sdem", "sarar"</code>  or 
<code>cor = "ar1"</code>, the parameters <code class="reqn">\rho</code>, <code class="reqn">\lambda</code> and <code class="reqn">\phi</code> 
are numerically estimated using 
<code><a href="minqa.html#topic+bobyqa">bobyqa</a></code> function implemented in package <span class="pkg">minqa</span>.
In these cases, an iterative process between SAP and numerical 
optimization of <code class="reqn">\rho</code>, <code class="reqn">\lambda</code> and <code class="reqn">\phi</code> is applied until
convergence. See details in <em>Minguez et al.</em>, (2018).
</p>
   
<dl>
<dt>Plotting non-parametric terms</dt><dd>
<p>To plot the non-linear functions corresponding to 
non-parametric terms we need to compute the fitted values,
and standard erros, using <code>fit_terms()</code> function 
and, afterwards, use <code>plot_terms()</code> function to 
plot the non-linear functions. <br /> 
An example of how plot the functions of non-parametric 
terms given by <code>"var1"</code> and <code>"var2"</code> variables is given by 
the next lines of code (it is assumed that a previous 
model has been fitted using <code>pspatfit(.)</code> and 
saved as an object named <code>model</code>): <br />
</p>
<p><code>list_varnopar &lt;- c("var1", "var2")</code> <br />
<code>terms_nopar &lt;- fit_terms(model, list_varnopar)</code> <br />
<code>plot_terms(terms_nopar, data)</code> 
<br />
</p>
<p>The <code>data</code> argument of <code>plot_terms()</code> usually 
corresponds to the dataframe used to fitted the model 
although a different database can be used to plot the 
non-parametric terms.</p>
</dd>
<dt>Spatial impacts</dt><dd>
<p>For the spatial models given by  <code>type = "sar"</code>, 
<code>"sdm"</code>, <code>"sdem"</code>, <code>"sarar"</code> 
or <code>"slx"</code> it is possible to compute spatial 
spillovers as usual in spatial econometric specifications. 
Nevertheless, in this case we need to distinguish between 
parametric and non-parametric covariates when computing spatial 
impacts.</p>
</dd>
</dl>

<ul>
<li><p> spatial impacts for parametric covariates <br />
In this case, the spatial impacts are computed in the 
usual way using simulation. See LeSage and Page (2009) 
for computational details. The function <code>impactspar()</code>
computes the direct, indirect and total impacts for 
parametric covariates and return and object similar to 
the case of <span class="pkg">spatialreg</span> and <span class="pkg">spsur</span> packages.
The inference for <code>"sar"</code>, <code>"sdm"</code>, 
and <code>"sarar"</code> types is based on simulations 
and for <code>"slx"</code> and <code>"sdem"</code> types the 
standard errors or total impacts are computed using 
the variance-covariance matrix of the fitted model. 
The <code>summary()</code> method can be used to present the 
the complete table of spatial impacts in this parametric case.
See the help of <code><a href="#topic+impactspar">impactspar</a></code> to know the 
additional arguments of the function. A little example 
is given in the next lines of code:<br />
</p>
<p><code>imp_parvar &lt;- impactspar(MODEL, listw = W)</code> <br />
<code>summary(imp_parvar)</code>
</p>
</li>
<li><p> spatial impacts for non-parametric covariates <br />
In this case direct, indirect and total 
<em>spatial impacts functions</em> are 
obtained using <code>impactsnopar</code>. The details of 
computation and inference can be obtained from the help 
of <code><a href="#topic+impactsnopar">impactsnopar</a></code>. 
The argument <code>viewplot</code> of <code>impactsnopar</code> 
have to be set as 'TRUE' to plot the spatial impacts 
functions. Another way to get the same plots is using 
<code>plot_impactsnopar</code> function with the output 
of <code>impactsnopar</code>. 
Next lines give an example of both cases: <br />
</p>
<p><code>imp_nparvar &lt;- impactsnopar(MODEL, listw = W, viewplot = TRUE)</code> <br />
<code>imp_nparvar &lt;- impactsnopar(MODEL, listw = W, viewplot = FALSE)</code> <br />
<code>plot_impactsnopar(imp_nparvar, data = DATA)</code> <br />
</p>
</li></ul>




<h3>Value</h3>

<p>A list object of class <em>pspatreg</em>
</p>

<table>
<tr>
 <td style="text-align: left;">
 <code>call</code> </td><td style="text-align: left;"> Matched call. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>terms</code> </td><td style="text-align: left;"> The terms object used. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>contrasts</code> </td><td style="text-align: left;"> (only where relevant) the contrasts used
             for parametric covariates. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>xlevels</code> </td><td style="text-align: left;"> (only where relevant) a record of the levels
             of the parametric factors used in fitting. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>data</code> </td><td style="text-align: left;"> dataframe used as database. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>nsp</code> </td><td style="text-align: left;"> number of spatial observations. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>nt</code> </td><td style="text-align: left;"> number of temporal observations. It is set
   to <code>nt=1</code> for spatial data. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>nfull</code> </td><td style="text-align: left;"> total number of observations. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>edftot</code> </td><td style="text-align: left;"> Equivalent degrees of freedom for the whole model. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>edfspt</code> </td><td style="text-align: left;"> Equivalent degrees of freedom for smooth
             spatio-temporal or spatial trend. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>edfnopar</code> </td><td style="text-align: left;"> Equivalent degrees of freedom for
             non-parametric covariates. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>psanova</code> </td><td style="text-align: left;"> <em>TRUE</em> if spatio-temporal or spatial trend is 
   PS-ANOVA. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>type</code> </td><td style="text-align: left;"> Value of <code>type</code> argument in the call to <code>pspatfit</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>listw</code> </td><td style="text-align: left;"> Value of <code>listw</code> argument in the call to <code>pspatfit</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>Durbin</code> </td><td style="text-align: left;"> Value of <code>Durbin</code> argument in the call to <code>pspatfit</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>cor</code> </td><td style="text-align: left;"> Value of <code>cor</code> argument in the call to <code>pspatfit</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>dynamic</code> </td><td style="text-align: left;"> Value of <code>dynamic</code> argument in the call to <code>pspatfit</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>demean</code> </td><td style="text-align: left;"> Value of <code>demean</code> argument in the call to <code>pspatfit</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>eff_demean</code> </td><td style="text-align: left;"> Value of <code>eff_demean</code> argument in the call to <code>pspatfit</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>index</code> </td><td style="text-align: left;"> Value of <code>index</code> argument in the call to <code>pspatfit</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>bfixed</code> </td><td style="text-align: left;"> Estimated betas corresponding to fixed effects in
             mixed model. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>se_bfixed</code> </td><td style="text-align: left;"> Standard errors of fixed betas. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>brandom</code> </td><td style="text-align: left;"> Estimated betas corresponding to random effects
             in mixed model. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>se_brandom</code></td><td style="text-align: left;"> Standard errors of random betas. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>vcov_fr</code> </td><td style="text-align: left;"> Covariance matrix of fixed and random
             effects using frequentist or sandwich method. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>vcov_by</code> </td><td style="text-align: left;"> Covariance matrix of fixed and random
             effects using bayesian method. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>rho</code> </td><td style="text-align: left;"> Estimated rho for spatial lag of the
   dependent variable. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>se_rho</code> </td><td style="text-align: left;"> Standard error of <code class="reqn">rho</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>delta</code> </td><td style="text-align: left;"> Estimated delta for spatial error models. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>se_delta</code> </td><td style="text-align: left;"> Standard error of <code class="reqn">delta</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>phi</code> </td><td style="text-align: left;"> Estimated phi. If <code>cor="none"</code> always <code class="reqn">phi=0</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>se_phi</code> </td><td style="text-align: left;"> Standard error of <code class="reqn">phi</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>fitted.values</code> </td><td style="text-align: left;"> Vector of fitted values of the dependent
             variable. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>se_fitted.values</code> </td><td style="text-align: left;"> Vector of standard errors of
      <code>fitted.values</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>fitted.values_Ay</code> </td><td style="text-align: left;"> Vector of fitted values of the spatial lag of
     dependent variable: <code class="reqn">(\rho*W_N \otimes I_T) y</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>se_fitted.values_Ay</code> </td><td style="text-align: left;"> Vector of standard errors of
      <code>fitted.values_Ay</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>residuals</code> </td><td style="text-align: left;"> Vector of residuals. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>df.residual</code> </td><td style="text-align: left;"> Equivalent degrees of freedom for <code>residuals</code>. 
   </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>sig2</code>  </td><td style="text-align: left;"> Residual variance computed as SSR/df.residual. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>llik</code> </td><td style="text-align: left;"> Log-likelihood value. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>llik_reml</code> </td><td style="text-align: left;"> Restricted log-likelihood value. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>aic</code> </td><td style="text-align: left;"> Akaike information criterion. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>bic</code> </td><td style="text-align: left;"> Bayesian information criterion. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>sp1</code> </td><td style="text-align: left;"> First spatial coordinate. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>sp2</code> </td><td style="text-align: left;"> Second spatial coordinate. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>time</code> </td><td style="text-align: left;"> Time coordinate. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>y</code> </td><td style="text-align: left;"> Dependent variable. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>X</code> </td><td style="text-align: left;"> Model matrix for fixed effects. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>Z</code> </td><td style="text-align: left;"> Model matrix for random effects. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Control Arguments</h3>


<table>
<tr>
 <td style="text-align: left;">
  <code>optim</code> </td><td style="text-align: left;"> method of estimation: <code>"llik_reml"</code> (default) or
    <code>"llik"</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code>typese</code> </td><td style="text-align: left;"> method to compute 
    standard errors. <code>"sandwich"</code>  or <code>"bayesian"</code> (default).
    See Fahrmeir et al, pp. 375 for details of computations. </td>
</tr>
<tr>
 <td style="text-align: left;">   
  <code>vary_init</code> </td><td style="text-align: left;"> Initial value of the noise variance in the model.
    Default = `NULL`. </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code>trace</code> </td><td style="text-align: left;"> A logical value set to <em>TRUE</em> to show 
    intermediate results during the estimation process. 
    Default = <em>FALSE</em>. </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code>tol1</code> </td><td style="text-align: left;"> Numerical value for the tolerance of convergence
    of penalization parameters during the estimation process. 
    Default 1e-3. This tolerance is only used 
    for small samples (&lt;= 500 observations). </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code>tol2</code> </td><td style="text-align: left;"> Numerical value for the tolerance of convergence
    of total estimated degrees of freedom ("edftot") during the 
    estimation process. Default 1e-1. This tolerance is used for 
    medium or big samples (&gt; 500 observations). </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code>tol3</code> </td><td style="text-align: left;"> Numerical value for the tolerance of convergence
    of spatial and correlation parameters during the 
    estimation process. Default 1e-2.  </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code>maxit</code> </td><td style="text-align: left;"> An integer value for the maximum number of 
    iterations until convergence. Default = 200. </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code>rho_init</code> </td><td style="text-align: left;"> An initial value for <code class="reqn">rho</code> parameter. 
    Default 0. </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code>delta_init</code> </td><td style="text-align: left;"> An initial value for <code class="reqn">delta</code> parameter. 
    Default 0. </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code>phi_init</code> </td><td style="text-align: left;"> An initial value for <code class="reqn">phi</code> parameter. 
    Default 0. </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code>Imult</code> </td><td style="text-align: left;"> default 2; used for preparing the Cholesky 
      decompositions for updating in the Jacobian function </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code>super</code> </td><td style="text-align: left;">  if `NULL` (default), set to `FALSE` to use 
      a simplicial decomposition for the sparse Cholesky decomposition 
      and method "Matrix_J", set to `as.logical(NA)` for method "Matrix", if 
      `TRUE`, use a supernodal decomposition </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>cheb_q</code> </td><td style="text-align: left;"> default 5; highest power of the approximating 
      polynomial for the Chebyshev approximation </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>MC_p</code> </td><td style="text-align: left;"> default 16; number of random variates </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>MC_m</code> </td><td style="text-align: left;"> default 30; number of products of random variates 
      matrix and spatial weights matrix </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>spamPivot</code> </td><td style="text-align: left;">  default "MMD", alternative "RCM" </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>in_coef</code> </td><td style="text-align: left;"> default 0.1, coefficient value for initial Cholesky 
      decomposition in "spam_update" </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>type</code> </td><td style="text-align: left;"> default "MC", used with method "moments"; alternatives 
      "mult" and "moments", for use if trs is missing </td>
</tr>
<tr>
 <td style="text-align: left;"> 
    <code>correct</code> </td><td style="text-align: left;"> default `TRUE`, used with method "moments" to 
      compute the Smirnov/Anselin correction term </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>trunc</code> </td><td style="text-align: left;"> default `TRUE`, used with method "moments" to 
      truncate the Smirnov/Anselin correction term </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>SE_method</code> </td><td style="text-align: left;"> default "LU", may be "MC" </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>nrho</code> </td><td style="text-align: left;"> default 200, as in SE toolbox; the size of the first 
      stage lndet grid; it may be reduced to for example 40 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>interpn</code> </td><td style="text-align: left;"> default 2000, as in SE toolbox; the size of the 
      second stage lndet grid </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>SElndet</code> </td><td style="text-align: left;"> default `NULL`, may be used to pass a 
      pre-computed SE toolbox style matrix of coefficients and their lndet 
      values to the "SE_classic" and "SE_whichMin" methods </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>LU_order</code> </td><td style="text-align: left;"> default `FALSE`; used in "LU_prepermutate", 
      note warnings given for lu method </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>pre_eig</code> </td><td style="text-align: left;"> default `NULL`; may be used to pass a 
      pre-computed vector of eigenvalues </td>
</tr>
<tr>
 <td style="text-align: left;">
 </td>
</tr>

</table>



<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
    Roman Minguez </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
    Roberto Basile </td><td style="text-align: left;"> <a href="mailto:roberto.basile@univaq.it">roberto.basile@univaq.it</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
    Maria Durban </td><td style="text-align: left;"> <a href="mailto:mdurban@est-econ.uc3m.es">mdurban@est-econ.uc3m.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
    Gonzalo Espana-Heredia </td><td style="text-align: left;"> <a href="mailto:gehllanza@gmail.com">gehllanza@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>References</h3>

 
<ul>
<li><p> Basile, R.; Durban, M.; Minguez, R.; Montero, J. M.; and 
Mur, J. (2014). Modeling regional economic dynamics: Spatial
dependence, spatial heterogeneity and nonlinearities. 
<em>Journal of Economic Dynamics and Control</em>, (48), 229-245.
&lt;doi:10.1016/j.jedc.2014.06.011&gt;
</p>
</li>
<li><p> Eilers, P. and Marx, B. (1996). Flexible Smoothing with 
B-Splines and Penalties. <em>Statistical Science</em>, (11), 89-121.
</p>
</li>
<li><p> Eilers, P. and Marx, B. (2021). <em>Practical Smoothing. 
The Joys of P-Splines</em>. Cambridge University Press.
</p>
</li>
<li><p> Fahrmeir, L.; Kneib, T.;  Lang, S.; and Marx, B. (2021). 
<em>Regression. Models, Methods and Applications (2nd Ed.)</em>.
Springer.
</p>
</li>
<li><p> Lee, D. and Durban, M. (2011). P-Spline ANOVA Type Interaction 
Models for Spatio-Temporal Smoothing. <em>Statistical Modelling</em>, 
(11), 49-69. &lt;doi:10.1177/1471082X1001100104&gt;
</p>
</li>
<li><p> Lee, D. J., Durban, M., and Eilers, P. (2013). Efficient
two-dimensional smoothing with P-spline ANOVA mixed models 
and nested bases. <em>Computational Statistics &amp; Data Analysis</em>, 
(61), 22-37. &lt;doi:10.1016/j.csda.2012.11.013&gt;
</p>
</li>
<li><p> LeSage, J. and Pace, K. (2009). <em>Introduction to 
Spatial Econometrics</em>. CRC Press, Boca Raton.
</p>
</li>
<li><p> Minguez, R.; Basile, R. and Durban, M. (2020). An Alternative 
Semiparametric Model for Spatial Panel Data. <em>Statistical Methods and Applications</em>,
(29), 669-708. &lt;doi:10.1007/s10260-019-00492-8&gt;
</p>
</li>
<li><p> Montero, J., Minguez, R., and Durban, M. (2012). SAR models 
with nonparametric spatial trends: A P-Spline approach. 
<em>Estadistica Espanola</em>, (54:177), 89-111.
</p>
</li>
<li><p> Rodriguez-Alvarez, M. X.; Kneib, T.; Durban, M.; Lee, D.J.
and Eilers, P. (2015). Fast smoothing parameter separation 
in multidimensional generalized P-splines: the SAP algorithm.
<em>Statistics and Computing</em> 25 (5), 941-957. 
&lt;doi:10.1007/s11222-014-9464-2&gt;
</p>
</li>
<li><p> Wood, S.N. (2017). <em>Generalized Additive Models. 
An Introduction with <code>R</code></em> (second edition). CRC Press, Boca Raton.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+impactspar">impactspar</a></code> compute total, direct and indirect effect
functions for parametric continuous 
covariates.
</p>
</li>
<li> <p><code><a href="#topic+impactsnopar">impactsnopar</a></code> compute total, direct and indirect effect
functions for non-parametric continuous 
covariates.
</p>
</li>
<li> <p><code><a href="#topic+fit_terms">fit_terms</a></code> compute smooth functions for non-parametric
continuous covariates.
</p>
</li>
<li><p><code><a href="mgcv.html#topic+gam">gam</a></code> well-known alternative of estimation
of semiparametric models in <span class="pkg">mgcv</span> 
package.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>################################################

##########################
library(pspatreg)
###############################################
# Examples using spatial data of Ames Houses.
###############################################
# Getting and preparing the data
library(spdep)
library(sf)
ames &lt;- AmesHousing::make_ames() # Raw Ames Housing Data
ames_sf &lt;- st_as_sf(ames, coords = c("Longitude", "Latitude"))
ames_sf$Longitude &lt;- ames$Longitude
ames_sf$Latitude &lt;- ames$Latitude
ames_sf$lnSale_Price &lt;- log(ames_sf$Sale_Price)
ames_sf$lnLot_Area &lt;- log(ames_sf$Lot_Area)
ames_sf$lnTotal_Bsmt_SF &lt;- log(ames_sf$Total_Bsmt_SF+1)
ames_sf$lnGr_Liv_Area &lt;- log(ames_sf$Gr_Liv_Area)
ames_sf1 &lt;- ames_sf[(duplicated(ames_sf$Longitude) == FALSE), ]

####  GAM pure with pspatreg
form1 &lt;- lnSale_Price ~ Fireplaces + Garage_Cars +
          pspl(lnLot_Area, nknots = 20) + 
          pspl(lnTotal_Bsmt_SF, nknots = 20) +
          pspl(lnGr_Liv_Area, nknots = 20)    
gampure &lt;- pspatfit(form1, data = ames_sf1)
summary(gampure)

######################  Get Non-parametric terms of GAM with pspatreg
list_varnopar &lt;- c("lnLot_Area", "lnTotal_Bsmt_SF", 
"lnGr_Liv_Area")
terms_nopar &lt;- fit_terms(gampure, list_varnopar, intercept = TRUE)
######################  Plot non-parametric terms
plot_terms(terms_nopar, ames_sf1)

 
########### Constructing the spatial weights matrix
coord_sf1 &lt;- cbind(ames_sf1$Longitude, ames_sf1$Latitude)
k5nb &lt;- knn2nb(knearneigh(coord_sf1, k = 5, 
                          longlat = TRUE, use_kd_tree = FALSE), sym = TRUE)
lw_ames &lt;- nb2listw(k5nb, style = "W", 
                  zero.policy = FALSE)
                  
#####################  GAM + SAR Model
gamsar &lt;- pspatfit(form1, data = ames_sf1, 
                   type = "sar", listw = lw_ames,
                   method = "Chebyshev")
summary(gamsar)
                  
######### Non-Parametric Total, Direct and Indirect impacts
### with impactsnopar(viewplot = TRUE)
nparimpacts &lt;- impactsnopar(gamsar, 
                            listw = lw_ames, 
                            viewplot = TRUE)
############ Non-Parametric Total, Direct and Indirect impacts
### with impactsnopar(viewplot = FALSE) and using plot_impactsnopar()
nparimpacts &lt;- impactsnopar(gamsar, listw = lw_ames, viewplot = FALSE)
plot_impactsnopar(nparimpacts, data = ames_sf1, smooth = TRUE)

###################### Parametric Total, Direct and Indirect impacts
parimpacts &lt;- impactspar(gamsar, listw = lw_ames)
summary(parimpacts)

###############################################
### Models with 2d spatial trend
form2 &lt;- lnSale_Price ~ Fireplaces + Garage_Cars +
          pspl(lnLot_Area, nknots = 20) + 
          pspl(lnTotal_Bsmt_SF, nknots = 20) +
          pspl(lnGr_Liv_Area, nknots = 20) +
          pspt(Longitude, Latitude, 
               nknots = c(10, 10), 
               psanova = FALSE)
#####################  GAM + GEO Model
gamgeo2d &lt;- pspatfit(form2, data = ames_sf1)
summary(gamgeo2d)

gamgeo2dsar &lt;- pspatfit(form2, data = ames_sf1,
                        type = "sar", 
                        listw = lw_ames, 
                        method = "Chebyshev")
summary(gamgeo2dsar)
####### plot spatial trend for spatial point coordinate
plot_sp2d(gamgeo2dsar, data = ames_sf1)
### Models with psanova 2d spatial trend
form3 &lt;- lnSale_Price ~ Fireplaces + Garage_Cars +
          pspl(lnLot_Area, nknots = 20) + 
          pspl(lnTotal_Bsmt_SF, nknots = 20) +
          pspl(lnGr_Liv_Area, nknots = 20) +
          pspt(Longitude, Latitude, 
               nknots = c(10, 10), 
               psanova = TRUE)
gamgeo2danovasar &lt;- pspatfit(form3, data = ames_sf1,
                        type = "sar", 
                        listw = lw_ames, method = "Chebyshev")
summary(gamgeo2danovasar)
####### plot spatial trend for spatial point coordinate
plot_sp2d(gamgeo2danovasar, data = ames_sf1, 
addmain = TRUE, addint = TRUE)

## Comparison between models
anova(gampure, gamsar, gamgeo2d, gamgeo2dsar,
gamgeo2danovasar, lrtest = FALSE)

###############################################
###################### Examples using a panel data of rate of
###################### unemployment for 103 Italian provinces in 1996-2019.
###############################################
## load spatial panel and Wsp_it
## 103 Italian provinces. Period 1996-2019
data(unemp_it, package = "pspatreg")
## Wsp_it is a matrix. Create a neighboord list 
lwsp_it &lt;- spdep::mat2listw(Wsp_it)
 ### Models with spatio-temporal trend
 ### Spatio-temporal semiparametric ANOVA model without spatial lag
 ### Interaction terms f12,f1t,f2t and f12t with nested basis
 ### Remark: nest_sp1, nest_sp2 and nest_time must be divisors of nknots
 form4 &lt;- unrate ~ partrate + agri + cons +
                   pspl(serv, nknots = 15) + 
                   pspl(empgrowth, nknots = 20) +
                   pspt(long, lat, year, 
                        nknots = c(18, 18, 12),
                        psanova = TRUE, 
                        nest_sp1 = c(1, 2, 3), 
                        nest_sp2 = c(1, 2, 3),
                        nest_time = c(1, 2, 2))
 sptanova &lt;- pspatfit(form4, data = unemp_it)
 summary(sptanova)
 
### Create sf object to make the plot 
### of spatio-temporal trends
library(sf)
unemp_it_sf &lt;- st_as_sf(dplyr::left_join(
                              unemp_it, 
                              map_it,  
                        by = c("prov" = "COD_PRO")))
###### Plot spatio-temporal trends for different years
plot_sp3d(sptanova, data = unemp_it_sf, 
          time_var = "year", 
          time_index = c(1996, 2005, 2019),
          addmain = FALSE, addint = FALSE)
###### Plot of spatio-temporal trend, main effects 
######      and interaction effect for a year
plot_sp3d(sptanova, data = unemp_it_sf, 
          time_var = "year", 
          time_index = c(2019),
          addmain = TRUE, addint = TRUE)
          
###### Plot of temporal trends for each province
plot_sptime(sptanova, 
            data = unemp_it, 
            time_var = "year", 
            reg_var = "prov")

 
 ###############################################
 ### Spatio-temporal semiparametric ANOVA model without spatial lag
 ### Now we repeat previous spatio-temporal model but 
 ### restricting some interactions
 ### Interaction terms f12,f1t and f12t with nested basis
 ### Interaction term f2t restricted to 0
 
  form5 &lt;- unrate ~ partrate + agri + cons + empgrowth +
                  pspl(serv, nknots = 15) + 
                  pspt(long, lat, year, 
                       nknots = c(18, 18, 6), 
                       psanova = TRUE,
                       nest_sp1 = c(1, 2, 3), 
                       nest_sp2 = c(1, 2, 3),
                       nest_time = c(1, 2, 2), 
                       f2t_int = FALSE)
 ## Add sar specification and ar1 temporal correlation 
 sptanova2_sar_ar1 &lt;- pspatfit(form5, data = unemp_it, 
                              listw = lwsp_it, 
                              type = "sar",
                              cor = "ar1")
summary(sptanova2_sar_ar1)                     
################ Comparison with parametric panels            
######################  Demeaning (Within Estimators)
formpar &lt;- unrate ~ partrate + agri + cons
# Not demeaning model
param &lt;- pspatfit(formpar, data = unemp_it, listw = lwsp_it)
summary(param)
# Demeaning model
param_dem &lt;- pspatfit(formpar, data = unemp_it,
                      demean = TRUE,
                      index = c("prov", "year"),
                      eff_demean = "individual" )
summary(param_dem)
# Compare results with plm package
param_plm &lt;- plm::plm(formula = formpar,
                      data = unemp_it,
                      index = c("prov", "year"),
                      effect = "individual",
                      model = "within")
summary(param_plm)                                              
param_dem_time &lt;- pspatfit(formpar, 
                      data = unemp_it, 
                      listw = lwsp_it,
                      demean = TRUE,
                      eff_demean = "time",
                      index = c("prov", "year"))
summary(param_dem_time)
param_plm_time &lt;- plm::plm(formula = formpar,
                      data = unemp_it,
                      index = c("prov", "year"),
                      effect = "time",
                      model = "within")
summary(param_plm_time)
param_dem_twoways &lt;- pspatfit(formpar, data = unemp_it,
                      demean = TRUE,
                      eff_demean = "twoways",
                      index = c("prov", "year") )
summary(param_dem_twoways)
param_plm_twoways &lt;- plm::plm(formula = formpar,
                      data = unemp_it,
                      index = c("prov", "year"),
                      effect = "twoways",
                      model = "within")
summary(param_plm_twoways)
##### Demeaning with nonparametric covariates
formgam &lt;- unrate ~ partrate + agri + cons +  
                    pspl(serv, nknots = 15) +
                    pspl(empgrowth, nknots = 20)
                    
gam_dem &lt;- pspatfit(formula = formgam,
                      data = unemp_it,
                      demean = TRUE,
                      index = c("prov", "year"))
summary(gam_dem)   
# Compare with GAM pure without demeaning                    
gam &lt;- pspatfit(formula = formgam,
                 data = unemp_it)
summary(gam)

## Demeaning with type = "sar" model
gamsar_dem &lt;- pspatfit(formula = formgam,
                      data = unemp_it,
                      type = "sar", 
                      listw = lwsp_it,
                      demean = TRUE,
                      index = c("prov", "year"))
summary(gamsar_dem)

               
</code></pre>

<hr>
<h2 id='pspl_terms'>Functions to include non-parametric continous covariates 
and spatial or spatio-temporal trends in semiparametric
regression models.</h2><span id='topic+pspl_terms'></span><span id='topic+pspl'></span><span id='topic+pspt'></span>

<h3>Description</h3>

<p>The <code>pspl()</code> and <code>pspt()</code> functions 
allow the inclusion of non-parametric continuous covariates
and spatial or spatio-temporal trends in semiparametric 
regression models. Both type of terms are modelled using P-splines.
</p>
<p><code>pspl()</code>: This function allows the inclusion of terms for
non-parametric covariates in semiparametric models. 
Each non-parametric covariate must be included with its own <code>pspl</code> 
term in a formula.
</p>
<p><code>pspt()</code>: This function allows the inclusion of a spatial or
spatio-temporal trend in the formula of the
semiparametric spatial or spatio-temporal models. 
The trend can be decomposed in an ANOVA
functional way including main and interaction effects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pspl(
  x,
  xl = min(x) - 0.01 * abs(min(x)),
  xr = max(x) + 0.01 * abs(max(x)),
  nknots = 10,
  bdeg = 3,
  pord = 2,
  decom = 2,
  scale = TRUE
)

pspt(
  sp1,
  sp2,
  time = NULL,
  scale = TRUE,
  ntime = NULL,
  xl_sp1 = min(sp1) - 0.01 * abs(min(sp1)),
  xr_sp1 = max(sp1) + 0.01 * abs(max(sp1)),
  xl_sp2 = min(sp2) - 0.01 * abs(min(sp2)),
  xr_sp2 = max(sp2) + 0.01 * abs(max(sp2)),
  xl_time = min(time) - 0.01 * abs(min(time)),
  xr_time = max(time) + 0.01 * abs(max(time)),
  nknots = c(10, 10, 5),
  bdeg = c(3, 3, 3),
  pord = c(2, 2, 2),
  decom = 2,
  psanova = FALSE,
  nest_sp1 = 1,
  nest_sp2 = 1,
  nest_time = 1,
  f1_main = TRUE,
  f2_main = TRUE,
  ft_main = TRUE,
  f12_int = TRUE,
  f1t_int = TRUE,
  f2t_int = TRUE,
  f12t_int = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pspl_terms_+3A_x">x</code></td>
<td>
<p>Name of the covariate.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_xl">xl</code></td>
<td>
<p>Minimum of the interval for the continuous covariate.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_xr">xr</code></td>
<td>
<p>Maximum of the interval for the continuous covariate.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_nknots">nknots</code></td>
<td>
<p>Vector including the number of knots of each 
coordinate for spline bases. Default = c(10,10,5). The order of the knots
in the vector follows the order of the specified spatio-temporal parameters 
so the first value of the vector is the number of knots for <code>sp1</code>, the second
value is for <code>sp2</code> and the third for <code>time</code>. See <code>Examples</code>.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_bdeg">bdeg</code></td>
<td>
<p>Order of the B-spline bases. Default = c(3,3,3).</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_pord">pord</code></td>
<td>
<p>Order of the penalty for the difference matrices 
in P-spline. Default = c(2,2,2).</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_decom">decom</code></td>
<td>
<p>Type of decomposition of fixed part when P-spline
term is expressed as a mixed model. If <code>decom = 1</code> the 
fixed part is given by <code class="reqn">X = B*U_n</code> where <em>B</em> is the
B-spline basis matrix and <em>U_n</em> is the nullspace basis of the 
penalty matrix. If <code>decom = 2</code> the fixed part is given by
<code class="reqn">X = [1|x|...|x^(pord-1)] </code>. Default = 2.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_scale">scale</code></td>
<td>
<p>Logical value to scale the spatial and temporal 
coordinates before the estimation of semiparametric model. 
Default = 'TRUE'</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_sp1">sp1</code></td>
<td>
<p>Name of the first spatial coordinate.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_sp2">sp2</code></td>
<td>
<p>Name of the second spatial coordinate.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_time">time</code></td>
<td>
<p>Name of the temporal coordinate. It must be 
specified only for spatio-temporal trends when using panel data. 
Default = 'NULL'.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_ntime">ntime</code></td>
<td>
<p>Number of temporal periods in panel data.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_xl_sp1">xl_sp1</code></td>
<td>
<p>Minimum of the interval for the first spatial coordinate.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_xr_sp1">xr_sp1</code></td>
<td>
<p>Maximum of the interval for the first spatial coordinate.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_xl_sp2">xl_sp2</code></td>
<td>
<p>Minimum of the interval for the second spatial coordinate.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_xr_sp2">xr_sp2</code></td>
<td>
<p>Maximum of the interval for the second spatial coordinate.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_xl_time">xl_time</code></td>
<td>
<p>Minimum of the interval for the temporal coordinate.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_xr_time">xr_time</code></td>
<td>
<p>Maximum of the interval for the temporal coordinate.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_psanova">psanova</code></td>
<td>
<p>Logical value to choose an ANOVA decomposition
of the spatial or spatio-temporal trend. Default = 'FALSE'.
If 'TRUE', you must specify the divisors for
main, and interaction effects. More in <code>Examples</code>.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_nest_sp1">nest_sp1</code></td>
<td>
<p>Vector including the divisor of the knots for main 
and interaction effects for the first spatial coordinate. It
is used for ANOVA decomposition models including nested bases.
Default = 1 (no nested bases). The values must be divisors and the resulting
value of the division should not be smaller than 4.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_nest_sp2">nest_sp2</code></td>
<td>
<p>Vector including the divisor of the knots for main 
and interaction effects for the second spatial coordinate. It
is used for ANOVA decomposition models including nested bases.
Default = 1 (no nested bases). The values must be divisors and the resulting
value of the division should not be smaller than 4.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_nest_time">nest_time</code></td>
<td>
<p>Vector including the divisor of the knots for main 
and interaction effects for the temporal coordinate. It
is used for ANOVA decomposition models including nested bases.
Default = 1 (no nested bases). The values must be divisors and the resulting
value of the division should not be smaller than 4.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_f1_main">f1_main</code></td>
<td>
<p>Logical value to include main effect for the first spatial
coordinate in ANOVA models. Default = 'TRUE'.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_f2_main">f2_main</code></td>
<td>
<p>Logical value to include main effect for the second spatial
coordinate in ANOVA models. Default = 'TRUE'.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_ft_main">ft_main</code></td>
<td>
<p>Logical value to include main effect for the temporal
coordinate in ANOVA models. Default = 'TRUE'.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_f12_int">f12_int</code></td>
<td>
<p>Logical value to include second-order interaction effect 
between first and second spatial coordinates in ANOVA models. 
Default = 'TRUE'.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_f1t_int">f1t_int</code></td>
<td>
<p>Logical value to include second-order interaction effect 
between first spatial and temporal coordinates in ANOVA 
models. Default = 'TRUE'.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_f2t_int">f2t_int</code></td>
<td>
<p>Logical value to include second-order interaction effect 
between second spatial and temporal coordinates in ANOVA 
models. Default = 'TRUE'.</p>
</td></tr>
<tr><td><code id="pspl_terms_+3A_f12t_int">f12t_int</code></td>
<td>
<p>Logical value to include third-order interaction effect 
between first and second spatial coordinates and temporal 
coordinates in ANOVA models. Default = 'TRUE'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>pspl()</code>: An object of class <em>bs</em> including.
</p>

<table>
<tr>
 <td style="text-align: left;">
    <code>B</code> </td><td style="text-align: left;"> Matrix including B-spline basis for the covariate </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>a</code> </td><td style="text-align: left;"> List including <em>nknots</em>, <em>knots</em>, <em>bdeg</em>,
        <em>pord</em> and <em>decom</em>.  </td>
</tr>
<tr>
 <td style="text-align: left;">
 </td>
</tr>

</table>

<p><code>pspt()</code>: An object of class <em>bs</em> including.
</p>

<table>
<tr>
 <td style="text-align: left;">
     <code>B</code> </td><td style="text-align: left;"> Matrix including B-spline basis for the covariate </td>
</tr>
<tr>
 <td style="text-align: left;">
     <code>a</code> </td><td style="text-align: left;"> List including <em>sp1</em>, <em>sp2</em>, <em>time</em>,
       <em>nknots</em>, <em>bdeg</em>, <em>pord</em>, <em>decom</em>,
       <em>psanova</em>, <em>nest_sp1</em>, <em>nest_sp2</em>,
       <em>nest_time</em>, <em>f1_main</em>, <em>f2_main</em>, <em>ft_main</em>,
       <em>f12_int</em>, <em>f1t_int</em>, <em>f2t_int</em>, and 
       <em>f12t_int</em>. </td>
</tr>
<tr>
 <td style="text-align: left;"> 
   </td>
</tr>

</table>



<h3>References</h3>

 
<ul>
<li><p> Eilers, P. and Marx, B. (1996). Flexible Smoothing with 
B-Splines and Penalties. <em>Statistical Science</em>, (11), 89-121.
</p>
</li>
<li><p> Eilers, P. and Marx, B. (2021). <em>Practical Smoothing. 
The Joys of P-Splines</em>. Cambridge University Press.
</p>
</li>
<li><p> Fahrmeir, L.; Kneib, T.;  Lang, S.; and Marx, B. (2021). 
<em>Regression. Models, Methods and Applications (2nd Ed.)</em>.
Springer.
</p>
</li>
<li><p> Lee, D. and Durban, M. (2011). P-Spline ANOVA Type Interaction 
Models for Spatio-Temporal Smoothing. <em>Statistical Modelling</em>, 
(11), 49-69. &lt;doi:10.1177/1471082X1001100104&gt;
</p>
</li>
<li><p> Lee, D. J., Durban, M., and Eilers, P. (2013). Efficient
two-dimensional smoothing with P-spline ANOVA mixed models 
and nested bases. <em>Computational Statistics &amp; Data Analysis</em>, 
(61), 22-37. &lt;doi:10.1016/j.csda.2012.11.013&gt;
</p>
</li>
<li><p> Minguez, R.; Basile, R. and Durban, M. (2020). An Alternative 
Semiparametric Model for Spatial Panel Data. <em>Statistical Methods and Applications</em>,
(29), 669-708. &lt;doi:	10.1007/s10260-019-00492-8&gt;
</p>
</li>
<li><p> Wood, S.N. (2017). <em>Generalized Additive Models. 
An Introduction with <code>R</code></em> (second edition). CRC Press, Boca Raton.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+pspatfit">pspatfit</a></code> estimate semiparametric spatial or
spatio-temporal regression models.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(pspatreg)
###############################################
# Examples using spatial data of Ames Houses.
###############################################
library(spdep)
library(sf)
ames &lt;- AmesHousing::make_ames() # Raw Ames Housing Data
ames_sf &lt;- st_as_sf(ames, coords = c("Longitude", "Latitude"))
ames_sf$Longitude &lt;- ames$Longitude
ames_sf$Latitude &lt;- ames$Latitude
ames_sf$lnSale_Price &lt;- log(ames_sf$Sale_Price)
ames_sf$lnLot_Area &lt;- log(ames_sf$Lot_Area)
ames_sf$lnTotal_Bsmt_SF &lt;- log(ames_sf$Total_Bsmt_SF+1)
ames_sf$lnGr_Liv_Area &lt;- log(ames_sf$Gr_Liv_Area)
ames_sf1 &lt;- ames_sf[(duplicated(ames_sf$Longitude) == FALSE), ]
####  GAM pure with pspatreg
form1 &lt;- lnSale_Price ~ Fireplaces + Garage_Cars +
          pspl(lnLot_Area, nknots = 20) + 
          pspl(lnTotal_Bsmt_SF, nknots = 20) +
          pspl(lnGr_Liv_Area, nknots = 20)    
gampure &lt;- pspatfit(form1, data = ames_sf1)
summary(gampure)
 
########### Constructing the spatial weights matrix
coord_sf1 &lt;- cbind(ames_sf1$Longitude, ames_sf1$Latitude)
k5nb &lt;- knn2nb(knearneigh(coord_sf1, k = 5, 
                          longlat = TRUE, use_kd_tree = FALSE), sym = TRUE)
lw_ames &lt;- nb2listw(k5nb, style = "W", 
                  zero.policy = FALSE)
#####################  GAM + SAR Model
gamsar &lt;- pspatfit(form1, data = ames_sf1, 
                   type = "sar", listw = lw_ames,
                   method = "Chebyshev")
summary(gamsar)
### Models with 2d spatial trend
form2 &lt;- lnSale_Price ~ Fireplaces + Garage_Cars +
          pspl(lnLot_Area, nknots = 20) + 
          pspl(lnTotal_Bsmt_SF, nknots = 20) +
          pspl(lnGr_Liv_Area, nknots = 20) +
          pspt(Longitude, Latitude, 
               nknots = c(10, 10), 
               psanova = FALSE)
#####################  GAM + GEO Model
gamgeo2d &lt;- pspatfit(form2, data = ames_sf1)
summary(gamgeo2d)

gamgeo2dsar &lt;- pspatfit(form2, data = ames_sf1,
                        type = "sar", 
                        listw = lw_ames, 
                        method = "Chebyshev")
summary(gamgeo2dsar)
### Models with psanova 2d spatial trend
form3 &lt;- lnSale_Price ~ Fireplaces + Garage_Cars +
          pspl(lnLot_Area, nknots = 20) + 
          pspl(lnTotal_Bsmt_SF, nknots = 20) +
          pspl(lnGr_Liv_Area, nknots = 20) +
          pspt(Longitude, Latitude, 
               nknots = c(10, 10), 
               psanova = TRUE)
gamgeo2danovasar &lt;- pspatfit(form3, data = ames_sf1,
                        type = "sar", 
                        listw = lw_ames, method = "Chebyshev")
summary(gamgeo2danovasar)
 ###############################################
###################### Examples using a panel data of rate of
###################### unemployment for 103 Italian provinces in 1996-2019.
 ###############################################
## load spatial panel and Wsp_it
## 103 Italian provinces. Period 1996-2019
data(unemp_it, package = "pspatreg")
## Wsp_it is a matrix. Create a neighboord list 
lwsp_it &lt;- spdep::mat2listw(Wsp_it, style = "W")
 ### Spatio-temporal semiparametric ANOVA model 
 ### Interaction terms f12,f1t,f2t and f12t with nested basis
 ### Remark: nest_sp1, nest_sp2 and nest_time must be divisors of nknots
 form4 &lt;- unrate ~ partrate + agri + cons +
                   pspl(serv, nknots = 15) + 
                   pspl(empgrowth, nknots = 20) +
                   pspt(long, lat, year, 
                        nknots = c(18, 18, 8), 
                        psanova = TRUE, 
                        nest_sp1 = c(1, 2, 2), 
                        nest_sp2 = c(1, 2, 2),
                        nest_time = c(1, 2, 2))
 sptanova &lt;- pspatfit(form4, data = unemp_it)
 summary(sptanova)
 

 ################################################  
 ### Interaction terms f1t not included in ANOVA decomposition
 form5 &lt;- unrate ~ partrate + agri + cons +
                   pspl(serv, nknots = 15) + 
                   pspl(empgrowth, nknots=20) +
                   pspt(long, lat, year, 
                        nknots = c(18, 18, 8),
                        psanova = TRUE, 
                        nest_sp1 = c(1, 2, 3), 
                        nest_sp2 = c(1, 2, 3),
                        nest_time = c(1, 2, 2), 
                        f1t_int = FALSE)
 ## Add sar specification and ar1 temporal correlation 
 sptanova2_sar_ar1 &lt;- pspatfit(form5, data = unemp_it, 
                              listw = lwsp_it, 
                              type = "sar",
                              cor = "ar1")
summary(sptanova2_sar_ar1)                                 
 
</code></pre>

<hr>
<h2 id='summary.impactspar.pspatreg'>Summary method for object of class impactspar.pspatreg.</h2><span id='topic+summary.impactspar.pspatreg'></span>

<h3>Description</h3>

<p>This method summarizes direct, indirect and total effects (or impacts)
for continous parametric covariates in semiparametric spatial regression models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'impactspar.pspatreg'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.impactspar.pspatreg_+3A_object">object</code></td>
<td>
<p><em>impactspar</em> object fitted using <code><a href="#topic+pspatfit">pspatfit</a></code> function.</p>
</td></tr>
<tr><td><code id="summary.impactspar.pspatreg_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <em>summary.impactspar.pspatreg</em>
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;"> 
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roberto Basile </td><td style="text-align: left;"> <a href="mailto:roberto.basile@univaq.it">roberto.basile@univaq.it</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Maria Durban </td><td style="text-align: left;">
  <a href="mailto:mdurban@est-econ.uc3m.es">mdurban@est-econ.uc3m.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Gonzalo Espana-Heredia </td><td style="text-align: left;">
  <a href="mailto:gehllanza@gmail.com">gehllanza@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> 
 </td>
</tr>

</table>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+impactspar">impactspar</a></code> Compute direct, indirect and total
impacts for continous parametric covariates.
</p>
</li>
<li> <p><code><a href="#topic+print.summary.impactspar.pspatreg">print.summary.impactspar.pspatreg</a></code> print objects of
class <em>summary.pspatreg</em>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'> # See examples for \code{\link{impactspar}} function.
</code></pre>

<hr>
<h2 id='summary.pspatreg'>Summary method for objects of class pspatreg.</h2><span id='topic+summary.pspatreg'></span>

<h3>Description</h3>

<p>This method summarizes both spatial (2-dimension) and
spatio-temporal (3-dimension) <em>pspatreg</em> objects.
The tables include information of:
</p>

<ul>
<li><p> The spatial (or spatio-temporal) trends. When the model is ANOVA
the trend is decomposed in main and interaction effects.
</p>
</li>
<li><p> The parametric and non-parametric covariates.
</p>
</li>
<li><p> The <code class="reqn">\rho</code> parameter when the model is SAR.
</p>
</li>
<li><p> The <code class="reqn">\phi</code> parameter when the model is spatio-temporal
with a first-order autorregressive in the noise.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'pspatreg'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.pspatreg_+3A_object">object</code></td>
<td>
<p><em>pspatreg</em> object fitted using <code><a href="#topic+pspatfit">pspatfit</a></code> function.</p>
</td></tr>
<tr><td><code id="summary.pspatreg_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <em>summary.pspatreg</em>
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;"> 
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roberto Basile </td><td style="text-align: left;"> <a href="mailto:roberto.basile@univaq.it">roberto.basile@univaq.it</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Maria Durban </td><td style="text-align: left;">
  <a href="mailto:mdurban@est-econ.uc3m.es">mdurban@est-econ.uc3m.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> Gonzalo Espana-Heredia </td><td style="text-align: left;">
  <a href="mailto:gehllanza@gmail.com">gehllanza@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;"> 
 </td>
</tr>

</table>



<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+pspatfit">pspatfit</a></code> estimate spatial or spatio-temporal semiparametric 
regression models.
</p>
</li>
<li> <p><code><a href="#topic+print.summary.pspatreg">print.summary.pspatreg</a></code> print objects of class <em>summary.pspatreg</em>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'> # See examples for \code{\link{pspatfit}} function.

</code></pre>

<hr>
<h2 id='unemp_it'>Regional unemployment rates Italian provinces</h2><span id='topic+unemp_it'></span>

<h3>Description</h3>

<p>A panel dataset containing unemployment rates and other economic
variables for Italian NUTS-3 provinces during the years 1996-2019.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>unemp_it
</code></pre>


<h3>Format</h3>

<p>A data frame with 2472 rows and 17 variables:
</p>

<dl>
<dt>prov</dt><dd><p>province (NUTS-3) coded as a number.</p>
</dd>
<dt>name</dt><dd><p>province (NUTS-3) coded as a name.</p>
</dd>
<dt>reg</dt><dd><p>region (NUTS-2) coded as a name.</p>
</dd>
<dt>year</dt><dd><p>year.</p>
</dd>
<dt>area</dt><dd><p>area of the province (km~2~).</p>
</dd>
<dt>unrate</dt><dd><p>unemployment rate (percentage).</p>
</dd>
<dt>agri</dt><dd><p>share of employment in agriculture (percentage).</p>
</dd>
<dt>ind</dt><dd><p>share of employment in industry (percentage).</p>
</dd>
<dt>cons</dt><dd><p>share of employment in construction (percentage).</p>
</dd>
<dt>serv</dt><dd><p>share of employment in services (percentage).</p>
</dd>
<dt>popdens</dt><dd><p>population density.</p>
</dd>
<dt>partrate</dt><dd><p>labor force participation rate, i.e. the
ratio between the total labor force and the
working population.</p>
</dd>
<dt>empgrowth</dt><dd><p>employment growth rate (percentage).</p>
</dd>
<dt>long</dt><dd><p>longitude of the centroid of the province.</p>
</dd>
<dt>lat</dt><dd><p>latitude of the centroid of the province.</p>
</dd>
<dt>South</dt><dd><p>dummy variable with unit value for southern provinces.</p>
</dd>
<dt>ln_popdens</dt><dd><p>logarithm of population density.</p>
</dd>
</dl>



<h3>Source</h3>

<p>Italian National Institute of Statistics (ISTAT)
<em>https://www.istat.it</em>
</p>

<hr>
<h2 id='Wsp_it'>Spatial weight matrix for Italian provinces</h2><span id='topic+Wsp_it'></span>

<h3>Description</h3>

<p>A spatial weight matrix row-standardized for Italian NUTS-3 provinces
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Wsp_it
</code></pre>


<h3>Format</h3>

<p>A row-standardized squared matrix with 103 rows and columns. 
The rows and columns follow the same order than provinces included in 
<em>unemp_it</em> data frame.
</p>


<h3>Source</h3>

<p>Italian National Institute of Statistics (ISTAT)
<em>https://www.istat.it</em>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
