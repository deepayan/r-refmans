<!DOCTYPE html><html><head><title>Help for package forestinventory</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {forestinventory}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#confint'><p>Calculates Confidence Intervals for Global and Small-Area Estimations</p></a></li>
<li><a href='#estTable'><p>estTable</p></a></li>
<li><a href='#forestinventory'><p>forestinventory: A package for computing design-based estimates for multiphase forest inventories</p></a></li>
<li><a href='#grisons'><p>Data from a multiphase forest inventory in the canton of Grisons, Switzerland</p></a></li>
<li><a href='#mphase.gain'><p>mphase.gain</p></a></li>
<li><a href='#onephase'><p>onephase</p></a></li>
<li><a href='#plot.esttable'><p>Plotting Estimation Results</p></a></li>
<li><a href='#summary'><p>Summarizing Global and Small-Area Estimation Results</p></a></li>
<li><a href='#threephase'><p>threephase</p></a></li>
<li><a href='#twophase'><p>twophase</p></a></li>
<li><a href='#zberg'><p>Data from a multiphase forest inventory at the zurichberg (zurich), switzerland</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Design-Based Global and Small-Area Estimations for Multiphase
Forest Inventories</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2021-01-08</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Andreas Hill &lt;andreas.hill@wald-rlp.de&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Extensive global and small-area estimation procedures for multiphase
    forest inventories under the design-based Monte-Carlo approach are provided.
    The implementation has been published in the Journal of Statistical Software (&lt;<a href="https://doi.org/10.18637%2Fjss.v097.i04">doi:10.18637/jss.v097.i04</a>&gt;) 
    and includes estimators for simple and cluster sampling
    published by Daniel Mandallaz in 2007 (&lt;<a href="https://doi.org/10.1201%2F9781584889779">doi:10.1201/9781584889779</a>&gt;),
    2013 (&lt;<a href="https://doi.org/10.1139%2Fcjfr-2012-0381">doi:10.1139/cjfr-2012-0381</a>&gt;, &lt;<a href="https://doi.org/10.1139%2Fcjfr-2013-0181">doi:10.1139/cjfr-2013-0181</a>&gt;,
    &lt;<a href="https://doi.org/10.1139%2Fcjfr-2013-0449">doi:10.1139/cjfr-2013-0449</a>&gt;, &lt;<a href="https://doi.org/10.3929%2Fethz-a-009990020">doi:10.3929/ethz-a-009990020</a>&gt;)
    and 2016 (&lt;<a href="https://doi.org/10.3929%2Fethz-a-010579388">doi:10.3929/ethz-a-010579388</a>&gt;). It provides point estimates,
    their external- and design-based variances and confidence intervals, as well as a
    set of functions to analyze and visualize the produced estimates.
    The procedures have also been optimized for the use of remote sensing data
    as auxiliary information, as demonstrated in 2018 by Hill et al. (&lt;<a href="https://doi.org/10.3390%2Frs10071052">doi:10.3390/rs10071052</a>&gt;).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>LazyData:</td>
<td>TRUE</td>
</tr>
<tr>
<td>Imports:</td>
<td>methods, stats, utils, plyr (&ge; 1.8.6), tidyr, ggplot2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>R.rsp</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>R.rsp</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-01-08 09:27:51 UTC; Andi</td>
</tr>
<tr>
<td>Author:</td>
<td>Andreas Hill [aut, cre],
  Alexander Massey [aut],
  Daniel Mandallaz [ctb]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-01-08 11:00:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='confint'>Calculates Confidence Intervals for Global and Small-Area Estimations</h2><span id='topic+confint'></span><span id='topic+confint.onephase'></span><span id='topic+confint.twophase'></span><span id='topic+confint.threephase'></span>

<h3>Description</h3>

<p>Calculates Confidence Intervals for Global and Small-Area Estimations
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'onephase'
confint(object, parm, level = 0.95, adjust.method = "none", ...)

## S3 method for class 'twophase'
confint(object, parm, level = 0.95, adjust.method = "none", ...)

## S3 method for class 'threephase'
confint(object, parm, level = 0.95, adjust.method = "none", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="confint_+3A_object">object</code></td>
<td>
<p>object of class <code>onephase</code>, <code>twophase</code> or <code>threephase</code>,
containing estimation results of the respective estimation method.</p>
</td></tr>
<tr><td><code id="confint_+3A_parm">parm</code></td>
<td>
<p>ignored.</p>
</td></tr>
<tr><td><code id="confint_+3A_level">level</code></td>
<td>
<p>the confidence level required.</p>
</td></tr>
<tr><td><code id="confint_+3A_adjust.method">adjust.method</code></td>
<td>
<p>correction method to obtain simultaneous confidence intervals
for a set of estimates (thus restricted to objects of class <code>"onephase"</code>,
<code>c("smallarea", "twophase")</code> and  <code>c("smallarea", "threephase")</code>).
Available correction methods are <code>c("none","bonferroni")</code>. Defaults to <code>"none"</code>.</p>
</td></tr>
<tr><td><code id="confint_+3A_...">...</code></td>
<td>
<p>additional arguments, so far ignored.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Depending on the estimation method specified, <code>confint()</code> computes confidence intervals as follows:
</p>
<p><code><a href="#topic+onephase">onephase</a></code>:
</p>
<p>Two-sided confidence intervals are computed based on the t-distribution with <code>n2 - 1</code> <em>degrees of freedom</em>,
where <code>n2</code> is the number of terrestrial data in the respective inventory domain.
</p>
<p><code><a href="#topic+twophase">twophase</a></code>:
</p>
<p>The calculation of the two-sided confidence intervals for <em>global</em> twophase estimates
(objects of class <code>global</code>) are calculated based on the quantiles of the <em>t</em>-distribution
with <code>n2 - p</code> <em>degrees of freedom</em>, where <code>p</code> is the number of parameters used in
the regression model, and <code>n2</code> is the number of terrestrial observations (i.e. <em>local densities</em>)
in the inventory domain.
</p>
<p>The calculation of the two-sided confidence intervals for <em>smallarea</em> twophase estimates
(objects of class <code>smallarea</code>) are calculated based on the quantiles of the <em>t</em>-distribution
with <code>n2G - 1</code> <em>degrees of freedom</em>, where <code>n2G</code> is the number of
terrestrial observations (i.e. <em>local densities</em>) in the smallarea.
</p>
<p><code><a href="#topic+threephase">threephase</a></code>:
</p>
<p>The calculation of the two-sided confidence intervals for <em>global</em> threephase estimates
(objects of class <code>global</code>) are calculated based on the quantiles of the <em>t</em>-distribution
with <code>n2 - p</code> <em>degrees of freedom</em>, where <code>p</code> is the number of parameters used in
the <strong>full</strong> regression model, and <code>n2</code> is the number of terrestrial observations
(i.e. <em>local densities</em>) in the inventory domain (note: in notation used here n0, n1 and n2
correspond to the zero, first and second phase sample sizes respectively).
</p>
<p>The calculation of the two-sided confidence intervals for <em>smallarea</em> theephase estimates
(objects of class <code>smallarea</code>) are calculated based on the quantiles of the <em>t</em>-distribution
with <code>n2G - 1</code> <em>degrees of freedom</em>, where <code>n2G</code> is the number of
terrestrial observations (i.e. <em>local densities</em>) in the smallarea.
</p>


<h3>Value</h3>

<p><code>confint</code> returns a list of  the following 3 components:
</p>
<table>
<tr><td><code>ci</code></td>
<td>
<p>a <code>data.frame</code> containing the columns:
</p>

<ul>
<li> <p><code>area</code> the domain, i.e. small area
</p>
</li>
<li> <p><code>ci_lower_ext</code> the lower confidence limit based on the external variance
</p>
</li>
<li> <p><code>ci_upper_ext</code> the upper confidence limit based on the external variance
</p>
</li>
<li> <p><code>ci_lower_g</code>   the lower confidence limit based on the g-weight variance
</p>
</li>
<li> <p><code>ci_upper_g</code>   the upper confidence limit based on the g-weight variance
</p>
</li></ul>
</td></tr>
<tr><td><code>level</code></td>
<td>
<p>the applied confidence level</p>
</td></tr>
<tr><td><code>adjust.method</code></td>
<td>
<p>the adjustment method applied to retrieve simultaneous confidence intervals</p>
</td></tr>
</table>


<h3>Note</h3>

<p>In the special case of <em>synthetic</em> smallarea estimations, the two-sided confidence intervals
are calculated based on the quantiles of the <em>t</em>-distribution
with <code>n2 - p</code> <em>degrees of freedom</em>, i.e. based on the global sample size.
</p>
<p>The confidence intervals for <em>synthetic</em> smallarea estimations do not account for the potential
bias of a linear model that was fit in a large forest area and applied to a small area.  Thus,
the coverage rates for confidence intervals produced by synthetic estimators may be less than
the nominal level of confidence.
</p>
<p>In case of cluster-sampling, <code>n2G</code> is the number of terrestrial clusters
(a cluster constitutes the sample unit). This is automatically considered by <code>confint</code>.
</p>
<p>The adjustment methods passed to <code>adjust.method</code> are designed to achieve
<em>simultaneous</em> confidence intervals by correcting the confidence level given by <code>level</code>.
The use of this option is recommended if a set of estimates contained in a <code>onephase</code>- or
<code>smallarea</code>-object should be compared by their confidence intervals. It ensures that the
percentage of confidence intervals containing the true value will correspond to
the nominal confidence level.
</p>


<h3>References</h3>

<p>Hill, A., Massey, A. F. (2021). <em>The R Package forestinventory: Design-Based Global and Small
Area Estimations for Multiphase Forest Inventories.</em> Journal of Statistical Software, 97(4), 1-40.
</p>
<p>Mandallaz, D. (2013). <em>Design-based properties of some small-area estimators in forest inventory
with two-phase sampling.</em> Canadian Journal of Forest Research, 43(5), 441-449.
</p>
<p>Mandallaz, D., Breschan, J., &amp; Hill, A. (2013). <em>New regression estimators in forest inventories
with two-phase sampling and partially exhaustive information: a design-based monte carlo approach
with applications to small-area estimation.</em> Canadian Journal of Forest Research,
43(11), 1023-1031.
</p>
<p>Mandallaz, D. (2013). <em>A three-phase sampling extension of the generalized regression estimator
with partially exhaustive information.</em> Canadian Journal of Forest Research,
44(4), 383-388.
</p>
<p>Benjamini, Y., and Hochberg, Y. (1995). <em>Controlling the false discovery rate:
a practical and powerful approach to multiple testing.</em>
Journal of the Royal Statistical Society Series B 57, 289-300.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Calculate twophase estimations by extended pseudosynthetic estimator
#  for 4 small areas ("A", "B", "C", "D") using the grisons-dataset:
sae.est &lt;- twophase(formula = tvol ~ mean + stddev + max + q75,
                    data = grisons,
                    phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                    small_area = list(sa.col = "smallarea",
                                      areas = c("A", "B","C", "D"),
                                      unbiased = TRUE))

## calculate 95%-confidence intervals for each small area:
confint(sae.est)

## calculate simultaneous 95%-confidence intervals using 'bonferroni'-method:
confint(sae.est, adjust.method = "bonferroni")
</code></pre>

<hr>
<h2 id='estTable'>estTable</h2><span id='topic+estTable'></span>

<h3>Description</h3>

<p><code>estTable</code> can be used to compare the results of <code><a href="#topic+onephase">onephase</a></code> to multiphase estimations
(<code><a href="#topic+twophase">twophase</a></code>, <code><a href="#topic+threephase">threephase</a></code>). It restructures the estimation results into a table that can
be used to plot the estimation results and provides the basis for further analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estTable(
  est.list,
  sae = FALSE,
  add.ci = TRUE,
  vartypes = c("variance", "ext_variance", "g_variance")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estTable_+3A_est.list">est.list</code></td>
<td>
<p>a <code><a href="base.html#topic+list">list</a></code> object containing at least one multiphase estimation object created by
the <code><a href="#topic+twophase">twophase</a></code> or <code><a href="#topic+threephase">threephase</a></code> function and the respective <code><a href="#topic+onephase">onephase</a></code> estimation object.</p>
</td></tr>
<tr><td><code id="estTable_+3A_sae">sae</code></td>
<td>
<p>an object of type <code><a href="base.html#topic+logical">logical</a></code>. Has to be set to <code>TRUE</code> if results of small area estimations are passed to <code>estTable</code>.
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="estTable_+3A_add.ci">add.ci</code></td>
<td>
<p><code>logical</code>: Should confidence intervals be added? Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="estTable_+3A_vartypes">vartypes</code></td>
<td>
<p>Specifying the variances that should be included in the estimation table. Has to be specified as a <code>character</code> vector. The full set
contains <code>"variance"</code>, <code>"ext_variance"</code> and <code>"g_variance"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>estTable</code> returns a <code>list</code> of the following components:
</p>

<ul>
<li> <p><code>area:</code> in case of small area estimations: the name of the small area
</p>
</li>
<li> <p><code>estimate:</code> the point estimates
</p>
</li>
<li> <p><code>vartype:</code> the type of variance
</p>
</li>
<li> <p><code>variance:</code> the variance values
</p>
</li>
<li> <p><code>std:</code> the standard errors (square root of variance values)
</p>
</li>
<li> <p><code>error:</code> the estimation errors defined as the ratio between <em>standard error</em> and <em>point estimate</em>
</p>
</li>
<li> <p><code>domain:</code> indicating if current row belongs to a <code>smallarea</code> or <code>global</code> estimation
</p>
</li>
<li> <p><code>estimator:</code> the estimator that that was applied
</p>
</li>
<li> <p><code>method:</code> the estimation method that was applied
</p>
</li>
<li> <p><code>n2:</code> terrestrial sample size in entire inventory area
</p>
</li>
<li> <p><code>n1:</code> first phase sample size in entire inventory area
</p>
</li>
<li> <p><code>n0:</code> in case of <code>threephase</code> estimations: zero phase sample size in entire inventory area
</p>
</li>
<li> <p><code>n2G:</code> terrestrial sample size in small area
</p>
</li>
<li> <p><code>n1G:</code> first phase sample size in small area
</p>
</li>
<li> <p><code>n0G:</code> in case of <code>threephase</code> estimations: zero phase sample size in small area
</p>
</li>
<li> <p><code>r.squared:</code> coefficient of determination of regression model
</p>
</li>
<li> <p><code>r.squared_reduced:</code> in case of <code>threephase</code> estimations: coefficient of determination of reduced regression model
</p>
</li>
<li> <p><code>r.squared_full:</code> in case of <code>threephase</code> estimations: coefficient of determination of full regression model
</p>
</li>
<li> <p><code>ci_lower:</code> if <code>add.ci=TRUE</code>: lower confidence limit
</p>
</li>
<li> <p><code>ci_upper:</code> if <code>add.ci=TRUE</code>: upper confidence limit
</p>
</li></ul>



<h3>Note</h3>

<p>An estimation object of class <code>onephase</code> as input is mandatory
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## run onephase estimation:
op.a &lt;- onephase(formula = tvol~1,
                 data = grisons,
                 phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                 area = list(sa.col = "smallarea", areas = c("A", "B", "C", "D")))

## run small area twophase estimation:
sae.2p.est &lt;- twophase(formula = tvol ~ mean + stddev + max + q75,
                       data = grisons,
                       phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                       small_area = list(sa.col = "smallarea", areas = c("A", "B","C", "D"),
                                         unbiased = TRUE))

## run small area threephase estimation:
sae.3p.est &lt;- threephase(formula.s0 =  tvol ~ mean,
                         formula.s1 = tvol ~ mean + stddev + max + q75,
                         data = grisons,
                         phase_id = list(phase.col = "phase_id_3p", s1.id = 1, terrgrid.id = 2),
                         small_area=list(sa.col = "smallarea", areas = c("A", "B", "C", "D"),
                                         unbiased = TRUE))

## create estimation table with confidence intervals:
sae.table&lt;- estTable(est.list = list(op.a, sae.2p.est, sae.3p.est), add.ci=TRUE,
                     sae = TRUE, vartypes = c("variance", "g_variance",  "ext_variance"))

sae.table.df&lt;- as.data.frame(sae.table)
</code></pre>

<hr>
<h2 id='forestinventory'>forestinventory: A package for computing design-based estimates for multiphase forest inventories</h2><span id='topic+forestinventory'></span>

<h3>Description</h3>

<p>The package provides <strong><em>global</em></strong>- and <strong><em>smallarea estimators</em></strong> for
<strong><em>twophase</em></strong> and <strong><em>threephase</em></strong> forest inventories under simple and
cluster sampling, which have been developed by Daniel Mandallaz at
ETH Zurich. The implemented methods have been published and applied in various studies
(see <code>References</code>) and can be used for <strong><em>double- and triple sampling for stratification</em></strong>,
<strong><em>double- and triple sampling for regression</em></strong> and <strong><em>double- and triple sampling for regression within strata</em></strong>.
</p>


<h3>Functions</h3>

<p>The package provides three main functions to apply the various estimators for
<em>twophase</em> and <em>threephase</em> forest inventories:
</p>

<ul>
<li> <p><code><a href="#topic+twophase">twophase</a></code>    Function to apply global- and various smallarea estimation techniques for twophase inventories
</p>
</li>
<li> <p><code><a href="#topic+threephase">threephase</a></code>  Function to apply global- and various smallarea estimation techniques for threephase inventories
</p>
</li>
<li> <p><code><a href="#topic+onephase">onephase</a></code>    Function to apply estimations for onephase inventories,  mainly for comparison
with <code>two</code>-and <code>threephase</code>
</p>
</li></ul>



<h3>Motivation</h3>

<p>The Motivation of writing this package was to provide an extensive and consistent
collection of state-of-the-art <em>design-based</em> estimation techniques for forest inventories.
It was especially designed to facilitate the application of the available estimators
in forest practice as well as in scientifically related studies. The work on this
package was also the trigger to complete the range of the already published estimators,
especially in the framework of three-phase smallarea estimators.
</p>


<h3>Selected references</h3>

<p>Hill, A., Massey, A. F. (2021). <em>The R Package forestinventory: Design-Based Global and Small
Area Estimations for Multiphase Forest Inventories.</em> Journal of Statistical Software, 97(4), 1-40.
</p>
<p>Massey, A. F. (2015). <em>Multiphase estimation procedures for forest inventories under
the design-based Monte Carlo approach</em> (Doctoral dissertation, Diss., ETH Zurich, Nr. 23025).
</p>
<p>Mandallaz, D. (2013). <em>Design-based properties of some small-area estimators in
forest inventory with two-phase sampling.</em> Canadian Journal of Forest Research, 43(5), 441-449.
</p>
<p>Mandallaz, D., Breschan, J., &amp; Hill, A. (2013). <em>New regression estimators in forest inventories
with two-phase sampling and partially exhaustive information: a design-based monte carlo approach
with applications to small-area estimation.</em> Canadian Journal of Forest Research, 43(11), 1023-1031.
</p>
<p>Mandallaz, D. (2013). <em>A three-phase sampling extension of the generalized regression estimator
with partially exhaustive information.</em> Canadian Journal of Forest Research, 44(4), 383-388.
</p>

<hr>
<h2 id='grisons'>Data from a multiphase forest inventory in the canton of Grisons, Switzerland</h2><span id='topic+grisons'></span>

<h3>Description</h3>

<p>A dataset containing observations of 306 systematically arranged sample plots.
Auxiliary information for all 306 plots is provided in the form of LiDAR canopy height metrics.
For a systematic subsample of 67 out of the 306 plots, terrestrial information of the timber volume
is provided from a terrestrial survey in the year 2007. Originally the inventory was carried out as a twophase inventory and
has been artificially extended to a threephase inventory for demonstration purposes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>grisons
</code></pre>


<h3>Format</h3>

<p>data frame with 306 rows and 14 columns
</p>


<h3>Details</h3>


<ul>
<li><p><code>phase_id_2p</code> phase-membership of each observation for the twophase inventory.
The large phase is indicated by <code>1</code>, the terrestrial phase by <code>2</code>.
</p>
</li>
<li><p><code>phase_id_3p</code> phase-membership of each observation for the threephase inventory,
i.e. the largest phase (<code>0</code>), the large phase (<code>1</code>)
and terrestrial phase (<code>2</code>). <em>Note:</em> The threephase sample scheme
was artificially created for demonstration purposes of the
<code><a href="#topic+threephase">threephase</a></code>-functions.
</p>
</li>
<li><p><code>boundary_weights</code> proportion of analysis-window for auxiliary information lying within the forest.
</p>
</li>
<li><p><code>mean</code> mean canopy height at the sample location based on the LiDAR canopy height model.
</p>
</li>
<li><p><code>stddev</code> standard deviation of the LiDAR canopy height model at the sample location.
</p>
</li>
<li><p><code>max</code> maximum value of the LiDAR canopy height model at the sample location.
</p>
</li>
<li><p><code>q75</code> 75%-Quantile of the LiDAR canopy height model at the sample location.
</p>
</li>
<li><p><code>smallarea</code> smallarea-indicator for each observation.
</p>
</li>
<li><p><code>tvol</code> terrestrial timber volume from field survey. Use for <code><a href="#topic+twophase">twophase</a></code>-inventory.
</p>
</li>
<li><p><code>tvol.3p</code> terrestrial timber volume from field survey. Use for <code><a href="#topic+threephase">threephase</a></code>-inventory.
</p>
</li></ul>



<h3>Note</h3>

<p>There are additional columns in <code>grisons</code> to demonstrate the function-behaviors
for special cases which might occur in a forest inventory
</p>

<ul>
<li><p><code>phase_id_3p_nG0</code> one of the smallareas does not contain any terrestrial observation.
</p>
</li>
<li><p><code>phase_id_3p_nG1</code> one of the smallareas does contain only a single terrestrial observation.
</p>
</li>
<li><p><code>tvol.3p_nG0</code> Use as response variable to test <code>phase_id_3p_nG0</code> for <code><a href="#topic+threephase">threephase</a></code>-inventory.
</p>
</li>
<li><p><code>tvol.3p_nG1</code> Use as response variable to test <code>phase_id_3p_nG1</code> for <code><a href="#topic+threephase">threephase</a></code>-inventory.
</p>
</li></ul>

<p>We leave testing these special cases to the user.
</p>


<h3>Source</h3>

<p>The terrestrial data are kindly provided by the forest service of the canton grisons.
</p>
<p>The dataset was created and used within the framework of the publications listed under <em>References</em>.
</p>


<h3>References</h3>

<p>Mandallaz, D., Breschan, J., &amp; Hill, A. (2013). <em>New regression estimators in forest inventories
with two-phase sampling and partially exhaustive information:
a design-based monte carlo approach with applications to small-area estimation.</em>
Canadian Journal of Forest Research, 43(11), 1023-1031.
</p>
<p>Hill, A., Breschan, J., &amp; Mandallaz, D. (2014). <em>Accuracy assessment of timber
volume maps using forest inventory data and LiDAR canopy height models.</em>
Forests, 5(9), 2253-2275.
</p>

<hr>
<h2 id='mphase.gain'>mphase.gain</h2><span id='topic+mphase.gain'></span>

<h3>Description</h3>

<p><code>mphase.gain</code> takes as input an object created by the <code><a href="#topic+estTable">estTable</a></code> function
and returns a validation of which multiphase method and estimator performed best in comparison
to the onephase estimation (baseline) in terms of estimation precision.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mphase.gain(esttable.obj, pref.vartype = "g_variance", exclude.synth = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mphase.gain_+3A_esttable.obj">esttable.obj</code></td>
<td>
<p>an object of class <code>esttable</code> created by the <code><a href="#topic+estTable">estTable</a></code> function</p>
</td></tr>
<tr><td><code id="mphase.gain_+3A_pref.vartype">pref.vartype</code></td>
<td>
<p>preferred type of multiphase variance that should be compared to the <code>onephase</code> variance,
if more then one variance type has been calculated in the multiphase estimation object(s) stored in
<code>esttable</code>. Valid input values are <code>"g_variance"</code> (default) and <code>"ext_variance"</code>.</p>
</td></tr>
<tr><td><code id="mphase.gain_+3A_exclude.synth">exclude.synth</code></td>
<td>
<p><code>logical</code>. If set to <code>TRUE</code> (default), synthetic estimations are not considered in the validation.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>mphase.gain</code> returns a <code>data.frame</code> containing the following components:
</p>

<ul>
<li> <p><code>area:</code> in case of small area estimation: the name of the small area
</p>
</li>
<li> <p><code>var_onephase:</code> standard error of the <code><a href="#topic+onephase">onephase</a></code> estimation
</p>
</li>
<li> <p><code>var_multiphase:</code> smallest variance among the (set of) multiphase estimations stored in <code>esttable.obj</code>
</p>
</li>
<li> <p><code>estimator:</code> multiphase estimator with the smallest variance
</p>
</li>
<li> <p><code>method:</code> estimation Method of the multiphase estimator with the smallest variance
</p>
</li>
<li> <p><code>gain:</code> the <em>gain</em> is the reduction (if value is positive) or possibly also the increase (if value is negative)
in variance when applying the multiphase as alternative to the onephase estimation
</p>
</li>
<li> <p><code>rel.eff:</code> the <em>relative efficiency</em> defined as the ratio between the onephase variance and the multiphase variance

</p>
</li></ul>



<h3>Note</h3>

<p>The <em>gain</em> can be interpreted as: &quot;The multiphase estimation procedure leads to a <code>gain</code> % reduction in variance compared to the
onephase procedure&quot;.
</p>
<p>The <em>relative efficiency</em> can be interpreted as: &quot;Using the onephase estimation procedure, the terrestrial sample size would have to be <code>rel.eff</code> times larger in order to achieve the same precision (in terms of variance) as the mutiphase estimation procedure&quot;.
</p>


<hr>
<h2 id='onephase'>onephase</h2><span id='topic+onephase'></span>

<h3>Description</h3>

<p><code>onephase</code> is used to calculate estimations exclusively based on
terrestrial observations of a forest inventory (i.e. the <em>local densities</em>).
The estimation method is available for simple and cluster-sampling
and provides point estimates of the sample mean and their variances.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>onephase(
  formula,
  data,
  phase_id = list(phase.col = NA, terrgrid.id = NA),
  cluster = NA,
  area = list(sa.col = NA, areas = NA)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="onephase_+3A_formula">formula</code></td>
<td>
<p>an object of class &quot;<code><a href="stats.html#topic+formula">formula</a></code>&quot; that
must be of the form <code>Y ~ 1</code>, where Y is the terrestrial response
value of interest provided in <code>data</code>.</p>
</td></tr>
<tr><td><code id="onephase_+3A_data">data</code></td>
<td>
<p>a data frame or vector containing the response value Y.
Specifications are given under 'Details'.</p>
</td></tr>
<tr><td><code id="onephase_+3A_phase_id">phase_id</code></td>
<td>
<p>an object of class &quot;<code><a href="base.html#topic+list">list</a></code>&quot; containing two elements:
</p>

<ul>
<li> <p><code>phase.col</code>: the column name in <code>data</code> that specifies the
phase membership of each observation
</p>
</li>
<li> <p><code>terrgrid.id</code>: the indicator identifying the the terrestrial
(a.k.a. &quot;ground truth&quot;) phase for that column
(must be of type &quot;<code><a href="base.html#topic+numeric">numeric</a></code>&quot;)
</p>
</li></ul>

<p><strong>Note:</strong> Only has to be specified if <code>data</code> is of class <code>data.frame</code>.</p>
</td></tr>
<tr><td><code id="onephase_+3A_cluster">cluster</code></td>
<td>
<p>Specifies the column name in <code>data</code>
containing the cluster identification. Only used in case of
cluster sampling.</p>
</td></tr>
<tr><td><code id="onephase_+3A_area">area</code></td>
<td>
<p>(<em>Optional</em>) an object of class &quot;<code><a href="base.html#topic+list">list</a></code>&quot; containing two elements:
</p>

<ul>
<li> <p><code>sa.col</code>: the column name in <code>data</code> containing
domain identification
</p>
</li>
<li> <p><code>areas</code>: vector of desired domains for which the estimation
should be computed. If estimations for multiple domains should be computed,
the domains have to be defined within a <code>character</code> vector using <code>c()</code>
</p>
</li></ul>

<p>Further details of the parameter-specifications are given under <em>'Details'</em>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>data</code> can either be a vector only containing the observations of the
response variable Y,
<em>or</em> a data frame containing a column for the response variable and
a column for the sample-grid indication that has to be further specified
by argument <code>phase_id</code>.
Additional <em>optional</em> columns include a cluster identification in case of
cluster sampling, as well as a column that specifies a domain (e.g. a forest district)
the respective terrestrial observation falls into.
The latter allows to compute onephase-estimations
for multiple domains at a time (see <em>'Examples'</em>).
</p>


<h3>Value</h3>

<p><code>onephase</code> returns an object of class <code>"onephase"</code>.
</p>
<p>The functions <code>summary</code> and <code>confint</code> can be used to obtain a summary of the
estimation results (point estimations, variances and sample sizes) and the confidence intervals
for the respective point estimates.
</p>
<p>An object of class <code>"onephase"</code> returns a <code>list</code> of the following components:
</p>
<table>
<tr><td><code>input</code></td>
<td>
<p>a <code>list</code> containing the function inputs</p>
</td></tr>
<tr><td><code>estimation</code></td>
<td>
<p>a data frame containing the following components:
</p>

<ul>
<li> <p><code>area:</code> the domain (only present if argument <code>area</code> has been used)
</p>
</li>
<li> <p><code>estimate:</code> the point estimate
</p>
</li>
<li> <p><code>variance:</code> the variance of the point estimate
</p>
</li>
<li> <p><code>n2:</code> the terrestrial sample size
</p>
</li></ul>
</td></tr>
<tr><td><code>samplesizes</code></td>
<td>
<p>a named numeric vector giving the terrestrial samplesize</p>
</td></tr>
</table>


<h3>References</h3>

<p>Hill, A., Massey, A. F. (2021). <em>The R Package forestinventory: Design-Based Global and Small Area Estimations for Multiphase Forest Inventories.</em> Journal of Statistical Software, 97(4), 1-40.
</p>
<p>Mandallaz, D. (2007). <em>Sampling techniques for forest inventories.</em> Chapter 4. CRC Press.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># ----------- non-cluster sampling------------------#

## load grisons dataset:
data(grisons)

## 1) calculate onephase-estimation for entire dataset:
op &lt;- onephase(formula = tvol~1 ,data = grisons,
              phase_id =list(phase.col = "phase_id_2p",terrgrid.id = 2))
summary(op)
confint(op)

## 2) calculate onephase-estimation for given domains (areas) in dataset:
op.a &lt;- onephase(formula = tvol~1,
                 data = grisons,
                 phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                 area = list(sa.col = "smallarea", areas = c("A", "B")))
summary(op.a)
confint(op.a)

# ----------- cluster sampling ------------------#

## load zurichberg dataset:
data(zberg)

## 1) calculate onephase-estimation for entire dataset:
op.clust &lt;- onephase(formula = basal~1, data = zberg,
                     phase_id = list(phase.col = "phase_id_2p",terrgrid.id = 2),
                     cluster = "cluster")
summary(op.clust)
confint(op.clust)

## 2) calculate onephase-estimation for given areas in dataset:
op.clust.a &lt;- onephase(formula = basal~1,
                       data = zberg,
                       phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                       cluster = "cluster",
                       area = list(sa.col = "ismallg23", areas = c("2", "3")))
summary(op.clust.a)
confint(op.clust.a)
</code></pre>

<hr>
<h2 id='plot.esttable'>Plotting Estimation Results</h2><span id='topic+plot.esttable'></span>

<h3>Description</h3>

<p>Function plots the estimation results of an object created by the <code><a href="#topic+estTable">estTable</a></code> function.
Provides the possibility to visualize and compare the point estimates and their estimation errors
differentiated by the applied estimation method and estimator.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'esttable'
plot(x, yvar = "error", ncol = 5, yscale.free = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.esttable_+3A_x">x</code></td>
<td>
<p>object of class <code>"list" "esttable"</code> created by the <code><a href="#topic+estTable">estTable</a></code> function.</p>
</td></tr>
<tr><td><code id="plot.esttable_+3A_yvar">yvar</code></td>
<td>
<p>if set to <code>"error"</code> (default), the estimation error is plotted on the y-axis. If set to <code>"estimate"</code>,
point estimates with their confidence intervals are plotted.</p>
</td></tr>
<tr><td><code id="plot.esttable_+3A_ncol">ncol</code></td>
<td>
<p>number of columns to plot small area estimations.</p>
</td></tr>
<tr><td><code id="plot.esttable_+3A_yscale.free">yscale.free</code></td>
<td>
<p><code>logical</code>: should y-axis scales be free (default) or fixed.</p>
</td></tr>
<tr><td><code id="plot.esttable_+3A_...">...</code></td>
<td>
<p>ignored.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
## run onephase estimation:
op.a &lt;- onephase(formula = tvol~1,
                 data = grisons,
                 phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                 area = list(sa.col = "smallarea", areas = c("A", "B", "C", "D")))

## run small area twophase estimation:
sae.2p.est &lt;- twophase(formula = tvol ~ mean + stddev + max + q75,
                       data = grisons,
                       phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                       small_area = list(sa.col = "smallarea", areas = c("A", "B","C", "D"),
                                         unbiased = TRUE))

## run small area threephase estimation:
sae.3p.est &lt;- threephase(formula.s0 =  tvol ~ mean,
                         formula.s1 = tvol ~ mean + stddev + max + q75,
                         data = grisons,
                         phase_id = list(phase.col = "phase_id_3p", s1.id = 1, terrgrid.id = 2),
                         small_area=list(sa.col = "smallarea", areas = c("A", "B", "C", "D"),
                                         unbiased = TRUE))

## create estimation table:
sae.table&lt;- estTable(est.list = list(op.a, sae.2p.est, sae.3p.est), add.ci=TRUE,
                     sae = TRUE, vartypes = c("variance", "g_variance",  "ext_variance"))

## plot estimation errors:
plot(sae.table)

## plot point estimates and confidence intervals:
#  Hint: --&gt; use ggplot2 functions to modify graphic:
library(ggplot2)
plot(sae.table, yvar = "estimate") +
   ylab("Timber Volume [m3/ha]")
</code></pre>

<hr>
<h2 id='summary'>Summarizing Global and Small-Area Estimation Results</h2><span id='topic+summary'></span><span id='topic+summary.onephase'></span><span id='topic+summary.twophase'></span><span id='topic+summary.threephase'></span>

<h3>Description</h3>

<p>Summarizing Global and Small-Area Estimation Results
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'onephase'
summary(object, coefs = FALSE, ...)

## S3 method for class 'twophase'
summary(object, coefs = FALSE, ...)

## S3 method for class 'threephase'
summary(object, coefs = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary_+3A_object">object</code></td>
<td>
<p>object of class <code>onephase</code>, <code>twophase</code> or <code>threephase</code>,
containing estimation results of the respective estimation method.</p>
</td></tr>
<tr><td><code id="summary_+3A_coefs">coefs</code></td>
<td>
<p>of type &quot;<code><a href="base.html#topic+logical">logical</a></code>&quot;. If set to <code>TRUE</code>, also
gives the regression coefficients of <code><a href="#topic+twophase">twophase</a></code> and
<code><a href="#topic+threephase">threephase</a></code> estimations. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="summary_+3A_...">...</code></td>
<td>
<p>additional arguments, so far ignored.</p>
</td></tr>
</table>

<hr>
<h2 id='threephase'>threephase</h2><span id='topic+threephase'></span>

<h3>Description</h3>

<p><code>threephase</code> is used to calculate estimations based on triple sampling under the
<em>model-assisted Monte Carlo approach</em>. A <em>zero phase</em> of auxiliary information
(e.g. taken from remote sensing data) is used to generate model predictions based on multiple linear
regression using the method of ordinary least squares. A subsample of the zero phase comprises
further auxiliary information that produces another set of model predictions.
A further subsample produces a <em>second phase</em> based on terrestrial observations
(i.e. the <em>local densities</em> of the ground truth) and is used to correct for bias in the design-based sense.
The estimation method is available for <em>simple</em> and <em>cluster sampling</em> and includes
the special case where the first phase is based on an <em>exhaustive</em> sample (i.e. a census).
<em>Small-area applications</em> are supported for synthetic estimation as well as two varieties
of bias-corrected estimators: the traditional small-area estimator and an asymptotically
equivalent version derived under Mandallaz' extended model approach.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>threephase(
  formula.s0,
  formula.s1,
  data,
  phase_id,
  cluster = NA,
  small_area = list(sa.col = NA, areas = NA, unbiased = TRUE),
  boundary_weights = NA,
  exhaustive = NA,
  progressbar = FALSE,
  psmall = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="threephase_+3A_formula.s0">formula.s0</code></td>
<td>
<p>an object of class &quot;<code><a href="stats.html#topic+formula">formula</a></code>&quot; as would be used in the function <code><a href="stats.html#topic+lm">lm</a></code>
that contains a reduced set of auxiliary variables available for all zero phase plots</p>
</td></tr>
<tr><td><code id="threephase_+3A_formula.s1">formula.s1</code></td>
<td>
<p>an object of class &quot;<code><a href="stats.html#topic+formula">formula</a></code>&quot; as would be used in the function <code><a href="stats.html#topic+lm">lm</a></code>
that contains the predictors from <code>formula.s0</code> as well as further ancilliary predictors available
for all first phase plots (i.e. <code>formula.s0</code> is <strong>nested</strong> in <code>formula.s1</code>)</p>
</td></tr>
<tr><td><code id="threephase_+3A_data">data</code></td>
<td>
<p>a data frame containing all variables contained in <code>formula</code> and a column indexing
phase membership.  Additional columns designating small-area membership, cluster ID and
boundary weights should also be contained in the data frame if they are
requested in the function.</p>
</td></tr>
<tr><td><code id="threephase_+3A_phase_id">phase_id</code></td>
<td>
<p>an object of class &quot;<code><a href="base.html#topic+list">list</a></code>&quot; containing three elements:
</p>

<ul>
<li> <p><code>phase.col</code>: the column name in <code>data</code> that specifies the
phase membership of each observation
</p>
</li>
<li> <p><code>s1.id</code>: the indicator identifying the &quot;second phase only&quot; plots
for that column  (must be of type &quot;<code><a href="base.html#topic+numeric">numeric</a></code>&quot;)
</p>
</li>
<li> <p><code>terrgrid.id</code>: the indicator identifying the terrestrial
(a.k.a. &quot;ground truth&quot;) phase for that column
(must be of type &quot;<code><a href="base.html#topic+numeric">numeric</a></code>&quot;)
</p>
</li></ul>
</td></tr>
<tr><td><code id="threephase_+3A_cluster">cluster</code></td>
<td>
<p>(<em>Optional</em>) Specifies the column name in <code>data</code>
containing the cluster ID. Only used in case of
cluster sampling.</p>
</td></tr>
<tr><td><code id="threephase_+3A_small_area">small_area</code></td>
<td>
<p>(<em>Optional</em>) a list that if containing three elements:
</p>

<ul>
<li> <p><code>sa.col</code>: the column name in <code>data</code> containing
domain identification
</p>
</li>
<li> <p><code>areas</code>: vector of desired small-area domain identifiers
</p>
</li>
<li> <p><code>unbiased</code>: an object of type &quot;<code><a href="base.html#topic+logical">logical</a></code>&quot;
that when FALSE designates that the estimator is allowed to be
biased (i.e. the synthetic estimator) and when TRUE forces
it to be design-unbiased. See <em>'Details'</em>.
</p>
</li></ul>

<p><strong>Note</strong>: If <code>small_area</code> is left unchanged then <code>twophase</code> defaults to global estimation.</p>
</td></tr>
<tr><td><code id="threephase_+3A_boundary_weights">boundary_weights</code></td>
<td>
<p>(<em>Optional</em>) Specifies the column name in <code>data</code>
containing the weights for boundary adjustment.  See <em>'Details'</em></p>
</td></tr>
<tr><td><code id="threephase_+3A_exhaustive">exhaustive</code></td>
<td>
<p>(<em>Optional</em>) For global estimation, a vector of true auxiliary means corresponding to
an exhaustive first phase.
The vector must be input in the same order that <code>lm</code> processes a <code>formula</code> object
and include the intercept term.
For small area estimation, <code>exhaustive</code> is a <code>data.frame</code> containing column names
(<code><a href="base.html#topic+colnames">colnames</a></code>) for every variable appearing in the parameter <code>formula</code> including
the variable &quot;Intercept&quot;.Rownames (<code><a href="base.html#topic+row.names">row.names</a></code>) have to be used and must correspond
to the names of the small areas. See <em>'Details'</em>.</p>
</td></tr>
<tr><td><code id="threephase_+3A_progressbar">progressbar</code></td>
<td>
<p>(<em>Optional</em>) an object a type &quot;<code><a href="base.html#topic+logical">logical</a></code>&quot; that when TRUE prints
the progress of the calculation in the console (recommended for large amount of small areas).  Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="threephase_+3A_psmall">psmall</code></td>
<td>
<p>(<em>Optional</em>) an object a type &quot;<code><a href="base.html#topic+logical">logical</a></code>&quot; used for small area estimations
that only works when <code>unbiased</code> in the parameter <code>small_area</code> is set to TRUE. See <em>'Details'</em>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>s1.id</code> identifies &quot;second phase only&quot; plots because the terrestrial phase is
known to be part of the second phase by the construction of the subsampling.
</p>
<p>If estimations for multiple small-area domains should be computed, the domains have to be
defined within a <code>character</code> vector using <code>c()</code>. Using <code>small_area(..., unbiased=FALSE)</code>
calculates design-based estimates with the synthetic estimator and may be design-biased if
the model is biased in that small area.  The default, <code>small_area(..., unbiased=TRUE)</code>, allows for a residual
correction by one of two asymptotically equivalent methods to create design-unbiased estimates:
</p>

<ul>
<li><p> Mandallaz' extended model approach calculates the residual correction by extending the
model formula with an indicator variable in the small area.  It is the default method
<code>psmall</code>=FALSE.
</p>
</li>
<li><p> the traditional small area estimator calculates the residual correction by taking the
synthetic estimator and adding the mean residual observed in the small area.  It is activated
when <code>psmall</code>=TRUE.
</p>
</li></ul>

<p>Missing values (<code>NA</code>) in the auxiliary variables (i.e. at least one auxiliary variable cannot be observed at
an inventory location) are automatically removed from the dataset <em>before</em> the estimations are computed.
Note that missingness in the auxiliary variables is only allowed if we assume that they are <em>missing at random</em>,
since the unbiasedness of the estimates is based on the sampling design.
</p>
<p>The boundary weight adjustment is pertinent for auxiliary information derived from remote sensing and
is equal to the percentage of forested area (e.g. as defined by a forest mask) in the interpretation area.
</p>
<p>Exhaustive estimation refers to when the true means of certain auxiliary variables are known
at an exhaustive zero phase (i.e. a census).  For global estimation, the vector must be input
in the same order that <code>lm</code> processes a <code>formula</code> object including the intercept term whose
true mean will always be one.  For small area estimation, <code>exhaustive</code> is a <code>data.frame</code> containing column names for every variable appearing in
the parameter <code>formula</code> including the variable &quot;Intercept&quot;.  The observations of the data.frame
must represent the true auxiliary means in the same order as was presented in <code>areas</code> from the
parameter <code>small_area</code>.  See <em>'Examples'</em>.
</p>


<h3>Value</h3>

<p><code>threephase</code> returns an object of class <code>"threephase"</code>.
</p>
<p>An object of class <code>"threephase"</code> returns a <code>list</code> of the following components:
</p>
<table>
<tr><td><code>input</code></td>
<td>
<p>a <code>list</code> containing the function's inputs</p>
</td></tr>
<tr><td><code>estimation</code></td>
<td>
<p>a data frame containing the following components:
</p>

<ul>
<li> <p><code>area:</code> the domain (only present if argument <code>areas</code> has been used)
</p>
</li>
<li> <p><code>estimate:</code> the point estimate
</p>
</li>
<li> <p><code>ext_variance:</code> the external variance of the point estimate that doesn't account for
fitting the model from the current inventory
</p>
</li>
<li> <p><code>g_variance:</code> the internal (g-weight) variance that accounts for
fitting the model from the current inventory
</p>
</li>
<li> <p><code>n0</code> the zero phase sample size of plots
</p>
</li>
<li> <p><code>n1</code> the first phase sample size of plots
</p>
</li>
<li> <p><code>n2</code> the second phase (i.e. terrestrial) sample size of plots
</p>
</li>
<li> <p><code>n0G</code> the zero phase sample size in the small area
</p>
</li>
<li> <p><code>n1G</code> the first phase sample size in the small area
</p>
</li>
<li> <p><code>n2G</code> the second phase (i.e. terrestrial) sample size in the small area
</p>
</li>
<li> <p><code>r.squared_reduced</code> the R-squared of the linear model based on <code>formula.s0</code> (i.e. the reduced model)
</p>
</li>
<li> <p><code>r.squared_full</code> the R-squared of the linear model based on <code>formula.s1</code> (i.e. the full model)
</p>
</li></ul>
</td></tr>
<tr><td><code>samplesizes</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame</a></code> summarizing all samplesizes: in case of cluster sampling both,
the number of individual plots and the number of clusters is reported.</p>
</td></tr>
<tr><td><code>coefficients</code></td>
<td>
<p>the coefficients of the two linear models:
</p>

<ul>
<li> <p><code>alpha:</code> the reduced model coefficients
</p>
</li>
<li> <p><code>beta:</code> the full model coefficients
</p>
</li></ul>
</td></tr>
<tr><td><code>cov_alpha_s2</code></td>
<td>
<p>the design-based covariance matrix of the reduced model coefficients</p>
</td></tr>
<tr><td><code>cov_beta_s2</code></td>
<td>
<p>the design-based covariance matrix of the full model coefficients</p>
</td></tr>
<tr><td><code>Z_bar_1_s0</code></td>
<td>
<p>the estimated auxiliary means of <code>formula.s0</code> based on the zero phase.
If the zero phase is exhaustive, these are the true auxiliary means specified in the input-argument <code>exhaustive</code>.</p>
</td></tr>
<tr><td><code>Z1_bar_s1</code></td>
<td>
<p>the estimated auxiliary means of <code>formula.s0</code> based on the first phase</p>
</td></tr>
<tr><td><code>Z_bar_s1</code></td>
<td>
<p>the estimated auxiliary means of <code>formula.s1</code> based on the first phase</p>
</td></tr>
<tr><td><code>cov_Z_bar_1_s0</code></td>
<td>
<p>the covariance matrix for <code>Z_bar_1_s0</code></p>
</td></tr>
<tr><td><code>resid_reduced</code></td>
<td>
<p>the reduced model residuals at either the plot level or cluster level depending on the call</p>
</td></tr>
<tr><td><code>resid_full</code></td>
<td>
<p>the full model residuals at either the plot level or cluster level depending on the call</p>
</td></tr>
<tr><td><code>warn.messages</code></td>
<td>
<p>logical indicating if warning messages were issued</p>
</td></tr>
</table>


<h3>Note</h3>

<p>In the special case of cluster sampling, the reported sample sizes in <code>estimation</code> are the number of clusters.
The <code>samplesize</code>-object also provides the respective number of single plot units for cluster sampling.
The reported <code>r.squared_reduced</code> and <code>r.squared_full</code> describe the model fit of the applied linear regression
models (i.e. on <em>plot-level</em>, not on <em>cluster level</em>).
</p>


<h3>References</h3>

<p>Hill, A., Massey, A. F. (2021). <em>The R Package forestinventory: Design-Based Global and Small Area Estimations for Multiphase Forest Inventories.</em> Journal of Statistical Software, 97(4), 1-40.
</p>
<p>Mandallaz, D., Breschan, J., &amp; Hill, A. (2013). <em>New regression estimators in forest inventories
with two-phase sampling and partially exhaustive information: a design-based monte carlo approach
with applications to small-area estimation.</em> Canadian Journal of Forest Research, 43(11), 1023-1031.
</p>
<p>Mandallaz, D. (2014). <em>A three-phase sampling extension of the generalized regression estimator with partially exhaustive information.</em> Can. J. For. Res. 44: 383-388
</p>
<p>Massey, A. and Mandallaz, D. and Lanz, A. (2014). <em>Integrating remote sensing and past inventory data under the new annual design of the Swiss National Forest Inventory using three-phase design-based regression estimation.</em> Can. J. For. Res. 44(10): 1177-1186
</p>
<p>Mandallaz, D. (2013). <em>Regression estimators in forest inventories with three-phase sampling and two multivariate components of auxiliary information.</em> ETH Zurich, Department of Environmental Systems Science,Tech. rep. Available from doi: <a href="https://doi.org/10.3929/ethz-a-009990020">10.3929/ethz-a-009990020</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## load datasets:
data(grisons)
data(zberg)


## define regression models for simple and cluster sampling:
formula.s0 &lt;- tvol ~ mean # reduced model:
formula.s1 &lt;- tvol ~ mean + stddev + max + q75 # full model
formula.clust.s0 &lt;- basal ~ stade
formula.clust.s1 &lt;- basal ~ stade + couver + melange


# ------------------------------------------------#
# ----------- GLOBAL ESTIMATION ------------------#

#----
## 1) -- Design-based estimation with non-exhaustive auxiliary information
#----

# 1.1) non-cluster-sampling (see eqns. [11], [14] and [16] in Mandallaz 2014):
summary(threephase(formula.s0, formula.s1, data = grisons,
                   phase_id = list(phase.col = "phase_id_3p", s1.id=1, terrgrid.id = 2)))


# 1.2) cluster-sampling (see eqns. [49] and [50] in Mandallaz 2013):
summary(threephase(formula.clust.s0, formula.clust.s1, data = zberg,
                   phase_id = list(phase.col="phase_id_3p", s1.id = 1, terrgrid.id = 2),
                   cluster = "cluster"))


# 1.3) example for boundary weight adjustment (non-cluster example):
summary(threephase(formula.s0, formula.s1, data = grisons,
                   phase_id = list(phase.col="phase_id_3p", s1.id = 1, terrgrid.id = 2),
                   boundary_weights = "boundary_weights"))

#----
## 2) -- Design-based estimation with exhaustive auxiliary information
#----

# 2.1) non-cluster-sampling (see eqns. [7], [9] and [10] in Mandallaz 2014):
summary(threephase(formula.s0, formula.s1, data = grisons,
                   phase_id = list(phase.col = "phase_id_3p", s1.id = 1, terrgrid.id = 2),
                   exhaustive = c(1,11.39)))


# 2.2) cluster-sampling:
summary(threephase(formula.clust.s0, formula.clust.s1, data = zberg,
                   phase_id = list(phase.col = "phase_id_3p", s1.id = 1, terrgrid.id = 2),
                   cluster = "cluster", exhaustive = c(1, 0.10, 0.7, 0.10)))


# ----------------------------------------------------#
# ----------- SMALL AREA ESTIMATION ------------------#

#----
## 1) --  Design-based estimation with non-exhaustive auxiliary information
#----

# 1.1) Mandallaz's extended pseudo small area estimator:
summary(threephase(formula.s0,
                   formula.s1,
                   data = grisons,
                   phase_id = list(phase.col = "phase_id_3p", s1.id = 1, terrgrid.id = 2),
                   small_area=list(sa.col = "smallarea", areas = c("A", "B", "C", "D"),
                                   unbiased = TRUE)))

summary(threephase(formula.clust.s0,
                   formula.clust.s1,
                   data = zberg,
                   phase_id = list(phase.col = "phase_id_3p", s1.id = 1, terrgrid.id = 2),
                   cluster = "cluster",
                   small_area = list(sa.col = "ismallold", areas = c("1"), unbiased = TRUE)))


# 1.2) pseudo small area estimator:
summary(threephase(formula.s0,
                   formula.s1,
                   data = grisons,
                   phase_id = list(phase.col = "phase_id_3p", s1.id = 1, terrgrid.id = 2),
                   small_area = list(sa.col = "smallarea", areas = c("A", "B", "C", "D"),
                                   unbiased = TRUE),
                   psmall = TRUE))

summary(threephase(formula.clust.s0,
                   formula.clust.s1,
                   data=zberg,
                   phase_id=list(phase.col="phase_id_3p", s1.id=1, terrgrid.id=2),
                   cluster="cluster",
                   small_area=list(sa.col="ismallold", areas=c("1"), unbiased=TRUE),
                   psmall = TRUE))


# 1.3) pseudosynthetic small area estimator:
summary(threephase(formula.s0  = tvol ~ mean,
                   formula.s1 = tvol ~ mean + stddev + max + q75,
                   data = grisons,
                   phase_id = list(phase.col = "phase_id_3p", s1.id = 1, terrgrid.id = 2),
                   small_area = list(sa.col = "smallarea", areas = c("A", "B", "C", "D"),
                                   unbiased = FALSE)))

summary(threephase(formula.clust.s0,
                   formula.clust.s1,
                   data = zberg,
                   phase_id = list(phase.col = "phase_id_3p", s1.id = 1, terrgrid.id = 2),
                   cluster = "cluster",
                   small_area = list(sa.col = "ismallold", areas = c("1"), unbiased = FALSE)))


#----
## 2) --  Design-based estimation with exhaustive auxiliary information
#----

# true auxiliary mean for variable "mean" taken from Mandallaz et al. (2013):
truemeans.G &lt;- data.frame(Intercept = rep(1, 4),
                         mean = c(12.85, 12.21, 9.33, 10.45))
rownames(truemeans.G) &lt;- c("A", "B", "C", "D")

# true auxiliary means taken from Mandallaz (1991):
truemeans.G.clust &lt;- data.frame(Intercept = 1, stade400 = 0.175, stade500 = 0.429,
                               stade600 = 0.321)
rownames(truemeans.G.clust) &lt;- c("1")


# 2.1) Mandallaz's extended small area estimator:
summary(threephase(formula.s0,
                   formula.s1,
                   data = grisons,
                   phase_id = list(phase.col = "phase_id_3p", s1.id = 1, terrgrid.id = 2),
                   small_area = list(sa.col = "smallarea", areas = c("A", "B", "C", "D"),
                                unbiased = TRUE),
                   exhaustive = truemeans.G))

summary(threephase(formula.clust.s0,
                   formula.clust.s1,
                   data = zberg,
                   phase_id = list(phase.col = "phase_id_3p", s1.id = 1, terrgrid.id = 2),
                   cluster = "cluster",
                   small_area = list(sa.col = "ismallold", areas = c("1"), unbiased = TRUE),
                   exhaustive = truemeans.G.clust))


# 2.2) small area estimator:
summary(threephase(formula.s0,
                   formula.s1,
                   data = grisons,
                   phase_id = list(phase.col = "phase_id_3p", s1.id = 1, terrgrid.id = 2),
                   small_area = list(sa.col = "smallarea", areas = c("A", "B", "C", "D"),
                                   unbiased = TRUE),
                   exhaustive = truemeans.G,
                   psmall = TRUE))

summary(threephase(formula.clust.s0,
                   formula.clust.s1,
                   data = zberg,
                   phase_id = list(phase.col = "phase_id_3p", s1.id = 1, terrgrid.id = 2),
                   cluster = "cluster",
                   small_area = list(sa.col = "ismallold", areas = c("1"), unbiased = TRUE),
                   exhaustive = truemeans.G.clust,
                   psmall = TRUE))


# 2.3) synthetic small area estimator:
summary(threephase(formula.s0,
                   formula.s1,
                   data = grisons,
                   phase_id = list(phase.col="phase_id_3p", s1.id = 1, terrgrid.id = 2),
                   small_area = list(sa.col = "smallarea", areas = c("A", "B", "C", "D"),
                                   unbiased = FALSE),
                   exhaustive = truemeans.G))

summary(threephase(formula.clust.s0,
                   formula.clust.s1,
                   data = zberg,
                   phase_id = list(phase.col = "phase_id_3p", s1.id = 1, terrgrid.id = 2),
                   cluster = "cluster",
                   small_area = list(sa.col = "ismallold", areas = c("1"), unbiased = FALSE),
                   exhaustive = truemeans.G.clust))

</code></pre>

<hr>
<h2 id='twophase'>twophase</h2><span id='topic+twophase'></span>

<h3>Description</h3>

<p><code>twophase</code> is used to calculate estimations based on double sampling under the
<em>model-assisted Monte Carlo approach</em>. A <em>first phase</em> of auxiliary information
(e.g. taken from remote sensing data) is used to generate model predictions based on multiple linear
regression  using the method of ordinary least squares. A subsample of the first phase comprises
the <em>second phase</em> which contains terrestrial observations (i.e. the <em>local densities</em>
of the ground truth) that is used to correct for bias in the design-based sense.
The estimation method is available for <em>simple</em> and <em>cluster sampling</em> and includes
the special case where the first phase is based on an <em>exhaustive</em> sample (i.e. a census).
<em>Small-area applications</em> are supported for synthetic estimation as well as two varieties
of bias-corrected estimators: the traditional small-area estimator and an asymptotically
equivalent version derived under Mandallaz' extended model approach.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>twophase(
  formula,
  data,
  phase_id,
  cluster = NA,
  small_area = list(sa.col = NA, areas = NA, unbiased = TRUE),
  boundary_weights = NA,
  exhaustive = NA,
  progressbar = FALSE,
  psmall = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="twophase_+3A_formula">formula</code></td>
<td>
<p>an object of class &quot;<code><a href="stats.html#topic+formula">formula</a></code>&quot; as would be used in the function <code><a href="stats.html#topic+lm">lm</a></code></p>
</td></tr>
<tr><td><code id="twophase_+3A_data">data</code></td>
<td>
<p>a data frame containing all variables contained in <code>formula</code> and a column indexing
phase membership.  Additional columns designating small-area membership, cluster ID and
boundary weights should also be contained in the data frame if they are
requested in the function.</p>
</td></tr>
<tr><td><code id="twophase_+3A_phase_id">phase_id</code></td>
<td>
<p>an object of class &quot;<code><a href="base.html#topic+list">list</a></code>&quot; containing two elements:
</p>

<ul>
<li> <p><code>phase.col</code>: the column name in <code>data</code> that specifies the
phase membership of each observation
</p>
</li>
<li> <p><code>terrgrid.id</code>: the indicator identifying the terrestrial
(a.k.a. &quot;ground truth&quot;) phase for that column
(must be of type &quot;<code><a href="base.html#topic+numeric">numeric</a></code>&quot;)
</p>
</li></ul>
</td></tr>
<tr><td><code id="twophase_+3A_cluster">cluster</code></td>
<td>
<p>(<em>Optional</em>) Specifies the column name in <code>data</code>
containing the cluster ID. Only used in case of
cluster sampling.</p>
</td></tr>
<tr><td><code id="twophase_+3A_small_area">small_area</code></td>
<td>
<p>(<em>Optional</em>) a list that if containing three elements:
</p>

<ul>
<li> <p><code>sa.col</code>: the column name in <code>data</code> containing
domain identification
</p>
</li>
<li> <p><code>areas</code>: vector of desired small-area domain identifiers
</p>
</li>
<li> <p><code>unbiased</code>: an object of type &quot;<code><a href="base.html#topic+logical">logical</a></code>&quot;
that when FALSE designates that the estimator is allowed to be
biased (i.e. the synthetic estimator) and when TRUE forces
it to be design-unbiased. See <em>'Details'</em>.
</p>
</li></ul>

<p><strong>Note</strong>: If <code>small_area</code> is left unchanged then <code>twophase</code> defaults to global estimation.</p>
</td></tr>
<tr><td><code id="twophase_+3A_boundary_weights">boundary_weights</code></td>
<td>
<p>(<em>Optional</em>) Specifies the column name in <code>data</code>
containing the weights for boundary adjustment.  See <em>'Details'</em></p>
</td></tr>
<tr><td><code id="twophase_+3A_exhaustive">exhaustive</code></td>
<td>
<p>(<em>Optional</em>) For global estimation, a vector of true auxiliary means corresponding to
an exhaustive first phase.
The vector must be input in the same order that <code>lm</code> processes a <code>formula</code> object
and include the intercept term.
For small area estimation, <code>exhaustive</code> is a <code>data.frame</code> containing column names
(<code><a href="base.html#topic+colnames">colnames</a></code>) for every variable appearing in the parameter <code>formula</code> including
the variable &quot;Intercept&quot;.Rownames (<code><a href="base.html#topic+row.names">row.names</a></code>) have to be used and must correspond
to the names of the small areas. See <em>'Details'</em>.</p>
</td></tr>
<tr><td><code id="twophase_+3A_progressbar">progressbar</code></td>
<td>
<p>(<em>Optional</em>) an object a type &quot;<code><a href="base.html#topic+logical">logical</a></code>&quot; that when TRUE prints
the progress of the calculation in the console (recommended for large amount of small areas).  Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="twophase_+3A_psmall">psmall</code></td>
<td>
<p>(<em>Optional</em>) an object a type &quot;<code><a href="base.html#topic+logical">logical</a></code>&quot; used for small area estimations
that only works when <code>unbiased</code> in the parameter <code>small_area</code> is set to TRUE. See <em>'Details'</em>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If estimations for multiple small-area domains should be computed, the domains have to be
defined within a <code>character</code> vector using <code>c()</code>. Using <code>small_area(..., unbiased=FALSE)</code>
calculates design-based estimates with the synthetic estimator and may be design-biased if
the model is biased in that small area.  The default, <code>small_area(..., unbiased=TRUE)</code>, allows for a residual
correction by one of two asymptotically equivalent methods to create design-unbiased estimates:
</p>

<ul>
<li><p> Mandallaz' extended model approach calculates the residual correction by extending the
model formula with an indicator variable in the small area.  It is the default method
<code>psmall</code>=FALSE.
</p>
</li>
<li><p> the traditional small area estimator calculates the residual correction by taking the
synthetic estimator and adding the mean residual observed in the small area.  It is activated
when <code>psmall</code>=TRUE.
</p>
</li></ul>

<p>Missing values (<code>NA</code>) in the auxiliary variables (i.e. at least one auxiliary variable cannot be observed at
an inventory location) are automatically removed from the dataset <em>before</em> the estimations are computed.
Note that missingness in the auxiliary variables is only allowed if we assume that they are <em>missing at random</em>,
since the unbiasedness of the estimates is based on the sampling design.
</p>
<p>The boundary weight adjustment is pertinent for auxiliary information derived from remote sensing and
is equal to the percentage of forested area (e.g. as defined by a forest mask) in the interpretation area.
</p>
<p>Exhaustive estimation refers to when the true means of certain auxiliary variables are known
and an exhaustive first phase (i.e. a census).  For global estimation, the vector must be input
in the same order that <code>lm</code> processes a <code>formula</code> object including the intercept term whose
true mean will always be one.  For small area estimation, <code>exhaustive</code> is a <code>data.frame</code> containing column names for every variable appearing in
the parameter <code>formula</code> including the variable &quot;Intercept&quot;.  The observations of the data.frame
must represent the true auxiliary means in the same order as was presented in <code>areas</code> from the
parameter <code>small_area</code>.  See <em>'Examples'</em>.
</p>


<h3>Value</h3>

<p><code>twophase</code> returns an object of class <code>"twophase"</code>.
</p>
<p>An object of class <code>"twophase"</code> returns a <code>list</code> of the following components:
</p>
<table>
<tr><td><code>input</code></td>
<td>
<p>a <code>list</code> containing the function's inputs</p>
</td></tr>
<tr><td><code>estimation</code></td>
<td>
<p>a data frame containing the following components:
</p>

<ul>
<li> <p><code>area:</code> the domain (only present if argument <code>areas</code> has been used)
</p>
</li>
<li> <p><code>estimate:</code> the point estimate
</p>
</li>
<li> <p><code>ext_variance:</code> the external variance of the point estimate that doesn't account for
fitting the model from the current inventory
</p>
</li>
<li> <p><code>g_variance:</code> the internal (g-weight) variance that accounts for
fitting the model from the current inventory
</p>
</li>
<li> <p><code>n1</code> the first phase sample size of plots
</p>
</li>
<li> <p><code>n2</code> the second phase (i.e. terrestrial) sample size of plots
</p>
</li>
<li> <p><code>n1G</code> the first phase sample size in the small area
</p>
</li>
<li> <p><code>n2G</code> the second phase (i.e. terrestrial) sample size in the small area
</p>
</li>
<li> <p><code>r.squared</code> the R squared of the linear model
</p>
</li></ul>
</td></tr>
<tr><td><code>samplesizes</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame</a></code> summarizing all samplesizes: in case of cluster sampling both,
the number of individual plots and the number of clusters is reported.</p>
</td></tr>
<tr><td><code>coefficients</code></td>
<td>
<p>the linear model coefficients</p>
</td></tr>
<tr><td><code>cov_coef</code></td>
<td>
<p>the design-based covariance matrix of the model coefficients</p>
</td></tr>
<tr><td><code>Z_bar_1G</code></td>
<td>
<p>the estimated auxiliary means of <code>formula</code> based on the first phase.
If the first phase is exhaustive, these are the true auxiliary means specified in the input-argument <code>exhaustive</code>.</p>
</td></tr>
<tr><td><code>cov_Z_bar_1G</code></td>
<td>
<p>the covariance matrix of <code>Z_bar_1G</code></p>
</td></tr>
<tr><td><code>Rc_x_hat_G</code></td>
<td>
<p>the small-area residuals at either the plot level or cluster level depending on the call</p>
</td></tr>
<tr><td><code>Rc_x_hat</code></td>
<td>
<p>the residuals at either the plot level or cluster level depending on the call</p>
</td></tr>
<tr><td><code>Yx_s2G</code></td>
<td>
<p>the local densities in the small area</p>
</td></tr>
<tr><td><code>Mx_s2G</code></td>
<td>
<p>the cluster weights in the small area</p>
</td></tr>
<tr><td><code>mean_Rc_x_hat_G</code></td>
<td>
<p>the mean residual (weighted mean in the case of cluster sampling) in the small area</p>
</td></tr>
<tr><td><code>mean_Rc_x_hat</code></td>
<td>
<p>the mean residual (weighted mean in the case of cluster sampling)</p>
</td></tr>
<tr><td><code>warn.messages</code></td>
<td>
<p>logical indicating if warning messages were issued</p>
</td></tr>
</table>


<h3>Note</h3>

<p>In the special case of cluster sampling, the reported sample sizes in <code>estimation</code> are the number of clusters.
The <code>samplesize</code>-object also provides the respective number of single plot units for cluster sampling.
The reported <code>r.squared</code> describe the model fit of the applied linear regression
model (i.e. on <em>plot-level</em>, not on <em>cluster level</em>).
</p>


<h3>References</h3>

<p>Hill, A., Massey, A. F. (2021). <em>The R Package forestinventory: Design-Based Global and Small Area Estimations for Multiphase Forest Inventories.</em> Journal of Statistical Software, 97(4), 1-40.
</p>
<p>Mandallaz, D. (2007). <em>Sampling techniques for forest inventories.</em> Chapter 4. CRC Press.
</p>
<p>Mandallaz, D. (2013). <em>Design-based properties of some small-area estimators in forest inventory with two-phase sampling.</em> Can. J. For. Res. 43: 441-449
</p>
<p>Mandallaz, D. and Hill, A. and Massey, A. (2016). <em>Design-based properties of some small-area estimators in forest inventory with two-phase sampling.</em> ETH Zurich, Department of Environmental Systems Science,Tech. rep. Available from <a href="http://e-collection.library.ethz.ch">http://e-collection.library.ethz.ch</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## load datasets:
data(grisons)
data(zberg)

# ------------------------------------------------#
# ----------- GLOBAL ESTIMATION ------------------#

#----
## 1) -- Design-based estimation with non-exhaustive auxiliary information
#----

# 1.1) non-cluster-sampling:
summary(twophase(formula = tvol ~mean + stddev + max + q75,
                 data = grisons,
                 phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2)))

# 1.2) cluster-sampling (see eqns. [57] and [58] in Mandallaz, Hill, Massey 2016):
summary(twophase(formula = basal ~ stade + couver + melange,
                data = zberg,
                phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                cluster = "cluster"))

# 1.3) example for boundary weight adjustment (non-cluster example):
summary(twophase(formula=tvol ~ mean + stddev + max + q75,
                 data=grisons,
                 phase_id=list(phase.col = "phase_id_2p", terrgrid.id = 2),
                 boundary_weights = "boundary_weights"))

#----
## 2) -- Design-based estimation with exhaustive auxiliary information
#----

# establish order for vector of true auxiliary means:
colnames(lm(formula = tvol ~ mean + stddev + max + q75, data = grisons, x = TRUE)$x)
true.means &lt;- c(1, 11.39, 8.84, 32.68, 18.03)

# 2.1) non-cluster-sampling:
summary(twophase(formula = tvol ~ mean + stddev + max + q75,
                 data = grisons,
                 phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                 exhaustive = true.means))

# 2.2) cluster-sampling:
summary(twophase(formula = stem ~ stade + couver + melange,
                 data = zberg,
                 phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                 cluster = "cluster",
                 exhaustive = c(1, 0.10, 0.7, 0.10, 0.6, 0.8)))


# ----------------------------------------------------#
# ----------- SMALL AREA ESTIMATION ------------------#

#----
## 1) -- Design-based estimation with non-exhaustive auxiliary information
#----

# 1.1) Mandallaz's extended pseudo small area estimator (see eqns. [35] and [36] in Mandallaz 2013):
summary(twophase(formula = tvol ~ mean + stddev + max + q75, data = grisons,
                 phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                 small_area = list(sa.col = "smallarea", areas = c("A", "B","C", "D"),
                                   unbiased = TRUE)))

summary(twophase(formula = basal ~ stade + couver + melange, data=zberg,
                 phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                 cluster = "cluster",
                 small_area = list(sa.col = "ismallg23", areas = c("2", "3"),
                                   unbiased = TRUE)))


# 1.2) pseudo small area estimator (see eqns. [25] and [26] in Mandallaz 2013):
summary(twophase(formula = tvol ~ mean + stddev + max + q75, data = grisons,
                 phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                 small_area = list(sa.col = "smallarea", areas = c("A", "B"),
                                   unbiased = TRUE),
                 psmall = TRUE))

summary(twophase(formula = basal ~ stade + couver + melange, data=zberg,
                 phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                 cluster = "cluster",
                 small_area = list(sa.col = "ismallg23", areas = c("2", "3"),
                                   unbiased = TRUE),
                 psmall = TRUE))


# 1.3) pseudosynthetic small area estimator (see eqns. [35] and [36] in Mandallaz 2013):
summary(twophase(formula = tvol ~ mean + stddev + max + q75, data=grisons,
                 phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                 small_area = list(sa.col = "smallarea", areas = c("B", "A"),
                                   unbiased = FALSE)))

summary(twophase(formula = basal ~ stade + couver + melange, data=zberg,
                 phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                 cluster = "cluster",
                 small_area = list(sa.col = "ismallg23", areas = c("2", "3"),
                                   unbiased = FALSE)))


#----
## 2) -- Design-based estimation with exhaustive auxiliary information
#----

# establish order for vector of true auxiliary means:
colnames(lm(formula = tvol ~ mean + stddev + max + q75, data = grisons, x = TRUE)$x)
colnames(lm(formula = basal ~ stade + couver + melange, data = zberg, x = TRUE)$x)

# true auxiliary means taken from Mandallaz et al. (2013):
truemeans.G &lt;- data.frame(Intercept = rep(1, 4),
                         mean = c(12.85, 12.21, 9.33, 10.45),
                         stddev = c(9.31, 9.47, 7.90, 8.36),
                         max = c(34.92, 35.36, 28.81, 30.22),
                         q75 = c(19.77, 19.16, 15.40, 16.91))
rownames(truemeans.G) &lt;- c("A", "B", "C", "D")

# true auxiliary means taken from Mandallaz (1991):
truemeans.G.clust &lt;- data.frame(Intercept = 1,
                               stade400 = 0.175,
                               stade500 = 0.429,
                               stade600 = 0.321,
                               couver2 = 0.791,
                               melange2 = 0.809)
rownames(truemeans.G.clust) &lt;- c("1")


# 2.1) Mandallaz's extended small area estimator (see eqns. [31] and [33] in Mandallaz 2013):
summary(twophase(formula = tvol ~ mean + stddev + max + q75, data = grisons,
                 phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                 small_area = list(sa.col ="smallarea", areas = c("A", "B"),
                                   unbiased = TRUE),
                 exhaustive = truemeans.G))

summary(twophase(formula = basal ~ stade + couver + melange, data=zberg,
                 phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                 cluster = "cluster",
                 small_area = list(sa.col = "ismallold", areas = c("1"),
                                   unbiased = TRUE),
                 exhaustive = truemeans.G.clust))


# 2.2) small area estimator (see eqns. [20] and [21] in Mandallaz 2013):
summary(twophase(formula = tvol ~ mean + stddev + max + q75, data = grisons,
                 phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                 small_area = list(sa.col = "smallarea", areas = c("A"),
                                   unbiased = TRUE),
                 exhaustive = truemeans.G, psmall = TRUE))

summary(twophase(formula = basal ~ stade + couver + melange, data = zberg,
                 phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                 cluster = "cluster",
                 small_area = list(sa.col ="ismallold", areas = c("1"),
                                   unbiased = TRUE),
                 psmall = TRUE,
                 exhaustive = truemeans.G.clust))


# 2.3) synthetic small area estimator (see eqns. [18] and [19] in Mandallaz 2013):
summary(twophase(formula=tvol ~ mean + stddev + max + q75, data=grisons,
                 phase_id=list(phase.col = "phase_id_2p", terrgrid.id = 2),
                 small_area=list(sa.col = "smallarea", areas = c("A", "B"),
                                 unbiased = FALSE),
                 exhaustive = truemeans.G))

summary(twophase(formula = basal ~ stade + couver + melange, data = zberg,
                 phase_id = list(phase.col = "phase_id_2p", terrgrid.id = 2),
                 cluster = "cluster",
                 small_area = list(sa.col = "ismallold", areas = c("1"),
                                   unbiased = FALSE),
                 exhaustive = truemeans.G.clust))

</code></pre>

<hr>
<h2 id='zberg'>Data from a multiphase forest inventory at the zurichberg (zurich), switzerland</h2><span id='topic+zberg'></span>

<h3>Description</h3>

<p>A dataset from 1991 containing 1203 sample plots observations from a forest inventory using cluster-sampling.
The large phase comprises 298 clusters. Terrestrial information of the stem number as well as the basal area
is available for a systematic subsample of 73 clusters. Auxiliary information at all 2103 sample plots were
derived by stand maps. Originally the inventory was carried out as a twophase inventory and
has been artificially extended to a threephase inventory for demonstration purposes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>zberg
</code></pre>


<h3>Format</h3>

<p>data frame with 1203 rows and 12 columns
</p>


<h3>Details</h3>


<ul>
<li><p><code>cluster</code>     cluster identification. Maximum number of sample plots per cluster is 5.
</p>
</li>
<li><p><code>phase_id_2p</code> phase-membership of each observation for the twophase inventory.
The first phase is indicated by <code>1</code>, the second (i.e. terrestrial) phase by <code>2</code>.
</p>
</li>
<li><p><code>phase_id_3p</code> the phase-membership of each observation for the threephase inventory,
i.e. the first phase (<code>0</code>), the second phase (<code>1</code>)
and third (terrestrial) phase (<code>2</code>). <em>Note:</em> The threephase sample scheme
was artificially created for demonstration purposes of the
<code><a href="#topic+threephase">threephase</a></code>-functions.
</p>
</li>
<li><p><code>stade</code>       development stage at sample plot location based on the stand map.
Categorical variable of class <code>factor</code> with 4 <code>levels</code>.
</p>
</li>
<li><p><code>melange</code>     degree of mixture at sample plot location based on the stand map.
Categorical variable of class <code>factor</code> with 2 <code>levels</code>.
</p>
</li>
<li><p><code>couver</code>      crown-coverage at sample plot location based on the stand map.
Categorical variable of class <code>factor</code> with 2 <code>levels</code>.
</p>
</li>
<li><p><code>stem</code>        stem number derived at field survey.
</p>
</li>
<li><p><code>basal</code>       basal area derived at field survey.
</p>
</li>
<li><p><code>ismallg23</code>   indicator for small area 2 and 3 for each observation.
</p>
</li>
<li><p><code>ismallold</code>   indicator for small area 1 for each observation.
</p>
</li></ul>



<h3>Source</h3>

<p>Data provided by D.Mandallaz
</p>


<h3>References</h3>

<p>Mandallaz, Daniel (1991). <em>A unified approach to sampling theory for forest inventory
based on infinite population and superpopulation models.</em> http://dx.doi.org/10.3929/ethz-a-000585900
</p>
<p>Mandallaz, Daniel (1993). <em>Geostatistical methods for double sampling schemes. application to combined forest inventories.</em>
Chair of Forest Inventory and Planning, Swiss Federal Institute of Technology (ETH). http://dx.doi.org/10.3929/ethz-a-000943897
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
