<!DOCTYPE html><html><head><title>Help for package IDF</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {IDF}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#dgev.d'><p>d-GEV probability density function</p></a></li>
<li><a href='#example'><p>Sampled data for duration-dependent GEV</p></a></li>
<li><a href='#gev.d.diag'><p>Diagnostic Plots for d-gev Models</p></a></li>
<li><a href='#gev.d.fit'><p>Maximum-likelihood Fitting of the duration-dependent GEV Distribution</p></a></li>
<li><a href='#gev.d.init'><p>get initial values for gev.d.fit</p></a></li>
<li><a href='#gev.d.lik'><p>d-GEV Likelihood</p></a></li>
<li><a href='#gev.d.params'><p>Calculate gev(d) parameters from <code>gev.d.fit</code> output</p></a></li>
<li><a href='#IDF-package'><p>Introduction</p></a></li>
<li><a href='#IDF.agg'><p>Aggregation and annual maxima for chosen durations</p></a></li>
<li><a href='#IDF.plot'><p>Plotting of IDF curves at a chosen station</p></a></li>
<li><a href='#pgev.d'><p>d-GEV cumulative distribution function</p></a></li>
<li><a href='#qgev.d'><p>d-GEV quantile function</p></a></li>
<li><a href='#rgev.d'><p>Generation of random variables from d-GEV</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Estimation and Plotting of IDF Curves</td>
</tr>
<tr>
<td>Version:</td>
<td>2.1.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-07-20</td>
</tr>
<tr>
<td>Description:</td>
<td>Intensity-duration-frequency (IDF) curves are a widely used analysis-tool
              in hydrology to assess extreme values of precipitation
              [e.g. Mailhot et al., 2007, &lt;<a href="https://doi.org/10.1016%2Fj.jhydrol.2007.09.019">doi:10.1016/j.jhydrol.2007.09.019</a>&gt;].
              The package 'IDF' provides functions to estimate IDF parameters for given
              precipitation time series on the basis of a duration-dependent
              generalized extreme value distribution
              [Koutsoyiannis et al., 1998, &lt;<a href="https://doi.org/10.1016%2FS0022-1694%2898%2900097-3">doi:10.1016/S0022-1694(98)00097-3</a>&gt;].</td>
</tr>
<tr>
<td>Author:</td>
<td>Felix S. Fauer [aut, cre],
  Jana Ulrich [aut],
  Laura Mack [ctb],
  Oscar E. Jurado [ctb],
  Christoph Ritschel [aut],
  Carola Detring [ctb],
  Sarah Joedicke [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Felix S. Fauer &lt;felix.fauer@met.fu-berlin.de&gt;</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats, evd, ismev, RcppRoll, pbapply, fastmatch</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://gitlab.met.fu-berlin.de/Rpackages/idf_package">https://gitlab.met.fu-berlin.de/Rpackages/idf_package</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-07-20 11:15:33 UTC; janaulrich</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-07-20 14:20:09 UTC</td>
</tr>
</table>
<hr>
<h2 id='dgev.d'>d-GEV probability density function</h2><span id='topic+dgev.d'></span>

<h3>Description</h3>

<p>Probability density function of duration-dependent GEV distribution
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dgev.d(q, mut, sigma0, xi, theta, eta, d, eta2 = 0, tau = 0, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dgev.d_+3A_q">q</code></td>
<td>
<p>vector of quantiles</p>
</td></tr>
<tr><td><code id="dgev.d_+3A_mut">mut</code>, <code id="dgev.d_+3A_sigma0">sigma0</code>, <code id="dgev.d_+3A_xi">xi</code></td>
<td>
<p>numeric value, giving modified location <code class="reqn">\tilde{\mu}</code>, scale offset <code class="reqn">\sigma_0</code> and 
shape parameter <code class="reqn">\xi</code>.</p>
</td></tr>
<tr><td><code id="dgev.d_+3A_theta">theta</code></td>
<td>
<p>numeric value, giving duration offset <code class="reqn">\theta</code> (defining curvature of the IDF curve)</p>
</td></tr>
<tr><td><code id="dgev.d_+3A_eta">eta</code></td>
<td>
<p>numeric value, giving duration exponent <code class="reqn">\eta</code> (defining slope of the IDF curve)</p>
</td></tr>
<tr><td><code id="dgev.d_+3A_d">d</code></td>
<td>
<p>positive numeric value, giving duration</p>
</td></tr>
<tr><td><code id="dgev.d_+3A_eta2">eta2</code></td>
<td>
<p>numeric value, giving a second duration exponent <code class="reqn">\eta_{2}</code> (needed for multiscaling). Default: <code class="reqn">\eta_2=0</code>.</p>
</td></tr>
<tr><td><code id="dgev.d_+3A_tau">tau</code></td>
<td>
<p>numeric value, giving intensity offset <code class="reqn">\tau</code> (defining flattening of the IDF curve). Default: <code class="reqn">\tau=0</code>.</p>
</td></tr>
<tr><td><code id="dgev.d_+3A_...">...</code></td>
<td>
<p>additional parameters passed to <code><a href="evd.html#topic+dgev">dgev</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>For details on the d-GEV and the parameter definitions, see <a href="#topic+IDF-package">IDF-package</a>.
</p>


<h3>Value</h3>

<p>list containing vectors of density values for given quantiles.
The first element of the list are the density values for the first given duration etc.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pgev.d">pgev.d</a></code>, <code><a href="#topic+qgev.d">qgev.d</a></code>, <code><a href="#topic+rgev.d">rgev.d</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- seq(4,20,0.1)
# calculate probability density for one duration
dgev.d(q=x,mut=4,sigma0=2,xi=0,theta=0.1,eta=0.1,d=1)

# calculate probability density for different durations
ds &lt;- 1:4
dens &lt;- lapply(ds,dgev.d,q=x,mut=4,sigma0=2,xi=0,theta=0.1,eta=0.1)

plot(x,dens[[1]],type='l',ylim = c(0,0.21),ylab = 'Probability Density')
for(i in 2:4){
  lines(x,dens[[i]],lty=i)
}
legend('topright',title = 'Duration',legend = 1:4,lty=1:4)
</code></pre>

<hr>
<h2 id='example'>Sampled data for duration-dependent GEV</h2><span id='topic+example'></span>

<h3>Description</h3>

<p>Randomly sampled data set used for running the example code, containing:
</p>

<ul>
<li> <p><code>$xdat</code>: 'annual' maxima values
</p>
</li>
<li> <p><code>$ds</code>: corresponding durations
</p>
</li>
<li> <p><code>$cov1</code>, <code>$cov2</code>: covariates</p>
</li></ul>

<p>d-GEV parameters used for sampling:
</p>

<ul>
<li> <p><code class="reqn">\tilde{\mu} = 4 + 0.2 cov_1 +0.5 cov_2</code>
</p>
</li>
<li> <p><code class="reqn">\sigma_0 = 2+0.5 cov_1</code>
</p>
</li>
<li> <p><code class="reqn">\xi = 0.5</code>
</p>
</li>
<li> <p><code class="reqn">\theta = 0</code>
</p>
</li>
<li> <p><code class="reqn">\eta = 0.5</code>
</p>
</li>
<li> <p><code class="reqn">\eta_2 = 0.5</code>
</p>
</li>
<li> <p><code class="reqn">\tau = 0</code></p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>data('example',package ='IDF')
</code></pre>


<h3>Format</h3>

<p>A data frame with 330 rows and 4 variables
</p>

<hr>
<h2 id='gev.d.diag'>Diagnostic Plots for d-gev Models</h2><span id='topic+gev.d.diag'></span>

<h3>Description</h3>

<p>Produces diagnostic plots for d-gev models using
the output of the function <code><a href="#topic+gev.d.fit">gev.d.fit</a></code>. Values for different durations can be plotted in
different colors of with different symbols.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gev.d.diag(
  fit,
  subset = NULL,
  cols = NULL,
  pch = NULL,
  which = "both",
  mfrow = c(1, 2),
  legend = TRUE,
  title = c("Residual Probability Plot", "Residual Quantile Plot"),
  emp.lab = "Empirical",
  mod.lab = "Model",
  ci = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gev.d.diag_+3A_fit">fit</code></td>
<td>
<p>object returned by <code><a href="#topic+gev.d.fit">gev.d.fit</a></code></p>
</td></tr>
<tr><td><code id="gev.d.diag_+3A_subset">subset</code></td>
<td>
<p>an optional vector specifying a subset of observations to be used in the plot</p>
</td></tr>
<tr><td><code id="gev.d.diag_+3A_cols">cols</code></td>
<td>
<p>optional either one value or vector of same length as <code>unique(fit$ds)</code> to
specify the colors of plotting points.
The default uses the <code>rainbow</code> function.</p>
</td></tr>
<tr><td><code id="gev.d.diag_+3A_pch">pch</code></td>
<td>
<p>optional either one value or vector of same length as <code>unique(fit$ds)</code> containing
integers or symbols to specify the plotting points.</p>
</td></tr>
<tr><td><code id="gev.d.diag_+3A_which">which</code></td>
<td>
<p>string containing 'both', 'pp' or 'qq' to specify, which plots should be produced.</p>
</td></tr>
<tr><td><code id="gev.d.diag_+3A_mfrow">mfrow</code></td>
<td>
<p>vector specifying layout of plots. If both plots should be produced separately,
set to <code>c(1,1)</code>.</p>
</td></tr>
<tr><td><code id="gev.d.diag_+3A_legend">legend</code></td>
<td>
<p>logical indicating if legends should be plotted</p>
</td></tr>
<tr><td><code id="gev.d.diag_+3A_title">title</code></td>
<td>
<p>character vector of length 2, giving the titles for the pp- and the qq-plot</p>
</td></tr>
<tr><td><code id="gev.d.diag_+3A_emp.lab">emp.lab</code>, <code id="gev.d.diag_+3A_mod.lab">mod.lab</code></td>
<td>
<p>character string containing names for empirical and model axis</p>
</td></tr>
<tr><td><code id="gev.d.diag_+3A_ci">ci</code></td>
<td>
<p>logical indicating whether 0.95 confidence intervals should be plotted</p>
</td></tr>
<tr><td><code id="gev.d.diag_+3A_...">...</code></td>
<td>
<p>additional parameters passed on to the plotting function</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>data('example',package ='IDF')

fit &lt;- gev.d.fit(xdat=example$dat,ds = example$d,ydat=as.matrix(example[,c('cov1','cov2')])
                 ,mutl=c(1,2),sigma0l=1)
# diagnostic plots for complete data
gev.d.diag(fit,pch=1,ci = TRUE)
# diagnostic plots for subset of data (e.g. one station)
gev.d.diag(fit,subset = example$cov1==1,pch=1,ci = TRUE)
</code></pre>

<hr>
<h2 id='gev.d.fit'>Maximum-likelihood Fitting of the duration-dependent GEV Distribution</h2><span id='topic+gev.d.fit'></span>

<h3>Description</h3>

<p>Modified <code><a href="ismev.html#topic+gev.fit">gev.fit</a></code> function for Maximum-likelihood fitting
for the duration-dependent generalized extreme
value distribution, following Koutsoyiannis et al. (1998), including generalized linear
modeling of each parameter.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gev.d.fit(
  xdat,
  ds,
  ydat = NULL,
  mutl = NULL,
  sigma0l = NULL,
  xil = NULL,
  thetal = NULL,
  etal = NULL,
  taul = NULL,
  eta2l = NULL,
  mutlink = make.link("identity"),
  sigma0link = make.link("identity"),
  xilink = make.link("identity"),
  thetalink = make.link("identity"),
  etalink = make.link("identity"),
  taulink = make.link("identity"),
  eta2link = make.link("identity"),
  init.vals = NULL,
  theta_zero = FALSE,
  tau_zero = TRUE,
  eta2_zero = TRUE,
  show = TRUE,
  method = "Nelder-Mead",
  maxit = 10000,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gev.d.fit_+3A_xdat">xdat</code></td>
<td>
<p>A vector containing maxima for different durations.
This can be obtained from <code><a href="#topic+IDF.agg">IDF.agg</a></code>.</p>
</td></tr>
<tr><td><code id="gev.d.fit_+3A_ds">ds</code></td>
<td>
<p>A vector of aggregation levels corresponding to the maxima in xdat.
1/60 corresponds to 1 minute, 1 corresponds to 1 hour.</p>
</td></tr>
<tr><td><code id="gev.d.fit_+3A_ydat">ydat</code></td>
<td>
<p>A matrix of covariates for generalized linear modeling of the parameters
(or NULL (the default) for stationary fitting). The number of rows should be the same as the
length of xdat.</p>
</td></tr>
<tr><td><code id="gev.d.fit_+3A_mutl">mutl</code>, <code id="gev.d.fit_+3A_sigma0l">sigma0l</code>, <code id="gev.d.fit_+3A_xil">xil</code>, <code id="gev.d.fit_+3A_thetal">thetal</code>, <code id="gev.d.fit_+3A_etal">etal</code>, <code id="gev.d.fit_+3A_taul">taul</code>, <code id="gev.d.fit_+3A_eta2l">eta2l</code></td>
<td>
<p>Numeric vectors of integers, giving the columns of ydat that contain
covariates for generalized linear modeling of the parameters (or NULL (the default)
if the corresponding parameter is stationary).
Parameters are: modified location, scale offset, shape, duration offset, duration exponent, respectively.</p>
</td></tr>
<tr><td><code id="gev.d.fit_+3A_mutlink">mutlink</code>, <code id="gev.d.fit_+3A_sigma0link">sigma0link</code>, <code id="gev.d.fit_+3A_xilink">xilink</code>, <code id="gev.d.fit_+3A_thetalink">thetalink</code>, <code id="gev.d.fit_+3A_etalink">etalink</code>, <code id="gev.d.fit_+3A_eta2link">eta2link</code>, <code id="gev.d.fit_+3A_taulink">taulink</code></td>
<td>
<p>Link functions for generalized linear
modeling of the parameters, created with <code><a href="stats.html#topic+make.link">make.link</a></code>. The default is <code>make.link("identity")</code>.</p>
</td></tr>
<tr><td><code id="gev.d.fit_+3A_init.vals">init.vals</code></td>
<td>
<p>list, giving initial values for all or some parameters
(order: mut, sigma0, xi, theta, eta, eta2, tau). If one of those parameters shall not be used (see theta_zero, eta2_zero, tau_zero),
the number of parameters has to be reduced accordingly. If some or all given values in init.vals are NA or 
no init.vals at all is declared (the default), initial parameters are obtained
internally by fitting the GEV separately for each duration and applying a linear model to obtain the
duration dependency of the location and shape parameter.
Initial values for covariate parameters are assumed as 0 if not given.</p>
</td></tr>
<tr><td><code id="gev.d.fit_+3A_theta_zero">theta_zero</code></td>
<td>
<p>Logical value, indicating whether theta should be estimated (FALSE, the default) or
should stay zero.</p>
</td></tr>
<tr><td><code id="gev.d.fit_+3A_tau_zero">tau_zero</code>, <code id="gev.d.fit_+3A_eta2_zero">eta2_zero</code></td>
<td>
<p>Logical values, indicating whether tau,eta2 should be estimated (TRUE, the default).</p>
</td></tr>
<tr><td><code id="gev.d.fit_+3A_show">show</code></td>
<td>
<p>Logical; if TRUE (the default), print details of the fit.</p>
</td></tr>
<tr><td><code id="gev.d.fit_+3A_method">method</code></td>
<td>
<p>The optimization method used in <code><a href="stats.html#topic+optim">optim</a></code>.</p>
</td></tr>
<tr><td><code id="gev.d.fit_+3A_maxit">maxit</code></td>
<td>
<p>The maximum number of iterations.</p>
</td></tr>
<tr><td><code id="gev.d.fit_+3A_...">...</code></td>
<td>
<p>Other control parameters for the optimization.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For details on the d-GEV and the parameter definitions, see <a href="#topic+IDF-package">IDF-package</a>.
</p>


<h3>Value</h3>

<p>A list containing the following components.
A subset of these components are printed after the fit.
If <code>show</code> is TRUE, then assuming that successful convergence is indicated,
the components nllh, mle and se are always printed.
</p>
<table>
<tr><td><code>nllh</code></td>
<td>
<p>single numeric giving the negative log-likelihood value</p>
</td></tr>
<tr><td><code>mle</code></td>
<td>
<p>numeric vector giving the MLE's for the modified location, scale_0, shape,
duration offset and duration exponent, resp. If requested, contains also second duration exponent and intensity-offset</p>
</td></tr>
<tr><td><code>se</code></td>
<td>
<p>numeric vector giving the standard errors for the MLE's (in the same order)</p>
</td></tr>
<tr><td><code>trans</code></td>
<td>
<p>A logical indicator for a non-stationary fit.</p>
</td></tr>
<tr><td><code>model</code></td>
<td>
<p>A list with components mutl, sigma0l, xil, thetal and etal. If requested, contains also eta2l and taul</p>
</td></tr>
<tr><td><code>link</code></td>
<td>
<p>A character vector giving link functions.</p>
</td></tr>
<tr><td><code>conv</code></td>
<td>
<p>The convergence code, taken from the list returned by <code><a href="stats.html#topic+optim">optim</a></code>.
A zero indicates successful convergence.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>data is standardized to standard Gumbel.</p>
</td></tr>
<tr><td><code>cov</code></td>
<td>
<p>The covariance matrix.</p>
</td></tr>
<tr><td><code>vals</code></td>
<td>
<p>Parameter values for every data point.</p>
</td></tr>
<tr><td><code>init.vals</code></td>
<td>
<p>Initial values that were used.</p>
</td></tr>
<tr><td><code>ds</code></td>
<td>
<p>Durations for every data point.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+IDF-package">IDF-package</a></code>, <code><a href="#topic+IDF.agg">IDF.agg</a></code>, <code>gev.fit</code>, <code><a href="stats.html#topic+optim">optim</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># sampled random data from d-gev with covariates
# GEV parameters:
# mut = 4 + 0.2*cov1 +0.5*cov2
# sigma0 = 2+0.5*cov1
# xi = 0.5
# theta = 0
# eta = 0.5
# eta2 = 0
# tau = 0

data('example',package ='IDF')

gev.d.fit(xdat=example$dat,ds = example$d,ydat=as.matrix(example[,c('cov1','cov2')])
,mutl=c(1,2),sigma0l=1)
</code></pre>

<hr>
<h2 id='gev.d.init'>get initial values for gev.d.fit</h2><span id='topic+gev.d.init'></span>

<h3>Description</h3>

<p>obtain initial values by fitting every duration separately
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gev.d.init(xdat, ds, link)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gev.d.init_+3A_xdat">xdat</code></td>
<td>
<p>vector of maxima for different durations</p>
</td></tr>
<tr><td><code id="gev.d.init_+3A_ds">ds</code></td>
<td>
<p>vector of durations belonging to maxima in xdat</p>
</td></tr>
<tr><td><code id="gev.d.init_+3A_link">link</code></td>
<td>
<p>list of 5, link functions for parameters, created with <code><a href="stats.html#topic+make.link">make.link</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>list of initial values for mu_tilde, sigma_0, xi, theta, eta, eta2, tau
</p>

<hr>
<h2 id='gev.d.lik'>d-GEV Likelihood</h2><span id='topic+gev.d.lik'></span>

<h3>Description</h3>

<p>Computes (log-) likelihood of d-GEV model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gev.d.lik(
  xdat,
  ds,
  mut,
  sigma0,
  xi,
  theta,
  eta,
  log = FALSE,
  tau = 0,
  eta2 = 0
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gev.d.lik_+3A_xdat">xdat</code></td>
<td>
<p>numeric vector containing observations</p>
</td></tr>
<tr><td><code id="gev.d.lik_+3A_ds">ds</code></td>
<td>
<p>numeric vector containing corresponding durations (1/60 corresponds to 1 minute, 1 corresponds to 1 hour)</p>
</td></tr>
<tr><td><code id="gev.d.lik_+3A_mut">mut</code>, <code id="gev.d.lik_+3A_sigma0">sigma0</code>, <code id="gev.d.lik_+3A_xi">xi</code>, <code id="gev.d.lik_+3A_theta">theta</code>, <code id="gev.d.lik_+3A_eta">eta</code>, <code id="gev.d.lik_+3A_eta2">eta2</code>, <code id="gev.d.lik_+3A_tau">tau</code></td>
<td>
<p>numeric vectors containing corresponding estimates for each of the parameters</p>
</td></tr>
<tr><td><code id="gev.d.lik_+3A_log">log</code></td>
<td>
<p>Logical; if TRUE, the log likelihood is returned.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>single value containing (log) likelihood
</p>


<h3>Examples</h3>

<pre><code class='language-R'># compute log-likelihood of observation values not included in fit
train.set &lt;- example[example$d!=2,]
test.set &lt;- example[example$d==2,]
fit &lt;- gev.d.fit(train.set$dat,train.set$d,mutl = c(1,2),sigma0l = 1
          ,ydat = as.matrix(train.set[c('cov1','cov2')]))
params &lt;- gev.d.params(fit,ydat = as.matrix(test.set[c('cov1','cov2')]))
gev.d.lik(xdat = test.set$dat,ds = test.set$d,mut = params[,1],sigma0 = params[,2],xi = params[,3]
          ,theta = params[,4],eta = params[,5],log=TRUE)
</code></pre>

<hr>
<h2 id='gev.d.params'>Calculate gev(d) parameters from <code>gev.d.fit</code> output</h2><span id='topic+gev.d.params'></span>

<h3>Description</h3>

<p>function to calculate mut, sigma0, xi, theta, eta, eta2, tau
(modified location, scale offset, shape, duration offset, duration exponent, second duration exponent, intensity offset)
from results of <code><a href="#topic+gev.d.fit">gev.d.fit</a></code> with covariates or link functions other than identity.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gev.d.params(fit, ydat = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gev.d.params_+3A_fit">fit</code></td>
<td>
<p>fit object returned by <code><a href="#topic+gev.d.fit">gev.d.fit</a></code> or <code>gev.fit</code></p>
</td></tr>
<tr><td><code id="gev.d.params_+3A_ydat">ydat</code></td>
<td>
<p>A matrix containing the covariates in the same order as used in <code>gev.d.fit</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame containing mu_tilde, sigma0, xi, theta, eta, eta2, tau (or mu, sigma, xi for gev.fit objects)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+IDF-package">IDF-package</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data('example',package = 'IDF')
fit &lt;- gev.d.fit(example$dat,example$d,ydat = as.matrix(example[,c("cov1","cov2")])
                 ,mutl = c(1,2),sigma0l = 1)
gev.d.params(fit = fit,ydat = cbind(c(0.9,1),c(0.5,1)))
</code></pre>

<hr>
<h2 id='IDF-package'>Introduction</h2><span id='topic+IDF-package'></span>

<h3>Description</h3>

<p>This package provides functions to estimate IDF relations for given
precipitation time series on the basis of a duration-dependent
generalized extreme value distribution (d-GEV).
The central function is <code><a href="#topic+gev.d.fit">gev.d.fit</a></code>, which uses the method
of maximum-likelihood estimation for the d-GEV parameters, whereby it is
possible to include generalized linear modeling
for each parameter. This function was implemented on the basis of <code><a href="ismev.html#topic+gev.fit">gev.fit</a></code>.
For more detailed information on the methods and the application of the package for estimating
IDF curves with spatial covariates, see Ulrich et. al (2020).
</p>


<h3>Details</h3>


<ul>
<li><p> The <strong>d-GEV</strong> is defined following Koutsoyiannis et al. (1998):
</p>
<p style="text-align: center;"><code class="reqn">G(x)= \exp[-( 1+\xi(x/\sigma(d)- \tilde{\mu}) ) ^{-1/\xi}] </code>
</p>

<p>defined on <code class="reqn"> \{ x: 1+\xi(x/\sigma(d)- \tilde{\mu} &gt; 0) \} </code>,
with the duration dependent scale parameter <code class="reqn">\sigma(d)=\sigma_0/(d+\theta)^\eta &gt; 0</code>,
modified location parameter <code class="reqn">\tilde{\mu}=\mu/\sigma(d)\in R</code>
and shape parameter <code class="reqn">\xi\in R</code>, <code class="reqn">\xi\neq 0</code>.
The parameters <code class="reqn">\theta \leq 0</code> and <code class="reqn">0&lt;\eta&lt;1</code> are duration offset and duration exponent
and describe the slope and curvature in the resulting IDF curves, respectively.
</p>
</li>
<li><p> The dependence of scale and location parameter on duration, <code class="reqn">\sigma(d)</code> and <code class="reqn">\mu(d)</code>, can be extended by multiscaling
and flattening, if requested. Multiscaling introduces a second duration exponent <code class="reqn">\eta_2</code>, enabling the model to change slope
linearly with return period. Flattening adds a parameter <code class="reqn">\tau</code>, that flattens the IDF curve for long durations:
</p>
<p style="text-align: center;"><code class="reqn">\sigma(x)=\sigma_0(d+\theta)^{-(\eta+\eta_2)}+\tau </code>
</p>

<p style="text-align: center;"><code class="reqn">\mu(x)=\tilde{\mu}(\sigma_0(d+\theta)^{-\eta_1}+\tau)</code>
</p>

</li>
<li><p> A useful introduction to <strong>Maximum Likelihood Estimation</strong> for fitting for the
generalized extreme value distribution (GEV) is provided by Coles (2001). It should be noted, however, that this method uses
the assumption that block maxima (of different durations or stations) are independent of each other.
</p>
</li></ul>



<h3>References</h3>


<ul>
<li><p> Ulrich, J.; Jurado, O.E.; Peter, M.; Scheibel, M.;
Rust, H.W. Estimating IDF Curves Consistently over Durations with Spatial Covariates. Water 2020, 12, 3119,
https://doi.org/10.3390/w12113119
</p>
</li>
<li><p> Demetris Koutsoyiannis, Demosthenes Kozonis, Alexandros Manetas,
A mathematical framework for studying rainfall intensity-duration-frequency relationships,
Journal of Hydrology,
Volume 206, Issues 1â€“2,1998,Pages 118-135,ISSN 0022-1694, https://doi.org/10.1016/S0022-1694(98)00097-3
</p>
</li>
<li><p> Coles, S.An Introduction to Statistical Modeling of Extreme Values;   Springer:  New York, NY, USA, 2001,
https://doi.org/10.1198/tech.2002.s73
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Here are a few examples to illustrate the order in which the functions are intended to be used.

## Step 0: sample 20 years of example hourly 'precipitation' data
</code></pre>

<hr>
<h2 id='IDF.agg'>Aggregation and annual maxima for chosen durations</h2><span id='topic+IDF.agg'></span>

<h3>Description</h3>

<p>Aggregates several time series for chosen durations and finds annual maxima 
(either for the whole year or chosen months). Returns data.frame that can be used for
the function <code><a href="#topic+gev.d.fit">gev.d.fit</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>IDF.agg(
  data,
  ds,
  na.accept = 0,
  which.stations = NULL,
  which.mon = list(0:11),
  names = c("date", "RR"),
  cl = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="IDF.agg_+3A_data">data</code></td>
<td>
<p>list of data.frames containing time series for every station. 
The data.frame must have the columns 'date' and 'RR' unless other names 
are specified in the parameter &lsquo;names'. The column &rsquo;date' must contain strings with 
standard date format.</p>
</td></tr>
<tr><td><code id="IDF.agg_+3A_ds">ds</code></td>
<td>
<p>numeric vector of aggregation durations in hours. 
(Must be multiples of time resolution at all stations.)</p>
</td></tr>
<tr><td><code id="IDF.agg_+3A_na.accept">na.accept</code></td>
<td>
<p>numeric in [0,1) giving maximum percentage of missing values 
for which block max. should still be calculated.</p>
</td></tr>
<tr><td><code id="IDF.agg_+3A_which.stations">which.stations</code></td>
<td>
<p>optional, subset of stations. Either numeric vector or character vector 
containing names of elements in data. If not given, all elements in 'data' will be used.</p>
</td></tr>
<tr><td><code id="IDF.agg_+3A_which.mon">which.mon</code></td>
<td>
<p>optional, subset of months (as list containing values from 0 to 11) of which to calculate the annual maxima from.</p>
</td></tr>
<tr><td><code id="IDF.agg_+3A_names">names</code></td>
<td>
<p>optional, character vector of length 2, containing the names of the columns to be used.</p>
</td></tr>
<tr><td><code id="IDF.agg_+3A_cl">cl</code></td>
<td>
<p>optional, number of cores to be used from <code><a href="parallel.html#topic+parLapply">parLapply</a></code> for parallel computing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If data contains stations with different time resolutions that need to be aggregated at
different durations, IDF.agg needs to be run separately for the different groups of stations. 
Afterwards the results can be joint together using 'rbind'.
</p>


<h3>Value</h3>

<p>data.frame containing the annual intensity maxima [mm/h] in '$xdat', the corresponding duration in '$ds',
the '$year' and month ('$mon') in which the maxima occurred 
and the station id or name in '$station'.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pgev.d">pgev.d</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dates &lt;- as.Date("2019-01-01")+0:729
x &lt;- rgamma(n = 730, shape = 0.4, rate = 0.5)
df &lt;- data.frame(date=dates,RR=x)

# get annual maxima
IDF.agg(list('Sample'= df),ds=c(24,48),na.accept = 0.01)

##      xdat ds year  mon station
## 0.2853811 24 2019 0:11  Sample
## 0.5673122 24 2020 0:11  Sample
## 0.1598448 48 2019 0:11  Sample
## 0.3112713 48 2020 0:11  Sample

# get monthly maxima for each month of june, july and august
IDF.agg(list('Sample'=df),ds=c(24,48),na.accept = 0.01,which.mon = list(5,6,7))

# get maxima for time range from june to august
IDF.agg(list('Sample'=df),ds=c(24,48),na.accept = 0.01,which.mon = list(5:7))

</code></pre>

<hr>
<h2 id='IDF.plot'>Plotting of IDF curves at a chosen station</h2><span id='topic+IDF.plot'></span>

<h3>Description</h3>

<p>Plotting of IDF curves at a chosen station
</p>


<h3>Usage</h3>

<pre><code class='language-R'>IDF.plot(
  durations,
  fitparams,
  probs = c(0.5, 0.9, 0.99),
  cols = 4:2,
  add = FALSE,
  legend = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="IDF.plot_+3A_durations">durations</code></td>
<td>
<p>vector of durations for which to calculate the quantiles.</p>
</td></tr>
<tr><td><code id="IDF.plot_+3A_fitparams">fitparams</code></td>
<td>
<p>vector containing parameters mut, sigma0, xi, theta, eta
(modified location, scale offset, shape, duration offset, duration exponent) for chosen station
as obtained from <code><a href="#topic+gev.d.fit">gev.d.fit</a></code>
(or <code><a href="#topic+gev.d.params">gev.d.params</a></code> for model with covariates).</p>
</td></tr>
<tr><td><code id="IDF.plot_+3A_probs">probs</code></td>
<td>
<p>vector of non-exceedance probabilities for which to plot IDF curves (p = 1-1/(Return Period))</p>
</td></tr>
<tr><td><code id="IDF.plot_+3A_cols">cols</code></td>
<td>
<p>vector of colors for IDF curves. Should have same length as <code>probs</code></p>
</td></tr>
<tr><td><code id="IDF.plot_+3A_add">add</code></td>
<td>
<p>logical indicating if plot should be added to existing plot, default is FALSE</p>
</td></tr>
<tr><td><code id="IDF.plot_+3A_legend">legend</code></td>
<td>
<p>logical indicating if legend should be plotted (TRUE, the default)</p>
</td></tr>
<tr><td><code id="IDF.plot_+3A_...">...</code></td>
<td>
<p>additional parameters passed on to the <code>plot</code> function</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>data('example',package = 'IDF')
# fit d-gev
fit &lt;- gev.d.fit(example$dat,example$d,ydat = as.matrix(example[,c("cov1","cov2")])
                 ,mutl = c(1,2),sigma0l = 1)
# get parameters for cov1 = 1, cov2 = 1
par &lt;- gev.d.params(fit = fit, ydat = matrix(1,1,2))
# plot quantiles
IDF.plot(durations = seq(0.5,35,0.2),fitparams = par)
# add data points
points(example[example$cov1==1,]$d,example[example$cov1==1,]$dat)
</code></pre>

<hr>
<h2 id='pgev.d'>d-GEV cumulative distribution function</h2><span id='topic+pgev.d'></span>

<h3>Description</h3>

<p>Cumulative probability distribution function of duration-dependent GEV distribution
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pgev.d(q, mut, sigma0, xi, theta, eta, d, tau = 0, eta2 = 0, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pgev.d_+3A_q">q</code></td>
<td>
<p>vector of quantiles</p>
</td></tr>
<tr><td><code id="pgev.d_+3A_mut">mut</code>, <code id="pgev.d_+3A_sigma0">sigma0</code>, <code id="pgev.d_+3A_xi">xi</code></td>
<td>
<p>numeric value, giving modified location, modified scale and shape parameter</p>
</td></tr>
<tr><td><code id="pgev.d_+3A_theta">theta</code></td>
<td>
<p>numeric value, giving duration offset (defining curvature of the IDF curve)</p>
</td></tr>
<tr><td><code id="pgev.d_+3A_eta">eta</code></td>
<td>
<p>numeric value, giving duration exponent (defining slope of the IDF curve)</p>
</td></tr>
<tr><td><code id="pgev.d_+3A_d">d</code></td>
<td>
<p>positive numeric value, giving duration</p>
</td></tr>
<tr><td><code id="pgev.d_+3A_tau">tau</code></td>
<td>
<p>numeric value, giving intensity offset <code class="reqn">\tau</code> (defining flattening of the IDF curve). Default: <code class="reqn">\tau=0</code>.</p>
</td></tr>
<tr><td><code id="pgev.d_+3A_eta2">eta2</code></td>
<td>
<p>numeric value, giving a second duration exponent <code class="reqn">\eta_{2}</code> (needed for multiscaling). Default: <code class="reqn">\eta_2=0</code>.</p>
</td></tr>
<tr><td><code id="pgev.d_+3A_...">...</code></td>
<td>
<p>additional parameters passed to <code><a href="evd.html#topic+pgev">pgev</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The duration dependent GEV distribution is defined after 
[Koutsoyiannis et al., 1998]:
</p>
<p style="text-align: center;"><code class="reqn">G(x)= \exp[-\left( 1+\xi(x/\sigma(d)-\mu_t) \right)^{-1/\xi}] </code>
</p>
 
<p>with the duration dependent scale <code class="reqn">\sigma(d)=\sigma_0/(d+\theta)^\eta</code> and 
modified location parameter <code class="reqn">\mu_t=\mu/\sigma(d)</code>.
</p>
<p>For details on the d-GEV and the parameter definitions, see <a href="#topic+IDF-package">IDF-package</a>.
</p>


<h3>Value</h3>

<p>list containing vectors of probability values for given quantiles. 
The first element of the list are the probability values for the first given duration etc.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dgev.d">dgev.d</a></code>, <code><a href="#topic+qgev.d">qgev.d</a></code>, <code><a href="#topic+rgev.d">rgev.d</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- seq(4,20,0.1)
prob &lt;- pgev.d(q=x,mut=4,sigma0=2,xi=0,theta=0.1,eta=0.1,d=1)
</code></pre>

<hr>
<h2 id='qgev.d'>d-GEV quantile function</h2><span id='topic+qgev.d'></span>

<h3>Description</h3>

<p>Quantile function of duration-dependent GEV distribution (inverse of the cumulative probability distribution function)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>qgev.d(p, mut, sigma0, xi, theta, eta, d, tau = 0, eta2 = 0, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="qgev.d_+3A_p">p</code></td>
<td>
<p>vector of probabilities</p>
</td></tr>
<tr><td><code id="qgev.d_+3A_mut">mut</code>, <code id="qgev.d_+3A_sigma0">sigma0</code>, <code id="qgev.d_+3A_xi">xi</code></td>
<td>
<p>numeric value, giving modified location, modified scale and shape parameter</p>
</td></tr>
<tr><td><code id="qgev.d_+3A_theta">theta</code></td>
<td>
<p>numeric value, giving duration offset (defining curvature of the IDF curve for short durations)</p>
</td></tr>
<tr><td><code id="qgev.d_+3A_eta">eta</code></td>
<td>
<p>numeric value, giving duration exponent (defining slope of the IDF curve)</p>
</td></tr>
<tr><td><code id="qgev.d_+3A_d">d</code></td>
<td>
<p>positive numeric value, giving duration</p>
</td></tr>
<tr><td><code id="qgev.d_+3A_tau">tau</code></td>
<td>
<p>numeric value, giving intensity offset <code class="reqn">\tau</code> (defining flattening of the IDF curve). Default: <code class="reqn">\tau=0</code>.</p>
</td></tr>
<tr><td><code id="qgev.d_+3A_eta2">eta2</code></td>
<td>
<p>numeric value, giving a second duration exponent <code class="reqn">\eta_{2}</code> (needed for multiscaling). Default: <code class="reqn">\eta_2=0</code>.</p>
</td></tr>
<tr><td><code id="qgev.d_+3A_...">...</code></td>
<td>
<p>additional parameters passed to <code><a href="evd.html#topic+qgev">qgev</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The duration dependent GEV distribution is defined after 
[Koutsoyiannis et al., 1998]:
</p>
<p style="text-align: center;"><code class="reqn"> G(x)= \exp[-\left( 1+\xi(x/\sigma(d)-\mu_t) \right)^{-1/\xi}] </code>
</p>
 
<p>with the duration dependent scale <code class="reqn">\sigma(d)=\sigma_0/(d+\theta)^\eta</code> and 
modified location parameter <code class="reqn">\mu_t=\mu/\sigma(d)</code>.
</p>
<p>For details on the d-GEV and the parameter definitions, see <a href="#topic+IDF-package">IDF-package</a>.
</p>


<h3>Value</h3>

<p>list containing vectors of quantile values for given probabilities. 
The first element of the list are the q. values for the first given duration etc.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pgev.d">pgev.d</a></code>, <code><a href="#topic+dgev.d">dgev.d</a></code>, <code><a href="#topic+rgev.d">rgev.d</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>p &lt;- c(0.5,0.9,0.99)
# calulate quantiles for one duration
qgev.d(p=p,mut=4,sigma0=2,xi=0,theta=0.1,eta=0.3, d=1)

# calculate quantiles for sequence of durations
ds &lt;- 2^seq(0,4,0.1)
qs &lt;- lapply(ds,qgev.d,p=p,mut=4,sigma0=2,xi=0,theta=0.1,eta=0.3)
qs &lt;- simplify2array(qs)

plot(ds,qs[1,],ylim=c(3,20),type='l',log = 'xy',ylab='Intensity',xlab = 'Duration')
for(i in 2:3){
  lines(ds,qs[i,],lty=i)
}
legend('topright',title = 'p-quantile',
       legend = p,lty=1:3,bty = 'n')
</code></pre>

<hr>
<h2 id='rgev.d'>Generation of random variables from d-GEV</h2><span id='topic+rgev.d'></span>

<h3>Description</h3>

<p>Generation of random variables following duration-dependent GEV.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rgev.d(n, mut, sigma0, xi, theta, eta, d, tau = 0, eta2 = 0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rgev.d_+3A_n">n</code></td>
<td>
<p>number of random variables per duration</p>
</td></tr>
<tr><td><code id="rgev.d_+3A_mut">mut</code>, <code id="rgev.d_+3A_sigma0">sigma0</code>, <code id="rgev.d_+3A_xi">xi</code></td>
<td>
<p>numeric value, giving modified location, modified scale and shape parameter</p>
</td></tr>
<tr><td><code id="rgev.d_+3A_theta">theta</code></td>
<td>
<p>numeric value, giving duration offset (defining curvature of the IDF curve)</p>
</td></tr>
<tr><td><code id="rgev.d_+3A_eta">eta</code></td>
<td>
<p>numeric value, giving duration exponent (defining slope of the IDF curve)</p>
</td></tr>
<tr><td><code id="rgev.d_+3A_d">d</code></td>
<td>
<p>positive numeric value, giving duration</p>
</td></tr>
<tr><td><code id="rgev.d_+3A_tau">tau</code></td>
<td>
<p>numeric value, giving intensity offset <code class="reqn">\tau</code> (defining flattening of the IDF curve). Default: <code class="reqn">\tau=0</code>.</p>
</td></tr>
<tr><td><code id="rgev.d_+3A_eta2">eta2</code></td>
<td>
<p>numeric value, giving a second duration exponent <code class="reqn">\eta_{2}</code> (needed for multiscaling). Default: <code class="reqn">\eta_2=0</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For details on the d-GEV and the parameter definitions, see <a href="#topic+IDF-package">IDF-package</a>
</p>


<h3>Value</h3>

<p>list containing vectors of random variables.  
The first element of the list are the random values for the first given duration etc.
Note that the random variables for different durations are nor ordered (contrary to precipitation maxima of different durations).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pgev.d">pgev.d</a></code>, <code><a href="#topic+qgev.d">qgev.d</a></code>, <code><a href="#topic+dgev.d">dgev.d</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># random sample for one duration
rgev.d(n=100,mut=4,sigma0=2,xi=0,theta=0.1,eta=0.3,d=1)

# compare randomn samples for different durations
ds &lt;- c(1,4)
samp &lt;- lapply(ds,rgev.d,n=100,mut=4,sigma0=2,xi=0,theta=0.1,eta=0.3)

hist(samp[[1]],breaks = 10,col=rgb(1,0,0,0.5),freq = FALSE
     ,ylim=c(0,0.3),xlim=c(3,20),xlab='x',main = 'Random d-GEV samples')
hist(samp[[2]],breaks = 10,add=TRUE,col=rgb(0,0,1,0.5),freq = FALSE)
legend('topright',fill = c(rgb(1,0,0,0.5),rgb(0,0,1,0.5)),
legend = paste('d=',1:2,'h'),title = 'Duration')
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
