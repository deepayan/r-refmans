<!DOCTYPE html><html lang="en"><head><title>Help for package nawtilus</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {nawtilus}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#cbcheck'><p>Summarize and plot covariate balance</p></a></li>
<li><a href='#LaLonde'><p>LaLonde data set</p></a></li>
<li><a href='#nawt'><p>Navigated weighting (NAWT) estimation</p></a></li>
<li><a href='#plot_omega'><p>Plot weights for propensity score estimation in the navigated weighting</p></a></li>
<li><a href='#plot.nawt'><p>Plot a scattered plot comparing the navigated weighting and naive estimation</p></a></li>
<li><a href='#print.nawt'><p>Print navigated weighting estimation</p></a></li>
<li><a href='#summary.nawt'><p>Summarizing navigated weighting estimation</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Navigated Weighting for the Inverse Probability Weighting</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.4</td>
</tr>
<tr>
<td>Description:</td>
<td>Implements the navigated weighting (NAWT) proposed by Katsumata (2020)
    &lt;<a href="https://doi.org/10.48550/arXiv.2005.10998">doi:10.48550/arXiv.2005.10998</a>&gt;, which improves the inverse probability weighting by 
    utilizing estimating equations suitable for a specific pre-specified parameter 
    of interest (e.g., the average treatment effects or the average treatment 
    effects on the treated) in propensity score estimation. It includes the 
    covariate balancing propensity score proposed by Imai and Ratkovic (2014) 
    &lt;<a href="https://doi.org/10.1111%2Frssb.12027">doi:10.1111/rssb.12027</a>&gt;, which uses covariate balancing conditions in 
    propensity score estimation. The point estimate of the parameter of interest
    as well as coefficients for propensity score estimation and their 
    uncertainty are produced using the M-estimation. The same functions can be 
    used to estimate average outcomes in missing outcome cases.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>MASS,</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.0</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>hypergeo, testthat</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-07-23 15:05:34 UTC; hkatsumata</td>
</tr>
<tr>
<td>Author:</td>
<td>Hiroto Katsumata [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Hiroto Katsumata &lt;hrt.katsumata@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-07-23 16:00:07 UTC</td>
</tr>
</table>
<hr>
<h2 id='cbcheck'>Summarize and plot covariate balance</h2><span id='topic+cbcheck'></span>

<h3>Description</h3>

<p>Summarizes and plots covariate balance between treatment and control groups 
before and after the navigated weighting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cbcheck(
  object,
  addcov = NULL,
  standardize = TRUE,
  plot = TRUE,
  absolute = TRUE,
  threshold = 0,
  sort = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cbcheck_+3A_object">object</code></td>
<td>
<p>an object of class “nawt”, usually, a result of a call to <code><a href="#topic+nawt">nawt</a></code>.</p>
</td></tr>
<tr><td><code id="cbcheck_+3A_addcov">addcov</code></td>
<td>
<p>a one-sided formula specifying additional covariates whose 
balance is checked. Covariates containing NAs are automatically dropped.</p>
</td></tr>
<tr><td><code id="cbcheck_+3A_standardize">standardize</code></td>
<td>
<p>a logical value indicating whether weighted mean 
differences are standardized or not.</p>
</td></tr>
<tr><td><code id="cbcheck_+3A_plot">plot</code></td>
<td>
<p>a logical value indicating whether a covariate balance plot is
displayed.</p>
</td></tr>
<tr><td><code id="cbcheck_+3A_absolute">absolute</code></td>
<td>
<p>a logical value indicating whether the absolute values of 
differences in weighted means are used in the covariate balance plot.</p>
</td></tr>
<tr><td><code id="cbcheck_+3A_threshold">threshold</code></td>
<td>
<p>an optional numeric vector used as threshold markers in the 
covariate balance plot.</p>
</td></tr>
<tr><td><code id="cbcheck_+3A_sort">sort</code></td>
<td>
<p>a logical value indicating whether covariates in the covariate 
balance plot are sorted by the values of differences in the weighted means 
before the navigated weighting.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Position of the legend is determined internally.
</p>


<h3>Value</h3>

<p>A matrix whose rows are the covariates and columns are the 
differences in the (un)standardized weighted mean between the treatment and
control groups before (<code>diff.un</code>) and after (<code>diff.adj</code>) the 
navigated weighting. The standardized weighted mean is the weighted mean 
divided by the standard deviation of the covariate for the target 
population (the treatment group for the average treatment effects on the 
treated estimation and the whole population for the other quantity of 
interest). The differences in the categorical variables are not 
standardized.
</p>


<h3>Author(s)</h3>

<p>Hiroto Katsumata
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulation from Kang and Shafer (2007) and Imai and Ratkovic (2014)
# ATT estimation
# True ATT is 10
tau &lt;- 10
set.seed(12345)
n &lt;- 1000
X &lt;- matrix(rnorm(n * 4, mean = 0, sd = 1), nrow = n, ncol = 4)
prop &lt;- 1 / (1 + exp(X[, 1] - 0.5 * X[, 2] + 0.25 * X[, 3] + 0.1 * X[, 4]))
treat &lt;- rbinom(n, 1, 1 - prop)
y &lt;- 210 + 27.4 * X[, 1] + 13.7 * X[, 2] + 13.7 * X[, 3] + 13.7 * X[, 4] + 
     tau * treat + rnorm(n)
df &lt;- data.frame(X, treat, y)
colnames(df) &lt;- c("x1", "x2", "x3", "x4", "treat", "y")

# A misspecified model
Xmis &lt;- data.frame(x1mis = exp(X[, 1] / 2), 
                   x2mis = X[, 2] * (1 + exp(X[, 1]))^(-1) + 10,
                   x3mis = (X[, 1] * X[, 3] / 25 + 0.6)^3, 
                   x4mis = (X[, 2] + X[, 4] + 20)^2)

# Data frame and a misspecified formula for propensity score estimation
df &lt;- data.frame(df, Xmis)
formula_m &lt;- as.formula(treat ~ x1mis + x2mis + x3mis + x4mis)

# Misspecified propensity score model
# Power weighting function with alpha = 2
fits2m &lt;- nawt(formula = formula_m, outcome = "y", estimand = "ATT", 
               method = "score", data = df, alpha = 2)
cbcheck(fits2m, addcov = ~ x1 + x2 + x3 + x4)

# Covariate balancing weighting function
fitcbm &lt;- nawt(formula = formula_m, outcome = "y", estimand = "ATT", 
               method = "cb", data = df)
cbcheck(fitcbm, addcov = ~ x1 + x2 + x3 + x4)

# Standard logistic regression
fits0m &lt;- nawt(formula = formula_m, outcome = "y", estimand = "ATT", 
               method = "score", data = df, alpha = 0)
cbcheck(fits0m, addcov = ~ x1 + x2 + x3 + x4)

# Display the covariate balance matrix
cb &lt;- cbcheck(fits2m, addcov = ~ x1 + x2 + x3 + x4, plot = FALSE)
cb
</code></pre>

<hr>
<h2 id='LaLonde'>LaLonde data set</h2><span id='topic+LaLonde'></span>

<h3>Description</h3>

<p>Data from the National Supported Work Demonstration Program and 
the Panel Study for Income Dynamics. A benchmark data set, which is
extensively analyzed by LaLonde (1986), Dehejia and Wahba (1999), and Imai
and Ratkovic (2014).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LaLonde
</code></pre>


<h3>Format</h3>

<p>A data frame with 3212 observations and 12 variables.
</p>

<dl>
<dt>exper</dt><dd><p>an indicator for whether the observed unit was in the 
experimental subset</p>
</dd>
<dt>treat</dt><dd><p>an indicator for whether the individual received the treatment</p>
</dd>
<dt>age</dt><dd><p>age in years</p>
</dd>
<dt>educ</dt><dd><p>schooling in years</p>
</dd>
<dt>black</dt><dd><p>an indicator for black</p>
</dd>
<dt>hisp</dt><dd><p>an indicator for Hispanic</p>
</dd>
<dt>married</dt><dd><p>an indicator for marriage status, one for married</p>
</dd>
<dt>nodegr</dt><dd><p>an indicator for no high school degree</p>
</dd>
<dt>re74</dt><dd><p>reported earnings in 1974</p>
</dd>
<dt>re75</dt><dd><p>reported earnings in 1975</p>
</dd>
<dt>re78</dt><dd><p>reported earnings in 1978</p>
</dd>
<dt>re74.miss</dt><dd><p>an indicator for whether the 1974 earnings variable is 
missing</p>
</dd>
</dl>

<p>Data not missing 1974 earnings are the Dehejia-Wahba subsample of the LaLonde
data. Missing values for 1974 earnings set to zero. 1974 and 1975 earnings 
are pre-treatment. 1978 earnings is taken as the outcome variable.
</p>


<h3>Source</h3>

<p>This version of the data is from <code><a href="CBPS.html#topic+LaLonde">LaLonde</a></code> data in <code>CBPS</code> package.
</p>


<h3>References</h3>

<p>Dehejia, Rajeev H., and Sadek Wahba. 1999. &quot;Causal Effects in 
Nonexperimental Studies: Reevaluating the Evaluation of Training Programs.&quot;
Journal of the American Statistical Association 94 (448): 1053&ndash;62.
</p>
<p>Imai, Kosuke and Marc Ratkovic. 2014. &quot;Covariate Balancing 
Propensity Score.&quot; Journal of the Royal Statistical Society, Series B 
(Statistical Methodology) 76 (1): 243&ndash;63.
</p>
<p>LaLonde, Robert J. 1986. &quot;Evaluating the Econometric Evaluations 
of Training Programs with Experimental Data.&quot; American Economic Review 76 
(4): 604&ndash;20.
</p>

<hr>
<h2 id='nawt'>Navigated weighting (NAWT) estimation</h2><span id='topic+nawt'></span>

<h3>Description</h3>

<p><code>nawt</code> estimates a pre-specified parameter of interest (e.g., the 
average treatment effects (ATE) or the average treatment effects on the 
treated (ATT)) with the inverse probability weighting where propensity scores
are estimated using estimating equations suitable for the parameter of 
interest. It includes the covariate balancing propensity score proposed by 
Imai and Ratkovic (2014), which uses covariate balancing conditions in 
propensity score estimation. <code>nawt</code> can also be used to estimate average
outcomes in missing outcome cases.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nawt(
  formula,
  outcome,
  estimand = "ATT",
  method = "score",
  data,
  weights = NULL,
  alpha = 2,
  twostep = TRUE,
  boot = FALSE,
  B = 2000,
  clevel = 0.95,
  message = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="nawt_+3A_formula">formula</code></td>
<td>
<p>an object of class <code><a href="stats.html#topic+formula">formula</a></code> (or one that
can be coerced to that class): a symbolic description of the model to be 
fitted.</p>
</td></tr>
<tr><td><code id="nawt_+3A_outcome">outcome</code></td>
<td>
<p>a character string specifying the name of outcome values
in <code>data</code>.</p>
</td></tr>
<tr><td><code id="nawt_+3A_estimand">estimand</code></td>
<td>
<p>a character string specifying a parameter of interest. Choose
&quot;ATT&quot; for the average treatment effects on the treated estimation, &quot;ATE&quot;
for the average treatment effects estimation, &quot;ATC&quot; for the average 
outcomes estimation in missing outcome cases. You can choose &quot;ATEcombined&quot; 
for the combined estimation for the average treatment effects estimation.</p>
</td></tr>
<tr><td><code id="nawt_+3A_method">method</code></td>
<td>
<p>a character string specifying a type of weighting functions in 
propensity score estimation (<code class="reqn">\omega(\pi)</code>). Choose &quot;score&quot; for a power
function of propensity scores (need to specify the value for alpha), &quot;cb&quot;
for a covariate balancing weighting function, or &quot;both&quot; to use both the
above weighting functions (need to specify the value for alpha).</p>
</td></tr>
<tr><td><code id="nawt_+3A_data">data</code></td>
<td>
<p>a data frame (or one that can be coerced to that class) 
containing the outcomes and the variables in the model.</p>
</td></tr>
<tr><td><code id="nawt_+3A_weights">weights</code></td>
<td>
<p>an optional vector of ‘prior weights’ (e.g. sampling weights)
to be used in the fitting process. Should be NULL or a numeric vector.</p>
</td></tr>
<tr><td><code id="nawt_+3A_alpha">alpha</code></td>
<td>
<p>a positive value for an exponent in a power weighting function
(<code class="reqn">\omega(\pi) = \pi^\alpha</code>, in the ATT estimation, for example).
Default is 2. Set to 0 to use the standard logistic regression for  
propensity score estimation. Note that <code>nawt</code> with alpha being one of the
pre-specified values (0, 0.5, 1, ..., 5) runs substantially faster than 
with any other values, and the latter case requires <code>hypergeo</code> package.</p>
</td></tr>
<tr><td><code id="nawt_+3A_twostep">twostep</code></td>
<td>
<p>a logical value indicating whether to use a two-step estimator
when <code>method = "both"</code>. Default is <code>TRUE</code>. Set to <code>FALSE</code> 
to use a continuously-updating GMM estimator, which is substantially
computationally intensive.</p>
</td></tr>
<tr><td><code id="nawt_+3A_boot">boot</code></td>
<td>
<p>a logical value indicating whether to use a non-parametric 
bootstrapping method to estimate the variance-covariance matrix and 
confidence intervals for parameters. Default is <code>FALSE</code>. Set to 
<code>FALSE</code> to use a sandwich-type asymptotic covariance estimator.</p>
</td></tr>
<tr><td><code id="nawt_+3A_b">B</code></td>
<td>
<p>the number of bootstrap replicates. Default is 2,000.</p>
</td></tr>
<tr><td><code id="nawt_+3A_clevel">clevel</code></td>
<td>
<p>confidence level. Default is 0.95.</p>
</td></tr>
<tr><td><code id="nawt_+3A_message">message</code></td>
<td>
<p>a logical value indicating whether messages are shown or not.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The treatment variable (or, missingness variable in missing outcome cases) 
must be binary and coded as 0 (for controlled or non-missing observations)
or 1 (for treated or missing observations).
</p>
<p>When the data frame has incomplete cases, which have NAs for either of 
the treatment variable, explanatory variables for propensity score 
estimation, or the outcome variable, <code>nawt</code> conducts listwise deletion.
Returned values (e.g., <code>weights</code>, <code>ps</code>, <code>data</code>) do not contain
values for these deleted cases.
</p>
<p>The parameter of interest is estimated by the Hajek estimator, where inverse
probability weights are standardized to sum to 1 within each treatment group 
after being calculated as <code class="reqn">t_i / \pi_i - (1 - t_i) / (1 - \pi_i)</code> for the
ATE estimation, <code class="reqn">(t_i - \pi_i) / (1 - \pi_i)</code> for the ATT estimation,
<code class="reqn">(t_i - \pi_i) / \pi_i</code> for the ATC estimation, and
<code class="reqn">(1 - t_i) / (1 - \pi_i)</code> for the missing outcome cases.
</p>
<p>For the ATE estimation, it is recommended to specify the <code>estimand</code> as
<code>"ATE"</code> but you may specify it as <code>"ATEcombined"</code>. The former utilizes 
the separated estimation whereas the latter utilizes the combined estimation,
and the former should produce smaller biases and variances. Note that the 
former estimates two propensity scores for each observation by estimating two 
propensity score functions with different estimating equations.
</p>
<p>When a two-step estimator is used in <code>nawt</code> with <code>method = "both"</code>,
<code>scratio</code> (<code class="reqn">r</code>) is calculated in the first step. <code>scratio</code> is a
ratio of accuracy in propensity score estimation in the NAWT with a power 
weighting function with a specified <code>alpha</code> to that with a covariate balancing
weighting function. It determines the mixture weight in the second step, like
the weighting matrix in the two-step over-identified GMM estimation, where 
weighted estimating equations of those with the power weighting function and 
the covariate balancing function is used. This mixture weight is proportional 
to the <code>scratio</code> (e.g., <code class="reqn">\omega(\pi) = r \pi^\alpha + (1 - r) / (1 - \pi)</code>, 
in the ATT estimation).
</p>
<p>Since the NAWT utilizes weighted estimating equations in propensity score 
estimation, it may sometimes become unstable especially when only a few 
observations have extremely large weights in propensity score estimation.
<code>nawt</code> generates a warning when the effective sample size for propensity 
score estimation is smaller than a quarter of the effective sample size with
the initial weights. In that case, carefully look at the estimated 
coefficients to check whether the estimation fails or not and <code><a href="#topic+cbcheck">cbcheck</a></code>
will be helpful.
</p>


<h3>Value</h3>

<p><code>nawt</code> returns an object of class inheriting from &quot;nawt&quot;. 
</p>
<p>The function summary (i.e., <code><a href="#topic+summary.nawt">summary.nawt</a></code>) can be used to obtain or print a 
summary of the results.
</p>
<p>An object of class &quot;nawt&quot; is a list containing the following components:
</p>
<table role = "presentation">
<tr><td><code>est</code></td>
<td>
<p>the point estimate of the parameter of interest.</p>
</td></tr>
<tr><td><code>weights</code></td>
<td>
<p>the estimated inverse probability weights.</p>
</td></tr>
<tr><td><code>ps</code></td>
<td>
<p>the estimated propensity scores. A matrix of two sets of the 
estimated propensity scores is returned when <code>estimand = "ATE"</code>.</p>
</td></tr>
<tr><td><code>coefficients</code></td>
<td>
<p>a named vector of coefficients. A matrix of two sets of
coefficients for two sets of propensity scores is returned when 
<code>estimand = "ATE"</code>.</p>
</td></tr>
<tr><td><code>varcov</code></td>
<td>
<p>the variance-covariance matrix of the coefficients and 
parameter of interest.</p>
</td></tr>
<tr><td><code>converged</code></td>
<td>
<p>logical. Was the algorithm judged to have converged?</p>
</td></tr>
<tr><td><code>naive_weights</code></td>
<td>
<p>the estimated inverse probability weights with the 
standard logistic regression for the propensity score estimation.</p>
</td></tr>
<tr><td><code>naive_coef</code></td>
<td>
<p>a named vector of coefficients with the standard logistic 
regression for the propensity score estimation.</p>
</td></tr>
<tr><td><code>scratio</code></td>
<td>
<p>an optimal ratio of the covariate balancing weighting function
to the power weighting function in taking the weighted average weights for
the weighted score conditions when <code>method = "both"</code> and <code>twostep = TRUE</code>. 
A vector of length two for two propensity score estimation is returned when
<code>estimand = "ATE"</code>.</p>
</td></tr>
<tr><td><code>estimand</code></td>
<td>
<p>the parameter of interest specified.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>the method specified.</p>
</td></tr>
<tr><td><code>outcome</code></td>
<td>
<p>the outcome vector.</p>
</td></tr>
<tr><td><code>alpha</code></td>
<td>
<p>alpha specified.</p>
</td></tr>
<tr><td><code>names.x</code></td>
<td>
<p>names of the explanatory variables in propensity score 
estimation.</p>
</td></tr>
<tr><td><code>prior.weights</code></td>
<td>
<p>the weights initially supplied, a vector of 1s if none
were.</p>
</td></tr>
<tr><td><code>treat</code></td>
<td>
<p>the treatment vector. The missingness vector when the missing
outcome cases.</p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>a matrix of the confidence intervals for the parameter of interest.</p>
</td></tr>
<tr><td><code>omega</code></td>
<td>
<p>a vector of weights for the weighted score conditions (<code class="reqn">\omega</code>).
A matrix of two sets of omega is returned when <code>estimand = "ATE"</code>.</p>
</td></tr>
<tr><td><code>effN_ps</code></td>
<td>
<p>the effective sample size for the propensity score estimation.
A vector of length two for two propensity score estimation is returned when 
<code>estimand = "ATE"</code>.</p>
</td></tr>
<tr><td><code>effN_est</code></td>
<td>
<p>the effective sample size for the parameter of interest
estimation.</p>
</td></tr>
<tr><td><code>effN_original</code></td>
<td>
<p>the effective sample size with the initial weights.</p>
</td></tr>
<tr><td><code>formula</code></td>
<td>
<p>formula specified.</p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p>the matched call.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>the data argument.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Hiroto Katsumata
</p>


<h3>References</h3>

<p>Imai, Kosuke and Marc Ratkovic. 2014. &quot;Covariate Balancing 
Propensity Score.&quot; Journal of the Royal Statistical Society, Series B 
(Statistical Methodology) 76 (1): 243&ndash;63.
</p>
<p>Christian Fong, Marc Ratkovic and Kosuke Imai (2019). CBPS: Covariate
Balancing Propensity Score. R package version 0.21.
https://CRAN.R-project.org/package=CBPS
</p>
<p>Katsumata, Hiroto. 2020. &quot;Navigated Weighting to Improve Inverse
Probability Weighting for Missing Data Problems and Causal Inference.&quot;
arXiv preprint arXiv:2005.10998.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+summary.nawt">summary.nawt</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulation from Kang and Shafer (2007) and Imai and Ratkovic (2014)
# ATT estimation
# True ATT is 10
tau &lt;- 10
set.seed(12345)
n &lt;- 1000
X &lt;- matrix(rnorm(n * 4, mean = 0, sd = 1), nrow = n, ncol = 4)
prop &lt;- 1 / (1 + exp(X[, 1] - 0.5 * X[, 2] + 0.25 * X[, 3] + 0.1 * X[, 4]))
treat &lt;- rbinom(n, 1, prop)
y &lt;- 210 + 27.4 * X[, 1] + 13.7 * X[, 2] + 13.7 * X[, 3] + 13.7 * X[, 4] + 
     tau * treat + rnorm(n)
df &lt;- data.frame(X, treat, y)
colnames(df) &lt;- c("x1", "x2", "x3", "x4", "treat", "y")

# A misspecified model
Xmis &lt;- data.frame(x1mis = exp(X[, 1] / 2), 
                   x2mis = X[, 2] * (1 + exp(X[, 1]))^(-1) + 10,
                   x3mis = (X[, 1] * X[, 3] / 25 + 0.6)^3, 
                   x4mis = (X[, 2] + X[, 4] + 20)^2)

# Data frame and formulas for propensity score estimation
df &lt;- data.frame(df, Xmis)
formula_c &lt;- as.formula(treat ~ x1 + x2 + x3 + x4)
formula_m &lt;- as.formula(treat ~ x1mis + x2mis + x3mis + x4mis)

# Correct propensity score model
# Power weighting function with alpha = 2
fits2c &lt;- nawt(formula = formula_c, outcome = "y", estimand = "ATT", 
               method = "score", data = df, alpha = 2)
summary(fits2c)

# Covariate balancing weighting function
fitcbc &lt;- nawt(formula = formula_c, outcome = "y", estimand = "ATT", 
               method = "cb", data = df)
summary(fitcbc)

# Standard logistic regression
fits0c &lt;- nawt(formula = formula_c, outcome = "y", estimand = "ATT", 
               method = "score", data = df, alpha = 0)
summary(fits0c)

# Misspecified propensity score model
# Power weighting function with alpha = 2
fits2m &lt;- nawt(formula = formula_m, outcome = "y", estimand = "ATT", 
               method = "score", data = df, alpha = 2)
summary(fits2m)

# Covariate balancing weighting function
fitcbm &lt;- nawt(formula = formula_m, outcome = "y", estimand = "ATT", 
               method = "cb", data = df)
summary(fitcbm)

# Standard logistic regression
fits0m &lt;- nawt(formula = formula_m, outcome = "y", estimand = "ATT", 
               method = "score", data = df, alpha = 0)
summary(fits0m)


# Empirical example
# Load the LaLonde data
data(LaLonde)
formula_l &lt;- as.formula("exper ~ age + I(age^2) + educ + I(educ^2) + 
                         black + hisp + married + nodegr +
                         I(re75 / 1000) + I(re75 == 0) + I(re74 / 1000)")

# Experimental benchmark
mean(subset(LaLonde, exper == 1 &amp; treat == 1)$re78) -
  mean(subset(LaLonde, exper == 1 &amp; treat == 0)$re78)

# Power weighting function with alpha = 2
fits2l &lt;- nawt(formula = formula_l, estimand = "ATT", method = "score",
               outcome = "re78", data = LaLonde, alpha = 2)
mean(subset(LaLonde, exper == 1 &amp; treat == 1)$re78) -
  with(LaLonde, sum((1 - exper) * re78 * fits2l$weights) / 
                sum((1 - exper) * fits2l$weights))

# Covariate balancing weighting function
fitcbl &lt;- nawt(formula = formula_l, estimand = "ATT", method = "cb",
               outcome = "re78", data = LaLonde)
mean(subset(LaLonde, exper == 1 &amp; treat == 1)$re78) -
  with(LaLonde, sum((1 - exper) * re78 * fitcbl$weights) / 
                sum((1 - exper) * fitcbl$weights))

# Standard logistic regression
fits0l &lt;- nawt(formula = formula_l, estimand = "ATT", method = "score",
               outcome = "re78", data = LaLonde, alpha = 0)
mean(subset(LaLonde, exper == 1 &amp; treat == 1)$re78) -
  with(LaLonde, sum((1 - exper) * re78 * fits0l$weights) / 
                sum((1 - exper) * fits0l$weights))
</code></pre>

<hr>
<h2 id='plot_omega'>Plot weights for propensity score estimation in the navigated weighting</h2><span id='topic+plot_omega'></span>

<h3>Description</h3>

<p>Plots weight of each observation in the score condition <code class="reqn">\omega(\pi)</code> for
propensity score estimation and estimated propensity score distribution 
in the navigated weighting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_omega(object, relative = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_omega_+3A_object">object</code></td>
<td>
<p>an object of class “nawt”, usually, a result of a call to <code><a href="#topic+nawt">nawt</a></code>.
Note that it cannot be used when the <code>object</code> is a result of a call to
<code>nawt</code> where <code>method = "both"</code> and <code>twostep = FALSE</code>.</p>
</td></tr>
<tr><td><code id="plot_omega_+3A_relative">relative</code></td>
<td>
<p>a logical value indicating whether or not relative weights 
standardized to have mean one are shown.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The x-axis shows estimated propensity scores, and the y-axis shows weight of 
each observation in propensity score estimation. When <code>estimand = "ATE"</code>,
the navigated weighting estimates two propensity scores for each observation;
one for estimating the average of the potential outcomes with treatment and  
the other for estimating the average of the potential outcomes without 
treatment. Therefore, there are two weighting functions for estimating two 
sets of propensity scores and two propensity score distributions. Points 
rising to the right and a solid curve represent the weighting functions and 
distribution of propensity scores for estimating the average of the potential
outcomes without treatment whereas points rising to the left and a dashed 
curve represent the weighting functions and distribution of propensity scores
for estimating the average of the potential outcomes with treatment.
</p>
<p>Position of the legend is determined internally.
</p>


<h3>Value</h3>

<p>No retrun value, called for side effects.
</p>


<h3>Author(s)</h3>

<p>Hiroto Katsumata
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulation from Kang and Shafer (2007) and Imai and Ratkovic (2014)
tau &lt;- 10
set.seed(12345)
n &lt;- 1000
X &lt;- matrix(rnorm(n * 4, mean = 0, sd = 1), nrow = n, ncol = 4)
prop &lt;- 1 / (1 + exp(X[, 1] - 0.5 * X[, 2] + 0.25 * X[, 3] + 0.1 * X[, 4]))
treat &lt;- rbinom(n, 1, prop)
y &lt;- 210 + 27.4 * X[, 1] + 13.7 * X[, 2] + 13.7 * X[, 3] + 13.7 * X[, 4] + 
     tau * treat + rnorm(n)

# Data frame and formulas for propensity score estimation
df &lt;- data.frame(X, treat, y)
colnames(df) &lt;- c("x1", "x2", "x3", "x4", "treat", "y")
formula_c &lt;- as.formula(treat ~ x1 + x2 + x3 + x4)

# Power weighting function with alpha = 2
# ATT estimation
fitatt &lt;- nawt(formula = formula_c, outcome = "y", estimand = "ATT", 
               method = "score", data = df, alpha = 2)
plot_omega(fitatt)

# ATE estimation
fitate &lt;- nawt(formula = formula_c, outcome = "y", estimand = "ATE", 
               method = "score", data = df, alpha = 2)
plot_omega(fitate)

# Use method = "both"
# Two-step estimation
fitateb2s &lt;- nawt(formula = formula_c, outcome = "y", estimand = "ATE", 
                  method = "both", data = df, alpha = 2, twostep = TRUE)
plot_omega(fitateb2s)

# Continuously-updating GMM estimation
## Not run: 
fitatebco &lt;- nawt(formula = formula_c, outcome = "y", estimand = "ATE", 
                  method = "both", data = df, alpha = 2, twostep = FALSE)
plot_omega(fitatebco) # error
## End(Not run)
</code></pre>

<hr>
<h2 id='plot.nawt'>Plot a scattered plot comparing the navigated weighting and naive estimation</h2><span id='topic+plot.nawt'></span>

<h3>Description</h3>

<p>Plots a scattered plot comparing the resulting inverse probability weights 
estimated by the navigated weighting and the standard logistic regression.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'nawt'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.nawt_+3A_x">x</code></td>
<td>
<p>an object of class “nawt”, usually, a result of a call to <code><a href="#topic+nawt">nawt</a></code>.</p>
</td></tr>
<tr><td><code id="plot.nawt_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed to plot.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The x-axis shows the inverse probability weights estimated by estimating 
propensity scores with the standard logistic regression whereas the y-axis
shows those with the navigated weighting. Excessively heavy weights on only a
few observations in the navigated weighting may indicate the failure of 
the estimation.
</p>
<p>Position of the legend is determined internally.
</p>


<h3>Value</h3>

<p>No retrun value, called for side effects.
</p>


<h3>Author(s)</h3>

<p>Hiroto Katsumata
</p>


<h3>See Also</h3>

<p><code><a href="#topic+nawt">nawt</a></code>, <code><a href="graphics.html#topic+plot">plot</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulation from Kang and Shafer (2007) and Imai and Ratkovic (2014)
tau &lt;- 10
set.seed(12345)
n &lt;- 1000
X &lt;- matrix(rnorm(n * 4, mean = 0, sd = 1), nrow = n, ncol = 4)
prop &lt;- 1 / (1 + exp(X[, 1] - 0.5 * X[, 2] + 0.25 * X[, 3] + 0.1 * X[, 4]))
treat &lt;- rbinom(n, 1, prop)
y &lt;- 210 + 27.4 * X[, 1] + 13.7 * X[, 2] + 13.7 * X[, 3] + 13.7 * X[, 4] + 
     tau * treat + rnorm(n)

# Data frame and formulas for propensity score estimation
df &lt;- data.frame(X, treat, y)
colnames(df) &lt;- c("x1", "x2", "x3", "x4", "treat", "y")
formula_c &lt;- as.formula(treat ~ x1 + x2 + x3 + x4)

# Power weighting function with alpha = 2
# ATT estimation
fitatt &lt;- nawt(formula = formula_c, outcome = "y", estimand = "ATT", 
               method = "score", data = df, alpha = 2)
plot(fitatt)

# ATE estimation
fitate &lt;- nawt(formula = formula_c, outcome = "y", estimand = "ATE", 
               method = "score", data = df, alpha = 2)
plot(fitate)
</code></pre>

<hr>
<h2 id='print.nawt'>Print navigated weighting estimation</h2><span id='topic+print.nawt'></span>

<h3>Description</h3>

<p>Prints a fitted <code>nawt</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'nawt'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.nawt_+3A_x">x</code></td>
<td>
<p>an object of class “nawt”, usually, a result of a call to <code><a href="#topic+nawt">nawt</a></code>.</p>
</td></tr>
<tr><td><code id="print.nawt_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed to print.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No retrun value, called for side effects.
</p>


<h3>Author(s)</h3>

<p>Hiroto Katsumata
</p>


<h3>See Also</h3>

<p><code><a href="#topic+nawt">nawt</a></code>, <code><a href="base.html#topic+print">print</a></code>
</p>

<hr>
<h2 id='summary.nawt'>Summarizing navigated weighting estimation</h2><span id='topic+summary.nawt'></span>

<h3>Description</h3>

<p>Prints a summary of a fitted <code>nawt</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'nawt'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.nawt_+3A_object">object</code></td>
<td>
<p>an object of class “nawt”, usually, a result of a call to <code><a href="#topic+nawt">nawt</a></code>.</p>
</td></tr>
<tr><td><code id="summary.nawt_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed to summary.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Prints a summary of a <code>nawt</code> object, in a format similar to glm.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>call</code></td>
<td>
<p>the matched call.</p>
</td></tr>
<tr><td><code>est</code></td>
<td>
<p>the point estimate of the parameter of interest.</p>
</td></tr>
<tr><td><code>coefficients</code></td>
<td>
<p>a table including coefficients, standard errors, 
z-values, and two-sided p-values.</p>
</td></tr>
<tr><td><code>effN_ps</code></td>
<td>
<p>the effective sample size for the propensity score estimation.</p>
</td></tr>
<tr><td><code>effN_est</code></td>
<td>
<p>the effective sample size for the parameter of interest
estimation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Hiroto Katsumata
</p>


<h3>See Also</h3>

<p><code><a href="#topic+nawt">nawt</a></code>, <code><a href="base.html#topic+summary">summary</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># For examples see example(nawt)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
