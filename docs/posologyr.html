<!DOCTYPE html><html><head><title>Help for package posologyr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {posologyr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#error_model_comb1'><p>Residual error model combined 1</p></a></li>
<li><a href='#error_model_comb2'><p>Residual error model combined 2</p></a></li>
<li><a href='#error_model_mixednm'><p>Residual error model mixed (idem NONMEM)</p></a></li>
<li><a href='#poso_dose_auc'><p>Estimate the optimal dose for a selected target area under the</p>
time-concentration curve (AUC)</a></li>
<li><a href='#poso_dose_conc'><p>Estimate the optimal dose for a selected target concentration</p></a></li>
<li><a href='#poso_estim_map'><p>Estimate the Maximum A Posteriori individual parameters</p></a></li>
<li><a href='#poso_estim_mcmc'><p>Estimate the posterior distribution of individual parameters by MCMC</p></a></li>
<li><a href='#poso_estim_sir'><p>Estimate the posterior distribution of individual parameters by SIR</p></a></li>
<li><a href='#poso_inter_cmin'><p>Estimate the optimal inter-dose interval for a given dose and a</p>
selected target trough concentration</a></li>
<li><a href='#poso_simu_pop'><p>Estimate the prior distribution of population parameters</p></a></li>
<li><a href='#poso_time_cmin'><p>Predict time to a selected trough concentration</p></a></li>
<li><a href='#posologyr_error_lines'><p>This creates the posologyr error lines from a rxui model</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Individual Dose Optimization using Population Pharmacokinetics</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2.4</td>
</tr>
<tr>
<td>Description:</td>
<td>Determine individual pharmacokinetic (and
    pharmacokinetic-pharmacodynamic) profiles and use them to personalise drug
    regimens. You provide the data and a population pharmacokinetic model,
    'posologyr' provides the individual a posteriori estimate and allows you to
    determine the optimal dosing. The empirical Bayes estimates are computed as
    described in Kang et al. (2012) &lt;<a href="https://doi.org/10.4196%2Fkjpp.2012.16.2.97">doi:10.4196/kjpp.2012.16.2.97</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/AGPL-3">AGPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>rxode2, stats, mvtnorm, data.table</td>
</tr>
<tr>
<td>Suggests:</td>
<td>lotri, knitr, rmarkdown, testthat (&ge; 3.0.0), ggplot2,
magrittr, tidyr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://levenc.github.io/posologyr/">https://levenc.github.io/posologyr/</a>,
<a href="https://github.com/levenc/posologyr">https://github.com/levenc/posologyr</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/levenc/posologyr/issues">https://github.com/levenc/posologyr/issues</a></td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-09 11:27:50 UTC; cyril</td>
</tr>
<tr>
<td>Author:</td>
<td>Cyril Leven <a href="https://orcid.org/0000-0002-0697-4370"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre, cph],
  Matthew nfidler <a href="https://orcid.org/0000-0001-8538-6691"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Emmanuelle Comets [ctb],
  Audrey Lavenu [ctb],
  Marc Lavielle [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Cyril Leven &lt;cyril.leven@chu-brest.fr&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-02-09 11:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='error_model_comb1'>Residual error model combined 1</h2><span id='topic+error_model_comb1'></span>

<h3>Description</h3>

<p>Residual error model combined 1. Constant error model
if no proportional coefficient is provided. Proportional
error model if no constant (or additive) error
coefficient is provided.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>error_model_comb1(f, sigma)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="error_model_comb1_+3A_f">f</code></td>
<td>
<p>Numeric vector, output of a pharmacokinetic model</p>
</td></tr>
<tr><td><code id="error_model_comb1_+3A_sigma">sigma</code></td>
<td>
<p>Numeric vector of the coefficients for the
residual error model</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Implements the following function:
<code>g &lt;- sigma[1] + sigma[2]*f</code>
</p>


<h3>Value</h3>

<p>Numeric vector, residual error
</p>

<hr>
<h2 id='error_model_comb2'>Residual error model combined 2</h2><span id='topic+error_model_comb2'></span>

<h3>Description</h3>

<p>Residual error model combined 2.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>error_model_comb2(f, sigma)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="error_model_comb2_+3A_f">f</code></td>
<td>
<p>Numeric vector, output of a pharmacokinetic model</p>
</td></tr>
<tr><td><code id="error_model_comb2_+3A_sigma">sigma</code></td>
<td>
<p>Numeric vector of the coefficients for the
residual error model</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Implements the following function:
<code>g &lt;- sqrt(sigma[1]^2 + sigma[2]^2*f^2)</code>
</p>


<h3>Value</h3>

<p>Numeric vector, residual error
</p>

<hr>
<h2 id='error_model_mixednm'>Residual error model mixed (idem NONMEM)</h2><span id='topic+error_model_mixednm'></span>

<h3>Description</h3>

<p>Mixed residual error model, similar to NONMEM implementation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>error_model_mixednm(f, sigma)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="error_model_mixednm_+3A_f">f</code></td>
<td>
<p>Numeric vector, output of a pharmacokinetic model</p>
</td></tr>
<tr><td><code id="error_model_mixednm_+3A_sigma">sigma</code></td>
<td>
<p>Matrix of the coefficients for the
residual error model</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric vector, residual error
</p>

<hr>
<h2 id='poso_dose_auc'>Estimate the optimal dose for a selected target area under the
time-concentration curve (AUC)</h2><span id='topic+poso_dose_auc'></span>

<h3>Description</h3>

<p>Estimates the optimal dose for a selected target area under the
time-concentration curve (AUC) given a population pharmacokinetic
model, a set of individual parameters, and a target AUC.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poso_dose_auc(
  dat = NULL,
  prior_model = NULL,
  tdm = FALSE,
  time_auc,
  time_dose = NULL,
  target_auc,
  estim_method = "map",
  nocb = FALSE,
  p = NULL,
  greater_than = TRUE,
  starting_time = 0,
  interdose_interval = NULL,
  add_dose = NULL,
  duration = 0,
  starting_dose = 100,
  indiv_param = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="poso_dose_auc_+3A_dat">dat</code></td>
<td>
<p>Dataframe. An individual subject dataset following the
structure of NONMEM/rxode2 event records.</p>
</td></tr>
<tr><td><code id="poso_dose_auc_+3A_prior_model">prior_model</code></td>
<td>
<p>A <code>posologyr</code> prior population pharmacokinetics
model, a list of six objects.</p>
</td></tr>
<tr><td><code id="poso_dose_auc_+3A_tdm">tdm</code></td>
<td>
<p>A boolean. If <code>TRUE</code>: estimates the optimal dose for a selected
target auc over a selected duration following the events from <code>dat</code>, and
using Maximum A Posteriori estimation. Setting <code>tdm</code> to <code>TRUE</code> causes the
following to occur:
</p>

<ul>
<li><p> the <code>time_dose</code> argument is required and is used as the starting point
for the AUC calculation instead of <code>starting_time</code>;
</p>
</li>
<li><p> the arguments <code>estim_method</code>, <code>p</code>, <code>greater_than</code>, <code>interdose_interval</code>,
<code>add_dose</code>, <code>indiv_param</code> and <code>starting_time</code> are ignored.
</p>
</li></ul>
</td></tr>
<tr><td><code id="poso_dose_auc_+3A_time_auc">time_auc</code></td>
<td>
<p>Numeric. A duration. The target AUC is computed from
<code>starting_time</code> to <code>starting_time</code> + <code>time_auc</code>.
When <code>tdm</code> is set to <code>TRUE</code> the target AUC is computed from <code>time_dose</code> to
<code>time_dose</code> + <code>time_auc</code> instead.</p>
</td></tr>
<tr><td><code id="poso_dose_auc_+3A_time_dose">time_dose</code></td>
<td>
<p>Numeric. Time when the dose is to be given. Only used and
mandatory, when <code>tdm</code> is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_dose_auc_+3A_target_auc">target_auc</code></td>
<td>
<p>Numeric. The target AUC.</p>
</td></tr>
<tr><td><code id="poso_dose_auc_+3A_estim_method">estim_method</code></td>
<td>
<p>A character string. An estimation method to be used for
the individual parameters. The default method &quot;map&quot; is the Maximum A
Posteriori estimation, the method &quot;prior&quot; simulates from the prior
population model, and &quot;sir&quot; uses the Sequential Importance Resampling
algorithm to estimate the a posteriori distribution of the individual
parameters. This argument is ignored if <code>indiv_param</code> is provided, or if
<code>tdm</code> is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_dose_auc_+3A_nocb">nocb</code></td>
<td>
<p>A boolean. for time-varying covariates: the next observation
carried backward (nocb) interpolation style, similar to NONMEM.  If
<code>FALSE</code>, the last observation carried forward (locf) style will be used.
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="poso_dose_auc_+3A_p">p</code></td>
<td>
<p>Numeric. The proportion of the distribution of AUC to consider for
the optimization. Mandatory for <code>estim_method=sir</code>. This argument is
ignored if <code>tdm</code> is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_dose_auc_+3A_greater_than">greater_than</code></td>
<td>
<p>A boolean. If <code>TRUE</code>: targets a dose leading to a
proportion <code>p</code> of the AUCs to be greater than <code>target_auc</code>. Respectively,
lower if <code>FALSE</code>. This argument is ignored if <code>tdm</code> is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_dose_auc_+3A_starting_time">starting_time</code></td>
<td>
<p>Numeric. First point in time of the AUC, for multiple
dose regimen. The default is zero. This argument is ignored if <code>tdm</code> is
set to <code>TRUE</code>, and <code>time_dose</code> is used as a starting point instead.</p>
</td></tr>
<tr><td><code id="poso_dose_auc_+3A_interdose_interval">interdose_interval</code></td>
<td>
<p>Numeric. Time for the interdose interval for
multiple dose regimen. Must be provided when add_dose is used. This
argument is ignored if <code>tdm</code> is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_dose_auc_+3A_add_dose">add_dose</code></td>
<td>
<p>Numeric. Additional doses administered at inter-dose interval
after the first dose. Optional. This argument is ignored if <code>tdm</code> is set
to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_dose_auc_+3A_duration">duration</code></td>
<td>
<p>Numeric. Duration of infusion, for zero-order
administrations.</p>
</td></tr>
<tr><td><code id="poso_dose_auc_+3A_starting_dose">starting_dose</code></td>
<td>
<p>Numeric. Starting dose for the optimization
algorithm.</p>
</td></tr>
<tr><td><code id="poso_dose_auc_+3A_indiv_param">indiv_param</code></td>
<td>
<p>Optional. A set of individual parameters : THETA,
estimates of ETA, and covariates. This argument is ignored if <code>tdm</code> is
set to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components:
</p>

<dl>
<dt>dose</dt><dd><p>Numeric. An optimal dose for the selected target AUC.</p>
</dd>
<dt>type_of_estimate</dt><dd><p>Character string. The type of estimate of the
individual parameters. Either a point estimate, or a distribution.</p>
</dd>
<dt>auc_estimate</dt><dd><p>A vector of numeric estimates of the AUC. Either a
single value (for a point estimate of ETA), or a distribution.</p>
</dd>
<dt>indiv_param</dt><dd><p>A <code>data.frame</code>. The set of individual parameters used
for the determination of the optimal dose : THETA, estimates of ETA, and
covariates</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>rxode2::setRxThreads(2L) # limit the number of threads

# model
mod_run001 &lt;- list(
ppk_model = rxode2::rxode({
  centr(0) = 0;
  depot(0) = 0;

  TVCl = THETA_Cl;
  TVVc = THETA_Vc;
  TVKa = THETA_Ka;

  Cl = TVCl*exp(ETA_Cl);
  Vc = TVVc*exp(ETA_Vc);
  Ka = TVKa*exp(ETA_Ka);

  K20 = Cl/Vc;
  Cc = centr/Vc;

  d/dt(depot) = -Ka*depot;
  d/dt(centr) = Ka*depot - K20*centr;
  d/dt(AUC) = Cc;
}),
error_model = function(f,sigma) {
  dv &lt;- cbind(f,1)
  g &lt;- diag(dv%*%sigma%*%t(dv))
  return(sqrt(g))
},
theta = c(THETA_Cl=4.0, THETA_Vc=70.0, THETA_Ka=1.0),
omega = lotri::lotri({ETA_Cl + ETA_Vc + ETA_Ka ~
    c(0.2,
      0, 0.2,
      0, 0, 0.2)}),
sigma = lotri::lotri({prop + add ~ c(0.05,0.0,0.00)}))
# df_patient01: event table for Patient01, following a 30 minutes intravenous
# infusion
df_patient01 &lt;- data.frame(ID=1,
                        TIME=c(0.0,1.0,14.0),
                        DV=c(NA,25.0,5.5),
                        AMT=c(2000,0,0),
                        EVID=c(1,0,0),
                        DUR=c(0.5,NA,NA))
# estimate the optimal dose to reach an AUC(0-12h) of 45 h.mg/l
poso_dose_auc(dat=df_patient01,prior_model=mod_run001,
time_auc=12,target_auc=45)

</code></pre>

<hr>
<h2 id='poso_dose_conc'>Estimate the optimal dose for a selected target concentration</h2><span id='topic+poso_dose_conc'></span>

<h3>Description</h3>

<p>Estimates the optimal dose for a selected target concentration at a
selected point in time given a population pharmacokinetic model, a set
of individual parameters, a selected point in time, and a target
concentration.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poso_dose_conc(
  dat = NULL,
  prior_model = NULL,
  tdm = FALSE,
  time_c,
  time_dose = NULL,
  target_conc,
  endpoint = "Cc",
  estim_method = "map",
  nocb = FALSE,
  p = NULL,
  greater_than = TRUE,
  starting_dose = 100,
  interdose_interval = NULL,
  add_dose = NULL,
  duration = 0,
  indiv_param = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="poso_dose_conc_+3A_dat">dat</code></td>
<td>
<p>Dataframe. An individual subject dataset following the
structure of NONMEM/rxode2 event records.</p>
</td></tr>
<tr><td><code id="poso_dose_conc_+3A_prior_model">prior_model</code></td>
<td>
<p>A <code>posologyr</code> prior population pharmacokinetics
model, a list of six objects.</p>
</td></tr>
<tr><td><code id="poso_dose_conc_+3A_tdm">tdm</code></td>
<td>
<p>A boolean. If <code>TRUE</code>: estimates the optimal dose for a selected
target concentration at a selected point in time following the events from
<code>dat</code>, and using Maximum A Posteriori estimation. Setting <code>tdm</code> to <code>TRUE</code> causes the
following to occur:
</p>

<ul>
<li><p> the arguments <code>estim_method</code>, <code>p</code>, <code>greater_than</code>, <code>interdose_interval</code>,
<code>add_dose</code>, <code>indiv_param</code> and <code>starting_time</code> are ignored.
</p>
</li></ul>
</td></tr>
<tr><td><code id="poso_dose_conc_+3A_time_c">time_c</code></td>
<td>
<p>Numeric. Point in time for which the dose is to be
optimized.</p>
</td></tr>
<tr><td><code id="poso_dose_conc_+3A_time_dose">time_dose</code></td>
<td>
<p>Numeric. Time when the dose is to be given.</p>
</td></tr>
<tr><td><code id="poso_dose_conc_+3A_target_conc">target_conc</code></td>
<td>
<p>Numeric. Target concentration.</p>
</td></tr>
<tr><td><code id="poso_dose_conc_+3A_endpoint">endpoint</code></td>
<td>
<p>Character. The endpoint of the prior model to be optimised
for. The default is &quot;Cc&quot;, which is the central concentration.</p>
</td></tr>
<tr><td><code id="poso_dose_conc_+3A_estim_method">estim_method</code></td>
<td>
<p>A character string. An estimation method to be used for
the individual parameters. The default method &quot;map&quot; is the Maximum A
Posteriori estimation, the method &quot;prior&quot; simulates from the prior
population model, and &quot;sir&quot; uses the Sequential Importance Resampling
algorithm to estimate the a posteriori distribution of the individual
parameters. This argument is ignored if <code>indiv_param</code> is provided or if
<code>tdm</code> is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_dose_conc_+3A_nocb">nocb</code></td>
<td>
<p>A boolean. for time-varying covariates: the next observation
carried backward (nocb) interpolation style, similar to NONMEM.  If
<code>FALSE</code>, the last observation carried forward (locf) style will be used.
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="poso_dose_conc_+3A_p">p</code></td>
<td>
<p>Numeric. The proportion of the distribution of concentrations to
consider for the optimization. Mandatory for <code>estim_method=sir</code>. This
argument is ignored if <code>tdm</code> is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_dose_conc_+3A_greater_than">greater_than</code></td>
<td>
<p>A boolean. If <code>TRUE</code>: targets a dose leading to a
proportion <code>p</code> of the concentrations to be greater than <code>target_conc</code>.
Respectively, lower if <code>FALSE</code>. This argument is ignored if <code>tdm</code> is
set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_dose_conc_+3A_starting_dose">starting_dose</code></td>
<td>
<p>Numeric. Starting dose for the optimization
algorithm.</p>
</td></tr>
<tr><td><code id="poso_dose_conc_+3A_interdose_interval">interdose_interval</code></td>
<td>
<p>Numeric. Time for the interdose interval
for multiple dose regimen. Must be provided when add_dose is used. This
argument is ignored if <code>tdm</code> is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_dose_conc_+3A_add_dose">add_dose</code></td>
<td>
<p>Numeric. Additional doses administered at inter-dose interval
after the first dose. Optional. This argument is ignored if <code>tdm</code> is set
to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_dose_conc_+3A_duration">duration</code></td>
<td>
<p>Numeric. Duration of infusion, for zero-order
administrations.</p>
</td></tr>
<tr><td><code id="poso_dose_conc_+3A_indiv_param">indiv_param</code></td>
<td>
<p>Optional. A set of individual parameters : THETA,
estimates of ETA, and covariates. This argument is ignored if <code>tdm</code> is
set to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components:
</p>

<dl>
<dt>dose</dt><dd><p>Numeric. An optimal dose for the selected target
concentration.</p>
</dd>
<dt>type_of_estimate</dt><dd><p>Character string. The type of estimate of the
individual parameters. Either a point estimate, or a distribution.</p>
</dd>
<dt>conc_estimate</dt><dd><p>A vector of numeric estimates of the conc. Either a
single value (for a point estimate of ETA), or a distribution.</p>
</dd>
<dt>indiv_param</dt><dd><p>A <code>data.frame</code>. The set of individual parameters used
for the determination of the optimal dose : THETA, estimates of ETA, and
covariates</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>rxode2::setRxThreads(2L) # limit the number of threads

# model
mod_run001 &lt;- list(
ppk_model = rxode2::rxode({
  centr(0) = 0;
  depot(0) = 0;

  TVCl = THETA_Cl;
  TVVc = THETA_Vc;
  TVKa = THETA_Ka;

  Cl = TVCl*exp(ETA_Cl);
  Vc = TVVc*exp(ETA_Vc);
  Ka = TVKa*exp(ETA_Ka);

  K20 = Cl/Vc;
  Cc = centr/Vc;

  d/dt(depot) = -Ka*depot;
  d/dt(centr) = Ka*depot - K20*centr;
  d/dt(AUC) = Cc;
}),
error_model = function(f,sigma) {
  dv &lt;- cbind(f,1)
  g &lt;- diag(dv%*%sigma%*%t(dv))
  return(sqrt(g))
},
theta = c(THETA_Cl=4.0, THETA_Vc=70.0, THETA_Ka=1.0),
omega = lotri::lotri({ETA_Cl + ETA_Vc + ETA_Ka ~
    c(0.2,
      0, 0.2,
      0, 0, 0.2)}),
sigma = lotri::lotri({prop + add ~ c(0.05,0.0,0.00)}))
# df_patient01: event table for Patient01, following a 30 minutes intravenous
# infusion
df_patient01 &lt;- data.frame(ID=1,
                        TIME=c(0.0,1.0,14.0),
                        DV=c(NA,25.0,5.5),
                        AMT=c(2000,0,0),
                        EVID=c(1,0,0),
                        DUR=c(0.5,NA,NA))
# estimate the optimal dose to reach a concentration of 80 mg/l
# one hour after starting the 30-minutes infusion
poso_dose_conc(dat=df_patient01,prior_model=mod_run001,
time_c=1,duration=0.5,target_conc=80)

</code></pre>

<hr>
<h2 id='poso_estim_map'>Estimate the Maximum A Posteriori individual parameters</h2><span id='topic+poso_estim_map'></span>

<h3>Description</h3>

<p>Estimates the Maximum A Posteriori (MAP) individual parameters,
also known as Empirical Bayes Estimates (EBE).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poso_estim_map(
  dat = NULL,
  prior_model = NULL,
  return_model = TRUE,
  return_ofv = FALSE,
  nocb = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="poso_estim_map_+3A_dat">dat</code></td>
<td>
<p>Dataframe. An individual subject dataset following the
structure of NONMEM/rxode2 event records.</p>
</td></tr>
<tr><td><code id="poso_estim_map_+3A_prior_model">prior_model</code></td>
<td>
<p>A <code>posologyr</code> prior population pharmacokinetics
model, a list of six objects.</p>
</td></tr>
<tr><td><code id="poso_estim_map_+3A_return_model">return_model</code></td>
<td>
<p>A boolean. Returns a rxode2 model using the estimated
ETAs if set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_estim_map_+3A_return_ofv">return_ofv</code></td>
<td>
<p>A boolean. Returns a the Objective Function Value (OFV)
if set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_estim_map_+3A_nocb">nocb</code></td>
<td>
<p>A boolean. for time-varying covariates: the next observation
carried backward (nocb) interpolation style, similar to NONMEM.  If
<code>FALSE</code>, the last observation carried forward (locf) style will be used.
Defaults to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A named list consisting of one or more of the following elements
depending on the input parameters of the function: <code style="white-space: pre;">&#8288;$eta&#8288;</code> a named vector
of the MAP estimates of the individual values of ETA, <code style="white-space: pre;">&#8288;$model&#8288;</code> an rxode2
model using the estimated ETAs, <code style="white-space: pre;">&#8288;$event&#8288;</code> the <code>data.table</code> used to solve the
returned rxode2 model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>rxode2::setRxThreads(1) # limit the number of threads

# model
mod_run001 &lt;- list(
ppk_model = rxode2::rxode({
  centr(0) = 0;
  depot(0) = 0;

  TVCl = THETA_Cl;
  TVVc = THETA_Vc;
  TVKa = THETA_Ka;

  Cl = TVCl*exp(ETA_Cl);
  Vc = TVVc*exp(ETA_Vc);
  Ka = TVKa*exp(ETA_Ka);

  K20 = Cl/Vc;
  Cc = centr/Vc;

  d/dt(depot) = -Ka*depot;
  d/dt(centr) = Ka*depot - K20*centr;
  d/dt(AUC) = Cc;
}),
error_model = function(f,sigma) {
  dv &lt;- cbind(f,1)
  g &lt;- diag(dv%*%sigma%*%t(dv))
  return(sqrt(g))
},
theta = c(THETA_Cl=4.0, THETA_Vc=70.0, THETA_Ka=1.0),
omega = lotri::lotri({ETA_Cl + ETA_Vc + ETA_Ka ~
    c(0.2,
      0, 0.2,
      0, 0, 0.2)}),
sigma = lotri::lotri({prop + add ~ c(0.05,0.0,0.00)}))
# df_patient01: event table for Patient01, following a 30 minutes intravenous
# infusion
df_patient01 &lt;- data.frame(ID=1,
                        TIME=c(0.0,1.0,14.0),
                        DV=c(NA,25.0,5.5),
                        AMT=c(2000,0,0),
                        EVID=c(1,0,0),
                        DUR=c(0.5,NA,NA))
# estimate the Maximum A Posteriori individual parameters
poso_estim_map(dat=df_patient01,prior_model=mod_run001)

</code></pre>

<hr>
<h2 id='poso_estim_mcmc'>Estimate the posterior distribution of individual parameters by MCMC</h2><span id='topic+poso_estim_mcmc'></span>

<h3>Description</h3>

<p>Estimates the posterior distribution of individual parameters by Markov
Chain Monte Carlo (using a Metropolis-Hastings algorithm)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poso_estim_mcmc(
  dat = NULL,
  prior_model = NULL,
  return_model = TRUE,
  burn_in = 50,
  n_iter = 1000,
  n_chains = 4,
  nocb = FALSE,
  control = list(n_kernel = c(2, 2, 2), stepsize_rw = 0.4, proba_mcmc = 0.3, nb_max = 3)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="poso_estim_mcmc_+3A_dat">dat</code></td>
<td>
<p>Dataframe. An individual subject dataset following the
structure of NONMEM/rxode2 event records.</p>
</td></tr>
<tr><td><code id="poso_estim_mcmc_+3A_prior_model">prior_model</code></td>
<td>
<p>A <code>posologyr</code> prior population pharmacokinetics
model, a list of six objects.</p>
</td></tr>
<tr><td><code id="poso_estim_mcmc_+3A_return_model">return_model</code></td>
<td>
<p>A boolean. Returns a rxode2 model using the estimated
ETAs if set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_estim_mcmc_+3A_burn_in">burn_in</code></td>
<td>
<p>Number of burn-in iterations for the Metropolis-Hastings
algorithm.</p>
</td></tr>
<tr><td><code id="poso_estim_mcmc_+3A_n_iter">n_iter</code></td>
<td>
<p>Total number of iterations (following the burn-in iterations)
for each Markov chain of the Metropolis-Hastings algorithm.</p>
</td></tr>
<tr><td><code id="poso_estim_mcmc_+3A_n_chains">n_chains</code></td>
<td>
<p>Number of Markov chains</p>
</td></tr>
<tr><td><code id="poso_estim_mcmc_+3A_nocb">nocb</code></td>
<td>
<p>A boolean. for time-varying covariates: the next observation
carried backward (nocb) interpolation style, similar to NONMEM.  If
<code>FALSE</code>, the last observation carried forward (locf) style will be used.
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="poso_estim_mcmc_+3A_control">control</code></td>
<td>
<p>A list of parameters controlling the Metropolis-Hastings
algorithm.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>return_model</code> is set to <code>FALSE</code>, a list of one element: a
dataframe <code style="white-space: pre;">&#8288;$eta&#8288;</code> of ETAs from the posterior distribution, estimated by
Markov Chain Monte Carlo.
If <code>return_model</code> is set to <code>TRUE</code>, a list of the dataframe of the posterior
distribution of ETA, and a rxode2 model using the estimated distributions of
ETAs.
</p>


<h3>Author(s)</h3>

<p>Emmanuelle Comets, Audrey Lavenu, Marc Lavielle, Cyril Leven
</p>


<h3>References</h3>

<p>Comets  E, Lavenu A, Lavielle M. Parameter estimation in
nonlinear mixed effect models using saemix, an R implementation of the SAEM
algorithm. Journal of Statistical Software 80, 3 (2017), 1-41.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># model
mod_run001 &lt;- list(
ppk_model = rxode2::rxode({
  centr(0) = 0;
  depot(0) = 0;

  TVCl = THETA_Cl;
  TVVc = THETA_Vc;
  TVKa = THETA_Ka;

  Cl = TVCl*exp(ETA_Cl);
  Vc = TVVc*exp(ETA_Vc);
  Ka = TVKa*exp(ETA_Ka);

  K20 = Cl/Vc;
  Cc = centr/Vc;

  d/dt(depot) = -Ka*depot;
  d/dt(centr) = Ka*depot - K20*centr;
  d/dt(AUC) = Cc;
}),
error_model = function(f,sigma) {
  dv &lt;- cbind(f,1)
  g &lt;- diag(dv%*%sigma%*%t(dv))
  return(sqrt(g))
},
theta = c(THETA_Cl=4.0, THETA_Vc=70.0, THETA_Ka=1.0),
omega = lotri::lotri({ETA_Cl + ETA_Vc + ETA_Ka ~
    c(0.2,
      0, 0.2,
      0, 0, 0.2)}),
sigma = lotri::lotri({prop + add ~ c(0.05,0.0,0.00)}))
# df_patient01: event table for Patient01, following a 30 minutes intravenous
# infusion
df_patient01 &lt;- data.frame(ID=1,
                        TIME=c(0.0,1.0,14.0),
                        DV=c(NA,25.0,5.5),
                        AMT=c(2000,0,0),
                        EVID=c(1,0,0),
                        DUR=c(0.5,NA,NA))
# estimate the posterior distribution of population parameters
poso_estim_mcmc(dat=df_patient01,prior_model=mod_run001,
n_iter=50,n_chains=2)

</code></pre>

<hr>
<h2 id='poso_estim_sir'>Estimate the posterior distribution of individual parameters by SIR</h2><span id='topic+poso_estim_sir'></span>

<h3>Description</h3>

<p>Estimates the posterior distribution of individual parameters by
Sequential Importance Resampling (SIR)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poso_estim_sir(
  dat = NULL,
  prior_model = NULL,
  n_sample = 10000,
  n_resample = 1000,
  return_model = TRUE,
  nocb = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="poso_estim_sir_+3A_dat">dat</code></td>
<td>
<p>Dataframe. An individual subject dataset following the
structure of NONMEM/rxode2 event records.</p>
</td></tr>
<tr><td><code id="poso_estim_sir_+3A_prior_model">prior_model</code></td>
<td>
<p>A <code>posologyr</code> prior population pharmacokinetics
model, a list of six objects.</p>
</td></tr>
<tr><td><code id="poso_estim_sir_+3A_n_sample">n_sample</code></td>
<td>
<p>Number of samples from the S-step</p>
</td></tr>
<tr><td><code id="poso_estim_sir_+3A_n_resample">n_resample</code></td>
<td>
<p>Number of samples from the R-step</p>
</td></tr>
<tr><td><code id="poso_estim_sir_+3A_return_model">return_model</code></td>
<td>
<p>A boolean. Returns a rxode2 model using the estimated
ETAs if set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_estim_sir_+3A_nocb">nocb</code></td>
<td>
<p>A boolean. for time-varying covariates: the next observation
carried backward (nocb) interpolation style, similar to NONMEM.  If
<code>FALSE</code>, the last observation carried forward (locf) style will be used.
Defaults to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>return_model</code> is set to <code>FALSE</code>, a list of one element: a
dataframe <code style="white-space: pre;">&#8288;$eta&#8288;</code> of ETAs from the posterior distribution, estimated by
Sequential Importance Resampling.
If <code>return_model</code> is set to <code>TRUE</code>, a list of the dataframe of the posterior
distribution of ETA, and a rxode2 model using the estimated distributions of
ETAs.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># model
mod_run001 &lt;- list(
ppk_model = rxode2::rxode({
  centr(0) = 0;
  depot(0) = 0;

  TVCl = THETA_Cl;
  TVVc = THETA_Vc;
  TVKa = THETA_Ka;

  Cl = TVCl*exp(ETA_Cl);
  Vc = TVVc*exp(ETA_Vc);
  Ka = TVKa*exp(ETA_Ka);

  K20 = Cl/Vc;
  Cc = centr/Vc;

  d/dt(depot) = -Ka*depot;
  d/dt(centr) = Ka*depot - K20*centr;
  d/dt(AUC) = Cc;
}),
error_model = function(f,sigma) {
  dv &lt;- cbind(f,1)
  g &lt;- diag(dv%*%sigma%*%t(dv))
  return(sqrt(g))
},
theta = c(THETA_Cl=4.0, THETA_Vc=70.0, THETA_Ka=1.0),
omega = lotri::lotri({ETA_Cl + ETA_Vc + ETA_Ka ~
    c(0.2,
      0, 0.2,
      0, 0, 0.2)}),
sigma = lotri::lotri({prop + add ~ c(0.05,0.0,0.00)}))
# df_patient01: event table for Patient01, following a 30 minutes intravenous
# infusion
df_patient01 &lt;- data.frame(ID=1,
                        TIME=c(0.0,1.0,14.0),
                        DV=c(NA,25.0,5.5),
                        AMT=c(2000,0,0),
                        EVID=c(1,0,0),
                        DUR=c(0.5,NA,NA))
# estimate the posterior distribution of population parameters
poso_estim_sir(dat=df_patient01,prior_model=mod_run001,
n_sample=1e3,n_resample=1e2)

</code></pre>

<hr>
<h2 id='poso_inter_cmin'>Estimate the optimal inter-dose interval for a given dose and a
selected target trough concentration</h2><span id='topic+poso_inter_cmin'></span>

<h3>Description</h3>

<p>Estimates the optimal inter-dose interval for a selected target
trough concentration (Cmin), given a dose, a population
pharmacokinetic model, a set of individual parameters, and a
target concentration.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poso_inter_cmin(
  dat = NULL,
  prior_model = NULL,
  dose,
  target_cmin,
  endpoint = "Cc",
  estim_method = "map",
  nocb = FALSE,
  p = NULL,
  greater_than = TRUE,
  starting_interval = 12,
  add_dose = 10,
  duration = 0,
  indiv_param = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="poso_inter_cmin_+3A_dat">dat</code></td>
<td>
<p>Dataframe. An individual subject dataset following the
structure of NONMEM/rxode2 event records.</p>
</td></tr>
<tr><td><code id="poso_inter_cmin_+3A_prior_model">prior_model</code></td>
<td>
<p>A <code>posologyr</code> prior population pharmacokinetics
model, a list of six objects.</p>
</td></tr>
<tr><td><code id="poso_inter_cmin_+3A_dose">dose</code></td>
<td>
<p>Numeric. The dose given.</p>
</td></tr>
<tr><td><code id="poso_inter_cmin_+3A_target_cmin">target_cmin</code></td>
<td>
<p>Numeric. Target trough concentration (Cmin).</p>
</td></tr>
<tr><td><code id="poso_inter_cmin_+3A_endpoint">endpoint</code></td>
<td>
<p>Character. The endpoint of the prior model to be optimised
for. The default is &quot;Cc&quot;, which is the central concentration.</p>
</td></tr>
<tr><td><code id="poso_inter_cmin_+3A_estim_method">estim_method</code></td>
<td>
<p>A character string. An estimation method to be used for
the individual parameters. The default method &quot;map&quot; is the Maximum A
Posteriori estimation, the method &quot;prior&quot; simulates from the prior
population model, and &quot;sir&quot; uses the Sequential Importance Resampling
algorithm to estimate the a posteriori distribution of the individual
parameters. This argument is ignored if <code>indiv_param</code> is provided.</p>
</td></tr>
<tr><td><code id="poso_inter_cmin_+3A_nocb">nocb</code></td>
<td>
<p>A boolean. for time-varying covariates: the next observation
carried backward (nocb) interpolation style, similar to NONMEM.  If
<code>FALSE</code>, the last observation carried forward (locf) style will be used.
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="poso_inter_cmin_+3A_p">p</code></td>
<td>
<p>Numeric. The proportion of the distribution of concentrations to
consider for the optimization. Mandatory for <code>estim_method=sir</code>.</p>
</td></tr>
<tr><td><code id="poso_inter_cmin_+3A_greater_than">greater_than</code></td>
<td>
<p>A boolean. If <code>TRUE</code>: targets a dose leading to a
proportion <code>p</code> of the concentrations to be greater than <code>target_conc</code>.
Respectively, lower if <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="poso_inter_cmin_+3A_starting_interval">starting_interval</code></td>
<td>
<p>Numeric. Starting inter-dose interval for
the optimization algorithm.</p>
</td></tr>
<tr><td><code id="poso_inter_cmin_+3A_add_dose">add_dose</code></td>
<td>
<p>Numeric. Additional doses administered at
inter-dose interval after the first dose.</p>
</td></tr>
<tr><td><code id="poso_inter_cmin_+3A_duration">duration</code></td>
<td>
<p>Numeric. Duration of infusion, for zero-order
administrations.</p>
</td></tr>
<tr><td><code id="poso_inter_cmin_+3A_indiv_param">indiv_param</code></td>
<td>
<p>Optional. A set of individual parameters : THETA,
estimates of ETA, and covariates.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components:
</p>

<dl>
<dt>interval</dt><dd><p>Numeric. An inter-dose interval to reach the target trough
concentration before each dosing of a multiple dose regimen.</p>
</dd>
<dt>type_of_estimate</dt><dd><p>Character string. The type of estimate of the
individual parameters. Either a point estimate, or a distribution.</p>
</dd>
<dt>conc_estimate</dt><dd><p>A vector of numeric estimates of the conc. Either a
single value (for a point estimate of ETA), or a distribution.</p>
</dd>
<dt>indiv_param</dt><dd><p>A <code>data.frame</code>. The set of individual parameters used
for the determination of the optimal dose : THETA, estimates of ETA, and
covariates</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>rxode2::setRxThreads(2L) # limit the number of threads

# model
mod_run001 &lt;- list(
ppk_model = rxode2::rxode({
  centr(0) = 0;
  depot(0) = 0;

  TVCl = THETA_Cl;
  TVVc = THETA_Vc;
  TVKa = THETA_Ka;

  Cl = TVCl*exp(ETA_Cl);
  Vc = TVVc*exp(ETA_Vc);
  Ka = TVKa*exp(ETA_Ka);

  K20 = Cl/Vc;
  Cc = centr/Vc;

  d/dt(depot) = -Ka*depot;
  d/dt(centr) = Ka*depot - K20*centr;
  d/dt(AUC) = Cc;
}),
error_model = function(f,sigma) {
  dv &lt;- cbind(f,1)
  g &lt;- diag(dv%*%sigma%*%t(dv))
  return(sqrt(g))
},
theta = c(THETA_Cl=4.0, THETA_Vc=70.0, THETA_Ka=1.0),
omega = lotri::lotri({ETA_Cl + ETA_Vc + ETA_Ka ~
    c(0.2,
      0, 0.2,
      0, 0, 0.2)}),
sigma = lotri::lotri({prop + add ~ c(0.05,0.0,0.00)}))
# df_patient01: event table for Patient01, following a 30 minutes intravenous
# infusion
df_patient01 &lt;- data.frame(ID=1,
                        TIME=c(0.0,1.0,14.0),
                        DV=c(NA,25.0,5.5),
                        AMT=c(2000,0,0),
                        EVID=c(1,0,0),
                        DUR=c(0.5,NA,NA))
# estimate the optimal interval to reach a cmin of of 2.5 mg/l
# before each administration
poso_inter_cmin(dat=df_patient01,prior_model=mod_run001,
dose=1500,duration=0.5,target_cmin=2.5)

</code></pre>

<hr>
<h2 id='poso_simu_pop'>Estimate the prior distribution of population parameters</h2><span id='topic+poso_simu_pop'></span>

<h3>Description</h3>

<p>Estimates the prior distribution of population parameters by Monte Carlo
simulations
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poso_simu_pop(
  dat = NULL,
  prior_model = NULL,
  n_simul = 1000,
  return_model = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="poso_simu_pop_+3A_dat">dat</code></td>
<td>
<p>Dataframe. An individual subject dataset following the
structure of NONMEM/rxode2 event records.</p>
</td></tr>
<tr><td><code id="poso_simu_pop_+3A_prior_model">prior_model</code></td>
<td>
<p>A <code>posologyr</code> prior population pharmacokinetics
model, a list of six objects.</p>
</td></tr>
<tr><td><code id="poso_simu_pop_+3A_n_simul">n_simul</code></td>
<td>
<p>An integer, the number of simulations to be run. For <code>n_simul =0</code>, all ETAs are set to 0.</p>
</td></tr>
<tr><td><code id="poso_simu_pop_+3A_return_model">return_model</code></td>
<td>
<p>A boolean. Returns a rxode2 model using the simulated
ETAs if set to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>return_model</code> is set to <code>FALSE</code>, a list of one element: a
dataframe <code style="white-space: pre;">&#8288;$eta&#8288;</code> of the individual values of ETA.
If <code>return_model</code> is set to <code>TRUE</code>, a list of the dataframe of the
individual values of ETA, and a rxode2 model using the simulated ETAs.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># model
mod_run001 &lt;- list(
ppk_model = rxode2::rxode({
  centr(0) = 0;
  depot(0) = 0;

  TVCl = THETA_Cl;
  TVVc = THETA_Vc;
  TVKa = THETA_Ka;

  Cl = TVCl*exp(ETA_Cl);
  Vc = TVVc*exp(ETA_Vc);
  Ka = TVKa*exp(ETA_Ka);

  K20 = Cl/Vc;
  Cc = centr/Vc;

  d/dt(depot) = -Ka*depot;
  d/dt(centr) = Ka*depot - K20*centr;
  d/dt(AUC) = Cc;
}),
error_model = function(f,sigma) {
  dv &lt;- cbind(f,1)
  g &lt;- diag(dv%*%sigma%*%t(dv))
  return(sqrt(g))
},
theta = c(THETA_Cl=4.0, THETA_Vc=70.0, THETA_Ka=1.0),
omega = lotri::lotri({ETA_Cl + ETA_Vc + ETA_Ka ~
    c(0.2,
      0, 0.2,
      0, 0, 0.2)}),
sigma = lotri::lotri({prop + add ~ c(0.05,0.0,0.00)}))
# df_patient01: event table for Patient01, following a 30 minutes intravenous
# infusion
df_patient01 &lt;- data.frame(ID=1,
                        TIME=c(0.0,1.0,14.0),
                        DV=c(NA,25.0,5.5),
                        AMT=c(2000,0,0),
                        EVID=c(1,0,0),
                        DUR=c(0.5,NA,NA))
# estimate the prior distribution of population parameters
poso_simu_pop(dat=df_patient01,prior_model=mod_run001,n_simul=100)

</code></pre>

<hr>
<h2 id='poso_time_cmin'>Predict time to a selected trough concentration</h2><span id='topic+poso_time_cmin'></span>

<h3>Description</h3>

<p>Predicts the time needed to reach a selected trough concentration
(Cmin) given a population pharmacokinetic model, a set of individual
parameters, a dose, and a target Cmin.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poso_time_cmin(
  dat = NULL,
  prior_model = NULL,
  tdm = FALSE,
  target_cmin,
  dose = NULL,
  endpoint = "Cc",
  estim_method = "map",
  nocb = FALSE,
  p = NULL,
  greater_than = TRUE,
  from = 0.2,
  last_time = 72,
  add_dose = NULL,
  interdose_interval = NULL,
  duration = 0,
  indiv_param = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="poso_time_cmin_+3A_dat">dat</code></td>
<td>
<p>Dataframe. An individual subject dataset following the
structure of NONMEM/rxode2 event records.</p>
</td></tr>
<tr><td><code id="poso_time_cmin_+3A_prior_model">prior_model</code></td>
<td>
<p>A <code>posologyr</code> prior population pharmacokinetics
model, a list of six objects.</p>
</td></tr>
<tr><td><code id="poso_time_cmin_+3A_tdm">tdm</code></td>
<td>
<p>A boolean. If <code>TRUE</code>: computes the predicted time to reach the
target trough concentration (Cmin) following the last event from <code>dat</code>,
and using Maximum A Posteriori estimation. Setting <code>tdm</code> to <code>TRUE</code> causes
the following to occur:
</p>

<ul>
<li><p> the simulation  starts at the time of the last recorded dose (from the
TDM data) plus <code>from</code>;
</p>
</li>
<li><p> the simulation stops at the time of the last recorded dose (from the TDM
data) plus <code>last_time</code>;
</p>
</li>
<li><p> the arguments <code>dose</code>, <code>duration</code>, <code>estim_method</code>, <code>p</code>, <code>greater_than</code>,
<code>interdose_interval</code>, <code>add_dose</code>, <code>indiv_param</code> and <code>starting_time</code> are
ignored.
</p>
</li></ul>
</td></tr>
<tr><td><code id="poso_time_cmin_+3A_target_cmin">target_cmin</code></td>
<td>
<p>Numeric. Target trough concentration (Cmin).</p>
</td></tr>
<tr><td><code id="poso_time_cmin_+3A_dose">dose</code></td>
<td>
<p>Numeric. Dose administered. This argument is ignored if <code>tdm</code> is
set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_time_cmin_+3A_endpoint">endpoint</code></td>
<td>
<p>Character. The endpoint of the prior model to be optimised
for. The default is &quot;Cc&quot;, which is the central concentration.</p>
</td></tr>
<tr><td><code id="poso_time_cmin_+3A_estim_method">estim_method</code></td>
<td>
<p>A character string. An estimation method to be used for
the individual parameters. The default method &quot;map&quot; is the Maximum A
Posteriori estimation, the method &quot;prior&quot; simulates from the prior
population model, and &quot;sir&quot; uses the Sequential Importance Resampling
algorithm to estimate the a posteriori distribution of the individual
parameters. This argument is ignored if <code>indiv_param</code> is provided, or if
<code>tdm</code> is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_time_cmin_+3A_nocb">nocb</code></td>
<td>
<p>A boolean. For time-varying covariates: the next observation
carried backward (nocb) interpolation style, similar to NONMEM. If
<code>FALSE</code>, the last observation carried forward (locf) style will be used.
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="poso_time_cmin_+3A_p">p</code></td>
<td>
<p>Numeric. The proportion of the distribution of Cmin to consider for
the estimation. Mandatory for <code>estim_method=sir</code>. This argument is ignored
if <code>tdm</code> is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_time_cmin_+3A_greater_than">greater_than</code></td>
<td>
<p>A boolean. If <code>TRUE</code>: targets a time leading to a
proportion <code>p</code> of the cmins to be greater than <code>target_cmin</code>.
Respectively, lower if <code>FALSE</code>. This argument is ignored if <code>tdm</code> is set
to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_time_cmin_+3A_from">from</code></td>
<td>
<p>Numeric. Starting time for the simulation of the individual
time-concentration profile. The default value is 0.2. When <code>tdm</code> is set
to <code>TRUE</code> the simulation starts at the time of the last recorded dose plus
<code>from</code>.</p>
</td></tr>
<tr><td><code id="poso_time_cmin_+3A_last_time">last_time</code></td>
<td>
<p>Numeric. Ending time for the simulation of the individual
time-concentration profile. The default value is 72. When <code>tdm</code> is set to
<code>TRUE</code> the simulation stops at the time of the last recorded dose plus
<code>last_time</code>.</p>
</td></tr>
<tr><td><code id="poso_time_cmin_+3A_add_dose">add_dose</code></td>
<td>
<p>Numeric. Additional doses administered at inter-dose interval
after the first dose. Optional. This argument is ignored if <code>tdm</code> is
set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_time_cmin_+3A_interdose_interval">interdose_interval</code></td>
<td>
<p>Numeric. Time for the inter-dose interval for
multiple dose regimen. Must be provided when add_dose is used. This
argument is ignored if <code>tdm</code> is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_time_cmin_+3A_duration">duration</code></td>
<td>
<p>Numeric. Duration of infusion, for zero-order
administrations. This argument is ignored if <code>tdm</code> is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="poso_time_cmin_+3A_indiv_param">indiv_param</code></td>
<td>
<p>Optional. A set of individual parameters : THETA,
estimates of ETA, and covariates.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components:
</p>

<dl>
<dt>time</dt><dd><p>Numeric. Time needed to reach the selected Cmin.</p>
</dd>
<dt>type_of_estimate</dt><dd><p>Character string. The type of estimate of the
individual parameters. Either a point estimate, or a distribution.</p>
</dd>
<dt>cmin_estimate</dt><dd><p>A vector of numeric estimates of the Cmin. Either a
single value (for a point estimate of ETA), or a distribution.</p>
</dd>
<dt>indiv_param</dt><dd><p>A <code>data.frame</code>. The set of individual parameters used
for the determination of the time needed to reach a selected Cmin: THETA,
estimates of ETA, and covariates</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>rxode2::setRxThreads(2L) # limit the number of threads

# model
mod_run001 &lt;- list(
ppk_model = rxode2::rxode({
  centr(0) = 0;
  depot(0) = 0;

  TVCl = THETA_Cl;
  TVVc = THETA_Vc;
  TVKa = THETA_Ka;

  Cl = TVCl*exp(ETA_Cl);
  Vc = TVVc*exp(ETA_Vc);
  Ka = TVKa*exp(ETA_Ka);

  K20 = Cl/Vc;
  Cc = centr/Vc;

  d/dt(depot) = -Ka*depot;
  d/dt(centr) = Ka*depot - K20*centr;
  d/dt(AUC) = Cc;
}),
error_model = function(f,sigma) {
  dv &lt;- cbind(f,1)
  g &lt;- diag(dv%*%sigma%*%t(dv))
  return(sqrt(g))
},
theta = c(THETA_Cl=4.0, THETA_Vc=70.0, THETA_Ka=1.0),
omega = lotri::lotri({ETA_Cl + ETA_Vc + ETA_Ka ~
    c(0.2,
      0, 0.2,
      0, 0, 0.2)}),
sigma = lotri::lotri({prop + add ~ c(0.05,0.0,0.00)}))
# df_patient01: event table for Patient01, following a 30 minutes intravenous
# infusion
df_patient01 &lt;- data.frame(ID=1,
                        TIME=c(0.0,1.0,14.0),
                        DV=c(NA,25.0,5.5),
                        AMT=c(2000,0,0),
                        EVID=c(1,0,0),
                        DUR=c(0.5,NA,NA))
# predict the time needed to reach a concentration of 2.5 mg/l
# after the administration of a 2500 mg dose over a 30 minutes
# infusion
poso_time_cmin(dat=df_patient01,prior_model=mod_run001,
dose=2500,duration=0.5,from=0.5,target_cmin=2.5)

</code></pre>

<hr>
<h2 id='posologyr_error_lines'>This creates the posologyr error lines from a rxui model</h2><span id='topic+posologyr_error_lines'></span><span id='topic+posologyr_error_lines.norm'></span><span id='topic+posologyr_error_lines.t'></span><span id='topic+posologyr_error_lines.default'></span><span id='topic+posologyr_error_lines.rxUi'></span>

<h3>Description</h3>

<p>This creates the posologyr error lines from a rxui model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>posologyr_error_lines(line)

## S3 method for class 'norm'
posologyr_error_lines(line)

## S3 method for class 't'
posologyr_error_lines(line)

## Default S3 method:
posologyr_error_lines(line)

## S3 method for class 'rxUi'
posologyr_error_lines(line)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="posologyr_error_lines_+3A_line">line</code></td>
<td>
<p>line to parse</p>
</td></tr>
</table>


<h3>Value</h3>

<p>error lines for posology
</p>


<h3>Author(s)</h3>

<p>Matthew L. Fidler
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
