<!DOCTYPE html><html><head><title>Help for package GoodFibes</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {GoodFibes}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#GoodFibes-package'>
<p>Detection and Reconstruction of Muscle Fibers from diceCT Image Data</p></a></li>
<li><a href='#ant.final'>
<p>Ant muscle fibers finalized</p></a></li>
<li><a href='#ant.raw'>
<p>Raw ant muscle fibers</p></a></li>
<li><a href='#boundary.check'>
<p>Check if muscle fiber is close to boundary of muscle</p></a></li>
<li><a href='#check.overlap'>
<p>Check if muscle fibers are redundant</p></a></li>
<li><a href='#color.scale'>
<p>A simple wrapper to create colors for a continuous variable</p></a></li>
<li><a href='#crop.stack'>
<p>Automated imaging cropping</p></a></li>
<li><a href='#equalize.stack'>
<p>Automated histogram equalization of image state</p></a></li>
<li><a href='#fiber.angle'>
<p><strong>Experimental!</strong> Calculating the orientation of muscle fibers</p></a></li>
<li><a href='#fiber.curve'>
<p>Calculate the relative curvature of muscle fibers</p></a></li>
<li><a href='#fiber.lengths'>
<p>Calculated the length of smoothed muscle fibers</p></a></li>
<li><a href='#fibers.smoothed'>
<p>Smoothing of estimated fiber paths</p></a></li>
<li><a href='#fuse.fibers'>
<p>Fuse incomplete fibers</p></a></li>
<li><a href='#fuse.fibers.auto'>
<p>Automated repeated fusing of fiber paths</p></a></li>
<li><a href='#get.whites'>
<p>An internal function determining grayscale values</p></a></li>
<li><a href='#good.fibes'>
<p>Automated detection of muscle fibers from diceCT scans</p></a></li>
<li><a href='#hemisphere.points'>
<p>Finding end points of possible paths</p></a></li>
<li><a href='#muscle.plot'>
<p>Plot a single muscle fiber</p></a></li>
<li><a href='#muscle.plot.multi'>
<p>Plot multi muscle fibers with a muscle outline</p></a></li>
<li><a href='#muscle.plot.stl'>
<p>Plot and export muscle fibers to stl</p></a></li>
<li><a href='#pointsGenerator'>
<p>Line points generator</p></a></li>
<li><a href='#quality.check'>
<p>Quality testing of possible muscle fibers detected by good.fibes</p></a></li>
<li><a href='#sequencePlot'>
<p>Plot the path of a muscle fiber generated using good.fibes</p></a></li>
<li><a href='#thresholdPlot'>
<p>Plot image from diceCT stack using thresholding</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Detection and Reconstruction of Muscle Fibers from diceCT Image
Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.10</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-08-18</td>
</tr>
<tr>
<td>Description:</td>
<td>Reconstruction of muscle fibers from image stacks using textural analysis. Includes functions for tracking, smoothing, cleaning, plotting and exporting muscle fibers. Also calculates basic fiber properties (e.g., length and curvature).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Depends:</td>
<td>R(&ge; 3.5.0), imager</td>
</tr>
<tr>
<td>Imports:</td>
<td>rgl, stats, graphics, grDevices, concaveman, prodlim, splines2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-08-18 17:34:19 UTC; fount</td>
</tr>
<tr>
<td>Author:</td>
<td>Jessica Arbour <a href="https://orcid.org/0000-0003-4506-158X"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jessica Arbour &lt;jessica.arbour@mtsu.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-08-18 18:02:37 UTC</td>
</tr>
</table>
<hr>
<h2 id='GoodFibes-package'>
Detection and Reconstruction of Muscle Fibers from diceCT Image Data
</h2><span id='topic+GoodFibes-package'></span><span id='topic+GoodFibes'></span>

<h3>Description</h3>

<p>Reconstruction of muscle fibers from image stacks using textural analysis. Includes functions for tracking, smoothing, cleaning, plotting and exporting muscle fibers. Also calculates basic fiber properties (e.g., length and curvature).
</p>


<h3>Details</h3>

<p>The DESCRIPTION file:
</p>

<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> GoodFibes</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Title: </td><td style="text-align: left;"> Detection and Reconstruction of Muscle Fibers from diceCT Image Data</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 0.1.10</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2023-08-18</td>
</tr>
<tr>
 <td style="text-align: left;">
Authors@R: </td><td style="text-align: left;"> 
    person("Jessica", "Arbour", , "jessica.arbour@mtsu.edu", role = c("aut", "cre"),
           comment = c(ORCID = "0000-0003-4506-158X"))</td>
</tr>
<tr>
 <td style="text-align: left;">
Description: </td><td style="text-align: left;"> Reconstruction of muscle fibers from image stacks using textural analysis. Includes functions for tracking, smoothing, cleaning, plotting and exporting muscle fibers. Also calculates basic fiber properties (e.g., length and curvature).</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL (&gt;=2)</td>
</tr>
<tr>
 <td style="text-align: left;">
Depends: </td><td style="text-align: left;"> R(&gt;= 3.5.0), imager</td>
</tr>
<tr>
 <td style="text-align: left;">
Imports: </td><td style="text-align: left;"> rgl, stats, graphics, grDevices, concaveman, prodlim, splines2</td>
</tr>
<tr>
 <td style="text-align: left;">
Author: </td><td style="text-align: left;"> Jessica Arbour [aut, cre] (&lt;https://orcid.org/0000-0003-4506-158X&gt;)</td>
</tr>
<tr>
 <td style="text-align: left;">
Maintainer: </td><td style="text-align: left;"> Jessica Arbour &lt;jessica.arbour@mtsu.edu&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>


<p>Index of help topics:
</p>
<pre>
GoodFibes-package       Detection and Reconstruction of Muscle Fibers
                        from diceCT Image Data
ant.final               Ant muscle fibers finalized
ant.raw                 Raw ant muscle fibers
check.overlap           Check if muscle fibers are redundant
color.scale             A simple wrapper to create colors for a
                        continuous variable
crop.stack              Automated imaging cropping
equalize.stack          Automated histogram equalization of image state
fiber.angle             *Experimental!* Calculating the orientation of
                        muscle fibers
fiber.curve             Calculate the relative curvature of muscle
                        fibers
fiber.lengths           Calculated the length of smoothed muscle fibers
fibers.smoothed         Smoothing of estimated fiber paths
fuse.fibers             Fuse incomplete fibers
fuse.fibers.auto        Automated repeated fusing of fiber paths
good.fibes              Automated detection of muscle fibers from
                        diceCT scans
muscle.plot             Plot a single muscle fiber
muscle.plot.multi       Plot multi muscle fibers with a muscle outline
muscle.plot.stl         Plot and export muscle fibers to stl
pointsGenerator         Line points generator
quality.check           Quality testing of possible muscle fibers
                        detected by good.fibes
sequencePlot            Plot the path of a muscle fiber generated using
                        good.fibes
thresholdPlot           Plot image from diceCT stack using thresholding
</pre>
<p>Functions in this package allow for the reconstruction of muscle fibers from diceCT image stacks. Fibers are detected using textural analysis, smoothed using splines and processed for path quality (grayscale variation). Muscle fibers can be plotted in 3D with or without the overall muscle outline, and the 3D muscle fibers can be exported as an STL file. Basic fiber architecture metrics can be calculated.</p>


<h3>Author(s)</h3>

<p>NA
</p>
<p>Maintainer: NA
</p>


<h3>References</h3>

<p>Arbour, J. In Prep. GoodFibes: an R package for the detection of muscle fibers from diceCT scans.
</p>

<hr>
<h2 id='ant.final'>
Ant muscle fibers finalized
</h2><span id='topic+ant.final'></span>

<h3>Description</h3>

<p>Muscle fibers reconstructed from the mandibular muscle of an ant <em>(Monomorium pharaonis)</em> (post processing).
</p>


<h3>Format</h3>

<p>A list with 198 entries, each representing a muscle fiber reconstructed from an image stack. Each entry contains $fiber.points, the raw reconstructed fiber paths, and $fiber.smoothed, the smoothed paths. 
</p>


<h3>Details</h3>

<p>These fibers were reconstructed using <em>good.fibes</em>, checked for poor fiber paths using <em>quality.check</em>, and had fibers fused and merged using <em>fuse.fibers</em> and <em>check.overlap</em>. Also see &quot;ant.raw&quot; for the initial fiber paths from good.fibes.
</p>


<h3>Source</h3>

<p>Fiber paths were generated from the ant dataset in Katzke et al (2022). Original image files available upon request.
</p>


<h3>References</h3>

<p>Katzke, J., Puchenkov, P., Stark, H., and Economo, E. 2022. A Roadmap to Reconstructing Muscle Architecture from CT Data. <em>Integrative Organismal Biology</em> 4(1): 1-16.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(ant.final)
fl&lt;-fiber.lengths(ant.final, res = 0.000673107, df = 1)


</code></pre>

<hr>
<h2 id='ant.raw'>
Raw ant muscle fibers
</h2><span id='topic+ant.raw'></span>

<h3>Description</h3>

<p>Preliminary muscle fibers detected from the mandibular muscle of an ant <em>(Monomorium pharaonis)</em>. No quality checking or processing.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("ant.raw")</code></pre>


<h3>Format</h3>

<p>A list with 247 entries, each representing a muscle fiber reconstructed from an image stack (dataset available in examples below) and a partial, subsampled stack is available in extdata. Each entry contains $fiber.points, the raw reconstructed fiber paths, and $fiber.smoothed, the smoothed paths. </p>


<h3>Details</h3>

<p>These are the initial possible fibers detected using <code><a href="#topic+good.fibes">good.fibes</a></code>. Also see <em>ant.final</em> for the processed fibers.
</p>


<h3>Source</h3>

<p>Fiber paths were generated from the ant dataset in Katzke et al (2022). Original image files are stored under extdata (and see example).
</p>


<h3>References</h3>

<p>Katzke, J., Puchenkov, P., Stark, H., and Economo, E. 2022. A Roadmap to Reconstructing Muscle Architecture from CT Data. <em>Integrative Organismal Biology</em> 4(1): 1-16.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

data(ant.raw)
fl&lt;-fiber.lengths(ant.raw, res = 0.000673107, df = 1)

#### this downloads the ant dataset image stack to a temp folder
olddir&lt;-getwd()
setwd(tempdir())
download.file(url=
"https://github.com/jessica-arbour/Ant-Muscle-Image-Stack/raw/main/Ant_data.zip",
destfile="antdata.zip")

unzip("antdata.zip")
setwd(paste0(getwd(),"/Ant data"))

setwd(olddir)

</code></pre>

<hr>
<h2 id='boundary.check'>
Check if muscle fiber is close to boundary of muscle</h2><span id='topic+boundary.check'></span>

<h3>Description</h3>

<p>An internal function that uses a concavehull to determine the bounds of the muscle based on grayscale values on each image and determines how many boundary voxels are within a set distance from the selected image point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>boundary.check(images, new.zero.image, new.startx, new.starty, bound.buffer, cutoff)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="boundary.check_+3A_images">images</code></td>
<td>

<p>A vector of image names in the working directory, created using list.files
</p>
</td></tr>
<tr><td><code id="boundary.check_+3A_new.zero.image">new.zero.image</code></td>
<td>

<p>The image plane being considered
</p>
</td></tr>
<tr><td><code id="boundary.check_+3A_new.startx">new.startx</code></td>
<td>

<p>The x coordinate of the considered point
</p>
</td></tr>
<tr><td><code id="boundary.check_+3A_new.starty">new.starty</code></td>
<td>

<p>The y coordinate of the considered point
</p>
</td></tr>
<tr><td><code id="boundary.check_+3A_bound.buffer">bound.buffer</code></td>
<td>

<p>The number of voxels a point can be distant from the boundary
</p>
</td></tr>
<tr><td><code id="boundary.check_+3A_cutoff">cutoff</code></td>
<td>

<p>The grayscale value under which voxels will be treated as black
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For internal use only
</p>


<h3>Value</h3>

<p>The number of boundary voxels within bound.buffer distance of the proposed point.
</p>


<h3>Author(s)</h3>

<p>J. Arbour
</p>

<hr>
<h2 id='check.overlap'>
Check if muscle fibers are redundant</h2><span id='topic+check.overlap'></span>

<h3>Description</h3>

<p>Determines whether muscle fibers are likely to be repeats. The function compares pairs of fibers and determines 1) whether they are within min.vox of each other, and 2) if the average distance between them stays less than min.vox. If so the longer fiber is kept and the redundant fiber is dropped.</p>


<h3>Usage</h3>

<pre><code class='language-R'>check.overlap(fiber.list, min.vox, df = 2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check.overlap_+3A_fiber.list">fiber.list</code></td>
<td>

<p>A list containing elements with $fiber.points. Generated by <code><a href="#topic+good.fibes">good.fibes</a></code>, <code><a href="#topic+fibers.smoothed">fibers.smoothed</a></code>, <code><a href="#topic+quality.check">quality.check</a></code>, or <code><a href="#topic+fuse.fibers">fuse.fibers</a></code>.
</p>
</td></tr>
<tr><td><code id="check.overlap_+3A_min.vox">min.vox</code></td>
<td>

<p>The distance between fibers in voxels (pixels) for fibers to be considered redundant</p>
</td></tr>
<tr><td><code id="check.overlap_+3A_df">df</code></td>
<td>

<p>The degree of curvature for spline interpolation via splines::ns
</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>drop.fibers</code></td>
<td>
<p>the index for the redundant fibers to be removed</p>
</td></tr>
<tr><td><code>overlapping.fibers</code></td>
<td>
<p>a matrix with the compared fibers, the index of which were kept and which were removed in each comparison</p>
</td></tr>
<tr><td><code>fibers.removed</code></td>
<td>
<p>a list with fiber.points with the redundant fibers excluded</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>J. Arbour</p>


<h3>References</h3>

<p>Arbour, J. In Prep. GoodFibes: an R package for the detection of muscle fibers from diceCT scans.</p>


<h3>See Also</h3>

<p><code><a href="#topic+fuse.fibers">fuse.fibers</a></code>,<code><a href="#topic+quality.check">quality.check</a></code>,<code><a href="#topic+good.fibes">good.fibes</a></code>
</p>

<hr>
<h2 id='color.scale'>
A simple wrapper to create colors for a continuous variable</h2><span id='topic+color.scale'></span>

<h3>Description</h3>

<p>For any continuous variable like fiber length, produces a vector that can be used in plotting functions for the <em>col</em> argument. Uses colorRampPalette.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>color.scale(fl, color1, color2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="color.scale_+3A_fl">fl</code></td>
<td>

<p>A numeric vector containing a measurement for each fiber in a fiber list.
</p>
</td></tr>
<tr><td><code id="color.scale_+3A_color1">color1</code></td>
<td>

<p>A character value for the color for small values of the variable
</p>
</td></tr>
<tr><td><code id="color.scale_+3A_color2">color2</code></td>
<td>

<p>A character value for the color for large values of the variable
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector with color values for each fiber</p>


<h3>See Also</h3>

<p><code><a href="#topic+muscle.plot.stl">muscle.plot.stl</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(ant.final)
fl&lt;-fiber.lengths(ant.final, res = 0.000673107, df=1)

cols&lt;-color.scale(fl, "blue", "green")
muscle.plot.stl(ant.final, res = 0.000673107, cols = cols, mirror.axis = TRUE, df=1)

</code></pre>

<hr>
<h2 id='crop.stack'>
Automated imaging cropping
</h2><span id='topic+crop.stack'></span>

<h3>Description</h3>

<p>Automatically crops a stack of png image files to the minimum bounds of non-black values. Or if bounds are supplied can be cropped to the exact size of another stack of images.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>crop.stack(images, bounds = NULL, save.images=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="crop.stack_+3A_images">images</code></td>
<td>

<p>A vector with file names for the image files, can be created with list.files.
</p>
</td></tr>
<tr><td><code id="crop.stack_+3A_bounds">bounds</code></td>
<td>

<p>An optional vector with four values, given as c(xlim, xmax, ylim, ymax). These are printed at the end of the function when cropping is performed automatically.
</p>
</td></tr>
<tr><td><code id="crop.stack_+3A_save.images">save.images</code></td>
<td>

<p>When TRUE, images are saved to the current directory using imager::save.image.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The bounds to be used for cropping. Optionally crops and saves images to working folder.
</p>


<h3>Author(s)</h3>

<p>J. Arbour</p>


<h3>References</h3>

<p>Arbour, J. In Prep. GoodFibes: an R package for the detection of muscle fibers from diceCT scans.</p>


<h3>See Also</h3>

<p><code><a href="#topic+equalize.stack">equalize.stack</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

olddir&lt;-getwd()

#### this downloads the ant dataset image stack
#### if you have it already downloaded you can navigate to that folder
setwd(tempdir())
download.file(url=
"https://github.com/jessica-arbour/Ant-Muscle-Image-Stack/raw/main/Ant_data.zip",
destfile="antdata.zip")

unzip("antdata.zip")
setwd(paste0(getwd(),"/Ant data"))
####

images&lt;-list.files(pattern=".png")

crop.stack(images)

setwd(olddir)




</code></pre>

<hr>
<h2 id='equalize.stack'>
Automated histogram equalization of image state
</h2><span id='topic+equalize.stack'></span>

<h3>Description</h3>

<p>Conducts histogram equalization to adjust the contrast of the image stack. May improve visibility of muscle fibers prior to fiber detection. Optionally automatically save new image stack in working directory.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>equalize.stack(images, n, save.images = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="equalize.stack_+3A_images">images</code></td>
<td>

<p>A vector of png image file names, created using list.files
</p>
</td></tr>
<tr><td><code id="equalize.stack_+3A_n">n</code></td>
<td>

<p>The number of the image in the stack to be equalized and plotted
</p>
</td></tr>
<tr><td><code id="equalize.stack_+3A_save.images">save.images</code></td>
<td>

<p>Should the whole image stack be equalized and plotted?
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Creates a plot and optionally saves an image stack
</p>


<h3>Author(s)</h3>

<p>J. Arbour
</p>


<h3>References</h3>

<p>Arbour, J. In Prep. GoodFibes: an R package for the detection of muscle fibers from diceCT scans</p>


<h3>See Also</h3>

<p><code><a href="#topic+crop.stack">crop.stack</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
olddir&lt;-getwd()

#### this downloads the ant dataset image stack
#### if you have it already downloaded you can navigate to that folder
setwd(tempdir())
download.file(url=
"https://github.com/jessica-arbour/Ant-Muscle-Image-Stack/raw/main/Ant_data.zip",
destfile="antdata.zip")

unzip("antdata.zip")
setwd(paste0(getwd(),"/Ant data"))
####

images&lt;-list.files(pattern=".png")
equalize.stack(images, 100)  


setwd(olddir)

</code></pre>

<hr>
<h2 id='fiber.angle'>
<strong>Experimental!</strong> Calculating the orientation of muscle fibers</h2><span id='topic+fiber.angle'></span>

<h3>Description</h3>

<p>Calculating the angle of individual muscle fibers. Currently this function can only calculate fiber angles around a central axis (x, y or z). Fiber data is centered around the other axes.
</p>
<p>Will eventually include an option for a tendon image stack. Not yet complete</p>


<h3>Usage</h3>

<pre><code class='language-R'>fiber.angle(fib.list, axis, centered = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fiber.angle_+3A_fib.list">fib.list</code></td>
<td>

<p>A list of muscle fiber paths generated by good.fibes or from the various cleaning and processing function (must contain $fiber.points).</p>
</td></tr>
<tr><td><code id="fiber.angle_+3A_axis">axis</code></td>
<td>

<p>The axis around which angles will be calculated as a deviation from 
</p>
</td></tr>
<tr><td><code id="fiber.angle_+3A_centered">centered</code></td>
<td>

<p>Should the data be centered on the other two axes before calculation.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of angles in degrees corresponding to each fiber in the original list</p>


<h3>Note</h3>

<p><strong>NOT TOTALLY VERIFIED YET, USE WITH CAUTION</strong>
</p>


<h3>Author(s)</h3>

<p>J. Arbour
</p>


<h3>References</h3>

<p>Arbour, J. In Prep. GoodFibes: an R package for the detection of muscle fibers from diceCT scans.
</p>
<p>Katzke, J., Puchenkov, P., Stark, H., and Economo, E. 2022. A Roadmap to Reconstructing Muscle Architecture from CT Data. <em>Integrative Organismal Biology</em> 4(1): 1-16.
</p>
<p>Sullivan, S., McGechie, F., Middleton, K., and Holliday, C. 3D Muscle Architecture of the Pectoral Muscles of European Starling (Sturnus vulgaris).<em>Integrative Organismal Biology</em> 1(1):1-18.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fiber.lengths">fiber.lengths</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

olddir&lt;-getwd()

data(ant.final)
fangle&lt;-fiber.angle(ant.final,3)
fangle

cols&lt;-color.scale(fangle, "blue", "red")
muscle.plot.stl(ant.final, cols=cols, df = 1)

setwd(olddir)

</code></pre>

<hr>
<h2 id='fiber.curve'>
Calculate the relative curvature of muscle fibers
</h2><span id='topic+fiber.curve'></span>

<h3>Description</h3>

<p>Calculates a metric for fiber curvature. This is the ratio between the total length of the curved smoothed fiber, to the straight line distance between the end points of the fiber. A straight fiber will have a curvature value of ~ 1 (small differences may be due to the calculation of fiber length across a smoothed curve), and values &gt; 1 represent more curvature.
</p>
<p>Optionally identified which fibers show unusual curvature (are outliers), for possible removal.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fiber.curve(fib.list, df, check = TRUE, length.out=500)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fiber.curve_+3A_fib.list">fib.list</code></td>
<td>

<p>A list of fibers containing $fiber.points. Produced by good.fibes or the various cleaning functions (quality check, fuse.fibers, check.overlap)</p>
</td></tr>
<tr><td><code id="fiber.curve_+3A_df">df</code></td>
<td>

<p>Corresponds to the df argument in splines2::nsp. Determines the shape of the smoothing spline (df = 1 represents straight muscle fibers)</p>
</td></tr>
<tr><td><code id="fiber.curve_+3A_check">check</code></td>
<td>

<p>Should unusually curved fibers be identified?</p>
</td></tr>
<tr><td><code id="fiber.curve_+3A_length.out">length.out</code></td>
<td>

<p>The number of straight line segments that the smoothed curve will be divided into for calculation of length
</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>curvature</code></td>
<td>
<p>The ratio of fiber length to end-to-end length</p>
</td></tr>
<tr><td><code>problem.fibers</code></td>
<td>
<p>Fibers with unusually high curvature. Given as the index of these fibers in the original list.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>J. Arbour
</p>


<h3>References</h3>

<p>Arbour, J. In Prep. GoodFibes: an R package for the detection of muscle fibers from diceCT scans.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fiber.lengths">fiber.lengths</a></code>,<code><a href="#topic+fiber.angle">fiber.angle</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(ant.final)

fcr&lt;-fiber.curve(ant.final,df=2,check=TRUE) 
#fibers reconstructed with a curve here merely to demonstrate function
#ant fibers were fairly straight

sort(fcr$curvature) 
#all fibers are close to 1 even with a "curved" reconstruction
</code></pre>

<hr>
<h2 id='fiber.lengths'>
Calculated the length of smoothed muscle fibers</h2><span id='topic+fiber.lengths'></span>

<h3>Description</h3>

<p>Determines the length of reconstructed and smoothed muscle fibers. Fibers are smoothed using splines::ns and then oversampled (length.out). The sum of all straight line segments on the smoothed paths is taken as the overall fiber length</p>


<h3>Usage</h3>

<pre><code class='language-R'>fiber.lengths(fib.list, res = NULL, df = 2, length.out = 500)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fiber.lengths_+3A_fib.list">fib.list</code></td>
<td>

<p>A list of fibers containing $fiber.points. Produced by good.fibes or the various cleaning functions (quality check, fuse.fibers, check.overlap)</p>
</td></tr>
<tr><td><code id="fiber.lengths_+3A_res">res</code></td>
<td>

<p>The resolution of the isometric voxels (i.e., the distance between images). Should be given as a linear measure (e.g., mm, um)</p>
</td></tr>
<tr><td><code id="fiber.lengths_+3A_df">df</code></td>
<td>

<p>The degrees of freedom passed to splines2::nsp. A df = 1 produces a straight fiber, while values &gt;1 allow fibers to curve.</p>
</td></tr>
<tr><td><code id="fiber.lengths_+3A_length.out">length.out</code></td>
<td>

<p>The number of straight line segments that the smoothed curve will be divided into for calculation of length
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector with fiber lengths
</p>


<h3>Author(s)</h3>

<p>J. Arbour</p>


<h3>References</h3>

<p>Arbour, J. In Prep. GoodFibes: an R package for the detection of muscle fibers from diceCT scans.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fiber.angle">fiber.angle</a></code>,<code><a href="#topic+fiber.curve">fiber.curve</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(ant.final)


fl&lt;-fiber.lengths(ant.final, res = 0.000673107, df=1)
mean(fl)

</code></pre>

<hr>
<h2 id='fibers.smoothed'>
Smoothing of estimated fiber paths</h2><span id='topic+fibers.smoothed'></span>

<h3>Description</h3>

<p>Applies splines to smooth the stepwise fiber paths produced by good.fibes, with the function <em>ns</em> from <strong>splines</strong>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fibers.smoothed(fib.list, df)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fibers.smoothed_+3A_fib.list">fib.list</code></td>
<td>

<p>A list of fibers with $fiber.points, produced by <code><a href="#topic+good.fibes">good.fibes</a></code> or one of the cleaning and processing functions (e.g., fuse.fibers).
</p>
</td></tr>
<tr><td><code id="fibers.smoothed_+3A_df">df</code></td>
<td>

<p>The degrees of freedom passed to splines2::nsp. Knots equal to df - 1 - intercept are set as breakpoints in the spline curve. A straight line path has a df of 1.
</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>fiber.points</code></td>
<td>
<p>The original fiber path from good.fibes</p>
</td></tr>
<tr><td><code>fiber.smoothed</code></td>
<td>
<p>The curved, smoothed fiber paths</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>J. Arbour</p>


<h3>References</h3>

<p>Arbour, J. In Prep. GoodFibes: an R package for the detection of muscle fibers from diceCT scans.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+good.fibes">good.fibes</a></code>
</p>

<hr>
<h2 id='fuse.fibers'>
Fuse incomplete fibers</h2><span id='topic+fuse.fibers'></span>

<h3>Description</h3>

<p>This function compares fibers that pass between a minimum number of voxels and determines if merging them into a single fiber produces a well supported path</p>


<h3>Usage</h3>

<pre><code class='language-R'>fuse.fibers(fiber.list, min.vox, min.improvement = 0.25, df = 2, length.out = 100)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fuse.fibers_+3A_fiber.list">fiber.list</code></td>
<td>

<p>A list of fibers with $fiber.points produced by good.fibes or any of the processing and cleaning functions.
</p>
</td></tr>
<tr><td><code id="fuse.fibers_+3A_min.vox">min.vox</code></td>
<td>

<p>The voxel distance below which fibers will be compared. Should be &lt;= the voxel width of the muscle fascicles, though lower if interstital spaces are low.
</p>
</td></tr>
<tr><td><code id="fuse.fibers_+3A_min.improvement">min.improvement</code></td>
<td>

<p>The minimum increase (as a proportion) in fiber length for fibers to be worth merging.
</p>
</td></tr>
<tr><td><code id="fuse.fibers_+3A_df">df</code></td>
<td>

<p>The df to be used in smoothing fiber paths in the calculation of fiber length
</p>
</td></tr>
<tr><td><code id="fuse.fibers_+3A_length.out">length.out</code></td>
<td>

<p>The number of divisions to be used in the calculation of fiber lengths (line segments)
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function compares pairs of fibers if they come within mix.vox of each other along their path. The fibers will be merged if 1) the mean 3D residual from the new spline through the combined fiber path is less than the mean residual from the two separate fiber paths, and 2) the fiber length of the combined fiber is at least min.improvement (proportionately) greater than the previous fiber lengths.
</p>


<h3>Value</h3>

<table>
<tr><td><code>merged.fibers</code></td>
<td>
<p>A list of fibers with $fiber.points, with fibers combined based on above thresholds</p>
</td></tr>
<tr><td><code>fibers.to.merge</code></td>
<td>
<p>a matrix of pairs of fibers that were merged</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>J. Arbour
</p>


<h3>References</h3>

<p>Arbour, J. In Prep. GoodFibes: an R package for the detection of muscle fibers from diceCT scans
</p>


<h3>See Also</h3>

<p><code><a href="#topic+quality.check">quality.check</a></code>, <code><a href="#topic+check.overlap">check.overlap</a></code>
</p>

<hr>
<h2 id='fuse.fibers.auto'>
Automated repeated fusing of fiber paths</h2><span id='topic+fuse.fibers.auto'></span>

<h3>Description</h3>

<p>This function repeatedly compares pairs of muscle fibers for fusing. Repeated applications of fuse.fibers until no further fibers can be merged</p>


<h3>Usage</h3>

<pre><code class='language-R'>fuse.fibers.auto(fiber.list, min.vox, min.improvement = 0.25, 
df = 2, length.out = 50, max.iter = 10, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fuse.fibers.auto_+3A_fiber.list">fiber.list</code></td>
<td>

<p>A list of fibers with $fiber.points produced by good.fibes or any of the processing and cleaning functions.
</p>
</td></tr>
<tr><td><code id="fuse.fibers.auto_+3A_min.vox">min.vox</code></td>
<td>

<p>The voxel distance below which fibers will be compared. Should be &lt;= the voxel width of the muscle fascicles, though lower if interstital spaces are low.
</p>
</td></tr>
<tr><td><code id="fuse.fibers.auto_+3A_min.improvement">min.improvement</code></td>
<td>

<p>The minimum increase (as a proportion) in fiber length for fibers to be worth merging.
</p>
</td></tr>
<tr><td><code id="fuse.fibers.auto_+3A_df">df</code></td>
<td>

<p>The df to be used in smoothing fiber paths in the calculation of fiber length
</p>
</td></tr>
<tr><td><code id="fuse.fibers.auto_+3A_length.out">length.out</code></td>
<td>

<p>The number of divisions to be used in the calculation of fiber lengths (line segments)
</p>
</td></tr>
<tr><td><code id="fuse.fibers.auto_+3A_max.iter">max.iter</code></td>
<td>

<p>The maximum number of iterations of fuse.fibers that will be attempted.
</p>
</td></tr>
<tr><td><code id="fuse.fibers.auto_+3A_verbose">verbose</code></td>
<td>

<p>Should the number of iterations through the function be displayed while running?
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of fibers with $fiber.points
</p>


<h3>Author(s)</h3>

<p>J. Arbour
</p>


<h3>References</h3>

<p>Arbour, J. In Prep. GoodFibes: an R package for the detection of muscle fibers from diceCT scans
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fuse.fibers">fuse.fibers</a></code>
</p>

<hr>
<h2 id='get.whites'>
An internal function determining grayscale values</h2><span id='topic+get.whites'></span>

<h3>Description</h3>

<p>Used internally in good.fibes to determine grayscale values along all possible line paths
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.whites(imglist, lpl, depth, backstep = 0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get.whites_+3A_imglist">imglist</code></td>
<td>

<p>The current images being considered
</p>
</td></tr>
<tr><td><code id="get.whites_+3A_lpl">lpl</code></td>
<td>

<p>generated by points.generator to find the position of all possible paths
</p>
</td></tr>
<tr><td><code id="get.whites_+3A_depth">depth</code></td>
<td>

<p>radius + 1 from good.fibes
</p>
</td></tr>
<tr><td><code id="get.whites_+3A_backstep">backstep</code></td>
<td>

<p>How many images to consider &quot;behind&quot; the plane of the zero.image. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>for internal use in good.fibes only</strong>
</p>


<h3>Value</h3>

<p>A matrix of grayscale values &gt; cutoff
</p>

<hr>
<h2 id='good.fibes'>
Automated detection of muscle fibers from diceCT scans
</h2><span id='topic+good.fibes'></span>

<h3>Description</h3>

<p>The function good.fibes uses textural analysis to determine the path of muscle fibers/fascicles through an image stack from a iodine contrast CT scan. Fiber paths are reconstructed using a stepwise algorithm that follows paths of low variation in threshold values. See details for full description of the method
</p>
<p><strong>SOMETIMES ABORTS RSTUDIO BUT STILL RUNS IN R-GUI, PROBLEM IS ONLY IN RSTUDIO</strong>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>good.fibes(images, zero.image, radius, threshold = NULL, 
cutoff, scaler = 1, blackcut = 0.95, seeds = 1, show.plot = TRUE, 
start.seed = NULL, allowed.black = 0, bound.buffer = 0, backstep = 0, verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="good.fibes_+3A_images">images</code></td>
<td>

<p>A character vector with image names representing the image stack from a diceCT scan. The voxels are assumed to be isometric, and the images should be in .png format. The vector can be produced using list.files(pattern = &quot;.png&quot;)
</p>
</td></tr>
<tr><td><code id="good.fibes_+3A_zero.image">zero.image</code></td>
<td>

<p>The number of the image in the stack from which seed points should be drawn. Only one image can be selected.
</p>
</td></tr>
<tr><td><code id="good.fibes_+3A_radius">radius</code></td>
<td>

<p>The number of images to consider forward or backward from the zero.image at each step of the walk. Maximum 11.
</p>
</td></tr>
<tr><td><code id="good.fibes_+3A_threshold">threshold</code></td>
<td>

<p>The grayscale value below which voxels will be considered black for the selection of seed points. Must be equal to or greater than cutoff</p>
</td></tr>
<tr><td><code id="good.fibes_+3A_cutoff">cutoff</code></td>
<td>

<p>The grayscale value below which voxels will be considered black in the forwards and backwards walk. Use <code><a href="#topic+thresholdPlot">thresholdPlot</a></code> to determine a value that isolates muscle voxels from other tissues/background noise.
</p>
</td></tr>
<tr><td><code id="good.fibes_+3A_scaler">scaler</code></td>
<td>

<p>Exponential scaler for the trajectory penalization. Default is 1. At a value of 0 there is no trajectory penalization
</p>
</td></tr>
<tr><td><code id="good.fibes_+3A_blackcut">blackcut</code></td>
<td>

<p>A termination condition. If a specified percentage (as proportion, e.g., 0.95) of voxels in the hemisphere of paths are black, the algorithm will terminate. 
</p>
</td></tr>
<tr><td><code id="good.fibes_+3A_seeds">seeds</code></td>
<td>

<p>The number of seed points on the starting image. The seed points will generate a possible fiber path, if a walk is possible (seeds can fail if they are located on noise without possible paths).
</p>
</td></tr>
<tr><td><code id="good.fibes_+3A_show.plot">show.plot</code></td>
<td>

<p>Optionally show the location of the tracker in the image stack at each step
</p>
</td></tr>
<tr><td><code id="good.fibes_+3A_start.seed">start.seed</code></td>
<td>

<p>Optionally applies <em>set.seed</em> in the tracker to make results reproducible from one run to the next. See set.seed for more details.
</p>
</td></tr>
<tr><td><code id="good.fibes_+3A_allowed.black">allowed.black</code></td>
<td>

<p>For noisy datasets, allows this number of voxels with grayscale values below <em>cutoff</em> to be included in the possible paths without terminating the algorithm
</p>
</td></tr>
<tr><td><code id="good.fibes_+3A_bound.buffer">bound.buffer</code></td>
<td>

<p>If a fiber path is within this many voxels distance of the outermost boundary of the muscle, as determined by grayscale values above the <em>cutoff</em>, then the algorithm will terminate the particular path. See details.
</p>
</td></tr>
<tr><td><code id="good.fibes_+3A_backstep">backstep</code></td>
<td>

<p>How many images &quot;behind&quot; the current plane should be considered. Should be kept to low values (1-3). When backstep = 0, only paths ending on images &quot;ahead&quot; of the image plane will be considered. <strong>EXPERIMENTAL</strong>, will create some weird paths. Use only if the muscle fibers definitely arc back through the image stack and perhaps only on image planes close to that point.
</p>
</td></tr>
<tr><td><code id="good.fibes_+3A_verbose">verbose</code></td>
<td>

<p>If TRUE will list the progress through each fiber</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function begins by selecting a set of seed points from the selected image. Grayscale values below <em>threshold</em> are excluded, and the pairwise euclidean distances among all remaining voxels are calculated. Cluster analysis is conducted using <em>hclust</em> and a set of groups equal to <em>seeds</em> are produced using <em>cutree</em>. Voxels within each group are randomly selected.
</p>
<p>From a selected seed voxel, a hemisphere of possible paths is projected, extending <em>radius</em> images from the selected starting image. If <em>backstep</em> is &gt;0, paths within the starting image plane and behind the plane (1 = 1 image behind, 2 = 2 images behind) are also included in the possible paths. <strong>NOTE</strong> backstep is experimental and does cause more circuitous paths, use only if fiber paths reverse direction through the image stack at some point.
</p>
<p>The forward walk from the seed point begins by choosing from the set of possible paths, the one that minimizes the following function.
</p>
<p>diagnostic value = scaled grayscale SD * trajectory ^ scaler 
</p>
<p>1)The scaled grayscale SD is the standard deviation of grayscale values along each possible path. This value is scaled to 0 to 1. 
2)The trajectory is the straight line distance between the end points on the hemisphere between the previous step and the next possible steps. This value is scaled to a range of 0 to 1, and added to 1 (resulting values range from 1 to 2). This is to penalize steps that make severe changes, as muscle fibers tend to not have very severe bends. 
3)The impact of the trajectory penalization is scaled using <em>scaler</em>. If scaler = 0, there is no trajectory penalization.
</p>
<p>The path with the minimum diagnostic value is selected, and the process repeated from the end point of that path. This stepwise algorithm continues the forward walk through the image stack until one of several stop conditions is reached:
</p>
<p>1) The only available remaining paths would either terminate or cross a black voxel. This prevents the tracker from passing out of the muscle fascicle. To accommodate noisy datasets, the tracker may be permitted to cross a small number of black voxels (<em>allowed.black</em>). 
2) The number of black voxels in the possible paths exceeds a specified number (e.g., 95 percent). This is meant to isolate regions of noise towards the end of a muscle fascicle, where adjoining connective tissue may obscure the end of a fiber. 
3) The remaining paths would terminate within a specified distance of the external &quot;boundary&quot; of the muscle. This prevents fibers from continuing to track along the exterior surface of the muscle in noisy image stacks.
</p>
<p>Once the path is terminated, the algorithm returns to the seed point and begins a walk in the opposite direction. It proceeds using the same terms as above. The forwards and backwards walks are returned. The process repeats for the next seed point.
</p>


<h3>Value</h3>

<p>A list with a length equal to or less than seeds (failed paths will be dropped). Each element contains $fiber.points, the 3D coordinates providing the fiber path through the image stack, expressed in units of voxels.
</p>
<p>Can be combined with separate runs from other images planes using c(). See example
</p>


<h3>Author(s)</h3>

<p>J. Arbour
</p>


<h3>References</h3>

<p>Arbour, J. In Prep. GoodFibes: an R package for the detection of muscle fibers from diceCT scans.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fibers.smoothed">fibers.smoothed</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


olddir&lt;-getwd()

#### this downloads the ant dataset image stack
#### if you have it already downloaded you can navigate to that folder
setwd(tempdir())
download.file(url=
"https://github.com/jessica-arbour/Ant-Muscle-Image-Stack/raw/main/Ant_data.zip",
destfile="antdata.zip")

unzip("antdata.zip")
setwd(paste0(getwd(),"/Ant data"))
####


images&lt;-list.files(pattern=".png")

fibes1&lt;-good.fibes(images = images, zero.image = 200, radius = 9, threshold = 0.7,
cutoff = 0.65, seeds=5, start.seed = 1, show.plot=FALSE)

fibes2&lt;-good.fibes(images = images, zero.image = 300, radius = 9, threshold = 0.7,
cutoff = 0.65, seeds=5, start.seed = 1, show.plot=FALSE)

fibes&lt;-c(fibes1,fibes2)

muscle.plot.multi(fibes, images, df=1)


setwd(olddir)


</code></pre>

<hr>
<h2 id='hemisphere.points'>
Finding end points of possible paths
</h2><span id='topic+hemisphere.points'></span>

<h3>Description</h3>

<p>Internal function that projects a hemisphere or spherical dome through the image stack to determine the end voxels of each possible path from a seed point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hemisphere.points(radius, show.plot = FALSE, backstep = 0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hemisphere.points_+3A_radius">radius</code></td>
<td>

<p>The number of images out from the seed point plane to sample
</p>
</td></tr>
<tr><td><code id="hemisphere.points_+3A_show.plot">show.plot</code></td>
<td>

<p>Generates a 3D plot showing the end points of possible paths
</p>
</td></tr>
<tr><td><code id="hemisphere.points_+3A_backstep">backstep</code></td>
<td>

<p>Should images in the seed point plane or behind it be considered. Each value (1, 2, 3, etc.) gives the number of images &quot;behind&quot; the seed point to consider in the spherical dome
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a matrix with 3D coordinates of the end points of the possible paths
</p>


<h3>Author(s)</h3>

<p>J. Arbour
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pointsGenerator">pointsGenerator</a></code>
</p>

<hr>
<h2 id='muscle.plot'>
Plot a single muscle fiber</h2><span id='topic+muscle.plot'></span>

<h3>Description</h3>

<p>Used to compare the muscle fiber path to the smoothed muscle fiber. Plots a single set of $fiber.points from and the smoothed fibers.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>muscle.plot(fiber.dat, images, df = 4, mirror.axis = FALSE, outline = 50, size = 2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="muscle.plot_+3A_fiber.dat">fiber.dat</code></td>
<td>

<p>Any set of $fiber.points produced by good.fibes
</p>
</td></tr>
<tr><td><code id="muscle.plot_+3A_images">images</code></td>
<td>

<p>A character vector with image names representing the image stack, can be produced using list.files.
</p>
</td></tr>
<tr><td><code id="muscle.plot_+3A_df">df</code></td>
<td>

<p>The df to be used in smoothing fiber paths in the calculation of fiber length
</p>
</td></tr>
<tr><td><code id="muscle.plot_+3A_mirror.axis">mirror.axis</code></td>
<td>

<p>Depending on the way the image stack was exported, fibers may be reflected from their original original. mirror.axis = TRUE will reflect the fibers before plotting to correct this
</p>
</td></tr>
<tr><td><code id="muscle.plot_+3A_outline">outline</code></td>
<td>

<p>The number of wireframe &quot;outlines&quot; to draw the muscle boundaries
</p>
</td></tr>
<tr><td><code id="muscle.plot_+3A_size">size</code></td>
<td>

<p>point size for $fiber.points in plot
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a 3D plot
</p>


<h3>Author(s)</h3>

<p>J. Arbour
</p>


<h3>References</h3>

<p>Arbour, J. In Prep. GoodFibes: an R package for the detection of muscle fibers from diceCT scans.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+muscle.plot.multi">muscle.plot.multi</a></code>, <code><a href="#topic+muscle.plot.stl">muscle.plot.stl</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
olddir&lt;-getwd()

#### this downloads the ant dataset image stack
#### if you have it already downloaded you can navigate to that folder
setwd(tempdir())
download.file(url=
"https://github.com/jessica-arbour/Ant-Muscle-Image-Stack/raw/main/Ant_data.zip",
destfile="antdata.zip")

unzip("antdata.zip")
setwd(paste0(getwd(),"/Ant data"))
####

images&lt;-list.files(pattern=".png")

data(ant.final)
muscle.plot(ant.final[[100]]$fiber.points,images,df=1, outline=30, mirror.axis=TRUE)
setwd(olddir)

</code></pre>

<hr>
<h2 id='muscle.plot.multi'>
Plot multi muscle fibers with a muscle outline
</h2><span id='topic+muscle.plot.multi'></span>

<h3>Description</h3>

<p>Uses functions from rgl to plot all fibers (smoothed with splines) in a fiber list. Also uses grayscale values from the image stack to determine the external boundaries of the muscle based on concave hulls. Boundaries are plotted as a series of single outlines sampled across the image.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>muscle.plot.multi(fiber.list, images, df = 2, outline = 30, 
cols = NULL, mirror.axis = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="muscle.plot.multi_+3A_fiber.list">fiber.list</code></td>
<td>

<p>A list of fibers with $fiber points. Generated by good.fibes or processed cleaned by other functions</p>
</td></tr>
<tr><td><code id="muscle.plot.multi_+3A_images">images</code></td>
<td>

<p>A character vector of image stack file names. Generated with list.files</p>
</td></tr>
<tr><td><code id="muscle.plot.multi_+3A_df">df</code></td>
<td>

<p>The degrees of freedom to pass to splines2::nsp for smoothing fiber paths. df = 1 gives a straight path, while &gt;1 gives increasingly curved paths</p>
</td></tr>
<tr><td><code id="muscle.plot.multi_+3A_outline">outline</code></td>
<td>

<p>The number of wireframe &quot;outlines&quot; to draw the muscle boundaries
</p>
</td></tr>
<tr><td><code id="muscle.plot.multi_+3A_cols">cols</code></td>
<td>

<p>An optional vector of colors, the same order and length of fiber.list</p>
</td></tr>
<tr><td><code id="muscle.plot.multi_+3A_mirror.axis">mirror.axis</code></td>
<td>

<p>Depending on the way the image stack was exported, fibers may be reflected from their original original. mirror.axis = TRUE will reflect the fibers before plotting to correct this
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a 3D plot
</p>


<h3>Author(s)</h3>

<p>J. Arbour
</p>


<h3>References</h3>

<p>Arbour, J. In Prep. GoodFibes: an R package for the detection of muscle fibers from diceCT scans.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+muscle.plot">muscle.plot</a></code>, <code><a href="#topic+muscle.plot.stl">muscle.plot.stl</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


olddir&lt;-getwd()

#### this downloads the ant dataset image stack
#### if you have it already downloaded you can navigate to that folder
setwd(tempdir())
download.file(url=
"https://github.com/jessica-arbour/Ant-Muscle-Image-Stack/raw/main/Ant_data.zip",
destfile="antdata.zip")

unzip("antdata.zip")
setwd(paste0(getwd(),"/Ant data"))
####

images&lt;-list.files(pattern=".png")
data(ant.final)
muscle.plot.multi(ant.final, images, df=1, mirror.axis = TRUE)


setwd(olddir)


</code></pre>

<hr>
<h2 id='muscle.plot.stl'>
Plot and export muscle fibers to stl</h2><span id='topic+muscle.plot.stl'></span>

<h3>Description</h3>

<p>Plot a series of muscle fibers produced by good.fibes. Fibers are smoothed using splines before plotting. Optionally export an STL file in the correct size scale.</p>


<h3>Usage</h3>

<pre><code class='language-R'>muscle.plot.stl(fiber.list, res = 1, df = 2, radius = 1, cols = NULL,
save.plot = FALSE, file.name = "muscle.fibers.stl", mirror.axis = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="muscle.plot.stl_+3A_fiber.list">fiber.list</code></td>
<td>

<p>A list of fibers with $fiber points. Generated by good.fibes or processed cleaned by other functions
</p>
</td></tr>
<tr><td><code id="muscle.plot.stl_+3A_res">res</code></td>
<td>

<p>The isometric resolution of the original scan (i.e., the distance between images). Provided as a linear measure (um, mm, etc.)
</p>
</td></tr>
<tr><td><code id="muscle.plot.stl_+3A_df">df</code></td>
<td>

<p>The degrees of freedom to pass to splines2::nsp for smoothing fiber paths. df = 1 gives a straight path, while &gt;1 gives increasingly curved paths
</p>
</td></tr>
<tr><td><code id="muscle.plot.stl_+3A_radius">radius</code></td>
<td>

<p>The radius of the lines plotted for muscle fibers
</p>
</td></tr>
<tr><td><code id="muscle.plot.stl_+3A_cols">cols</code></td>
<td>

<p>An optional vector of colors, the same order and length of fiber.list
</p>
</td></tr>
<tr><td><code id="muscle.plot.stl_+3A_save.plot">save.plot</code></td>
<td>

<p>When TRUE, plot is saved as an .stl object in the current working directory. Provide file in file.name argument.
</p>
</td></tr>
<tr><td><code id="muscle.plot.stl_+3A_file.name">file.name</code></td>
<td>

<p>Character data giving the file.name and ending in .stl
</p>
</td></tr>
<tr><td><code id="muscle.plot.stl_+3A_mirror.axis">mirror.axis</code></td>
<td>

<p>Depending on the way the image stack was exported, fibers may be reflected from their original original. mirror.axis = TRUE will reflect the fibers before plotting to correct this
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a 3D plot
</p>


<h3>Author(s)</h3>

<p>J. Arbour
</p>


<h3>References</h3>

<p>Arbour, J. In Prep. GoodFibes: an R package for the detection of muscle fibers from diceCT scans.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+muscle.plot.multi">muscle.plot.multi</a></code>,<code><a href="#topic+muscle.plot">muscle.plot</a></code>,<code><a href="#topic+good.fibes">good.fibes</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(ant.final)

muscle.plot.stl(ant.final, res = 0.000673107, df=1, radius = 1, 
mirror.axis = TRUE, save.plot = FALSE)

</code></pre>

<hr>
<h2 id='pointsGenerator'>
Line points generator
</h2><span id='topic+pointsGenerator'></span>

<h3>Description</h3>

<p>An internal function for generating line coordinates for all possible paths of the good.fibes tracking algorithm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pointsGenerator(startx, starty, ucoords, radius = radius, backstep)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pointsGenerator_+3A_startx">startx</code></td>
<td>

<p>seed point x coordinate
</p>
</td></tr>
<tr><td><code id="pointsGenerator_+3A_starty">starty</code></td>
<td>

<p>seed point y coordinate
</p>
</td></tr>
<tr><td><code id="pointsGenerator_+3A_ucoords">ucoords</code></td>
<td>

<p>unique end coordinates generated by hemisphere.points
</p>
</td></tr>
<tr><td><code id="pointsGenerator_+3A_radius">radius</code></td>
<td>

<p>Number of images to consider forward from the zero.image
</p>
</td></tr>
<tr><td><code id="pointsGenerator_+3A_backstep">backstep</code></td>
<td>

<p>Should images in the seed point plane or behind it be considered. Each value (1, 2, 3, etc.) gives the number of images &quot;behind&quot; the seed point to consider in the spherical dome
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For internal use in good.fibes only</p>


<h3>Value</h3>

<p>A list containing coorindates for each line ending in the end points determined by hemisphere.points
</p>

<hr>
<h2 id='quality.check'>
Quality testing of possible muscle fibers detected by good.fibes</h2><span id='topic+quality.check'></span>

<h3>Description</h3>

<p>Calculates quality as the ratio of grayscale standard deviation and fiber length for each muscle fiber detected using good.fibes. Long, homogenous fibers are considered to be of higher quality. Fibers are smoothed before the calculation of fiber quality.
</p>
<p>Fibers with usually low quality (high grayscale variation compared to fiber length) are identified for exclusion.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>quality.check(fib.list, images, res, min.length = NULL, length.out = 200, df = 2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="quality.check_+3A_fib.list">fib.list</code></td>
<td>

<p>A list of muscle fibers with $fiber.points, generated by good.fibes
</p>
</td></tr>
<tr><td><code id="quality.check_+3A_images">images</code></td>
<td>

<p>A character vector of image stack file names. Generated with list.files
</p>
</td></tr>
<tr><td><code id="quality.check_+3A_res">res</code></td>
<td>

<p>The isometric resolution of the voxels (i.e., the distance between images). Given as a linear measure (um, mm, etc.)
</p>
</td></tr>
<tr><td><code id="quality.check_+3A_min.length">min.length</code></td>
<td>

<p>Optionally exclude fibers below a certain fiber length (e.g., based on anatomical measurements). If resolution is given, then in those units, otherwise in number of voxels.
</p>
</td></tr>
<tr><td><code id="quality.check_+3A_length.out">length.out</code></td>
<td>

<p>Number of line segments used in the calculation of fiber length
</p>
</td></tr>
<tr><td><code id="quality.check_+3A_df">df</code></td>
<td>

<p>Degrees of freedom passed to splines::ns in the smoothing of muscle fibers before calculation. df = 1 produces straight fibers, while values &gt; 1 produce increasingly curved fibers
</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>quality</code></td>
<td>
<p>grayscale sd/fiber length, low values are considered of higher quality</p>
</td></tr>
<tr><td><code>grey.values</code></td>
<td>
<p>A list providing the grayscale values for each smoothed fibers</p>
</td></tr>
<tr><td><code>problem.fibers</code></td>
<td>
<p>The location of fibers in the original list object that have atypically poor quality and should be excluded from further analyses</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Also produces a plot showing the distribution of quality values, and numbered bars for outliers.
</p>


<h3>Author(s)</h3>

<p>J. Arbour
</p>


<h3>References</h3>

<p>Arbour, J. In Prep. GoodFibes: an R package for the detection of muscle fibers from diceCT scans.
</p>
<p>Puffel, F. Pouget, A., Liu, X., Zuber, M., van de Kamp, T., Roces, F., and Labonte, D., 2021. <em>Journal of the Royal Society Interface</em> 18: 20210424
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fuse.fibers">fuse.fibers</a></code>,<code><a href="#topic+check.overlap">check.overlap</a></code>,
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

olddir&lt;-getwd()

#### this downloads the ant dataset image stack
#### if you have it already downloaded you can navigate to that folder
setwd(tempdir())
download.file(url=
"https://github.com/jessica-arbour/Ant-Muscle-Image-Stack/raw/main/Ant_data.zip",
destfile="antdata.zip")

unzip("antdata.zip")
setwd(paste0(getwd(),"/Ant data"))
####

data(ant.raw)
images&lt;-list.files(pattern=".png")

qc&lt;-quality.check(ant.raw[21:50],images, res=0.000673107, df=1)


setwd(olddir)


</code></pre>

<hr>
<h2 id='sequencePlot'>
Plot the path of a muscle fiber generated using good.fibes</h2><span id='topic+sequencePlot'></span>

<h3>Description</h3>

<p>Plots images in sequence showing the image stack and the location of the muscle fiber path at each step in the fiber tracking algorithm in good.fibes
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sequencePlot(fib.track, images, threshold = 0.1, sleep.time = 0.5)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sequencePlot_+3A_fib.track">fib.track</code></td>
<td>

<p>A set of $fiber.points from a fiber list, generated by good.fibes
</p>
</td></tr>
<tr><td><code id="sequencePlot_+3A_images">images</code></td>
<td>

<p>A character vector of image stack file names. Generated with list.files
</p>
</td></tr>
<tr><td><code id="sequencePlot_+3A_threshold">threshold</code></td>
<td>

<p>A cutoff values under which voxels are set to black
</p>
</td></tr>
<tr><td><code id="sequencePlot_+3A_sleep.time">sleep.time</code></td>
<td>

<p>Time in seconds between images, sets speed for plotting sequence
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a sequence of plots
</p>


<h3>Author(s)</h3>

<p>J. Arbour
</p>


<h3>References</h3>

<p>Arbour, J. In Prep. GoodFibes: an R package for the detection of muscle fibers from diceCT scans.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+thresholdPlot">thresholdPlot</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

olddir&lt;-getwd()

#### this downloads the ant dataset image stack
#### if you have it already downloaded you can navigate to that folder
setwd(tempdir())
download.file(url=
"https://github.com/jessica-arbour/Ant-Muscle-Image-Stack/raw/main/Ant_data.zip",
destfile="antdata.zip")

unzip("antdata.zip")
setwd(paste0(getwd(),"/Ant data"))
####

images&lt;-list.files(pattern=".png")

data(ant.raw)

sequencePlot(ant.raw[[2]]$fiber.points, images, 0 ,0.2)



setwd(olddir)


</code></pre>

<hr>
<h2 id='thresholdPlot'>
Plot image from diceCT stack using thresholding
</h2><span id='topic+thresholdPlot'></span>

<h3>Description</h3>

<p>Plot a selected image from the image stack with values below <em>threshold</em> set to black (grayscale = 0). Can be used to select <em>threshold</em> and <em>cutoff</em> values used in good.fibes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>thresholdPlot(images, n, threshold)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="thresholdPlot_+3A_images">images</code></td>
<td>

<p>A character vector of image stack file names. Generated with list.files
</p>
</td></tr>
<tr><td><code id="thresholdPlot_+3A_n">n</code></td>
<td>

<p>The number of the selected image in the vector &quot;images&quot;
</p>
</td></tr>
<tr><td><code id="thresholdPlot_+3A_threshold">threshold</code></td>
<td>

<p>The cutoff value for grayscale values. All voxels with grayscales below threshold will be displayed as black.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a plot
</p>


<h3>Author(s)</h3>

<p>J. Arbour
</p>


<h3>References</h3>

<p>Arbour, J. In Prep. GoodFibes: an R package for the detection of muscle fibers from diceCT scans.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sequencePlot">sequencePlot</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
images &lt;- dir(system.file("extdata", package = "GoodFibes"), ".png", full.names = TRUE)

thresholdPlot(images, 1, 0.3)
thresholdPlot(images, 1, 0.4)
thresholdPlot(images, 1, 0.5)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
