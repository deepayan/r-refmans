<!DOCTYPE html><html><head><title>Help for package MetricsWeighted</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {MetricsWeighted}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#classification'><p>Classification Metrics</p></a></li>
<li><a href='#elementary_score'><p>Elementary Scoring Function for Expectiles and Quantiles</p></a></li>
<li><a href='#multi_metric'><p>Multiple Metrics</p></a></li>
<li><a href='#murphy_diagram'><p>Murphy diagram</p></a></li>
<li><a href='#performance'><p>Performance</p></a></li>
<li><a href='#regression'><p>Regression Metrics</p></a></li>
<li><a href='#rsquared'><p>Generalized R-Squared</p></a></li>
<li><a href='#weighted_cor'><p>Weighted Pearson Correlation</p></a></li>
<li><a href='#weighted_mean'><p>Weighted Mean</p></a></li>
<li><a href='#weighted_median'><p>Weighted Median</p></a></li>
<li><a href='#weighted_quantile'><p>Weighted Quantiles</p></a></li>
<li><a href='#weighted_var'><p>Weighted Variance</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Weighted Metrics and Performance Measures for Machine Learning</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.3</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides weighted versions of several metrics and performance
    measures used in machine learning, including average unit deviances of
    the Bernoulli, Tweedie, Poisson, and Gamma distributions, see
    Jorgensen B. (1997, ISBN: 978-0412997112).  The package also contains
    a weighted version of generalized R-squared, see e.g. Cohen, J. et al.
    (2002, ISBN: 978-0805822236).  Furthermore, 'dplyr' chains are
    supported.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1.0)</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Imports:</td>
<td>graphics, stats</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/mayer79/MetricsWeighted">https://github.com/mayer79/MetricsWeighted</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/mayer79/MetricsWeighted/issues">https://github.com/mayer79/MetricsWeighted/issues</a></td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-11-16 10:33:04 UTC; Michael</td>
</tr>
<tr>
<td>Author:</td>
<td>Michael Mayer [aut, cre],
  Christian Lorentzen [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Michael Mayer &lt;mayermichael79@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-11-16 14:23:59 UTC</td>
</tr>
</table>
<hr>
<h2 id='classification'>Classification Metrics</h2><span id='topic+classification'></span><span id='topic+accuracy'></span><span id='topic+classification_error'></span><span id='topic+precision'></span><span id='topic+recall'></span><span id='topic+f1_score'></span><span id='topic+AUC'></span><span id='topic+gini_coefficient'></span><span id='topic+deviance_bernoulli'></span><span id='topic+logLoss'></span>

<h3>Description</h3>

<p>Weighted versions of non-probabilistic and probabilistic classification metrics:
</p>

<ul>
<li> <p><code>accuracy()</code>: Accuracy (higher is better).
</p>
</li>
<li> <p><code>classification_error()</code>: Classification error = 1 - Accuracy (lower is better).
</p>
</li>
<li> <p><code>precision()</code>: Precision (higher is better).
</p>
</li>
<li> <p><code>recall()</code>: Recall (higher is better).
</p>
</li>
<li> <p><code>f1_score()</code>: F1 Score. Harmonic mean of precision and recall (higher is better).
</p>
</li>
<li> <p><code>AUC()</code>: Area under the ROC (higher is better).
</p>
</li>
<li> <p><code>gini_coefficient()</code>: Gini coefficient, equivalent to <code class="reqn">2 \cdot \textrm{AUC} - 1</code>.
Up to ties in <code>predicted</code>, equivalent to Somer's D (higher is better).
</p>
</li>
<li> <p><code>deviance_bernoulli()</code>: Average Bernoulli deviance. Equals twice the
log loss/binary cross entropy (smaller is better).
</p>
</li>
<li> <p><code>logLoss()</code>: Log loss/binary cross entropy. Equals half the average Bernoulli
deviance (smaller is better).
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>accuracy(actual, predicted, w = NULL, ...)

classification_error(actual, predicted, w = NULL, ...)

precision(actual, predicted, w = NULL, ...)

recall(actual, predicted, w = NULL, ...)

f1_score(actual, predicted, w = NULL, ...)

AUC(actual, predicted, w = NULL, ...)

gini_coefficient(actual, predicted, w = NULL, ...)

deviance_bernoulli(actual, predicted, w = NULL, ...)

logLoss(actual, predicted, w = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="classification_+3A_actual">actual</code></td>
<td>
<p>Observed values.</p>
</td></tr>
<tr><td><code id="classification_+3A_predicted">predicted</code></td>
<td>
<p>Predicted values.</p>
</td></tr>
<tr><td><code id="classification_+3A_w">w</code></td>
<td>
<p>Optional case weights.</p>
</td></tr>
<tr><td><code id="classification_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="#topic+weighted_mean">weighted_mean()</a></code>
(no effect for <code>AUC()</code> and <code>gini_coefficient()</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that the function <code>AUC()</code> was originally modified from the 'glmnet' package
to ensure deterministic results. The unweighted version can be different from the
weighted one with unit weights due to ties in <code>predicted</code>.
</p>


<h3>Value</h3>

<p>A numeric vector of length one.
</p>


<h3>Input ranges</h3>


<ul>
<li><p> For <code>precision()</code>, <code>recall()</code>, and <code>f1_score()</code>: The <code>actual</code> and <code>predicted</code> values
need to be in <code class="reqn">\{0, 1\}</code>.
</p>
</li>
<li><p> For <code>accuracy()</code> and <code>classification_error()</code>: Any discrete input.
</p>
</li>
<li><p> For <code>AUC()</code> and <code>gini_coefficient()</code>: Only <code>actual</code> must be in <code class="reqn">\{0, 1\}</code>.
</p>
</li>
<li><p> For <code>deviance_bernoulli()</code> and <code>logLoss()</code>: The values of <code>actual</code> must be in
<code class="reqn">\{0, 1\}</code>, while <code>predicted</code> must be in the closed interval <code class="reqn">[0, 1]</code>.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>y &lt;- c(0, 0, 1, 1)
pred &lt;- c(0, 0, 1, 0)
w &lt;- y * 2

accuracy(y, pred)
classification_error(y, pred, w = w)
precision(y, pred, w = w)
recall(y, pred, w = w)
f1_score(y, pred, w = w)

y2 &lt;- c(0, 1, 0, 1)
pred2 &lt;- c(0.1, 0.1, 0.9, 0.8)
w2 &lt;- 1:4

AUC(y2, pred2)
AUC(y2, pred2, w = rep(1, 4))  # Different due to ties in predicted

gini_coefficient(y2, pred2, w = w2)
logLoss(y2, pred2, w = w2)
deviance_bernoulli(y2, pred2, w = w2)
</code></pre>

<hr>
<h2 id='elementary_score'>Elementary Scoring Function for Expectiles and Quantiles</h2><span id='topic+elementary_score'></span><span id='topic+elementary_score_expectile'></span><span id='topic+elementary_score_quantile'></span>

<h3>Description</h3>

<p>Weighted average of the elementary scoring function for expectiles or quantiles at
level <code class="reqn">\alpha</code> with parameter <code class="reqn">\theta</code>, see reference below.
Every choice of <code class="reqn">\theta</code> gives a scoring function consistent for the expectile
or quantile at level <code class="reqn">\alpha</code>.
Note that the expectile at level <code class="reqn">\alpha = 0.5</code> is the expectation (mean).
The smaller the score, the better.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>elementary_score_expectile(
  actual,
  predicted,
  w = NULL,
  alpha = 0.5,
  theta = 0,
  ...
)

elementary_score_quantile(
  actual,
  predicted,
  w = NULL,
  alpha = 0.5,
  theta = 0,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="elementary_score_+3A_actual">actual</code></td>
<td>
<p>Observed values.</p>
</td></tr>
<tr><td><code id="elementary_score_+3A_predicted">predicted</code></td>
<td>
<p>Predicted values.</p>
</td></tr>
<tr><td><code id="elementary_score_+3A_w">w</code></td>
<td>
<p>Optional case weights.</p>
</td></tr>
<tr><td><code id="elementary_score_+3A_alpha">alpha</code></td>
<td>
<p>Level of expectile or quantile. The default <code>alpha = 0.5</code>
corresponds to the expectation/median.</p>
</td></tr>
<tr><td><code id="elementary_score_+3A_theta">theta</code></td>
<td>
<p>Evaluation point.</p>
</td></tr>
<tr><td><code id="elementary_score_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="#topic+weighted_mean">weighted_mean()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector of length one.
</p>


<h3>References</h3>

<p>Ehm, W., Gneiting, T., Jordan, A. and Krüger, F. (2016), Of quantiles and
expectiles: consistent scoring functions, Choquet representations and forecast
rankings. J. R. Stat. Soc. B, 78: 505-562, &lt;doi.org/10.1111/rssb.12154&gt;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+murphy_diagram">murphy_diagram()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>elementary_score_expectile(1:10, c(1:9, 12), alpha = 0.5, theta = 11)
elementary_score_quantile(1:10, c(1:9, 12), alpha = 0.5, theta = 11)
</code></pre>

<hr>
<h2 id='multi_metric'>Multiple Metrics</h2><span id='topic+multi_metric'></span>

<h3>Description</h3>

<p>Provides a way to create a list of metrics/performance measures from a
parametrized function like the Tweedie deviance or the elementary
scoring functions for expectiles.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>multi_metric(fun, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="multi_metric_+3A_fun">fun</code></td>
<td>
<p>A metric/performance measure with additional parameter to be varied.</p>
</td></tr>
<tr><td><code id="multi_metric_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code>fun()</code>, including one varying parameter
(specified by a vector).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A named list of functions.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+performance">performance()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data &lt;- data.frame(act = 1:10, pred = c(1:9, 12))
multi &lt;- multi_metric(fun = deviance_tweedie, tweedie_p = c(0, seq(1, 3, by = 0.1)))
performance(data, actual = "act", predicted = "pred", metrics = multi)
multi &lt;- multi_metric(
  fun = r_squared,
  deviance_function = deviance_tweedie, tweedie_p = c(0, seq(1, 3, by = 0.1))
)
performance(data, actual = "act", predicted = "pred", metrics = multi)
multi &lt;- multi_metric(fun = elementary_score_expectile, theta = 1:11, alpha = 0.1)
performance(data, actual = "act", predicted = "pred", metrics = multi, key = "theta")
multi &lt;- multi_metric(fun = elementary_score_expectile, theta = 1:11, alpha = 0.5)
performance(data, actual = "act", predicted = "pred", metrics = multi, key = "theta")
</code></pre>

<hr>
<h2 id='murphy_diagram'>Murphy diagram</h2><span id='topic+murphy_diagram'></span>

<h3>Description</h3>

<p>Murphy diagram of the elementary scoring function for expectiles/quantiles at level
<code class="reqn">\alpha</code> for different values of <code class="reqn">\theta</code>. Can be used to study and
compare performance of one or multiple models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>murphy_diagram(
  actual,
  predicted,
  w = NULL,
  alpha = 0.5,
  theta = seq(-2, 2, length.out = 100L),
  functional = c("expectile", "quantile"),
  plot = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="murphy_diagram_+3A_actual">actual</code></td>
<td>
<p>Observed values.</p>
</td></tr>
<tr><td><code id="murphy_diagram_+3A_predicted">predicted</code></td>
<td>
<p>Predicted values.</p>
</td></tr>
<tr><td><code id="murphy_diagram_+3A_w">w</code></td>
<td>
<p>Optional case weights.</p>
</td></tr>
<tr><td><code id="murphy_diagram_+3A_alpha">alpha</code></td>
<td>
<p>Level of expectile or quantile. The default <code>alpha = 0.5</code>
corresponds to the expectation/median.</p>
</td></tr>
<tr><td><code id="murphy_diagram_+3A_theta">theta</code></td>
<td>
<p>Vector of evaluation points.</p>
</td></tr>
<tr><td><code id="murphy_diagram_+3A_functional">functional</code></td>
<td>
<p>Either &quot;expectile&quot; or &quot;quantile&quot;.</p>
</td></tr>
<tr><td><code id="murphy_diagram_+3A_plot">plot</code></td>
<td>
<p>Should a plot be returned (default is <code>TRUE</code>)? If <code>FALSE</code>,
a <code>data.frame</code> containing the results.</p>
</td></tr>
<tr><td><code id="murphy_diagram_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="graphics.html#topic+matplot">graphics::matplot()</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the plot needs to be customized, set <code>plot = FALSE</code> to get the
resulting data instead of the plot.
</p>


<h3>Value</h3>

<p>The result of <code><a href="graphics.html#topic+matplot">graphics::matplot()</a></code> or a <code>data.frame</code> containing the results.
</p>


<h3>References</h3>

<p>Ehm, W., Gneiting, T., Jordan, A. and Krüger, F. (2016), Of quantiles and
expectiles: consistent scoring functions, Choquet representations and forecast
rankings. J. R. Stat. Soc. B, 78: 505-562, &lt;doi.org/10.1111/rssb.12154&gt;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+elementary_score">elementary_score()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>y &lt;- 1:10
predicted &lt;- 1.1 * y
murphy_diagram(y, predicted, theta = seq(0.9, 1.2, by = 0.01))
two_models &lt;- cbind(m1 = predicted, m2 = 1.2 * y)
murphy_diagram(y, two_models, theta = seq(0.9, 1.3, by = 0.01))
</code></pre>

<hr>
<h2 id='performance'>Performance</h2><span id='topic+performance'></span>

<h3>Description</h3>

<p>Applies one or more metrics to a <code>data.frame</code> containing columns with
actual and predicted values as well as an optional column with case weights.
The results are returned as a <code>data.frame</code> and can be used in a pipe.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>performance(
  data,
  actual,
  predicted,
  w = NULL,
  metrics = rmse,
  key = "metric",
  value = "value",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="performance_+3A_data">data</code></td>
<td>
<p>A <code>data.frame</code> with columns <code>actual</code>, <code>predicted</code>, and optionally <code>w</code>.</p>
</td></tr>
<tr><td><code id="performance_+3A_actual">actual</code></td>
<td>
<p>The column name in <code>data</code> referring to actual values.</p>
</td></tr>
<tr><td><code id="performance_+3A_predicted">predicted</code></td>
<td>
<p>The column name in <code>data</code> referring to predicted values.</p>
</td></tr>
<tr><td><code id="performance_+3A_w">w</code></td>
<td>
<p>The optional column name in <code>data</code> referring to case weights.</p>
</td></tr>
<tr><td><code id="performance_+3A_metrics">metrics</code></td>
<td>
<p>Either a function or a named list of functions.
Each function represents a metric and has four arguments:
</p>

<ul>
<li> <p><code>observed</code>,
</p>
</li>
<li> <p><code>predicted</code>,
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;case weights&#8288;</code>, and
</p>
</li>
<li> <p><code>...</code>.
</p>
</li></ul>

<p>If not a named list but a single function, the name of the function is guessed by
<code>deparse(substitute(...))</code>, which would not provide the actual name of the
function if called within <code><a href="base.html#topic+lapply">lapply()</a></code> etc. In such cases, you can pass a named
list with one element, e.g., <code>list(rmse = rmse)</code>.</p>
</td></tr>
<tr><td><code id="performance_+3A_key">key</code></td>
<td>
<p>Name of the resulting column containing the name of the metric.
Defaults to &quot;metric&quot;.</p>
</td></tr>
<tr><td><code id="performance_+3A_value">value</code></td>
<td>
<p>Name of the resulting column with the value of the metric.
Defaults to &quot;value&quot;.</p>
</td></tr>
<tr><td><code id="performance_+3A_...">...</code></td>
<td>
<p>Further arguments passed to the metric functions. E.g., if the metric
is <code><a href="#topic+r_squared">r_squared()</a></code>, you could pass the relevant deviance function as additional
argument (see examples).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Data frame with one row per metric and two columns: <code>key</code> and <code>value</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ir &lt;- iris
fit_num &lt;- lm(Sepal.Length ~ ., data = ir)
ir$fitted &lt;- fit_num$fitted
performance(ir, "Sepal.Length", "fitted")
performance(ir, "Sepal.Length", "fitted", metrics = r_squared)
performance(
  ir,
  actual = "Sepal.Length",
  predicted = "fitted",
  metrics = c(`R-squared` = r_squared, rmse = rmse)
)
performance(
  ir,
  actual = "Sepal.Length",
  predicted = "fitted",
  metrics = r_squared,
  deviance_function = deviance_gamma
)
performance(
  ir,
  actual = "Sepal.Length",
  predicted = "fitted",
  metrics = r_squared,
  deviance_function = deviance_tweedie,
  tweedie_p = 2
)
</code></pre>

<hr>
<h2 id='regression'>Regression Metrics</h2><span id='topic+regression'></span><span id='topic+mse'></span><span id='topic+rmse'></span><span id='topic+mae'></span><span id='topic+medae'></span><span id='topic+mape'></span><span id='topic+prop_within'></span><span id='topic+deviance_normal'></span><span id='topic+deviance_poisson'></span><span id='topic+deviance_gamma'></span><span id='topic+deviance_tweedie'></span>

<h3>Description</h3>

<p>Case-weighted versions of typical regression metrics:
</p>

<ul>
<li> <p><code>mse()</code>: Mean-squared error.
</p>
</li>
<li> <p><code>rmse()</code>: Root-mean-squared error.
</p>
</li>
<li> <p><code>mae()</code>: Mean absolute error.
</p>
</li>
<li> <p><code>medae()</code>: Median absolute error.
</p>
</li>
<li> <p><code>mape()</code>: Mean absolute percentage error.
</p>
</li>
<li> <p><code>prop_within()</code>: Proportion of predictions that are within a given tolerance
around the actual values.
</p>
</li>
<li> <p><code>deviance_normal()</code>: Average (unscaled) normal deviance. Equals MSE, and also the
average Tweedie deviance with <code class="reqn">p = 0</code>.
</p>
</li>
<li> <p><code>deviance_poisson()</code>: Average (unscaled) Poisson deviance. Equals average Tweedie
deviance with <code class="reqn">p=1</code>.
</p>
</li>
<li> <p><code>deviance_gamma()</code>: Average (unscaled) Gamma deviance. Equals average Tweedie
deviance with <code class="reqn">p=2</code>.
</p>
</li>
<li> <p><code>deviance_tweedie()</code>: Average Tweedie deviance with parameter
<code class="reqn">p \in \{0\} \cup [1, \infty)</code>, see reference.
</p>
</li></ul>

<p>Lower values mean better performance. Notable exception is <code>prop_within()</code>,
where higher is better.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mse(actual, predicted, w = NULL, ...)

rmse(actual, predicted, w = NULL, ...)

mae(actual, predicted, w = NULL, ...)

medae(actual, predicted, w = NULL, ...)

mape(actual, predicted, w = NULL, ...)

prop_within(actual, predicted, w = NULL, tol = 1, ...)

deviance_normal(actual, predicted, w = NULL, ...)

deviance_poisson(actual, predicted, w = NULL, ...)

deviance_gamma(actual, predicted, w = NULL, ...)

deviance_tweedie(actual, predicted, w = NULL, tweedie_p = 0, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="regression_+3A_actual">actual</code></td>
<td>
<p>Observed values.</p>
</td></tr>
<tr><td><code id="regression_+3A_predicted">predicted</code></td>
<td>
<p>Predicted values.</p>
</td></tr>
<tr><td><code id="regression_+3A_w">w</code></td>
<td>
<p>Optional case weights.</p>
</td></tr>
<tr><td><code id="regression_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="#topic+weighted_mean">weighted_mean()</a></code> (no effect for <code>medae()</code>).</p>
</td></tr>
<tr><td><code id="regression_+3A_tol">tol</code></td>
<td>
<p>Predictions in <code class="reqn">[\textrm{actual} \pm \textrm{tol}]</code> count as &quot;within&quot;
(only relevant for <code>prop_within()</code>).</p>
</td></tr>
<tr><td><code id="regression_+3A_tweedie_p">tweedie_p</code></td>
<td>
<p>Tweedie power <code class="reqn">p \in \{0\} \cup [1, \infty)</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector of length one.
</p>


<h3>Input range</h3>

<p>The values of <code>actual</code> and <code>predicted</code> can be any real numbers, with the following
exceptions:
</p>

<ul>
<li> <p><code>mape()</code>: Non-zero actual values.
</p>
</li>
<li> <p><code>deviance_poisson()</code>: Non-negative actual values and predictions.
</p>
</li>
<li> <p><code>deviance_gamma()</code>: Strictly positive actual values and predictions.
</p>
</li></ul>



<h3>References</h3>

<p>Jorgensen, B. (1997). The Theory of Dispersion Models. Chapman &amp; Hall/CRC.
ISBN 978-0412997112.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>y &lt;- 1:10
pred &lt;- c(1:9, 12)
w &lt;- 1:10

rmse(y, pred)
sqrt(mse(y, pred))  # Same

mae(y, pred)
mae(y, pred, w = w)
medae(y, pred, w = 1:10)
mape(y, pred)

prop_within(y, pred)

deviance_normal(y, pred)
deviance_poisson(y, pred)
deviance_gamma(y, pred)

deviance_tweedie(y, pred, tweedie_p = 0)  # Normal
deviance_tweedie(y, pred, tweedie_p = 1)  # Poisson
deviance_tweedie(y, pred, tweedie_p = 2)  # Gamma
deviance_tweedie(y, pred, tweedie_p = 1.5, w = 1:10)

</code></pre>

<hr>
<h2 id='rsquared'>Generalized R-Squared</h2><span id='topic+rsquared'></span><span id='topic+r_squared'></span><span id='topic+r_squared_poisson'></span><span id='topic+r_squared_gamma'></span><span id='topic+r_squared_bernoulli'></span>

<h3>Description</h3>

<p>Returns (weighted) proportion of deviance explained, see reference below.
For the mean-squared error as deviance, this equals the usual (weighted) R-squared.
The higher, the better.
</p>
<p>The convenience functions
</p>

<ul>
<li> <p><code>r_squared_poisson()</code>,
</p>
</li>
<li> <p><code>r_squared_gamma()</code>, and
</p>
</li>
<li> <p><code>r_squared_bernoulli()</code>
</p>
</li></ul>

<p>call the function <code>r_squared(..., deviance_function = fun)</code> with the right deviance
function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>r_squared(
  actual,
  predicted,
  w = NULL,
  deviance_function = mse,
  reference_mean = NULL,
  ...
)

r_squared_poisson(actual, predicted, w = NULL, reference_mean = NULL, ...)

r_squared_gamma(actual, predicted, w = NULL, reference_mean = NULL, ...)

r_squared_bernoulli(actual, predicted, w = NULL, reference_mean = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rsquared_+3A_actual">actual</code></td>
<td>
<p>Observed values.</p>
</td></tr>
<tr><td><code id="rsquared_+3A_predicted">predicted</code></td>
<td>
<p>Predicted values.</p>
</td></tr>
<tr><td><code id="rsquared_+3A_w">w</code></td>
<td>
<p>Optional case weights.</p>
</td></tr>
<tr><td><code id="rsquared_+3A_deviance_function">deviance_function</code></td>
<td>
<p>A positive (deviance) function taking four arguments:
&quot;actual&quot;, &quot;predicted&quot;, &quot;w&quot; and &quot;...&quot;. The default is <code>mse()</code>, which equals
the average normal deviance.</p>
</td></tr>
<tr><td><code id="rsquared_+3A_reference_mean">reference_mean</code></td>
<td>
<p>An optional reference mean used to derive the null deviance.
Recommended in out-of-sample applications.</p>
</td></tr>
<tr><td><code id="rsquared_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="#topic+weighted_mean">weighted_mean()</a></code> and <code>deviance_function()</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The deviance gain is calculated regarding the null model derived from the actual
values. While fine for in-sample considerations, this is only an approximation
for out-of-sample considerations. There, it is recommended to calculate null
deviance regarding the in-sample (weighted) mean. This value can be passed by
the argument <code>reference_mean</code>.
</p>


<h3>Value</h3>

<p>A numeric vector of length one.
</p>


<h3>References</h3>

<p>Cohen, Jacob. et al. (2002). Applied Multiple Regression/Correlation Analysis for
the Behavioral Sciences (3rd ed.). Routledge. ISBN 978-0805822236.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>y &lt;- 1:10
pred &lt;- c(1, 1:9)
w &lt;- 1:10

r_squared(y, pred)
r_squared(y, pred, w = w)

r_squared(y, pred, w = w, deviance_function = deviance_gamma)
r_squared_gamma(y, pred, w = w)

# Poisson situation
y2 &lt;- 0:2
pred2 &lt;- c(0.1, 1, 2)
r_squared(y2, pred2, deviance_function = deviance_poisson)
r_squared_poisson(y2, pred2)

# Binary (probabilistic) classification
y3 &lt;- c(0, 0, 1, 1)
pred3 &lt;- c(0.1, 0.1, 0.9, 0.8)
r_squared_bernoulli(y3, pred3, w = 1:4)

# With respect to 'own' deviance formula
myTweedie &lt;- function(actual, predicted, w = NULL, ...) {
  deviance_tweedie(actual, predicted, w, tweedie_p = 1.5, ...)
}
r_squared(y, pred, deviance_function = myTweedie)
</code></pre>

<hr>
<h2 id='weighted_cor'>Weighted Pearson Correlation</h2><span id='topic+weighted_cor'></span>

<h3>Description</h3>

<p>Calculates weighted Pearson correlation coefficient between actual and predicted
values by the help of <code><a href="stats.html#topic+cov.wt">stats::cov.wt()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>weighted_cor(actual, predicted, w = NULL, na.rm = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="weighted_cor_+3A_actual">actual</code></td>
<td>
<p>Observed values.</p>
</td></tr>
<tr><td><code id="weighted_cor_+3A_predicted">predicted</code></td>
<td>
<p>Predicted values.</p>
</td></tr>
<tr><td><code id="weighted_cor_+3A_w">w</code></td>
<td>
<p>Optional case weights.</p>
</td></tr>
<tr><td><code id="weighted_cor_+3A_na.rm">na.rm</code></td>
<td>
<p>Should observations with missing values in <code>actual</code> or <code>predicted</code>
be removed? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="weighted_cor_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="stats.html#topic+cov.wt">stats::cov.wt()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A length-one numeric vector.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>weighted_cor(1:10, c(1, 1:9))
weighted_cor(1:10, c(1, 1:9), w = 1:10)
</code></pre>

<hr>
<h2 id='weighted_mean'>Weighted Mean</h2><span id='topic+weighted_mean'></span>

<h3>Description</h3>

<p>Returns the weighted mean of a numeric vector.
In contrast to <code><a href="stats.html#topic+weighted.mean">stats::weighted.mean()</a></code>, <code>w</code> does not need to be specified.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>weighted_mean(x, w = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="weighted_mean_+3A_x">x</code></td>
<td>
<p>Numeric vector.</p>
</td></tr>
<tr><td><code id="weighted_mean_+3A_w">w</code></td>
<td>
<p>Optional vector of non-negative case weights.</p>
</td></tr>
<tr><td><code id="weighted_mean_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="base.html#topic+mean">mean()</a></code> or <code><a href="stats.html#topic+weighted.mean">stats::weighted.mean()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A length-one numeric vector.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+weighted.mean">stats::weighted.mean()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>weighted_mean(1:10)
weighted_mean(1:10, w = NULL)
weighted_mean(1:10, w = 1:10)
</code></pre>

<hr>
<h2 id='weighted_median'>Weighted Median</h2><span id='topic+weighted_median'></span>

<h3>Description</h3>

<p>Calculates weighted median based on <code><a href="#topic+weighted_quantile">weighted_quantile()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>weighted_median(x, w = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="weighted_median_+3A_x">x</code></td>
<td>
<p>Numeric vector.</p>
</td></tr>
<tr><td><code id="weighted_median_+3A_w">w</code></td>
<td>
<p>Optional vector of non-negative case weights.</p>
</td></tr>
<tr><td><code id="weighted_median_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="#topic+weighted_quantile">weighted_quantile()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A length-one numeric vector.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+weighted_quantile">weighted_quantile()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>n &lt;- 21
x &lt;- seq_len(n)
quantile(x, probs = 0.5)
weighted_median(x, w = rep(1, n))
weighted_median(x, w = x)
quantile(rep(x, x), probs = 0.5)
</code></pre>

<hr>
<h2 id='weighted_quantile'>Weighted Quantiles</h2><span id='topic+weighted_quantile'></span>

<h3>Description</h3>

<p>Calculates weighted quantiles based on the generalized inverse of the weighted ECDF.
If no weights are passed, uses <code><a href="stats.html#topic+quantile">stats::quantile()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>weighted_quantile(
  x,
  w = NULL,
  probs = seq(0, 1, 0.25),
  na.rm = TRUE,
  names = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="weighted_quantile_+3A_x">x</code></td>
<td>
<p>Numeric vector.</p>
</td></tr>
<tr><td><code id="weighted_quantile_+3A_w">w</code></td>
<td>
<p>Optional vector of non-negative case weights.</p>
</td></tr>
<tr><td><code id="weighted_quantile_+3A_probs">probs</code></td>
<td>
<p>Vector of probabilities.</p>
</td></tr>
<tr><td><code id="weighted_quantile_+3A_na.rm">na.rm</code></td>
<td>
<p>Ignore missing data? Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="weighted_quantile_+3A_names">names</code></td>
<td>
<p>Return names? Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="weighted_quantile_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="stats.html#topic+quantile">stats::quantile()</a></code> in the unweighted case.
Not used in the weighted case.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A length-one numeric vector.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+weighted_median">weighted_median()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>n &lt;- 10
x &lt;- seq_len(n)
quantile(x)
weighted_quantile(x)
weighted_quantile(x, w = rep(1, n))
quantile(x, type = 1)
weighted_quantile(x, w = x) # same as Hmisc::wtd.quantile()
weighted_quantile(x, w = x, names = FALSE)
weighted_quantile(x, w = x, probs = 0.5, names = FALSE)

# Example with integer weights
x &lt;- c(1, 1:11, 11, 11)
w &lt;- seq_along(x)
weighted_quantile(x, w)
quantile(rep(x, w)) # same
</code></pre>

<hr>
<h2 id='weighted_var'>Weighted Variance</h2><span id='topic+weighted_var'></span>

<h3>Description</h3>

<p>Calculates weighted variance, see <code><a href="stats.html#topic+cov.wt">stats::cov.wt()</a></code> or
<a href="https://en.wikipedia.org/wiki/Sample_mean_and_covariance#Weighted_samples">https://en.wikipedia.org/wiki/Sample_mean_and_covariance#Weighted_samples</a>
for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>weighted_var(x, w = NULL, method = c("unbiased", "ML"), na.rm = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="weighted_var_+3A_x">x</code></td>
<td>
<p>Numeric vector.</p>
</td></tr>
<tr><td><code id="weighted_var_+3A_w">w</code></td>
<td>
<p>Optional vector of non-negative case weights.</p>
</td></tr>
<tr><td><code id="weighted_var_+3A_method">method</code></td>
<td>
<p>Specifies how the result is scaled. If &quot;unbiased&quot;, the denomiator
is reduced by 1, see <code><a href="stats.html#topic+cov.wt">stats::cov.wt()</a></code> for details.</p>
</td></tr>
<tr><td><code id="weighted_var_+3A_na.rm">na.rm</code></td>
<td>
<p>Should missing values in <code>x</code> be removed? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="weighted_var_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="stats.html#topic+cov.wt">stats::cov.wt()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A length-one numeric vector.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+cov.wt">stats::cov.wt()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>weighted_var(1:10)
weighted_var(1:10, w = NULL)
weighted_var(1:10, w = rep(1, 10))
weighted_var(1:10, w = 1:10)
weighted_var(1:10, w = 1:10, method = "ML")
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
