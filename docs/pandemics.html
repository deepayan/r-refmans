<!DOCTYPE html><html lang="en"><head><title>Help for package pandemics</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {pandemics}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#pandemics-package'>
<p>Monitoring a Developing Pandemic with Available Data.</p></a></li>
<li><a href='#covid'>
<p>COVID-19 Outbreak Data in France</p></a></li>
<li><a href='#forecasting'>
<p>Forecasting infections, hospitalizations and deaths in hospital.</p></a></li>
<li><a href='#hazard2D'>
<p>Local Linear Estimator of the Two-Dimensional Marker-Dependent Hazard.</p></a></li>
<li><a href='#hazard2Dmiss'>
<p>Local Linear Estimator of the Two-Dimensional Marker-Dependent Hazard from Missing-Survival-Link Data.</p></a></li>
<li><a href='#medtime'>
<p>Median of the Time Spent in Hospital by Date of Admission.</p></a></li>
<li><a href='#poutcome'>
<p>Probability of Outcome by Cause Specific.</p></a></li>
<li><a href='#rate2Dmiss'>
<p>Local Linear Estimator of the Two-Dimensional Infection (or Hospitalization) Rate from Missing-Survival-Link Data.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Monitoring a Developing Pandemic with Available Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Author:</td>
<td>María Luz Gámiz [aut, cph],
  Enno Mammen [aut, cph],
  María Dolores Martínez-Miranda [aut, cre, cph],
  Jens Perch Nielsen [aut, cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>María Dolores Martínez-Miranda &lt;mmiranda@ugr.es&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Full dynamic system to describe and forecast the spread and the severity
    of a developing pandemic, based on available data. These data are number of infections, 
    hospitalizations, deaths and recoveries notified each day. The system consists of three 
    transitions, infection-infection, infection-hospital and hospital-death/recovery. 
    The intensities of these transitions are dynamic and estimated using non-parametric local
    linear estimators. The package can be used to provide forecasts and survival indicators 
    such as the median time spent in hospital and the probability that a patient who has been
    in hospital for a number of days can leave it alive. Methods are described in Gámiz, 
    Mammen, Martínez-Miranda, and Nielsen (2024) &lt;<a href="https://doi.org/10.48550%2FarXiv.2308.09918">doi:10.48550/arXiv.2308.09918</a>&gt; and 
    &lt;<a href="https://doi.org/10.48550%2FarXiv.2308.09919">doi:10.48550/arXiv.2308.09919</a>&gt;. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-08-30 17:38:02 UTC; Usuario</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-09-04 13:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='pandemics-package'>
Monitoring a Developing Pandemic with Available Data.
</h2><span id='topic+pandemics-package'></span><span id='topic+pandemics'></span>

<h3>Description</h3>

<p>Full dynamic system to describe and forecast the spread
and the severity of a developing pandemic based on typically available data. The system involves three different transitions: infection-infection, infection-hospitalization and hospitalization-death/recovery. The intensities of these transitions are dynamic and estimated using nonparametric local linear estimators.
</p>
<p>Estimation is performed from aggregated data consisting of number of infections (positive tests), hospitalizations, deaths and recoveries notified each day.
</p>
<p>The package can be used to provide forecasts of new infections, hospitalizations and deaths, as well as typical survival indicators such as the median time from admission in hospital to recovery or death, or the probability that a patient who has been in hospital for a number of days can leave it alive.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> pandemics</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 0.1.0</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2024-30-08</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL-2</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>M.L. Gamiz, E. Mammen, M.D. Martinez-Miranda and J.P. Nielsen
</p>
<p>Maintainer: Maria Dolores Martinez-Miranda &lt;mmiranda@ugr.es&gt;
</p>


<h3>References</h3>

<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P.  (2022). Missing link survival analysis with applications to available pandemic data. Computational Statistics &amp; Data Analysis, 169, 107405.
</p>
<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P. (2024a). Low quality exposure and point processes with a view to the first phase of a pandemic. arXiv:2308.09918.
</p>
<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P. (2024b). Monitoring a developing pandemic with available data. arXiv:2308.09919.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Forecasting new infections in October 2020 from data up to 30-Sep
data('covid')
## We remove the first 56 rows  (no data on testing until 13th May)
covid2&lt;-covid[-c(1:56),]
M2&lt;-nrow(covid2)
Hi&lt;-covid2$Hospi
Hi&lt;-Hi[-1]
Ri&lt;-covid2$Recov
Ri&lt;-diff(Ri)
Di&lt;-covid2$Death
Di&lt;-diff(Di)
Pi&lt;-covid2$Posit
M2&lt;-length(Di)
# New hospitalizations are Hi-Ri-Di
newHi&lt;-Hi[-1]-(Hi[-M2]-Ri[-M2]-Di[-M2])
newHi&lt;-as.integer(c(Hi[1],newHi))
newHi[newHi&lt;0]&lt;-0
ddates&lt;-covid2$Date

## 1. First estimate the infection rate
Ms&lt;-141   # up to 30-Sep
Ei.new&lt;-Pi[1:Ms]
delay&lt;-1;Msd&lt;-Ms-delay
Oi.z&lt;-Ei.new[-(1:delay)]
Ei.z1&lt;-Ei.new[1:Msd];
t.grid&lt;-z.grid&lt;-1:Msd
bs&lt;-t(c(5,10))
RInf&lt;-rate2Dmiss(t.grid,z.grid,Oi.z,Ei.z1,bs.grid=bs,cv=FALSE)
RoInf&lt;-RInf$hi.zt

## 2. Forecasting now with a given infection indicator
Cval&lt;-1.5
period&lt;-32  # forecasts up to 1st November, 32 days
fore&lt;-forecasting(Cval,period,RoInf,Pz=Pi[1:Ms],
    newHz=newHi[1:Ms],Hz=Hi[1:Ms],Dz=Di[1:Ms],Rz=Ri[1:Ms])
Pz.pred&lt;-fore$Pz.pred

## 3. Plot forecasts and compare with observed values
## (future values are shown for predictions validation)
Pz.obs&lt;-Pi
yy&lt;-range(Pz.pred,Pz.obs,na.rm=TRUE)
plot(1:(Ms-1),Pz.obs[3:(Ms+1)],ylab='',xlab='Date of notification',
     main='Forecasts of new positives in October 2020',pch=19,
     ylim=yy,xaxt='n',xlim=c(1,Ms+1+period))
oat&lt;-c(1,17,32,47,62,78,93,109,124,139,154,170)
olab&lt;-ddates[oat]
axis(1,at=oat,labels=olab)
points(Ms:(Ms+period-2),Pz.obs[(Ms+2):(Ms+period)],col=1,pch=1)
lines(Ms:(Ms+period-2),Pz.pred[-1],col=2,lty=2,lwd=3)
legend('topleft',c('Data: daily number of new positives until 30-Sep',
    paste('Forecasts with Cval=',round(Cval,2)),
    'True numbers of new positives in October'),
    pch=c(19,NA,1),col=c(1,2,1),lty=c(NA,2,NA),lwd=c(NA,3,NA),bty='n')

</code></pre>

<hr>
<h2 id='covid'>
COVID-19 Outbreak Data in France
</h2><span id='topic+covid'></span>

<h3>Description</h3>

<p>Daily data of COVID-19 cases (positive-tested),  hospitalizations, deaths and recovered published in the open platform for French public data during the period 2020-03-18 to 2020-11-01.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("covid")</code></pre>


<h3>Format</h3>

<p>Data frame with 229 observations and 5 variables:
</p>
<p>[,1] <code>Date</code> Notification date
</p>
<p>[,2] <code>Hospi</code> Daily total number of persons in hospital
</p>
<p>[,3] <code>Death</code> Daily total number of deaths (in hospital)
</p>
<p>[,4] <code>Recov</code> Daily total number of persons discharged from hospital
</p>
<p>[,5] <code>Posit</code> Daily total number of persons tested positive
</p>


<h3>Source</h3>

<p>Data were downloaded from <a href="https://www.data.gouv.fr/es/datasets/">https://www.data.gouv.fr/es/datasets/</a> on 5th of January 2022.
</p>


<h3>References</h3>

<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P. (2024a). Low quality exposure and point processes with a view to the first phase of a pandemic. arXiv:2308.09918.
</p>
<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P. (2024b). Monitoring a developing pandemic with available data. arXiv:2308.09919.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("covid")
Hi&lt;-covid$Hospi
Hi&lt;-Hi[-1]
Ri&lt;-covid$Recov
Ri&lt;-diff(Ri)
Di&lt;-covid$Death
Di&lt;-diff(Di)
M&lt;-length(Di)
## New hospitalizations are Hi-Ri-Di
newHi&lt;-Hi[-1]-(Hi[-M]-Ri[-M]-Di[-M])
newHi&lt;-c(Hi[1],newHi)
newHi[newHi&lt;0]&lt;-0 # (inconsistencies in the data)
plot(covid$Date[-1],newHi,xlab='Notification date',ylab='Number of persons',
main='New hospitalizations',type='l')
</code></pre>

<hr>
<h2 id='forecasting'>
Forecasting infections, hospitalizations and deaths in hospital.</h2><span id='topic+forecasting'></span>

<h3>Description</h3>

<p>Forecasting infections, hospitalizations and deaths in hospital. From estimated two-dimensional rates of infections and hospilizations and estimated hazards of deaths and recoveries, new infections, hospitalizations and deaths are predicted in a forecasting period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>forecasting(Cval=1, period, RoInf, RoHosp, RoDeath, RoRec,
            Pz, newHz, Hz, Dz, Rz)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="forecasting_+3A_cval">Cval</code></td>
<td>

<p>a numeric value with the infection indicator. Default value is <code>Cval=1</code>.
</p>
</td></tr>
<tr><td><code id="forecasting_+3A_period">period</code></td>
<td>

<p>an integer value with the number of days to forecast.
</p>
</td></tr>
<tr><td><code id="forecasting_+3A_roinf">RoInf</code></td>
<td>

<p>a matrix with the estimated rate of infection (<code>M-1</code> times <code>M-1</code>) estimated from <code>M</code> days, evaluating the function  <code>rate2Dmiss</code>.
</p>
</td></tr>
<tr><td><code id="forecasting_+3A_rohosp">RoHosp</code></td>
<td>
<p> (optional)
a matrix with the estimated rate of hospitalization (<code>M</code> times <code>M</code>), obtained evaluating the function  <code>rate2Dmiss</code>.
</p>
</td></tr>
<tr><td><code id="forecasting_+3A_rodeath">RoDeath</code></td>
<td>
<p> (optional)
a matrix with the estimated hazard of deaths  (<code>M</code> times <code>M</code>), obtained  evaluating the function  <code>hazard2Dmiss</code>.
</p>
</td></tr>
<tr><td><code id="forecasting_+3A_rorec">RoRec</code></td>
<td>
<p> (optional)
a matrix with the estimated hazard of recoveries  (<code>M</code> times <code>M</code>), obtained  evaluating the function  <code>hazard2Dmiss</code>.
</p>
</td></tr>
<tr><td><code id="forecasting_+3A_pz">Pz</code></td>
<td>

<p>a vector with the observed (past) number of people tested positive each day (length <code>M</code>).  </p>
</td></tr>
<tr><td><code id="forecasting_+3A_newhz">newHz</code></td>
<td>

<p>a vector with the observed number of new hospitalizations each day (length <code>M</code>).  </p>
</td></tr>
<tr><td><code id="forecasting_+3A_hz">Hz</code></td>
<td>

<p>a vector with the observed total number people in   hospitals each day (length <code>M</code>).  </p>
</td></tr>
<tr><td><code id="forecasting_+3A_dz">Dz</code></td>
<td>

<p>a vector with the observed number of deaths each day (length <code>M</code>).  </p>
</td></tr>
<tr><td><code id="forecasting_+3A_rz">Rz</code></td>
<td>

<p>a vector with the observed number of recoveries each day (length <code>M</code>).  </p>
</td></tr>
</table>


<h3>Details</h3>

<p>To create estimated rates and hazards for the arguments evaluate the functions <code>hazard2Dmiss</code> and <code>rate2Dmiss</code>. If the argument <code>RoHosp</code> is missing then only infections are predicted. If any of the argument <code>RoDeath</code> or <code>RoRec</code> is missing  then deaths (recoveries) are not predicted.
</p>
<p>The infection indicator <code>Cval</code> is typically provided by experts. At the more recent observation (t), it indicates whether the future (t+h, h &gt; 0) will be different or equal to the immediate past. If <code>Cval=1</code> then we can forecast the immediate future based on the immediate past. There might be periods where little is happening (and the indicator might have a tendency
to increase slowly) and there might be few but very important change-points where measures (e.g. lock down) are introduced to minimize future infections (and the indicator might drop dramatically in a matter of days). See Gámiz et al. (2024a) for more details and the relationship to the well-known reproduction number.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>Pz.fitted</code></td>
<td>
<p>a vector with the fitted values for the number of infections in the past. </p>
</td></tr>
<tr><td><code>Pz.pred</code></td>
<td>
<p>a vector with the predicted values for the number of infections in the forecasting period. </p>
</td></tr>
<tr><td><code>newHz.fitted</code></td>
<td>
<p>a vector with the fitted values for the number of hospitalizations in the past. </p>
</td></tr>
<tr><td><code>newHz.pred</code></td>
<td>
<p>a vector with the predicted values for the number of hospitalizations in the forecasting period. </p>
</td></tr>
<tr><td><code>Dz.fitted</code></td>
<td>
<p>a vector with the fitted values for the number of deaths in the past. </p>
</td></tr>
<tr><td><code>Dz.pred</code></td>
<td>
<p>a vector with the predicted values for the number of deaths in the forecasting period. </p>
</td></tr>
<tr><td><code>Rz.fitted</code></td>
<td>
<p>a vector with the fitted values for the number of recoveries in the past. </p>
</td></tr>
<tr><td><code>Rz.pred</code></td>
<td>
<p>a vector with the predicted values for the number of recoveries in the forecasting period. </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>M.L. Gámiz, E. Mammen, M.D. Martínez-Miranda and J.P. Nielsen.
</p>


<h3>References</h3>

<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P. (2024a). Low quality exposure and point processes with a view to the first phase of a pandemic. arXiv:2308.09918.
</p>
<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P. (2024b). Monitoring a developing pandemic with available data. arXiv:2308.09919.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+hazard2Dmiss">hazard2Dmiss</a></code>, <code><a href="#topic+rate2Dmiss">rate2Dmiss</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Forecasting October 2020 from past data
data('covid')
## We remove the first 56 rows(no data on testing until 13th May)
covid2&lt;-covid[-c(1:56),]
M2&lt;-nrow(covid2)
Hi&lt;-covid2$Hospi
Hi&lt;-Hi[-1]
Ri&lt;-covid2$Recov
Ri&lt;-diff(Ri)
Di&lt;-covid2$Death
Di&lt;-diff(Di)
Pi&lt;-covid2$Posit
M2&lt;-length(Di)
# New hospitalizations are Hi-Ri-Di
newHi&lt;-Hi[-1]-(Hi[-M2]-Ri[-M2]-Di[-M2])
newHi&lt;-as.integer(c(Hi[1],newHi))
newHi[newHi&lt;0]&lt;-0
ddates&lt;-covid2$Date

## 1. First we estimate the death and recovery hazards,
## and the infection and hospitalization rates.
## Estimation using data up to 30-Sep-2020
Ms&lt;-141   # up to 30-Sep

## 1.1. Infection rate
Ei.new&lt;-Pi[1:Ms]
delay&lt;-1;Msd&lt;-Ms-delay
Oi.z&lt;-Ei.new[-(1:delay)]
Ei.z1&lt;-Ei.new[1:Msd];
t.grid&lt;-z.grid&lt;-1:Msd
bs&lt;-t(c(5,10))
RInf&lt;-rate2Dmiss(t.grid,z.grid,Oi.z,Ei.z1,
     bs.grid=bs,cv=FALSE)
RoInf&lt;-RInf$hi.zt

## 1.2. Hospitalization rate
Oi.z&lt;-newHi[1:Ms]
# The exposure are the positives data
Ei.z1&lt;-Pi[1:Ms]
t.grid&lt;-z.grid&lt;-1:Ms
bs&lt;-t(c(150,150))
RHosp&lt;-rate2Dmiss(t.grid,z.grid,Oi.z,Ei.z1,
     bs.grid=bs,cv=FALSE)
RoHosp&lt;-matrix(as.numeric(RHosp$hi.zt),Ms,Ms)

## 1.3. Hazards of deaths and recoveries
Oi1.z&lt;-Di[1:Ms]  # deaths
Oi2.z&lt;-Ri[1:Ms]   # recoveries
Ei.z&lt;-Hi[1:Ms]    # exposure is left as cumulative
t.grid&lt;-z.grid&lt;-1:Ms
bs&lt;-t(c(150,40))
res.h&lt;-hazard2Dmiss(t.grid,z.grid,Oi1.z,Oi2.z,Ei.z,
     bs.grid=bs,cv=FALSE)
RoDeath&lt;-as.matrix(res.h$hi1.zt,Ms,Ms) ## 2D-hazard of deaths
RoRec&lt;-as.matrix(res.h$hi2.zt,Ms,Ms) ## 2D-hazard of recoveries

## 2. Forecasting with a given infection indicator
Cval&lt;-1.5
period&lt;-32  # forecasts up to 1st November, 32 days
fore&lt;-forecasting(Cval,period,RoInf,RoHosp,RoDeath,RoRec,
    Pi[1:Ms],newHi[1:Ms],Hi[1:Ms],Di[1:Ms],Ri[1:Ms])
Hz.pred&lt;-fore$newHz.pred
Pz.pred&lt;-fore$Pz.pred
Dz.pred&lt;-fore$Dz.pred

## 3. Plot forecasts and compare with observed values
## (future values are shown for predictions validation)
Pz.obs&lt;-Pi
Hz.obs&lt;-newHi
Dz.obs&lt;-Di

## Graph with the new infections up to 30-Sep and forecasts
yy&lt;-range(Pz.pred,Pz.obs,na.rm=TRUE)
plot(1:(Ms-1),Pz.obs[3:(Ms+1)],ylab='',xlab='Date of notification',
     main='Forecasts of new positives in October 2020',pch=19,
     ylim=yy,xaxt='n',xlim=c(1,Ms+1+period))
oat&lt;-c(1,17,32,47,62,78,93,109,124,139,154,170)
olab&lt;-ddates[oat]
axis(1,at=oat,labels=olab)
## forecasts start on 30-sep but we only plot from 1-October
points(Ms:(Ms+period-2),Pz.obs[(Ms+2):(Ms+period)],col=1,pch=1)
lines(Ms:(Ms+period-2),Pz.pred[-1],col=2,lty=2,lwd=3)
legend('topleft',c('Data: daily number of new positives until 30-Sep',
    paste('Forecasts with Cval=',round(Cval,2)),
    'True numbers of new positives in October'),
    pch=c(19,NA,1),col=c(1,2,1),lty=c(NA,2,NA),lwd=c(NA,3,NA),bty='n')

## Graph with the new hospitalizations up to 30-Sep and forecasts
ylim1&lt;-range(Hz.pred,Hz.obs[-(1:2)],na.rm=TRUE)
plot(1:(Ms-1),Hz.obs[3:(Ms+1)],ylab='',xlab='Date of admission',
     main='Forecasts of new hospitalizations in October 2020',
     pch=19,
     ylim=ylim1,xaxt='n',xlim=c(1,Ms+1+period))
oat&lt;-c(1,17,32,47,62,78,93,109,124,139,154,170)
olab&lt;-ddates[oat]
axis(1,at=oat,labels=olab)
points(Ms:(Ms+period-2),Hz.obs[(Ms+2):(Ms+period)])
lines(Ms:(Ms+period-2),Hz.pred[-1],col=2,lty=2,lwd=2)
legend('topleft',c('Data: daily number of new hospitalizations until 30-Sep',
    paste('Forecasts with Cval=',round(Cval,2)),
    'True numbers of new hospitalizations in October'),
    pch=c(19,NA,1),col=c(1,2,1),lty=c(NA,2,NA),lwd=c(NA,3,NA),bty='n')


## Graph with deaths up to 30-Sep and forecasts
ylim1&lt;-range(Dz.pred,Dz.obs[-(1:2)],na.rm=TRUE)
plot(1:(Ms-1),Dz.obs[3:(Ms+1)],ylab='',xlab='Date of admission',
     main='Forecasts of deaths in October 2020',
     pch=19,ylim=ylim1,xaxt='n',xlim=c(1,Ms+1+period))
oat&lt;-c(1,17,32,47,62,78,93,109,124,139,154,170)
olab&lt;-ddates[oat]
axis(1,at=oat,labels=olab)
points(Ms:(Ms+period-2),Dz.obs[(Ms+2):(Ms+period)])
lines(Ms:(Ms+period-2),Dz.pred[-1],col=2,lty=2,lwd=2)
legend('topleft',c('Data: daily number of deaths until 30-Sep',
    paste('Forecasts with Cval=',round(Cval,2)),
    'True numbers of deaths in October'),
    pch=c(19,NA,1),col=c(1,2,1),lty=c(NA,2,NA),
    lwd=c(NA,3,NA),bty='n')

</code></pre>

<hr>
<h2 id='hazard2D'>
Local Linear Estimator of the Two-Dimensional Marker-Dependent Hazard. 
</h2><span id='topic+hazard2D'></span>

<h3>Description</h3>

<p>Local linear estimator of the marker-dependent hazard introduced by Nielsen (1998). The implementation considers two dimensions only: a one-dimensional marker and time (duration). It assumes aggregated data in the form of occurrences and exposure. The bandwidth can be provided or estimated using  cross-validation (see details below).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hazard2D(t.grid, z.grid, o.zt, e.zt, bs.grid, cv=FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hazard2D_+3A_t.grid">t.grid</code></td>
<td>

<p>a vector of <code>M</code> grid points for the time dimension.
</p>
</td></tr>
<tr><td><code id="hazard2D_+3A_z.grid">z.grid</code></td>
<td>

<p>a vector of <code>M</code> grid points for the marker dimension.
</p>
</td></tr>
<tr><td><code id="hazard2D_+3A_o.zt">o.zt</code></td>
<td>

<p>a matrix of occurrences (<code>M</code> times <code>M</code>).
</p>
</td></tr>
<tr><td><code id="hazard2D_+3A_e.zt">e.zt</code></td>
<td>

<p>a matrix of exposures (<code>M</code> times <code>M</code>).
</p>
</td></tr>
<tr><td><code id="hazard2D_+3A_bs.grid">bs.grid</code></td>
<td>

<p>a matrix with a grid of 2-dimensional bandwidths (by rows).
</p>
</td></tr>
<tr><td><code id="hazard2D_+3A_cv">cv</code></td>
<td>

<p>logical, if <code>cv=TRUE</code> (default) bandwidth is estimated
by cross-validation.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The marker-dependent hazard local linear estimator was introduced by Nielsen (1998) and bandwidth selection provided by Gámiz et al. (2013). It assumes the Aalen multiplicative intensity model. The function implements such estimator in the case of a one-dimensional marker only (first dimension). Data are assumed to be aggregated in the form of occurrences and exposure (see Gámiz et al. 2013) in a two-dimensional grid of values (z,t).
</p>
<p>The estimator involves on a two-dimensional kernel function and a two-dimensional bandwidth. The implemented kernel is multiplicative with <code>K(u)=(3003/2048)*(1-(u)^2)^6)*(abs(u)&lt;1)</code>. The bandwidth can be provided in the argument <code>bs.grid</code>  in the form of a matrix (<code>2</code> times <code>1</code>). Data-driven badwidth selection  is also supported. If <code>cv=TRUE</code> (default) then the bandwith is estimated using cross-validation from a grid of <code>nb</code> two-dimensional bandwidths provided in <code>bs.grid</code> (<code>nb</code> times <code>2</code>).
</p>
<p>This marker-dependent hazard local linear estimator assumes that full information is available in the form of occurrences and exposures. In a emergent or developing pandemic, this estimator will most likely be infeasible from typically available data. Thus, the estimator will  be computed after the necessary information is estimated through the function <code>hazard2Dmiss()</code>.  See Gámiz et al. (2022,2024a,b) for more details.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>hi.zt</code></td>
<td>
<p>A (<code>M</code> times <code>M</code>) matrix with the estimated hazard evaluated at the grid points.</p>
</td></tr>
<tr><td><code>bcv</code></td>
<td>
<p>A two-dimensional vector with the bandwidth used to compute the estimator (estimated by cross-validation if <code>cv=TRUE</code>).</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Infeasible estimator to be evaluated through the function <code>hazard2Dmiss()</code>.
</p>


<h3>Author(s)</h3>

<p>M.L. Gámiz, E. Mammen, M.D. Martínez-Miranda and J.P. Nielsen.
</p>


<h3>References</h3>

<p>Gámiz, M.L., Janys, L., Martínez-Miranda,  M.D. and Nielsen, J.P.  (2013). Bandwidth selection in marker
dependent kernel hazard estimation. Computational Statistics &amp; Data Analysis,  68, 155–169.
</p>
<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P.  (2022). Missing link survival analysis with applications to available pandemic data. Computational Statistics &amp; Data Analysis, 169, 107405.
</p>
<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P. (2024a). Low quality exposure and point processes with a view to the first phase of a pandemic. arXiv:2308.09918.
</p>
<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P. (2024b). Monitoring a developing pandemic with available data. arXiv:2308.09919.
</p>
<p>Nielsen, J.P. (1998). Marker dependent kernel estimation from local linear estimation.  Scandinavian Actuarial Journal, 2, 113-124.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+hazard2Dmiss">hazard2Dmiss</a></code>, <code><a href="#topic+rate2Dmiss">rate2Dmiss</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## 1. Define a true 2D-hazard evaluated at M*M grid points
M&lt;-100
alpha&lt;-dbeta((1:M)/(M+1),2,2)/(M+1)
alpha.zt&lt;-matrix(NA,M,M)
for(z in 1:M) for (t in 1:(M-z+1)) alpha.zt[z,t]&lt;-alpha[z]*alpha[t]

## 2. Simulate data from the true hazard (Aalen multiplicative model)
N&lt;-10000 # sample size
set.seed(1)
##  simulate new arrivals
Ei.new&lt;-hist(sort(runif(n=N,max=M)),breaks=0:M,plot=FALSE)$counts
##  simulate matrices of exposure (e.zt) and occurrences (o.zt)
o.zt&lt;-e.zt&lt;-matrix(0,M,M)
e.zt[,1]&lt;-as.integer(Ei.new)
for(z in 1:M)  for (t in 1:(M-z+1)){
 if(e.zt[z,t]&gt;0) o.zt[z,t]&lt;-rbinom(1,as.integer(e.zt[z,t]),alpha.zt[z,t]) 
    else o.zt[z,t]&lt;-0
 if(t&lt;(M-z+1)) e.zt[z,(t+1)]&lt;-e.zt[z,t]-o.zt[z,t]
 }

## 3. Estimate the 2d-hazard with fixed bandwidth
bs.grid&lt;-t(c(M/2,M/2))
alpha.estim&lt;-hazard2D(1:M,1:M,o.zt,e.zt,bs.grid,cv=FALSE)

## 4. Compare true and estimated hazards
persp(1:M,1:M,alpha.zt,main='True hazard',theta=60,xlab='z',ylab='t',zlab='')
persp(1:M,1:M,alpha.estim$hi.zt,main='Estimated hazard',theta=60,
      xlab='z',ylab='t',zlab='')

</code></pre>

<hr>
<h2 id='hazard2Dmiss'>
Local Linear Estimator of the Two-Dimensional Marker-Dependent Hazard from Missing-Survival-Link Data. 
</h2><span id='topic+hazard2Dmiss'></span>

<h3>Description</h3>

<p>Local linear estimator of the marker-dependent hazard in the case of missing-survival-link data. Hazard is assumed to have two dimensions: a one-dimensional marker (typically the notification date) and time (duration). It is assumed the situation of observing aggregated data in the form of occurrences and exposures. The missing-survival link problem means that the duration is not directly observed. The estimator follows from an iterative algorithm where, at each step, full information including duration is estimated first and then, the local linear estimator is computed evaluating the function <code>hazard2D</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hazard2Dmiss(t.grid, z.grid, Oi1.z, Oi2.z, Ei.z, bs.grid,
    cv=TRUE, epsilon=1e-4, max.ite=50)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hazard2Dmiss_+3A_t.grid">t.grid</code></td>
<td>

<p>a vector of <code>M</code> grid points for the time dimension.
</p>
</td></tr>
<tr><td><code id="hazard2Dmiss_+3A_z.grid">z.grid</code></td>
<td>

<p>a vector of <code>M</code> grid points for the marker dimension.
</p>
</td></tr>
<tr><td><code id="hazard2Dmiss_+3A_oi1.z">Oi1.z</code></td>
<td>

<p>a vector of length <code>M</code> with the number of deaths notified each day in <code>z.grid</code>.</p>
</td></tr>
<tr><td><code id="hazard2Dmiss_+3A_oi2.z">Oi2.z</code></td>
<td>

<p>a vector of length <code>M</code> with the number of recoveries notified each day in <code>z.grid</code>.</p>
</td></tr>
<tr><td><code id="hazard2Dmiss_+3A_ei.z">Ei.z</code></td>
<td>

<p>a vector of length <code>M</code> with the total number of people in the hospital each day in <code>z.grid</code>.. 
</p>
</td></tr>
<tr><td><code id="hazard2Dmiss_+3A_bs.grid">bs.grid</code></td>
<td>

<p>a matrix with a grid of 2-dimensional bandwidths (by rows).
</p>
</td></tr>
<tr><td><code id="hazard2Dmiss_+3A_cv">cv</code></td>
<td>

<p>logical, if <code>cv=TRUE</code> (default) bandwidth is estimated by cross-validation.
</p>
</td></tr>
<tr><td><code id="hazard2Dmiss_+3A_epsilon">epsilon</code></td>
<td>
 
<p>a numeric value with the tolerance in the iterative algorithm. Default value is <code>epsilon=1e-4</code>.</p>
</td></tr>
<tr><td><code id="hazard2Dmiss_+3A_max.ite">max.ite</code></td>
<td>
 
<p>a integer value with the maximum number of iterations in the iterative algorithm. Default value is <code>max.ite=50</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Hazard is assumed having two dimensions: a one-dimensional marker  and time. It is assumed the situation of observing aggregated data in the form of occurrences and exposure, as  the function <code>hazard2D</code> does. The difference is that the time  dimension (duration) is not observed. The estimator follows from an iterative algorithm where, at each step, full information, estimating the duration, is constructed first and then the local linear estimator is computed by evaluating the function <code>hazard2D</code>. 
</p>
<p>Missing-link-survival data means that duration is not observed directly. Each day (z), we get information on number of people remaining in hospital (exposure, Ei.z), the number of deaths (Oi1.z) and the number of recoveries (Oi2.z) on that day.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>hi.zt</code></td>
<td>
<p>a (<code>M</code> times <code>M</code>) matrix with the estimated hazard (death+recovery) evaluated at the grid points.</p>
</td></tr>
<tr><td><code>hi1.zt</code></td>
<td>
<p>a (<code>M</code> times <code>M</code>) matrix with the estimated hazard of deaths evaluated at the grid points.</p>
</td></tr>
<tr><td><code>hi2.zt</code></td>
<td>
<p>a (<code>M</code> times <code>M</code>) matrix with the estimated hazard of recoveries evaluated at the grid points.</p>
</td></tr>
<tr><td><code>bcv</code></td>
<td>
<p>a two-dimensional vector with the bandwidth used to compute the estimator (estimated by cross-validation if <code>cv=TRUE</code>).</p>
</td></tr>
<tr><td><code>tol</code></td>
<td>
<p>a numeric value with the achieved tolerance value in the algorithm.</p>
</td></tr>
<tr><td><code>it</code></td>
<td>
<p>an integer with the number of iterations performed in the algorithm.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>M.L. Gámiz, E. Mammen, M.D. Martínez-Miranda and J.P. Nielsen.
</p>


<h3>References</h3>

<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P.  (2022). Missing link survival analysis with applications to available pandemic data. Computational Statistics &amp; Data Analysis, 169, 107405.
</p>
<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P. (2024a). Low quality exposure and point processes with a view to the first phase of a pandemic. arXiv:2308.09918.
</p>
<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P. (2024b). Monitoring a developing pandemic with available data. arXiv:2308.09919.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+hazard2D">hazard2D</a></code>, <code><a href="#topic+medtime">medtime</a></code>, <code><a href="#topic+poutcome">poutcome</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Survival analysis of duration in covid-19 data
data('covid')
Ei.z&lt;-covid$Hospi   # exposure for survival analysis
Oi1.z&lt;-covid$Death  # deaths
Oi2.z&lt;-covid$Recov  # recoveries
## compute incremental values
Oi1.z&lt;-diff(Oi1.z)
Oi2.z&lt;-diff(Oi2.z)
Ei.z&lt;-Ei.z[-1]     # exposure is cumulative
M&lt;-length(Ei.z)
t.grid&lt;-z.grid&lt;-1:M
## notification date (marker)
ddates&lt;-covid$Date

## Hazard estimate with a fixed bandwidth
bs&lt;-t(c(150,150))
res.h&lt;-hazard2Dmiss(t.grid,z.grid,Oi1.z,Oi2.z,Ei.z,bs.grid=bs,cv=FALSE)
hi1.zt&lt;-res.h$hi1.zt ## 2D-hazard of recoveries
hi2.zt&lt;-res.h$hi2.zt ## 2D-hazard of deaths

## Plot of hazard of deaths on several dates
z1&lt;-c(13,44,105,197)
zdates&lt;-ddates[z1] ; nz&lt;-length(z1)
t.min&lt;-35  # consider a maximum duration of 35 days for the plots
ti&lt;-1:t.min ; n0&lt;-length(ti)

yy&lt;-range(hi1.zt[z1,1:n0],na.rm=TRUE)
yy[1]&lt;-yy[1]-.0003;yy[2]&lt;-yy[2]+.03
plot(ti,hi1.zt[nz,1:n0], main='Deaths',type='l',
  xlab='Time (days) from admission',ylab='Hazard',ylim=yy)
for(i in 2:nz) lines(ti,hi1.zt[z1[i-1],1:n0],lwd=3,col=i,lty=i)
legend('topright',c('Date of admision', as.character(zdates)),
  lty=c(NA,2:nz,1),lwd=c(NA,rep(3,nz-1),2),col=c(NA,2:nz,1),bty='n')

## Same for recoveries 
yy&lt;-range(hi2.zt[z1,1:n0],na.rm=TRUE)
yy[2]&lt;-yy[2]+.05
plot(ti,hi2.zt[nz,1:n0], main='Recoveries',type='l',
    xlab='Time (days) from admission',ylab='Hazard',ylim=yy)
for(i in 2:nz) lines(ti,hi2.zt[z1[i-1],1:n0],lwd=3,col=i,lty=i)
    legend('topright',c('Date of admision',as.character(zdates)),
    lty=c(NA,2:nz,1),lwd=c(NA,rep(3,nz-1),2),col=c(NA,2:nz,1),bty='n')

</code></pre>

<hr>
<h2 id='medtime'>
Median of the Time Spent in Hospital by Date of Admission. 
</h2><span id='topic+medtime'></span>

<h3>Description</h3>

<p>From the two-dimensional estimated hazard of death/recovery, the median of the time spent in hospital is computed  depending on the date of admission.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>medtime(hi.zt,z1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="medtime_+3A_hi.zt">hi.zt</code></td>
<td>

<p>a matrix with the estimated hazard of death+recovery  (<code>M</code> times <code>M</code>), obtained  evaluating the function  <code>hazard2Dmiss</code>.
</p>
</td></tr>
<tr><td><code id="medtime_+3A_z1">z1</code></td>
<td>

<p>(optional) a vector of indexes between 1 and <code>M</code> indicating the admission days to evaluate the median. If missing then <code>z1&lt;-c(seq(1,M-1,by=2),M-1)</code>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector with the computed median times for each day in <code>z1</code>.</p>


<h3>Note</h3>

<p>Evaluate the function <code>hazard2Dmiss</code> to create the estimated hazard for the argument <code>hi.zt</code>. 
</p>


<h3>Author(s)</h3>

<p>M.L. Gámiz, E. Mammen, M.D. Martínez-Miranda and J.P. Nielsen.
</p>


<h3>References</h3>

<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P. (2024b). Monitoring a developing pandemic with available data. arXiv:2308.09919.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+hazard2Dmiss">hazard2Dmiss</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data('covid')
Ei.z&lt;-covid$Hospi   # exposure for survival analysis
Oi1.z&lt;-covid$Death  # deaths
Oi2.z&lt;-covid$Recov  # recoveries
# compute incremental values
Oi1.z&lt;-diff(Oi1.z)
Oi2.z&lt;-diff(Oi2.z)
Ei.z&lt;-Ei.z[-1]     # exposure is left as cumulative
M&lt;-length(Ei.z)
t.grid&lt;-z.grid&lt;-1:M
# notification date (marker)
ddates&lt;-covid$Date

## First compute the estimated hazard
bs&lt;-t(c(150,150))
res.h&lt;-hazard2Dmiss(t.grid,z.grid,Oi1.z,Oi2.z,Ei.z,bs.grid=bs,cv=FALSE)
hi.zt&lt;-res.h$hi.zt # =hi2.zt+hi1.zt (two possible outcomes)

## Now the median time at few values of the marker (admission dates)
z1&lt;-c(seq(1,M-1,by=30),M-1)
nz&lt;-length(z1)
res&lt;-medtime(hi.zt,z1)

plot(z1,res,ylab='days',xaxt = "n",type='p',pch=16,
  xlim=range(z1), xlab='Date of admission',
  main='Median time from admission to exit (death+recovery)')
axis(1,at=z1,labels=ddates[z1],cex=1.2)

</code></pre>

<hr>
<h2 id='poutcome'>
Probability of Outcome by Cause Specific. 
</h2><span id='topic+poutcome'></span>

<h3>Description</h3>

<p>From the two-dimensional estimated hazards of deaths and recoveries, the probability that a person, who has been in hospital for a number of days, leaves the hospital  alive or death, depending on the date of admission.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poutcome(hi1.zt,hi2.zt,z1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="poutcome_+3A_hi1.zt">hi1.zt</code></td>
<td>

<p>a matrix with the estimated hazard of deaths  (<code>M</code> times <code>M</code>). 
</p>
</td></tr>
<tr><td><code id="poutcome_+3A_hi2.zt">hi2.zt</code></td>
<td>

<p>a matrix with the estimated hazard of recoveries  (<code>M</code> times <code>M</code>). 
</p>
</td></tr>
<tr><td><code id="poutcome_+3A_z1">z1</code></td>
<td>

<p>(optional) a vector of indexes between 1 and <code>M</code> indicating the admission days to evaluate the probabilities. If missing then <code>z1&lt;-c(seq(1,M-1,by=2),M-1)</code>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>alive.zt</code></td>
<td>
<p> a matrix (<code>M</code> times <code>M</code>) with the computed probabilities of leaving the hospital alive (each column corresponds to a day in <code>z1</code>).</p>
</td></tr>
<tr><td><code>death.zt</code></td>
<td>
<p> a matrix (<code>M</code> times <code>M</code>) with the computed probabilities of dying in hospital (each column corresponds to a day in <code>z1</code>).</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Evaluate the function <code>hazard2Dmiss</code> to create the estimated hazards for the arguments <code>hi1.zt</code> and <code>hi2.zt</code>. 
</p>


<h3>Author(s)</h3>

<p>M.L. Gámiz, E. Mammen, M.D. Martínez-Miranda and J.P. Nielsen.
</p>


<h3>References</h3>

<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P. (2024b). Monitoring a developing pandemic with available data. arXiv:2308.09919.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+hazard2Dmiss">hazard2Dmiss</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data('covid')
Ei.z&lt;-covid$Hospi   # exposure for survival analysis
Oi1.z&lt;-covid$Death  # deaths
Oi2.z&lt;-covid$Recov  # recoveries
# compute incremental values
Oi1.z&lt;-diff(Oi1.z)
Oi2.z&lt;-diff(Oi2.z)
Ei.z&lt;-Ei.z[-1]     # exposure is left as cumulative
M&lt;-length(Ei.z)
t.grid&lt;-z.grid&lt;-1:M
# notification date (marker)
ddates&lt;-covid$Date

## First compute the estimated hazard
bs&lt;-t(c(150,150))
res.h&lt;-hazard2Dmiss(t.grid,z.grid,Oi1.z,Oi2.z,Ei.z,bs.grid=bs,cv=FALSE)
hi1.zt&lt;-res.h$hi1.zt # 2D-hazard of deaths
hi2.zt&lt;-res.h$hi2.zt # 2D-hazard of recoveries

## Now the probabilities at few values of the marker (admission dates)
z1&lt;-c(13,44,105,197)
zdates&lt;-ddates[z1]
nz&lt;-length(z1)
t.min&lt;-35  # maximum duration is 35
ti&lt;-1:t.min;n0&lt;-length(ti)
res&lt;-poutcome(hi1.zt,hi2.zt,z1)
alive.zt&lt;-res$alive.zt
death.zt&lt;-res$death.zt

# Cause= recovery
plot(ti,alive.zt[1:n0,1],ylim=c(0,1),lwd=2,type='l',
     main='Probability to get out alive',
     ylab='',xlab='Time from admission (days)')
for(i in 2:nz) lines(ti,alive.zt[1:n0,i-1],lwd=3,col=i,lty=i)
legend('bottom',legend=zdates,lty=c(2:nz,1),
  lwd=c(rep(3,nz-1),2),col=c(2:nz,1),bty='n')

# Cause= death
plot(ti,death.zt[1:n0,1],ylim=c(0,1),lwd=2,type='l',
     main='Probability of dying in the hospital',
     ylab='',xlab='Time from admission (days)')
for(i in 2:nz) lines(ti,death.zt[1:n0,i-1],lwd=3,col=i,lty=i)
legend('top',legend=zdates,lty=c(2:nz,1),lwd=c(rep(3,nz-1),2),
       col=c(2:nz,1),bty='n')

</code></pre>

<hr>
<h2 id='rate2Dmiss'>
Local Linear Estimator of the Two-Dimensional Infection (or Hospitalization) Rate from Missing-Survival-Link Data.
</h2><span id='topic+rate2Dmiss'></span>

<h3>Description</h3>

<p>Local linear estimator of the infection or the hospitalization rate in the case of missing-survival-link data (Gámiz et al. 2024a). The rate is assumed to have two dimensions: a one-dimensional marker (typically the notification date) and time (duration). It is assumed the situation of observing aggregated data in the form of occurrences and exposures. The missing-survival link problem means that the duration is not directly observed. The estimator follows from an iterative algorithm where, at each step, full information including duration is estimated first and then, the local linear estimator is computed evaluating the function <code>hazard2D</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rate2Dmiss(t.grid, z.grid, Oi.z, Ei.z1, bs.grid,
    cv=TRUE, epsilon=1e-4, max.ite=50)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rate2Dmiss_+3A_t.grid">t.grid</code></td>
<td>

<p>a vector of <code>M</code> grid points for the time dimension.
</p>
</td></tr>
<tr><td><code id="rate2Dmiss_+3A_z.grid">z.grid</code></td>
<td>

<p>a vector of <code>M</code> grid points for the marker dimension.
</p>
</td></tr>
<tr><td><code id="rate2Dmiss_+3A_oi.z">Oi.z</code></td>
<td>

<p>a vector of length <code>M</code> with the number of people tested positive (infection rate) or with the number of hospitalizations (hospitalization rate) notified  ech day in <code>z.grid</code>.
</p>
</td></tr>
<tr><td><code id="rate2Dmiss_+3A_ei.z1">Ei.z1</code></td>
<td>

<p>a vector of length <code>M</code> with the number of people tested positive   notified  each day in <code>z.grid</code>.
</p>
</td></tr>
<tr><td><code id="rate2Dmiss_+3A_bs.grid">bs.grid</code></td>
<td>

<p>a matrix with a grid of 2-dimensional bandwidths (by rows).
</p>
</td></tr>
<tr><td><code id="rate2Dmiss_+3A_cv">cv</code></td>
<td>

<p>logical, if <code>cv=TRUE</code> (default) bandwidth is estimated by cross-validation.
</p>
</td></tr>
<tr><td><code id="rate2Dmiss_+3A_epsilon">epsilon</code></td>
<td>
  
<p>a numeric value with the tolerance in the iterative algorithm. Default value is <code>epsilon=1e-4</code>.</p>
</td></tr>
<tr><td><code id="rate2Dmiss_+3A_max.ite">max.ite</code></td>
<td>
  
<p>an integer value with the maximum number of iterations in the iterative algorithm. Default value is <code>max.ite=50</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Hazard is assumed having two dimensions: a one-dimensional marker (typically the notification date) and time (duration). It is assumed the situation of observing aggregated data in the form of occurrences and exposure, as  the function <code>hazard2D</code> does. The difference is that the time dimension (duration) is not directly observed. The estimator follows from an iterative algorithm where, at each step, full information, estimating the duration, is constructed first and then the local linear estimator is computed evaluating the function <code>hazard2D</code>. See more details on the local linear hazard estimator in the documentation of <code><a href="#topic+hazard2D">hazard2D</a></code>.
</p>
<p>To estimate the infection rate we assume that each day (z), we have information on the number of people tested positive. The vector of occurrences (<code>Oi.z</code>)  is the observed number of people tested positive each day, removing the first <code>d</code> days. Here <code>d</code> is typically 1 (an infected person might infect one day after being tested positive), see the examples below. The vector of exposure (<code>Ei.z</code>) is the observed number of people tested positive each day, removing the last <code>d</code> days.
</p>
<p>To estimate the hospitalization rate we assume that each day (z), we have information on  the number of new hospitalizations (<code>Oi.z</code>), and the number of people tested positive (<code>Ei.z</code>)  each day.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>hi.zt</code></td>
<td>
<p>a (<code>M</code> times <code>M</code>) matrix with the estimated rate evaluated at the grid points.</p>
</td></tr>
<tr><td><code>bcv</code></td>
<td>
<p>a two-dimensional vector with the bandwidth used to compute the estimator (estimated by cross-validation if <code>cv=TRUE</code>).</p>
</td></tr>
<tr><td><code>tol</code></td>
<td>
<p>a numeric value with the achieved tolerance value in the algorithm.</p>
</td></tr>
<tr><td><code>it</code></td>
<td>
<p>an integer with the number of iterations performed in the algorithm.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>M.L. Gámiz, E. Mammen, M.D. Martínez-Miranda and J.P. Nielsen.
</p>


<h3>References</h3>

<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P. (2024a). Low quality exposure and point processes with a view to the first phase of a pandemic. arXiv:2308.09918.
</p>
<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P. (2024b). Monitoring a developing pandemic with available data. arXiv:2308.09919.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+hazard2D">hazard2D</a></code>, <code><a href="#topic+forecasting">forecasting</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Analysis of the infection and hospitalization processes
## data are (cumulative) number of hospitalizations and positive tested

data('covid')
## We remove the first 56 rows (no data on testing until 13th May)
covid2&lt;-covid[-c(1:56),]
M2&lt;-nrow(covid2)

## 1. Rate of infection
Ei.new&lt;-covid2$Posit
delay&lt;-1;M2&lt;-M2-delay
Oi.z&lt;-Ei.new[-(1:delay)]; Ei.z1&lt;-Ei.new[1:M2]
t.grid&lt;-z.grid&lt;-1:M2
bs&lt;-t(c(5,10))
RInf&lt;-rate2Dmiss(t.grid,z.grid,Oi.z,Ei.z1,bs.grid=bs,cv=FALSE,
       epsilon=1e-4,max.ite=50)
hi.zt&lt;-RInf$hi.zt # the estimated infection rate

## Plot the estimated infection rate at few notification days
ddates&lt;-covid2$Date
z1&lt;-c(19,49,80,141)
nz&lt;-length(z1)
zdates&lt;-ddates[z1]
t.min&lt;-min(M2-z1+1)
ti&lt;-1:t.min;n0&lt;-length(ti)

## displaced curves
alphas.I&lt;-matrix(NA,M2,M2) # upper-triangular matrix
for(j in 1:M2) alphas.I[j,j:M2]&lt;-hi.zt[j,1:(M2-j+1)]
alphas&lt;-alphas.I[z1,-(1:18)]
M2a&lt;-ncol(alphas)
yy&lt;-c(0,max(alphas,na.rm=TRUE)+0.1)

plot(1:M2a,alphas[nz,],type='l',ylab='',xlab='Date of notification',
      main= 'Dynamic rate of infection',ylim=yy,lwd=2,lty=1,xaxt='n')
axis(1,at=z1-18,labels=c(zdates))
for (i in 2:nz) lines(1:M2a,alphas[i-1,],lwd=3,col=i,lty=i)
legend('topleft',c('Starting on date:',as.character(zdates)),
     lty=c(NA,2:nz,1),lwd=c(NA,rep(3,nz-1),2),col=c(NA,2:nz,1),bty='n')

## 2. Rate of hospitalization
Hi&lt;-covid2$Hospi ; Hi&lt;-Hi[-1]
Ri&lt;-covid2$Recov ; Ri&lt;-diff(Ri)
Di&lt;-covid2$Death ; Di&lt;-diff(Di)
M2&lt;-length(Di)
## New hospitalizations are Hi-Ri-Di
newHi&lt;-Hi[-1]-(Hi[-M2]-Ri[-M2]-Di[-M2])
newHi&lt;-c(Hi[1],newHi)
newHi[newHi&lt;0]&lt;-0; # possible inconsistency in the data
Oi.z&lt;-as.integer(newHi)
Ei.z1&lt;-covid2$Posit
t.grid&lt;-z.grid&lt;-1:M2
bs&lt;-t(c(20,10))
RHosp&lt;-rate2Dmiss(t.grid,z.grid,Oi.z,Ei.z1,bs.grid=bs,cv=FALSE,
     epsilon=1e-4,max.ite=50)
hi.zt&lt;-RHosp$hi.zt # the estimated rate

## Plot the estimated rate at few notification days
z1&lt;-c(19,49,80,141)
nz&lt;-length(z1)
zdates&lt;-ddates[z1]
t.min&lt;-min(M2-z1+1)
ti&lt;-1:t.min;n0&lt;-length(ti)
## displaced curves
alphas.I&lt;-matrix(NA,M2,M2) # upper-triangular matrix
for(j in 1:M2) alphas.I[j,j:M2]&lt;-hi.zt[j,1:(M2-j+1)]
alphas&lt;-alphas.I[z1,-(1:18)]
M2a&lt;-ncol(alphas)
yy&lt;-c(0,max(alphas,na.rm=TRUE)+0.01)
plot(1:M2a,alphas[nz,],type='l',ylab='',xlab='Date of notification',
     main= 'Dynamic rate of hospitalization',ylim=yy,lwd=2,xaxt='n')
axis(1,at=z1-18,labels=c(zdates))
for (i in 2:nz) lines(1:M2a,alphas[i-1,],lwd=3,col=i,lty=i)
legend('topright',c('Starting on date:',as.character(zdates)),
    lty=c(NA,2:nz,1),lwd=c(NA,rep(3,nz-1),2),col=c(NA,2:nz,1),bty='n')
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
