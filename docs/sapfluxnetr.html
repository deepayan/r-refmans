<!DOCTYPE html><html><head><title>Help for package sapfluxnetr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {sapfluxnetr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#.accumulated_posix_aware'><p>accumulated function</p></a></li>
<li><a href='#.assert_that_period_is_valid'><p>test for character period</p></a></li>
<li><a href='#.collapse_timestamp'><p>.collapse_timestamp helper</p></a></li>
<li><a href='#.env_vars_names'><p>helper to return all environmental variable names</p></a></li>
<li><a href='#.fixed_metrics_funs'><p>helper function to generate the fixed metrics</p></a></li>
<li><a href='#.flag'><p>helper function to flag the mutated data in sfn_mutate and sfn_mutate_at</p></a></li>
<li><a href='#.metadata_architecture'><p>Metadata variables architecture</p></a></li>
<li><a href='#.nightly_daily_cf'><p>Period custom function</p></a></li>
<li><a href='#.parse_period'><p>.parse_period</p></a></li>
<li><a href='#.period_to_minutes'><p>transform period to minutes</p></a></li>
<li><a href='#.sapflow_tidy'><p>.sapflow_tidy helper</p></a></li>
<li><a href='#.timezone_dic'><p>Timezones dictionary</p></a></li>
<li><a href='#.write_metadata_cache'><p>Write metadata cache file to disk</p></a></li>
<li><a href='#+25+26gt+3B+25'><p>Reexporting the pipe operator</p></a></li>
<li><a href='#ARG_MAZ'><p>ARG_MAZ sapfluxnet site</p></a></li>
<li><a href='#ARG_TRE'><p>ARG_TRE sapfluxnet site</p></a></li>
<li><a href='#as_sfn_data_multi'><p>as_sfn_data_multi helper</p></a></li>
<li><a href='#AUS_CAN_ST2_MIX'><p>AUS_CAN_ST2_MIX sapfluxnet site</p></a></li>
<li><a href='#data_coverage'><p>data coverage</p></a></li>
<li><a href='#describe_md_variable'><p>Detailed description of metadata variables</p></a></li>
<li><a href='#diurnal_centroid'><p>Diurnal centroid calculation</p></a></li>
<li><a href='#filter_sites_by_md'><p>Filter the sites by metadata variable values</p></a></li>
<li><a href='#get_timezone'><p>get the timezone of the site</p></a></li>
<li><a href='#initialize+2Csfn_data_multi-method'><p>Initialize method for sfn_data multi</p></a></li>
<li><a href='#initialize+2Csfn_data-method'><p>Initialize method for sfn_data</p></a></li>
<li><a href='#metrics'><p>Complete metrics wrappers</p></a></li>
<li><a href='#metrics_tidyfier'><p>Build a tidy data frame from the metrics results nested list</p></a></li>
<li><a href='#norm_diurnal_centroid'><p>Normalized diurnal centroid calculation</p></a></li>
<li><a href='#read_sfn_data'><p>Read sfn_data from disk</p></a></li>
<li><a href='#read_sfn_metadata'><p>Read and combine all metadata</p></a></li>
<li><a href='#sfn_data_multi_validity'><p>Validity method for sfn_data_multi class</p></a></li>
<li><a href='#sfn_data_multi-class'><p>S4 class for sapfluxnet multi-site data</p></a></li>
<li><a href='#sfn_data_validity'><p>Validity method for sfn_data class</p></a></li>
<li><a href='#sfn_data-class'><p>S4 class for sapfluxnet site data</p></a></li>
<li><a href='#sfn_filter'><p>Filter sfn_data by variable/s value</p></a></li>
<li><a href='#sfn_get_generics'><p>sfn_data custom get generics</p></a></li>
<li><a href='#sfn_get_methods'><p>sfn_data get methods</p></a></li>
<li><a href='#sfn_metadata_ex'><p>sfn_metadata cache file for example data (ARG_MAZ, ARG_TRE and AUS_CAN_ST2_MIX)</p></a></li>
<li><a href='#sfn_metrics'><p>Metrics summary function</p></a></li>
<li><a href='#sfn_multi_get_methods'><p>sfn_data_multi get methods</p></a></li>
<li><a href='#sfn_mutate'><p>Mutate variables by function</p></a></li>
<li><a href='#sfn_mutate_at'><p>Mutate selected columns by function</p></a></li>
<li><a href='#sfn_plot'><p>plot method for sfn_data class</p></a></li>
<li><a href='#sfn_replacement_generics'><p>sfn_data replacement generics</p></a></li>
<li><a href='#sfn_replacement_methods'><p>sfn_data replacement methods</p></a></li>
<li><a href='#sfn_sites_in_folder'><p>list available sites in a db folder</p></a></li>
<li><a href='#sfn_vars_to_filter'><p>List all variables that can be used to filter sites</p></a></li>
<li><a href='#show+2Csfn_data_multi-method'><p>Show method for sfn_data_multi</p></a></li>
<li><a href='#show+2Csfn_data-method'><p>Show method for sfn_data</p></a></li>
<li><a href='#summarise_by_period'><p>Summaries by period</p></a></li>
<li><a href='#time_at_events'><p>time at maximum/minimum</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Working with 'Sapfluxnet' Project Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.4</td>
</tr>
<tr>
<td>Description:</td>
<td>Access, modify, aggregate and plot data from the 'Sapfluxnet' project
  (<a href="http://sapfluxnet.creaf.cat">http://sapfluxnet.creaf.cat</a>), the first global database of sap flow measurements.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>assertthat, dplyr, furrr, ggplot2, glue, lubridate, magrittr,
methods, purrr, rlang, stats, stringr, tibble, tidyr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Collate:</td>
<td>'data.R' 'getters.R' 'helpers.R' 'imports.R' 'metrics.R'
'sfn_data_classes.R' 'sfn_data_generics.R' 'sfn_data_methods.R'
'sfn_dplyr.R' 'visualizations.R'</td>
</tr>
<tr>
<td>Suggests:</td>
<td>future, knitr, remotes, rmarkdown, testthat, xtable</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Config/testthat/parallel:</td>
<td>true</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/sapfluxnet/sapfluxnetr">https://github.com/sapfluxnet/sapfluxnetr</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/sapfluxnet/sapfluxnetr/issues">https://github.com/sapfluxnet/sapfluxnetr/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-01-25 15:10:46 UTC; malditobarbudo</td>
</tr>
<tr>
<td>Author:</td>
<td>Victor Granda <a href="https://orcid.org/0000-0002-0469-1991"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Rafael Poyatos <a href="https://orcid.org/0000-0003-0521-2523"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Victor Flo <a href="https://orcid.org/0000-0003-1908-4577"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Jacob Nelson <a href="https://orcid.org/0000-0002-4663-2420"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Sapfluxnet Core Team [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Victor Granda &lt;victorgrandagarcia@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-01-25 15:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='.accumulated_posix_aware'>accumulated function</h2><span id='topic+.accumulated_posix_aware'></span>

<h3>Description</h3>

<p>sum for summarise_all aware of POSIX objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.accumulated_posix_aware(variable, na.rm = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id=".accumulated_posix_aware_+3A_variable">variable</code></td>
<td>
<p>the variable as it is passed to the .fixed_metrics function</p>
</td></tr>
<tr><td><code id=".accumulated_posix_aware_+3A_na.rm">na.rm</code></td>
<td>
<p>logical to pass to na.rm argument from sum</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the sum for any other variables, but the first for POSIXct variables
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sapfluxnetr:::.accumulated_posix_aware(c(50,20))
sapfluxnetr:::.accumulated_posix_aware(c(Sys.time(), Sys.time() -1))

</code></pre>

<hr>
<h2 id='.assert_that_period_is_valid'>test for character period</h2><span id='topic+.assert_that_period_is_valid'></span>

<h3>Description</h3>

<p>test for character period
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.assert_that_period_is_valid(period)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id=".assert_that_period_is_valid_+3A_period">period</code></td>
<td>
<p>&quot;frequency period&quot;</p>
</td></tr>
</table>


<h3>Value</h3>

<p>TRUE if is valid, informative error if not.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sapfluxnetr:::.assert_that_period_is_valid('1 day') # TRUE
# not run
# sapfluxnetr:::.assert_that_period_is_valid('1day') # error

</code></pre>

<hr>
<h2 id='.collapse_timestamp'>.collapse_timestamp helper</h2><span id='topic+.collapse_timestamp'></span>

<h3>Description</h3>

<p>Util to collapse the TIMESTAMP using lubridate::*_date functions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.collapse_timestamp(timestamp, ..., period, side = "start")
</code></pre>


<h3>Value</h3>

<p>A vector of the same length as TIMESTAMP, with the collapsed timestamp
with the same tz as the original one.
</p>


<h3>Period</h3>

<p>Periods accepted are in the &quot;number period&quot; format, as in
<code><a href="lubridate.html#topic+floor_date">floor_date</a></code> or a custom function name without quotes:
</p>

<ul>
<li><p>hours (exs. &quot;1 hour&quot;, &quot;12 hours&quot;)
</p>
</li>
<li><p>days (exs. &quot;1 day&quot;, &quot;3 days&quot;)
</p>
</li>
<li><p>weeks (exs. &quot;1 week&quot;, &quot;4 weeks&quot;)
</p>
</li>
<li><p>months (exs. &quot;1 month&quot;, &quot;6 months&quot;)
</p>
</li>
<li><p>years (exs. &quot;1 year&quot;, &quot;7 years&quot;)
</p>
</li>
<li><p>Also a custom function can be supplied, one that transforms the
TIMESTAMP variable to the collapsed timestamp desired. See
<code><a href="#topic+sfn_metrics">sfn_metrics</a></code> for details
</p>
</li></ul>



<h3>Side</h3>

<p>Side indicates if using <code><a href="lubridate.html#topic+floor_date">floor_date</a></code> (side = &quot;start) or
<code><a href="lubridate.html#topic+ceiling_date">ceiling_date</a></code> (side = 'end'). Ceiling dates is not
trivial, see <code><a href="lubridate.html#topic+ceiling_date">ceiling_date</a></code> for information on how
the date will be ceiled.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>arg_tre_timestamp &lt;- get_timestamp(ARG_TRE)
sapfluxnetr:::.collapse_timestamp(
  arg_tre_timestamp, period = "1 day", side = 'start'
)
</code></pre>

<hr>
<h2 id='.env_vars_names'>helper to return all environmental variable names</h2><span id='topic+.env_vars_names'></span>

<h3>Description</h3>

<p>helper to return all environmental variable names
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.env_vars_names()
</code></pre>


<h3>Value</h3>

<p>a character vector with env vars names
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sapfluxnetr:::.env_vars_names()

</code></pre>

<hr>
<h2 id='.fixed_metrics_funs'>helper function to generate the fixed metrics</h2><span id='topic+.fixed_metrics_funs'></span>

<h3>Description</h3>

<p>generates a call to list to capture the fixed metrics in a quosure lambda
style
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.fixed_metrics_funs(probs, centroid)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id=".fixed_metrics_funs_+3A_probs">probs</code></td>
<td>
<p>probs vector for quantile</p>
</td></tr>
<tr><td><code id=".fixed_metrics_funs_+3A_centroid">centroid</code></td>
<td>
<p>logical indicating if centroid calculation must be made.
(i.e. in monthly metrics, the centroid calculation is not needed)</p>
</td></tr>
</table>


<h3>Metrics</h3>

<p>Calculated metrics are as follow:
</p>

<ul>
<li><p>mean: Mean value for the selected period
</p>
</li>
<li><p>sd: Standard deviation for the selected period
</p>
</li>
<li><p>coverage: Percentage of coverage as the percentage of no NAs in the
expected length of the period, stated by the site timestep
</p>
</li>
<li><p>q*: q95 by default. Quantile value for the selected period. Quantiles to
calculate are stated in the probs argument
</p>
</li>
<li><p>accumulated: Accumulated value on the selected period
</p>
</li>
<li><p>centroid: daily centroid value in the selected period, calculated
only if centroid argument is TRUE
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>sapfluxnetr:::.fixed_metrics_funs(0.95, FALSE)
sapfluxnetr:::.fixed_metrics_funs(c(0.05, 0.95), TRUE)

</code></pre>

<hr>
<h2 id='.flag'>helper function to flag the mutated data in sfn_mutate and sfn_mutate_at</h2><span id='topic+.flag'></span>

<h3>Description</h3>

<p>This function will add the &quot;USER_MODF&quot; flag to the data point flags
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.flag(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id=".flag_+3A_x">x</code></td>
<td>
<p>variable to flag</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of the same length than x with the variable flags modified
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sapfluxnetr:::.flag('')
sapfluxnetr:::.flag('OUT_WARNING')

</code></pre>

<hr>
<h2 id='.metadata_architecture'>Metadata variables architecture</h2><span id='topic+.metadata_architecture'></span>

<h3>Description</h3>

<p>This function returns a nested list with the metadata, the variable and the
values, description , units and type for it use in describe_variable,
sfn_vars_to_filter and sfn_values_for
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.metadata_architecture()
</code></pre>


<h3>Value</h3>

<p>a list with the metadata architecture
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sapfluxnetr:::.metadata_architecture()

</code></pre>

<hr>
<h2 id='.nightly_daily_cf'>Period custom function</h2><span id='topic+.nightly_daily_cf'></span>

<h3>Description</h3>

<p>nightly period custom function, to use with nightly_metrics
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.nightly_daily_cf(timestamp, night_data, int_start)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id=".nightly_daily_cf_+3A_timestamp">timestamp</code></td>
<td>
<p>TIMESTAMP</p>
</td></tr>
<tr><td><code id=".nightly_daily_cf_+3A_night_data">night_data</code></td>
<td>
<p>as it comes inside of sfn_metrics</p>
</td></tr>
<tr><td><code id=".nightly_daily_cf_+3A_int_start">int_start</code></td>
<td>
<p>interval start as supplied to sfn_metrics</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function will be supplied as &quot;period&quot; argument to summarise_by_period
when daily nightly metrics are requested.
</p>


<h3>Value</h3>

<p>a vector of the same length as TIMESTAMP with the collapsed values.
</p>

<hr>
<h2 id='.parse_period'>.parse_period</h2><span id='topic+.parse_period'></span>

<h3>Description</h3>

<p>Util to parse the period supplied to the function call to
create the collapsed timestamp
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.parse_period(period)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id=".parse_period_+3A_period">period</code></td>
<td>
<p>Period in the &quot;number period&quot; format</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list, with the freq value as numeric and the period value as
character
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sapfluxnetr:::.parse_period('1 day')

</code></pre>

<hr>
<h2 id='.period_to_minutes'>transform period to minutes</h2><span id='topic+.period_to_minutes'></span>

<h3>Description</h3>

<p>helper for data_coverage
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.period_to_minutes(period, timestamp, timestep, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id=".period_to_minutes_+3A_period">period</code></td>
<td>
<p>character indicating the period to summarise or a custom
function name (without quotes).</p>
</td></tr>
<tr><td><code id=".period_to_minutes_+3A_timestamp">timestamp</code></td>
<td>
<p>timestamp vector obtained from data</p>
</td></tr>
<tr><td><code id=".period_to_minutes_+3A_timestep">timestep</code></td>
<td>
<p>numeric with the timestep in minutes, obtained from metadata</p>
</td></tr>
<tr><td><code id=".period_to_minutes_+3A_...">...</code></td>
<td>
<p>extra arguments for period if it is a function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function converts the period supplied into minutes to use it in the
coverage calculation.
</p>


<h3>Value</h3>

<p>An integer with the period value in minutes
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# daily period, expected 1440 minutes
sapfluxnetr:::.period_to_minutes('1 day')

# Using a custom function, we need timestamp and timestep
sapfluxnetr:::.period_to_minutes(
  lubridate::as_date, get_timestamp(ARG_TRE), 30
)
</code></pre>

<hr>
<h2 id='.sapflow_tidy'>.sapflow_tidy helper</h2><span id='topic+.sapflow_tidy'></span>

<h3>Description</h3>

<p>This helper is in charge of putting in shape the sapflow metrics, creating
the pl_code column.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.sapflow_tidy(data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id=".sapflow_tidy_+3A_data">data</code></td>
<td>
<p>site sapflow metrics dataframe</p>
</td></tr>
</table>

<hr>
<h2 id='.timezone_dic'>Timezones dictionary</h2><span id='topic+.timezone_dic'></span>

<h3>Description</h3>

<p>Transforms timezone ISO code to character vector compatible with lubridate and
POSIXct
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.timezone_dic(tz)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id=".timezone_dic_+3A_tz">tz</code></td>
<td>
<p>Character vector with the ISO code of the timezone as provided in
<code>env_time_zone</code> variable in <code>environmental_md</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>GMT time zones are used, as they are day saving light time (DST) agnostic,
and in that way the DST can setted if the metadata says so. GMT are sign
exchanged to be compatible with ISO.
</p>


<h3>Value</h3>

<p>A character vector with the timezone code compatible with lubridate
and as.POSIXct
</p>

<hr>
<h2 id='.write_metadata_cache'>Write metadata cache file to disk</h2><span id='topic+.write_metadata_cache'></span>

<h3>Description</h3>

<p>Load all sites, read the metadata and write it to disk to cache the
info for easy and fast access
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.write_metadata_cache(folder, .dry = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id=".write_metadata_cache_+3A_folder">folder</code></td>
<td>
<p>Route to the folder containing the data. Default to working
directory</p>
</td></tr>
<tr><td><code id=".write_metadata_cache_+3A_.dry">.dry</code></td>
<td>
<p>Dry run. Metadata is loaded and read, but no cache is written</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Load all data in memory to collect metadata info can be resource limiting.
For easy and quick access to metadata, this function stores an .RData file
in the specified folder along the data with all the metadata preloaded.
</p>


<h3>Value</h3>

<p>A list of tibbles with the five metadata classes (site, stand,
species, plant and environmental)
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Let's access the data in "folder". This typically is the folder where the
# sapflow data at the desired unit level is (i.e. "RData/plant"), but in this
# example we will create a temporal folder with some data to test the function
folder &lt;- tempdir()
save(ARG_TRE, file = file.path(folder, 'ARG_TRE.RData'))
save(ARG_MAZ, file = file.path(folder, 'ARG_MAZ.RData'))

# lets create the metadata cache file
sapfluxnetr:::.write_metadata_cache(folder, .dry = FALSE)#' 
file.exists(file.path(folder, '.metadata_cache.RData')) # TRUE

</code></pre>

<hr>
<h2 id='+25+26gt+3B+25'>Reexporting the pipe operator</h2><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>Imported from magrittr package
</p>


<h3>Examples</h3>

<pre><code class='language-R'># piping sites
ARG_TRE %&gt;% daily_metrics()

</code></pre>

<hr>
<h2 id='ARG_MAZ'>ARG_MAZ sapfluxnet site</h2><span id='topic+ARG_MAZ'></span>

<h3>Description</h3>

<p>Example site for package usage demonstration based on ARG_MAZ
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ARG_MAZ
</code></pre>


<h3>Format</h3>

<p>An sfn_data class object with the data and metadata for ARG_MAZ site
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data('ARG_MAZ', package = 'sapfluxnetr')
ARG_MAZ

</code></pre>

<hr>
<h2 id='ARG_TRE'>ARG_TRE sapfluxnet site</h2><span id='topic+ARG_TRE'></span>

<h3>Description</h3>

<p>Example site for package usage demonstration based on ARG_TRE
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ARG_TRE
</code></pre>


<h3>Format</h3>

<p>An sfn_data class object with the data and metadata for ARG_TRE site
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data('ARG_TRE', package = 'sapfluxnetr')
ARG_TRE

</code></pre>

<hr>
<h2 id='as_sfn_data_multi'>as_sfn_data_multi helper</h2><span id='topic+as_sfn_data_multi'></span>

<h3>Description</h3>

<p>Convert any list of sfn_data objects in a sfn_data_multi object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as_sfn_data_multi(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="as_sfn_data_multi_+3A_x">x</code></td>
<td>
<p>A list of sfn_data objects</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A sfn_data_multi object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sites_list &lt;- list(ARG_TRE, ARG_MAZ)
sapfluxnetr:::as_sfn_data_multi(sites_list)

</code></pre>

<hr>
<h2 id='AUS_CAN_ST2_MIX'>AUS_CAN_ST2_MIX sapfluxnet site</h2><span id='topic+AUS_CAN_ST2_MIX'></span>

<h3>Description</h3>

<p>Example site for package usage demonstration based on AUS_CAN_ST2_MIX
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AUS_CAN_ST2_MIX
</code></pre>


<h3>Format</h3>

<p>An sfn_data class object with the data and metadata for AUS_CAN_ST2_MIX site
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data('AUS_CAN_ST2_MIX', package = 'sapfluxnetr')
AUS_CAN_ST2_MIX

</code></pre>

<hr>
<h2 id='data_coverage'>data coverage</h2><span id='topic+data_coverage'></span>

<h3>Description</h3>

<p>helper for sfn_metrics
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data_coverage(x, timestep, period_minutes)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="data_coverage_+3A_x">x</code></td>
<td>
<p>a vector, usually a variable in the sapflow or environmental data.</p>
</td></tr>
<tr><td><code id="data_coverage_+3A_timestep">timestep</code></td>
<td>
<p>numeric value with the timestep in minutes</p>
</td></tr>
<tr><td><code id="data_coverage_+3A_period_minutes">period_minutes</code></td>
<td>
<p>numeric value with the period in minutes</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This helper function calculates the coverage percentage in a vector, and is
designed to be used inside a dplyr summarise statement. It calculates the
coverage as the percentage of no NAs in the expected length of the summarising
period stated by the timestep.
</p>


<h3>Value</h3>

<p>a single value (numeric) with the percentage of coverage for that
variable
</p>


<h3>Examples</h3>

<pre><code class='language-R'># data for one day, 60 minutes timestep (24 values) with a 75% of coberture
x &lt;- rep(c(1,2,3,NA), 6)
data_coverage(x, 60, 1440) # 75

</code></pre>

<hr>
<h2 id='describe_md_variable'>Detailed description of metadata variables</h2><span id='topic+describe_md_variable'></span>

<h3>Description</h3>

<p><code>describe_md_variable</code> prints in console a detailed description for the
requested variable. Useful to know which values to filter or in which units
the variables are.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>describe_md_variable(variable)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="describe_md_variable_+3A_variable">variable</code></td>
<td>
<p>A character with the name of the variable</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing, prints information to console
</p>


<h3>Examples</h3>

<pre><code class='language-R'># info about the method used to measure sapflow (pl_sens_meth)
describe_md_variable('pl_sens_meth')
</code></pre>

<hr>
<h2 id='diurnal_centroid'>Diurnal centroid calculation</h2><span id='topic+diurnal_centroid'></span>

<h3>Description</h3>

<p>Calculate the diurnal centroid for sapflow variables
</p>


<h3>Usage</h3>

<pre><code class='language-R'>diurnal_centroid(variable)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="diurnal_centroid_+3A_variable">variable</code></td>
<td>
<p>A numeric vector containing the sapflow values for a day at a
regular intervals. Missing values are allowed but not recommended</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The code for this function has been kindly provided by Jacob Nelson in python
(see https://github.com/jnelson18/FluxnetTools/blob/master/FileS3.py) and has
been translated to a tidy data philosophy in R to be used inside a
<code><a href="dplyr.html#topic+summarise">summarise</a></code> statement.
</p>


<h3>Value</h3>

<p>A numeric value with the diurnal centroid value (0 to 24 h)
</p>


<h3>Diurnal centroid algorithm</h3>

<p>Given a continuous subdaily sapflow values at regular intervals
<code class="reqn">V = {x_1, ..., x_n}</code> to obtain the diurnal centroid each value is
multiplied by its interval index and summed up and divided
by the sum of the values for the day and finally the value is normalized to
24h:
</p>
<p style="text-align: center;"><code class="reqn">
\sum {x_1 * 1, x_2 * 2, ... , x_n * n} / \sum {x_1, x_2, ... , x_n} * (24/n)
</code>
</p>

<p>With even values for all the intervals (i.e. 100 for all), centroid converges
to 12h at more than 1000 intervals per day. With only 48 (half hourly
measurements) centroid converges to 12.25h and with 24 intervals (hourly
measurements) centroid converges to 12.5h. So, using diurnal centroid value
in half hourly datasets or above can have a considerable error associated.
</p>


<h3>Author(s)</h3>

<p>Jacob Nelson &amp; Víctor Granda
</p>


<h3>Examples</h3>

<pre><code class='language-R'># dplyr
library(dplyr)

# check convergence to 12h:
diurnal_centroid(rep(1, 1000)) # 12.012 h
diurnal_centroid(rep(10000, 1000)) # 12.012 h, variable scale not affects calculation

# sapflow diurnal centroid
data('ARG_TRE', package = 'sapfluxnetr')

sfn_metrics(
  ARG_TRE,
  period = '1 day',
  .funs = list(~ diurnal_centroid(.),
               ~ data_coverage(., timestep, period_minutes)),
  solar = FALSE,
  interval = 'general'
)

</code></pre>

<hr>
<h2 id='filter_sites_by_md'>Filter the sites by metadata variable values</h2><span id='topic+filter_sites_by_md'></span>

<h3>Description</h3>

<p><code>filter_sites_by_md</code> function takes logical expressions for the metadata
variables (i.e. <code>pl_sens_meth == 'HR'</code>), and list the sites that met
the criteria from those supplied
</p>


<h3>Usage</h3>

<pre><code class='language-R'>filter_sites_by_md(sites, metadata, ..., .join = c("and", "or"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="filter_sites_by_md_+3A_sites">sites</code></td>
<td>
<p>character vector with the sites codes to filter, generally the
result of <code><a href="#topic+sfn_sites_in_folder">sfn_sites_in_folder</a></code></p>
</td></tr>
<tr><td><code id="filter_sites_by_md_+3A_metadata">metadata</code></td>
<td>
<p>metadata tbl object, usually the result of
<code><a href="#topic+read_sfn_metadata">read_sfn_metadata</a></code></p>
</td></tr>
<tr><td><code id="filter_sites_by_md_+3A_...">...</code></td>
<td>
<p>Logical expressions for the metadata variables, as in
<code><a href="dplyr.html#topic+filter">filter</a></code>.</p>
</td></tr>
<tr><td><code id="filter_sites_by_md_+3A_.join">.join</code></td>
<td>
<p>Character indicating how to filter the sites, see details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>.join</code> argument indicates how sites must be filtered between metadata
classes. <code>'and'</code> indicates only sites meeting all conditions for all
metadata classes are returned. <code>'or'</code> indicates all sites meeting any
condition between classes are returned. For two or more filters of the same
metadata class, they are combined as 'and'.
</p>


<h3>Value</h3>

<p>A character vector with the sites fulfilling the premises
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Let's access the data in "folder". This typically is the folder where the
# sapflow data at the desired unit level is (i.e. "RData/plant"), but in this
# example we will create a temporal folder with some data to test the function
folder &lt;- tempdir()
save(ARG_TRE, file = file.path(folder, 'ARG_TRE.RData'))
save(ARG_MAZ, file = file.path(folder, 'ARG_MAZ.RData'))
save(AUS_CAN_ST2_MIX, file = file.path(folder, 'AUS_CAN_ST2_MIX.RData'))

# we need the metadata and the site names
metadata &lt;- read_sfn_metadata(folder = folder, .write_cache = TRUE)
sites &lt;- sfn_sites_in_folder(folder)

# Filter by Heat Ratio method
filter_sites_by_md(
  pl_sens_meth == 'HR', sites = sites, metadata = metadata
)

# Both, Heat Ratio and Heat Dissipation
filter_sites_by_md(
  pl_sens_meth %in% c('HR', 'HD'),
  sites = sites, metadata = metadata
)

# more complex, Heat Ratio method AND Woodland/Shrubland biome
filter_sites_by_md(
  pl_sens_meth == 'HR',
  si_biome == 'Woodland/Shrubland',
  sites = sites, metadata = metadata,
  .join = 'and' # default
)

# join = 'or' returns sites that meet any condition
filter_sites_by_md(
  pl_sens_meth == 'HR',
  si_biome == 'Woodland/Shrubland',
  sites = sites, metadata = metadata,
  .join = 'or'
)

</code></pre>

<hr>
<h2 id='get_timezone'>get the timezone of the site</h2><span id='topic+get_timezone'></span>

<h3>Description</h3>

<p>Obtain the site timezone from a sfn_data/sfn_data_multi object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_timezone(sfn_data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_timezone_+3A_sfn_data">sfn_data</code></td>
<td>
<p>An sfn_data or sfn_data_multi object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a character with the site timezone
</p>


<h3>Examples</h3>

<pre><code class='language-R'># timezone of ARG_TRE site
get_timezone(ARG_TRE)

</code></pre>

<hr>
<h2 id='initialize+2Csfn_data_multi-method'>Initialize method for sfn_data multi</h2><span id='topic+initialize+2Csfn_data_multi-method'></span>

<h3>Description</h3>

<p>Initialize an sfn_data_multi object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'sfn_data_multi'
initialize(.Object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="initialize+2B2Csfn_data_multi-method_+3A_.object">.Object</code></td>
<td>
<p>sfn_data_multi object to create</p>
</td></tr>
<tr><td><code id="initialize+2B2Csfn_data_multi-method_+3A_...">...</code></td>
<td>
<p>sfn_data elements</p>
</td></tr>
</table>

<hr>
<h2 id='initialize+2Csfn_data-method'>Initialize method for sfn_data</h2><span id='topic+initialize+2Csfn_data-method'></span>

<h3>Description</h3>

<p>Initialize an sfn_data object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'sfn_data'
initialize(
  .Object,
  sapf_data,
  env_data,
  sapf_flags,
  env_flags,
  si_code,
  timestamp,
  solar_timestamp,
  site_md,
  stand_md,
  species_md,
  plant_md,
  env_md
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="initialize+2B2Csfn_data-method_+3A_.object">.Object</code></td>
<td>
<p>sfn_data object to create</p>
</td></tr>
<tr><td><code id="initialize+2B2Csfn_data-method_+3A_sapf_data">sapf_data</code></td>
<td>
<p>A tibble (or any object coercible to one) with the sapf_data
(without the TIMESTAMP variable)</p>
</td></tr>
<tr><td><code id="initialize+2B2Csfn_data-method_+3A_env_data">env_data</code></td>
<td>
<p>A tibble (or any object coercible to one) with the env_data
(without the TIMESTAMP variable)</p>
</td></tr>
<tr><td><code id="initialize+2B2Csfn_data-method_+3A_sapf_flags">sapf_flags</code></td>
<td>
<p>A tibble (or any object coercible to one) with the same
dimensions of <code>sapf_data</code> with the flag info for each tree/TIMESTAMP
combination</p>
</td></tr>
<tr><td><code id="initialize+2B2Csfn_data-method_+3A_env_flags">env_flags</code></td>
<td>
<p>A tibble (or any object coercible to one) with the same
dimensions of <code>env_data</code> with the flag info for each env_var/TIMESTAMP
combination</p>
</td></tr>
<tr><td><code id="initialize+2B2Csfn_data-method_+3A_si_code">si_code</code></td>
<td>
<p>A character vector of length one indicating
the site code</p>
</td></tr>
<tr><td><code id="initialize+2B2Csfn_data-method_+3A_timestamp">timestamp</code></td>
<td>
<p>A POSIXct vector of length <code>nrow(sapf_data)</code> with the
timestamp</p>
</td></tr>
<tr><td><code id="initialize+2B2Csfn_data-method_+3A_solar_timestamp">solar_timestamp</code></td>
<td>
<p>A POSIXct vector of length <code>nrow(sapf_data)</code> with
the solar timestamp</p>
</td></tr>
<tr><td><code id="initialize+2B2Csfn_data-method_+3A_site_md">site_md</code></td>
<td>
<p>A tibble (or any object coercible to one) containing the site
metadata</p>
</td></tr>
<tr><td><code id="initialize+2B2Csfn_data-method_+3A_stand_md">stand_md</code></td>
<td>
<p>A tibble (or any object coercible to one) containing the stand
metadata</p>
</td></tr>
<tr><td><code id="initialize+2B2Csfn_data-method_+3A_species_md">species_md</code></td>
<td>
<p>A tibble (or any object coercible to one) containing the species
metadata</p>
</td></tr>
<tr><td><code id="initialize+2B2Csfn_data-method_+3A_plant_md">plant_md</code></td>
<td>
<p>A tibble (or any object coercible to one) containing the plant
metadata</p>
</td></tr>
<tr><td><code id="initialize+2B2Csfn_data-method_+3A_env_md">env_md</code></td>
<td>
<p>A tibble (or any object coercible to one) containing the env
metadata</p>
</td></tr>
</table>

<hr>
<h2 id='metrics'>Complete metrics wrappers</h2><span id='topic+metrics'></span><span id='topic+daily_metrics'></span><span id='topic+monthly_metrics'></span><span id='topic+nightly_metrics'></span><span id='topic+daylight_metrics'></span><span id='topic+predawn_metrics'></span><span id='topic+midday_metrics'></span>

<h3>Description</h3>

<p>This set of functions returns a complete set of statistics for a site (using
<code><a href="#topic+sfn_data">sfn_data</a></code>) or several sites (using <code><a href="#topic+sfn_data_multi">sfn_data_multi</a></code>)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>daily_metrics(
  sfn_data,
  solar = TRUE,
  probs = c(0.95),
  tidy = FALSE,
  metadata = NULL,
  ...
)

monthly_metrics(
  sfn_data,
  solar = TRUE,
  probs = c(0.95),
  tidy = FALSE,
  metadata = NULL,
  ...
)

nightly_metrics(
  sfn_data,
  period = c("1 day", "1 month"),
  solar = TRUE,
  int_start = 20,
  int_end = 6,
  probs = c(0.95),
  tidy = FALSE,
  metadata = NULL,
  ...
)

daylight_metrics(
  sfn_data,
  period = c("1 day", "1 month"),
  solar = TRUE,
  int_start = 6,
  int_end = 20,
  probs = c(0.95),
  tidy = FALSE,
  metadata = NULL,
  ...
)

predawn_metrics(
  sfn_data,
  period = c("1 day", "1 month"),
  solar = TRUE,
  int_start = 4,
  int_end = 6,
  probs = c(0.95),
  tidy = FALSE,
  metadata = NULL,
  ...
)

midday_metrics(
  sfn_data,
  period = c("1 day", "1 month"),
  solar = TRUE,
  int_start = 11,
  int_end = 13,
  probs = c(0.95),
  tidy = FALSE,
  metadata = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="metrics_+3A_sfn_data">sfn_data</code></td>
<td>
<p><code><a href="#topic+sfn_data">sfn_data</a></code> or <code><a href="#topic+sfn_data_multi">sfn_data_multi</a></code> object
to obtain the metrics from</p>
</td></tr>
<tr><td><code id="metrics_+3A_solar">solar</code></td>
<td>
<p>Logical indicating if the solarTIMESTAMP must be used instead of
the site local TIMESTAMP. Default to TRUE (use solarTIMESTAMP).</p>
</td></tr>
<tr><td><code id="metrics_+3A_probs">probs</code></td>
<td>
<p>numeric vector of probabilities for
<code><a href="stats.html#topic+quantile">quantile</a></code></p>
</td></tr>
<tr><td><code id="metrics_+3A_tidy">tidy</code></td>
<td>
<p>Logical indicating if the metrics must be returned in a tidy
format (a long tibble, each observation in its own row)</p>
</td></tr>
<tr><td><code id="metrics_+3A_metadata">metadata</code></td>
<td>
<p>metadata object, usually the result of
<code><a href="#topic+read_sfn_metadata">read_sfn_metadata</a></code>. Only used if tidy is TRUE.</p>
</td></tr>
<tr><td><code id="metrics_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed to <code><a href="#topic+.collapse_timestamp">.collapse_timestamp</a></code>
or <code><a href="lubridate.html#topic+floor_date">floor_date</a></code> or <code><a href="lubridate.html#topic+ceiling_date">ceiling_date</a></code>.</p>
</td></tr>
<tr><td><code id="metrics_+3A_period">period</code></td>
<td>
<p>Time period to aggregate data by. See period section for an
explanation about the periods ('3 hours', '1 day', '1 month', '1 year', ...)</p>
</td></tr>
<tr><td><code id="metrics_+3A_int_start">int_start</code></td>
<td>
<p>Integer value indicating the starting hour of the special
interval in 24h format. See Interval section in details.</p>
</td></tr>
<tr><td><code id="metrics_+3A_int_end">int_end</code></td>
<td>
<p>Integer value indicating the ending hour of the special
interval in 24h format. See Interval section in details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>*_metrics</code> functions are wrappers for <code><a href="#topic+sfn_metrics">sfn_metrics</a></code> with a
set of fixed arguments.
</p>
<p><code>*_metrics</code> functions return all or some of the following statistics:
</p>

<ul>
<li><p>mean: mean of variable (tree or environmental variable) for the
given period. NAs are removed
</p>
</li>
<li><p>sd: standard deviation of the variable for the given period. NAs are
removed
</p>
</li>
<li><p>coverage: Data coverage percentage (percentage of measures without
NAs)
</p>
</li>
<li><p>q_XX: 0.XX quantile value for the period
</p>
</li>
<li><p>centroid: Diurnal centroid value (hours passed until the half of
the summed daily value was reached). Only returned for sapflow
measures when period is '1 day'
</p>
</li>
<li><p>accumulated: Accumulated values for precipitation only
</p>
</li></ul>



<h3>Value</h3>

<p>If <code>tidy</code> is TRUE, a tibble with the metrics for
sapflow and environmental data, with all the metadata included. If
<code>tidy</code> is FALSE (default), a list of tibbles with the calculated
metrics.
</p>


<h3>daily_metrics</h3>

<p><code>daily_metrics</code> summarise daily data for all hours in the day
</p>


<h3>monthly_metrics</h3>

<p><code>monthly_metrics</code> summarise monthly data for all hours in the day.
</p>


<h3>nightly_metrics</h3>

<p><code>nightly_metrics</code> will return the metrics for night
periods, summarised daily or monthly
</p>
<p>Night for daily period starts in DOY x and ends in DOY x+1 (i.e. if
<code>night_start = 20, night_end = 6</code> values for the night starting at
2018-03-28 20:00:00 and ending at 2018-03-29 06:00:00 are summarised).
</p>
<p>Night for monthly period summarises all night periods in the month, that
includes from 00:00:00 of the first month night to 23:59:59 of the last
month night.
</p>


<h3>daylight_metrics</h3>

<p><code>daylight_metrics</code> will return the metrics for daylight
periods, summarised daily or monthly. Daylight interval is selected by start
and end hours.
</p>


<h3>predawn_metrics</h3>

<p><code>predawn_metrics</code> will always return the metrics for predawn
period, summarised daily or monthly. Predawn interval is selected by start and
end hours.
</p>
<p>Predawn metrics did not return the centroid metric.
</p>


<h3>midday_metrics</h3>

<p><code>midday_metrics</code> will always return the metrics for midday
period, summarised daily or monthly. midday interval is selected by start and
end hours.
</p>
<p>Midday metrics did not return the centroid metric.
</p>


<h3>See Also</h3>

<p>Other metrics: 
<code><a href="#topic+sfn_metrics">sfn_metrics</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## daily_metrics
# data load
data('ARG_TRE', package = 'sapfluxnetr')
data('sfn_metadata_ex', package = 'sapfluxnetr')

# non tidy raw metrics (default)
ARG_TRE_raw_daily &lt;- daily_metrics(ARG_TRE)
str(ARG_TRE_raw_daily)


# tidy daily metrics
ARG_TRE_daily &lt;- daily_metrics(
  ARG_TRE, tidy = TRUE, metadata = sfn_metadata_ex
)
ARG_TRE_daily


## monthly_metrics
# data load
data('ARG_TRE', package = 'sapfluxnetr')
data('sfn_metadata_ex', package = 'sapfluxnetr')

# non tidy raw metrics (default)
ARG_TRE_raw_monthly &lt;- monthly_metrics(ARG_TRE)
str(ARG_TRE_raw_monthly)


# tidy monthly metrics
ARG_TRE_monthly &lt;- monthly_metrics(
  ARG_TRE, tidy = TRUE, metadata = sfn_metadata_ex
)
ARG_TRE_monthly



## nightly_metrics
# data load
data('AUS_CAN_ST2_MIX', package = 'sapfluxnetr')

# non tidy daily night metrics (default)
AUS_CAN_ST2_MIX_night &lt;- nightly_metrics(AUS_CAN_ST2_MIX)

str(AUS_CAN_ST2_MIX_night)
AUS_CAN_ST2_MIX_night[['sapf']]
AUS_CAN_ST2_MIX_night[['env']]

# change the night interval
AUS_CAN_ST2_MIX_night_short &lt;- nightly_metrics(
  AUS_CAN_ST2_MIX, int_start = 21, int_end = 4 # night starting and ending hour
)
AUS_CAN_ST2_MIX_night_short[['env']]

# tidy nightly metrics
data('sfn_metadata_ex', package = 'sapfluxnetr')
AUS_CAN_ST2_MIX_night_tidy &lt;- nightly_metrics(
  AUS_CAN_ST2_MIX,
  tidy = TRUE, metadata = sfn_metadata_ex
)
AUS_CAN_ST2_MIX_night_tidy



## daylight_metrics
# data load
data('AUS_CAN_ST2_MIX', package = 'sapfluxnetr')

# non tidy daily daylight metrics (default)
AUS_CAN_ST2_MIX_daylight &lt;- daylight_metrics(AUS_CAN_ST2_MIX)

str(AUS_CAN_ST2_MIX_daylight)
AUS_CAN_ST2_MIX_daylight[['sapf']]
AUS_CAN_ST2_MIX_daylight[['env']]

# change the daylight interval
AUS_CAN_ST2_MIX_daylight_short &lt;- daylight_metrics(
  AUS_CAN_ST2_MIX, int_start = 8, int_end = 18 # night starting and ending hour
)
AUS_CAN_ST2_MIX_daylight_short[['env']]

# tidy daylight metrics
data('sfn_metadata_ex', package = 'sapfluxnetr')
AUS_CAN_ST2_MIX_daylight_tidy &lt;- daylight_metrics(
  AUS_CAN_ST2_MIX,
  tidy = TRUE, metadata = sfn_metadata_ex
)
AUS_CAN_ST2_MIX_daylight_tidy



## predawn_metrics
# data load
data('AUS_CAN_ST2_MIX', package = 'sapfluxnetr')

# non tidy daily predawn metrics (default)
AUS_CAN_ST2_MIX_predawn &lt;- predawn_metrics(AUS_CAN_ST2_MIX)

str(AUS_CAN_ST2_MIX_predawn)
AUS_CAN_ST2_MIX_predawn[['sapf']]
AUS_CAN_ST2_MIX_predawn[['env']]

# change the predawn interval
AUS_CAN_ST2_MIX_predawn_short &lt;- predawn_metrics(
  AUS_CAN_ST2_MIX, int_start = 8, int_end = 18 # night starting and ending hour
)
AUS_CAN_ST2_MIX_predawn_short[['env']]

# tidy daylight metrics
data('sfn_metadata_ex', package = 'sapfluxnetr')
AUS_CAN_ST2_MIX_predawn_tidy &lt;- predawn_metrics(
  AUS_CAN_ST2_MIX,
  tidy = TRUE, metadata = sfn_metadata_ex
)
AUS_CAN_ST2_MIX_predawn_tidy



## midday_metrics
# data load
data('AUS_CAN_ST2_MIX', package = 'sapfluxnetr')

# non tidy daily midday metrics (default)
AUS_CAN_ST2_MIX_midday &lt;- midday_metrics(AUS_CAN_ST2_MIX)

str(AUS_CAN_ST2_MIX_midday)
AUS_CAN_ST2_MIX_midday[['sapf']]
AUS_CAN_ST2_MIX_midday[['env']]

# change the midday interval
AUS_CAN_ST2_MIX_midday_short &lt;- midday_metrics(
  AUS_CAN_ST2_MIX, int_start = 8, int_end = 18 # night starting and ending hour
)
AUS_CAN_ST2_MIX_midday_short[['env']]

# tidy daylight metrics
data('sfn_metadata_ex', package = 'sapfluxnetr')
AUS_CAN_ST2_MIX_midday_tidy &lt;- midday_metrics(
  AUS_CAN_ST2_MIX,
  tidy = TRUE, metadata = sfn_metadata_ex
)
AUS_CAN_ST2_MIX_midday_tidy


</code></pre>

<hr>
<h2 id='metrics_tidyfier'>Build a tidy data frame from the metrics results nested list</h2><span id='topic+metrics_tidyfier'></span>

<h3>Description</h3>

<p>Transform the nested list of metrics in a tidy tibble where each observation
has its own row
</p>


<h3>Usage</h3>

<pre><code class='language-R'>metrics_tidyfier(
  metrics_res,
  metadata,
  interval = c("general", "predawn", "midday", "night", "daylight")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="metrics_tidyfier_+3A_metrics_res">metrics_res</code></td>
<td>
<p>Nested list containing the metrics results as obtained
from <code><a href="#topic+metrics">metrics</a></code></p>
</td></tr>
<tr><td><code id="metrics_tidyfier_+3A_metadata">metadata</code></td>
<td>
<p>List containing the metadata nested list, as obtained from
<code><a href="#topic+read_sfn_metadata">read_sfn_metadata</a></code></p>
</td></tr>
<tr><td><code id="metrics_tidyfier_+3A_interval">interval</code></td>
<td>
<p>Interval to return, it depends on the <code>metrics_res</code> and
can be <code>"gen"</code> for the general metrics, <code>"md"</code> for midday metrics,
<code>"pd"</code> for predawn metrics, <code>"night"</code> for night metrics or
<code>"day"</code> for diurnal metrics.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a tibble with the following columns:
</p>

<ul>
<li><p>TIMESTAMP: POSIXct vector with the date-time of the observation
</p>
</li>
<li><p>si_code: Character vector with the site codes
</p>
</li>
<li><p>pl_code: Character vector with the plant codes
</p>
</li>
<li><p>sapflow_*: Variables containing the different metrics for the
sapflow measurements (i.e. sapflow_mean, sapflow_q_95)
</p>
</li>
<li><p>ta_*; rh_*; vpd_*; ...: Variables containing the different metrics
for environmental variables (i.e. ta_mean, ta_q_95)
</p>
</li>
<li><p>pl_*: plant metadata variables (i.e. pl_sapw_area, pl_sens_meth)
</p>
</li>
<li><p>si_*: site metadata variables (i.e. si_biome, si_contact_firstname)
</p>
</li>
<li><p>st_*: stand metadata variables (i.e. st_aspect, st_lai)
</p>
</li>
<li><p>sp_*: species metadata variables (i.e. sp_basal_area_perc)
</p>
</li>
<li><p>env_*: environmental metadata variables (i.e. env_timezone)
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
# data
multi_sfn &lt;- sfn_data_multi(ARG_TRE, ARG_MAZ, AUS_CAN_ST2_MIX)
data('sfn_metadata_ex', package = 'sapfluxnetr')

# metrics
multi_metrics &lt;- daily_metrics(multi_sfn)

# tidyfing
multi_tidy &lt;- metrics_tidyfier(
  multi_metrics, sfn_metadata_ex, interval = 'general'
)
multi_tidy

# A really easier way of doing the same
multi_tidy_easy &lt;- daily_metrics(multi_sfn, tidy = TRUE, metadata = sfn_metadata_ex)


</code></pre>

<hr>
<h2 id='norm_diurnal_centroid'>Normalized diurnal centroid calculation</h2><span id='topic+norm_diurnal_centroid'></span>

<h3>Description</h3>

<p>Calculate the normalized diurnal centroid for sapflow variables
</p>


<h3>Usage</h3>

<pre><code class='language-R'>norm_diurnal_centroid(sapf_var, rad_var)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="norm_diurnal_centroid_+3A_sapf_var">sapf_var</code></td>
<td>
<p>A numeric vector containing the sapflow values for a day at a
regular intervals. Missing values are allowed but not recommended.</p>
</td></tr>
<tr><td><code id="norm_diurnal_centroid_+3A_rad_var">rad_var</code></td>
<td>
<p>A numeric vector containing the incoming radiation for a day
at a regular intervals. Missing values are allowed but not recommended.
Must be the same length as sapf_var.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The code for this function has been kindly provided by Jacob Nelson in python
(see https://github.com/jnelson18/FluxnetTools/blob/master/FileS3.py) and has
been translated to a tidy data philosophy in R to be used inside a
<code><a href="dplyr.html#topic+summarise">summarise</a></code> statement.
</p>


<h3>Value</h3>

<p>A numeric value with the normalized diurnal centroid value
</p>


<h3>Normalized diurnal centroid algorithm</h3>

<p>This function calculates the diurnal centroid of sapflow measures
<em>relative</em> to the diurnal centroid of incoming radiation (in any units).
For that the incoming radiation diurnal centroid is substracted from the
sapflow diurnal centroid:
</p>
<p style="text-align: center;"><code class="reqn">
Sapf_cent - IncomingRad_cent
</code>
</p>



<h3>Author(s)</h3>

<p>Jacob Nelson &amp; Víctor Granda
</p>

<hr>
<h2 id='read_sfn_data'>Read sfn_data from disk</h2><span id='topic+read_sfn_data'></span>

<h3>Description</h3>

<p>Given a site code and a route, <code>read_sfn_data</code> will return the selected
sfn_data object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_sfn_data(site_codes, folder = ".")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="read_sfn_data_+3A_site_codes">site_codes</code></td>
<td>
<p>A character vector with the site code/s</p>
</td></tr>
<tr><td><code id="read_sfn_data_+3A_folder">folder</code></td>
<td>
<p>Route to the folder containing the <code>.RData</code> file. Default
to working directory.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>site_codes</code> is a vector of length 1, an sfn_data object with
the selected site data. If <code>site_codes</code> is a vector of length &gt; 1, then
a sfn_data_multi object containing all selected sites.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Let's access the data in "folder". This typically is the folder where the
# sapflow data at the desired unit level is (i.e. "RData/plant"), but in this
# example we will create a temporal folder with some data to test the function
folder &lt;- tempdir()
save(ARG_TRE, file = file.path(folder, 'ARG_TRE.RData'))
save(ARG_MAZ, file = file.path(folder, 'ARG_MAZ.RData'))

# now we read a single site
ARG_TRE_test &lt;- read_sfn_data('ARG_TRE', folder)
ARG_TRE_test

# or we can read multiple sites at once
multi_sfn &lt;- read_sfn_data(
  c('ARG_TRE', 'ARG_MAZ'), folder
)
multi_sfn

</code></pre>

<hr>
<h2 id='read_sfn_metadata'>Read and combine all metadata</h2><span id='topic+read_sfn_metadata'></span>

<h3>Description</h3>

<p>Read metadata from all sites in folder and write it to disk to cache the
info for easy and fast access
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_sfn_metadata(folder = ".", .write_cache = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="read_sfn_metadata_+3A_folder">folder</code></td>
<td>
<p>Route to the folder containing the data. Default to working
directory</p>
</td></tr>
<tr><td><code id="read_sfn_metadata_+3A_.write_cache">.write_cache</code></td>
<td>
<p>Logical indicating if a cached copy of the metadata must
be written in <code>folder</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Load all data in memory to collect metadata info can be resource limiting.
For easy and quick access to metadata, this function stores an .RData file
in the specified folder along the data with all the metadata preloaded. Also
it return it as an object to use in filtering and selecting sites.
</p>


<h3>Value</h3>

<p>A list of tibbles with the five metadata classes (site, stand,
species, plant and environmental)
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Let's access the data in "folder". This typically is the folder where the
# sapflow data at the desired unit level is (i.e. "RData/plant"), but in this
# example we will create a temporal folder with some data to test the function
folder &lt;- tempdir()
save(ARG_TRE, file = file.path(folder, 'ARG_TRE.RData'))
save(ARG_MAZ, file = file.path(folder, 'ARG_MAZ.RData'))

# create and load the metadata. The first time we use .write_cache = TRUE,
# to ensure creating a file containing the metadata for speed the process
# for the next times
read_sfn_metadata(
  folder = folder, .write_cache = TRUE
)
# a cached copy must have been written to "folder"
file.exists(paste0(folder, '.metadata_cache.RData')) # TRUE

# after that, we only need to especify the folder
sites_metadata &lt;- read_sfn_metadata(folder = folder) # quicker than before
sites_metadata

</code></pre>

<hr>
<h2 id='sfn_data_multi_validity'>Validity method for sfn_data_multi class</h2><span id='topic+sfn_data_multi_validity'></span>

<h3>Description</h3>

<p>Validation checks for generating sfn_data_multi class objects
</p>


<h3>Details</h3>

<p>This method is used internally to ensure the correctness of the sfn_data_multi
object. Basically ensures that the object returned is a list of sfn_data
class objects
</p>

<hr>
<h2 id='sfn_data_multi-class'>S4 class for sapfluxnet multi-site data</h2><span id='topic+sfn_data_multi-class'></span><span id='topic+sfn_data_multi'></span>

<h3>Description</h3>

<p>Multi sfn data class, derived from list
</p>


<h3>Details</h3>

<p>This class inherits from <code>list</code>, but modified to contain sfn_data objects
as elements. This will allow to work with several sites at the same time
obtaining results for all of them combined or individually as elements of
the resulting list (with <code>lapply</code> or <code>purrr::map</code>)
</p>

<hr>
<h2 id='sfn_data_validity'>Validity method for sfn_data class</h2><span id='topic+sfn_data_validity'></span>

<h3>Description</h3>

<p>Validation checks for generating sfn_data class objects
</p>


<h3>Details</h3>

<p>This method is used internally when creating and/or modifying sfn_data class
objects to ensure that the object returned is correct in terms of content
classes and dimensions (i.e. sapflow data and environmental data has the
same length)
</p>

<hr>
<h2 id='sfn_data-class'>S4 class for sapfluxnet site data</h2><span id='topic+sfn_data-class'></span><span id='topic+sfn_data'></span>

<h3>Description</h3>

<p>Main class for storing sapfluxnet project site data and metadata
</p>


<h3>Details</h3>

<p>This class allows to store all the data and metadata for a sapfluxnet site
in one single object, to easily work with it. See
<code>vignette('sfn-data-classes', package = 'sapfluxnetr')</code> for more info.
</p>


<h3>Slots</h3>


<dl>
<dt><code>sapf_data</code></dt><dd><p>A data frame with the sapf data</p>
</dd>
<dt><code>env_data</code></dt><dd><p>A data frame with the env data</p>
</dd>
<dt><code>sapf_flags</code></dt><dd><p>A data frame with the same dimensions of <code>sapf_data</code>
with the flag info for each tree/TIMESTAMP combination</p>
</dd>
<dt><code>env_flags</code></dt><dd><p>A data frame with the same dimensions of <code>env_data</code> with
the flag info for each env_var/TIMESTAMP combination</p>
</dd>
<dt><code>si_code</code></dt><dd><p>A character vector of length one indicating
the site code</p>
</dd>
<dt><code>timestamp</code></dt><dd><p>A POSIXct vector of length <code>nrow(sapf_data)</code> with the
timestamp</p>
</dd>
<dt><code>solar_timestamp</code></dt><dd><p>A POSIXct vector of length <code>nrow(sapf_data)</code> with
the solar timestamp</p>
</dd>
<dt><code>site_md</code></dt><dd><p>A data frame containing the site metadata</p>
</dd>
<dt><code>stand_md</code></dt><dd><p>A data frame containing the stand metadata</p>
</dd>
<dt><code>species_md</code></dt><dd><p>A data frame containing the species metadata</p>
</dd>
<dt><code>plant_md</code></dt><dd><p>A data frame containing the plant metadata</p>
</dd>
<dt><code>env_md</code></dt><dd><p>A data frame containing the env metadata</p>
</dd>
</dl>

<hr>
<h2 id='sfn_filter'>Filter sfn_data by variable/s value</h2><span id='topic+sfn_filter'></span>

<h3>Description</h3>

<p>Port of <code><a href="dplyr.html#topic+filter">filter</a></code> for <code>sfn_data</code> and
<code>sfn_data_multi</code> objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sfn_filter(sfn_data, ..., solar = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sfn_filter_+3A_sfn_data">sfn_data</code></td>
<td>
<p><code>sfn_data</code> or <code>sfn_data_multi</code> object to subset</p>
</td></tr>
<tr><td><code id="sfn_filter_+3A_...">...</code></td>
<td>
<p>expressions to pass to the <code><a href="dplyr.html#topic+filter">filter</a></code> function</p>
</td></tr>
<tr><td><code id="sfn_filter_+3A_solar">solar</code></td>
<td>
<p>Logical indicating if solar timestamp must used to subset</p>
</td></tr>
</table>


<h3>Details</h3>

<p>'sfn_filter' will remove the rows not matching the logical expression/s
provided. So, it will remove cases and will create TIMESTAMP gaps, so its use
is not recommended except in the case of filtering by TIMESTAMP (i.e. to
set several sites (sfn_data_multi) in the same time frame). For other
scenarios (removing extreme environmental conditions values or strange
sapflow measures patterns) see <code><a href="#topic+sfn_mutate">sfn_mutate</a></code> and
<code><a href="#topic+sfn_mutate_at">sfn_mutate_at</a></code>
</p>


<h3>Value</h3>

<p>For <code>sfn_data</code> objects, a filtered <code>sfn_data</code> or NULL if
no data meet the criteria. For <code>sfn_data_multi</code> another
<code>sfn_data_multi</code> with the sites filtered, and an empty
<code>sfn_data_multi</code> if any sites met the criteria
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
library(lubridate)

# data
data('ARG_TRE', package = 'sapfluxnetr')

# by timestamp
foo_timestamp &lt;- get_timestamp(ARG_TRE)

foo_timestamp_trimmed &lt;- foo_timestamp[1:100]

sfn_filter(
  ARG_TRE,
  TIMESTAMP %in% foo_timestamp_trimmed
)

# by wind speed value
ws_threshold &lt;- 25

sfn_filter(
  ARG_TRE,
  ws &lt;= ws_threshold
)

## multi
data('ARG_MAZ', package = 'sapfluxnetr')
multi_sfn &lt;- sfn_data_multi(ARG_TRE, ARG_MAZ)

# by timestamp
sfn_filter(
  multi_sfn,
  between(day(TIMESTAMP), 18, 22)
)

# by wind speed value
sfn_filter(
  multi_sfn,
  ws &lt;= ws_threshold
)

</code></pre>

<hr>
<h2 id='sfn_get_generics'>sfn_data custom get generics</h2><span id='topic+sfn_get_generics'></span><span id='topic+get_sapf_data'></span><span id='topic+get_env_data'></span><span id='topic+get_sapf_flags'></span><span id='topic+get_env_flags'></span><span id='topic+get_timestamp'></span><span id='topic+get_solar_timestamp'></span><span id='topic+get_si_code'></span><span id='topic+get_site_md'></span><span id='topic+get_stand_md'></span><span id='topic+get_species_md'></span><span id='topic+get_plant_md'></span><span id='topic+get_env_md'></span>

<h3>Description</h3>

<p>Generics for getting the info in the slots of SfnData
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_sapf_data(object, ...)

get_env_data(object, ...)

get_sapf_flags(object, ...)

get_env_flags(object, ...)

get_timestamp(object, ...)

get_solar_timestamp(object, ...)

get_si_code(object, ...)

get_site_md(object, ...)

get_stand_md(object, ...)

get_species_md(object, ...)

get_plant_md(object, ...)

get_env_md(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sfn_get_generics_+3A_object">object</code></td>
<td>
<p>Object to get data from</p>
</td></tr>
<tr><td><code id="sfn_get_generics_+3A_...">...</code></td>
<td>
<p>Further arguments to pass to the corresponding get method</p>
</td></tr>
</table>


<h3>Details</h3>

<p>see <code><a href="#topic+sfn_get_methods">sfn_get_methods</a></code> for detailed info about using the get
methods in <code>sfn_data</code> class objects and
<code><a href="#topic+sfn_multi_get_methods">sfn_multi_get_methods</a></code> for detailed info about using the get
methods in <code>sfn_data_multi</code> class objects.
</p>

<hr>
<h2 id='sfn_get_methods'>sfn_data get methods</h2><span id='topic+sfn_get_methods'></span><span id='topic+get_sapf_data+2Csfn_data-method'></span><span id='topic+get_env_data+2Csfn_data-method'></span><span id='topic+get_sapf_flags+2Csfn_data-method'></span><span id='topic+get_env_flags+2Csfn_data-method'></span><span id='topic+get_timestamp+2Csfn_data-method'></span><span id='topic+get_solar_timestamp+2Csfn_data-method'></span><span id='topic+get_si_code+2Csfn_data-method'></span><span id='topic+get_site_md+2Csfn_data-method'></span><span id='topic+get_stand_md+2Csfn_data-method'></span><span id='topic+get_species_md+2Csfn_data-method'></span><span id='topic+get_plant_md+2Csfn_data-method'></span><span id='topic+get_env_md+2Csfn_data-method'></span>

<h3>Description</h3>

<p>Methods to get the data and metadata from the sfn_data class slots
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'sfn_data'
get_sapf_data(object, solar = FALSE)

## S4 method for signature 'sfn_data'
get_env_data(object, solar = FALSE)

## S4 method for signature 'sfn_data'
get_sapf_flags(object, solar = FALSE)

## S4 method for signature 'sfn_data'
get_env_flags(object, solar = FALSE)

## S4 method for signature 'sfn_data'
get_timestamp(object)

## S4 method for signature 'sfn_data'
get_solar_timestamp(object)

## S4 method for signature 'sfn_data'
get_si_code(object)

## S4 method for signature 'sfn_data'
get_site_md(object)

## S4 method for signature 'sfn_data'
get_stand_md(object)

## S4 method for signature 'sfn_data'
get_species_md(object)

## S4 method for signature 'sfn_data'
get_plant_md(object)

## S4 method for signature 'sfn_data'
get_env_md(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sfn_get_methods_+3A_object">object</code></td>
<td>
<p>Object of class sfn_data from which data is retrieved</p>
</td></tr>
<tr><td><code id="sfn_get_methods_+3A_solar">solar</code></td>
<td>
<p>Logical indicating if the timestamp to return in the <code>get_sapf_data</code>,
<code>get_env_data</code>, <code>get_sapf_flags</code> and <code>get_env_flags</code> methods is
the solarTIMESTAMP (TRUE) or the contributors provided TIMESTAMP (FALSE)</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>get_sapf_data</code> and <code>get_env_data</code> methods retrieve sapflow or environmental
tibbles to create a functional dataset to work with.
</p>
<p><code>get_sapf_flags</code> and <code>get_env_flags</code> methods retrieve sapflow or
environmental flags as tibbles.
</p>
<p><code>get_timestamp</code> and <code>get_solar_timestamp</code> methods retrieve only the
timestamp as POSIXct vector.
</p>
<p><code>get_si_code</code> method retrieve a character vector with length(timestamp)
containing the site code.
</p>
<p><code>get_site_md</code>, <code>get_stand_md</code>, <code>get_species_md</code>,
<code>get_plant_md</code> and <code>get_env_md</code> methods retrieve the corresponding
metadata.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)

data('ARG_TRE', package = 'sapfluxnetr')
sapf_data &lt;- get_sapf_data(ARG_TRE, solar = TRUE)
env_data_no_solar &lt;- get_env_data(ARG_TRE, solar = FALSE)
plant_md &lt;- get_plant_md(ARG_TRE)

# dplyr pipe to get the mean dbh for a site
ARG_TRE %&gt;%
  get_plant_md() %&gt;%
  summarise(dbh_mean = mean(pl_dbh, na.rm = TRUE)) %&gt;%
  pull(dbh_mean)

</code></pre>

<hr>
<h2 id='sfn_metadata_ex'>sfn_metadata cache file for example data (ARG_MAZ, ARG_TRE and AUS_CAN_ST2_MIX)</h2><span id='topic+sfn_metadata_ex'></span>

<h3>Description</h3>

<p>Example metadata cache file content for package usage demonstration
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sfn_metadata_ex
</code></pre>


<h3>Format</h3>

<p>A list with five elements, each of one a metadata type.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data('sfn_metadata_ex', package = 'sapfluxnetr')
sfn_metadata_ex

</code></pre>

<hr>
<h2 id='sfn_metrics'>Metrics summary function</h2><span id='topic+sfn_metrics'></span>

<h3>Description</h3>

<p>Generate metrics from a site/s data for the period indicated
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sfn_metrics(
  sfn_data,
  period,
  .funs,
  solar,
  interval = c("general", "predawn", "midday", "night", "daylight"),
  int_start = NULL,
  int_end = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sfn_metrics_+3A_sfn_data">sfn_data</code></td>
<td>
<p><code><a href="#topic+sfn_data">sfn_data</a></code> or <code><a href="#topic+sfn_data_multi">sfn_data_multi</a></code> object
to obtain the metrics from</p>
</td></tr>
<tr><td><code id="sfn_metrics_+3A_period">period</code></td>
<td>
<p>Time period to aggregate data by. See period section for an
explanation about the periods ('3 hours', '1 day', '1 month', '1 year', ...)</p>
</td></tr>
<tr><td><code id="sfn_metrics_+3A_.funs">.funs</code></td>
<td>
<p>List of function calls to summarise the data by, see .funs
section for more details.</p>
</td></tr>
<tr><td><code id="sfn_metrics_+3A_solar">solar</code></td>
<td>
<p>Logical indicating if the solarTIMESTAMP must be used instead of
the site local TIMESTAMP. Default to TRUE (use solarTIMESTAMP).</p>
</td></tr>
<tr><td><code id="sfn_metrics_+3A_interval">interval</code></td>
<td>
<p>Character vector indicating if the metrics must be filtered
by an special hour interval. See Interval section in details.</p>
</td></tr>
<tr><td><code id="sfn_metrics_+3A_int_start">int_start</code></td>
<td>
<p>Integer value indicating the starting hour of the special
interval in 24h format. See Interval section in details.</p>
</td></tr>
<tr><td><code id="sfn_metrics_+3A_int_end">int_end</code></td>
<td>
<p>Integer value indicating the ending hour of the special
interval in 24h format. See Interval section in details.</p>
</td></tr>
<tr><td><code id="sfn_metrics_+3A_...">...</code></td>
<td>
<p>optional arguments to pass to methods used
(i.e. .collapse_timestamp or summarise funs extra arguments)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>For <code><a href="#topic+sfn_data">sfn_data</a></code> objects, a list of tbl_df objects
with the following structure:
</p>

<ul>
<li><p>$sapf: metrics for the sapflow data
</p>
</li>
<li><p>$env: metrics for the environmental data
</p>
</li></ul>

<p>For <code><a href="#topic+sfn_data_multi">sfn_data_multi</a></code> objects, a list of lists of tbl_df objects
with the metrics for each site:
</p>

<ul>
<li><p>$SITE_CODE
</p>

<ul>
<li><p>$sapf: metrics for the sapflow data
</p>
</li>
<li><p>$env: metrics for the environmental data
</p>
</li></ul>


</li>
<li><p>$NEXT_SITE_CODE...
</p>
</li></ul>



<h3>Period</h3>

<p><code>period</code> argument is used by internal function
<code><a href="#topic+.collapse_timestamp">.collapse_timestamp</a></code> and it can be stated in two ways:
</p>

<ul>
<li><p><em>frequency period</em> format: &quot;3 hours&quot;, &quot;1 day&quot;, &quot;7 days&quot;, &quot;1 month&quot;
</p>
</li>
<li><p>As a <em>custom function</em>. This will be the name of a function,
without quotes, that accepts as the first argument the timestamp to collapse.
The result of the function must be a vector of collapsed TIMESTAMPs of the
same length than the original TIMESTAMP which will be used to group by and
summarise the data. Additional arguments to this function, if needed, can
be passed in the <code>...</code> argument.
</p>
</li></ul>

<p><code><a href="#topic+.collapse_timestamp">.collapse_timestamp</a></code> also accepts the <code>side</code> argument to
collapse by the starting timestamp or the ending timestamp of each group. This
can be supplied in the <code>...</code> argument.
</p>


<h3>.funs</h3>

<p><code>.funs</code> argument uses the same method as the <code>.funs</code> argument in the
<code><a href="dplyr.html#topic+summarise_all">summarise_all</a></code> function of <code>dplyr</code> package. Basically
it accepts a list of function calls generated by list(). If you want to pass
on a custom function you can specify it here. See details in
<code><a href="#topic+summarise_by_period">summarise_by_period</a></code> for more complex summarising functions
declaration.
</p>


<h3>Interval</h3>

<p>Previously to the metrics summary, data can be filtered by an special
interval (i.e. predawn or nightly). This filtering can be specified with the
<code>interval</code> argument as this:
</p>

<ul>
<li><p><code>"general"</code> (default). No special interval is used, and metrics
are performed with all the data.
</p>
</li>
<li><p><code>"predawn"</code>. Data is filtered for predawn interval. In this case
<code>int_start</code> and <code>int_end</code> must be specified as 24h value
</p>
</li>
<li><p><code>"midday"</code>. Data is filtered for midday interval. In this case
<code>int_start</code> and <code>int_end</code> must be specified as 24h value
</p>
</li>
<li><p><code>"night"</code>. Data is filtered for night interval. In this case
<code>int_start</code> and <code>int_end</code> must be specified as 24h value
</p>
</li>
<li><p><code>"daylight"</code>. Data is filtered for daylight interval. In this case
<code>int_start</code> and <code>int_end</code> must be specified as 24h value
</p>
</li></ul>



<h3>See Also</h3>

<p>Other metrics: 
<code><a href="#topic+metrics">metrics</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)

### general metrics
## sfn_data
data('ARG_TRE', package = 'sapfluxnetr')
ARG_TRE_metrics &lt;- sfn_metrics(
  ARG_TRE,
  period = '7 days',
  .funs = list(~ mean(., na.rm = TRUE), ~ sd(., na.rm = TRUE), ~ n()),
  solar = FALSE,
  interval = 'general'
)

str(ARG_TRE_metrics)
ARG_TRE_metrics[['sapf']]
ARG_TRE_metrics[['env']]

## sfn_data_multi

data('ARG_MAZ', package = 'sapfluxnetr')
data('AUS_CAN_ST2_MIX', package = 'sapfluxnetr')
multi_sfn &lt;- sfn_data_multi(ARG_TRE, ARG_MAZ, AUS_CAN_ST2_MIX)

multi_metrics &lt;- sfn_metrics(
  multi_sfn,
  period = '7 days',
  .funs = list(~ mean(., na.rm = TRUE), ~ sd(., na.rm = TRUE), ~ n()),
  solar = FALSE,
  interval = 'general'
)

str(multi_metrics)

multi_metrics[['ARG_TRE']][['sapf']]


### midday metrics
ARG_TRE_midday &lt;- sfn_metrics(
  ARG_TRE,
  period = '1 day',
  .funs = list(~ mean(., na.rm = TRUE), ~ sd(., na.rm = TRUE), ~ n()),
  solar = TRUE,
  interval = 'midday', int_start = 11, int_end = 13
)

str(ARG_TRE_midday)
ARG_TRE_midday[['sapf']]

</code></pre>

<hr>
<h2 id='sfn_multi_get_methods'>sfn_data_multi get methods</h2><span id='topic+sfn_multi_get_methods'></span><span id='topic+get_sapf_data+2Csfn_data_multi-method'></span><span id='topic+get_env_data+2Csfn_data_multi-method'></span><span id='topic+get_sapf_flags+2Csfn_data_multi-method'></span><span id='topic+get_env_flags+2Csfn_data_multi-method'></span><span id='topic+get_timestamp+2Csfn_data_multi-method'></span><span id='topic+get_solar_timestamp+2Csfn_data_multi-method'></span><span id='topic+get_si_code+2Csfn_data_multi-method'></span><span id='topic+get_site_md+2Csfn_data_multi-method'></span><span id='topic+get_stand_md+2Csfn_data_multi-method'></span><span id='topic+get_species_md+2Csfn_data_multi-method'></span><span id='topic+get_plant_md+2Csfn_data_multi-method'></span><span id='topic+get_env_md+2Csfn_data_multi-method'></span>

<h3>Description</h3>

<p>Methods to get the data and metadata from the sfn_data class slots
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'sfn_data_multi'
get_sapf_data(object, solar = FALSE)

## S4 method for signature 'sfn_data_multi'
get_env_data(object, solar = FALSE)

## S4 method for signature 'sfn_data_multi'
get_sapf_flags(object, solar = FALSE)

## S4 method for signature 'sfn_data_multi'
get_env_flags(object, solar = FALSE)

## S4 method for signature 'sfn_data_multi'
get_timestamp(object)

## S4 method for signature 'sfn_data_multi'
get_solar_timestamp(object)

## S4 method for signature 'sfn_data_multi'
get_si_code(object)

## S4 method for signature 'sfn_data_multi'
get_site_md(object, collapse = FALSE)

## S4 method for signature 'sfn_data_multi'
get_stand_md(object, collapse = FALSE)

## S4 method for signature 'sfn_data_multi'
get_species_md(object, collapse = FALSE)

## S4 method for signature 'sfn_data_multi'
get_plant_md(object, collapse = FALSE)

## S4 method for signature 'sfn_data_multi'
get_env_md(object, collapse = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sfn_multi_get_methods_+3A_object">object</code></td>
<td>
<p>Object of class sfn_data_multi from which data or metadata is
retrieved</p>
</td></tr>
<tr><td><code id="sfn_multi_get_methods_+3A_solar">solar</code></td>
<td>
<p>Logical indicating if the timestamp to return in the <code>get_sapf_data</code>,
<code>get_env_data</code>, <code>get_sapf_flags</code> and <code>get_env_flags</code> methods is
the solarTIMESTAMP (TRUE) or the contributors provided TIMESTAMP (FALSE)</p>
</td></tr>
<tr><td><code id="sfn_multi_get_methods_+3A_collapse">collapse</code></td>
<td>
<p>Logical indicating if the metadata get methods must collapse
the returning list to a data frame with all sites</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>get_sapf_data</code> and <code>get_env_data</code> methods retrieve sapflow or
environmental tibbles from the sfn_data objects contained in the 
sfn_data_multi and return them in a list.
</p>
<p><code>get_sapf_flags</code> and <code>get_env_flags</code> methods retrieve sapflow or
environmental flags tibbles from the sfn_data objects contained in the 
sfn_data_multi and return them in a list.
</p>
<p><code>get_timestamp</code> and <code>get_solar_timestamp</code> methods retrieve only the
timestamps as POSIXct vectors and return them as a list (each element
corresponding to a site in the sfn_data_multi object).
</p>
<p><code>get_si_code</code> method retrieve a character vector with length(timestamp)
containing the site code for each site, returning them as a list.
</p>
<p><code>get_site_md</code>, <code>get_stand_md</code>, <code>get_species_md</code>,
<code>get_plant_md</code> and <code>get_env_md</code> methods retrieve the corresponding
metadata objects for each site returning them as a list, unless collapse is
TRUE, then the list collapses to a tibble.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)

</code></pre>

<hr>
<h2 id='sfn_mutate'>Mutate variables by function</h2><span id='topic+sfn_mutate'></span>

<h3>Description</h3>

<p>Port of <code><a href="dplyr.html#topic+mutate">mutate</a></code> for <code>sfn_data</code> and
<code>sfn_data_multi</code> objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sfn_mutate(sfn_data, ..., solar = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sfn_mutate_+3A_sfn_data">sfn_data</code></td>
<td>
<p><code>sfn_data</code> or <code>sfn_data_multi</code> object to subset</p>
</td></tr>
<tr><td><code id="sfn_mutate_+3A_...">...</code></td>
<td>
<p>Name-value pairs of expressions to pass to the
<code><a href="dplyr.html#topic+mutate">mutate</a></code> function.</p>
</td></tr>
<tr><td><code id="sfn_mutate_+3A_solar">solar</code></td>
<td>
<p>Logical indicating if solar timestamp must used to subset</p>
</td></tr>
</table>


<h3>Details</h3>

<p>'sfn_mutate' function will maintain the same number of rows before and after
the modification, so it is well suited to modify variables without creating
TIMESTAMP gaps (i.e. to change variable units). For mutating groups of
variables at the same time see <code><a href="#topic+sfn_mutate_at">sfn_mutate_at</a></code>.
</p>


<h3>Value</h3>

<p>For <code>sfn_data</code> objects, a mutated <code>sfn_data</code>. For
<code>sfn_data_multi</code> another <code>sfn_data_multi</code> with the sites mutated
</p>


<h3>Sapflow and environmental variables</h3>

<p>'sfn_mutate' internally joins the sapflow and environmental datasets by the
TIMESTAMP, so it is possible to mutate variables conditionally between
sapflow and environmental measures (i.e. mutate sapflow when wind is high or
radiation is zero). Due to this, at the moment any new variable is dropped
when building the final results, so this is ONLY intended to mutate
existing variables without changing the names.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
library(lubridate)

# data
data('ARG_TRE', package = 'sapfluxnetr')

# transform to NAs any wind value above 25
ws_threshold &lt;- 25
sfn_mutate(ARG_TRE, ws = if_else(ws &gt; 25, NA_real_, ws))

## multi
data(ARG_MAZ, package = 'sapfluxnetr')
data(AUS_CAN_ST2_MIX, package = 'sapfluxnetr')
multi_sfn &lt;- sfn_data_multi(ARG_TRE, ARG_MAZ, AUS_CAN_ST2_MIX)

multi_sfn_mutated &lt;- sfn_mutate(
  multi_sfn, ws = if_else(ws &gt; 25, NA_real_, ws)
)

multi_sfn_mutated[['ARG_TRE']]

</code></pre>

<hr>
<h2 id='sfn_mutate_at'>Mutate selected columns by function</h2><span id='topic+sfn_mutate_at'></span>

<h3>Description</h3>

<p>Port of <code><a href="dplyr.html#topic+mutate_at">mutate_at</a></code> for <code>sfn_data</code> and
<code>sfn_data_multi</code> objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sfn_mutate_at(sfn_data, .vars, .funs, ..., solar = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sfn_mutate_at_+3A_sfn_data">sfn_data</code></td>
<td>
<p><code>sfn_data</code> or <code>sfn_data_multi</code> object to subset</p>
</td></tr>
<tr><td><code id="sfn_mutate_at_+3A_.vars">.vars</code></td>
<td>
<p>Variables to mutate. Passed to <code><a href="dplyr.html#topic+mutate_at">mutate_at</a></code></p>
</td></tr>
<tr><td><code id="sfn_mutate_at_+3A_.funs">.funs</code></td>
<td>
<p>Function/s for mutate, passed to <code><a href="dplyr.html#topic+mutate_at">mutate_at</a></code></p>
</td></tr>
<tr><td><code id="sfn_mutate_at_+3A_...">...</code></td>
<td>
<p>Extra arguments to pass to the functions in <code>.funs</code>, passed
to <code><a href="dplyr.html#topic+mutate_at">mutate_at</a></code>.</p>
</td></tr>
<tr><td><code id="sfn_mutate_at_+3A_solar">solar</code></td>
<td>
<p>Logical indicating if solar timestamp must used to subset</p>
</td></tr>
</table>


<h3>Details</h3>

<p>'sfn_mutate_at' function will maintain the same number of rows before and
after the modification, so it is well suited to modify variables without
creating TIMESTAMP gaps (i.e. to change variable units). For mutating
individual variables see <code><a href="#topic+sfn_mutate">sfn_mutate</a></code>.
</p>


<h3>Value</h3>

<p>For <code>sfn_data</code> objects, a mutated <code>sfn_data</code>. For
<code>sfn_data_multi</code> another <code>sfn_data_multi</code> with the sites mutated
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
library(lubridate)

# data
data('ARG_TRE', package = 'sapfluxnetr')

# transform to NAs any sapflow value occured with wind speed above 25
ws_threshold &lt;- 25
# get the names of the variables to mutate (tree names)
vars_to_mutate &lt;- names(get_sapf_data(ARG_TRE)[,-1]) # no TIMESTAMP

sfn_mutate_at(
  ARG_TRE,
  .vars = vars(one_of(vars_to_mutate)),
  .funs = list(
    ~ case_when(
      ws &gt; ws_threshold ~ NA_real_,
      TRUE ~ .
    )
  )
)

## multi
data(ARG_MAZ, package = 'sapfluxnetr')
data(AUS_CAN_ST2_MIX, package = 'sapfluxnetr')
multi_sfn &lt;- sfn_data_multi(ARG_TRE, ARG_MAZ, AUS_CAN_ST2_MIX)

## in multi it's better to discard the variables to not mutate:
vars_to_not_mutate &lt;- names(get_env_data(ARG_TRE)) # all the environmental

multi_sfn_mutated &lt;- sfn_mutate_at(
  multi_sfn,
  .vars = vars(-one_of(vars_to_not_mutate)), # we use -
  .funs = list(
    ~ case_when(
      ws &gt; ws_threshold ~ NA_real_,
      TRUE ~ .
    )
  )
)

multi_sfn_mutated[['ARG_TRE']]

</code></pre>

<hr>
<h2 id='sfn_plot'>plot method for sfn_data class</h2><span id='topic+sfn_plot'></span>

<h3>Description</h3>

<p>Plot the desired data from a site object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sfn_plot(
  sfn_data,
  type = c("sapf", "env", "ta", "rh", "vpd", "ppfd_in", "netrad", "sw_in", "ext_rad",
    "ws", "precip", "swc_shallow", "swc_deep"),
  formula_env = NULL,
  solar = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sfn_plot_+3A_sfn_data">sfn_data</code></td>
<td>
<p>sfn_data object to plot. It can be also an sfn_data_multi
object.</p>
</td></tr>
<tr><td><code id="sfn_plot_+3A_type">type</code></td>
<td>
<p>Character indicating which data to plot. See Type section for
detailed information about the available values. Ignored if formula is
provided</p>
</td></tr>
<tr><td><code id="sfn_plot_+3A_formula_env">formula_env</code></td>
<td>
<p>Right side formula indicating an environmental variable to
plot vs. the sapflow values. If NULL (default), <code>sfn_plot</code> will use
&quot;type&quot; to guess which plot show.</p>
</td></tr>
<tr><td><code id="sfn_plot_+3A_solar">solar</code></td>
<td>
<p>Logical indicating if the solar timestamp must be used instead
of the site timestamp</p>
</td></tr>
<tr><td><code id="sfn_plot_+3A_...">...</code></td>
<td>
<p>Further arguments to be passed on <code><a href="ggplot2.html#topic+geom_point">geom_point</a></code> or
<code><a href="ggplot2.html#topic+geom_col">geom_col</a></code> to modify geometry aesthetics.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot object that can be called to see the plot. If input is an
sfn_data_multi object, a list with the plots
</p>


<h3>ggplot plotting system</h3>

<p><code><a href="base.html#topic+plot">plot</a></code> is a base R function which uses the base R plotting system
to show the plot. We prefer the ggplot plotting system, which allow for
storing the plots in objects and can be subjected to further modifications.
This allow the package users to generate rather simple plots that can be
fine tuned afterwards to the user taste. Generating a <code><a href="base.html#topic+plot">plot</a></code>
method for the <code>sfn_data</code> class returning a ggplot object is not
desired (it change the way plot works and can be misleading about the plot
general usage). So, instead, we offer this function, <code>sfn_plot</code>.
</p>


<h3>Type</h3>

<p><code>type</code> argument controls what is going to be plotted. It accepts
the following:
</p>

<ul>
<li><p>&quot;sapf&quot;: It will plot sapflow data vs. TIMESTAMP
</p>
</li>
<li><p>&quot;env&quot;: It will plot environmental variables vs. TIMESTMAP
</p>
</li>
<li><p>&quot;ta&quot;, &quot;rh&quot;, &quot;vpd&quot;, &quot;ppfd_in&quot;, &quot;netrad&quot;, &quot;sw_in&quot;, &quot;ext_rad&quot;,
&quot;ws&quot;, &quot;precip&quot;, &quot;swc_shallow&quot; and &quot;swc_deep&quot;: They will plot
the corresponding variable vs. TIMESTAMP
</p>
</li></ul>



<h3>Formula</h3>

<p><code>formula</code> argument can be used to select an environmental variable to
plot versus all the sapflow measurements. Any environmental variable is
allowed, if it exist in the site provided.
</p>


<h3>Geometry</h3>

<p>By default <code>sfn_plot</code> generates plots using <code><a href="ggplot2.html#topic+geom_point">geom_point</a></code>
geometry, except in the case of <code>type = "ws"</code> and
<code>type = "precip"</code> where <code><a href="ggplot2.html#topic+geom_col">geom_col</a></code> is used. These
geometries can be modified with the <code>...</code> argument.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)

# data
data('ARG_TRE', package = 'sapfluxnetr')

# plotting directly
sfn_plot(ARG_TRE, type = 'sapf')

# this could be noisy, you can facet by "Tree" (for sapflow) or by
# "Variable" (for environmental data):
sfn_plot(ARG_TRE, type = 'sapf') +
  facet_wrap(~ Tree)

sfn_plot(ARG_TRE, type = 'env') +
  facet_wrap(~ Variable, scales = 'free_y')

# saving and modifying:
env_plot &lt;- sfn_plot(ARG_TRE, type = 'env', solar = FALSE) +
  facet_wrap(~ Variable, scales = 'free_y')
env_plot + labs(title = 'Environmental variables facet plot')

# formula
sfn_plot(ARG_TRE, formula_env = ~ vpd)

</code></pre>

<hr>
<h2 id='sfn_replacement_generics'>sfn_data replacement generics</h2><span id='topic+sfn_replacement_generics'></span><span id='topic+get_sapf_data+3C-'></span><span id='topic+get_env_data+3C-'></span><span id='topic+get_sapf_flags+3C-'></span><span id='topic+get_env_flags+3C-'></span><span id='topic+get_timestamp+3C-'></span><span id='topic+get_solar_timestamp+3C-'></span><span id='topic+get_si_code+3C-'></span><span id='topic+get_site_md+3C-'></span><span id='topic+get_stand_md+3C-'></span><span id='topic+get_species_md+3C-'></span><span id='topic+get_plant_md+3C-'></span><span id='topic+get_env_md+3C-'></span>

<h3>Description</h3>

<p>Generic functions for replacement functions for sfn_data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_sapf_data(object) &lt;- value

get_env_data(object) &lt;- value

get_sapf_flags(object) &lt;- value

get_env_flags(object) &lt;- value

get_timestamp(object) &lt;- value

get_solar_timestamp(object) &lt;- value

get_si_code(object) &lt;- value

get_site_md(object) &lt;- value

get_stand_md(object) &lt;- value

get_species_md(object) &lt;- value

get_plant_md(object) &lt;- value

get_env_md(object) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sfn_replacement_generics_+3A_object">object</code></td>
<td>
<p>Object to replace</p>
</td></tr>
<tr><td><code id="sfn_replacement_generics_+3A_value">value</code></td>
<td>
<p>Object to replace with</p>
</td></tr>
</table>


<h3>Details</h3>

<p>see <code><a href="#topic+sfn_replacement_methods">sfn_replacement_methods</a></code> for more info about using the
replacement methods in sfn_data objects
</p>

<hr>
<h2 id='sfn_replacement_methods'>sfn_data replacement methods</h2><span id='topic+sfn_replacement_methods'></span><span id='topic+get_sapf_data+3C-+2Csfn_data-method'></span><span id='topic+get_env_data+3C-+2Csfn_data-method'></span><span id='topic+get_sapf_flags+3C-+2Csfn_data-method'></span><span id='topic+get_env_flags+3C-+2Csfn_data-method'></span><span id='topic+get_timestamp+3C-+2Csfn_data-method'></span><span id='topic+get_solar_timestamp+3C-+2Csfn_data-method'></span><span id='topic+get_si_code+3C-+2Csfn_data-method'></span><span id='topic+get_site_md+3C-+2Csfn_data-method'></span><span id='topic+get_stand_md+3C-+2Csfn_data-method'></span><span id='topic+get_species_md+3C-+2Csfn_data-method'></span><span id='topic+get_plant_md+3C-+2Csfn_data-method'></span><span id='topic+get_env_md+3C-+2Csfn_data-method'></span>

<h3>Description</h3>

<p>Methods to replace the data and metadata from the sfn_data class slots
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 replacement method for signature 'sfn_data'
get_sapf_data(object) &lt;- value

## S4 replacement method for signature 'sfn_data'
get_env_data(object) &lt;- value

## S4 replacement method for signature 'sfn_data'
get_sapf_flags(object) &lt;- value

## S4 replacement method for signature 'sfn_data'
get_env_flags(object) &lt;- value

## S4 replacement method for signature 'sfn_data'
get_timestamp(object) &lt;- value

## S4 replacement method for signature 'sfn_data'
get_solar_timestamp(object) &lt;- value

## S4 replacement method for signature 'sfn_data'
get_si_code(object) &lt;- value

## S4 replacement method for signature 'sfn_data'
get_site_md(object) &lt;- value

## S4 replacement method for signature 'sfn_data'
get_stand_md(object) &lt;- value

## S4 replacement method for signature 'sfn_data'
get_species_md(object) &lt;- value

## S4 replacement method for signature 'sfn_data'
get_plant_md(object) &lt;- value

## S4 replacement method for signature 'sfn_data'
get_env_md(object) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sfn_replacement_methods_+3A_object">object</code></td>
<td>
<p>sfn_data containing the slot to replace</p>
</td></tr>
<tr><td><code id="sfn_replacement_methods_+3A_value">value</code></td>
<td>
<p>object with the data to replace sfn_data slot with</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The replacement object must be a valid object for that slot:
</p>

<ul>
<li><p>For <code>get_sapf_data</code>, <code>get_env_data</code>, <code>get_sapf_flags</code> and
<code>get_env_flags</code> a data.frame or tibble without the TIMESTAMP
variable
</p>
</li>
<li><p>For <code>get_*_md</code> a data.frame or tibble
</p>
</li>
<li><p>For <code>get_timestamp</code> and <code>get_solar_timestamp</code> a POSIXct
vector of length == nrow(sapf/env_data)
</p>
</li>
<li><p>For <code>get_si_code</code> a character vector
</p>
</li></ul>

<p>Validity is automatically checked before modifying the sfn_data object, and
an error is raised if not valid
</p>


<h3>Examples</h3>

<pre><code class='language-R'># preparation
data('ARG_TRE', package = 'sapfluxnetr')
sapf_data &lt;- get_sapf_data(ARG_TRE, solar = TRUE)

# modifying the slot data
sapf_data[1:10, 2] &lt;- NA

# replacement. Remember, the sfn_data slot does not contain a TIMESTAMP
# variable, it must be removed
get_sapf_data(ARG_TRE) &lt;- sapf_data[,-1]

</code></pre>

<hr>
<h2 id='sfn_sites_in_folder'>list available sites in a db folder</h2><span id='topic+sfn_sites_in_folder'></span>

<h3>Description</h3>

<p>Retrieves the site codes in the specified folder
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sfn_sites_in_folder(folder = ".")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sfn_sites_in_folder_+3A_folder">folder</code></td>
<td>
<p>Character vector of length 1 indicating the route to the
db folder</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If folder
</p>


<h3>Value</h3>

<p>A character vector with the site codes present in the folder, an
error if the folder is not valid or does not contain any site data file.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Let's access the data in "folder". This typically is the folder where the
# sapflow data at the desired unit level is (i.e. "RData/plant"), but in this
# example we will create a temporal folder with some data to test the function
folder &lt;- tempdir()
save(ARG_TRE, file = file.path(folder, 'ARG_TRE.RData'))
save(ARG_MAZ, file = file.path(folder, 'ARG_MAZ.RData'))
save(AUS_CAN_ST2_MIX, file = file.path(folder, 'AUS_EUC_ST2_MIX.RData'))

# lets see the sites
sites &lt;- sfn_sites_in_folder(folder)

</code></pre>

<hr>
<h2 id='sfn_vars_to_filter'>List all variables that can be used to filter sites</h2><span id='topic+sfn_vars_to_filter'></span>

<h3>Description</h3>

<p><code>sfn_vars_to_filter()</code> returns a list with the variables for each
kind of metadata that can be used to select and filter sites
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sfn_vars_to_filter()
</code></pre>


<h3>Value</h3>

<p>A list with five elements, <code>site_md</code>, <code>stand_md</code>,
<code>species_md</code>, <code>plant_md</code> and <code>env_md</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># all variables
sfn_vars_to_filter()

# by some metadata
sfn_vars_to_filter()$site_md

</code></pre>

<hr>
<h2 id='show+2Csfn_data_multi-method'>Show method for sfn_data_multi</h2><span id='topic+show+2Csfn_data_multi-method'></span>

<h3>Description</h3>

<p>print a summary for sfn_data_multi objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'sfn_data_multi'
show(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="show+2B2Csfn_data_multi-method_+3A_object">object</code></td>
<td>
<p>sfn_data_multi object to show</p>
</td></tr>
</table>

<hr>
<h2 id='show+2Csfn_data-method'>Show method for sfn_data</h2><span id='topic+show+2Csfn_data-method'></span>

<h3>Description</h3>

<p>print a summary for sfn_data objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'sfn_data'
show(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="show+2B2Csfn_data-method_+3A_object">object</code></td>
<td>
<p>sfn_data object to show</p>
</td></tr>
</table>

<hr>
<h2 id='summarise_by_period'>Summaries by period</h2><span id='topic+summarise_by_period'></span>

<h3>Description</h3>

<p>This function collapse the TIMESTAMP to the desired period (day, month...)
by setting the same value to all timestamps within the period. This modified
TIMESTAMP is used to group by and summarise the data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>summarise_by_period(data, period, .funs, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summarise_by_period_+3A_data">data</code></td>
<td>
<p>sapflow or environmental data as obtained by <code><a href="#topic+get_sapf_data">get_sapf_data</a></code>
and <code><a href="#topic+get_env_data">get_env_data</a></code>. Must have a column named TIMESTAMP</p>
</td></tr>
<tr><td><code id="summarise_by_period_+3A_period">period</code></td>
<td>
<p>period to collapse by. See <code><a href="#topic+sfn_metrics">sfn_metrics</a></code> for details.</p>
</td></tr>
<tr><td><code id="summarise_by_period_+3A_.funs">.funs</code></td>
<td>
<p>funs to summarise the data. See details.</p>
</td></tr>
<tr><td><code id="summarise_by_period_+3A_...">...</code></td>
<td>
<p>optional arguments. See details</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function uses internally <code><a href="#topic+.collapse_timestamp">.collapse_timestamp</a></code> and
<code><a href="dplyr.html#topic+summarise_all">summarise_all</a></code>. Arguments to control these functions
can be passed as '...'. Arguments for each function are spliced and applied
when needed. Be advised that all arguments passed to the summarise_all function
will be applied to all the summarising functions used, so it will fail if any
of that functions does not accept that argument. To complex function-argument
relationships, indicate each summary function call within the <code>.funs</code>
argument as explained here <code><a href="dplyr.html#topic+summarise_all">summarise_all</a></code>:
</p>
<pre>
# This will fail beacuse na.rm argument will be also passed to the n function,
# which does not accept any argument:
summarise_by_period(
  data = get_sapf_data(ARG_TRE),
  period = '7 days',
  .funs = list(mean, sd, n()),
  na.rm = TRUE
)

# to solve this is better to use the .funs argument:
summarise_by_period(
  data = get_sapf_data(ARG_TRE),
  period = '7 days',
  .funs = list(~ mean(., na.rm = TRUE), ~ sd(., na.rm = TRUE), ~ n())
)
</pre>


<h3>Value</h3>

<p>A 'tbl_df' object with the metrics results. The names of the columns
indicate the original variable (tree or environmental variable) and the
metric calculated (i.e. 'vpd_mean'), separated by underscore
</p>


<h3>TIMESTAMP_coll</h3>

<p>Previously to the collapsing step, a temporal variable called
<code>TIMESTAMP_coll</code> is created to be able to catch the real timestamp when
some events happens, for example to use the <code>min_time</code> function. If
your custom summarise function needs to get the time at which some event
happens, use TIMESTAMP_coll instead of TIMESTAMP for that:
</p>
<pre>
    min_time &lt;- function(x, time) {
      time[which.min(x)]
    }

    summarise_by_period(
      data = get_sapf_data(ARG_TRE),
      period = '1 day',
      .funs = list(~ min_time(., time = TIMESTAMP_coll)) # Not TIMESTAMP
    )
  </pre>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)

# data
data('ARG_TRE', package = 'sapfluxnetr')

# simple summary
summarise_by_period(
  data = get_sapf_data(ARG_TRE),
  period = '7 days',
  .funs = list(~ mean(., na.rm = TRUE), ~ sd(., na.rm = TRUE), ~ n())
)

</code></pre>

<hr>
<h2 id='time_at_events'>time at maximum/minimum</h2><span id='topic+time_at_events'></span><span id='topic+max_time'></span><span id='topic+min_time'></span>

<h3>Description</h3>

<p>helpers for sfn_metrics
</p>


<h3>Usage</h3>

<pre><code class='language-R'>max_time(x, time)

min_time(x, time)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="time_at_events_+3A_x">x</code></td>
<td>
<p>a numeric vector, usually a variable in the sapflow or environmental
data.</p>
</td></tr>
<tr><td><code id="time_at_events_+3A_time">time</code></td>
<td>
<p>a POSIXct or character vector with the TIMESTAMP values</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These helper functions return the TIMESTAMP value at which the maximum value
for other variable occurs. It is designed to be used inside a dplyr summarise
statement.
</p>


<h3>Value</h3>

<p>a single value (POSIXct) with the TIMESTAMP value.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>max_time()</code>: helper for sfn_metrics
</p>
</li>
<li> <p><code>min_time()</code>: helper for sfn_metrics
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
storms %&gt;%
  group_by(year) %&gt;%
  summarise(wind_max = max(wind),
            hour_at_max = sapfluxnetr:::max_time(wind, time = hour),
            wind_min = min(wind),
            hour_at_min = sapfluxnetr:::min_time(wind, time = hour))

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
