<!DOCTYPE html><html><head><title>Help for package BAMMtools</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {BAMMtools}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#addBAMMlegend'><p>Add a color legend to a phylo-rate plot</p></a></li>
<li><a href='#addBAMMshifts'><p>Add <code>BAMM</code>-inferred rate shifts to a phylogeny plot</p></a></li>
<li><a href='#assignColorBreaks'><p>Map macroevolutionary rates to colors</p></a></li>
<li><a href='#BAMMlikelihood'><p>Calculate <code>BAMM</code> likelihood</p></a></li>
<li><a href='#BAMMtools'><p>BAMMtools</p></a></li>
<li><a href='#BAMMtools-data'><p>BAMMtools datasets</p></a></li>
<li><a href='#cohorts'><p>Visualize macroevolutionary cohorts</p></a></li>
<li><a href='#computeBayesFactors'><p>Compute Bayes Factors</p></a></li>
<li><a href='#credibleShiftSet'><p>Credible set of macroevolutionary rate shift configurations from</p>
<code>BAMM</code> results</a></li>
<li><a href='#cumulativeShiftProbsTree'><p>Branch-specific rate shift probabilities</p></a></li>
<li><a href='#distinctShiftConfigurations'><p>Identify distinct rate shift configurations</p></a></li>
<li><a href='#dtRates'><p>Calculate macroevolutionary rate changes on a phylogeny from</p>
<code>BAMM</code> output</a></li>
<li><a href='#generateControlFile'><p>Generate control file for <code>BAMM</code></p></a></li>
<li><a href='#getBestShiftConfiguration'><p>Get the best (sampled) rate shift configuration from a <code>BAMM</code></p>
analysis</a></li>
<li><a href='#getBranchShiftPriors'><p>Compute prior odds of a rate shift on each branch of a phylogeny</p>
from BAMM output</a></li>
<li><a href='#getCladeRates'><p>Compute clade-specific mean rates</p></a></li>
<li><a href='#getCohortMatrix'><p>Compute the pairwise correlation in rate regimes between all tips</p>
in a <code>bammdata</code> object</a></li>
<li><a href='#getEventData'><p>Create <code>bammdata</code> object from MCMC output</p></a></li>
<li><a href='#getJenksBreaks'><p>Jenks natural breaks classification</p></a></li>
<li><a href='#getMarginalBranchRateMatrix'><p>Compute mean branch rates for <code>bammdata</code> object</p></a></li>
<li><a href='#getMeanBranchLengthTree'><p>Compute phylogeny with branch lengths equal to corresponding</p>
macroevolutionary rate estimates</a></li>
<li><a href='#getmrca'><p>Find most recent common ancestors</p></a></li>
<li><a href='#getRateThroughTimeMatrix'><p>Generate rate-through-time matrix from <code>bammdata</code> object</p></a></li>
<li><a href='#getShiftNodesFromIndex'><p>Identify nodes associated with rate shifts from <code>bammdata</code></p>
object</a></li>
<li><a href='#getTipRates'><p>Compute tip-specific macroevolutionary rates from <code>bammdata</code></p>
object</a></li>
<li><a href='#marginalOddsRatioBranches'><p>Ratio of (marginal) posterior-to-prior probabilities on individual</p>
branches</a></li>
<li><a href='#maximumShiftCredibility'><p>Estimate maximum shift credibility configuration</p></a></li>
<li><a href='#plot.bammdata'><p>Plot <code>BAMM</code>-estimated macroevolutionary rates on a phylogeny</p></a></li>
<li><a href='#plot.bammshifts'><p>Plot distinct rate shift configurations on a phylogeny</p></a></li>
<li><a href='#plot.credibleshiftset'><p>Plot credible set of rate shift configurations from <code>BAMM</code></p>
analysis</a></li>
<li><a href='#plotPrior'><p>Plot the prior and posterior distribution of shifts</p></a></li>
<li><a href='#plotRateThroughTime'><p>Plot rates through time</p></a></li>
<li><a href='#ratesHistogram'><p>Histogram of <code>BAMM</code> rate frequencies</p></a></li>
<li><a href='#richColors'><p>Rich color palette</p></a></li>
<li><a href='#samplingProbs'><p>Creates clade-specific sampling fractions</p></a></li>
<li><a href='#setBAMMpriors'><p>Set BAMM Priors</p></a></li>
<li><a href='#speciesByRatesMatrix'><p>Compute species-specific rate through time trajectories</p></a></li>
<li><a href='#stepBF'><p>Identify the optimal number of shifts using Bayes factors</p></a></li>
<li><a href='#subsetEventData'><p>Subset a <code>bammdata</code> object</p></a></li>
<li><a href='#subtreeBAMM'><p>Pulls out a subtree from <code>bammdata</code> object</p></a></li>
<li><a href='#summary.bammdata'><p>Summary of rate shift results from <code>BAMM</code> analysis</p></a></li>
<li><a href='#summary.credibleshiftset'><p>Summary of credible set of shift configurations from a <code>BAMM</code></p>
analysis</a></li>
<li><a href='#testTimeVariableBranches'><p>Evaluate evidence for temporal rate variation across tree</p></a></li>
<li><a href='#traitDependentBAMM'><p>STRAPP: STructured Rate Permutations on Phylogenies</p></a></li>
<li><a href='#transparentColor'><p>Define colors with transparency</p></a></li>
<li><a href='#writeEventData'><p>Write a <code>bammdata</code> object to disk</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Analysis and Visualization of Macroevolutionary Dynamics on
Phylogenetic Trees</td>
</tr>
<tr>
<td>Version:</td>
<td>2.1.11</td>
</tr>
<tr>
<td>Author:</td>
<td>Dan Rabosky, Mike Grundler, Pascal Title, Carlos Anderson, Jeff Shi,
    Joseph Brown, Huateng Huang, Jon Mitchell</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Pascal Title &lt;ptitle@umich.edu&gt;</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp (&ge; 0.11.0), gplots, methods</td>
</tr>
<tr>
<td>Depends:</td>
<td>ape, R (&ge; 2.10)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>parallel</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides functions for analyzing and visualizing complex
    macroevolutionary dynamics on phylogenetic trees. It is a companion
    package to the command line program BAMM (Bayesian Analysis of
    Macroevolutionary Mixtures) and is entirely oriented towards the analysis,
    interpretation, and visualization of evolutionary rates. Functionality
    includes visualization of rate shifts on phylogenies, estimating
    evolutionary rates through time, comparing posterior distributions of
    evolutionary rates across clades, comparing diversification models using
    Bayes factors, and more.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="http://bamm-project.org/">http://bamm-project.org/</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-12-18 17:47:17 UTC; pascaltitle</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-12-19 05:50:09 UTC</td>
</tr>
</table>
<hr>
<h2 id='addBAMMlegend'>Add a color legend to a phylo-rate plot</h2><span id='topic+addBAMMlegend'></span>

<h3>Description</h3>

<p>Add a legend to a phylorate plot, with greater manual
control.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>addBAMMlegend(
  x,
  direction,
  side,
  location = "topleft",
  nTicks = 2,
  stretchInterval = FALSE,
  shortFrac = 0.02,
  longFrac = 0.3,
  axisOffset = 0.002,
  cex.axis = 0.8,
  labelDist = 0.7,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="addBAMMlegend_+3A_x">x</code></td>
<td>
<p>A <code>plot.bammdata</code> object.</p>
</td></tr>
<tr><td><code id="addBAMMlegend_+3A_direction">direction</code></td>
<td>
<p>Direction of color ramp. If omitted, then direction is 
automatically inferred, otherwise can be specified as horizontal or
vertical.</p>
</td></tr>
<tr><td><code id="addBAMMlegend_+3A_side">side</code></td>
<td>
<p>Side for tick marks, see <code><a href="graphics.html#topic+axis">axis</a></code> documentation.
Automatically inferred if omitted.</p>
</td></tr>
<tr><td><code id="addBAMMlegend_+3A_location">location</code></td>
<td>
<p>Either a location name (see Details), or coordinates for
the corners of the bar legend c(xmin, xmax, ymin, ymax).</p>
</td></tr>
<tr><td><code id="addBAMMlegend_+3A_nticks">nTicks</code></td>
<td>
<p>Number of tick marks, besides min and max.</p>
</td></tr>
<tr><td><code id="addBAMMlegend_+3A_stretchinterval">stretchInterval</code></td>
<td>
<p>If color.interval was defined, should the legend be
stretched to the color.interval, or should the full range of rates be 
presented.</p>
</td></tr>
<tr><td><code id="addBAMMlegend_+3A_shortfrac">shortFrac</code></td>
<td>
<p>Percent of the plot width range that will be used as the
short dimention of the legend. Only applies to preset location
options.</p>
</td></tr>
<tr><td><code id="addBAMMlegend_+3A_longfrac">longFrac</code></td>
<td>
<p>Percent of the plot width range that will be used as the
long dimension of the legend. Only applies to preset location options.</p>
</td></tr>
<tr><td><code id="addBAMMlegend_+3A_axisoffset">axisOffset</code></td>
<td>
<p>Distance from color bar for labels, as a percent of the
plot width.</p>
</td></tr>
<tr><td><code id="addBAMMlegend_+3A_cex.axis">cex.axis</code></td>
<td>
<p>Size of axis labels.</p>
</td></tr>
<tr><td><code id="addBAMMlegend_+3A_labeldist">labelDist</code></td>
<td>
<p>Distance from axis to axis labels (passed to mgp).</p>
</td></tr>
<tr><td><code id="addBAMMlegend_+3A_...">...</code></td>
<td>
<p>Additional parameters to be passed to axis.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A number of predefined locations exist in this function to make
it easy to add a legend to a phylorate plot. Preset <code>locations</code>
are: <code>topleft</code>, <code>topright</code>, <code>bottomleft</code>,
<code>bottomright</code>, <code>left</code>, <code>right</code>, <code>top</code> and
<code>bottom</code>. If more fine-tuned control is desired, then a numeric
vector of length 4 can be supplied to <code>location</code>, specifying the
min x, max x, min y and max y values for the legend. See
<code>Examples</code>.
</p>


<h3>Value</h3>

<p>Invisibly returns a list with the following components:
</p>

<ul>
<li><p> coords: A 2-column matrix of xy coordinates for each color
bin in the legend.
</p>
</li>
<li><p> width: Coordinates for the short dimension of the legend.
</p>
</li>
<li><p> pal: The color ramp.
</p>
</li>
<li><p> tickLocs: The tick mark locations in plotting units.
</p>
</li>
<li><p> labels: The rate values associated with those tick
locations.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pascal Title
</p>


<h3>See Also</h3>

<p>Requires an object created with <code><a href="#topic+plot.bammdata">plot.bammdata</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)
ephy &lt;- getEventData(whales, events.whales, burnin = 0.25, nsamples = 300)

# plot phylorate with extra margin space
x &lt;- plot(ephy, lwd = 2, mar = c(5,4,4,4)) 
# presets
addBAMMlegend(x, location = 'topleft')
addBAMMlegend(x, location = 'bottom')
addBAMMlegend(x, location = 'right')

# fine-tune placement
x &lt;- plot(ephy, lwd = 2, mar = c(5,4,4,4)) 
axis(1); axis(2)
addBAMMlegend(x, location = c(-1, -0.5, 40, 80), nTicks = 4)
addBAMMlegend(x, location = c(5, 20, 60, 61), nTicks = 4, side = 3,
              cex.axis = 0.7)

# addBAMMlegend also automatically detects the use of color.interval
data(primates, events.primates)
ephy &lt;- getEventData(primates, events.primates, burnin=0.25,
                     nsamples = 300, type = 'trait')

x &lt;- plot(ephy, breaksmethod = 'linear',
          color.interval = c(NA, 0.12), lwd = 2)
addBAMMlegend(x, location = c(0, 30, 200, 205), nTicks = 1, side = 3)
</code></pre>

<hr>
<h2 id='addBAMMshifts'>Add <code>BAMM</code>-inferred rate shifts to a phylogeny plot</h2><span id='topic+addBAMMshifts'></span>

<h3>Description</h3>

<p>Adds symbols to a plotted tree to mark the location(s) where
there is a shift in the macroevolutionary dynamics of diversification
or trait evolution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>addBAMMshifts(
  ephy,
  index = 1,
  method = "phylogram",
  cex = 1,
  pch = 21,
  col = 1,
  bg = 2,
  msp = NULL,
  shiftnodes = NULL,
  par.reset = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="addBAMMshifts_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="addBAMMshifts_+3A_index">index</code></td>
<td>
<p>An integer indicating which posterior sample to use for
adding shifts to the plotted tree.</p>
</td></tr>
<tr><td><code id="addBAMMshifts_+3A_method">method</code></td>
<td>
<p>A character string indicating the method used in plotting.
Must be &quot;polar&quot; or &quot;phylogram&quot;.</p>
</td></tr>
<tr><td><code id="addBAMMshifts_+3A_cex">cex</code></td>
<td>
<p>A numeric indicating the character expansion (&quot;size&quot;) of the
plotted points.</p>
</td></tr>
<tr><td><code id="addBAMMshifts_+3A_pch">pch</code></td>
<td>
<p>An integer indicating the choice of plotting symbol.</p>
</td></tr>
<tr><td><code id="addBAMMshifts_+3A_col">col</code></td>
<td>
<p>An integer or character string indicating the border color of
the plotting symbol.</p>
</td></tr>
<tr><td><code id="addBAMMshifts_+3A_bg">bg</code></td>
<td>
<p>An integer or character string indicating the background color
of the plotting symbol.</p>
</td></tr>
<tr><td><code id="addBAMMshifts_+3A_msp">msp</code></td>
<td>
<p>If not <code>NULL</code>, an object of class <code>phylo</code> where each
branch length is equal to the marginal probability of a shift
occurring on that branch. Plotted points corresponding to shifts will
be sized by these probabilities.</p>
</td></tr>
<tr><td><code id="addBAMMshifts_+3A_shiftnodes">shiftnodes</code></td>
<td>
<p>An optional vector of node numbers indicating the
locations of shifts to plot.</p>
</td></tr>
<tr><td><code id="addBAMMshifts_+3A_par.reset">par.reset</code></td>
<td>
<p>A logical indicating whether to reset the graphical
parameters before exiting.</p>
</td></tr>
<tr><td><code id="addBAMMshifts_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed to <code><a href="graphics.html#topic+points">points</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Any given sample from the posterior distribution sampled using
<code>BAMM</code> contains a potentially unique configuration of rate shifts
and associated parameters. There is no single &quot;best&quot; rate shift, but
rather a set of shift configurations (and associated parameters) -
along with their relative probabilities - sampled with MCMC. This
function enables the user to plot the locations of shifts sampled with
<code>BAMM</code> for a given sample from the posterior. 
</p>
<p>If the <code>bammdata</code> object contains just a single sample, these
shifts will be plotted regardless of the value of <code>index</code>.
</p>


<h3>Note</h3>

<p>If a <code>shiftnodes</code> argument is passed care should be taken to
ensure that the nodes are in the same order as in the event data for
the sample index.
</p>


<h3>Author(s)</h3>

<p>Mike Grundler
</p>


<h3>See Also</h3>

<p><code><a href="#topic+getShiftNodesFromIndex">getShiftNodesFromIndex</a></code>, <code><a href="#topic+plot.bammdata">plot.bammdata</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)
ed &lt;- getEventData(whales, events.whales, burnin=0.25, nsamples = 500)

# adding shifts to tree for specific posterior samples
plot(ed, method="polar")
addBAMMshifts(ed, index=5, "polar")

# multi-panel plotting and adding shifts
par(mfrow=c(2,3),mar=c(5,1,1,1))
samples = sample(1:length(ed$eventData), 6)
for (i in 1:6) {
  sed &lt;- subsetEventData(ed, samples[i])
  plot(sed, par.reset=FALSE)
  addBAMMshifts(sed,index=1,method="phylogram",par.reset=FALSE)	
}
</code></pre>

<hr>
<h2 id='assignColorBreaks'>Map macroevolutionary rates to colors</h2><span id='topic+assignColorBreaks'></span>

<h3>Description</h3>

<p>Maps macroevolutionary rates to a set of <code>NCOLORS</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>assignColorBreaks(
  rates,
  NCOLORS = 64,
  spex = "s",
  logcolor = FALSE,
  method = c("linear", "quantile", "jenks"),
  JenksSubset = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="assignColorBreaks_+3A_rates">rates</code></td>
<td>
<p>A numeric vector of phenotypic rates or a list of numeric
vectors of speciation and extinction rates.</p>
</td></tr>
<tr><td><code id="assignColorBreaks_+3A_ncolors">NCOLORS</code></td>
<td>
<p>An integer number of colors to use for the mapping. Larger
numbers do not necessarily result in smoother looking color ramps. The
default is 64 and is probably sufficient for most purposes.</p>
</td></tr>
<tr><td><code id="assignColorBreaks_+3A_spex">spex</code></td>
<td>
<p>A character string. &quot;s&quot; means that speciation rates are used
to make the map, &quot;e&quot; means that extinction rates are used. &quot;netdiv&quot;
means that diversification rates are used. Ignored for <code>BAMM</code>
trait data.</p>
</td></tr>
<tr><td><code id="assignColorBreaks_+3A_logcolor">logcolor</code></td>
<td>
<p>Logical. Should the natural logarithm of rates be used for
the color map.</p>
</td></tr>
<tr><td><code id="assignColorBreaks_+3A_method">method</code></td>
<td>
<p>Determines how the color breaks are created. See Details.</p>
</td></tr>
<tr><td><code id="assignColorBreaks_+3A_jenkssubset">JenksSubset</code></td>
<td>
<p>Number of regularly spaced samples to subset from
<code>rates</code>. Only relevant when <code>method = "jenks"</code>. See Details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>method = "quantile"</code> macroevolutionary rates are binned
into <code>NCOLORS+1</code> percentiles and rates in each bin are mapped to
a color determined by the <code>pal</code> argument in <code>plot.bammdata</code>.
Alternatively, if <code>method = "linear"</code> macroevolutionary rates are
binned into <code>NCOLORS+1</code> equal length intervals between the
minimum and maximum. 
</p>
<p>If <code>method = "jenks"</code>, macroevolutionary rates are binned into
<code>NCOLORS+1</code> categories, according to the Jenks natural breaks
classification method. This method is borrowed from the field of
cartography, and seeks to minimize the variance within categories,
while maximizing the variance between categories. 
</p>
<p>The Jenks natural breaks method was ported to C from code found in the classInt R package.
</p>


<h3>Value</h3>

<p>A numeric vector of rate percentiles/intervals.
</p>


<h3>Author(s)</h3>

<p>Mike Grundler, Pascal Title
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.bammdata">plot.bammdata</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)
ed &lt;- getEventData(whales, events.whales, burnin = 0.2, nsamples = 500)

ed &lt;- dtRates(ed, 0.01)
colors &lt;- assignColorBreaks(ed$dtrates$rates, spex="s") #speciation rates
#colors &lt;- assignColorBreaks(ed$dtrates$rates[[1]]) 
#this also works for speciation rates

plot(ed, colorbreaks = colors, spex="s")
colors &lt;- assignColorBreaks(ed$dtrates$rates, spex="netdiv") 
#diversification rates

#colors &lt;- assignColorBreaks(ed$dtrates$rates[[1]] - ed$dtrates$rates[[2]]) 
#this also works for diversification rates

plot(ed, colorbreaks = colors, spex="netdiv")
</code></pre>

<hr>
<h2 id='BAMMlikelihood'>Calculate <code>BAMM</code> likelihood</h2><span id='topic+BAMMlikelihood'></span>

<h3>Description</h3>

<p>Calculates the likelihood of a phylogeny exactly as is done
by <code>BAMM</code>, given a set of events.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BAMMlikelihood(
  phy,
  eventdata,
  gen = "last",
  segLength = 0.02,
  sf = 1,
  return.intermediates = FALSE,
  e_prob_condition = "if_different",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="BAMMlikelihood_+3A_phy">phy</code></td>
<td>
<p>Either an object of class <code>phylo</code> or the path to a tree
file in newick format.</p>
</td></tr>
<tr><td><code id="BAMMlikelihood_+3A_eventdata">eventdata</code></td>
<td>
<p>A table of event data, as returned by <code>BAMM</code>, either
as an object of class <code>dataframe</code> or as the path to an event_data
file. Alternatively, a named numeric vector of length two holding
speciation (&quot;lambda&quot;) and extinction (&quot;mu&quot;) rates for the
constant-rate birth-death process.</p>
</td></tr>
<tr><td><code id="BAMMlikelihood_+3A_gen">gen</code></td>
<td>
<p>The <code>BAMM</code> generation for which the likelihood should be
calculated. Can be an integer specifying a specific generation, or
<code>last</code>, specifying the last generation, or <code>all</code>, in which
case the likelihood will be calculated for all generations.</p>
</td></tr>
<tr><td><code id="BAMMlikelihood_+3A_seglength">segLength</code></td>
<td>
<p>The relative segment length, exactly as defined for
<code>BAMM</code>.</p>
</td></tr>
<tr><td><code id="BAMMlikelihood_+3A_sf">sf</code></td>
<td>
<p>The sampling fraction.</p>
</td></tr>
<tr><td><code id="BAMMlikelihood_+3A_return.intermediates">return.intermediates</code></td>
<td>
<p>Debugging option, returns augmented
<code>phylo</code> objects for each generation, see Details.</p>
</td></tr>
<tr><td><code id="BAMMlikelihood_+3A_e_prob_condition">e_prob_condition</code></td>
<td>
<p>Approach for how extinction probabilities are
handled at nodes.</p>
</td></tr>
<tr><td><code id="BAMMlikelihood_+3A_...">...</code></td>
<td>
<p>Additional arguments that will be passed to an internal
function <code>computeBAMMlikelihood</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function allows the user to check the likelihoods computed
by <code>BAMM</code> using an independent R-based implementation. This is
designed to provide a check on potential software bugs that might be
introduced during future <code>BAMM</code> development and which might
compromise the likelihood calculation. If you observe measurable
discrepancies between the likelihood computed by this function and the
corresponding likelihood returned by <code>BAMM</code>, please inform the
<code>BAMM</code> development team.
</p>


<h3>Value</h3>

<p>If <code>return.intermediates == TRUE</code>, then <code>phylo</code> objects
are returned with the following components:
</p>
<table>
<tr><td><code>event_times</code></td>
<td>
<p>A list of length (number of nodes), where
event_times[[k]] is the vector of absolute times, in order, of
events that happened on a focal branch. If no event, it is
<code>NULL</code>.</p>
</td></tr>
<tr><td><code>event_id</code></td>
<td>
<p>A list of length equal to number of nodes, as
event_times, but holding the corresponding event id.</p>
</td></tr>
<tr><td><code>events</code></td>
<td>
<p>A dataframe giving parameters and associated nodes (and
unique index values) of the event data.</p>
</td></tr>
<tr><td><code>node_event</code></td>
<td>
<p>The event governing the process realized at the
node. This will be the first event encountered as one moves
rootwards towards the tips from the focal node.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Dan Rabosky, Pascal Title
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a global sampling fraction of 0.98 was used in generating the whales
# dataset.
data(whales, events.whales, mcmc.whales)

x &lt;- BAMMlikelihood(whales, events.whales, gen = 'last', sf = 0.98)

# Does the likelihood generated by BAMM match the R implementation?
identical(round(x, 3), mcmc.whales[nrow(mcmc.whales), 'logLik'])

# an example with a constant-rate birth-death process:
pars &lt;- c(0.5, 0.45)
names(pars) &lt;- c("lambda", "mu")
BAMMlikelihood(whales, pars, sf = 0.98)
</code></pre>

<hr>
<h2 id='BAMMtools'>BAMMtools</h2><span id='topic+BAMMtools'></span>

<h3>Description</h3>

<p>An R package for the analysis and visualization of complex
macroevolutionary dynamics. Functions in <code>BAMMtools</code> are oriented
entirely around analysis of results obtained using the <code>BAMM</code>
software (<a href="http://bamm-project.org/">http://bamm-project.org/</a>).
</p>


<h3>Author(s)</h3>

<p>Dan Rabosky, Mike Grundler, Pascal Title, Jonathan Mitchell,
Carlos Anderson, Jeff Shi, Joseph Brown, Huateng Huang
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>
<p>Rabosky, D., M. Grundler, C. Anderson, P. Title, J. Shi, J. Brown,
H. Huang and J. Larson. 2014. BAMMtools: an R package for the
analysis of evolutionary dynamics on phylogenetic trees. Methods in
Ecology and Evolution 5: 701-707.
</p>
<p>Rabosky, D. L. 2014. Automatic detection of key innovations, rate
shifts, and diversity-dependence on phylogenetic trees. PLoS ONE 9:
e89543.
</p>
<p>Shi, J. J., and D. L. Rabosky. 2015. Speciation dynamics during the
global radiation of extant bats. Evolution 69: 1528-1545.
</p>
<p>Rabosky, D. L., F. Santini, J. T. Eastman, S. A. Smith, B. L.
Sidlauskas, J. Chang, and M. E. Alfaro. 2013. Rates of speciation
and morphological evolution are correlated across the largest
vertebrate radiation. Nature Communications DOI: 10.1038/ncomms2958.
</p>

<hr>
<h2 id='BAMMtools-data'>BAMMtools datasets</h2><span id='topic+BAMMtools-data'></span><span id='topic+whales'></span><span id='topic+primates'></span><span id='topic+fishes'></span><span id='topic+mcmc.whales'></span><span id='topic+mcmc.primates'></span><span id='topic+events.whales'></span><span id='topic+events.primates'></span><span id='topic+events.fishes'></span><span id='topic+mass.primates'></span><span id='topic+traits.fishes'></span>

<h3>Description</h3>

<p>Example datasets and sample <code>BAMM</code> output for the
package <code>BAMMtools</code>.
</p>


<h3>Details</h3>

<p>This includes both the raw data and the <code>BAMM</code> output for
three example analyses. The first is an analysis of speciation and
extinction rates during the radiation of modern whales, using a
time-calibrated tree from Steeman et al. (2009). The second is a
<code>BAMM</code> analysis of phenotypic evolutionary rates (body mass)
during the radiation of extant primates, taken from Vos and Mooers
(2006) and Redding et al. (2010).The third is a <code>BAMM</code> analysis
of speciation and extinction rates for a 300-species subset of
ray-finned fishes, along with body size data for these species from
Rabosky et al. (2013). 
</p>
<p>Dataset <code>whales</code> is the raw time-calibrated tree that was
analyzed with <code>BAMM</code>, <code>primates</code> is the corresponding
time-calibrated phylogeny of 233 primate species, and <code>fishes</code>
is the time-calibrated phylogeny of 300 fish species. Log-transformed
body masses for primates are in dataset <code>mass.primates</code>, and fish
body sizes are in dataset <code>traits.fishes</code>.
</p>
<p>The MCMC output files (<code>mcmc.whales</code> and <code>mcmc.primates</code>)
are dataframes containing the raw MCMC output as generated by
<code>BAMM</code>. Column headers in the dataframes includes the sampling
generation, the current number of shifts in the simulation
(<code>N_shifts</code>), the log-prior density of the parameters
(<code>logPrior</code>), the log-likelihood of the data (<code>logLik</code>), the
current parameter of the Poisson process governing the number of
regime shifts (<code>eventRate</code>), and the MCMC acceptance rate
(<code>acceptRate</code>). This is the file that would typically be analyzed
as a first step towards assessing MCMC convergence (e.g., analyzing
effective sample sizes of <code>logLik</code> and <code>N_shifts</code>).
</p>
<p>The &quot;core&quot; <code>BAMM</code> output is included in the <em>event data</em>
files (<code>events.whales</code>, <code>events.primates</code> and
<code>events.fishes</code>). These are all the parameters sampled with MCMC
that are relevant to reconstructing the nature and location of
evolutionary rate dynamics across a phylogeny. Please refer to
<code>BAMM</code> documentation for a detailed overview of this output, but
a brief description is as follows:
</p>
<p><code>generation</code>: The index value of the state in the MCMC simulation
(the &quot;generation&quot;).
</p>
<p><code>leftchild, rightchild</code>: This defines a unique topological
location where a rate shift was sampled. Specifically, for given
right-left pair, the shift is sampled on the branch leading to the
node from which <code>rightchild</code> and <code>leftchild</code> are descended
(these two taxa are part of the spanning set of taxa for the node). If
<code>leftchild</code> is &quot;NA&quot;, this simply means that the shift was sampled
on a terminal branch.
</p>
<p><code>abstime</code>: The absolute occurrence time of the shift, assuming
that the time of the root node is 0.0.
</p>
<p><code>lambdainit, lambdashift</code>: For speciation extinction model, the
initial speciation rate and rate change parameter for the process.
</p>
<p><code>muinit</code>: For speciation extinction model, the extinction rate
(time-invariant).
</p>
<p><code>betainit, betashift</code>: For phenotypic evolutionary model, the
initial (<code>betainit</code>) rate of phenotypic evolution and the rate
change parameter (<code>betashift</code>).
</p>


<h3>Source</h3>

<p>Vos R.A., A.O. Mooers. 2006. A new dated supertree of the Primates.
Chapter 5. In Inferring large phylogenies: the big tree problem (R
Vos, Ph.D. thesis) Simon Fraser University.
</p>
<p>Redding D.W., C. DeWolff, A.O. Mooers. 2010. Evolutionary
distinctiveness, threat status and ecological oddity in primates.
Conservation Biology 24: 1052-1058. DOI:
10.1111/j.1523-1739.2010.01532.x
</p>
<p>Steeman, M.E., M.B. Hebsgaard, R.E. Fordyce, S.W.Y. Ho, D.L. Rabosky,
R. Nielsen, C. Rahbek, H. Glenner, M.V. Sorensen, E. Willerslev. 2009.
Radiation of Extant Cetaceans Driven by Restructuring of the Oceans.
Systematic Biology. 58: 573-585. DOI: 10.1093/sysbio/syp060
</p>
<p>Rabosky, D. L., F. Santini, J.T. Eastman, S. . Smith, B.L. Sidlauskas,
J. Chang, and M.E. Alfaro. 2013. Rates of speciation and morphological
evolution are correlated across the largest vertebrate radiation.
Nature Communications DOI: 10.1038/ncomms2958.
</p>

<hr>
<h2 id='cohorts'>Visualize macroevolutionary cohorts</h2><span id='topic+cohorts'></span>

<h3>Description</h3>

<p>Plots the matrix of pairwise correlations in rate regimes
between all tips in a phylogeny.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cohorts(
  x,
  ephy,
  col,
  pal,
  lwd = 1,
  ofs = 0,
  use.plot.bammdata = FALSE,
  useraster = FALSE,
  LARGE = 500,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cohorts_+3A_x">x</code></td>
<td>
<p>A matrix of pairwise correlations generated by
<code>getCohortMatrix</code>.</p>
</td></tr>
<tr><td><code id="cohorts_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="cohorts_+3A_col">col</code></td>
<td>
<p>A vector of colors passed to the function <code>image</code>. These
will be used to color the values in <code>x</code>. See documentation for
<code>image</code>. If <code>col = 'temperature'</code>, the color palette from
<code><a href="gplots.html#topic+rich.colors">rich.colors</a></code> from the gplots package will be used.</p>
</td></tr>
<tr><td><code id="cohorts_+3A_pal">pal</code></td>
<td>
<p>The palette to use if <code>use.plot.bammdata=TRUE</code>. See
options documented in the help file for <code><a href="#topic+plot.bammdata">plot.bammdata</a></code>.</p>
</td></tr>
<tr><td><code id="cohorts_+3A_lwd">lwd</code></td>
<td>
<p>A numeric indicating the width of branches in the phylogeny.</p>
</td></tr>
<tr><td><code id="cohorts_+3A_ofs">ofs</code></td>
<td>
<p>A numeric controlling the offset of the phylogeny from the
matrix plot. Appropriate values will probably be in the interval
[0,0.1].</p>
</td></tr>
<tr><td><code id="cohorts_+3A_use.plot.bammdata">use.plot.bammdata</code></td>
<td>
<p>Logical. should a phylorate plot be generated?</p>
</td></tr>
<tr><td><code id="cohorts_+3A_useraster">useraster</code></td>
<td>
<p>A logical indicating whether the function <code>image</code>
should plot the matrix as a raster.</p>
</td></tr>
<tr><td><code id="cohorts_+3A_large">LARGE</code></td>
<td>
<p>An integer. If trees have more tips than <code>LARGE</code>,
<code>useraster</code> will be coerced to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="cohorts_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code>plot.bammdata</code> if
<code>use.plot.bammdata=TRUE</code> or <code>plot.phylo</code> if 
<code>use.plot.bammdata=FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The plotting function creates an image of the <code>BAMM</code>
correlation matrix between tip lineages of the phylogeny. Each
correlation is the posterior frequency with which a pair of lineages
occurs in the same macroevolutionary rate regime. Correlations are
mapped to a set of colors, with warmer colors corresponding to higher
correlations than cooler colors. The set of colors is specified by the
<code>col</code> argument and a legend is plotted to guide interpretation of
the color-correlation map. Trees are plotted on the margins of the
matrix image. The correlation between any two tips can be inferred by
finding their intersection within the matrix image.
</p>
<p><strong>IMPORTANT</strong>: the legend DOES NOT apply to the phylorate plots
shown in the margin if <code>use.plot.bammdata=TRUE</code>.
</p>


<h3>Author(s)</h3>

<p>Mike Grundler
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.bammdata">plot.bammdata</a></code>, <code><a href="#topic+getCohortMatrix">getCohortMatrix</a></code>,
<code><a href="graphics.html#topic+image">image</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)
ed &lt;- getEventData(whales, events.whales, burnin=0.1, nsamples=500)
x &lt;- getCohortMatrix(ed)
cohorts(x, ed)
cohorts(x, ed, col='temperature')
cohorts(x, ed, ofs=0.05, col='temperature')
cohorts(x, ed, pal="temperature", col='temperature', use.plot.bammdata=TRUE)
# gray scale
cohorts(x, ed, col=gray(seq(0.2,0.9,length.out=128)),
        use.plot.bammdata=FALSE)
</code></pre>

<hr>
<h2 id='computeBayesFactors'>Compute Bayes Factors</h2><span id='topic+computeBayesFactors'></span>

<h3>Description</h3>

<p>Computes pairwise Bayes factors for a set of
macroevolutionary models sampled using <code>BAMM</code>, using MCMC
simulation output.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>computeBayesFactors(postdata, expectedNumberOfShifts, burnin = 0.1, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="computeBayesFactors_+3A_postdata">postdata</code></td>
<td>
<p>Filename for the MCMC output file from a <code>BAMM</code> run.
Alternatively, a dataframe containing this information.</p>
</td></tr>
<tr><td><code id="computeBayesFactors_+3A_expectednumberofshifts">expectedNumberOfShifts</code></td>
<td>
<p>Expected number of shifts under the prior.</p>
</td></tr>
<tr><td><code id="computeBayesFactors_+3A_burnin">burnin</code></td>
<td>
<p>What fraction of samples to discard from postdata as burnin?</p>
</td></tr>
<tr><td><code id="computeBayesFactors_+3A_...">...</code></td>
<td>
<p>Additional arguments to computeBayesFactors.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function returns a matrix of pairwise Bayes factors, where
the Bayes factor is the ratio of marginal likelihoods between two
models M<sub>i</sub> and M<sub>j</sub>. Numerator models are given as rows, and
denominator models as columns. Row names and column names give the
number of shifts in the corresponding model. Suppose you have an
output matrix with row and column names 0:3 (0, 1, 2, 3). Model 0 is a
model with just a single process (starting at the root), and no
among-lineage rate heterogeneity. 
</p>
<p>If <code>computeBayesFactors</code> gives a matrix <code>mm</code>, and
<code>mm[2,1]</code> is 10.0, this implies Bayes factor evidence of 10 in
favor of the 2nd row model (a model with 1 process; e.g.,
<code>rownames(mm)[2]</code>) over the first column model (a model with a
single process).
</p>
<p>This function will only compute Bayes factors between models which
were actually sampled during simulation of the posterior. Hence, if
a model has such low probability that it is never visited by
<code>BAMM</code> during the simulation of the posterior, it will be
impossible to estimate its posterior probability (and thus, you will
get no Bayes factors involving this particular model). This is likely
to change in the future with more robust methods for estimating
posterior probabilities in the tails of the distribution.
</p>


<h3>Value</h3>

<p>A matrix of pairwise Bayes factors between models.
</p>


<h3>Author(s)</h3>

<p>Dan Rabosky
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mcmc.whales)
computeBayesFactors(mcmc.whales, expectedNumberOfShifts = 1, burnin = 0.1)
</code></pre>

<hr>
<h2 id='credibleShiftSet'>Credible set of macroevolutionary rate shift configurations from
<code>BAMM</code> results</h2><span id='topic+credibleShiftSet'></span>

<h3>Description</h3>

<p>Computes the 95% (or any other %) credible set of
macroevolutionary rate shift configurations from a <code>bammdata</code>
object. These results can be analyzed further and/or plotted.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>credibleShiftSet(
  ephy,
  expectedNumberOfShifts,
  threshold = 5,
  set.limit = 0.95,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="credibleShiftSet_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="credibleShiftSet_+3A_expectednumberofshifts">expectedNumberOfShifts</code></td>
<td>
<p>The expected number of rate shifts under the
prior.</p>
</td></tr>
<tr><td><code id="credibleShiftSet_+3A_threshold">threshold</code></td>
<td>
<p>The marginal posterior-to-prior odds ratio for a rate
shift on a specific branch, used to distinguish core and non-core
shifts.</p>
</td></tr>
<tr><td><code id="credibleShiftSet_+3A_set.limit">set.limit</code></td>
<td>
<p>The desired limit to the credible set. A value of 0.95
will return the 95% credible set of shift configurations.</p>
</td></tr>
<tr><td><code id="credibleShiftSet_+3A_...">...</code></td>
<td>
<p>Other arguments to <code>credibleShiftSet</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Computes the 95% credible set (or XX% credible set, depending
on <code>set.limit</code>) of diversification shift configurations sampled
using <code>BAMM</code>. This is analogous to a credible set of phylogenetic
tree topologies from a Bayesian phylogenetic analysis. 
</p>
<p>To understand how this calculation is performed, one must first
distinguish between &quot;core&quot; and &quot;non-core&quot; rate shifts. A &quot;core shift&quot;
is a rate shift with a marginal probability that is substantially
elevated above the probability expected on the basis of the prior
alone. With <code>BAMM</code>, every branch in a phylogenetic tree is
associated with some non-zero prior probability of a rate shift.
Typically this is a very low per-branch shift probability (this prior
is determined by the value of the &quot;poissonRatePrior&quot; parameter in a
<code>BAMM</code> analysis). 
</p>
<p>If we compute distinct shift configurations with every sampled shift
(including those shifts with very low marginal probabilities), the
number of distinct shift configurations will be overwhelmingly high.
However, most of these configurations include shifts with marginal
probabilities that are expected even under the prior alone. Hence,
using these shifts to identify distinct shift configurations simply
generates noise and isn't particularly useful.
</p>
<p>The solution adopted in <code>BAMMtools</code> is, for each branch in the
phylogeny, to compute both the posterior and prior probabilities of a
rate shift occurring. The ratio of these probabilities is a
branch-specific marginal odds ratio: it is the marginal posterior
frequency of one or more rate shifts normalized by the corresponding
prior probability. Hence, any branch with a marginal odds ratio of
1.0 is one where the observed (posterior) odds of a rate shift are no
different from the prior odds. A value of 10 implies that the
posterior probability is 10 times the prior probability. 
</p>
<p>The user of <code>credibleShiftSet</code> must specify a <code>threshold</code>
argument. This is simply a cutoff value for identifying &quot;important&quot;
shifts for the purposes of identifying distinct shift configurations.
This does not imply that it is identifying &quot;significant&quot; shifts. See
the online documentation on this topic available at
<a href="http://bamm-project.org">http://bamm-project.org</a> for more information. If you specify
<code>threshold = 5</code> as an argument to <code>credibleShiftSet</code>, the
function will ignore all branches with marginal odds ratios less than
5 during the enumeration of topologically distinct shift
configurations. Only shifts with marginal odds ratios greater than or
equal to <code>threshold</code> will be treated as core shifts for the
purposes of identifying distinct shift configurations.
</p>
<p>For each shift configuration in the credible set, this function will
compute the average diversification parameters. For example, the most
frequent shift configuration (the maximum a posteriori shift
configuration) might have 3 shifts, and 150 samples from your
posterior (within the <code>bammdata</code> object) might show this shift
configuration. However, the parameters associated with each of these
shift configurations (the actual evolutionary rate parameters) might
be different for every sample. This function returns the mean set of
rate parameters for each shift configuration, averaging over all
samples from the posterior that can be assigned to a particular shift
configuration.
</p>


<h3>Value</h3>

<p>A class <code>credibleshiftset</code> object with many components. Most
components are an ordered list of length L, where L is the number of
distinct shift configurations in the credible set. The first list
element in each case corresponds to the shift configuration with the
maximum a posteriori probability. 
</p>
<table>
<tr><td><code>frequency</code></td>
<td>
<p>A vector of frequencies of shift configurations,
including those that account for <code>set.limit</code> (typically, 0.95
or 0.99) of the probability of the data. The index of the i'th
element of this vector is the i'th most probable shift
configuration (excepting ties).</p>
</td></tr>
<tr><td><code>shiftnodes</code></td>
<td>
<p>A list of the &quot;core&quot; rate shifts (marginal
probability &gt; threshold) that occurred in each distinct shift
configuration in the credible set. The i'th vector from this list
gives the core shift nodes for the i'th shift configuration. They
are sorted by frequency, so <code>x$shiftnodes[[1]]</code> gives the
shift nodes that occurred together in the shift configuration with
the highest posterior probability.</p>
</td></tr>
<tr><td><code>indices</code></td>
<td>
<p>A list of vectors containing the indices of samples in
the <code>bammdata</code> object that are assigned to a given shift
configuration. All are sorted by frequency.</p>
</td></tr>
<tr><td><code>cumulative</code></td>
<td>
<p>Like <code>frequency</code>, but contains the cumulative
frequencies.</p>
</td></tr>
<tr><td><code>threshold</code></td>
<td>
<p>The marginal posterior-to-prior odds for rate shifts
on branches used during enumeration of distinct shift
configurations.</p>
</td></tr>
<tr><td><code>number.distinct</code></td>
<td>
<p>Number of distinct shift configurations in the
credible set.</p>
</td></tr>
<tr><td><code>set.limit</code></td>
<td>
<p>which credible set is this (0.9, 0.95, etc)?</p>
</td></tr>
<tr><td><code>coreshifts</code></td>
<td>
<p>A vector of node numbers corresponding to the core
shifts. All of these nodes have a Bayes factor of at least
<code>BFcriterion</code> supporting a rate shift.</p>
</td></tr>
</table>
<p>In addition, a number of components that are defined similarly in
class <code>phylo</code> or class <code>bammdata</code> objects:
</p>
<table>
<tr><td><code>edge</code></td>
<td>
<p>See documentation for class <code>phylo</code> in package ape.</p>
</td></tr>
<tr><td><code>Nnode</code></td>
<td>
<p>See documentation for class <code>phylo</code> in package ape.</p>
</td></tr>
<tr><td><code>tip.label</code></td>
<td>
<p>See documentation for class <code>phylo</code> in package
ape.</p>
</td></tr>
<tr><td><code>edge.length</code></td>
<td>
<p>See documentation for class <code>phylo</code> in package
ape.</p>
</td></tr>
<tr><td><code>begin</code></td>
<td>
<p>The beginning time of each branch in absolute time (the
root is set to time zero)</p>
</td></tr>
<tr><td><code>end</code></td>
<td>
<p>The ending time of each branch in absolute time.</p>
</td></tr>
<tr><td><code>numberEvents</code></td>
<td>
<p>An integer vector with the number of core events
contained in the <code>bammdata</code> object for each shift
configuration in the credible set. The length of this vector is
equal to the number of distinct shift configurations in the
credible set.</p>
</td></tr>
<tr><td><code>eventData</code></td>
<td>
<p>A list of dataframes. Each element holds the average
rate and location parameters for all samples from the posterior
that were assigned to a particular distinct shift configuration.
Each row in a dataframe holds the data for a single event. Data
associated with an event are: <code>node</code> - a node number. This
identifies the branch where the event originates. <code>time</code> -
this is the absolute time on that branch where the event
originates (with the root at time 0). <code>lam1</code> - an initial
rate of speciation or trait evolution.<code>lam2</code> - a decay/growth
parameter. <code>mu1</code> - an initial rate of extinction. <code>mu2</code>
- a decay/growth parameter. <code>index</code> - a unique integer
associated with the event. See 'Details' in the documentation for
<code><a href="#topic+getEventData">getEventData</a></code> for more information.</p>
</td></tr>
<tr><td><code>eventVectors</code></td>
<td>
<p>A list of integer vectors. Each element is for a
single shift configuration in the posterior. For each branch in
the <code>bammdata</code> object, gives the index of the event governing
the (tipwards) end of the branch. Branches are ordered increasing
here and elsewhere.</p>
</td></tr>
<tr><td><code>eventBranchSegs</code></td>
<td>
<p>A list of matrices. Each element of the list is
a single distinct shift configuration. Each matrix has four
columns: <code>Column 1</code> identifies a node in <code>phy</code>.
<code>Column 2</code> identifies the beginning time of the branch or
segment of the branch that subtends the node in <code>Column 1</code>.
<code>Column 3</code> identifies the ending time of the branch or
segment of the branch that subtends the node in <code>Column 1</code>.
<code>Column 4</code> identifies the index of the event that occurs
along the branch or segment of the branch that subtends the node
in <code>Column 1</code>.</p>
</td></tr>
<tr><td><code>tipStates</code></td>
<td>
<p>A list of integer vectors. Each element is a single
distinct shift configuration. For each tip the index of the event
that occurs along the branch subtending the tip. Tips are ordered
increasing here and elsewhere.</p>
</td></tr>
<tr><td><code>tipLambda</code></td>
<td>
<p>A list of numeric vectors. Each element is a single
distinct shift configuration. For each tip is the average rate of
speciation or trait evolution at the end of the terminal branch
subtending that tip (averaged over all samples that are assignable
to this particular distinct shift configuration).</p>
</td></tr>
<tr><td><code>tipMu</code></td>
<td>
<p>A list of numeric vectors. Each element is a single
distinct shift configuration. For each tip the rate of extinction
at the end of the terminal branch subtending that tip. Meaningless
if working with <code>BAMM</code> trait results.</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>A character string. Either &quot;diversification&quot; or &quot;trait&quot;
depending on your <code>BAMM</code> analysis.</p>
</td></tr>
<tr><td><code>downseq</code></td>
<td>
<p>An integer vector holding the nodes of <code>phy</code>. The
order corresponds to the order in which nodes are visited by a
pre-order tree traversal.</p>
</td></tr>
<tr><td><code>lastvisit</code></td>
<td>
<p>An integer vector giving the index of the last node
visited by the node in the corresponding position in
<code>downseq</code>. <code>downseq</code> and <code>lastvisit</code> can be used to
quickly retrieve the descendants of any node. e.g. the descendants
of node 89 can be found by
<code>downseq[which(downseq==89):which(downseq==lastvisit[89])</code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Dan Rabosky
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+distinctShiftConfigurations">distinctShiftConfigurations</a></code>,
<code><a href="#topic+plot.bammshifts">plot.bammshifts</a></code>, <code><a href="#topic+summary.credibleshiftset">summary.credibleshiftset</a></code>,
<code><a href="#topic+plot.credibleshiftset">plot.credibleshiftset</a></code>,
<code><a href="#topic+getBranchShiftPriors">getBranchShiftPriors</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(events.whales, whales)
ed &lt;- getEventData(whales, events.whales, burnin=0.1, nsamples=500)

cset &lt;- credibleShiftSet(ed, expectedNumberOfShifts = 1, threshold = 5)

# Here is the total number of samples in the posterior:
length(ed$eventData)

# And here is the number of distinct shift configurations:
cset$number.distinct

# here is the summary statistics:
summary(cset)

# Accessing the raw frequency vector for the credible set:
cset$frequency

#The cumulative frequencies:
cset$cumulative

# The first element is the shift configuration with the maximum 
#  a posteriori probability. We can identify all the samples from 
#  posterior that show this shift configuration:

cset$indices[[1]]

# Now we can plot the credible set:
plot(cset, plotmax=4)
</code></pre>

<hr>
<h2 id='cumulativeShiftProbsTree'>Branch-specific rate shift probabilities</h2><span id='topic+cumulativeShiftProbsTree'></span><span id='topic+marginalShiftProbsTree'></span>

<h3>Description</h3>

<p><code>marginalShiftProbsTree</code> computes a version of a
phylogenetic tree where each branch length is equal to the marginal
probability that a shift occurred on a particular branch. The
<code>cumulativeShiftProbsTree</code> includes the cumulative probability
that a shift occurred on a given branch. See details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cumulativeShiftProbsTree(ephy)

marginalShiftProbsTree(ephy)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cumulativeShiftProbsTree_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <em>marginal shift probability tree</em> is a copy of the
target phylogeny, but where each branch length is equal to the
branch-specific marginal probability that a rate-shift occurred on the
focal branch. For example, a branch length of 0.333 implies that 1/3
of all samples from the posterior had a rate shift on the focal branch. 
</p>
<p><b>Note:</b> It is highly inaccurate to use marginal shift
probabilities as a measure of whether diversification rate
heterogeneity occurs within a given dataset. Consider the following
example. Suppose you have a tree with topology (A, (B, C)). You find a
marginal shift probability of 0.5 on the branch leading to clade C,
and also a marginal shift probability of 0.5 on the branch leading to
clade BC. Even though the marginal shift probabilities appear low, it
may be the case that the joint probability of a shift occurring on
<em>either</em> the branch leading to C or BC is 1.0. Hence, you could
be extremely confident (posterior probabilities approaching 1.0) in
rate heterogeneity, yet find that no single branch has a particularly
high marginal shift probability. In fact, this is exactly what we
expect in most real datasets, because there is rarely enough signal to
strongly support the occurrence of a shift on any particular branch.
</p>
<p>The <em>cumulative shift probability tree</em> is a copy of the target
phylogeny but where branch lengths are equal to the cumulative
probability that a rate shift occurred somewhere on the path between
the root and the focal branch. A branch length equal to 0.0 implies
that the branch in question has evolutionary rate dynamics that are
shared with the evolutionary process starting at the root of the tree.
A branch length of 1.0 implies that, with posterior probability 1.0,
the rate dynamics on a branch are decoupled from the &quot;root process&quot;.
</p>


<h3>Value</h3>

<p>An object of class <code>phylo</code>, but with branch lengths equal to
the marginal or cumulative shift probabilities.
</p>


<h3>Author(s)</h3>

<p>Dan Rabosky
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+maximumShiftCredibility">maximumShiftCredibility</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales)
data(events.whales)
ed &lt;- getEventData(whales, events.whales, nsamples = 500)

# computing the marginal shift probs tree:
mst &lt;- marginalShiftProbsTree(ed)

# The cumulative shift probs tree:
cst &lt;- cumulativeShiftProbsTree(ed)

#compare the two types of shift trees side-by-side:
plot.new()
par(mfrow=c(1,2))
plot.phylo(mst, no.margin=TRUE, show.tip.label=FALSE)
plot.phylo(cst, no.margin=TRUE, show.tip.label=FALSE)
</code></pre>

<hr>
<h2 id='distinctShiftConfigurations'>Identify distinct rate shift configurations</h2><span id='topic+distinctShiftConfigurations'></span>

<h3>Description</h3>

<p>Identify topologically distinct rate shift configurations
that were sampled with <code>BAMM</code>, and assign each sample in the
posterior to one of the distinct shift configurations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>distinctShiftConfigurations(ephy, expectedNumberOfShifts, threshold, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="distinctShiftConfigurations_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="distinctShiftConfigurations_+3A_expectednumberofshifts">expectedNumberOfShifts</code></td>
<td>
<p>The expected number of rate shifts under the
prior.</p>
</td></tr>
<tr><td><code id="distinctShiftConfigurations_+3A_threshold">threshold</code></td>
<td>
<p>Threshold value for marginal posterior-to-prior odds
ratios, used to identify branches with elevated shift probabilities
relative to prior (core vs non-core shifts).</p>
</td></tr>
<tr><td><code id="distinctShiftConfigurations_+3A_...">...</code></td>
<td>
<p>Other arguments to distinctShiftConfigurations (possibly
deprecated args).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See Rabosky et al (2014) and the <code>BAMM</code> project website for
details on the nature of distinct shift configurations and especially
the distinction between &quot;core&quot; and &quot;non-core&quot; rate shifts. Note that
branches with elevated marginal posterior probabilities relative to
the prior (marginal odds ratios) cannot be claimed to have
&quot;significant&quot; evidence for a rate shift on the basis of this evidence
alone.
</p>


<h3>Value</h3>

<p>An object of class <code>bammshifts</code>. This is a list with the
following components:
</p>

<ul>
<li><p> marg.probs: A list of the marginal probability of a shift
occurring at each node of the phylogeny for each distinct rate
shift configuration.
</p>
</li>
<li><p> marginal_odd_ratio: Marginal posterior-to-prior odds ratios
for one or more rate shifts an a given branch.
</p>
</li>
<li><p> shifts: A list of the set of shift nodes for each distinct
rate configuration.
</p>
</li>
<li><p> samplesets: A list of sample indices that reduce to each of
the unique shift sets.
</p>
</li>
<li><p> frequency: A vector of frequencies of each distinct shift
configuration.
</p>
</li>
<li><p> coreshifts: A vector of node numbers corresponding to the
core shifts. All of these nodes have a marginal odds ratio of
at least <code>threshold</code> supporting a rate shift.
</p>
</li>
<li><p> threshold: A single numeric value giving the marginal
posterior:prior odds ratio threshold used during enumeration
of distinct shift configurations.
</p>
</li></ul>

<p>Results are sorted by frequency:
</p>
<p>$frequency[1] gives the most common shift configuration sampled.
</p>
<p>$shifts[[1]] gives the corresponding node indices for that
configuration.
</p>
<p>$samplesets[[1]] gives the indices of samples with this configuration.
</p>


<h3>Author(s)</h3>

<p>Dan Rabosky
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.bammshifts">plot.bammshifts</a></code>, <code><a href="#topic+credibleShiftSet">credibleShiftSet</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)
ed &lt;- getEventData(whales, events.whales, burnin=0.25, nsamples=500)

sc &lt;- distinctShiftConfigurations(ed, expectedNumberOfShifts = 1,
                                  threshold = 5)

plot(sc, ed, rank=1)
</code></pre>

<hr>
<h2 id='dtRates'>Calculate macroevolutionary rate changes on a phylogeny from
<code>BAMM</code> output</h2><span id='topic+dtRates'></span>

<h3>Description</h3>

<p><code>dtRates</code> calculates the mean of the marginal posterior
density of the rate of speciation/extinction or trait evolution for
small segments along each branch in a phylogeny.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dtRates(ephy, tau, ism = NULL, tmat = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dtRates_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="dtRates_+3A_tau">tau</code></td>
<td>
<p>A numeric that specifies the size (as a fraction of tree
height) of the segments that each branch will be discretized into.</p>
</td></tr>
<tr><td><code id="dtRates_+3A_ism">ism</code></td>
<td>
<p>An integer vector indexing which posterior samples to include
in the calculation.</p>
</td></tr>
<tr><td><code id="dtRates_+3A_tmat">tmat</code></td>
<td>
<p>A logical. If <code>TRUE</code> the matrix of branch segments is
returned.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>dtRates</code> bins the phylogeny into windows of time and
calculates average rates of speciation/extinction or phenotypic
evolution along each segment of a branch within a window. The width of
each window is determined by <code>tau</code>. <code>tau</code> is a fraction of
the root to tip distance so a value of <code>tau = 0.01</code> bins the
phylogeny into 100 time windows of equal width.
</p>


<h3>Value</h3>

<p>A <code>bammdata</code> object with a new component named &quot;dtrates&quot;, which
is a list with two or three components:
</p>

<ul>
<li><p> tau: The parameter value of <code>tau</code> used in the
calculation.
</p>
</li>
<li><p> rates: If <code>ephy$type = "trait"</code>: a numeric vector with
the phenotypic rates of each segment on each branch. If
<code>ephy$type = "diversification"</code>: a list with two
components. The first component is a numeric vector of
speciation rates. The second component is a numeric vector of
extinction rates.
</p>
</li>
<li><p> tmat: A matrix of the starting and ending times of the
segments on each branch. Only if <code>tmat = TRUE</code>.
</p>
</li></ul>



<h3>Note</h3>

<p>If there are zero length branches in the input tree <code>NA</code>s will
result.
</p>


<h3>Author(s)</h3>

<p>Mike Grundler
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.bammdata">plot.bammdata</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)
ed &lt;- getEventData(whales, events.whales, burnin=0.25, nsamples=500)

# use all posterior samples
ed &lt;- dtRates(ed, tau=0.01)

# use specified range of posterior samples
ed &lt;- dtRates(ed, tau=0.01, ism=50:150)
</code></pre>

<hr>
<h2 id='generateControlFile'>Generate control file for <code>BAMM</code></h2><span id='topic+generateControlFile'></span>

<h3>Description</h3>

<p>Generates a template diversification or trait control file
for <code>BAMM</code>, while allowing the user to specify parameter values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>generateControlFile(
  file = "controlfile.txt",
  type = "diversification",
  params = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="generateControlFile_+3A_file">file</code></td>
<td>
<p>Destination file name with or without path.</p>
</td></tr>
<tr><td><code id="generateControlFile_+3A_type">type</code></td>
<td>
<p>Character, either &ldquo;<code>diversification</code>&rdquo; or 
&ldquo;<code>trait</code>&rdquo;, depending on the desired <code>BAMM</code> analysis.</p>
</td></tr>
<tr><td><code id="generateControlFile_+3A_params">params</code></td>
<td>
<p>List of parameters, see <code>Details</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The user can supply parameters as a list, where the name of the
list item is the name of the parameter as it appears in the control
file, and the value of the list item is what will be placed in the
contol file.
</p>
<p>If a parameter is specified by the user, it will automatically be
uncommented if it was commented in the template.
</p>


<h3>Author(s)</h3>

<p>Pascal Title
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
#Produce a blank template control file
generateControlFile(file = 'traitcontrol.txt', type='trait')

#Produce a customized control file
data(whales)

#get bamm priors to supply to control file
priors &lt;- setBAMMpriors(whales, outfile = NULL)

generateControlFile(file = 'divcontrol.txt', params = list(
    treefile = 'whales.tre',
    globalSamplingFraction = '1',
    numberOfGenerations = '100000',
    overwrite = '1',
    lambdaInitPrior = as.numeric(priors['lambdaInitPrior']),
    lambdaShiftPrior = as.numeric(priors['lambdaShiftPrior']),
    muInitPrior = as.numeric(priors['muInitPrior']),
    expectedNumberOfShifts = '1'))

## End(Not run)
</code></pre>

<hr>
<h2 id='getBestShiftConfiguration'>Get the best (sampled) rate shift configuration from a <code>BAMM</code>
analysis</h2><span id='topic+getBestShiftConfiguration'></span>

<h3>Description</h3>

<p>Get the rate shift configuration with the maximum a
posteriori probability, e.g., the shift configuration that was sampled
most frequently with <code>BAMM</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getBestShiftConfiguration(x, expectedNumberOfShifts, threshold = 5)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getBestShiftConfiguration_+3A_x">x</code></td>
<td>
<p>Either a <code>bammdata</code> object or a <code>credibleshiftset</code>
object.</p>
</td></tr>
<tr><td><code id="getBestShiftConfiguration_+3A_expectednumberofshifts">expectedNumberOfShifts</code></td>
<td>
<p>The expected number of shifts under the
prior.</p>
</td></tr>
<tr><td><code id="getBestShiftConfiguration_+3A_threshold">threshold</code></td>
<td>
<p>The marginal posterior-to-prior odds ratio used as a
cutoff for distinguishing between &quot;core&quot; and &quot;non-core&quot; rate shifts.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function estimates the rate shift configuration with the
highest maximum a posteriori (MAP) probability. It returns a
<code>bammdata</code> object with a single sample. This can be plotted with
<code><a href="#topic+plot.bammdata">plot.bammdata</a></code>, and individual rate shifts can then
be added with <code><a href="#topic+addBAMMshifts">addBAMMshifts</a></code>. 
</p>
<p>The parameters of this object are averaged over all samples in the
posterior that were assignable to the MAP shift configuration. All
non-core shifts have been excluded, such that the only shift
information contained in the object is from the &quot;significant&quot; rate
shifts, as determined by the relevant marginal posterior-to-prior odds
ratio <code>threshold</code>.
</p>
<p>You can extract the same information from the credible set of shift
configurations. See <code><a href="#topic+credibleShiftSet">credibleShiftSet</a></code> for more
information.
</p>


<h3>Value</h3>

<p>A class <code>bammdata</code> object with a single sample, corresponding
to the diversification rate shift configuration with the maximum a
posteriori probability. See <code><a href="#topic+getEventData">getEventData</a></code> for details.
</p>


<h3>Author(s)</h3>

<p>Dan Rabosky
</p>


<h3>See Also</h3>

<p><a href="#topic+getEventData">getEventData</a>,  <a href="#topic+credibleShiftSet">credibleShiftSet</a>,
<a href="#topic+plot.credibleshiftset">plot.credibleshiftset</a>, <a href="#topic+plot.bammdata">plot.bammdata</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)
ed &lt;- getEventData(whales, events.whales, burnin=0.1, nsamples=500)

# Get prior distribution on shifts-per-branch:
bp &lt;- getBranchShiftPriors(whales, expectedNumberOfShifts = 1)

# Pass the event data object in to the function:
best &lt;- getBestShiftConfiguration(ed, expectedNumberOfShifts = 1,
                                  threshold = 5)
plot(best, lwd=2)
addBAMMshifts(best, cex=2)

# Now we can also work with the credible shift set:
css &lt;- credibleShiftSet(ed, expectedNumberOfShifts = 1, threshold = 5)

summary(css)

# examine model-averaged shifts from MAP configuration-
# This gives us parameters, times, and associated nodes
#   of each evolutionary rate regime (note that one of
#   them corresponds to the root)
css$eventData[[1]];

# Get bammdata representation of MAP configuration:
best &lt;- getBestShiftConfiguration(css, expectedNumberOfShifts = 1,
                                  threshold = 5)

plot(best)
addBAMMshifts(best)
</code></pre>

<hr>
<h2 id='getBranchShiftPriors'>Compute prior odds of a rate shift on each branch of a phylogeny
from BAMM output</h2><span id='topic+getBranchShiftPriors'></span>

<h3>Description</h3>

<p>Computes the prior probability of a rate shift event for each
branch. These results are important for identifying topological rate
shift locations on phylogenies with marginal probabilities that exceed
those predicted under the prior alone.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getBranchShiftPriors(phy, expectedNumberOfShifts)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getBranchShiftPriors_+3A_phy">phy</code></td>
<td>
<p>An object of class <code>phylo</code>.</p>
</td></tr>
<tr><td><code id="getBranchShiftPriors_+3A_expectednumberofshifts">expectedNumberOfShifts</code></td>
<td>
<p>The expected number of shifts under the
prior.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function computes the prior odds on the distribution of
numbers of rate shift events per branch under the prior. It returns an
object which is nothing more than a copy of the original phylogenetic
tree but where each branch length has been replaced by the prior
probability of a rate shift on each branch.
</p>
<p>The significance of this function is that it lets us explicitly
determine which branches have shift probabilities that are elevated
relative to the prior expectation.
</p>


<h3>Value</h3>

<p>A class <code>phylo</code> with all the components of the original class
<code>phylo</code> object, with the following changes:
</p>
<table>
<tr><td><code>edge.length</code></td>
<td>
<p>Branch lengths now represent the prior probability
of a rate shift on each branch.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Dan Rabosky
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+distinctShiftConfigurations">distinctShiftConfigurations</a></code>,
<code><a href="#topic+plot.bammshifts">plot.bammshifts</a></code>, <code><a href="#topic+summary.credibleshiftset">summary.credibleshiftset</a></code>,
<code><a href="#topic+plot.credibleshiftset">plot.credibleshiftset</a></code>, <code><a href="#topic+credibleShiftSet">credibleShiftSet</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales)
prior_tree1 &lt;- getBranchShiftPriors(whales, expectedNumberOfShifts = 1)
prior_tree10 &lt;- getBranchShiftPriors(whales, expectedNumberOfShifts = 10)
# plot prior expectations for branches based on these two counts:
plot(prior_tree1$edge.length ~ prior_tree10$edge.length, xlim=c(0,0.05),
     ylim=c(0,0.05), asp=1)
lines(x=c(0,1), y=c(0,1))
</code></pre>

<hr>
<h2 id='getCladeRates'>Compute clade-specific mean rates</h2><span id='topic+getCladeRates'></span>

<h3>Description</h3>

<p>Computes marginal clade-specific rates of speciation,
extinction, or (if relevant) trait evolution from <code>BAMM</code> output.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getCladeRates(ephy, node = NULL, nodetype = "include", verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getCladeRates_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="getCladeRates_+3A_node">node</code></td>
<td>
<p>If computing rates for a specific portion of tree, the node
subtending the relevant subtree. If multiple nodes are supplied, then
the equivalent number of <code>nodetype</code> must be supplied.</p>
</td></tr>
<tr><td><code id="getCladeRates_+3A_nodetype">nodetype</code></td>
<td>
<p>Either &quot;include&quot; or &quot;exclude&quot;. If <code>nodetype = 
"include"</code>, the rates returned by the function will be for the subtree
defined by <code>node</code>. If <code>nodetype = "exclude"</code>, will compute
mean rates for the tree after excluding the subtree defined by
<code>node</code>. If multiple nodes are specified, there must be a
<code>nodetype</code> for each node.</p>
</td></tr>
<tr><td><code id="getCladeRates_+3A_verbose">verbose</code></td>
<td>
<p>Logical. If <code>TRUE</code>, will print the sample index as
mean rates are computed for each sample from posterior. Potentially
useful for extremely large trees.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Computes the time-weighted mean evolutionary rate for a given
clade. Conversely, one can compute the rate for a given phylogeny
while excluding a clade; this operation will give the &quot;background&quot;
rate. It is important to understand several aspects of these mean
rates. First, rates in the <code>BAMM</code> framework are not constant
through time. Hence, the function computes the mean time-integrated
rates across the subtree. Operationally, this is done by integrating
the speciation rate with respect to time along each branch in the
subtree. These time-integrated rates are then summed, and the sum
is divided by the total sum of branch lengths for the subtree. 
</p>
<p>The function computes a rate for each sample in the posterior, and
returns a list of rate vectors. Each rate in the corresponding vector
is a mean rate for a particular sample from the posterior. Hence, you
can think of the return value for this function as an estimate of the
marginal distribution of rates for the focal clade. You can compute
means, medians, quantiles, etc from these vectors.
</p>


<h3>Value</h3>

<p>A list with the following components:
</p>

<ul>
<li><p> lambda: A vector of speciation rates (if applicable), with
the i'th rate corresponding to the mean rate from the i'th
sample in the posterior.
</p>
</li>
<li><p> mu: A vector of extinction rates (if applicable), with the
i'th rate corresponding to the mean rate from the i'th sample
in the posterior.
</p>
</li>
<li><p> beta: A vector of phenotypic rates (if applicable), with
the i'th rate corresponding to the mean rate from the i'th 
sample in the posterior.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Dan Rabosky
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(events.whales, whales)
ed &lt;- getEventData(whales, events.whales, nsamples=500)
all_rates &lt;- getCladeRates(ed)

mean(all_rates$lambda)
mean(all_rates$mu)
# joint density of mean speciation and extinction rates:
plot(all_rates$mu ~ all_rates$lambda)

# clade specific rates: here for Dolphin subtree:
dol_rates &lt;- getCladeRates(ed, node=140)
mean(dol_rates$lambda)
mean(dol_rates$mu)

# defining multiple nodes
mean(getCladeRates(ed, node=c(132, 140),
     nodetype=c('include','exclude'))$lambda)
</code></pre>

<hr>
<h2 id='getCohortMatrix'>Compute the pairwise correlation in rate regimes between all tips
in a <code>bammdata</code> object</h2><span id='topic+getCohortMatrix'></span>

<h3>Description</h3>

<p>Takes a <code>bammdata</code> object and computes the pairwise
correlation in evolutionary rate regimes between all tips in the
phylogeny. This can be used to identify cohorts of taxa that share
common macroevolutionary rate parameters. It can also be used to
construct a correlation matrix for GLS analyses using
<code>BAMM</code>-estimated tip rates of speciation, extinction, or
phenotypic evolution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getCohortMatrix(ephy)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getCohortMatrix_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The cohort matrix is important for interpreting and visualizing
macroevolutionary dynamics. Each entry [i, j] of the cohort matrix is
the probability that taxon i and taxon j share a common
macroevolutionary rate regime. To compute this, we simply tabulate the
percentage of samples from the posterior where taxon i and taxon j
were placed in the same rate regime. If there is no rate heterogeneity
in the dataset (e.g., the data are best explained by a single rate
regime), then all species will tend to share the same rate regime and
all values of the cohort matrix will approach 1. 
</p>
<p>A value of 0 between any two taxa means that at least one rate shift
occurred on the nodal path connecting them in 100% of samples from
the posterior. A value of 0.50 would imply that 50% of samples from
the posterior included a rate shift on the path connecting taxa i and
j. See below (Examples) for an illustration of this.
</p>


<h3>Value</h3>

<p>A numeric matrix of dimension k x k, where k is the number of
species in the phylogeny included in the <code>bammdata</code> object.
Species names are included as row names and column names. The matrix
is symmetric, such that the values for entry [i , j] will mirror those
for [j , i].
</p>


<h3>Author(s)</h3>

<p>Dan Rabosky
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)
ed &lt;- getEventData(whales, events.whales, nsamples=500)

cormat &lt;- getCohortMatrix(ed)

dim(cormat)
hist(cormat, breaks=50)
</code></pre>

<hr>
<h2 id='getEventData'>Create <code>bammdata</code> object from MCMC output</h2><span id='topic+getEventData'></span>

<h3>Description</h3>

<p><code>getEventData</code> Reads shift configuration data (the
&quot;event data&quot; output) from a <code>BAMM</code> analysis and creates a
<code>bammdata</code> object. The <code>bammdata</code> object is fundamental
for extracting information about macroevolutionary rate variation
through time and among lineages.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getEventData(
  phy,
  eventdata,
  burnin = 0,
  nsamples = NULL,
  verbose = FALSE,
  type = "diversification"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getEventData_+3A_phy">phy</code></td>
<td>
<p>An object of class <code>phylo</code> - specifically, the
time-calibrated tree that was analyzed with <code>BAMM</code>.
Alternatively, a character string specifying the path to a
newick-formatted tree.</p>
</td></tr>
<tr><td><code id="getEventData_+3A_eventdata">eventdata</code></td>
<td>
<p>A character string specifying the path to a <code>BAMM</code>
event-data file. Alternatively, an object of class <code>data.frame</code>
that includes the event data from a <code>BAMM</code> run.</p>
</td></tr>
<tr><td><code id="getEventData_+3A_burnin">burnin</code></td>
<td>
<p>A numeric indicating the fraction of posterior samples to
discard as burn-in.</p>
</td></tr>
<tr><td><code id="getEventData_+3A_nsamples">nsamples</code></td>
<td>
<p>An integer indicating the number of posterior samples to
include in the <code>bammdata</code> object. May be <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="getEventData_+3A_verbose">verbose</code></td>
<td>
<p>A logical. If <code>TRUE</code> progess is outputted to the
console. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="getEventData_+3A_type">type</code></td>
<td>
<p>A character string. Either &quot;diversification&quot; or &quot;trait&quot;
depending on your <code>BAMM</code> analysis.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In the <code>BAMM</code> framework, an &quot;event&quot; defines a
macroevolutionary process of diversification or trait evolution. Every
sample from the posterior includes at least one process, defined by
such an &quot;event&quot;. If a given sample includes just a single event, then
the dynamics of diversification or trait evolution can be described
entirely by a single time-constant or time-varying process that begins
at the root of the tree. Any sample from the posterior distribution
may include a complex mixture of distinct processes. To represent
temporal heterogeneity in macroevolutionary rates, <code>BAMM</code> models
a rate <code class="reqn">R</code>, e.g. speciation, as a function that changes
exponentially with time:
</p>
<p><code class="reqn">R(t) = R(0)*exp(b*t)</code>.
</p>
<p>Here <code class="reqn">R(0)</code> is the initial rate and <code class="reqn">b</code> is a parameter
determining how quickly that rate grows or decays with time. 
</p>
<p>The <code>eventdata</code> file (or data frame) is a record of events and
associated parameters that were sampled with <code>BAMM</code> during
simulation of the posterior with reversible jump MCMC. This complex,
information-rich file is processed into a <code>bammdata</code> object,
which serves as the core data object for numerous downstream analyses.
From a <code>bammdata</code> object, you can summarize rate variation
through time, among clades, extract locations of rate shifts,
summarize clade-specific rates of speciation and extinction, and more.
</p>
<p>In general, the user does not need to be concerned with the details of
a <code>bammdata</code> object. The object is used as input by a number of
<code>BAMMtools</code> functions. 
</p>
<p>The parameter <code>nsamples</code> can be used to reduce the total amount
of data included in the raw eventdata output from a <code>BAMM</code> run.
The final <code>bammdata</code> object will consist of all data for
<code>nsamples</code> from the posterior. These <code>nsamples</code> are equally
spaced after discarding some <code>burnin</code> fraction as &quot;burn-in&quot;. If
<code>nsamples</code> is set to <code>NULL</code>, the <code>bammdata</code> object will
include all samples in the posterior after discarding the
<code>burnin</code> fraction.
</p>


<h3>Value</h3>

<p>A list with many components:
</p>

<ul>
<li><p> edge: See documentation for class <code>phylo</code> in package ape.
</p>
</li>
<li><p> Nnode: See documentation for class <code>phylo</code> in package
ape.
</p>
</li>
<li><p> tip.label: See documentation for class <code>phylo</code> in package
ape.
</p>
</li>
<li><p> edge.length: See documentation for class <code>phylo</code> in
package ape.
</p>
</li>
<li><p> begin: The beginning time of each branch in absolute time (the
root is set to time zero)
</p>
</li>
<li><p> end: The ending time of each branch in absolute time.
</p>
</li>
<li><p> numberEvents: An integer vector with the number of events
contained in <code>phy</code> for each posterior sample. The length of
this vector is equal to the number of posterior samples in the
<code>bammdata</code> object.
</p>
</li>
<li><p> eventData: A list of dataframes. Each element is a single
posterior sample. Each row in a dataframe holds the data for a
single event. Data associated with an event are: <code>node</code> - a
node number. This identifies the branch where the event
originates. <code>time</code> - this is the absolute time on that branch
where the event originates (with the root at time 0). <code>lam1</code>
- an initial rate of speciation or trait evolution. <code>lam2</code> -
a decay/growth parameter. <code>mu1</code> - an initial rate of
extinction. <code>mu2</code> - a decay/growth parameter. <code>index</code> -
a unique integer associated with the event. See 'Details'.
</p>
</li>
<li><p> eventVectors: A list of integer vectors. Each element is a
single posterior sample. For each branch in <code>phy</code> the index
of the event that occurs along that branch. Branches are ordered
increasing here and elsewhere.
</p>
</li>
<li><p> eventBranchSegs: A list of matrices. Each element is a single
posterior sample. Each matrix has four columns: <code>Column 1</code>
identifies a node in <code>phy</code>. <code>Column 2</code> identifies the
beginning time of the branch or segment of the branch that
subtends the node in <code>Column 1</code>. <code>Column 3</code> identifies
the ending time of the branch or segment of the branch that
subtends the node in <code>Column 1</code>. <code>Column 4</code> identifies
the index of the event that occurs along the branch or segment of
the branch that subtends the node in <code>Column 1</code>.
</p>
</li>
<li><p> tipStates: A list of integer vectors. Each element is a single
posterior sample. For each tip the index of the event that occurs
along the branch subtending the tip. Tips are ordered increasing
here and elsewhere.
</p>
</li>
<li><p> tipLambda: A list of numeric vectors. Each element is a single
posterior sample. For each tip the rate of speciation or trait
evolution at the end of the terminal branch subtending that tip.
</p>
</li>
<li><p> tipMu: A list of numeric vectors. Each element is a single
posterior sample. For each tip the rate of extinction at the end
of the terminal branch subtending that tip. Meaningless if working
with <code>BAMM</code> trait results.
</p>
</li>
<li><p> meanTipLambda: For each tip the mean of the marginal posterior
density of the rate of speciation or trait evolution at the end of
the terminal branch subtending that tip.
</p>
</li>
<li><p> meanTipMu: For each tip the mean of the marginal posterior
density of the rate of extinction at the end of the terminal
branch subtending that tip. Meaningless if working with
<code>BAMM</code> trait results.
</p>
</li>
<li><p> type: A character string. Either &quot;diversification&quot; or &quot;trait&quot;
depending on your <code>BAMM</code> analysis.
</p>
</li>
<li><p> downseq: An integer vector holding the nodes of <code>phy</code>. The
order corresponds to the order in which nodes are visited by a
pre-order tree traversal.
</p>
</li>
<li><p> lastvisit: An integer vector giving the index of the last node
visited by the node in the corresponding position in
<code>downseq</code>. <code>downseq</code> and <code>lastvisit</code> can be used to
quickly retrieve the descendants of any node. e.g. the descendants
of node 89 can be found by
<code>downseq[which(downseq==89):which(downseq==lastvisit[89])</code>.
</p>
</li></ul>



<h3>Note</h3>

<p>Currently the function does not check for duplicate tip labels in
<code>phy</code>, which may cause the function to choke.
</p>


<h3>Author(s)</h3>

<p>Dan Rabosky, Mike Grundler
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+summary.bammdata">summary.bammdata</a></code>, <code><a href="#topic+plot.bammdata">plot.bammdata</a></code>,
<code><a href="#topic+dtRates">dtRates</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(primates, events.primates)
xx &lt;- getEventData(primates, events.primates, burnin=0.25, nsamples=500,
                   type = 'trait')

# compute mean phenotypic rate for primate body size evolution:
brates &lt;- getCladeRates(xx)
mean(brates$beta)

# Plot rates:
plot(xx)
</code></pre>

<hr>
<h2 id='getJenksBreaks'>Jenks natural breaks classification</h2><span id='topic+getJenksBreaks'></span>

<h3>Description</h3>

<p>Given a vector of numeric values and the number of desired
breaks, calculate the optimum breakpoints using Jenks natural
breaks optimization.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getJenksBreaks(var, k, subset = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getJenksBreaks_+3A_var">var</code></td>
<td>
<p>Numeric vector.</p>
</td></tr>
<tr><td><code id="getJenksBreaks_+3A_k">k</code></td>
<td>
<p>Number of breaks.</p>
</td></tr>
<tr><td><code id="getJenksBreaks_+3A_subset">subset</code></td>
<td>
<p>Number of regularly spaced samples to subset from
<code>var</code>. Intended to improve runtime for large datasets. If
<code>NULL</code>, all values are used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>getJenksBreaks</code> is called by
<code><a href="#topic+assignColorBreaks">assignColorBreaks</a></code>.
</p>
<p>The values in <code>var</code> are binned into <code>k+1</code> categories,
according to the Jenks natural breaks classification method. This
method is borrowed from the field of cartography, and seeks to
minimize the variance within categories, while maximizing the variance
between categories. If <code>subset = NULL</code>, all values of <code>var</code>
are used for the optimization, however this can be a slow process with
very large datasets. If <code>subset</code> is set to some number, then 
<code>subset</code> regularly spaced values of <code>var</code> will be sampled.
This is slightly less accurate than when using the entirety of
<code>var</code> but is unlikely to make much of a difference. If 
<code>subset</code> is defined but <code>length(var) &lt; subset</code>, then
<code>subset</code> has no effect.  
</p>
<p>The Jenks natural breaks method was ported to C from code found in the
classInt R package.
</p>


<h3>Value</h3>

<p>A numeric vector of intervals.
</p>


<h3>Author(s)</h3>

<p>Pascal Title
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+assignColorBreaks">assignColorBreaks</a></code> and
<code><a href="#topic+plot.bammdata">plot.bammdata</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># load whales dataset
data(whales, events.whales)
ed &lt;- getEventData(whales, events.whales, burnin=0.25, nsamples=500)

# for demonstration purposes, extract the vector of speciation rates
ed &lt;- dtRates(ed, tau=0.01)
vec &lt;- ed$dtrates$rates[[1]]

# Return breaks for the binning of speciation rates into 65 groups
# yielding 64 breaks
getJenksBreaks(vec, 64)
</code></pre>

<hr>
<h2 id='getMarginalBranchRateMatrix'>Compute mean branch rates for <code>bammdata</code> object</h2><span id='topic+getMarginalBranchRateMatrix'></span>

<h3>Description</h3>

<p>For each sample in the posterior, computes the mean rate for
each branch in the focal phylogeny (speciation, extinction, trait
evolution). If the <code>bammdata</code> object contains <em>nsamples</em>
samples and the target phylogeny has <em>nbranches</em> branches, the
function will compute a matrix of <em>nbranches</em> x <em>nsamples</em>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getMarginalBranchRateMatrix(ephy, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getMarginalBranchRateMatrix_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="getMarginalBranchRateMatrix_+3A_verbose">verbose</code></td>
<td>
<p>Print progress during processing of <code>bammdata</code> object.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If a <code>type = 'diversification'</code> <code>bammdata</code> object is
passed as an argument, the function will return matrices for both
speciation and extinction. If <code>type = 'trait'</code> object, the matrix
will simply be the corresponding phenotypic rates. Branch-specific
rates are the mean rates computed by integrating the relevant
rate-through-time function along each branch, then dividing by the
length of the branch.
</p>


<h3>Value</h3>

<p>Returns a list with the following components:
</p>

<ul>
<li><p> lambda_branch_matrix: A <code>nbranches x nsamples</code> matrix
of mean speciation rates for each branch.
</p>
</li>
<li><p> mu_branch_matrix: A <code>nbranches x nsamples</code> matrix of
mean extinction rates for each branch.
</p>
</li>
<li><p> beta_branch_matrix: A <code>nbranches x nsamples</code> matrix of
mean phenotypic rates for each branch.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Dan Rabosky
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales)
data(events.whales)
ed &lt;- getEventData(whales, events.whales, nsamples = 10)
mbr &lt;- getMarginalBranchRateMatrix(ed)
dim(mbr$lambda_branch_matrix)
</code></pre>

<hr>
<h2 id='getMeanBranchLengthTree'>Compute phylogeny with branch lengths equal to corresponding
macroevolutionary rate estimates</h2><span id='topic+getMeanBranchLengthTree'></span>

<h3>Description</h3>

<p>Takes a <code>bammdata</code> object and computes a phylogenetic
tree where branch lengths are equal to the mean of the marginal
distributions of rates on each branch. This tree can be plotted to
visualize rate variation across a phylogeny.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getMeanBranchLengthTree(ephy, rate = "speciation")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getMeanBranchLengthTree_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="getMeanBranchLengthTree_+3A_rate">rate</code></td>
<td>
<p>The type of rate-tree to be computed. Options: &quot;speciation&quot;
(default), &quot;extinction&quot;, &quot;ndr&quot; (net diversification), and &quot;trait&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the following components:
</p>

<ul>
<li><p> phy: A phylogenetic tree, topologically identical to the
model tree, but with branch lengths replaced by the mean
(marginal) rates on each branch as estimated from the
posterior samples in the <code>bammdata</code> object.
</p>
</li>
<li><p> mean: The mean rate over all branches.
</p>
</li>
<li><p> median: the median rate over all branches.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Dan Rabosky
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.bammdata">plot.bammdata</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales)
data(events.whales)
ed &lt;- getEventData(whales, events.whales, burnin=0.1, nsamples=500)
ed2 &lt;- subsetEventData(ed, index = 1:20)
ratetree &lt;- getMeanBranchLengthTree(ed2, rate='speciation')
plot(ratetree$phy, show.tip.label=FALSE)
</code></pre>

<hr>
<h2 id='getmrca'>Find most recent common ancestors</h2><span id='topic+getmrca'></span>

<h3>Description</h3>

<p>Calculates the most recent common ancestor for each pair of
tips. Used internally by <code><a href="#topic+getEventData">getEventData</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getmrca(phy, t1, t2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getmrca_+3A_phy">phy</code></td>
<td>
<p>An object of class <code>phylo</code>.</p>
</td></tr>
<tr><td><code id="getmrca_+3A_t1">t1</code></td>
<td>
<p>A vector of mode integer or character corresponding to tips in
<code>phy</code>.</p>
</td></tr>
<tr><td><code id="getmrca_+3A_t2">t2</code></td>
<td>
<p>A vector of mode integer or character corresponding to tips in
<code>phy</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Finds the most recent common ancestor for each pair of tips where
pairs are defined as (<code>t1</code>[1], <code>t2</code>[1]), (<code>t1</code>[2],
<code>t2</code>[2]), ... , (<code>t1</code>[i], <code>t2</code>[i]), ... ,(<code>t1</code>[n],
<code>t2</code>[n]).
</p>


<h3>Value</h3>

<p>A vector of node numbers of the common ancestor for each pair of
tips.
</p>


<h3>Author(s)</h3>

<p>Mike Grundler
</p>


<h3>See Also</h3>

<p><code><a href="#topic+subtreeBAMM">subtreeBAMM</a></code>
</p>

<hr>
<h2 id='getRateThroughTimeMatrix'>Generate rate-through-time matrix from <code>bammdata</code> object</h2><span id='topic+getRateThroughTimeMatrix'></span>

<h3>Description</h3>

<p>Computes a matrix of macroevolutionary rates at specified
timepoints from a <code>bammdata</code> object. These rates can be used for
plotting speciation rates (and other rates) through time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getRateThroughTimeMatrix(
  ephy,
  start.time = NULL,
  end.time = NULL,
  nslices = 100,
  node = NULL,
  nodetype = "include"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getRateThroughTimeMatrix_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="getRateThroughTimeMatrix_+3A_start.time">start.time</code></td>
<td>
<p>The start time (in units before present) for the time.
sequence over which rates should be computed. If <code>NULL</code>, starts
at the root.</p>
</td></tr>
<tr><td><code id="getRateThroughTimeMatrix_+3A_end.time">end.time</code></td>
<td>
<p>The end time (in units before present) for the time
sequence over which rates should be computed. If <code>NULL</code>, ends in
the present.</p>
</td></tr>
<tr><td><code id="getRateThroughTimeMatrix_+3A_nslices">nslices</code></td>
<td>
<p>The number of time points at which to compute rate
estimates (between <code>start.time</code> and <code>end.time</code>).</p>
</td></tr>
<tr><td><code id="getRateThroughTimeMatrix_+3A_node">node</code></td>
<td>
<p>Allows user to extract rate-through-time information for the
subtree descended from a specific node. Alternatively, a specified
subtree can be excluded from the rate matrix calculations.</p>
</td></tr>
<tr><td><code id="getRateThroughTimeMatrix_+3A_nodetype">nodetype</code></td>
<td>
<p>Two options: &quot;include&quot; and &quot;exclude&quot;. If &quot;include&quot;,
computes rate matrix only for the descendants of subtree defined by
<code>node</code>. If &quot;exclude&quot;, computes rate matrix for all background
lineages in tree after excluding the subtree defined by <code>node</code>.
Ignored if <code>node = NULL</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Computes evolutionary rates for each sample in the posterior
included as part of the <code>bammdata</code> object. Rates are computed by
draping an imaginary grid over the phylogeny, where the grid begins at
<code>start.time</code> and ends at <code>end.time</code>, with <code>nslices</code>
vertical lines through the phylogeny. The mean rate at each point in
time (for a given sample from the posterior) is simply the mean rate
at that time for all branches that are intersected by the grid (see
the grid plot in the examples section).
</p>
<p>This function is used by <a href="#topic+plotRateThroughTime">plotRateThroughTime</a>, but the user can
work directly with the <code>bamm-ratematrix</code> object for greater
control in plotting rate-through-time trajectories for individual
clades. See <code>examples</code> for an example of how this can be used to
plot confidence intervals on a rate trajectory using shaded polygons.
</p>
<p>The <code>node</code> options are particularly useful. If you have run
<code>BAMM</code> on a large phylogeny, you can easily generate the
rate-through-time data for a particular subtree by specifying the node
number along with <code>nodetype = "include"</code>. Likewise, if you want
to look at just the background rate - excluding some particular
lineage - just specify <code>nodetype = "exclude"</code>.
</p>


<h3>Value</h3>

<p>An object of class <code>bamm-ratematrix</code> with the following
components:
</p>
<table>
<tr><td><code>lambda</code></td>
<td>
<p>A <code>nsamples</code> x <code>nslices</code> matrix of speciation
rates, where <code>nsamples</code> is the number of posterior samples in
the <code>bammdata</code> object.</p>
</td></tr>
<tr><td><code>mu</code></td>
<td>
<p>A <code>nsamples</code> x <code>nslices</code> matrix of extinction
rates.</p>
</td></tr>
<tr><td><code>beta</code></td>
<td>
<p>A <code>nsamples</code> x <code>nslices</code> matrix of phenotypic
rates (if applicable).</p>
</td></tr>
<tr><td><code>times</code></td>
<td>
<p>A vector of timepoints where rates were computed.</p>
</td></tr>
<tr><td><code>times</code></td>
<td>
<p>A vector of timepoints where rates were computed (see
Examples).</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>Either &quot;diversification&quot; or &quot;trait&quot;, depending on the
input data.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Dan Rabosky
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plotRateThroughTime">plotRateThroughTime</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Plot a rate-through-time curve with 
# confidence intervals for the whale dataset:

data(whales, events.whales)
ed &lt;- getEventData(whales, events.whales)

rmat &lt;- getRateThroughTimeMatrix(ed)

plot.new()
plot.window(xlim=c(0, 36), ylim=c(0, .7))

## Speciation quantiles: plot 90% CIs
qq &lt;- apply(rmat$lambda, 2, quantile, c(0.05, 0.5, 0.95))

xv &lt;- c(rmat$times, rev(rmat$times))
yv &lt;- c(qq[1,], rev(qq[3,]))

## Add the confidence polygon on rate distributions:
polygon(xv, yv, col='gray80', border=FALSE)

## Add the median rate line:
lines(rmat$times, qq[2,], lwd=3, col='red')

## Add axes
axis(1, at=seq(-5, 35, by=5))
axis(2, at=seq(-0.2, 1, by=0.2), las=1)

####### Now we will show the actual grid used for rate calculations:

plot(whales, show.tip.label=FALSE)
axisPhylo()

mbt &lt;- max(branching.times(whales))
tvec &lt;- mbt - rmat$times;
tvec &lt;- rmat$times;

for (i in 1:length(tvec)){
    lines(x=c(tvec[i], tvec[i]), y=c(0, 90), lwd=0.7, col='gray70')
}

## This shows the grid of time slices over the phylogeny
## End(Not run)
</code></pre>

<hr>
<h2 id='getShiftNodesFromIndex'>Identify nodes associated with rate shifts from <code>bammdata</code>
object</h2><span id='topic+getShiftNodesFromIndex'></span>

<h3>Description</h3>

<p>Find the node numbers associated with rate shifts for a
specified sample from the posterior distribution contained in a
<code>bammdata</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getShiftNodesFromIndex(ephy, index)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getShiftNodesFromIndex_+3A_ephy">ephy</code></td>
<td>
<p>A <code>bammdata</code> object.</p>
</td></tr>
<tr><td><code id="getShiftNodesFromIndex_+3A_index">index</code></td>
<td>
<p>The index value of the posterior sample from which you want
to identify shift nodes. This is <em>not</em> the same as the actual
generation number of the MCMC sample. If your <code>bammdata</code> object
contains 100 samples from the posterior distribution, the value of
<code>index</code> must range from 1 to 100.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of nodes (excluding the root) that define branches on
which shifts occurred for the specified sample from the posterior.
Will return a numeric of length 0 if no non-root shifts occur in the
specified sample.
</p>


<h3>Author(s)</h3>

<p>Dan Rabosky
</p>


<h3>See Also</h3>

<p><code><a href="#topic+addBAMMshifts">addBAMMshifts</a></code>, <code><a href="#topic+plot.bammdata">plot.bammdata</a></code>,
<code><a href="#topic+maximumShiftCredibility">maximumShiftCredibility</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)
ed &lt;- getEventData(whales, events.whales, burnin=0.1, nsamples=500)

# Get the maximum shift credibility configuration:
msc &lt;- maximumShiftCredibility(ed)

# Get the nodes at which shifts occurred in the 
# maximum shift credibility configuration:

getShiftNodesFromIndex(ed, index=msc$sampleindex)
</code></pre>

<hr>
<h2 id='getTipRates'>Compute tip-specific macroevolutionary rates from <code>bammdata</code>
object</h2><span id='topic+getTipRates'></span>

<h3>Description</h3>

<p>Return speciation, extinction, net diversification, or
Brownian motion trait rates for all species in the phylogeny from
<code>BAMM</code> output.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getTipRates(ephy, returnNetDiv = FALSE, statistic = "mean")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getTipRates_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="getTipRates_+3A_returnnetdiv">returnNetDiv</code></td>
<td>
<p>Logical. If <code>TRUE</code>, then net diversification
rates are returned, if <code>FALSE</code>, then both speciation and
extinction rates are returned. If <code>ephy</code> is of type <code>trait</code>,
then this is ignored.</p>
</td></tr>
<tr><td><code id="getTipRates_+3A_statistic">statistic</code></td>
<td>
<p>Determines how the average tip rates should be
calculated. Can be either <code>mean</code> or <code>median</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a list with the following elements:
</p>
<p>If <code>ephy</code> type is 'diversification':
</p>

<ul>
<li><p> lambda: A matrix of tip speciation rates with species as
rows, and posterior samples as columns.
</p>
</li>
<li><p> mu: A matrix of tip extinction rates with species as rows,
and posterior samples as columns.
</p>
</li>
<li><p> lambda.avg: A vector of average tip speciation rates,
averaged with mean or median, depending on selected option for
<code>statistic</code>. The vector is named with species names.
</p>
</li>
<li><p> mu.avg: A vector of average tip extinction rates, averaged
with mean or median, depending on selected option for
<code>statistic</code>. The vector is named with species names.
</p>
</li></ul>

<p>If <code>ephy</code> type is 'diversification' and
<code>returnNetDiv = TRUE</code>:
</p>

<ul>
<li><p> netdiv: A matrix of tip net diversification rates with
species as rows, and posterior samples as columns.
</p>
</li>
<li><p> netdiv.avg: A vector of average tip net diversification
rates, averaged with mean or median, depending on selected
option for <code>statistic</code>. The vector is named with species
names.
</p>
</li></ul>

<p>If <code>ephy</code> type is 'trait':
</p>

<ul>
<li><p> beta: A matrix of tip phenotypic rates with species as
rows, and posterior samples as columns.
</p>
</li>
<li><p> beta.avg: A vector of average tip phenotypic rates,
averaged with mean or median, depending on selected option for
<code>statistic</code>. The vector is named with species names.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pascal Title
</p>


<h3>See Also</h3>

<p>Requires an object of class <code>bammdata</code> as obtained with
<code><a href="#topic+getEventData">getEventData</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)
ephy &lt;- getEventData(whales, events.whales, burnin=0.25, nsamples = 500)

# return a vector of average species-specific speciation rates.
meanlam &lt;- getTipRates(ephy, returnNetDiv = FALSE,
                       statistic = 'mean')$lambda.avg
meanlam

# return a vector of median species-specific net diversification rates.
ndr &lt;- getTipRates(ephy, returnNetDiv = TRUE,
                   statistic = 'median')$netdiv.avg

# Return mean species-specific speciation rates from all posterior 
# samples in the \code{bamm-data} object.
lam &lt;- getTipRates(ephy, returnNetDiv = FALSE, statistic = 'mean')$lambda
rowMeans(lam)
</code></pre>

<hr>
<h2 id='marginalOddsRatioBranches'>Ratio of (marginal) posterior-to-prior probabilities on individual
branches</h2><span id='topic+marginalOddsRatioBranches'></span>

<h3>Description</h3>

<p>Compute marginal posterior-to-prior odds ratio associated
with observing one or more rate shift on a given branch.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>marginalOddsRatioBranches(ephy, expectedNumberOfShifts)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="marginalOddsRatioBranches_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="marginalOddsRatioBranches_+3A_expectednumberofshifts">expectedNumberOfShifts</code></td>
<td>
<p>Expected number of shifts under the prior
alone.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function returns a copy of a phylogenetic tree where each
branch length is equal to the marginal odds ratio in favor of a rate
shift on a particular branch. These cannot be interpreted as evidence
for a rate shift in an absolute sense. As explained on the website,
they are a marginal odds ratio. This function is provided primarily
for the purpose of distinguishing core and non-core shifts.
</p>


<h3>Value</h3>

<p>A object of class <code>phylo</code> but where each branch length is
equal to the marginal shift odds on each branch.
</p>


<h3>Author(s)</h3>

<p>Dan Rabosky
</p>


<h3>See Also</h3>

<p><code><a href="#topic+getBranchShiftPriors">getBranchShiftPriors</a></code>,
<code><a href="#topic+distinctShiftConfigurations">distinctShiftConfigurations</a></code>,
<code><a href="#topic+credibleShiftSet">credibleShiftSet</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)
ed &lt;- getEventData(whales, events.whales, burnin=0.1, nsamples=500)
marginalOddsRatioBranches(ed, expectedNumberOfShifts = 1)

</code></pre>

<hr>
<h2 id='maximumShiftCredibility'>Estimate maximum shift credibility configuration</h2><span id='topic+maximumShiftCredibility'></span>

<h3>Description</h3>

<p>This is one estimate of the &quot;best&quot; rate shift configuration,
considering only those shift configurations that were actually sampled
using <code>BAMM</code>'s reversible jump MCMC simulator. This is analogous
to the &quot;maximum clade credibility tree&quot; from a Bayesian phylogenetic
analysis. It is not necessarily the same as the shift configuration
with the maximum a posteriori probability.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>maximumShiftCredibility(ephy, maximize = "product")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="maximumShiftCredibility_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>BAMMdata</code>.</p>
</td></tr>
<tr><td><code id="maximumShiftCredibility_+3A_maximize">maximize</code></td>
<td>
<p>Maximize the marginal probability of the product or sum of
branch-specific shifts.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is one point estimate of the overall &quot;best&quot; rate shift
configuration. Following an MCMC simulation, the marginal shift
probabilities on each individual branch are computed using
<code><a href="#topic+marginalShiftProbsTree">marginalShiftProbsTree</a></code>. The shift configuration that
maximizes the product (or sum, if specified) of these marginal
branch-specific shift probabilities is the <em>maximum shift
credibility configuration</em>.  
</p>
<p>This option is only recommended if you have no clear &quot;winner&quot; in your
credible set of shift configurations (see
<code><a href="#topic+credibleShiftSet">credibleShiftSet</a></code>). If you have a number of
largely-equiprobable shift configurations in your 95% credible set,
you may wish to try this function as an alternative for identifying a
single best shift configuration. Otherwise, it is recommended that you
present the shift configuration with the maximum a posteriori
probability (see <code><a href="#topic+getBestShiftConfiguration">getBestShiftConfiguration</a></code>).
</p>


<h3>Value</h3>

<p>A list with the following components:
</p>

<ul>
<li><p> bestconfigs: A vector of the index values of MCMC samples
with shift configurations equal to the maximum. Usually, more
than one state sampled during the MCMC simulation will have an
identical (maximized) marginal probability. All samples given
in this vector will have an identical shift configuration.
</p>
</li>
<li><p> scores: The optimality score (product or sum of marginal
shift probabilities) for all sampled shift configurations in
the <code>BAMMdata</code> object.
</p>
</li>
<li><p> optimalityType: Whether the product or sum of marginal
shift probabilities was used to compute the maximum shift
credibility configuration.
</p>
</li>
<li><p> sampleindex: A representative sample that is equal to the
maximum shift credibility configuration (e.g., this can be
plotted with <code><a href="#topic+addBAMMshifts">addBAMMshifts</a></code>).
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Dan Rabosky
</p>


<h3>See Also</h3>

<p><code><a href="#topic+marginalShiftProbsTree">marginalShiftProbsTree</a></code>,
<code><a href="#topic+addBAMMshifts">addBAMMshifts</a></code>, <code><a href="#topic+cumulativeShiftProbsTree">cumulativeShiftProbsTree</a></code>,
<code><a href="#topic+credibleShiftSet">credibleShiftSet</a></code>,
<code><a href="#topic+getBestShiftConfiguration">getBestShiftConfiguration</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)
ed &lt;- getEventData(whales, events.whales, burnin=0.25, nsamples=500)
best_config &lt;- maximumShiftCredibility(ed)
plot(ed)
addBAMMshifts(ed, method='phylogram', index=best_config$sampleindex)
</code></pre>

<hr>
<h2 id='plot.bammdata'>Plot <code>BAMM</code>-estimated macroevolutionary rates on a phylogeny</h2><span id='topic+plot.bammdata'></span>

<h3>Description</h3>

<p><code>plot.bammdata</code> plots a phylogenetic tree from a
<code>bammdata</code> object and colors each branch by the estimated rate of
speciation, extinction, or trait evolution. Rates are not assumed to
be constant in time, and the function can plot continuously-varying
rates along individual branches.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bammdata'
plot(
  x,
  tau = 0.01,
  method = "phylogram",
  xlim = NULL,
  ylim = NULL,
  vtheta = 5,
  rbf = 0.001,
  show = TRUE,
  labels = FALSE,
  legend = FALSE,
  spex = "s",
  lwd = 1,
  cex = 1,
  pal = "RdYlBu",
  mask = integer(0),
  mask.color = gray(0.5),
  colorbreaks = NULL,
  logcolor = FALSE,
  breaksmethod = "linear",
  color.interval = NULL,
  JenksSubset = 20000,
  par.reset = FALSE,
  direction = "rightwards",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.bammdata_+3A_x">x</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_tau">tau</code></td>
<td>
<p>A numeric indicating the grain size for the calculations. See
documentation for <code><a href="#topic+dtRates">dtRates</a></code>.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_method">method</code></td>
<td>
<p>A character string indicating the method for plotting the
phylogenetic tree. <code>method = "phylogram"</code> (default) plots the
phylogenetic tree using rectangular coordinates.
<code>method = "polar"</code> plots the phylogenetic tree using polar
coordinates.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_xlim">xlim</code></td>
<td>
<p>A numeric vector of coordinates for the x-axis endpoints.
Defaults to <code>NULL</code>, in which case they are calculated
automatically. The x-axis corresponds to time when the phylogeny is
plotted facing to the left or to the right. The time at the root
equals zero.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_ylim">ylim</code></td>
<td>
<p>A numeric vector of coordinates for the y-axis endpoints.
Defaults to <code>NULL</code>, in which case they are calculated
automatically. Tips are plotted at integer values beginning from zero
and stepping by one when the phylogeny is plotted facing to the left
or to the right.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_vtheta">vtheta</code></td>
<td>
<p>A numeric indicating the angular separation (in degrees) of
the first and last terminal nodes. Ignored if
<code>method = "phylogram"</code>.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_rbf">rbf</code></td>
<td>
<p>A numeric indicating the length of the root branch as a
fraction of total tree height. Ignored if <code>method = "phylogram"</code>.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_show">show</code></td>
<td>
<p>A logical indicating whether or not to plot the tree. Defaults
to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_labels">labels</code></td>
<td>
<p>A logical indicating whether or not to plot the tip labels.
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_legend">legend</code></td>
<td>
<p>A logical indicating whether or not to plot a legend for
interpreting the mapping of evolutionary rates to colors. Defaults to
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_spex">spex</code></td>
<td>
<p>A character string indicating what type of macroevolutionary
rates should be plotted. &quot;s&quot; (default) indicates speciation rates, &quot;e&quot;
indicates extinction rates, and &quot;netdiv&quot; indicates net diversification
rates. Ignored if <code>ephy$type = "trait"</code>.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_lwd">lwd</code></td>
<td>
<p>A numeric specifying the line width for branches.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_cex">cex</code></td>
<td>
<p>A numeric specifying the size of tip labels.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_pal">pal</code></td>
<td>
<p>A character string or vector of mode character that describes
the color palette. See Details for explanation of options.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_mask">mask</code></td>
<td>
<p>An optional integer vector of node numbers specifying branches
that will be masked with <code>mask.color</code> when plotted.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_mask.color">mask.color</code></td>
<td>
<p>The color for the mask.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_colorbreaks">colorbreaks</code></td>
<td>
<p>A numeric vector of percentiles delimiting the bins for
mapping rates to colors. If <code>NULL</code> (default) bins are calculated
from the rates that are passed with the <code>bammdata</code> object.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_logcolor">logcolor</code></td>
<td>
<p>Logical. Should colors be plotted on a log scale.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_breaksmethod">breaksmethod</code></td>
<td>
<p>Method used for determining color breaks. See help
file for <code><a href="#topic+assignColorBreaks">assignColorBreaks</a></code>.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_color.interval">color.interval</code></td>
<td>
<p>Min and max value for the mapping of rates. If
<code>NULL</code>, then min and max are inferred from the data. NA can also
be supplied for one of the two values. See details.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_jenkssubset">JenksSubset</code></td>
<td>
<p>If <code>breaksmethod = "jenks"</code>, the number of
regularly spaced samples to subset from the full rates vector. Only
relevant for large datasets. See help file for
<code><a href="#topic+assignColorBreaks">assignColorBreaks</a></code>.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_par.reset">par.reset</code></td>
<td>
<p>A logical indicating whether or not to reset the
graphical parameters when the function exits. Defaults to
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_direction">direction</code></td>
<td>
<p>A character string. Options are &quot;rightwards&quot;,
&quot;leftwards&quot;, &quot;upwards&quot;, and &quot;downwards&quot;, which determine the
orientation of the tips when the phylogeny plotted.</p>
</td></tr>
<tr><td><code id="plot.bammdata_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code>par</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To calculate rates, each branch of the phylogeny is discretized
into a number of small segments, and the mean of the marginal
posterior density of the rate of speciation/extinction or trait
evolution is calculated for each such segment. Rates are mapped to
colors such that cool colors represent slow rates and warm colors
represent fast rates. When the tree is plotted each of these small
segments is plotted so that changes in rates through time and shifts
in rates are visible as gradients of color. The <code>spex</code> argument
determines the type of rate that will be calculated. <code>spex = "s"</code>
will plot speciation rates, <code>spex = "e"</code> will plot extinction
rates, and <code>spex = "netdiv"</code> will plot diversification rates
(speciation - extinction). Note that if <code>x$type = "trait"</code> the
<code>spex</code> argument is ignored and rates of phenotypic evolution are
plotted instead. If <code>legend = TRUE</code> the function will plot a
legend that contains the mapping of colors to numerical values.  
</p>
<p>A number of color palettes come built in with <code>BAMMtools</code>.
Color-blind friendly options include:
</p>

<ul>
<li><p> BrBG
</p>
</li>
<li><p> PiYG
</p>
</li>
<li><p> PRGn
</p>
</li>
<li><p> PuOr
</p>
</li>
<li><p> RdBu
</p>
</li>
<li><p> RdYlBu
</p>
</li>
<li><p> BuOr
</p>
</li>
<li><p> BuOrRd
</p>
</li>
<li><p> DkRdBu
</p>
</li>
<li><p> BuDkOr
</p>
</li>
<li><p> GnPu
</p>
</li></ul>

<p>Some color-blind unfriendly options include:
</p>

<ul>
<li><p> RdYlGn
</p>
</li>
<li><p> Spectral
</p>
</li>
<li><p> temperature
</p>
</li>
<li><p> terrain
</p>
</li></ul>

<p>Some grayscale options include:
</p>

<ul>
<li><p> grayscale
</p>
</li>
<li><p> revgray
</p>
</li></ul>

<p>For more information about these color palettes visit
<a href="https://colorbrewer2.org/">https://colorbrewer2.org/</a> and
<a href="https://pjbartlein.github.io/datagraphics/color_scales.html">https://pjbartlein.github.io/datagraphics/color_scales.html</a> or
use the help files of the R packages <code>RColorBrewer</code> and
<code>dichromat</code>.
</p>
<p>Additionally, any vector of valid named colors may also be used. The
only restriction is that the length of this vector be greater than or
equal to three (you can provide a single color, but in this case the
entire tree will be assigned the same color). The colors should be
ordered from cool to warm as the colors will be mapped from low rates
to high rates in the order supplied (e.g. <code>pal=c("darkgreen",
    "yellow2", "red")</code>). The option <code>pal = "temperature"</code> uses the
<code>rich.colors</code> function written by Arni Magnusson for the R
package <code>gplots</code>.
</p>
<p>Internally <code>plot.bammdata</code> checks whether or not rates have been
calculated by looking for a component named &quot;dtrates&quot; in the
<code>bammdata</code> object. If rates have not been calculated
<code>plot.bammdata</code> calls <code>dtRates</code> with <code>tau</code>. Specifying
smaller values for <code>tau</code> will result in smoother-looking rate
changes on the tree. Note that smaller values of <code>tau</code> require
more computation. If the <code>colorbreaks</code> argument
is <code>NULL</code> a map of rates to colors is also made by calling
<code>assignColorBreaks</code> with <code>NCOLORS = 64</code>. A user supplied
<code>colorbreaks</code> argument can be passed as well. This allows one to
plot parts of a tree while preserving the map of rates to colors that
was made using rates for the entire tree.
</p>
<p>If color.interval is defined, then those min and max values override
the automatic detection of min and max. This might be useful if some
small number of lineages have very high or very low rates, such that
the map of colors is being skewed towards these extremes, resulting in
other rate variation being drowned out. If specified, the color ramp
will be built between these two color.interval values, and the rates
outside of the color interval range will be set to the highest and
lowest color. The total number of colors will also be increased such
that 64 color bins are found within the color.interval.
</p>
<p>If <code>plot.bammdata</code> is called repeatedly with the same
<code>bammdata</code> object, computation can be reduced by first calling
<code>dtRates</code> in the global environment.
</p>


<h3>Value</h3>

<p>Returns (invisibly) a list with three components. 
</p>

<ul>
<li><p> coords: A matrix of plot coordinates. Rows correspond to
branches. Columns 1-2 are starting (x,y) coordinates of each
branch and columns 3-4 are ending (x,y) coordinates of each
branch. If <code>method = "polar"</code> a fifth column gives the
angle(in radians) of each branch.
</p>
</li>
<li><p> colorbreaks: A vector of percentiles used to group
macroevolutionary rates into color bins.
</p>
</li>
<li><p> colordens: A matrix of the kernel density estimates (column
2) of evolutionary rates (column 1) and the color (column 3)
corresponding to each rate value.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Mike Grundler, Pascal Title
</p>


<h3>Source</h3>

<p><a href="https://colorbrewer2.org/">https://colorbrewer2.org/</a>,
<a href="https://pjbartlein.github.io/datagraphics/color_scales.html">https://pjbartlein.github.io/datagraphics/color_scales.html</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dtRates">dtRates</a></code>, <code><a href="#topic+addBAMMshifts">addBAMMshifts</a></code>,
<code><a href="#topic+assignColorBreaks">assignColorBreaks</a></code>, <code><a href="#topic+subtreeBAMM">subtreeBAMM</a></code>,
<code><a href="grDevices.html#topic+colorRampPalette">colorRampPalette</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)
ed &lt;- getEventData(whales, events.whales, burnin=0.25, nsamples=500)

# The first call to plot.bammdata
# No calculations or assignments of rates have been made
plot(ed, lwd = 3, spex = "s") # calls dtRates &amp; assignColorBreaks

# Compare the different color breaks methods
par(mfrow=c(1,3))
plot(ed, lwd = 3, spex = "s", breaksmethod = "linear")
title(main="linear")
plot(ed, lwd = 3, spex = "s", breaksmethod = "quantile")
title(main="quantile")
plot(ed, lwd = 3, spex = "s", breaksmethod = "jenks")
title(main="jenks")

## Not run: 
# now plot.bammdata no longer calls dtRates
ed &lt;- dtRates(ed, tau = 0.01)
xx &lt;- plot(ed, lwd = 3, spex = "s")

# you can plot subtrees while preserving the original 
# rates to colors map by passing the colorbreaks object as an argument
sed &lt;- subtreeBAMM(ed, node = 103)
plot(sed, lwd = 3, colorbreaks = xx$colorbreaks)
sed &lt;- subtreeBAMM(ed, node = 140)
plot(sed, lwd = 3, colorbreaks = xx$colorbreaks)
# note how if we do not pass colorbreaks the map is 
# no longer relative to the rest of the tree and the plot is quite
# distinct from the original
plot(sed, lwd = 3)

# if you want to change the value of tau and the rates to colors map for
# the entire tree
ed &lt;- dtRates(ed, tau = 0.002)
xx &lt;- plot(ed, lwd = 3, spex = "s")
# now you can re-plot the subtrees using this finer tau partition
sed &lt;- subtreeBAMM(ed, node = 103)
sed &lt;- dtRates(sed, 0.002)
plot(sed, lwd = 3, colorbreaks = xx$colorbreaks)
sed &lt;- subtreeBAMM(ed, node = 140)
sed &lt;- dtRates(sed, 0.002)
plot(sed, lwd = 3, colorbreaks = xx$colorbreaks)

# multi-panel plotting and adding shifts of specific posterior samples
par(mfrow=c(2,3))
samples &lt;- sample(1:length(ed$eventData), 6)
ed &lt;- dtRates(ed, 0.005)
# individual plots will have a color map relative to the mean
xx &lt;- plot(ed, show=FALSE)
for (i in 1:6) {
    ed &lt;- dtRates(ed, 0.005, samples[i])
    plot(ed, colorbreaks=xx$colorbreaks)
    addBAMMshifts(ed,index=samples[i],method="phylogram", par.reset=FALSE)	
}
dev.off()

# color options
ed &lt;- dtRates(ed,0.01)
plot(ed, pal="temperature",lwd=3)
plot(ed, pal="terrain",lwd=3)
plot(ed, pal=c("darkgreen","yellow2","red"),lwd=3)
plot(ed,method="polar",pal="Spectral", lwd=3)
plot(ed,method="polar",pal="RdYlBu", lwd=3)
## End(Not run)
</code></pre>

<hr>
<h2 id='plot.bammshifts'>Plot distinct rate shift configurations on a phylogeny</h2><span id='topic+plot.bammshifts'></span>

<h3>Description</h3>

<p>Plots a random distinct rate shift configuration sampled by
<code>BAMM</code> on a phylogeny.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bammshifts'
plot(
  x,
  ephy,
  method = "phylogram",
  pal = "RdYlBu",
  rank = NULL,
  index = NULL,
  spex = "s",
  legend = TRUE,
  add.freq.text = TRUE,
  logcolor = FALSE,
  breaksmethod = "linear",
  color.interval = NULL,
  JenksSubset = 20000,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.bammshifts_+3A_x">x</code></td>
<td>
<p>An object of class <code>bammshifts</code>.</p>
</td></tr>
<tr><td><code id="plot.bammshifts_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="plot.bammshifts_+3A_method">method</code></td>
<td>
<p>A character string for which plotting method to use.
&quot;phylogram&quot; uses rectangular coordinates. &quot;polar&quot; uses polar
coordinates.</p>
</td></tr>
<tr><td><code id="plot.bammshifts_+3A_pal">pal</code></td>
<td>
<p>The color palette to use in <code>plot.bammdata</code>.</p>
</td></tr>
<tr><td><code id="plot.bammshifts_+3A_rank">rank</code></td>
<td>
<p>The rank of the core shift configuration to plot. For the
default (<code>NULL</code>) a random configuration is chosen.</p>
</td></tr>
<tr><td><code id="plot.bammshifts_+3A_index">index</code></td>
<td>
<p>The posterior sample to plot. For the default (<code>NULL</code>)
a random sample is chosen.</p>
</td></tr>
<tr><td><code id="plot.bammshifts_+3A_spex">spex</code></td>
<td>
<p>A character string indicating what type of macroevolutionary
rates should be plotted. &quot;s&quot; (default) indicates speciation rates, &quot;e&quot;
indicates extinction rates, and 'netdiv' indicates net diversification
rates. Ignored if <code>ephy$type = "trait"</code>.</p>
</td></tr>
<tr><td><code id="plot.bammshifts_+3A_legend">legend</code></td>
<td>
<p>Logical indicating whether to plot a legend.</p>
</td></tr>
<tr><td><code id="plot.bammshifts_+3A_add.freq.text">add.freq.text</code></td>
<td>
<p>A logical indicating whether the frequency of each
sampled shift configuration should be added to each plot.</p>
</td></tr>
<tr><td><code id="plot.bammshifts_+3A_logcolor">logcolor</code></td>
<td>
<p>Logical. Should colors be plotted on a log scale.</p>
</td></tr>
<tr><td><code id="plot.bammshifts_+3A_breaksmethod">breaksmethod</code></td>
<td>
<p>Method used for determining color breaks. See help
file for <code><a href="#topic+assignColorBreaks">assignColorBreaks</a></code>.</p>
</td></tr>
<tr><td><code id="plot.bammshifts_+3A_color.interval">color.interval</code></td>
<td>
<p>Min and max value for the mapping of rates. One of
the two values can be <code>NA</code>. See details in
<code><a href="#topic+plot.bammdata">plot.bammdata</a></code> for further details.</p>
</td></tr>
<tr><td><code id="plot.bammshifts_+3A_jenkssubset">JenksSubset</code></td>
<td>
<p>If <code>breaksmethod = "jenks"</code>, the number of
regularly-spaced samples to subset from the full rates vector. Only
relevant for large datasets. See help file for
<code><a href="#topic+assignColorBreaks">assignColorBreaks</a></code>.</p>
</td></tr>
<tr><td><code id="plot.bammshifts_+3A_...">...</code></td>
<td>
<p>Other arguments to <code>plot.bammdata</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A rate shift configuration is the set of nodes of the phylogeny
where a shift occurs in the macroevolutionary rate dynamic of
diversification or trait evolution. Each posterior sample is a
potentially distinct rate shift configuration. Different
configurations may imply different macroevolutionary scenarios. This
function helps visualize the different distinct rate shift
configurations sampled by <code>BAMM</code>.
</p>
<p>A core shift configuration is defined by a set of nodes that have
shift probabilities that are substantially elevated relative to what
you expect under the prior alone. These core configurations are
inferred in <code><a href="#topic+distinctShiftConfigurations">distinctShiftConfigurations</a></code>. It is almost
certain that more than one core shift configuration will be sampled by
<code>BAMM</code>. Moreover, each core shift configuration may contain many
subconfigurations. A subconfiguration contains the core shift node
configuration and zero or more additional shift nodes that occur with
low marginal probability.  
</p>
<p>Points are added to the branches subtending the nodes of each rate
configuration. The size of the point is proportional to the marginal
probability that a shift occurs on a specific branch. If the
instantaneous rate at a shift's origin represents an initial increase
above the ancestral instantaneous rate the point is red. If the
instantaneous rate at a shift's origin represents an initial decrease
below the ancestral instantaneous rate the point is blue.
</p>


<h3>Author(s)</h3>

<p>Mike Grundler, Dan Rabosky
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+distinctShiftConfigurations">distinctShiftConfigurations</a></code>,
<code><a href="#topic+plot.bammdata">plot.bammdata</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)

ed &lt;- getEventData(whales, events.whales, burnin=0.25, nsamples=500)

sc &lt;- distinctShiftConfigurations(ed, expectedNumberOfShifts = 1,
                                  threshold = 5)

plot(sc, ed)
</code></pre>

<hr>
<h2 id='plot.credibleshiftset'>Plot credible set of rate shift configurations from <code>BAMM</code>
analysis</h2><span id='topic+plot.credibleshiftset'></span>

<h3>Description</h3>

<p>Plots the credible set of rate shift configurations from a
<code>BAMM</code> analysis on a phylogeny.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'credibleshiftset'
plot(
  x,
  plotmax = 9,
  method = "phylogram",
  pal = "RdYlBu",
  shiftColor = "black",
  spex = "s",
  add.freq.text = TRUE,
  use.plot.bammdata = TRUE,
  border = TRUE,
  legend = FALSE,
  send2pdf = FALSE,
  logcolor = FALSE,
  breaksmethod = "linear",
  color.interval = NULL,
  JenksSubset = 20000,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.credibleshiftset_+3A_x">x</code></td>
<td>
<p>An object of class <code>credibleshiftset</code>.</p>
</td></tr>
<tr><td><code id="plot.credibleshiftset_+3A_plotmax">plotmax</code></td>
<td>
<p>An integer number of plots to display.</p>
</td></tr>
<tr><td><code id="plot.credibleshiftset_+3A_method">method</code></td>
<td>
<p>A coordinate method to use for plotting. Options are
&quot;phylogram&quot; or &quot;polar&quot;.</p>
</td></tr>
<tr><td><code id="plot.credibleshiftset_+3A_pal">pal</code></td>
<td>
<p>A color palette to use with <code>plot.bammdata</code>.</p>
</td></tr>
<tr><td><code id="plot.credibleshiftset_+3A_shiftcolor">shiftColor</code></td>
<td>
<p>Color to use for shift points.</p>
</td></tr>
<tr><td><code id="plot.credibleshiftset_+3A_spex">spex</code></td>
<td>
<p>A character string indicating what type of macroevolutionary
rates should be plotted. &quot;s&quot; (default) indicates speciation rates, &quot;e&quot;
indicates extinction rates, and &quot;netdiv&quot; indicates net diversification
rates. Ignored if ephy$type = &quot;trait&quot;.</p>
</td></tr>
<tr><td><code id="plot.credibleshiftset_+3A_add.freq.text">add.freq.text</code></td>
<td>
<p>A logical indicating whether to add the posterior
frequency of each shift configuration to the plotting region.</p>
</td></tr>
<tr><td><code id="plot.credibleshiftset_+3A_use.plot.bammdata">use.plot.bammdata</code></td>
<td>
<p>A logical indicating whether to use
<code>plot.bammdata</code> (<code>TRUE</code>) or <code>plot.phylo</code>
(<code>FALSE</code>).</p>
</td></tr>
<tr><td><code id="plot.credibleshiftset_+3A_border">border</code></td>
<td>
<p>A logical indicating whether to frame the plotting region.</p>
</td></tr>
<tr><td><code id="plot.credibleshiftset_+3A_legend">legend</code></td>
<td>
<p>A logical indicating whether to plot a legend.</p>
</td></tr>
<tr><td><code id="plot.credibleshiftset_+3A_send2pdf">send2pdf</code></td>
<td>
<p>A logical indicating whether to print the figure to a PDF
file.</p>
</td></tr>
<tr><td><code id="plot.credibleshiftset_+3A_logcolor">logcolor</code></td>
<td>
<p>A logical indicating whether the rates should be
log-transformed.</p>
</td></tr>
<tr><td><code id="plot.credibleshiftset_+3A_breaksmethod">breaksmethod</code></td>
<td>
<p>Method used for determining color breaks. See help
file for <code><a href="#topic+assignColorBreaks">assignColorBreaks</a></code>.</p>
</td></tr>
<tr><td><code id="plot.credibleshiftset_+3A_color.interval">color.interval</code></td>
<td>
<p>Min and max value for the mapping of rates. One of
the two values can be <code>NA</code>. See details in
<code><a href="#topic+plot.bammdata">plot.bammdata</a></code> for further details.</p>
</td></tr>
<tr><td><code id="plot.credibleshiftset_+3A_jenkssubset">JenksSubset</code></td>
<td>
<p>If <code>breaksmethod = "jenks"</code>, the number of
regularly spaced samples to subset from the full rates vector. Only
relevant for large datasets. See help file for
<code><a href="#topic+assignColorBreaks">assignColorBreaks</a></code>.</p>
</td></tr>
<tr><td><code id="plot.credibleshiftset_+3A_...">...</code></td>
<td>
<p>Further arguments to pass to <code>plot.bammdata</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This produces phylorate plots for the <code>plotmax</code>
most-probable shift configurations sampled with <code>BAMM</code>. Shift
configurations are plotted in a single graphics window. The posterior
probability (frequency) of each rate shift configuration in the
posterior is shown (omitted with argument <code>add.freq.text = FALSE</code>).
</p>
<p>Points are added to the branches subtending the nodes of each rate
configuration. The size of the point is proportional to the marginal
probability that a shift occurs on a specific branch.
</p>


<h3>Author(s)</h3>

<p>Mike Grundler
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+credibleShiftSet">credibleShiftSet</a></code>,
<code><a href="#topic+distinctShiftConfigurations">distinctShiftConfigurations</a></code>,
<code><a href="#topic+plot.bammdata">plot.bammdata</a></code>, <code><a href="#topic+plot.bammshifts">plot.bammshifts</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(events.whales)
data(whales)
ed &lt;- getEventData(whales, events.whales, nsamples=500)
cset &lt;- credibleShiftSet(ed, expectedNumberOfShifts = 1, threshold = 5)
plot(cset)
</code></pre>

<hr>
<h2 id='plotPrior'>Plot the prior and posterior distribution of shifts</h2><span id='topic+plotPrior'></span>

<h3>Description</h3>

<p>Generates a barplot of the prior and posterior distributions
of the number of shifts.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotPrior(
  mcmc,
  expectedNumberOfShifts = 1,
  burnin = 0.15,
  priorCol = "light blue",
  postCol = "red",
  legendPos = "topright",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotPrior_+3A_mcmc">mcmc</code></td>
<td>
<p>A dataframe of the mcmc_out file from a <code>BAMM</code> run, or
the filename.</p>
</td></tr>
<tr><td><code id="plotPrior_+3A_expectednumberofshifts">expectedNumberOfShifts</code></td>
<td>
<p>Expected number of shifts under the prior.</p>
</td></tr>
<tr><td><code id="plotPrior_+3A_burnin">burnin</code></td>
<td>
<p>The fraction of samples to discard as burn-in.</p>
</td></tr>
<tr><td><code id="plotPrior_+3A_priorcol">priorCol</code></td>
<td>
<p>Color for the prior distribution.</p>
</td></tr>
<tr><td><code id="plotPrior_+3A_postcol">postCol</code></td>
<td>
<p>Color for the posterior distribution.</p>
</td></tr>
<tr><td><code id="plotPrior_+3A_legendpos">legendPos</code></td>
<td>
<p>Placement of the legend, see <code><a href="graphics.html#topic+legend">legend</a></code>.</p>
</td></tr>
<tr><td><code id="plotPrior_+3A_...">...</code></td>
<td>
<p>Additional parameters that are passed to
<code><a href="graphics.html#topic+barplot">barplot</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns a matrix with the probability of each shift
number under the prior and the posterior.
</p>


<h3>Author(s)</h3>

<p>Pascal Title
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mcmc.whales)
plotPrior(mcmc.whales, expectedNumberOfShifts = 1, burnin = 0.15)
</code></pre>

<hr>
<h2 id='plotRateThroughTime'>Plot rates through time</h2><span id='topic+plotRateThroughTime'></span>

<h3>Description</h3>

<p>Generates a plot of diversification or phenotypic rate through
time with confidence intervals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotRateThroughTime(
  ephy,
  useMedian = TRUE,
  intervals = seq(from = 0, to = 1, by = 0.01),
  ratetype = "auto",
  nBins = 100,
  smooth = FALSE,
  smoothParam = 0.2,
  opacity = 0.01,
  intervalCol = "blue",
  avgCol = "red",
  start.time = NULL,
  end.time = NULL,
  node = NULL,
  nodetype = "include",
  plot = TRUE,
  cex.axis = 1,
  cex.lab = 1.3,
  lwd = 3,
  xline = 3.5,
  yline = 3.5,
  mar = c(6, 6, 1, 1),
  xticks = NULL,
  yticks = NULL,
  xlim = "auto",
  ylim = "auto",
  add = FALSE,
  axis.labels = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotRateThroughTime_+3A_ephy">ephy</code></td>
<td>
<p>Object of class <code>bammdata</code> or <code>bamm-ratematrix</code>.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_usemedian">useMedian</code></td>
<td>
<p>A logical: will plot median if <code>TRUE</code>, mean if
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_intervals">intervals</code></td>
<td>
<p>If <code>NULL</code>, no intervals will be plotted, otherwise a
vector of quantiles must be supplied (these will define shaded
polygons).</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_ratetype">ratetype</code></td>
<td>
<p>If 'auto', defaults to speciation (for diversification) or
beta (for traits). Can alternatively specify 'netdiv' or 'extinction'.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_nbins">nBins</code></td>
<td>
<p>Number of time slices used to generate rates through time.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_smooth">smooth</code></td>
<td>
<p>A logical: whether or not to apply loess smoothing.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_smoothparam">smoothParam</code></td>
<td>
<p>Loess smoothing parameter, ignored if
<code>smooth = FALSE</code>.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_opacity">opacity</code></td>
<td>
<p>Opacity of color for interval polygons.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_intervalcol">intervalCol</code></td>
<td>
<p>Color for interval polygons.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_avgcol">avgCol</code></td>
<td>
<p>Color for mean/median line (line will not be plotted if
<code>avgCol = NULL</code>).</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_start.time">start.time</code></td>
<td>
<p>Start time (in units before present). If <code>NULL</code>,
starts at root.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_end.time">end.time</code></td>
<td>
<p>End time (in units before present). If <code>NULL</code>, ends
at present.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_node">node</code></td>
<td>
<p>If supplied, the clade descended from this node will be used
or ignored, depending on <code>nodetype</code>.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_nodetype">nodetype</code></td>
<td>
<p>If 'include', rates will be plotted only for the clade
descended from <code>node</code>. If 'exclude', the clade descended from
<code>node</code> will be left out of the calculation of rates.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_plot">plot</code></td>
<td>
<p>A logical: if <code>TRUE</code>, a plot will be returned, if
<code>FALSE</code>, the data for the plot will be returned.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_cex.axis">cex.axis</code></td>
<td>
<p>Size of axis tick labels.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_cex.lab">cex.lab</code></td>
<td>
<p>Size of axis labels.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_lwd">lwd</code></td>
<td>
<p>Line width of the average rate.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_xline">xline</code></td>
<td>
<p>Margin line for placing x-axis label.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_yline">yline</code></td>
<td>
<p>Margin line for placing y-axis label.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_mar">mar</code></td>
<td>
<p>Passed to <code>par()</code> to set plot margins.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_xticks">xticks</code></td>
<td>
<p>Number of ticks on the x-axis, automatically inferred if
<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_yticks">yticks</code></td>
<td>
<p>Number of ticks on the y-axis, automatically inferred if
<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_xlim">xlim</code></td>
<td>
<p>Vector of length 2 with min and max times for x axis. X axis
is time since present, so if plotting till the present,
<code>xlim[2] == 0</code>. Can also be 'auto'.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_ylim">ylim</code></td>
<td>
<p>Vector of length 2 with min and max rates for y axis. Can also
be 'auto'.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_add">add</code></td>
<td>
<p>A logical: should rates be added to an existing plot.</p>
</td></tr>
<tr><td><code id="plotRateThroughTime_+3A_axis.labels">axis.labels</code></td>
<td>
<p>A logical: if <code>TRUE</code>, axis labels will be plotted.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the input <code>ephy</code> object has been generated by
<code><a href="#topic+getEventData">getEventData</a></code> and is of class <code>bammdata</code>, then
<code>start.time</code>, <code>end.time</code>, <code>node</code>, and <code>nodetype</code>
can be specified. If the input <code>ephy</code> object has been generated
by <code><a href="#topic+getRateThroughTimeMatrix">getRateThroughTimeMatrix</a></code> and is of class
<code>bamm-ratematrix</code>, then those arguments cannot be specified
because they are needed to generate the rate matrix, which in this
case has already happened. 
</p>
<p>The user has complete control of the plotting of the confidence
intervals. Confidence intervals will not be plotted at all if
<code>intervals=NULL</code>. If a single confidence interval polygon is
desired, rather than overlapping polygons, then <code>intervals</code> can
specify the confidence interval bounds, and <code>opacity</code> should be
set to 1 (see examples).
</p>
<p>If working with a large dataset, we recommend first creating a
<code>bamm-ratematrix</code> object with
<code><a href="#topic+getRateThroughTimeMatrix">getRateThroughTimeMatrix</a></code> and then using that object as
input for <code>plotRateThroughTime</code>. This way, the computation of
rates has already happened and will not slow the plotting function
down, making it easier to adjust plotting parameters.
</p>


<h3>Value</h3>

<p>If <code>plot = FALSE</code>, then a list is returned with the following
components:
</p>

<ul>
<li><p> poly: A list of matrices, where each matrix contains the
coordinates that define each overlapping confidence interval
polygon.
</p>
</li>
<li><p> avg: A vector of y-coordinates for mean or median rates
used to plot the average rates line.
</p>
</li>
<li><p> times: A vector of time values, used as x-coordinates in
this plot function.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pascal Title
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+getEventData">getEventData</a></code> and
<code><a href="#topic+getRateThroughTimeMatrix">getRateThroughTimeMatrix</a></code> to generate input data.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(events.whales)
data(whales)
ephy &lt;- getEventData(whales,events.whales)

# Simple plot of rates through time with default settings
plotRateThroughTime(ephy)

# Plot two processes separately with 90% CI and loess smoothing
plotRateThroughTime(ephy, intervals = seq(from = 0, 0.9, by = 0.01), smooth = TRUE,
                    node = 141, nodetype = 'exclude', ylim = c(0, 1.2))

plotRateThroughTime(ephy, intervals = seq(from = 0, 0.9, by = 0.01), smooth = TRUE, 
                    node = 141, nodetype = 'include', add = TRUE,
                    intervalCol = 'orange')

legend('topleft', legend = c('Dolphins','Whales'), col = 'red',
    fill = c('orange', 'blue'), border = FALSE, lty = 1, lwd = 2, merge = TRUE,
           seg.len=0.6)

# Same plot, but from bamm-ratematrix objects
rmat1 &lt;- getRateThroughTimeMatrix(ephy, node = 141, nodetype = 'exclude')
rmat2 &lt;- getRateThroughTimeMatrix(ephy, node = 141, nodetype = 'include')

plotRateThroughTime(rmat1, intervals=seq(from = 0, 0.9, by = 0.01), 
    smooth = TRUE, ylim = c(0, 1.2))

plotRateThroughTime(rmat2, intervals = seq(from = 0, 0.9, by = 0.01), 
    smooth = TRUE, add = TRUE, intervalCol = 'orange')

# To plot the mean rate without the confidence envelope
plotRateThroughTime(ephy, useMedian = FALSE, intervals = NULL)

# To plot the mean rate, with a single 95% confidence envelope, grayscale
plotRateThroughTime(ephy, useMedian = FALSE, intervals = c(0.05, 0.95),
    intervalCol = 'gray70', avgCol = 'black', opacity = 1)

# To not plot, but instead return the plotting data generated in this
# function, we can make plot = FALSE
plotRateThroughTime(ephy, plot = FALSE)
## End(Not run)
</code></pre>

<hr>
<h2 id='ratesHistogram'>Histogram of <code>BAMM</code> rate frequencies</h2><span id='topic+ratesHistogram'></span>

<h3>Description</h3>

<p>Plots a histogram of the frequency of rate values across the
phylogeny.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ratesHistogram(
  phylorates,
  plotBrks = TRUE,
  xlab = "speciation rate",
  ylab = "density",
  lwd = 0.2,
  lty = 1,
  brksCol = "black",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ratesHistogram_+3A_phylorates">phylorates</code></td>
<td>
<p>A saved <code><a href="#topic+plot.bammdata">plot.bammdata</a></code> object.</p>
</td></tr>
<tr><td><code id="ratesHistogram_+3A_plotbrks">plotBrks</code></td>
<td>
<p>Boolean, should breaks be plotted over the histogram.</p>
</td></tr>
<tr><td><code id="ratesHistogram_+3A_xlab">xlab</code></td>
<td>
<p>x-axis label.</p>
</td></tr>
<tr><td><code id="ratesHistogram_+3A_ylab">ylab</code></td>
<td>
<p>y-axis label.</p>
</td></tr>
<tr><td><code id="ratesHistogram_+3A_lwd">lwd</code></td>
<td>
<p>Line width for breaks.</p>
</td></tr>
<tr><td><code id="ratesHistogram_+3A_lty">lty</code></td>
<td>
<p>Line style for breaks.</p>
</td></tr>
<tr><td><code id="ratesHistogram_+3A_brkscol">brksCol</code></td>
<td>
<p>Color of breaks lines.</p>
</td></tr>
<tr><td><code id="ratesHistogram_+3A_...">...</code></td>
<td>
<p>Additional arguments passed on to <code>mtext</code> for axis
labels.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>With this function, a histogram is plotted that shows the
frequency of rates present in the dataset. The color scheme plotted
is taken from the saved <code>plot.bammdata</code> object that is the main
input. Therefore, the mapping of colors to rates in the histogram
corresponds exactly to what is plotted in the phylorate plot. If
<code>plotBrks = TRUE</code>, then the color breaks used for the phylorates
plot are shown. 
</p>
<p>This function can be a useful tool for exploring different
<code>plot.bammdata</code> options. Please see
<a href="http://bamm-project.org/colorbreaks.html">http://bamm-project.org/colorbreaks.html</a> on the bamm-project
website for more information on the utility of this function.
</p>


<h3>Author(s)</h3>

<p>Pascal Title
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.bammdata">plot.bammdata</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(primates, events.primates)
ed &lt;- getEventData(primates, events.primates, burnin=0.25, nsamples=500,
                   type = 'trait')

# create phylorate plot with the jenks breaks method to generate output
phylorates &lt;- plot(ed, breaksmethod='jenks', show = FALSE)

ratesHistogram(phylorates, plotBrks = TRUE, xlab = 'trait rates')
</code></pre>

<hr>
<h2 id='richColors'>Rich color palette</h2><span id='topic+richColors'></span>

<h3>Description</h3>

<p>Deprecated function. Please use
<code><a href="gplots.html#topic+rich.colors">rich.colors</a></code> instead.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>richColors(n)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="richColors_+3A_n">n</code></td>
<td>
<p>The number of desired colors.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="gplots.html#topic+rich.colors">rich.colors</a></code>
</p>

<hr>
<h2 id='samplingProbs'>Creates clade-specific sampling fractions</h2><span id='topic+samplingProbs'></span>

<h3>Description</h3>

<p>If the user would like to specify species sampling on a
clade-by-clade basis, a sampling probability table can be provided to
<code>BAMM</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>samplingProbs(
  tree,
  cladeTable,
  cladeRichness = NULL,
  globalSampling,
  output,
  writeToDisk = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="samplingProbs_+3A_tree">tree</code></td>
<td>
<p>An object of class <code>phylo</code>.</p>
</td></tr>
<tr><td><code id="samplingProbs_+3A_cladetable">cladeTable</code></td>
<td>
<p>A dataframe with one column of species names and a
second column of group assignment.</p>
</td></tr>
<tr><td><code id="samplingProbs_+3A_claderichness">cladeRichness</code></td>
<td>
<p>Either <code>NULL</code> or a vector of species counts,
named by clade names.</p>
</td></tr>
<tr><td><code id="samplingProbs_+3A_globalsampling">globalSampling</code></td>
<td>
<p>percent sampling for the backbone of the phylogeny.</p>
</td></tr>
<tr><td><code id="samplingProbs_+3A_output">output</code></td>
<td>
<p>Path + output file name.</p>
</td></tr>
<tr><td><code id="samplingProbs_+3A_writetodisk">writeToDisk</code></td>
<td>
<p>A logical, should the table be written to disk,
defaults to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function handles two types of input: The cladeTable can
either contain the species found in the phylogeny, along with clade
assignment of those species, or it can contain more species than found
in the phylogeny. If the table only contains those species in the
phylogeny, then a vector <code>cladeRichness</code> must be provided that
contains known clade richness. If the cladeTable contains more than
the species in the phylogeny, then cladeRichness should be set to
<code>NULL</code>. The <code>globalSampling</code> value should represent the
overall completeness of species sampling in terms of major clades. See
<a href="http://bamm-project.org/">http://bamm-project.org/</a> for additional details.
</p>


<h3>Value</h3>

<p>If <code>writeToDisk = TRUE</code>, then no object is returned. If
<code>writeToDisk = FALSE</code>, then a dataframe is returned. The
resultant table must contain one row for each species in the
phylogeny, along with clade assignment, and sampling fraction. The
first line must contain the overall sampling fraction for the
phylogeny and must be written as tab-delimited, with no headers.
</p>


<h3>Author(s)</h3>

<p>Pascal Title
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Generate dummy data
tree &lt;- read.tree(text="(((t1:2,(t2:1,t3:1):1):1,((t4:1,t5:1):1,t6:2):1)
                  :1,(t7:3,(t8:2,t9:2):1):1);")
tree$tip.label &lt;- paste(rep('Species',9),1:9,sep='')

spTable &lt;- as.data.frame(matrix(nrow=9,ncol=2))
spTable[,1] &lt;- tree$tip.label
spTable[1:3,2] &lt;- 'cladeA'
spTable[4:6,2] &lt;- 'cladeB'
spTable[7:9,2] &lt;- 'cladeC'
richnessVec &lt;- c(cladeA=5, cladeB=4, cladeC=12)

# Option 1: We have a table of clade assignment for the species in the
#           tree, along with a vector of known clade richness
spTable
richnessVec
samplingProbs(tree, cladeTable = spTable, cladeRichness = richnessVec,
              globalSampling = 1, writeToDisk = FALSE)

# Option 2: We have a table of known species, beyond the sampling in the
#           phylogeny
spTable &lt;- rbind(spTable, c('Species10','cladeA'),c('Species11','cladeA'),
                 c('Species12','cladeC'), c('Species13','cladeC'),
                 c('Species14','cladeC'))

spTable

samplingProbs(tree, cladeTable = spTable, cladeRichness = NULL, 
              globalSampling = 0.9, writeToDisk = FALSE)
</code></pre>

<hr>
<h2 id='setBAMMpriors'>Set BAMM Priors</h2><span id='topic+setBAMMpriors'></span>

<h3>Description</h3>

<p>Set priors for <code>BAMM</code> analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>setBAMMpriors(
  phy,
  total.taxa = NULL,
  traits = NULL,
  outfile = "myPriors.txt",
  Nmax = 1000,
  suppressWarning = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="setBAMMpriors_+3A_phy">phy</code></td>
<td>
<p>An object of class <code>phylo</code>, e.g., the phylogenetic tree
you will analyze with <code>BAMM</code>.</p>
</td></tr>
<tr><td><code id="setBAMMpriors_+3A_total.taxa">total.taxa</code></td>
<td>
<p>If doing speciation-extinction analysis, the total
number of taxa in your clade. If your tree contains all taxa in the
clade (100% sampling), then leave this as <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="setBAMMpriors_+3A_traits">traits</code></td>
<td>
<p>A filename where the trait data (<code>BAMM</code> format) are
stored, or a numeric vector named according to the tips in <code>phy</code>.
Leave <code>NULL</code> if doing a speciation-extinction analysis.</p>
</td></tr>
<tr><td><code id="setBAMMpriors_+3A_outfile">outfile</code></td>
<td>
<p>Filename for outputting the sample priors block. If
<code>NULL</code>, then a vector is returned instead.</p>
</td></tr>
<tr><td><code id="setBAMMpriors_+3A_nmax">Nmax</code></td>
<td>
<p>If analyzing a very large tree for phenotypic evolution, uses
only this many taxa to estimate priors for your dataset. Avoid matrix
inversion issues with large numbers of tips.</p>
</td></tr>
<tr><td><code id="setBAMMpriors_+3A_suppresswarning">suppressWarning</code></td>
<td>
<p>Logical. If <code>TRUE</code>, then the warning about
setting the Poisson rate prior is suppressed. Only applies if
<code>outfile = NULL</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is a &quot;quick and dirty&quot; tool for identifying approximately
acceptable priors for a <code>BAMM</code> analysis. We have found that
choice of prior can have a substantial impact on <code>BAMM</code> analyses.
It is difficult to simply set a default prior that applies across
datasets, because users often have trees with branch lengths in very
different units (e.g., numbers of substitutions versus millions of
years). Hence, without some careful attention, you can inadvertently
specify some very bad prior distributions. This function is designed
to at least put you in the right ballpark for decent prior
distributions, but there are no guarantees that these are most
appropriate for your data.
</p>
<p>The general rules applied here are: 
</p>
<p>For the <code>lambdaInitPrior</code>, we estimate the speciation rate of the
data under a pure birth model. We then set this prior to give an
exponential distribution with a mean five times greater than this
computed pure birth speciation estimate.
</p>
<p>The <code>lambdaShiftPrior</code> is the standard deviation of the normal
prior on the exponential change parameter k. We set the prior
distribution based on the age of the root of the tree. We set the
standard deviation of this distribution such that 2 standard
deviations give a parameter that will yield a 90% decline in the
initial speciation rate between the root of the tree and the tips.
The basic model is lambda(t) = lambda_0 * exp(k * t). This is a
straightforward calculation: let x = -log(0.1) / TMAX, where TMAX is
the age of the tree. Then set the standard deviation equal to (x / 2).
</p>
<p>We set <code>muInitPrior</code> equal to <code>lambdaInitPrior</code>.  
</p>
<p>For trait evolution, we first compute the maximum likelihood estimate
of the variance of a Brownian motion process of trait evolution. The
prior <code>betaInitPrior</code> is then set to an exponential distribution
with a mean 5 times greater than this value (similar to what is done
for lambda and mu, above).  
</p>
<p>This function generates an output file containing a prior parameters
block that can be pasted directly into the priors section of your
<code>BAMM</code> control file.
</p>


<h3>Value</h3>

<p>The function does not return anything. It simply performs some
calculations and writes formatted output to a file. However, if
<code>outfile = NULL</code>, then a named vector is returned.
</p>


<h3>Author(s)</h3>

<p>Dan Rabosky
</p>


<h3>Examples</h3>

<pre><code class='language-R'># for diversification analyses
data(whales)
setBAMMpriors(phy = whales, total.taxa = 89, outfile = NULL)

# for trait analyses
data("primates")
data("mass.primates")

## create a named vector of trait values
mass &lt;- setNames(mass.primates[,2], mass.primates[,1])

setBAMMpriors(phy = primates, traits = mass, outfile = NULL)
</code></pre>

<hr>
<h2 id='speciesByRatesMatrix'>Compute species-specific rate through time trajectories</h2><span id='topic+speciesByRatesMatrix'></span>

<h3>Description</h3>

<p>Computes the mean of the marginal posterior density of
speciation/extinction or phenotypic rates for equally spaced points
along the root to tip path for each species.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>speciesByRatesMatrix(ephy, nslices, index = NULL, spex = "s")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="speciesByRatesMatrix_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="speciesByRatesMatrix_+3A_nslices">nslices</code></td>
<td>
<p>An integer number of time slices. This determines the
number of equally spaced points in time at which rates are computed
for each species.</p>
</td></tr>
<tr><td><code id="speciesByRatesMatrix_+3A_index">index</code></td>
<td>
<p>An integer or vector of mode integer indicating which
posterior samples to use in the calculation. If <code>NULL</code> (default)
all samples are used.</p>
</td></tr>
<tr><td><code id="speciesByRatesMatrix_+3A_spex">spex</code></td>
<td>
<p>A character string. &quot;s&quot; (default) calculates speciation rates;
&quot;e&quot; calculates extinction rates; &quot;netdiv&quot; calculates diversification
rates. Ignored if <code>ephy$type = "trait"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with two components:
</p>

<ul>
<li><p> times: A vector of time points where rates were
calculated.
</p>
</li>
<li><p> rates: A species X times matrix of rate through time
trajectories.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Mike Grundler
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+getRateThroughTimeMatrix">getRateThroughTimeMatrix</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)
ed &lt;- getEventData(whales, events.whales, burnin=0.25, nsamples=500)
ratemat &lt;- speciesByRatesMatrix(ed, nslices = 100)

dolphins &lt;- extract.clade(whales, 140)$tip.label
plot.new()
plot.window(xlim = c(0, 35), ylim = c(0, 0.8))
for (i in 1:nrow(ratemat$rates)) {
	if (whales$tip.label[i] %in% dolphins) {
		lines(ratemat$times, ratemat$rates[i,], lwd = 2, col = 4)	
	} else {
		lines(ratemat$times, ratemat$rates[i,], lwd = 2, col = 8)
	}
}
axis(1, seq(-5, 35, 5))
axis(2, seq(-0.2, 0.8, 0.2), las = 1)
mtext("Time since root", 1, line = 2.5)
mtext("Speciation rate", 2, line = 2.5)

</code></pre>

<hr>
<h2 id='stepBF'>Identify the optimal number of shifts using Bayes factors</h2><span id='topic+stepBF'></span>

<h3>Description</h3>

<p>stepBF is a function to determine the overall best fitting number of shifts 
using Bayes factor evidence.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stepBF(BFmat, step.size = 20, expectedNumberOfShifts = 1, inputType = "matrix")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stepBF_+3A_bfmat">BFmat</code></td>
<td>
<p>square Bayes factor matrix or a named vector of posterior probabilities</p>
</td></tr>
<tr><td><code id="stepBF_+3A_step.size">step.size</code></td>
<td>
<p>how much Bayes factor support is required to accept a more complex model, see Details</p>
</td></tr>
<tr><td><code id="stepBF_+3A_expectednumberofshifts">expectedNumberOfShifts</code></td>
<td>
<p>expected number of shifts under the prior (only needed for <code>inputType = 'postProb'</code>)</p>
</td></tr>
<tr><td><code id="stepBF_+3A_inputtype">inputType</code></td>
<td>
<p>describes the input: <code>'matrix'</code> or <code>'postProb'</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>stepBF takes either a square Bayes factor matrix (such as output by <code><a href="#topic+computeBayesFactors">computeBayesFactors</a></code>) or a named 
vector of posterior probabilities. If posterior probabilities are supplied, the model prior
(<code>expectedNumberOfShifts</code>) must also be provided.
If the input is a Bayes factor matrix, specify <code>inputType = 'matrix'</code>, otherwise if the input is
a named vector of posterior probabilities, specify <code>inputType = 'postProb'</code>.
</p>
<p>The <code>step.size</code> argument is how much Bayes factor support is needed to accept a more complex model. 
By default, this value is 1, so any more complex model that has a better Bayes factor than the previous model 
will be accepted. Increasing the step size greatly reduces the Type I error at the cost of inflating Type II 
error. So, with increasing step.size, you will infer fewer shifts.
</p>


<h3>Value</h3>

<p>a list of 3 items: the number of shifts for the best model, the number of shifts for the second best model,
and the Bayes factor support for the best model over the second best.
</p>


<h3>Author(s)</h3>

<p>Jonathan Mitchell
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+computeBayesFactors">computeBayesFactors</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mcmc.whales)
# remove 10% burnin
mcmc.whales &lt;- mcmc.whales[floor(0.1 * nrow(mcmc.whales)):nrow(mcmc.whales), ]
# from a square matrix of Bayes factor values (inputType = 'matrix')
bfmat &lt;- computeBayesFactors(mcmc.whales, expectedNumberOfShifts = 1, burnin = 0)
stepBF(bfmat, step.size = 1, inputType = 'matrix')
# or from a vector of posterior probabilities (inputType = 'postProb')
postProb &lt;- table(mcmc.whales$N_shifts) / nrow(mcmc.whales)
stepBF(postProb, step.size = 1, inputType = 'postProb')

</code></pre>

<hr>
<h2 id='subsetEventData'>Subset a <code>bammdata</code> object</h2><span id='topic+subsetEventData'></span>

<h3>Description</h3>

<p>Subsets a <code>bammdata</code> object. Returns a <code>bammdata</code>
object after extracting a specified set of samples from the posterior.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>subsetEventData(ephy, index)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="subsetEventData_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="subsetEventData_+3A_index">index</code></td>
<td>
<p>A vector of integers corresponding to samples to be extracted
from the posterior distribution of shift configurations included in
the <code>bammdata</code> object.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This will result in an error if you attempt to access samples
that do not exist in the <code>ephy</code> data object. For example, if your
<code>bammdata</code> object includes 100 samples from a posterior
distribution sampled with <code>BAMM</code>, you can only attempt to subset
with index values 1:100.
</p>


<h3>Author(s)</h3>

<p>Dan Rabosky
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.bammdata">plot.bammdata</a></code>, <code><a href="#topic+getCohortMatrix">getCohortMatrix</a></code>,
<code><a href="graphics.html#topic+image">image</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)
ed &lt;- getEventData(whales, events.whales, nsamples=500)
ed2 &lt;- subsetEventData(ed, index=1)
plot(ed2) 
addBAMMshifts(ed2, cex=2)
</code></pre>

<hr>
<h2 id='subtreeBAMM'>Pulls out a subtree from <code>bammdata</code> object</h2><span id='topic+subtreeBAMM'></span>

<h3>Description</h3>

<p>Given a set of tips or a node, this function extracts the
corresponding subtree from the <code>bammdata</code> object. User should
specify either a set of tips or a node, and the node will overwrite
the tips if both are given.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>subtreeBAMM(ephy, tips = NULL, node = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="subtreeBAMM_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="subtreeBAMM_+3A_tips">tips</code></td>
<td>
<p>An integer or character vector indicating which tips (more
than one) to be included in the subtree.</p>
</td></tr>
<tr><td><code id="subtreeBAMM_+3A_node">node</code></td>
<td>
<p>An integer indicating the root of the subtree to be extracted,
and it must correspond to an innernode on the tree.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function allows users to extract a subtree from a big
<code>bammdata</code> object, and examine the subset using
<code><a href="#topic+plot.bammdata">plot.bammdata</a></code>
</p>


<h3>Value</h3>

<p>An object of class <code>bammdata</code>.
</p>


<h3>Author(s)</h3>

<p>Huateng Huang
</p>


<h3>See Also</h3>

<p><code><a href="#topic+getmrca">getmrca</a></code>, <code><a href="#topic+plot.bammdata">plot.bammdata</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)
ephy &lt;- getEventData(whales, events.whales, burnin=0.25, nsamples=500)

# specify a set of tips for the subtree
tips &lt;- sample(ephy$tip.label,size=20,replace=FALSE)
subphy &lt;- subtreeBAMM(ephy,tips=tips)

# specify a innernode for subsetting
subphy &lt;- subtreeBAMM(ephy,node=103)

# plot the subtree
plot(subphy)
</code></pre>

<hr>
<h2 id='summary.bammdata'>Summary of rate shift results from <code>BAMM</code> analysis</h2><span id='topic+summary.bammdata'></span>

<h3>Description</h3>

<p>Summarizes the posterior distribution on the number of
shifts.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bammdata'
summary(object, display = 10, print = T, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.bammdata_+3A_object">object</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="summary.bammdata_+3A_display">display</code></td>
<td>
<p>An integer for the number of rows of the posterior to
display.</p>
</td></tr>
<tr><td><code id="summary.bammdata_+3A_print">print</code></td>
<td>
<p>Print summary of shift distribution in console window?</p>
</td></tr>
<tr><td><code id="summary.bammdata_+3A_...">...</code></td>
<td>
<p>Additional arguments (currently unused).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Prints to console the number of posterior samples and the
posterior distribution on the number of shifts, which is just the
fraction of samples in the posterior having 0, 1, 2,...n shifts.
</p>


<h3>Value</h3>

<p>Returns (invisibly) a dataframe with 2 components:
</p>
<table>
<tr><td><code>shifts</code></td>
<td>
<p>The number of shifts.</p>
</td></tr>
<tr><td><code>prob</code></td>
<td>
<p>The corresponding posterior probability of a model with a
given number of rate shifts.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Mike Grundler, Dan Rabosky
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)
ephy &lt;- getEventData(whales, events.whales, nsamples=100)
summary(ephy)
</code></pre>

<hr>
<h2 id='summary.credibleshiftset'>Summary of credible set of shift configurations from a <code>BAMM</code>
analysis</h2><span id='topic+summary.credibleshiftset'></span><span id='topic+print.credibleshiftset'></span>

<h3>Description</h3>

<p>Prints summary attributes of the <code>BAMM</code> credible set of
shift configurations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'credibleshiftset'
summary(object, ...)

## S3 method for class 'credibleshiftset'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.credibleshiftset_+3A_object">object</code>, <code id="summary.credibleshiftset_+3A_x">x</code></td>
<td>
<p>An object of class <code>credibleshiftset</code>.</p>
</td></tr>
<tr><td><code id="summary.credibleshiftset_+3A_...">...</code></td>
<td>
<p>Additional arguments (unused).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Prints to console summary attributes of the XX% credible set of
shift configurations sampled using <code>BAMM</code>. Attributes printed
include: the number of distinct configurations in the XX% credible
set and the posterior probability, cumulative probability, and number
of rate shifts in the 9 most-probable shift configurations.
</p>


<h3>Value</h3>

<p><code>summary.credibleshiftset</code> returns (invisibly) a dataframe
with a number of rows equal to the number of shift configurations in
the credible set and four columns:
</p>
<table>
<tr><td><code>rank</code></td>
<td>
<p>The ranked index of each shift configuration (ranked by
posterior probability).</p>
</td></tr>
<tr><td><code>probability</code></td>
<td>
<p>The posterior probability of each shift
configuration.</p>
</td></tr>
<tr><td><code>cumulative</code></td>
<td>
<p>The cumulative probability of each shift
configuration.</p>
</td></tr>
<tr><td><code>N_shifts</code></td>
<td>
<p>The number of rate shifts in each shift
configuration (can be zero).</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Dan Rabosky
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+distinctShiftConfigurations">distinctShiftConfigurations</a></code>,
<code><a href="#topic+plot.bammshifts">plot.bammshifts</a></code>, <code><a href="#topic+credibleShiftSet">credibleShiftSet</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(whales, events.whales)
ed &lt;- getEventData(whales, events.whales, nsamples = 500)
cset &lt;- credibleShiftSet(ed, expectedNumberOfShifts = 1, threshold = 5)
summary(cset)
</code></pre>

<hr>
<h2 id='testTimeVariableBranches'>Evaluate evidence for temporal rate variation across tree</h2><span id='topic+testTimeVariableBranches'></span>

<h3>Description</h3>

<p>For each branch in a phylogenetic tree, evaluates the
evidence (posterior probability or Bayes factor) that
macroevolutionary rates have varied through time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>testTimeVariableBranches(ephy, prior_tv = 0.5, return.type = "posterior")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="testTimeVariableBranches_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="testTimeVariableBranches_+3A_prior_tv">prior_tv</code></td>
<td>
<p>The prior probability that rate shifts lead to a new
time-varying rate process (versus a time-constant process).</p>
</td></tr>
<tr><td><code id="testTimeVariableBranches_+3A_return.type">return.type</code></td>
<td>
<p>Either <code>"posterior"</code> or <code>"bayesfactor"</code>,
depending on which form of evidence you would like.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In <code>BAMM 2.0</code>, rate shifts on trees can lead to time-varying
or constant-rate diversification processes. In other words, the model
will incorporate temporal variation in rates only if there is
sufficient evidence in the data to favor it. The function
<code>testTimeVariableBranches</code> enables the user to extract the
evidence in favor of time-varying rates on any branch of a
phylogenetic tree from a <code>bammdata</code> object. 
</p>
<p>The function returns a copy of the original phylogenetic tree, but
where branch lengths have been replaced by either the posterior
probability (<code>return.type = "posterior"</code>) or the Bayes factor
evidence (<code>return.type = "bayesfactor"</code>) that the
macroevolutionary rate regime governing each branch is time-variable.
Consider a particular branch X on a phylogenetic tree. If the length
of this branch is 0.97 and <code>return.type = "posterior"</code>, this
implies that branch X was governed by a time-varying rate dynamic in
97% of all samples in the posterior. Alternatively, only 3% of
samples specified a constant rate dynamic on this branch. 
</p>
<p>The function also provides an alternative measure of support if
<code>return.type = "bayesfactor"</code>. In this case, the Bayes factor
evidence for temporal rate variation is computed for each branch. We
simply imagine that diversification rates on each branch can be
explained by one of two models: either rates vary through time, or
they do not. In the above example (branch X), the Bayes factor would
be computed as follows, letting <em>Prob_timevar</em> and
<em>Prior_timevar</em> be the posterior and prior probabilities that a
particular branch is governed by a time-varying rate process:
</p>
<p><em>( Prob_timevar) / (1 - Prob_timevar)</em> * <em> (1 -
prior_timevar) / (prior_timevar) </em>
</p>
<p>The Bayes factor is not particularly useful under uniform prior odds
(e.g., <code>prior_tv = 0.5</code>), since this simply reduces to the ratio
of posterior probabilities. Note that the prior must correspond to
whatever you used to analyze your data in <code>BAMM</code>. By default,
time-variable and time-constant processes are assumed to have equal
prior odds.
</p>
<p>This function can be used several ways, but this function allows the
user to quickly evaluate which portions of a phylogenetic tree have
&quot;significant&quot; evidence for rate variation through time (see Examples
below).
</p>


<h3>Value</h3>

<p>An object of class <code>phylo</code>, but where branch lengths are
replaced with the desired evidence (posterior probability or Bayes
factor) that each branch is governed by a time-varying rate dynamic.
</p>


<h3>Author(s)</h3>

<p>Dan Rabosky
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+getRateThroughTimeMatrix">getRateThroughTimeMatrix</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Load whale data:
data(whales, events.whales)
ed &lt;- getEventData(whales, events.whales, burnin=0.1, nsamples=200)

# compute the posterior probability of 
# time-varying rates on each branch
tree.pp &lt;- testTimeVariableBranches(ed)

# Plot tree, but color all branches where the posterior 
# probability of time-varying rates exceeds 95\%:

colvec &lt;- rep("black", nrow(whales$edge))
colvec[tree.pp$edge.length &gt;= 0.95] &lt;- 'red'

plot.phylo(whales, edge.color=colvec, cex=0.5)

# now, compute Bayes factors for each branch:

tree.bf &lt;- testTimeVariableBranches(ed, return.type = "bayesfactor")

# now, assume that our prior was heavily stacked in favor
# of a time-constant process:
tree.bf2 &lt;- testTimeVariableBranches(ed, prior_tv = 0.1,
                                     return.type = "bayesfactor")

# Plotting the branch-specific Bayes factors against each other:

plot.new()
par(mar=c(5,5,1,1))
plot.window(xlim=c(0, 260), ylim=c(0, 260))
points(tree.bf2$edge.length, tree.bf$edge.length, pch=21, bg='red',
       cex=1.5)
axis(1)
axis(2, las=1)
mtext(side=1, text="Bayes factor: prior_tv = 0.1", line=3, cex=1.5)
mtext(side = 2, text = "Bayes factor: uniform prior odds", line=3,
      cex=1.5)

# and you can see that if your prior favors CONSTANT RATE dynamics
# you will obtain much stronger Bayes factor support for time varying
# rates.
# IF the evidence is present in your data to support time variation.
# To be clear, the Bayes factors in this example were computed from the
#  same posterior probabilities: it is only the prior odds that differed.
</code></pre>

<hr>
<h2 id='traitDependentBAMM'>STRAPP: STructured Rate Permutations on Phylogenies</h2><span id='topic+traitDependentBAMM'></span><span id='topic+strapp'></span>

<h3>Description</h3>

<p>Given a <code>bammdata</code> object and a vector of (continuous)
trait data, assess whether the correlation between the trait and bamm
estimated speciation, extinction or net diversification rate is
significant using permutation. A set of posterior samples is randomly
drawn from the <code>bammdata</code> object. If the trait is continuous,
this function calculates the correlation coefficients between the
trait and tip rates (observed correlation), as well as that with
permuted rates for each posterior sample. In a one-tailed test for
positive correlations, the reported p-value is the proportion of the
posterior samples in which the observed correlation is larger than the
correlations calculated with permuted rates. In a two-tailed test, the
reported p-value is the proportion of the posterior samples in which
the null correlation is as extreme as the correlation observed. If the
trait is binary, the U statistic of the Mann-Whitney test is
calculated instead of correlation coefficients to assess whether there
is a significant difference in rate between the two trait states. For
categorical traits with more than two states, the Kruskal-Wallis rank
sum statistic is used.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>traitDependentBAMM(
  ephy,
  traits,
  reps,
  rate = "speciation",
  return.full = FALSE,
  method = "spearman",
  logrates = TRUE,
  two.tailed = TRUE,
  traitorder = NA,
  nthreads = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="traitDependentBAMM_+3A_ephy">ephy</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td></tr>
<tr><td><code id="traitDependentBAMM_+3A_traits">traits</code></td>
<td>
<p>A vector of trait data, with names corresponding to tips in
the <code>bammdata</code> object. It can be numeric or categorical.</p>
</td></tr>
<tr><td><code id="traitDependentBAMM_+3A_reps">reps</code></td>
<td>
<p>An integer specifying the number of permutations (i.e., the
number of posterior samples to randomly draw with replacement from the
<code>bammdata</code> object).</p>
</td></tr>
<tr><td><code id="traitDependentBAMM_+3A_rate">rate</code></td>
<td>
<p>A character string specifying which estimated rate from the
<code>bammdata</code> object to use for testing correlation, must be one of
'speciation', 'extinction', 'net diversification' or 'trait'. Defaults to
'speciation'. You can specify just the initial letter. Ignored for 
trait event data.</p>
</td></tr>
<tr><td><code id="traitDependentBAMM_+3A_return.full">return.full</code></td>
<td>
<p>A logical. If <code>TRUE</code>, the list of posterior
samples, the observed correlation for each posterior sample, and the
null distribution will be included in the returned object. Defaults to
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="traitDependentBAMM_+3A_method">method</code></td>
<td>
<p>A character string, must be one of 'spearman', 'pearson',
'mann-whitney', or 'kruskal'. Defaults to 'spearman'. You can specify
just the initial letter.</p>
</td></tr>
<tr><td><code id="traitDependentBAMM_+3A_logrates">logrates</code></td>
<td>
<p>A logical. If <code>TRUE</code> log-transform the rates before
analysis. Defaults to <code>TRUE</code>. This can only matter for the
pearson correlation.</p>
</td></tr>
<tr><td><code id="traitDependentBAMM_+3A_two.tailed">two.tailed</code></td>
<td>
<p>A logical, used for continuous trait data. If
<code>TRUE</code>, perform a two-tailed statistical test (i.e., if the null
distribution is symmetric, it is equivalent to doubling the p-value).
Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="traitDependentBAMM_+3A_traitorder">traitorder</code></td>
<td>
<p>A character string specifying the direction of
correlation for the alternative hypothesis. For continuous traits, it
must be either &quot;positive&quot; or &quot;negative&quot;; only the initial letter is
needed. For binary traits, it must be a string indicating states with
increasing rate under the alternative hypothesis, separated by comma
(e.g., 'A, B'). One-tailed test for categorical data with more than
two states is not supported.</p>
</td></tr>
<tr><td><code id="traitDependentBAMM_+3A_nthreads">nthreads</code></td>
<td>
<p>Number of threads to use for parallelization of the
function. The R package <code>parallel</code> must be loaded for
<code>nthreads &gt; 1</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Tip rates &ndash;trait, speciation, extinction, or net diversification
rates&ndash; are permuted in a way such that pairwise covariances in rates
between species are maintained. That is, tips with the same
<code>tipStates</code> still have the same rate after permutation. Posterior
samples are randomly selected with replacement from the
<code>bammdata</code> object, so <code>reps</code> could be smaller or larger than
the total number of samples in the object.
</p>
<p>This function expects that the bamm-data object and the trait data
have the same taxon set. It may be necessary to subset the trait data
and/or run <code><a href="#topic+subtreeBAMM">subtreeBAMM</a></code> on the <code>bamm-data</code> object in
order to meet this requirement.
</p>


<h3>Value</h3>

<p>A list with the following components:
</p>

<ul>
<li><p> estimate: A numeric value for continous trait data: the
average observed correlation between tip rates and the trait
across the posterior samples. For categorical traits, it is
a list showing the median species-specific rates for each
trait state.
</p>
</li>
<li><p> p.value: A numeric value. The probability that the observed
correlation is less than or equal to a sample from the null
distribution.
</p>
</li>
<li><p> method: A character string, as input.
</p>
</li>
<li><p> rate: A character string, as input.
</p>
</li>
<li><p> two.tailed: A logical, as input.
</p>
</li>
<li><p> gen: An integer vector, recording which posterior samples
were selected. Only present when <code>return.full</code> is
<code>TRUE</code>.
</p>
</li>
<li><p> obs.corr: A numeric vector, the observed correlation
coefficents for each posterior sample. Only present when
<code>return.full</code> is <code>TRUE</code>. For binary traits, centered
U statistics (U - n1* n2/2; where n1 and n2 are the number of
species in each state of the binary trait) is reported.
</p>
</li>
<li><p> null: A numeric vector. The null distribution of
correlation coefficients (or centered U statistics for binary
traits) from permutation. Only present when <code>return.full</code>
is <code>TRUE</code>.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Dan Rabosky, Huateng Huang
</p>


<h3>References</h3>

<p><a href="http://bamm-project.org/">http://bamm-project.org/</a>
</p>
<p>Rabosky, D. L. and Huang, H., 2015. A Robust Semi-Parametric Test for
Detecting Trait-Dependent Diversification. Systematic Biology 65:
181-193.
</p>
<p>Rabosky, D. L. 2014. Automatic detection of key innovations, rate
shifts, and diversity-dependence on phylogenetic trees. PLoS ONE
9:e89543.
</p>
<p>Rabosky, D. L., F. Santini, J. T. Eastman, S. A. Smith, B. L.
Sidlauskas, J. Chang, and M. E. Alfaro. 2013. Rates of speciation and
morphological evolution are correlated across the largest vertebrate
radiation. Nature Communications DOI: 10.1038/ncomms2958.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+subtreeBAMM">subtreeBAMM</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># using a small subset of the fish data set (300 taxa) in Rabosky et al.
# 2013. Nat. Com. paper
data(fishes, events.fishes)
xx &lt;- getEventData(phy = fishes, eventdata = events.fishes, 
      nsamples = 500, type = "diversification")
# traits.fishes is the trait -- body size
data(traits.fishes)
x &lt;- traitDependentBAMM(ephy = xx, traits = traits.fishes, reps = 1000,
                        return.full = TRUE, method = 's', logrates = TRUE,
                        two.tailed = TRUE)
</code></pre>

<hr>
<h2 id='transparentColor'>Define colors with transparency</h2><span id='topic+transparentColor'></span>

<h3>Description</h3>

<p>Converts a named color and opacity and returns the proper RGB
code.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>transparentColor(namedColor, alpha = 0.8)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="transparentColor_+3A_namedcolor">namedColor</code></td>
<td>
<p>A color name.</p>
</td></tr>
<tr><td><code id="transparentColor_+3A_alpha">alpha</code></td>
<td>
<p>A transparency value between 0 and 1, where 0 is fully
transparent.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is used internally by
<code><a href="#topic+plotRateThroughTime">plotRateThroughTime</a></code>.
</p>


<h3>Value</h3>

<p>Returns the transparent color in RGB format.
</p>


<h3>Author(s)</h3>

<p>Pascal Title
</p>

<hr>
<h2 id='writeEventData'>Write a <code>bammdata</code> object to disk</h2><span id='topic+writeEventData'></span>

<h3>Description</h3>

<p>Takes a <code>bammdata</code> object and re-writes it back into a
treefile and an event csv file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>writeEventData(ephy, outtreefile, outeventfile, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="writeEventData_+3A_ephy">ephy</code></td>
<td>
<p>A <code>bammdata</code> object.</p>
</td></tr>
<tr><td><code id="writeEventData_+3A_outtreefile">outtreefile</code></td>
<td>
<p>The file name for outputting the tree.</p>
</td></tr>
<tr><td><code id="writeEventData_+3A_outeventfile">outeventfile</code></td>
<td>
<p>The file name for outputting the event csv file.</p>
</td></tr>
<tr><td><code id="writeEventData_+3A_...">...</code></td>
<td>
<p>Additional arguments to pass to <code>write.csv</code>.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+subtreeBAMM">subtreeBAMM</a></code>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
