<!DOCTYPE html><html lang="en"><head><title>Help for package fitConic</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {fitConic}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#fitConic-package'>
<p>Fit Data to Any Conic Section</p></a></li>
<li><a href='#AtoG'><p>  A Set Of Functions To Convert Among Various Conic-Section-Defining Parameter Sets.</p></a></li>
<li><a href='#bootEllipse'>
<p>Simple, Medium-Quality Ellipse Fitting Function</p></a></li>
<li><a href='#bootHyperbola'>
<p>A Function to Attempt a Crude Fit of Data to a Hyperbola</p></a></li>
<li><a href='#createConic'>
<p>Create A Conic Section Dataset Based on Parameter Set</p></a></li>
<li><a href='#doWeights'>
<p>Function to Apply Weights to Data</p></a></li>
<li><a href='#fhyp'>
<p>Internal Functions to Perform Bootstrap Fitting Operations</p></a></li>
<li><a href='#fitConic'>
<p>Fit Data to A Conic Section Curve</p></a></li>
<li><a href='#fitParabola'>
<p>Fit Data to Parabola</p></a></li>
<li><a href='#JmatrixLMA'>
<p>Calculate a Jacobian Matrix</p></a></li>
<li><a href='#Residuals.ellipse'>
<p>Calculate Residual Error For Current Coefficients</p></a></li>
<li><a href='#Residuals.hyperbola'>
<p>Calculate Residual Error For Current Coefficients</p></a></li>
<li><a href='#rotateA'>
<p>Rotate Conic Section Equation Parameters Or A Dataset, With Respect To X-Y Axes.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Fit Data to Any Conic Section</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-08-28</td>
</tr>
<tr>
<td>Description:</td>
<td>Fit data to an ellipse, hyperbola, or parabola. Bootstrapping is available when needed. The conic curve can be rotated through an  arbitrary angle and the fit will still succeed. Helper functions are  provided to convert generator coefficients from one style to another, generate test data sets, rotate conic section parameters, and so on. References include Nikolai Chernov (2014) "Fitting ellipses, circles, and lines by  least squares" <a href="https://people.cas.uab.edu/~mosya/cl/">https://people.cas.uab.edu/~mosya/cl/</a>; A. W. Fitzgibbon, M. Pilu, R. B. Fisher (1999) "Direct Least Squares Fitting of Ellipses" IEEE Trans. PAMI,  Vol. 21, pages 476-48; N. Chernov, Q. Huang, and H. Ma (2014) "Fitting quadratic curves to data points", British Journal of Mathematics &amp; Computer Science, 4, 33-60; N. Chernov and H. Ma  (2011) "Least squares fitting of quadratic curves and surfaces", Computer Vision, Editor S. R. Yoshida, Nova Science Publishers, pp. 285-302.  </td>
</tr>
<tr>
<td>Imports:</td>
<td>pracma</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/LGPL-3">LGPL-3</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-08-28 14:36:40 UTC; cgw</td>
</tr>
<tr>
<td>Author:</td>
<td>Carl Witthoft [aut, cre],
  Jose Gama [ctb],
  Nikolai Chernov [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Carl Witthoft &lt;cellocgw@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-08-28 17:40:12 UTC</td>
</tr>
</table>
<hr>
<h2 id='fitConic-package'>
Fit Data to Any Conic Section
</h2><span id='topic+fitConic-package'></span>

<h3>Description</h3>

<p>Fit data to an ellipse, hyperbola, or parabola. Bootstrapping is available when needed. The conic curve can be rotated through an  arbitrary angle and the fit will still succeed. Helper functions are  provided to convert generator coefficients from one style to another, generate test data sets, rotate conic section parameters, and so on. References include Nikolai Chernov (2014) &quot;Fitting ellipses, circles, and lines by  least squares&quot; &lt;https://people.cas.uab.edu/~mosya/cl/&gt;; A. W. Fitzgibbon, M. Pilu, R. B. Fisher (1999) &quot;Direct Least Squares Fitting of Ellipses&quot; IEEE Trans. PAMI,  Vol. 21, pages 476-48; N. Chernov, Q. Huang, and H. Ma (2014) &quot;Fitting quadratic curves to data points&quot;, British Journal of Mathematics &amp; Computer Science, 4, 33-60; N. Chernov and H. Ma  (2011) &quot;Least squares fitting of quadratic curves and surfaces&quot;, Computer Vision, Editor S. R. Yoshida, Nova Science Publishers, pp. 285-302.  
</p>


<h3>Details</h3>

<p>The DESCRIPTION file:
</p>

<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> fitConic</td>
</tr>
<tr>
 <td style="text-align: left;">
Title: </td><td style="text-align: left;"> Fit Data to Any Conic Section</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.2.1</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2023-08-28</td>
</tr>
<tr>
 <td style="text-align: left;">
Authors@R: </td><td style="text-align: left;"> c(person(given = "Carl", family = "Witthoft", role = c("aut","cre"), email= "cellocgw@gmail.com") ,person(given="Jose", family= "Gama",  role = "ctb"), person(given="Nikolai", family = "Chernov", role = "ctb"))</td>
</tr>
<tr>
 <td style="text-align: left;">
Description: </td><td style="text-align: left;"> Fit data to an ellipse, hyperbola, or parabola. Bootstrapping is available when needed. The conic curve can be rotated through an  arbitrary angle and the fit will still succeed. Helper functions are  provided to convert generator coefficients from one style to another, generate test data sets, rotate conic section parameters, and so on. References include Nikolai Chernov (2014) "Fitting ellipses, circles, and lines by  least squares" &lt;https://people.cas.uab.edu/~mosya/cl/&gt;; A. W. Fitzgibbon, M. Pilu, R. B. Fisher (1999) "Direct Least Squares Fitting of Ellipses" IEEE Trans. PAMI,  Vol. 21, pages 476-48; N. Chernov, Q. Huang, and H. Ma (2014) "Fitting quadratic curves to data points", British Journal of Mathematics &amp; Computer Science, 4, 33-60; N. Chernov and H. Ma  (2011) "Least squares fitting of quadratic curves and surfaces", Computer Vision, Editor S. R. Yoshida, Nova Science Publishers, pp. 285-302.  </td>
</tr>
<tr>
 <td style="text-align: left;">
Imports: </td><td style="text-align: left;"> pracma</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> LGPL-3</td>
</tr>
<tr>
 <td style="text-align: left;">
Author: </td><td style="text-align: left;"> Carl Witthoft [aut, cre],
  Jose Gama [ctb],
  Nikolai Chernov [ctb]</td>
</tr>
<tr>
 <td style="text-align: left;">
Maintainer: </td><td style="text-align: left;"> Carl Witthoft &lt;cellocgw@gmail.com&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

 
<p>The main function is <code>fitConic</code> . 
</p>


<h3>Author(s)</h3>

<p>NA, based on code provided in the references and in <code><a href="conicfit.html#topic+fit.conicLMA">conicfit::fit.conicLMA()</a> </code> 
</p>
<p>Maintainer: NA
</p>


<h3>References</h3>

<p><a href="https://www.mathworks.com/matlabcentral/answers/80541">https://www.mathworks.com/matlabcentral/answers/80541</a> for the RANSAC-style search to fit rotated parabolas. 
<a href="https://math.stackexchange.com/questions/426150">https://math.stackexchange.com/questions/426150</a> for detailed ellipse parametric equations. 
<a href="https://math.stackexchange.com/questions/2800817">https://math.stackexchange.com/questions/2800817</a> for &quot;focus/directrix/eccentricity&quot; information
<a href="https://people.cas.uab.edu/~mosya/cl/">https://people.cas.uab.edu/~mosya/cl/</a> and the folks referred to there,
for fitConicLMA .
<a href="https://en.wikipedia.org/wiki/Ellipse">https://en.wikipedia.org/wiki/Ellipse</a> for several parameter conversion formulas
</p>
<p>A. W. Fitzgibbon, M. Pilu, R. B. Fisher, &quot;Direct Least Squares Fitting of Ellipses&quot;, IEEE Trans. PAMI, Vol. 21, pages 476-480 (1999)
</p>
<p>Halir R, Flusser J (1998) Proceedings of the 6th International Conference in Central Europe on Computer Graphics and Visualization,  Numerically stable direct least squares fitting of ellipses (WSCG, Plzen, Czech Republic), pp 125132.
</p>

<hr>
<h2 id='AtoG'>  A Set Of Functions To Convert Among Various Conic-Section-Defining Parameter Sets. 
</h2><span id='topic+AtoG'></span><span id='topic+GtoA'></span><span id='topic+parab3toA'></span><span id='topic+FEDtoA'></span>

<h3>Description</h3>

<p><code>AtoG</code> Convert from full quadratic &quot;ABCDEF&quot;  to focus, axis, angle &quot;hvab theta&quot; parameters.
<code>GtoA</code> Convert from &quot;hvab theta&quot; to &quot;ABCDEF&quot; parameters.
<code>parab3toA</code> Simple conversion from  a + bx + cx^2 to &quot;ABCDEF&quot; parameters.
<code>FEDtoA</code> Convert focus, eccentricity, and directrix to &quot;ABCDEF&quot; parameters. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AtoG(parA, tol = 1e-06)
GtoA(parG, conicType = c("e", "h"))
parab3toA(ADF, theta = 0)
FEDtoA(focus = c(0, 0), directrix = c(1, 0, 1), eccentricity = 0.5)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="AtoG_+3A_para">parA</code></td>
<td>
<p> The six coefficients in the quadratic Ax^2 + Bxy + Cy^2 +Dx + Ey +F = 0 
</p>
</td></tr>
<tr><td><code id="AtoG_+3A_tol">tol</code></td>
<td>
<p> A small value, used to check whether small coefficient values might be actually zero. See &quot;Details.&quot;  
</p>
</td></tr>
<tr><td><code id="AtoG_+3A_parg">parG</code></td>
<td>
<p> a five-element vector &quot;h,v,a,b,theta&quot; . See &quot;Details&quot; for the standard equation form for this. 
</p>
</td></tr>
<tr><td><code id="AtoG_+3A_conictype">conicType</code></td>
<td>

<p>Because the 'hvab' equation has a sign difference for ellipses vs. hyperbolas, it is necessary to indicate which kind of input is intended.  See &quot;Details.&quot; 
</p>
</td></tr>
<tr><td><code id="AtoG_+3A_focus">focus</code></td>
<td>
<p> location of the conic sections focus.
</p>
</td></tr>
<tr><td><code id="AtoG_+3A_directrix">directrix</code></td>
<td>
<p> the 3-element directrix. 
</p>
</td></tr>
<tr><td><code id="AtoG_+3A_eccentricity">eccentricity</code></td>
<td>
<p> the eccentricity of the conic section. 
</p>
</td></tr>
<tr><td><code id="AtoG_+3A_adf">ADF</code></td>
<td>
<p> The A,D,F coeffients in the standard quadratic. Thus, the x^2 term, the x term, and the constant term.
</p>
</td></tr>
<tr><td><code id="AtoG_+3A_theta">theta</code></td>
<td>
<p> An angle by which the entire parabola is to be rotated. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>tol</code> input for  <code>AtoG</code> checks two conditions. First, is B practically zero, in which case B is set to exactly zero, implying no rotation of the conic section. Second, is B^2 - 4*A*C almost zero, implying that the conic is probably a parabola, and conversion to 'hvab' form is not useful.
</p>
<p>The &quot;hvab&quot; form for describing an ellipse or a hyperbola looks like [Center(1:2), Axes(1:2)/2] angle A, to fill the equation 
</p>
<p>((x-h)cosA +(y-v)sinA)^2/a^2 + ((x-h)sinA-(y-v)cosA)^2/b^2 = 1 
The length of the axes are 2*a, 2*b .
</p>
<p>A discussion of the focus/directrix/eccentricity form of a conic section is rather lengthy and not presented here.  One short introduction can be found at 
<a href="https://en.wikipedia.org/wiki/Conic_section#Eccentricity,_focus_and_directrix">https://en.wikipedia.org/wiki/Conic_section#Eccentricity,_focus_and_directrix</a>
</p>


<h3>Value</h3>

<p>for <code>AtoG</code>, 
</p>
<table role = "presentation">
<tr><td><code>parG</code></td>
<td>
<p> c(h,v,a,b,theta)</p>
</td></tr>
<tr><td><code>exitCode</code></td>
<td>
<p>a value used in fitConic. 1,2, or 3 for ellipse, hyperbola, parabola</p>
</td></tr>
<tr><td><code>conicType</code></td>
<td>
<p>matching exitCode with a char &quot;e&quot;, &quot;h&quot;, or &quot;p&quot; </p>
</td></tr>
</table>
<p>for <code>GtoA</code>
</p>
<table role = "presentation">
<tr><td><code>parA</code></td>
<td>
<p>the ABCDEF coefficients of the general quadratic</p>
</td></tr>
<tr><td><code>exitCode</code></td>
<td>
<p> a value used in fitConic. 1,2, or 3 for ellipse, hyperbola, parabola</p>
</td></tr>
<tr><td><code>conicType</code></td>
<td>
<p>matching exitCode with a char &quot;e&quot;, &quot;h&quot;, or &quot;p&quot; </p>
</td></tr>
</table>
<p>for <code>FEDtoA</code>, the ABCDEF coefficients of the general quadratic
for <code>parab3toA</code>,
</p>
<table role = "presentation">
<tr><td><code>parA</code></td>
<td>
<p>the ABCDEF coefficients of the general quadratic</p>
</td></tr>
<tr><td><code>exitCode</code></td>
<td>
<p>always numeric 3,  a value used in fitConic</p>
</td></tr>
<tr><td><code>conicType</code></td>
<td>
<p>always char  &quot;p&quot;</p>
</td></tr>
</table>
<p>.
</p>

<hr>
<h2 id='bootEllipse'>
Simple, Medium-Quality Ellipse Fitting Function
</h2><span id='topic+bootEllipse'></span>

<h3>Description</h3>

<p>This function generates a half-decent fit to the source data. It is intended only for internal use, to bootstrap the higher-quality <code>fitConic</code> function. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bootEllipse(x, y = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bootEllipse_+3A_x">x</code></td>
<td>
<p> vector of x-values, or a Nx2 array of x and y values. In the latter   case, the input <code>y</code> is ignored. 
</p>
</td></tr>
<tr><td><code id="bootEllipse_+3A_y">y</code></td>
<td>
<p> vector of y-values. </p>
</td></tr>
<tr><td><code id="bootEllipse_+3A_...">...</code></td>
<td>
<p> possible other arguments to be passed to future upgrades
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This can be used as a Q&amp;D ellipse fitting algorithm, but is intended only for internal use by <code>fitConic</code>, providing that function with an initial estimate for the ellipse's defining parameter set. 
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>parA</code></td>
<td>
<p>6-element set with estimate of the &quot;ABCDEF&quot; coefficients for the general quadratic equation</p>
</td></tr>
<tr><td><code>centroid</code></td>
<td>
<p>estimate of the ellipse's centroid</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Carl Witthoft,  <a href="mailto:carl@witthoft.com">carl@witthoft.com</a>
</p>


<h3>References</h3>

<p>This is a revision of the function EllipseDirectFit in package conicfit by Jose Gama, with minor upgrades. 
Original MATLAB code by: Nikolai Chernov <a href="https://www.mathworks.com/matlabcentral/fileexchange/22684-ellipse-fit-direct-method">https://www.mathworks.com/matlabcentral/fileexchange/22684-ellipse-fit-direct-method</a>
A. W. Fitzgibbon, M. Pilu, R. B. Fisher, &quot;Direct Least Squares Fitting of Ellipses&quot;, IEEE Trans. PAMI, Vol. 21, pages 476-480 (1999)
Halir R, Flusser J (1998) Proceedings of the 6th International Conference in Central Europe on Computer Graphics and Visualization, 
Numerically stable direct least squares fitting of ellipses (WSCG, Plzen, Czech Republic), pp 125132.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitConic">fitConic</a></code> , <code><a href="#topic+createConic">createConic</a> </code>
</p>

<hr>
<h2 id='bootHyperbola'>
A Function to Attempt a Crude Fit of Data to a Hyperbola
</h2><span id='topic+bootHyperbola'></span>

<h3>Description</h3>

<p>This function is not intended for direct use. It attempts to generate an approximate fit of a data set to a hyperbola, returning a parameter set for use in intializing the main function <code>conicFit</code> . 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bootHyperbola(x, y = NULL, maxiter = 10000, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bootHyperbola_+3A_x">x</code></td>
<td>
<p> vector of x-values, or a Nx2 array of x and y values. In the latter case, the input <code>y</code> is ignored. 
</p>
</td></tr>
<tr><td><code id="bootHyperbola_+3A_y">y</code></td>
<td>
<p> vector of y-values. 
</p>
</td></tr>
<tr><td><code id="bootHyperbola_+3A_maxiter">maxiter</code></td>
<td>
<p> A 'safety' limiter on the number of iterations to try before giving up.
</p>
</td></tr>
<tr><td><code id="bootHyperbola_+3A_...">...</code></td>
<td>
<p> possible other arguments to be passed to future upgrades
</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>parA</code></td>
<td>
<p>the new 6-parameter set defining the non-rotated conic.</p>
</td></tr>
<tr><td><code>parAr</code></td>
<td>
<p>the new 6-parameter set defining the rotated conic.</p>
</td></tr>
<tr><td><code>theta</code></td>
<td>
<p>the angle of rotation between ParA and ParAr</p>
</td></tr>
<tr><td><code>fitdat</code></td>
<td>
<p>the information returned from <code><a href="stats.html#topic+optim">optim</a></code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Carl Witthoft,  <a href="mailto:carl@witthoft.com">carl@witthoft.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitConic">fitConic</a></code>
</p>

<hr>
<h2 id='createConic'>
Create A Conic Section Dataset Based on Parameter Set
</h2><span id='topic+createConic'></span>

<h3>Description</h3>

<p>Given a vector of x-values and a parameter set defining a conic section, produce an array of x- and y- values, optionally with noise added, for the specified conic section. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>createConic(x, param, conicType, ranFun = NULL, noise = 1, seedit = NULL, tol = 1e-06)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="createConic_+3A_x">x</code></td>
<td>

<p>Vector of (real) values 
</p>
</td></tr>
<tr><td><code id="createConic_+3A_param">param</code></td>
<td>

<p>Either a 6-value set representing the standard quadratic form  Ax^2 + Bxy + Cy^2 +Dx + Ey +F = 0  or a 5-value set representing the &quot;hvab,theta&quot; form ((x-h)cosA +(y-v)sinA)^2/a^2 + ((x-h)sinA-(y-v)cosA)^2/b^2 = 1 . In the latter case the value <code>conicType</code> is required. 
</p>
</td></tr>
<tr><td><code id="createConic_+3A_conictype">conicType</code></td>
<td>

<p>Either the character &quot;e&quot; for ellipse or &quot;h&quot; for hyperbola. Only required if the &quot;hvab,theta&quot; form is used in <code>param</code> . 
</p>
</td></tr>
<tr><td><code id="createConic_+3A_ranfun">ranFun</code></td>
<td>

<p>If random noise is to be added to the calculated y-values, provide a vectorized function which takes a single input (x). See Details. 
</p>
</td></tr>
<tr><td><code id="createConic_+3A_noise">noise</code></td>
<td>

<p>Optional argument to multiply the output of <code>ranFun</code> .
</p>
</td></tr>
<tr><td><code id="createConic_+3A_seedit">seedit</code></td>
<td>

<p>Optional argument to set a starting seed for <code>ranFun</code> to use. 
</p>
</td></tr>
<tr><td><code id="createConic_+3A_tol">tol</code></td>
<td>

<p>A (small) value used to decide whether various parameter terms are so small that they should be zero. This is used to facilitate distinguishing, e.g., parabolas from hyperbolas. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When supplied <code>ranFun</code> is used as follows.
y &lt;- y + ranFun(y)*noise  . Make sure any function supplied fits that form (no other input argument required; only a vector returned).
</p>


<h3>Value</h3>

<p>An N x 2 array of the x,y pairs.  Warning: since there are often two possible y-values for a given x-value (these being quadratic equations), the array does contain duplicate x-values. This may &quot;annoy&quot; some other packages' functions which don't allow that sort of repeated value. If this presents a problem, I'd recommend applying a very small amount of noise to the x-values in this output. 
</p>


<h3>Author(s)</h3>

<p>Carl Witthoft &lt;carl@witthoft.com&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# create noisy ellipse
parGr &lt;- c(-2.3,4.2,5,3,pi/4)
xe &lt;-seq(-8,9,by=.05)
elipGrn &lt;- createConic(xe, parGr, 'e',ranFun=rnorm, noise=0.25)
elipGr &lt;- createConic(xe,  parGr, 'e')
plot(elipGrn, pch='.',cex = 4, asp = TRUE)  #, xlim = c(-5,8), ylim = c(0,7))
lines(elipGr,col='green')
</code></pre>

<hr>
<h2 id='doWeights'>
Function to Apply Weights to Data
</h2><span id='topic+doWeights'></span>

<h3>Description</h3>

<p>This function applies an integer weight set to an array of (x,y) data points.  It normally is only called from <code>fitConic</code> but can be applied directly to a dataset if desired. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>doWeights(XY, weights)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="doWeights_+3A_xy">XY</code></td>
<td>

<p>A Nx2 array of data representing (x,y) pairs
</p>
</td></tr>
<tr><td><code id="doWeights_+3A_weights">weights</code></td>
<td>

<p>A vector of weights the same length as the number of rows in XY. At this time, only nonnegative integer values are allowed.  Doubles are rounded and negative values are set to zero. A zero weight will remove the matching data value from the dataset. 
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A new Nx2 array. Basically, each row in the input XY is repeated <code>weights[j]</code> times. 
..
</p>


<h3>Author(s)</h3>

<p>Carl Witthoft &lt;carl@witthoft.com&gt;
</p>

<hr>
<h2 id='fhyp'>
Internal Functions to Perform Bootstrap Fitting Operations
</h2><span id='topic+fhyp'></span><span id='topic+fhypopt'></span><span id='topic+costparab'></span><span id='topic+costparabxy'></span>

<h3>Description</h3>

<p>These functions are not intended for external use. 
<code>fhyp</code> and <code>fhypopt</code> support the parent function <code>bootHyperbola</code> by providing functions for <code>optimize</code> to use.
The functions <code>costparab</code> <code>costparabxy</code> similarly provide functions for <code>optim</code> to use inside the function <code>fitParabola</code> .
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhyp(xy, b3, Ang)
costparabxy(theta, xy)
costparab(theta, xy)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fhyp_+3A_xy">xy</code></td>
<td>

<p>A Nx2 array of data
</p>
</td></tr>
<tr><td><code id="fhyp_+3A_b3">b3</code></td>
<td>

<p>Three of the parameters describing a hyperbola. These three are the &quot;other parameters&quot; fed to <code>optim</code>
</p>
</td></tr>
<tr><td><code id="fhyp_+3A_ang">Ang</code></td>
<td>

<p>The initial angle of rotation, also optimized during the process.
</p>
</td></tr>
<tr><td><code id="fhyp_+3A_theta">theta</code></td>
<td>

<p>The angle of rotation of the parabola for this run of <code><a href="stats.html#topic+optimize">optimize</a></code>
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>various combinations of &quot;cost&quot; values, i.e. Figure of Merit, to determine optimal set of coefficients, along with datasets where necessary. 
..
</p>


<h3>Author(s)</h3>

<p>Carl Witthoft &lt;carl@witthoft.com&gt;
</p>

<hr>
<h2 id='fitConic'>
Fit Data to A Conic Section Curve 
</h2><span id='topic+fitConic'></span>

<h3>Description</h3>

<p>This function fits data to an ellipse, hyperbola, or parabola.
It can do so without any initial conditions, or can accept
initial parameter values when known.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fitConic(X, Y = NULL, parInit = NULL, conicType = c("e", "h", "p"),
weights = NULL, LambdaIni = 1, epsilonP = 1e-06, epsilonF = 1e-06, IterMAX = 20000)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fitConic_+3A_x">X</code></td>
<td>
<p> vector of x-values, or a Nx2 array of x and y values.
In the latter case, the input <code>y</code> is ignored. 
</p>
</td></tr>
<tr><td><code id="fitConic_+3A_y">Y</code></td>
<td>
<p> vector of y-values. 
</p>
</td></tr>
<tr><td><code id="fitConic_+3A_parinit">parInit</code></td>
<td>

<p>Optional. A vector either of six values representing an initial guess
at the &quot;ABCDEF&quot; coefficients of the quadratic, or five values
representing an initial guess at the &quot;hvab,theta&quot; coefficients.
In the latter case, a value of either &quot;e&quot; or &quot;h&quot; is required for
<code>conicType</code>.  See the Details section for more information. 
</p>
</td></tr>
<tr><td><code id="fitConic_+3A_conictype">conicType</code></td>
<td>

<p>If <code>parInit</code> is either NULL or the &quot;hvab,theta&quot; option,
<code>conicType</code> is required. Enter either &quot;e&quot;, &quot;h&quot;, or &quot;p&quot; for
fitting to ellipse, hyperbola, or parabola. 
</p>
</td></tr>
<tr><td><code id="fitConic_+3A_weights">weights</code></td>
<td>

<p>Optional vector of weights to apply to data. Must be same length as the input data. Only non-negative integer weights are allowed. See the Details section. 
</p>
</td></tr>
<tr><td><code id="fitConic_+3A_lambdaini">LambdaIni</code></td>
<td>

<p>A control parameter used in the fitting algorithm. Typically
there is no reason to change from the default value. 
</p>
</td></tr>
<tr><td><code id="fitConic_+3A_epsilonp">epsilonP</code></td>
<td>

<p>A tolerance value to determine whether convergence has occurred. 

</p>
</td></tr>
<tr><td><code id="fitConic_+3A_epsilonf">epsilonF</code></td>
<td>

<p>A tolerance parameter for determining when to adjust lambda
away from the input value <code>LambdaIni</code>.
</p>
</td></tr>
<tr><td><code id="fitConic_+3A_itermax">IterMAX</code></td>
<td>

<p>A &quot;safety&quot; value to avoid loop thrashing when convergence isn't taking place. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>ParInit</code>, when supplied is either a 6-value set representing the standard quadratic form  Ax^2 + Bxy + Cy^2 +Dx + Ey +F = 0  or a 5-value set representing the &quot;hvab,theta&quot; form ((x-h)cosA +(y-v)sinA)^2/a^2 + ((x-h)sinA-(y-v)cosA)^2/b^2 = 1 . In the latter case the value <code>conicType</code> is required, because ellipses and hyperbolas have a different sign for the y-term. 
In most cases, the bootstrapper tools work well enough to allow the main algorithm to fit to an ellipse or hyperbola. However, &quot;knowledge is power.&quot; If you have a good idea approximately what the <code>ParIni</code> values are,
entering them will help avoid convergence to the wrong local minimum. 
The algorithm branch which fits data to parabolas does not use or need
initialization, as it uses a RANSAC-type search to find 
the best rotation angle, and then does a simple quadratic polynomial fit. 
The <code>weights</code> input is restricted to nonnegative integers at this time. Doubles are rounded and negative values are set to zero. A zero weight will remove the matching data value from the dataset. 
</p>


<h3>Value</h3>

<p><code>parA </code>vector of the six &quot;ABCDEF&quot; coefficients
<code>RSS </code>'root sum square' figure of merit describing the relative fit quality
<code>iters </code>number of iterations at convergence
<code>exitCode </code>1 means ellipse, 2 means hyperbola, 3 means parabola.
If other values show up (possibly -1, 0, 4), most likely the
dataset led to a degenerate case such as a line fit. 
</p>



<h3>Author(s)</h3>

<p>Carl Witthoft &lt;carl@witthoft.com&gt;
</p>


<h3>References</h3>

<p><a href="https://people.cas.uab.edu/~mosya/cl/">https://people.cas.uab.edu/~mosya/cl/</a> for information
on the original &quot;LMA&quot; fitting algorithm. 
<a href="https://math.stackexchange.com/questions/426150">https://math.stackexchange.com/questions/426150</a> and 
<a href="https://math.stackexchange.com/questions/2800817">https://math.stackexchange.com/questions/2800817</a>
for various related equations concerning conic sections.
<a href="https://en.wikipedia.org/wiki/Ellipse">https://en.wikipedia.org/wiki/Ellipse</a> for several parameter
conversion formulas
</p>


<h3>See Also</h3>

  
<p><code><a href="#topic+createConic">createConic</a></code> , <code><a href="#topic+fitParabola">fitParabola</a> </code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
##-create a hyperbola, add noise
Ang =  0.42 #radians
xh &lt;- seq(-20,20,by=0.1)
parAxyh &lt;- c(0, 1, 0, -2, 4, -15 )
parAxyhr &lt;- rotateA(parAxyh, Ang)$parA
newxyr &lt;-createConic(xh,parAxyhr)
newxyrn &lt;- createConic(xh,parAxyhr,ranFun=rnorm, noise= 0.05)
plot(newxyr, t = 'l',asp=TRUE)
points(newxyrn, pch = '.', cex = 3)
# Now find the hyperbola for that dataset
hypfitr &lt;-fitConic(newxyrn, conicType = 'h')
hypdatr &lt;- createConic(xh, hypfitr$parA)
lines(hypdatr, col='red')
</code></pre>

<hr>
<h2 id='fitParabola'>
Fit Data to Parabola 
</h2><span id='topic+fitParabola'></span>

<h3>Description</h3>

<p>This function fits a data set to a parabola, including any rotation angle. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fitParabola(x, y = NULL, searchAngle = c(-pi/2, pi/2), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fitParabola_+3A_x">x</code></td>
<td>
<p> vector of x-values, or a Nx2 array of x and y values. In the latter case, the input <code>y</code> is ignored. 
</p>
</td></tr>
<tr><td><code id="fitParabola_+3A_y">y</code></td>
<td>
<p> vector of y-values. 
</p>
</td></tr>
<tr><td><code id="fitParabola_+3A_searchangle">searchAngle</code></td>
<td>

<p>Optional pair of angles, in radians, defining the limits of the search range to find the rotation angle of the parabola. Usually the default range <code>-pi/2:+pi/2</code> works acceptable. 
</p>
</td></tr>
<tr><td><code id="fitParabola_+3A_...">...</code></td>
<td>

<p>For possible future expansion to pass to additional features. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>fitParabola</code> starts by doing a RANSAC-style search to find the optimum rotation angle. Once that is chosen, the data are rotated by that angle and a simple polynomial fit to the (rotated) vertical parabola is done.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>vertex</code></td>
<td>
<p> calculated vertex of the parabola</p>
</td></tr>
<tr><td><code>theta</code></td>
<td>
<p>angle of rotation relative to a vertical parabola </p>
</td></tr>
<tr><td><code>parA</code></td>
<td>
<p> the &quot;ABCDEF&quot; coefficients of the fitted parabola</p>
</td></tr>
<tr><td><code>parQ</code></td>
<td>
<p> the coefficients of the derotated parabola's simple quadratic polynomial, highest power first</p>
</td></tr>
<tr><td><code>cost</code></td>
<td>
<p> final value of the &quot;cost&quot; parameter used for optimization</p>
</td></tr>
</table>


<h3>Note</h3>

<p>When the function <code>fitConic</code> is called with instructions to fit to a parabola, it passes the inputs to <code>fitParabola</code> and does nothing else. For parabolic data, then, either function will give the same result. 
</p>


<h3>Author(s)</h3>

<p>Carl Witthoft &lt;carl@witthoft.com&gt;
</p>


<h3>References</h3>

<p>Some of the code is based on <a href="https://www.mathworks.com/matlabcentral/answers/80541">https://www.mathworks.com/matlabcentral/answers/80541</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+createConic">createConic</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Create vertical parabola with some noise
parP &lt;-c(.5,0,0,2,-1,4)
xp &lt;- seq(-5,5,by=0.05)
 partest &lt;-createConic(xp,param = parP,ranFun = rnorm, noise = 1)
 plot(partest, pch= '.',asp=TRUE, cex=3)
 # rotate the data
 partestr &lt;-xyrot(partest,theta = -.35)
 points(partestr,col='green',pch='.',cex=3)
 # do the fit
 parfit &lt;-fitParabola(partestr)
 points(parfit$vertex,pch='X',col='blue') 
 parout &lt;- createConic(xp,parfit$parA)
 lines(parout,col='red')

</code></pre>

<hr>
<h2 id='JmatrixLMA'>
Calculate a Jacobian Matrix
</h2><span id='topic+JmatrixLMA'></span>

<h3>Description</h3>

<p>Calculate the Jacobian matrix with the original dataset and the
current version of fitted data.  This is not intended for 
external use. It is called from <code>fitConic</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>JmatrixLMA(XY, parA, XYproj)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="JmatrixLMA_+3A_xy">XY</code></td>
<td>

<p>The original input dataset
</p>
</td></tr>
<tr><td><code id="JmatrixLMA_+3A_para">parA</code></td>
<td>

<p>The current set of ABCDEF quadratic equation coefficients.
</p>
</td></tr>
<tr><td><code id="JmatrixLMA_+3A_xyproj">XYproj</code></td>
<td>

<p>The current calculated dataset based on the latest iteration
of the coefficient set. 
</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>Res</code></td>
<td>
<p> residuals based on the norm of XY - XYproj</p>
</td></tr>
<tr><td><code>J</code></td>
<td>
<p>matrix of values for each input data point corresponding
to the terms in the general quadratic Ax^2 + Bxy + Cy^2 +Dx + Ey +F </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Carl Witthoft &lt;carl@witthoft.com&gt;
</p>


<h3>References</h3>

<p>This is a copy of <code><a href="conicfit.html#topic+JmatrixLMA">JmatrixLMA</a> </code> with some
validation steps added. 
</p>

<hr>
<h2 id='Residuals.ellipse'>
Calculate Residual Error For Current Coefficients
</h2><span id='topic+Residuals.ellipse'></span>

<h3>Description</h3>

<p>This function is not intended for external use. It is called from <code>fitConic</code> when iterating to find the best-fit ellipse. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Residuals.ellipse(XY, parG)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Residuals.ellipse_+3A_xy">XY</code></td>
<td>

<p>The x,y dataset
</p>
</td></tr>
<tr><td><code id="Residuals.ellipse_+3A_parg">parG</code></td>
<td>

<p>The &quot;G-parameter&quot; set for the current iteration.
</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>RSS</code></td>
<td>
<p>Figure of merit, the 'norm' of the difference between the input XY data and the output &quot;XYproj&quot; data generated. </p>
</td></tr>
<tr><td><code>XYproj</code></td>
<td>
<p> Calculated dataset to be used in generating the  Jacobian matrix for the next iteration of <code>fitConic</code>  </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Carl Witthoft &lt;carl@witthoft.com&gt;
</p>


<h3>References</h3>

<p>This is a slightly modified (and debugged) version of <code><a href="conicfit.html#topic+Residuals.ellipse">Residuals.ellipse</a> </code>
</p>

<hr>
<h2 id='Residuals.hyperbola'>
Calculate Residual Error For Current Coefficients
</h2><span id='topic+Residuals.hyperbola'></span>

<h3>Description</h3>

<p>This function is not intended for external use. It is called from <code>fitConic</code> when iterating to find the best-fit hyperbola. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Residuals.hyperbola(XY, parG)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Residuals.hyperbola_+3A_xy">XY</code></td>
<td>

<p>The x,y dataset
</p>
</td></tr>
<tr><td><code id="Residuals.hyperbola_+3A_parg">parG</code></td>
<td>

<p>The &quot;G-parameter&quot; set for the current iteration.
</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>RSS</code></td>
<td>
<p>Figure of merit, the 'norm' of the difference between the input XY data and the output &quot;XYproj&quot; data generated. </p>
</td></tr>
<tr><td><code>XYproj</code></td>
<td>
<p> Calculated dataset to be used in generating the  Jacobian matrix for the next iteration of <code>fitConic</code>  </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Carl Witthoft &lt;carl@witthoft.com&gt;
</p>


<h3>References</h3>

<p>This is a slightly modified (and debugged) version of <code><a href="conicfit.html#topic+Residuals.hyperbola">Residuals.hyperbola</a> </code>
</p>

<hr>
<h2 id='rotateA'>
Rotate Conic Section Equation Parameters Or A Dataset, With Respect To X-Y Axes.
</h2><span id='topic+rotateA'></span><span id='topic+derotateA'></span><span id='topic+xyrot'></span>

<h3>Description</h3>

<p><code>rotateA</code> Takes as input &quot;parA,&quot; the 6 values of the general quadratic Ax^2 + Bxy + Cy^2 +Dx + Ey +F = 0 , and applies a rotation angle to the coefficient set. 
<code>derotateA</code> calculates the rotation angle required to change the conic section defined by 'parA' into one that is orthogonal to the cartesian axes. 
<code>xyrot</code> is a simple function to rotate the coordinate system by theta. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rotateA(parA, theta)
derotateA(parA, ACmin = 1e-05)
xyrot(x, y = NULL, theta)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rotateA_+3A_para">parA</code></td>
<td>

<p>the 6 values of the general quadratic Ax^2 + Bxy + Cy^2 +Dx + Ey +F = 0 
</p>
</td></tr>
<tr><td><code id="rotateA_+3A_theta">theta</code></td>
<td>

<p>the angle, in radians, to rotate the conic section. 
</p>
</td></tr>
<tr><td><code id="rotateA_+3A_acmin">ACmin</code></td>
<td>

<p>A tolerance parameter for deciding that the product of 
parameters A and C is actually zero (in which case the 
type of conic section is more likely a parabola or a degenerate case)
</p>
</td></tr>
<tr><td><code id="rotateA_+3A_x">x</code></td>
<td>

<p>Either a vector of x-coordinates or a Nx2 array of x and 
y coordinates, in which case the y-input is ignored
</p>
</td></tr>
<tr><td><code id="rotateA_+3A_y">y</code></td>
<td>

<p>A vector of y-coordinates.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>derotateA</code> uses the following standard formula to calculate the angle.
Derotate means to remove the xy term, i.e. force B = 0 . Some algebra shows that  cot(2theta) = (A-C)/B  and thus tan(2theta) = B/(A-C)
</p>
<p>For <code>xyrot</code>, the internal <code>xy.coords</code> is used. If you enter only a vector for x and nothing for y, this will feed the new vectors 1:N for x and x-input for y to the rotator, which is probably not useful. 
</p>


<h3>Value</h3>

<p>For <code>derotateA</code>, 
</p>
<table role = "presentation">
<tr><td><code>parA</code></td>
<td>
<p>the new 6-parameter set defining the derotated conic.</p>
</td></tr>
<tr><td><code>theta</code></td>
<td>
<p>the derived angle by which the parameter set was rotated</p>
</td></tr>
</table>
<p>For <code>rotateA</code>
</p>
<table role = "presentation">
<tr><td><code>parA</code></td>
<td>
<p>the new 6-parameter set defining the rotated conic.</p>
</td></tr>
<tr><td><code>theta</code></td>
<td>
<p>the angle by which the parameter set was rotated</p>
</td></tr>
</table>
<p>For <code>xyrot</code> a Nx2 array of the x,y coordinates of the rotated data set. 
</p>


<h3>Author(s)</h3>

<p>Carl Witthoft,  <a href="mailto:carl@witthoft.com">carl@witthoft.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+createConic">createConic</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># make an ellipse and derotate it
parGr &lt;- c(-2.3,4.2,5,3,pi/4)
xe &lt;-seq(-8,9,by=.05)
elipGr &lt;- createConic(xe,  parGr, 'e')
plot(elipGr, t= 'l',  asp = TRUE)
# convert to ABCDEF form
parAr &lt;- GtoA(parGr,'e')
elipAr &lt;- createConic(xe,parAr$parA) 
points(elipAr,pch='.',col='red')
# remove rotation angle
 parAd &lt;- derotateA(parAr$parA)
 # returns theta = pi/4, how much the ellipse had been rotated by
 elipAd &lt;-createConic(xe,parAd$parA)
lines(elipAd)
# rotate back
parAdr &lt;- rotateA(parAd$parA, parAd$theta)
elipAdr &lt;-createConic(xe,parAdr$parA)
lines(elipAdr,lty=3, lwd = 3, col='green')


</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
