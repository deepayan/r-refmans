<!DOCTYPE html><html lang="en"><head><title>Help for package SpaCOAP</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {SpaCOAP}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#chooseParams'><p>Select the parameters in COAP models</p></a></li>
<li><a href='#gendata_spacoap'><p>Generate simulated data</p></a></li>
<li><a href='#SpaCOAP'><p>Fit the SpaCOAP model</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>High-Dimensional Spatial Covariate-Augmented Overdispersed
Poisson Factor Model</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-05-26</td>
</tr>
<tr>
<td>Author:</td>
<td>Wei Liu [aut, cre],
  Qingzhi Zhong [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Wei Liu &lt;liuwei8@scu.edu.cn&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>A spatial covariate-augmented overdispersed Poisson factor model is proposed to perform efficient latent representation learning method for high-dimensional large-scale spatial count data with additional covariates.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/feiyoung/SpaCOAP">https://github.com/feiyoung/SpaCOAP</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/feiyoung/SpaCOAP/issues">https://github.com/feiyoung/SpaCOAP/issues</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>LaplacesDemon,stats, methods, Matrix, MASS, Rcpp (&ge; 1.0.10)</td>
</tr>
<tr>
<td>Depends:</td>
<td>irlba, R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-05-26 06:27:12 UTC; Liuxianju</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-05-27 14:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='chooseParams'>Select the parameters in COAP models</h2><span id='topic+chooseParams'></span>

<h3>Description</h3>

<p>Select the number of factors and the rank of coefficient matrix in the covariate-augmented overdispersed Poisson factor model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chooseParams(
  X_count,
  Adj_sp,
  H,
  Z = matrix(1, nrow(X_count), 1),
  offset = rep(0, nrow(X_count)),
  q_max = 15,
  r_max = 24,
  threshold = c(0.1, 0.01),
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="chooseParams_+3A_x_count">X_count</code></td>
<td>
<p>a count matrix, the observed count matrix with shape n-by-p.</p>
</td></tr>
<tr><td><code id="chooseParams_+3A_adj_sp">Adj_sp</code></td>
<td>
<p>a sparse matrix, the weighted adjacency matrix;</p>
</td></tr>
<tr><td><code id="chooseParams_+3A_h">H</code></td>
<td>
<p>a n-by-d matrix, the covariate matrix with low-rank regression coefficient matrix;</p>
</td></tr>
<tr><td><code id="chooseParams_+3A_z">Z</code></td>
<td>
<p>an optional matrix, the fixed-dimensional covariate matrix with control variables; default as a full-one column vector if there is no additional covariates.</p>
</td></tr>
<tr><td><code id="chooseParams_+3A_offset">offset</code></td>
<td>
<p>an optional vector, the offset for each unit; default as full-zero vector.</p>
</td></tr>
<tr><td><code id="chooseParams_+3A_q_max">q_max</code></td>
<td>
<p>an optional string, specify the upper bound for the number of factors; default as 15.</p>
</td></tr>
<tr><td><code id="chooseParams_+3A_r_max">r_max</code></td>
<td>
<p>an optional integer, specify the upper bound for the rank of the regression coefficient matrix; default as 24.</p>
</td></tr>
<tr><td><code id="chooseParams_+3A_threshold">threshold</code></td>
<td>
<p>an optional 2-dimensional positive vector, specify the the thresholds that filters the singular values of beta and B, respectively.</p>
</td></tr>
<tr><td><code id="chooseParams_+3A_verbose">verbose</code></td>
<td>
<p>a logical value, whether output the information in iteration.</p>
</td></tr>
<tr><td><code id="chooseParams_+3A_...">...</code></td>
<td>
<p>other arguments passed to the function <code><a href="#topic+SpaCOAP">SpaCOAP</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The threshold is to filter the singular values with  low signal, to assist the identification of underlying model structure.
</p>


<h3>Value</h3>

<p>return a named vector with names 'hr' and 'hq', the estimated rank and number of factors.
</p>


<h3>References</h3>

<p>None
</p>


<h3>See Also</h3>

<p><code><a href="#topic+SpaCOAP">SpaCOAP</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>width &lt;- 20; height &lt;- 15; p &lt;- 300
d &lt;- 20; k &lt;- 3; q &lt;- 6; r &lt;- 3
datlist &lt;- gendata_spacoap(width=width, height=height, p=p, d=d, k=k, q=q, rank0=r)
set.seed(1)
para_vec &lt;- chooseParams(X_count=datlist$X, Adj_sp=datlist$Adj_sp,
 H= datlist$H, Z = datlist$Z, r_max=6)
print(para_vec)
</code></pre>

<hr>
<h2 id='gendata_spacoap'>Generate simulated data</h2><span id='topic+gendata_spacoap'></span>

<h3>Description</h3>

<p>Generate simulated data from spaital covariate-augmented Poisson factor models
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gendata_spacoap(
  seed = 1,
  width = 20,
  height = 30,
  p = 500,
  d = 40,
  k = 3,
  q = 5,
  rank0 = 3,
  eta0 = 0.5,
  bandwidth = 1,
  rho = c(10, 1),
  sigma2_eps = 1,
  seed.beta = 1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gendata_spacoap_+3A_seed">seed</code></td>
<td>
<p>a postive integer, the random seed for reproducibility of data generation process.</p>
</td></tr>
<tr><td><code id="gendata_spacoap_+3A_width">width</code></td>
<td>
<p>a postive integer, specify the width of the spatial grid.</p>
</td></tr>
<tr><td><code id="gendata_spacoap_+3A_height">height</code></td>
<td>
<p>a postive integer, specify the height of the spatial grid.</p>
</td></tr>
<tr><td><code id="gendata_spacoap_+3A_p">p</code></td>
<td>
<p>a postive integer, specify the dimension of count variables.</p>
</td></tr>
<tr><td><code id="gendata_spacoap_+3A_d">d</code></td>
<td>
<p>a postive integer,  specify the dimension of covariate matrix with low-rank regression coefficient matrix.</p>
</td></tr>
<tr><td><code id="gendata_spacoap_+3A_k">k</code></td>
<td>
<p>a postive integer,  specify the dimension of  covariate matrix as control variables.</p>
</td></tr>
<tr><td><code id="gendata_spacoap_+3A_q">q</code></td>
<td>
<p>a postive integer,  specify the number of factors.</p>
</td></tr>
<tr><td><code id="gendata_spacoap_+3A_rank0">rank0</code></td>
<td>
<p>a postive integer, specify the rank of the coefficient matrix.</p>
</td></tr>
<tr><td><code id="gendata_spacoap_+3A_eta0">eta0</code></td>
<td>
<p>a real between 0 and 1, specify the spatial autocorrelation parameter.</p>
</td></tr>
<tr><td><code id="gendata_spacoap_+3A_bandwidth">bandwidth</code></td>
<td>
<p>a real positive value, specify the bandwidth in calculating the weighted adjacency matrix.</p>
</td></tr>
<tr><td><code id="gendata_spacoap_+3A_rho">rho</code></td>
<td>
<p>a numeric vector with length 2 and positive elements, specify the signal strength of loading matrix and regression coefficient, respectively.</p>
</td></tr>
<tr><td><code id="gendata_spacoap_+3A_sigma2_eps">sigma2_eps</code></td>
<td>
<p>a positive real, the variance of overdispersion error.</p>
</td></tr>
<tr><td><code id="gendata_spacoap_+3A_seed.beta">seed.beta</code></td>
<td>
<p>a postive integer, the random seed for reproducibility of data generation process by fixing the regression coefficient matrix beta.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>None
</p>


<h3>Value</h3>

<p>return a list including the following components:
</p>

<ul>
<li> <p><code>X</code> - the high-dimensional count matrix; 
</p>
</li>
<li> <p><code>Z</code> - the low-dimensional covariate matrix with control variables.
</p>
</li>
<li> <p><code>H</code> - the high-dimensional covariate matrix;
</p>
</li>
<li> <p><code>Adj_sp</code> - the weighted adjacence matrix;
</p>
</li>
<li> <p><code>alpha0</code> - the regression coefficient matrix corresponing to Z;
</p>
</li>
<li> <p><code>bbeta0</code> - the low-rank large regression coefficient matrix corresponing to H; 
</p>
</li>
<li> <p><code>B0</code> - the loading matrix;
</p>
</li>
<li> <p><code>F0</code> -  the laten factor matrix;
</p>
</li>
<li> <p><code>rank0</code> - the true rank of bbeta0;
</p>
</li>
<li> <p><code>q</code> - the true number of factors;
</p>
</li>
<li> <p><code>eta0</code> - spatial autocorrelation parameter;
</p>
</li>
<li> <p><code>pos</code> - spatial coordinates for each observation.
</p>
</li></ul>



<h3>References</h3>

<p>None
</p>


<h3>See Also</h3>

<p><code><a href="#topic+SpaCOAP">SpaCOAP</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>width &lt;- 20; height &lt;- 15; p &lt;- 100
d &lt;- 20; k &lt;- 3; q &lt;- 6; r &lt;- 3
datlist &lt;- gendata_spacoap(width=width, height=height, p=p, d=20, k=k, q=q, rank0=r)
str(datlist)
</code></pre>

<hr>
<h2 id='SpaCOAP'>Fit the SpaCOAP model</h2><span id='topic+SpaCOAP'></span>

<h3>Description</h3>

<p>Fit the spatial covariate-augmented overdispersed Poisson factor model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SpaCOAP(
  X_count,
  Adj_sp,
  H,
  Z = matrix(1, nrow(X_count), 1),
  offset = rep(0, nrow(X_count)),
  rank_use = 5,
  q = 15,
  epsELBO = 1e-08,
  maxIter = 30,
  verbose = TRUE,
  add_IC_inter = FALSE,
  seed = 1,
  algo = 1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="SpaCOAP_+3A_x_count">X_count</code></td>
<td>
<p>a count matrix, the observed count matrix with shape n-by-p.</p>
</td></tr>
<tr><td><code id="SpaCOAP_+3A_adj_sp">Adj_sp</code></td>
<td>
<p>a sparse matrix, the weighted adjacency matrix;</p>
</td></tr>
<tr><td><code id="SpaCOAP_+3A_h">H</code></td>
<td>
<p>a n-by-d matrix, the covariate matrix with low-rank regression coefficient matrix;</p>
</td></tr>
<tr><td><code id="SpaCOAP_+3A_z">Z</code></td>
<td>
<p>an optional matrix, the fixed-dimensional covariate matrix with control variables; default as a full-one column vector if there is no additional covariates.</p>
</td></tr>
<tr><td><code id="SpaCOAP_+3A_offset">offset</code></td>
<td>
<p>an optional vector, the offset for each unit; default as full-zero vector.</p>
</td></tr>
<tr><td><code id="SpaCOAP_+3A_rank_use">rank_use</code></td>
<td>
<p>an optional integer, specify the rank of the regression coefficient matrix; default as 5.</p>
</td></tr>
<tr><td><code id="SpaCOAP_+3A_q">q</code></td>
<td>
<p>an optional string, specify the number of factors; default as 15.</p>
</td></tr>
<tr><td><code id="SpaCOAP_+3A_epselbo">epsELBO</code></td>
<td>
<p>an optional positive vlaue, tolerance of relative variation rate of the envidence lower bound value, defualt as '1e-8'.</p>
</td></tr>
<tr><td><code id="SpaCOAP_+3A_maxiter">maxIter</code></td>
<td>
<p>the maximum iteration of the VEM algorithm. The default is 30.</p>
</td></tr>
<tr><td><code id="SpaCOAP_+3A_verbose">verbose</code></td>
<td>
<p>a logical value, whether output the information in iteration.</p>
</td></tr>
<tr><td><code id="SpaCOAP_+3A_add_ic_inter">add_IC_inter</code></td>
<td>
<p>a logical value, add the identifiability condition in iterative algorithm or add it after algorithm converges; default as FALSE.</p>
</td></tr>
<tr><td><code id="SpaCOAP_+3A_seed">seed</code></td>
<td>
<p>an integer, set the random seed in initialization, default as 1;</p>
</td></tr>
<tr><td><code id="SpaCOAP_+3A_algo">algo</code></td>
<td>
<p>an optional integer taking value 1 0r 2, select the algorithm used, default as 1, representing variational EM algorithm.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>None
</p>


<h3>Value</h3>

<p>return a list including the following components:
</p>

<ul>
<li> <p><code>F</code> - the predicted factor matrix; 
</p>
</li>
<li> <p><code>B</code> - the estimated loading matrix; 
</p>
</li>
<li> <p><code>bbeta</code> - the estimated low-rank large coefficient matrix; 
</p>
</li>
<li> <p><code>alpha0</code> - the estimated regression coefficient matrix corresponing to Z;
</p>
</li>
<li> <p><code>invLambda</code> - the inverse of the estimated variances of error;
</p>
</li>
<li> <p><code>eta</code> - the estimated spatial autocorrelation parameter;
</p>
</li>
<li> <p><code>S</code> - the approximated posterior covariance for each row of F;
</p>
</li>
<li> <p><code>ELBO</code> -  the ELBO value when algorithm stops;
</p>
</li>
<li> <p><code>ELBO_seq</code> - the sequence of ELBO values.
</p>
</li>
<li> <p><code>time_use</code> - the running time in model fitting of SpaCOAP;
</p>
</li></ul>



<h3>References</h3>

<p>Liu W, Zhong Q. High-dimensional covariate-augmented overdispersed poisson factor model. Biometrics. 2024 Jun;80(2):ujae031.
</p>


<h3>See Also</h3>

<p>None
</p>


<h3>Examples</h3>

<pre><code class='language-R'>width &lt;- 20; height &lt;- 15; p &lt;- 100
d &lt;- 20; k &lt;- 3; q &lt;- 6; r &lt;- 3
datlist &lt;- gendata_spacoap(width=width, height=height, p=p, d=20, k=k, q=q, rank0=r)
fitlist &lt;- SpaCOAP(X_count=datlist$X, Adj_sp = datlist$Adj_sp, 
H= datlist$H, Z = datlist$Z, q=6, rank_use=3)
str(fitlist)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
