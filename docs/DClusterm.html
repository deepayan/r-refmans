<!DOCTYPE html><html><head><title>Help for package DClusterm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {DClusterm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#brainNM'><p>Brain cancer in New Mexico, USA, 1973-1991.</p></a></li>
<li><a href='#CalcStatClusterGivenCenter'><p>Calls the function to obtain the cluster with the maximum log-likelihood ratio</p>
or minimum DIC of all the clusters with the same center and start and end dates.</a></li>
<li><a href='#CalcStatsAllClusters'><p>Obtains the clusters with the maximum log-likelihood ratio or minimum DIC</p>
for each center and start and end dates.</a></li>
<li><a href='#computeprob'><p>Computes the probability that a model parameter is &lt;=k from inla marginals</p></a></li>
<li><a href='#CreateGridDClusterm'><p>Creates grid over the study area.</p></a></li>
<li><a href='#DetectClustersModel'><p>Detects clusters and computes their significance.</p></a></li>
<li><a href='#get.allknclusters'><p>Extract indices of the areas in the clusters detected</p></a></li>
<li><a href='#get.stclusters'><p>Gets areas in a spatio-temporal cluster</p></a></li>
<li><a href='#glmAndZIP.iscluster'><p>Obtains the cluster with the maximum log-likelihood ratio or minimum DIC</p>
of all the clusters with the same center and start and end dates.</a></li>
<li><a href='#knbinary'><p>Constructs data frame with clusters in binary format.</p></a></li>
<li><a href='#mergeknclusters'><p>Merges clusters so that they are identifed as levels of a factor.</p></a></li>
<li><a href='#Navarre'><p>Brain cancer in males in Navarre, Spain, 1988-1994.</p></a></li>
<li><a href='#NY8'><p>Leukemia in an eight-county region of upstate New York, 1978-1982.</p></a></li>
<li><a href='#SelectStatsAllClustersNoOverlap'><p>Removes the overlapping clusters.</p></a></li>
<li><a href='#SetVbleCluster'><p>Constructs a variable that indicates the locations and times that pertain</p>
to a cluster.</a></li>
<li><a href='#slimknclusters'><p>Remove overlapping clusters</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Model-Based Detection of Disease Clusters</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0-1</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Date:</td>
<td>2020-02-21</td>
</tr>
<tr>
<td>Author:</td>
<td>Virgilio Gomez-Rubio, Paula Esther Moraga Serrano, Barry
    Rowlingson</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Virgilio Gomez-Rubio &lt;virgilio.gomez@uclm.es&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10), parallel, sp, spacetime, DCluster</td>
</tr>
<tr>
<td>Imports:</td>
<td>methods, xts, lme4</td>
</tr>
<tr>
<td>Suggests:</td>
<td>INLA, pscl, RColorBrewer, gridExtra, latticeExtra</td>
</tr>
<tr>
<td>Description:</td>
<td>Model-based methods for the detection of disease clusters
  using GLMs, GLMMs and zero-inflated models. These methods are described
  in 'V. Gómez-Rubio et al.' (2019) &lt;<a href="https://doi.org/10.18637%2Fjss.v090.i14">doi:10.18637/jss.v090.i14</a>&gt; and
  'V. Gómez-Rubio et al.' (2018) &lt;<a href="https://doi.org/10.1007%2F978-3-030-01584-8_1">doi:10.1007/978-3-030-01584-8_1</a>&gt;.</td>
</tr>
<tr>
<td>Additional_repositories:</td>
<td><a href="https://inla.r-inla-download.org/R/stable/">https://inla.r-inla-download.org/R/stable/</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>LazyData:</td>
<td>yes</td>
</tr>
<tr>
<td>Collate:</td>
<td>'Functions1.R' 'Functions2.R' 'glm.iscluster.R' 'knutils.R'</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.0.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-02-21 13:23:06 UTC; virgil</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-02-25 13:10:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='brainNM'>Brain cancer in New Mexico, USA, 1973-1991.</h2><span id='topic+brainNM'></span><span id='topic+brainst'></span><span id='topic+losalamos'></span><span id='topic+brainNM_clusters'></span><span id='topic+nm.m0'></span><span id='topic+nm.m1'></span><span id='topic+nm.cl0'></span><span id='topic+nm.cl1'></span>

<h3>Description</h3>

<p>This data set contains the number of incident brain cancer cases in the 32 counties of New Mexico, USA, and each year of the period 1973-1991,
and the location of Los Alamos National Laboratory.
In addition, the data set also includes for each county and year information about
the expected cases, the Standardized Morbidity Ratio (SMR),
the FIPS, ...
</p>
<p>File brainNM_clusters contains the results of running DetectClustersModel on a
null model ('nm.m0') and another one with covariates ('nm.m1'). The results are
in 'nm.cl0' and 'nm.cl1', respectively.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(brainNM)</code></pre>


<h3>Format</h3>

<p>brainst: A STFDF object containing the following information for each county and year:
</p>

<table>
<tr>
 <td style="text-align: right;">
Observed  </td><td style="text-align: left;">  Number of observed brain cancer cases </td>
</tr>
<tr>
 <td style="text-align: right;">
Expected  </td><td style="text-align: left;">  Number of expected brain cancer cases. Standardisation is done taking the whole time-period and not year-ly to keep any temporal trend. </td>
</tr>
<tr>
 <td style="text-align: right;">
SMR        </td><td style="text-align: left;"> Standardized Morbidity Ratio (observed/expected) </td>
</tr>
<tr>
 <td style="text-align: right;">
Year       </td><td style="text-align: left;"> Year </td>
</tr>
<tr>
 <td style="text-align: right;">
FIPS      </td><td style="text-align: left;">  FIPS Code </td>
</tr>
<tr>
 <td style="text-align: right;">
ID         </td><td style="text-align: left;">  ID (from 1 to 32)</td>
</tr>
<tr>
 <td style="text-align: right;">
IDLANL    </td><td style="text-align: left;">  Inverse distance to Los Alamos National Laboratory</td>
</tr>
<tr>
 <td style="text-align: right;">
IDLANLre   </td><td style="text-align: left;">  Re-scaled Inverse distance to Los Alamos National Laboratory 
(i.e., IDLANL/mean(IDLANL))</td>
</tr>
<tr>
 <td style="text-align: right;">
</td>
</tr>

</table>

<p>losalamos: A SpatialPoints object which contains the location (in long/lat) of Los Alamos National Laboratory obtained from the Wikipedia: -106.298333, 35.881667.
</p>


<h3>Source</h3>

 
<p>Data have been downlodad from the SatScan  website. Boundaries have been
obtained from the U.S. Census Bureau. Cibola and Valencia counties has been
merged together.
</p>


<h3>References</h3>

<p>SatScan (c). <a href="http://www.spatstat.org">http://www.spatstat.org</a>
</p>
<p>Kulldorff, M., W. F. Athas, E. J. Feurer, B. A. Miller, and C. R. Key (1998).
Evaluating cluster alarms: a space-time scan statistic and brain cancer in
los alamos, new mexico. American Journal of Public Health 88, 1377-1380.
</p>

<hr>
<h2 id='CalcStatClusterGivenCenter'>Calls the function to obtain the cluster with the maximum log-likelihood ratio
or minimum DIC of all the clusters with the same center and start and end dates.</h2><span id='topic+CalcStatClusterGivenCenter'></span>

<h3>Description</h3>

<p>This function orders the regions according to the distance to a given center
and selects the regions with distance to the center less than sqrt(rr).
Then it calls glmAndZIP.iscluster() to obtain the cluster with the maximum
log-likelihood ratio or minimum DIC of all the clusters with the same center
and start and end dates, and where the maximum fraction of the total
population inside the cluster is less than fractpop.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CalcStatClusterGivenCenter(
  point,
  stfdf,
  rr,
  minDateCluster,
  maxDateCluster,
  fractpop,
  model0,
  ClusterSizeContribution
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CalcStatClusterGivenCenter_+3A_point">point</code></td>
<td>
<p>vector with the coordinates of the center of the cluster.</p>
</td></tr>
<tr><td><code id="CalcStatClusterGivenCenter_+3A_stfdf">stfdf</code></td>
<td>
<p>spatio-temporal class object containing the data.</p>
</td></tr>
<tr><td><code id="CalcStatClusterGivenCenter_+3A_rr">rr</code></td>
<td>
<p>square of the maximum radius of the cluster.</p>
</td></tr>
<tr><td><code id="CalcStatClusterGivenCenter_+3A_mindatecluster">minDateCluster</code></td>
<td>
<p>start date of the cluster.</p>
</td></tr>
<tr><td><code id="CalcStatClusterGivenCenter_+3A_maxdatecluster">maxDateCluster</code></td>
<td>
<p>end date of the cluster.</p>
</td></tr>
<tr><td><code id="CalcStatClusterGivenCenter_+3A_fractpop">fractpop</code></td>
<td>
<p>maximum fraction of the total population inside the cluster.</p>
</td></tr>
<tr><td><code id="CalcStatClusterGivenCenter_+3A_model0">model0</code></td>
<td>
<p>Initial model (including covariates).</p>
</td></tr>
<tr><td><code id="CalcStatClusterGivenCenter_+3A_clustersizecontribution">ClusterSizeContribution</code></td>
<td>
<p>Variable used to check the fraction of the 
population at risk in the cluster
This can be &quot;glm&quot; for generalized linear models (<a href="stats.html#topic+glm">glm</a> stats),
&quot;glmer&quot; for generalized linear mixed model (<a href="lme4.html#topic+glmer">glmer</a> lme4),
&quot;zeroinfl&quot; for zero-inflated models (zeroinfl), or
&quot;inla&quot; for generalized linear, generalized linear mixed or zero-inflated models fitted with <code>inla</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector containing the coordinates of the center, the size,
the start and end dates, the log-likelihood ratio or DIC, the p-value and 
the risk of the cluster with the maximum log-likelihood ratio or minimum DIC.
</p>

<hr>
<h2 id='CalcStatsAllClusters'>Obtains the clusters with the maximum log-likelihood ratio or minimum DIC
for each center and start and end dates.</h2><span id='topic+CalcStatsAllClusters'></span>

<h3>Description</h3>

<p>This function explores all possible clusters changing their center and start
and end dates. For each center and time periods, it obtains the cluster with
the maximum log-likelihood ratio or minimum DIC so that the maximum fraction
of the total population inside the cluster is less than fractpop, 
and the maximum distance to the center is less than radius.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CalcStatsAllClusters(
  thegrid,
  CalcStatClusterGivenCenter,
  stfdf,
  rr,
  typeCluster,
  sortDates,
  idMinDateCluster,
  idMaxDateCluster,
  fractpop,
  model0,
  ClusterSizeContribution,
  numCPUS
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CalcStatsAllClusters_+3A_thegrid">thegrid</code></td>
<td>
<p>grid with the coordinates of the centers of the clusters
explored.</p>
</td></tr>
<tr><td><code id="CalcStatsAllClusters_+3A_calcstatclustergivencenter">CalcStatClusterGivenCenter</code></td>
<td>
<p>function to obtain the cluster with the
maximum log-likelihood ratio of all the clusters with the same center and
start and end dates</p>
</td></tr>
<tr><td><code id="CalcStatsAllClusters_+3A_stfdf">stfdf</code></td>
<td>
<p>spatio-temporal class object containing the data.</p>
</td></tr>
<tr><td><code id="CalcStatsAllClusters_+3A_rr">rr</code></td>
<td>
<p>square of the maximum radius of the cluster.</p>
</td></tr>
<tr><td><code id="CalcStatsAllClusters_+3A_typecluster">typeCluster</code></td>
<td>
<p>type of clusters to be detected. &quot;ST&quot; for spatio-temporal
clusters or &quot;S&quot; spatial clusters.</p>
</td></tr>
<tr><td><code id="CalcStatsAllClusters_+3A_sortdates">sortDates</code></td>
<td>
<p>sorted vector of the times where disease cases occurred.</p>
</td></tr>
<tr><td><code id="CalcStatsAllClusters_+3A_idmindatecluster">idMinDateCluster</code></td>
<td>
<p>index of the closest date to the start date of the
cluster in the vector sortDates</p>
</td></tr>
<tr><td><code id="CalcStatsAllClusters_+3A_idmaxdatecluster">idMaxDateCluster</code></td>
<td>
<p>index of the closest date to the end date of the
cluster in the vector sortDates</p>
</td></tr>
<tr><td><code id="CalcStatsAllClusters_+3A_fractpop">fractpop</code></td>
<td>
<p>maximum fraction of the total population inside the cluster.</p>
</td></tr>
<tr><td><code id="CalcStatsAllClusters_+3A_model0">model0</code></td>
<td>
<p>Initial model (including covariates).
This can be &quot;glm&quot; for generalized linear models (<a href="stats.html#topic+glm">glm</a> stats),
&quot;glmer&quot; for generalized linear mixed model (<a href="lme4.html#topic+glmer">glmer</a> lme4),
&quot;zeroinfl&quot; for zero-inflated models (zeroinfl), or
&quot;inla&quot; for generalized linear, generalized linear mixed or zero-inflated models fitted with <code>inla</code>.</p>
</td></tr>
<tr><td><code id="CalcStatsAllClusters_+3A_clustersizecontribution">ClusterSizeContribution</code></td>
<td>
<p>Variable used to check the fraction of the 
population at risk in the cluster</p>
</td></tr>
<tr><td><code id="CalcStatsAllClusters_+3A_numcpus">numCPUS</code></td>
<td>
<p>Number of cpus used when using parallel  to run the method.
If parallel is not used numCPUS is NULL.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data frame with information of the clusters with the maximum
log-likelihood ratio or minimum DIC for each center and start and end dates.
It contains the coordinates of the center, the size, the start and end dates,
the log-likelihood ratio or DIC, the p-value and the risk of each of the clusters.
</p>

<hr>
<h2 id='computeprob'>Computes the probability that a model parameter is &lt;=k from inla marginals</h2><span id='topic+computeprob'></span>

<h3>Description</h3>

<p>This function will be used to calculate the P(coeficient variable cluster &lt;=0)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>computeprob(func, k)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="computeprob_+3A_func">func</code></td>
<td>
<p>is the inla marginals of the model parameter</p>
</td></tr>
<tr><td><code id="computeprob_+3A_k">k</code></td>
<td>
<p>is the cutoff</p>
</td></tr>
</table>


<h3>Value</h3>

<p>probability model coefficient &lt;=k
</p>

<hr>
<h2 id='CreateGridDClusterm'>Creates grid over the study area.</h2><span id='topic+CreateGridDClusterm'></span>

<h3>Description</h3>

<p>If the argument thegrid of DetectClustersModel() is null, this function is
used to create a rectangular grid with a given step.
If step is NULL the step used is equal to 0.2*radius.
The grid contains the coordinates of the centers of the clusters explored.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateGridDClusterm(stfdf, radius, step)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CreateGridDClusterm_+3A_stfdf">stfdf</code></td>
<td>
<p>spatio-temporal class object containing the data.</p>
</td></tr>
<tr><td><code id="CreateGridDClusterm_+3A_radius">radius</code></td>
<td>
<p>maximum radius of the clusters.</p>
</td></tr>
<tr><td><code id="CreateGridDClusterm_+3A_step">step</code></td>
<td>
<p>step of the grid.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>two columns matrix where each row represents a point of the grid.
</p>

<hr>
<h2 id='DetectClustersModel'>Detects clusters and computes their significance.</h2><span id='topic+DetectClustersModel'></span>

<h3>Description</h3>

<p>Searches all possible clusters with start and end dates within minDateUser
and maxDateUser, so that the maximum fraction of the total population inside
the cluster is less than fractpop, and the maximum distance to the center is
less than radius.
The search can be done for spatial or spatio-temporal clusters.
The significance of the clusters is obtained with a Monte Carlo procedure
or based on the chi-square distribution (<a href="stats.html#topic+glm">glm</a>, <a href="lme4.html#topic+glmer">glmer</a> or zeroinfl models)
or DIC (<code>inla</code> models).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DetectClustersModel(
  stfdf,
  thegrid = NULL,
  radius = Inf,
  step = NULL,
  fractpop,
  alpha,
  typeCluster = "S",
  minDateUser = NULL,
  maxDateUser = NULL,
  R = NULL,
  model0,
  ClusterSizeContribution = "Population"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="DetectClustersModel_+3A_stfdf">stfdf</code></td>
<td>
<p>object containing the data.
If data is spatial, stfdf is a <a href="sp.html#topic+SpatialPolygonsDataFrame">SpatialPolygonsDataFrame</a> object from sp.
If data is spatio-temporal, stfdf is a <a href="spacetime.html#topic+STFDF">STFDF</a> object from spacetime.
The data contain a <a href="sp.html#topic+SpatialPolygons">SpatialPolygons</a> object with the coordinates,
and if applicable, a time object holding time information,
an endTime vector of class <a href="base.html#topic+POSIXct">POSIXct</a> holding end points of time intervals.
It also contain a data.frame with the Observed, Expected and potential covariates
in each location and time (if applicable). Note that the function DetectClustersModel
does not use the endTime vector. We can define endTime, for example,
as the vector of class <a href="base.html#topic+POSIXct">POSIXct</a> which contains the same dates as the ones
contained in the time object.</p>
</td></tr>
<tr><td><code id="DetectClustersModel_+3A_thegrid">thegrid</code></td>
<td>
<p>two-columns matrix containing the points of the grid to be
used. If it is null, a rectangular grid is built.</p>
</td></tr>
<tr><td><code id="DetectClustersModel_+3A_radius">radius</code></td>
<td>
<p>maximum radius of the clusters.</p>
</td></tr>
<tr><td><code id="DetectClustersModel_+3A_step">step</code></td>
<td>
<p>step of the thegrid built.</p>
</td></tr>
<tr><td><code id="DetectClustersModel_+3A_fractpop">fractpop</code></td>
<td>
<p>maximum fraction of the total population inside the cluster.</p>
</td></tr>
<tr><td><code id="DetectClustersModel_+3A_alpha">alpha</code></td>
<td>
<p>significance level used to determine the existence of clusters.</p>
</td></tr>
<tr><td><code id="DetectClustersModel_+3A_typecluster">typeCluster</code></td>
<td>
<p>type of clusters to be detected. &quot;ST&quot; for spatio-temporal
or &quot;S&quot; spatial clusters.</p>
</td></tr>
<tr><td><code id="DetectClustersModel_+3A_mindateuser">minDateUser</code></td>
<td>
<p>start date of the clusters.</p>
</td></tr>
<tr><td><code id="DetectClustersModel_+3A_maxdateuser">maxDateUser</code></td>
<td>
<p>end date of the clusters.</p>
</td></tr>
<tr><td><code id="DetectClustersModel_+3A_r">R</code></td>
<td>
<p>If the cluster's significance is calculated based on the chi-square
distribution or DIC, R is NULL. If the cluster's significance is calculated using a
Monte Carlo procedure, R represents the number replicates under the null hypothesis.</p>
</td></tr>
<tr><td><code id="DetectClustersModel_+3A_model0">model0</code></td>
<td>
<p>Initial model (including covariates).</p>
</td></tr>
<tr><td><code id="DetectClustersModel_+3A_clustersizecontribution">ClusterSizeContribution</code></td>
<td>
<p>Indicates the variable to be used as the population at risk in the cluster. This is the variable name to be used by 'fractpop' when checking the fraction of the population inside the cluster. The default column name is 'Population'.
This can be &quot;glm&quot; for generalized linear models (<a href="stats.html#topic+glm">glm</a> stats),
&quot;glmer&quot; for generalized linear mixed model (<a href="lme4.html#topic+glmer">glmer</a> lme4),
&quot;zeroinfl&quot; for zero-inflated models (zeroinfl), or
&quot;inla&quot; for generalized linear, generalized linear mixed or zero-inflated models fitted with <code>inla</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data frame with information of the detected clusters ordered by its
log-likelihood ratio value or DIC. Each row represents the information of
one of the clusters. It contains the coordinates of the center, the size,
the start and end dates, the log-likelihood ratio or DIC, the p-value,
the risk of the cluster, and a boolean indicating if it is a
cluster (TRUE in all cases).
It also returns alpha_bonferroni which is the level of significance
adjusted for multiple testing using Bonferroni correction.
Thus, rows that should be considered clusters are the ones with
p-value less than alpha_bonferroni.
</p>


<h3>References</h3>


<p>Bilancia M, Demarinis G (2014) Bayesian scanning of spatial disease rates
with the Integrated Nested Laplace Approximation (INLA). Statistical
Methods &amp; Applications 23(1): 71 - 94. <a href="http://dx.doi.org/10.1007/s10260-013-0241-8">http://dx.doi.org/10.1007/s10260-013-0241-8</a>
</p>
<p>Jung I (2009) A generalized linear models approach to spatial scan 
statistics for covariate adjustment. Statistics in Medicine 28(7): 1131 - 1143.
Gómez-Rubio V, Molitor J, Moraga P (2018) Fast Bayesian Classification 
for Disease Mapping and the Detection of Disease Clusters. In: Cameletti M.,
Finazzi F. (eds) Quantitative Methods in Environmental and Climate Research.
Springer, Cham
</p>
<p>Gómez-Rubio V, Moraga P, Molitor J, Rowlingson B (2019). &quot;DClusterm:
Model-Based Detection of Disease Clusters.&quot; _Journal of Statistical
Software_, *90*(14), 1-26. doi: 10.18637/jss.v090.i14 (URL:
https://doi.org/10.18637/jss.v090.i14).

</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DClusterm")
data("NY8")

NY8$Observed &lt;- round(NY8$Cases)
NY8$Expected  &lt;- NY8$POP8 * sum(NY8$Observed) / sum(NY8$POP8)

NY8$x &lt;- coordinates(NY8)[, 1]
NY8$y &lt;- coordinates(NY8)[, 2]


#Model to account for covariates
ny.m1 &lt;- glm(Observed ~ offset(log(Expected)) + PCTOWNHOME + PCTAGE65P +
PEXPOSURE, family = "poisson", data = NY8)

#Indices of areas that are possible cluster centres
idxcl &lt;- c(120, 12, 89, 139, 146)

#Cluster detection adjusting for covariates
ny.cl1 &lt;- DetectClustersModel(NY8,
thegrid = as.data.frame(NY8)[idxcl, c("x", "y")],
fractpop = 0.15, alpha = 0.05,
typeCluster = "S", R = NULL, model0 = ny.m1,
ClusterSizeContribution = "POP8")

#Display results
ny.cl1


</code></pre>

<hr>
<h2 id='get.allknclusters'>Extract indices of the areas in the clusters detected</h2><span id='topic+get.allknclusters'></span>

<h3>Description</h3>

<p>This function returns a categorical vector that identifies
to which cluster a given areas belongs. It is the empty string for 
areas not in a cluster.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.allknclusters(spdf, knresults)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get.allknclusters_+3A_spdf">spdf</code></td>
<td>
<p>Spatial object with data used in the detection of clusters.</p>
</td></tr>
<tr><td><code id="get.allknclusters_+3A_knresults">knresults</code></td>
<td>
<p>Table with the clusters detected.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A categorical vector with value the cluster to which area belongs.
It is the empty string for regions not in a cluster.
</p>

<hr>
<h2 id='get.stclusters'>Gets areas in a spatio-temporal cluster</h2><span id='topic+get.stclusters'></span>

<h3>Description</h3>

<p>This function is similar to get.knclusters but it also allows
for spatio-temporal clusters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.stclusters(stfdf, results)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get.stclusters_+3A_stfdf">stfdf</code></td>
<td>
<p>A sp or spacetime object with the information about the data.</p>
</td></tr>
<tr><td><code id="get.stclusters_+3A_results">results</code></td>
<td>
<p>Results from a call to <a href="#topic+DetectClustersModel">DetectClustersModel</a></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with as many elements as clusters in 'results'
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DClusterm")
library("RColorBrewer")

data("brainNM")
data("brainNM_clusters")

stcl &lt;- get.stclusters(brainst, nm.cl0)
#Get first cluster
brainst$CLUSTER &lt;- ""
brainst$CLUSTER[ stcl[[1]] ] &lt;- "CLUSTER"

#Plot cluster
stplot(brainst[, , "CLUSTER"], at = c(0, 0.5, 1.5), col = "#4D4D4D",
  col.regions = c("white", "gray"))

</code></pre>

<hr>
<h2 id='glmAndZIP.iscluster'>Obtains the cluster with the maximum log-likelihood ratio or minimum DIC
of all the clusters with the same center and start and end dates.</h2><span id='topic+glmAndZIP.iscluster'></span>

<h3>Description</h3>

<p>This function constructs all the clusters with start date equal to
minDateCluster, end date equal to maxDateCluster, and with center specified
by the first element of idxorder, so that the maximum fraction of the total
population inside the cluster is less than fractpop, and the maximum
distance to the center is less than radius.
For each one of these clusters, the log-likelihood ratio test statistic
for comparing the alternative model with the cluster versus the null model
of no clusters (if model is <a href="stats.html#topic+glm">glm</a>, <a href="lme4.html#topic+glmer">glmer</a> or zeroinfl),
or the DIC (if model is <code>inla</code>) is calculated.
The cluster with maximum value of the log-likelihood ratio or
minimum DIC is returned.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>glmAndZIP.iscluster(
  stfdf,
  idxorder,
  minDateCluster,
  maxDateCluster,
  fractpop,
  model0,
  ClusterSizeContribution
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="glmAndZIP.iscluster_+3A_stfdf">stfdf</code></td>
<td>
<p>a spatio-temporal class object containing the data.</p>
</td></tr>
<tr><td><code id="glmAndZIP.iscluster_+3A_idxorder">idxorder</code></td>
<td>
<p>a permutation of the regions according to their distance to
the current center.</p>
</td></tr>
<tr><td><code id="glmAndZIP.iscluster_+3A_mindatecluster">minDateCluster</code></td>
<td>
<p>start date of the cluster.</p>
</td></tr>
<tr><td><code id="glmAndZIP.iscluster_+3A_maxdatecluster">maxDateCluster</code></td>
<td>
<p>end date of the cluster.</p>
</td></tr>
<tr><td><code id="glmAndZIP.iscluster_+3A_fractpop">fractpop</code></td>
<td>
<p>maximum fraction of the total population inside the cluster.</p>
</td></tr>
<tr><td><code id="glmAndZIP.iscluster_+3A_model0">model0</code></td>
<td>
<p>Initial model (including covariates).</p>
</td></tr>
<tr><td><code id="glmAndZIP.iscluster_+3A_clustersizecontribution">ClusterSizeContribution</code></td>
<td>
<p>Variable used to check the fraction of the 
population at risk in the cluster
This can be &quot;glm&quot; for generalized linear models (<a href="stats.html#topic+glm">glm</a> stats),
&quot;glmer&quot; for generalized linear mixed model (<a href="lme4.html#topic+glmer">glmer</a> lme4),
&quot;zeroinfl&quot; for zero-inflated models (zeroinfl), or
&quot;inla&quot; for generalized linear, generalized linear mixed or zero-inflated models fitted with <code>inla</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector containing the size, the start and end dates,
the log-likelihood ratio or DIC, the p-value and the risk
of the cluster with the maximum log-likelihood ratio or minimum DIC.
</p>

<hr>
<h2 id='knbinary'>Constructs data frame with clusters in binary format.</h2><span id='topic+knbinary'></span>

<h3>Description</h3>

<p>This function constructs a data frame with number of columns equal to the
number of clusters. Each column is a binary representation of one of the
clusters. The position i of the column is equal to 1 if the polygon i is
in the cluster or 0 if it is not in the cluster.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>knbinary(datamap, knresults)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="knbinary_+3A_datamap">datamap</code></td>
<td>
<p>data of the <a href="sp.html#topic+SpatialPolygonsDataFrame">SpatialPolygonsDataFrame</a> with the polygons
of the map.</p>
</td></tr>
<tr><td><code id="knbinary_+3A_knresults">knresults</code></td>
<td>
<p>data frame with information of the detected clusters.
Each row represents the information of one of the clusters.
It contains the coordinates of the center, the size, the start
and end dates, the log-likelihood ratio, a boolean indicating if it is a
cluster (TRUE in all cases), and the p-value of the cluster.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data frame where the columns represent the clusters in binary format.
The position i of the column is equal to 1 if the polygon i is in the cluster
or 0 if it is not in the cluster.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DClusterm")
library("RColorBrewer")

data("NY8")
data("NY8_clusters")

stcl &lt;- knbinary(NY8, ny.cl1)
#Get first cluster
NY8$CLUSTER &lt;- stcl[, 1]

#Plot cluster
spplot(NY8, "CLUSTER", at = c(0, 0.5, 1.5), col = "#4D4D4D",
  col.regions = c("white", "gray"))

</code></pre>

<hr>
<h2 id='mergeknclusters'>Merges clusters so that they are identifed as levels of a factor.</h2><span id='topic+mergeknclusters'></span>

<h3>Description</h3>

<p>Given a data frame with clusters that do not overlap 
this function merges the clusters and construct a factor.
The levels of the factor are &quot;NCL&quot; if the polygon of the map is not
in any cluster, and &quot;CL&quot; if the polygon i is in cluster i.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mergeknclusters(datamap, knresults, indClustersPlot)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mergeknclusters_+3A_datamap">datamap</code></td>
<td>
<p>data of the <a href="sp.html#topic+SpatialPolygonsDataFrame">SpatialPolygonsDataFrame</a> with the polygons
of the map.</p>
</td></tr>
<tr><td><code id="mergeknclusters_+3A_knresults">knresults</code></td>
<td>
<p>Data frame with information of the detected clusters.
Each row represents the information of one of the clusters.
It contains the coordinates of the center, the size, the start
and end dates, the log-likelihood ratio, a boolean indicating if it is a
cluster (TRUE in all cases), and the p-value of the cluster.</p>
</td></tr>
<tr><td><code id="mergeknclusters_+3A_indclustersplot">indClustersPlot</code></td>
<td>
<p>rows of knresults that denote the clusters to be plotted.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>factor with levels that represent the clusters.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DClusterm")
library("RColorBrewer")

data("NY8")
data("NY8_clusters")

stcl &lt;- mergeknclusters(NY8, ny.cl1, 1:2)
#Get first cluster
NY8$CLUSTER &lt;- stcl

#Plot cluster
spplot(NY8, "CLUSTER", col.regions = c("white", "lightgray", "gray"))

</code></pre>

<hr>
<h2 id='Navarre'>Brain cancer in males in Navarre, Spain, 1988-1994.</h2><span id='topic+Navarre'></span><span id='topic+brainnav'></span><span id='topic+brainnavnb'></span>

<h3>Description</h3>

<p>This data set contains the male mortality due to brain cancer in the 40 basic health zones (BHZ) in Navarre over the period 1988-1994, and the neighborhood structure of the BHZ in Navarre.
In addition, the data set also includes information about
the location of the BHZ,
the expected cases, the Standardized Mortality Ratio (SMR),
relative risk estimates and 95% confidence intervals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(Navarre)</code></pre>


<h3>Format</h3>

<p>brainnav: A SpatialPolygonsDataFrame with 40 polygons representing the basic health zones (BHZ) in Navarre, and the following information about each BHZ:
</p>

<table>
<tr>
 <td style="text-align: right;">
ZBS        </td><td style="text-align: left;">  </td>
</tr>
<tr>
 <td style="text-align: right;"> Basic Health Zone Code
NAME       </td><td style="text-align: left;">  Name </td>
</tr>
<tr>
 <td style="text-align: right;">
OBSERVED   </td><td style="text-align: left;">  Number of observed brain cancer cases in males </td>
</tr>
<tr>
 <td style="text-align: right;">
EXPECTED   </td><td style="text-align: left;">  Number of expected brain cancer cases in males. They are computed using indirect age-standardization using Navarre as a standard population. </td>
</tr>
<tr>
 <td style="text-align: right;">
RISK       </td><td style="text-align: left;">   Relative Risk Estimates </td>
</tr>
<tr>
 <td style="text-align: right;">
RISKLL     </td><td style="text-align: left;">   Relative 95% confidence interval, lower limit </td>
</tr>
<tr>
 <td style="text-align: right;">
RISKUL     </td><td style="text-align: left;">   Relative 95% confidence interval, upper limit </td>
</tr>
<tr>
 <td style="text-align: right;">
SMR        </td><td style="text-align: left;"> Standardized Mortality Ratio (OBSERVED/EXPECTED) </td>
</tr>
<tr>
 <td style="text-align: right;">
x          </td><td style="text-align: left;"> x coordinate </td>
</tr>
<tr>
 <td style="text-align: right;">
y          </td><td style="text-align: left;"> y coordinate </td>
</tr>
<tr>
 <td style="text-align: right;">
</td>
</tr>

</table>

<p>brainnavnb: A neighbor (nb) object which contains the index numbers of the neighbors of each BHZ.
</p>


<h3>Source</h3>

 
<p>Data set obtained from Ugarte et al. (2004). Boundaries downloaded 
in shapefile format from <a href="http://idena.navarra.es">http://idena.navarra.es</a>. These have been thinned to reduce space use.
</p>


<h3>References</h3>

<p>Ugarte, M. D., B. Ibáñez, and A. F. Militino (2004). Testing for poisson zero a
inflation in disease mapping. Biometrical Journal 46 (5), 526-539.
</p>
<p>Ugarte, M. D., B. Ibáñez, and A. F. Militino (2006). Modelling risks in a
disease mapping. Statistical Methods in Medical Research 15, 21-35.
</p>

<hr>
<h2 id='NY8'>Leukemia in an eight-county region of upstate New York, 1978-1982.</h2><span id='topic+NY8'></span><span id='topic+NY8_clusters'></span><span id='topic+ny.m0'></span><span id='topic+ny.m1'></span><span id='topic+ny.cl0'></span><span id='topic+ny.cl1'></span><span id='topic+TCE'></span>

<h3>Description</h3>

<p>This data set provides the number of incident leukemia cases per census tract in an eight-county
region of upstate New York in the period 1978-1982. In addition, the data set also includes information about
the location of the census tracts,
the population in 1980,
the inverse of the distance to the nearest Trichloroethene (TCE) site,
the percentage of people aged 65 or more, and
the percentage of people who own their home.
</p>
<p>The dataset also provides the locations of the TCE sites.
</p>
<p>File NY8_clusters contains the results of running DetectClustersModel on a null
model ('ny.m0') and another one with covariates ('ny.m1'). The results are in
'ny.cl0' and 'ny.cl1', respectively.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(NY8)</code></pre>


<h3>Format</h3>

<p>A SpatialPolygonsDataFrame with 281 polygons representing the census tracts, and the following information about each census tract:
</p>

<table>
<tr>
 <td style="text-align: right;">
AREANAME    </td><td style="text-align: left;">  Name</td>
</tr>
<tr>
 <td style="text-align: right;">
AREAKEY     </td><td style="text-align: left;">  Identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
X           </td><td style="text-align: left;">  x coordinate </td>
</tr>
<tr>
 <td style="text-align: right;">
Y           </td><td style="text-align: left;">  y coordinate </td>
</tr>
<tr>
 <td style="text-align: right;">
POP8        </td><td style="text-align: left;">  Population in 1980</td>
</tr>
<tr>
 <td style="text-align: right;">
TRACTCAS    </td><td style="text-align: left;">  Number of leukemia cases rounded to 2 decimals </td>
</tr>
<tr>
 <td style="text-align: right;">
PROPCAS     </td><td style="text-align: left;">  Ratio of the number of leukemia cases to the population in 1980 </td>
</tr>
<tr>
 <td style="text-align: right;">
PCTOWNHOME  </td><td style="text-align: left;">  Proportion of people who own their home </td>
</tr>
<tr>
 <td style="text-align: right;">
PCTAGE65P   </td><td style="text-align: left;">  Proportion of people aged 65 or more </td>
</tr>
<tr>
 <td style="text-align: right;">
Z           </td><td style="text-align: left;">  </td>
</tr>
<tr>
 <td style="text-align: right;">
AVGIDIST    </td><td style="text-align: left;">  </td>
</tr>
<tr>
 <td style="text-align: right;">
PEXPOSURE   </td><td style="text-align: left;">  Inverse of the distance to the nearest TCE site </td>
</tr>
<tr>
 <td style="text-align: right;">
Cases       </td><td style="text-align: left;">  Number of leukemia cases </td>
</tr>
<tr>
 <td style="text-align: right;">
Xm          </td><td style="text-align: left;">  x coordinate (in meters)</td>
</tr>
<tr>
 <td style="text-align: right;">
Ym          </td><td style="text-align: left;">  y coordinates(in meters)</td>
</tr>
<tr>
 <td style="text-align: right;">
Xshift      </td><td style="text-align: left;">  Shifted Xm coordinate</td>
</tr>
<tr>
 <td style="text-align: right;">
Yshift      </td><td style="text-align: left;">  Shifted Ym coordinate</td>
</tr>
<tr>
 <td style="text-align: right;">
</td>
</tr>

</table>


<h3>Source</h3>

<p>Waller and Gotway (2004) and Bivand et al. (2008)</p>


<h3>References</h3>

<p>Bivand, R.S., E. J. Pebesma and V. Gómez-Rubio (2008). Applied Spatial Data
Analysis with R. Springer.
</p>
<p>Waller, L., B. Turnbull, L. Clark, and P. Nasca (1992). Chronic disease
surveillance and testing of clustering of disease and exposure: application
to leukemia incidence in tce-contamined dumpsites in upstate New York.
Environmetrics 3, 281-300
</p>
<p>Waller, L. A. and C. A. Gotway (2004). Applied Spatial Statistics for Public
Health Data. John Wiley &amp; Sons, Hoboken, New Jersey. <a href="http://web1.sph.emory.edu/users/lwaller/WGindex.htm">http://web1.sph.emory.edu/users/lwaller/WGindex.htm</a>
</p>

<hr>
<h2 id='SelectStatsAllClustersNoOverlap'>Removes the overlapping clusters.</h2><span id='topic+SelectStatsAllClustersNoOverlap'></span>

<h3>Description</h3>

<p>Function DetectClustersModel() detects duplicated clusters.
This function reduces the number of clusters by removing the overlapping
clusters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SelectStatsAllClustersNoOverlap(stfdf, statsAllClusters)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SelectStatsAllClustersNoOverlap_+3A_stfdf">stfdf</code></td>
<td>
<p>spatio-temporal class object containing the data.</p>
</td></tr>
<tr><td><code id="SelectStatsAllClustersNoOverlap_+3A_statsallclusters">statsAllClusters</code></td>
<td>
<p>data frame with information of the detected
clusters obtained with DetectClustersModel().</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data frame with the same information than statsAllClusters but only
for clusters that do not overlap.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DClusterm")
data("brainNM")
data("brainNM_clusters")

SelectStatsAllClustersNoOverlap(brainst, nm.cl1)
</code></pre>

<hr>
<h2 id='SetVbleCluster'>Constructs a variable that indicates the locations and times that pertain
to a cluster.</h2><span id='topic+SetVbleCluster'></span>

<h3>Description</h3>

<p>This function constructs a variable that indicates the locations and times
that pertain to a cluster. Each position of the variable is equal to 1 if
it corresponds to a location and time inside the cluster, and 0 otherwise.
This is one of the explanatory variables used in the glmAndZIP.iscluster
function to model the observed cases.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SetVbleCluster(stfdf, idTime, idSpace)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SetVbleCluster_+3A_stfdf">stfdf</code></td>
<td>
<p>spatio-temporal class object containing the data.</p>
</td></tr>
<tr><td><code id="SetVbleCluster_+3A_idtime">idTime</code></td>
<td>
<p>vector with the indexes of the stfdf object corresponding to
the time inside the cluster.</p>
</td></tr>
<tr><td><code id="SetVbleCluster_+3A_idspace">idSpace</code></td>
<td>
<p>vector with the indexes of the stfdf object corresponding to
the locations inside the cluster.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector with 1's or 0's that indicates the locations and times that
pertain to a cluster.
</p>

<hr>
<h2 id='slimknclusters'>Remove overlapping clusters</h2><span id='topic+slimknclusters'></span>

<h3>Description</h3>

<p>This function slims the number of clusters down.
The spatial scan statistic is known to detect duplicated
clusters. This function aims to reduce the number of clusters
by removing duplicated and overlapping clusters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>slimknclusters(d, knresults, minsize = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="slimknclusters_+3A_d">d</code></td>
<td>
<p>Data.frame with data used in the detection of clusters.</p>
</td></tr>
<tr><td><code id="slimknclusters_+3A_knresults">knresults</code></td>
<td>
<p>Object returned by function opgam() with the clusters detected.</p>
</td></tr>
<tr><td><code id="slimknclusters_+3A_minsize">minsize</code></td>
<td>
<p>Minimum size of cluster (default to 1).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A subset of knresults with non-overlaping clusters of at least
minsize size.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("brainNM_clusters")

nm.cl1.s &lt;- slimknclusters(brainst, nm.cl1)
nm.cl1.s
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
