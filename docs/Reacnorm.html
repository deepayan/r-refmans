<!DOCTYPE html><html lang="en"><head><title>Help for package Reacnorm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {Reacnorm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#dragon_continuous'><p>A simulated dataset on the reaction norms of dragons in a continuous environment</p></a></li>
<li><a href='#dragon_discrete'><p>A simulated dataset on the reaction norms of dragons at a discretised environmental gradient</p></a></li>
<li><a href='#rn_cs_gen'><p>Decompose the <code class="reqn">\mathbf{G}</code>-matrix from a character-state model</p></a></li>
<li><a href='#rn_gamma_env'><p>Compute the <code class="reqn">\gamma</code>-decomposition of additive genetic variance per environment</p></a></li>
<li><a href='#rn_gen_decomp'><p>Compute the decomposition of the additive genetic variance and their <code class="reqn">\gamma</code>- and <code class="reqn">\iota</code>-decomposition</p></a></li>
<li><a href='#rn_mean_by_env'><p>Compute the phenotypic mean on the observed scale</p></a></li>
<li><a href='#rn_phi_decomp'><p>Compute the <code class="reqn">\varphi</code>-decomposition of <code class="reqn">V_{\text{Plas}}</code></p></a></li>
<li><a href='#rn_pi_decomp'><p>Compute the <code class="reqn">\pi</code>-decomposition of <code class="reqn">V_{\text{Plas}}</code></p></a></li>
<li><a href='#rn_vgen'><p>Compute the total genetic variance <code class="reqn">V_{\text{Gen}}</code></p></a></li>
<li><a href='#rn_vp_env'><p>Compute the total phenotypic variance <code class="reqn">V_{\text{Tot}}</code></p></a></li>
<li><a href='#rn_vplas'><p>Compute the purely environmental plastic variance <code class="reqn">V_{\text{Plas}}</code></p></a></li>
<li><a href='#rn_vtot'><p>Compute the total phenotypic variance <code class="reqn">V_{\text{Tot}}</code></p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Perform a Partition of Variance of Reaction Norms</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2025-01-23</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/devillemereuil/reacnorm/issues">https://github.com/devillemereuil/reacnorm/issues</a></td>
</tr>
<tr>
<td>Description:</td>
<td>Partitions the phenotypic variance of a plastic trait, studied through its reaction norm. The variance partition distinguishes between the variance arising from the average shape of the reaction norms (V_Plas) and the (additive) genetic variance . The latter is itself separated into an environment-blind component (V_G/V_A) and the component arising from plasticity (V_GxE/V_AxE). The package also provides a way to further partition V_Plas into aspects (slope/curvature) of the shape of the average reaction norm (pi-decomposition) and partition V_Add (gamma-decomposition) and V_AxE (iota-decomposition) into the impact of genetic variation in the reaction norm parameters. Reference: de Villemereuil &amp; Chevin (2025) &lt;<a href="https://doi.org/10.32942%2FX2NC8B">doi:10.32942/X2NC8B</a>&gt;.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1.0)</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Imports:</td>
<td>cubature (&ge; 1.4), stringi, matrixStats</td>
</tr>
<tr>
<td>Suggests:</td>
<td>R.rsp</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>R.rsp</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-23 10:51:23 UTC; pierre</td>
</tr>
<tr>
<td>Author:</td>
<td>Pierre de Villemereuil [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Pierre de Villemereuil &lt;pierre.de-villemereuil@mnhn.fr&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-27 18:40:09 UTC</td>
</tr>
</table>
<hr>
<h2 id='dragon_continuous'>A simulated dataset on the reaction norms of dragons in a continuous environment</h2><span id='topic+dragon_continuous'></span>

<h3>Description</h3>

<p>A simulated dataset on the reaction norm of aggressiveness and thermal performance of dragons measured directly in a wild population, with heterogenous temperatures. Offspring from the same mothers are considered as half-sibs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dragon_continuous
</code></pre>


<h3>Format</h3>

<p>A data frame with 1000 rows and 5 variables:
</p>

<dl>
<dt>Individual</dt><dd><p>The individual on which the measures were performed at the different temperatures.</p>
</dd>
<dt>Family</dt><dd><p>The family to which each individual belongs to, i.e.\ which mother they are the offspring off. Offspring from the same mothers are considered as half-sibs.</p>
</dd>
<dt>Temp</dt><dd><p>The value of the recorded temperature at which the experiment was performed in the field. For convenience, the value was standardised so that the average is 0.</p>
</dd>
<dt>Aggressiveness</dt><dd><p>Aggressiveness of the dragon, measured using a very precise, continuous index, when presented with an armored knight to combat in the field.</p>
</dd>
<dt>Performance</dt><dd><p>Performance (sprint speed to rush toward a dummy princess) of each individual dragon evaluated directly on the field.</p>
</dd>
</dl>


<hr>
<h2 id='dragon_discrete'>A simulated dataset on the reaction norms of dragons at a discretised environmental gradient</h2><span id='topic+dragon_discrete'></span>

<h3>Description</h3>

<p>A simulated dataset on the reaction norm of aggressiveness and thermal performance of dragons according to a series of experimental measures at a discretised gradient of temperature
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dragon_discrete
</code></pre>


<h3>Format</h3>

<p>A data frame with 1000 rows and 5 variables:
</p>

<dl>
<dt>Name_Env</dt><dd><p>A character string for the &quot;name&quot; of the experimental temperature at which the experiment was performed.</p>
</dd>
<dt>Temp</dt><dd><p>The value of the experimental temperature at which the experiment was performed. For convenience, the value was standardised so that the average is 0.</p>
</dd>
<dt>Individual</dt><dd><p>The individual on which the measures were performed at the different temperatures.</p>
</dd>
<dt>Aggressiveness</dt><dd><p>Aggressiveness of the dragon, measured using a very precise, continuous index, when presented with an armored knight to combat.</p>
</dd>
<dt>Performance</dt><dd><p>Performance (sprint speed to rush toward a dummy princess) of each individual dragon evaluated at each of the experimental temperatures.</p>
</dd>
</dl>


<hr>
<h2 id='rn_cs_gen'>Decompose the <code class="reqn">\mathbf{G}</code>-matrix from a character-state model</h2><span id='topic+rn_cs_gen'></span>

<h3>Description</h3>

<p>This function takes the <code class="reqn">\mathbf{G}</code>-matrix estimated from a character-state model and returns the values for <code class="reqn">V_{\text{Add}}</code>,  <code class="reqn">V_{\text{A}}</code>, <code class="reqn">V_{\text{A}\times\text{E}}</code> and <code class="reqn">n_{\text{eff}}</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rn_cs_gen(G_cs, wt = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rn_cs_gen_+3A_g_cs">G_cs</code></td>
<td>
<p>(Additive) genetic variance-covariance matrix estimated from a character-state model (i.e. where environments are treated as a categorical variable). (numerical matrix)</p>
</td></tr>
<tr><td><code id="rn_cs_gen_+3A_wt">wt</code></td>
<td>
<p>Weights to apply to the different environments, e.g. reflecting their frequencies in the wild. The weights must non-negative, and at least one must be non-zero. The vector <code>wt</code> must be the same length as the rows and columns of <code>G_cs</code>. By default, no weighting is applied. (numeric)</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code class="reqn">V_{\text{Add}}</code> is the (weighted) average of the diagonal elements of <code>G_cs</code>, <code class="reqn">V_{\text{A}}</code> is the (weighted) average of all the elements of <code>G_cs</code> and <code class="reqn">V_{\text{A}\times\text{E}}</code> is the difference between <code class="reqn">V_{\text{Add}}</code> and  <code class="reqn">V_{\text{A}}</code>. Finally, the efficient number of dimensions <code class="reqn">n_{\text{eff}}</code> is the ratio of the sum of the eigen values of <code>G_cs</code> over its maximum eigen  value. Note that <code class="reqn">n_{\text{eff}}</code> is returned for information, but is expected to be biased in practice due to an over-estimation of the maximum eigen value.
</p>


<h3>Value</h3>

<p>This function yields <code class="reqn">V_{\text{Add}}</code>,  <code class="reqn">V_{\text{A}}</code>,  <code class="reqn">V_{\text{A}\times\text{E}}</code> and <code class="reqn">n_{\text{eff}}</code> as a one-row data.frame (data.frame, all numeric).</p>


<h3>Author(s)</h3>

<p>Pierre de Villemereuil
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rn_vgen">rn_vgen</a></code>, <code><a href="#topic+rn_gen_decomp">rn_gen_decomp</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>G &lt;- diag(10)

rn_cs_gen(G_cs = G)
</code></pre>

<hr>
<h2 id='rn_gamma_env'>Compute the <code class="reqn">\gamma</code>-decomposition of additive genetic variance per environment</h2><span id='topic+rn_gamma_env'></span>

<h3>Description</h3>

<p>This function computes the <code class="reqn">\gamma</code>-decomposition of the additive genetic variance for each environment.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rn_gamma_env(theta, G_theta, env = NULL, shape = NULL, X = NULL,
             fixed = NULL, width = 10)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rn_gamma_env_+3A_theta">theta</code></td>
<td>
<p>Average parameters of the shape function. It must be a named vector, with the names corresponding to the parameters in the <code>shape</code> expression. (numeric)</p>
</td></tr>
<tr><td><code id="rn_gamma_env_+3A_g_theta">G_theta</code></td>
<td>
<p>Genetic variance-covariance matrix of the parameters. It can be of lesser dimensions than <code>theta</code>, see <code>fixed</code> parameter. (numerical matrix)</p>
</td></tr>
<tr><td><code id="rn_gamma_env_+3A_env">env</code></td>
<td>
<p>Vector of environmental values (numeric).</p>
</td></tr>
<tr><td><code id="rn_gamma_env_+3A_shape">shape</code></td>
<td>
<p>Expression providing the shape of the reaction where <code>x</code> is the environment. For example: <code>expression(a + b * x + c * x^2)</code>.</p>
</td></tr>
<tr><td><code id="rn_gamma_env_+3A_x">X</code></td>
<td>
<p>If the model used was linear in the parameters, the design matrix X of the model (numeric, incompatible with the arguments <code>env</code> and <code>shape</code>).</p>
</td></tr>
<tr><td><code id="rn_gamma_env_+3A_fixed">fixed</code></td>
<td>
<p>If some parameters of <code>shape</code>, included in <code>theta</code> are not included in the <code>G_theta</code> matrix, then those dimensions are considered as genetically &quot;fixed&quot;. Hence, <code>fixed</code> should contain a vector of the <b>index</b> of those parameters. Otherwise (if all parameters vary genetically), and by default, fixed should be set as NA. (integer)</p>
</td></tr>
<tr><td><code id="rn_gamma_env_+3A_width">width</code></td>
<td>
<p>Parameter for the integral computation. The integral is evaluated from <code>mu</code> - <code>width * sqrt(var)</code> to <code>mu</code> + <code>width * sqrt(var)</code>. The default value is 10, which should be sensible for most models. (numeric)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function provides the <code class="reqn">\gamma</code>-decomposition (according to each parameter of the reaction norm and their covariances) of the additive genetic variance in each environment.
</p>
<p>It is very important that the parameters are in the same order in the argument of the <code>shape</code> function, in <code>theta</code> and in <code>G_theta</code>.
</p>
<p>If <code>X</code> is provided the second column is returned as the value for the &quot;environment&quot; (based on the assumption that a polynomial function was used).
</p>


<h3>Value</h3>

<p>This function yields a data.frame containing the input values for the environment, the additive genetic variance in each of them, with its corresponding <code class="reqn">\gamma</code>-decomposition (data.frame, all numeric).</p>


<h3>Author(s)</h3>

<p>Pierre de Villemereuil
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rn_vgen">rn_vgen</a></code>, <code><a href="#topic+rn_gen_decomp">rn_gen_decomp</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Some environment vector
vec_env &lt;- seq(-2, 2)

# Shape function
expr &lt;- expression(
     cmax * exp(
         - exp(rho * (x - xopt) - 6) -
             sigmagaus * (x - xopt)^2
     ))

# Theta
theta &lt;- c(cmax = 1, xopt = 0.9, rho = 8, sigmagaus = 0.4)
# G, only for cmax and xopt
G     &lt;- matrix(c(0.1,      0.01,
                  0.01,     0.05),
                ncol = 2)

# Computing V_gen
rn_gamma_env(env     = vec_env,
              shape   = expr,
              theta   = theta,
              G_theta = G,
              fixed   = c(3, 4))
# Note that fixed is set for the third and forth parameters than are not in G

# If a polynomial was used, it is possible to use the linear modeling rather having
# to compute integrals
theta &lt;- c(a = 1.5, b = 0.5, c = -0.5)
X     &lt;- cbind(1, vec_env, (vec_env - mean(vec_env))^2)
G     &lt;- 0.1 * diag(3)
rn_gamma_env(theta   = theta,
             G_theta = G,
             X       = X)
</code></pre>

<hr>
<h2 id='rn_gen_decomp'>Compute the decomposition of the additive genetic variance and their <code class="reqn">\gamma</code>- and <code class="reqn">\iota</code>-decomposition</h2><span id='topic+rn_gen_decomp'></span>

<h3>Description</h3>

<p>This function calculates the total additive genetic variance of the reaction norm (<code class="reqn">V_{\text{Add}}</code>, and its <code class="reqn">\gamma</code>-decomposition), the marginal additive genetic variance of the trait (<code class="reqn">V_{\text{A}}</code>) and the additive genetic variance of plasticity (<code class="reqn">V_{\text{A}\times\text{E}}</code>, and its <code class="reqn">\iota</code>-decomposition).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rn_gen_decomp(theta, G_theta, env = NULL, shape = NULL, X = NULL, fixed = NULL,
              wt_env = NULL, compute_gamma = TRUE, compute_iota  = TRUE,
              add_vars = NULL, width = 10)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rn_gen_decomp_+3A_theta">theta</code></td>
<td>
<p>Average parameters of the shape function. It must be a named vector, with the names corresponding to the parameters in the <code>shape</code> expression. (numeric)</p>
</td></tr>
<tr><td><code id="rn_gen_decomp_+3A_g_theta">G_theta</code></td>
<td>
<p>Genetic variance-covariance matrix of the parameters. It can be of lesser dimensions than <code>theta</code>, see <code>fixed</code> parameter. (numerical matrix)</p>
</td></tr>
<tr><td><code id="rn_gen_decomp_+3A_env">env</code></td>
<td>
<p>Vector of environmental values (numeric).</p>
</td></tr>
<tr><td><code id="rn_gen_decomp_+3A_shape">shape</code></td>
<td>
<p>Expression providing the shape of the reaction where <code>x</code> is the environment. For example: <code>expression(a + b * x + c * x^2)</code>.</p>
</td></tr>
<tr><td><code id="rn_gen_decomp_+3A_x">X</code></td>
<td>
<p>If the model used was linear in the parameters, the design matrix X of the model (numeric, incompatible with the arguments <code>env</code> and <code>shape</code>).</p>
</td></tr>
<tr><td><code id="rn_gen_decomp_+3A_fixed">fixed</code></td>
<td>
<p>If some parameters of <code>shape</code>, included in <code>theta</code> are not included in the <code>G_theta</code> matrix, then those dimensions are considered as genetically &quot;fixed&quot;. Hence, <code>fixed</code> should contain a vector of the <b>index</b> of those parameters. Otherwise (if all parameters vary genetically), and by default, fixed should be set as NA. (integer)</p>
</td></tr>
<tr><td><code id="rn_gen_decomp_+3A_wt_env">wt_env</code></td>
<td>
<p>Weights to apply to the <code>env</code> vector values, providing an information regarding their relative probability in the biological context. The weights must non-negative, and at least one must non-zero. The vector <code>wt_env</code> must be the same length as <code>env</code>. By default, no weighting is applied. (numeric)</p>
</td></tr>
<tr><td><code id="rn_gen_decomp_+3A_compute_gamma">compute_gamma</code></td>
<td>
<p>Should the <code class="reqn">\gamma</code>-decomposition be performed? Default is TRUE. (boolean)</p>
</td></tr>
<tr><td><code id="rn_gen_decomp_+3A_compute_iota">compute_iota</code></td>
<td>
<p>Should the <code class="reqn">\iota</code>-decomposition be performed? Default is TRUE. (boolean)</p>
</td></tr>
<tr><td><code id="rn_gen_decomp_+3A_add_vars">add_vars</code></td>
<td>
<p>Optional, provide additive genetic variances <code class="reqn">V_{\text{Add}}</code>,  <code class="reqn">V_{\text{A}}</code> and <code class="reqn">V_{\text{A}\times\text{E}}</code> (in that exact order!) computed from another model, e.g. a character-state model. These values will be used to scale the <code class="reqn">\gamma</code>'s and <code class="reqn">\iota</code>'s and be returned by the function for the respective additive genetic variances. (numeric vector of length 3)</p>
</td></tr>
<tr><td><code id="rn_gen_decomp_+3A_width">width</code></td>
<td>
<p>Parameter for the integral computation. The integral is evaluated from <code>mu</code> - <code>width * sqrt(var)</code> to <code>mu</code> + <code>width * sqrt(var)</code>. The default value is 10, which should be sensible for most models. (numeric)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The variance <code class="reqn">V_{\text{Add}}</code> is the total additive genetic variance in the reaction norm. It can be decomposed according to each of the parameters in <code>G_theta</code> (and their pairwise covariance), using the <code class="reqn">\gamma</code>-decomposition, if the <code>compute_gamma</code> is activated. It can also be decomposed into the marginal additive genetic variance of the trait (<code class="reqn">V_{\text{A}}</code>, the additive genetic variance of the trait that would be computed if plasticity were ignored), and the additive genetic variance of plasticity itself (<code class="reqn">V_{\text{A}\times\text{E}}</code>, i.e. the genetic-by-environment interaction variance). This last component can also be decomposed according to each of the parameters in <code>G_theta</code> (and their pairwise covariance), using the <code class="reqn">\iota</code>-decomposition (for interaction).
</p>
<p>It is very important that the parameters are in the same order in the argument of the <code>shape</code> function, in <code>theta</code> and in <code>G_theta</code>.
</p>


<h3>Value</h3>

<p>This function yields the values for <code class="reqn">V_{\text{Add}}</code>, <code class="reqn">V_{\text{A}}</code> and <code class="reqn">V_{\text{A}\times\text{E}}</code>, as well as the <code class="reqn">\gamma</code>- and <code class="reqn">\iota</code>-decomposition if requested, formatted as a 1-row data.frame (data.frame, all numeric).</p>


<h3>Author(s)</h3>

<p>Pierre de Villemereuil
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rn_vgen">rn_vgen</a></code>, <code><a href="#topic+rn_gen_decomp">rn_gen_decomp</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Some environment vector
vec_env &lt;- seq(-2, 2)

# Shape function
expr &lt;- expression(
     cmax * exp(
         - exp(rho * (x - xopt) - 6) -
             sigmagaus * (x - xopt)^2
     ))

# Theta
theta &lt;- c(cmax = 1, xopt = 0.9, rho = 8, sigmagaus = 0.4)
# G, only for cmax and xopt
G     &lt;- matrix(c(0.1,      0.01,
                  0.01,     0.05),
                ncol = 2)

# Computing V_gen
out &lt;- 
  rn_gen_decomp(theta   = theta,
                G_theta = G,
                env     = vec_env,
                shape   = expr,
                fixed   = c(3, 4))
# Note that fixed is set for the third and forth parameters than are not in G

# Checking that V_Add = V_A + V_AxE
out$V_Add == out$V_A + out$V_AxE
# Checking that the sum of \eqn{\gamma}'s is 1
out$Gamma_cmax + out$Gamma_xopt + out$Gamma_cmax_xopt
# Checking that the sum of \eqn{\iota}'s is 1
out$Iota_cmax + out$Iota_xopt + out$Iota_cmax_xopt

# Applying some weighting to the environmental values according to a normal distribution
rn_gen_decomp(theta   = theta,
              G_theta = G,
              env     = vec_env,
              shape   = expr,
              fixed   = c(3, 4),
              wt_env  = dnorm(vec_env))
              
# If a polynomial was used, it is possible to use the linear modeling rather having
# to compute integrals
theta &lt;- c(a = 1.5, b = 0.5, c = -0.5)
X     &lt;- cbind(1, vec_env, (vec_env - mean(vec_env))^2)
G     &lt;- 0.1 * diag(3)
rn_gen_decomp(theta   = theta,
              G_theta = G,
              X        = X)
</code></pre>

<hr>
<h2 id='rn_mean_by_env'>Compute the phenotypic mean on the observed scale</h2><span id='topic+rn_mean_by_env'></span>

<h3>Description</h3>

<p>This function calculates the phenotypic mean on the observed scale from the latent mean and variance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rn_mean_by_env(theta, V_theta, env, shape, fixed = NULL, width = 10)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rn_mean_by_env_+3A_theta">theta</code></td>
<td>
<p>Average parameters of the shape function. It must be a named vector, with the names corresponding to the parameters in the <code>shape</code> expression. (numeric)</p>
</td></tr>
<tr><td><code id="rn_mean_by_env_+3A_v_theta">V_theta</code></td>
<td>
<p>Full variance-covariance matrix of the parameters. It can be of lesser dimensions than <code>theta</code>, see <code>fixed</code> parameter. (numerical matrix)</p>
</td></tr>
<tr><td><code id="rn_mean_by_env_+3A_env">env</code></td>
<td>
<p>Vector of environmental values (numeric).</p>
</td></tr>
<tr><td><code id="rn_mean_by_env_+3A_shape">shape</code></td>
<td>
<p>Expression providing the shape of the reaction where <code>x</code> is the environment. For example: <code>expression(a + b * x + c * x^2)</code>.</p>
</td></tr>
<tr><td><code id="rn_mean_by_env_+3A_fixed">fixed</code></td>
<td>
<p>If some parameters of <code>shape</code>, included in <code>theta</code> are not included in the <code>V_theta</code> matrix, then those dimensions are considered as genetically &quot;fixed&quot;. Hence, <code>fixed</code> should contain a vector of the <b>index</b> of those parameters. Otherwise (if all parameters vary genetically), and by default, fixed should be set as NA. (integer)</p>
</td></tr>
<tr><td><code id="rn_mean_by_env_+3A_width">width</code></td>
<td>
<p>Parameter for the integral computation. The integral is evaluated from <code>mu</code> - <code>width * sqrt(var)</code> to <code>mu</code> + <code>width * sqrt(var)</code>. The default value is 10, which should be sensible for most models. (numeric)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function yields the phenotypic average (across genotypes) for each value of the environment. If the reaction norm is not linear in its parameters (the parameters in <code>theta</code>), then this average will generaly differ from the value yielded by <code>shape</code> evaluated at values in <code>theta</code>.
</p>
<p>It is very important that the parameters are in the same order in <code>theta</code> (which, again, must be named) and in <code>V_theta</code>.
</p>


<h3>Value</h3>

<p>This function yields the phenotypic mean for each value of the environmental vector provided (numeric).</p>


<h3>Author(s)</h3>

<p>Pierre de Villemereuil
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rn_vplas">rn_vplas</a></code>, <code><a href="#topic+rn_vgen">rn_vgen</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Some environment vector
vec_env &lt;- seq(-2, 2)

# Shape function
expr &lt;- expression(
     cmax * exp(
         - exp(rho * (x - xopt) - 6) -
             sigmagaus * (x - xopt)^2
     ))

# Theta
theta &lt;- c(cmax = 1, xopt = 0.9, rho = 8, sigmagaus = 0.4)
# G, only for cmax and xopt
G     &lt;- matrix(c(0.1,      0.01,
                  0.01,     0.05),
                ncol = 2)

# Computing mean by environment
rn_mean_by_env(env     = vec_env,
               shape   = expr,
               theta   = theta,
               V_theta = G,
               fixed = c(3, 4))
# Note that fixed is set for the third and forth parameters than are not in G

# This is (slightly) different from the function evaluated
# using the average values of the parameters in theta 
theta["cmax"] * exp(
         - exp(theta["rho"] * (vec_env - theta["xopt"]) - 6) -
             theta["sigmagaus"] * (vec_env - theta["xopt"])^2
     )
</code></pre>

<hr>
<h2 id='rn_phi_decomp'>Compute the <code class="reqn">\varphi</code>-decomposition of <code class="reqn">V_{\text{Plas}}</code></h2><span id='topic+rn_phi_decomp'></span>

<h3>Description</h3>

<p>This function calculates, for a linear (in its parameters) model, the plastic variance of the average (over genotypes) reaction norm shape <code class="reqn">V_{\text{Plas}}</code> and its <code class="reqn">\varphi</code>-decomposition (depending on the parameters rather than slope/curvature). This is especially useful when the reaction norm model was a polynomial.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rn_phi_decomp(theta, X, S = NULL, wt_env = NULL, correction = FALSE, v_plas = NA)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rn_phi_decomp_+3A_theta">theta</code></td>
<td>
<p>Average parameters of the shape function. It must be a named vector, with the names corresponding to the parameters in the <code>shape</code> expression. (numeric)</p>
</td></tr>
<tr><td><code id="rn_phi_decomp_+3A_x">X</code></td>
<td>
<p>The design matrix X of the reaction norm model. For a polynomial, X contains all the exponents of the environment. (numerical matrix)</p>
</td></tr>
<tr><td><code id="rn_phi_decomp_+3A_s">S</code></td>
<td>
<p>The error variance-covariance matrix of the estimated fixed effects <code>theta</code>. Not mandatory, but it is strongly advised to correct for the error variance in the parameter estimates. The function throws a warning if it is <code>NULL</code> (numerical matrix).</p>
</td></tr>
<tr><td><code id="rn_phi_decomp_+3A_wt_env">wt_env</code></td>
<td>
<p>Weights to apply to the <code>env</code> vector values, providing an information regarding their relative probability in the biological context. The weights must non-negative, and at least one must non-zero. The vector <code>wt_env</code> must be the same length as <code>env</code>. By default, no weighting is applied. (numeric)</p>
</td></tr>
<tr><td><code id="rn_phi_decomp_+3A_correction">correction</code></td>
<td>
<p>Should Bessel's correction (dividing the sum-of-squares by N-1 rather than N) be used (TRUE) or not (FALSE, default). The default is FALSE, because it is likely that other components such as the total phenotypic variance is computed over the number of individuals (generally large number) rather than the number of environments (generally small number). The best is to manually use Bessel's correction over the proper number of data points. (boolean)</p>
</td></tr>
<tr><td><code id="rn_phi_decomp_+3A_v_plas">v_plas</code></td>
<td>
<p>If already computed, an estimate for <code class="reqn">V_{\text{Plas}}</code>. If NA, then <code class="reqn">V_{\text{Plas}}</code> will be computed by the function. (numeric)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The variance <code class="reqn">V_{\text{Plas}}</code> is the variance arising from the shape of the reaction norm after avering over the genetic variance, i.e. the purely environmental part of the variance of plasticity in the reaction norm. Its <code class="reqn">\phi</code>-decomposition is based on the parameters of the linear model <code class="reqn">\mathbf{X}\theta</code>, rather than on slope and curvature, as for the <code class="reqn">\pi</code>-decomposition.
</p>
<p>It is very important that the parameters are in the same order in <code>theta</code> (which, again, must be named) and in <code>G_theta</code>.
</p>


<h3>Value</h3>

<p>This function yields the <code class="reqn">\pi</code>-decomposition of <code class="reqn">V_{\text{Plas}}</code> as a one-row data.frame. If <code class="reqn">V_{\text{Plas}}</code> was provided as an argument (e.g. as computed from a separate character-state model), it also outputs <code class="reqn">M^2</code>, the ratio between <code class="reqn">V_{\text{Plas}}</code> as computed from the linear model parameters and the provided value for <code class="reqn">V_{\text{Plas}}</code> (data.frame, all numeric).</p>


<h3>Author(s)</h3>

<p>Pierre de Villemereuil
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rn_pi_decomp">rn_pi_decomp</a></code>, <code><a href="#topic+rn_vplas">rn_vplas</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Parameters
vec_env &lt;- rnorm(20)
theta &lt;- c(a = 1.5, b = 0.5, c = -0.5)
X     &lt;- cbind(1, vec_env, (vec_env - mean(vec_env))^2)
S     &lt;- (10^-4) * diag(3)

# Computing the phi-decomposition
rn_phi_decomp(theta = theta, X = X, S = S)
</code></pre>

<hr>
<h2 id='rn_pi_decomp'>Compute the <code class="reqn">\pi</code>-decomposition of <code class="reqn">V_{\text{Plas}}</code></h2><span id='topic+rn_pi_decomp'></span>

<h3>Description</h3>

<p>This function calculates the plastic variance of the average (over genotypes) reaction norm shape <code class="reqn">V_{\text{Plas}}</code> and its <code class="reqn">\pi</code>-decomposition into <code class="reqn">\pi_{\text{Sl}}</code> and <code class="reqn">\pi_{\text{Cv}}</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rn_pi_decomp(theta, V_theta, env, shape, fixed = NULL, wt_env = NULL,
             correction = FALSE, width = 10)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rn_pi_decomp_+3A_theta">theta</code></td>
<td>
<p>Average parameters of the shape function. It must be a named vector, with the names corresponding to the parameters in the <code>shape</code> expression. (numeric)</p>
</td></tr>
<tr><td><code id="rn_pi_decomp_+3A_v_theta">V_theta</code></td>
<td>
<p>Full variance-covariance matrix of the parameters. It can be of lesser dimensions than <code>theta</code>, see <code>fixed</code> parameter. (numerical matrix)</p>
</td></tr>
<tr><td><code id="rn_pi_decomp_+3A_env">env</code></td>
<td>
<p>Vector of environmental values (numeric).</p>
</td></tr>
<tr><td><code id="rn_pi_decomp_+3A_shape">shape</code></td>
<td>
<p>Expression providing the shape of the reaction where <code>x</code> is the environment. For example: <code>expression(a + b * x + c * x^2)</code>.</p>
</td></tr>
<tr><td><code id="rn_pi_decomp_+3A_fixed">fixed</code></td>
<td>
<p>If some parameters of <code>shape</code>, included in <code>theta</code> are not included in the <code>V_theta</code> matrix, then those dimensions are considered as genetically &quot;fixed&quot;. Hence, <code>fixed</code> should contain a vector of the <b>index</b> of those parameters. Otherwise (if all parameters vary genetically), and by default, fixed should be set as NA. (integer)</p>
</td></tr>
<tr><td><code id="rn_pi_decomp_+3A_wt_env">wt_env</code></td>
<td>
<p>Weights to apply to the <code>env</code> vector values, providing an information regarding their relative probability in the biological context. The weights must non-negative, and at least one must non-zero. The vector <code>wt_env</code> must be the same length as <code>env</code>. By default, no weighting is applied. (numeric)</p>
</td></tr>
<tr><td><code id="rn_pi_decomp_+3A_correction">correction</code></td>
<td>
<p>Should Bessel's correction (dividing the sum-of-squares by N-1 rather than N) be used (TRUE) or not (FALSE, default). The default is FALSE, because it is likely that other components such as the total phenotypic variance is computed over the number of individuals (generally large number) rather than the number of environments (generally small number). The best is to manually use Bessel's correction over the proper number of data points. (boolean)</p>
</td></tr>
<tr><td><code id="rn_pi_decomp_+3A_width">width</code></td>
<td>
<p>Parameter for the integral computation. The integral is evaluated from <code>mu</code> - <code>width * sqrt(var)</code> to <code>mu</code> + <code>width * sqrt(var)</code>. The default value is 10, which should be sensible for most models. (numeric)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The variance <code class="reqn">V_{\text{Plas}}</code> is the variance arising from the shape of the reaction norm after averaging over the genetic variance, i.e. the purely environmental part of the variance of plasticity in the reaction norm. Its <code class="reqn">\pi</code>-decomposition into a slope (<code class="reqn">\pi_{\text{Sl}}</code>) and curvature (<code class="reqn">\pi_{\text{Cv}}</code>) components allows to distinguish the importance of each of those components in <code class="reqn">V_{\text{Plas}}</code>. Note that the <code class="reqn">\pi</code>-decomposition requires that the environmental variable is normally distributed, or that the reaction norm shape is quadratic.
</p>
<p>It is very important that the parameters are in the same order in <code>theta</code> (which, again, must be named) and in <code>V_theta</code>.
</p>


<h3>Value</h3>

<p>This function yields the <code class="reqn">\pi</code>-decomposition of <code class="reqn">V_{\text{Plas}}</code> as a one-row data.frame (data.frame, all numeric).</p>


<h3>Author(s)</h3>

<p>Pierre de Villemereuil
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rn_mean_by_env">rn_mean_by_env</a></code>, <code><a href="#topic+rn_vplas">rn_vplas</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Some environment vector
vec_env &lt;- rnorm(20)

# Shape function
expr &lt;- expression(
     cmax * exp(
         - exp(rho * (x - xopt) - 6) -
             sigmagaus * (x - xopt)^2
     ))

# Theta
theta &lt;- c(cmax = 1, xopt = 0.9, rho = 8, sigmagaus = 0.4)
# G, only for cmax and xopt
G     &lt;- matrix(c(0.1,      0.01,
                  0.01,     0.05),
                ncol = 2)

# Computing the pi-decomposition of V_Plas
rn_pi_decomp(theta   = theta,
             V_theta = G,
             env     = vec_env,
             shape   = expr,
             fixed   = c(3, 4))
# Note that fixed is set for the third and forth parameters than are not in G

# Applying some weighting to the environmental values according to a normal distribution
# if the env variable is actually fixed
vec_env2 &lt;- seq(-2, 2, length.out = 20)
rn_pi_decomp(theta   = theta,
              V_theta = G,
              env     = vec_env2,
              shape   = expr,
              fixed   = c(3, 4),
              wt_env  = dnorm(vec_env2))
</code></pre>

<hr>
<h2 id='rn_vgen'>Compute the total genetic variance <code class="reqn">V_{\text{Gen}}</code></h2><span id='topic+rn_vgen'></span>

<h3>Description</h3>

<p>This function calculates the total genetic variance <code class="reqn">V_{\text{Gen}}</code> arising from genetic variation in the reaction norm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rn_vgen(theta, G_theta, env = NULL, shape = NULL, X = NULL, fixed = NULL, wt_env = NULL,
        average = TRUE, width = 10)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rn_vgen_+3A_theta">theta</code></td>
<td>
<p>Average parameters of the shape function. It must be a named vector, with the names corresponding to the parameters in the <code>shape</code> expression. (numeric)</p>
</td></tr>
<tr><td><code id="rn_vgen_+3A_g_theta">G_theta</code></td>
<td>
<p>Genetic variance-covariance matrix of the parameters. It can be of lesser dimensions than <code>theta</code>, see <code>fixed</code> parameter. (numerical matrix)</p>
</td></tr>
<tr><td><code id="rn_vgen_+3A_env">env</code></td>
<td>
<p>Vector of environmental values (numeric).</p>
</td></tr>
<tr><td><code id="rn_vgen_+3A_shape">shape</code></td>
<td>
<p>Expression providing the shape of the reaction where <code>x</code> is the environment. For example: <code>expression(a + b * x + c * x^2)</code>.</p>
</td></tr>
<tr><td><code id="rn_vgen_+3A_x">X</code></td>
<td>
<p>If the model used was linear in the parameters, the design matrix X of the model (numeric, incompatible with the arguments <code>env</code> and <code>shape</code>).</p>
</td></tr>
<tr><td><code id="rn_vgen_+3A_fixed">fixed</code></td>
<td>
<p>If some parameters of <code>shape</code>, included in <code>theta</code> are not included in the <code>G_theta</code> matrix, then those dimensions are considered as genetically &quot;fixed&quot;. Hence, <code>fixed</code> should contain a vector of the <b>index</b> of those parameters. Otherwise (if all parameters vary genetically), and by default, fixed should be set as NA. (integer)</p>
</td></tr>
<tr><td><code id="rn_vgen_+3A_wt_env">wt_env</code></td>
<td>
<p>Weights to apply to the <code>env</code> vector values, providing an information regarding their relative probability in the biological context. The weights must non-negative, and at least one must non-zero. The vector <code>wt_env</code> must be the same length as <code>env</code>. By default, no weighting is applied. (numeric)</p>
</td></tr>
<tr><td><code id="rn_vgen_+3A_average">average</code></td>
<td>
<p>Should the values for each environment be given, or just their average (default)? (boolean)</p>
</td></tr>
<tr><td><code id="rn_vgen_+3A_width">width</code></td>
<td>
<p>Parameter for the integral computation. The integral is evaluated from <code>mu</code> - <code>width * sqrt(var)</code> to <code>mu</code> + <code>width * sqrt(var)</code>. The default value is 10, which should be sensible for most models. (numeric)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The variance <code class="reqn">V_{\text{Gen}}</code> is the total genetic variance in the reaction norm. If the reaction norm is linear in its parameters, then is it also equal to the total additive genetic variance in the reaction norm (<code class="reqn">V_{\text{Add}}</code>). Otherwise, see the function <code><a href="#topic+rn_gen_decomp">rn_gen_decomp</a></code> to compute <code class="reqn">V_{\text{Add}}</code>.
</p>
<p>It is very important that the parameters are in the same order in the argument of the <code>shape</code> function, in <code>theta</code> and in <code>G_theta</code>.
</p>


<h3>Value</h3>

<p>This function yields the genetic variance arising from all the genetic variation in the reaction norm (numeric).</p>


<h3>Author(s)</h3>

<p>Pierre de Villemereuil
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rn_gen_decomp">rn_gen_decomp</a></code>, <code><a href="#topic+rn_vplas">rn_vplas</a></code>, <code><a href="#topic+rn_vtot">rn_vtot</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Some environment vector
vec_env &lt;- seq(-2, 2)

# Shape function
expr &lt;- expression(
     cmax * exp(
         - exp(rho * (x - xopt) - 6) -
             sigmagaus * (x - xopt)^2
     ))

# Theta
theta &lt;- c(cmax = 1, xopt = 0.9, rho = 8, sigmagaus = 0.4)
# G, only for cmax and xopt
G     &lt;- matrix(c(0.1,      0.01,
                  0.01,     0.05),
                ncol = 2)

# Computing V_gen
rn_vgen(theta   = theta,
        G_theta = G,
        env     = vec_env,
        shape   = expr,
        fixed   = c(3, 4))
# Note that fixed is set for the third and forth parameters than are not in G

# Applying some weighting according to a normal distribution
rn_vgen(theta   = theta,
        G_theta = G,
        env     = vec_env,
        shape   = expr,
        fixed   = c(3, 4),
        wt_env  = dnorm(vec_env))

# Setting average to FALSE allows to obtain the value for each environment
rn_vgen(theta   = theta,
        G_theta = G,
        env     = vec_env,
        shape   = expr,
        fixed   = c(3, 4),
        average = FALSE)

# If a polynomial was used, it is possible to use the linear modeling rather having
# to compute integrals
theta &lt;- c(a = 1.5, b = 0.5, c = -0.5)
X     &lt;- cbind(1, vec_env, (vec_env - mean(vec_env))^2)
G     &lt;- 0.1 * diag(3)
rn_vgen(theta   = theta,
        G_theta = G,
        X       = X)
# Should be very close to the computation with integration
rn_vgen(theta   = theta,
        G_theta = G,
        env     = vec_env,
        shape   = expression(a + b * x + c * x^2))
</code></pre>

<hr>
<h2 id='rn_vp_env'>Compute the total phenotypic variance <code class="reqn">V_{\text{Tot}}</code></h2><span id='topic+rn_vp_env'></span>

<h3>Description</h3>

<p>This function calculates the total phenotypic variance <code class="reqn">V_{\text{Tot}}</code> arising along and beyond the reaction norm, i.e. including the residual variance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rn_vp_env(theta, V_theta, var_res, env = NULL, shape = NULL, X = NULL,
          fixed = NULL, wt_env = NULL, width = 10)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rn_vp_env_+3A_theta">theta</code></td>
<td>
<p>Average parameters of the shape function. It must be a named vector, with the names corresponding to the parameters in the <code>shape</code> expression. (numeric)</p>
</td></tr>
<tr><td><code id="rn_vp_env_+3A_v_theta">V_theta</code></td>
<td>
<p>Full variance-covariance matrix of the parameters. It can be of lesser dimensions than <code>theta</code>, see <code>fixed</code> parameter. (numerical matrix)</p>
</td></tr>
<tr><td><code id="rn_vp_env_+3A_var_res">var_res</code></td>
<td>
<p>Residual variance beyond the reaction norm. It could be a scalar if this residual variance is assumed homogeneous or a vector the same length as <code>env</code> (or number of rows of <code>X</code>), if the residual variance is allowed to vary across the environment. (numeric scalar or vector)</p>
</td></tr>
<tr><td><code id="rn_vp_env_+3A_env">env</code></td>
<td>
<p>Vector of environmental values (numeric).</p>
</td></tr>
<tr><td><code id="rn_vp_env_+3A_shape">shape</code></td>
<td>
<p>Expression providing the shape of the reaction where <code>x</code> is the environment. For example: <code>expression(a + b * x + c * x^2)</code>.</p>
</td></tr>
<tr><td><code id="rn_vp_env_+3A_x">X</code></td>
<td>
<p>If the model used was linear in the parameters, the design matrix X of the model (numeric, incompatible with the arguments <code>env</code> and <code>shape</code>).</p>
</td></tr>
<tr><td><code id="rn_vp_env_+3A_fixed">fixed</code></td>
<td>
<p>If some parameters of <code>shape</code>, included in <code>theta</code> are not included in the <code>G_theta</code> matrix, then those dimensions are considered as genetically &quot;fixed&quot;. Hence, <code>fixed</code> should contain a vector of the <b>index</b> of those parameters. Otherwise (if all parameters vary genetically), and by default, fixed should be set as NA. (integer)</p>
</td></tr>
<tr><td><code id="rn_vp_env_+3A_wt_env">wt_env</code></td>
<td>
<p>Weights to apply to the <code>env</code> vector values, providing an information regarding their relative probability in the biological context. The weights must non-negative, and at least one must non-zero. The vector <code>wt_env</code> must be the same length as <code>env</code>. By default, no weighting is applied. (numeric)</p>
</td></tr>
<tr><td><code id="rn_vp_env_+3A_width">width</code></td>
<td>
<p>Parameter for the integral computation. The integral is evaluated from <code>mu</code> - <code>width * sqrt(var)</code> to <code>mu</code> + <code>width * sqrt(var)</code>. The default value is 10, which should be sensible for most models. (numeric)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The phenotypic variance at a given environment depends on the variation in the <code class="reqn">\theta</code> parameters and the residual variance. It thus account for everything but the variance due to the average shape of the reaction norm (i.e. <code class="reqn">V_{\text{Plas}}</code>).
</p>


<h3>Value</h3>

<p>This function yields the phenotypic variance in each environment (numerical vector).</p>


<h3>Author(s)</h3>

<p>Pierre de Villemereuil
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rn_vplas">rn_vplas</a></code>, <code><a href="#topic+rn_vgen">rn_vgen</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Some environment vector
vec_env &lt;- seq(-2, 2)

# Shape function
expr &lt;- expression(
     cmax * exp(
         - exp(rho * (x - xopt) - 6) -
             sigmagaus * (x - xopt)^2
     ))

# Theta
theta &lt;- c(cmax = 1, xopt = 0.9, rho = 8, sigmagaus = 0.4)
# G, only for cmax and xopt
G     &lt;- matrix(c(0.1,      0.01,
                  0.01,     0.05),
                ncol = 2)
# Another covariance matrix for cmax and xopt (e.g. permanent environment, or maternal effet)
M     &lt;- matrix(c(0.05,      0,
                  0,      0.01),
                ncol = 2)
# Full variance-covariance matrix
P     &lt;- G + M
# Residual variance
vr    &lt;- 0.1
                
# Computing V_tot
rn_vp_env(theta   = theta,
          V_theta = P,
          var_res = vr,
          env     = vec_env,
          shape   = expr,
          fixed   = c(3, 4))
# Note that fixed is set for the third and forth parameters than are not in P
</code></pre>

<hr>
<h2 id='rn_vplas'>Compute the purely environmental plastic variance <code class="reqn">V_{\text{Plas}}</code></h2><span id='topic+rn_vplas'></span>

<h3>Description</h3>

<p>This function calculates the purely environmental plastic variance arising from the average (across genotypes) shape of the reaction norm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rn_vplas(theta, V_theta, env = NULL, shape = NULL, X = NULL, S = NULL,
         fixed = NULL, wt_env = NULL, correction = FALSE, width = 10)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rn_vplas_+3A_theta">theta</code></td>
<td>
<p>Average parameters of the shape function. It must be a named vector, with the names corresponding to the parameters in the <code>shape</code> expression. (numeric)</p>
</td></tr>
<tr><td><code id="rn_vplas_+3A_v_theta">V_theta</code></td>
<td>
<p>Full variance-covariance matrix of the parameters. It can be of lesser dimensions than <code>theta</code>, see <code>fixed</code> parameter. (numerical matrix)</p>
</td></tr>
<tr><td><code id="rn_vplas_+3A_env">env</code></td>
<td>
<p>Vector of environmental values (numeric).</p>
</td></tr>
<tr><td><code id="rn_vplas_+3A_shape">shape</code></td>
<td>
<p>Expression providing the shape of the reaction where <code>x</code> is the environment. For example: <code>expression(a + b * x + c * x^2)</code>.</p>
</td></tr>
<tr><td><code id="rn_vplas_+3A_x">X</code></td>
<td>
<p>If the model used was linear in the parameters, the design matrix X of the model (numeric, incompatible with the arguments <code>env</code> and <code>shape</code>).</p>
</td></tr>
<tr><td><code id="rn_vplas_+3A_s">S</code></td>
<td>
<p>The error variance-covariance matrix of the estimated fixed effects <code>theta</code>. Used only if the <code>X</code> argument is used. (numeric, incompatible with the arguments <code>env</code> and <code>shape</code>).</p>
</td></tr>
<tr><td><code id="rn_vplas_+3A_fixed">fixed</code></td>
<td>
<p>If some parameters of <code>shape</code>, included in <code>theta</code> are not included in the <code>V_theta</code> matrix, then those dimensions are considered as genetically &quot;fixed&quot;. Hence, <code>fixed</code> should contain a vector of the <b>index</b> of those parameters. Otherwise (if all parameters vary genetically), and by default, fixed should be set as NA. (integer)</p>
</td></tr>
<tr><td><code id="rn_vplas_+3A_wt_env">wt_env</code></td>
<td>
<p>Weights to apply to the <code>env</code> vector values, providing an information regarding their relative probability in the biological context. The weights must non-negative, and at least one must non-zero. The vector <code>wt_env</code> must be the same length as <code>env</code>. By default, no weighting is applied. (numeric)</p>
</td></tr>
<tr><td><code id="rn_vplas_+3A_correction">correction</code></td>
<td>
<p>Should Bessel's correction (dividing the sum-of-squares by N-1 rather than N) be used (TRUE) or not (FALSE, default). The default is FALSE, because it is likely that other components such as the total phenotypic variance is computed over the number of individuals (generally large number) rather than the number of environments (generally small number). The best is to manually use Bessel's correction over the proper number of data points. (boolean)</p>
</td></tr>
<tr><td><code id="rn_vplas_+3A_width">width</code></td>
<td>
<p>Parameter for the integral computation. The integral is evaluated from <code>mu</code> - <code>width * sqrt(var)</code> to <code>mu</code> + <code>width * sqrt(var)</code>. The default value is 10, which should be sensible for most models. (numeric)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The variance <code class="reqn">V_{\text{Plas}}</code> is the variance arising from the shape of the reaction norm after avering over the genetic variance, i.e. the purely environmental part of the variance of plasticity in the reaction norm.
</p>
<p>It is very important that the parameters are in the same order in <code>theta</code> (which, again, must be named) and in <code>V_theta</code>.
</p>


<h3>Value</h3>

<p>This function yields <code class="reqn">V_{\text{Plas}}</code> (numeric).</p>


<h3>Author(s)</h3>

<p>Pierre de Villemereuil
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rn_mean_by_env">rn_mean_by_env</a></code>, <code><a href="#topic+rn_pi_decomp">rn_pi_decomp</a></code>, <code><a href="#topic+rn_vgen">rn_vgen</a></code>, <code><a href="#topic+rn_vtot">rn_vtot</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Some environment vector
vec_env &lt;- seq(-2, 2)

# Shape function
expr &lt;- expression(
     cmax * exp(
         - exp(rho * (x - xopt) - 6) -
             sigmagaus * (x - xopt)^2
     ))

# Theta
theta &lt;- c(cmax = 1, xopt = 0.9, rho = 8, sigmagaus = 0.4)
# G, only for cmax and xopt
G     &lt;- matrix(c(0.1,      0.01,
                  0.01,     0.05),
                ncol = 2)

# Computing V_plas
rn_vplas(theta   = theta,
         V_theta = G,
         env     = vec_env,
         shape   = expr,
         fixed   = c(3, 4))
# Note that fixed is set for the third and forth parameters than are not in G

# Note the quite large difference when Bessel's correction is used
rn_vplas(theta   = theta,
         V_theta = G,
         env     = vec_env,
         shape   = expr,
         fixed   = c(3, 4),
         correction = TRUE)
         
# It is possible to weight the environment, e.g. according to a normal distribution
rn_vplas(theta   = theta,
         V_theta = G,
         env     = vec_env,
         shape   = expr,
         fixed   = c(3, 4),
         wt_env  = dnorm(vec_env),
         correction = TRUE)

# If a polynomial was used, it is possible to use the linear modeling rather having
# to compute integrals
theta &lt;- c(a = 1.5, b = 0.5, c = -0.5)
X     &lt;- cbind(1, vec_env, (vec_env - mean(vec_env))^2)
S     &lt;- (10^-4) * diag(3)
rn_vplas(theta = theta, X = X, S = S)
</code></pre>

<hr>
<h2 id='rn_vtot'>Compute the total phenotypic variance <code class="reqn">V_{\text{Tot}}</code></h2><span id='topic+rn_vtot'></span>

<h3>Description</h3>

<p>This function calculates the total phenotypic variance <code class="reqn">V_{\text{Tot}}</code> arising along and beyond the reaction norm, i.e. including the residual variance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rn_vtot(theta, V_theta, var_res, env = NULL, shape = NULL, X = NULL, S = NULL,
        fixed = NULL, wt_env = NULL, correction = FALSE, width = 10)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rn_vtot_+3A_theta">theta</code></td>
<td>
<p>Average parameters of the shape function. It must be a named vector, with the names corresponding to the parameters in the <code>shape</code> expression. (numeric)</p>
</td></tr>
<tr><td><code id="rn_vtot_+3A_v_theta">V_theta</code></td>
<td>
<p>Full variance-covariance matrix of the parameters. It can be of lesser dimensions than <code>theta</code>, see <code>fixed</code> parameter. (numerical matrix)</p>
</td></tr>
<tr><td><code id="rn_vtot_+3A_var_res">var_res</code></td>
<td>
<p>Residual variance beyond the reaction norm. It could be a scalar if this residual variance is assumed homogeneous or a vector the same length as <code>env</code> (or number of rows of <code>X</code>), if the residual variance is allowed to vary across the environment. (numeric scalar or vector)</p>
</td></tr>
<tr><td><code id="rn_vtot_+3A_env">env</code></td>
<td>
<p>Vector of environmental values (numeric).</p>
</td></tr>
<tr><td><code id="rn_vtot_+3A_shape">shape</code></td>
<td>
<p>Expression providing the shape of the reaction where <code>x</code> is the environment. For example: <code>expression(a + b * x + c * x^2)</code>.</p>
</td></tr>
<tr><td><code id="rn_vtot_+3A_x">X</code></td>
<td>
<p>If the model used was linear in the parameters, the design matrix X of the model (numeric, incompatible with the arguments <code>env</code> and <code>shape</code>).</p>
</td></tr>
<tr><td><code id="rn_vtot_+3A_s">S</code></td>
<td>
<p>The error variance-covariance matrix of the estimated fixed effects <code>theta</code>. Used only if the <code>X</code> argument is used. (numeric, incompatible with the arguments <code>env</code> and <code>shape</code>).</p>
</td></tr>
<tr><td><code id="rn_vtot_+3A_fixed">fixed</code></td>
<td>
<p>If some parameters of <code>shape</code>, included in <code>theta</code> are not included in the <code>G_theta</code> matrix, then those dimensions are considered as genetically &quot;fixed&quot;. Hence, <code>fixed</code> should contain a vector of the <b>index</b> of those parameters. Otherwise (if all parameters vary genetically), and by default, fixed should be set as NA. (integer)</p>
</td></tr>
<tr><td><code id="rn_vtot_+3A_wt_env">wt_env</code></td>
<td>
<p>Weights to apply to the <code>env</code> vector values, providing an information regarding their relative probability in the biological context. The weights must non-negative, and at least one must non-zero. The vector <code>wt_env</code> must be the same length as <code>env</code>. By default, no weighting is applied. (numeric)</p>
</td></tr>
<tr><td><code id="rn_vtot_+3A_correction">correction</code></td>
<td>
<p>Should Bessel's correction (dividing the sum-of-squares by N-1 rather than N) be used (TRUE) or not (FALSE, default). The default is FALSE, because it is likely that other components such as the total phenotypic variance is computed over the number of individuals (generally large number) rather than the number of environments (generally small number). The best is to manually use Bessel's correction over the proper number of data points. (boolean)</p>
</td></tr>  
<tr><td><code id="rn_vtot_+3A_width">width</code></td>
<td>
<p>Parameter for the integral computation. The integral is evaluated from <code>mu</code> - <code>width * sqrt(var)</code> to <code>mu</code> + <code>width * sqrt(var)</code>. The default value is 10, which should be sensible for most models. (numeric)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The variance <code class="reqn">V_{\text{Tot}}</code> is the total phenotypic variance of the trait along and beyond the reaction norm. In the simplest case, it is equal to the sum <code class="reqn">V_{\text{Plas}} + V_{\text{Gen}} + V_{\text{Res}}</code>, in which case this function is rather useless. But in cases where the parameters <code class="reqn">\theta</code> in the reaction norm curve is fitted with more than the (additive) genetic effect, then computing <code class="reqn">V_{\text{Tot}}</code> becomes non-trivial. This function allows to do it, e.g. by providing (i) a way to specify the full variation assumed in <code class="reqn">\theta</code>, using the <code>V_theta</code> full variance-covariance argument, and (ii) a way to specify a varying residual variance by environment.
</p>


<h3>Value</h3>

<p>This function yields the total phenotypic variance along and beyond the reaction norm (numeric).</p>


<h3>Author(s)</h3>

<p>Pierre de Villemereuil
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rn_vplas">rn_vplas</a></code>, <code><a href="#topic+rn_vgen">rn_vgen</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Some environment vector
vec_env &lt;- seq(-2, 2)

# Shape function
expr &lt;- expression(
     cmax * exp(
         - exp(rho * (x - xopt) - 6) -
             sigmagaus * (x - xopt)^2
     ))

# Theta
theta &lt;- c(cmax = 1, xopt = 0.9, rho = 8, sigmagaus = 0.4)
# G, only for cmax and xopt
G     &lt;- matrix(c(0.1,      0.01,
                  0.01,     0.05),
                ncol = 2)
# Another covariance matrix for cmax and xopt (e.g. permanent environment, or maternal effet)
M     &lt;- matrix(c(0.05,      0,
                  0,      0.01),
                ncol = 2)
# Full variance-covariance matrix
P     &lt;- G + M
# Residual variance
vr    &lt;- 0.1
                
# Computing V_tot
rn_vtot(theta   = theta,
        V_theta = P,
        var_res = vr,
        env     = vec_env,
        shape   = expr,
        fixed   = c(3, 4))
# Note that fixed is set for the third and forth parameters than are not in P

# With varying residual variance along the environmental (here with environmental variance)
vr    &lt;- 0.05 * (vec_env^2)
rn_vtot(theta   = theta,
        V_theta = P,
        var_res = vr,
        env     = vec_env,
        shape   = expr,
        fixed   = c(3, 4))
# Same result because the average of Vr is the same as the unique value above
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
