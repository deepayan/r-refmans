<!DOCTYPE html><html><head><title>Help for package medfateland</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {medfateland}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#medfateland-package'><p>medfateland: Mediterranean Landscape Forest Simulation</p></a></li>
<li><a href='#add_forests'><p>Add forests</p></a></li>
<li><a href='#add_topography'><p>Add topography and land cover</p></a></li>
<li><a href='#create_fire_regime'><p>Create fire regime</p></a></li>
<li><a href='#create_management_scenario'><p>Create management scenario</p></a></li>
<li><a href='#default_dispersal_control'><p>Default control parameters for dispersal</p></a></li>
<li><a href='#default_volume_function'><p>Default volume function</p></a></li>
<li><a href='#default_watershed_control'><p>Default control parameters for watershed processes</p></a></li>
<li><a href='#defaultPrescriptionsBySpecies'><p>Default prescriptions by species</p></a></li>
<li><a href='#dispersal'><p>Seed production, dispersal and seed bank dynamics</p></a></li>
<li><a href='#example_ifn'><p>Example of distributed forest inventory stands</p></a></li>
<li><a href='#example_watershed'><p>Example of watershed</p></a></li>
<li><a href='#extract_variables'><p>Landscape variables</p></a></li>
<li><a href='#fire_regime_instance'><p>Fire regime instance</p></a></li>
<li><a href='#fordyn_scenario'><p>Scenario of forest dynamics</p></a></li>
<li><a href='#forest_parametrization'><p>Landscape forest parametrization</p></a></li>
<li><a href='#initialize_landscape'><p>Initialization of model inputs for spatially-distributed forest stands</p></a></li>
<li><a href='#landscape_summary'><p>Forest and soil summaries over space</p></a></li>
<li><a href='#plot_summary'><p>Displays spatial simulation summaries</p></a></li>
<li><a href='#shinyplot_land'><p>Shiny app with interactive plots and maps</p></a></li>
<li><a href='#simulation_summary'><p>Summarizes spatial simulation results</p></a></li>
<li><a href='#soil_parametrization'><p>Landscape soil parametrization</p></a></li>
<li><a href='#spwb_land'><p>Watershed simulations</p></a></li>
<li><a href='#spwb_land_day'><p>One-day watershed simulations</p></a></li>
<li><a href='#spwb_spatial'><p>Simulations for spatially-distributed forest stands</p></a></li>
<li><a href='#spwb_spatial_day'><p>One-day simulation for spatially-distributed forest stands</p></a></li>
<li><a href='#update_landscape'><p>Updates the state of a landscape object</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Mediterranean Landscape Simulation</td>
</tr>
<tr>
<td>Version:</td>
<td>2.4.3</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-05-31</td>
</tr>
<tr>
<td>Description:</td>
<td>Simulate forest hydrology, forest function and dynamics over landscapes [De Caceres et al. (2015) &lt;<a href="https://doi.org/10.1016%2Fj.agrformet.2015.06.012">doi:10.1016/j.agrformet.2015.06.012</a>&gt;]. Parallelization is allowed in several simulation functions and simulations may be conducted including spatial processes such as lateral water transfer and seed dispersal.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://emf-creaf.github.io/medfateland/index.html">https://emf-creaf.github.io/medfateland/index.html</a></td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.4.0), medfate (&ge; 4.3.1)</td>
</tr>
<tr>
<td>Imports:</td>
<td>cli, ggplot2, dplyr, httr, jsonlite, lifecycle, methods,
meteoland (&ge; 2.0.2), rlang, Rcpp (&ge; 0.12.12), parallel, sf,
shiny, stars, terra, tidyterra, tidyr, tibble, stats</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, meteoland, medfate</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-06-02 14:34:29 UTC; miquel</td>
</tr>
<tr>
<td>Author:</td>
<td>Miquel De Cáceres [aut, cre],
  Aitor Améztegui <a href="https://orcid.org/0000-0003-2006-1559"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  María González <a href="https://orcid.org/0000-0002-2227-8404"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Núria Aquilué [aut],
  Daniel Caviedes-Voullième [aut],
  Mario Morales-Hernández [aut],
  Mario Beltrán [ctb],
  Roberto Molowny-Horas
    <a href="https://orcid.org/0000-0003-2626-6379"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Miquel De Cáceres &lt;miquelcaceres@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-06-02 23:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='medfateland-package'>medfateland: Mediterranean Landscape Forest Simulation</h2><span id='topic+medfateland-package'></span><span id='topic+medfateland'></span>

<h3>Description</h3>

<p>Functions to simulate forest hydrology, forest function and dynamics over landscapes
</p>


<h3>Author(s)</h3>

<p>Maintainer: Miquel De Cáceres
<a href="mailto:miquelcaceres@gmail.com">miquelcaceres@gmail.com</a>
<a href="https://orcid.org/0000-0001-7132-2080">ORCID</a>
</p>
<p>Author: Aitor Améztegui
<a href="https://orcid.org/0000-0003-2006-1559">ORCID</a>
</p>
<p>Author: María González
<a href="https://orcid.org/0000-0002-2227-8404">ORCID</a>
</p>
<p>Author: Núria Aquilué
</p>
<p>Contributor: Mario Beltrán
</p>
<p>Contributor: Roberto Molowny
<a href="https://orcid.org/0000-0003-2626-6379">ORCID</a>
</p>


<h3>See Also</h3>

<p>Useful links: </p>
 <ul>
<li>
<p><a href="https://emf-creaf.github.io/medfateland/index.html">https://emf-creaf.github.io/medfateland/index.html</a> </p>
</li></ul>


<hr>
<h2 id='add_forests'>Add forests</h2><span id='topic+add_forests'></span>

<h3>Description</h3>

<p>Creates and adds forest data to an <code><a href="sf.html#topic+sf">sf</a></code> object by reading from tree and shrub data tables
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_forests(
  x,
  tree_table = NULL,
  tree_mapping = NULL,
  shrub_table = NULL,
  shrub_mapping = NULL,
  merge_trees = TRUE,
  merge_shrubs = TRUE,
  SpParams = NULL,
  progress = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="add_forests_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code> with a valid CRS definition, and a column called 'id'.</p>
</td></tr>
<tr><td><code id="add_forests_+3A_tree_table">tree_table</code></td>
<td>
<p>A data frame with tree records in rows and attributes in columns. Tree records can correspond to individual trees or groups of trees with an associated density.</p>
</td></tr>
<tr><td><code id="add_forests_+3A_tree_mapping">tree_mapping</code></td>
<td>
<p>A named character vector to specify mappings of columns in <code>tree_table</code> into attributes of <code>treeData</code>. Accepted names (and the corresponding specifications for the columns in <code>tree_table</code>) are:
</p>

<ul>
<li><p>&quot;id&quot;: Forest stand id.
</p>
</li>
<li><p>&quot;Species&quot;: Species code (should follow codes in <code>SpParams</code>).
</p>
</li>
<li><p>&quot;Species.name&quot;: Species name. In this case, the species code will be drawn by matching names with species names in <code>SpParams</code>.
</p>
</li>
<li><p>&quot;N&quot;: Tree density (in ind./ha).
</p>
</li>
<li><p>&quot;DBH&quot;: Diameter at breast height (in cm).
</p>
</li>
<li><p>&quot;Height&quot;: Tree height (in cm).
</p>
</li>
<li><p>&quot;plot.size&quot;: Plot size (in m2) to which each record refers to. This is used to calculate tree density (stems per hectare) when not supplied.
</p>
</li>
<li><p>&quot;Z50&quot;: Depth (in mm) corresponding to 50 percent of fine roots.
</p>
</li>
<li><p>&quot;Z95&quot;: Depth (in mm) corresponding to 95 percent of fine roots.
</p>
</li></ul>
</td></tr>
<tr><td><code id="add_forests_+3A_shrub_table">shrub_table</code></td>
<td>
<p>A data frame with shrub records in rows and attributes in columns. Records can correspond to individual shrubs (with crown dimensions and height) or groups of shrubs with an associated cover estimate.</p>
</td></tr>
<tr><td><code id="add_forests_+3A_shrub_mapping">shrub_mapping</code></td>
<td>
<p>A named character vector to specify mappings of columns in <code>shrub_table</code> into attributes of <code>shrubData</code>. Accepted names (and the corresponding specifications for the columns in <code>shrub_table</code>) are:
</p>

<ul>
<li><p>&quot;id&quot;: Forest stand id.
</p>
</li>
<li><p>&quot;Species&quot;: Species code (should follow codes in <code>SpParams</code>).
</p>
</li>
<li><p>&quot;Species.name&quot;: Species name. In this case, the species code will be drawn by matching names with species names in <code>SpParams</code>.
</p>
</li>
<li><p>&quot;Cover&quot;: Shrub cover (in percent).
</p>
</li>
<li><p>&quot;D1&quot;: Shrub largest crown diameter (in cm).
</p>
</li>
<li><p>&quot;D2&quot;: Shrub crown diameter orthogonal to the largest one (in cm).
</p>
</li>
<li><p>&quot;Height&quot;: Shrub height (in cm).
</p>
</li>
<li><p>&quot;plot.size&quot;: Plot size (in m2) to which each record refers to. This is used to calculate shrub cover when shrub data is given at the individual level.
</p>
</li>
<li><p>&quot;Z50&quot;: Depth (in mm) corresponding to 50 percent of fine roots.
</p>
</li>
<li><p>&quot;Z95&quot;: Depth (in mm) corresponding to 95 percent of fine roots.
</p>
</li></ul>
</td></tr>
<tr><td><code id="add_forests_+3A_merge_trees">merge_trees</code></td>
<td>
<p>A logical flag to simplify tree cohorts by merging tree records in DBH classes (see <code><a href="medfate.html#topic+forest_mergeTrees">forest_mergeTrees</a></code>).</p>
</td></tr>
<tr><td><code id="add_forests_+3A_merge_shrubs">merge_shrubs</code></td>
<td>
<p>A logical flag to simplify shrub cohorts by merging shrub records in height classes (see <code><a href="medfate.html#topic+forest_mergeShrubs">forest_mergeShrubs</a></code>).</p>
</td></tr>
<tr><td><code id="add_forests_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="medfate.html#topic+SpParamsMED">SpParamsMED</a></code>) from which valid species names are drawn.</p>
</td></tr>
<tr><td><code id="add_forests_+3A_progress">progress</code></td>
<td>
<p>A logical flag to include a progress bar while processing the data.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The current implementation will replace existing forests of the indicated 'id' values.
</p>


<h3>Value</h3>

<p>A modified object of class <code><a href="sf.html#topic+sf">sf</a></code> with column 'forest'.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+impute_forests">impute_forests()</a></code>, <code><a href="medfate.html#topic+forest_mapWoodyTables">forest_mapWoodyTables</a></code>, <code><a href="medfate.html#topic+forest_mergeTrees">forest_mergeTrees</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load tree data
data(poblet_trees)

# Load species parameters
data(SpParamsMED)

# Define sf with three stands
cc &lt;- rbind(c(1.0215, 41.3432),
            c(1.0219, 41.3443), 
            c(1.0219, 41.3443))
d &lt;- data.frame(lon = cc[,1], lat = cc[,2], 
                id = c("POBL_CTL", "POBL_THI_BEF", "POBL_THI_AFT"))
x &lt;- sf::st_as_sf(d, coords = c("lon", "lat"), crs = 4326)
x

# Define tree mapping 
mapping &lt;- c("id" = "Plot.Code", "Species.name" = "Species", "DBH" = "Diameter.cm")

# Read tree data (warnings are raised)
y_1 &lt;- add_forests(x, tree_table = poblet_trees, tree_mapping = mapping, SpParams = SpParamsMED)

# Correct scientific name for downy oak and repeat to avoid losing tree records
poblet_trees$Species[poblet_trees$Species=="Quercus humilis"] &lt;- "Quercus pubescens"
y_1 &lt;- add_forests(x, tree_table = poblet_trees, tree_mapping = mapping, SpParams = SpParamsMED)

# Display summary of first forest
summary(y_1$forest[[1]], SpParamsMED)

# Add sampled plot surface and repeat reading to correct tree density
poblet_trees$PlotSurface &lt;- 706.86
mapping &lt;- c(mapping, "plot.size" = "PlotSurface")

y_2 &lt;- add_forests(x, tree_table = poblet_trees, tree_mapping = mapping, SpParams = SpParamsMED)
summary(y_2$forest[[1]], SpParamsMED)

# Check forests (height is missing!)
check_forests(y_2)

# Estimate tree height using general allometric
poblet_trees$Height.cm &lt;- 100 * 1.806*poblet_trees$Diameter.cm^0.518

#Modify mapping to include height and repeat
mapping &lt;- c(mapping, "Height" = "Height.cm")

y_3 &lt;- add_forests(x, tree_table = poblet_trees, tree_mapping = mapping, SpParams = SpParamsMED)
summary(y_3$forest[[1]], SpParamsMED)

# Final check
check_forests(y_3)

</code></pre>

<hr>
<h2 id='add_topography'>Add topography and land cover</h2><span id='topic+add_topography'></span><span id='topic+add_land_cover'></span><span id='topic+check_topography'></span><span id='topic+check_land_cover'></span>

<h3>Description</h3>

<p>Initializes topography and land cover type for a set of target locations
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_topography(x, dem, progress = TRUE)

add_land_cover(
  x,
  land_cover_map,
  wildland = NULL,
  agriculture = NULL,
  rock = NULL,
  artificial = NULL,
  water = NULL,
  progress = TRUE
)

check_topography(x, filter_missing = FALSE)

check_land_cover(x, filter_missing = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="add_topography_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code></p>
</td></tr>
<tr><td><code id="add_topography_+3A_dem">dem</code></td>
<td>
<p>A digital elevation model (class <code><a href="terra.html#topic+SpatRaster">SpatRaster</a></code>) with meters as units</p>
</td></tr>
<tr><td><code id="add_topography_+3A_progress">progress</code></td>
<td>
<p>A logical flag to print console output</p>
</td></tr>
<tr><td><code id="add_topography_+3A_land_cover_map">land_cover_map</code></td>
<td>
<p>An object of class <code><a href="terra.html#topic+SpatRaster">SpatRaster</a></code> of land cover type. If missing, all locations are considered 'wildland'.</p>
</td></tr>
<tr><td><code id="add_topography_+3A_wildland">wildland</code>, <code id="add_topography_+3A_agriculture">agriculture</code>, <code id="add_topography_+3A_rock">rock</code>, <code id="add_topography_+3A_artificial">artificial</code>, <code id="add_topography_+3A_water">water</code></td>
<td>
<p>Strings indicating the mapping from the legend of land_cover_map.</p>
</td></tr>
<tr><td><code id="add_topography_+3A_filter_missing">filter_missing</code></td>
<td>
<p>Boolean flag to filter locations with missing data</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The user should manually define the mapping of land cover classes in <code>land_cover_map</code> to the land cover types
used in medfateland.
</p>


<h3>Value</h3>

<p>Function <code>add_topography()</code> returns a modified object of class <code><a href="sf.html#topic+sf">sf</a></code> with columns:
</p>

<ul>
<li><p><code>id</code>: Numeric location identifiers (if not existing).
</p>
</li>
<li><p><code>elevation</code>: Elevation above sea level (in m).
</p>
</li>
<li><p><code>slope</code>: Slope (in degrees).
</p>
</li>
<li><p><code>aspect</code>: Aspect (in degrees).
</p>
</li>
<li><p><code>land_cover_type</code>: Land cover type.
</p>
</li></ul>

<p>Function <code>add_land_cover()</code> returns a modified object of class <code><a href="sf.html#topic+sf">sf</a></code> with new column:
</p>

<ul>
<li><p><code>id</code>: Numeric location identifiers (if not existing).
</p>
</li>
<li><p><code>land_cover_type</code>: Land cover type.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+impute_forests">impute_forests()</a></code>, <code><a href="#topic+add_soilgrids">add_soilgrids()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># See package vignettes 'Preparing inputs'
</code></pre>

<hr>
<h2 id='create_fire_regime'>Create fire regime</h2><span id='topic+create_fire_regime'></span>

<h3>Description</h3>

<p>Defines an object containing fire regime parameters for simulations of forest dynamics.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_fire_regime(annual_burned_area, sd_burned_area = NULL, doy = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_fire_regime_+3A_annual_burned_area">annual_burned_area</code></td>
<td>
<p>A named vector of burned area in hectares for simulation years.</p>
</td></tr>
<tr><td><code id="create_fire_regime_+3A_sd_burned_area">sd_burned_area</code></td>
<td>
<p>A named vector of standard deviation (in log scale) of burned area. If specified, annual target to burn will be determined
using a log-normal distribution with mean values given by <code>annual_burned_area</code>.</p>
</td></tr>
<tr><td><code id="create_fire_regime_+3A_doy">doy</code></td>
<td>
<p>A named integer vector with the day of the year (i.e. between 1 and 366) when fires will be simulated for each simulation year in <code>annual_burned_area</code>. If NULL
fires will be simulated on the driest day (i.e. when vapor pressure deficit is largest).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Names of <code>annual_burned_area</code> should be simulation years. If provided, <code>sd_burned_area</code> should be a vector of the same size as
<code>annual_burned_area</code> and have the same names.
</p>


<h3>Value</h3>

<p>A list with the supplied parameters
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fire_regime_instance">fire_regime_instance</a></code>, <code><a href="#topic+fordyn_scenario">fordyn_scenario</a></code>, <code><a href="#topic+fordyn_spatial">fordyn_spatial</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Fire regime with pre-defined burned area values
reg1 &lt;- create_fire_regime(annual_burned_area = c("2002" = 1000, "2003" = 5000)) 

# Fire regime with log-normal distribution for burned area
reg2 &lt;- create_fire_regime(annual_burned_area = c("2002" = 1000, "2003" = 5000),
                           sd_burned_area = c("2002" = 0.9, "2003" = 0.8)) 

</code></pre>

<hr>
<h2 id='create_management_scenario'>Create management scenario</h2><span id='topic+create_management_scenario'></span>

<h3>Description</h3>

<p>Defines a management scenario for simulations of forest dynamics
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_management_scenario(
  units,
  annual_demand_by_species = NULL,
  extraction_rate_by_year = NULL,
  default_management_arguments = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_management_scenario_+3A_units">units</code></td>
<td>
<p>Number of management units. Alternatively, a data frame with management options (in columns) for a set of units (in rows). Options not specified witl be taken from defaults.</p>
</td></tr>
<tr><td><code id="create_management_scenario_+3A_annual_demand_by_species">annual_demand_by_species</code></td>
<td>
<p>A vector or matrix of annual wood demand (m3) by medfate species names (or groups of species names). If empty, the scenario is 'bottom-up' (not based on demand).
If a vector is supplied, the same wood demand is applied for all simulated years. If a matrix is supplied, each row should correspond
to a different year.</p>
</td></tr>
<tr><td><code id="create_management_scenario_+3A_extraction_rate_by_year">extraction_rate_by_year</code></td>
<td>
<p>A vector of extraction rates (%) per year of the simulation, starting at the second year. If specified,
the annual demand by species will be applied for the first year of the simulation, but it will be rescaled for the remaining
years according to the growth observed and the desired extraction rates.</p>
</td></tr>
<tr><td><code id="create_management_scenario_+3A_default_management_arguments">default_management_arguments</code></td>
<td>
<p>A list of arguments to be passed to the managementFunction. These arguments will be taken as defaults
copied for all management units and can later be modified. If NULL, the result of calling function
<code><a href="medfate.html#topic+defaultManagementArguments">defaultManagementArguments</a></code> will be taken.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Three kinds of management scenarios are allowed:
</p>

<ol>
<li><p><code>'bottom-up'</code> represents a scenario where forest stands belong to different management units,
each of them having possibly distinct management prescriptions. However, there is no demand and the amount
of extracted wood emerges from the interplay between forest dynamics and management prescriptions.
</p>
</li>
<li><p><code>'input_demand'</code> represents a scenario where a certain amount of wood extraction is targeted for some species
and each year. This requires deciding which stands will actually undergo thinning operations to fulfill the demand (stands
managed following prescriptions that indicate final regeneration cuts are managed irrespective of demand).
</p>
</li>
<li><p><code>'input_rate'</code> represents a scenario similar to the previous one but where total amount of wood targeted depends
on (i.e. is a proportion of) the growth observed in previous year.
</p>
</li></ol>

<p>The kind of management scenario depends on the arguments supplied by the user when calling <code>create_management_scenario</code> (see examples).
In all cases, management units need to be defined. Each management unit represents a group of forest stands
following the same management prescriptions. Although the <code>create_management_scenario</code> function allows specifying the management arguments of each unit,
the simulation of management scenarios also requires specifying, for each forest stand, to which management unit it belongs (see <code><a href="#topic+fordyn_scenario">fordyn_scenario</a></code>).
</p>


<h3>Value</h3>

<p>A list with the following structure:
</p>

<ul>
<li><p><code>scenario_type</code>: Either 'bottom-up' (no demand is specified),
'input_demand' (annual species demand is specified), or
'input_rate' when extraction rates are also supplied.
</p>
</li>
<li><p><code>annual_demand_by_species</code>: A vector of annual wood demand (m3) by species (or species groups)
(for scenario_type 'bottom-up' or 'input_demand').
</p>
</li>
<li><p><code>extraction_rate_by_year</code>: A vector of extraction rate values per year.
</p>
</li>
<li><p><code>units</code>: A data frame with as many rows as units and management arguments as columns.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>
<p>Aitor Améztegui, UdL
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fordyn_scenario">fordyn_scenario</a></code>, <code><a href="medfate.html#topic+defaultManagementFunction">defaultManagementFunction</a></code>, <code><a href="#topic+defaultPrescriptionsBySpecies">defaultPrescriptionsBySpecies</a></code>, <code><a href="#topic+create_fire_regime">create_fire_regime</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# A scenario with three management units and annual demand for two species
scen_1 &lt;- create_management_scenario(3,  c("Quercus ilex" = 1000, "Pinus nigra" = 2000))

# A scenario like the former, but with total annual demand changing as a function of
# prescribed extraction rates (second and third years)
scen_2 &lt;- create_management_scenario(3,  
           c("Quercus ilex" = 1000, "Pinus nigra" = 2000),
           c("2002" = 30, "2003" = 50))
        
# A scenario with as many management units as rows in 'defaultPrescriptionsBySpecies'
# and not based on demand
data("defaultPrescriptionsBySpecies")
scen_3 &lt;- create_management_scenario(defaultPrescriptionsBySpecies)

# A scenario with three management units and annual demand for one species group 
# and a third species
scen_4 &lt;- create_management_scenario(3,  c("Quercus ilex/Quercus pubescens" = 1000, 
                                           "Pinus nigra" = 2000))
</code></pre>

<hr>
<h2 id='default_dispersal_control'>Default control parameters for dispersal</h2><span id='topic+default_dispersal_control'></span>

<h3>Description</h3>

<p>Defines default control parameters for dispersal process
</p>


<h3>Usage</h3>

<pre><code class='language-R'>default_dispersal_control()
</code></pre>


<h3>Value</h3>

<p>A list with the following items:
</p>

<ul>
<li><p><code>distance_step  [= 25]</code>: Distance step in meters.
</p>
</li>
<li><p><code>maximum_dispersal_distance [= 3000]</code>: Maximum dispersal distance in meters.
</p>
</li>
<li><p><code>min_percent [= 1]</code>: A minimum percent of seed bank to retain entry in <code>seedBank</code> element of <code>forest</code>.
</p>
</li>
<li><p><code>stochastic_resampling [= FALSE]</code>: A flag to indicate that stochastic resampling of stands is performed.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb_land">spwb_land</a></code>, <code><a href="#topic+fordyn_scenario">fordyn_scenario</a></code> <code><a href="#topic+dispersal">dispersal</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>default_dispersal_control()

</code></pre>

<hr>
<h2 id='default_volume_function'>Default volume function</h2><span id='topic+default_volume_function'></span>

<h3>Description</h3>

<p>Example function for estimating wood volume (in m3/ha) from a tree table or forest object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>default_volume_function(x, SpParams = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="default_volume_function_+3A_x">x</code></td>
<td>
<p>A data frame with columns 'DBH', 'Height' and 'N' or a <code><a href="medfate.html#topic+forest">forest</a></code> object</p>
</td></tr>
<tr><td><code id="default_volume_function_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (not used in the default function but will be called)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Users should define their own functions taking into account that:
</p>

<ul>
<li><p>Input should be named 'x' and consist of a tree table with tree records as rows
and columns 'DBH' (cm), 'Height' (cm), and 'N' (ind./ha).
</p>
</li>
<li><p>Output should be a numeric vector of length equal to the number of tree records in 'x'
</p>
</li></ul>



<h3>Value</h3>

<p>A function amenable for wood volume estimation.
</p>

<hr>
<h2 id='default_watershed_control'>Default control parameters for watershed processes</h2><span id='topic+default_watershed_control'></span>

<h3>Description</h3>

<p>Defines default control parameters for watershed processes
</p>


<h3>Usage</h3>

<pre><code class='language-R'>default_watershed_control(watershed_model = "tetis")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="default_watershed_control_+3A_watershed_model">watershed_model</code></td>
<td>
<p>Hydrological model for watershed processes. Only &quot;tetis&quot; or &quot;serghei&quot; are accepted.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the following items:
</p>

<ul>
<li><p><code>watershed_model</code>: A string with the watershed model.
</p>
</li>
<li><p><code>weather_aggregation_factor [= 1]</code>: An integer specifying the spatial aggregation for interpolated weather.
</p>
</li>
<li><p><code>tetis_parameters</code>: A list of TETIS parameters with the following elements:
</p>

<ul>
<li><p><code>R_localflow [= 1.0]</code>: Correction factor for soil hydraulic saturated conductivity (local vertical flows).
</p>
</li>
<li><p><code>R_interflow [= 50.0]</code>: Correction factor for soil hydraulic saturated conductivity (subsurface flow between grid cells).
</p>
</li>
<li><p><code>R_baseflow [= 5.0]</code>: Correction factor for bedrock hydraulic conductivity (groundwaterflow between grid cells).
</p>
</li>
<li><p><code>n_interflow [= 1.0]</code>: Exponent for the determination of interflow.
</p>
</li>
<li><p><code>n_baseflow [= 1.0]</code>: Exponent for the determination of baseflow.
</p>
</li>
<li><p><code>num_daily_substeps [= 4]</code>: Number of daily sub-steps for interflow calculations.
</p>
</li>
<li><p><code>rock_max_infiltration [= 10]</code>: Maximum infiltration rate (mm·day-1) for rock cells.
</p>
</li>
<li><p><code>deep_aquifer_loss [= 0]</code>: Daily loss rate from watershed aquifer towards a deeper aquifer not connected to outlets (mm·day-1).
</p>
</li></ul>


</li>
<li><p><code>serghei_parameters</code>: A list of SERGHEI parameters with the following elements:
</p>

<ul>
<li><p><code>input_dir [= ""]</code>: Path to SERGHEI input files.
</p>
</li>
<li><p><code>output_dir [= ""]</code>: Path to SERGHEI output files.
</p>
</li>
<li><p><code>force_equal_layer_widths [= FALSE]</code>: A boolean flag to force equal layer widths (taken from the first soil element) in all soils.
</p>
</li></ul>


</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb_land">spwb_land</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>default_watershed_control()

</code></pre>

<hr>
<h2 id='defaultPrescriptionsBySpecies'>Default prescriptions by species</h2><span id='topic+defaultPrescriptionsBySpecies'></span>

<h3>Description</h3>

<p>Default management prescriptions by species, defined according current practices in Catalonia (NE Spain)
</p>


<h3>Details</h3>

<p>A data frame with 27 species (or species groups) in rows and management parameters in columns (defined in <code><a href="medfate.html#topic+defaultManagementArguments">defaultManagementArguments</a></code>)
</p>


<h3>Source</h3>

<p>Mario Beltrán &amp; Míriam Piqué. Forest Science and Technology Centre of Catalonia (CTFC)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+create_management_scenario">create_management_scenario</a></code>, <code><a href="medfate.html#topic+defaultManagementArguments">defaultManagementArguments</a></code>,
<code><a href="#topic+fordyn_scenario">fordyn_scenario</a></code>
</p>

<hr>
<h2 id='dispersal'>Seed production, dispersal and seed bank dynamics</h2><span id='topic+dispersal'></span>

<h3>Description</h3>

<p>Simulates seed bank mortality, seed production and dispersal among stands
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dispersal(
  sf,
  SpParams,
  local_control = medfate::defaultControl(),
  distance_step = 25,
  maximum_dispersal_distance = 3000,
  min_percent = 1,
  stochastic_resampling = FALSE,
  progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dispersal_+3A_sf">sf</code></td>
<td>
<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code> using a UTM projection (to measure distances in m) and with the following columns:
</p>

<ul>
<li><p><code>geometry</code>: Spatial geometry.
</p>
</li>
<li><p><code>forest</code>: Objects of class <code><a href="medfate.html#topic+forest">forest</a></code>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="dispersal_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="medfate.html#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
<tr><td><code id="dispersal_+3A_local_control">local_control</code></td>
<td>
<p>A list of control parameters (see <code><a href="medfate.html#topic+defaultControl">defaultControl</a></code>)</p>
</td></tr>
<tr><td><code id="dispersal_+3A_distance_step">distance_step</code></td>
<td>
<p>Distance step in meters.</p>
</td></tr>
<tr><td><code id="dispersal_+3A_maximum_dispersal_distance">maximum_dispersal_distance</code></td>
<td>
<p>Maximum dispersal distance in meters.</p>
</td></tr>
<tr><td><code id="dispersal_+3A_min_percent">min_percent</code></td>
<td>
<p>A minimum percent of seed bank to retain entry in <code>seedBank</code> element of <code>forest</code>.</p>
</td></tr>
<tr><td><code id="dispersal_+3A_stochastic_resampling">stochastic_resampling</code></td>
<td>
<p>A flag to indicate that stochastic resampling of stands is performed.</p>
</td></tr>
<tr><td><code id="dispersal_+3A_progress">progress</code></td>
<td>
<p>Boolean flag to display progress information.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The input 'sf' object has to be in a Universal Transverse Mercator (UTM) coordinate system (or any other projection using meters as length unit)
for appropriate function behavior.
</p>
<p>Dispersal kernel follows Clark et al. (1999) and potential seed donors (neighbors) are defined up to a given grid distance order.
A maximum value of 100% seed bank refill is attained for species with seed production in all seed donors and the local cell.
</p>


<h3>Value</h3>

<p>A list with forest objects (for wildland cover type) containing a modified seed bank
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF.
</p>
<p>Roberto Molowny-Horas, CREAF.
</p>


<h3>References</h3>

<p>Clark et al. (1999). Seed dispersal near and far: Patterns across temperate and tropical forests. Ecology 80(5):1475-1494
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fordyn_land">fordyn_land</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(example_watershed)
data(SpParamsMED)

# Transform to UTM31
example_watershed_utm31 &lt;- sf::st_transform(example_watershed, crs = 32631)

# Estimate seed production and dispersal over the watershed
seedbank_list &lt;- dispersal(example_watershed_utm31, SpParamsMED)

seedbank_list[[1]]

# Transform to UTM31
example_ifn_utm31 &lt;- sf::st_transform(example_ifn, crs = 32631)

# Estimate seed production and dispersal over the set of forest inventory plots
seedbank_list &lt;- dispersal(example_ifn_utm31, SpParamsMED)

seedbank_list[[1]]

</code></pre>

<hr>
<h2 id='example_ifn'>Example of distributed forest inventory stands</h2><span id='topic+example_ifn'></span>

<h3>Description</h3>

<p>An example of an coordinates, topography, forest and soil data corresponding to 30 forest inventory plots.
</p>


<h3>Format</h3>

<p>The data format is that of an object <code><a href="sf.html#topic+sf">sf</a></code>
</p>


<h3>Source</h3>


<ul>
<li><p>Soil data from SoilGrids global database (Hengl et al. 2017).
</p>
</li>
<li><p>Soil depth and depth to bedrock from Shangguan et al. (2017).
</p>
</li>
<li><p>Forest structure and composition from the Third Spanish Forest Inventory (IFN3).
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+spwb_spatial">spwb_spatial</a></code>
</p>

<hr>
<h2 id='example_watershed'>Example of watershed</h2><span id='topic+example_watershed'></span><span id='topic+example_watershed_burnin'></span>

<h3>Description</h3>

<p>An example of an object of <code><a href="sf.html#topic+sf">sf</a></code> with data for a small catchment of 66 ha (0.66 km2) in Catalonia.
Object <code>example_watershed_burnin</code> is the result of three years of burn-in period.
</p>


<h3>Format</h3>

<p>The data format is that of an object <code><a href="sf.html#topic+sf">sf</a></code>
</p>


<h3>Source</h3>


<ul>
<li><p>Watershed limits and channel network from the spanish Ministerio de Transición Ecológica y el Reto Demográfico.
</p>
</li>
<li><p>Elevation data at 30 m resolution from catalan Institut Cartogràfic i Geològic de Catalunya.
</p>
</li>
<li><p>Soil data from SoilGrids global database (Hengl et al. 2017).
</p>
</li>
<li><p>Soil depth and depth to bedrock from Shangguan et al. (2017).
</p>
</li>
<li><p>Bedrock hydraulic properties from Huscroft et al. (2018).
</p>
</li>
<li><p>Land cover data from Mapa Forestal de España 1:25000.
</p>
</li>
<li><p>Forest structure and composition from Mapa Forestal de España 1:25000 and the Third Spanish Forest Inventory (IFN3).
</p>
</li></ul>



<h3>References</h3>

<p>Hengl, T., Mendes De Jesus, J., Heuvelink, G.B.M., Gonzalez, M.R., Kilibarda, M., Blagotí, A., Shangguan, W., Wright, M.N., Geng, X., Bauer-Marschallinger, B., Guevara, M.A., Vargas, R., Macmillan, R.A., Batjes, N.H., Leenaars, J.G.B., Ribeiro, E., Wheeler, I., Mantel, S., Kempen, B., 2017. SoilGrids250m: Global Gridded Soil Information Based on Machine Learning. PLoS One 12, e0169748. doi:10.1371/journal.pone.0169748
</p>
<p>Huscroft, J., Gleeson, T., Hartmann, J., Börker, J., 2018. Compiling and Mapping Global Permeability of the Unconsolidated and Consolidated Earth: GLobal HYdrogeology MaPS 2.0 (GLHYMPS 2.0). Geophys. Res. Lett. 45, 1897–1904. doi:10.1002/2017GL075860
</p>
<p>Shangguan, W., Hengl, T., Mendes de Jesus, J., Yuan, H., Dai, Y., 2017. Mapping the global depth to bedrock for land surface modeling. J. Adv. Model. Earth Syst. 9, 65–88. doi:10.1002/2016MS000686
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb_land">spwb_land</a></code>
</p>

<hr>
<h2 id='extract_variables'>Landscape variables</h2><span id='topic+extract_variables'></span><span id='topic+plot_variable'></span>

<h3>Description</h3>

<p>Extract or estimate variables from landscape objects (class 'sf').
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_variables(x, vars = "land_cover_type", SpParams = NULL, ...)

plot_variable(x, variable = "land_cover_type", SpParams = NULL, r = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_variables_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code> with the appropriate columns.</p>
</td></tr>
<tr><td><code id="extract_variables_+3A_vars">vars</code></td>
<td>
<p>A string vector with the name of the variables to extract (see details).</p>
</td></tr>
<tr><td><code id="extract_variables_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="medfate.html#topic+SpParamsMED">SpParamsMED</a></code>), required for most forest stand variables.</p>
</td></tr>
<tr><td><code id="extract_variables_+3A_...">...</code></td>
<td>
<p>Additional arguments (not used).</p>
</td></tr>
<tr><td><code id="extract_variables_+3A_variable">variable</code></td>
<td>
<p>A string with the name of the variables to draw (see details).</p>
</td></tr>
<tr><td><code id="extract_variables_+3A_r">r</code></td>
<td>
<p>An object of class <code><a href="terra.html#topic+rast">rast</a></code>, defining the raster topology.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The following string values are available for <code>vars</code>.
</p>
<p><em>Topography</em>:
</p>

<ul>
<li><p><code>"elevation"</code>: Elevation in m.
</p>
</li>
<li><p><code>"slope"</code>: Slope in degrees.
</p>
</li>
<li><p><code>"aspect"</code>: Slope in degrees.
</p>
</li>
<li><p><code>"land_cover_type"</code>: Land cover type.
</p>
</li></ul>

<p><em>Soil</em>:
</p>

<ul>
<li><p><code>"soil_vol_extract"</code>: Total water extractable volume (mm).
</p>
</li>
<li><p><code>"soil_vol_sat"</code>: Total water volume at saturation (mm).
</p>
</li>
<li><p><code>"soil_vol_fc"</code>: Total water volume at field capacity (mm).
</p>
</li>
<li><p><code>"soil_vol_wp"</code>: Total water volume at wilting point (mm).
</p>
</li>
<li><p><code>"soil_vol_curr"</code>: Current total water volume (mm).
</p>
</li>
<li><p><code>"soil_rwc_curr"</code>: Current soil relative water content (%).
</p>
</li>
<li><p><code>"soil_rew_curr"</code>: Current soil relative extractable water (%).
</p>
</li>
<li><p><code>"soil_theta_curr"</code>: Current soil moisture content (% vol.)
</p>
</li>
<li><p><code>"soil_psi_curr"</code>: Current soil water potential (MPa).
</p>
</li></ul>

<p><em>Watershed</em>:
</p>

<ul>
<li><p><code>"depth_to_bedrock"</code>: Depth to bedrock (m).
</p>
</li>
<li><p><code>"bedrock_porosity"</code>: Bedrock porosity.
</p>
</li>
<li><p><code>"bedrock_conductivity"</code>: Bedrock conductivity (m/day).
</p>
</li>
<li><p><code>"aquifer_elevation"</code>: Aquifer elevation over bedrock (m).
</p>
</li>
<li><p><code>"depth_to_aquifer"</code>: Depth to aquifer (m).
</p>
</li>
<li><p><code>"aquifer"</code>: Aquifer volume (mm).
</p>
</li>
<li><p><code>"snowpack"</code>: Snowpack water equivalent (mm).
</p>
</li></ul>

<p><em>Forest stand</em>:
</p>

<ul>
<li><p><code>"basal_area"</code>: Basal area (m2/ha).
</p>
</li>
<li><p><code>"tree_density"</code>: Tree density (ind/ha).
</p>
</li>
<li><p><code>"mean_tree_height"</code>: Mean tree height (cm).
</p>
</li>
<li><p><code>"dominant_tree_height"</code>: Dominant tree height (cm).
</p>
</li>
<li><p><code>"dominant_tree_diameter"</code>: Dominant tree diameter (cm).
</p>
</li>
<li><p><code>"quadratic_mean_tree_diameter"</code>: Quadratic mean tree diameter (cm).
</p>
</li>
<li><p><code>"hart_becking_index"</code>: Hart-Becking index.
</p>
</li>
<li><p><code>"leaf_area_index"</code>: Leaf area index (m2/m2).
</p>
</li>
<li><p><code>"foliar_biomass"</code>: Foliar biomass (kg/m2).
</p>
</li>
<li><p><code>"fuel_loading"</code>: Fine live fuel loading (kg/m2).
</p>
</li>
<li><p><code>"shrub_volume"</code>: Shrub volume (m3/m2).
</p>
</li></ul>



<h3>Value</h3>

<p>Function <code>extract_variables()</code> returns an object of class <code><a href="sf.html#topic+sf">sf</a></code> with the desired variables.
Function <code>plot_variables()</code> returns a ggplot object.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF.
</p>


<h3>See Also</h3>

<p><code><a href="medfate.html#topic+forest">forest</a></code>, <code><a href="medfate.html#topic+soil">soil</a></code>, <code><a href="medfate.html#topic+summary.forest">summary.forest</a></code>, <code><a href="#topic+shinyplot_land">shinyplot_land</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Load data and species parameters from medfate
data(example_ifn)
data(SpParamsMED)
  
# Calculate basal area and leaf area index
# for all forest stands
extract_variables(example_ifn, vars = c("basal_area", "leaf_area_index"),
                  SpParams = SpParamsMED)
                  
</code></pre>

<hr>
<h2 id='fire_regime_instance'>Fire regime instance</h2><span id='topic+fire_regime_instance'></span>

<h3>Description</h3>

<p>Applies a fire regime object over a set of landscape units to determine a fire realization
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fire_regime_instance(sf, fire_regime)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fire_regime_instance_+3A_sf">sf</code></td>
<td>
<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code> with the following columns:
</p>

<ul>
<li><p><code>geometry</code>: Spatial geometry.
</p>
</li>
<li><p><code>id</code>: Stand identifiers.
</p>
</li>
<li><p><code>represented_area_ha</code>: Area represented by each stand (in hectares).
</p>
</li>
<li><p><code>ignition_weights</code>: Relative weights to determine stands to be burned (optional).
</p>
</li></ul>
</td></tr>
<tr><td><code id="fire_regime_instance_+3A_fire_regime">fire_regime</code></td>
<td>
<p>A list of parameters defining the fire regime (see <code><a href="#topic+create_fire_regime">create_fire_regime</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function randomly determines the landscape units that will burn every year, depending on the specifications
of the fire regime object. Users can define their own fire regime instances from other models (e.g. a fire landscape model)
and then use those directly in functions <code><a href="#topic+fordyn_spatial">fordyn_spatial</a></code> or <code><a href="#topic+fordyn_scenario">fordyn_scenario</a></code>-
</p>


<h3>Value</h3>

<p>An integer matrix specifying the day of the year of burning of each landscape unit for every year in the fire regime definition.
Values are interpreted as follows:
</p>

<ul>
<li><p>NA - No wildfire this year
</p>
</li>
<li><p>0 - Wildfire will occur the driest day (i.e. the one with largest vapor pressure deficit).
</p>
</li>
<li><p>1...366 - Day of the year when wildfire will occur
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+create_fire_regime">create_fire_regime</a></code>, <code><a href="#topic+fordyn_spatial">fordyn_spatial</a></code>, <code><a href="#topic+fordyn_scenario">fordyn_scenario</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Load example data
data("example_ifn")

# Assume that each stand represents 1km2 = 100 ha
example_ifn$represented_area_ha &lt;- 100

# Define fire regime characteristics
reg1 &lt;- create_fire_regime(c("2002" = 200, "2003" = 500)) 

# Create a fire regime instance
m1 &lt;- fire_regime_instance(example_ifn, reg1)

# Check number of plots burned
colSums(!is.na(m1))

# Define fire regime characteristics with stochastic area burned
reg2 &lt;- create_fire_regime(annual_burned_area = c("2002" = 200, "2003" = 500),
                           sd_burned_area = c("2002" = 0.4, "2003" = 0.5)) 

# Create a fire regime instance
m2 &lt;- fire_regime_instance(example_ifn, reg2)

# Check number of plots burned
colSums(!is.na(m2))

</code></pre>

<hr>
<h2 id='fordyn_scenario'>Scenario of forest dynamics</h2><span id='topic+fordyn_scenario'></span>

<h3>Description</h3>

<p>Evaluates forest dynamics over a landscape including climate and management scenarios
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fordyn_scenario(
  sf,
  SpParams,
  meteo = NULL,
  management_scenario,
  volume_function = NULL,
  volume_arguments = NULL,
  local_control = defaultControl(),
  dispersal_control = default_dispersal_control(),
  dates = NULL,
  CO2ByYear = numeric(0),
  fire_regime = NULL,
  summary_function = NULL,
  summary_arguments = NULL,
  parallelize = FALSE,
  num_cores = detectCores() - 1,
  chunk_size = NULL,
  progress = TRUE,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fordyn_scenario_+3A_sf">sf</code></td>
<td>
<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code> with the following columns:
</p>

<ul>
<li><p><code>geometry</code>: Spatial geometry.
</p>
</li>
<li><p><code>id</code>: Stand identifiers.
</p>
</li>
<li><p><code>elevation</code>: Elevation above sea level (in m).
</p>
</li>
<li><p><code>slope</code>: Slope (in degrees).
</p>
</li>
<li><p><code>aspect</code>: Aspect (in degrees).
</p>
</li>
<li><p><code>forest</code>: Objects of class <code><a href="medfate.html#topic+forest">forest</a></code>.
</p>
</li>
<li><p><code>soil</code>: Objects of class <code><a href="medfate.html#topic+soil">soil</a></code>.
</p>
</li>
<li><p><code>state</code>: Objects of class <code><a href="medfate.html#topic+spwbInput">spwbInput</a></code> or <code><a href="medfate.html#topic+growthInput">growthInput</a></code> (optional).
</p>
</li>
<li><p><code>meteo</code>: Data frames with weather data (required if parameter <code>meteo = NULL</code>).
</p>
</li>
<li><p><code>management_unit</code>: Management unit corresponding to each stand.
</p>
</li>
<li><p><code>represented_area_ha</code>: Area represented by each stand in hectares.
</p>
</li>
<li><p><code>ignition_weights</code>: Relative weights to determine stands to be burned. Optional, relevant when
<code>fire_regime</code> is supplied only).
</p>
</li>
<li><p><code>local_control</code>: A list of control parameters (optional). Used to override function parameter <code>local_control</code> for specific stands (values can be <code>NULL</code> for the remaining ones).
</p>
</li></ul>

<p>Alternatively, the user may supply the result of a previous call to <code>fordyn_scenario</code>, where
to continue simulations.</p>
</td></tr>
<tr><td><code id="fordyn_scenario_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="medfate.html#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
<tr><td><code id="fordyn_scenario_+3A_meteo">meteo</code></td>
<td>
<p>Meteorology data (see <code><a href="#topic+fordyn_spatial">fordyn_spatial</a></code>).</p>
</td></tr>
<tr><td><code id="fordyn_scenario_+3A_management_scenario">management_scenario</code></td>
<td>
<p>A list defining the management scenario (see <code><a href="#topic+create_management_scenario">create_management_scenario</a></code>)</p>
</td></tr>
<tr><td><code id="fordyn_scenario_+3A_volume_function">volume_function</code></td>
<td>
<p>A function accepting a forest object or a tree data table, and a species parameter table, as input and
returning the wood volume (m3/ha) corresponding to each tree cohort. The function may accept additional arguments.
If NULL, the default volume function is used (not recommended!).</p>
</td></tr>
<tr><td><code id="fordyn_scenario_+3A_volume_arguments">volume_arguments</code></td>
<td>
<p>List with additional arguments for the volume function.</p>
</td></tr>
<tr><td><code id="fordyn_scenario_+3A_local_control">local_control</code></td>
<td>
<p>A list of local model control parameters (see <code><a href="medfate.html#topic+defaultControl">defaultControl</a></code>).</p>
</td></tr>
<tr><td><code id="fordyn_scenario_+3A_dispersal_control">dispersal_control</code></td>
<td>
<p>A list of dispersal control parameters (see <code><a href="#topic+default_dispersal_control">default_dispersal_control</a></code>). If NULL, then dispersal is not simulated.</p>
</td></tr>
<tr><td><code id="fordyn_scenario_+3A_dates">dates</code></td>
<td>
<p>A <code><a href="base.html#topic+Date">Date</a></code> object with the days of the period to be simulated. If <code>NULL</code>, then the whole period of <code>meteo</code> is used.</p>
</td></tr>
<tr><td><code id="fordyn_scenario_+3A_co2byyear">CO2ByYear</code></td>
<td>
<p>A named numeric vector with years as names and atmospheric CO2 concentration (in ppm) as values. Used to specify annual changes in CO2 concentration along the simulation (as an alternative to specifying daily values in <code>meteo</code>).</p>
</td></tr>
<tr><td><code id="fordyn_scenario_+3A_fire_regime">fire_regime</code></td>
<td>
<p>A list of parameters defining the fire regime (see <code><a href="#topic+create_fire_regime">create_fire_regime</a></code>) or
a matrix representing a fire regime instance (see <code><a href="#topic+fire_regime_instance">fire_regime_instance</a></code>).
If NULL, wildfires are not simulated. Details are given in <code><a href="#topic+fordyn_spatial">fordyn_spatial</a></code>.</p>
</td></tr>
<tr><td><code id="fordyn_scenario_+3A_summary_function">summary_function</code></td>
<td>
<p>An appropriate function to calculate summaries from an object of class 'fordyn' (e.g., <code><a href="medfate.html#topic+summary.fordyn">summary.fordyn</a></code>).</p>
</td></tr>
<tr><td><code id="fordyn_scenario_+3A_summary_arguments">summary_arguments</code></td>
<td>
<p>List with additional arguments for the summary function.</p>
</td></tr>
<tr><td><code id="fordyn_scenario_+3A_parallelize">parallelize</code></td>
<td>
<p>Boolean flag to try parallelization (will use all clusters minus one).</p>
</td></tr>
<tr><td><code id="fordyn_scenario_+3A_num_cores">num_cores</code></td>
<td>
<p>Integer with the number of cores to be used for parallel computation.</p>
</td></tr>
<tr><td><code id="fordyn_scenario_+3A_chunk_size">chunk_size</code></td>
<td>
<p>Integer indicating the size of chunks to be sent to different processes (by default, the number of spatial elements divided by the number of cores).</p>
</td></tr>
<tr><td><code id="fordyn_scenario_+3A_progress">progress</code></td>
<td>
<p>Boolean flag to display progress information for simulations.</p>
</td></tr>
<tr><td><code id="fordyn_scenario_+3A_verbose">verbose</code></td>
<td>
<p>Boolean flag to display additional console output.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function allows coordinating the dynamics of simulated forest stands via a management scenario
defined at the landscape/regional level (see different kinds of scenarios and how to specify them in <code><a href="#topic+create_management_scenario">create_management_scenario</a></code>).
</p>
<p>The input 'sf' object has to be in a Universal Transverse Mercator (UTM) coordinate system (or any other projection using meters as length unit)
for appropriate behavior of dispersal sub-model.
</p>
<p>For each year to be simulated, the function determines which forest stands will be managed, possibly depending on the demand,
and then calls function <code><a href="#topic+fordyn_spatial">fordyn_spatial</a></code> for one year (normally including parallelization).
If the simulation of some stands results in an error, the function will try to restore
the previous state of the forest stand for the next year steps. Finally, the function evaluates how much of the specified demand
has been fulfilled and stores the results, including demand offsets to be applied the year after.
</p>
<p>Management is implemented using the <code><a href="medfate.html#topic+defaultManagementFunction">defaultManagementFunction</a></code> in medfate,
meaning that management parameters need to follow the structure of <code><a href="medfate.html#topic+defaultManagementArguments">defaultManagementArguments</a></code>
</p>
<p>Details about the inclusion of fire regimes in simulations are explained in <code><a href="#topic+fordyn_spatial">fordyn_spatial</a></code>.
</p>


<h3>Value</h3>

<p>An list of class 'fordyn_scenario' with the following elements:
</p>

<ul>
<li><p><code>result_sf</code>: An object of class 'sf' using a UTM projection and containing four elements:
</p>

<ul>
<li><p><code>geometry</code>: Spatial geometry.
</p>
</li>
<li><p><code>id</code>: Stand id, taken from the input.
</p>
</li>
<li><p><code>tree_table</code>: A list of data frames for each simulated stand, containing the living trees at each time step.
</p>
</li>
<li><p><code>shrub_table</code>: A list of data frames for each simulated stand, containing the living shrub at each time step.
</p>
</li>
<li><p><code>dead_tree_table</code>: A list of data frames for each simulated stand, containing the dead trees at each time step.
</p>
</li>
<li><p><code>dead_shrub_table</code>: A list of data frames for each simulated stand, containing the dead shrub at each time step.
</p>
</li>
<li><p><code>cut_tree_table</code>: A list of data frames for each simulated stand, containing the cut trees at each time step.
</p>
</li>
<li><p><code>cut_shrub_table</code>: A list of data frames for each simulated stand, containing the cut shrub at each time step.
</p>
</li>
<li><p><code>summary</code>: A list of model output summaries for each simulated stand (if <code>summary_function</code> was not <code>NULL</code>).
</p>
</li></ul>


</li>
<li><p><code>result_volumes</code>: A data frame with initial, growth, extracted and final volumes (m3) by year. In demand-based scenarios volumes corresponding to species with demand are also included.
</p>
</li>
<li><p><code>result_volumes_spp</code>: A data frame with growth and extracted volumes (m3) by species and year.
</p>
</li>
<li><p><code>result_volumes_demand</code>: In demand-based scenarios target volumes are also included, a data frame with growth, target and extracted volumes (m3) by demand entity and year. .
</p>
</li>
<li><p><code>next_sf</code>: An object of class 'sf' to continue simulations in subsequent calls to <code>fordyn_scenario</code>.
</p>
</li>
<li><p><code>next_demand</code>: In demand-based scenarios, a list with information (i.e. demand offset by species and last volume growth)
to modify demand in subsequent calls to <code>fordyn_scenario</code>.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>
<p>Aitor Améztegui, UdL
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fordyn_spatial">fordyn_spatial</a></code>, <code><a href="#topic+create_management_scenario">create_management_scenario</a></code>, <code><a href="#topic+dispersal">dispersal</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load example landscape data
data("example_ifn")
  
# Load example meteo data frame from package meteoland
data("examplemeteo")
  
# Load default medfate parameters
data("SpParamsMED")

# Creates scenario with one management unit and annual demand for P. nigra 
scen &lt;- create_management_scenario(1, c("Pinus nigra/Pinus sylvestris" = 2300))

# Assign management unit to all stands
example_ifn$management_unit &lt;- 1 

# Assume that each stand represents 1km2 = 100 ha
example_ifn$represented_area_ha &lt;- 100

# Transform to UTM31 (necessary for dispersal)
example_ifn_utm31 &lt;- sf::st_transform(example_ifn, crs = 32631)

# Subset three plots to speed-up calculations
example_subset &lt;- example_ifn_utm31[31:33, ]

# Launch simulation scenario
fs_12 &lt;- fordyn_scenario(example_subset, SpParamsMED, meteo = examplemeteo, 
                         volume_function = NULL, management_scenario = scen,
                         parallelize = FALSE)

</code></pre>

<hr>
<h2 id='forest_parametrization'>Landscape forest parametrization</h2><span id='topic+forest_parametrization'></span><span id='topic+impute_forests'></span><span id='topic+modify_forest_structure'></span><span id='topic+check_forests'></span>

<h3>Description</h3>

<p>Utility functions to define forest inputs in a landscape:
</p>

<ul>
<li><p><code>impute_forests()</code> performs imputation of forest objects from a forest inventory using a forest map to match forest types and topography as covariates. 
</p>
</li>
<li><p><code>modify_forest_structure()</code> uses forest structure rasters supplied by the user to correct forest structure metrics.
</p>
</li>
<li><p><code>check_forests()</code> checks that forests are defined and do not contain missing values in key tree/shrub attributes.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>impute_forests(
  x,
  sf_fi,
  dem,
  forest_map,
  var_class = NA,
  max_distance_km = 100,
  replace_existing = FALSE,
  missing_class_imputation = FALSE,
  missing_class_forest = NULL,
  merge_trees = TRUE,
  merge_shrubs = TRUE,
  progress = TRUE
)

modify_forest_structure(
  x,
  structure_map,
  variable,
  map_var = NA,
  ratio_limits = NULL,
  minDBH = 7.5,
  progress = TRUE
)

check_forests(x, progress = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="forest_parametrization_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code>. If it contains a column named 'land_cover_type', imputation
will be performed for locations whose land cover is &quot;wildland&quot;. Otherwise, forest imputation is done for all locations.
For structural corrections or when checking, <code>x</code> should already contain a column named 'forest' containing  <code><a href="medfate.html#topic+forest">forest</a></code> objects.</p>
</td></tr>
<tr><td><code id="forest_parametrization_+3A_sf_fi">sf_fi</code></td>
<td>
<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code> with forest inventory data column 'forest'.</p>
</td></tr>
<tr><td><code id="forest_parametrization_+3A_dem">dem</code></td>
<td>
<p>A digital elevation model (class <code><a href="terra.html#topic+rast">rast</a></code>) with meters as units</p>
</td></tr>
<tr><td><code id="forest_parametrization_+3A_forest_map">forest_map</code></td>
<td>
<p>An object of class <code><a href="terra.html#topic+rast">rast</a></code> or <code><a href="terra.html#topic+vect">vect</a></code> with the forest class map</p>
</td></tr>
<tr><td><code id="forest_parametrization_+3A_var_class">var_class</code></td>
<td>
<p>Variable name or index containing forest classes in <code>forest_map</code>. If missing the first column is taken.</p>
</td></tr>
<tr><td><code id="forest_parametrization_+3A_max_distance_km">max_distance_km</code></td>
<td>
<p>Maximum distance, in km, for forest inventory plot imputation.</p>
</td></tr>
<tr><td><code id="forest_parametrization_+3A_replace_existing">replace_existing</code></td>
<td>
<p>A logical flag to force the replacement of existing <code><a href="medfate.html#topic+forest">forest</a></code> objects, when present.</p>
</td></tr>
<tr><td><code id="forest_parametrization_+3A_missing_class_imputation">missing_class_imputation</code></td>
<td>
<p>A logical flag to force imputation in locations where forest class is not defined. If <code>missing_class_imputation = TRUE</code>, imputation in those locations will be based on geographic and topographic criteria only.</p>
</td></tr>
<tr><td><code id="forest_parametrization_+3A_missing_class_forest">missing_class_forest</code></td>
<td>
<p>A <code><a href="medfate.html#topic+forest">forest</a></code> object to be used for locations with missing class.</p>
</td></tr>
<tr><td><code id="forest_parametrization_+3A_merge_trees">merge_trees</code></td>
<td>
<p>A logical flag to simplify tree cohorts by merging tree records in DBH classes (see <code><a href="medfate.html#topic+forest_mergeTrees">forest_mergeTrees</a></code>).</p>
</td></tr>
<tr><td><code id="forest_parametrization_+3A_merge_shrubs">merge_shrubs</code></td>
<td>
<p>A logical flag to simplify shrub cohorts by merging shrub records in height classes (see <code><a href="medfate.html#topic+forest_mergeShrubs">forest_mergeShrubs</a></code>).</p>
</td></tr>
<tr><td><code id="forest_parametrization_+3A_progress">progress</code></td>
<td>
<p>A logical flag to print console output.</p>
</td></tr>
<tr><td><code id="forest_parametrization_+3A_structure_map">structure_map</code></td>
<td>
<p>An object of class <code><a href="terra.html#topic+rast">rast</a></code> or <code><a href="terra.html#topic+vect">vect</a></code> with a forest structural variable map</p>
</td></tr>
<tr><td><code id="forest_parametrization_+3A_variable">variable</code></td>
<td>
<p>Structural variable to correct. See options in details.</p>
</td></tr>
<tr><td><code id="forest_parametrization_+3A_map_var">map_var</code></td>
<td>
<p>Variable name or index containing structural variable in 'structure_map'. If missing the first column is taken.</p>
</td></tr>
<tr><td><code id="forest_parametrization_+3A_ratio_limits">ratio_limits</code></td>
<td>
<p>Limits for ratio of variable in corrections, used to avoid outliers.</p>
</td></tr>
<tr><td><code id="forest_parametrization_+3A_mindbh">minDBH</code></td>
<td>
<p>Minimum diameter for stand metric calculation. If <code>minDBH &gt; 0</code> then those stands with smaller trees will not be corrected
because of the missing stand metric.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function <code>impute_forests()</code> performs imputation of forest inventory plots on target locations provided that
they correspond to the same forest class, defined in the input forest map, and are geographically closer than a distance threshold (<code>max_distance_km</code>).
Among the multiple stands that can have fulfill these two requirements, the function chooses the one that has the most similar elevation
and position in the N-to-S slopes (i.e. the product of the cosine of aspect and slope). Both topographic
features are standardized to zero mean and unit standard deviation (using the supplied digital elevation model to calculate those metrics), to make their
weight on the imputation equal. This imputation method will be more or less successful depending on the resolution of forest classes and
the number of forest inventory plots available for each of them. Additionally, tree and shrub cohorts can be simplified after imputation (<code>merge_trees</code> and <code>merge_shrubs</code>),
to reduce the number of records (and hence, speed-up simulations).
</p>
<p>Function <code>modify_forest_structure()</code> can be used to modify specific structure variables of the imputed forests
building on rasters supplied by the user (typically from aerial or satellite LiDAR products). For any given metric,
the function will calculate the ratio of the structure metric between the target <code><a href="medfate.html#topic+forest">forest</a></code> object (see <code><a href="medfate.html#topic+stand_basalArea">stand_basalArea</a></code>)
and the input map in the target location. Locations where the metric value in the map is missing are left unmodified.
Options for structural variables are the following:
</p>

<ul>
<li><p><code>mean_tree_height</code>: Should contain values in cm. Corrects tree heights and diameters (assuming a constant diameter-height relationship).
</p>
</li>
<li><p><code>dominant_tree_height</code>: Should contain values in cm. Corrects tree heights and diameters (assuming a constant diameter-height relationship).
</p>
</li>
<li><p><code>tree_density</code>: Should contain values in individuals per hectare. Corrects tree density.
</p>
</li>
<li><p><code>basal_area</code>: Should contain values in squared meters per hectare (m2/ha). Corrects tree density.
</p>
</li>
<li><p><code>mean_shrub_height</code>: Should contain values in cm. Corrects shrub cover.
</p>
</li></ul>

<p>Function <code>check_forest()</code> checks first that <code><a href="medfate.html#topic+forest">forest</a></code> objects are defined in &quot;wildland&quot; locations. Then, it looks for missing
data in tree or shrub attributes required for simulations. The function does not modify the data.
</p>


<h3>Value</h3>

<p>Functions <code>impute_forests()</code> and <code>modify_forest_structure()</code> return a modified object of class <code><a href="sf.html#topic+sf">sf</a></code>.
Function <code>check_forests()</code> returns an invisible data frame with columns indicating missing forest data and missing values in tree or shrub parameters.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_topography">add_topography()</a></code>, <code><a href="#topic+add_forests">add_forests()</a></code>, <code><a href="#topic+add_soilgrids">add_soilgrids()</a></code>, <code><a href="medfate.html#topic+forest_mergeTrees">forest_mergeTrees</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># See package vignettes 'Preparing inputs'
</code></pre>

<hr>
<h2 id='initialize_landscape'>Initialization of model inputs for spatially-distributed forest stands</h2><span id='topic+initialize_landscape'></span>

<h3>Description</h3>

<p>Initializes state for local models <code><a href="medfate.html#topic+spwb">spwb</a></code> or <code><a href="medfate.html#topic+growth">growth</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>initialize_landscape(
  x,
  SpParams,
  local_control,
  model = "spwb",
  simplify = FALSE,
  replace = FALSE,
  progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="initialize_landscape_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code> with the following columns:
</p>

<ul>
<li><p><code>geometry</code>: Spatial geometry.
</p>
</li>
<li><p><code>forest</code>: Objects of class <code><a href="medfate.html#topic+forest">forest</a></code>.
</p>
</li>
<li><p><code>soil</code>: Objects of class <code><a href="medfate.html#topic+soil">soil</a></code> or data frames of physical properties.
</p>
</li>
<li><p><code>land_cover_type</code>: Land cover type of each grid cell (values should be 'wildland' or 'agriculture').
</p>
</li>
<li><p><code>crop_factor</code>: Crop evapo-transpiration factor. Only required for 'agriculture' land cover type.
</p>
</li>
<li><p><code>local_control</code>: A list of control parameters (optional). Used to override function parameter <code>local_control</code> for specific cells (values can be <code>NULL</code> for the remaining ones).
</p>
</li></ul>
</td></tr>
<tr><td><code id="initialize_landscape_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="medfate.html#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
<tr><td><code id="initialize_landscape_+3A_local_control">local_control</code></td>
<td>
<p>A list of control parameters (see <code><a href="medfate.html#topic+defaultControl">defaultControl</a></code>).</p>
</td></tr>
<tr><td><code id="initialize_landscape_+3A_model">model</code></td>
<td>
<p>A string to indicate the model, either <code>"spwb"</code> or <code>"growth"</code>.</p>
</td></tr>
<tr><td><code id="initialize_landscape_+3A_simplify">simplify</code></td>
<td>
<p>Boolean flag to simplify forest to the tree and shrub cohorts with largest leaf area index. The leaf area index of the whole tree (respectively, shrub) layer will be attributed to the selected cohort.
See function <code><a href="medfate.html#topic+forest_reduceToDominant">forest_reduceToDominant</a></code>.</p>
</td></tr>
<tr><td><code id="initialize_landscape_+3A_replace">replace</code></td>
<td>
<p>Boolean flag to replace existing initialized states</p>
</td></tr>
<tr><td><code id="initialize_landscape_+3A_progress">progress</code></td>
<td>
<p>Boolean flag to display progress information.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Initialization is dealt automatically when calling simulation functions <code><a href="#topic+spwb_spatial">spwb_spatial</a></code>,  <code><a href="#topic+growth_spatial">growth_spatial</a></code>,
<code><a href="#topic+spwb_spatial_day">spwb_spatial_day</a></code> or <code><a href="#topic+growth_spatial_day">growth_spatial_day</a></code>. However, function <code>initialize_landscape</code>  allows separating initialization from model simulations.
</p>
<p>Option <code>simplify</code> has been implemented to allow simplification of forests to tree/shrub dominant cohorts during watershed simulations
where focus is on runoff (e.g. calibration of watershed parameters or burnin periods). Elements identified as <code>result_cell</code> will not be simplified.
</p>


<h3>Value</h3>

<p>Replaces or adds column 'state' whose elements are <code><a href="medfate.html#topic+spwbInput">spwbInput</a></code> or <code><a href="medfate.html#topic+growthInput">growthInput</a></code> objects
and returns the modified object of class 'sf'.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb_spatial">spwb_spatial</a></code>, <code><a href="#topic+spwb_spatial_day">spwb_spatial_day</a></code>,
<code><a href="#topic+update_landscape">update_landscape</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Load example landscape data
data("example_ifn")
  
# Load example meteo data frame from package meteoland
data("examplemeteo")
  
# Load default medfate parameters
data("SpParamsMED")
  
# Initialize state for 'spwb' simulations
example_ifn_init &lt;- initialize_landscape(example_ifn, SpParamsMED, 
                                         defaultControl(), model = "spwb")

</code></pre>

<hr>
<h2 id='landscape_summary'>Forest and soil summaries over space</h2><span id='topic+landscape_summary'></span>

<h3>Description</h3>

<p>Functions to calculates a summary function for the forest or soil of all spatial elements
in an object of class <code><a href="sf.html#topic+sf">sf</a></code> containing landscape information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>landscape_summary(
  object,
  name,
  summary_function,
  ...,
  unlist = FALSE,
  progress = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="landscape_summary_+3A_object">object</code></td>
<td>
<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code>.</p>
</td></tr>
<tr><td><code id="landscape_summary_+3A_name">name</code></td>
<td>
<p>A string of the element to summarize: &quot;forest&quot;, &quot;soil&quot; or &quot;state&quot;.</p>
</td></tr>
<tr><td><code id="landscape_summary_+3A_summary_function">summary_function</code></td>
<td>
<p>A function that accepts objects of class <code><a href="medfate.html#topic+forest">forest</a></code>, <code>soil</code> or model input objects, respectively.</p>
</td></tr>
<tr><td><code id="landscape_summary_+3A_...">...</code></td>
<td>
<p>Additional arguments to the summary function.</p>
</td></tr>
<tr><td><code id="landscape_summary_+3A_unlist">unlist</code></td>
<td>
<p>Logical flag to try converting the summaries into different columns</p>
</td></tr>
<tr><td><code id="landscape_summary_+3A_progress">progress</code></td>
<td>
<p>Boolean flag to display progress information</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code> containing the calculated statistics.
If <code>unlist = FALSE</code> column 'summary' is a list with summaries for each element.
If <code>unlist = TRUE</code> different columns are returned instead, one per variable given in the summary function.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF.
</p>


<h3>See Also</h3>

<p><code><a href="medfate.html#topic+forest">forest</a></code>, <code><a href="medfate.html#topic+soil">soil</a></code>, <code><a href="medfate.html#topic+summary.forest">summary.forest</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Load plot data and species parameters from medfate
data(example_ifn)

# Load default medfate parameters
data("SpParamsMED")
 
# Apply forest summary function
landscape_summary(example_ifn, "forest", summary.forest, SpParamsMED)
 
</code></pre>

<hr>
<h2 id='plot_summary'>Displays spatial simulation summaries</h2><span id='topic+plot_summary'></span>

<h3>Description</h3>

<p>Produces graphical output of the summaries of a simulation models
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_summary(x, variable, date, r = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_summary_+3A_x">x</code></td>
<td>
<p>An object of class <code>sf</code>, with simulation summaries.</p>
</td></tr>
<tr><td><code id="plot_summary_+3A_variable">variable</code></td>
<td>
<p>The variable to be drawn.</p>
</td></tr>
<tr><td><code id="plot_summary_+3A_date">date</code></td>
<td>
<p>The date of the summary to be plotted.</p>
</td></tr>
<tr><td><code id="plot_summary_+3A_r">r</code></td>
<td>
<p>An object of class <code><a href="terra.html#topic+rast">rast</a></code>, defining the raster topology.</p>
</td></tr>
<tr><td><code id="plot_summary_+3A_...">...</code></td>
<td>
<p>Additional parameters (passed to scale definition, such as <code>limits</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Appropriate values for <code>x</code> can originate from calls to <code><a href="#topic+simulation_summary">simulation_summary</a></code>.
Alternatively, if summary functions were specified at the time of performing simulations,
the result of the spatial simulation function (e.g. <code><a href="#topic+spwb_spatial">spwb_spatial</a></code>)
will already contain the summaries. A special case is made for <code><a href="#topic+spwb_land">spwb_land</a></code> and <code><a href="#topic+growth_land">growth_land</a></code>,
that are accepted inputs as <code>x</code>, because its element 'sf' is used.
</p>


<h3>Value</h3>

<p>An object of class <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code>.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb_spatial">spwb_spatial</a></code>, <code><a href="#topic+simulation_summary">simulation_summary</a></code>
</p>

<hr>
<h2 id='shinyplot_land'>Shiny app with interactive plots and maps</h2><span id='topic+shinyplot_land'></span>

<h3>Description</h3>

<p>Creates a shiny app with interactive plots for spatial inputs and simulation results
</p>


<h3>Usage</h3>

<pre><code class='language-R'>shinyplot_land(x, SpParams = NULL, r = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="shinyplot_land_+3A_x">x</code></td>
<td>
<p>The object of class 'sf' containing information to be drawn (see details). Alternatively, an object of class 'spwb_land', 'growth_land' or 'fordyn_land'.</p>
</td></tr>
<tr><td><code id="shinyplot_land_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="medfate.html#topic+SpParamsMED">SpParamsMED</a></code>), required for most forest stand variables.</p>
</td></tr>
<tr><td><code id="shinyplot_land_+3A_r">r</code></td>
<td>
<p>An object of class <code><a href="terra.html#topic+rast">rast</a></code>, defining the raster topology.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Only run this function in interactive mode. The shiny app can be used to display spatial inputs or simulation results.
</p>
<p><em>Spatial inputs</em>:
This is the case if the user supplies an object of class <code><a href="sf.html#topic+sf">sf</a></code> with simulation inputs.
</p>
<p><em>Simulation result summaries</em>:
This is the case if the user supplies an object of class <code><a href="sf.html#topic+sf">sf</a></code> with simulation summaries. Available plots depend on the summary function used to create the result summaries.
</p>


<h3>Value</h3>

<p>An object that represents the shiny app
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot_summary">plot_summary</a></code>, <code><a href="#topic+extract_variables">extract_variables</a></code>
</p>

<hr>
<h2 id='simulation_summary'>Summarizes spatial simulation results</h2><span id='topic+simulation_summary'></span>

<h3>Description</h3>

<p>Creates spatial objects containing summaries of simulations
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulation_summary(object, summary_function, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simulation_summary_+3A_object">object</code></td>
<td>
<p>An object of class 'sf' simulation results (e.g. the result of calling <code><a href="#topic+spwb_spatial">spwb_spatial</a></code>).</p>
</td></tr>
<tr><td><code id="simulation_summary_+3A_summary_function">summary_function</code></td>
<td>
<p>The summary function to be executed on simulation results (see details).</p>
</td></tr>
<tr><td><code id="simulation_summary_+3A_...">...</code></td>
<td>
<p>Additional parameters to the summary function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function supplied should take as input an object of local simulation function, i.e. <code><a href="medfate.html#topic+spwb">spwb</a></code>, <code><a href="medfate.html#topic+growth">growth</a></code>, or <code><a href="medfate.html#topic+fordyn">fordyn</a></code>.
The output should be a matrix with dates as rows and variables in columns.
An example of suitable function is <code><a href="medfate.html#topic+summary.spwb">summary.spwb</a></code>.
</p>


<h3>Value</h3>

<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code>, with the following two elements:
</p>

<ul>
<li><p><code>geometry</code>: Spatial geometry.
</p>
</li>
<li><p><code>id</code>: Stand id, taken from the input.
</p>
</li>
<li><p><code>summary</code>: A list of model output summaries for each simulated location.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb_spatial">spwb_spatial</a></code>, <code><a href="#topic+plot_summary">plot_summary</a></code>
</p>

<hr>
<h2 id='soil_parametrization'>Landscape soil parametrization</h2><span id='topic+soil_parametrization'></span><span id='topic+add_soilgrids'></span><span id='topic+modify_soils'></span><span id='topic+check_soils'></span>

<h3>Description</h3>

<p>Function <code>add_soilgrids</code> fills column 'soil' with physical soil characteristics drawn from SoilGrids 2.0 (Hengl et al. 2017; Poggio et al. 2021).
Function <code>modify_soils</code> modifies soil definition according to soil depth and depth to bedrock information.
Function <code>check_soils</code> verifies that soil data does not contain missing values for key variables and, if so, assigns default values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_soilgrids(
  x,
  soilgrids_path = NULL,
  widths = NULL,
  replace_existing = TRUE,
  progress = TRUE
)

modify_soils(
  x,
  soil_depth_map = NULL,
  depth_to_bedrock_map = NULL,
  regolith_rfc = 97.5,
  full_rock_filling = TRUE,
  progress = TRUE
)

check_soils(
  x,
  check_equal_layers = FALSE,
  fill_missing = FALSE,
  default_values = c(clay = 25, sand = 25, bd = 1.5, rfc = 25),
  progress = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="soil_parametrization_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code> with a valid CRS definition. If it contains a column called 'land_cover_type', soils will be retrieved for &quot;agriculture&quot; and &quot;wildland&quot;
cover types only. Otherwise, soils are retrieved for all locations. For functions <code>modify_soils</code> or <code>check_soils</code>, <code>x</code> should already contain a column named &quot;soil&quot;.</p>
</td></tr>
<tr><td><code id="soil_parametrization_+3A_soilgrids_path">soilgrids_path</code></td>
<td>
<p>Path to SoilGrids rasters (see details). If missing, the SoilGrids REST API (https://rest.isric.org) will be queried.</p>
</td></tr>
<tr><td><code id="soil_parametrization_+3A_widths">widths</code></td>
<td>
<p>A numeric vector indicating the desired layer widths, in <em>mm</em>. If <code>NULL</code> the default soil grids layer definition is returned.</p>
</td></tr>
<tr><td><code id="soil_parametrization_+3A_replace_existing">replace_existing</code></td>
<td>
<p>A logical flag to force the replacement of existing soil data, when already present</p>
</td></tr>
<tr><td><code id="soil_parametrization_+3A_progress">progress</code></td>
<td>
<p>A logical flag to include a progress bar while processing the output of the query to the SoilGrids REST API.</p>
</td></tr>
<tr><td><code id="soil_parametrization_+3A_soil_depth_map">soil_depth_map</code></td>
<td>
<p>An object of class <code><a href="terra.html#topic+rast">rast</a></code> or <code><a href="terra.html#topic+vect">vect</a></code> with the soil depth (in <em>mm</em>) values.</p>
</td></tr>
<tr><td><code id="soil_parametrization_+3A_depth_to_bedrock_map">depth_to_bedrock_map</code></td>
<td>
<p>An object of class <code><a href="terra.html#topic+rast">rast</a></code> or <code><a href="terra.html#topic+vect">vect</a></code> with depth to bedrock (in <em>mm</em>) values.</p>
</td></tr>
<tr><td><code id="soil_parametrization_+3A_regolith_rfc">regolith_rfc</code></td>
<td>
<p>Rock fragment content, in percent volume, between soil depth and 200cm depth (or lower depths, if modified via <code>widths</code>).</p>
</td></tr>
<tr><td><code id="soil_parametrization_+3A_full_rock_filling">full_rock_filling</code></td>
<td>
<p>Logical flag to modify rock fragment content in all soil layers with according to distance to soil depth.</p>
</td></tr>
<tr><td><code id="soil_parametrization_+3A_check_equal_layers">check_equal_layers</code></td>
<td>
<p>Logical flag to test whether soils have the same number of layers.</p>
</td></tr>
<tr><td><code id="soil_parametrization_+3A_fill_missing">fill_missing</code></td>
<td>
<p>Logical flag to fill missing values in key parameters with defaults.</p>
</td></tr>
<tr><td><code id="soil_parametrization_+3A_default_values">default_values</code></td>
<td>
<p>Vector of default values for locations with missing data.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>soilgrids_path = NULL</code> the function connects with the SoilGrids REST API (https://rest.isric.org)
to retrieve the soil physical and chemical characteristics for a site (Hengl <em>et al</em>. 2007; Poggio et al. 2021), selected
by its coordinates. Also, in case the depths are not the default ones in the SoilGrids API, the function uses
averages the values of soil grid layers depending on the overlap between soil layer definitions. Unfortunately,
SoilGrids REST API queries are limited to a few points.
</p>
<p>If <code>soilgrids_path != NULL</code> the function will read SoilGrid rasters from the file disk. Folders need to be defined
for each variable (&quot;sand&quot;, &quot;clay&quot;, &quot;soc&quot;, &quot;bdod&quot;, &quot;cfvo&quot; and &quot;nitrogen&quot;). File paths from <code>soilgrids_path</code> should be named:
</p>
<p><em>var</em>/<em>var</em>_<em>layer</em>_mean.tif
</p>
<p>where <em>var</em> is one of the above and <em>layer</em> is &quot;0-5cm&quot;, &quot;5-15cm&quot;, &quot;15-30cm&quot;, &quot;30-60cm&quot;, &quot;60-100cm&quot; or &quot;100-200cm&quot;
</p>
<p>SoilGrids does not provide soil depth estimates. Function <code>modify_soils</code> is designed to adjust soil depths according to available information.
When <code>soil_depth_map</code> is provided, the function adjusts rock fragment content of layers below soil depth with the value of <code>regolith_rfc</code>.
When <code>depth_to_bedrock_map</code> is provided, the function truncates the total depth of the soil definition to the depth to bedrock.
If regional maps of soil depth are not available, users are recommended to resort on Shangguan et al (2017).
</p>


<h3>Value</h3>

<p>A modified object of class <code><a href="sf.html#topic+sf">sf</a></code> with column 'soil'.
</p>


<h3>Author(s)</h3>

<p>Víctor Granda, EMF-CREAF
</p>
<p>Miquel De Cáceres Ainsa, EMF-CREAF
</p>


<h3>References</h3>

<p>Hengl T, Mendes de Jesus J, Heuvelink GBM, Ruiperez Gonzalez M, Kilibarda M, Blagotić A, et al. (2017) SoilGrids250m: Global gridded soil information based on machine learning. PLoS ONE 12(2): e0169748. doi:10.1371/journal.pone.0169748.
</p>
<p>Poggio L, de Sousa LM, Batjes NH, Heuvelink GBM, Kempen B, Ribeiro E, Rossiter D (2021). SoilGrids 2.0: producing soil information for the globe with quantified spatial uncertainty. SOIL 7, 217-240. doi: 10.5194/soil-7-217-2021
</p>
<p>Shangguan W, Hengl T, Mendes de Jesus J, Yuan H, Dai J (2017). Mapping the global depth to bedrock for land surface modeling. Journal of Advances in Modeling Earth Systems 9: 65-88. doi: 10.1002/2016MS000686
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_topography">add_topography()</a></code>, <code><a href="#topic+impute_forests">impute_forests()</a></code>, <code><a href="medfate.html#topic+soil">soil</a></code>, <code><a href="medfate.html#topic+defaultSoilParams">defaultSoilParams</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> 
   library(sf)
   x &lt;- st_sf(geometry = st_sfc(st_point(c(-5.6333, 42.6667)), crs = 4326))
   x_soil &lt;- add_soilgrids(x, widths = c(300, 700, 1000))
   x_soil
   # See more complete examples in package vignettes 'Preparing inputs'
 

</code></pre>

<hr>
<h2 id='spwb_land'>Watershed simulations</h2><span id='topic+spwb_land'></span><span id='topic+growth_land'></span><span id='topic+fordyn_land'></span><span id='topic+cell_neighbors'></span><span id='topic+summary.spwb_land'></span><span id='topic+summary.growth_land'></span>

<h3>Description</h3>

<p>Functions to perform simulations on a watershed described by a set of connected grid cells.
</p>

<ul>
<li><p>Function <code>spwb_land</code> implements a distributed hydrological model that simulates daily local water balance, from <code><a href="medfate.html#topic+spwb_day">spwb_day</a></code>,
on grid cells of a watershed while accounting for overland runoff, subsurface flow and groundwater flow between cells.
</p>
</li>
<li><p>Function <code>growth_land</code> is similar to <code>spwb_land</code>, but includes daily local carbon balance, growth and mortality processes in grid cells,
provided by <code><a href="medfate.html#topic+growth_day">growth_day</a></code>.
</p>
</li>
<li><p>Function <code>fordyn_land</code> extends the previous two functions with the simulation of management, seed dispersal, recruitment
and resprouting.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>spwb_land(
  r,
  sf,
  SpParams,
  meteo = NULL,
  dates = NULL,
  CO2ByYear = numeric(0),
  summary_frequency = "years",
  local_control = medfate::defaultControl(),
  watershed_control = default_watershed_control(),
  parallelize = FALSE,
  num_cores = detectCores() - 1,
  chunk_size = NULL,
  progress = TRUE
)

growth_land(
  r,
  sf,
  SpParams,
  meteo = NULL,
  dates = NULL,
  CO2ByYear = numeric(0),
  summary_frequency = "years",
  local_control = medfate::defaultControl(),
  watershed_control = default_watershed_control(),
  parallelize = FALSE,
  num_cores = detectCores() - 1,
  chunk_size = NULL,
  progress = TRUE
)

fordyn_land(
  r,
  sf,
  SpParams,
  meteo = NULL,
  dates = NULL,
  CO2ByYear = numeric(0),
  local_control = medfate::defaultControl(),
  watershed_control = default_watershed_control(),
  dispersal_control = default_dispersal_control(),
  management_function = NULL,
  parallelize = FALSE,
  num_cores = detectCores() - 1,
  chunk_size = NULL,
  progress = TRUE
)

cell_neighbors(sf, r)

## S3 method for class 'spwb_land'
summary(object, ...)

## S3 method for class 'growth_land'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spwb_land_+3A_r">r</code></td>
<td>
<p>An object of class <code><a href="terra.html#topic+SpatRaster">SpatRaster</a></code>, defining the raster topology.</p>
</td></tr>
<tr><td><code id="spwb_land_+3A_sf">sf</code></td>
<td>
<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code> with the following columns:
</p>

<ul>
<li><p><code>geometry</code>: Spatial point geometry corresponding to cell centers.
</p>
</li>
<li><p><code>elevation</code>: Elevation above sea level (in m).
</p>
</li>
<li><p><code>slope</code>: Slope (in degrees).
</p>
</li>
<li><p><code>aspect</code>: Aspect (in degrees).
</p>
</li>
<li><p><code>land_cover_type</code>: Land cover type of each grid cell (values should be 'wildland', 'agriculture', 'rock', 'artificial' or 'water').
</p>
</li>
<li><p><code>forest</code>: Objects of class <code><a href="medfate.html#topic+forest">forest</a></code>.
</p>
</li>
<li><p><code>soil</code>: Objects of class <code><a href="medfate.html#topic+soil">soil</a></code> or data frames of physical properties.
</p>
</li>
<li><p><code>state</code>: Objects of class <code><a href="medfate.html#topic+spwbInput">spwbInput</a></code> or <code><a href="medfate.html#topic+growthInput">growthInput</a></code> (optional).
</p>
</li>
<li><p><code>meteo</code>: Data frames with weather data (required if parameter <code>meteo = NULL</code>).
</p>
</li>
<li><p><code>crop_factor</code>: Crop evapo-transpiration factor. Only required for 'agriculture' land cover type.
</p>
</li>
<li><p><code>local_control</code>: A list of control parameters (optional). Used to override function parameter <code>local_control</code> for specific cells (values can be <code>NULL</code> for the remaining ones).
</p>
</li>
<li><p><code>snowpack</code>: An optional numeric vector with the snow water equivalent content of the snowpack in each cell (in mm). If missing it will be initialized to zero.
</p>
</li>
<li><p><code>management_arguments</code>: Lists with management arguments (optional, relevant for <code>fordyn_land</code> only).
</p>
</li>
<li><p><code>result_cell</code>: A logical indicating that local model results are desired (optional, relevant for <code>spwb_land</code> and  <code>growth_land</code> only). Model results are only produced for wildland and agriculture cells. 
</p>
</li></ul>

<p>When using TETIS watershed model, the following columns are also REQUIRED:
</p>

<ul>
<li><p><code>depth_to_bedrock</code>: Depth to bedrock (mm).
</p>
</li>
<li><p><code>bedrock_conductivity</code>: Bedrock (saturated) conductivity (in m·day-1).
</p>
</li>
<li><p><code>bedrock_porosity</code>: Bedrock porosity (the proportion of pore space in the rock).
</p>
</li></ul>

<p>When using TETIS watershed model, the following columns are OPTIONAL:
</p>

<ul>
<li><p><code>aquifer</code>: A numeric vector with the water content of the aquifer in each cell (in mm). If missing, it will be initialized to zero.
</p>
</li>
<li><p><code>deep_aquifer_loss</code>: A numeric vector with the maximum daily loss to a deeper aquifer (in mm·day-1). If missing all cells take their value from <code>deep_aquifer_loss</code> in <code><a href="#topic+default_watershed_control">default_watershed_control</a></code>
</p>
</li></ul>
</td></tr>
<tr><td><code id="spwb_land_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="medfate.html#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
<tr><td><code id="spwb_land_+3A_meteo">meteo</code></td>
<td>
<p>Input meteorological data (see <code><a href="#topic+spwb_spatial">spwb_spatial</a></code> and details).</p>
</td></tr>
<tr><td><code id="spwb_land_+3A_dates">dates</code></td>
<td>
<p>A <code><a href="base.html#topic+Date">Date</a></code> object describing the days of the period to be modeled.</p>
</td></tr>
<tr><td><code id="spwb_land_+3A_co2byyear">CO2ByYear</code></td>
<td>
<p>A named numeric vector with years as names and atmospheric CO2 concentration (in ppm) as values. Used to specify annual changes in CO2 concentration along the simulation (as an alternative to specifying daily values in <code>meteo</code>).</p>
</td></tr>
<tr><td><code id="spwb_land_+3A_summary_frequency">summary_frequency</code></td>
<td>
<p>Frequency in which cell summary will be produced (e.g. &quot;years&quot;, &quot;months&quot;, ...) (see <code><a href="base.html#topic+cut.Date">cut.Date</a></code>).
In <code>fordyn_land</code> summaries are always produced at monthly resolution.</p>
</td></tr>
<tr><td><code id="spwb_land_+3A_local_control">local_control</code></td>
<td>
<p>A list of control parameters (see <code><a href="medfate.html#topic+defaultControl">defaultControl</a></code>) for function <code><a href="medfate.html#topic+spwb_day">spwb_day</a></code> or <code><a href="medfate.html#topic+growth_day">growth_day</a></code>.</p>
</td></tr>
<tr><td><code id="spwb_land_+3A_watershed_control">watershed_control</code></td>
<td>
<p>A list of watershed control parameters (see <code><a href="#topic+default_watershed_control">default_watershed_control</a></code>). Importantly, the sub-model used
for lateral water flows - either Francés et al. (2007) or Caviedes-Voullième et al. (2023) - is specified there.</p>
</td></tr>
<tr><td><code id="spwb_land_+3A_parallelize">parallelize</code></td>
<td>
<p>Boolean flag to try parallelization (see details).</p>
</td></tr>
<tr><td><code id="spwb_land_+3A_num_cores">num_cores</code></td>
<td>
<p>Integer with the number of cores to be used for parallel computation (by default it will use all clusters minus one).</p>
</td></tr>
<tr><td><code id="spwb_land_+3A_chunk_size">chunk_size</code></td>
<td>
<p>Integer indicating the size of chunks to be sent to different processes (by default, the number of spatial elements divided by the number of cores).</p>
</td></tr>
<tr><td><code id="spwb_land_+3A_progress">progress</code></td>
<td>
<p>Boolean flag to display progress information for simulations.</p>
</td></tr>
<tr><td><code id="spwb_land_+3A_dispersal_control">dispersal_control</code></td>
<td>
<p>A list of dispersal control parameters (see <code><a href="#topic+default_dispersal_control">default_dispersal_control</a></code>). If NULL, then dispersal is not simulated.</p>
</td></tr>
<tr><td><code id="spwb_land_+3A_management_function">management_function</code></td>
<td>
<p>A function that implements forest management actions (see <code><a href="medfate.html#topic+fordyn">fordyn</a></code>).
of such lists, one per spatial unit.</p>
</td></tr>
<tr><td><code id="spwb_land_+3A_object">object</code></td>
<td>
<p>An object of class <code>spwb_land</code> or <code>groth_land</code></p>
</td></tr>
<tr><td><code id="spwb_land_+3A_...">...</code></td>
<td>
<p>Additional parameters for summary functions</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Two sub-models are available for lateral water transfer processes (overland flow, sub-surface flow, etc.), either &quot;TETIS&quot;
(similar to Francés et al. 2007) or &quot;SERGHEI&quot; (Caviedes-Voullième et al. 2023).
</p>
<p>IMPORTANT: medfateland needs to be compiled along with SERGHEI model in order to launch simulations with using this
distributed hydrological model.
</p>
<p>When running <code>fordyn_land</code>, the input 'sf' object has to be in a Universal Transverse Mercator (UTM) coordinate system (or any other projection using meters as length unit)
for appropriate behavior of dispersal sub-model.
</p>
<p>Parallel computation is only recommended for watersheds with large number of grid cells (e.g. &gt; 10,000 when using <code>transpirationMode = "granier"</code>).
In watershed with a small number of cells, parallel computation can result in larger processing times than sequential computation, due
to the communication overload.
</p>
<p>When dealing with large data sets, weather data included in the 'sf' object will likely be very data hungry. In those cases, it is
recommended to resort on weather interpolation (see <code><a href="#topic+spwb_spatial">spwb_spatial</a></code>). Weather interpolation can be done using a coarser resolution
than that of raster 'r', by changing the watershed control parameter called 'weather_aggregation_factor' (see <code><a href="#topic+default_watershed_control">default_watershed_control</a></code>).
</p>


<h3>Value</h3>

<p>Functions <code>spwb_land</code>, <code>growth_land</code> and <code>fordyn_land</code> return a list of class of the same name as the function with the following elements:
</p>

<ul>
<li><p><code>watershed_control</code>: A list with input control parameters.
</p>
</li>
<li><p><code>sf</code>: An object of class <code><a href="sf.html#topic+sf">sf</a></code>, similar to the output of <code><a href="#topic+spwb_spatial">spwb_spatial</a></code>,
with the following columns:
</p>

<ul>
<li><p><code>geometry</code>: Spatial geometry.
</p>
</li>
<li><p><code>state</code>: A list of model input objects for each simulated stand.
</p>
</li>
<li><p><code>aquifer</code>: A numeric vector with the water volume in the aquifer of each cell.
</p>
</li>
<li><p><code>snowpack</code>: A numeric vector with the snowpack water equivalent volume of each cell.
</p>
</li>
<li><p><code>summary</code>: A list of cell summaries, containing the following variables:
</p>

<ul>
<li><p><code>MinTemperature</code>: Minimum temperature (degrees Celsius).
</p>
</li>
<li><p><code>MaxTemperature</code>: Maximum temperature (degrees Celsius).
</p>
</li>
<li><p><code>PET</code>: Potential evapotranspiration (in mm).
</p>
</li>
<li><p><code>Rain</code>: Rainfall (in mm).
</p>
</li>
<li><p><code>Snow</code>: Snowfall (in mm).
</p>
</li>
<li><p><code>Snowmelt</code>: Snow melt (in mm).
</p>
</li>
<li><p><code>Interception</code>: Rainfall interception (in mm).
</p>
</li>
<li><p><code>NetRain</code>: Net rainfall, i.e. throughfall, (in mm).
</p>
</li>
<li><p><code>Infiltration</code>: The amount of water infiltrating into the soil (in mm).
</p>
</li>
<li><p><code>InfiltrationExcess</code>: The amount of water exceeding the soil infiltration capacity (in mm).
</p>
</li>
<li><p><code>SaturationExcess</code>: The amount of water that reaches the soil surface because of soil saturation (in mm).
</p>
</li>
<li><p><code>Runon</code>: The amount of water reaching the cell via surface runon (in mm).
</p>
</li>
<li><p><code>Runoff</code>: The amount of water exported from the cell via surface runoff (in mm).
</p>
</li>
<li><p><code>DeepDrainage</code>: The amount of water draining from soil to the aquifer via deep drainage (in mm).
</p>
</li>
<li><p><code>CapillarityRise</code>: Water entering the soil via capillarity rise (mm) from the water table.
</p>
</li>
<li><p><code>SoilEvaporation</code>: Bare soil evaporation (in mm).
</p>
</li>
<li><p><code>Transpiration</code>: Woody plant transpiration (in mm).
</p>
</li>
<li><p><code>HerbTranspiration</code>: Herbaceous transpiration (in mm).
</p>
</li>
<li><p><code>InterflowInput</code>: The amount of water that reaches the soil of the cell from adjacent cells via subsurface flow (in mm).
</p>
</li>
<li><p><code>InterflowOutput</code>: The amount of water that leaves the soil of the cell towards adjacent cells via subsurface flow (in mm).
</p>
</li>
<li><p><code>InterflowBalance</code>: The balance of water circulating via subsurface flow (in mm).
</p>
</li>
<li><p><code>BaseflowInput</code>: The amount of water that reaches the aquifer of the cell from adjacent cells via groundwater flow (in mm).
</p>
</li>
<li><p><code>BaseflowOutput</code>: The amount of water that leaves the aquifer of the cell towards adjacent cells via groundwater flow (in mm).
</p>
</li>
<li><p><code>BaseflowBalance</code>: The balance of water circulating via groundwater flow (in mm).
</p>
</li>
<li><p><code>AquiferExfiltration</code>: The amount of water of the cell that generates surface runoff due to the aquifer reaching the soil surface (in mm).
</p>
</li>
<li><p><code>SWE</code>: Snow water equivalent (in mm) of the snowpack.
</p>
</li>
<li><p><code>RWC</code>: Soil relative water content with respect to field capacity (in percent).
</p>
</li>
<li><p><code>SoilVol</code>: Soil water volume integrated across vertical layers (in mm).
</p>
</li>
<li><p><code>WTD</code>: Saturated soil water table depth (in mm from surface).
</p>
</li>
<li><p><code>DTA</code>: Depth to aquifer (in m from surface).
</p>
</li></ul>


</li>
<li><p><code>result</code>: A list of cell detailed results (only for those indicated in the input), with contents depending on the local model.
</p>
</li>
<li><p><code>outlet</code>: A logical vector indicating outlet cells.
</p>
</li></ul>

<p>In function <code>fordyn_land</code> the <code><a href="sf.html#topic+sf">sf</a></code> object contains additional columns:
</p>

<ul>
<li><p><code>forest</code>: A list of <code><a href="medfate.html#topic+forest">forest</a></code> objects for each simulated stand, to be used in subsequent simulations (see <code><a href="#topic+update_landscape">update_landscape</a></code>).
</p>
</li>
<li><p><code>management_arguments</code>: A list of management arguments for each simulated stand, to be used in subsequent simulations (see <code><a href="#topic+update_landscape">update_landscape</a></code>).
</p>
</li>
<li><p><code>tree_table</code>: A list of data frames for each simulated stand, containing the living trees at each time step.
</p>
</li>
<li><p><code>shrub_table</code>: A list of data frames for each simulated stand, containing the living shrub at each time step.
</p>
</li>
<li><p><code>dead_tree_table</code>: A list of data frames for each simulated stand, containing the dead trees at each time step.
</p>
</li>
<li><p><code>dead_shrub_table</code>: A list of data frames for each simulated stand, containing the dead shrub at each time step.
</p>
</li>
<li><p><code>cut_tree_table</code>: A list of data frames for each simulated stand, containing the cut trees at each time step.
</p>
</li>
<li><p><code>cut_shrub_table</code>: A list of data frames for each simulated stand, containing the cut shrub at each time step.
</p>
</li></ul>


</li>
<li><p><code>watershed_balance</code>: A data frame with as many rows as days and where columns are components of the water balance at the watershed level (i.e., rain, snow, interception, infiltration, soil evaporation, plant transpiration, ...).
</p>
</li>
<li><p><code>watershed_soil_balance</code>: A data frame with as many rows as days and where columns are components of the water balance at the watershed level restricted to those cells with a soil definition.
</p>
</li>
<li><p><code>outlet_export_m3s</code>: A matrix with daily values of runoff (in m3/s) reaching each of the outlet cells of the landscape. Each outlet drains its own subset of cells, so the
overall watershed export corresponds to the sum of row values.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF.
</p>
<p>Maria González-Sanchís, Universitat Politecnica de Valencia.
</p>
<p>Daniel Caviedes-Voullième, Forschungszentrum Julich.
</p>
<p>Mario Morales-Hernández, Universidad de Zaragoza.
</p>


<h3>References</h3>

<p>Francés, F., Vélez, J.I. &amp; Vélez, J.J. (2007). Split-parameter structure for the automatic calibration of distributed hydrological models. Journal of Hydrology, 332, 226–240.
</p>
<p>Caviedes-Voullième, D., Morales-Hernández, M., Norman, M.R. &amp; Ogzen-Xian, I. (2023). SERGHEI (SERGHEI-SWE) v1.0: a performance-portable high-performance parallel-computing shallow-water solver for hydrology and environmental hydraulics. Geoscientific Model Development, 16, 977-1008.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+default_watershed_control">default_watershed_control</a></code>, <code><a href="#topic+initialize_landscape">initialize_landscape</a></code>, <code><a href="#topic+spwb_land_day">spwb_land_day</a></code>, <code><a href="medfate.html#topic+spwb_day">spwb_day</a></code>,  <code><a href="medfate.html#topic+growth_day">growth_day</a></code>,
<code><a href="#topic+spwb_spatial">spwb_spatial</a></code>, <code><a href="#topic+fordyn_spatial">fordyn_spatial</a></code>, <code><a href="#topic+dispersal">dispersal</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load example watershed data
data("example_watershed")

# Set crop factor 
example_watershed$crop_factor &lt;- NA
example_watershed$crop_factor[example_watershed$land_cover_type=="agriculture"] &lt;- 0.75

# Set request for daily model results in cells number 3, 6 (outlet) and 9
example_watershed$result_cell &lt;- FALSE
example_watershed$result_cell[c(3,6,9)] &lt;- TRUE

# Get bounding box to determine limits
b &lt;- sf::st_bbox(example_watershed)
b

# Define a raster topology, using terra package, 
# with the same CRS as the watershed. In this example cells have 100 m side.
# Coordinates in the 'sf' object are assumed to be cell centers
r &lt;-terra::rast(xmin = 401380, ymin = 4671820, xmax = 402880, ymax = 4672620, 
                nrow = 8, ncol = 15, crs = "epsg:32631")

# Load example meteo data frame from package meteoland
data("examplemeteo")
  
# Load default medfate parameters
data("SpParamsMED")
  
# Set simulation period
dates &lt;- seq(as.Date("2001-01-01"), as.Date("2001-03-31"), by="day")

# Watershed control parameters (TETIS model; Frances et al. 2007)
ws_control &lt;- default_watershed_control("tetis")

# Launch simulations 
res &lt;- spwb_land(r, example_watershed, SpParamsMED, examplemeteo, 
                 dates = dates, summary_frequency = "month",
                 watershed_control = ws_control)
                 
# Print a summary of water balance components
summary(res)

# Option 'simplify = TRUE' in initialization, may be useful to speed up calculations
example_simplified &lt;- initialize_landscape(example_watershed, SpParams = SpParamsMED,
                                           local_control = defaultControl(), 
                                           simplify = TRUE)

# Launch simulations overs simplified landscape (should be considerably faster)
res_simplified &lt;- spwb_land(r, example_simplified, SpParamsMED, examplemeteo, 
                            dates = dates, summary_frequency = "month",
                            watershed_control = ws_control)


</code></pre>

<hr>
<h2 id='spwb_land_day'>One-day watershed simulations</h2><span id='topic+spwb_land_day'></span><span id='topic+growth_land_day'></span>

<h3>Description</h3>

<p>Functions to perform one-day simulations on a watershed described by a set of connected grid cells.
</p>

<ul>
<li><p>Function <code>spwb_land_day</code> implements a distributed hydrological model that simulates daily local water balance, from <code><a href="medfate.html#topic+spwb_day">spwb_day</a></code>,
on grid cells of a watershed while accounting for overland runoff, subsurface flow and groundwater flow between cells.
</p>
</li>
<li><p>Function <code>growth_land_day</code> is similar to <code>spwb_land_day</code>, but includes daily local carbon balance, growth and mortality processes in grid cells,
provided by <code><a href="medfate.html#topic+growth_day">growth_day</a></code>.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>spwb_land_day(
  r,
  sf,
  SpParams,
  meteo = NULL,
  date = NULL,
  local_control = medfate::defaultControl(),
  watershed_control = default_watershed_control(),
  parallelize = FALSE,
  num_cores = detectCores() - 1,
  chunk_size = NULL,
  progress = TRUE
)

growth_land_day(
  r,
  sf,
  SpParams,
  meteo = NULL,
  date = NULL,
  local_control = medfate::defaultControl(),
  watershed_control = default_watershed_control(),
  parallelize = FALSE,
  num_cores = detectCores() - 1,
  chunk_size = NULL,
  progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spwb_land_day_+3A_r">r</code></td>
<td>
<p>An object of class <code><a href="terra.html#topic+rast">rast</a></code>, defining the raster topology.</p>
</td></tr>
<tr><td><code id="spwb_land_day_+3A_sf">sf</code></td>
<td>
<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code> as described in <code><a href="#topic+spwb_land">spwb_land</a></code>.</p>
</td></tr>
<tr><td><code id="spwb_land_day_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="medfate.html#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
<tr><td><code id="spwb_land_day_+3A_meteo">meteo</code></td>
<td>
<p>Input meteorological data (see <code><a href="#topic+spwb_spatial">spwb_spatial</a></code> and details).</p>
</td></tr>
<tr><td><code id="spwb_land_day_+3A_date">date</code></td>
<td>
<p>A string with the date to be simulated.</p>
</td></tr>
<tr><td><code id="spwb_land_day_+3A_local_control">local_control</code></td>
<td>
<p>A list of control parameters (see <code><a href="medfate.html#topic+defaultControl">defaultControl</a></code>) for function <code><a href="medfate.html#topic+spwb_day">spwb_day</a></code> or <code><a href="medfate.html#topic+growth_day">growth_day</a></code>.</p>
</td></tr>
<tr><td><code id="spwb_land_day_+3A_watershed_control">watershed_control</code></td>
<td>
<p>A list of watershed control parameters (see <code><a href="#topic+default_watershed_control">default_watershed_control</a></code>). Importantly, the sub-model used
for lateral water flows - either Francés et al. (2007) or Caviedes-Voullième et al. (2023) - is specified there.</p>
</td></tr>
<tr><td><code id="spwb_land_day_+3A_parallelize">parallelize</code></td>
<td>
<p>Boolean flag to try parallelization (see details).</p>
</td></tr>
<tr><td><code id="spwb_land_day_+3A_num_cores">num_cores</code></td>
<td>
<p>Integer with the number of cores to be used for parallel computation (by default it will use all clusters minus one).</p>
</td></tr>
<tr><td><code id="spwb_land_day_+3A_chunk_size">chunk_size</code></td>
<td>
<p>Integer indicating the size of chunks to be sent to different processes (by default, the number of spatial elements divided by the number of cores).</p>
</td></tr>
<tr><td><code id="spwb_land_day_+3A_progress">progress</code></td>
<td>
<p>Boolean flag to display progress information for simulations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See details in <code><a href="#topic+spwb_land">spwb_land</a></code>.
</p>


<h3>Value</h3>

<p>Functions <code>spwb_land_day</code> and <code>spwb_land_day</code> return a sf object:
</p>

<ul>
<li><p><code>geometry</code>: Spatial geometry.
</p>
</li>
<li><p><code>state</code>: A list of model input objects for each simulated stand.
</p>
</li>
<li><p><code>aquifer</code>: A numeric vector with the water volume in the aquifer of each cell.
</p>
</li>
<li><p><code>snowpack</code>: A numeric vector with the snowpack water equivalent volume of each cell.
</p>
</li>
<li><p><code>result</code>: A list of cell detailed results (only for those indicated in the input), with contents depending on the local model.
</p>
</li>
<li><p><code>outlet</code>: A logical vector indicating outlet cells.
</p>
</li>
<li><p><code>MinTemperature</code>: Minimum temperature (degrees Celsius).
</p>
</li>
<li><p><code>MaxTemperature</code>: Maximum temperature (degrees Celsius).
</p>
</li>
<li><p><code>PET</code>: Potential evapotranspiration (in mm).
</p>
</li>
<li><p><code>Rain</code>: Rainfall (in mm).
</p>
</li>
<li><p><code>Snow</code>: Snowfall (in mm).
</p>
</li>
<li><p><code>Snowmelt</code>: Snow melt (in mm).
</p>
</li>
<li><p><code>Interception</code>: Rainfall interception (in mm).
</p>
</li>
<li><p><code>NetRain</code>: Net rainfall, i.e. throughfall, (in mm).
</p>
</li>
<li><p><code>Infiltration</code>: The amount of water infiltrating into the soil (in mm).
</p>
</li>
<li><p><code>InfiltrationExcess</code>: The amount of water exceeding the soil infiltration capacity (in mm).
</p>
</li>
<li><p><code>SaturationExcess</code>: The amount of water that reaches the soil surface because of soil saturation (in mm).
</p>
</li>
<li><p><code>Runoff</code>: The amount of water exported via surface runoff (in mm).
</p>
</li>
<li><p><code>DeepDrainage</code>: The amount of water draining from soil to the aquifer via deep drainage (in mm).
</p>
</li>
<li><p><code>CapillarityRise</code>: Water entering the soil via capillarity rise (mm) from the water table.
</p>
</li>
<li><p><code>SoilEvaporation</code>: Bare soil evaporation (in mm).
</p>
</li>
<li><p><code>Transpiration</code>: Woody plant transpiration (in mm).
</p>
</li>
<li><p><code>HerbTranspiration</code>: Herbaceous transpiration (in mm).
</p>
</li>
<li><p><code>InterflowInput</code>: The amount of water that reaches the soil of the cell from adjacent cells via subsurface flow (in mm).
</p>
</li>
<li><p><code>InterflowOutput</code>: The amount of water that leaves the soil of the cell towards adjacent cells via subsurface flow (in mm).
</p>
</li>
<li><p><code>InterflowBalance</code>: The balance of water circulating via subsurface flow (in mm).
</p>
</li>
<li><p><code>BaseflowInput</code>: The amount of water that reaches the aquifer of the cell from adjacent cells via groundwater flow (in mm).
</p>
</li>
<li><p><code>BaseflowOutput</code>: The amount of water that leaves the aquifer of the cell towards adjacent cells via groundwater flow (in mm).
</p>
</li>
<li><p><code>BaseflowBalance</code>: The balance of water circulating via groundwater flow (in mm).
</p>
</li>
<li><p><code>AquiferExfiltration</code>: The amount of water of the cell that generates surface runoff due to the aquifer reaching the soil surface (in mm).
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF.
</p>
<p>Maria González-Sanchís, Universitat Politecnica de Valencia.
</p>
<p>Daniel Caviedes-Voullième, Forschungszentrum Julich.
</p>
<p>Mario Morales-Hernández, Universidad de Zaragoza.
</p>


<h3>References</h3>

<p>Francés, F., Vélez, J.I. &amp; Vélez, J.J. (2007). Split-parameter structure for the automatic calibration of distributed hydrological models. Journal of Hydrology, 332, 226–240.
</p>
<p>Caviedes-Voullième, D., Morales-Hernández, M., Norman, M.R. &amp; Ogzen-Xian, I. (2023). SERGHEI (SERGHEI-SWE) v1.0: a performance-portable high-performance parallel-computing shallow-water solver for hydrology and environmental hydraulics. Geoscientific Model Development, 16, 977-1008.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+default_watershed_control">default_watershed_control</a></code>,  <code><a href="medfate.html#topic+spwb_day">spwb_day</a></code>,  <code><a href="medfate.html#topic+growth_day">growth_day</a></code>,
<code><a href="#topic+spwb_land">spwb_land</a></code>,
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Load example watershed data after burnin period
data("example_watershed_burnin")

# Set request for daily model results in cells number 3, 6 (outlet) and 9
example_watershed_burnin$result_cell &lt;- FALSE
example_watershed_burnin$result_cell[c(3,6,9)] &lt;- TRUE

# Get bounding box to determine limits
b &lt;- sf::st_bbox(example_watershed_burnin)
b

# Define a raster topology, using terra package, 
# with the same CRS as the watershed. In this example cells have 100 m side.
# Coordinates in the 'sf' object are assumed to be cell centers
r &lt;-terra::rast(xmin = 401380, ymin = 4671820, xmax = 402880, ymax = 4672620, 
                nrow = 8, ncol = 15, crs = "epsg:32631")

# Load example meteo data frame from package meteoland
data("examplemeteo")
  
# Load default medfate parameters
data("SpParamsMED")
  
# Watershed control parameters (TETIS model; Frances et al. 2007)
ws_control &lt;- default_watershed_control("tetis")

# Launch simulation 
date &lt;- "2001-03-01"
sf_out &lt;- spwb_land_day(r, example_watershed_burnin, SpParamsMED, examplemeteo, 
                        date = date, 
                        watershed_control = ws_control)

</code></pre>

<hr>
<h2 id='spwb_spatial'>Simulations for spatially-distributed forest stands</h2><span id='topic+spwb_spatial'></span><span id='topic+growth_spatial'></span><span id='topic+fordyn_spatial'></span>

<h3>Description</h3>

<p>Functions that allow calling local models <code><a href="medfate.html#topic+spwb">spwb</a></code>, <code><a href="medfate.html#topic+growth">growth</a></code> or <code><a href="medfate.html#topic+fordyn">fordyn</a></code>, for a set of forest stands distributed in specific locations.
No spatial processes are simulated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spwb_spatial(
  sf,
  SpParams,
  meteo = NULL,
  local_control = defaultControl(),
  dates = NULL,
  CO2ByYear = numeric(0),
  keep_results = TRUE,
  summary_function = NULL,
  summary_arguments = NULL,
  parallelize = FALSE,
  num_cores = detectCores() - 1,
  chunk_size = NULL,
  progress = TRUE,
  local_verbose = FALSE
)

growth_spatial(
  sf,
  SpParams,
  meteo = NULL,
  local_control = defaultControl(),
  dates = NULL,
  CO2ByYear = numeric(0),
  fire_regime = NULL,
  keep_results = TRUE,
  summary_function = NULL,
  summary_arguments = NULL,
  parallelize = FALSE,
  num_cores = detectCores() - 1,
  chunk_size = NULL,
  progress = TRUE,
  local_verbose = FALSE
)

fordyn_spatial(
  sf,
  SpParams,
  meteo = NULL,
  local_control = defaultControl(),
  dates = NULL,
  CO2ByYear = numeric(0),
  fire_regime = NULL,
  keep_results = TRUE,
  management_function = NULL,
  summary_function = NULL,
  summary_arguments = NULL,
  parallelize = FALSE,
  num_cores = detectCores() - 1,
  chunk_size = NULL,
  progress = TRUE,
  local_verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spwb_spatial_+3A_sf">sf</code></td>
<td>
<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code> with the following columns:
</p>

<ul>
<li><p><code>geometry</code>: Spatial geometry.
</p>
</li>
<li><p><code>id</code>: Stand identifiers.
</p>
</li>
<li><p><code>elevation</code>: Elevation above sea level (in m).
</p>
</li>
<li><p><code>slope</code>: Slope (in degrees).
</p>
</li>
<li><p><code>aspect</code>: Aspect (in degrees).
</p>
</li>
<li><p><code>land_cover_type</code>: Land cover type of each grid cell (values should be 'wildland' or 'agriculture').
</p>
</li>
<li><p><code>forest</code>: Objects of class <code><a href="medfate.html#topic+forest">forest</a></code>.
</p>
</li>
<li><p><code>soil</code>: Objects of class <code><a href="medfate.html#topic+soil">soil</a></code> or data frames of physical properties.
</p>
</li>
<li><p><code>state</code>: Objects of class <code><a href="medfate.html#topic+spwbInput">spwbInput</a></code> or <code><a href="medfate.html#topic+growthInput">growthInput</a></code> (optional).
</p>
</li>
<li><p><code>meteo</code>: Data frames with weather data (required if parameter <code>meteo = NULL</code>).
</p>
</li>
<li><p><code>crop_factor</code>: Crop evapo-transpiration factor. Only required for 'agriculture' land cover type.
</p>
</li>
<li><p><code>local_control</code>: A list of control parameters (optional). Used to override function parameter <code>local_control</code> for specific locations (values can be <code>NULL</code> for the remaining ones).
</p>
</li>
<li><p><code>management_arguments</code>: Lists with management arguments. Optional, relevant for <code>fordyn_spatial</code> only.
</p>
</li>
<li><p><code>represented_area_ha</code>: Area represented by each stand in hectares. Optional, relevant for <code>fordyn_spatial</code> when
<code>fire_regime</code> is supplied only).
</p>
</li>
<li><p><code>ignition_weights</code>: Relative weights to determine stands to be burned. Optional, relevant for <code>fordyn_spatial</code> when
<code>fire_regime</code> is supplied only).
</p>
</li></ul>
</td></tr>
<tr><td><code id="spwb_spatial_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="medfate.html#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
<tr><td><code id="spwb_spatial_+3A_meteo">meteo</code></td>
<td>
<p>Input meteorological data (see section details). If NULL, the function will expect a column 'meteo' in parameter <code>y</code>.</p>
</td></tr>
<tr><td><code id="spwb_spatial_+3A_local_control">local_control</code></td>
<td>
<p>A list of control parameters (see <code><a href="medfate.html#topic+defaultControl">defaultControl</a></code>) for function <code><a href="medfate.html#topic+spwb_day">spwb_day</a></code> or <code><a href="medfate.html#topic+growth_day">growth_day</a></code>.</p>
</td></tr>
<tr><td><code id="spwb_spatial_+3A_dates">dates</code></td>
<td>
<p>A <code><a href="base.html#topic+Date">Date</a></code> object describing the days of the period to be modeled.</p>
</td></tr>
<tr><td><code id="spwb_spatial_+3A_co2byyear">CO2ByYear</code></td>
<td>
<p>A named numeric vector with years as names and atmospheric CO2 concentration (in ppm) as values. Used to specify annual changes in CO2 concentration along the simulation (as an alternative to specifying daily values in <code>meteo</code>).</p>
</td></tr>
<tr><td><code id="spwb_spatial_+3A_keep_results">keep_results</code></td>
<td>
<p>Boolean flag to indicate that point/cell simulation results are to be returned (set to <code>FALSE</code> and use summary functions for large data sets).</p>
</td></tr>
<tr><td><code id="spwb_spatial_+3A_summary_function">summary_function</code></td>
<td>
<p>An appropriate function to calculate summaries (e.g., <code><a href="medfate.html#topic+summary.spwb">summary.spwb</a></code>).</p>
</td></tr>
<tr><td><code id="spwb_spatial_+3A_summary_arguments">summary_arguments</code></td>
<td>
<p>List with additional arguments for the summary function.</p>
</td></tr>
<tr><td><code id="spwb_spatial_+3A_parallelize">parallelize</code></td>
<td>
<p>Boolean flag to try parallelization (will use all clusters minus one).</p>
</td></tr>
<tr><td><code id="spwb_spatial_+3A_num_cores">num_cores</code></td>
<td>
<p>Integer with the number of cores to be used for parallel computation.</p>
</td></tr>
<tr><td><code id="spwb_spatial_+3A_chunk_size">chunk_size</code></td>
<td>
<p>Integer indicating the size of chuncks to be sent to different processes (by default, the number of spatial elements divided by the number of cores).</p>
</td></tr>
<tr><td><code id="spwb_spatial_+3A_progress">progress</code></td>
<td>
<p>Boolean flag to display progress information of simulations.</p>
</td></tr>
<tr><td><code id="spwb_spatial_+3A_local_verbose">local_verbose</code></td>
<td>
<p>Boolean flag to display detailed progress information in local simulations.</p>
</td></tr>
<tr><td><code id="spwb_spatial_+3A_fire_regime">fire_regime</code></td>
<td>
<p>A list of parameters defining the fire regime (see <code><a href="#topic+create_fire_regime">create_fire_regime</a></code>) or
a matrix representing a fire regime instance (see <code><a href="#topic+fire_regime_instance">fire_regime_instance</a></code>),
to be used in simulations with <code><a href="#topic+fordyn_spatial">fordyn_spatial</a></code>. If NULL, wildfires are not simulated.</p>
</td></tr>
<tr><td><code id="spwb_spatial_+3A_management_function">management_function</code></td>
<td>
<p>A function that implements forest management actions (see <code><a href="medfate.html#topic+fordyn">fordyn</a></code>).
of such lists, one per spatial unit.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Simulation functions  accept different formats for meteorological input (parameter <code>meteo</code>).
The user may supply two kinds of daily weather sources:
</p>

<ol>
<li><p>A data frame with meteorological data common for all spatial location (spatial variation of weather not considered).
</p>
</li>
<li><p>An object or (a list of objects) of class <code><a href="graphics.html#topic+stars">stars</a></code> with reference interpolation data created by package <code><a href="meteoland.html#topic+meteoland">meteoland</a></code>.
If a list of such <em>interpolator</em> objects is supplied, the simulation functions will interpolate on the target locations for the periods covered by each interpolator,
but the user will be responsible for supplying interpolators in the correct temporal order.
</p>
</li></ol>

<p>Alternatively, the user may leave parameter <code>meteo = NULL</code> and specify a weather data frame for each element of <code>y</code>
in a column named 'meteo'.
</p>
<p>Fire regimes are only allowed for function <code>fordyn_spatial</code>. If an object of class <code>fire_regime</code> is supplied, the function will call
<code><a href="#topic+fire_regime_instance">fire_regime_instance</a></code> to generate a realization of the fire regime before conducting simulations. Alternatively,
users can directly supply a fire regime instance matrix, derived from another source (e.g. a fire landscape model). Note that operating
with fire regimes assumes all forest stands share the same period of simulation, but enforcing this is left to the user.
</p>


<h3>Value</h3>

<p>An object of class 'sf' containing four elements:
</p>

<ul>
<li><p><code>geometry</code>: Spatial geometry.
</p>
</li>
<li><p><code>id</code>: Stand id, taken from the input.
</p>
</li>
<li><p><code>state</code>: A list of <code><a href="medfate.html#topic+spwbInput">spwbInput</a></code> or <code><a href="medfate.html#topic+growthInput">growthInput</a></code> objects for each simulated stand, to be used in subsequent simulations (see <code><a href="#topic+update_landscape">update_landscape</a></code>) or with NULL values whenever simulation errors occurred.
</p>
</li>
<li><p><code>forest</code>: A list of <code><a href="medfate.html#topic+forest">forest</a></code> objects for each simulated stand (only in function <code>fordyn_spatial</code>), to be used in subsequent simulations (see <code><a href="#topic+update_landscape">update_landscape</a></code>) or with NULL values whenever simulation errors occurred.
</p>
</li>
<li><p><code>management_arguments</code>: A list of management arguments for each simulated stand (only in function <code>fordyn_spatial</code> if management function was supplied), to be used in subsequent simulations (see <code><a href="#topic+update_landscape">update_landscape</a></code>).
</p>
</li>
<li><p><code>result</code>: A list of model output for each simulated stand. Some elements can contain an error condition if the simulation resulted in an error. Values will be NULL (or errors) if <code>keep_results = FALSE</code>.
</p>
</li>
<li><p><code>summary</code>: A list of model output summaries for each simulated stand (if <code>summary_function</code> was not <code>NULL</code>), with NULL values whenever simulation errors occurred.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="medfate.html#topic+spwb">spwb</a></code>, <code><a href="medfate.html#topic+growth">growth</a></code>, <code><a href="medfate.html#topic+fordyn">fordyn</a></code>, <code><a href="#topic+spwb_spatial_day">spwb_spatial_day</a></code>,
<code><a href="#topic+simulation_summary">simulation_summary</a></code> , <code><a href="#topic+plot_summary">plot_summary</a></code>,
<code><a href="#topic+initialize_landscape">initialize_landscape</a></code>, <code><a href="#topic+update_landscape">update_landscape</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load example landscape data
data("example_ifn")
  
# Load example meteo data frame from package meteoland
data("examplemeteo")
  
# Load default medfate parameters
data("SpParamsMED")
  
# Subset two plots to speed-up calculations
example_subset &lt;- example_ifn[31:32, ]

# Perform simulation
dates &lt;- seq(as.Date("2001-03-01"), as.Date("2001-03-15"), by="day")
res &lt;- spwb_spatial(example_subset, SpParamsMED, examplemeteo, dates = dates)
  
# Perform fordyn simulation for one year (one stand) without management
res_noman &lt;- fordyn_spatial(example_subset, SpParamsMED, examplemeteo)



</code></pre>

<hr>
<h2 id='spwb_spatial_day'>One-day simulation for spatially-distributed forest stands</h2><span id='topic+spwb_spatial_day'></span><span id='topic+growth_spatial_day'></span>

<h3>Description</h3>

<p>Functions that allow calling local models <code><a href="medfate.html#topic+spwb_day">spwb_day</a></code> or <code><a href="medfate.html#topic+growth_day">growth_day</a></code>,
for a set of forest stands distributed in specific locations and a given date.
No spatial processes are simulated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spwb_spatial_day(
  sf,
  meteo = NULL,
  date,
  SpParams,
  local_control = defaultControl(),
  parallelize = FALSE,
  num_cores = detectCores() - 1,
  chunk_size = NULL,
  progress = TRUE
)

growth_spatial_day(
  sf,
  meteo = NULL,
  date,
  SpParams,
  local_control = defaultControl(),
  parallelize = FALSE,
  num_cores = detectCores() - 1,
  chunk_size = NULL,
  progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spwb_spatial_day_+3A_sf">sf</code></td>
<td>
<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code> with landscape information (see <code><a href="#topic+spwb_spatial">spwb_spatial</a></code>).</p>
</td></tr>
<tr><td><code id="spwb_spatial_day_+3A_meteo">meteo</code></td>
<td>
<p>Meteorology data (see <code><a href="#topic+spwb_spatial">spwb_spatial</a></code>).</p>
</td></tr>
<tr><td><code id="spwb_spatial_day_+3A_date">date</code></td>
<td>
<p>A string with the date to be simulated.</p>
</td></tr>
<tr><td><code id="spwb_spatial_day_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="medfate.html#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
<tr><td><code id="spwb_spatial_day_+3A_local_control">local_control</code></td>
<td>
<p>A list of local model control parameters (see <code><a href="medfate.html#topic+defaultControl">defaultControl</a></code>).</p>
</td></tr>
<tr><td><code id="spwb_spatial_day_+3A_parallelize">parallelize</code></td>
<td>
<p>Boolean flag to try parallelization (will use all clusters minus one).</p>
</td></tr>
<tr><td><code id="spwb_spatial_day_+3A_num_cores">num_cores</code></td>
<td>
<p>Integer with the number of cores to be used for parallel computation.</p>
</td></tr>
<tr><td><code id="spwb_spatial_day_+3A_chunk_size">chunk_size</code></td>
<td>
<p>Integer indicating the size of chunks to be sent to different processes (by default, the number of spatial elements divided by the number of cores).</p>
</td></tr>
<tr><td><code id="spwb_spatial_day_+3A_progress">progress</code></td>
<td>
<p>Boolean flag to display progress information for simulations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Simulation functions accept different formats for meteorological input (described in <code><a href="#topic+spwb_spatial">spwb_spatial</a></code>).
</p>


<h3>Value</h3>

<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code> the same name as the function called containing three elements:
</p>

<ul>
<li><p><code>geometry</code>: Spatial geometry.
</p>
</li>
<li><p><code>id</code>: Stand id, taken from the input.
</p>
</li>
<li><p><code>state</code>: A list of model input objects for each simulated stand, to be used in subsequent simulations.
</p>
</li>
<li><p><code>result</code>: A list of model output for each simulated stand.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="medfate.html#topic+spwb_day">spwb_day</a></code>, <code><a href="medfate.html#topic+growth_day">growth_day</a></code>, <code><a href="#topic+spwb_spatial">spwb_spatial</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#Load example landscape data
data("example_ifn")

#Load example meteo data frame from package meteoland
data("examplemeteo")
  
#Load default medfate parameters
data("SpParamsMED")
  
#Perform simulation
date &lt;- "2001-03-01"
res &lt;- spwb_spatial_day(example_ifn, examplemeteo, date, SpParamsMED)

</code></pre>

<hr>
<h2 id='update_landscape'>Updates the state of a landscape object</h2><span id='topic+update_landscape'></span>

<h3>Description</h3>

<p>Updates the state of a spatial object 'x' according to the final state in simulation outcome 'y'
</p>


<h3>Usage</h3>

<pre><code class='language-R'>update_landscape(x, y)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="update_landscape_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code> with the corresponding landscape columns.</p>
</td></tr>
<tr><td><code id="update_landscape_+3A_y">y</code></td>
<td>
<p>The object resulting of a simulation previously carried on <code>x</code>
using <code><a href="#topic+spwb_spatial">spwb_spatial</a></code>, <code><a href="#topic+growth_spatial">growth_spatial</a></code>, <code><a href="#topic+spwb_land">spwb_land</a></code>, etc.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code><a href="sf.html#topic+sf">sf</a></code> with modified state variables.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb_spatial">spwb_spatial</a></code>, <code><a href="#topic+spwb_spatial_day">spwb_spatial_day</a></code>, <code><a href="#topic+spwb_land">spwb_land</a></code>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
