<!DOCTYPE html><html><head><title>Help for package WCE</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {WCE}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#checkWCE'><p>Verify that the arguments passed to the WCE function are in correct format</p></a></li>
<li><a href='#coef.WCE'><p>Obtain estimated coefficients from <code>WCE</code> object</p></a></li>
<li><a href='#drugdata'><p>Simulated dataset to illustrate the use of WCE models</p></a></li>
<li><a href='#HR.WCE'><p>Obtain a hazard ratio (HR) from a WCE Cox proportional hazards model</p></a></li>
<li><a href='#knotsWCE'><p>Obtain the placement of the knots used for splines in WCE models</p></a></li>
<li><a href='#plot.WCE'><p>Plot of the weight function(s) estimated by <code>WCE</code></p></a></li>
<li><a href='#summary.WCE'><p>Summarize the results of a WCE object</p></a></li>
<li><a href='#vcov.WCE'><p>Obtain variance-covariance matrix from WCE models</p></a></li>
<li><a href='#WCE'><p>Fit weighted cumulative exposure models</p></a></li>
<li><a href='#WCE-package'><p>WCE: Weighted Cumulative Exposure Models</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Weighted Cumulative Exposure Models</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.3</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>plyr, survival, splines</td>
</tr>
<tr>
<td>Suggests:</td>
<td>R.rsp</td>
</tr>
<tr>
<td>Description:</td>
<td>A flexible method for modeling cumulative effects of time-varying exposures, weighted according to their relative proximity in time, and represented by time-dependent covariates. The current implementation estimates the weight function in the Cox proportional hazards model. The function that assigns weights to doses taken in the past is estimated using cubic regression splines.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-15 12:35:14 UTC; 15148</td>
</tr>
<tr>
<td>Author:</td>
<td>Marie-Pierre Sylvestre
    <a href="https://orcid.org/0000-0001-5803-4615"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre],
  Marie-Eve Beauchamp [ctb],
  Ryan Patrick Kyle [ctb],
  Michal Abrahamowicz [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Marie-Pierre Sylvestre &lt;marie-pierre.sylvestre@umontreal.ca&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-02-15 13:20:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='checkWCE'>Verify that the arguments passed to the WCE function are in correct format</h2><span id='topic+checkWCE'></span>

<h3>Description</h3>

<p>This function checks whether the arguments passed to the WCE function are in the correct format. If at least one argument is incorrectly specified, the function returns an error message specifying what needs to be fixed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>checkWCE(data, id, event, start, stop, expos)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="checkWCE_+3A_data">data</code></td>
<td>
<p>A data frame in the long (interval) format with one line per unit of time.</p>
</td></tr>
<tr><td><code id="checkWCE_+3A_id">id</code></td>
<td>
<p>The name of the variable in <code>data</code> that identifies subjects.</p>
</td></tr>
<tr><td><code id="checkWCE_+3A_event">event</code></td>
<td>
<p>The name of the variable in <code>data</code> that identifies the events (must be 0 or 1).</p>
</td></tr>
<tr><td><code id="checkWCE_+3A_start">start</code></td>
<td>
<p>The name of the variable in <code>data</code> that identifies the beginning of the interval.</p>
</td></tr>
<tr><td><code id="checkWCE_+3A_stop">stop</code></td>
<td>
<p>The name of the variable in <code>data</code> that identifies the end of the interval.</p>
</td></tr>
<tr><td><code id="checkWCE_+3A_expos">expos</code></td>
<td>
<p>The name of the variable in <code>data</code> that represents the exposure of interest.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The arguments passed to <code>checkWCE</code> must be exactly those passed to <code>WCE</code>.
</p>


<h3>Value</h3>

<p><code>checkWCE</code> returns a message on the screen indicating whether the arguments are correctly specified or not.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>checkWCE(drugdata, id = "Id", event = "Event",  start = "Start", stop = "Stop", expos = "dose")
</code></pre>

<hr>
<h2 id='coef.WCE'>Obtain estimated coefficients from <code>WCE</code> object</h2><span id='topic+coef.WCE'></span>

<h3>Description</h3>

<p>This function extracts the estimated coefficients from a WCE object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'WCE'
coef(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coef.WCE_+3A_object">object</code></td>
<td>
<p>A <code>WCE</code> object.</p>
</td></tr>
<tr><td><code id="coef.WCE_+3A_...">...</code></td>
<td>
<p>Optional; other parameters to be passed through to <code>coef</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function returns a list with one element if the WCE object was fitted without covariates and two if the WCE object was fitted with covariates. The first element is a matrix of estimated coefficients for the artificial D variables (see Sylvestre and Abrahamowicz, 2009). Each row of the matrix corresponds to a model with the number of knots specified in <code>WCE</code>. The second element of the list is a matrix of estimated covariate coefficients. Similarly, each row of the matrix corresponds to a model with the number of knots specified in <code>WCE</code>.
</p>


<h3>Value</h3>

<p>WCEest Matrix of estimated coefficients of the artificial D variables.
</p>
<p>covariates Matrix of estimated coefficients of the covariates (optional).
</p>


<h3>References</h3>

<p>Sylvestre, M. P., &amp; Abrahamowicz, M. (2009). Flexible modeling of the cumulative effects of time-dependent exposures on the hazard. Statistics in medicine, 28(27), 3437-3453.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+WCE">WCE</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>wce &lt;- WCE(data=drugdata, analysis="Cox", nknots=1, cutoff = 90, constrained = "R",
id = "Id", event = "Event", start = "Start", stop = "Stop", expos = "dose",
covariates = c("age", "sex"))
coef(wce)

</code></pre>

<hr>
<h2 id='drugdata'>Simulated dataset to illustrate the use of WCE models</h2><span id='topic+drugdata'></span>

<h3>Description</h3>

<p>Simulated dataset to illustrate the use of WCE models
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(drugdata)
</code></pre>


<h3>Format</h3>

<p>A data frame with 77038 rows and 7 variables for 500 individuals.  The data frame is formatted in an interval format.
</p>

<dl>
<dt>Id</dt><dd><p>numeric vector to identify observations that belong to the same individual.</p>
</dd>
<dt>Event</dt><dd><p>numeric vector representing the event of interest. Takes the value of 1 in the interval during which the event occurs and is 0 otherwise.</p>
</dd>
<dt>Start</dt><dd><p>numeric vector indicating the beginning of the interval.</p>
</dd>
<dt>Stop</dt><dd><p>numeric vector indicating the end of the interval.</p>
</dd>
<dt>sex</dt><dd><p>numeric vector indicating males (0) and females (1).</p>
</dd>
<dt>age</dt><dd><p>numeric vector representing age at baseline.</p>
</dd>
<dt>dose</dt><dd><p>numeric vector representing time-dependent doses of a drug.</p>
</dd>
</dl>



<h3>Details</h3>

<p>The variables sex and age are covariates. They are optional and illustrate the inclusion of adjustment variables. Covariates can be numeric or factors.
</p>


<h3>Source</h3>

<p>This dataset was simulated using the <code>PermAlgo</code> package (<a href="https://cran.r-project.org/package=PermAlgo">https://cran.r-project.org/package=PermAlgo</a>).
</p>


<h3>References</h3>

<p>Sylvestre, MP, &amp; Abrahamowicz, M. (2008). Comparison of algorithms to generate event times conditional on time-dependent covariates. Statistics in Medicine, 27(14), 2618-2634.
</p>

<hr>
<h2 id='HR.WCE'>Obtain a hazard ratio (HR) from a WCE Cox proportional hazards model</h2><span id='topic+HR.WCE'></span>

<h3>Description</h3>

<p>This function extracts the estimated coefficients from a WCE object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HR.WCE(x, vecnum, vecdenom, allres = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="HR.WCE_+3A_x">x</code></td>
<td>
<p>A <code>WCE</code> object.</p>
</td></tr>
<tr><td><code id="HR.WCE_+3A_vecnum">vecnum</code></td>
<td>
<p>A vector of time-dependent exposures corresponding to a scenario of interest (numerator of the HR).</p>
</td></tr>
<tr><td><code id="HR.WCE_+3A_vecdenom">vecdenom</code></td>
<td>
<p>A vector of time-dependent exposures corresponding to a scenario for the reference category (denominator of the HR).</p>
</td></tr>
<tr><td><code id="HR.WCE_+3A_allres">allres</code></td>
<td>
<p>Logical. If FALSE, prints the results using the best model from the WCE object, i.e. among the models fitted with the different numbers of interior knots requested by <code>nknots</code>, based on AIC or BIC as specified in the <code>WCE</code> call. If TRUE, prints the results for all the estimated models available from the WCE object. Default to FALSE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Both <code>vecnum</code> and <code>vecdenom</code> need to be of the same length as the weight function <code>cutof</code> argument used in the call to WCE. The first value of each vector represents the exposure today (t1) and subsequent values represent the exposures in the past. The hazard ratio computed by <code>HR.WCE</code> corresponds to the ratio of the weighted cumulative exposures for the scenario of interest (<code>vecnum</code>) and the reference scenario (<code>vecdenom</code>). It corresponds to equation (8) of Sylvestre and Abrahamowicz (2009).
</p>


<h3>Value</h3>

<p>Returns one or several hazard ratios. Inference may be obtained by bootstrap and has to be coded separately (please see <code>WCE</code> for an example).
</p>


<h3>References</h3>

<p>Sylvestre, M. P., &amp; Abrahamowicz, M. (2009). Flexible modeling of the cumulative effects of time-dependent exposures on the hazard. Statistics in medicine, 28(27), 3437-3453.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>wce &lt;- WCE(drugdata, "Cox", 1, 90, constrained = "R", id = "Id", event = "Event",
start = "Start", stop = "Stop", expos = "dose",covariates = c("age", "sex"))
# Exposed at a dose of 1 (constant) vs. unexposed over the time window of 90 days
scenario1 &lt;- rep(1, 90)
scenario2 &lt;- rep(0, 90)
HR.WCE(wce, vecnum = scenario1, vecdenom = scenario2)

</code></pre>

<hr>
<h2 id='knotsWCE'>Obtain the placement of the knots used for splines in WCE models</h2><span id='topic+knotsWCE'></span>

<h3>Description</h3>

<p>This function extracts the knots placement for the spline function used to fit the WCE models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>knotsWCE(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="knotsWCE_+3A_x">x</code></td>
<td>
<p>A <code>WCE</code> object.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function returns a list with one element if the WCE object was fitted without covariates and two if the WCE object was fitted with covariates. The first element is a matrix of estimated coefficients for the artificial D variables (see Sylvestre and Abrahamowicz, 2009). Each row of the matrix corresponds to a model with the number of knots specified in <code>WCE</code>. The second element of the list is a matrix of estimated covariate coefficients. Similarly, each row of the matrix corresponds to a model with the number of knots specified in <code>WCE</code>.
</p>


<h3>Value</h3>

<p>Returns a list of vectors indicating the placement of the knots used in the spline function of each of the models fitted in the WCE object.
</p>


<h3>References</h3>

<p>Sylvestre, M. P., &amp; Abrahamowicz, M. (2009). Flexible modeling of the cumulative effects of time-dependent exposures on the hazard. Statistics in medicine, 28(27), 3437-3453.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>wce &lt;- WCE(drugdata, "Cox", 1, 90, constrained = "R", id = "Id", event = "Event",
start = "Start", stop = "Stop", expos = "dose", covariates = c("age", "sex"))
knotsWCE(wce)

</code></pre>

<hr>
<h2 id='plot.WCE'>Plot of the weight function(s) estimated by <code>WCE</code></h2><span id='topic+plot.WCE'></span>

<h3>Description</h3>

<p>Method to plot the weight function(s) of a <code>WCE</code> object. Can plot the best estimated weight function or all the estimated functions simultaneously.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'WCE'
plot(x, allres = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.WCE_+3A_x">x</code></td>
<td>
<p>A <code>WCE</code> object.</p>
</td></tr>
<tr><td><code id="plot.WCE_+3A_allres">allres</code></td>
<td>
<p>Logical. If TRUE, then all the weight functions from the WCE object are plotted simultaneously. If FALSE, then only the best function, determined by AIC or BIC, is plotted. Default to FALSE.</p>
</td></tr>
<tr><td><code id="plot.WCE_+3A_...">...</code></td>
<td>
<p>Optional. Additional arguments to be passed to <code>plot</code> (none currently used).</p>
</td></tr>
</table>


<h3>References</h3>

<p>Sylvestre, M. P., &amp; Abrahamowicz, M. (2009). Flexible modeling of the cumulative effects of time-dependent exposures on the hazard. Statistics in medicine, 28(27), 3437-3453.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>wce &lt;- WCE(drugdata, "Cox", 1, 90, constrained = "R", id = "Id", event = "Event",
start = "Start", stop = "Stop", expos = "dose", covariates = c("age", "sex"))
plot(wce)

</code></pre>

<hr>
<h2 id='summary.WCE'>Summarize the results of a WCE object</h2><span id='topic+summary.WCE'></span>

<h3>Description</h3>

<p>This is a method to summarize the results from either the best fitting or all of the estimated models from a WCE object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'WCE'
summary(object, allres = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.WCE_+3A_object">object</code></td>
<td>
<p>A <code>WCE</code> object.</p>
</td></tr>
<tr><td><code id="summary.WCE_+3A_allres">allres</code></td>
<td>
<p>Logical. If TRUE, then a summary is produced for every model from the WCE object. If FALSE, then a summary is produced only for the best fitting model, as determined by AIC or BIC. Default to FALSE.</p>
</td></tr>
<tr><td><code id="summary.WCE_+3A_...">...</code></td>
<td>
<p>Optional; other parameters to be passed through to <code>summary</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The <code>summary</code> method prints to screen the estimated coefficients, standard errors and p-values for the coefficients (if any) included in the WCE model. It also provides the partial likelihood and AIC or BIC value, and the number of events used in the estimation of the model.
</p>


<h3>References</h3>

<p>Sylvestre, M. P., &amp; Abrahamowicz, M. (2009). Flexible modeling of the cumulative effects of time-dependent exposures on the hazard. Statistics in medicine, 28(27), 3437-3453.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>wce &lt;- WCE(drugdata, "Cox", 1, 90, constrained = "R", id = "Id", event = "Event",
start = "Start", stop = "Stop", expos = "dose", covariates = c("age", "sex"))
summary(wce)

</code></pre>

<hr>
<h2 id='vcov.WCE'>Obtain variance-covariance matrix from WCE models</h2><span id='topic+vcov.WCE'></span>

<h3>Description</h3>

<p>This function extracts the knots placement for the spline function used to fit the WCE models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'WCE'
vcov(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vcov.WCE_+3A_object">object</code></td>
<td>
<p>A <code>WCE</code> object.</p>
</td></tr>
<tr><td><code id="vcov.WCE_+3A_...">...</code></td>
<td>
<p>Optional; other parameters to be passed through to <code>vcov</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function returns the variance-covariance matrix of the estimated regression coefficients from a WCE model.
</p>


<h3>Value</h3>

<p>The function returns variance-covariance matrices with the estimated regression coefficients for the supplied WCE model object. The number of matrices returned is equivalent to the length of the <code>nknots</code> vector (or one matrix, if <code>nknots</code> is a scalar) passed to the <code>WCE</code> function when fitting the model.
</p>


<h3>References</h3>

<p>Sylvestre, M. P., &amp; Abrahamowicz, M. (2009). Flexible modeling of the cumulative effects of time-dependent exposures on the hazard. Statistics in medicine, 28(27), 3437-3453.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>wce &lt;- WCE(drugdata, "Cox", 1, 90, constrained = "R", id = "Id", event = "Event",
start = "Start", stop = "Stop", expos = "dose", covariates = c("age", "sex"))
vcov(wce)

</code></pre>

<hr>
<h2 id='WCE'>Fit weighted cumulative exposure models</h2><span id='topic+WCE'></span>

<h3>Description</h3>

<p><code>WCE</code> implements a flexible method for modeling cumulative effects of time-varying exposures, weighted according to their relative proximity in time, and represented by time-dependent covariates. The current implementation estimates the weight function in the Cox proportional hazards model. The function that assigns weights to doses taken in the past is estimated using cubic regression splines.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>WCE(
  data,
  analysis = "Cox",
  nknots,
  cutoff,
  constrained = FALSE,
  aic = FALSE,
  MatchedSet = NULL,
  id,
  event,
  start,
  stop,
  expos,
  covariates = NULL,
  controls = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="WCE_+3A_data">data</code></td>
<td>
<p>A data frame in an interval (long) format, in which each line corresponds to one and only one time unit for a given individual.</p>
</td></tr>
<tr><td><code id="WCE_+3A_analysis">analysis</code></td>
<td>
<p>Character string. One of 'Cox', 'NCC' or 'CC' for Cox proportional hazards model, conditional logistic regression for nested case controls ('NCC') or logistic regression for case-controls ('CC'). Currently only 'Cox' for the Cox proportional hazards model is implemented, calling the <code>coxph</code> function of the survival package.</p>
</td></tr>
<tr><td><code id="WCE_+3A_nknots">nknots</code></td>
<td>
<p>A scalar or a vector. Corresponds to the number(s) of interior knots for the cubic splines to estimate the weight function. For example, if <code>nknots</code> is set to 2, then a model with two interior knots is fitted. If <code>nknots</code>  is set to 1:3 or alternatively c(1,2,3) then three models with 1, 2, and 3 interior knots, respectively, are fitted.</p>
</td></tr>
<tr><td><code id="WCE_+3A_cutoff">cutoff</code></td>
<td>
<p>Integer. Time window over which the WCE model is estimated. Corresponds to the length of the estimated weight function.</p>
</td></tr>
<tr><td><code id="WCE_+3A_constrained">constrained</code></td>
<td>
<p>Controls whether the weight function should be constrained to smoothly go to zero. Set to FALSE for unconstrained models, to 'Right' or 'R' to constrain the weight function to smoothly go to zero for exposure remote in time, and to 'Left' or 'L' to constrain the weight function to start a zero for the current values.</p>
</td></tr>
<tr><td><code id="WCE_+3A_aic">aic</code></td>
<td>
<p>Logical. If TRUE, then the AIC is used to select the best fitting model among those estimated for the different numbers of interior knots requested with <code>nknots</code>. If FALSE, then the BIC is used instead of the AIC. Default to FALSE (BIC). Note that the BIC implemented in <code>WCE</code> is the version suggested by Volinsky and Raftery in Biometrics (2000), which corresponds to BIC = 2 * log(PL) + p * log(d) where PL is the model's partial likelihood, p is the number of estimated parameters and d is the number of uncensored events. See Sylvestre and Abrahamowicz (2009) for more details.</p>
</td></tr>
<tr><td><code id="WCE_+3A_matchedset">MatchedSet</code></td>
<td>
<p>Argument required for 'NCC' analysis only. Corresponds to the variable in <code>data</code> that specifies the matched sets for the conditional logistic regression. Currently not implemented.</p>
</td></tr>
<tr><td><code id="WCE_+3A_id">id</code></td>
<td>
<p>Name of the variable in <code>data</code> corresponding to the identification of subjects.</p>
</td></tr>
<tr><td><code id="WCE_+3A_event">event</code></td>
<td>
<p>Name of the variable in <code>data</code> corresponding to event indicator. Must be coded 1 = event and 0 = no event.</p>
</td></tr>
<tr><td><code id="WCE_+3A_start">start</code></td>
<td>
<p>Name of the variable in <code>data</code> corresponding to the starting time for the interval. Corresponds to <code>time</code> argument in function <code>Surv</code> in the survival package.</p>
</td></tr>
<tr><td><code id="WCE_+3A_stop">stop</code></td>
<td>
<p>Name of the variable in <code>data</code> corresponding to the ending time for the interval. Corresponds to <code>time2</code> argument in function <code>Surv</code> in the survival package.</p>
</td></tr>
<tr><td><code id="WCE_+3A_expos">expos</code></td>
<td>
<p>Name of the variable in <code>data</code> corresponding to the exposure variable.</p>
</td></tr>
<tr><td><code id="WCE_+3A_covariates">covariates</code></td>
<td>
<p>Optional. Vector of characters corresponding to the name(s) of the variable(s) in <code>data</code> corresponding to the covariate(s) to be included in the model. Default to NULL, which corresponds to fitting model(s) without covariates.</p>
</td></tr>
<tr><td><code id="WCE_+3A_controls">controls</code></td>
<td>
<p>List corresponding to the control parameters to be passed to the <code>coxph</code> function. See <code><a href="survival.html#topic+coxph.control">coxph.control</a></code> for more details.</p>
</td></tr>
<tr><td><code id="WCE_+3A_...">...</code></td>
<td>
<p>Optional; other parameters to be passed through to <code>WCE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The current implementation of the <code>WCE</code> function does not allow missing values in the <code>Id</code>, <code>event</code>, <code>start</code>, <code>stop</code>, <code>expos</code> variables. Intervals in <code>data</code> determined by <code>start</code> and <code>stop</code> are assumed to be open on the left and closed on the right, (start, stop]. Intervals for a given individual (<code>Id</code>) must not overlap, and must cover the entire follow-up for the individual. The <code>start</code> and <code>stop</code> values for a given interval must not be equal. Delayed entry is not implemented in this version of the <code>WCE</code> function so all of the <code>Id</code> must start their follow-up at the same <code>start</code> value. The interior knots are placed at quantiles of the exposure variable distribution.
</p>


<h3>Value</h3>

<p>A list of elements:</p>

<table>
<tr>
 <td style="text-align: left;">
<code>knotsmat</code> </td><td style="text-align: left;"> List of vectors of knots used for the spline modelling of the weight function(s). </td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>WCEmat</code> </td><td style="text-align: left;"> Matrix of the estimated weight function. Each row corresponds to an estimated weight function. The number of columns in the <code>WCEmat</code> corresponds to the value of the argument <code>nknots</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>loglik</code> </td><td style="text-align: left;"> Partial likelihood for each estimated model. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>est</code> </td><td style="text-align: left;"> List of vectors of estimated coefficients for the artificial time-dependent variables used to fit the WCE model(s). </td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>vcovmat</code> </td><td style="text-align: left;"> List of variance-covariance matrices estimated for each model. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>SED</code> </td><td style="text-align: left;"> List of vectors of estimated standard errors of the estimated coefficients of the artificial time-dependent variables used to fit each WCE model. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>beta.hat.covariates</code> </td><td style="text-align: left;"> List of vectors of estimated coefficients for the covariates. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>se.covariates</code> </td><td style="text-align: left;"> List of vectors of standard errors of the estimated coefficients for the covariates. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>covariates</code> </td><td style="text-align: left;"> Names of the covariates used in the estimation. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>constrained</code> </td><td style="text-align: left;"> Indicator of whether the model(s) was(were) unconstrained, right-constrained or left-constrained. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>nevents</code> </td><td style="text-align: left;"> Number of events. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>aic</code> </td><td style="text-align: left;"> Logical value corresponding to the <code>aic</code> argument. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>info.criterion</code> </td><td style="text-align: left;"> Value of the AIC or BIC for each model estimated. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>analysis</code> </td><td style="text-align: left;"> Value of the <code>analysis</code> argument. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>...</code> </td><td style="text-align: left;"> Optional, additional argument(s). </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Note</h3>

<p>Note that the print method for a WCE object returns the estimated WCE function(s), the number of events, the partial likelihoods, the AIC or BIC values, the matrix of coefficients estimates for the covariates (if any) and the matrix of standard error estimates for the covariates (if any).
</p>


<h3>References</h3>

<p>Sylvestre, M. P., &amp; Abrahamowicz, M. (2009). Flexible modeling of the cumulative effects of time-dependent exposures on the hazard. Statistics in medicine, 28(27), 3437-3453.
</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+checkWCE">checkWCE</a></code>, a function to check whether the arguments passed to <code>WCE</code> are correctly specified. See also <code>summary</code>, and <code>plot</code> for <code>WCE</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
wce &lt;- WCE(drugdata, "Cox", 1, 90, constrained = "R", id = "Id", event = "Event",
start = "Start", stop = "Stop", expos = "dose", covariates = c("age", "sex"))
## Not run: 
 # Confidence intervals for HR, as well as pointwise confidence bands
 # for the estimated weight function can be obtained via bootstrap.

 # Set the number of bootstrap resamples
 #(set to 5 for demonstration purposes, should be higher)
 B &lt;- 5

 # Obtain the list of ID for sampling
 ID &lt;- unique(drugdata$Id)

 # Prepare vectors to extract estimated weight function and HR
 # for the best-fitting model for each bootstrap resample
 boot.WCE &lt;- matrix(NA, ncol = 90, nrow=B)
 boot.HR &lt;- rep(NA, B)

 # Sample IDs with replacement
 for (i in 1:B){
   ID.resamp &lt;- sort(sample(ID, replace=T))
   datab &lt;- drugdata[drugdata$Id %in% ID.resamp,] # select obs. but duplicated Id are ignored

   # deal with duplicated Id and assign them new Id
   step &lt;- 1
   repeat {
   # select duplicated Id in ID.resamp
     ID.resamp &lt;- ID.resamp[duplicated(ID.resamp)==TRUE]
     if (length(ID.resamp)==0) break # stop when no more duplicated Id to deal with
     # select obs. but remaining duplicated Id are ignored
     subset.dup &lt;- drugdata[drugdata$Id %in% ID.resamp,]
     # assign new Id to duplicates
     subset.dup$Id &lt;- subset.dup$Id + step * 10^ceiling(log10(max(drugdata$Id)))
     # 10^ceiling(log10(max(drugdata$Id)) is the power of 10
     # above the maximum Id from original data
     datab &lt;- rbind(datab, subset.dup)
     step &lt;- step+1
   }

   mod &lt;- WCE(data = datab, analysis = "Cox", nknots = 1:3, cutoff = 90,
   constrained = "R", aic = FALSE, MatchedSet = NULL, id = "Id",
   event = "Event", start = "Start", stop = "Stop", expos = "dose",
   covariates = c("sex", "age"))

   # return best WCE estimates and corresponding HR
   best &lt;- which.min(mod$info.criterion)
   boot.WCE[i,] &lt;- mod$WCEmat[best,]
   boot.HR[i] &lt;- HR.WCE(mod, rep(1, 90), rep(0, 90))
 }

 # Summarize bootstrap results using percentile method
 apply(boot.WCE, 2, quantile, p = c(0.05, 0.95))
 quantile(boot.HR, p = c(0.05, 0.95))

## End(Not run)

</code></pre>

<hr>
<h2 id='WCE-package'>WCE: Weighted Cumulative Exposure Models</h2><span id='topic+WCE-package'></span>

<h3>Description</h3>

<p>A flexible method for modeling cumulative effects of time-varying exposures, weighted according to their relative proximity in time, and represented by time-dependent covariates. The current implementation estimates the weight function in the Cox proportional hazards model. The function that assigns weights to doses taken in the past is estimated using cubic regression splines.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Marie-Pierre Sylvestre <a href="mailto:marie-pierre.sylvestre@umontreal.ca">marie-pierre.sylvestre@umontreal.ca</a> (<a href="https://orcid.org/0000-0001-5803-4615">ORCID</a>)
</p>
<p>Other contributors:
</p>

<ul>
<li><p> Marie-Eve Beauchamp [contributor]
</p>
</li>
<li><p> Ryan Patrick Kyle [contributor]
</p>
</li>
<li><p> Michal Abrahamowicz [contributor]
</p>
</li></ul>


</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
