<!DOCTYPE html><html><head><title>Help for package syrup</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {syrup}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#syrup-package'><p>syrup: Measure Memory and CPU Usage for Parallel R Code</p></a></li>
<li><a href='#syrup'><p>Memory and CPU Usage Information for Parallel R Code</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Measure Memory and CPU Usage for Parallel R Code</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Measures memory and CPU usage of R code by regularly taking 
    snapshots of calls to the system command 'ps'. The package provides an entry 
    point (albeit coarse) to profile usage of system resources by R code run 
    in parallel.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Depends:</td>
<td>bench</td>
</tr>
<tr>
<td>Imports:</td>
<td>callr, dplyr, ps, purrr, rlang, tibble, vctrs, withr</td>
</tr>
<tr>
<td>Config/Needs/website:</td>
<td>rmarkdown</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/simonpcouch/syrup">https://github.com/simonpcouch/syrup</a>,
<a href="https://simonpcouch.github.io/syrup/">https://simonpcouch.github.io/syrup/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/simonpcouch/syrup/issues">https://github.com/simonpcouch/syrup/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-07-08 17:11:18 UTC; simoncouch</td>
</tr>
<tr>
<td>Author:</td>
<td>Simon Couch <a href="https://orcid.org/0000-0001-5676-5107"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre],
  Posit Software, PBC [cph, fnd]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Simon Couch &lt;simon.couch@posit.co&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-07-09 15:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='syrup-package'>syrup: Measure Memory and CPU Usage for Parallel R Code</h2><span id='topic+syrup-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Measures memory and CPU usage of R code by regularly taking snapshots of calls to the system command 'ps'. The package provides an entry point (albeit coarse) to profile usage of system resources by R code run in parallel.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Simon Couch <a href="mailto:simon.couch@posit.co">simon.couch@posit.co</a> (<a href="https://orcid.org/0000-0001-5676-5107">ORCID</a>)
</p>
<p>Other contributors:
</p>

<ul>
<li><p> Posit Software, PBC [copyright holder, funder]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/simonpcouch/syrup">https://github.com/simonpcouch/syrup</a>
</p>
</li>
<li> <p><a href="https://simonpcouch.github.io/syrup/">https://simonpcouch.github.io/syrup/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/simonpcouch/syrup/issues">https://github.com/simonpcouch/syrup/issues</a>
</p>
</li></ul>


<hr>
<h2 id='syrup'>Memory and CPU Usage Information for Parallel R Code</h2><span id='topic+syrup'></span>

<h3>Description</h3>

<p>This function is a wrapper around the system command <code>ps</code> that can
be used to benchmark (peak) memory and CPU usage of parallel R code.
By taking snapshots the memory usage of R processes at a regular <code>interval</code>,
the function dynamically builds up a profile of their usage of system
resources.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>syrup(expr, interval = 0.5, peak = FALSE, env = caller_env())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="syrup_+3A_expr">expr</code></td>
<td>
<p>An expression.</p>
</td></tr>
<tr><td><code id="syrup_+3A_interval">interval</code></td>
<td>
<p>The interval at which to take snapshots of respirce usage.
In practice, there's an overhead on top of each of these intervals.</p>
</td></tr>
<tr><td><code id="syrup_+3A_peak">peak</code></td>
<td>
<p>Whether to return rows for only the &quot;peak&quot; memory usage.
Interpreted as the <code>id</code> with the maximum <code>rss</code> sum. Defaults to <code>FALSE</code>,
but may be helpful to set <code>peak = TRUE</code> for potentially very long-running
processes so that the tibble doesn't grow too large.</p>
</td></tr>
<tr><td><code id="syrup_+3A_env">env</code></td>
<td>
<p>The environment to evaluate <code>expr</code> in.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>While much of the verbiage in the package assumes that the supplied
expression will be distributed across CPU cores, there's nothing specific
about this package that necessitates the expression provided to <code>syrup()</code> is
run in parallel. Said another way, <code>syrup()</code> will work just fine
with &quot;normal,&quot; sequentially-run R code (as in the examples). That said,
there are many better, more fine-grained tools for the job in the case of
sequential R code, such as <code><a href="utils.html#topic+Rprofmem">Rprofmem()</a></code>, the
<a href="https://CRAN.R-project.org/package=profmem">profmem</a>
package, the <a href="bench.html#topic+mark">bench</a> package, and packages in
the <a href="https://github.com/r-prof">R-prof</a> GitHub organization.
</p>
<p>Loosely, the function works by:
</p>

<ul>
<li><p> Setting up another R process (call it <code>sesh</code>) that queries system
information using <code><a href="ps.html#topic+ps">ps::ps()</a></code> at a regular interval,
</p>
</li>
<li><p> Evaluating the supplied expression,
</p>
</li>
<li><p> Reading the queried system information back into the main process from <code>sesh</code>,
</p>
</li>
<li><p> Closing <code>sesh</code>, and then
</p>
</li>
<li><p> Returning the queried system information.
</p>
</li></ul>

<p>Note that information on the R process <code>sesh</code> is filtered out from the results
automatically.
</p>


<h3>Value</h3>

<p>A tibble with columns <code>id</code> and <code>time</code> and a number of columns from
<code><a href="ps.html#topic+ps">ps::ps()</a></code> output describing memory and CPU usage. Notably, the process ID
<code>pid</code>, parent process ID <code>ppid</code>, percent CPU usage, and resident set size
<code>rss</code> (a measure of memory usage).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# pass any expression to syrup. first, sequentially:
res_syrup &lt;- syrup({res_output &lt;- Sys.sleep(1)})

res_syrup

# to snapshot memory and CPU information more (or less) often, set `interval`
syrup(Sys.sleep(1), interval = .01)

# use `peak = TRUE` to return only the snapshot with
# the highest memory usage (as `sum(rss)`)
syrup(Sys.sleep(1), interval = .01, peak = TRUE)

# results from syrup are more---or maybe only---useful when
# computations are evaluated in parallel. see package README
# for an example.

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
