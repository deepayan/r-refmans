<!DOCTYPE html><html><head><title>Help for package aVirtualTwins</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {aVirtualTwins}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#aVirtualTwins'><p>aVirtualTwins : An adapation of VirtualTwins method created by Jared Foster.</p></a></li>
<li><a href='#formatRCTDataset'><p>RCT format for Virtual Twins</p></a></li>
<li><a href='#sepsis'><p>Clinical Trial for Sepsis desease</p></a></li>
<li><a href='#vt.data'><p>Initialize virtual twins data</p></a></li>
<li><a href='#VT.difft'><p>Difference between twins</p></a></li>
<li><a href='#vt.forest'><p>Create forest to compute difft</p></a></li>
<li><a href='#VT.forest'><p>Difft by Random Forest</p></a></li>
<li><a href='#VT.forest.double'><p>Difft by double random forest</p></a></li>
<li><a href='#VT.forest.fold'><p>Difft via k random forests</p></a></li>
<li><a href='#VT.forest.one'><p>Difft by one random forest</p></a></li>
<li><a href='#VT.object'><p>VT.object</p></a></li>
<li><a href='#VT.predict'><p>VT.predict generic function</p></a></li>
<li><a href='#vt.subgroups'><p>Visualize subgroups</p></a></li>
<li><a href='#vt.tree'><p>Trees to find Subgroups</p></a></li>
<li><a href='#VT.tree'><p>Tree to find subgroup</p></a></li>
<li><a href='#VT.tree.class'><p>Classification tree to find subgroups</p></a></li>
<li><a href='#VT.tree.reg'><p>Regression tree to find subgroups</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Adaptation of Virtual Twins Method from Jared Foster</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2018-02-03</td>
</tr>
<tr>
<td>Description:</td>
<td>Research of subgroups in random clinical trials with binary outcome and two treatments groups. This is an adaptation of the Jared Foster method (<a href="https://www.ncbi.nlm.nih.gov/pubmed/21815180">https://www.ncbi.nlm.nih.gov/pubmed/21815180</a>).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> | file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/prise6/aVirtualTwins">https://github.com/prise6/aVirtualTwins</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/prise6/aVirtualTwins/issues">https://github.com/prise6/aVirtualTwins/issues</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>rpart, party, methods, randomForest, stats</td>
</tr>
<tr>
<td>Suggests:</td>
<td>caret, knitr, rpart.plot, rmarkdown, e1071</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.2.0),</td>
</tr>
<tr>
<td>Collate:</td>
<td>'aVirtualTwins.R' 'data.R' 'object.R' 'difft.R' 'setClass.R'
'predict.R' 'forest.R' 'forest.double.R' 'forest.fold.R'
'forest.one.R' 'forest.wrapper.R' 'formatRCTDataset.R'
'incidences.R' 'object.wrapper.R' 'tools.R' 'tree.R'
'tree.class.R' 'tree.reg.R' 'tree.wrapper.R'</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.0.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2018-02-03 15:22:29 UTC; prise6</td>
</tr>
<tr>
<td>Author:</td>
<td>Francois Vieille [aut, cre],
  Jared Foster [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Francois Vieille &lt;vieille.francois@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2018-02-04 16:00:40 UTC</td>
</tr>
</table>
<hr>
<h2 id='aVirtualTwins'>aVirtualTwins : An adapation of VirtualTwins method created by Jared Foster.</h2><span id='topic+aVirtualTwins'></span><span id='topic+aVirtualTwins-package'></span><span id='topic+aVirtualTwins-package'></span>

<h3>Description</h3>

<p>aVirtualTwins is written mainly with reference classes. Briefly, there is three kinds of class :
</p>

<ul>
<li> <p><code><a href="#topic+VT.object">VT.object</a></code> class to represent RCT dataset used by aVirtualTwins. To format correctly RCT dataset, use <code><a href="#topic+formatRCTDataset">formatRCTDataset</a></code>.
</p>
</li>
<li> <p><code><a href="#topic+VT.difft">VT.difft</a></code> class to compute difference between twins. Family <code><a href="#topic+VT.forest">VT.forest</a></code> extends it to compute twins by random forest.
<code><a href="#topic+vt.forest">vt.forest</a></code> is users function.
</p>
</li>
<li> <p><code><a href="#topic+VT.tree">VT.tree</a></code> class to find subgroups from <code>difft</code> by CART trees. <code><a href="#topic+VT.tree.class">VT.tree.class</a></code> and <code><a href="#topic+VT.tree.reg">VT.tree.reg</a></code> extend it. 
<code><a href="#topic+vt.tree">vt.tree</a></code> is users function.
</p>
</li></ul>



<h3>Details</h3>

<p>See http://github.com/prise6/aVirtualTwins for last updates.
</p>

<hr>
<h2 id='formatRCTDataset'>RCT format for Virtual Twins</h2><span id='topic+formatRCTDataset'></span>

<h3>Description</h3>

<p><code>formatRCTDataset</code> returns dataset that Virtual Twins is able to 
analyze.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>formatRCTDataset(dataset, outcome.field, treatment.field, interactions = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="formatRCTDataset_+3A_dataset">dataset</code></td>
<td>
<p>data.frame representing RCT's</p>
</td></tr>
<tr><td><code id="formatRCTDataset_+3A_outcome.field">outcome.field</code></td>
<td>
<p>name of the outcome's field in <code>dataset</code></p>
</td></tr>
<tr><td><code id="formatRCTDataset_+3A_treatment.field">treatment.field</code></td>
<td>
<p>name of the treatment's field in <code>dataset</code></p>
</td></tr>
<tr><td><code id="formatRCTDataset_+3A_interactions">interactions</code></td>
<td>
<p>logical. If running VirtualTwins with treatment's
interactions, set to TRUE (default value)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function check these differents topic: Outcome must be binary and a 
factor. If numeric with two distincts values, outcome becomes a factor where 
the favorable reponse is the second level. Also, outcome is moved on the 
first column of <code>dataset</code>.
</p>
<p>Treatment must have two distinct numeric values, 0 : no treatment, 1 : 
treatment. Treatment is moved to the second column.
</p>
<p>Qualitatives variables must be factor. If it has more than two levels, if 
running VirtualTwins with interaction, it creates dummy variables.
</p>


<h3>Value</h3>

<p>return data.frame with good format (explained in details section) to run VirtualTwins
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
    data.format &lt;- formatRCTDataset(data, "outcome", "treatment", TRUE)

## End(Not run)
data(sepsis)
data.format &lt;- formatRCTDataset(sepsis, "survival", "THERAPY", T)
 

 
  
</code></pre>

<hr>
<h2 id='sepsis'>Clinical Trial for Sepsis desease</h2><span id='topic+sepsis'></span>

<h3>Description</h3>

<p>Simulated clinical trial with two groups treatment about sepsis desease. See 
details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(sepsis)
</code></pre>


<h3>Format</h3>

<p>470 patients and 13 variables. </p>
 <dl>
<dt>survival</dt><dd><p>binary 
outcome</p>
</dd> <dt>THERAPY</dt><dd><p>1 for active treatment, 0 for control treatment</p>
</dd> 
<dt>TIMFIRST</dt><dd><p>Time from first sepsis-organ fail to start drug</p>
</dd> 
<dt>AGE</dt><dd><p>Patient age in years</p>
</dd> <dt>BLLPLAT</dt><dd><p>Baseline local platelets</p>
</dd> 
<dt>blSOFA</dt><dd><p>Sum of baselin sofa (cardiovascular, hematology, 
hepaticrenal, and respiration scores)</p>
</dd> <dt>BLLCREAT</dt><dd><p>Base creatinine</p>
</dd> 
<dt>ORGANNUM</dt><dd><p>Number of baseline organ failures</p>
</dd> 
<dt>PRAPACHE</dt><dd><p>Pre-infusion apache-ii score</p>
</dd> <dt>BLGCS</dt><dd><p>Base GLASGOW 
coma scale score</p>
</dd> <dt>BLIL6</dt><dd><p>Baseline serum IL-6 concentration</p>
</dd> 
<dt>BLADL</dt><dd><p>Baseline activity of daily living score</p>
</dd> 
<dt>BLLBILI</dt><dd><p>Baseline local bilirubin</p>
</dd> </dl>


<h3>Details</h3>

<p>This dataset is taken from 
<a href="http://biopharmnet.com/subgroup-analysis-software/">SIDES
method</a>.
</p>
<p><code>Sepsis</code> contains simulated data on 470 subjects with a binary outcome 
survival, that stores survival status for patient after 28 days of treatment,
value of 1 for subjects who died after 28 days and 0 otherwise. There are 11 
covariates, listed below, all of which are numerical variables.
</p>
<p>Note that contrary to the original dataset used in SIDES, missing values have
been imputed by random forest <code>(randomForest::rfImpute())</code>. See file 
data-raw/sepsis.R for more details.
</p>
<p>True subgroup is <em>PRAPACHE &lt;= 26 &amp; AGE &lt;= 49.80</em>. <em>NOTE:</em> This 
subgroup is defined with the <em>lower</em> event rate (survival = 1) in
treatement arm.
</p>


<h3>Source</h3>

<p><a href="http://biopharmnet.com/subgroup-analysis-software/">http://biopharmnet.com/subgroup-analysis-software/</a>
</p>

<hr>
<h2 id='vt.data'>Initialize virtual twins data</h2><span id='topic+vt.data'></span>

<h3>Description</h3>

<p><code>vt.data</code> is a wrapper of <code><a href="#topic+formatRCTDataset">formatRCTDataset</a></code> and 
<code><a href="#topic+VT.object">VT.object</a></code>. Allows to format your data.frame in order to create
a VT.object object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vt.data(dataset, outcome.field, treatment.field, interactions = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vt.data_+3A_dataset">dataset</code></td>
<td>
<p>data.frame representing RCT's</p>
</td></tr>
<tr><td><code id="vt.data_+3A_outcome.field">outcome.field</code></td>
<td>
<p>name of the outcome's field in <code>dataset</code></p>
</td></tr>
<tr><td><code id="vt.data_+3A_treatment.field">treatment.field</code></td>
<td>
<p>name of the treatment's field in <code>dataset</code></p>
</td></tr>
<tr><td><code id="vt.data_+3A_interactions">interactions</code></td>
<td>
<p>logical. If running VirtualTwins with treatment's 
interactions, set to TRUE (default value)</p>
</td></tr>
<tr><td><code id="vt.data_+3A_...">...</code></td>
<td>
<p>parameters of <code><a href="#topic+VT.object">VT.object</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>VT.object</code>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+formatRCTDataset">formatRCTDataset</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(sepsis)
vt.o &lt;- vt.data(sepsis, "survival", "THERAPY", T)
  
</code></pre>

<hr>
<h2 id='VT.difft'>Difference between twins</h2><span id='topic+VT.difft'></span>

<h3>Description</h3>

<p>A reference class to represent difference between twin1 and twin2
</p>


<h3>Details</h3>

<p>Difft are calculated depending on the favorable outcome chosen. It is the 
second level of the outcome. For example, if the outcome is 0 and 1, the 
favorable outcome is 1. Then, </p>
<p style="text-align: center;"><code class="reqn">difft_i = twin1_i - twin2_i if T_i = 1</code>
</p>

<p style="text-align: center;"><code class="reqn"> difft_i = twin2_i - twin1_i if T_i = 0</code>
</p>
<p>.
So <em>absolute</em> method is :
</p>
<p style="text-align: center;"><code class="reqn">P(Y = 1 | T = 1) - P(Y = 1 | T =0)</code>
</p>

<p>So <em>relative</em> method is :
</p>
<p style="text-align: center;"><code class="reqn">P(Y = 1 | T = 1)/P(Y = 1 | T =0)</code>
</p>

<p>So <em>absolute</em> method is :
</p>
<p style="text-align: center;"><code class="reqn">logit(P(Y = 1 | T = 1)) - logit(P(Y = 1 | T =0))</code>
</p>



<h3>Fields</h3>


<dl>
<dt><code>vt.object</code></dt><dd><p>VT.object (refClass) representing data</p>
</dd>
<dt><code>twin1</code></dt><dd><p>vector of <code class="reqn">E(Y|T = real treatment)</code></p>
</dd>
<dt><code>twin2</code></dt><dd><p>vector of <code class="reqn">E(Y|T = another treatment)</code></p>
</dd>
<dt><code>method</code></dt><dd><p>Method available to compute difft : c(&quot;absolute&quot;, &quot;relative&quot;,
&quot;logit&quot;). Absolute is default value. See details.</p>
</dd>
<dt><code>difft</code></dt><dd><p>vector of difference between twin1 and twin2</p>
</dd>
</dl>


<h3>Methods</h3>


<dl>
<dt><code>computeDifft()</code></dt><dd><p>Compute difference between twin1 and twin2. See details.</p>
</dd>
</dl>


<h3>See Also</h3>

<p><code><a href="#topic+VT.forest">VT.forest</a></code>, <code><a href="#topic+VT.forest.one">VT.forest.one</a></code>,
<code><a href="#topic+VT.forest.double">VT.forest.double</a></code>
</p>

<hr>
<h2 id='vt.forest'>Create forest to compute difft</h2><span id='topic+vt.forest'></span>

<h3>Description</h3>

<p><code>vt.forest</code> is a wrapper of <code><a href="#topic+VT.forest.one">VT.forest.one</a></code>, 
<code><a href="#topic+VT.forest.double">VT.forest.double</a></code> and <code><a href="#topic+VT.forest.fold">VT.forest.fold</a></code>. With 
parameter forest.type, any of these class can be used with its own parameter.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vt.forest(forest.type = "one", vt.data, interactions = T,
  method = "absolute", model = NULL, model_trt1 = NULL,
  model_trt0 = NULL, ratio = 1, fold = 10, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vt.forest_+3A_forest.type">forest.type</code></td>
<td>
<p>must be a character. &quot;one&quot; to use VT.forest.one class. 
&quot;double&quot; to use VT.forest.double. &quot;fold&quot; to use VT.forest.fold.</p>
</td></tr>
<tr><td><code id="vt.forest_+3A_vt.data">vt.data</code></td>
<td>
<p><code><a href="#topic+VT.object">VT.object</a></code>. Can be return of <code>vt.data()</code> 
function</p>
</td></tr>
<tr><td><code id="vt.forest_+3A_interactions">interactions</code></td>
<td>
<p>logical. If running VirtualTwins with treatment's 
interactions, set to TRUE (default value)</p>
</td></tr>
<tr><td><code id="vt.forest_+3A_method">method</code></td>
<td>
<p>character c(&quot;absolute&quot;, &quot;relative&quot;, &quot;logit&quot;). See 
<code><a href="#topic+VT.difft">VT.difft</a></code>.</p>
</td></tr>
<tr><td><code id="vt.forest_+3A_model">model</code></td>
<td>
<p>allows to give a model you build outside this function. Can be 
randomForest, train or cforest. Is only used with forest.type = &quot;one&quot;. If 
NULL, a randomForest model is grown inside the function. NULL is default.</p>
</td></tr>
<tr><td><code id="vt.forest_+3A_model_trt1">model_trt1</code></td>
<td>
<p>see model_trt0 explanation and 
<code><a href="#topic+VT.forest.double">VT.forest.double</a></code> details.</p>
</td></tr>
<tr><td><code id="vt.forest_+3A_model_trt0">model_trt0</code></td>
<td>
<p>works the same as model parameter. Is only used with 
forest.type = &quot;double&quot;. If NULL, a randomForest model is grown inside the 
function. NULL is default. See <code><a href="#topic+VT.forest.double">VT.forest.double</a></code> for details.</p>
</td></tr>
<tr><td><code id="vt.forest_+3A_ratio">ratio</code></td>
<td>
<p>numeric value that allow sampsize to be a bit controlled.
Default to 1. See <code><a href="#topic+VT.forest.fold">VT.forest.fold</a></code>.</p>
</td></tr>
<tr><td><code id="vt.forest_+3A_fold">fold</code></td>
<td>
<p>number of fold you want to construct forest with k-fold method. 
Is only used with forest.type = &quot;fold&quot;. Default to 5. See 
<code><a href="#topic+VT.forest.fold">VT.forest.fold</a></code></p>
</td></tr>
<tr><td><code id="vt.forest_+3A_...">...</code></td>
<td>
<p>randomForest() function parameters. Can be used for any forest.type.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>VT.difft</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(sepsis)
vt.o &lt;- vt.data(sepsis, "survival", "THERAPY", T)
# inside model :
vt.f &lt;- vt.forest("one", vt.o)
# ...
# your model :
# library(randomForest)
# rf &lt;- randomForest(y = vt.o$getY(),
#                    x = vt.o$getX(int = T),
#                    mtry = 3,
#                    nodesize = 15)
# vt.f &lt;- vt.forest("one", vt.o, model = rf)
# ...
# Can also use ... parameters
vt.f &lt;- vt.forest("one", vt.o, mtry = 3, nodesize = 15)
# ...
   

</code></pre>

<hr>
<h2 id='VT.forest'>Difft by Random Forest</h2><span id='topic+VT.forest'></span>

<h3>Description</h3>

<p>An abstract reference class to compute twin via random forests
</p>
<p><code>VT.forest</code> extends <code>VT.difft</code>
</p>


<h3>Fields</h3>


<dl>
<dt><code>...</code></dt><dd><p>see fields of <code><a href="#topic+VT.difft">VT.difft</a></code></p>
</dd>
</dl>


<h3>Methods</h3>


<dl>
<dt><code>checkModel(model)</code></dt><dd><p>Checking model class: Must be : train, RandomForest, randomForest</p>
</dd>
<dt><code>getFullData()</code></dt><dd><p>Return twin1, twin2 and difft in column</p>
</dd>
<dt><code>run()</code></dt><dd><p>Compute twin1 and twin2 estimation. Switch treatment if necessary.</p>
</dd>
</dl>


<h3>See Also</h3>

<p><code><a href="#topic+VT.difft">VT.difft</a></code>, <code><a href="#topic+VT.forest.one">VT.forest.one</a></code>, <code><a href="#topic+VT.forest.double">VT.forest.double</a></code>
</p>

<hr>
<h2 id='VT.forest.double'>Difft by double random forest</h2><span id='topic+VT.forest.double'></span>

<h3>Description</h3>

<p>A reference class to compute twins via double random forests
</p>


<h3>Details</h3>

<p><code>VT.forest.double</code> extends <code>VT.forest</code>.
</p>
<p><code class="reqn">E(Y|T = 1)</code> if <code class="reqn">T_i = 1</code> is estimated by OOB predictions from
<code>model_trt1</code>. 
<code class="reqn">E(Y|T = 0)</code> if <code class="reqn">T_i = 0</code> is estimated by OOB predictions from
<code>model_trt0</code>.
This is what <code>computeTwin1()</code> does.
</p>
<p>Then <code class="reqn">E(Y|T = 1)</code> if <code class="reqn">T_i = 0</code> is estimated by model_trt1.
Then <code class="reqn">E(Y|T = 0)</code> if <code class="reqn">T_i = 1</code> is estimated by model_trt1.
This is what <code>computeTwin2()</code> does.
</p>


<h3>Fields</h3>


<dl>
<dt><code>model_trt1</code></dt><dd><p>a caret/RandomForest/randomForest object for treatment T =
1</p>
</dd>
<dt><code>model_trt0</code></dt><dd><p>a caret/RandomForest/randomForest object for treatment T =
0</p>
</dd>
<dt><code>...</code></dt><dd><p>field from parent class : <code><a href="#topic+VT.forest">VT.forest</a></code></p>
</dd>
</dl>


<h3>Methods</h3>


<dl>
<dt><code>computeTwin1()</code></dt><dd><p>Compute twin1 with OOB predictions from double forests. See details.</p>
</dd>
<dt><code>computeTwin2()</code></dt><dd><p>Compute twin2 by the other part of data in the other forest. See details.</p>
</dd>
</dl>


<h3>See Also</h3>

<p><code><a href="#topic+VT.difft">VT.difft</a></code>, <code><a href="#topic+VT.forest">VT.forest</a></code>,
<code><a href="#topic+VT.forest.one">VT.forest.one</a></code>
</p>

<hr>
<h2 id='VT.forest.fold'>Difft via k random forests</h2><span id='topic+VT.forest.fold'></span>

<h3>Description</h3>

<p>A reference class to compute twins via k random forest
</p>


<h3>Details</h3>

<p><code>VT.forest.fold</code> extends <code>VT.forest</code>
</p>
<p>Twins are estimated by k-fold cross validation. A forest is computed on k-1/k
of the data and then used to estimate twin1 and twin2 on 1/k of the left 
data.
</p>


<h3>Fields</h3>


<dl>
<dt><code>interactions</code></dt><dd><p>logical set TRUE if model has been computed with 
interactions</p>
</dd>
<dt><code>fold</code></dt><dd><p>numeric, number of fold, i.e. number of forest (k)</p>
</dd>
<dt><code>ratio</code></dt><dd><p>numeric experimental, use to balance sampsize. Defaut to 1.</p>
</dd>
<dt><code>groups</code></dt><dd><p>vector Define which observations belong to which group</p>
</dd>
<dt><code>...</code></dt><dd><p>field from parent class : <code><a href="#topic+VT.forest">VT.forest</a></code></p>
</dd>
</dl>


<h3>Methods</h3>


<dl>
<dt><code>run()</code></dt><dd><p>Compute twin1 and twin2 estimation. Switch treatment if necessary.</p>
</dd>
</dl>


<h3>See Also</h3>

<p><code><a href="#topic+VT.difft">VT.difft</a></code>, <code><a href="#topic+VT.forest">VT.forest</a></code>, 
<code><a href="#topic+VT.forest.one">VT.forest.one</a></code>, <code><a href="#topic+VT.forest.double">VT.forest.double</a></code>
</p>

<hr>
<h2 id='VT.forest.one'>Difft by one random forest</h2><span id='topic+VT.forest.one'></span>

<h3>Description</h3>

<p>A reference class to compute twins via one random forest
</p>


<h3>Details</h3>

<p><code>VT.forest.one</code> extends <code>VT.forest</code>.
</p>
<p>OOB predictions are used to estimate <code class="reqn">E(Y|T = real treatment)</code>. Then, 
treatement is switched, it means that 1 becomes 0 and 0 becomes 1. We use 
again <code>model</code> to estimate <code class="reqn">E(Y|T = the other treatment)</code>. This is
what <code>computeTwin1()</code> and <code>computeTwin2()</code> functions do.
</p>


<h3>Fields</h3>


<dl>
<dt><code>model</code></dt><dd><p>is a caret/RandomForest/randomForest class object</p>
</dd>
<dt><code>interactions</code></dt><dd><p>logical set TRUE if model has been computed with interactions</p>
</dd>
<dt><code>...</code></dt><dd><p>field from parent class : <code><a href="#topic+VT.forest">VT.forest</a></code></p>
</dd>
</dl>


<h3>Methods</h3>


<dl>
<dt><code>computeTwin1()</code></dt><dd><p>Compute twin1 with OOB predictions</p>
</dd>
<dt><code>computeTwin2()</code></dt><dd><p>Compute twin2 by switching treatment and applying random forest model</p>
</dd>
</dl>


<h3>See Also</h3>

<p><code><a href="#topic+VT.difft">VT.difft</a></code>, <code><a href="#topic+VT.forest">VT.forest</a></code>, <code><a href="#topic+VT.forest.double">VT.forest.double</a></code>
</p>

<hr>
<h2 id='VT.object'>VT.object</h2><span id='topic+VT.object'></span>

<h3>Description</h3>

<p>A Reference Class to deal with RCT dataset
</p>


<h3>Details</h3>

<p>Currently working with binary response only. Continous will come, one day. 
Two-levels treatment only as well.
</p>
<p><code>data</code> field should be as described, however if virtual twins won't used
interactions, there is no need to transform factors. See
<a href="#topic+formatRCTDataset">formatRCTDataset</a> for more details.
</p>


<h3>Fields</h3>


<dl>
<dt><code>data</code></dt><dd><p>Data.frame with format: <code class="reqn">Y,T,X_{1}, \ldots, X_{p}</code>. Y must be
two levels factor if type is binary. T must be numeric or integer.</p>
</dd>
<dt><code>screening</code></dt><dd><p>Logical, set to <code>FALSE</code> Set to <code>TRUE</code> to use
<code>varimp</code> in trees computation.</p>
</dd>
<dt><code>varimp</code></dt><dd><p>Character vector of important variables to use in trees 
computation.</p>
</dd>
<dt><code>delta</code></dt><dd><p>Numeric representing the difference of incidence between 
treatments.</p>
</dd>
<dt><code>type</code></dt><dd><p>Character : binary or continous. Only binary is currently 
available.</p>
</dd>
</dl>


<h3>Methods</h3>


<dl>
<dt><code>computeDelta()</code></dt><dd><p>Compute delta value.</p>
</dd>
<dt><code>getData(interactions = F)</code></dt><dd><p>Return dataset. If interactions is set to T, return data with treatement interactions</p>
</dd>
<dt><code>getFormula()</code></dt><dd><p>Return formula : Y~T+X1+...+Xp. Usefull for cforest function.</p>
</dd>
<dt><code>getIncidences(rule = NULL)</code></dt><dd><p>Return incidence table of data if rule set to NULL. Otherwise return incidence for the rule.</p>
</dd>
<dt><code>getX(interactions = T, trt = NULL)</code></dt><dd><p>Return predictors (T,X,X*T,X*(1-T)). Or (T,X) if interactions is FALSE.
If trt is not NULL, return predictors for T = trt</p>
</dd>
<dt><code>getXwithInt()</code></dt><dd><p>Return predictors with interactions. Use VT.object::getX(interactions = T) instead.</p>
</dd>
<dt><code>getY(trt = NULL)</code></dt><dd><p>Return outcome. If trt is not NULL, return outcome for T = trt.</p>
</dd>
<dt><code>switchTreatment()</code></dt><dd><p>Switch treatment value.</p>
</dd>
</dl>


<h3>See Also</h3>

<p><code><a href="#topic+VT.difft">VT.difft</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Default use :
vt.o &lt;- VT.object$new(data = my.rct.dataset)

# Getting data
head(vt.o$data)

# or getting predictor with interactions
vt.o$getX(interactions = T)

# or getting X|T = 1
vt.o$getX(trt = 1)

# or getting Y|T = 0
vt.o$getY(0)

# Print incidences
vt.o$getIncidences()

## End(Not run)

</code></pre>

<hr>
<h2 id='VT.predict'>VT.predict generic function</h2><span id='topic+VT.predict'></span><span id='topic+VT.predict+2CRandomForest+2Cmissing+2Ccharacter-method'></span><span id='topic+VT.predict+2CRandomForest+2Cdata.frame+2Ccharacter-method'></span><span id='topic+VT.predict+2CrandomForest+2Cmissing+2Ccharacter-method'></span><span id='topic+VT.predict+2CrandomForest+2Cdata.frame+2Ccharacter-method'></span><span id='topic+VT.predict+2Ctrain+2CANY+2Ccharacter-method'></span><span id='topic+VT.predict+2Ctrain+2Cmissing+2Ccharacter-method'></span>

<h3>Description</h3>

<p>VT.predict generic function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>VT.predict(rfor, newdata, type)

## S4 method for signature 'RandomForest,missing,character'
VT.predict(rfor, type = "binary")

## S4 method for signature 'RandomForest,data.frame,character'
VT.predict(rfor, newdata,
  type = "binary")

## S4 method for signature 'randomForest,missing,character'
VT.predict(rfor, type = "binary")

## S4 method for signature 'randomForest,data.frame,character'
VT.predict(rfor, newdata,
  type = "binary")

## S4 method for signature 'train,ANY,character'
VT.predict(rfor, newdata, type = "binary")

## S4 method for signature 'train,missing,character'
VT.predict(rfor, type = "binary")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="VT.predict_+3A_rfor">rfor</code></td>
<td>
<p>random forest model. Can be train, randomForest or RandomForest
class.</p>
</td></tr>
<tr><td><code id="VT.predict_+3A_newdata">newdata</code></td>
<td>
<p>Newdata to predict by the random forest model. If missing, OOB
predictions are returned.</p>
</td></tr>
<tr><td><code id="VT.predict_+3A_type">type</code></td>
<td>
<p>Must be binary or continous, depending on the outcome. Only
binary is really available.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector <code class="reqn">E(Y=1)</code>
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>rfor = RandomForest,newdata = missing,type = character</code>: rfor(RandomForest) newdata (missing) type (character)
</p>
</li>
<li> <p><code>rfor = RandomForest,newdata = data.frame,type = character</code>: rfor(RandomForest) newdata (data.frame) type (character)
</p>
</li>
<li> <p><code>rfor = randomForest,newdata = missing,type = character</code>: rfor(randomForest) newdata (missing) type (character)
</p>
</li>
<li> <p><code>rfor = randomForest,newdata = data.frame,type = character</code>: rfor(randomForest) newdata (data.frame) type (character)
</p>
</li>
<li> <p><code>rfor = train,newdata = ANY,type = character</code>: rfor(train) newdata (ANY) type (character)
</p>
</li>
<li> <p><code>rfor = train,newdata = missing,type = character</code>: rfor(train) newdata (missing) type (character)
</p>
</li></ul>

<hr>
<h2 id='vt.subgroups'>Visualize subgroups</h2><span id='topic+vt.subgroups'></span>

<h3>Description</h3>

<p>Function which uses <code><a href="#topic+VT.tree">VT.tree</a></code> intern functions. Package 
rpart.plot must be loaded. See <code><a href="#topic+VT.tree">VT.tree</a></code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vt.subgroups(vt.trees, only.leaf = T, only.fav = T, tables = F,
  verbose = F, compete = F)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vt.subgroups_+3A_vt.trees">vt.trees</code></td>
<td>
<p><code><a href="#topic+VT.tree">VT.tree</a></code> object. Or return of 
<code><a href="#topic+vt.tree">vt.tree</a></code> function. Can be a list.</p>
</td></tr>
<tr><td><code id="vt.subgroups_+3A_only.leaf">only.leaf</code></td>
<td>
<p>logical to select only leaf of trees. TRUE is default.</p>
</td></tr>
<tr><td><code id="vt.subgroups_+3A_only.fav">only.fav</code></td>
<td>
<p>logical select only favorable subgroups (meaning with 
favorable label of the tree). TRUE is default.</p>
</td></tr>
<tr><td><code id="vt.subgroups_+3A_tables">tables</code></td>
<td>
<p>set to TRUE if tables of incidence must be shown. FALSE is 
default.</p>
</td></tr>
<tr><td><code id="vt.subgroups_+3A_verbose">verbose</code></td>
<td>
<p>print infos during computation. FALSE is default.</p>
</td></tr>
<tr><td><code id="vt.subgroups_+3A_compete">compete</code></td>
<td>
<p>print competitors rules thanks to competitors computation of
the tree</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame of rules
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(sepsis)
vt.o &lt;- vt.data(sepsis, "survival", "THERAPY", TRUE)
# inside model :
vt.f &lt;- vt.forest("one", vt.o)
# use classification tree
vt.tr &lt;- vt.tree("class", vt.f, threshold = c(0.01, 0.05))
# show subgroups
subgroups &lt;- vt.subgroups(vt.tr)
# change options you'll be surprised !
subgroups &lt;- vt.subgroups(vt.tr, verbose = TRUE, tables = TRUE)

</code></pre>

<hr>
<h2 id='vt.tree'>Trees to find Subgroups</h2><span id='topic+vt.tree'></span>

<h3>Description</h3>

<p><code>vt.tree</code> is a wrapper of <code><a href="#topic+VT.tree.class">VT.tree.class</a></code> and 
<code><a href="#topic+VT.tree.reg">VT.tree.reg</a></code>. With parameter tree.type, any of these two class 
can be used with its own parameter.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vt.tree(tree.type = "class", vt.difft, sens = "&gt;", threshold = seq(0.5,
  0.8, 0.1), screening = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vt.tree_+3A_tree.type">tree.type</code></td>
<td>
<p>must be a character. &quot;class&quot; for classification tree, &quot;reg&quot; 
for regression tree.</p>
</td></tr>
<tr><td><code id="vt.tree_+3A_vt.difft">vt.difft</code></td>
<td>
<p><code><a href="#topic+VT.difft">VT.difft</a></code> object. Or return of 
<code><a href="#topic+vt.forest">vt.forest</a></code> function.</p>
</td></tr>
<tr><td><code id="vt.tree_+3A_sens">sens</code></td>
<td>
<p>must be a character c(&quot;&gt;&quot;,&quot;&lt;&quot;). See <code><a href="#topic+VT.tree">VT.tree</a></code> for 
details.</p>
</td></tr>
<tr><td><code id="vt.tree_+3A_threshold">threshold</code></td>
<td>
<p>must be numeric. It can be a unique value or a vector. If 
numeric vector, a list is returned. See <code><a href="#topic+VT.tree">VT.tree</a></code> for details.</p>
</td></tr>
<tr><td><code id="vt.tree_+3A_screening">screening</code></td>
<td>
<p>must be logical. If TRUE, only varimp variables of VT.object
is used to create the tree.</p>
</td></tr>
<tr><td><code id="vt.tree_+3A_...">...</code></td>
<td>
<p>rpart() function parameters. Can be used for any tree.type.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+VT.tree">VT.tree</a></code>, <code><a href="#topic+VT.tree.class">VT.tree.class</a></code> and 
<code><a href="#topic+VT.tree.reg">VT.tree.reg</a></code> classes.
</p>


<h3>Value</h3>

<p><code>VT.tree</code> or a list of <code>VT.tree</code> depending on threshold 
dimension. See examples.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(sepsis)
vt.o &lt;- vt.data(sepsis, "survival", "THERAPY", T)
# inside model :
vt.f &lt;- vt.forest("one", vt.o)
# use classification tree
vt.tr &lt;- vt.tree("class", vt.f, threshold = c(0.01, 0.05))
# return a list
class(vt.tr)
# access one of the tree
tree1 &lt;- vt.tr$tree1
# return infos
# vt.tr$tree1$getInfos()
# vt.tr$tree1$getRules()
# use vt.subgroups tool:
subgroups &lt;- vt.subgroups(vt.tr)
  
</code></pre>

<hr>
<h2 id='VT.tree'>Tree to find subgroup</h2><span id='topic+VT.tree'></span>

<h3>Description</h3>

<p>An abstract reference class to compute tree
</p>


<h3>Details</h3>

<p><code>VT.tree.class</code> and <code>VT.tree.reg</code> are children of <code>VT.tree</code>.
<code>VT.tree.class</code> and <code>VT.tree.reg</code> try to find a strong association 
between <code>difft</code> (in <code>VT.difft</code> object) and RCT variables.
</p>
<p>In <code>VT.tree.reg</code>, a regression tree is computed on <code>difft</code> values. 
Then, thanks to the <code>threshold</code> it flags leafs of the <code>tree</code> which 
are above the <code>threshold</code> (when <code>sens</code> is &quot;&gt;&quot;). Or it flags leafs 
which are below the <code>threshold</code> (when <code>sens</code> = &quot;&lt;&quot;).
</p>
<p>In <code>VT.tree.class</code>, it first flags <code>difft</code> above or below 
(depending on the <code>sens</code>) the given <code>threshold</code>. Then a 
classification tree is computed to find which variables explain flagged 
<code>difft</code>.
</p>
<p>To sum up, <code>VT.tree</code> try to understand which variables are associated 
with a big change of <code>difft</code>.
</p>
<p>Results are shown with <code>getRules()</code> function. <code>only.leaf</code> parameter
allows to obtain only the leaf of the <code>tree</code>. <code>only.fav</code> parameter 
select only favorable nodes. <code>tables</code> shows incidence table of the rule.
<code>verbose</code> allow <code>getRules()</code> to be quiet. And <code>compete</code> show
also rules with <code>maxcompete</code> competitors from the <code>tree</code>.
</p>


<h3>Fields</h3>


<dl>
<dt><code>vt.difft</code></dt><dd><p><code>VT.difft</code> object</p>
</dd>
<dt><code>outcome</code></dt><dd><p>outcome vector from <code>rpart</code> function</p>
</dd>
<dt><code>threshold</code></dt><dd><p>numeric Threshold for difft calculation (c)</p>
</dd>
<dt><code>screening</code></dt><dd><p>Logical. TRUE if using varimp. Default is VT.object 
screening field</p>
</dd>
<dt><code>sens</code></dt><dd><p>character Sens can be &quot;&gt;&quot; (default) or &quot;&lt;&quot;. Meaning : 
<code>difft</code> &gt; <code>threshold</code> or <code>difft</code> &lt; <code>threshold</code></p>
</dd>
<dt><code>name</code></dt><dd><p>character Names of the tree</p>
</dd>
<dt><code>tree</code></dt><dd><p>rpart Rpart object to construct the tree</p>
</dd>
<dt><code>Ahat</code></dt><dd><p>vector Indicator of beglonging to Ahat</p>
</dd>
</dl>


<h3>Methods</h3>


<dl>
<dt><code>computeNameOfTree(type)</code></dt><dd><p>return label of response variable of the tree</p>
</dd>
<dt><code>createCompetitors()</code></dt><dd><p>Create competitors table</p>
</dd>
<dt><code>getAhatIncidence()</code></dt><dd><p>Return Ahat incidence</p>
</dd>
<dt><code>getAhatQuality()</code></dt><dd><p>Return Ahat quality</p>
</dd>
<dt><code>getData()</code></dt><dd><p>Return data used for tree computation</p>
</dd>
<dt><code>getIncidences(rule, rr.snd = T)</code></dt><dd><p>Return incidence of the rule</p>
</dd>
<dt><code>getInfos()</code></dt><dd><p>Return infos about tree</p>
</dd>
<dt><code>getRules(only.leaf = F, only.fav = F, tables = T, verbose = T,
  compete = F)</code></dt><dd><p>Return subgroups discovered by the tree. See details.</p>
</dd>
<dt><code>run(...)</code></dt><dd><p>Compute tree with rpart parameters</p>
</dd>
</dl>


<h3>See Also</h3>

<p><code><a href="#topic+VT.tree.reg">VT.tree.reg</a></code>, <code><a href="#topic+VT.tree.class">VT.tree.class</a></code>
</p>

<hr>
<h2 id='VT.tree.class'>Classification tree to find subgroups</h2><span id='topic+VT.tree.class'></span>

<h3>Description</h3>

<p>See <code><a href="#topic+VT.tree">VT.tree</a></code>
</p>


<h3>Methods</h3>


<dl>
<dt><code>run(...)</code></dt><dd><p>Compute tree with rpart parameters</p>
</dd>
</dl>

<hr>
<h2 id='VT.tree.reg'>Regression tree to find subgroups</h2><span id='topic+VT.tree.reg'></span>

<h3>Description</h3>

<p>See <code><a href="#topic+VT.tree">VT.tree</a></code>
</p>


<h3>Methods</h3>


<dl>
<dt><code>run(...)</code></dt><dd><p>Compute tree with rpart parameters</p>
</dd>
</dl>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
