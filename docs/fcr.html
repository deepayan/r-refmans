<!DOCTYPE html><html lang="en"><head><title>Help for package fcr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {fcr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#fcr-package'><p>Dynamic prediction in functional concurrent regression with sparse functional covariates</p></a></li>
<li><a href='#content'><p>Example dataset</p></a></li>
<li><a href='#fcr'><p>Fit Functional Concurrent Regression</p></a></li>
<li><a href='#plot.fcr'><p>Plotting an fcr model fit</p></a></li>
<li><a href='#predict.fcr'><p>Prediction for fcr</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Functional Concurrent Regression for Sparse Data</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0</td>
</tr>
<tr>
<td>Author:</td>
<td>Andrew Leroux [aut, cre],
    Luo Xiao [aut, cre],
    Ciprian Crainiceanu [aut],
    William Checkly [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Andrew Leroux &lt;aleroux2@jhu.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Dynamic prediction in functional concurrent regression with an application to child growth. Extends the pffr() function from the 'refund' package to handle the scenario where the functional response and concurrently measured functional predictor are irregularly measured.  Leroux et al. (2017), Statistics in Medicine, &lt;<a href="https://doi.org/10.1002%2Fsim.7582">doi:10.1002/sim.7582</a>&gt;.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.2.4), face (&ge; 0.1), mgcv (&ge; 1.7), fields (&ge; 9.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.0.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2018-03-11 17:38:36 UTC; andrewleroux</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2018-03-13 15:45:22 UTC</td>
</tr>
</table>
<hr>
<h2 id='fcr-package'>Dynamic prediction in functional concurrent regression with sparse functional covariates</h2><span id='topic+fcr-package'></span><span id='topic+dynfcr'></span>

<h3>Description</h3>

<p>This package contains the functions for fitting dynamic functional concurrent regression
with sparse data.
</p>


<h3>Notation</h3>

<p>Let $y_ij$ denote some outcome measured at
$t_ij$ on the functional domain (e.g. time) for subject $i$ at observation
$j$.
We focus on fitting models of the form
</p>
<p style="text-align: center;"><code class="reqn">
 y_{ij} = f_0(t_{ij}) + f_1(t_{ij})X_{ij} + \cdots + b_i(t_{ij}) + \epsilon_{ij}
</code>
</p>



<h3>Estimation</h3>

<p>Estimation is performed using an iterative procedure described in Leroux et. al (2017).
Initially, a model is fit without $b_i(t_ij)$. Using the residuals from this initial fit,
the covariance function is estimated. The model is then re-fit using this covariance function.
This procedure can be iterated as many times as desired.
</p>


<h3>References</h3>

<p>Leroux A, Xiao L, Crainiceanu C, Checkley W (2017).
Dynamic prediction in functional concurrent regression with an application to child growth.
</p>

<hr>
<h2 id='content'>Example dataset</h2><span id='topic+content'></span>

<h3>Description</h3>

<p>Simulated data from the CONTENT dataset. Data contains information on child growth
as measured by WHO defined Z-scores
as well as gender.
</p>


<h3>Format</h3>

<p>A dataframe with 8 variables:
</p>

<dl>
<dt>Y</dt><dd><p>Observed HAZ score</p>
</dd>
<dt>Ytrue</dt><dd><p>True HAZ score</p>
</dd>
<dt>waz.true</dt><dd><p>True WAZ score</p>
</dd>
<dt>waz</dt><dd><p>Observed WAZ score</p>
</dd>
<dt>Male</dt><dd><p>Sex. 1 if male, 0 if female.</p>
</dd>
<dt>argvals</dt><dd><p>time of observations standardized to be in the interval [0,1]</p>
</dd>
<dt>subj</dt><dd><p>Subject ID</p>
</dd>
<dt>include</dt><dd><p>Indicator for out of sample prediction used in the vignette</p>
</dd>
</dl>


<h3>References</h3>

<p>Jaganath D, Saito M Giman RH Queirox DM, Rocha GA, Cama V, Cabrera L, Kelleher D, Windle HJ,
Crabtree JE, Jean E, Checkley W. First Detected Helicobacter pylori Infection in Infancy Modifies the
Association Between Diarrheal Disease and Childhood Growth in Peru. Helicobacter (2014); 19:272-297.
</p>

<hr>
<h2 id='fcr'>Fit Functional Concurrent Regression</h2><span id='topic+fcr'></span>

<h3>Description</h3>

<p>This function implements functional concurrent regression for sparse functional responses with both functional and scalar covariates.
This function is a wrapper for mgcv's <code><a href="mgcv.html#topic+gam">gam</a></code>/<code><a href="mgcv.html#topic+bam">bam</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fcr(formula, argvals, subj, argvals.new = NULL, data = NULL, niter = 1,
  sp = FALSE, nPhi = NULL, use_bam = FALSE, discrete = FALSE,
  face.args = list(knots = 12, lower = -3, pve = 0.95), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fcr_+3A_formula">formula</code></td>
<td>
<p>formula will accept any input formula which is valid for <code><a href="mgcv.html#topic+gam">gam</a></code>.
The formula should only include terms not associated with the random function intercept b_i(t_ij). See Examples.</p>
</td></tr>
<tr><td><code id="fcr_+3A_argvals">argvals</code></td>
<td>
<p>a string indicating the functional domain variable name in data</p>
</td></tr>
<tr><td><code id="fcr_+3A_subj">subj</code></td>
<td>
<p>a string indicating the unique subject identifier name in data</p>
</td></tr>
<tr><td><code id="fcr_+3A_argvals.new">argvals.new</code></td>
<td>
<p>new values of the functional domanin to predict using <code>face.sparse</code>, optional
if one desires to predict at points of the functional domain not included in the data fitting procedure,
they must be supplied in this argument.</p>
</td></tr>
<tr><td><code id="fcr_+3A_data">data</code></td>
<td>
<p>dataframe including all variables of interest. Must not have any missing data for variables used in model fitting.
data must also not contain any variables named: &quot;g&quot;, &quot;phi&quot; followed by any numbers, or &quot;sp&quot; followed by any numbers. These
names are reserved for the fitting procedure.</p>
</td></tr>
<tr><td><code id="fcr_+3A_niter">niter</code></td>
<td>
<p>number of times to iterate the covariance estimation</p>
</td></tr>
<tr><td><code id="fcr_+3A_sp">sp</code></td>
<td>
<p>logical arguement indicating whether smoothing parameters for random effects should be supplied to
<code><a href="mgcv.html#topic+gam">gam</a></code> or <code><a href="mgcv.html#topic+bam">bam</a></code> using estimates from <code>face.sparse</code>
(TRUE), or whether smoothing parameters for random effects should
be estimated by mgcv (FALSE). Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="fcr_+3A_nphi">nPhi</code></td>
<td>
<p>number of random effects to include in final model (i.e. number of eigenfunctions of the covariance function).
Default value (NULL) results in the use of all estimated random effects.</p>
</td></tr>
<tr><td><code id="fcr_+3A_use_bam">use_bam</code></td>
<td>
<p>logical argument indicating whether to use <code><a href="mgcv.html#topic+gam">gam</a></code> or <code><a href="mgcv.html#topic+bam">bam</a></code>.
For moderate or large number of eigenfunctions
it is recommended to use <code><a href="mgcv.html#topic+bam">bam</a></code>.</p>
</td></tr>
<tr><td><code id="fcr_+3A_discrete">discrete</code></td>
<td>
<p>logical argument indicating whether whether to supple discrete = TRUE argument to <code><a href="mgcv.html#topic+bam">bam</a></code>.
This argument may reduce computation time, but is currently listed as &ldquo;experimental&quot;. Not available when use_bam = FALSE.
Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="fcr_+3A_face.args">face.args</code></td>
<td>
<p>list of arguments to pass to <code>face.sparse</code>. Can not pass the arguments &ldquo;data&quot;, &ldquo;newdata&quot;, &ldquo;center&quot; or &ldquo;argvals.new&quot;
as these are determined by the procedure.</p>
</td></tr>
<tr><td><code id="fcr_+3A_...">...</code></td>
<td>
<p>arguments to be passed to mgcv::gam()/bam()</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The models fit are of the form
</p>
<p style="text-align: center;"><code class="reqn">y = f_0(t_{ij}) + f_1(t_{ij})X_{ij} + ... + b_i(t_{ij}) + \epsilon_{ij}</code>
</p>

<p>Note that this function will accept any valid formula for <code><a href="mgcv.html#topic+gam">gam</a></code>/<code><a href="mgcv.html#topic+bam">bam</a></code>.
However, only the identity link function is available at this time.
See the package vignettes for additional descriptions of dynamic prediction and the class of models fit by this function.
</p>


<h3>Value</h3>

<p>An object of class <code>fcr</code> containing five elements
</p>

<dl>
<dt>fit</dt><dd><p>An object corresponding to the fitted model from the mgcv package</p>
</dd>
<dt>face.object</dt><dd><p>An object corresponding to the estimated covariance features</p>
</dd>
<dt>runtime</dt><dd><p>Model fitting time</p>
</dd>
<dt>argvals</dt><dd><p>Character scalar corresponding the name of the functional domain variable</p>
</dd>
<dt>runtime</dt><dd><p>logical scalar corresponding to sp argument used in model fitting</p>
</dd></dl>



<h3>References</h3>

<p>Jaganath D, Saito M Giman RH Queirox DM, Rocha GA, Cama V, Cabrera L, Kelleher D, Windle HJ,
Crabtree JE, Jean E, Checkley W. First Detected Helicobacter pylori Infection in Infancy Modifies the
Association Between Diarrheal Disease and Childhood Growth in Peru. Helicobacter (2014); 19:272-297.
</p>
<p>Leroux A, Xiao L, Crainiceanu C, Checkley W (2017). Dynamic prediction in functional concurrent
regression with an application to child growth.
</p>
<p>Xiao L, Li C, Checkley W, Crainiceanu C. Fast covariance estimation for sparse functional data.
Statistics and Computing, (2017).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>





data &lt;- content
## smoothing parameters
k &lt;- 12  # number of interior knots for fpca (results in k + 3 basis functions)
K &lt;- 15 # dimenson of smooth for time varying coefficients

## functional domain where we need predictions
tnew &lt;- sort(unique(data$argvals))

###########################################
## Step 1: Smooth time-varying covariate ##
###########################################
dat.waz &lt;- data.frame("y" = data$waz, "subj" = data$subj, argvals = data$argvals)
fit.waz &lt;- face.sparse(dat.waz, newdata = dat.waz, knots = k, argvals.new = tnew)
data$wazPred &lt;- fit.waz$y.pred


#####################
## Step 2: Fit fcr ##
#####################
fit &lt;- fcr(formula = Y ~ s(argvals, k=K, bs="ps") +
                         s(argvals, by=Male, k=K, bs="ps") +
                         s(argvals, by=wazPred, bs="ps"),
           argvals = "argvals", subj="subj", data=data, use_bam=TRUE, argvals.new=tnew,
           face.args = list(knots=k, pve=0.99))

## plot covariance features
plot(fit, plot.covariance=TRUE)

## plot coefficient functions and qq plots for random effects
plot(fit)

########################
## Step 3: Prediction ##
########################
## data frames for in-sample and dynamic predictions
data_dyn &lt;- data_in &lt;- data

## change subject IDs to values not used in model fitting
## for dynamic prediction
data_dyn$subj &lt;- data_dyn$subj + 1000

## make all observations beyond 0.5 NA in both data frames
## and dynamically predict the concurrent covariate in
## dynamic prediction
inx_na &lt;- which(data_dyn$argvals &gt; 0.5)
data_dyn$Y[inx_na] &lt;- data_dyn$waz[inx_na] &lt;- NA
data_dyn$wazPred &lt;- predict(fit.waz,
                            newdata= data.frame("subj" = data_dyn$subj,
                                                "argvals" = data_dyn$argvals,
                                                "y" = data_dyn$Y))$y.pred

data_in$Y[inx_na]  &lt;- NA


## in sample and dynamic predictions on the same subjects
insample_preds  &lt;- predict(fit, newdata = data)
dynamic_preds   &lt;- predict(fit, newdata = data_dyn)



</code></pre>

<hr>
<h2 id='plot.fcr'>Plotting an fcr model fit</h2><span id='topic+plot.fcr'></span>

<h3>Description</h3>

<p>Plot method for <code><a href="#topic+fcr">fcr</a></code>. Takes a fitted fcr object and plots either the features of the covariance function, or the
smooth terms and qqplots for random effects. See <code><a href="mgcv.html#topic+plot.gam">plot.gam</a></code> for further details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'fcr'
plot(x, plot.covariance = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.fcr_+3A_x">x</code></td>
<td>
<p>object of class fcr.</p>
</td></tr>
<tr><td><code id="plot.fcr_+3A_plot.covariance">plot.covariance</code></td>
<td>
<p>logical argument, indicates whether to plot features of the covariance
function (correlation function, variance function, and eigenfunctions of the covariance function).
If FALSE, will call <code><a href="mgcv.html#topic+plot.gam">plot.gam</a></code> on the fitted gam/bam object. See <code><a href="mgcv.html#topic+plot.gam">plot.gam</a></code> for additional details.
Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="plot.fcr_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed to <code><a href="mgcv.html#topic+plot.gam">plot.gam</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If plot.covariance is FALSE, this function will silently return a list fo the data used to create the plots.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## see examples in fcr

</code></pre>

<hr>
<h2 id='predict.fcr'>Prediction for fcr</h2><span id='topic+predict.fcr'></span>

<h3>Description</h3>

<p>Predict method for <code><a href="#topic+fcr">fcr</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'fcr'
predict(object, newdata, type = "link", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.fcr_+3A_object">object</code></td>
<td>
<p>object of class fcr.</p>
</td></tr>
<tr><td><code id="predict.fcr_+3A_newdata">newdata</code></td>
<td>
<p>data frame including all predictors used in the model fitting procedure.
missing values for the responses are OK. Missing covariate values will result in pairwise deletion with
a warning message.</p>
</td></tr>
<tr><td><code id="predict.fcr_+3A_type">type</code></td>
<td>
<p>defaults to link (i.e. response). See <code><a href="mgcv.html#topic+predict.gam">predict.gam</a></code> for additional information.</p>
</td></tr>
<tr><td><code id="predict.fcr_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed to <code><a href="mgcv.html#topic+predict.gam">predict.gam</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object containing two elements
</p>

<dl>
<dt>dynamic_predictions</dt><dd><p>Predictions corresponding to dynamic predictions (i.e. subject ids not included in the original fitting).
Note that these predictions are slower and do not incorporate the estimated covariance between random effects and fixed effects in making
predictions. This is different than the in sample predictions which account for this estimated covariance. See <code><a href="mgcv.html#topic+predict.gam">predict.gam</a></code>
for more information.
</p>

<ul>
<li><p> fitted.values
</p>

<ul>
<li><p> y.pred fitted <code class="reqn">\hat{y}</code>
</p>
</li>
<li><p> se.fit standard errors used to create confidence intervals for <code class="reqn">\hat{y}</code>, <code class="reqn">\sqrt{var(y)}</code>
</p>
</li>
<li><p> se.fit.p standard errors used for creating prediction intervals for <code class="reqn">\hat{y}</code>, <code class="reqn">\sqrt{var(y) + \hat{\sigma^2}}</code>
</p>
</li>
<li><p> random subject specific random effects <code class="reqn">b_i</code>
</p>
</li></ul>

</li>
<li><p> scores matrix of BLUPs for subjects' eigenscores
</p>
</li>
<li><p> data newdata supplied to the function
</p>
</li></ul>

</dd>
<dt>insample_predictions</dt><dd><p>Predictions for subject ids included in the original fitting. This returns all output from the relevant
<code><a href="mgcv.html#topic+predict.gam">predict.gam</a></code>/<code><a href="mgcv.html#topic+predict.bam">predict.bam</a></code> call. </p>
</dd></dl>



<h3>Examples</h3>

<pre><code class='language-R'>## see examples in fcr

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
