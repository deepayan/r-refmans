<!DOCTYPE html><html><head><title>Help for package tsdb</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {tsdb}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#tsdb-package'>
<p>Terribly-Simple Database for Time Series</p></a></li>
<li><a href='#as.ts_table'>
<p>Coerce to ts_table</p></a></li>
<li><a href='#file_info'>
<p>Information about Data File</p></a></li>
<li><a href='#read_ts_tables'>
<p>Read Time-Series Data from Files</p></a></li>
<li><a href='#ts_table'>
<p>Create ts_table</p></a></li>
<li><a href='#ttime'>
<p>Translate Timestamps</p></a></li>
<li><a href='#write_ts_table'>
<p>Write Time-Series Data to File</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Terribly-Simple Data Base for Time Series</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1-0</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-02-20</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Enrico Schumann &lt;es@enricoschumann.net&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>A terribly-simple data base for numeric
  time series, written purely in R, so no external
  database-software is needed. Series are stored in
  plain-text files (the most-portable and enduring file
  type) in CSV format. Timestamps are encoded using R's
  native numeric representation for 'Date'/'POSIXct',
  which makes them fast to parse, but keeps them
  accessible with other software. The package provides
  tools for saving and updating series in this
  standardised format, for retrieving and joining data,
  for summarising files and directories, and for
  coercing series from and to other data types (such as
  'zoo' series).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>datetimeutils, fastmatch, utils, zoo</td>
</tr>
<tr>
<td>Suggests:</td>
<td>data.table, tinytest</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="http://enricoschumann.net/R/packages/tsdb/">http://enricoschumann.net/R/packages/tsdb/</a>,
<a href="https://github.com/enricoschumann/tsdb">https://github.com/enricoschumann/tsdb</a>,
<a href="https://gitlab.com/enricoschumann/tsdb">https://gitlab.com/enricoschumann/tsdb</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-02-20 15:36:37 UTC; es19</td>
</tr>
<tr>
<td>Author:</td>
<td>Enrico Schumann <a href="https://orcid.org/0000-0001-7601-6576"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-02-20 16:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='tsdb-package'>
Terribly-Simple Database for Time Series
</h2><span id='topic+tsdb-package'></span><span id='topic+tsdb'></span>

<h3>Description</h3>

<p>A terribly-simple data base for numeric time series,
written purely in <span class="rlang"><b>R</b></span>, so no external database-software is
needed. Series are stored in plain-text files (the
most-portable and enduring file type) in <abbr><span class="acronym">CSV</span></abbr>
format; timestamps are encoded using <span class="rlang"><b>R</b></span>'s native numeric
representation for
<code><a href="base.html#topic+Date">Date</a></code>/<code><a href="base.html#topic+POSIXct">POSIXct</a></code>, which makes them
fast to parse, but keeps them accessible with other
software. The package provides tools for saving and
updating series in this standardised format, for
retrieving and joining data, for summarising files and
directories, and for coercing series from and to other
data types (such as 'zoo' series).
</p>


<h3>Details</h3>

<p>See the functions <code><a href="#topic+ts_table">ts_table</a></code> and
<code><a href="#topic+as.ts_table">as.ts_table</a></code> for creating a
<code><a href="#topic+ts_table">ts_table</a></code>.
</p>
<p>See <code><a href="#topic+write_ts_table">write_ts_table</a></code> and
<code><a href="#topic+read_ts_tables">read_ts_tables</a></code> for storing and loading a
<code><a href="#topic+ts_table">ts_table</a></code> (or several).
</p>
<p>For getting started, see the tutorial at
<a href="https://gitlab.com/enricoschumann/tsdb/blob/master/README.org">https://gitlab.com/enricoschumann/tsdb/blob/master/README.org</a>
or
<a href="https://github.com/enricoschumann/tsdb/blob/master/README.org">https://github.com/enricoschumann/tsdb/blob/master/README.org</a> .
</p>


<h3>Author(s)</h3>

<p>Enrico Schumann
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ts_table">ts_table</a></code> and <code><a href="#topic+as.ts_table">as.ts_table</a></code> for
creating a <code><a href="#topic+ts_table">ts_table</a></code>
</p>
<p><code><a href="#topic+write_ts_table">write_ts_table</a></code> and <code><a href="#topic+read_ts_tables">read_ts_tables</a></code> for
storing and loading a <code><a href="#topic+ts_table">ts_table</a></code>
</p>

<hr>
<h2 id='as.ts_table'>
Coerce to ts_table
</h2><span id='topic+as.ts_table'></span><span id='topic+as.ts_table.zoo'></span>

<h3>Description</h3>

<p>Coerce objects to <code>ts_table</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as.ts_table(x, ...)

## S3 method for class 'zoo'
as.ts_table(x, columns, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="as.ts_table_+3A_x">x</code></td>
<td>

<p>object to be coerced to ts_table
</p>
</td></tr>
<tr><td><code id="as.ts_table_+3A_columns">columns</code></td>
<td>

<p>character
</p>
</td></tr>
<tr><td><code id="as.ts_table_+3A_...">...</code></td>
<td>

<p>arguments to be passed to other methods
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A generic function for coercing objects to class
<code><a href="#topic+ts_table">ts_table</a></code>.
</p>


<h3>Value</h3>

<p>a <code><a href="#topic+ts_table">ts_table</a></code>
</p>


<h3>Author(s)</h3>

<p>Enrico Schumann
</p>


<h3>See Also</h3>

<p><code><a href="#topic+read_ts_tables">read_ts_tables</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("zoo")
as.ts_table(zoo(1:5, Sys.Date()-5:1),  ## note that the "columns"
            columns = "value")         ## must be specified
</code></pre>

<hr>
<h2 id='file_info'>
Information about Data File
</h2><span id='topic+file_info'></span>

<h3>Description</h3>

<p>Provides information about data stored in file:
columns, number of observations, range of timestamps.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>file_info(dir, file)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="file_info_+3A_dir">dir</code></td>
<td>

<p>character
</p>
</td></tr>
<tr><td><code id="file_info_+3A_file">file</code></td>
<td>

<p>character
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Provide information, such as number of entries, of
specified files.
</p>
<p>It is recommended that code that uses the returned
information to alter or write tables, should explicitly
check whether a table exists (column <code>exists</code> in
the returned <code><a href="base.html#topic+data.frame">data.frame</a></code>). For instance,
a value of <code><a href="base.html#topic+NA">NA</a></code> for <code>min.timestamp</code>
would occur for a non-existing file, but also if the
file could not be read for some reason.
</p>


<h3>Value</h3>

<p>An object of type <code>file_info</code>, which is a
<code>data.frame</code> with information such as whether a
file exists, minimum and maximum timestamp, and more.
</p>


<h3>Author(s)</h3>

<p>Enrico Schumann
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ts_table">ts_table</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ts &lt;- ts_table(1:3, as.Date("2018-12-3") + 1:3, columns = "A")
d &lt;- tempdir()
write_ts_table(ts, file = "temp", dir = d)
file_info(d, "temp")
</code></pre>

<hr>
<h2 id='read_ts_tables'>
Read Time-Series Data from Files
</h2><span id='topic+read_ts_tables'></span>

<h3>Description</h3>

<p>Read time-series data from files and merge them.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_ts_tables(file, dir, t.type = "guess",
               start, end, columns,
               return.class = NULL,
               drop.weekends = FALSE,
               column.names = "%dir%/%file%::%column%",
               backend = "csv",
               read.fn = NULL,
               frequency = "1 sec",
               timestamp)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="read_ts_tables_+3A_file">file</code></td>
<td>

<p>character
</p>
</td></tr>
<tr><td><code id="read_ts_tables_+3A_dir">dir</code></td>
<td>

<p>character
</p>
</td></tr>
<tr><td><code id="read_ts_tables_+3A_t.type">t.type</code></td>
<td>

<p>character: <code>guess</code>, <code>Date</code> or <code>POSIXct</code>
</p>
</td></tr>
<tr><td><code id="read_ts_tables_+3A_start">start</code></td>
<td>

<p>a timestamp: either of classes <code><a href="base.html#topic+Date">Date</a></code>
or <code><a href="base.html#topic+POSIXct">POSIXct</a></code> (possibly including
timezone information), or a character
string. Strings are passed to
<code><a href="base.html#topic+as.Date">as.Date</a></code>/<code><a href="base.html#topic+as.POSIXct">as.POSIXct</a></code>.
Note in particular that a string of the form
<code>"YYYY-MM-DD HH:MM:SS"</code>, when passed to
<code><a href="base.html#topic+as.POSIXct">as.POSIXct</a></code>, will be interpreted as a
datetime in the current timezone.
</p>
<p>It is best to always specify <code>start</code>: if
<code>start</code> is missing, the function will use the
first timestamp of the first time-series it reads.
</p>
</td></tr>
<tr><td><code id="read_ts_tables_+3A_end">end</code></td>
<td>

<p>a timestamp: either of classes <code><a href="base.html#topic+Date">Date</a></code>
or <code><a href="base.html#topic+POSIXct">POSIXct</a></code> (possibly including
timezone information), or a character
string. Strings are passed to
<code><a href="base.html#topic+as.Date">as.Date</a></code>/<code><a href="base.html#topic+as.POSIXct">as.POSIXct</a></code>.
Note in particular that a string of the form
<code>"YYYY-MM-DD HH:MM:SS"</code>, when passed to
<code><a href="base.html#topic+as.POSIXct">as.POSIXct</a></code>, will be interpreted as a
datetime in the current timezone.
</p>
<p>It is best to always specify <code>end</code>: if
<code>end</code> is missing, the function will use the
current time (which may not be appropriate: for
instance, when forecasts are stored).
</p>
</td></tr>
<tr><td><code id="read_ts_tables_+3A_columns">columns</code></td>
<td>

<p>character.
</p>
</td></tr>
<tr><td><code id="read_ts_tables_+3A_return.class">return.class</code></td>
<td>

<p><code>NULL</code> (default) or character: if <code>NULL</code>, a
list is returned. Also supported are <code>zoo</code>,
<code><a href="base.html#topic+data.frame">data.frame</a></code> and <code><a href="#topic+ts_table">ts_table</a></code>.
</p>
</td></tr>
<tr><td><code id="read_ts_tables_+3A_drop.weekends">drop.weekends</code></td>
<td>

<p>logical
</p>
</td></tr>
<tr><td><code id="read_ts_tables_+3A_column.names">column.names</code></td>
<td>

<p>character: a format string for column names; may
contain <code>%dir%</code>, <code>%file%</code>, and
<code>%column%</code>.  It is only used when
<code>return.class</code> is <code>data.frame</code> or <code>zoo</code>.
</p>
</td></tr>
<tr><td><code id="read_ts_tables_+3A_backend">backend</code></td>
<td>

<p>character: currently, only &lsquo;<code>csv</code>&rsquo; is
fully supported
</p>
</td></tr>
<tr><td><code id="read_ts_tables_+3A_read.fn">read.fn</code></td>
<td>

<p><code>NULL</code> or character: use &lsquo;<code>fread</code>&rsquo;
to use <code><a href="data.table.html#topic+fread">fread</a></code>
from package <span class="pkg">data.table</span>
</p>
</td></tr>
<tr><td><code id="read_ts_tables_+3A_frequency">frequency</code></td>
<td>

<p>character; used compute a regular grid between
<code>start</code> and <code>end</code>. The argument is only
used when <code>t.type</code> is <code>POSIXct</code>
(or guessed to be <code>POSIXct</code>) and no
<code>timestamp</code> is specified.
If set to <code><a href="base.html#topic+NA">NA</a></code>, the function will first
read all files and compute <code>timestamp</code> as the
union of all files' timestamps.
</p>
</td></tr>
<tr><td><code id="read_ts_tables_+3A_timestamp">timestamp</code></td>
<td>

<p>a vector of timestamps: if specified, only data at
the times in <code>timestamp</code> are selected
</p>
</td></tr>
</table>


<h3>Details</h3>


<p>Read time-series data from <abbr><span class="acronym">CSV</span></abbr> files.
</p>


<h3>Value</h3>

<p>When <code>return.class</code> is <code>NULL</code>, a list:
</p>
<table>
<tr><td><code>data</code></td>
<td>
<p>a numeric matrix</p>
</td></tr>
<tr><td><code>timestamp</code></td>
<td>
<p>Date or POSIXct</p>
</td></tr>
<tr><td><code>columns</code></td>
<td>
<p>character</p>
</td></tr>
<tr><td><code>file.path</code></td>
<td>
<p>character</p>
</td></tr>
</table>
<p>Otherwise an object of class as specified by argument
<code>return.class</code>.
</p>


<h3>Author(s)</h3>

<p>Enrico Schumann
</p>


<h3>See Also</h3>

<p><code><a href="#topic+write_ts_table">write_ts_table</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>t1 &lt;- ts_table(1:3, as.Date("2018-12-3") + 1:3, columns = "A")
t2 &lt;- ts_table(4:5, as.Date("2018-12-3") + 1:2, columns = "A")

d &lt;- tempdir()  ## this is just an example.
                ## Actual (valuable) data should never
                ## be stored in a tempdir!

write_ts_table(t1, dir = d, file = "t1")
write_ts_table(t2, dir = d, file = "t2")

read_ts_tables(c("t1", "t2"),
               dir = d, columns = "A",
               return.class = "zoo",
               column.names = "%file%.%column%")
</code></pre>

<hr>
<h2 id='ts_table'>
Create ts_table
</h2><span id='topic+ts_table'></span>

<h3>Description</h3>

<p>Create a <code>ts_table</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ts_table(data, timestamp, columns)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ts_table_+3A_data">data</code></td>
<td>

<p>numeric
</p>
</td></tr>
<tr><td><code id="ts_table_+3A_timestamp">timestamp</code></td>
<td>

<p><code><a href="base.html#topic+Date">Date</a></code> or <code><a href="base.html#topic+POSIXct">POSIXct</a></code>
</p>
</td></tr>
<tr><td><code id="ts_table_+3A_columns">columns</code></td>
<td>

<p>column names
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Create a time-series table (<code>ts_table</code>). A
<code>ts_table</code> is a numeric matrix, so there is
always a <code>dim</code> attribute. For a <code>ts_table</code>
<code>x</code>, you get the number of observations with
<code>dim(x)[1L]</code>.
</p>
<p>Attached to this matrix are several attributes:
</p>

<dl>
<dt>timestamp</dt><dd><p>a vector: the numeric representation of
the timestamp</p>
</dd>
<dt>t.type</dt><dd><p>character: the class of the original
timestamp, either <code>Date</code> or <code>POSIXct</code></p>
</dd>
<dt>columns</dt><dd><p>a character vector that provides the
columns names</p>
</dd>
</dl>

<p>There may be other attributes as well, but these three
are always present.
</p>
<p>Timestamps must be of class <code><a href="base.html#topic+Date">Date</a></code> or
<code><a href="base.html#topic+POSIXct">POSIXct</a></code> (<code><a href="base.html#topic+POSIXlt">POSIXlt</a></code> is
converted). A <code>tzone</code> attribute is dropped.
</p>
<p>A <code>ts_table</code> is not meant as a time-series
class. For most computations (plotting, calculation
of statistics, etc.), the <code>ts_table</code> must first
be coerced to <code>zoo</code>, <code>xts</code>, a
<code><a href="base.html#topic+data.frame">data.frame</a></code> or a similar data
structure. Methods that perform such coercions are
responsible for converting the numeric timestamp
vector to an actual timestamp. For this, they may use
the function <code><a href="#topic+ttime">ttime</a></code> (&lsquo;translate time&rsquo;).
</p>


<h3>Value</h3>

<p>a <code>ts_table</code>
</p>


<h3>Author(s)</h3>

<p>Enrico Schumann
</p>


<h3>See Also</h3>

<p><code><a href="#topic+as.ts_table">as.ts_table</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ts_table(1:5, Sys.Date() - 5:1, columns = "value")
</code></pre>

<hr>
<h2 id='ttime'>
Translate Timestamps
</h2><span id='topic+ttime'></span>

<h3>Description</h3>

<p>Translate a vector of timestamps.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ttime(x, from = "datetime", to = "numeric", tz = "",
      strip.attr = TRUE, format = "%Y-%m-%d")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ttime_+3A_x">x</code></td>
<td>

<p>numeric
</p>
</td></tr>
<tr><td><code id="ttime_+3A_from">from</code></td>
<td>

<p>character: <code>datetime</code>, <code>numeric</code> or <code>character</code>
</p>
</td></tr>
<tr><td><code id="ttime_+3A_to">to</code></td>
<td>

<p>character: <code>numeric</code>, <code>Date</code> or <code>POSIXct</code>
</p>
</td></tr>
<tr><td><code id="ttime_+3A_tz">tz</code></td>
<td>

<p>character
</p>
</td></tr>
<tr><td><code id="ttime_+3A_strip.attr">strip.attr</code></td>
<td>

<p>logical: strip attributes; in particular, timezone information
</p>
</td></tr>
<tr><td><code id="ttime_+3A_format">format</code></td>
<td>

<p>character
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>ttime</code> (&lsquo;translate time&rsquo;) converts timestamps
between formats.
</p>


<h3>Author(s)</h3>

<p>Enrico Schumann
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ts_table">ts_table</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ttime(Sys.Date())
ttime(17397, from = "numeric", to = "Date")
</code></pre>

<hr>
<h2 id='write_ts_table'>
Write Time-Series Data to File
</h2><span id='topic+write_ts_table'></span>

<h3>Description</h3>

<p>Write time-series data to files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_ts_table(ts, dir, file, add = FALSE, overwrite = FALSE,
               replace.file = FALSE, backend = "csv")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="write_ts_table_+3A_ts">ts</code></td>
<td>

<p>a <code>ts_table</code>
</p>
</td></tr>
<tr><td><code id="write_ts_table_+3A_dir">dir</code></td>
<td>

<p>character
</p>
</td></tr>
<tr><td><code id="write_ts_table_+3A_file">file</code></td>
<td>

<p>character
</p>
</td></tr>
<tr><td><code id="write_ts_table_+3A_add">add</code></td>
<td>

<p>logical: if <code>TRUE</code>, add data with timestamps
that are not in a file.
</p>
</td></tr>
<tr><td><code id="write_ts_table_+3A_overwrite">overwrite</code></td>
<td>

<p>logical: overwrite existing file when data
differs. <code>overwrite</code> implies <code>add</code>.
</p>
</td></tr>
<tr><td><code id="write_ts_table_+3A_replace.file">replace.file</code></td>
<td>

<p>logical: if <code>TRUE</code>, an existing file is deleted
and replaced by a new file (i.e. containing <code>ts</code>)
</p>
</td></tr>
<tr><td><code id="write_ts_table_+3A_backend">backend</code></td>
<td>
<p>a string; currently, only <code>csv</code>
is supported</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function takes a <code>ts_table</code> and writes it to
a file.
</p>
<p>If the file already exists and both <code>add</code> and
<code>overwrite</code> are <code>FALSE</code> (the default),
nothing is written.
</p>
<p>When <code>add</code> is <code>TRUE</code>, the function checks
if <code>ts</code> contains timestamps not yet in the file
and, if there are any, writes only those data.
</p>
<p>When <code>overwrite</code> is <code>TRUE</code>, the function
merges all observations in the file with those in
<code>ts</code> and writes the result back to the file. If
<code>ts</code> contains timestamps that were already in the
file, the data in the file are overwritten. Note that
no data will be removed from the file: timestamps not
in <code>ts</code> remain unchanged in the file.
</p>


<h3>Value</h3>

<p>Invisibly, the number of data rows written to a file.
</p>


<h3>Author(s)</h3>

<p>Enrico Schumann
</p>


<h3>See Also</h3>

<p><code><a href="#topic+read_ts_tables">read_ts_tables</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>t1 &lt;- ts_table(1:3, as.Date("2018-12-3") + 1:3, columns = "A")
t2 &lt;- ts_table(4:5, as.Date("2018-12-3") + 1:2, columns = "A")

d &lt;- tempdir()  ## this is just an example.
                ## Actual (valuable) data should never
                ## be stored in a tempdir!

write_ts_table(t1, dir = d, file = "t1")
write_ts_table(t2, dir = d, file = "t2")

read_ts_tables(c("t1", "t2"),
               dir = d, columns = "A",
               return.class = "zoo",
               column.names = "%file%.%column%")
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
