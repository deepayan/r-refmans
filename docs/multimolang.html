<!DOCTYPE html><html lang="en-US"><head><title>Help for package multimolang</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {multimolang}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#dfMaker'><p>dfMaker Function</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>'multimolang': Multimodal Language Analysis</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Process 'OpenPose' human body keypoints for computer vision, including data structuring and user-defined linear transformations for standardization. It optionally, includes metadata extraction from filenames in the UCLA 'NewsScape' archive.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>arrow</td>
</tr>
<tr>
<td>Suggests:</td>
<td>roxygen2 (&ge; 7.0.0), testthat (&ge; 3.0.0), knitr, rmarkdown,
spelling</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/daedalusLAB/multimolang">https://github.com/daedalusLAB/multimolang</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/daedalusLAB/multimolang/issues">https://github.com/daedalusLAB/multimolang/issues</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Copyright:</td>
<td>Copyright (C) 2024 Universidad de Murcia</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-12-05 23:57:13 UTC; bherreno</td>
</tr>
<tr>
<td>Author:</td>
<td>Brian Herreño Jiménez
    <a href="https://orcid.org/0000-0002-0800-938X"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Brian Herreño Jiménez &lt;brian.herreno@um.es&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-12-09 10:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='dfMaker'>dfMaker Function</h2><span id='topic+dfMaker'></span>

<h3>Description</h3>

<p><code>dfMaker()</code> processes and organizes keypoints data generated by 'OpenPose' (Cao et al., 2019), compiling multiple JSON files into a structured data frame. It applies linear transformations to align and scale the keypoints within a custom coordinate system defined by the user. The function supports datasets containing pose keypoints alone or combined with face and hand keypoints.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dfMaker(
  input.folder,
  config.path,
  output.file = NULL,
  output.path = NULL,
  no_save = FALSE,
  fast_scaling = TRUE,
  transformation_coords = c(1, 1, 5, 5)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dfMaker_+3A_input.folder">input.folder</code></td>
<td>
<p>Path to the folder containing 'OpenPose' JSON files. The folder should contain only the JSON files to be processed; including other files may lead to unexpected behavior.</p>
</td></tr>
<tr><td><code id="dfMaker_+3A_config.path">config.path</code></td>
<td>
<p>Path to the configuration file used for extracting metadata from filenames, particularly when processing data from the UCLA NewsScape archive. If not provided, default settings are used, which may not extract NewsScape-specific metadata.</p>
</td></tr>
<tr><td><code id="dfMaker_+3A_output.file">output.file</code></td>
<td>
<p>Name of the output file. If <code>NULL</code> and there is only one unique <code>id</code> in the data, an auto-generated name with a <code>.parquet</code> extension is used. If multiple unique <code>id</code> values are present and <code>output.file</code> is <code>NULL</code>, the function will return an error prompting you to provide an explicit output file name. If the specified <code>output.file</code> ends with <code>.csv</code>, the output will be saved in CSV format; otherwise, the default format is <code>.parquet</code>.</p>
</td></tr>
<tr><td><code id="dfMaker_+3A_output.path">output.path</code></td>
<td>
<p>Path to save the output file. If <code>NULL</code>, the file is saved in a default directory called <code>df_outputs</code> in the current working directory.</p>
</td></tr>
<tr><td><code id="dfMaker_+3A_no_save">no_save</code></td>
<td>
<p>Logical. If <code>TRUE</code>, the output is not saved to a file.</p>
</td></tr>
<tr><td><code id="dfMaker_+3A_fast_scaling">fast_scaling</code></td>
<td>
<p>Logical. If <code>TRUE</code>, uses a simplified scaling transformation that utilizes only the primary base vector <code>v.i</code>, ignoring the secondary base vector <code>v.j</code>. <strong>Warning:</strong> When <code>fast_scaling</code> is <code>TRUE</code>, scaling is performed only using pose keypoints (<code>t_typepoint = 1</code>), and the secondary vector <code>v.j</code> is not utilized.</p>
</td></tr>
<tr><td><code id="dfMaker_+3A_transformation_coords">transformation_coords</code></td>
<td>
<p>Numeric vector of length 4 specifying the transformation parameters:
</p>

<dl>
<dt><strong>t_typepoint</strong></dt><dd><p>Type of keypoints to use for transformation. Possible values:
</p>

<ul>
<li> <p><code>1</code>: Body keypoints (pose).
</p>
</li>
<li> <p><code>2</code>: Face keypoints.
</p>
</li>
<li> <p><code>3</code>: Left hand keypoints.
</p>
</li>
<li> <p><code>4</code>: Right hand keypoints.
</p>
</li></ul>
</dd>
<dt><strong>o_point</strong></dt><dd><p>Index of the keypoint used as the origin in the new coordinate system.</p>
</dd>
<dt><strong>i_point</strong></dt><dd><p>Index of the keypoint that defines the primary base vector <code>v.i</code>.</p>
</dd>
<dt><strong>j_point</strong></dt><dd><p>Index of the keypoint that defines the secondary base vector <code>v.j</code>.
</p>

<ul>
<li><p> If <code>i_point == j_point</code>, <code>v.j</code> is calculated as a perpendicular vector to <code>v.i</code> (orthonormalization).
</p>
</li>
<li><p> If <code>fast_scaling = TRUE</code>, <code>v.j</code> is not utilized and should be set to <code>NA</code>.
</p>
</li></ul>
</dd>
</dl>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>dfMaker()</code> function processes keypoints data generated by 'OpenPose', applying linear transformations to align and scale the keypoints within a custom coordinate system defined by the user. The transformation is specified by the <code>transformation_coords</code> parameter, which allows you to select specific keypoints to define the origin and the base vectors for the new coordinate system.
</p>
<p>When <code>fast_scaling = FALSE</code>, the function uses two base vectors (<code>v.i</code> and <code>v.j</code>) defined by the keypoints specified in <code>i_point</code> and <code>j_point</code> to perform an affine transformation. If <code>i_point == j_point</code>, <code>v.j</code> is calculated as a perpendicular vector to <code>v.i</code>, resulting in an orthonormal basis.
</p>
<p>When <code>fast_scaling = TRUE</code>, the transformation uses only the primary base vector <code>v.i</code>, and the scaling is simplified. The secondary vector <code>v.j</code> is not utilized, and <code>j_point</code> should be set to <code>NA</code>.
</p>
<p>This function depends on the <code>arrow</code> package for efficient reading and writing of JSON and Parquet files. Ensure that the <code>arrow</code> package is installed.
</p>
<p>The function expects JSON files generated by 'OpenPose' (tested with version 1.7.0) with a specific structure. Variations in the 'OpenPose' configuration or version may affect the format of these files. Ensure that the JSON files conform to the expected structure for accurate processing.
</p>
<p>Each row in the output data frame represents a single keypoint detected in a specific frame and associated with a specific person. The columns <code>nx</code> and <code>ny</code> provide the transformed coordinates based on the selected origin and linear transformation parameters. The <code>id</code> column links the keypoints to the corresponding input file from which they were extracted.
</p>
<p>The data frame may contain missing values (<code>NA</code>) for keypoints that could not be reliably detected.
</p>


<h3>Value</h3>

<p>A data frame containing the processed keypoints data with the following columns:
</p>

<dl>
<dt><strong>id</strong></dt><dd><p><code>Character</code>: Identifier derived from the name of the file processed.</p>
</dd>
<dt><strong>frame</strong></dt><dd><p><code>Numeric</code>: Frame number from which the data is extracted.</p>
</dd>
<dt><strong>people_id</strong></dt><dd><p><code>Integer</code>: Identifier for each detected person in the frame.</p>
</dd>
<dt><strong>type_points</strong></dt><dd><p><code>Character</code>: Type of keypoints (e.g., <code>"pose_keypoints"</code>, <code>"face_keypoints"</code>, <code>"hand_left_keypoints"</code>, <code>"hand_right_keypoints"</code>).</p>
</dd>
<dt><strong>points</strong></dt><dd><p><code>Integer</code>: Index of the keypoints sequence.</p>
</dd>
<dt><strong>x</strong></dt><dd><p><code>Numeric</code>: X-coordinate of the keypoint.</p>
</dd>
<dt><strong>y</strong></dt><dd><p><code>Numeric</code>: Y-coordinate of the keypoint.</p>
</dd>
<dt><strong>c</strong></dt><dd><p><code>Numeric</code>: Confidence score for the detected keypoint, ranging from 0 to 1.</p>
</dd>
<dt><strong>nx</strong></dt><dd><p><code>Numeric</code>: Transformed X-coordinate in the new coordinate system.</p>
</dd>
<dt><strong>ny</strong></dt><dd><p><code>Numeric</code>: Transformed Y-coordinate in the new coordinate system.</p>
</dd>
</dl>

<p>Additional metadata columns may be included if extracted based on the configuration, such as <code>datetime</code>, <code>exp_search</code>, <code>country_code</code>, <code>network_code</code>, <code>program_name</code>, and <code>time_range</code>.
</p>


<h3>R Version Requirements</h3>

<p>This function uses the native pipe operator <code style="white-space: pre;">&#8288;|&gt;&#8288;</code> introduced in R version 4.1.0. Therefore, R version 4.1.0 or higher is required.
</p>


<h3>Error Handling</h3>

<p>If the JSON files do not have the expected format or are empty, the function will skip these files and print a message indicating the issue. If <code>output.file</code> is <code>NULL</code> and multiple unique <code>id</code> values are found, the function will stop and return an error, prompting you to provide an explicit <code>output.file</code> name.
</p>


<h3>Note</h3>

<p>When processing data from the UCLA NewsScape archive, the <code>config.path</code> parameter allows you to specify a configuration file that defines how to extract metadata from the filenames of the videos. The filenames in this archive have specific structures containing metadata such as date, time, country code, network code, program name, and time range.
</p>
<p><strong>Example of Configuration File (<code>config.json</code>):</strong>
</p>
<pre>
{
    "extract_datetime": true,
    "extract_time": true,
    "extract_exp_search": true,
    "extract_country_code": true,
    "extract_network_code": true,
    "extract_program_name": true,
    "extract_time_range": true,
    "timezone": "America/Los_Angeles"
}
</pre>
<p>Ensure that your data filenames follow the standard NewsScape naming convention for accurate metadata extraction. If your data does not conform to this naming convention, you may need to adjust your filenames or modify the configuration accordingly.
</p>
<p>The <code>dfMaker()</code> function processes all keypoints provided by 'OpenPose', including pose, face, and hand keypoints. For the specific indices and descriptions of these keypoints, please refer to the 'OpenPose' documentation.
</p>


<h3>References</h3>

<p>For more information about the UCLA NewsScape archive, visit:
<a href="https://bigdatasocialscience.ucla.edu/newsscape/">https://bigdatasocialscience.ucla.edu/newsscape/</a>
</p>
<p>For a detailed description of the NewsScape infrastructure and its applications, refer to:
Uhrig, P. (2018). &quot;NewsScape and the Distributed Little Red Hen Lab: A Digital Infrastructure for the Large-Scale Analysis of TV Broadcasts.&quot; In <em>Anglistentag 2017 in Regensburg: Proceedings</em>, pp. 99–114.
</p>
<p>The <code>arrow</code> R package is used for efficient reading and writing of JSON and Parquet files. For more information, visit:
<a href="https://cran.r-project.org/package=arrow">https://cran.r-project.org/package=arrow</a>
</p>
<p>'OpenPose' GitHub Repository:
<a href="https://github.com/CMU-Perceptual-Computing-Lab/openpose">https://github.com/CMU-Perceptual-Computing-Lab/openpose</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example 1: Define paths to example data included with the package
input.folder &lt;- system.file("extdata/eg/o1", package = "multimolang")
output.file &lt;- file.path(tempdir(), "processed_data.csv")
output.path &lt;- tempdir()  # Use a temporary directory for writing output

# Run dfMaker() with example data
df &lt;- dfMaker(
  input.folder = input.folder,
  output.file = output.file,
  output.path = output.path,
  no_save = FALSE,
  fast_scaling = TRUE,
  transformation_coords = c(1, 1, 5, 5)
)

# View the first few rows of the resulting data frame
head(df)

# Example 2: Using NewsScape data with a custom configuration file
# Define the configuration file path
config.path &lt;- system.file("extdata/config_all_true.json", package = "multimolang")

# Run dfMaker with custom configuration
df &lt;- dfMaker(
  input.folder = input.folder,
  config.path = config.path,
  output.file = output.file,
  output.path = output.path,
  no_save = FALSE,
  fast_scaling = TRUE,
  transformation_coords = c(1, 1, 5, 5)
)

# View the first few rows
head(df)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
