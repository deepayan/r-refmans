<!DOCTYPE html><html><head><title>Help for package hisse</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {hisse}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#AddFossilPoints'><p>Adds sampled fossils to a complete phylogeny</p></a></li>
<li><a href='#AddStratIntervals'><p>Adds sampled stratigraphic intervals to a complete phylogeny</p></a></li>
<li><a href='#Compute Model Weights'><p>Compute model weights</p></a></li>
<li><a href='#generateMiSSEGreedyCombinations'><p>Combinations for Character-free State Speciation and Extinction Searching Greedily</p></a></li>
<li><a href='#GeoHiSSE'><p>Hidden Geographic State Speciation and Extinction</p></a></li>
<li><a href='#GeoHiSSE.old'><p>Original Hidden Geographic State Speciation and Extinction</p></a></li>
<li><a href='#GetFossils'><p>Get fossilized birth-death samples</p></a></li>
<li><a href='#hisse'><p>Hidden State Speciation and Extinction</p></a></li>
<li><a href='#hisse.null4.old'><p>Original Four state trait-independent Hidden State Speciation and Extinction</p></a></li>
<li><a href='#hisse.old'><p>Original Hidden State Speciation and Extinction</p></a></li>
<li><a href='#makeGeoHiSSELikelihood'><p>Export likelihood function for the GeoHiSSE model</p></a></li>
<li><a href='#makeHiSSELikelihood'><p>Export likelihood function for the HiSSE model</p></a></li>
<li><a href='#MarginRecon.old'><p>Original Ancestral State Estimation based on Marginal Reconstruction</p></a></li>
<li><a href='#MarginReconGeoSSE'><p>Ancestral State Estimation based on Marginal Reconstruction for</p>
the GeoSSE and GeoHiSSE models.</a></li>
<li><a href='#MarginReconGeoSSE.old'><p>Original Ancestral State Estimation based on Marginal Reconstruction for</p>
the GeoSSE and GeoHiSSE models.</a></li>
<li><a href='#MarginReconHiSSE'><p>Ancestral State Estimation based on Marginal Reconstruction for</p>
the HiSSE model.</a></li>
<li><a href='#MarginReconMiSSE'><p>Ancestral State Estimation based on Marginal Reconstruction for</p>
the MiSSE models.</a></li>
<li><a href='#MarginReconMuHiSSE'><p>Ancestral State Estimation based on Marginal Reconstruction for</p>
the MuSSE and MuHiSSE models.</a></li>
<li><a href='#MiSSE'><p>Character-free State Speciation and Extinction</p></a></li>
<li><a href='#MiSSEGreedy'><p>Character-free State Speciation and Extinction Searching Greedily</p></a></li>
<li><a href='#MiSSENet'><p>A function for catching bad model fits from MiSSEGreedy</p></a></li>
<li><a href='#Model averaged rates'><p>Model average rates at tips and nodes</p></a></li>
<li><a href='#MuHiSSE'><p>Multicharacter Hidden State Speciation and Extinction</p></a></li>
<li><a href='#plot.geohisse.states'><p>Plotting function geohisse.states objects</p></a></li>
<li><a href='#plot.hisse.states'><p>Plotting function hisse.states objects</p></a></li>
<li><a href='#plot.misse.states'><p>Plotting function misse.states objects</p></a></li>
<li><a href='#plot.muhisse.states'><p>Plotting function muhisse.states objects</p></a></li>
<li><a href='#PlotMisseSpace'><p>Plotting function for MiSSEGreedy</p></a></li>
<li><a href='#ProcessSimSample'><p>Process fossilized birth-death sample of lineages</p></a></li>
<li><a href='#ProcessSimStrat'><p>Process fossilized birth-death sample of lineages into stratigraphic intervals.</p></a></li>
<li><a href='#PruneRedundantModels'><p>Prune Redundant Models</p></a></li>
<li><a href='#SimToPhylo'><p>Convert simulated result to a tree</p></a></li>
<li><a href='#SimulateGeoHiSSE'><p>Simulate under a GeoHiSSE model</p></a></li>
<li><a href='#SimulateHisse'><p>Simulate under a HiSSE model</p></a></li>
<li><a href='#SummarizeMiSSEGreedy'><p>Summarize Results of the Greedy Algorithm</p></a></li>
<li><a href='#SupportRegion.old'><p>Adaptive Sampling of the Likelihood Surface</p></a></li>
<li><a href='#SupportRegionGeoSSE'><p>Adaptive Sampling of the Likelihood Surface under the new version of GeoHiSSE model</p></a></li>
<li><a href='#SupportRegionGeoSSE.old'><p>Adaptive Sampling of the Likelihood Surface under the original GeoHiSSE model</p></a></li>
<li><a href='#SupportRegionHiSSE'><p>Adaptive Sampling of the Likelihood Surface under the new version of HiSSE</p></a></li>
<li><a href='#SupportRegionMiSSE'><p>Adaptive Sampling of the Likelihood Surface under MiSSE</p></a></li>
<li><a href='#SupportRegionMuHiSSE'><p>Adaptive Sampling of the Likelihood Surface under MuHiSSE</p></a></li>
<li><a href='#TipCorrelation'><p>Phylogenetic independent contrasts using tip rates</p></a></li>
<li><a href='#TranslateParsMakerGeoHiSSE'><p>Key to translate GeoHiSSE into ClaSSE</p></a></li>
<li><a href='#TransMatMaker.old'><p>Transition Rate matrix generator</p></a></li>
<li><a href='#TransMatMakerGeoHiSSE'><p>Transition Rate matrix generator for the GeoHiSSE model</p></a></li>
<li><a href='#TransMatMakerHiSSE'><p>Transition Rate matrix generator for the HiSSE model</p></a></li>
<li><a href='#TransMatMakerMuHiSSE'><p>Transition Rate matrix generator for the MuHiSSE model</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>2.1.11</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-1-31</td>
</tr>
<tr>
<td>Title:</td>
<td>Hidden State Speciation and Extinction</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jeremy Beaulieu &lt;jmbeauli@uark.edu&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>ape, deSolve, GenSA, subplex, nloptr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, knitr, rmarkdown, markdown</td>
</tr>
<tr>
<td>Imports:</td>
<td>parallel, phytools, data.table, igraph, methods, diversitree,
paleotree, plotrix, geiger, phangorn, TreeSim, corHMM</td>
</tr>
<tr>
<td>Description:</td>
<td>Sets up and executes a HiSSE model (Hidden State Speciation and Extinction) on a phylogeny and character sets to test for hidden shifts in trait dependent rates of diversification. Beaulieu and O'Meara (2016) &lt;<a href="https://doi.org/10.1093%2Fsysbio%2Fsyw022">doi:10.1093/sysbio/syw022</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-02-06 20:57:47 UTC; jeremybeaulieu</td>
</tr>
<tr>
<td>Author:</td>
<td>Jeremy Beaulieu [aut, cre],
  Brian O'Meara [aut],
  Daniel Caetano [aut],
  James Boyko [aut],
  Thais Vasconcelos [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-02-11 10:10:15 UTC</td>
</tr>
</table>
<hr>
<h2 id='AddFossilPoints'>Adds sampled fossils to a complete phylogeny</h2><span id='topic+AddFossilPoints'></span>

<h3>Description</h3>

<p>Takes a sampled set of m and k fossils from <code>GetFossils</code> and them as points to a plot of the phylogeny from which they were sampled.</p>


<h3>Usage</h3>

<pre><code class='language-R'>AddFossilPoints(phy, f, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AddFossilPoints_+3A_phy">phy</code></td>
<td>
<p>a complete phylogeny that includes both extant and extinct lineages.</p>
</td></tr> 
<tr><td><code id="AddFossilPoints_+3A_f">f</code></td>
<td>
<p>the table of sampled lineages under the fossilized birth-death process obtained from <code>GetFossils</code>.</p>
</td></tr>
<tr><td><code id="AddFossilPoints_+3A_...">...</code></td>
<td>
<p>Additional parameters to control the points. See <code>points</code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Vascancelos, T, B.C. O'Meara, and J.M. Beaulieu. In prep.
</p>

<hr>
<h2 id='AddStratIntervals'>Adds sampled stratigraphic intervals to a complete phylogeny</h2><span id='topic+AddStratIntervals'></span>

<h3>Description</h3>

<p>Takes a sampled set of stratigraphic intervals from <code>GeteStratigraphicIntervals</code> and adds them as segments to a plot of the phylogeny from which they were sampled.</p>


<h3>Usage</h3>

<pre><code class='language-R'>AddStratIntervals(phy, f, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AddStratIntervals_+3A_phy">phy</code></td>
<td>
<p>a complete phylogeny that includes both extant and extinct lineages.</p>
</td></tr> 
<tr><td><code id="AddStratIntervals_+3A_f">f</code></td>
<td>
<p>the table of sampled lineages under the fossilized birth-death process obtained from <code>GetFossils</code>.</p>
</td></tr>
<tr><td><code id="AddStratIntervals_+3A_...">...</code></td>
<td>
<p>Additional parameters to control the points. See <code>segments</code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Vascancelos, T, B.C. O'Meara, and J.M. Beaulieu. In prep.
</p>

<hr>
<h2 id='Compute+20Model+20Weights'>Compute model weights</h2><span id='topic+GetAICWeights'></span>

<h3>Description</h3>

<p>Computes the Akaike model weights for a list of HiSSE, MiSSE,
and/or GeoHiSSE model fits.</p>


<h3>Usage</h3>

<pre><code class='language-R'>GetAICWeights(hisse.results, criterion="AIC")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Compute+2B20Model+2B20Weights_+3A_hisse.results">hisse.results</code></td>
<td>
<p>A list of models (such as from MiSSEGreedy or just putting individual hisse runs in a list)</p>
</td></tr>
<tr><td><code id="Compute+2B20Model+2B20Weights_+3A_criterion">criterion</code></td>
<td>
<p>Which criterion to use, AIC or AICc (with correction for sample size)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function computes the model weight from their AIC values using the
formula:
</p>
<p>&ldquo;delta &lt;- mod.AIC - min( mod.AIC )&rdquo;
</p>
<p>&ldquo;AICw &lt;- exp( -0.5 * delta) / sum( exp( -0.5 * delta) )&rdquo;
</p>
<p>Function will return vector of weights
</p>


<h3>Author(s)</h3>

<p>Daniel Caetano</p>

<hr>
<h2 id='generateMiSSEGreedyCombinations'>Combinations for Character-free State Speciation and Extinction Searching Greedily</h2><span id='topic+generateMiSSEGreedyCombinations'></span>

<h3>Description</h3>

<p>Sets up a set of MiSSE models (Missing State Speciation
and Extinction) on a phylogeny, varying the number of parameters for turnover and extinction fraction.</p>


<h3>Usage</h3>

<pre><code class='language-R'>generateMiSSEGreedyCombinations(max.param=52, turnover.tries=sequence(26), 
eps.tries=sequence(26), fixed.eps.tries=NA, vary.both=TRUE, shuffle.start=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="generateMiSSEGreedyCombinations_+3A_max.param">max.param</code></td>
<td>
<p>how many parameters to try estimating at the most.</p>
</td></tr>
<tr><td><code id="generateMiSSEGreedyCombinations_+3A_turnover.tries">turnover.tries</code></td>
<td>
<p>vector of number of free turnover parameters.</p>
</td></tr>
<tr><td><code id="generateMiSSEGreedyCombinations_+3A_eps.tries">eps.tries</code></td>
<td>
<p>vector of number of free eps parameters.</p>
</td></tr>
<tr><td><code id="generateMiSSEGreedyCombinations_+3A_fixed.eps.tries">fixed.eps.tries</code></td>
<td>
<p>fixed eps values to use. By default this is set to NA to allow estimating. However, a vector of values can supplied as fixed value for eps (and an NA to allow estimating, as well).</p>
</td></tr>
<tr><td><code id="generateMiSSEGreedyCombinations_+3A_vary.both">vary.both</code></td>
<td>
<p>if TRUE, allows models that have multiple parameters for turnover and eps; if FALSE, if turnover has multiple hidden states eps can only have one estimated value and vice versa.</p>
</td></tr>
<tr><td><code id="generateMiSSEGreedyCombinations_+3A_shuffle.start">shuffle.start</code></td>
<td>
<p>if TRUE, instead of generating models strictly by increasing complexity shuffles them around so that simpler models tend to be earlier but with some more complex models mixed in</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This creates the set of combinations of models to run through MiSSEGreedy as a data.frame. It has columns for the number of rates to estimate for turnover, the number of values to estimate for eps, and any fixed values for eps to apply to the whole tree. You can add your own rows or delete some to this data.frame to add more or fewer combinations. By default, this comes out ordered so that simpler models are run first in <code>MiSSEGreedy</code> but that is not required (but wise for most use cases), and you can reorder if you wish.
</p>
<p>It can be worth considering how much information your tree has for diversification rates. A fully resolved tree with N taxa has 2N-2 branches and only N-1 internal node heights, which is more relevant for diversification models.  So on a 50 taxon tree, there are 49 node heights &ndash; it's a bit ambitious to think you can extract, say, 5 different parameters (3 turnover rates, 1 eps value, 1 transition rate) from such a tree. People clearly try to extract more &ndash; some methods claim to use information in a tree to extract a different speciation or net diversification rate for every single tip &ndash; but that could be a tad ambitious. So setting <code>max.param</code> to a low value makes a lot of sense. <code>max.param = floor(ape::Ntip(phy)/10)</code> is ridiculously optimistic (dividing by 100 or more is probably more conservative) but if things are running well <code>MiSSEGreedy</code> should stop before getting to the models that are too complex.
</p>
<p><code>turnover.tries</code> and <code>eps.tries</code> set how many turnover and eps hidden states to try, respectively. If you wanted to try only 1, 3, and 7 hidden states for turnover you would set <code>turnover.tries = c(1, 3, 7)</code> for example.
</p>
<p>Estimating extinction rates is hard. This affects all diversification models (even if all you want and look at is speciation rate, extinction rate estimates still affect what this is as they affect the likelihood). It is most noticeable in MiSSE with eps, the extinction fraction (extinction rate divided by speciation rate). One option, following Magallon &amp; Sanderson (2001), is to set extinction fraction at set values. By default, we use theirs, 0 (meaning a Yule model - no extinction) or 0.9 (a lot of extinction, though still less than paleontoligists find). You can set your own in <code>fixed.eps.tries</code>. If you only want to use fixed values, and not estimate, get rid of the NA, as well. However, don't &ldquo;cheat&rdquo; &ndash; if you use a range of values for fixed.eps, it's basically doing a search for this, though the default AICc calculation doesn't dQuoteknow this to penalize it for another parameter.
</p>
<p>HiSSE and thus MiSSE assume that a taxon has a particular hidden state (though they recognize that there can be uncertainty in which state it actually has). Thus, they're written to assume that we dQuotepaint these states on the tree and a given state affects both turnover and eps. So if turnover has four hidden states, eps has four hidden states. They can be constrained: the easiest way is to have, say, turnover having an independent rate for each hidden state and eps having the same rate for all the hidden states. If <code>vary.both</code> is set to FALSE, all models are of this sort: if turnover varies, eps is constant across all hidden states, or vice versa. Jeremy Beaulieu prefers this. If <code>vary.both</code> is set to TRUE, both can vary: for example, there could be five hidden states for both turnover and eps, but turnover lets each of these have a different rate, but eps only allows three values (so that eps_A and eps_D might be forced to be equal, and eps_B and eps_E might be forced to be equal). Brian O'Meara would consider allowing this, while cautioning you about the risks of too many parameters.
</p>


<h3>Value</h3>

<p><code>generateMiSSEGreedyCombinations</code> returns a data.frame to pass to MiSSEGreedy().
</p>


<h3>Author(s)</h3>

<p>Brian C. O'Meara</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models
of trait-dependent speciation and extinction. Syst. Biol. 65:583-601.
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation
and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Herrera-Alsina, L., P. van Els, and R.S. Etienne. 2018. Detecting the dependence of diversification on multiples traits from phylogenetic trees and trait data. Systematic Biology, 68:317-328.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters effect on
speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Magallon S. and Sanderson M.J. 2001. Absolute diversification rates in angiosperm clades. Evolution 55:1762-1780.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos.
Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='GeoHiSSE'>Hidden Geographic State Speciation and Extinction</h2><span id='topic+GeoHiSSE'></span>

<h3>Description</h3>

<p>Sets up and executes a GeoHiSSE model (Hidden Geographic State Speciation
and Extinction) on a very large phylogeny and character distribution.</p>


<h3>Usage</h3>

<pre><code class='language-R'>GeoHiSSE(phy, data, f=c(1,1,1), turnover=c(1,2,3), eps=c(1,2), 
hidden.states=FALSE, trans.rate=NULL, assume.cladogenetic=TRUE, 
condition.on.survival=TRUE, root.type="madfitz", root.p=NULL, sann=TRUE,
sann.its=1000, bounded.search=TRUE,  max.tol=.Machine$double.eps^.50,
mag.san.start=0.5, starting.vals=NULL, turnover.upper=1000, 
eps.upper=3, trans.upper=100, restart.obj=NULL, ode.eps=0, dt.threads=1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="GeoHiSSE_+3A_phy">phy</code></td>
<td>
<p>a phylogenetic tree, in <code>ape</code> &ldquo;phylo&rdquo; format and
with internal nodes labeled denoting the ancestral selective regimes.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_data">data</code></td>
<td>
<p>a matrix (or dataframe) with two columns containing species
information. First column has the species names and second column has
area codes. Values for the areas need to be 0, 1, or 2, where 0 is the 
widespread area '01', 1 is endemic area '00' and 2 is endemic area '11'. See 'Details'.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_f">f</code></td>
<td>
<p>vector of length 3 with the estimated proportion of extant
species in state 1 (area '00'), state 2 (area '1'), and state 0 (widespread area '01') 
that are included in the phylogeny. A value of c(0.25, 0.25, 0.5) means that 25 percent
of species in areas '00' and '11' and 50 percent of species in area '01' are
included in the phylogeny. By default all species are assumed to be
sampled.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_turnover">turnover</code></td>
<td>
<p>a numeric vector of length equal to 3+(number of
<code>hidden.states</code> * 3). A GeoSSE model has 3 turnover parameters:
tau00, tau11 and tau01. A GeoHiSSE model with one hidden area has 6 speciation
parameters: tau00A, tau11A, tau01A, tau00B, tau11B, and tau01B, and so on. The length of the numeric vector needs to match the number of speciation parameters in the model.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_eps">eps</code></td>
<td>
<p>a numeric vector of length equal to 2+(number of
<code>hidden.states</code> * 2). A GeoSSE model has 2 extinct fraction parameters:
ef00 and ef11. A GeoHiSSE model with one hidden area has 4 extinct.frac
parameters: ef00A, ef11A, ef00B, and ef11B, and so on. The length of the numeric
vector needs to match the number of extinct.frac parameters in the
model.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_hidden.states">hidden.states</code></td>
<td>
<p>a logical indicating whether the model includes hidden.states.
The default is <code>FALSE</code>.</p>
</td></tr> 
<tr><td><code id="GeoHiSSE_+3A_trans.rate">trans.rate</code></td>
<td>
<p>provides the transition rate model. See function
<code>TransMatMakerGeoHiSSE</code>.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_assume.cladogenetic">assume.cladogenetic</code></td>
<td>
<p>assumes that cladogenetic events occur at nodes. The 
default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_condition.on.survival">condition.on.survival</code></td>
<td>
<p>a logical indicating whether the likelihood
should be conditioned on the survival of two lineages and the
speciation event subtending them (Nee et al. 1994). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_root.type">root.type</code></td>
<td>
<p>indicates whether root summarization follow the procedure described by FitzJohn et al. 2009, &ldquo;madfitz&rdquo; or Herrera-Alsina et al. 2018, &ldquo;herr_als&rdquo;.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_root.p">root.p</code></td>
<td>
<p>a vector indicating fixed root state probabilities. The
default is <code>NULL</code>. Order of the areas in the vector need to follow:
root.p[1] = 1 (endemic area '0'); root.p[2] = 2 (endemic
area '1'); root.p[3] = 0 (widespread area '01').</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_sann">sann</code></td>
<td>
<p>a logical indicating whether a two-step optimization
procedure is to be used. The first includes a simulate annealing
approach, with the second involving a refinement using
<code>subplex</code>. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_sann.its">sann.its</code></td>
<td>
<p>a numeric indicating the number of times the simulated
annealing algorithm should call the objective function.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_bounded.search">bounded.search</code></td>
<td>
<p>a logical indicating whether or not bounds should
be enforced during optimization. The default is is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_max.tol">max.tol</code></td>
<td>
<p>supplies the relative optimization tolerance to
<code>subplex</code>.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_mag.san.start">mag.san.start</code></td>
<td>
<p>Sets the extinction fraction to estimate the starting values 
for the diversification parameters. The equation used is based on Magallon and 
Sanderson (2001), and follows the procedure used in the original GeoSSE 
implementation.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_starting.vals">starting.vals</code></td>
<td>
<p>a numeric vector of length 3 with starting values for the
model for all areas and hidden states. Position [1] sets turnover, [2]
sets extinction fraction, and [3] dispersal rates.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_turnover.upper">turnover.upper</code></td>
<td>
<p>sets the upper bound for the speciation parameters.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_eps.upper">eps.upper</code></td>
<td>
<p>sets the upper bound for the extirpation parameters.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_trans.upper">trans.upper</code></td>
<td>
<p>sets the upper bound for the transition rate parameters.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_restart.obj">restart.obj</code></td>
<td>
<p>an object that contains everything to restart an optimization.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_ode.eps">ode.eps</code></td>
<td>
<p>sets the tolerance for the integration at the end of a
branch. Essentially if the sum of compD is less than this tolerance,
then it assumes the results are unstable and discards them. The
default is set to zero, but in testing a value of 1e-8 can sometimes
produce stable solutions for both easy and very difficult optimization problems.</p>
</td></tr>
<tr><td><code id="GeoHiSSE_+3A_dt.threads">dt.threads</code></td>
<td>
<p>sets the number of threads available to data.table. In practice this need not change from the default of 1 thread, as we have not seen any speedup from allowing more threads.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function sets up and executes a more complex and faster version of the GeoHiSSE model (for the original function see <code>GeoHisse.old</code>). One of the main differences here is that the model allows up to 10 hidden categories, and implements a more efficient means of carrying out the branch calculation. Specifically, we break up the tree into carry out all descendent branch calculations simultaneously, combine the probabilities based on their shared ancestry, then repeat for the next set of descendent . In testing, we've found that as the number of taxa increases, the calculation becomes much more efficient. In future versions, we will likely allow for multicore processing of these calculations to further improve speed. Also, note this function has replaced the version of <code>GeoSSE</code> that is currently available (see <code>GeoHisse.old</code>).
</p>
<p>The other main difference is that, like <code>HiSSE</code>, we employ a modified optimization procedure. In other words, rather than optimizing birth and death separately, <code>GeoHisse</code> optimizes orthogonal transformations of these variables: we let tau = birth+death define &quot;net turnover&quot;, and we let eps = death/birth define the &ldquo;extinction fraction&rdquo;. This reparameterization alleviates problems associated with overfitting when birth and death are highly correlated, but both matter in explaining the diversity pattern. 
</p>
<p>To setup a model, users input vectors containing values to indicate how
many free parameters are to be estimated for each of the variables in
the model. This is done using the <code>turnover</code> and
<code>extinct.frac</code> parameters. One needs to specify a value for each of
the parameters of the model, when two parameters show the same value,
then the parameters are set to be linked during the estimation of the
model. For example, a GeoHiSSE model with 1 hidden area and all free
parameters has <code>turnover = 1:6</code>. The same model with
speciation rates constrained to be the same for all hidden states has
<code>turnover = c(1,2,3,1,2,3)</code>. This same format applies to
<code>extinct.frac</code>.
</p>
<p>Once the model is specified, the parameters can be estimated using the
subplex routine (default), or use a two-step process (i.e., sann=TRUE)
that first employs a stochastic simulated annealing procedure, which is
later refined using the subplex routine.
</p>
<p>The &ldquo;trans.rate&rdquo; input is the transition model and has an
entirely different setup than speciation and extirpation rates.
See <code>TransMatMakerGeoHiSSE</code> function for more details. 
</p>
<p>For user-specified &ldquo;root.p&rdquo;, you should specify the probability
for each area. If you are doing a hidden model, there will be six areas:
0A, 1A, 2A, 0B, 1B, 2B. So if you wanted to say the root had to be in
area 0 (widespread distribution), you would specify &ldquo;root.p =
c(0.5, 0, 0, 0.5, 0, 0)&rdquo;. In other words, the root has a 50% chance
to be in one of the areas 0A or 0B.
</p>
<p>For the &ldquo;root.type&rdquo; option, we are currently maintaining the previous default of 
&ldquo;madfitz&rdquo;. However, it was recently pointed out by Herrera-Alsina et al. (2018)
that at the root, the individual likelihoods for each possible state should be conditioned
prior to averaging the individual likelihoods across states. This can be set doing 
&ldquo;herr_als&rdquo;. It is unclear to us which is exactly correct, but it does seem that 
both &ldquo;madfitz&rdquo; and &ldquo;herr_als&rdquo; behave exactly as they should in the case of 
character-independent diversification (i.e., reduces to likelihood of tree + likelihood of
trait model). We've also tested the behavior and the likelihood differences are very 
subtle and the parameter estimates in simulation are nearly indistinguishable from the
&ldquo;madfitz&rdquo; conditioning scheme. We provide both options and encourage users to try 
both and let us know conditions in which the result vary dramatically under the two root
implementations. We suspect they do not. 
</p>
<p>Also, note, that in the case of &ldquo;root.type=user&rdquo; and &ldquo;root.type=equal&rdquo; are
no longer explicit &ldquo;root.type&rdquo; options. Instead, either &ldquo;madfitz&rdquo; or 
&ldquo;herr_als&rdquo; are specified and the &ldquo;root.p&rdquo; can be set to allow for custom
root options.  
</p>


<h3>Value</h3>

<p><code>GeoHiSSE</code> returns an object of class <code>geohisse.fit</code>. This is a list with 
elements:
</p>
<table>
<tr><td><code>$loglik</code></td>
<td>
<p>the maximum negative log-likelihood.</p>
</td></tr>
<tr><td><code>$AIC</code></td>
<td>
<p>Akaike information criterion.</p>
</td></tr>
<tr><td><code>$AICc</code></td>
<td>
<p>Akaike information criterion corrected for sample-size.</p>
</td></tr>
<tr><td><code>$solution</code></td>
<td>
<p>a matrix containing the maximum likelihood estimates of the model 
parameters.</p>
</td></tr>
<tr><td><code>$index.par</code></td>
<td>
<p>an index matrix of the parameters being estimated.</p>
</td></tr>
<tr><td><code>$f</code></td>
<td>
<p>user-supplied sampling frequencies.</p>
</td></tr>
<tr><td><code>$hidden.states</code></td>
<td>
<p>a logical indicating whether hidden states were included in the 
model.</p>
</td></tr>
<tr><td><code>$assume.cladogenetic</code></td>
<td>
<p>a logical indicating whether cladogenetic events were allowed
at nodes.</p>
</td></tr>
<tr><td><code>$condition.on.surivival</code></td>
<td>
<p>a logical indicating whether the
likelihood was conditioned on the survival of two lineages and the speciation event 
subtending them.</p>
</td></tr>
<tr><td><code>$root.type</code></td>
<td>
<p>indicates the user-specified root prior assumption.</p>
</td></tr>
<tr><td><code>$root.p</code></td>
<td>
<p>indicates whether the user-specified fixed root probabilities.</p>
</td></tr>
<tr><td><code>$phy</code></td>
<td>
<p>user-supplied tree</p>
</td></tr>
<tr><td><code>$data</code></td>
<td>
<p>user-supplied dataset</p>
</td></tr>
<tr><td><code>$trans.matrix</code></td>
<td>
<p>the user-supplied transition matrix</p>
</td></tr>
<tr><td><code>$max.tol</code></td>
<td>
<p>relative optimization tolerance.</p>
</td></tr>
<tr><td><code>$starting.vals</code></td>
<td>
<p>The starting values for the optimization.</p>
</td></tr>
<tr><td><code>$upper.bounds</code></td>
<td>
<p>the vector of upper limits to the optimization search.</p>
</td></tr>
<tr><td><code>$lower.bounds</code></td>
<td>
<p>the vector of lower limits to the optimization
search.</p>
</td></tr>
<tr><td><code>$ode.eps</code></td>
<td>
<p>The ode.eps value used for the estimation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Caetano, D.S., B.C. O'Meara, and J.M. Beaulieu. 2018. Hidden state models improve state-dependent diversification approaches, including biogeographic models. Evolution, 72:2308-2324.
</p>
<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., W.P. Maddison, and S.P. Otto. 2009. Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Maddison W.P., P.E. Midford, and S.P. Otto. 2007. Estimating a binary characters effect on speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., R.M. May, and P.H. Harvey. 1994. The reconstructed evolutionary process. Philos. Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='GeoHiSSE.old'>Original Hidden Geographic State Speciation and Extinction</h2><span id='topic+GeoHiSSE.old'></span>

<h3>Description</h3>

<p>Sets up and executes the original GeoHiSSE model
(Hidden Geographic State Speciation and Extinction) on a phylogeny and 
character distribution.</p>


<h3>Usage</h3>

<pre><code class='language-R'>GeoHiSSE.old(phy, data, f=c(1,1,1), speciation=c(1,2,3), extirpation=c(1,2), 
hidden.areas=FALSE, trans.rate=NULL, assume.cladogenetic=TRUE, 
condition.on.survival=TRUE, root.type="madfitz", root.p=NULL, sann=TRUE,
sann.its=1000, bounded.search=TRUE,  max.tol=.Machine$double.eps^.50,
mag.san.start=0.5, starting.vals=NULL, speciation.upper=1000, extirpation.upper=1000, 
trans.upper=100, ode.eps=0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="GeoHiSSE.old_+3A_phy">phy</code></td>
<td>
<p>a phylogenetic tree, in <code>ape</code> &ldquo;phylo&rdquo; format and
with internal nodes labeled denoting the ancestral selective regimes.</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_data">data</code></td>
<td>
<p>a matrix (or dataframe) with two columns containing species
information. First column has the species names and second column has
area codes. Values for the areas need to be 0, 1, or 2, where 0 is the 
widespread area '01', 1 is endemic area '0' and 2 is endemic area '1'. See 'Details'.</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_f">f</code></td>
<td>
<p>vector of length 3 with the estimated proportion of extant
species in state 1 (area '0'), state 2 (area '1'), and state 0 (widespread area '01') 
that are included in the phylogeny. A value of c(0.25, 0.25, 0.5) means that 25 percent
of species in areas '0' and '1' and 50 percent of species in area '01' are
included in the phylogeny. By default all species are assumed to be
sampled.</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_speciation">speciation</code></td>
<td>
<p>a numeric vector of length equal to 3+(number of
<code>hidden.areas</code> * 3). A GeoSSE model has 3 speciation parameters:
s0, s1 and s01. A GeoHiSSE model with one hidden area has 6 speciation
parameters: s0A, s1A, s01A, s0B, s1B, s01B. And so on. The length of the numeric
vector needs to match the number of speciation parameters in the
model. See 'Details'.</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_extirpation">extirpation</code></td>
<td>
<p>a numeric vector of length equal to 2+(number of
<code>hidden.areas</code> * 2). A GeoSSE model has 2 extirpation parameters:
x0 and x1. A GeoHiSSE model with one hidden area has 4 extirpation
parameters: x0A, x1A, x0B, and x1B. And so on. The length of the numeric
vector needs to match the number of extirpation parameters in the
model. See 'Details'.</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_hidden.areas">hidden.areas</code></td>
<td>
<p>a logical indicating whether the model includes a
hidden area. The default is <code>FALSE</code>.</p>
</td></tr> 
<tr><td><code id="GeoHiSSE.old_+3A_trans.rate">trans.rate</code></td>
<td>
<p>provides the transition rate model. See function
<code>TransMatMakerGeoHiSSE.old</code>.</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_assume.cladogenetic">assume.cladogenetic</code></td>
<td>
<p>assumes that cladogenetic events occur at nodes. The 
default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_condition.on.survival">condition.on.survival</code></td>
<td>
<p>a logical indicating whether the likelihood
should be conditioned on the survival of two lineages and the
speciation event subtending them (Nee et al. 1994). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_root.type">root.type</code></td>
<td>
<p>indicates whether root summarization follow the procedure described by FitzJohn et al. 2009, &ldquo;madfitz&rdquo; or Herrera-Alsina et al. 2018, &ldquo;herr_als&rdquo;.</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_root.p">root.p</code></td>
<td>
<p>a vector indicating fixed root state probabilities. The
default is <code>NULL</code>. Order of the areas in the vector need to follow:
root.p[1] = 1 (endemic area '0'); root.p[2] = 2 (endemic
area '1'); root.p[3] = 0 (widespread area '01').</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_sann">sann</code></td>
<td>
<p>a logical indicating whether a two-step optimization
procedure is to be used. The first includes a simulate annealing
approach, with the second involving a refinement using
<code>subplex</code>. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_sann.its">sann.its</code></td>
<td>
<p>a numeric indicating the number of times the simulated
annealing algorithm should call the objective function.</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_bounded.search">bounded.search</code></td>
<td>
<p>a logical indicating whether or not bounds should
be enforced during optimization. The default is is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_max.tol">max.tol</code></td>
<td>
<p>supplies the relative optimization tolerance to
<code>subplex</code>.</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_mag.san.start">mag.san.start</code></td>
<td>
<p>Sets the extinction fraction to estimate the starting values 
for the diversification parameters. The equation used is based on Magallon and 
Sanderson (2001), and follows the procedure used in the original GeoSSE 
implementation.</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_starting.vals">starting.vals</code></td>
<td>
<p>a numeric vector of length 3 with starting values for the
model for all areas and hidden states. Position [1] sets turnover, [2]
sets extinction fraction, and [3] dispersal rates.</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_speciation.upper">speciation.upper</code></td>
<td>
<p>sets the upper bound for the speciation parameters.</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_extirpation.upper">extirpation.upper</code></td>
<td>
<p>sets the upper bound for the extirpation parameters.</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_trans.upper">trans.upper</code></td>
<td>
<p>sets the upper bound for the transition rate parameters.</p>
</td></tr>
<tr><td><code id="GeoHiSSE.old_+3A_ode.eps">ode.eps</code></td>
<td>
<p>sets the tolerance for the integration at the end of a
branch. Essentially if the sum of compD is less than this tolerance,
then it assumes the results are unstable and discards them. The
default is set to zero, but in testing a value of 1e-8 can sometimes
produce stable solutions for both easy and very difficult optimization problems.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function sets up and executes the original GeoHiSSE model. The model closely
follows <code>diversitree</code>, although here we employ modified
optimization procedures. As for data file format, <code>GeoHiSSE</code>
expects a two column matrix or data frame, with the first column
containing the species names and the second containing the are
information. The area information need to be in the format of three
numbers: 0 for area '01', 1 for area '0', and 2 for '1'. Please note that 
the code for the areas here differ from the
<code>make.geosse</code> function of package <code>diversitree</code>.
The order of the data file and the names in the
&ldquo;phylo&rdquo; object need not be in the same order; <code>hisse</code> deals
with this internally. Also, the character information MUST be 0,
1, or 2, otherwise, the function will return an error message.
</p>
<p>To setup a model, users input vectors containing values to indicate how
many free parameters are to be estimated for each of the variables in
the model. This is done using the <code>speciation</code> and
<code>extirpation</code> parameters. One needs to specify a value for each of
the parameters of the model, when two parameters show the same value,
then the parameters are set to be linked during the estimation of the
model. For example, a GeoHiSSE model with 1 hidden area and all free
parameters has <code>speciation = 1:6</code>. The same model with
speciation rates constrained to be the same for all hidden areas has
<code>speciation = c(1,2,3,1,2,3)</code>. This same format applies to
<code>extirpation</code>. Please note that GeoHiSSE currently works with up to
4 hidden areas. The most complex model would be <code>speciation = 1:15</code>
and <code>extirpation = 1:10</code>.
</p>
<p>Once the model is specified, the parameters can be estimated using the
subplex routine (default), or use a two-step process (i.e., sann=TRUE)
that first employs a stochastic simulated annealing procedure, which is
later refined using the subplex routine.
</p>
<p>The &ldquo;trans.rate&rdquo; input is the transition model and has an
entirely different setup than speciation and extirpation rates.
See <code>TransMatMakerGeoHiSSE.old</code> function for more details. 
</p>
<p>For user-specified &ldquo;root.p&rdquo;, you should specify the probability
for each area. If you are doing a hidden model, there will be six areas:
0A, 1A, 01A, 0B, 1B, 01B. So if you wanted to say the root had to be in
area 0 (widespread distribution), you would specify &ldquo;root.p =
c(0.5, 0, 0, 0.5, 0, 0)&rdquo;. In other words, the root has a 50% chance
to be in one of the areas 0A or 0B.
</p>
<p>For the &ldquo;root.type&rdquo; option, we are currently maintaining the previous default of 
&ldquo;madfitz&rdquo;. However, it was recently pointed out by Herrera-Alsina et al. (2018)
that at the root, the individual likelihoods for each possible state should be conditioned
prior to averaging the individual likelihoods across states. This can be set doing 
&ldquo;herr_als&rdquo;. It is unclear to us which is exactly correct, but it does seem that 
both &ldquo;madfitz&rdquo; and &ldquo;herr_als&rdquo; behave exactly as they should in the case of 
character-independent diversification (i.e., reduces to likelihood of tree + likelihood of
trait model). We've also tested the behavior and the likelihood differences are very 
subtle and the parameter estimates in simulation are nearly indistinguishable from the
&ldquo;madfitz&rdquo; conditioning scheme. We provide both options and encourage users to try 
both and let us know conditions in which the result vary dramatically under the two root
implementations. We suspect they do not. 
</p>
<p>Also, note, that in the case of &ldquo;root.type=user&rdquo; and &ldquo;root.type=equal&rdquo; are
no longer explicit &ldquo;root.type&rdquo; options. Instead, either &ldquo;madfitz&rdquo; or 
&ldquo;herr_als&rdquo; are specified and the &ldquo;root.p&rdquo; can be set to allow for custom
root options.  
</p>


<h3>Value</h3>

<p><code>GeoHiSSE</code> returns an object of class <code>geohisse.fit</code>. This is a list with 
elements:
</p>
<table>
<tr><td><code>$loglik</code></td>
<td>
<p>the maximum negative log-likelihood.</p>
</td></tr>
<tr><td><code>$AIC</code></td>
<td>
<p>Akaike information criterion.</p>
</td></tr>
<tr><td><code>$AICc</code></td>
<td>
<p>Akaike information criterion corrected for sample-size.</p>
</td></tr>
<tr><td><code>$solution</code></td>
<td>
<p>a matrix containing the maximum likelihood estimates of the model 
parameters.</p>
</td></tr>
<tr><td><code>$index.par</code></td>
<td>
<p>an index matrix of the parameters being estimated.</p>
</td></tr>
<tr><td><code>$f</code></td>
<td>
<p>user-supplied sampling frequencies.</p>
</td></tr>
<tr><td><code>$hidden.areas</code></td>
<td>
<p>a logical indicating whether hidden areas were included in the 
model.</p>
</td></tr>
<tr><td><code>$assume.cladogenetic</code></td>
<td>
<p>a logical indicating whether cladogenetic events were allowed
at nodes.</p>
</td></tr>
<tr><td><code>$condition.on.surivival</code></td>
<td>
<p>a logical indicating whether the
likelihood was conditioned on the survival of two lineages and the speciation event 
subtending them.</p>
</td></tr>
<tr><td><code>$root.type</code></td>
<td>
<p>indicates the user-specified root prior assumption.</p>
</td></tr>
<tr><td><code>$root.p</code></td>
<td>
<p>indicates whether the user-specified fixed root probabilities.</p>
</td></tr>
<tr><td><code>$timeslice</code></td>
<td>
<p>indicates whether the user-specified timeslice that split the tree.</p>
</td></tr>
<tr><td><code>$phy</code></td>
<td>
<p>user-supplied tree</p>
</td></tr>
<tr><td><code>$data</code></td>
<td>
<p>user-supplied dataset</p>
</td></tr>
<tr><td><code>$trans.matrix</code></td>
<td>
<p>the user-supplied transition matrix</p>
</td></tr>
<tr><td><code>$max.tol</code></td>
<td>
<p>relative optimization tolerance.</p>
</td></tr>
<tr><td><code>$starting.vals</code></td>
<td>
<p>The starting values for the optimization.</p>
</td></tr>
<tr><td><code>$upper.bounds</code></td>
<td>
<p>the vector of upper limits to the optimization search.</p>
</td></tr>
<tr><td><code>$lower.bounds</code></td>
<td>
<p>the vector of lower limits to the optimization
search.</p>
</td></tr>
<tr><td><code>$ode.eps</code></td>
<td>
<p>The ode.eps value used for the estimation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Caetano, D.S., B.C. O'Meara, and J.M. Beaulieu. 2018. Hidden state models improve state-dependent diversification approaches, including biogeographic models. Evolution, 72:2308-2324.
</p>
<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., W.P. Maddison, and S.P. Otto. 2009. Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Goldberg, E. E., L. T. Lancaster, and R. H. Ree. 2011. Phylogenetic Inference of Reciprocal Effects between Geographic Range Evolution and Diversification. Syst. Biol. 60:451-465.
</p>
<p>Maddison W.P., P.E. Midford, and S.P. Otto. 2007. Estimating a binary characters effect on speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., R.M. May, and P.H. Harvey. 1994. The reconstructed evolutionary process. Philos. Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='GetFossils'>Get fossilized birth-death samples</h2><span id='topic+GetFossils'></span>

<h3>Description</h3>

<p>Samples a simulated tree of extinct and extant lineages according to the preservation rate of the fossilized birth-death process.</p>


<h3>Usage</h3>

<pre><code class='language-R'>GetFossils(phy, psi=0.1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="GetFossils_+3A_phy">phy</code></td>
<td>
<p>a complete phylogeny that includes both extant and extinct lineages.</p>
</td></tr> 
<tr><td><code id="GetFossils_+3A_psi">psi</code></td>
<td>
<p>the preservation rate for which lineages will be sampled under a fossilized birth-death process.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a table of sampled lineages.
</p>

<hr>
<h2 id='hisse'>Hidden State Speciation and Extinction</h2><span id='topic+hisse'></span>

<h3>Description</h3>

<p>Sets up and executes a HiSSE model (Hidden State Speciation and Extinction) 
on a phylogeny and character distribution.</p>


<h3>Usage</h3>

<pre><code class='language-R'>hisse(phy, data, f=c(1,1), turnover=c(1,2), eps=c(1,2), 
hidden.states=FALSE, trans.rate=NULL, condition.on.survival=TRUE, 
root.type="madfitz", root.p=NULL, includes.fossils=FALSE, k.samples=NULL, 
strat.intervals=NULL, sann=TRUE, sann.its=5000, bounded.search=TRUE, 
max.tol=.Machine$double.eps^.50, starting.vals=NULL, turnover.upper=10000, eps.upper=3,
trans.upper=100, restart.obj=NULL, ode.eps=0, dt.threads=1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hisse_+3A_phy">phy</code></td>
<td>
<p>a phylogenetic tree, in <code>ape</code> &ldquo;phylo&rdquo; format.</p>
</td></tr>
<tr><td><code id="hisse_+3A_data">data</code></td>
<td>
<p>a matrix (or dataframe) with three columns. The first column 
containing the species names and the second and third containing the binary 
character information. Character &quot;0&quot; is on column 2 and chracter &quot;1&quot; is on 
column 3. A value of 0 means character absent and a value of 1 character 
present. The input of data follows a Pagel model. See 'Details'.</p>
</td></tr>
<tr><td><code id="hisse_+3A_f">f</code></td>
<td>
<p>vector of length 2 with the estimated proportion of extant species in 
state 0 and 1 that are included in the phylogeny. A value of c(0.25, 0.5) means 
that 25 percent of species in state 0 and 50 percent of species in state 1 are 
included in the phylogeny. By default all species are assumed to be sampled.</p>
</td></tr>
<tr><td><code id="hisse_+3A_turnover">turnover</code></td>
<td>
<p>a numeric vector indicating the number of free turnover parameters in the
model.</p>
</td></tr>
<tr><td><code id="hisse_+3A_eps">eps</code></td>
<td>
<p>a numeric vector indicating the number of free extinction fraction parameters 
in the model.</p>
</td></tr>
<tr><td><code id="hisse_+3A_hidden.states">hidden.states</code></td>
<td>
<p>a logical indicating whether the model includes a
hidden states. The default is <code>FALSE</code>.</p>
</td></tr> 
<tr><td><code id="hisse_+3A_trans.rate">trans.rate</code></td>
<td>
<p>provides the transition rate model. See function
<code>TransMatMakerHiSSE</code>.</p>
</td></tr>
<tr><td><code id="hisse_+3A_condition.on.survival">condition.on.survival</code></td>
<td>
<p>a logical indicating whether the likelihood
should be conditioned on the survival of two lineages and the
speciation event subtending them (Nee et al. 1994). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="hisse_+3A_root.type">root.type</code></td>
<td>
<p>indicates whether root summarization follow the procedure described by 
FitzJohn et al. 2009, &ldquo;madfitz&rdquo; or Herrera-Alsina et al. 2018, &ldquo;herr_als&rdquo;.</p>
</td></tr>
<tr><td><code id="hisse_+3A_root.p">root.p</code></td>
<td>
<p>a vector indicating fixed root state probabilities. The
default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="hisse_+3A_includes.fossils">includes.fossils</code></td>
<td>
<p>a logical indicating whether the tree contains fossil taxa. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="hisse_+3A_k.samples">k.samples</code></td>
<td>
<p>a table of extinct individuals with sampled descendants. See details for how the table must be formatted.</p>
</td></tr>
<tr><td><code id="hisse_+3A_strat.intervals">strat.intervals</code></td>
<td>
<p>a table of extinct individuals with sampled descendants. See vignette for how the table must be formatted.</p>
</td></tr>
<tr><td><code id="hisse_+3A_sann">sann</code></td>
<td>
<p>a logical indicating whether a two-step optimization
procedure is to be used. The first includes a simulate annealing
approach, with the second involving a refinement using
<code>subplex</code>. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="hisse_+3A_sann.its">sann.its</code></td>
<td>
<p>a numeric indicating the number of times the simulated
annealing algorithm should call the objective function.</p>
</td></tr>
<tr><td><code id="hisse_+3A_bounded.search">bounded.search</code></td>
<td>
<p>a logical indicating whether or not bounds should
be enforced during optimization. The default is is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="hisse_+3A_max.tol">max.tol</code></td>
<td>
<p>supplies the relative optimization tolerance to
<code>subplex</code>.</p>
</td></tr>
<tr><td><code id="hisse_+3A_starting.vals">starting.vals</code></td>
<td>
<p>a numeric vector of length 3 with starting values for the
model for all areas and hidden states. Position [1] sets turnover, [2]
sets extinction fraction, and [3] transition rates.</p>
</td></tr>
<tr><td><code id="hisse_+3A_turnover.upper">turnover.upper</code></td>
<td>
<p>sets the upper bound for the turnover parameters.</p>
</td></tr>
<tr><td><code id="hisse_+3A_eps.upper">eps.upper</code></td>
<td>
<p>sets the upper bound for the eps parameters.</p>
</td></tr>
<tr><td><code id="hisse_+3A_trans.upper">trans.upper</code></td>
<td>
<p>sets the upper bound for the transition rate parameters.</p>
</td></tr>
<tr><td><code id="hisse_+3A_restart.obj">restart.obj</code></td>
<td>
<p>an object of class  that contains everything to restart an optimization.</p>
</td></tr>
<tr><td><code id="hisse_+3A_ode.eps">ode.eps</code></td>
<td>
<p>sets the tolerance for the integration at the end of a
branch. Essentially if the sum of compD is less than this tolerance,
then it assumes the results are unstable and discards them. The
default is set to zero, but in testing a value of 1e-8 can sometimes
produce stable solutions for both easy and very difficult optimization problems.</p>
</td></tr>
<tr><td><code id="hisse_+3A_dt.threads">dt.threads</code></td>
<td>
<p>sets the number of threads available to data.table. In practice this 
need not change from the default of 1 thread, as we have not seen any speedup from 
allowing more threads.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function sets up and executes a new and faster version of the HiSSE model. Note that
the four-state character-independent model can be called from this command in addition to
the two-state BiSSE model and the full character-dependent HiSSE model. See vignette on 
how to set this up.
</p>
<p>The &ldquo;trans.rate&rdquo; input is the transition model and has an
entirely different setup than turnover rates and extinction fraction. See 
<code>TransMatMakerHiSSE</code> function for more details. 
</p>
<p>For the &ldquo;root.type&rdquo; option, we are currently maintaining the previous default of 
&ldquo;madfitz&rdquo;. However, it was recently pointed out by Herrera-Alsina et al. (2018)
that at the root, the individual likelihoods for each possible state should be conditioned
prior to averaging the individual likelihoods across states. This can be set doing 
&ldquo;herr_als&rdquo;. It is unclear to us which is exactly correct, but it does seem that 
both &ldquo;madfitz&rdquo; and &ldquo;herr_als&rdquo; behave exactly as they should in the case of 
character-independent diversification (i.e., reduces to likelihood of tree + likelihood of
trait model). We've also tested the behavior and the likelihood differences are very 
subtle and the parameter estimates in simulation are nearly indistinguishable from the
&ldquo;madfitz&rdquo; conditioning scheme. We provide both options and encourage users to try 
both and let us know conditions in which the result vary dramatically under the two root
implementations. We suspect they do not. 
</p>
<p>For user-specified &ldquo;root.p&rdquo;, you should specify the probability for each state. If
you are doing a hidden model, there will be four states: 0A, 1A, 0B, 1B. So if you 
wanted to say the root had to be state 0, you would specify
&ldquo;root.p = c(0.5, 0, 0.5, 0)&rdquo;.
</p>
<p>This code will completely replace the original hisse function in the next version.
</p>


<h3>Value</h3>

<p><code>hisse</code> returns an object of class <code>hisse.fit</code>. This is a list with 
elements:
</p>
<table>
<tr><td><code>$loglik</code></td>
<td>
<p>the maximum negative log-likelihood.</p>
</td></tr>
<tr><td><code>$AIC</code></td>
<td>
<p>Akaike information criterion.</p>
</td></tr>
<tr><td><code>$AICc</code></td>
<td>
<p>Akaike information criterion corrected for sample-size.</p>
</td></tr>
<tr><td><code>$solution</code></td>
<td>
<p>a matrix containing the maximum likelihood estimates of the model 
parameters.</p>
</td></tr>
<tr><td><code>$index.par</code></td>
<td>
<p>an index matrix of the parameters being estimated.</p>
</td></tr>
<tr><td><code>$f</code></td>
<td>
<p>user-supplied sampling frequencies.</p>
</td></tr>
<tr><td><code>$hidden.states</code></td>
<td>
<p>a logical indicating whether hidden states were included in the 
model.</p>
</td></tr>
<tr><td><code>$condition.on.surivival</code></td>
<td>
<p>a logical indicating whether the
likelihood was conditioned on the survival of two lineages and the speciation event 
subtending them.</p>
</td></tr>
<tr><td><code>$root.type</code></td>
<td>
<p>indicates the user-specified root prior assumption.</p>
</td></tr>
<tr><td><code>$root.p</code></td>
<td>
<p>indicates whether the user-specified fixed root probabilities.</p>
</td></tr>
<tr><td><code>$phy</code></td>
<td>
<p>user-supplied tree</p>
</td></tr>
<tr><td><code>$data</code></td>
<td>
<p>user-supplied dataset</p>
</td></tr>
<tr><td><code>$trans.matrix</code></td>
<td>
<p>the user-supplied transition matrix</p>
</td></tr>
<tr><td><code>$max.tol</code></td>
<td>
<p>relative optimization tolerance.</p>
</td></tr>
<tr><td><code>$starting.vals</code></td>
<td>
<p>The starting values for the optimization.</p>
</td></tr>
<tr><td><code>$upper.bounds</code></td>
<td>
<p>the vector of upper limits to the optimization search.</p>
</td></tr>
<tr><td><code>$lower.bounds</code></td>
<td>
<p>the vector of lower limits to the optimization
search.</p>
</td></tr>
<tr><td><code>$ode.eps</code></td>
<td>
<p>The ode.eps value used for the estimation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models 
of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation 
and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Herrera-Alsina, L., P. van Els, and R.S. Etienne. 2018. Detecting the dependence of diversification on multiples traits from phylogenetic trees and trait data. Systematic Biology, 68:317-328.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters effect on 
speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos. 
Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(diversitree)
pars &lt;- c(0.1, 0.2, 0.03, 0.03, 0.01, 0.01)
set.seed(4) 
phy &lt;- tree.bisse(pars, max.t=30, x0=0)
sim.dat &lt;- data.frame(names(phy$tip.state), phy$tip.state)

## Fit BiSSE equivalent:
trans.rates.bisse &lt;-  TransMatMakerHiSSE(hidden.traits=0)
pp.bisse &lt;- hisse(phy, sim.dat, hidden.states=FALSE, turnover=c(1,2), 
eps=c(1,2), trans.rate=trans.rates.bisse)

## Now fit HiSSE equivalent with a hidden state for state 1:
trans.rates.hisse &lt;- TransMatMakerHiSSE(hidden.traits=1)
pp.hisse &lt;- hisse(phy, sim.dat, hidden.states=TRUE, turnover=c(1,2,1,2), 
eps=c(1,2,1,2), trans.rate=trans.rates.hisse)

</code></pre>

<hr>
<h2 id='hisse.null4.old'>Original Four state trait-independent Hidden State Speciation and Extinction</h2><span id='topic+hisse.null4.old'></span>

<h3>Description</h3>

<p>Sets up and executes the original four state trait-independent HiSSE model (Hidden State Speciation and Extinction) on a phylogeny and character set.</p>


<h3>Usage</h3>

<pre><code class='language-R'>hisse.null4.old(phy, data, f=c(1,1), turnover.anc=rep(c(1,2,3,4),2), 
eps.anc=rep(c(1,2,3,4),2), trans.type="equal", condition.on.survival=TRUE, 
root.type="madfitz", root.p=NULL,  output.type="turnover", sann=TRUE, 
sann.its=1000, bounded.search=TRUE, max.tol=.Machine$double.eps^.50,
starting.vals=NULL, turnover.upper=10000, eps.upper=3, trans.upper=100,
ode.eps=0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hisse.null4.old_+3A_phy">phy</code></td>
<td>
<p>a phylogenetic tree, in <code>ape</code> &ldquo;phylo&rdquo; format and with internal nodes labeled denoting the ancestral selective regimes.</p>
</td></tr>
<tr><td><code id="hisse.null4.old_+3A_data">data</code></td>
<td>
<p>a data matrix containing species information (see Details).</p>
</td></tr>
<tr><td><code id="hisse.null4.old_+3A_f">f</code></td>
<td>
<p>vector of length 2 with the estimated proportion of extant species in state 0 and 1 that are included in the phylogeny. A value of c(0.25, 0.5) means that 25 percent of species in state 0 and 50 percent of species in state 1 are included in the phylogeny. By default all species are assumed to be sampled.</p>
</td></tr>
<tr><td><code id="hisse.null4.old_+3A_turnover.anc">turnover.anc</code></td>
<td>
<p>a vector of length 8, indicating the free parameters associated with the net turnover rates. Default setting assumes character independent diversification (see Details).</p>
</td></tr> 
<tr><td><code id="hisse.null4.old_+3A_eps.anc">eps.anc</code></td>
<td>
<p>a vector of length 8, indicating the free parameters associated with the extinction fractions. Default setting assumes character independent diversification (see Details).</p>
</td></tr> 
<tr><td><code id="hisse.null4.old_+3A_trans.type">trans.type</code></td>
<td>
<p>provides the type of transition rate model. Currently this model allows two types: &ldquo;equal&rdquo;, the default, which assumes all transitions are equal, and &ldquo;three.rate&rdquo;, that assumes three rates (see Details).</p>
</td></tr> 
<tr><td><code id="hisse.null4.old_+3A_condition.on.survival">condition.on.survival</code></td>
<td>
<p>a logical indicating whether the likelihood should be conditioned on the survival of two lineages and the speciation event subtending them (Nee et al. 1994). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="hisse.null4.old_+3A_root.type">root.type</code></td>
<td>
<p>indicates whether root summarization follow the procedure described by FitzJohn et al. 2009, &ldquo;madfitz&rdquo; or Herrera-Alsina et al. 2018, &ldquo;herr_als&rdquo;.</p>
</td></tr>
<tr><td><code id="hisse.null4.old_+3A_root.p">root.p</code></td>
<td>
<p>a vector indicating fixed root state probabilities. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="hisse.null4.old_+3A_output.type">output.type</code></td>
<td>
<p>indicates whether the rates should be printed onscreen as the optimized variables, &ldquo;turnover&rdquo;, transformed to reflect net diversification, &ldquo;net.div&rdquo;, or transformed to reflect <code class="reqn">\lambda</code> and <code class="reqn">\mu</code>, &ldquo;raw&rdquo;.</p>
</td></tr>
<tr><td><code id="hisse.null4.old_+3A_sann">sann</code></td>
<td>
<p>a logical indicating whether a two-step optimization procedure is to be used. The first includes a simulate annealing approach, with the second involving a refinement using <code>subplex</code>. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="hisse.null4.old_+3A_sann.its">sann.its</code></td>
<td>
<p>a numeric indicating the number of times the simulated annealing algorithm should call the objective function.</p>
</td></tr>
<tr><td><code id="hisse.null4.old_+3A_bounded.search">bounded.search</code></td>
<td>
<p>a logical indicating whether or not bounds should be enforced during optimization. The default is is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="hisse.null4.old_+3A_max.tol">max.tol</code></td>
<td>
<p>supplies the relative optimization tolerance to <code>subplex</code>.</p>
</td></tr>
<tr><td><code id="hisse.null4.old_+3A_starting.vals">starting.vals</code></td>
<td>
<p>a vector of starting values to be used instead of the default settings. These are just three values given in the following order: turnover (1), extinction fraction (2), and a single transition rate (3)</p>
</td></tr>
<tr><td><code id="hisse.null4.old_+3A_turnover.upper">turnover.upper</code></td>
<td>
<p>sets the upper bound for the turnover parameters. The default upper bound assumes an event occurs every 100 years.</p>
</td></tr>
<tr><td><code id="hisse.null4.old_+3A_eps.upper">eps.upper</code></td>
<td>
<p>sets the upper bound for the extinction fraction parameters.</p>
</td></tr>
<tr><td><code id="hisse.null4.old_+3A_trans.upper">trans.upper</code></td>
<td>
<p>sets the upper bound for the transition rate parameters.</p>
</td></tr>
<tr><td><code id="hisse.null4.old_+3A_ode.eps">ode.eps</code></td>
<td>
<p>sets the tolerance for the integration at the end of a branch. Essentially if the sum of compD is less than this tolerance, then it assumes the results are unstable and discards them. The default is set to zero, but in testing a value of 1e-8 can sometimes produce stable solutions for both easy and very difficult optimization problems.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function sets up and executes a four-state trait independent HiSSE model. The model closely follows <code>hisse.old</code>. However, note that this function is no longer necessary and can be called and evaluated directly using the new <code>hisse</code> function.
</p>
<p>Like <code>hisse.old</code>, users input vectors containing values to indicate how many free parameters are to be estimated for each of the variables in the model. However, the null-four model assumes that &ldquo;turnover.anc&rdquo; and &ldquo;eps.anc&rdquo; are linked between the two observed states. Thus, users are unlikely to alter the inputs much, aside from perhaps fixing &ldquo;turnover.anc&rdquo; or &ldquo;eps.anc&rdquo; to be equal across the four hidden states, where the &ldquo;turnover.anc&rdquo; input vector is set as rep(c(1,1,1,1),2). For a Yule equivalent, the input vector for &ldquo;eps.anc&rdquo; would be rep(c(0,0,0,0),2). For how to setup a null-two model see the example code below.
</p>
<p>For user-specified &ldquo;root.p&rdquo;, you should specify the probability for each state. See help for &ldquo;hisse.old&rdquo; for more on other parameters for this function.
</p>
<p>For the &ldquo;root.type&rdquo; option, we are currently maintaining the previous default of 
&ldquo;madfitz&rdquo;. However, it was recently pointed out by Herrera-Alsina et al. (2018)
that at the root, the individual likelihoods for each possible state should be conditioned
prior to averaging the individual likelihoods across states. This can be set doing 
&ldquo;herr_als&rdquo;. It is unclear to us which is exactly correct, but it does seem that 
both &ldquo;madfitz&rdquo; and &ldquo;herr_als&rdquo; behave exactly as they should in the case of 
character-independent diversification (i.e., reduces to likelihood of tree + likelihood of
trait model). We've also tested the behavior and the likelihood differences are very 
subtle and the parameter estimates in simulation are nearly indistinguishable from the
&ldquo;madfitz&rdquo; conditioning scheme. We provide both options and encourage users to try 
both and let us know conditions in which the result vary dramatically under the two root
implementations. We suspect they do not. 
</p>
<p>Also, note, that in the case of &ldquo;root.type=user&rdquo; and &ldquo;root.type=equal&rdquo; are
no longer explicit &ldquo;root.type&rdquo; options. Instead, either &ldquo;madfitz&rdquo; or 
&ldquo;herr_als&rdquo; are specified and the &ldquo;root.p&rdquo; can be set to allow for custom
root options.  
</p>


<h3>Value</h3>

<p><code>hisse.null4.old</code> returns an object of class <code>hisse.fit</code>. This is a list with elements:
</p>
<table>
<tr><td><code>$loglik</code></td>
<td>
<p>the maximum negative log-likelihood.</p>
</td></tr>
<tr><td><code>$AIC</code></td>
<td>
<p>Akaike information criterion.</p>
</td></tr>
<tr><td><code>$AICc</code></td>
<td>
<p>Akaike information criterion corrected for sample-size.</p>
</td></tr>
<tr><td><code>$solution</code></td>
<td>
<p>a matrix containing the maximum likelihood estimates of the model parameters.</p>
</td></tr>
<tr><td><code>$index.par</code></td>
<td>
<p>an index matrix of the parameters being estimated.</p>
</td></tr>
<tr><td><code>$f</code></td>
<td>
<p>user-supplied sampling frequencies.</p>
</td></tr>
<tr><td><code>$condition.on.surivival</code></td>
<td>
<p>a logical indicating whether the likelihood was conditioned on the survival of two lineages and the speciation event subtending them.</p>
</td></tr>
<tr><td><code>$root.type</code></td>
<td>
<p>indicates the user-specified root prior assumption.</p>
</td></tr>
<tr><td><code>$root.p</code></td>
<td>
<p>indicates whether the user-specified fixed root probabilities.</p>
</td></tr>
<tr><td><code>$phy</code></td>
<td>
<p>user-supplied tree</p>
</td></tr>
<tr><td><code>$data</code></td>
<td>
<p>user-supplied dataset</p>
</td></tr>
<tr><td><code>$output.type</code></td>
<td>
<p>the user-specified output.type to be printed on the screen.</p>
</td></tr>
<tr><td><code>$trans.type</code></td>
<td>
<p>the user-specified transition model.</p>
</td></tr>
<tr><td><code>$trans.mat</code></td>
<td>
<p>the index matrix that specifies the free parameters in the transition model.</p>
</td></tr> 
<tr><td><code>$max.tol</code></td>
<td>
<p>relative optimization tolerance.</p>
</td></tr>
<tr><td><code>$upper.bounds</code></td>
<td>
<p>the vector of upper limits to the optimization search.</p>
</td></tr>
<tr><td><code>$lower.bounds</code></td>
<td>
<p>the vector of lower limits to the optimization search.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>

<hr>
<h2 id='hisse.old'>Original Hidden State Speciation and Extinction</h2><span id='topic+hisse.old'></span>

<h3>Description</h3>

<p>Sets up and executes the original HiSSE model (Hidden State Speciation and Extinction) on a phylogeny and character distribution.</p>


<h3>Usage</h3>

<pre><code class='language-R'>hisse.old(phy, data, f=c(1,1), hidden.states=TRUE, turnover.anc=c(1,1,0,0), 
eps.anc=c(1,1,0,0), trans.rate=NULL, turnover.beta=c(0,0,0,0), 
eps.beta=c(0,0,0,0), timeslice=NULL, condition.on.survival=TRUE, 
root.type="madfitz", root.p=NULL, output.type="turnover", sann=TRUE,
sann.its=1000, bounded.search=TRUE, max.tol=.Machine$double.eps^.50,
starting.vals=NULL, turnover.upper=10000, eps.upper=3, trans.upper=100,
ode.eps=0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hisse.old_+3A_phy">phy</code></td>
<td>
<p>a phylogenetic tree, in <code>ape</code> &ldquo;phylo&rdquo; format and with internal nodes labeled denoting the ancestral selective regimes.</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_data">data</code></td>
<td>
<p>a data matrix containing species information (see Details).</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_f">f</code></td>
<td>
<p>vector of length 2 with the estimated proportion of extant species in state 0 and 1 that are included in the phylogeny. A value of c(0.25, 0.5) means that 25 percent of species in state 0 and 50 percent of species in state 1 are included in the phylogeny. By default all species are assumed to be sampled.</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_hidden.states">hidden.states</code></td>
<td>
<p>a logical indicating whether the model includes a hidden state. The default is <code>FALSE</code>.</p>
</td></tr> 
<tr><td><code id="hisse.old_+3A_turnover.anc">turnover.anc</code></td>
<td>
<p>a vector of length 4, indicating the free parameters associated with the net turnover rates. Default settings is a BiSSE model with fixed turnover rates for both observed states (see Details).</p>
</td></tr> 
<tr><td><code id="hisse.old_+3A_eps.anc">eps.anc</code></td>
<td>
<p>a vector of length 4, indicating the free parameters associated with the extinction fractions. Default settings is a BiSSE model with fixed extinction fractions for both observed states (see Details).</p>
</td></tr> 
<tr><td><code id="hisse.old_+3A_trans.rate">trans.rate</code></td>
<td>
<p>provides the transition rate model.</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_turnover.beta">turnover.beta</code></td>
<td>
<p>a vector of length 4, indicating the free parameters associated with time-varying net turnover rates (see Details).</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_eps.beta">eps.beta</code></td>
<td>
<p>a vector of length 4, indicating the free parameters associated with time-varying extinction fractions (see Details).</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_timeslice">timeslice</code></td>
<td>
<p>a user-supplied time to split the tree.</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_condition.on.survival">condition.on.survival</code></td>
<td>
<p>a logical indicating whether the likelihood should be conditioned on the survival of two lineages and the speciation event subtending them (Nee et al. 1994). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_root.type">root.type</code></td>
<td>
<p>indicates whether root summarization follow the procedure described by FitzJohn et al. 2009, &ldquo;madfitz&rdquo; or Herrera-Alsina et al. 2018, &ldquo;herr_als&rdquo;.</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_root.p">root.p</code></td>
<td>
<p>a vector indicating fixed root state probabilities. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_output.type">output.type</code></td>
<td>
<p>indicates whether the rates should be printed onscreen as the optimized variables, &ldquo;turnover&rdquo;, transformed to reflect net diversification, &ldquo;net.div&rdquo;, or transformed to reflect <code class="reqn">\lambda</code> and <code class="reqn">\mu</code>, &ldquo;raw&rdquo;.</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_sann">sann</code></td>
<td>
<p>a logical indicating whether a two-step optimization procedure is to be used. The first includes a simulate annealing approach, with the second involving a refinement using <code>subplex</code>. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_sann.its">sann.its</code></td>
<td>
<p>a numeric indicating the number of times the simulated annealing algorithm should call the objective function.</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_bounded.search">bounded.search</code></td>
<td>
<p>a logical indicating whether or not bounds should be enforced during optimization. The default is is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_max.tol">max.tol</code></td>
<td>
<p>supplies the relative optimization tolerance to <code>subplex</code>.</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_starting.vals">starting.vals</code></td>
<td>
<p>a vector of starting values to be used instead of the default settings. These are just three values given in the following order: turnover (1), extinction fraction (2), and a single transition rate (3)</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_turnover.upper">turnover.upper</code></td>
<td>
<p>sets the upper bound for the turnover parameters. The default upper bound assumes an event occurs every 100 years.</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_eps.upper">eps.upper</code></td>
<td>
<p>sets the upper bound for the extinction fraction parameters.</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_trans.upper">trans.upper</code></td>
<td>
<p>sets the upper bound for the transition rate parameters.</p>
</td></tr>
<tr><td><code id="hisse.old_+3A_ode.eps">ode.eps</code></td>
<td>
<p>sets the tolerance for the integration at the end of a branch. Essentially if the sum of compD is less than this tolerance, then it assumes the results are unstable and discards them. The default is set to zero, but in testing a value of 1e-8 can sometimes produce stable solutions for both easy and very difficult optimization problems.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function sets up and executes the original HiSSE model. The model closely follows <code>diversitree</code>, although here we employ modified optimization procedures. For example, rather than optimizing birth and death separately, hisse optimizes orthogonal transformations of these variables: we let tau = birth+death define &quot;net turnover&quot;, and we let eps = death/birth define the &ldquo;extinction fraction&rdquo;. This reparameterization alleviates problems associated with overfitting when birth and death are highly correlated, but both matter in explaining the diversity pattern. As for data file format, <code>hisse</code> expects a two column matrix or data frame, with the first column containing the species names and the second containing the binary character information. Note that the order of the data file and the names in the &ldquo;phylo&rdquo; object need not be in the same order; <code>hisse</code> deals with this internally. Also, the character information should be binary and coded as 0 and 1, otherwise the function will misbehave. However, if the state for a species is unknown, a user can specify this with a 2, and the state will be considered maximally ambiguous.
</p>
<p>To setup a model, users input vectors containing values to indicate how many free parameters are to be estimated for each of the variables in the model. For example, the &ldquo;turnover.anc&rdquo; input vector is set by default as c(1,1,0,0). This means for state 0 and state 1, we are allowing one free parameter to define the net turnover rate (birth+death) in the model. This is essentially a BiSSE model with fixed turnover rates. Now, say we want to include separate turnover rates for both states we would simply input c(1,2,0,0). The last two entries, which in the preceding example are set to zero, correspond to the hidden states; the third entry corresponds to a hidden state associated with observed state 0, such that 0A (hidden state absent) is the first entry, and 0B (hidden state present) is the third entry. So, to set up a model with three turnover rates, where we include a free parameter for a hidden state associated with state 0 we input c(1,2,3,0). A full model would thus be c(1,2,3,4), which corresponds to four separate net turnover rates, for states 0A (first entry), 1A (second entry), 0B (third entry), and 1B (fourth entry). Extinction fraction, or &ldquo;eps.anc&rdquo;, follows the same format, though including a zero for a state we want to include in the model corresponds to no extinction, which is the Yule equivalent. In general, we follow this format to make it easier to generate a large set of nested models. Once the model is specified, the parameters can be estimated using the subplex routine (default), or use a two-step process (i.e., sann=TRUE) that first employs a stochastic simulated annealing procedure, which is later refined using the subplex routine.
</p>
<p>The &ldquo;trans.rate&rdquo; input is the transition model and has an entirely different setup than turnover and extinction rates. See <code>TransMatMaker</code> function for more details. 
</p>
<p>For user-specified &ldquo;root.p&rdquo;, you should specify the probability for each state. If you are doing a hidden model, there will be four states: 0A, 1A, 0B, 1B. So if you wanted to say the root had to be state 0, you would specify &ldquo;root.p = c(0.5, 0, 0.5, 0)&rdquo;.
</p>
<p>For the &ldquo;root.type&rdquo; option, we are currently maintaining the previous default of 
&ldquo;madfitz&rdquo;. However, it was recently pointed out by Herrera-Alsina et al. (2018)
that at the root, the individual likelihoods for each possible state should be conditioned
prior to averaging the individual likelihoods across states. This can be set doing 
&ldquo;herr_als&rdquo;. It is unclear to us which is exactly correct, but it does seem that 
both &ldquo;madfitz&rdquo; and &ldquo;herr_als&rdquo; behave exactly as they should in the case of 
character-independent diversification (i.e., reduces to likelihood of tree + likelihood of
trait model). We've also tested the behavior and the likelihood differences are very 
subtle and the parameter estimates in simulation are nearly indistinguishable from the
&ldquo;madfitz&rdquo; conditioning scheme. We provide both options and encourage users to try 
both and let us know conditions in which the result vary dramatically under the two root
implementations. We suspect they do not. 
</p>
<p>Also, note, that in the case of &ldquo;root.type=user&rdquo; and &ldquo;root.type=equal&rdquo; are
no longer explicit &ldquo;root.type&rdquo; options. Instead, either &ldquo;madfitz&rdquo; or 
&ldquo;herr_als&rdquo; are specified and the &ldquo;root.p&rdquo; can be set to allow for custom
root options.  
</p>
<p>Finally, the options &ldquo;.beta&rdquo; and &ldquo;timeslice&rdquo; are included, but neither have been tested &ndash; needless to say, use at your own risk (but really, though, you should probably forget that these options exist for the time being). The &ldquo;.beta&rdquo; provides a means for testing for time-varying rates, whereas &ldquo;timeslice&rdquo; splits the tree to allow the process to vary before and after some user defined time period. These options will be further developed in due course.
</p>


<h3>Value</h3>

<p><code>hisse.old</code> returns an object of class <code>hisse.fit</code>. This is a list with elements:
</p>
<table>
<tr><td><code>$loglik</code></td>
<td>
<p>the maximum negative log-likelihood.</p>
</td></tr>
<tr><td><code>$AIC</code></td>
<td>
<p>Akaike information criterion.</p>
</td></tr>
<tr><td><code>$AICc</code></td>
<td>
<p>Akaike information criterion corrected for sample-size.</p>
</td></tr>
<tr><td><code>$solution</code></td>
<td>
<p>a matrix containing the maximum likelihood estimates of the model parameters.</p>
</td></tr>
<tr><td><code>$index.par</code></td>
<td>
<p>an index matrix of the parameters being estimated.</p>
</td></tr>
<tr><td><code>$f</code></td>
<td>
<p>user-supplied sampling frequencies.</p>
</td></tr>
<tr><td><code>$hidden.states</code></td>
<td>
<p>a logical indicating whether a hidden state was included in the model.</p>
</td></tr>
<tr><td><code>$condition.on.surivival</code></td>
<td>
<p>a logical indicating whether the likelihood was conditioned on the survival of two lineages and the speciation event subtending them.</p>
</td></tr>
<tr><td><code>$root.type</code></td>
<td>
<p>indicates the user-specified root prior assumption.</p>
</td></tr>
<tr><td><code>$root.p</code></td>
<td>
<p>indicates whether the user-specified fixed root probabilities.</p>
</td></tr>
<tr><td><code>$timeslice</code></td>
<td>
<p>indicates whether the user-specified timeslice that split the tree.</p>
</td></tr>
<tr><td><code>$phy</code></td>
<td>
<p>user-supplied tree</p>
</td></tr>
<tr><td><code>$data</code></td>
<td>
<p>user-supplied dataset</p>
</td></tr>
<tr><td><code>$iterations</code></td>
<td>
<p>number of iterations of the likelihood search that were executed.</p>
</td></tr>
<tr><td><code>$output.type</code></td>
<td>
<p>the user-specified output.type to be printed on the screen.</p>
</td></tr>
<tr><td><code>$max.tol</code></td>
<td>
<p>relative optimization tolerance.</p>
</td></tr>
<tr><td><code>$upper.bounds</code></td>
<td>
<p>the vector of upper limits to the optimization search.</p>
</td></tr>
<tr><td><code>$lower.bounds</code></td>
<td>
<p>the vector of lower limits to the optimization search.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Herrera-Alsina, L., P. van Els, and R.S. Etienne. 2018. Detecting the dependence of diversification on multiples traits from phylogenetic trees and trait data. Systematic Biology, 68:317-328.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters effect on speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos. Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='makeGeoHiSSELikelihood'>Export likelihood function for the GeoHiSSE model</h2><span id='topic+makeGeoHiSSELikelihood'></span>

<h3>Description</h3>

<p>Exports a likelihood function conditioned on the data and a
named vector with the parameters for each of the models.</p>


<h3>Usage</h3>

<pre><code class='language-R'>makeGeoHiSSELikelihood(phy, data, hidden.areas=0, f=c(1,1,1), assume.cladogenetic=TRUE, 
condition.on.survival=TRUE, root.type="madfitz", root.p=NULL, dt.threads=1, ode.eps = 0, 
bad.likelihood = exp(-300))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="makeGeoHiSSELikelihood_+3A_phy">phy</code></td>
<td>
<p>a phylogenetic tree, in <code>ape</code> &ldquo;phylo&rdquo; format and with internal nodes labeled denoting the ancestral selective regimes.</p>
</td></tr>
<tr><td><code id="makeGeoHiSSELikelihood_+3A_data">data</code></td>
<td>
<p>a data matrix containing species information (see Details).</p>
</td></tr>
<tr><td><code id="makeGeoHiSSELikelihood_+3A_hidden.areas">hidden.areas</code></td>
<td>
<p>Number of hidden areas included in the model. When hidden.areas = 0, the model is equal to the GeoSSE model (i.e., no hidden states included).</p>
</td></tr>
<tr><td><code id="makeGeoHiSSELikelihood_+3A_f">f</code></td>
<td>
<p>vector of length 3 with the estimated proportion of extant species in areas 0, 1, and 2 (see fgeohisse function for more information) that are included in the phylogeny. By default all species are assumed to be sampled.</p>
</td></tr>
<tr><td><code id="makeGeoHiSSELikelihood_+3A_assume.cladogenetic">assume.cladogenetic</code></td>
<td>
<p>a logical indicating whether the likelihood should be conditioned on geographical speciation happening at the nodes. If set to FALSE then all range transitions are treated as anagenetic. The default is <code>TRUE</code>. See Caetano et al. (2018 - Evolution) for more information.</p>
</td></tr>
<tr><td><code id="makeGeoHiSSELikelihood_+3A_condition.on.survival">condition.on.survival</code></td>
<td>
<p>a logical indicating whether the likelihood should be conditioned on the survival of two lineages and the speciation event subtending them (Nee et al. 1994). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="makeGeoHiSSELikelihood_+3A_root.type">root.type</code></td>
<td>
<p>indicates whether root summarization follow the procedure described by FitzJohn et al. 2009, &ldquo;madfitz&rdquo; or Herrera-Alsina et al. 2018, &ldquo;herr_als&rdquo;.</p>
</td></tr>
<tr><td><code id="makeGeoHiSSELikelihood_+3A_root.p">root.p</code></td>
<td>
<p>a vector indicating fixed root state probabilities. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="makeGeoHiSSELikelihood_+3A_dt.threads">dt.threads</code></td>
<td>
<p>Number of core threads to be used by the data.table function. Default is 1.</p>
</td></tr>
<tr><td><code id="makeGeoHiSSELikelihood_+3A_ode.eps">ode.eps</code></td>
<td>
<p>sets the tolerance for the integration at the end of a branch. Essentially if the sum of compD is less than this tolerance, then it assumes the results are unstable and discards them. The default is set to zero, but in testing a value of 1e-8 can sometimes produce stable solutions for both easy and very difficult optimization problems.</p>
</td></tr>
<tr><td><code id="makeGeoHiSSELikelihood_+3A_bad.likelihood">bad.likelihood</code></td>
<td>
<p>Value returned when there is a problem in the computation of the likelihood value for the function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function sets up and returns the likelihood for the GeoHiSSE model
together with a vector of parameters. The likelihood function is
conditioned on the observed data and will return a value of
loglikelihood given a vector of parameter values. The length of the
parameter vector as well as the order of
the parameter vector cannot be changed. Please pay special attention to the length of the parameter
vector and the names of the parameters provided by the &ldquo;pars&rdquo;
element of the list.
</p>
<p>Note that when the likelihood computation fails the function will return the value set as &ldquo;bad.likelihood&rdquo;.
</p>


<h3>Value</h3>

<p><code>makeGeoHiSSELikelihood</code> returns a list with elements:
</p>
<table>
<tr><td><code>$loglik</code></td>
<td>
<p>the likelihood function for the model. This has a single
parameter 'p'.</p>
</td></tr>
<tr><td><code>$pars</code></td>
<td>
<p>a named vector for the likelihood function pupulated with 0
values.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu and Daniel S. Caetano</p>


<h3>References</h3>

<p>Caetano, D.S., B.C. O'Meara, and J.M. Beaulieu. 2018. Hidden state models improve state-dependent diversification approaches, including biogeographic models. Evolution, 72:2308-2324.
</p>
<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters effect on speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos. Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(diversitree)
library(hisse)
## Generate data:
pars &lt;- c(0.1, 0.2, 0.03, 0.03, 0.01, 0.01)
set.seed(4) 
phy &lt;- tree.bisse(pars, max.t=30, x0=0)
sim.dat &lt;- data.frame(names(phy$tip.state), phy$tip.state)
## Get lik function:
lik.hisse &lt;- makeHiSSELikelihood(phy = phy, data = sim.dat, hidden.states = FALSE)
likf &lt;- lik.hisse$log.lik
pars &lt;- lik.hisse$pars
## Set the parameter values. Note that we have turnover and eps, not speciation and extinction!
pars &lt;- setNames(c(0.1+0.03,0.2+0.03,0.03/0.1,0.03/0.2,0.01,0.01), names(pars))
## Compute the log-likelihood for the model.
likf(pars)

</code></pre>

<hr>
<h2 id='makeHiSSELikelihood'>Export likelihood function for the HiSSE model</h2><span id='topic+makeHiSSELikelihood'></span>

<h3>Description</h3>

<p>Exports a likelihood function conditioned on the data and a
named vector with the parameters for each of the models.</p>


<h3>Usage</h3>

<pre><code class='language-R'>makeHiSSELikelihood(phy, data, hidden.states=TRUE, null4=FALSE,
f=c(1,1), condition.on.survival=TRUE, root.type="madfitz", root.p=NULL, ode.eps=0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="makeHiSSELikelihood_+3A_phy">phy</code></td>
<td>
<p>a phylogenetic tree, in <code>ape</code> &ldquo;phylo&rdquo; format and with internal nodes labeled denoting the ancestral selective regimes.</p>
</td></tr>
<tr><td><code id="makeHiSSELikelihood_+3A_data">data</code></td>
<td>
<p>a data matrix containing species information (see Details).</p>
</td></tr>
<tr><td><code id="makeHiSSELikelihood_+3A_hidden.states">hidden.states</code></td>
<td>
<p>whether the model has hidden states. This is
ignored if the option &ldquo;null4&rdquo; is selected.</p>
</td></tr>
<tr><td><code id="makeHiSSELikelihood_+3A_null4">null4</code></td>
<td>
<p>used to select the null model for the full HiSSE
model. This is a special model with 4 hidden states.</p>
</td></tr>
<tr><td><code id="makeHiSSELikelihood_+3A_f">f</code></td>
<td>
<p>vector of length 2 with the estimated proportion of extant species in state 0 and 1 that are included in the phylogeny. A value of c(0.25, 0.5) means that 25 percent of species in state 0 and 50 percent of species in state 1 are included in the phylogeny. By default all species are assumed to be sampled.</p>
</td></tr>
<tr><td><code id="makeHiSSELikelihood_+3A_condition.on.survival">condition.on.survival</code></td>
<td>
<p>a logical indicating whether the likelihood should be conditioned on the survival of two lineages and the speciation event subtending them (Nee et al. 1994). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="makeHiSSELikelihood_+3A_root.type">root.type</code></td>
<td>
<p>indicates whether root summarization follow the procedure described by FitzJohn et al. 2009, &ldquo;madfitz&rdquo; or Herrera-Alsina et al. 2018, &ldquo;herr_als&rdquo;.</p>
</td></tr>
<tr><td><code id="makeHiSSELikelihood_+3A_root.p">root.p</code></td>
<td>
<p>a vector indicating fixed root state probabilities. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="makeHiSSELikelihood_+3A_ode.eps">ode.eps</code></td>
<td>
<p>sets the tolerance for the integration at the end of a branch. Essentially if the sum of compD is less than this tolerance, then it assumes the results are unstable and discards them. The default is set to zero, but in testing a value of 1e-8 can sometimes produce stable solutions for both easy and very difficult optimization problems.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function sets up and returns the likelihood for the HiSSE model
together with a vector of parameters. The likelihood function is
conditioned on the observed data and will return a value of
loglikelihood given a vector of parameter values. The length of the
parameter vector as well as the order of
the parameter vector cannot be changed. The parameter values are
provided in natural form but are log-transformed for the likelihood
evaluation. Please pay special attention to the length of the parameter
vector and the names of the parameters provided by the &ldquo;pars&rdquo;
element of the list.
</p>
<p>When the option &ldquo;null4&rdquo; is set to TRUE, then the likelihood
returned is for the HiSSE null model with 4 hidden states. The returned
list will include an additional element named &ldquo;trans.mat.guide&rdquo;
which can be used as a reference for the meaning of the 32 transition
parameters. Note that the original model in &ldquo;hisse.null4&rdquo; usually
sets all these transitions to a single value. This helps model
estimation since information is limited to estimate distinct transition
rates between parameters.
</p>


<h3>Value</h3>

<p><code>makeHiSSELikelihood</code> returns a list with elements:
</p>
<table>
<tr><td><code>$loglik</code></td>
<td>
<p>the likelihood function for the model. This has a single
parameter 'p'.</p>
</td></tr>
<tr><td><code>$pars</code></td>
<td>
<p>a named vector for the likelihood function pupulated with 0
values.</p>
</td></tr>
<tr><td><code>$trans.mat.guide</code></td>
<td>
<p>a reference matrix to understand the parameters
returned by the &ldquo;$pars&rdquo; vector. Only present if the
&ldquo;null4&rdquo; option is set to TRUE.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu and Daniel S. Caetano</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters effect on speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos. Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(diversitree)
library(hisse)
## Generate data:
pars &lt;- c(0.1, 0.2, 0.03, 0.03, 0.01, 0.01)
set.seed(4) 
phy &lt;- tree.bisse(pars, max.t=30, x0=0)
sim.dat &lt;- data.frame(names(phy$tip.state), phy$tip.state)
## Get lik function:
lik.hisse &lt;- makeHiSSELikelihood(phy = phy, data = sim.dat, hidden.states = FALSE)
likf &lt;- lik.hisse$log.lik
pars &lt;- lik.hisse$pars
## Set the parameter values. Note that we have turnover and eps, not speciation and extinction!
pars &lt;- setNames(c(0.1+0.03,0.2+0.03,0.03/0.1,0.03/0.2,0.01,0.01), names(pars))
## Compute the log-likelihood for the model.
likf(pars)

</code></pre>

<hr>
<h2 id='MarginRecon.old'>Original Ancestral State Estimation based on Marginal Reconstruction</h2><span id='topic+MarginRecon.old'></span>

<h3>Description</h3>

<p>Estimates the likeliest states for both internal nodes and tips of a phylogeny using the marginal reconstruction algorithm.</p>


<h3>Usage</h3>

<pre><code class='language-R'>MarginRecon.old(phy, data, f, pars, hidden.states=TRUE, four.state.null=FALSE, 
timeslice=NULL, condition.on.survival=TRUE, root.type="madfitz", root.p=NULL, 
AIC=NULL, verbose=TRUE, n.cores=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="MarginRecon.old_+3A_phy">phy</code></td>
<td>
<p>a phylogenetic tree, in <code>ape</code> &ldquo;phylo&rdquo; format and with internal nodes labeled denoting the ancestral selective regimes.</p>
</td></tr>
<tr><td><code id="MarginRecon.old_+3A_data">data</code></td>
<td>
<p>a data matrix containing species information (see Details).</p>
</td></tr>
<tr><td><code id="MarginRecon.old_+3A_f">f</code></td>
<td>
<p>vector of length 2 with the estimated proportion of extant species in state 0 and 1 that are included in the phylogeny. A value of c(0.25, 0.5) means that 25 percent of species in state 0 and 50 percent of species in state 1 are included in the phylogeny. By default all species are assumed to be known.</p>
</td></tr>
<tr><td><code id="MarginRecon.old_+3A_pars">pars</code></td>
<td>
<p>vector containing the MLE of the parameters.</p>
</td></tr>
<tr><td><code id="MarginRecon.old_+3A_hidden.states">hidden.states</code></td>
<td>
<p>a logical indicating whether the model includes a hidden state. The default is <code>FALSE</code>.</p>
</td></tr> 
<tr><td><code id="MarginRecon.old_+3A_four.state.null">four.state.null</code></td>
<td>
<p>a logical indicating whether the model is the null-four model. The default is <code>FALSE</code>.</p>
</td></tr> 
<tr><td><code id="MarginRecon.old_+3A_timeslice">timeslice</code></td>
<td>
<p>a user-supplied time to split the tree.</p>
</td></tr>
<tr><td><code id="MarginRecon.old_+3A_condition.on.survival">condition.on.survival</code></td>
<td>
<p>a logical indicating whether the likelihood should be conditioned on the survival of two lineages and the speciation event subtending them (Nee et al. 1994). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MarginRecon.old_+3A_root.type">root.type</code></td>
<td>
<p>indicates whether root prior assumption should based the procedure described by FitzJohn et al. 2009, &ldquo;madfitz&rdquo;, assumed equal, &ldquo;equal&rdquo;, or set to user, &ldquo;user&rdquo;.</p>
</td></tr>
<tr><td><code id="MarginRecon.old_+3A_root.p">root.p</code></td>
<td>
<p>a vector indicating fixed root state probabilities. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MarginRecon.old_+3A_aic">AIC</code></td>
<td>
<p>the AIC for the model being used for the reconstruction. This is used by the plotting function. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MarginRecon.old_+3A_verbose">verbose</code></td>
<td>
<p>a logical indicating whether progress should be printed to screen. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MarginRecon.old_+3A_n.cores">n.cores</code></td>
<td>
<p>specifies the number of independent processors to conduct the analysis.. The default is <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Conducts ancestral state reconstruction on the original <code>hisse.old</code> and <code>hisseNull4.old</code> functions. In this implementation the marginal probability of state i for a focal node is simply the overall likelihood of the tree and data when the state of the focal node is fixed in state i. Note that the likeliest tip states can also be estimated: we observe state 1, but the underlying state could either be state 1A or 1B. Thus, for any given node or tip we traverse the entire tree as many times as there are states in the model. As the size of the tree grows, however, these repeated tree traversals can slow the calculation down considerably. For this reason, we allow the marginal calculation to be conducted in parallel across any number of independent computer processors.
</p>
<p>For user-specified &ldquo;root.p&rdquo;, you should specify the probability for each state. If you are doing a hidden model, there will be four states: 0A, 1A, 0B, 1B. So if you wanted to say the root had to be state 0, you would specify &ldquo;root.p = c(0.5, 0, 0.5, 0)&rdquo;. 
</p>
<p>See help for &ldquo;hisse.old&rdquo; for more on other parameters for this function.
</p>


<h3>Value</h3>

<p><code>MarginRecon</code> returns an object of class <code>hisse.states</code>. This is a list with elements:
</p>
<table>
<tr><td><code>$node.mat</code></td>
<td>
<p>the marginal probabilities calculated for each node. They are ordered based on the elements in the edge matrix in &ldquo;phylo&rdquo; format.</p>
</td></tr>
<tr><td><code>$tip.mat</code></td>
<td>
<p>the marginal probabilities calculated for each tip. They are ordered based on the order of tip labels in the tree.</p>
</td></tr>
<tr><td><code>$rate.mat</code></td>
<td>
<p>a matrix that details the rates for each state combination. This is used by the plotting function.</p>
</td></tr>
<tr><td><code>$phy</code></td>
<td>
<p>a phylogenetic tree in the &ldquo;phylo&rdquo; format that contains the states with the highest marginal probability at each internal node.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters' effect on speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos. Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='MarginReconGeoSSE'>Ancestral State Estimation based on Marginal Reconstruction for
the GeoSSE and GeoHiSSE models.</h2><span id='topic+MarginReconGeoSSE'></span>

<h3>Description</h3>

<p>Estimates the likeliest states for both internal nodes and tips of a phylogeny using the marginal reconstruction algorithm.</p>


<h3>Usage</h3>

<pre><code class='language-R'>MarginReconGeoSSE(phy, data, f, pars, hidden.states=1, 
assume.cladogenetic=TRUE, condition.on.survival=TRUE, 
root.type="madfitz", root.p=NULL, AIC=NULL, get.tips.only=FALSE,
verbose=TRUE, n.cores=NULL, dt.threads=1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="MarginReconGeoSSE_+3A_phy">phy</code></td>
<td>
<p>a phylogenetic tree, in <code>ape</code> &ldquo;phylo&rdquo; format and with internal nodes labeled denoting the ancestral selective regimes.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE_+3A_data">data</code></td>
<td>
<p>a data matrix containing species information (see Details).</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE_+3A_f">f</code></td>
<td>
<p>vector of length 3 with the estimated proportion of extant species in area 00, 11, and 01 that are included in the phylogeny. A value of c(0.25, 0.5, 0.25) means that 25 percent of species in state 00 and 01 and 50 percent of species in state 11 are included in the phylogeny. By default all species are assumed to be known.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE_+3A_pars">pars</code></td>
<td>
<p>vector containing the MLE of the parameters.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE_+3A_hidden.states">hidden.states</code></td>
<td>
<p>a numeric indicating the number of shifts. The default is <code>1</code> meaning a standard GeoSSE model.</p>
</td></tr> 
<tr><td><code id="MarginReconGeoSSE_+3A_assume.cladogenetic">assume.cladogenetic</code></td>
<td>
<p>a logical indicating whether the model
assumes that changes occurr at the nodes. The default is
<code>TRUE</code>. Setting this to <code>FALSE</code> will result in a different
models from GeoSSE. Please check <code>hisse::GeoHiSSE</code> for more details.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE_+3A_condition.on.survival">condition.on.survival</code></td>
<td>
<p>a logical indicating whether the likelihood should be conditioned on the survival of two lineages and the speciation event subtending them (Nee et al. 1994). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE_+3A_root.type">root.type</code></td>
<td>
<p>indicates whether root prior assumption should based the procedure described by FitzJohn et al. 2009, &ldquo;madfitz&rdquo;, assumed equal, &ldquo;equal&rdquo;, or set to user, &ldquo;user&rdquo;.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE_+3A_root.p">root.p</code></td>
<td>
<p>a vector indicating fixed root state probabilities. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE_+3A_aic">AIC</code></td>
<td>
<p>the AIC for the model being used for the reconstruction. This is used by the plotting function. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE_+3A_get.tips.only">get.tips.only</code></td>
<td>
<p>a logical indicating whether just tip reconstructions should be output. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE_+3A_verbose">verbose</code></td>
<td>
<p>a logical indicating whether progress should be printed to screen. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE_+3A_n.cores">n.cores</code></td>
<td>
<p>specifies the number of independent processors to conduct the analysis.. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE_+3A_dt.threads">dt.threads</code></td>
<td>
<p>sets the number of threads available to data.table. In practice this need not change from the default of 1 thread, as we have not seen any speedup from allowing more threads.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In this implementation the marginal probability of area i for a focal node is simply the overall likelihood of the tree and data when the area of the focal node is fixed in area i. Note that the likeliest tip areas can also be estimated: we observe area 11, but the underlying area could either be area 11A or 11B. Thus, for any given node or tip we traverse the entire tree as many times as there are areas in the model. As the size of the tree grows, however, these repeated tree traversals can slow the calculation down considerably. For this reason, we allow the marginal calculation to be conducted in parallel across any number of independent computer processors.
</p>
<p>For user-specified &ldquo;root.p&rdquo;, you should specify the probability
for each area. If you are doing a hidden model, the number of parameters
will depend on the number of hidden states included. For a two classes
model there are six areas: 00A, 11A, 01A, 00B, 11B, 01B. So if you wanted to
say the root had to be area A, you would specify &ldquo;root.p = c(0.5,
0, 0, 0.5, 0, 0)&rdquo;. The root area is 00, but there is an equal
chance for hidden states A or B.
</p>
<p>See help for &ldquo;GeoHiSSE&rdquo; for more on other parameters for this function.
</p>


<h3>Value</h3>

<p><code>MarginReconGeoSSE</code> returns an object of class <code>geohisse.states</code>. This is a list with elements:
</p>
<table>
<tr><td><code>$node.mat</code></td>
<td>
<p>the marginal probabilities calculated for each node. They are ordered based on the elements in the edge matrix in &ldquo;phylo&rdquo; format.</p>
</td></tr>
<tr><td><code>$tip.mat</code></td>
<td>
<p>the marginal probabilities calculated for each tip. They are ordered based on the order of tip labels in the tree.</p>
</td></tr>
<tr><td><code>$rate.mat</code></td>
<td>
<p>a matrix that details the rates for each state combination. This is used by the plotting function.</p>
</td></tr>
<tr><td><code>$phy</code></td>
<td>
<p>a phylogenetic tree in the &ldquo;phylo&rdquo; format that contains the states with the highest marginal probability at each internal node.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Goldberg, E. E., L. T. Lancaster, and R. H. Ree. 2011. Phylogenetic Inference of Reciprocal Effects between Geographic Range Evolution and Diversification. Syst. Biol. 60:451-465.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters' effect on speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos. Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='MarginReconGeoSSE.old'>Original Ancestral State Estimation based on Marginal Reconstruction for
the GeoSSE and GeoHiSSE models.</h2><span id='topic+MarginReconGeoSSE.old'></span>

<h3>Description</h3>

<p>Estimates the likeliest states for both internal nodes and tips of a phylogeny using the marginal reconstruction algorithm.</p>


<h3>Usage</h3>

<pre><code class='language-R'>MarginReconGeoSSE.old(phy, data, f, pars, hidden.areas=TRUE, 
assume.cladogenetic=TRUE, condition.on.survival=TRUE, 
root.type="madfitz", root.p=NULL, AIC=NULL, verbose=TRUE, 
n.cores=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="MarginReconGeoSSE.old_+3A_phy">phy</code></td>
<td>
<p>a phylogenetic tree, in <code>ape</code> &ldquo;phylo&rdquo; format and with internal nodes labeled denoting the ancestral selective regimes.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE.old_+3A_data">data</code></td>
<td>
<p>a data matrix containing species information (see Details).</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE.old_+3A_f">f</code></td>
<td>
<p>vector of length 2 with the estimated proportion of extant species in state 0 and 1 that are included in the phylogeny. A value of c(0.25, 0.5) means that 25 percent of species in state 0 and 50 percent of species in state 1 are included in the phylogeny. By default all species are assumed to be known.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE.old_+3A_pars">pars</code></td>
<td>
<p>vector containing the MLE of the parameters.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE.old_+3A_hidden.areas">hidden.areas</code></td>
<td>
<p>a logical indicating whether the model includes hidden areas. The default is <code>FALSE</code>.</p>
</td></tr> 
<tr><td><code id="MarginReconGeoSSE.old_+3A_assume.cladogenetic">assume.cladogenetic</code></td>
<td>
<p>a logical indicating whether the model
assumes that changes occurr at the nodes. The default is
<code>TRUE</code>. Setting this to <code>FALSE</code> will result in a different
models from GeoSSE. Please check <code>hisse::GeoHiSSE.old</code> for more details.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE.old_+3A_condition.on.survival">condition.on.survival</code></td>
<td>
<p>a logical indicating whether the likelihood should be conditioned on the survival of two lineages and the speciation event subtending them (Nee et al. 1994). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE.old_+3A_root.type">root.type</code></td>
<td>
<p>indicates whether root prior assumption should based the procedure described by FitzJohn et al. 2009, &ldquo;madfitz&rdquo;, assumed equal, &ldquo;equal&rdquo;, or set to user, &ldquo;user&rdquo;.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE.old_+3A_root.p">root.p</code></td>
<td>
<p>a vector indicating fixed root state probabilities. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE.old_+3A_aic">AIC</code></td>
<td>
<p>the AIC for the model being used for the reconstruction. This is used by the plotting function. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE.old_+3A_verbose">verbose</code></td>
<td>
<p>a logical indicating whether progress should be printed to screen. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MarginReconGeoSSE.old_+3A_n.cores">n.cores</code></td>
<td>
<p>specifies the number of independent processors to conduct the analysis.. The default is <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In this implementation the marginal probability of area i for a focal node is simply the overall likelihood of the tree and data when the area of the focal node is fixed in area i. Note that the likeliest tip areas can also be estimated: we observe area 1, but the underlying area could either be area 1A or 1B. Thus, for any given node or tip we traverse the entire tree as many times as there are areas in the model. As the size of the tree grows, however, these repeated tree traversals can slow the calculation down considerably. For this reason, we allow the marginal calculation to be conducted in parallel across any number of independent computer processors.
</p>
<p>For user-specified &ldquo;root.p&rdquo;, you should specify the probability
for each area. If you are doing a hidden model, the number of parameters
will depend on the number of hidden areas included. For a two classes
model there are six areas: A0, B0, AB0, A1, B1, AB1. So if you wanted to
say the root had to be area A, you would specify &ldquo;root.p = c(0.5,
0, 0, 0.5, 0, 0)&rdquo;. There is 'root area is A and there is an equal
chance for hidden area A0 or A1'.
</p>
<p>See help for &ldquo;GeoHiSSE.old&rdquo; for more on other parameters for this function.
</p>


<h3>Value</h3>

<p><code>MarginReconGeoSSE.old</code> returns an object of class <code>geohisse.states</code>. This is a list with elements:
</p>
<table>
<tr><td><code>$node.mat</code></td>
<td>
<p>the marginal probabilities calculated for each node. They are ordered based on the elements in the edge matrix in &ldquo;phylo&rdquo; format.</p>
</td></tr>
<tr><td><code>$tip.mat</code></td>
<td>
<p>the marginal probabilities calculated for each tip. They are ordered based on the order of tip labels in the tree.</p>
</td></tr>
<tr><td><code>$rate.mat</code></td>
<td>
<p>a matrix that details the rates for each state combination. This is used by the plotting function.</p>
</td></tr>
<tr><td><code>$phy</code></td>
<td>
<p>a phylogenetic tree in the &ldquo;phylo&rdquo; format that contains the states with the highest marginal probability at each internal node.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Goldberg, E. E., L. T. Lancaster, and R. H. Ree. 2011. Phylogenetic Inference of Reciprocal Effects between Geographic Range Evolution and Diversification. Syst. Biol. 60:451-465.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters' effect on speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos. Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='MarginReconHiSSE'>Ancestral State Estimation based on Marginal Reconstruction for
the HiSSE model.</h2><span id='topic+MarginReconHiSSE'></span>

<h3>Description</h3>

<p>Estimates the likeliest states for both internal nodes and tips of a phylogeny using the marginal reconstruction algorithm.</p>


<h3>Usage</h3>

<pre><code class='language-R'>MarginReconHiSSE(phy, data, f, pars, hidden.states=1, 
condition.on.survival=TRUE, root.type="madfitz", root.p=NULL, includes.fossils = FALSE,
k.samples = NULL, AIC=NULL, get.tips.only=FALSE, verbose=TRUE, n.cores=NULL, dt.threads=1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="MarginReconHiSSE_+3A_phy">phy</code></td>
<td>
<p>a phylogenetic tree, in <code>ape</code> &ldquo;phylo&rdquo; format and with internal nodes labeled denoting the ancestral selective regimes.</p>
</td></tr>
<tr><td><code id="MarginReconHiSSE_+3A_data">data</code></td>
<td>
<p>a matrix (or dataframe) with three columns. The first column 
containing the species names and the second and third containing the binary 
character information. Character &quot;0&quot; is on column 2 and chracter &quot;1&quot; is on 
column 3. A value of 0 means character absent and a value of 1 character 
present. The input of data follows a Pagel model. See 'Details'.</p>
</td></tr>
<tr><td><code id="MarginReconHiSSE_+3A_f">f</code></td>
<td>
<p>vector of length 2 with the estimated proportion of extant species in 
state 0 and 1 that are included in the phylogeny. A value of c(0.25, 0.5) means 
that 25 percent of species in state 0 and 50 percent of species in state 1 are 
included in the phylogeny. By default all species are assumed to be sampled.</p>
</td></tr>
<tr><td><code id="MarginReconHiSSE_+3A_pars">pars</code></td>
<td>
<p>vector containing the MLE of the parameters.</p>
</td></tr>
<tr><td><code id="MarginReconHiSSE_+3A_hidden.states">hidden.states</code></td>
<td>
<p>a numeric indicating the number of shifts. The default is <code>1</code> meaning a standard BiSSE model.</p>
</td></tr> 
<tr><td><code id="MarginReconHiSSE_+3A_condition.on.survival">condition.on.survival</code></td>
<td>
<p>a logical indicating whether the likelihood should be conditioned on the survival of two lineages and the speciation event subtending them (Nee et al. 1994). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MarginReconHiSSE_+3A_root.type">root.type</code></td>
<td>
<p>indicates whether root prior assumption should based the procedure described by FitzJohn et al. 2009, &ldquo;madfitz&rdquo;, assumed equal, &ldquo;equal&rdquo;, or set to user, &ldquo;user&rdquo;.</p>
</td></tr>
<tr><td><code id="MarginReconHiSSE_+3A_root.p">root.p</code></td>
<td>
<p>a vector indicating fixed root state probabilities. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MarginReconHiSSE_+3A_includes.fossils">includes.fossils</code></td>
<td>
<p>a logical indicating whether the tree contains fossil taxa. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="MarginReconHiSSE_+3A_k.samples">k.samples</code></td>
<td>
<p>a table of extinct individuals with sampled descendants. See details for how the table must be formatted.</p>
</td></tr>
<tr><td><code id="MarginReconHiSSE_+3A_aic">AIC</code></td>
<td>
<p>the AIC for the model being used for the reconstruction. This is used by the plotting function. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MarginReconHiSSE_+3A_get.tips.only">get.tips.only</code></td>
<td>
<p>a logical indicating whether just tip reconstructions should be output. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="MarginReconHiSSE_+3A_verbose">verbose</code></td>
<td>
<p>a logical indicating whether progress should be printed to screen. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MarginReconHiSSE_+3A_n.cores">n.cores</code></td>
<td>
<p>specifies the number of independent processors to conduct the analysis.. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MarginReconHiSSE_+3A_dt.threads">dt.threads</code></td>
<td>
<p>sets the number of threads available to data.table. In practice this need not change from the default of 1 thread, as we have not seen any speedup from allowing more threads.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is the marginal reconstruction algorithm for the newer, faster version of HiSSE. In this implementation the marginal probability of state i for a focal node is simply the overall likelihood of the tree and data when the state of the focal node is fixed in state i. Note that the likeliest tip states can also be estimated: we observe state 1, but the underlying state could either be state 1A or 1B. Thus, for any given node or tip we traverse the entire tree as many times as there are states in the model. As the size of the tree grows, however, these repeated tree traversals can slow the calculation down considerably. For this reason, we allow the marginal calculation to be conducted in parallel across any number of independent computer processors.
</p>
<p>See help for &ldquo;hisse&rdquo; for more on other parameters for this function.
</p>


<h3>Value</h3>

<p><code>MarginReconHiSSE</code> returns an object of class <code>hisse.states</code>. This is a list with elements:
</p>
<table>
<tr><td><code>$node.mat</code></td>
<td>
<p>the marginal probabilities calculated for each node. They are ordered based on the elements in the edge matrix in &ldquo;phylo&rdquo; format.</p>
</td></tr>
<tr><td><code>$tip.mat</code></td>
<td>
<p>the marginal probabilities calculated for each tip. They are ordered based on the order of tip labels in the tree.</p>
</td></tr>
<tr><td><code>$rate.mat</code></td>
<td>
<p>a matrix that details the rates for each state combination. This is used by the plotting function.</p>
</td></tr>
<tr><td><code>$phy</code></td>
<td>
<p>a phylogenetic tree in the &ldquo;phylo&rdquo; format that contains the states with the highest marginal probability at each internal node.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters' effect on speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos. Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='MarginReconMiSSE'>Ancestral State Estimation based on Marginal Reconstruction for
the MiSSE models.</h2><span id='topic+MarginReconMiSSE'></span>

<h3>Description</h3>

<p>Estimates the likeliest states for both internal nodes and tips of a phylogeny using the marginal reconstruction algorithm.</p>


<h3>Usage</h3>

<pre><code class='language-R'>MarginReconMiSSE(phy, f, pars, hidden.states=1, fixed.eps=NULL,
condition.on.survival=TRUE,  root.type="madfitz", root.p=NULL, includes.fossils=FALSE, 
k.samples=NULL, strat.intervals=NULL, AIC=NULL, get.tips.only=FALSE, verbose=TRUE, 
n.cores=NULL, dt.threads=1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="MarginReconMiSSE_+3A_phy">phy</code></td>
<td>
<p>a phylogenetic tree, in <code>ape</code> &ldquo;phylo&rdquo; format and with internal nodes labeled denoting the ancestral selective regimes.</p>
</td></tr>
<tr><td><code id="MarginReconMiSSE_+3A_f">f</code></td>
<td>
<p>the estimated proportion of extant species included in the phylogeny. A value of 
0.50 means that 50 percent of species are contained in the. By default all species are assumed 
to be sampled.</p>
</td></tr>
<tr><td><code id="MarginReconMiSSE_+3A_pars">pars</code></td>
<td>
<p>vector containing the MLE of the parameters.</p>
</td></tr>
<tr><td><code id="MarginReconMiSSE_+3A_hidden.states">hidden.states</code></td>
<td>
<p>a numeric indicating the number of shifts. The default is <code>1</code> meaning a single birth-death model.</p>
</td></tr> 
<tr><td><code id="MarginReconMiSSE_+3A_fixed.eps">fixed.eps</code></td>
<td>
<p>a value to be used to fix extinction fraction during search. Default is <code>NULL</code> meaning that it is freely estimated.</p>
</td></tr>
<tr><td><code id="MarginReconMiSSE_+3A_condition.on.survival">condition.on.survival</code></td>
<td>
<p>a logical indicating whether the likelihood should be conditioned on the survival of two lineages and the speciation event subtending them (Nee et al. 1994). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MarginReconMiSSE_+3A_root.type">root.type</code></td>
<td>
<p>indicates whether root prior assumption should based the procedure described by FitzJohn et al. 2009, &ldquo;madfitz&rdquo;, assumed equal, &ldquo;equal&rdquo;, or set to user, &ldquo;user&rdquo;.</p>
</td></tr>
<tr><td><code id="MarginReconMiSSE_+3A_root.p">root.p</code></td>
<td>
<p>a vector indicating fixed root state probabilities. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MarginReconMiSSE_+3A_includes.fossils">includes.fossils</code></td>
<td>
<p>a logical indicating whether the tree contains fossil taxa. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="MarginReconMiSSE_+3A_k.samples">k.samples</code></td>
<td>
<p>a table of extinct individuals with sampled descendants. See details for how the table must be formatted.</p>
</td></tr>
<tr><td><code id="MarginReconMiSSE_+3A_strat.intervals">strat.intervals</code></td>
<td>
<p>a table of extinct individuals with sampled descendants. See vignette for how the table must be formatted.</p>
</td></tr>
<tr><td><code id="MarginReconMiSSE_+3A_aic">AIC</code></td>
<td>
<p>the AIC for the model being used for the reconstruction. This is used by the plotting function. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MarginReconMiSSE_+3A_verbose">verbose</code></td>
<td>
<p>a logical indicating whether progress should be printed to screen. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MarginReconMiSSE_+3A_get.tips.only">get.tips.only</code></td>
<td>
<p>a logical indicating whether just tip reconstructions should be output. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="MarginReconMiSSE_+3A_n.cores">n.cores</code></td>
<td>
<p>specifies the number of independent processors to conduct the analysis. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MarginReconMiSSE_+3A_dt.threads">dt.threads</code></td>
<td>
<p>sets the number of threads available to data.table. In practice this need not change from the default of 1 thread, as we have not seen any speedup from allowing more threads.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In this implementation the marginal probability of state combination i for a focal node is simply the overall likelihood of the tree and data when the state of the focal node is fixed in state combination i.
</p>
<p>See help for &ldquo;MiSSE&rdquo; for more on other parameters for this function.
</p>


<h3>Value</h3>

<p><code>MarginReconMiSSE</code> returns an object of class <code>misse.states</code>. This is a list with elements:
</p>
<table>
<tr><td><code>$node.mat</code></td>
<td>
<p>the marginal probabilities calculated for each node. They are ordered based on the elements in the edge matrix in &ldquo;phylo&rdquo; format.</p>
</td></tr>
<tr><td><code>$tip.mat</code></td>
<td>
<p>the marginal probabilities calculated for each tip. They are ordered based on the order of tip labels in the tree.</p>
</td></tr>
<tr><td><code>$rate.mat</code></td>
<td>
<p>a matrix that details the rates for each state combination. This is used by the plotting function.</p>
</td></tr>
<tr><td><code>$phy</code></td>
<td>
<p>a phylogenetic tree in the &ldquo;phylo&rdquo; format that contains the states with the highest marginal probability at each internal node.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating
trait-dependent speciation and extinction rates from incompletely
resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters' effect on speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos. Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='MarginReconMuHiSSE'>Ancestral State Estimation based on Marginal Reconstruction for
the MuSSE and MuHiSSE models.</h2><span id='topic+MarginReconMuHiSSE'></span>

<h3>Description</h3>

<p>Estimates the likeliest states for both internal nodes and tips of a phylogeny using the marginal reconstruction algorithm.</p>


<h3>Usage</h3>

<pre><code class='language-R'>MarginReconMuHiSSE(phy, data, f, pars, hidden.states=1, 
condition.on.survival=TRUE, root.type="madfitz", root.p=NULL, includes.fossils = FALSE,
k.samples = NULL, AIC=NULL, get.tips.only=FALSE, verbose=TRUE, n.cores=NULL, dt.threads=1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="MarginReconMuHiSSE_+3A_phy">phy</code></td>
<td>
<p>a phylogenetic tree, in <code>ape</code> &ldquo;phylo&rdquo; format and with internal nodes labeled denoting the ancestral selective regimes.</p>
</td></tr>
<tr><td><code id="MarginReconMuHiSSE_+3A_data">data</code></td>
<td>
<p>a matrix (or dataframe) with three columns. The first column 
containing the species names and the second and third containing the binary 
character information. Character &quot;0&quot; is on column 2 and chracter &quot;1&quot; is on 
column 3. A value of 0 means character absent and a value of 1 character 
present. The input of data follows a Pagel model. See 'Details'.</p>
</td></tr>
<tr><td><code id="MarginReconMuHiSSE_+3A_f">f</code></td>
<td>
<p>vector of length 4 with the estimated proportion of extant
species in 00, 01, 10, and 11 that are included in the phylogeny. A value of 
c(0.50, 0.25, 0.125, 0.125) means that 50 percent of species in combination '00', 25 
percent in '01' and 12.5 percent in '10' and '11'. By default all species are assumed 
to be sampled.</p>
</td></tr>
<tr><td><code id="MarginReconMuHiSSE_+3A_pars">pars</code></td>
<td>
<p>vector containing the MLE of the parameters.</p>
</td></tr>
<tr><td><code id="MarginReconMuHiSSE_+3A_hidden.states">hidden.states</code></td>
<td>
<p>a numeric indicating the number of shifts. The default is <code>2</code> meaning a standard MuSSE model.</p>
</td></tr> 
<tr><td><code id="MarginReconMuHiSSE_+3A_condition.on.survival">condition.on.survival</code></td>
<td>
<p>a logical indicating whether the likelihood should be conditioned on the survival of two lineages and the speciation event subtending them (Nee et al. 1994). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MarginReconMuHiSSE_+3A_root.type">root.type</code></td>
<td>
<p>indicates whether root prior assumption should based the procedure described by FitzJohn et al. 2009, &ldquo;madfitz&rdquo;, assumed equal, &ldquo;equal&rdquo;, or set to user, &ldquo;user&rdquo;.</p>
</td></tr>
<tr><td><code id="MarginReconMuHiSSE_+3A_root.p">root.p</code></td>
<td>
<p>a vector indicating fixed root state probabilities. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MarginReconMuHiSSE_+3A_includes.fossils">includes.fossils</code></td>
<td>
<p>a logical indicating whether the tree contains fossil taxa. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="MarginReconMuHiSSE_+3A_k.samples">k.samples</code></td>
<td>
<p>a table of extinct individuals with sampled descendants. See details for how the table must be formatted.</p>
</td></tr>
<tr><td><code id="MarginReconMuHiSSE_+3A_aic">AIC</code></td>
<td>
<p>the AIC for the model being used for the reconstruction. This is used by the plotting function. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MarginReconMuHiSSE_+3A_get.tips.only">get.tips.only</code></td>
<td>
<p>a logical indicating whether just tip reconstructions should be output. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="MarginReconMuHiSSE_+3A_verbose">verbose</code></td>
<td>
<p>a logical indicating whether progress should be printed to screen. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MarginReconMuHiSSE_+3A_n.cores">n.cores</code></td>
<td>
<p>specifies the number of independent processors to conduct the analysis.. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MarginReconMuHiSSE_+3A_dt.threads">dt.threads</code></td>
<td>
<p>sets the number of threads available to data.table. In practice this need not change from the default of 1 thread, as we have not seen any speedup from allowing more threads.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In this implementation the marginal probability of state combination i for a focal node is simply the overall likelihood of the tree and data when the state of the focal node is fixed in state combination i. Note that the likeliest tip states can also be estimated: we observe state 00, but the underlying state could either be 00A or 00B. Thus, for any given node or tip we traverse the entire tree as many times as there are states in the model. As the size of the tree grows, however, these repeated tree traversals can slow the calculation down considerably. For this reason, we allow the marginal calculation to be conducted in parallel across any number of independent computer processors.
</p>
<p>For user-specified &ldquo;root.p&rdquo;, you should specify the probability
for each state combination. If you are doing a hidden model, the number of parameters
will depend on the number of hidden states included. For a two classes
model there are eight states: 00A, 01A, 10A, 11A, 00B, 01B, 10B, and 11B. So if you wanted to
say the root had to be in state 00, you would specify &ldquo;root.p = c(0.5,
0, 0, 0, 0.5, 0, 0, 0, 0)&rdquo;. There is 50 percent chance the root state is 00 and there is an equal
chance for hidden state A or B.
</p>
<p>See help for &ldquo;MuHiSSE&rdquo; for more on other parameters for this function.
</p>


<h3>Value</h3>

<p><code>MarginRecon</code> returns an object of class <code>muhisse.states</code>. This is a list with elements:
</p>
<table>
<tr><td><code>$node.mat</code></td>
<td>
<p>the marginal probabilities calculated for each node. They are ordered based on the elements in the edge matrix in &ldquo;phylo&rdquo; format.</p>
</td></tr>
<tr><td><code>$tip.mat</code></td>
<td>
<p>the marginal probabilities calculated for each tip. They are ordered based on the order of tip labels in the tree.</p>
</td></tr>
<tr><td><code>$rate.mat</code></td>
<td>
<p>a matrix that details the rates for each state combination. This is used by the plotting function.</p>
</td></tr>
<tr><td><code>$phy</code></td>
<td>
<p>a phylogenetic tree in the &ldquo;phylo&rdquo; format that contains the states with the highest marginal probability at each internal node.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters' effect on speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nakov, T., Beaulieu, J.M., and Alverson, A.J. 2019. Diatoms diversify and turn over faster in freshwater than marine environments. Evolution, doi: https://doi.org/10.1111/evo.13832.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos. Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='MiSSE'>Character-free State Speciation and Extinction</h2><span id='topic+MiSSE'></span>

<h3>Description</h3>

<p>Sets up and executes a MiSSE model (Missing State Speciation
and Extinction) on a phylogeny.</p>


<h3>Usage</h3>

<pre><code class='language-R'>MiSSE(phy, f=1, turnover=c(1,2), eps=c(1,2), fixed.eps=NULL, condition.on.survival=TRUE,
root.type="madfitz", root.p=NULL, includes.fossils=FALSE, k.samples=NULL, 
strat.intervals=NULL, sann=TRUE, sann.its=5000, sann.temp=5230, sann.seed=-100377, 
bounded.search=TRUE, max.tol=.Machine$double.eps^.50, starting.vals=NULL, 
turnover.upper=10000, eps.upper=3, trans.upper=100, restart.obj=NULL, ode.eps=0, 
dt.threads=1, expand.mode=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="MiSSE_+3A_phy">phy</code></td>
<td>
<p>a phylogenetic tree, in <code>ape</code> &ldquo;phylo&rdquo; format. If <code>includes.fossils=TRUE</code> then the input phy object must include extinct tips.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_f">f</code></td>
<td>
<p>the estimated proportion of extant species included in the phylogeny. A value of
0.50 means that 50 percent of species are contained in the. By default all species are assumed
to be sampled.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_turnover">turnover</code></td>
<td>
<p>a numeric vector of length equal to the number of suspected rates
in turnover. See 'Details'.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_eps">eps</code></td>
<td>
<p>a numeric vector of length equal to the number of suspected rates
in extinction fraction. See 'Details'.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_fixed.eps">fixed.eps</code></td>
<td>
<p>a value to be used to fix extinction fraction during search. Default is <code>NULL</code> meaning that it is freely estimated.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_condition.on.survival">condition.on.survival</code></td>
<td>
<p>a logical indicating whether the likelihood
should be conditioned on the survival of two lineages and the
speciation event subtending them (Nee et al. 1994). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_root.type">root.type</code></td>
<td>
<p>indicates whether root summarization follow the procedure described by FitzJohn et al. 2009, &ldquo;madfitz&rdquo; or Herrera-Alsina et al. 2018, &ldquo;herr_als&rdquo;.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_root.p">root.p</code></td>
<td>
<p>a vector indicating fixed root state probabilities. The
default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_includes.fossils">includes.fossils</code></td>
<td>
<p>a logical indicating whether the tree contains fossil taxa. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_k.samples">k.samples</code></td>
<td>
<p>a table of extinct individuals with sampled descendants. See vignette for how the table must be formatted.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_strat.intervals">strat.intervals</code></td>
<td>
<p>a table of extinct individuals with sampled descendants. See vignette for how the table must be formatted.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_sann">sann</code></td>
<td>
<p>a logical indicating whether a two-step optimization
procedure is to be used. The first includes a simulate annealing
approach, with the second involving a refinement using
<code>subplex</code>. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_sann.its">sann.its</code></td>
<td>
<p>a numeric indicating the number of times the simulated
annealing algorithm should call the objective function.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_sann.temp">sann.temp</code></td>
<td>
<p>the starting temperature for the simulated annealing. Higher temperatures results in the chain sampling a much wider space initially. The default of 5320 is based on the default of the GenSA package. For larger trees setting this value higher in conjunction with more sann.its can drastically improve performance.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_sann.seed">sann.seed</code></td>
<td>
<p>the seed number for the simulated annealing algorithm. This value must be negative and an odd number.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_bounded.search">bounded.search</code></td>
<td>
<p>a logical indicating whether or not bounds should
be enforced during optimization. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_max.tol">max.tol</code></td>
<td>
<p>supplies the relative optimization tolerance to
<code>subplex</code>.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_starting.vals">starting.vals</code></td>
<td>
<p>a numeric vector of length 3 with starting values for the
model. Position [1] sets turnover, [2] sets extinction fraction, and
[3] transition rates between distinct diversification rates.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_turnover.upper">turnover.upper</code></td>
<td>
<p>sets the upper bound for the turnover parameters.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_eps.upper">eps.upper</code></td>
<td>
<p>sets the upper bound for the eps parameters.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_trans.upper">trans.upper</code></td>
<td>
<p>sets the upper bound for the transition rate parameters.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_restart.obj">restart.obj</code></td>
<td>
<p>an object of class  that contains everything to restart an optimization.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_ode.eps">ode.eps</code></td>
<td>
<p>sets the tolerance for the integration at the end of a
branch. Essentially if the sum of compD is less than this tolerance,
then it assumes the results are unstable and discards them. The
default is set to zero, but in testing a value of 1e-8 can sometimes
produce stable solutions for both easy and very difficult optimization problems.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_dt.threads">dt.threads</code></td>
<td>
<p>sets the number of threads available to data.table. In practice this need not change from the default of 1 thread, as we have not seen any speedup from allowing more threads.</p>
</td></tr>
<tr><td><code id="MiSSE_+3A_expand.mode">expand.mode</code></td>
<td>
<p>allows passing in the number of free parameters for turnover and eps and creates vectors to permit this.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>One thing pointed out in the original HiSSE paper (Beaulieu &amp; O'Meara, 2016) is
that the trait-independent hisse model is basically a model for traits and a separate
model for shifts in diversification parameters, much like BAMM (though without priors,
discontinuous inheritance of extinction probability, or other mathematical foibles).
The hidden states can drive different diversification processes, and the traits just
evolve in a regular trait model. At that point, there is no harm in just dropping the
trait (or analyzing separately) and just focusing on diversification driven by unknown
factors. That is what this function does. It sets up and executes a completely trait-free
version of a HiSSE model.
</p>
<p>Thus, all that is required is a tree. The model allows up to 26 possible hidden states in
diversification (denoted by A-Z). Transitions among hidden states are governed by a global
transition rate, q. A &quot;shift&quot; in diversification denotes a lineage tracking some
unobserved, hidden state. An interesting byproduct of this assumption is that distantly
related clades can actually share the same discrete set of diversification parameters.
</p>
<p>Note that &quot;hidden state&quot; is a shorthand. We do not mean that there is a single, discrete
character that is solely driving diversification differences. There is some heritable
&quot;thing&quot; that affects rates: but this could be a combination of body size, oxygen
concentration, trophic level, and how many other species are competing in an area.
This is true for HiSSE, but is especially important to grasp for MiSSE. It could
be that there is some single discrete trait that drives everything; it's more likely
that a whole range of factors play a role, and we just slice them up into discrete
categories, the same way we slice up mammals into carnivore / omnivore / herbivore
or plants into woody / herbaceous when the reality is more continuous.
</p>
<p>As with <code>hisse</code>, we employ a modified optimization procedure. In other words, rather
than optimizing birth and death separately, <code>MiSSE</code> optimizes orthogonal
transformations of these variables: we let tau = birth+death define &quot;net turnover&quot;, and
we let eps = death/birth define the &ldquo;extinction fraction&rdquo;. This reparameterization
alleviates problems associated with overfitting when birth and death are highly
correlated, but both matter in explaining the diversity pattern.
</p>
<p>For the &ldquo;root.type&rdquo; option, we are currently maintaining the previous default of
&ldquo;madfitz&rdquo;. However, it was recently pointed out by Herrera-Alsina et al. (2018)
that at the root, the individual likelihoods for each possible state should be conditioned
prior to averaging the individual likelihoods across states. This can be set doing
&ldquo;herr_als&rdquo;. It is unclear to us which is exactly correct, but it does seem that
both &ldquo;madfitz&rdquo; and &ldquo;herr_als&rdquo; behave exactly as they should in the case of
character-independent diversification (i.e., reduces to likelihood of tree + likelihood of
trait model). We've also tested the behavior and the likelihood differences are very
subtle and the parameter estimates in simulation are nearly indistinguishable from the
&ldquo;madfitz&rdquo; conditioning scheme. We provide both options and encourage users to try
both and let us know conditions in which the result vary dramatically under the two root
implementations. We suspect they do not.
</p>
<p>Also, note, that in the case of &ldquo;root.type=user&rdquo; and &ldquo;root.type=equal&rdquo; are
no longer explicit &ldquo;root.type&rdquo; options. Instead, either &ldquo;madfitz&rdquo; or
&ldquo;herr_als&rdquo; are specified and the &ldquo;root.p&rdquo; can be set to allow for custom
root options.
</p>


<h3>Value</h3>

<p><code>MiSSE</code> returns an object of class <code>misse.fit</code>. This is a list with
elements:
</p>
<table>
<tr><td><code>$loglik</code></td>
<td>
<p>the maximum negative log-likelihood.</p>
</td></tr>
<tr><td><code>$AIC</code></td>
<td>
<p>Akaike information criterion.</p>
</td></tr>
<tr><td><code>$AICc</code></td>
<td>
<p>Akaike information criterion corrected for sample-size.</p>
</td></tr>
<tr><td><code>$solution</code></td>
<td>
<p>a matrix containing the maximum likelihood estimates of the model
parameters.</p>
</td></tr>
<tr><td><code>$index.par</code></td>
<td>
<p>an index matrix of the parameters being estimated.</p>
</td></tr>
<tr><td><code>$f</code></td>
<td>
<p>user-supplied sampling frequencies.</p>
</td></tr>
<tr><td><code>$hidden.states</code></td>
<td>
<p>a logical indicating whether hidden states were included in the
model.</p>
</td></tr>
<tr><td><code>$condition.on.surivival</code></td>
<td>
<p>a logical indicating whether the
likelihood was conditioned on the survival of two lineages and the speciation event
subtending them.</p>
</td></tr>
<tr><td><code>$root.type</code></td>
<td>
<p>indicates the user-specified root prior assumption.</p>
</td></tr>
<tr><td><code>$root.p</code></td>
<td>
<p>indicates whether the user-specified fixed root probabilities.</p>
</td></tr>
<tr><td><code>$phy</code></td>
<td>
<p>user-supplied tree</p>
</td></tr>
<tr><td><code>$max.tol</code></td>
<td>
<p>relative optimization tolerance.</p>
</td></tr>
<tr><td><code>$starting.vals</code></td>
<td>
<p>The starting values for the optimization.</p>
</td></tr>
<tr><td><code>$upper.bounds</code></td>
<td>
<p>the vector of upper limits to the optimization search.</p>
</td></tr>
<tr><td><code>$lower.bounds</code></td>
<td>
<p>the vector of lower limits to the optimization
search.</p>
</td></tr>
<tr><td><code>$ode.eps</code></td>
<td>
<p>The ode.eps value used for the estimation.</p>
</td></tr>
<tr><td><code>$turnover</code></td>
<td>
<p>The turnover vector used.</p>
</td></tr>
<tr><td><code>$eps</code></td>
<td>
<p>The eps vector used.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models
of trait-dependent speciation and extinction. Syst. Biol. 65:583-601.
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation
and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Herrera-Alsina, L., P. van Els, and R.S. Etienne. 2018. Detecting the dependence of diversification on multiples traits from phylogenetic trees and trait data. Systematic Biology, 68:317-328.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters effect on
speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos.
Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='MiSSEGreedy'>Character-free State Speciation and Extinction Searching Greedily</h2><span id='topic+MiSSEGreedy'></span>

<h3>Description</h3>

<p>Executes a set of MiSSE models (Missing State Speciation
and Extinction) on a phylogeny, varying the number of parameters for turnover and extinction fraction and stopping when models stop being very good.</p>


<h3>Usage</h3>

<pre><code class='language-R'>MiSSEGreedy(phy, f=1, possible.combos = 
generateMiSSEGreedyCombinations(shuffle.start=TRUE), stop.deltaAICc=10, save.file=NULL, 
n.cores=NULL, chunk.size=10, check.fits=FALSE, remove.bad=FALSE, n.tries=2, 
condition.on.survival=TRUE, root.type="madfitz", root.p=NULL, includes.fossils=FALSE, 
k.samples=NULL, strat.intervals=NULL, sann=TRUE, sann.its=5000, sann.temp=5230, 
sann.seed=-100377,bounded.search=TRUE, max.tol=.Machine$double.eps^.50, 
starting.vals=NULL, turnover.upper=10000, eps.upper=3, trans.upper=100, restart.obj=NULL, 
ode.eps=0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="MiSSEGreedy_+3A_phy">phy</code></td>
<td>
<p>a phylogenetic tree, in <code>ape</code> &ldquo;phylo&rdquo; format. If <code>includes.fossils=TRUE</code> then the input phy object must include extinct tips.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_f">f</code></td>
<td>
<p>the estimated proportion of extant species included in the phylogeny. A value of
0.50 means that 50 percent of species are contained in the. By default all species are assumed
to be sampled.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_possible.combos">possible.combos</code></td>
<td>
<p>data.frame of parameter combinations to try. See 'Details'.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_stop.deltaaicc">stop.deltaAICc</code></td>
<td>
<p>how bad compared to the best does a model have to be to far enough outside we stop looking at even more complex ones?</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_save.file">save.file</code></td>
<td>
<p>file to use to save results while the code is running</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_n.cores">n.cores</code></td>
<td>
<p>how many cores to run this on in parallel</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_chunk.size">chunk.size</code></td>
<td>
<p>how many models to run before checking to make sure there are no improvements. See 'Details'.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_check.fits">check.fits</code></td>
<td>
<p>a logical indicating whether a secondary check to ensure optimization performed well. See <code>FindAndRerun</code></p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_remove.bad">remove.bad</code></td>
<td>
<p>a logical indicating whether bad models identified as poorly fit should be removed. Only invoked when <code>FindAndRerun=TRUE</code>.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_n.tries">n.tries</code></td>
<td>
<p>maximum number of retries for a given model when <code>check.fits=TRUE</code>.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_condition.on.survival">condition.on.survival</code></td>
<td>
<p>a logical indicating whether the likelihood
should be conditioned on the survival of two lineages and the
speciation event subtending them (Nee et al. 1994). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_root.type">root.type</code></td>
<td>
<p>indicates whether root summarization follow the procedure described by FitzJohn et al. 2009, &ldquo;madfitz&rdquo; or Herrera-Alsina et al. 2018, &ldquo;herr_als&rdquo;.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_root.p">root.p</code></td>
<td>
<p>a vector indicating fixed root state probabilities. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_includes.fossils">includes.fossils</code></td>
<td>
<p>a logical indicating whether the tree contains fossil taxa. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_k.samples">k.samples</code></td>
<td>
<p>a table of extinct individuals with sampled descendants. See vignette for how the table must be formatted.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_strat.intervals">strat.intervals</code></td>
<td>
<p>a table of extinct individuals with sampled descendants. See vignette for how the table must be formatted.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_sann">sann</code></td>
<td>
<p>a logical indicating whether a two-step optimization
procedure is to be used. The first includes a simulate annealing
approach, with the second involving a refinement using
<code>subplex</code>. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_sann.its">sann.its</code></td>
<td>
<p>a numeric indicating the number of times the simulated
annealing algorithm should call the objective function.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_sann.temp">sann.temp</code></td>
<td>
<p>the starting temperature for the simulated annealing. Higher temperatures results in the chain sampling a much wider space initially. The default of 5320 is based on the default of the GenSA package. For larger trees setting this value higher in conjunction with more sann.its can drastically improve performance.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_sann.seed">sann.seed</code></td>
<td>
<p>the seed number for the simulated annealing algorithm. This value must be negative and an odd number.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_bounded.search">bounded.search</code></td>
<td>
<p>a logical indicating whether or not bounds should
be enforced during optimization. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_max.tol">max.tol</code></td>
<td>
<p>supplies the relative optimization tolerance to
<code>subplex</code>.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_starting.vals">starting.vals</code></td>
<td>
<p>a numeric vector of length 3 with starting values for the
model. Position [1] sets turnover, [2] sets extinction fraction, and
[3] transition rates between distinct diversification rates.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_turnover.upper">turnover.upper</code></td>
<td>
<p>sets the upper bound for the turnover parameters.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_eps.upper">eps.upper</code></td>
<td>
<p>sets the upper bound for the eps parameters.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_trans.upper">trans.upper</code></td>
<td>
<p>sets the upper bound for the transition rate parameters.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_restart.obj">restart.obj</code></td>
<td>
<p>an object of class  that contains everything to restart an optimization.</p>
</td></tr>
<tr><td><code id="MiSSEGreedy_+3A_ode.eps">ode.eps</code></td>
<td>
<p>sets the tolerance for the integration at the end of a
branch. Essentially if the sum of compD is less than this tolerance,
then it assumes the results are unstable and discards them. The
default is set to zero, but in testing a value of 1e-8 can sometimes
produce stable solutions for both easy and very difficult optimization problems.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See the <code>MiSSE</code> function for description of the method overall. It requires a set number of hidden state categories, but finding the best number of categories can be hard. For example, one could 1 to 26 different turnover categories and 1 to 26 possible extinction fraction categories. For most cases, we suspect that it makes sense to have the number of extinction fraction categories either equal to the number of turnover categories or set to the same category over the tree, but there are actually a lot of possibilities: have turnover=c(1,2,3) and eps=c(1,2,1), for example, or turnover=c(1,1,1) and eps=c(1,2,3). This uses the generateMiSSEGreedyCombinations function to generate a very large set of these possible models, then runs them in increasing complexity. By default, it stops when the models stop getting being reasonable in AICc. This is NOT where the models stop being significant (if you're looking for significance, note you don't get that from AICc), but where they probably will not contribute much to the model averaged parameter estimates and so may not be worth the bother of searching further. However, there's no guarantee that this is a wise decision: you could stop with 10 turnover rates, and 11 and 12 are far worse for AICc, but it could be that 13 turnover rates are much better than anything else (for that matter, the best number of turnover rates could be 42, even though MiSSe's current code can only go up to 26). And of course, in reality, the truth is that there is an infinite set of hidden rate parameters: a passing cloud blocks a tiny bit of energy for photosynthesis, so for that moment the rate of extinction for plants underneath the shadow is a tiny bit higher. You should not be using this to test hypotheses about how many hidden factors there are, but rather as a way to get a good enough model to estimate rates on a tree.
</p>
<p>You can change how quickly the function stops trying new models with stop.deltaAICc. Once it runs a chunk of models where the best gets a model that is at least stop.deltaAICc worse than the *current* best model, it stops running new models. Since this is based on current best AICc, and we start with simple models, there's an asymmetry: a terrible model with no rate variation is always included, but a slightly less terrible model with 26 turnover rates might never be run.
</p>
<p>This works MUCH faster when run in parallel. To do so, set n.cores to the number of available cores on your machine (for example, for a modern Mac laptop, this would be 4). An easy way to do this automatically is to use n.cores=parallel::detectCores(). The default is one core; if running this function on a cluster, a default of parallel::detectCores() might take over an entire compute node when you're supposed to be using just one core, and get you in trouble. Since we run many models, the most natural approach is to run one model per core, see if at least one of the models are still ok, then send out the next models out to all the cores. Setting n.cores to the number of parallel jobs you want, and setting chunk.size to NULL, will do this. However, this is slightly inefficient &ndash; the odds are that some cores will finish earlier than others, and will be waiting until all finish. So a different approach is to set a chunk.size greater than n.cores &ndash; it will still use no more than n.cores at a time, but once one model in the set finishes it will send off the next until all models in the chunk are run. This keeps the computer even busier, but then it won't stop to check to make sure the models are still feasible as often, and it only saves intermediate results after each chunk of models finishes. Our recommendation is to use n.cores=parallel::detectCores() if you're on a machine where you can use all the cores. By default, we set chunk.size=10 so it looks at ten models before deciding none of them have a good enough AICc to keep looking at all models. If chunk.size is smaller, say, 2, it will look at only two models and if neither is within stop.deltaAICc of the best model, it will stop looking at the next chunk of models.
</p>
<p>After every chunk of models are done, this function will display the status: what models have been run, what the likelihoods and AICs are, etc. It will also predict how long future runs will check (based on a linear regression between the number of free parameters and log(minutes to run)). These are just estimates based on the runs so far, but it's a stochastic search and can take more or less time.
</p>
<p>Saving output while this goes is highly recommended &ndash; you can see how things are going and salvage something if a run fails (then, start again, deleting the models that worked from possible.combos and USING A DIFFERENT FILE TO SAVE TO SO YOU DON'T OVERWRITE THE OLD ONE. You can so this by giving a file name (including path, if you want) as the save.file argument. This will save the list of finished models (misse.list) and the possible.combos data.frame with additional information.
</p>


<h3>Value</h3>

<p><code>MiSSEGreedy</code> returns a list of class <code>misse.fit</code> objects.
</p>


<h3>Author(s)</h3>

<p>Brian C. O'Meara</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models
of trait-dependent speciation and extinction. Syst. Biol. 65:583-601.
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation
and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Herrera-Alsina, L., P. van Els, and R.S. Etienne. 2018. Detecting the dependence of diversification on multiples traits from phylogenetic trees and trait data. Systematic Biology, 68:317-328.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters effect on
speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos.
Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='MiSSENet'>A function for catching bad model fits from MiSSEGreedy</h2><span id='topic+MiSSENet'></span>

<h3>Description</h3>

<p>A function for assessing whether models optimized well, identifying bad fits, and rerunning them if needed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MiSSENet(misse.list, n.tries=2, remove.bad=TRUE, dont.rerun=FALSE, save.file=NULL, 
n.cores=1, sann=TRUE, sann.its=5000, sann.temp=5230, bounded.search=TRUE, 
starting.vals=NULL, turnover.upper=10000, eps.upper=3, trans.upper=100, restart.obj=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="MiSSENet_+3A_misse.list">misse.list</code></td>
<td>
<p>a <code>misse</code> list of model fits obtain from <code>MiSSEGreedy</code>.</p>
</td></tr>
<tr><td><code id="MiSSENet_+3A_n.tries">n.tries</code></td>
<td>
<p>maximum number of retries for a given model.</p>
</td></tr>
<tr><td><code id="MiSSENet_+3A_remove.bad">remove.bad</code></td>
<td>
<p>a logical indicating whether models identified as poorly optimized (even after attempting to be refit) should be removed from <code>misse.list</code>.</p>
</td></tr>
<tr><td><code id="MiSSENet_+3A_dont.rerun">dont.rerun</code></td>
<td>
<p>a logical indicating whether models identified as poorly optimized should be run. The default is <code>FALSE</code>, meaning they will be rerun. Note that if <code>dont.rerun=TRUE</code> and <code>remove.bad=TRUE</code>, the bad models will be removed from the input list; when <code>remove.bad=FALSE</code> only a vector of model numbers are provided.</p>
</td></tr>
<tr><td><code id="MiSSENet_+3A_save.file">save.file</code></td>
<td>
<p>file to use to save the full model fits before removing the poorly optimized ones.</p>
</td></tr>
<tr><td><code id="MiSSENet_+3A_n.cores">n.cores</code></td>
<td>
<p>how many cores to run this on in parallel.</p>
</td></tr>
<tr><td><code id="MiSSENet_+3A_sann">sann</code></td>
<td>
<p>a logical indicating whether a two-step optimization
procedure is to be used. The first includes a simulate annealing
approach, with the second involving a refinement using
<code>subplex</code>. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="MiSSENet_+3A_sann.its">sann.its</code></td>
<td>
<p>a numeric indicating the number of times the simulated
annealing algorithm should call the objective function.</p>
</td></tr>
<tr><td><code id="MiSSENet_+3A_sann.temp">sann.temp</code></td>
<td>
<p>the starting temperature for the simulated annealing. Higher temperatures results in the chain sampling a much wider space initially. The default of 5320 is based on the default of the GenSA package. For larger trees setting this value higher in conjunction with more sann.its can drastically improve performance.</p>
</td></tr>
<tr><td><code id="MiSSENet_+3A_bounded.search">bounded.search</code></td>
<td>
<p>a logical indicating whether or not bounds should
be enforced during optimization. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MiSSENet_+3A_starting.vals">starting.vals</code></td>
<td>
<p>a numeric vector of length 3 with starting values for the
model. Position [1] sets turnover, [2] sets extinction fraction, and
[3] transition rates between distinct diversification rates.</p>
</td></tr>
<tr><td><code id="MiSSENet_+3A_turnover.upper">turnover.upper</code></td>
<td>
<p>sets the upper bound for the turnover parameters.</p>
</td></tr>
<tr><td><code id="MiSSENet_+3A_eps.upper">eps.upper</code></td>
<td>
<p>sets the upper bound for the eps parameters.</p>
</td></tr>
<tr><td><code id="MiSSENet_+3A_trans.upper">trans.upper</code></td>
<td>
<p>sets the upper bound for the transition rate parameters.</p>
</td></tr>
<tr><td><code id="MiSSENet_+3A_restart.obj">restart.obj</code></td>
<td>
<p>an object of class  that contains everything to restart an optimization.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is used to triage poorly optimized models after a <code>MiSSEGreedy</code> run. 
It is normally invoked within <code>MiSSEGreedy</code>, but it can also be used as a standalone function, 
to simply identify poorly identify models and/or rerun them.
</p>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Vascancelos, T, B.C. O'Meara, and J.M. Beaulieu. In prep.
</p>

<hr>
<h2 id='Model+20averaged+20rates'>Model average rates at tips and nodes</h2><span id='topic+GetModelAveRates'></span>

<h3>Description</h3>

<p>Summarizes reconstructions from a single model or a set of models and returns model averaged rates.</p>


<h3>Usage</h3>

<pre><code class='language-R'>GetModelAveRates(x, AIC.weights=NULL, type=c("tips", "nodes", "both"),
bound.par.matrix=cbind(c(0,-1000,0,0,0),c(1000,1000,1000,3,1000)) )
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Model+2B20averaged+2B20rates_+3A_x">x</code></td>
<td>
<p>a <code>hisse.states</code> object, a <code>hisse.states.geosse</code>
object, a <code>muhisse.states</code> or a list of such objects. A 
list of model can only include models of one type.</p>
</td></tr>
<tr><td><code id="Model+2B20averaged+2B20rates_+3A_aic.weights">AIC.weights</code></td>
<td>
<p>a numeric vector with length equal to the number of
models in the list 'x'. This is the AICw for each of the models to be
averaged. If 'AIC.weights==NULL' (the default value) then function
will compute the AICw for the models in the set from the $AIC value
for each model.</p>
</td></tr>
<tr><td><code id="Model+2B20averaged+2B20rates_+3A_type">type</code></td>
<td>
<p>one of &quot;tips&quot;, &quot;nodes&quot;, or &quot;both&quot; (the default). This
controls whether only the averaged rates for the tips, nodes or both
should be returned. If tips or nodes is chosen the output will be a
matrix and if both are returned the output will be a list.</p>
</td></tr>
<tr><td><code id="Model+2B20averaged+2B20rates_+3A_bound.par.matrix">bound.par.matrix</code></td>
<td>
<p>A numeric matrix with exactly 5 rows and 2
columns to set the limits for the model parameters. First column is
the minimum value and second column is the maximum value (both
inclusive). The rows are the model parameter in this fixed order:
turnover, net diversification, speciation, extinction fraction, and
extinction.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Provides a data frame model-averaged rates for all possible configurations of the model parameters (i.e., turnover, net.div, speciation, extinction, or extinction.fraction), either for all tips or for all nodes.
As with the plotting function, if you give a single hisse.state object,
it uses that, and the rates account for uncertainty in the marginal
probabilities of the states; if you give it a list of them, it will
model-average the results (it assumes the trees are the same) in
addition to accounting for uncertainty in the marginal probabilities at
tips and nodes.
If 'AIC.weights==NULL', then the models in the set do not require the
'$AIC' element to compute the AICw. Otherwise the function will return
an error message.
</p>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>

<hr>
<h2 id='MuHiSSE'>Multicharacter Hidden State Speciation and Extinction</h2><span id='topic+MuHiSSE'></span>

<h3>Description</h3>

<p>Sets up and executes a MuHiSSE model (Multicharacter Hidden State Speciation
and Extinction) on a phylogeny and character distribution.</p>


<h3>Usage</h3>

<pre><code class='language-R'>MuHiSSE(phy, data, f=c(1,1,1,1), turnover=c(1,2,3,4), eps=c(1,2,3,4), 
hidden.states=FALSE, trans.rate=NULL, condition.on.survival=TRUE, 
root.type="madfitz", root.p=NULL, includes.fossils=FALSE, k.samples=NULL, sann=TRUE, 
sann.its=1000, bounded.search=TRUE, max.tol=.Machine$double.eps^.50, starting.vals=NULL, 
turnover.upper=10000, eps.upper=3, trans.upper=100, restart.obj=NULL, ode.eps=0, 
dt.threads=1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="MuHiSSE_+3A_phy">phy</code></td>
<td>
<p>a phylogenetic tree, in <code>ape</code> &ldquo;phylo&rdquo; format.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_data">data</code></td>
<td>
<p>a matrix (or dataframe) with three columns. The first column 
containing the species names and the second and third containing the binary 
character information. Character &quot;0&quot; is on column 2 and chracter &quot;1&quot; is on 
column 3. A value of 0 means character absent and a value of 1 character 
present. The input of data follows a Pagel model. See 'Details'.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_f">f</code></td>
<td>
<p>vector of length 4 with the estimated proportion of extant
species in 00, 01, 10, and 11 that are included in the phylogeny. A value of 
c(0.50, 0.25, 0.125, 0.125) means that 50 percent of species in combination '00', 25 
percent in '01' and 12.5 percent in '10' and '11'. By default all species are assumed 
to be sampled.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_turnover">turnover</code></td>
<td>
<p>a numeric vector of length equal to 4+(number of
<code>hidden.states</code> * 4). A MuSSE model has 4 speciation parameters:
lambda00, lambda01, lambda10, and lambda11. A MuHiSSE model with 
one hidden states has 8 speciation parameters: lambda0A, s1A, s01A, s0B, s1B, s01B. 
And so on. The length of the numeric vector needs to match the number of speciation 
parameters in the model. See 'Details'.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_eps">eps</code></td>
<td>
<p>a numeric vector of length equal to4+(number of
<code>hidden.states</code> * 4). A MuSSE model has 4 extinction parameters:
mu00, mu01, mu10, and mu11. A MuHiSSE model with one hidden state has 8 extinction 
parameters: mu00A, mu01A, mu10A, mu11A, mu00B, mu01B, mu10B, and mu11B. And so on. The 
length of the numeric vector needs to match the number of extinction parameters in the 
model. See 'Details'.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_hidden.states">hidden.states</code></td>
<td>
<p>a logical indicating whether the model includes a
hidden states. The default is <code>FALSE</code>.</p>
</td></tr> 
<tr><td><code id="MuHiSSE_+3A_trans.rate">trans.rate</code></td>
<td>
<p>provides the transition rate model. See function
<code>TransMatMakerMuHiSSE</code>.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_condition.on.survival">condition.on.survival</code></td>
<td>
<p>a logical indicating whether the likelihood
should be conditioned on the survival of two lineages and the
speciation event subtending them (Nee et al. 1994). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_root.type">root.type</code></td>
<td>
<p>indicates whether root summarization follow the procedure described by FitzJohn et al. 2009, &ldquo;madfitz&rdquo; or Herrera-Alsina et al. 2018, &ldquo;herr_als&rdquo;.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_root.p">root.p</code></td>
<td>
<p>a vector indicating fixed root state probabilities. The
default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_includes.fossils">includes.fossils</code></td>
<td>
<p>a logical indicating whether the tree contains fossil taxa. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_k.samples">k.samples</code></td>
<td>
<p>a table of extinct individuals with sampled descendants. See details for how the table must be formatted.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_sann">sann</code></td>
<td>
<p>a logical indicating whether a two-step optimization
procedure is to be used. The first includes a simulate annealing
approach, with the second involving a refinement using
<code>subplex</code>. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_sann.its">sann.its</code></td>
<td>
<p>a numeric indicating the number of times the simulated
annealing algorithm should call the objective function.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_bounded.search">bounded.search</code></td>
<td>
<p>a logical indicating whether or not bounds should
be enforced during optimization. The default is is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_max.tol">max.tol</code></td>
<td>
<p>supplies the relative optimization tolerance to
<code>subplex</code>.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_starting.vals">starting.vals</code></td>
<td>
<p>a numeric vector of length 3 with starting values for the
model for all areas and hidden states. Position [1] sets turnover, [2]
sets extinction fraction, and [3] transition rates.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_turnover.upper">turnover.upper</code></td>
<td>
<p>sets the upper bound for the turnover parameters.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_eps.upper">eps.upper</code></td>
<td>
<p>sets the upper bound for the eps parameters.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_trans.upper">trans.upper</code></td>
<td>
<p>sets the upper bound for the transition rate parameters.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_restart.obj">restart.obj</code></td>
<td>
<p>an object of class  that contains everything to restart an optimization.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_ode.eps">ode.eps</code></td>
<td>
<p>sets the tolerance for the integration at the end of a
branch. Essentially if the sum of compD is less than this tolerance,
then it assumes the results are unstable and discards them. The
default is set to zero, but in testing a value of 1e-8 can sometimes
produce stable solutions for both easy and very difficult optimization problems.</p>
</td></tr>
<tr><td><code id="MuHiSSE_+3A_dt.threads">dt.threads</code></td>
<td>
<p>sets the number of threads available to data.table. In practice this need not change from the default of 1 thread, as we have not seen any speedup from allowing more threads.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function sets up and executes a multiple state HiSSE model. The model allows up to 8
hidden categories (hidden states A-H), and implements a more efficient means of carrying 
out the branch calculation. Specifically, we break up the tree into carry out all 
descendent branch calculations simultaneously, combine the probabilities based on their 
shared ancestry, then repeat for the next set of descendents. In testing, we've found that 
as the number of taxa increases, the calculation becomes much more efficient. In future 
versions, we will likely allow for multicore processing of these calculations to further 
improve speed. We also note that there is vignette tha describes more details for running
this particular function.
</p>
<p>As for data file format, <code>MuHiSSE</code> expects a three column matrix or data frame, with 
the first column containing the species names and the second and third containing the 
binary character information. Note that the order of the data file and the names in the 
&ldquo;phylo&rdquo; object need not be in the same order; <code>MuHiSSE</code> deals with this 
internally. Also, the character information must be coded as 0 and 1, otherwise, the
function will misbehave. However, if the state for a species is unknown for either 
character, a user can specify this with a 2, and the state will be considered maximally 
ambiguous for all relevant character combinations. For example, if character 1 is in state
0, but character 2 is provided a 2, then the program provides a probability of 1 for 00 
and a probability of for 01.
</p>
<p>As with <code>hisse</code>, we employ a modified optimization procedure. In other words, rather
than optimizing birth and death separately, <code>MuHisse</code> optimizes orthogonal 
transformations of these variables: we let tau = birth+death define &quot;net turnover&quot;, and 
we let eps = death/birth define the &ldquo;extinction fraction&rdquo;. This reparameterization 
alleviates problems associated with overfitting when birth and death are highly 
correlated, but both matter in explaining the diversity pattern. 
</p>
<p>To setup a model, users input vectors containing values to indicate how
many free parameters are to be estimated for each of the variables in
the model. This is done using the <code>turnover</code> and
<code>extinct.frac</code> parameters. One needs to specify a value for each of
the parameters of the model, when two parameters show the same value,
then the parameters are set to be linked during the estimation of the
model. For example, a MuHiSSE model with 1 hidden state and all free
parameters has <code>turnover = 1:8</code>. The same model with
turnover rates constrained to be the same for all hidden states has
<code>turnover = c(1,2,3,4,1,2,3,4)</code>. This same format applies to
<code>extinct.frac</code>.
</p>
<p>The &ldquo;trans.rate&rdquo; input is the transition model and has an entirely different setup 
than speciation and extinction rates. See <code>TransMatMakerMuHiSSE</code> function for more 
details. 
</p>
<p>For user-specified &ldquo;root.p&rdquo;, you should specify the probability
for each state combination. If you are doing a hidden model, there will be eight state 
combinations: 00A, 01A, 10A, 11A, 00B, 01B, 10B, 11B. So if you wanted to say the root 
had to be in state 00, and since you do not know the hidden state, you would specify 
&ldquo;root.p = c(0.5, 0, 0, 0, 0.5, 0, 0, 0)&rdquo;. In other words, the root has a 50% 
chance to be in one of the states to be 00A or 00B.
</p>
<p>For the &ldquo;root.type&rdquo; option, we are currently maintaining the previous default of 
&ldquo;madfitz&rdquo;. However, it was recently pointed out by Herrera-Alsina et al. (2018)
that at the root, the individual likelihoods for each possible state should be conditioned
prior to averaging the individual likelihoods across states. This can be set doing 
&ldquo;herr_als&rdquo;. It is unclear to us which is exactly correct, but it does seem that 
both &ldquo;madfitz&rdquo; and &ldquo;herr_als&rdquo; behave exactly as they should in the case of 
character-independent diversification (i.e., reduces to likelihood of tree + likelihood of
trait model). We've also tested the behavior and the likelihood differences are very 
subtle and the parameter estimates in simulation are nearly indistinguishable from the
&ldquo;madfitz&rdquo; conditioning scheme. We provide both options and encourage users to try 
both and let us know conditions in which the result vary dramatically under the two root
implementations. We suspect they do not. 
</p>
<p>Also, note, that in the case of &ldquo;root.type=user&rdquo; and &ldquo;root.type=equal&rdquo; are
no longer explicit &ldquo;root.type&rdquo; options. Instead, either &ldquo;madfitz&rdquo; or 
&ldquo;herr_als&rdquo; are specified and the &ldquo;root.p&rdquo; can be set to allow for custom
root options.  
</p>


<h3>Value</h3>

<p><code>MuHiSSE</code> returns an object of class <code>muhisse.fit</code>. This is a list with 
elements:
</p>
<table>
<tr><td><code>$loglik</code></td>
<td>
<p>the maximum negative log-likelihood.</p>
</td></tr>
<tr><td><code>$AIC</code></td>
<td>
<p>Akaike information criterion.</p>
</td></tr>
<tr><td><code>$AICc</code></td>
<td>
<p>Akaike information criterion corrected for sample-size.</p>
</td></tr>
<tr><td><code>$solution</code></td>
<td>
<p>a matrix containing the maximum likelihood estimates of the model 
parameters.</p>
</td></tr>
<tr><td><code>$index.par</code></td>
<td>
<p>an index matrix of the parameters being estimated.</p>
</td></tr>
<tr><td><code>$f</code></td>
<td>
<p>user-supplied sampling frequencies.</p>
</td></tr>
<tr><td><code>$hidden.states</code></td>
<td>
<p>a logical indicating whether hidden states were included in the 
model.</p>
</td></tr>
<tr><td><code>$condition.on.surivival</code></td>
<td>
<p>a logical indicating whether the
likelihood was conditioned on the survival of two lineages and the speciation event 
subtending them.</p>
</td></tr>
<tr><td><code>$root.type</code></td>
<td>
<p>indicates the user-specified root prior assumption.</p>
</td></tr>
<tr><td><code>$root.p</code></td>
<td>
<p>indicates whether the user-specified fixed root probabilities.</p>
</td></tr>
<tr><td><code>$phy</code></td>
<td>
<p>user-supplied tree</p>
</td></tr>
<tr><td><code>$data</code></td>
<td>
<p>user-supplied dataset</p>
</td></tr>
<tr><td><code>$trans.matrix</code></td>
<td>
<p>the user-supplied transition matrix</p>
</td></tr>
<tr><td><code>$max.tol</code></td>
<td>
<p>relative optimization tolerance.</p>
</td></tr>
<tr><td><code>$starting.vals</code></td>
<td>
<p>The starting values for the optimization.</p>
</td></tr>
<tr><td><code>$upper.bounds</code></td>
<td>
<p>the vector of upper limits to the optimization search.</p>
</td></tr>
<tr><td><code>$lower.bounds</code></td>
<td>
<p>the vector of lower limits to the optimization
search.</p>
</td></tr>
<tr><td><code>$ode.eps</code></td>
<td>
<p>The ode.eps value used for the estimation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models 
of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation 
and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Herrera-Alsina, L., P. van Els, and R.S. Etienne. 2018. Detecting the dependence of diversification on multiples traits from phylogenetic trees and trait data. Systematic Biology, 68:317-328.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters effect on 
speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nakov, T., Beaulieu, J.M., and Alverson, A.J. 2019. Diatoms diversify and turn over faster in freshwater than marine environments. Evolution, doi: https://doi.org/10.1111/evo.13832.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos. 
Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='plot.geohisse.states'>Plotting function geohisse.states objects</h2><span id='topic+plot.geohisse.states'></span>

<h3>Description</h3>

<p>A plotting function for visualizing changes in states and rates over a phylogeny</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'geohisse.states'
plot(x, rate.param = "net.div", type = "fan",
show.tip.label = TRUE, fsize = 1.0, legend = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.geohisse.states_+3A_x">x</code></td>
<td>
<p>a <code>hisse.states</code> object or a list of such objects.</p>
</td></tr>
<tr><td><code id="plot.geohisse.states_+3A_rate.param">rate.param</code></td>
<td>
<p>indicates the type of rates to plot. Options include: &ldquo;turnover&rdquo;, &ldquo;net.div&rdquo;, &ldquo;speciation&rdquo;,  &ldquo;extinction&rdquo;,  &ldquo;extinction.fraction&rdquo;.</p>
</td></tr>
<tr><td><code id="plot.geohisse.states_+3A_type">type</code></td>
<td>
<p>a character string specifying the type of phylogeny to be drawn. Options are &quot;fan&quot; (default) or &quot;phylogram&quot;.</p>
</td></tr>
<tr><td><code id="plot.geohisse.states_+3A_show.tip.label">show.tip.label</code></td>
<td>
<p>a logical indicating whether tip names should be included. Default is TRUE</p>
</td></tr>
<tr><td><code id="plot.geohisse.states_+3A_fsize">fsize</code></td>
<td>
<p>sets the font size for the tip labels.</p>
</td></tr>
<tr><td><code id="plot.geohisse.states_+3A_legend">legend</code></td>
<td>
<p>indicates if the legend is to be plotted. TRUE or FALSE.</p>
</td></tr>
<tr><td><code id="plot.geohisse.states_+3A_...">...</code></td>
<td>
<p>Additional parameters to control the plot. See &ldquo;Details&rdquo;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Additional parameters can be defined using &ldquo;...&rdquo;:
</p>
<p>&ldquo;do.observed.only&rdquo; is a logical indicating whether just the
states should be plotted; for now, only TRUE
works.
&ldquo;rate.colors&rdquo; are user specified colors to be used for
coloring rates.
&ldquo;state.colors&rdquo; are user specified colors to be
used for coloring states. A vector with the color for state 1 (endemic
area '0'), state 2 (endemic area '1') and state 0 (widespread area
'01'). Always in this order!
&ldquo;edge.width&rdquo; is the width of the
branches of the phylogeny.
&ldquo;width.factor&rdquo; is the factor
multiplying the &ldquo;edge.width&rdquo; to get the width of the branch
for the states tree. Needs to be a numeric value between 0 and 1.
&ldquo;rate.range&rdquo; is an optional two element
vector. If present, specifies the range of rate values to use for
plotting.
&ldquo;lims.percentage.correction&rdquo; deals with cases where
the limits are slightly smaller than the values due to imprecision
issues.
&ldquo;legend.position&rdquo; are the coordinates for placing the
legend.
&ldquo;legend.cex&rdquo; is the text size inside the
legend.
&ldquo;legend.kernel&rdquo; lets you specify the way the density
plot or histogram is made for rates. A value of &ldquo;auto&rdquo; chooses
what we think is the best option given your data, &ldquo;hist&rdquo; makes
a histogram, &ldquo;rectangular&rdquo;, &ldquo;gaussian&rdquo;, and others make
a density plot. See <code>?density</code> for all non-&ldquo;hist&rdquo;
options.
&ldquo;legend.bg&rdquo; sets the color for the legend
background.
&ldquo;mar&rdquo; sets the margins for the plot. See more
information in 'help(par)'.
&ldquo;outline&rdquo; is whether to plot an
outline on the branches of the tree. Choose the color of the outline
using the parameter outline.color.
&ldquo;outline.color&rdquo; is the color
for the outline. Defaults to &quot;black&quot;.
&ldquo;swap.underscore&rdquo; sets
whether to substitute all &quot;_&quot; with &quot; &quot; on the labels for the tips.
</p>
<p>This function is very similar to the <code>hisse::plot.hisse.states</code>
function. See more details in help page for <code>hisse::plot.hisse.states</code> function.
</p>


<h3>Author(s)</h3>

<p>Brian O'Meara and Daniel Caetano</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>

<hr>
<h2 id='plot.hisse.states'>Plotting function hisse.states objects</h2><span id='topic+plot.hisse.states'></span>

<h3>Description</h3>

<p>A plotting function for visualizing changes in states and rates over a phylogeny</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'hisse.states'
plot(x, rate.param = "net.div", type = "fan",
show.tip.label = TRUE, fsize = 1.0, legend = "tips", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.hisse.states_+3A_x">x</code></td>
<td>
<p>a <code>hisse.states</code> object or a list of such objects.</p>
</td></tr>
<tr><td><code id="plot.hisse.states_+3A_rate.param">rate.param</code></td>
<td>
<p>indicates the type of rates to plot. Options include: &ldquo;turnover&rdquo;, &ldquo;net.div&rdquo;, &ldquo;speciation&rdquo;,  &ldquo;extinction&rdquo;,  &ldquo;extinction.fraction&rdquo;. The default is &ldquo;net.div&rdquo;.</p>
</td></tr>
<tr><td><code id="plot.hisse.states_+3A_type">type</code></td>
<td>
<p>a character string specifying the type of phylogeny to be drawn. Options are &quot;fan&quot; (default) or &quot;phylogram&quot;.</p>
</td></tr>
<tr><td><code id="plot.hisse.states_+3A_show.tip.label">show.tip.label</code></td>
<td>
<p>a logical indicating whether tip names should be included.</p>
</td></tr>
<tr><td><code id="plot.hisse.states_+3A_fsize">fsize</code></td>
<td>
<p>sets the font size for the tip labels.</p>
</td></tr>
<tr><td><code id="plot.hisse.states_+3A_legend">legend</code></td>
<td>
<p>indicates the type of legend. Options include:
&ldquo;none&rdquo;, &ldquo;traditional&rdquo;, &ldquo;tips&rdquo;, &ldquo;internal&rdquo;,
&ldquo;all&rdquo;.</p>
</td></tr>
<tr><td><code id="plot.hisse.states_+3A_...">...</code></td>
<td>
<p>Additional parameters to control the plot. See &ldquo;Details&rdquo;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Provides phylogeny that shows a heat map of the diversification rate parameter you specify (which could be turnover, net.div, speciation, extinction, or extinction.fraction).
The discrete state reconstruction appears as lines on top of the heat map. If you give a single hisse.state object, it uses that; if you give it a list of them, it will 
model-average the results (it assumes the trees are the same). Colors can be specified by sending a vector of colors to rate.colors or state.colors (the defaults
are red to blue for rate and white to black for state). You can specify two or more colors: c(&quot;red&quot;, &quot;gray&quot;, &quot;blue&quot;) for example. By default the visualization uses the
minimum rate on the tree for the minimum color, and the maximum rate for the maximum color, but you may want to use the same color scale across models, even
if some of them have a smaller range than others. To do this, pass a vector with the minimum and maximum rate across all models to the visualization for all models
and they will use the same scale. There are many options for adding a legend. A traditional legend showing what values a color corresponds to is &ldquo;traditional&rdquo;, like
what plotSimmap will show in phytools. However, we can also use the legend to show the distribution of values, rather than just a key to color. &ldquo;tips&rdquo; shows a density
plot of states or rates at tips, &ldquo;internal&rdquo; a distribution at internal nodes, and &ldquo;all&rdquo; at all nodes in the tree. For the density or histogram plots, you can
let the package pick the best visualization or choose yourself whether to use a histogram or density plot, and if the latter, what kernel you want. The legend can be
moved around the overall tree plot by using &ldquo;legend.position&rdquo;: this is a vector that specifies the &ldquo;fig&rdquo; argument to &ldquo;par&rdquo;: c(x1, x2, y1, y2), where
the values are the starting and ending positions as a fraction of the overall plot. By default, the legend starts at the lower left corner and continues up 20
the rest of the plot (c(0, 0.2, 0, 0.2)): by changing values, you can make the legend larger or smaller and change its position. The heatmap code is modified slightly
from Liam Revell's phytools package.
</p>
<p>Additional parameters to control the plot:
&ldquo;do.observed.only&rdquo; is a logical indicating whether just the states should be plotted; for now, only TRUE works.
&ldquo;rate.colors&rdquo; sets user specified colors to be used for coloring rates.
&ldquo;state.colors&rdquo; sets user specified colors to be used for coloring states.
&ldquo;edge.width&rdquo; sets the width of the branches of the phylogeny. 
&ldquo;width.factor&rdquo; is the factor multiplying the edge.width to get the
width of the branch for the states tree. Needs to be a numeric value
between 0 and 1.
&ldquo;rate.range&rdquo; is an optional two element vector. If present, specifies the range of rate values to use for plotting.
&ldquo;lims.percentage.correction&rdquo; deals with cases where the limits are slightly smaller than the values due to imprecision issues.
&ldquo;legend.position&rdquo; are the coordinates for placing the legend.
&ldquo;legend.cex&rdquo; is the text size inside the legend.
&ldquo;legend.kernel.rates&rdquo; used for legend=tips, internal, or all, lets you specify the way the density plot or histogram is made for rates. &ldquo;auto&rdquo;
chooses what we think is the best option given your data, &ldquo;hist&rdquo; makes a histogram, &ldquo;rectangular&rdquo;, &ldquo;gaussian&rdquo;, and others make a density plot. See <code>?density</code> for all non-&ldquo;hist&rdquo; options.
&ldquo;legend.kernel.states&rdquo; is as above, for states.
&ldquo;legend.bg&rdquo; sets the color for the legend background.
&ldquo;mar&rdquo; sets the margins for the plot. See more information in 'help(par)'.
&ldquo;outline&rdquo; sets whether to plot an outline on the branches of the tree. Choose the color of the outline using the parameter outline.color.
&ldquo;outline.color&rdquo; sets the color for the outline. Defaults to &quot;black&quot;.
&ldquo;swap.underscore&rdquo; defines whether to substitute all &quot;_&quot; with &quot; &quot; on the labels for the tips.
</p>


<h3>Author(s)</h3>

<p>Brian O'Meara and Daniel Caetano</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>

<hr>
<h2 id='plot.misse.states'>Plotting function misse.states objects</h2><span id='topic+plot.misse.states'></span>

<h3>Description</h3>

<p>A plotting function for visualizing changes in states and rates over a phylogeny</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'misse.states'
plot(x, rate.param = "net.div", type = "fan",
show.tip.label = TRUE, fsize = 1.0, legend = "tips", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.misse.states_+3A_x">x</code></td>
<td>
<p>a <code>misse.states</code> object or a list of such objects.</p>
</td></tr>
<tr><td><code id="plot.misse.states_+3A_rate.param">rate.param</code></td>
<td>
<p>indicates the type of rates to plot. Options include: &ldquo;turnover&rdquo;, &ldquo;net.div&rdquo;, &ldquo;speciation&rdquo;,  &ldquo;extinction&rdquo;,  &ldquo;extinction.fraction&rdquo;.</p>
</td></tr>
<tr><td><code id="plot.misse.states_+3A_type">type</code></td>
<td>
<p>a character string specifying the type of phylogeny to be drawn. Options are &quot;fan&quot; (default) or &quot;phylogram&quot;.</p>
</td></tr>
<tr><td><code id="plot.misse.states_+3A_show.tip.label">show.tip.label</code></td>
<td>
<p>a logical indicating whether tip names should be included. Default is TRUE</p>
</td></tr>
<tr><td><code id="plot.misse.states_+3A_fsize">fsize</code></td>
<td>
<p>sets the font size for the tip labels.</p>
</td></tr>
<tr><td><code id="plot.misse.states_+3A_legend">legend</code></td>
<td>
<p>indicates if the legend is to be plotted. TRUE or FALSE.</p>
</td></tr>
<tr><td><code id="plot.misse.states_+3A_...">...</code></td>
<td>
<p>Additional parameters to control the plot. See &ldquo;Details&rdquo;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Additional parameters can be defined using &ldquo;...&rdquo;:
</p>
<p>&ldquo;do.observed.only&rdquo; is a logical indicating whether just the
states should be plotted; for now, only TRUE
works.
&ldquo;rate.colors&rdquo; are user specified colors to be used for
coloring rates.
&ldquo;state.colors&rdquo; are user specified colors to be
used for coloring states. A vector with the color for states 00, 01, 10, and 11 (in this order).
&ldquo;edge.width&rdquo; is the width of the
branches of the phylogeny.
&ldquo;width.factor&rdquo; is the factor
multiplying the &ldquo;edge.width&rdquo; to get the width of the branch
for the states tree. Needs to be a numeric value between 0 and 1.
&ldquo;rate.range&rdquo; is an optional two element
vector. If present, specifies the range of rate values to use for
plotting.
&ldquo;lims.percentage.correction&rdquo; deals with cases where
the limits are slightly smaller than the values due to imprecision
issues.
&ldquo;legend.position&rdquo; are the coordinates for placing the
legend.
&ldquo;legend.cex&rdquo; is the text size inside the
legend.
&ldquo;legend.kernel&rdquo; lets you specify the way the density
plot or histogram is made for rates. A value of &ldquo;auto&rdquo; chooses
what we think is the best option given your data, &ldquo;hist&rdquo; makes
a histogram, &ldquo;rectangular&rdquo;, &ldquo;gaussian&rdquo;, and others make
a density plot. See <code>?density</code> for all non-&ldquo;hist&rdquo;
options.
&ldquo;legend.bg&rdquo; sets the color for the legend
background.
&ldquo;mar&rdquo; sets the margins for the plot. See more
information in 'help(par)'.
&ldquo;outline&rdquo; is whether to plot an
outline on the branches of the tree. Choose the color of the outline
using the parameter outline.color.
&ldquo;outline.color&rdquo; is the color
for the outline. Defaults to &quot;black&quot;.
&ldquo;swap.underscore&rdquo; sets
whether to substitute all &quot;_&quot; with &quot; &quot; on the labels for the tips.
</p>
<p>This function is very similar to the <code>hisse::plot.hisse.states</code>
function. See more details in help page for <code>hisse::plot.hisse.states</code> function.
</p>


<h3>Author(s)</h3>

<p>Brian O'Meara and Daniel Caetano</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>

<hr>
<h2 id='plot.muhisse.states'>Plotting function muhisse.states objects</h2><span id='topic+plot.muhisse.states'></span>

<h3>Description</h3>

<p>A plotting function for visualizing changes in states and rates over a phylogeny</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'muhisse.states'
plot(x, rate.param = "net.div", type = "fan",
show.tip.label = TRUE, fsize = 1.0, legend = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.muhisse.states_+3A_x">x</code></td>
<td>
<p>a <code>muhisse.states</code> object or a list of such objects.</p>
</td></tr>
<tr><td><code id="plot.muhisse.states_+3A_rate.param">rate.param</code></td>
<td>
<p>indicates the type of rates to plot. Options include: &ldquo;turnover&rdquo;, &ldquo;net.div&rdquo;, &ldquo;speciation&rdquo;,  &ldquo;extinction&rdquo;,  &ldquo;extinction.fraction&rdquo;.</p>
</td></tr>
<tr><td><code id="plot.muhisse.states_+3A_type">type</code></td>
<td>
<p>a character string specifying the type of phylogeny to be drawn. Options are &quot;fan&quot; (default) or &quot;phylogram&quot;.</p>
</td></tr>
<tr><td><code id="plot.muhisse.states_+3A_show.tip.label">show.tip.label</code></td>
<td>
<p>a logical indicating whether tip names should be included. Default is TRUE</p>
</td></tr>
<tr><td><code id="plot.muhisse.states_+3A_fsize">fsize</code></td>
<td>
<p>sets the font size for the tip labels.</p>
</td></tr>
<tr><td><code id="plot.muhisse.states_+3A_legend">legend</code></td>
<td>
<p>indicates if the legend is to be plotted. TRUE or FALSE.</p>
</td></tr>
<tr><td><code id="plot.muhisse.states_+3A_...">...</code></td>
<td>
<p>Additional parameters to control the plot. See &ldquo;Details&rdquo;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Additional parameters can be defined using &ldquo;...&rdquo;:
</p>
<p>&ldquo;do.observed.only&rdquo; is a logical indicating whether just the
states should be plotted; for now, only TRUE
works.
&ldquo;rate.colors&rdquo; are user specified colors to be used for
coloring rates.
&ldquo;state.colors&rdquo; are user specified colors to be
used for coloring states. A vector with the color for states 00, 01, 10, and 11 (in this order).
&ldquo;edge.width&rdquo; is the width of the
branches of the phylogeny.
&ldquo;width.factor&rdquo; is the factor
multiplying the &ldquo;edge.width&rdquo; to get the width of the branch
for the states tree. Needs to be a numeric value between 0 and 1.
&ldquo;rate.range&rdquo; is an optional two element
vector. If present, specifies the range of rate values to use for
plotting.
&ldquo;lims.percentage.correction&rdquo; deals with cases where
the limits are slightly smaller than the values due to imprecision
issues.
&ldquo;legend.position&rdquo; are the coordinates for placing the
legend.
&ldquo;legend.cex&rdquo; is the text size inside the
legend.
&ldquo;legend.kernel&rdquo; lets you specify the way the density
plot or histogram is made for rates. A value of &ldquo;auto&rdquo; chooses
what we think is the best option given your data, &ldquo;hist&rdquo; makes
a histogram, &ldquo;rectangular&rdquo;, &ldquo;gaussian&rdquo;, and others make
a density plot. See <code>?density</code> for all non-&ldquo;hist&rdquo;
options.
&ldquo;legend.bg&rdquo; sets the color for the legend
background.
&ldquo;mar&rdquo; sets the margins for the plot. See more
information in 'help(par)'.
&ldquo;outline&rdquo; is whether to plot an
outline on the branches of the tree. Choose the color of the outline
using the parameter outline.color.
&ldquo;outline.color&rdquo; is the color
for the outline. Defaults to &quot;black&quot;.
&ldquo;swap.underscore&rdquo; sets
whether to substitute all &quot;_&quot; with &quot; &quot; on the labels for the tips.
</p>
<p>This function is very similar to the <code>hisse::plot.hisse.states</code>
function. See more details in help page for <code>hisse::plot.hisse.states</code> function.
</p>


<h3>Author(s)</h3>

<p>Brian O'Meara and Daniel Caetano</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>

<hr>
<h2 id='PlotMisseSpace'>Plotting function for MiSSEGreedy</h2><span id='topic+PlotMisseSpace'></span>

<h3>Description</h3>

<p>A plotting function for visualizing the model space explored in MiSSEGreedy. 
Arguments in <code>...</code> are passed to <code>plot.igraph</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PlotMisseSpace(x, possible.combos=NULL, arrows.by.weight=FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PlotMisseSpace_+3A_x">x</code></td>
<td>
<p>a <code>misse</code> list of model fits obtain from <code>MiSSEGreedy</code>.</p>
</td></tr>
<tr><td><code id="PlotMisseSpace_+3A_possible.combos">possible.combos</code></td>
<td>
<p>data.frame of parameter combinations to try. See 'Details'.</p>
</td></tr>
<tr><td><code id="PlotMisseSpace_+3A_arrows.by.weight">arrows.by.weight</code></td>
<td>
<p>a logical indicating whether arrow direction between adjacent model reflects which model has higher support. The default is <code>FALSE</code> which means arrows show direction of model complexity.</p>
</td></tr>
<tr><td><code id="PlotMisseSpace_+3A_...">...</code></td>
<td>
<p>Additional parameters to control the igraph plot. See <code>plot.igraph</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the input x is a list of <code>misse</code> fits from MiSSEGreedy then size of the vertices are in proportion 
of their AIC weights. If only the &ldquo;possible.combos&rdquo; is input, and <code>x=NULL</code>, then the model space 
will be plotted but with each vertex having the same size.
</p>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Vascancelos, T, B.C. O'Meara, and J.M. Beaulieu. In prep.
</p>

<hr>
<h2 id='ProcessSimSample'>Process fossilized birth-death sample of lineages</h2><span id='topic+ProcessSimSample'></span>

<h3>Description</h3>

<p>Takes output from <code>GetFossils</code> and places extinct lineages in the tree and produces a properly formatted table of fossil samples from lineages that survive to the present (k fossils).</p>


<h3>Usage</h3>

<pre><code class='language-R'>ProcessSimSample(phy, f)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ProcessSimSample_+3A_phy">phy</code></td>
<td>
<p>a complete phylogeny that includes both extant and extinct lineages.</p>
</td></tr> 
<tr><td><code id="ProcessSimSample_+3A_f">f</code></td>
<td>
<p>the table of sampled lineages under the fossilized birth-death process obtained from <code>GetFossils</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns an object that contains:
</p>
<table>
<tr><td><code>$phy</code></td>
<td>
<p>a tree of extant taxa and sampled extinct tips.</p>
</td></tr>
<tr><td><code>$k.samples</code></td>
<td>
<p>a table of k fossils sampled, formatted to be input into <code>MiSSE</code>, <code>hisse</code>, <code>MuHiSSE</code>.</p>
</td></tr>
</table>

<hr>
<h2 id='ProcessSimStrat'>Process fossilized birth-death sample of lineages into stratigraphic intervals.</h2><span id='topic+ProcessSimStrat'></span>

<h3>Description</h3>

<p>Takes output from <code>GetFossils</code> and places extinct lineages in the tree and produces a properly formatted table of stratigraphic intervals.</p>


<h3>Usage</h3>

<pre><code class='language-R'>ProcessSimStrat(phy, f)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ProcessSimStrat_+3A_phy">phy</code></td>
<td>
<p>a complete phylogeny that includes both extant and extinct lineages.</p>
</td></tr> 
<tr><td><code id="ProcessSimStrat_+3A_f">f</code></td>
<td>
<p>the table of sampled lineages under the fossilized birth-death process obtained from <code>GetFossils</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns an object that contains:
</p>
<table>
<tr><td><code>$phy</code></td>
<td>
<p>a tree of extant taxa and sampled extinct tips.</p>
</td></tr>
<tr><td><code>$strat.intervals</code></td>
<td>
<p>a table of stratigraphic intervals, formatted to be input into <code>MiSSE</code>, <code>hisse</code>, <code>MuHiSSE</code>.</p>
</td></tr>
</table>

<hr>
<h2 id='PruneRedundantModels'>Prune Redundant Models</h2><span id='topic+PruneRedundantModels'></span>

<h3>Description</h3>

<p>Removes models that fit equivalently well to models that are as simple or simpler.</p>


<h3>Usage</h3>

<pre><code class='language-R'>PruneRedundantModels(..., precision=1e-5)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PruneRedundantModels_+3A_...">...</code></td>
<td>
<p>A list of models (such as from MiSSEGreedy or just putting individual hisse runs in a list)</p>
</td></tr>
<tr><td><code id="PruneRedundantModels_+3A_precision">precision</code></td>
<td>
<p>How different the log likelihoods can be to assume they're equivalent models)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Imagine two models:
Model 1: parameters a and b allowed to vary
Model 2: parameters a set to equal b 
</p>
<p>If the maximum likelihood estimate for a and b in model 1 are that they have the same value, it's essentially the same as including model 2 twice, and so other models have lower weight in consequence. This comes up with hidden state models where some hidden states are in extremely low frequencies throughout: they have more parameters than simpler models but the likelihood is essentially the same. Burnham and Anderson (2003, page 342ff) recommend removing redundant models in cases like this where two models are effectively identical. 
</p>
<p>This function does this by ordering models by the number of free parameters, then deleting models that have log likelihoods nearly exactly equal (to the precision set above) to a model that is as simple or simpler. This is not a perfect solution &ndash; it's possible that models could have very different parameters and have the same likelihood, for example. Also the &quot;as simple&quot; means that if there are two models with equal numbers of parameters, whichever is first gets saved and the second is removed. 
</p>


<h3>Author(s)</h3>

<p>Brian O'Meara</p>

<hr>
<h2 id='SimToPhylo'>Convert simulated result to a tree</h2><span id='topic+SimToPhylo'></span>

<h3>Description</h3>

<p>Converts the $results element of the return to a phylo object</p>


<h3>Usage</h3>

<pre><code class='language-R'>SimToPhylo(results, include.extinct=FALSE, drop.stem=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SimToPhylo_+3A_results">results</code></td>
<td>
<p>dataframe of results from SimulateHisse.</p>
</td></tr>
<tr><td><code id="SimToPhylo_+3A_include.extinct">include.extinct</code></td>
<td>
<p>include (TRUE) or delete (FALSE) extinct terminal taxa.</p>
</td></tr>
<tr><td><code id="SimToPhylo_+3A_drop.stem">drop.stem</code></td>
<td>
<p>include the lineage leading to the first saved speciation even (FALSE) or cull it (TRUE).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This takes the <code>$results</code> object from a <code>SimulateHisse</code> run and converts it to an ape <code>phylo</code> object. If there are no taxa on the final tree, it returns NA; if there is one taxon, it returns a one taxon tree. This is behavior different from diversitree's tree simulators, which returns NULL in both the zero and one taxon case. Extinct taxa can be pruned or not. For simulations starting with one taxon, and/or for simulations with some extinction, the final tree can have a time when there is a single lineage before it radiates into the crown group. This stem can be included or not. The tip states are stored in <code>$tip.state</code> in the returned tree.
</p>


<h3>Value</h3>

<table>
<tr><td><code>phylo</code></td>
<td>
<p>a phylo object in cladewise order.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Brian O'Meara</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
simulated.result &lt;- SimulateHisse(c(.3, .1), c(.1, 0), 
matrix(c(NA, 0.2, .3, NA), nrow=2), max.taxa=35, x0=1)	
par(mfcol=c(1,2))
plot(SimToPhylo(simulated.result$results, include.extinct=TRUE))
plot(SimToPhylo(simulated.result$results, include.extinct=FALSE))
 	
</code></pre>

<hr>
<h2 id='SimulateGeoHiSSE'>Simulate under a GeoHiSSE model</h2><span id='topic+SimulateGeoHiSSE'></span>

<h3>Description</h3>

<p>Simulation function for the GeoHiSSE model</p>


<h3>Usage</h3>

<pre><code class='language-R'>SimulateGeoHiSSE(pars, hidden.traits=1, x0="0A", max.taxa=Inf,
max.time=Inf, add.jumps=FALSE, add.extinction=FALSE, 
include.extinct=FALSE, return.GeoHiSSE_pars=FALSE, 
override.safeties=FALSE)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SimulateGeoHiSSE_+3A_pars">pars</code></td>
<td>
<p>an object of class &quot;GeoHiSSE_pars&quot; generated by
<code>SimulateGeoHiSSE</code>. See 'Details'.</p>
</td></tr>
<tr><td><code id="SimulateGeoHiSSE_+3A_hidden.traits">hidden.traits</code></td>
<td>
<p>number of hidden areas in the model. Default is 1.</p>
</td></tr>
<tr><td><code id="SimulateGeoHiSSE_+3A_x0">x0</code></td>
<td>
<p>a character value for the starting state. Default is &quot;01A&quot;.</p>
</td></tr>
<tr><td><code id="SimulateGeoHiSSE_+3A_max.taxa">max.taxa</code></td>
<td>
<p>have the simulation stop at <code>max.taxa</code> surviving taxa.</p>
</td></tr>
<tr><td><code id="SimulateGeoHiSSE_+3A_max.time">max.time</code></td>
<td>
<p>have the simulation stop at <code>max.time</code> height
(including stem).</p>
</td></tr>
<tr><td><code id="SimulateGeoHiSSE_+3A_return.geohisse_pars">return.GeoHiSSE_pars</code></td>
<td>
<p>whether to (only) return a &quot;GeoHiSSE_pars&quot; object
in the correct format to use in this function. See 'Details'.</p>
</td></tr>
<tr><td><code id="SimulateGeoHiSSE_+3A_add.jumps">add.jumps</code></td>
<td>
<p>whether to include jump dispersals in the model. Both
for returning the parameters of the model and model
estimation. Default is FALSE.</p>
</td></tr>
<tr><td><code id="SimulateGeoHiSSE_+3A_add.extinction">add.extinction</code></td>
<td>
<p>whether to separate extirpation and extinction of
endemic lineages. Both for returning the parameters of the model and model
estimation. Default is FALSE.</p>
</td></tr>
<tr><td><code id="SimulateGeoHiSSE_+3A_include.extinct">include.extinct</code></td>
<td>
<p>whether the simulation should keep extinct
lineages. Default is FALSE.</p>
</td></tr>
<tr><td><code id="SimulateGeoHiSSE_+3A_override.safeties">override.safeties</code></td>
<td>
<p>simulate even if there is no limit on number of
taxa or depth of tree.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function uses <code>diversitree::tree.classe</code> function to simulate
the tree under the GeoSSE model with hidden states. The parameter
<code>pars</code> is a list of class &quot;GeoHiSSE_pars&quot; that can be generated
using this same function. The best way is to first run
<code>SimulateGeoHiSSE</code> with empty parameters and
<code>return.GeoHiSSE_pars=TRUE</code> and with <code>hidden.areas</code> equal to
the number of desired hidden states in the model. This will return an
object in list format with a set of four matrices. Each matrix controls
a different set of parameters of the model. All parameters are set to 0
and parameters not used by the model are set to NA. To prepare the
simulation, edit these matrices and change the desired parameter
values. Leaving a parameter equal to 0 is the same as reducing the model
by eliminating this parameter of the model.
</p>


<h3>Value</h3>

<p>This returns a list, with the following elements:
</p>
<table>
<tr><td><code>$phy</code></td>
<td>
<p>a phylogeny of class phylo.</p>
</td></tr>
<tr><td><code>$data</code></td>
<td>
<p>a data matrix with the species names as the first
column and the ranges (in 0, 1, and 2 format) as the second column.</p>
</td></tr>
<tr><td><code>$hidden.states</code></td>
<td>
<p>a named vector with the 'true' simulated ranges
(include the hidden state information).</p>
</td></tr>
<tr><td><code>$sim.attempts</code></td>
<td>
<p>number of times that the simulation tried
before reaching desired termination condition.</p>
</td></tr>
<tr><td><code>$pars</code></td>
<td>
<p>the parameters used for the simulation.</p>
</td></tr>
<tr><td><code>$classe.pars</code></td>
<td>
<p>the parameters in 'make.classe' format for 
the 'diversitree' package.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Daniel Caetano</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## Get the a list with the correct parameters to run the simulation:
pars &lt;- SimulateGeoHiSSE(hidden.areas=1, return.GeoHiSSE_pars=TRUE)
## Edit the parameter values:
pars$model.pars[1:3,] &lt;- 0.1
pars$model.pars[4:5,] &lt;- 0.05
pars$model.pars[6:7,] &lt;- 0.01
pars$q.01[1,2] &lt;- pars$q.01[2,1] &lt;- 0.01
pars$q.1[1,2] &lt;- pars$q.1[2,1] &lt;- 0.02
pars$q.2[1,2] &lt;- pars$q.2[2,1] &lt;- 0.02
## Run the simulation:
sim &lt;- SimulateGeoHiSSE(pars=pars, hidden.areas=1, x0="01A", max.taxa=100)

## End(Not run)
</code></pre>

<hr>
<h2 id='SimulateHisse'>Simulate under a HiSSE model</h2><span id='topic+SimulateHisse'></span>

<h3>Description</h3>

<p>Flexible simulation function allowing checkpointing</p>


<h3>Usage</h3>

<pre><code class='language-R'>SimulateHisse(turnover.rates, eps.values, transition.rates, max.taxa=Inf, max.t=Inf, 
max.wall.time=Inf, x0, nstart=1, checkpoint.file=NULL, checkpoint.frequency=100, 
checkpoint.start.object=NULL, override.safeties=FALSE, mass.extinction.heights=c(),
mass.extinction.magnitudes=c())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SimulateHisse_+3A_turnover.rates">turnover.rates</code></td>
<td>
<p>a vector of turnover rates.</p>
</td></tr>
<tr><td><code id="SimulateHisse_+3A_eps.values">eps.values</code></td>
<td>
<p>a vector of extinction fractions.</p>
</td></tr>
<tr><td><code id="SimulateHisse_+3A_transition.rates">transition.rates</code></td>
<td>
<p>a matrix of transition rates.</p>
</td></tr>
<tr><td><code id="SimulateHisse_+3A_max.taxa">max.taxa</code></td>
<td>
<p>have the simulation stop at <code>max.taxa</code> surviving taxa.</p>
</td></tr>
<tr><td><code id="SimulateHisse_+3A_max.t">max.t</code></td>
<td>
<p>have the simulation stop at <code>max.t</code> height (including stem).</p>
</td></tr> 
<tr><td><code id="SimulateHisse_+3A_max.wall.time">max.wall.time</code></td>
<td>
<p>have the simulation stop at this many seconds of running.</p>
</td></tr> 
<tr><td><code id="SimulateHisse_+3A_x0">x0</code></td>
<td>
<p>the starting state.</p>
</td></tr>
<tr><td><code id="SimulateHisse_+3A_nstart">nstart</code></td>
<td>
<p>how many taxa you want to start from. Usual values are 1 (start with single lineage) or 2 (crown group).</p>
</td></tr>
<tr><td><code id="SimulateHisse_+3A_checkpoint.file">checkpoint.file</code></td>
<td>
<p>if you want to save progress (so you can restart from last saved point) include the name of a file.</p>
</td></tr>
<tr><td><code id="SimulateHisse_+3A_checkpoint.frequency">checkpoint.frequency</code></td>
<td>
<p>if there is a checkpoint file, frequency (in terms of number of steps: births, deaths, or transitions) at which this is saved.</p>
</td></tr>
<tr><td><code id="SimulateHisse_+3A_checkpoint.start.object">checkpoint.start.object</code></td>
<td>
<p>if you are starting from a checkpointed.file, the object loaded from that file. Typically called <code>checkpoint.result</code>.</p>
</td></tr>
<tr><td><code id="SimulateHisse_+3A_override.safeties">override.safeties</code></td>
<td>
<p>simulate even if there is no limit on number of taxa, depth of tree, or wall time.</p>
</td></tr>
<tr><td><code id="SimulateHisse_+3A_mass.extinction.heights">mass.extinction.heights</code></td>
<td>
<p>vector of times above the root [NOT from the present] to have a mass extinction.</p>
</td></tr>
<tr><td><code id="SimulateHisse_+3A_mass.extinction.magnitudes">mass.extinction.magnitudes</code></td>
<td>
<p>vector of per species extinction probability at mass extinctions.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that currently, the simulator assumes <code>turnover.rates</code>, <code>eps.values</code>, and <code>transition rates</code> are in the same state order. Remember that <code>turnover.rates</code> are birth + death rates, and <code>eps.values</code> are death / birth rates. 
</p>
<p>We strongly advise putting some limits to stop the run. These can be any combination of <code>max.taxa</code>, <code>max.t</code>, and <code>max.wall.time</code>. For example, you could set up the run to stop when you hit 1000 taxa or 3600 seconds (one hour) of running on your computer, whichever comes first. If you want to run with no limits, you have to specify <code>override.safeties=TRUE</code>, and you should know what you're doing here (the runs might never finish). There is only one starting state (<code>x0</code>), which should be the index into the rate vectors, starting with 0: that is, if your states are 0A, 0B, 1A, and 1B, x0=0 would start in 0A, x0=3 would start in 1B. <code>nstart</code> lets you choose how many taxa to start with: it could be one lineage to start from a single taxon, in which case you'll have to wait some time for the first speciation event, or you could start with two, to start simulation with a clade of this size (though, if extinction is nonzero, you are not guaranteed to have the final crown group include both of these descendants). You can choose numbers higher than two, to start with, say, a 50-species polytomy. We're not sure why you would. You can add checkpointing: runs take a long time, and if it crashes, this will let you start from the same point in the last saved file (though with a different seed, unless you specify this yourself). If you want to save checkpoints as you go along, specify a file in <code>checkpoint.file</code>. Every <code>checkpoint.frequency</code> events, where an event is a speciation, extinction, or transition event, it will save current progress to a file. The smaller this value, the more frequently the simulation will be saved: fewer lost steps if you have to re-simulate, but slower during the run because it spends time writing to disk. If you want to start from a checkpointed analysis, load the file into R and then specify the object within R [not the file] containing the checkpointed results (by default, saved in an object called <code>checkpoint.result</code>) and the simulation will continue from that point. 
</p>
<p>Results are returned in a list, containing a dataframe with the outcome of the simulation (one row per edge in the tree, and containing information on the lengths, ancestor, tipward height from the original root, and state at the tipward end of the edge (you can get state at the rootward end by getting the tipward state of the ancestral edge). It may be of interest to know how many events of each type occurred, which is saved in <code>$birth.counts</code>, <code>$death.counts</code>, <code>$transition.counts</code>. The total number of surviving taxa is stored in <code>$n.surviving</code>. 
</p>
<p>The output can be returned as an ape <code>phylo</code> tree by passing the <code>$results</code> element of the final output to <code>SimToPhylo()</code>.
</p>


<h3>Value</h3>

<p>This returns a list, with the following elements:
</p>
<table>
<tr><td><code>$results</code></td>
<td>
<p>a dataframe containing the simulation output: states at nodes and tips, ancestor-descendant pairs, branch lengths.</p>
</td></tr>
<tr><td><code>$birth.counts</code></td>
<td>
<p>a vector, in the same state order as turnover.rates et al., that includes the counts for the number of times species in each state speciated.</p>
</td></tr>
<tr><td><code>$death.counts</code></td>
<td>
<p>same as birth.counts, but counting extinction events in each state outside of mass extinctions.</p>
</td></tr>
<tr><td><code>$mass.extinction.death.counts</code></td>
<td>
<p>total number of species that went extinct during a mass extinction event (which is assumed to be trait-independent).</p>
</td></tr>
<tr><td><code>$transition.counts</code></td>
<td>
<p>matrix of counts of transitions from one state to another.</p>
</td></tr>
<tr><td><code>$n.surviving</code></td>
<td>
<p>the number of taxa alive at the end of the simulation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Brian O'Meara</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
simulated.result &lt;- SimulateHisse(c(.3, .1), c(.1, 0), 
matrix(c(NA, 0.2, .3, NA), nrow=2), max.taxa=35, x0=1)	
par(mfcol=c(1,2))
plot(SimToPhylo(simulated.result$results, include.extinct=TRUE))
plot(SimToPhylo(simulated.result$results, include.extinct=FALSE))
 	
</code></pre>

<hr>
<h2 id='SummarizeMiSSEGreedy'>Summarize Results of the Greedy Algorithm</h2><span id='topic+SummarizeMiSSEGreedy'></span>

<h3>Description</h3>

<p>This provides an overview of all the examined models, including (optionally) a reconstruction of the diversification parameters across the models.</p>


<h3>Usage</h3>

<pre><code class='language-R'>SummarizeMiSSEGreedy(greedy.result, min.weight=0.01, n.cores=1, recon=TRUE) </code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SummarizeMiSSEGreedy_+3A_greedy.result">greedy.result</code></td>
<td>
<p>a list of misse.fit objects, returned from MiSSEGreedy or just a list of misse results more generally</p>
</td></tr>
<tr><td><code id="SummarizeMiSSEGreedy_+3A_min.weight">min.weight</code></td>
<td>
<p>what proportion of the AICc weight a model must have to be included in the model average</p>
</td></tr>
<tr><td><code id="SummarizeMiSSEGreedy_+3A_n.cores">n.cores</code></td>
<td>
<p>how many cores to use for parallelization</p>
</td></tr>
<tr><td><code id="SummarizeMiSSEGreedy_+3A_recon">recon</code></td>
<td>
<p>Boolean on whether to do the rate reconstructions</p>
</td></tr>
</table>


<h3>Details</h3>

<p>After doing a MiSSEGreedy run, this function provides an overview of the models. The overview object is a data.frame with columns for the model number, its AICc and related measures, the number of free parameters, how long that model took, and whether it is used to reconstruct the diversification parameters. Whether to include a model or not in a reconstruction is up to the user: including very bad models can lead to a reconstruction that is not very good (the model might have very low weight, but if the parameter estimate is still near infinity, for example, it could have a major impact). By default we use models with a weight of at least 0.01.
</p>
<p>The rates object is a 3d array: the dimensions are the tips and internal nodes, the parameters being estimated, and the model(s) being used. For example, if you store the SummarizeMiSSEGreedy() output as summarized_results, then summarized_results$rates[,&quot;extinction.fraction&quot;,&quot;best&quot;] is the extinction fraction estimates for the tips and internal nodes from the best model.
</p>


<h3>Value</h3>

<p><code>SummarizeMiSSEGreedy</code> returns a list of containing a data.frame with an overview of models (overview) and an array with rates (rates).
</p>


<h3>Author(s)</h3>

<p>Brian C. O'Meara</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models
of trait-dependent speciation and extinction. Syst. Biol. 65:583-601.
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation
and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Herrera-Alsina, L., P. van Els, and R.S. Etienne. 2018. Detecting the dependence of diversification on multiples traits from phylogenetic trees and trait data. Systematic Biology, 68:317-328.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters effect on
speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos.
Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='SupportRegion.old'>Adaptive Sampling of the Likelihood Surface</h2><span id='topic+SupportRegion.old'></span>

<h3>Description</h3>

<p>Adaptively samples points for each parameter to obtain an estimate of the confidence intervals.</p>


<h3>Usage</h3>

<pre><code class='language-R'>SupportRegion.old(hisse.old.obj, n.points=1000, scale.int=0.1, desired.delta=2, 
min.number.points=10, output.type="turnover", hidden.states=TRUE, 
condition.on.survival=TRUE, root.type="madfitz", root.p=NULL, verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SupportRegion.old_+3A_hisse.old.obj">hisse.old.obj</code></td>
<td>
<p>an object of class <code>hisse.old.fit</code> that contains the MLE from a model run.</p>
</td></tr>
<tr><td><code id="SupportRegion.old_+3A_n.points">n.points</code></td>
<td>
<p>indicates the number of points to sample.</p>
</td></tr>
<tr><td><code id="SupportRegion.old_+3A_scale.int">scale.int</code></td>
<td>
<p>the scaling multiplier that defines interval to randomly sample. By default the value is set to 0.1, meaning that values are drawn at random along an interval that encompasses 10 percent above and below the MLE.</p>
</td></tr>
<tr><td><code id="SupportRegion.old_+3A_desired.delta">desired.delta</code></td>
<td>
<p>defines the number lnL units away from the MLE to include. By default the value is set to 2.</p>
</td></tr> 
<tr><td><code id="SupportRegion.old_+3A_min.number.points">min.number.points</code></td>
<td>
<p>sets the minimum number of points that can be returned. By default the value is set to 10.</p>
</td></tr>
<tr><td><code id="SupportRegion.old_+3A_output.type">output.type</code></td>
<td>
<p>indicates whether the rates should be printed onscreen as the optimized variables, &ldquo;turnover&rdquo;, transformed to reflect net diversification, &ldquo;net.div&rdquo;, or transformed to reflect <code class="reqn">\lambda</code> and <code class="reqn">\mu</code>, &ldquo;raw&rdquo;.</p>
</td></tr>
<tr><td><code id="SupportRegion.old_+3A_hidden.states">hidden.states</code></td>
<td>
<p>a logical indicating whether the model includes a hidden state. The default is <code>TRUE</code>.</p>
</td></tr> 
<tr><td><code id="SupportRegion.old_+3A_condition.on.survival">condition.on.survival</code></td>
<td>
<p>a logical indicating whether the likelihood was conditioned on the survival of two lineages and the speciation event subtending them (Nee et al. 1994). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="SupportRegion.old_+3A_root.type">root.type</code></td>
<td>
<p>indicates whether root prior assumption should based the procedure described by FitzJohn et al. 2009, &ldquo;madfitz&rdquo;, assumed equal, &ldquo;equal&rdquo;, or set to user, &ldquo;user&rdquo;.</p>
</td></tr>
<tr><td><code id="SupportRegion.old_+3A_root.p">root.p</code></td>
<td>
<p>a vector indicating fixed root state probabilities. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="SupportRegion.old_+3A_verbose">verbose</code></td>
<td>
<p>a logical indicating whether progress should be printed to the screen. The default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function provides a means for sampling the likelihood surface quickly to estimate confidence intervals that reflect the uncertainty in the MLE. The function starts with the MLE from the hisse run. It then uses a scaling multiplier to generate an interval by which to randomly alter each parameter. However, the algorithm was designed to &ldquo;feel&rdquo; the boundaries of the random search. In other words, when the algorithm begins to sample the hinterlands of the surface, it will know to restrict the boundary to allow sampling of more reasonable values based on the currently sampled set. The goal of this sampling process is to find points within some desired distance from the MLE; by default we assume this distance is 2 lnLik. The confidence interval can be estimated directly from these points. The full set of points tried are also provided and can be used to generate contour plots (though, it is not entirely straightforward to do so &ndash; but certainly doable).
</p>
<p>Note the scale.int option. This roughly sets the variance for sampling points. If this seems to take a long while to find enough points within the desired likelihood region consider reducing scale.int to either 0.05 or, in some cases, 0.01. 
</p>


<h3>Value</h3>

<p><code>SupportRegion.old</code> returns an object of class <code>hisse.old.support</code>. This is a list with elements:
</p>
<table>
<tr><td><code>$ci</code></td>
<td>
<p>the sampled confidence interval.</p>
</td></tr>
<tr><td><code>$points.within.region</code></td>
<td>
<p>the sampled points that within 2lnL units from the MLE.</p>
</td></tr>
<tr><td><code>$all.points</code></td>
<td>
<p>all points sampled by the adaptive sampler.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters effect on speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos. Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='SupportRegionGeoSSE'>Adaptive Sampling of the Likelihood Surface under the new version of GeoHiSSE model</h2><span id='topic+SupportRegionGeoSSE'></span>

<h3>Description</h3>

<p>Adaptively samples points for each parameter to obtain an estimate of the confidence intervals.</p>


<h3>Usage</h3>

<pre><code class='language-R'>SupportRegionGeoSSE(geohisse.obj, n.points=1000, scale.int=0.1, desired.delta=2, 
min.number.points=10, verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SupportRegionGeoSSE_+3A_geohisse.obj">geohisse.obj</code></td>
<td>
<p>an object of class <code>geohisse.fit</code> that contains the MLE from a model run.</p>
</td></tr>
<tr><td><code id="SupportRegionGeoSSE_+3A_n.points">n.points</code></td>
<td>
<p>indicates the number of points to sample.</p>
</td></tr>
<tr><td><code id="SupportRegionGeoSSE_+3A_scale.int">scale.int</code></td>
<td>
<p>the scaling multiplier that defines interval to randomly sample. By default the value is set to 0.1, meaning that values are drawn at random along an interval that encompasses 10 percent above and below the MLE.</p>
</td></tr>
<tr><td><code id="SupportRegionGeoSSE_+3A_desired.delta">desired.delta</code></td>
<td>
<p>defines the number lnL units away from the MLE to include. By default the value is set to 2.</p>
</td></tr> 
<tr><td><code id="SupportRegionGeoSSE_+3A_min.number.points">min.number.points</code></td>
<td>
<p>sets the minimum number of points that can be returned. By default the value is set to 10.</p>
</td></tr>
<tr><td><code id="SupportRegionGeoSSE_+3A_verbose">verbose</code></td>
<td>
<p>a logical indicating whether progress should be printed to the screen. The default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function provides a means for sampling the likelihood surface quickly to estimate confidence intervals that reflect the uncertainty in the MLE. The function starts with the MLE from the hisse run. It then uses a scaling multiplier to generate an interval by which to randomly alter each parameter. However, the algorithm was designed to &ldquo;feel&rdquo; the boundaries of the random search. In other words, when the algorithm begins to sample the hinterlands of the surface, it will know to restrict the boundary to allow sampling of more reasonable values based on the currently sampled set. The goal of this sampling process is to find points within some desired distance from the MLE; by default we assume this distance is 2 lnLik. The confidence interval can be estimated directly from these points. The full set of points tried are also provided and can be used to generate contour plots (though, it is not entirely straightforward to do so &ndash; but certainly doable).
</p>
<p>Note the scale.int option. This roughly sets the variance for sampling points. If this seems to take a long while to find enough points within the desired likelihood region consider reducing scale.int to either 0.05 or, in some cases, 0.01.
</p>


<h3>Value</h3>

<p><code>SupportRegionGeoSSE.old</code> returns an object of class <code>geohisse.old.support</code>. This is a list with elements:
</p>
<table>
<tr><td><code>$ci</code></td>
<td>
<p>the sampled confidence interval.</p>
</td></tr>
<tr><td><code>$points.within.region</code></td>
<td>
<p>the sampled points that within 2lnL units from the MLE.</p>
</td></tr>
<tr><td><code>$all.points</code></td>
<td>
<p>all points sampled by the adaptive sampler.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters effect on speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos. Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='SupportRegionGeoSSE.old'>Adaptive Sampling of the Likelihood Surface under the original GeoHiSSE model</h2><span id='topic+SupportRegionGeoSSE.old'></span>

<h3>Description</h3>

<p>Adaptively samples points for each parameter to obtain an estimate of the confidence intervals.</p>


<h3>Usage</h3>

<pre><code class='language-R'>SupportRegionGeoSSE.old(geohisse.old.obj, n.points=1000, scale.int=0.1, desired.delta=2, 
min.number.points=10, verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SupportRegionGeoSSE.old_+3A_geohisse.old.obj">geohisse.old.obj</code></td>
<td>
<p>an object of class <code>geohisse.old.fit</code> that contains the MLE from a model run.</p>
</td></tr>
<tr><td><code id="SupportRegionGeoSSE.old_+3A_n.points">n.points</code></td>
<td>
<p>indicates the number of points to sample.</p>
</td></tr>
<tr><td><code id="SupportRegionGeoSSE.old_+3A_scale.int">scale.int</code></td>
<td>
<p>the scaling multiplier that defines interval to randomly sample. By default the value is set to 0.1, meaning that values are drawn at random along an interval that encompasses 10 percent above and below the MLE.</p>
</td></tr>
<tr><td><code id="SupportRegionGeoSSE.old_+3A_desired.delta">desired.delta</code></td>
<td>
<p>defines the number lnL units away from the MLE to include. By default the value is set to 2.</p>
</td></tr> 
<tr><td><code id="SupportRegionGeoSSE.old_+3A_min.number.points">min.number.points</code></td>
<td>
<p>sets the minimum number of points that can be returned. By default the value is set to 10.</p>
</td></tr>
<tr><td><code id="SupportRegionGeoSSE.old_+3A_verbose">verbose</code></td>
<td>
<p>a logical indicating whether progress should be printed to the screen. The default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function provides a means for sampling the likelihood surface quickly to estimate confidence intervals that reflect the uncertainty in the MLE. The function starts with the MLE from the hisse run. It then uses a scaling multiplier to generate an interval by which to randomly alter each parameter. However, the algorithm was designed to &ldquo;feel&rdquo; the boundaries of the random search. In other words, when the algorithm begins to sample the hinterlands of the surface, it will know to restrict the boundary to allow sampling of more reasonable values based on the currently sampled set. The goal of this sampling process is to find points within some desired distance from the MLE; by default we assume this distance is 2 lnLik. The confidence interval can be estimated directly from these points. The full set of points tried are also provided and can be used to generate contour plots (though, it is not entirely straightforward to do so &ndash; but certainly doable).
</p>
<p>Note the scale.int option. This roughly sets the variance for sampling points. If this seems to take a long while to find enough points within the desired likelihood region consider reducing scale.int to either 0.05 or, in some cases, 0.01.
</p>


<h3>Value</h3>

<p><code>SupportRegionGeoSSE.old</code> returns an object of class <code>geohisse.old.support</code>. This is a list with elements:
</p>
<table>
<tr><td><code>$ci</code></td>
<td>
<p>the sampled confidence interval.</p>
</td></tr>
<tr><td><code>$points.within.region</code></td>
<td>
<p>the sampled points that within 2lnL units from the MLE.</p>
</td></tr>
<tr><td><code>$all.points</code></td>
<td>
<p>all points sampled by the adaptive sampler.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters effect on speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos. Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='SupportRegionHiSSE'>Adaptive Sampling of the Likelihood Surface under the new version of HiSSE</h2><span id='topic+SupportRegionHiSSE'></span>

<h3>Description</h3>

<p>Adaptively samples points for each parameter to obtain an estimate of the confidence intervals.</p>


<h3>Usage</h3>

<pre><code class='language-R'>SupportRegionHiSSE(hisse.obj, n.points=1000, scale.int=0.1, desired.delta=2, 
min.number.points=10, verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SupportRegionHiSSE_+3A_hisse.obj">hisse.obj</code></td>
<td>
<p>an object of class <code>hisse.fit</code> that contains the MLE from a model run.</p>
</td></tr>
<tr><td><code id="SupportRegionHiSSE_+3A_n.points">n.points</code></td>
<td>
<p>indicates the number of points to sample.</p>
</td></tr>
<tr><td><code id="SupportRegionHiSSE_+3A_scale.int">scale.int</code></td>
<td>
<p>the scaling multiplier that defines interval to randomly sample. By default the value is set to 0.1, meaning that values are drawn at random along an interval that encompasses 10 percent above and below the MLE.</p>
</td></tr>
<tr><td><code id="SupportRegionHiSSE_+3A_desired.delta">desired.delta</code></td>
<td>
<p>defines the number lnL units away from the MLE to include. By default the value is set to 2.</p>
</td></tr> 
<tr><td><code id="SupportRegionHiSSE_+3A_min.number.points">min.number.points</code></td>
<td>
<p>sets the minimum number of points that can be returned. By default the value is set to 10.</p>
</td></tr>
<tr><td><code id="SupportRegionHiSSE_+3A_verbose">verbose</code></td>
<td>
<p>a logical indicating whether progress should be printed to the screen. The default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is the support region estimator for the new version of <code>hisse</code>. 
</p>
<p>Note the scale.int option. This roughly sets the variance for sampling points. If this seems to take a long while to find enough points within the desired likelihood region consider reducing scale.int to either 0.05 or, in some cases, 0.01. 
</p>


<h3>Value</h3>

<p><code>SupportRegionHiSSE</code> returns an object of class <code>hisse.support</code>. This is a list with elements:
</p>
<table>
<tr><td><code>$ci</code></td>
<td>
<p>the sampled confidence interval.</p>
</td></tr>
<tr><td><code>$points.within.region</code></td>
<td>
<p>the sampled points that within 2lnL units from the MLE.</p>
</td></tr>
<tr><td><code>$all.points</code></td>
<td>
<p>all points sampled by the adaptive sampler.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters effect on speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos. Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='SupportRegionMiSSE'>Adaptive Sampling of the Likelihood Surface under MiSSE</h2><span id='topic+SupportRegionMiSSE'></span>

<h3>Description</h3>

<p>Adaptively samples points for each parameter to obtain an estimate of the confidence intervals.</p>


<h3>Usage</h3>

<pre><code class='language-R'>SupportRegionMiSSE(misse.obj, n.points=1000, scale.int=0.1, desired.delta=2, 
min.number.points=10, verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SupportRegionMiSSE_+3A_misse.obj">misse.obj</code></td>
<td>
<p>an object of class <code>misse.fit</code> that contains the MLE from a model run.</p>
</td></tr>
<tr><td><code id="SupportRegionMiSSE_+3A_n.points">n.points</code></td>
<td>
<p>indicates the number of points to sample.</p>
</td></tr>
<tr><td><code id="SupportRegionMiSSE_+3A_scale.int">scale.int</code></td>
<td>
<p>the scaling multiplier that defines interval to randomly sample. By default the value is set to 0.1, meaning that values are drawn at random along an interval that encompasses 10 percent above and below the MLE.</p>
</td></tr>
<tr><td><code id="SupportRegionMiSSE_+3A_desired.delta">desired.delta</code></td>
<td>
<p>defines the number lnL units away from the MLE to include. By default the value is set to 2.</p>
</td></tr> 
<tr><td><code id="SupportRegionMiSSE_+3A_min.number.points">min.number.points</code></td>
<td>
<p>sets the minimum number of points that can be returned. By default the value is set to 10.</p>
</td></tr>
<tr><td><code id="SupportRegionMiSSE_+3A_verbose">verbose</code></td>
<td>
<p>a logical indicating whether progress should be printed to the screen. The default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function provides a means for sampling the likelihood surface quickly to estimate confidence intervals that reflect the uncertainty in the MLE. The function starts with the MLE from the hisse run. It then uses a scaling multiplier to generate an interval by which to randomly alter each parameter. However, the algorithm was designed to &ldquo;feel&rdquo; the boundaries of the random search. In other words, when the algorithm begins to sample the hinterlands of the surface, it will know to restrict the boundary to allow sampling of more reasonable values based on the currently sampled set. The goal of this sampling process is to find points within some desired distance from the MLE; by default we assume this distance is 2 lnLik. The confidence interval can be estimated directly from these points. The full set of points tried are also provided and can be used to generate contour plots (though, it is not entirely straightforward to do so &ndash; but certainly doable).
</p>
<p>Note the scale.int option. This roughly sets the variance for sampling points. If this seems to take a long while to find enough points within the desired likelihood region consider reducing scale.int to either 0.05 or, in some cases, 0.01. 
</p>


<h3>Value</h3>

<p><code>SupportRegionMiSSE</code> returns an object of class <code>misse.support</code>. This is a list with elements:
</p>
<table>
<tr><td><code>$ci</code></td>
<td>
<p>the sampled confidence interval.</p>
</td></tr>
<tr><td><code>$points.within.region</code></td>
<td>
<p>the sampled points that within 2lnL units from the MLE.</p>
</td></tr>
<tr><td><code>$all.points</code></td>
<td>
<p>all points sampled by the adaptive sampler.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters effect on speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos. Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='SupportRegionMuHiSSE'>Adaptive Sampling of the Likelihood Surface under MuHiSSE</h2><span id='topic+SupportRegionMuHiSSE'></span>

<h3>Description</h3>

<p>Adaptively samples points for each parameter to obtain an estimate of the confidence intervals.</p>


<h3>Usage</h3>

<pre><code class='language-R'>SupportRegionMuHiSSE(muhisse.obj, n.points=1000, scale.int=0.1, desired.delta=2, 
min.number.points=10, verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SupportRegionMuHiSSE_+3A_muhisse.obj">muhisse.obj</code></td>
<td>
<p>an object of class <code>muhisse.fit</code> that contains the MLE from a model run.</p>
</td></tr>
<tr><td><code id="SupportRegionMuHiSSE_+3A_n.points">n.points</code></td>
<td>
<p>indicates the number of points to sample.</p>
</td></tr>
<tr><td><code id="SupportRegionMuHiSSE_+3A_scale.int">scale.int</code></td>
<td>
<p>the scaling multiplier that defines interval to randomly sample. By default the value is set to 0.1, meaning that values are drawn at random along an interval that encompasses 10 percent above and below the MLE.</p>
</td></tr>
<tr><td><code id="SupportRegionMuHiSSE_+3A_desired.delta">desired.delta</code></td>
<td>
<p>defines the number lnL units away from the MLE to include. By default the value is set to 2.</p>
</td></tr> 
<tr><td><code id="SupportRegionMuHiSSE_+3A_min.number.points">min.number.points</code></td>
<td>
<p>sets the minimum number of points that can be returned. By default the value is set to 10.</p>
</td></tr>
<tr><td><code id="SupportRegionMuHiSSE_+3A_verbose">verbose</code></td>
<td>
<p>a logical indicating whether progress should be printed to the screen. The default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function provides a means for sampling the likelihood surface quickly to estimate confidence intervals that reflect the uncertainty in the MLE. The function starts with the MLE from the hisse run. It then uses a scaling multiplier to generate an interval by which to randomly alter each parameter. However, the algorithm was designed to &ldquo;feel&rdquo; the boundaries of the random search. In other words, when the algorithm begins to sample the hinterlands of the surface, it will know to restrict the boundary to allow sampling of more reasonable values based on the currently sampled set. The goal of this sampling process is to find points within some desired distance from the MLE; by default we assume this distance is 2 lnLik. The confidence interval can be estimated directly from these points. The full set of points tried are also provided and can be used to generate contour plots (though, it is not entirely straightforward to do so &ndash; but certainly doable).
</p>
<p>Note the scale.int option. This roughly sets the variance for sampling points. If this seems to take a long while to find enough points within the desired likelihood region consider reducing scale.int to either 0.05 or, in some cases, 0.01. 
</p>


<h3>Value</h3>

<p><code>SupportRegionMuHiSSE</code> returns an object of class <code>muhisse.support</code>. This is a list with elements:
</p>
<table>
<tr><td><code>$ci</code></td>
<td>
<p>the sampled confidence interval.</p>
</td></tr>
<tr><td><code>$points.within.region</code></td>
<td>
<p>the sampled points that within 2lnL units from the MLE.</p>
</td></tr>
<tr><td><code>$all.points</code></td>
<td>
<p>all points sampled by the adaptive sampler.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jeremy M. Beaulieu</p>


<h3>References</h3>

<p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models of trait-dependent speciation and extinction. Syst. Biol. 65:583-601. 
</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.
</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters effect on speciation and extinction. Syst. Biol. 56:701-710.
</p>
<p>Nakov, T., Beaulieu, J.M., and Alverson, A.J. 2019. Diatoms diversify and turn over faster in freshwater than marine environments. Evolution, doi: https://doi.org/10.1111/evo.13832.
</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos. Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.
</p>

<hr>
<h2 id='TipCorrelation'>Phylogenetic independent contrasts using tip rates</h2><span id='topic+TipCorrelation'></span>

<h3>Description</h3>

<p>Performs linear regression between phylogenetic independent contrasts (PICs) of tip rates and continuous trais</p>


<h3>Usage</h3>

<pre><code class='language-R'>TipCorrelation(phy, tip.rate, trait, log=TRUE, remove.cherries=TRUE, 
scaled=TRUE, positivise=TRUE, use.lmorigin=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="TipCorrelation_+3A_phy">phy</code></td>
<td>
<p>an ultrametric phylogenetic tree of class 'phylo'.</p>
</td></tr> 
<tr><td><code id="TipCorrelation_+3A_tip.rate">tip.rate</code></td>
<td>
<p>an object of class 'named numeric' containing tip.rates</p>
</td></tr>
<tr><td><code id="TipCorrelation_+3A_trait">trait</code></td>
<td>
<p>an object of class 'named numeric' containing continuous trait data</p>
</td></tr>
<tr><td><code id="TipCorrelation_+3A_log">log</code></td>
<td>
<p>Should tip.rate and trait values be logged before regression? The default is TRUE.</p>
</td></tr>
<tr><td><code id="TipCorrelation_+3A_remove.cherries">remove.cherries</code></td>
<td>
<p>Should PICs of 'cherries' be pruned before regression? The default is TRUE.</p>
</td></tr>
<tr><td><code id="TipCorrelation_+3A_scaled">scaled</code></td>
<td>
<p>Should PICs be scaled with their expected variances? The default to TRUE.</p>
</td></tr>
<tr><td><code id="TipCorrelation_+3A_positivise">positivise</code></td>
<td>
<p>Should PICs be positivised before regression? The default is TRUE.</p>
</td></tr>
<tr><td><code id="TipCorrelation_+3A_use.lmorigin">use.lmorigin</code></td>
<td>
<p>Should a regression-through-origin be performed instead of regular linear model? The default is TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Tip rates as those obtained with <code>MiSSEGreedy</code> are analogous to a continuous trait evolving in the tree and must also be corrected for phylogenetic 
non-independence before regression analyses. This function does that by using PICs (Felsenstein, 1985) and gives the additional option of removing PICs 
from 'cherries' from analyses. Cherries (theoretically) inherit the exact same rate class probabilities in any model that uses just branch lengths to estimate 
tip rates. For that reason, they may: (1) present identical tip rates, forcing the slope of the regression to be close to 0 since all PICs for cherries will be 0; 
and (2) constitute pseudoreplicates in the analyses. We suspect that, for that reason, it may make sense to prune them out from any PIC analyses that uses tip-rate
correlations from tree-only diversification approaches (see Vasconcelos et al. in prep.).
</p>


<h3>Value</h3>

<p>Returns an object that contains:
</p>
<table>
<tr><td><code>$correlation</code></td>
<td>
<p>summary of correlation results.</p>
</td></tr>
<tr><td><code>$tip.rate PIC</code></td>
<td>
<p>tip rate PICs for each node.</p>
</td></tr>
<tr><td><code>$trait PIC</code></td>
<td>
<p>trait PICs for each node.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Thais Vasconcelos and Brian O'Meara</p>


<h3>References</h3>

<p>Vasconcelos, T, B.C. O'Meara, and J.M. Beaulieu. In prep.
Felsenstein, J. (1985). Phylogenies and the comparative method. The American Naturalist, 125, 1-15.
</p>

<hr>
<h2 id='TranslateParsMakerGeoHiSSE'>Key to translate GeoHiSSE into ClaSSE</h2><span id='topic+TranslateParsMakerGeoHiSSE'></span>

<h3>Description</h3>

<p>Simulate key of parnames to translate between GeoHiSSE and ClaSSE models</p>


<h3>Usage</h3>

<pre><code class='language-R'>TranslateParsMakerGeoHiSSE(k, add.extinction, add.jumps)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="TranslateParsMakerGeoHiSSE_+3A_k">k</code></td>
<td>
<p>number of hidden states in the model. Minimum is 0 for a model
without hidden states (i.e., GeoSSE).</p>
</td></tr>
<tr><td><code id="TranslateParsMakerGeoHiSSE_+3A_add.extinction">add.extinction</code></td>
<td>
<p>if the extinction parameter should be separated from extirpation.</p>
</td></tr>
<tr><td><code id="TranslateParsMakerGeoHiSSE_+3A_add.jumps">add.jumps</code></td>
<td>
<p>if jumps between endemic areas should be added.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function will only return the parameters that are relevant for a
GeoHiSSE model. The ClaSSE model will have many more parameters. The
extra parameters of the ClaSSE model need to be all set to 0. The number
of parameters of the correspondent ClaSSE model given the parameter
<code>k</code> is given by:
</p>
<p>(k+1)*3
</p>


<h3>Value</h3>

<p>Function returns a matrix of characters names. Column 'classe.pars'
have the parameter names for a ClaSSE model and column 'geohisse.pars'
have the parameter names for the matching GeoHiSSE model.
</p>


<h3>Author(s)</h3>

<p>Daniel Caetano</p>

<hr>
<h2 id='TransMatMaker.old'>Transition Rate matrix generator</h2><span id='topic+TransMatMaker.old'></span><span id='topic+ParDrop'></span><span id='topic+ParEqual'></span>

<h3>Description</h3>

<p>Generates and manipulates the index of the rate parameters to be optimized</p>


<h3>Usage</h3>

<pre><code class='language-R'>TransMatMaker.old(hidden.states=FALSE)
ParDrop(rate.mat.index=NULL, drop.par=NULL)
ParEqual(rate.mat.index=NULL, eq.par=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="TransMatMaker.old_+3A_hidden.states">hidden.states</code></td>
<td>
<p>a logical indicating whether the underlying model includes hidden states. The default is <code>FALSE</code>.</p>
</td></tr> 
<tr><td><code id="TransMatMaker.old_+3A_rate.mat.index">rate.mat.index</code></td>
<td>
<p>A user-supplied rate matrix index to be manipulated.</p>
</td></tr>
<tr><td><code id="TransMatMaker.old_+3A_drop.par">drop.par</code></td>
<td>
<p>a vector of transitions to be dropped from the model.</p>
</td></tr>
<tr><td><code id="TransMatMaker.old_+3A_eq.par">eq.par</code></td>
<td>
<p>a vector of transitions pairs to be set equal.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Outputs the full index of the rate parameters that are to be optimized. The intention is that a user might want to see how the matrix is designed prior to an analysis and perhaps drop a few parameters beforehand due to some hypothesis that he or she might have. The resulting matrix is to be plugged directly into <code>hisse.old</code>.
</p>


<h3>Value</h3>

<p>Returns a rate matrix index
</p>

<hr>
<h2 id='TransMatMakerGeoHiSSE'>Transition Rate matrix generator for the GeoHiSSE model</h2><span id='topic+TransMatMakerGeoHiSSE'></span><span id='topic+TransMatMakerGeoHiSSE.old'></span>

<h3>Description</h3>

<p>Generates and manipulates the index of the transition rate parameters to be optimized.</p>


<h3>Usage</h3>

<pre><code class='language-R'>TransMatMakerGeoHiSSE(hidden.traits=0, make.null=FALSE, include.jumps=FALSE, 
	separate.extirpation=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="TransMatMakerGeoHiSSE_+3A_hidden.traits">hidden.traits</code></td>
<td>
<p>a numeric value with the number of hidden trait in
the model. The cannonical GeoSSE model has no hidden areas, so
<code>'hidden.traits=0'</code>. The default value is 0.</p>
</td></tr> 
<tr><td><code id="TransMatMakerGeoHiSSE_+3A_make.null">make.null</code></td>
<td>
<p>Sets the transition matrix to the null model such that (1)
transition rates from endemic to widespread areas (A -&gt; AB and B -&gt;
AB) are the same across all hidden areas and (2) the transition rates
between hidden areas (such as 0A &lt;-&gt; 1A) are the same for all areas.</p>
</td></tr>
<tr><td><code id="TransMatMakerGeoHiSSE_+3A_include.jumps">include.jumps</code></td>
<td>
<p>allows for 0-&gt;1 and 1-&gt;0 transitions.</p>
</td></tr>
<tr><td><code id="TransMatMakerGeoHiSSE_+3A_separate.extirpation">separate.extirpation</code></td>
<td>
<p>allows for 01-&gt;0 and 01-&gt;1 transitions.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Outputs the full index of the rate parameters that are to be optimized.
</p>
<p>The intention is that a user might want to see how the matrix is designed prior to an analysis and perhaps drop a few parameters beforehand due to some hypothesis that she might have. The resulting matrix is to be plugged directly into <code>GeoHiSSE</code>.
</p>


<h3>Value</h3>

<p>Returns a rate matrix index.
</p>

<hr>
<h2 id='TransMatMakerHiSSE'>Transition Rate matrix generator for the HiSSE model</h2><span id='topic+TransMatMakerHiSSE'></span>

<h3>Description</h3>

<p>Generates and manipulates the index of the transition rate parameters to be optimized.</p>


<h3>Usage</h3>

<pre><code class='language-R'>TransMatMakerHiSSE(hidden.traits=0, make.null=FALSE, cat.trans.vary=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="TransMatMakerHiSSE_+3A_hidden.traits">hidden.traits</code></td>
<td>
<p>a numeric value with the number of hidden states in
the model. The canonical BiSSE model has no hidden states, so
<code>'hidden.traits=0'</code>. The default value is 0.</p>
</td></tr> 
<tr><td><code id="TransMatMakerHiSSE_+3A_make.null">make.null</code></td>
<td>
<p>Sets the transition matrix to the null model such that (1)
transition rates are the same across all hidden states and (2) the transition rates
between hidden states (such as 0A &lt;-&gt; 1A) are the same.</p>
</td></tr>
<tr><td><code id="TransMatMakerHiSSE_+3A_cat.trans.vary">cat.trans.vary</code></td>
<td>
<p>sets transition among hidden categories to vary.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Outputs the full index of the rate parameters that are to be optimized.
</p>
<p>The intention is that a user might want to see how the matrix is designed prior to an analysis and perhaps drop a few parameters beforehand due to some hypothesis that she might have. The resulting matrix is to be plugged directly into <code>hisse</code>.
</p>


<h3>Value</h3>

<p>Returns a rate matrix index.
</p>

<hr>
<h2 id='TransMatMakerMuHiSSE'>Transition Rate matrix generator for the MuHiSSE model</h2><span id='topic+TransMatMakerMuHiSSE'></span>

<h3>Description</h3>

<p>Generates and manipulates the index of the transition rate parameters to be optimized.</p>


<h3>Usage</h3>

<pre><code class='language-R'>TransMatMakerMuHiSSE(hidden.traits=0, make.null=FALSE, include.diagonals=FALSE, 
cat.trans.vary=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="TransMatMakerMuHiSSE_+3A_hidden.traits">hidden.traits</code></td>
<td>
<p>a numeric value with the number of hidden states in
the model. The canonical MuSSE model has no hidden states, so
<code>'hidden.traits=0'</code>. The default value is 0.</p>
</td></tr> 
<tr><td><code id="TransMatMakerMuHiSSE_+3A_make.null">make.null</code></td>
<td>
<p>Sets the transition matrix to the null model such that (1)
transition rates are the same across all hidden states and (2) the transition rates
between hidden states (such as 00A &lt;-&gt; 01A) are the same.</p>
</td></tr>
<tr><td><code id="TransMatMakerMuHiSSE_+3A_include.diagonals">include.diagonals</code></td>
<td>
<p>allows for dual transitions, e.g., 00-&gt;11 and 11-&gt;00 transitions.</p>
</td></tr>
<tr><td><code id="TransMatMakerMuHiSSE_+3A_cat.trans.vary">cat.trans.vary</code></td>
<td>
<p>sets transitions among hidden categories to vary.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Outputs the full index of the rate parameters that are to be optimized.
</p>
<p>The intention is that a user might want to see how the matrix is designed prior to an analysis and perhaps drop a few parameters beforehand due to some hypothesis that she might have. The resulting matrix is to be plugged directly into <code>MuHiSSE</code>.
</p>


<h3>Value</h3>

<p>Returns a rate matrix index.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
