<!DOCTYPE html><html><head><title>Help for package wrswoR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {wrswoR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#sample_int_crank'><p>Weighted sampling without replacement</p></a></li>
<li><a href='#wrswoR-package'><p>Faster weighted sampling without replacement</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Weighted Random Sampling without Replacement</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2020-07-26</td>
</tr>
<tr>
<td>Description:</td>
<td>A collection of implementations of classical and
    novel algorithms for weighted sampling without replacement.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="http://krlmlr.github.io/wrswoR">http://krlmlr.github.io/wrswoR</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/krlmlr/wrswoR/issues">https://github.com/krlmlr/wrswoR/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.0.2)</td>
</tr>
<tr>
<td>Imports:</td>
<td>logging (&ge; 0.4-13), Rcpp</td>
</tr>
<tr>
<td>Suggests:</td>
<td>BatchExperiments, BiocManager, dplyr, ggplot2, import, kimisc
(&ge; 0.2-4), knitcitations, knitr, metap, microbenchmark,
rmarkdown, roxygen2, rticles (&ge; 0.1), sampling, testthat,
tidyr, tikzDevice (&ge; 0.9-1)</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp (&ge; 0.11.5)</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1.9000</td>
</tr>
<tr>
<td>URLNote:</td>
<td>https://github.com/krlmlr/wrswoR</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-07-26 17:53:56 UTC; kirill</td>
</tr>
<tr>
<td>Author:</td>
<td>Kirill Müller [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Kirill Müller &lt;krlmlr+r@mailbox.org&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-07-26 18:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='sample_int_crank'>Weighted sampling without replacement</h2><span id='topic+sample_int_crank'></span><span id='topic+sample_int_ccrank'></span><span id='topic+sample_int_expj'></span><span id='topic+sample_int_expjs'></span><span id='topic+sample_int'></span><span id='topic+sample_int_R'></span><span id='topic+sample_int_rank'></span><span id='topic+sample_int_rej'></span>

<h3>Description</h3>

<p>These functions implement weighted sampling without replacement using various
algorithms, i.e., they take a sample of the specified
<code>size</code> from the elements of <code>1:n</code> without replacement, using the
weights defined by <code>prob</code>.  The call
<code style="white-space: pre;">&#8288;sample_int_*(n, size, prob)&#8288;</code> is equivalent
to <code>sample.int(n, size, replace = F, prob)</code>.  (The results will
most probably be different for the same random seed, but the
returned samples are distributed identically for both calls.)
Except for <code>sample_int_R()</code> (which
has quadratic complexity as of this writing), all functions have complexity
<code class="reqn">O(n \log n)</code> or better and
often run faster than R's implementation, especially when <code>n</code> and
<code>size</code> are large.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sample_int_crank(n, size, prob)

sample_int_ccrank(n, size, prob)

sample_int_expj(n, size, prob)

sample_int_expjs(n, size, prob)

sample_int_R(n, size, prob)

sample_int_rank(n, size, prob)

sample_int_rej(n, size, prob)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sample_int_crank_+3A_n">n</code></td>
<td>
<p>a positive number, the number of items to choose from.  See
&lsquo;Details.&rsquo;</p>
</td></tr>
<tr><td><code id="sample_int_crank_+3A_size">size</code></td>
<td>
<p>a non-negative integer giving the number of items to choose.</p>
</td></tr>
<tr><td><code id="sample_int_crank_+3A_prob">prob</code></td>
<td>
<p>a vector of probability weights for obtaining the elements
of the vector being sampled.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>sample_int_R()</code> is a simple wrapper for <code><a href="base.html#topic+sample">base::sample.int()</a></code>.
</p>
<p><code>sample_int_expj()</code> and <code>sample_int_expjs()</code>
implement one-pass random sampling with a reservoir with exponential jumps
(Efraimidis and Spirakis, 2006, Algorithm A-ExpJ).  Both functions are
implemented in <code>Rcpp</code>; <code style="white-space: pre;">&#8288;*_expj()&#8288;</code> uses log-transformed keys,
<code style="white-space: pre;">&#8288;*_expjs()&#8288;</code> implements the algorithm in the paper verbatim
(at the cost of numerical stability).
</p>
<p><code>sample_int_rank()</code>, <code>sample_int_crank()</code> and
<code>sample_int_ccrank()</code> implement one-pass random sampling
(Efraimidis and Spirakis, 2006, Algorithm A).  The first function is
implemented purely in R, the other two are optimized <code>Rcpp</code>
implementations (<code style="white-space: pre;">&#8288;*_crank()&#8288;</code> uses R vectors internally, while
<code style="white-space: pre;">&#8288;*_ccrank()&#8288;</code> uses <code>std::vector</code>; surprisingly, <code style="white-space: pre;">&#8288;*_crank()&#8288;</code> seems
to be faster on most inputs). It can be
shown that the order statistic of <code class="reqn">U^{(1/w_i)}</code> has the same
distribution as random sampling without replacement (<code class="reqn">U=\mbox{uniform}(0,1)</code>
distribution). To increase numerical stability, <code class="reqn">\log(U) /
  w_i</code> is computed instead; the log transform does not
change the order statistic.
</p>
<p><code>sample_int_rej()</code> uses repeated weighted sampling with
replacement and a variant of rejection sampling. It is implemented purely
in R.
This function simulates weighted sampling without replacement using
somewhat more draws <em>with</em> replacement, and then discarding
duplicate values (rejection sampling).  If too few items are
sampled, the routine calls itself recursively on a (hopefully) much
smaller problem.  See also
<a href="http://stats.stackexchange.com/q/20590/6432">http://stats.stackexchange.com/q/20590/6432</a>.
</p>


<h3>Value</h3>

<p>An integer vector of length <code>size</code> with elements from
<code>1:n</code>.
</p>


<h3>Author(s)</h3>

<p>Dinre (for <code style="white-space: pre;">&#8288;*_rank()&#8288;</code>), Kirill Müller
(for all other functions)
</p>


<h3>References</h3>

<p><a href="https://stackoverflow.com/q/15113650/946850">https://stackoverflow.com/q/15113650/946850</a>
</p>
<p>Efraimidis, Pavlos S., and Paul G. Spirakis. &quot;Weighted
random sampling with a reservoir.&quot; <em>Information Processing
Letters</em> 97, no. 5 (2006): 181-185.
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+sample">base::sample.int()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Base R implementation
s &lt;- sample_int_R(2000, 1000, runif(2000))
stopifnot(unique(s) == s)
p &lt;- c(995, rep(1, 5))
n &lt;- 1000
set.seed(42)
tbl &lt;- table(replicate(sample_int_R(6, 3, p),
                       n = n)) / n
stopifnot(abs(tbl - c(1, rep(0.4, 5))) &lt; 0.04)

## Algorithm A, Rcpp version using std::vector
s &lt;- sample_int_ccrank(20000, 10000, runif(20000))
stopifnot(unique(s) == s)
p &lt;- c(995, rep(1, 5))
n &lt;- 1000
set.seed(42)
tbl &lt;- table(replicate(sample_int_ccrank(6, 3, p),
                       n = n)) / n
stopifnot(abs(tbl - c(1, rep(0.4, 5))) &lt; 0.04)

## Algorithm A, Rcpp version using R vectors
s &lt;- sample_int_crank(20000, 10000, runif(20000))
stopifnot(unique(s) == s)
p &lt;- c(995, rep(1, 5))
n &lt;- 1000
set.seed(42)
tbl &lt;- table(replicate(sample_int_crank(6, 3, p),
                       n = n)) / n
stopifnot(abs(tbl - c(1, rep(0.4, 5))) &lt; 0.04)

## Algorithm A-ExpJ (with log-transformed keys)
s &lt;- sample_int_expj(20000, 10000, runif(20000))
stopifnot(unique(s) == s)
p &lt;- c(995, rep(1, 5))
n &lt;- 1000
set.seed(42)
tbl &lt;- table(replicate(sample_int_expj(6, 3, p),
                       n = n)) / n
stopifnot(abs(tbl - c(1, rep(0.4, 5))) &lt; 0.04)

## Algorithm A-ExpJ (paper version)
s &lt;- sample_int_expjs(20000, 10000, runif(20000))
stopifnot(unique(s) == s)
p &lt;- c(995, rep(1, 5))
n &lt;- 1000
set.seed(42)
tbl &lt;- table(replicate(sample_int_expjs(6, 3, p),
                       n = n)) / n
stopifnot(abs(tbl - c(1, rep(0.4, 5))) &lt; 0.04)

## Algorithm A
s &lt;- sample_int_rank(20000, 10000, runif(20000))
stopifnot(unique(s) == s)
p &lt;- c(995, rep(1, 5))
n &lt;- 1000
set.seed(42)
tbl &lt;- table(replicate(sample_int_rank(6, 3, p),
                       n = n)) / n
stopifnot(abs(tbl - c(1, rep(0.4, 5))) &lt; 0.04)

## Rejection sampling
s &lt;- sample_int_rej(20000, 10000, runif(20000))
stopifnot(unique(s) == s)
p &lt;- c(995, rep(1, 5))
n &lt;- 1000
set.seed(42)
tbl &lt;- table(replicate(sample_int_rej(6, 3, p),
                       n = n)) / n
stopifnot(abs(tbl - c(1, rep(0.4, 5))) &lt; 0.04)

</code></pre>

<hr>
<h2 id='wrswoR-package'>Faster weighted sampling without replacement</h2><span id='topic+wrswoR-package'></span><span id='topic+wrswoR'></span>

<h3>Description</h3>

<p><span class="rlang"><b>R</b></span>'s default sampling without replacement using
<code><a href="base.html#topic+sample">base::sample.int()</a></code> seems to require quadratic run time,
e.g., when using weights drawn from a uniform distribution. For large
sample sizes, this is too slow.  This package contains several
alternative implementations.
</p>


<h3>Details</h3>

<p>Implementations are adapted from
<a href="https://stackoverflow.com/q/15113650/946850">https://stackoverflow.com/q/15113650/946850</a>.
</p>


<h3>Author(s)</h3>

<p>Kirill Müller
</p>


<h3>References</h3>

<p>Efraimidis, Pavlos S., and Paul G. Spirakis. &quot;Weighted
random sampling with a reservoir.&quot; <em>Information Processing Letters</em> 97,
no. 5 (2006): 181-185.
</p>
<p>Wong, Chak-Kuen, and Malcolm C. Easton. &quot;An efficient method for
weighted sampling without replacement.&quot; <em>SIAM Journal on Computing</em> 9,
no. 1 (1980): 111-113.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sample_int_rej(100, 50, 1:100)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
