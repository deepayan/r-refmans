<!DOCTYPE html><html><head><title>Help for package osDesign</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {osDesign}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#beta0'>
<p>Calculate the intercept of a logistic regression model, given a vector of log-odds ratio parameters and an overall prevalence.</p></a></li>
<li><a href='#ccPower'>
<p>Simulation-based estimation of power for the case-control design</p></a></li>
<li><a href='#ccSim'>
<p>Simulation function for case-control study designs.</p></a></li>
<li><a href='#infants'>
<p>Infant mortality data from North Carolina</p></a></li>
<li><a href='#Ohio'>
<p>Ohio lung cancer data</p></a></li>
<li><a href='#phaseI'>
<p>Expected phase I stratification</p></a></li>
<li><a href='#plotPower'>
<p>Plot function for power, based on two-phase and case-control design</p></a></li>
<li><a href='#rmvhyper'>
<p>Random generation for the multivariate hypergeometric distribution</p></a></li>
<li><a href='#tps'>
<p>Estimation for two-phase designs.</p></a></li>
<li><a href='#tpsPower'>
<p>Simulation-based estimation of power for the two-phase study design</p></a></li>
<li><a href='#tpsSim'>
<p>Simulation function for two-phase study designs.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Design, Planning and Analysis of Observational Studies</td>
</tr>
<tr>
<td>Version:</td>
<td>1.8</td>
</tr>
<tr>
<td>Date:</td>
<td>2020-12-11</td>
</tr>
<tr>
<td>Author:</td>
<td>Sebastien Haneuse, Takumi Saegusa, Nilanjan Chaterjee, Norman Breslow</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Sebastien Haneuse &lt;shaneuse@hsph.harvard.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>A suite of functions for the design of case-control and two-phase studies, and the analysis of data that arise from them. Functions in this packages provides Monte Carlo based evaluation of operating characteristics such as powers for estimators of the components of a logistic regression model. For additional detail see: Haneuse S, Saegusa T and Lumley T (2011)&lt;<a href="https://doi.org/10.18637%2Fjss.v043.i11">doi:10.18637/jss.v043.i11</a>&gt;.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-11-15 20:30:21 UTC; sebastienhaneuse</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-11-15 23:40:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='beta0'>
Calculate the intercept of a logistic regression model, given a vector of log-odds ratio parameters and an overall prevalence.
</h2><span id='topic+beta0'></span>

<h3>Description</h3>

<p>When conducting power calculations, one is often interested in examining power for various 'effect sizes'. Suppose the logistic regression is specified via the vector of coefficients (<code>beta0</code>, <code>betaX</code>); the first element is the intercept and the second consists of a vector of log odds ratio parameters. In many settings, the overall outcome prevalence in the population of interest is known or, at least, fixed. Modifying any given element of <code>betaX</code> will automatically modify the overall prevalence, unless there is a corresponding change in <code>beta0</code>. The function <code>beta0()</code> calculates the value of <code>beta0</code> that minimizes the difference between the target outcome prevalence, <code>rhoY</code>, and prevalence induced by the model in conjuction with the assumed marginal exposure distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>beta0(betaX, X, N, rhoY, expandX="all")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="beta0_+3A_betax">betaX</code></td>
<td>

<p>Numeric vector of log-odds ratio parameters for the logistic regression model.
</p>
</td></tr>
<tr><td><code id="beta0_+3A_x">X</code></td>
<td>

<p>Design matrix for the logistic regression model. The first column should correspond to intercept. For each exposure, the baseline group should be coded as 0, the first level as 1, and so on.
</p>
</td></tr>
<tr><td><code id="beta0_+3A_n">N</code></td>
<td>

<p>A numeric vector providing the sample size for each row of the design matrix, <code>X</code>. 
</p>
</td></tr>
<tr><td><code id="beta0_+3A_rhoy">rhoY</code></td>
<td>

<p>Target outcome prevalence in the population.
</p>
</td></tr>
<tr><td><code id="beta0_+3A_expandx">expandX</code></td>
<td>

<p>Character vector indicating which columns of <code>X</code> to expand as a series of dummy variables. Useful when at least one exposure is continuous (and should not be expanded). Default is &lsquo;all&rsquo;; the other option is &lsquo;none&rsquo; or character vector of column names.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The minimization is performed using the <code><a href="stats.html#topic+optimize">optimize</a></code> function.
</p>


<h3>Value</h3>

<p>Numeric value of the intercept parameter in a logistic regression model. 
</p>


<h3>Author(s)</h3>

<p>Sebastien Haneuse, Takumi Saegusa
</p>


<h3>References</h3>

<p>Haneuse, S. and Saegusa, T. and Lumley, T. (2011) &quot;osDesign: An R Package for the Analysis, Evaluation, and Design of Two-Phase and Case-Control Studies.&quot; Journal of Statistical Software, 43(11), 1-29.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##
data(Ohio)

## 
XM   &lt;- cbind(Int=1, Ohio[,1:3])
fitM &lt;- glm(cbind(Death, N-Death) ~ factor(Age) + Sex + Race, data=Ohio,
            family=binomial)

## Overall prevalence in the observed data
##
sum(Ohio$Death)/sum(Ohio$N)

## Intercept corresponding to the original vector of log-odds ratios
## 
fitM$coef
beta0(betaX=fitM$coef[-1], X=XM, N=Ohio$N, rhoY=sum(Ohio$Death)/sum(Ohio$N))

## Reduction of Sex effect by 50%
##
betaXm    &lt;- fitM$coef[-1]
betaXm[3] &lt;- betaXm[3] * 0.5
beta0(betaX=betaXm, X=XM, N=Ohio$N, rhoY=sum(Ohio$Death)/sum(Ohio$N))

## Doubling of Race effect
##
betaXm    &lt;- fitM$coef[-1]
betaXm[4] &lt;- betaXm[4] * 2
beta0(betaX=betaXm, X=XM, N=Ohio$N, rhoY=sum(Ohio$Death)/sum(Ohio$N))
</code></pre>

<hr>
<h2 id='ccPower'>
Simulation-based estimation of power for the case-control design
</h2><span id='topic+ccPower'></span>

<h3>Description</h3>

<p>Monte Carlo based estimation of statistical power for maximum likelihood estimator (MLE) of the components of a logistic regression model, based on the case-control design.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ccPower(B=1000, betaTruth, X, N, expandX="all", etaTerms=NULL,
        nCC, r=1, alpha=0.05,
        digits=1, betaNames=NULL, monitor=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ccPower_+3A_b">B</code></td>
<td>

<p>The number of datasets generated by the simulation.
</p>
</td></tr>
<tr><td><code id="ccPower_+3A_betatruth">betaTruth</code></td>
<td>

<p>Regression coefficients from the logistic regression model.
</p>
</td></tr>
<tr><td><code id="ccPower_+3A_x">X</code></td>
<td>

<p>Design matrix for the logistic regression model. The first column should correspond to intercept. For each exposure, the baseline group should be coded as 0, the first level as 1, and so on.
</p>
</td></tr>
<tr><td><code id="ccPower_+3A_n">N</code></td>
<td>

<p>A numeric vector providing the sample size for each row of the design matrix, <code>X</code>. 
</p>
</td></tr>
<tr><td><code id="ccPower_+3A_expandx">expandX</code></td>
<td>

<p>Character vector indicating which columns of <code>X</code> to expand as a series of dummy variables. Useful when at least one exposure is continuous (and should not be expanded). Default is &lsquo;all&rsquo;; other options include &lsquo;none&rsquo; or character vector of column names. See Details, below.
</p>
</td></tr>
<tr><td><code id="ccPower_+3A_etaterms">etaTerms</code></td>
<td>

<p>Character vector indicating which columns of <code>X</code> are to be included in the model. See Details, below.
</p>
</td></tr>
<tr><td><code id="ccPower_+3A_ncc">nCC</code></td>
<td>

<p>A numeric value indicating the total case-control sample size. If a vector is provided, separate simulations are run for each value.
</p>
</td></tr>
<tr><td><code id="ccPower_+3A_r">r</code></td>
<td>

<p>A numeric value indicating the control:case ratio in the case-control sample.
</p>
</td></tr>
<tr><td><code id="ccPower_+3A_alpha">alpha</code></td>
<td>

<p>Type I error rate assumed for the evaluation of coverage probabilities and power.
</p>
</td></tr>
<tr><td><code id="ccPower_+3A_digits">digits</code></td>
<td>

<p>Integer indicating the precision to be used for the output.
</p>
</td></tr>
<tr><td><code id="ccPower_+3A_betanames">betaNames</code></td>
<td>

<p>An optional character vector of names for the regression coefficients, <code>betaTruth</code>.
</p>
</td></tr>
<tr><td><code id="ccPower_+3A_monitor">monitor</code></td>
<td>

<p>Numeric value indicating how often <code>ccPower()</code> reports real-time progress on the simulation, as the <code>B</code> datasets are generated and evaluated. The default of <code>NULL</code> indicates no output.
</p>
</td></tr>     
</table>


<h3>Details</h3>

<p>A simulation study is conducted to evaluate statistical power for the MLE of a logistic regression model, based on the case-control design. The overall simulation approach is the same as that described in <code><a href="#topic+ccSim">ccSim</a></code>. Power is estimated as the proportion of simulated datasets for which a hypothesis test of no effect is rejected. Each hypothesis test is performed using the generic <code><a href="stats.html#topic+glm">glm</a></code> function.
</p>
<p>The correspondence between <code>betaTruth</code> and <code>X</code>, specifically the ordering of elements, is based on successive use of <code><a href="base.html#topic+factor">factor</a></code> to each column of <code>X</code> which is expanded via the <code>expandX</code> argument. Each exposure that is expanded must conform to a 0, 1, 2, ... integer-based coding convention.
</p>
<p>The <code>etaTerms</code> argument is useful when only certain columns in <code>X</code> are to be included in the model.
</p>
<p>A balanced case-control design is specified by setting <code>r</code>=1; setting <code>r</code>=2 indicates twice as many controls are sampled, relative to the number cases, from the total <code>nCC</code>.
</p>
<p>When evaluating operating characteristics of the MLE, some simulated datasets may result in unusually large or small estimates. Particularly, when the the case-control sample size, <code>nCC</code>, is small. In some settings, it may be desirable to truncate the Monte Carlo sampling distribution prior to evaluating operating characteristics. The <code>threshold</code> argument indicates the interval beyond which MLEs are ignored. The default is such that all <code>B</code> datasets are kept.
</p>


<h3>Value</h3>

<p><code>ccPower()</code> returns an object of class &quot;ccPower&quot;, a list containing all the input arguments, as well as the following components:
</p>
<table>
<tr><td><code>betaPower</code></td>
<td>

<p>Power against the null hypothesis that the regression coefficient is zero for a Wald-based test with an <code>alpha</code> type I error rate.
</p>
</td></tr>
<tr><td><code>failed</code></td>
<td>

<p>A vector consisting of the number of datasets excluded from the power calculations (i.e. set to <code>NA</code>), for each simulation performed. For power calculations, the two reasons are: (1) lack of convergence indicated by <code>NA</code> point estimates returned by <code><a href="stats.html#topic+glm">glm</a></code>, (2) lack of convergence indicated by <code>NA</code> standard error point estimates returned by <code><a href="stats.html#topic+glm">glm</a></code>.
</p>
</td></tr>
</table>


<h3>Note</h3>

<p>A generic print method provides formatted output of the results.
</p>
<p>A generic plot function <code><a href="#topic+plotPower">plotPower</a></code> provides plots of powers against different sample sizes for each estimate of a regression coefficient.
</p>


<h3>Author(s)</h3>

<p>Sebastien Haneuse, Takumi Saegusa
</p>


<h3>References</h3>

<p>Prentice, R. and Pyke, R. (1979) &quot;Logistic disease incidence models and case-control studies.&quot; Biometrika 66:403-411.
</p>
<p>Haneuse, S. and Saegusa, T. and Lumley, T. (2011) &quot;osDesign: An R Package for the Analysis, Evaluation, and Design of Two-Phase and Case-Control Studies.&quot; Journal of Statistical Software, 43(11), 1-29.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##
data(Ohio)

## 
XM   &lt;- cbind(Int=1, Ohio[,1:3])
fitM &lt;- glm(cbind(Death, N-Death) ~ factor(Age) + Sex + Race, data=Ohio,
            family=binomial)
betaNamesM &lt;- c("Int", "Age1", "Age2", "Sex", "Race")

## Power for a single CC design
##
ccResult1 &lt;- ccPower(B=100, betaTruth=fitM$coef, X=XM, N=Ohio$N, r=1,
                     nCC=500, betaNames=betaNamesM, monitor=10)
ccResult1

## Power for the CC design, based on a balanced design with 
## various sample sizes
##

ccResult2 &lt;- ccPower(B=1000, betaTruth=fitM$coef, X=XM, N=Ohio$N, r=1,
                     nCC=seq(from=100, to=500, by=50),
                     betaNames=betaNamesM, monitor=100)
ccResult2

## Recalculate power for the setting where the age coefficients are
## halved from their observed true values
##   * the intercept is modified, accordingly, using the beta0() function
##
newBetaM      &lt;- fitM$coef
newBetaM[2:3] &lt;- newBetaM[2:3] / 2
newBetaM[1]   &lt;- beta0(betaX=newBetaM[-1], X=XM, N=Ohio$N,
rhoY=sum(Ohio$Death)/sum(Ohio$N))
##

ccResult3 &lt;- ccPower(B=1000, betaTruth=newBetaM, X=XM, N=Ohio$N,
                     r=1, nCC=seq(from=100, to=500, by=50),
                     betaNames=betaNamesM,
                     monitor=100)
ccResult3
</code></pre>

<hr>
<h2 id='ccSim'>
Simulation function for case-control study designs.
</h2><span id='topic+ccSim'></span>

<h3>Description</h3>

<p>Monte Carlo based evaluation of operating characteristics of the maximum likelihood estimator (MLE) for the coefficients of a logistic regression model, based on the case-control.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ccSim(B=1000, betaTruth, X, N,  expandX="all", etaTerms=NULL,
      nCC, r, refDesign=1, alpha=0.05,
      threshold=c(-Inf, Inf), digits=1, betaNames=NULL,
      monitor=NULL, returnRaw=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ccSim_+3A_b">B</code></td>
<td>

<p>The number of datasets generated by the simulation.
</p>
</td></tr>
<tr><td><code id="ccSim_+3A_betatruth">betaTruth</code></td>
<td>

<p>Regression coefficients from the logistic regression model.
</p>
</td></tr>
<tr><td><code id="ccSim_+3A_x">X</code></td>
<td>

<p>Design matrix for the logistic regression model. The first column should correspond to intercept. For each exposure, the baseline group should be coded as 0, the first level as 1, and so on.
</p>
</td></tr>
<tr><td><code id="ccSim_+3A_n">N</code></td>
<td>

<p>A numeric vector providing the sample size for each row of the design matrix, <code>X</code>. 
</p>
</td></tr>
<tr><td><code id="ccSim_+3A_expandx">expandX</code></td>
<td>

<p>Character vector indicating which columns of <code>X</code> to expand as a series of dummy variables. Useful when at least one exposure is continuous (and should not be expanded). Default is &lsquo;all&rsquo;; other options include &lsquo;none&rsquo; or character vector of column names. See Details, below.
</p>
</td></tr>
<tr><td><code id="ccSim_+3A_etaterms">etaTerms</code></td>
<td>

<p>Character vector indicating which columns of <code>X</code> are to be included in the model. See Details, below.
</p>
</td></tr>
<tr><td><code id="ccSim_+3A_ncc">nCC</code></td>
<td>

<p>A numeric value indicating the total case-control sample size. 
</p>
</td></tr>
<tr><td><code id="ccSim_+3A_r">r</code></td>
<td>

<p>A numeric value indicating the control:case ratio in the case-control sample. If a vector is provided, separate simulations are run for each value.
</p>
</td></tr>
<tr><td><code id="ccSim_+3A_refdesign">refDesign</code></td>
<td>

<p>A numeric value indicating the control:case ratio for the referent design (for the relative uncertainty calculation).
</p>
</td></tr>
<tr><td><code id="ccSim_+3A_alpha">alpha</code></td>
<td>

<p>Type I error rate assumed for the evaluation of coverage probabilities and power.
</p>
</td></tr>
<tr><td><code id="ccSim_+3A_threshold">threshold</code></td>
<td>

<p>An interval that specifies truncation of the Monte Carlo sampling distribution of the MLE.
</p>
</td></tr>
<tr><td><code id="ccSim_+3A_digits">digits</code></td>
<td>

<p>Integer indicating the precision to be used for the output.
</p>
</td></tr>
<tr><td><code id="ccSim_+3A_betanames">betaNames</code></td>
<td>

<p>An optional character vector of names for the regression coefficients, <code>betaTruth</code>.
</p>
</td></tr>
<tr><td><code id="ccSim_+3A_monitor">monitor</code></td>
<td>

<p>Numeric value indicating how often <code>ccSim()</code> reports real-time progress on the simulation, as the <code>B</code> datasets are generated and evaluated. The default of <code>NULL</code> indicates no output.
</p>
</td></tr>
<tr><td><code id="ccSim_+3A_returnraw">returnRaw</code></td>
<td>

<p>Logical indicator of whether or not the raw coefficient and standard error estimates for each of the design/estimator combinations should be returned.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A simulation study is performed to evaluate the operating
characteristics of the MLE for <code>betaTruth</code> from a case-control
design (Prentice and Pyke, 1979). The operating characteristics are
evaluated using the Monte Carlo sampling distribution of the
estimator. The latter is generated using the following steps:
</p>

<ul>
<li><p>(i) Specify the (joint) marginal exposure distribution of underlying population, using <code>X</code> and <code>N</code>. 
</p>
</li>
<li><p>(ii) Simulate outcomes for all sum(<code>N</code>) individuals in the population, based on an underlying logistic regression model specified via <code>betaTruth</code>.
</p>
</li>
<li><p>(iii) Sample <code>n0</code> controls and <code>n1</code> cases, on the basis of <code>nCC</code> and <code>r</code>.
</p>
</li>
<li><p>(iv) Evaluate the MLE estimator, its estimated standard error and store the results.
</p>
</li>
<li><p>(v) Repeat steps (ii)-(iv) <code>B</code> times.
</p>
</li></ul>

<p>All case-control MLEs are evaluated using the generic <code><a href="stats.html#topic+glm">glm</a></code> function.
</p>
<p>The correspondence between <code>betaTruth</code> and <code>X</code>, specifically the ordering of elements, is based on successive use of <code><a href="base.html#topic+factor">factor</a></code> to each column of <code>X</code> which is expanded via the <code>expandX</code> argument. Each exposure that is expanded must conform to a 0, 1, 2, ... integer-based coding convention.
</p>
<p>The <code>etaTerms</code> argument is useful when only certain columns in <code>X</code> are to be included in the model.
</p>
<p>When evaluating operating characteristics of the MLE, some simulated datasets may result in unusually large or small estimates. Particularly, when the the case-control sample size, <code>nCC</code>, is small. In some settings, it may be desirable to truncate the Monte Carlo sampling distribution prior to evaluating operating characteristics. The <code>threshold</code> argument indicates the interval beyond which MLEs are ignored. The default is such that all <code>B</code> datasets are kept.
</p>


<h3>Value</h3>

<p><code>ccSim()</code> returns an object of class &quot;ccSim&quot;, a list containing all the input arguments, as well list <code>results</code> with the following components:
</p>
<table>
<tr><td><code>betaMean</code></td>
<td>

<p>Mean of the Monte Carlo sampling distribution for each regression coefficient estimator.
</p>
</td></tr>
<tr><td><code>betaMeanBias</code></td>
<td>

<p>Bias based on the mean, calculated as <code>betaMean</code> - <code>betaTruth</code>. 
</p>
</td></tr>
<tr><td><code>betaMeanPB</code></td>
<td>

<p>Percent bias based on mean, calculated as ((<code>betaMean</code> - <code>betaTruth</code>) / <code>betaTruth</code>) x 100. If a regression coefficient is
zero, percent bias is not calculated and an NA is returned.
</p>
</td></tr>
<tr><td><code>betaMedian</code></td>
<td>

<p>Median of the Monte Carlo sampling distribution for each regression coefficient estimator.
</p>
</td></tr>  
<tr><td><code>betaMedianBias</code></td>
<td>

<p>Bias based on the median, calculated as <code>betaMedian</code> - <code>betaTruth</code>. 
</p>
</td></tr>
<tr><td><code>betaMedianPB</code></td>
<td>

<p>Percent bias based on median, calculated as ((<code>betaMedian</code> - <code>betaTruth</code>) / <code>betaTruth</code>) x 100. If a regression coefficient is
zero, median percent bias is not calculated and an NA is returned.
</p>
</td></tr>
<tr><td><code>betaSD</code></td>
<td>

<p>Standard deviation of the Monte Carlo sampling distribution for each regression coefficient estimator.
</p>
</td></tr>
<tr><td><code>betaMSE</code></td>
<td>

<p>Mean squared error of the Monte Carlo sampling distribution for each regression coefficient
estimator.
</p>
</td></tr>
<tr><td><code>seMean</code></td>
<td>

<p>Mean of the Monte Carlo sampling distribution for the standard error estimates reported by glm().
</p>
</td></tr>
<tr><td><code>seRatio</code></td>
<td>

<p>Ratio of the mean reported standard error to the standard deviation of the Monte Carlo sampling
distribution for each regression coefficient estimator. The ratio is multiplied by 100.    
</p>
</td></tr>
<tr><td><code>betaCP</code></td>
<td>

<p>Coverage probability for Wald-based confidence intervals, evaluated on the basis of an <code>alpha</code> type I error rate.
</p>
</td></tr>
<tr><td><code>betaPower</code></td>
<td>

<p>Power against the null hypothesis that the regression coefficient is zero for a Wald-based test with an <code>alpha</code> type I error rate.
</p>
</td></tr>
<tr><td><code>betaRU</code></td>
<td>

<p>The ratio of the standard deviation of the Monte Carlo sampling
distribution for each estimator to the standard deviation of the Monte Carlo sampling distribution
for the estimator corresponding to <code>refDesign</code>. The ratio is multiplied by 100.
</p>
</td></tr>
</table>
<p>Also returned is an object <code>failed</code> which is a vector consisting of the number of datasets excluded from the power calculations (i.e. set to <code>NA</code>), for each simulation performed. For the evaluation of general operating characteristics, the three reasons are: (1) lack of convergence indicated by <code>NA</code> point estimates returned by <code><a href="stats.html#topic+glm">glm</a></code>, (2) lack of convergence indicated by <code>NA</code> standard error point estimates returned by <code><a href="stats.html#topic+glm">glm</a></code>, (3) exclusion on the basis of the <code>threshold</code> argument.
</p>


<h3>Note</h3>

<p>A generic print method provides formatted output of the results.
</p>


<h3>Author(s)</h3>

<p>Sebastien Haneuse, Takumi Saegusa
</p>


<h3>References</h3>

<p>Prentice, R. and Pyke, R. (1979) &quot;Logistic disease incidence models and case-control studies.&quot; Biometrika 66:403-411.
</p>
<p>Haneuse, S. and Saegusa, T. and Lumley, T. (2011) &quot;osDesign: An R Package for the Analysis, Evaluation, and Design of Two-Phase and Case-Control Studies.&quot; Journal of Statistical Software, 43(11), 1-29.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plotPower">plotPower</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##
data(Ohio)

## 
XM   &lt;- cbind(Int=1, Ohio[,1:3])
fitM &lt;- glm(cbind(Death, N-Death) ~ factor(Age) + Sex + Race, data=Ohio,
            family=binomial)
betaNamesM &lt;- c("Int", "Age1", "Age2", "Sex", "Race")

## Single case-control design
##
ccResults1 &lt;- ccSim(B=100, betaTruth=fitM$coef, X=XM, N=Ohio$N,
                    nCC=500, r=1, betaNames=betaNamesM, monitor=10)
ccResults1

## Examining unbalanced case-control designs
##

ccResults2 &lt;- ccSim(B=1000, betaTruth=fitM$coef, X=XM, N=Ohio$N,
                    nCC=500, r=c(0.25, 0.33, 0.5, 1, 2, 3, 4),
                    betaNames=betaNamesM, monitor=100)
ccResults2
</code></pre>

<hr>
<h2 id='infants'>
Infant mortality data from North Carolina
</h2><span id='topic+infants'></span>

<h3>Description</h3>

<p>Individual-level infant mortality data on 235,272 births in the U.S. state of North Carolina, in 2003 and 2004.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(infants)</code></pre>


<h3>Format</h3>

<p>A data frame consisting of 235,464 observations, with the following columns:
</p>

<dl>
<dt><code>year</code></dt><dd><p>Year of birth; either 2003 or 2004.</p>
</dd>
<dt><code>race</code></dt><dd><p>A 9-level categorical variable indicating the race of the baby. See Details, below.</p>
</dd>
<dt><code>male</code></dt><dd><p>A binary variable; 0=female; 1=male.</p>
</dd>
<dt><code>mage</code></dt><dd><p>Age of the mother, years.</p>
</dd>
<dt><code>weeks</code></dt><dd><p>Number of completed weeks of gestation.</p>
</dd>
<dt><code>cignum</code></dt><dd><p>Average number of cigarettes. A value of &lsquo;98&rsquo; indicates smoking but unknown amount.</p>
</dd>
<dt><code>gained</code></dt><dd><p>Weight gained during pregnancy, lbs.</p>
</dd>
<dt><code>weight</code></dt><dd><p>Birth weight, grams.</p>
</dd>
<dt><code>death</code></dt><dd><p>A binary variable indicating death within 1st year of life; 0=alive; 1=death.</p>
</dd>
</dl>



<h3>Details</h3>

<p>The data were compiled by the North Carolina State Center for Health Statistics (http://www.irss.unc.edu/).
</p>
<p>The <code>race</code> variable is coded as follows:
0 = Other non-white
1 = White
2 = Black
3 = American Indian
4 = Chinese
5 = Japanese
6 = Hawaiin
7 = Filipino
8 = Other Asian or Pacific Islander
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Code to generate an aggregated dataset
##
data(infants)
##
infants$smoker  &lt;- as.numeric(infants$cignum &gt; 0)
infants$teen    &lt;- as.numeric(infants$mage &lt; 20)
infants$lowgain &lt;- as.numeric(infants$gained &lt; 20)
infants$early   &lt;- as.numeric(infants$weeks &lt; 32)
infants$lbw     &lt;- as.numeric(infants$weight &lt; 2500)
##
listAgg &lt;- list(year=infants$year,
                smoker=infants$smoker,
                teen=infants$teen,
                lowgain=infants$lowgain,
                race=infants$race,
                male=infants$male,
                early=infants$early,
                lbw=infants$lbw)
infantsAgg &lt;- aggregate(rep(1, nrow(infants)), listAgg, FUN=sum)
names(infantsAgg)[ncol(infantsAgg)] &lt;- "N"
infantsAgg$Y &lt;- aggregate(infants$death, listAgg, FUN=sum)$x
</code></pre>

<hr>
<h2 id='Ohio'>
Ohio lung cancer data
</h2><span id='topic+Ohio'></span>

<h3>Description</h3>

<p>Population estimates and lung cancer death counts for the state of Ohio in 1988, among 55-84 year olds. Counts are stratified by age, sex and race.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(Ohio)</code></pre>


<h3>Format</h3>

<p>A data frame consisting of 12 observations, with the following columns:
</p>

<dl>
<dt><code>Age</code></dt><dd><p>A 3-level categorical level variable; 0=55-64 years; 1=65-74 years; 2=75-84 years.</p>
</dd>
<dt><code>Sex</code></dt><dd><p>A binary variable; 0=male; 1=female.</p>
</dd>
<dt><code>Race</code></dt><dd><p>A binary variable; 0=white; 1=non-white.</p>
</dd>
<dt><code>N</code></dt><dd><p>A numeric vector of estimated population counts.</p>
</dd>
<dt><code>Death</code></dt><dd><p>A numeric vector of lung cancer death counts.</p>
</dd>
</dl>



<h3>Details</h3>

<p>The data were obtained from the National Center for Heatlh Statistics Compressed Mortality File and correspond to a population of 2,220,177 individuals with 5,533 lung cancer deaths. A more comprehensive dataset, providing counts further stratified by county as well as for the years 1968 to 1988, is described by Xia and Carlin (1998).
</p>


<h3>Source</h3>

<p>Xia H, Carlin B (1998). Spatio-temporal models with errors in covariates: Mapping Ohio lung cancer mortality. Statistics in Medicine, 17, 2025-2043.
</p>
<p>Haneuse, S. and Saegusa, T. and Lumley, T. (2011) &quot;osDesign: An R Package for the Analysis, Evaluation, and Design of Two-Phase and Case-Control Studies.&quot; Journal of Statistical Software, 43(11), 1-29.
</p>

<hr>
<h2 id='phaseI'>
Expected phase I stratification
</h2><span id='topic+phaseI'></span>

<h3>Description</h3>

<p><code>phaseI()</code> provides the expected phase I counts, based on a pre-specified population and outcome model. If phase II sample sizes are provided, the (expected) phase II sampling probabilities are also reported.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phaseI(betaTruth, X, N, strata=NULL, expandX="all", etaTerms=NULL,
      nII0=NULL, nII1=NULL,
      cohort=TRUE, NI=NULL, digits=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="phaseI_+3A_betatruth">betaTruth</code></td>
<td>

<p>Regression coefficients from the logistic regression model.
</p>
</td></tr>
<tr><td><code id="phaseI_+3A_x">X</code></td>
<td>

<p>Design matrix for the logistic regression model. The first column should correspond to intercept. For each exposure, the baseline group should be coded as 0, the first level as 1, and so on.
</p>
</td></tr>
<tr><td><code id="phaseI_+3A_n">N</code></td>
<td>

<p>A numeric vector providing the sample size for each row of the design matrix, <code>X</code>.
</p>
</td></tr>
<tr><td><code id="phaseI_+3A_strata">strata</code></td>
<td>

<p>A numeric vector indicating which columns of the design matrix, <code>X</code>, are used to form the phase I stratification variable. <code>strata=1</code> specifies the intercept and is, therefore, equivalent to a case-control study.
</p>
</td></tr>
<tr><td><code id="phaseI_+3A_expandx">expandX</code></td>
<td>

<p>Character vector indicating which columns of <code>X</code> to expand as a series of dummy variables. Useful when at least one exposure is continuous (and should not be expanded). Default is &lsquo;all&rsquo;; other options include &lsquo;none&rsquo; or character vector of column names. See Details, below.
</p>
</td></tr>
<tr><td><code id="phaseI_+3A_etaterms">etaTerms</code></td>
<td>

<p>Character vector indicating which columns of <code>X</code> are to be included in the model. See Details, below.
</p>
</td></tr>
<tr><td><code id="phaseI_+3A_nii0">nII0</code></td>
<td>

<p>A vector of sample sizes at phase II for controls. The length must correspond to the number of unique values for phase I stratification variable.
</p>
</td></tr>
<tr><td><code id="phaseI_+3A_nii1">nII1</code></td>
<td>

<p>A vector of sample sizes at phase II for cases. The length must correspond to the number of unique values phase I stratification variable.
</p>
</td></tr>
<tr><td><code id="phaseI_+3A_cohort">cohort</code></td>
<td>

<p>Logical flag. TRUE indicates phase I is drawn as a cohort; FALSE indicates phase I is drawn as a case-control sample.
</p>
</td></tr>
<tr><td><code id="phaseI_+3A_ni">NI</code></td>
<td>

<p>A pair of integers providing the outcome-specific phase I sample
sizes when the phase I data are drawn as a case-control sample. The
first element corresponds to the controls and the second to the
cases.
</p>
</td></tr>
<tr><td><code id="phaseI_+3A_digits">digits</code></td>
<td>

<p>Integer indicating the precision to be used for the reporting of the (expected) sampling probabilities
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The correspondence between <code>betaTruth</code> and <code>X</code>, specifically the ordering of elements, is based on successive use of <code><a href="base.html#topic+factor">factor</a></code> to each column of <code>X</code> which is expanded via the <code>expandX</code> argument. Each exposure that is expanded must conform to a 0, 1, 2, ... integer-based coding convention.
</p>
<p>The <code>etaTerms</code> argument is useful when only certain columns in <code>X</code> are to be included in the model. In the context of the two-phase design, this might be the case if phase I stratifies on some surrogate exposure and a more detailed/accurate measure is to be included in the main model.
</p>


<h3>Value</h3>

<p><code>phaseI()</code> returns an object of class &quot;phaseI&quot; that, at a minimum includes:
</p>
<table>
<tr><td><code>phaseI</code></td>
<td>
<p>Expected phase I counts, based on a pre-specified population and outcome model</p>
</td></tr>
<tr><td><code>covm</code></td>
<td>
<p>Model based variance-covariance matrix. This is available for <code>method</code> = &quot;PL&quot; and &quot;ML&quot;.</p>
</td></tr>
<tr><td><code>cove</code></td>
<td>
<p>Empirical variance-covariance matrix. This is available for all the three methods.</p>
</td></tr>
<tr><td><code>fail</code></td>
<td>
<p>Indicator of whether or not the phase I and/or the phase II constraints are satisfied; only relevant for the ML estimator.</p>
</td></tr>
</table>
<p>If phase II sample sizes were provided as part of the initial call, the object additionally includes:
</p>
<table>
<tr><td><code>phaseII</code></td>
<td>
<p>The supplied phase II sample sizes.</p>
</td></tr>
<tr><td><code>phaseIIprobs</code></td>
<td>
<p>Expected phase II sampling probabilities.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Sebastien Haneuse, Takumi Saegusa
</p>


<h3>References</h3>

<p>Haneuse, S. and Saegusa, T. and Lumley, T. (2011) &quot;osDesign: An R Package for the Analysis, Evaluation, and Design of Two-Phase and Case-Control Studies.&quot; Journal of Statistical Software, 43(11), 1-29.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##
data(Ohio)

## Design matrix that forms the basis for model and phase I 
## stata specification 
##
XM &lt;- cbind(Int=1, Ohio[,1:3])      ## main effects only
XI &lt;- cbind(XM, SbyR=XM[,3]*XM[,4]) ## interaction between sex and race

## 'True' values for the underlying logistic model
##
fitM &lt;- glm(cbind(Death, N-Death) ~ factor(Age) + Sex + Race, data=Ohio,
            family=binomial)
fitI &lt;- glm(cbind(Death, N-Death) ~ factor(Age) + Sex * Race, data=Ohio,
            family=binomial)

## Stratified sampling by race
##
phaseI(betaTruth=fitM$coef, X=XM, N=Ohio$N, strata=4,
       nII0=c(125, 125),
       nII1=c(125, 125))

## Stratified sampling by age and sex
##
phaseI(betaTruth=fitM$coef, X=XM, N=Ohio$N, strata=c(2,3))
##
phaseI(betaTruth=fitM$coef, X=XM, N=Ohio$N, strata=c(2,3),
       nII0=(30+1:6),
       nII1=(40+1:6))
</code></pre>

<hr>
<h2 id='plotPower'>
Plot function for power, based on two-phase and case-control design
</h2><span id='topic+plotPower'></span>

<h3>Description</h3>

<p>The <code>plotPower</code> function plots estimates of power obtained from objects returned by either the <code>tpsPower</code> or <code>ccPower</code> functions. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotPower(x, coefNum=1, include="All", yAxis=seq(from=0, to=100, by=20),
          xAxis=NULL, main=NULL, legendXY=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotPower_+3A_x">x</code></td>
<td>

<p>An object in a class <code>tpsPower</code> or <code>ccPower</code> obtained as a result of <code><a href="#topic+tpsPower">tpsPower</a></code> or <code><a href="#topic+ccPower">ccPower</a></code> functions, respectively.
</p>
</td></tr>
<tr><td><code id="plotPower_+3A_coefnum">coefNum</code></td>
<td>

<p>A numeric vector number specifying the regression coefficient in <code>beta</code> for the plot.
</p>
</td></tr>
<tr><td><code id="plotPower_+3A_include">include</code></td>
<td>

<p>Character string indicating which estimators from a <code>tpsPower</code> object are to be printed. The default is &quot;All&quot; in which case all four estimators (two-phase WL, PL, ML and case-control CC) are presented. Other options include &quot;TPS&quot; which solely presents the three two-phase estimators; options &quot;WL&quot;, &quot;PL&quot;, &quot;ML&quot; and &quot;CC&quot; solely present the corresponding estimators. If the object is of class <code>ccPower</code> then only the case-control MLE (CC) is presented (i.e., the <code>include</code> argument is ignored).
</p>
</td></tr>
<tr><td><code id="plotPower_+3A_yaxis">yAxis</code></td>
<td>

<p>A scale marking the y-axis for the plot.
</p>
</td></tr>
<tr><td><code id="plotPower_+3A_xaxis">xAxis</code></td>
<td>

<p>A scale marking the x-axis for the plot. If left as the default <code>NULL</code>, the x-axis scale is taken from <code>nII</code> in the <code>tpsResults</code> object.
</p>
</td></tr>
<tr><td><code id="plotPower_+3A_main">main</code></td>
<td>

<p>Title for the plot. 
</p>
</td></tr>
<tr><td><code id="plotPower_+3A_legendxy">legendXY</code></td>
<td>

<p>Optional vector indicating the co-ordinates for the top-left hand corner of the legend box.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Produces a plot of statistical power (to reject a null hypothesis H0: beta = 0), for estimators of a regression coefficient from a logistic regression model, based on a two-phase and/or case-control design.
</p>


<h3>Author(s)</h3>

<p>Sebastien Haneuse, Takumi Saegusa
</p>


<h3>References</h3>

<p>Haneuse, S. and Saegusa, T. and Lumley, T. (2011) &quot;osDesign: An R Package for the Analysis, Evaluation, and Design of Two-Phase and Case-Control Studies.&quot; Journal of Statistical Software, 43(11), 1-29.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+tpsPower">tpsPower</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##
data(Ohio)

##
XM   &lt;- cbind(Int=1, Ohio[,1:3])
fitM &lt;- glm(cbind(Death, N-Death) ~ factor(Age) + Sex + Race, data=Ohio,
            family=binomial)
betaNamesM &lt;- c("Int", "Age1", "Age2", "Sex", "Race")

## Power for the TPS design where phase I stratification is based on Age
##
newBetaM      &lt;- fitM$coef
newBetaM[2:3] &lt;- newBetaM[2:3] / 2
##

powerRaceTPS &lt;- tpsPower(B=10000, betaTruth=fitM$coef, X=XM, N=Ohio$N,
                    strata=4,
                    nII=seq(from=100, to=1000, by=100),
		 betaNames=c("Int", "Age1", "Age2", "Sex", "Race"), monitor=1000)
##
old.par &lt;- par()
par(mfrow=c(2,2))
plotPower(powerRaceTPS, include="TPS", coefNum=2,
          xAxis=seq(from=100, to=1000, by=100),
          main=expression("Age effect (65-74 vs. 55-64 years), " * beta[A1]),
          legendXY=c(800, 65))
plotPower(powerRaceTPS, include="ML", coefNum=2,
          xAxis=seq(from=100, to=1000, by=100),
          main=expression("Age effect (65-74 vs. 55-64 years), " * beta[A1]),
          legendXY=c(800, 65))
plotPower(powerRaceTPS, include="WL", coefNum=2,
          xAxis=seq(from=100, to=1000, by=100),
          main=expression("Age effect (65-74 vs. 55-64 years), " * beta[A1]),
          legendXY=c(800, 65))
plotPower(powerRaceTPS, include="CC", coefNum=2,
          xAxis=seq(from=100, to=1000, by=100),
          main=expression("Age effect (65-74 vs. 55-64 years), " * beta[A1]),
          legendXY=c(800, 65))
##
par(old.par)

## Power 
##

ccResult &lt;- ccPower(B=1000, betaTruth=newBetaM, X=XM, N=Ohio$N, r=0.5,
                    nCC=seq(from=100, to=500, by=50), betaNames=betaNamesM,
                    monitor=100)
##
par(mfrow=c(2,2))
plotPower(ccResult, coefNum=2, yAxis=seq(from=0, to=100, by=20),
            xAxis=seq(from=100, to=500, by=100),
            main=expression("Age effect (65-74 vs. 55-64 years), " * beta[A1]))
plotPower(ccResult, coefNum=3, yAxis=seq(from=0, to=100, by=20),
            xAxis=seq(from=100, to=500, by=100),
            main=expression("Age effect (75-84 vs. 55-64 years), " * beta[A2]))
plotPower(ccResult, coefNum=4, yAxis=seq(from=0, to=100, by=20),
            xAxis=seq(from=100, to=500, by=100),
            main=expression("Sex effect, " * beta[S]))
plotPower(ccResult, coefNum=5, yAxis=seq(from=0, to=100, by=20),
            xAxis=seq(from=100, to=500, by=100),
            main=expression("Race effect, " * beta[R]))
</code></pre>

<hr>
<h2 id='rmvhyper'>
Random generation for the multivariate hypergeometric distribution
</h2><span id='topic+rmvhyper'></span>

<h3>Description</h3>

<p>Generates a single random deviate from a multivariate hypergeometric distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmvhyper(Mk, m)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rmvhyper_+3A_mk">Mk</code></td>
<td>
<p> A numeric vector describing the population from which the sub-sample will be drawn.</p>
</td></tr>
<tr><td><code id="rmvhyper_+3A_m">m</code></td>
<td>
<p> Number of elements to be drawn from the population</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The multivariate hypergeometric distribution is for sampling without replacement from a population with a finite number of element types. The number of element types is given by the length of the vector <code>Mk</code>.
</p>


<h3>Value</h3>

<p>A numeric vector of elements, totally to <code>m</code>, drawn without replacement from the population described by <code>Mk</code>.
</p>


<h3>Author(s)</h3>

<p>Sebastien Haneuse
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+rhyper">rhyper</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##
rmvhyper(c(1000, 500, 200, 50), 200)

## Check the properties (first two moments) of the generated deviates
##
M  &lt;- 100
Qx &lt;- c(0.7, 0.15, 0.1, 0.05)
temp &lt;- matrix(NA, nrow=10000, ncol=length(Qx))
for(i in 1:nrow(temp)) temp[i,] &lt;- rmvhyper(M*Qx, 1)

##
rbind(Qx, apply(temp, 2,  mean))
rbind(sqrt(Qx * (1-Qx)), apply(temp, 2, sd))
</code></pre>

<hr>
<h2 id='tps'>
Estimation for two-phase designs.
</h2><span id='topic+tps'></span>

<h3>Description</h3>

<p>Fits a logistic regression model to data arising from two phase designs
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tps(formula=formula(data), data=parent.frame(), nn0, nn1, group,
    contrasts=NULL, method="PL", cohort=TRUE, alpha=1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tps_+3A_formula">formula</code></td>
<td>

<p>A formula expression as for other binomial response regression models, of the form  response ~ predictors, where both the response and predictors corresponds to observations at phase II sample. The response can be either a vector of 0's and 1's or else a matrix with two columns representing number of cases (response=1) and controls (response=0) corresponding to the rows of the design matrix.
</p>
</td></tr>
<tr><td><code id="tps_+3A_data">data</code></td>
<td>

<p>An optional data frame for phase two sample in which to interpret the variables occurring in the formula.
</p>
</td></tr>
<tr><td><code id="tps_+3A_nn0">nn0</code></td>
<td>

<p>A numeric vector of length K, indicating the numbers of controls for each Phase I strata.
</p>
</td></tr>
<tr><td><code id="tps_+3A_nn1">nn1</code></td>
<td>

<p>A numeric vector of length K, indicating the numbers of cases for each Phase I strata.
</p>
</td></tr>
<tr><td><code id="tps_+3A_group">group</code></td>
<td>

<p>A numeric vector providing stratum identification for phase II data. Values should be in <code>{1,...,K}</code>, where K is the number of strata
(vector of same length as the response and predictors). A vector indicating a stratum for each row of the design matrix.
</p>
</td></tr>
<tr><td><code id="tps_+3A_contrasts">contrasts</code></td>
<td>

<p>A list of contrasts to be used for some or all of the factors appearing as variables in the model formula. See the documentation of <code><a href="stats.html#topic+glm">glm</a></code> for more details.
</p>
</td></tr>
<tr><td><code id="tps_+3A_method">method</code></td>
<td>

<p>Three different procedures are available. The default method is &quot;PL&quot; which implements pseudo-likelihood as developed by Breslow and Cain (1988). Other possible choices
are &quot;WL&quot; and &quot;ML&quot;  which implements, respectively, weighted likelihood (Flanders and Greenland, 1991; Zhao and Lipsitz, 1992) and maximum likelihood
(Breslow and Holubkov, 1997; Scott and Wild, 1997).
</p>
</td></tr>
<tr><td><code id="tps_+3A_cohort">cohort</code></td>
<td>

<p>Logical flag. TRUE indicates phase I is drawn as a cohort; FALSE indicates phase I is drawn as a case-control sample.
</p>
</td></tr>
<tr><td><code id="tps_+3A_alpha">alpha</code></td>
<td>

<p>Marginal odds of observing a case in the population. This is only used when cohort=F is specified and must be correctly specified in order to obtain a correct estimate of the intercept.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Returns estimates and standard errors  from logistic regression fit to data arising from two phase designs. Three semiparametric methods are implemented to obtain estimates of the
regression coefficients and their standard errors. Use of this function requires existence of a finite number of strata (K) so that the phase one data consist of a joint
classification into 2K cells according to binary outcome and stratum. This function can also handle certain missing value and measurement error problems with validation data.
</p>
<p>The phase I sample can involve either cohort or case-control sampling. This software yields correct estimates (and standard errors) of all the regression coefficients
(including the intercept) under cohort sampling at phase I. When phase I  involves case-control sampling one  cannot estimate the intercept, except, when the marginal odds
of observing a case in the population is specified. Then the software yields a correct estimate and standard error for the intercept also.  
</p>
<p>The WL method fits a logistic regression model to the phase II data with a set of weights. Each unit is weighted by the ratio of frequencies (phase I/phase II) for the
corresponding outcome X stratum cell. This estimator has its origins in sampling theory and is well known as Horvitz-Thompson method. The PL method maximizes the product
of conditional probabilities of &quot;being a case&quot; given the covariates and the fact of inclusion in the phase II sample. This is  called the &quot;complete data likelihood&quot; by some
researchers. The estimate is obtained by fitting a logistic regression model to the phase II data with a set of offsets. The ML procedure maximizes the full likelihood of
the data (phase I and II) jointly with respect to the regression parameters and the marginal distribution of the covariates. The resulting concentrated score equations
(Breslow and Holubkov (1997) , eq. 18) were solved using a modified Newton-Raphson algorithm. Schill's (1993) partial likelihood estimates are used as the starting values.
</p>
<p>NOTE: In some settings, the current implementation of the ML estimator returns point estimates that do not satisfy the phase I and/or phase II constraints. If this is the case a warning is printed and the &quot;fail&quot; elements of the returned list is set to TRUE. An example of this is phenomenon is given below. When this occurs, users are encouraged to either report the PL estimator or consider using Chris Wild's 'missreg' package.
</p>


<h3>Value</h3>

<p><code>tps()</code> returns a list that includes estimated regression coefficients and one or two estimates of their asymptotic variance-covariance matrix:
</p>
<table>
<tr><td><code>coef</code></td>
<td>
<p>Regression coefficient estimates</p>
</td></tr>
<tr><td><code>covm</code></td>
<td>
<p>Model based variance-covariance matrix. This is available for <code>method</code> = &quot;PL&quot; and &quot;ML&quot;.</p>
</td></tr>
<tr><td><code>cove</code></td>
<td>
<p>Empirical variance-covariance matrix. This is available for all the three methods.</p>
</td></tr>
<tr><td><code>fail</code></td>
<td>
<p>Indicator of whether or not the phase I and/or the phase II constraints are satisfied; only relevant for the ML estimator.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Nilanjan Chaterjee, Norman Breslow, Sebastien Haneuse
</p>


<h3>References</h3>

<p>Flanders W. and Greenland S. (1991) &quot;Analytic methods for two-stage case-control studies and other stratified designs.&quot; Statistics in Medicine 10:739-747.
</p>
<p>Zhao L. and Lipsitz S. (1992) &quot;Design and analysis of two-stage studies.&quot;Statistics in Medicine 11:769-782.
</p>
<p>Schill, W., Jockel K-H., Drescher, K. and Timm, J.(1993). &quot;Logistic analysis in case-control studies under validation sampling.&quot; Biometrika 80:339-352.
</p>
<p>Scott, A. and Wild, C. (1997) &quot;Fitting regression models to case control data by maximum likelihood.&quot; Biometrika 78:705-717.
</p>
<p>Breslow, N. and Holubkov, R. (1997) &quot;Maximum likelihood estimation for logistic regression parameters under two-phase, outcome dependent sampling.&quot; J. Roy. Statist. Soc. B. 59:447-461.
</p>
<p>Breslow, N. and Cain, K. (1988) &quot;Logistic regression for two-stage case control data.&quot; Biometrika 75:11-20.
</p>
<p>Breslow, N. and Chatterjee, N. (1999) &quot;Design and analysis of two phase studies with binary outcome applied to Wilms tumour prognosis.&quot; Applied Statistics 48:457-468.
</p>
<p>Haneuse, S. and Saegusa, T. and Lumley, T. (2011) &quot;osDesign: An R Package for the Analysis, Evaluation, and Design of Two-Phase and Case-Control Studies.&quot; Journal of Statistical Software, 43(11), 1-29.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##
data(Ohio)

## Phase I stratification based on age
##
Ohio$S &lt;- Ohio$Age + 1
K &lt;- length(unique(Ohio$S))

## Phase I data
##
Ohio$nonDeath &lt;- Ohio$N-Ohio$Death
nn0 &lt;- aggregate(Ohio$nonDeath, list(S=Ohio$S), FUN=sum)$x
nn1 &lt;- aggregate(Ohio$Death, list(S=Ohio$S), FUN=sum)$x

## Phase II sample sizes
##
nPhIIconts &lt;- rep(100, 3)
nPhIIcases &lt;- rep(100, 3)

## 'Generate' phase II data
##
Ohio$conts &lt;- NA
Ohio$cases &lt;- NA
for(k in 1:K)
{
  Ohio$conts[Ohio$S == k] &lt;- rmvhyper(Ohio$nonDeath[Ohio$S == k],
                                      nPhIIconts[k])
  Ohio$cases[Ohio$S == k] &lt;- rmvhyper(Ohio$Death[Ohio$S == k],
                                      nPhIIcases[k])
}

## Three estimators
##
tps(cbind(cases, conts) ~ factor(Age) + Sex + Race, data=Ohio,
    nn0=nn0, nn1=nn1,
    group=Ohio$S, method="WL")
tps(cbind(cases, conts) ~ factor(Age) + Sex + Race, data=Ohio,
    nn0=nn0, nn1=nn1,
    group=Ohio$S, method="PL")
tps(cbind(cases, conts) ~ factor(Age) + Sex + Race, data=Ohio,
    nn0=nn0, nn1=nn1,
    group=Ohio$S, method="ML")

## An example where (most of the time) the constraints are not satisfied and a warning is returned
##
tps(cbind(cases, conts) ~ Sex + Race, data=Ohio,
    nn0=nn0, nn1=nn1,
    group=Ohio$S, method="ML")
</code></pre>

<hr>
<h2 id='tpsPower'>
Simulation-based estimation of power for the two-phase study design
</h2><span id='topic+tpsPower'></span>

<h3>Description</h3>

<p>Monte Carlo based estimation of statistical power for estimators of the components of a logistic regression model, based on balanced two-phase and case-control study designs (Breslow and Chatterjee, 1999; Prentice and Pykle, 1979).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tpsPower(B=1000, betaTruth, X, N, strata, expandX="all", etaTerms=NULL,
         nII, alpha=0.05, digits=1, betaNames=NULL,
         monitor=NULL, cohort=TRUE, NI=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tpsPower_+3A_b">B</code></td>
<td>

<p>The number of datasets generated by the simulation.
</p>
</td></tr>
<tr><td><code id="tpsPower_+3A_betatruth">betaTruth</code></td>
<td>

<p>Regression coefficients from the logistic regression model.
</p>
</td></tr>
<tr><td><code id="tpsPower_+3A_x">X</code></td>
<td>

<p>Design matrix for the logistic regression model. The first column should correspond to intercept. For each exposure, the baseline group should be coded as 0, the first level as 1, and so on.
</p>
</td></tr>
<tr><td><code id="tpsPower_+3A_n">N</code></td>
<td>

<p>A numeric vector providing the sample size for each row of the design matrix, <code>X</code>.
</p>
</td></tr>
<tr><td><code id="tpsPower_+3A_strata">strata</code></td>
<td>

<p>A numeric vector indicating which columns of the design matrix, <code>X</code>, are used to form the phase I stratification variable. <code>strata=1</code> specifies the intercept and is, therefore, equivalent to a case-control study. <code>strata=0</code> is not permitted in tpsPower(), although multiple two-phase stratifications can be investigated with tpsSim().
</p>
</td></tr>
<tr><td><code id="tpsPower_+3A_expandx">expandX</code></td>
<td>

<p>Character vector indicating which columns of <code>X</code> to expand as a series of dummy variables. Useful when at least one exposure is continuous (and should not be expanded). Default is &lsquo;all&rsquo;; other options include &lsquo;none&rsquo; or character vector of column names. See Details, below.
</p>
</td></tr>
<tr><td><code id="tpsPower_+3A_etaterms">etaTerms</code></td>
<td>

<p>Character vector indicating which columns of <code>X</code> are to be included in the model. See Details, below.
</p>
</td></tr>
<tr><td><code id="tpsPower_+3A_nii">nII</code></td>
<td>

<p>A numeric value indicating the phase II sample size. If a vector is provided, separate simulations are run for each element.
</p>
</td></tr>
<tr><td><code id="tpsPower_+3A_alpha">alpha</code></td>
<td>

<p>Type I error rate assumed for the evaluation of coverage probabilities and power.
</p>
</td></tr>
<tr><td><code id="tpsPower_+3A_digits">digits</code></td>
<td>

<p>Integer indicating the precision to be used for the output.
</p>
</td></tr>
<tr><td><code id="tpsPower_+3A_betanames">betaNames</code></td>
<td>

<p>An optional character vector of names for the regression coefficients, 
<code>betaTruth</code>.
</p>
</td></tr>
<tr><td><code id="tpsPower_+3A_monitor">monitor</code></td>
<td>

<p>Numeric value indicating how often <code>tpsPower()</code> reports real-time progress on the simulation, as the <code>B</code> datasets are generated and evaluated. The default of <code>NULL</code> indicates no output.
</p>
</td></tr>
<tr><td><code id="tpsPower_+3A_cohort">cohort</code></td>
<td>

<p>Logical flag. TRUE indicates phase I is drawn as a cohort; FALSE indicates phase I is drawn as a case-control sample.
</p>
</td></tr>
<tr><td><code id="tpsPower_+3A_ni">NI</code></td>
<td>

<p>A pair of integers providing the outcome-specific phase I sample
sizes when the phase I data are drawn as a case-control sample. The
first element corresponds to the controls and the second to the
cases.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A simulation study is performed to estimate power for various estimators
of <code>beta</code>:
</p>

<ul>
<li><p>(a) complete data maximum likelihood (CD)
</p>
</li>
<li><p>(b) case-control maximum likelihood (CC)
</p>
</li>
<li><p>(c) two-phase weighted likelihood (WL)
</p>
</li>
<li><p>(d) two-phase pseudo- or profile likelihood (PL)
</p>
</li>
<li><p>(e) two-phase maximum likelihood (ML)
</p>
</li></ul>

<p>The overall simulation approach is the same as that described in <code><a href="#topic+tpsSim">tpsSim</a></code>.
</p>
<p>In each case, power is estimated as the proportion of simulated datasets for which a hypothesis test of no effect is rejected.
</p>
<p>The correspondence between <code>betaTruth</code> and <code>X</code>, specifically the ordering of elements, is based on successive use of <code><a href="base.html#topic+factor">factor</a></code> to each column of <code>X</code> which is expanded via the <code>expandX</code> argument. Each exposure that is expanded must conform to a 0, 1, 2, ... integer-based coding convention.
</p>
<p>The <code>etaTerms</code> argument is useful when only certain columns in <code>X</code> are to be included in the model. In the context of the two-phase design, this might be the case if phase I stratifies on some surrogate exposure and a more detailed/accurate measure is to be included in the main model.
</p>
<p>Only balanced designs are considered by <code>tpsPower()</code>. For unbalanced designs, power estimates can be obtained from <code><a href="#topic+tpsSim">tpsSim</a></code>.
</p>
<p>NOTE: In some settings, the current implementation of the ML estimator returns point estimates that do not satisfy the phase I and/or phase II constraints. If this is the case a warning is printed and the &quot;fail&quot; elements of the returned list is set to TRUE. An example of this is phenomenon is given the help file for <code><a href="#topic+tps">tps</a></code>. When this occurs, <code>tpsPower()</code> considers ML estimation for the particular dataset to have failed.
</p>


<h3>Value</h3>

<p><code>tpsPower()</code> returns an object of class 'tpsPower', a list containing all the input arguments, as well as the following components:
</p>
<table>
<tr><td><code>betaPower</code></td>
<td>

<p>Power against the null hypothesis that the regression coefficient is zero for a Wald-based test with an <code>alpha</code> type I error rate.
</p>
</td></tr>
<tr><td><code>failed</code></td>
<td>

<p>A vector consisting of the number of datasets excluded from the power calculations (i.e. set to <code>NA</code>), for each simulation performed. For power calculations, the three reasons are: (1) lack of convergence indicated by <code>NA</code> point estimates returned by <code><a href="stats.html#topic+glm">glm</a></code> or <code><a href="#topic+tps">tps</a></code>; (2) lack of convergence indicated by <code>NA</code> standard error point estimates returned by <code><a href="stats.html#topic+glm">glm</a></code> or <code><a href="#topic+tps">tps</a></code>; and (3) for the ML estimator only, the phase I and/or phase II constraints are not satisfied.
</p>
</td></tr>
</table>


<h3>Note</h3>

<p>A generic print method provides formatted output of the results.
</p>
<p>A generic plot function <code><a href="#topic+plotPower">plotPower</a></code> provides plots of powers against different sample sizes for each estimate of a regression coefficient.
</p>


<h3>Author(s)</h3>

<p>Sebastien Haneuse, Takumi Saegusa
</p>


<h3>References</h3>

<p>Prentice, R. and Pyke, R. (1979) &quot;Logistic disease incidence models and case-control studies.&quot; Biometrika 66:403-411.
</p>
<p>Breslow, N. and Chatterjee, N. (1999) &quot;Design and analysis of two phase studies with binary outcome applied to Wilms tumour prognosis.&quot; Applied Statistics 48:457-468.
</p>
<p>Haneuse, S. and Saegusa, T. and Lumley, T. (2011) &quot;osDesign: An R Package for the Analysis, Evaluation, and Design of Two-Phase and Case-Control Studies.&quot; Journal of Statistical Software, 43(11), 1-29.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plotPower">plotPower</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##
data(Ohio)

## 
XM   &lt;- cbind(Int=1, Ohio[,1:3])
fitM &lt;- glm(cbind(Death, N-Death) ~ factor(Age) + Sex + Race, data=Ohio,
            family=binomial)
betaNamesM &lt;- c("Int", "Age1", "Age2", "Sex", "Race")

## Power for the TPS design where phase I stratification is based on Race.
##

tpsResult1 &lt;- tpsPower(B=1000, beta=fitM$coef, X=XM, N=Ohio$N, strata=4,
                       nII=seq(from=100, to=1000, by=100),
                       betaNames=betaNamesM, monitor=100)
tpsResult1

## Power for the TPS design where phase I stratification is based on Age
##   * consider the setting where the age coefficients are halved from
##     their observed true values
##   * the intercept is modified, accordingly, using the beta0() function
##
newBetaM      &lt;- fitM$coef
newBetaM[2:3] &lt;- newBetaM[2:3] / 2
newBetaM[1]   &lt;- beta0(betaX=newBetaM[-1], X=XM, N=Ohio$N,
                       rhoY=sum(Ohio$Death)/sum(Ohio$N))
##

tpsResult2 &lt;- tpsPower(B=1000, beta=fitM$coef, X=XM, N=Ohio$N, strata=2,
                       nII=seq(from=100, to=500, by=50),
                       betaNames=betaNamesM, monitor=100)
tpsResult2
</code></pre>

<hr>
<h2 id='tpsSim'>
Simulation function for two-phase study designs.
</h2><span id='topic+tpsSim'></span>

<h3>Description</h3>

<p>Monte Carlo based evaluation of operating characteristics for estimators of the components of a logistic regression model, based on the two-phase and case-control study designs (Breslow and Chatterjee, 1999; Prentice and Pykle, 1979).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tpsSim(B=1000, betaTruth, X, N, strata, expandX="all", etaTerms=NULL,
       nII0=NULL, nII1=NULL, nII=NULL, nCC=NULL,
       alpha=0.05, threshold=c(-Inf, Inf), digits=1, betaNames=NULL,
       referent=2, monitor=NULL, cohort=TRUE, NI=NULL, returnRaw=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tpsSim_+3A_b">B</code></td>
<td>

<p>The number of datasets generated by the simulation.
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_betatruth">betaTruth</code></td>
<td>

<p>Regression coefficients from the logistic regression model.
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_x">X</code></td>
<td>

<p>Design matrix for the logistic regression model. The first column should correspond to intercept. For each exposure, the baseline group should be coded as 0, the first level as 1, and so on.
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_n">N</code></td>
<td>

<p>A numeric vector providing the sample size for each row of the design matrix, <code>X</code>.
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_strata">strata</code></td>
<td>

<p>A list of numeric vectors indicating which columns of the design matrix, <code>X</code>, are used to form the phase I stratification schemes. <code>strata=1</code> specifies the intercept and is, therefore, equivalent to a case-control study. <code>strata=0</code> indicates all possible stratified two-phase sampling schemes. <code>strata=list(2,3)</code> indicates 2 two-phase designs (that stratify on the 2nd and 3rd columns, separately) are to be considered.
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_expandx">expandX</code></td>
<td>

<p>Character vector indicating which columns of <code>X</code> to expand as a series of dummy variables. Useful when at least one exposure is continuous (and should not be expanded). Default is &lsquo;all&rsquo;; other options include &lsquo;none&rsquo; or character vector of column names. See Details, below.
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_etaterms">etaTerms</code></td>
<td>

<p>Character vector indicating which columns of <code>X</code> are to be included in the model. See Details, below.
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_nii0">nII0</code></td>
<td>

<p>A numeric vector of sample sizes at phase II for controls. The length must correspond to the number of unique values for the <code>strata</code> specification.
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_nii1">nII1</code></td>
<td>

<p>A numeric vector of sample sizes at phase II for cases. The length must correspond to the number of unique values for the <code>strata</code> specification.
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_nii">nII</code></td>
<td>

<p>A pair of numbers providing the sample sizes for controls and cases at phase II. This is only used when simulating all stratified two-phase sampling schemes (i.e., <code>strata=0</code>).
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_ncc">nCC</code></td>
<td>

<p>A pair of sample sizes at phase II for controls and cases in a case-control design. If left <code>NULL</code>, the values case-control sample sizes are taken as the sums of <code>n1</code> and <code>n0</code>, respectively.
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_alpha">alpha</code></td>
<td>

<p>Type I error rate assumed for the evaluation of coverage probabilities and power.
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_threshold">threshold</code></td>
<td>

<p>An interval that specifies truncation of the Monte Carlo sampling distribution of each estimator.
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_digits">digits</code></td>
<td>

<p>Integer indicating the precision to be used for the output.
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_betanames">betaNames</code></td>
<td>

<p>An optional character vector of names for the regression coefficients, 
<code>betaTruth</code>.
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_referent">referent</code></td>
<td>

<p>An numeric value specifying which estimator is taken as the referent (denominator) for the relative uncertainty calculation. 1=CD, 2=CC, 3=WL, 4=PL, 5=ML (see Details below).
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_monitor">monitor</code></td>
<td>

<p>Numeric value indicating how often <code>tpsSim()</code> reports real-time progress on the simulation, as the <code>B</code> datasets are generated and evaluated. The default of <code>NULL</code> indicates no output.
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_cohort">cohort</code></td>
<td>

<p>Logical flag. TRUE indicates phase I is drawn as a cohort; FALSE indicates phase I is drawn as a case-control sample.
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_ni">NI</code></td>
<td>

<p>A pair of integers providing the outcome-specific phase I sample
sizes when the phase I data are drawn as a case-control sample. The
first element corresponds to the controls and the second to the
cases.
</p>
</td></tr>
<tr><td><code id="tpsSim_+3A_returnraw">returnRaw</code></td>
<td>

<p>Logical indicator of whether or not the raw coefficient and standard error estimates for each of the design/estimator combinations should be returned.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A simulation study is performed to evaluate the operating
characteristics of various designs/estimators for <code>betaTruth</code>:
</p>

<ul>
<li><p>(a) complete data maximum likelihood (CD)
</p>
</li>
<li><p>(b) case-control maximum likelihood (CC)
</p>
</li>
<li><p>(c) two-phase weighted likelihood (WL)
</p>
</li>
<li><p>(d) two-phase pseudo- or profile likelihood (PL)
</p>
</li>
<li><p>(e) two-phase maximum likelihood (ML)
</p>
</li></ul>

<p>The operating characteristics are evaluated using the Monte Carlo
sampling distribution of each estimator. The latter is generated using
the following steps:
</p>

<ul>
<li><p>(i) Specify the (joint) marginal exposure distribution of underlying population, using <code>X</code> and <code>N</code>. 
</p>
</li>
<li><p>(ii) Simulate outcomes for all sum(<code>N</code>) individuals in the population, based on an underlying logistic regression model specified via <code>betaTruth</code>.
</p>
</li>
<li><p>(iii) Evaluate the CD estimator on the basis of the complete data.
</p>
</li>
<li><p>(iv) Sample either (a) <code>ccDesign</code> controls and cases or (b) sum(<code>n0</code>) controls and sum(<code>n1</code>) cases, (without regard to the <code>strata</code> variable) and evaluate the CC estimator.
</p>
</li>
<li><p>(v) Stratify the population according to outcome and the <code>strata</code> argument, to form the phase I data.
</p>
</li>
<li><p>(vi) Sample <code>n0</code> controls and <code>n1</code> cases from their respective phase I strata.
</p>
</li>
<li><p>(vii) Evaluate the WL, PL and ML estimators.
</p>
</li>
<li><p>(viii) Repeat steps (ii)-(vii) <code>B</code> times.
</p>
</li></ul>

<p>Both the CD and CC estimators are evaluated using the generic <code><a href="stats.html#topic+glm">glm</a></code> function. The three two-phase estimators are based on the <code><a href="#topic+tps">tps</a></code> function.
</p>
<p>The correspondence between <code>betaTruth</code> and <code>X</code>, specifically the ordering of elements, is based on successive use of <code><a href="base.html#topic+factor">factor</a></code> to each column of <code>X</code> which is expanded via the <code>expandX</code> argument. Each exposure that is expanded must conform to a 0, 1, 2, ... integer-based coding convention.
</p>
<p>The <code>etaTerms</code> argument is useful when only certain columns in <code>X</code> are to be included in the model. In the context of the two-phase design, this might be the case if phase I stratifies on some surrogate exposure and a more detailed/accurate measure is to be included in the main model.
</p>
<p>When evaluating operating characteristics, some simulated datasets may result in unusually large or small estimates. Particularly, when the the case-control/phase II sample sizes are small. In some settings, it may be desirable to truncate the Monte Carlo sampling distribution prior to evaluating operating characteristics. The <code>threshold</code> argument indicates the interval beyond which point estimates are ignored. The default is such that all <code>B</code> datasets are kept.
</p>
<p>NOTE: In some settings, the current implementation of the ML estimator returns point estimates that do not satisfy the phase I and/or phase II constraints. If this is the case a warning is printed and the 'fail' elements of the returned list is set to TRUE. An example of this is phenomenon is given the help file for <code><a href="#topic+tps">tps</a></code>. When this occurs, <code>tpsSim()</code> considers ML estimation for the particular dataset to have failed.
</p>


<h3>Value</h3>

<p><code>tpsSim()</code> returns an object of class 'tpsSim', a list containing all the input arguments, as well list <code>results</code> with the following components:
</p>
<table>
<tr><td><code>betaMean</code></td>
<td>

<p>Mean of the Monte Carlo sampling distribution for each regression coefficient estimator.
</p>
</td></tr>
<tr><td><code>betaMeanBias</code></td>
<td>

<p>Bias based on the mean, calculated as <code>betaMean</code> - <code>betaTruth</code>. 
</p>
</td></tr>
<tr><td><code>betaMeanPB</code></td>
<td>

<p>Percent bias based on mean, calculated as ((<code>betaMean</code> - <code>betaTruth</code>) / <code>betaTruth</code>) x 100. If a regression coefficient is
zero, percent bias is not calculated and an NA is returned.
</p>
</td></tr>
<tr><td><code>betaMedian</code></td>
<td>

<p>Median of the Monte Carlo sampling distribution for each regression coefficient estimator.
</p>
</td></tr>  
<tr><td><code>betaMedianBias</code></td>
<td>

<p>Bias based on the median, calculated as <code>betaMedian</code> - <code>betaTruth</code>. 
</p>
</td></tr>
<tr><td><code>betaMedianPB</code></td>
<td>

<p>Percent bias based on median, calculated as ((<code>betaMedian</code> - <code>betaTruth</code>) / <code>betaTruth</code>) x 100. If a regression coefficient is
zero, median percent bias is not calculated and an NA is returned.
</p>
</td></tr>
<tr><td><code>betaSD</code></td>
<td>

<p>Standard deviation of the Monte Carlo sampling distribution for each regression coefficient estimator.
</p>
</td></tr>
<tr><td><code>betaMSE</code></td>
<td>

<p>Mean squared error of the Monte Carlo sampling distribution for each regression coefficient
estimator.
</p>
</td></tr>
<tr><td><code>seMean</code></td>
<td>

<p>Mean of the Monte Carlo sampling distribution for the standard error estimates reported by glm().
</p>
</td></tr>
<tr><td><code>seRatio</code></td>
<td>

<p>Ratio of the mean reported standard error to the standard deviation of the Monte Carlo sampling
distribution for each regression coefficient estimator. The ratio is multiplied by 100.    
</p>
</td></tr>
<tr><td><code>betaCP</code></td>
<td>

<p>Coverage probability for Wald-based confidence intervals, evaluated on the basis of an <code>alpha</code> type I error rate.
</p>
</td></tr>
<tr><td><code>betaPower</code></td>
<td>

<p>Power against the null hypothesis that the regression coefficient is zero for a Wald-based test with an <code>alpha</code> type I error rate.
</p>
</td></tr>
<tr><td><code>betaRU</code></td>
<td>

<p>The ratio of the standard deviation of the Monte Carlo sampling
distribution for each estimator to the standard deviation of the Monte Carlo sampling distribution
for the estimator corresponding to <code>refDesign</code>. The ratio is multiplied by 100.
</p>
</td></tr>
</table>
<p>Also returned is an object <code>failed</code> which is a vector consisting of the number of datasets excluded from the power calculations (i.e. set to <code>NA</code>), for each simulation performed. For the evaluation of general operating characteristics, the four reasons are: (1) lack of convergence indicated by <code>NA</code> point estimates returned by <code><a href="stats.html#topic+glm">glm</a></code> or <code><a href="#topic+tps">tps</a></code>; (2) lack of convergence indicated by <code>NA</code> standard error point estimates returned by <code><a href="stats.html#topic+glm">glm</a></code> or <code><a href="#topic+tps">tps</a></code>; (3) exclusion on the basis of the <code>threshold</code> argument; and (4) for the ML estimator only, the phase I and/or phase II constraints are not satisfied.
</p>


<h3>Note</h3>

<p>A generic print method provides formatted output of the results.
</p>


<h3>Author(s)</h3>

<p>Sebastien Haneuse, Takumi Saegusa
</p>


<h3>References</h3>

<p>Prentice, R. and Pyke, R. (1979) &quot;Logistic disease incidence models and case-control studies.&quot; Biometrika 66:403-411.
</p>
<p>Breslow, N. and Chatterjee, N. (1999) &quot;Design and analysis of two phase studies with binary outcome applied to Wilms tumour prognosis.&quot; Applied Statistics 48:457-468.
</p>
<p>Haneuse, S. and Saegusa, T. and Lumley, T. (2011) &quot;osDesign: An R Package for the Analysis, Evaluation, and Design of Two-Phase and Case-Control Studies.&quot; Journal of Statistical Software, 43(11), 1-29.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##
data(Ohio)

## Design matrix that forms the basis for model and 
## phase I strata specification
##
XM &lt;- cbind(Int=1, Ohio[,1:3])      ## main effects only
XI &lt;- cbind(XM, SbyR=XM[,3]*XM[,4]) ## interaction between sex and race

## 'True' values for the underlying logistic model
##
fitM &lt;- glm(cbind(Death, N-Death) ~ factor(Age) + Sex + Race, data=Ohio,
            family=binomial)
fitI &lt;- glm(cbind(Death, N-Death) ~ factor(Age) + Sex * Race, data=Ohio,
            family=binomial)
##
betaNamesM &lt;- c("Int", "Age1", "Age2", "Sex", "Race")
betaNamesI &lt;- c("Int", "Age1", "Age2", "Sex", "Race", "SexRace")

## Two-phase design stratified by age
##   * sample 50 from each of 6 phase I strata
##   * show primary output (% bias, 95% CP, relative uncertainty)
##

ocAge &lt;- tpsSim(B=1000, betaTruth=fitM$coef, X=XM, N=Ohio$N, strata=2,
                nII0=c(50,50,50), nII1=c(50,50,50), betaNames=betaNamesM,
                monitor=100)
ocAge

## All possible balanced two-phase designs
##  * 250 controls and 250 cases
##  * only show the relative uncertainty output
##

ocAll &lt;- tpsSim(B=1000, betaTruth=fitM$coef, X=XM, N=Ohio$N, strata=0,
                nII=c(250, 250), betaNames=betaNamesM,
                monitor=100)
ocAll

## Two-phase design stratified by race
##  * balanced solely on outcome
##  * only show the relative uncertainty output
##

ocRace &lt;- tpsSim(B=1000, betaTruth=fitI$coef, X=XI, N=Ohio$N, strata=4,
                 nII0=c(200, 50), nII1=c(200, 50), betaNames=betaNamesI,
                 monitor=100)
ocRace

## Comparison of two case-control designs
##  * 240 controls and 260 cases
##  * 240 controls and 260 cases
##  * only show the relative uncertainty output
##

ocCC &lt;- tpsSim(B=1000, betaTruth=fitM$coef, X=XM, N=Ohio$N, strata=1,
               nII0=240, nII1= 260, nCC=c(200,300),
               betaNames=betaNamesM,
               monitor=100)
ocCC

## Illustration of setting where one of the covariates is continuous
##  * restrict to black and white children born in 2003
##  * dichotomize smoking, mothers age, weight gain during pregnancy and weight weight
##  * note the use of 'etaTerms' to restrict to specific variables (the majority of which
##    are created)
##  * note the use of 'strata=list(11,12)' to simultaneously investigate stratification by
##     - 11th column in XM: derived 'smoker' variable
##     - 12th column in XM: derived 'teen' variable
##
## Warning: takes a long time!
##

data(infants)
##
infants &lt;- infants[infants$year == 2003,]
##
infants$race[!is.element(infants$race, c(1,2))] &lt;- NA  ## White/Black = 0/1
infants$race &lt;- infants$race - 1
infants &lt;- na.omit(infants)
##
infants$smoker  &lt;- as.numeric(infants$cignum &gt; 0)
infants$teen    &lt;- as.numeric(infants$mage &lt; 20)
infants$lowgain &lt;- as.numeric(infants$gained &lt; 20)
infants$lbw     &lt;- as.numeric(infants$weight &lt; 2500)
infants$weeks   &lt;- (infants$weeks - 36) / 4       ## estimate a 4-week contrast
##
fitM  &lt;- glm(death ~ smoker + teen + race + male+ lowgain + lbw + weeks,
             data=infants,
             family=binomial)
betaM &lt;- fitM$coef
XM    &lt;- cbind(Int=1, infants)
etaM  &lt;- c("Int", "smoker", "teen", "race", "male", "lowgain", "lbw", "weeks")
##
tpsSim(B=1000, betaTruth=fitM$coef, X=XM, N=rep(1, nrow(XM)), strata=list(11,12),
       expand="none", etaTerms=etaM, nII=c(1000,1000),
       threshold=c(-20,20),
       monitor=100)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
