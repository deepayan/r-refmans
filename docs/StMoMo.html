<!DOCTYPE html><html><head><title>Help for package StMoMo</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {StMoMo}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#apc'><p>Create an Age-Period-Cohort mortality model</p></a></li>
<li><a href='#arima.string'><p>Copy of unexported function arima.string from forecast</p></a></li>
<li><a href='#binomRes2q'><p>Map Binomial deviance residuals into deaths</p></a></li>
<li><a href='#bootstrap'><p>Generic method for bootstrapping a fitted Stochastic Mortality Model</p></a></li>
<li><a href='#bootstrap.fitStMoMo'><p>Bootstrap a fitted Stochastic Mortality Model</p></a></li>
<li><a href='#cbd'><p>Create a Cairns-Blake-Dowd mortality model</p></a></li>
<li><a href='#central2initial'><p>Transform StMoMoData from central to initial exposures</p></a></li>
<li><a href='#coef.fitStMoMo'><p>Extract coefficients from a fitted Stochastic Mortality Model</p></a></li>
<li><a href='#computeDevianceBinomial'><p>Binomial deviance</p></a></li>
<li><a href='#computeDeviancePoisson'><p>Compute Poisson deviance</p></a></li>
<li><a href='#computeLogLikBinomial'><p>Compute Binomial loglikelihod</p></a></li>
<li><a href='#computeLogLikPoisson'><p>Compute Poisson loglikelihod</p></a></li>
<li><a href='#EWMaleData'><p>England and Wales male mortality data</p></a></li>
<li><a href='#extractCoefficientsFromGnm'><p>Extract the model coefficient</p></a></li>
<li><a href='#extractCohort'><p>Extract cohort from an age-period array</p></a></li>
<li><a href='#fit'><p>Generic for fitting a Stochastic Mortality Model</p></a></li>
<li><a href='#fit.rh'><p>Fit a Renshaw and Haberman (Lee-Carter with cohorts) mortality model</p></a></li>
<li><a href='#fit.StMoMo'><p>Fit a Stochastic Mortality Model</p></a></li>
<li><a href='#fitted.fitStMoMo'><p>Compute fitted values for a Stochastic Mortality Model</p></a></li>
<li><a href='#forecast.fitStMoMo'><p>Forecast mortality rates using a Stochastic Mortality Model</p></a></li>
<li><a href='#forecast.iarima'><p>Forecast independent arima series</p></a></li>
<li><a href='#forecast.mrwd'><p>Forecast a Multivariate Random Walk with Drift</p></a></li>
<li><a href='#genBinomialResBootSamples'><p>Generate Binomial residual bootstrap sample</p></a></li>
<li><a href='#genBinomialSemiparametricBootSamples'><p>Generate Binomial semiparametric bootstrap samples</p></a></li>
<li><a href='#genPoissonResBootSamples'><p>Generate Poisson residual bootstrap sample</p></a></li>
<li><a href='#genPoissonSemiparametricBootSamples'><p>Generate Poisson semiparametric bootstrap samples</p></a></li>
<li><a href='#genWeightMat'><p>Generate weight matrix</p></a></li>
<li><a href='#getMinimalFitStMoMo'><p>Extract a lighter version of a fitted Stochastic Mortality Model</p></a></li>
<li><a href='#iarima'><p>Fit independent arima series to a multivariate time series</p></a></li>
<li><a href='#initial2central'><p>Transform StMoMoData from initial to central exposures</p></a></li>
<li><a href='#invlogit'><p>Inverse Logit function</p>
<code>invlogit</code> computes the inverse logit function</a></li>
<li><a href='#lc'><p>Create a Lee-Carter model</p></a></li>
<li><a href='#logit'><p>Logit function</p>
<code>logit</code> computes the logit function</a></li>
<li><a href='#logLik.fitStMoMo'><p>Log-Likelihood of a fitStMoMo object</p></a></li>
<li><a href='#m6'><p>Create an M6 type extension of the Cairns-Blake-Dowd mortality model</p></a></li>
<li><a href='#m7'><p>Create an M7 type extension of the Cairns-Blake-Dowd mortality model</p></a></li>
<li><a href='#m8'><p>Create an M8 type extension of the Cairns-Blake-Dowd mortality model</p></a></li>
<li><a href='#mrwd'><p>Fit a Multivariate Random Walk with Drift</p></a></li>
<li><a href='#plot.bootStMoMo'><p>Plot bootstrapped parameters of a Stochastic Mortality Model</p></a></li>
<li><a href='#plot.fitStMoMo'><p>Plot fitted parameters from a stochastic mortality model</p></a></li>
<li><a href='#plot.forStMoMo'><p>Plot a forecast from a Stochastic Mortality Model</p></a></li>
<li><a href='#plot.resStMoMo'><p>Plot the residuals of a Stochastic Mortality Model</p></a></li>
<li><a href='#plotParameterFan'><p>Plot fanchart of the parameters</p></a></li>
<li><a href='#poissonRes2death'><p>Map poisson deviance residuals into deaths</p></a></li>
<li><a href='#predict.fitStMoMo'><p>Predict method for Stochastic Mortality Models fits</p></a></li>
<li><a href='#predictLink'><p>Compute the link for a given mortality models</p></a></li>
<li><a href='#processStartValues'><p>Process the initial parameter supplied by the user</p></a></li>
<li><a href='#residuals.fitStMoMo'><p>Extract deviance residuals of a Stochastic Mortality Model</p></a></li>
<li><a href='#rh'><p>Create a Renshaw and Haberman (Lee-Carter with cohorts) mortality model</p></a></li>
<li><a href='#scatterplotAPC'><p>Do a scatter plot of a matrix according to age-period-cohorts</p></a></li>
<li><a href='#simulate.bootStMoMo'><p>Simulate future sample paths from a Bootstrapped Stochastic</p>
Mortality Model</a></li>
<li><a href='#simulate.fitStMoMo'><p>Simulate future sample paths from a Stochastic Mortality Model</p></a></li>
<li><a href='#simulate.iarima'><p>Simulate independent arima series</p></a></li>
<li><a href='#simulate.mrwd'><p>Simulate a Multivariate Random Walk with Drift</p></a></li>
<li><a href='#StMoMo'><p>Create a new Stochastic Mortality Model</p></a></li>
<li><a href='#StMoMoData'><p>Create StMoMoData object from demogdata object</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Stochastic Mortality Modelling</td>
</tr>
<tr>
<td>Version:</td>
<td>0.4.1</td>
</tr>
<tr>
<td>Author:</td>
<td>Andres Villegas &lt;andresmauriciovillegas@gmail.com&gt;,
    Pietro Millossovich &lt;Pietro.Millossovich.1@city.ac.uk&gt;,
    Vladimir Kaishev &lt;Vladimir.Kaishev.1@city.ac.uk&gt;</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Andres Villegas &lt;andresmauriciovillegas@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Implementation of the family of generalised age-period-cohort
    stochastic mortality models. This family of models encompasses many models
    proposed in the actuarial and demographic literature including the 
    Lee-Carter (1992) &lt;<a href="https://doi.org/10.2307%2F2290201">doi:10.2307/2290201</a>&gt; and
    the Cairns-Blake-Dowd (2006) &lt;<a href="https://doi.org/10.1111%2Fj.1539-6975.2006.00195.x">doi:10.1111/j.1539-6975.2006.00195.x</a>&gt; models. 
    It includes functions for fitting mortality models, analysing their 
    goodness-of-fit and performing mortality projections and simulations.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="http://github.com/amvillegas/StMoMo">http://github.com/amvillegas/StMoMo</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="http://github.com/amvillegas/StMoMo/issues">http://github.com/amvillegas/StMoMo/issues</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>MASS, rootSolve (&ge; 1.6.5.1), fanplot (&ge; 3.4), reshape2 (&ge;
1.4.1), fields (&ge; 8.2), RColorBrewer</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.2.0), gnm (&ge; 1.0), forecast(&ge; 6.1)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Suggests:</td>
<td>demography, knitr, xtable, MTS</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr, utils</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.0.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2018-04-13 09:18:10 UTC; z3509687</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2018-04-13 11:12:44 UTC</td>
</tr>
</table>
<hr>
<h2 id='apc'>Create an Age-Period-Cohort mortality model</h2><span id='topic+apc'></span>

<h3>Description</h3>

<p>Utility function to initialise a <code>StMoMo</code> object representing an 
Age-Period-Cohort mortality model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apc(link = c("log", "logit"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apc_+3A_link">link</code></td>
<td>
<p>defines the link function and random component associated with 
the mortality model. <code>"log"</code> would assume that deaths follow a 
Poisson distribution and use a log link while <code>"logit"</code> would assume 
that deaths follow a Binomial distribution and a logit link.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The created model is either a log-Poisson or a logit-Binomial version of 
the classical age-period-cohort mortality model which has predictor 
structure 
</p>
<p style="text-align: center;"><code class="reqn">\eta_{xt} = \alpha_x + \kappa_t + \gamma_{t-x}.</code>
</p>

<p>To ensure identifiability we follow Cairns et al. (2009) and impose 
constraints </p>
<p style="text-align: center;"><code class="reqn">\sum_c \gamma_c = 0</code>
</p>
<p>  and  </p>
<p style="text-align: center;"><code class="reqn">\sum_c c\gamma_c = 0</code>
</p>



<h3>Value</h3>

<p>An object of class <code>"StMoMo"</code>.
</p>


<h3>References</h3>

<p>Cairns, A. J. G., Blake, D., Dowd, K., Coughlan, G. D., Epstein, D., 
Ong, A., &amp; Balevich, I. (2009). A quantitative comparison of stochastic 
mortality models using data from England and Wales and the United States. 
North American Actuarial Journal, 13(1), 1-35.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+StMoMo">StMoMo</a></code>, <code><a href="#topic+rh">rh</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
APC &lt;- apc()
wxt &lt;- genWeightMat(EWMaleData$ages,  EWMaleData$years, clip = 3)
APCfit &lt;- fit(APC, data = EWMaleData, wxt = wxt)
plot(APCfit, parametricbx = FALSE, nCol = 3)

</code></pre>

<hr>
<h2 id='arima.string'>Copy of unexported function arima.string from forecast</h2><span id='topic+arima.string'></span>

<h3>Description</h3>

<p>Copy of unexported function arima.string from forecast
</p>


<h3>Usage</h3>

<pre><code class='language-R'>arima.string(object, padding = FALSE)
</code></pre>

<hr>
<h2 id='binomRes2q'>Map Binomial deviance residuals into deaths</h2><span id='topic+binomRes2q'></span>

<h3>Description</h3>

<p>This function uses the procedure described in 
Debon et al. (2010, section 3)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>binomRes2q(dhat, e, res)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="binomRes2q_+3A_dhat">dhat</code></td>
<td>
<p>fitted number of deaths (scalar)</p>
</td></tr>
<tr><td><code id="binomRes2q_+3A_e">e</code></td>
<td>
<p>number of exposures (scalar)</p>
</td></tr>
<tr><td><code id="binomRes2q_+3A_res">res</code></td>
<td>
<p>deviance residual (scalar)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>matching observed deaths
</p>


<h3>References</h3>

<p>Debon, A., Martinez-Ruiz, F., &amp; Montes, F. (2010). A geostatistical 
approach for dynamic life tables: The effect of mortality on remaining 
lifetime and annuities. Insurance: Mathematics and Economics, 
47(3), 327-336.
</p>

<hr>
<h2 id='bootstrap'>Generic method for bootstrapping a fitted Stochastic Mortality Model</h2><span id='topic+bootstrap'></span>

<h3>Description</h3>

<p><code>bootstrap</code> is a generic function for bootstrapping Stochastic 
Mortality Models. The function invokes particular methods which depend on 
the class of the first argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bootstrap(object, nBoot, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bootstrap_+3A_object">object</code></td>
<td>
<p>an object used to select a method. Typically of class 
<code>fitStMoMo</code> or an extension of this class.</p>
</td></tr>
<tr><td><code id="bootstrap_+3A_nboot">nBoot</code></td>
<td>
<p>number of bootstrap samples to produce.</p>
</td></tr>
<tr><td><code id="bootstrap_+3A_...">...</code></td>
<td>
<p>arguments to be passed to or from other methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>bootstrap</code> is a generic function which means that new fitting 
strategies can be added for particular stochastic mortality models. See 
for instance <code><a href="#topic+bootstrap.fitStMoMo">bootstrap.fitStMoMo</a></code>.
</p>

<hr>
<h2 id='bootstrap.fitStMoMo'>Bootstrap a fitted Stochastic Mortality Model</h2><span id='topic+bootstrap.fitStMoMo'></span>

<h3>Description</h3>

<p>Produce bootstrap parameters of a Stochastic Mortality Model to account for 
parameter uncertainty.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'fitStMoMo'
bootstrap(object, nBoot = 1, type = c("semiparametric",
  "residual"), deathType = c("observed", "fitted"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bootstrap.fitStMoMo_+3A_object">object</code></td>
<td>
<p>an object of class <code>"fitStMoMo"</code> with the fitted 
parameters of a stochastic mortality model.</p>
</td></tr>
<tr><td><code id="bootstrap.fitStMoMo_+3A_nboot">nBoot</code></td>
<td>
<p>number of bootstrap samples to produce.</p>
</td></tr>
<tr><td><code id="bootstrap.fitStMoMo_+3A_type">type</code></td>
<td>
<p>type of bootstrapping approach to be applied. 
<code>"semiparametric"</code>(default) uses the assumed distribution of the 
deaths to generate bootstrap samples. <code>"residual"</code> resamples the 
deviance residuals of the model to generate bootstrap samples.</p>
</td></tr>
<tr><td><code id="bootstrap.fitStMoMo_+3A_deathtype">deathType</code></td>
<td>
<p>type of deaths to sample in the semiparametric bootstrap. 
<code>"observed"</code> (default) resamples the observed deaths. <code>"fitted"</code> 
resamples the fitted deaths. This parameter is only used if <code>type</code> is 
<code>"semiparametric"</code>.</p>
</td></tr>
<tr><td><code id="bootstrap.fitStMoMo_+3A_...">...</code></td>
<td>
<p>arguments to be passed to or from other methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When <code>type</code> is <code>"residual"</code> the residual bootstrapping approach 
described in Renshaw and Haberman (2008) is applied, which is an 
adaptation of the approach of Koissi et al (2006). In the case of a 
<code>"logit"</code> link with Binomial responses the adaptation described in 
Debon et al, (2010, section 3) is used.
</p>
<p>When <code>type</code> is <code>"semiparametric"</code> the semiparametric approach 
described in Brouhns et al.(2005) is used. In the case of a <code>"logit"</code> 
link with Binomial responses a suitable adaptation is applied. If 
<code>deathType</code> is <code>"observed"</code> then the observed deaths are used in 
the sampling as in Brouhns et al. (2005) while if <code>deathType</code> is 
<code>"fitted"</code> the fitted deaths are used in the sampling as in 
Renshaw and Haberman (2008).
</p>


<h3>Value</h3>

<p>A list with class <code>"bootStMoMo"</code> with components:
</p>
<table>
<tr><td><code>bootParameters</code></td>
<td>
<p> a list of of length <code>nBoot</code> with the fitted 
parameters for each bootstrap replication.</p>
</td></tr> 
<tr><td><code>model</code></td>
<td>
<p> the model fit that has been bootstrapped.</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p> type of bootstrapping approach applied.</p>
</td></tr>
<tr><td><code>deathType</code></td>
<td>
<p> type of deaths sampled in case of semiparametric 
bootstrap.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Brouhns, N., Denuit M., &amp; Van Keilegom, I. (2005). Bootstrapping the 
Poisson log-bilinear model for mortality forecasting. 
Scandinavian Actuarial Journal, 2005(3), 212-224. 
</p>
<p>Debon, A., Martinez-Ruiz, F., &amp; Montes, F. (2010). A geostatistical 
approach for dynamic life tables: The effect of mortality on remaining 
lifetime and annuities. Insurance: Mathematics and Economics, 47(3), 
327-336. 
</p>
<p>Renshaw, A. E., &amp; Haberman, S. (2008). On simulation-based approaches to 
risk measurement in mortality with specific reference to Poisson Lee-Carter 
modelling. Insurance: Mathematics and Economics, 42(2), 797-816.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+simulate.bootStMoMo">simulate.bootStMoMo</a></code>, <code><a href="#topic+plot.bootStMoMo">plot.bootStMoMo</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Long computing times
## Not run: 
LCfit &lt;- fit(lc(), data = EWMaleData)

LCResBoot &lt;- bootstrap(LCfit, nBoot = 500, type = "residual")
plot(LCResBoot)
LCSemiObsBoot &lt;- bootstrap(LCfit, nBoot = 500, type = "semiparametric")
plot(LCSemiObsBoot)
LCSemiFitBoot &lt;- bootstrap(LCfit, nBoot = 500, type = "semiparametric",  
                           deathType = "fitted")
plot(LCSemiFitBoot)

## End(Not run)

</code></pre>

<hr>
<h2 id='cbd'>Create a Cairns-Blake-Dowd mortality model</h2><span id='topic+cbd'></span>

<h3>Description</h3>

<p>Utility function to initialise a <code>StMoMo</code> object representing a 
Cairns-Blake-Dowd mortality model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cbd(link = c("logit", "log"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cbd_+3A_link">link</code></td>
<td>
<p>defines the link function and random component associated with 
the mortality model. <code>"log"</code> would assume that deaths follow a 
Poisson distribution and use a log link while <code>"logit"</code> would 
assume that deaths follow a Binomial distribution and a logit link. 
Note that the default is the logit link.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The created model is either a logit-Binomial or a log-Poisson version of 
the Cairns-Blake-Dowd mortality model which has predictor structure 
</p>
<p style="text-align: center;"><code class="reqn">\eta_{xt} = \kappa_t^{(1)} + (x-\bar{x})\kappa_t^{(2)},</code>
</p>

<p>where <code class="reqn">\bar{x}</code> is the average age in the data.
</p>


<h3>Value</h3>

<p>An object of class <code>"StMoMo"</code>.
</p>


<h3>References</h3>

<p>Cairns, A. J. G., Blake, D., &amp; Dowd, K. (2006). A Two-Factor Model for 
Stochastic Mortality with Parameter Uncertainty: Theory and Calibration. 
Journal of Risk and Insurance, 73(4), 687-718.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+StMoMo">StMoMo</a></code>, <code><a href="#topic+central2initial">central2initial</a></code>, 
<code><a href="#topic+m6">m6</a></code>, <code><a href="#topic+m7">m7</a></code>, <code><a href="#topic+m8">m8</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
CBD &lt;- cbd()
CBDfit &lt;- fit(CBD, data = central2initial(EWMaleData), ages.fit = 55:89)
plot(CBDfit, parametricbx = FALSE)

</code></pre>

<hr>
<h2 id='central2initial'>Transform StMoMoData from central to initial exposures</h2><span id='topic+central2initial'></span>

<h3>Description</h3>

<p>Transform StMoMoData from central to initial exposures. Initial exposures
are computed by adding one half of the deaths to the central exposures.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>central2initial(data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="central2initial_+3A_data">data</code></td>
<td>
<p>StMoMoData object of type &quot;central&quot; created with function 
<code><a href="#topic+StMoMoData">StMoMoData</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A StMoMoData object of type &quot;initial&quot;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+initial2central">initial2central</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
CBD &lt;- cbd()
CBDfit &lt;- fit(CBD, data = central2initial(EWMaleData), ages.fit = 55:89)
plot(CBDfit, parametricbx = FALSE)

</code></pre>

<hr>
<h2 id='coef.fitStMoMo'>Extract coefficients from a fitted Stochastic Mortality Model</h2><span id='topic+coef.fitStMoMo'></span>

<h3>Description</h3>

<p>Extract coefficients from a fitted Stochastic Mortality Model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'fitStMoMo'
coef(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coef.fitStMoMo_+3A_object">object</code></td>
<td>
<p>an object of class <code>"fitStMoMo"</code> with the fitted 
parameters of a stochastic mortality model.</p>
</td></tr>
<tr><td><code id="coef.fitStMoMo_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of model parameters with components:
</p>
<table>
<tr><td><code>ax</code></td>
<td>
<p> Vector with the fitted values of the static age function 
<code class="reqn">\alpha_x</code>. If the model does not have a static age function or failed 
to fit this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>bx</code></td>
<td>
<p> Matrix with the values of the period age-modulating functions 
<code class="reqn">\beta_x^{(i)}, i=1, ..., N</code>. If the <code class="reqn">i</code>-th age-modulating 
function is non-parametric (e.g., as in the Lee-Carter model) 
<code>bx[, i]</code> contains the estimated values. If the model does not have 
any age-period terms (i.e. <code class="reqn">N=0</code>) or failed to fit this is set to 
<code>NULL</code>.</p>
</td></tr>
<tr><td><code>kt</code></td>
<td>
<p> Matrix with the values of the fitted period indexes 
<code class="reqn">\kappa_t^{(i)}, i=1, ..., N</code>. <code>kt[i, ]</code> contains the estimated 
values of the <code class="reqn">i</code>-th period index. If the model does not have any 
age-period terms (i.e. <code class="reqn">N=0</code>) or failed to fit this is set to 
<code>NULL</code>.</p>
</td></tr>
<tr><td><code>b0x</code></td>
<td>
<p> Vector with the values of the cohort age-modulating function 
<code class="reqn">\beta_x^{(0)}</code>. If the age-modulating function is non-parametric 
<code>b0x</code> contains the estimated values. If the model does not have a 
cohort effect or failed to fit this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>gc</code></td>
<td>
<p> Vector with the fitted cohort index <code class="reqn">\gamma_{c}</code>.
If the model does not have a cohort effect or failed to fit this is set 
to <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>APCfit &lt;- fit(apc(), data = EWMaleData)
coef(APCfit) 
</code></pre>

<hr>
<h2 id='computeDevianceBinomial'>Binomial deviance</h2><span id='topic+computeDevianceBinomial'></span>

<h3>Description</h3>

<p>Binomial deviance
</p>


<h3>Usage</h3>

<pre><code class='language-R'>computeDevianceBinomial(obs, fit, exposure, weight)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="computeDevianceBinomial_+3A_obs">obs</code></td>
<td>
<p>observed rates</p>
</td></tr>
<tr><td><code id="computeDevianceBinomial_+3A_fit">fit</code></td>
<td>
<p>fitted rates</p>
</td></tr>
<tr><td><code id="computeDevianceBinomial_+3A_exposure">exposure</code></td>
<td>
<p>observed exposure</p>
</td></tr>
<tr><td><code id="computeDevianceBinomial_+3A_weight">weight</code></td>
<td>
<p>weights given to each observation#'</p>
</td></tr>
</table>

<hr>
<h2 id='computeDeviancePoisson'>Compute Poisson deviance</h2><span id='topic+computeDeviancePoisson'></span>

<h3>Description</h3>

<p>Compute Poisson deviance
</p>


<h3>Usage</h3>

<pre><code class='language-R'>computeDeviancePoisson(obs, fit, weight)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="computeDeviancePoisson_+3A_obs">obs</code></td>
<td>
<p>observed number of deaths</p>
</td></tr>
<tr><td><code id="computeDeviancePoisson_+3A_fit">fit</code></td>
<td>
<p>fitted number of deaths</p>
</td></tr>
<tr><td><code id="computeDeviancePoisson_+3A_weight">weight</code></td>
<td>
<p>weights given to each observation#'</p>
</td></tr>
</table>

<hr>
<h2 id='computeLogLikBinomial'>Compute Binomial loglikelihod</h2><span id='topic+computeLogLikBinomial'></span>

<h3>Description</h3>

<p>Compute Binomial loglikelihod
</p>


<h3>Usage</h3>

<pre><code class='language-R'>computeLogLikBinomial(obs, fit, exposure, weight)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="computeLogLikBinomial_+3A_obs">obs</code></td>
<td>
<p>observed rates</p>
</td></tr>
<tr><td><code id="computeLogLikBinomial_+3A_fit">fit</code></td>
<td>
<p>fitted rates</p>
</td></tr>
<tr><td><code id="computeLogLikBinomial_+3A_exposure">exposure</code></td>
<td>
<p>observed exposure</p>
</td></tr>
<tr><td><code id="computeLogLikBinomial_+3A_weight">weight</code></td>
<td>
<p>weights given to each observation#'</p>
</td></tr>
</table>

<hr>
<h2 id='computeLogLikPoisson'>Compute Poisson loglikelihod</h2><span id='topic+computeLogLikPoisson'></span>

<h3>Description</h3>

<p>Compute Poisson loglikelihod
</p>


<h3>Usage</h3>

<pre><code class='language-R'>computeLogLikPoisson(obs, fit, weight)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="computeLogLikPoisson_+3A_obs">obs</code></td>
<td>
<p>observed number of deaths</p>
</td></tr>
<tr><td><code id="computeLogLikPoisson_+3A_fit">fit</code></td>
<td>
<p>fitted number of deaths</p>
</td></tr>
<tr><td><code id="computeLogLikPoisson_+3A_weight">weight</code></td>
<td>
<p>weights given to each observation#'</p>
</td></tr>
</table>

<hr>
<h2 id='EWMaleData'>England and Wales male mortality data</h2><span id='topic+EWMaleData'></span>

<h3>Description</h3>

<p>Age-specific deaths and exposures for England and Wales from
the Human Mortality Database. This is an object of class StMoMoData.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EWMaleData
</code></pre>


<h3>Format</h3>

<p>A list  with the following components:
</p>

<dl>
<dt>Dxt</dt><dd><p> matrix of deaths data.</p>
</dd>
<dt>Ext</dt><dd><p> matrix of exposures data (mid year population estimates).</p>
</dd>
<dt>ages</dt><dd><p> vector of ages.</p>
</dd>
<dt>years</dt><dd><p> vector of years.</p>
</dd>
<dt>type</dt><dd><p> the type of exposure in the data (central).</p>
</dd>
<dt>series</dt><dd><p> name of the extracted seriesin this case males.</p>
</dd>
<dt>label</dt><dd><p> label of the data.</p>
</dd>
</dl>


<h3>Details</h3>

<p><code>EWMaleData</code> contains deaths and exposures for England and
Wales males for the period 1961-2011 and for ages 0-100.
Data taken from the Human Mortality Database on 5 November 2014.
</p>


<h3>Source</h3>

<p>Human Mortality Database <a href="http://www.mortality.org/">http://www.mortality.org/</a>.
</p>


<h3>References</h3>

<p>Human Mortality Database (2014). University of California,
Berkeley (USA), and Max Planck Institute for Demographic Research (Germany).
Available at <a href="www.mortality.org">www.mortality.org</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+StMoMoData">StMoMoData</a></code>
</p>

<hr>
<h2 id='extractCoefficientsFromGnm'>Extract the model coefficient</h2><span id='topic+extractCoefficientsFromGnm'></span>

<h3>Description</h3>

<p>Extract the model coefficient of a stochastic mortality model from
a gnm fit of the model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extractCoefficientsFromGnm(object, coefGnmModel, ages, years, cohorts,
  zeroWeigthAges, zeroWeigthYears, zeroWeigthCohorts)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extractCoefficientsFromGnm_+3A_object">object</code></td>
<td>
<p>an object of class <code>"StMoMo"</code> defining the stochastic
mortality model.</p>
</td></tr>
<tr><td><code id="extractCoefficientsFromGnm_+3A_coefgnmmodel">coefGnmModel</code></td>
<td>
<p>fitted coefficient from a gnm model fit.</p>
</td></tr>
<tr><td><code id="extractCoefficientsFromGnm_+3A_ages">ages</code></td>
<td>
<p>ages in the fitting data.</p>
</td></tr>
<tr><td><code id="extractCoefficientsFromGnm_+3A_years">years</code></td>
<td>
<p>years in the fitting data.</p>
</td></tr>
<tr><td><code id="extractCoefficientsFromGnm_+3A_cohorts">cohorts</code></td>
<td>
<p>cohorts in the fitting data.</p>
</td></tr>
<tr><td><code id="extractCoefficientsFromGnm_+3A_zeroweigthages">zeroWeigthAges</code></td>
<td>
<p>character vector of years whose parameters cannot 
be estimated because all data is zero weighted</p>
</td></tr>
<tr><td><code id="extractCoefficientsFromGnm_+3A_zeroweigthyears">zeroWeigthYears</code></td>
<td>
<p>character vector of years whose parameters cannot 
be estimated because all data is zero weighted</p>
</td></tr>
<tr><td><code id="extractCoefficientsFromGnm_+3A_zeroweigthcohorts">zeroWeigthCohorts</code></td>
<td>
<p>character vector of cohort whose parameters 
cannot be estimated because all data is zero weighted</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Weight vectors wx, wx, wc are used to identify parameters that
cannot be estimated because all the data is weighted out.
</p>


<h3>Value</h3>

<p>A list with the model parameters, ax, bx, kt, b0x, gc
</p>

<hr>
<h2 id='extractCohort'>Extract cohort from an age-period array</h2><span id='topic+extractCohort'></span>

<h3>Description</h3>

<p>Extract cohorts from an age-period array. This is useful to
construct a life table or to perform actuarial/demographic 
calculations on a cohort basis using the output of several functions
in <code>StMoMo</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extractCohort(A, age = as.numeric(dimnames(A)[[1]][1]),
  period = as.numeric(dimnames(A)[[2]][1]), cohort = period - age)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extractCohort_+3A_a">A</code></td>
<td>
<p>an age-period array with a demographic quantity. This array 
can have two or more dimensions, with the first dimension being the age and 
the second dimension being the period (calendar year). Note that the names 
of these two dimension are taken to represent the possible ages and periods
in the array.</p>
</td></tr>
<tr><td><code id="extractCohort_+3A_age">age</code></td>
<td>
<p>optional age for defining the cohort to be extracted. If 
argument <code>age</code> is provided (and argument <code>cohort</code> is not) then the 
extracted cohort corresponds to those born in the year <code>period-age</code>.</p>
</td></tr>
<tr><td><code id="extractCohort_+3A_period">period</code></td>
<td>
<p>optional period (calendar year) for defining the cohort to be 
extracted. If argument <code>period</code> is provided (and argument <code>cohort</code> 
is not) then the extracted cohort corresponds to those born in the year 
<code>period-age</code>.</p>
</td></tr>
<tr><td><code id="extractCohort_+3A_cohort">cohort</code></td>
<td>
<p>optional cohort to be extracted. If this argument is provided
then arguments <code>age</code> and <code>period</code> are ignored.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If the the input array is two dimensional the the output is a 
a vector with the quantity along the cohort. Otherwise if <code>A</code> is an 
N-dimensional  array the output is an (N-1)-dimensional array with the first 
dimension representing the cohort.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitted.fitStMoMo">fitted.fitStMoMo</a></code>, <code><a href="#topic+forecast.fitStMoMo">forecast.fitStMoMo</a></code>,
<code><a href="#topic+simulate.fitStMoMo">simulate.fitStMoMo</a></code>, <code><a href="#topic+simulate.bootStMoMo">simulate.bootStMoMo</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>LCfit &lt;- fit(lc(), data = EWMaleData, ages.fit = 55:89)
#Plot forecast mortality rates for the 1950 cohort
LCfor &lt;- forecast(LCfit)
plot(55:61, extractCohort(fitted(LCfit, type = "rates"), cohort = 1950), 
     type = "l", log = "y", xlab = "age", ylab = "Mortality rate", 
     main = "Mortality rates for the 1950 cohort", 
     xlim = c(55,89), ylim = c(0.005, 0.12))
lines(62:89, extractCohort(LCfor$rates, cohort = 1950), lty = 2, col = "blue")


#Plot 10 simulated sets of mortality rates for the cohort 
# aged 60 in year 2010 (i.e., the 1950 cohort)
LCsim &lt;- simulate(LCfit, nsim = 10)
mSim &lt;- extractCohort(LCsim$rates, age = 60, period = 2010)
plot(55:61, extractCohort(fitted(LCfit, type = "rates"), cohort = 1950), 
     type = "l", log = "y", xlab = "age", ylab = "Mortality rate", 
     main = "Mortality rates for the 1950 cohort", 
     xlim = c(55,89), ylim = c(0.005, 0.12))
matlines(62:89, mSim, lty = 2)

</code></pre>

<hr>
<h2 id='fit'>Generic for fitting a Stochastic Mortality Model</h2><span id='topic+fit'></span>

<h3>Description</h3>

<p><code>fit</code> is a generic function for fitting Stochastic Mortality Models. 
The function invokes particular methods which depend on the class of the 
first argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit_+3A_object">object</code></td>
<td>
<p>an object used to select a method. Typically of class 
<code>StMoMo</code> or an extension of this class.</p>
</td></tr>
<tr><td><code id="fit_+3A_...">...</code></td>
<td>
<p>arguments to be passed to or from other methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>fit</code> is a generic function which means that new fitting strategies 
can be added for particular stochastic mortality models. See for instance 
<code><a href="#topic+fit.StMoMo">fit.StMoMo</a></code>.
</p>

<hr>
<h2 id='fit.rh'>Fit a Renshaw and Haberman (Lee-Carter with cohorts) mortality model</h2><span id='topic+fit.rh'></span>

<h3>Description</h3>

<p>Fit a Renshaw and Haberman (Lee-Carter with cohorts) mortality model
using the iterative Newton-Raphson procedure presented in Algorithm 1
of Hunt and Villegas (2015). This approach helps solve the 
well-known robustness and converges issues of the Lee-Carter model 
with cohort-effects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'rh'
fit(object, data = NULL, Dxt = NULL, Ext = NULL,
  ages = NULL, years = NULL, ages.fit = NULL, years.fit = NULL,
  oxt = NULL, wxt = NULL, start.ax = NULL, start.bx = NULL,
  start.kt = NULL, start.b0x = NULL, start.gc = NULL, verbose = TRUE,
  tolerance = 1e-04, iterMax = 10000, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit.rh_+3A_object">object</code></td>
<td>
<p>an object of class <code>"rh"</code> created with function 
<code><a href="#topic+rh">rh</a></code>.</p>
</td></tr>
<tr><td><code id="fit.rh_+3A_data">data</code></td>
<td>
<p>an optional object of type StMoMoData containing information on
deaths and exposures to be used for fitting the model. This is typically created 
with  function <code><a href="#topic+StMoMoData">StMoMoData</a></code>. If this is not provided then the fitting 
data is taken from arguments, <code>Dxt</code>, <code>Ext</code>, <code>ages</code>, <code>years</code>.</p>
</td></tr>
<tr><td><code id="fit.rh_+3A_dxt">Dxt</code></td>
<td>
<p>optional matrix of deaths data.</p>
</td></tr>
<tr><td><code id="fit.rh_+3A_ext">Ext</code></td>
<td>
<p>optional matrix of observed exposures of the same dimension of 
<code>Dxt</code>.</p>
</td></tr>
<tr><td><code id="fit.rh_+3A_ages">ages</code></td>
<td>
<p>optional vector of ages corresponding to rows of <code>Dxt</code> and 
<code>Ext</code>.</p>
</td></tr>
<tr><td><code id="fit.rh_+3A_years">years</code></td>
<td>
<p>optional vector of years corresponding to rows of <code>Dxt</code> and 
<code>Ext</code>.</p>
</td></tr>
<tr><td><code id="fit.rh_+3A_ages.fit">ages.fit</code></td>
<td>
<p>optional vector of ages to include in the fit. Must be a 
subset of <code>ages</code>.</p>
</td></tr>
<tr><td><code id="fit.rh_+3A_years.fit">years.fit</code></td>
<td>
<p>optional vector of years to include in the fit. Must be a 
subset of <code>years</code>.</p>
</td></tr>
<tr><td><code id="fit.rh_+3A_oxt">oxt</code></td>
<td>
<p>optional matrix/vector or scalar of known offset to be used in fitting
the model. This can be used to specify any a priori known component to be added to 
the predictor during fitting.</p>
</td></tr>
<tr><td><code id="fit.rh_+3A_wxt">wxt</code></td>
<td>
<p>optional matrix of 0-1 weights to be used in the fitting process. 
This can be used, for instance, to zero weight some cohorts in the data.
See <code><a href="#topic+genWeightMat">genWeightMat</a></code> which is a helper function for defining 
weighting matrices.</p>
</td></tr>
<tr><td><code id="fit.rh_+3A_start.ax">start.ax</code></td>
<td>
<p>optional vector with starting values for <code class="reqn">\alpha_x</code>.</p>
</td></tr>
<tr><td><code id="fit.rh_+3A_start.bx">start.bx</code></td>
<td>
<p>optional matrix with starting values for <code class="reqn">\beta_x^{(i)}</code>.</p>
</td></tr>
<tr><td><code id="fit.rh_+3A_start.kt">start.kt</code></td>
<td>
<p>optional matrix with starting values for <code class="reqn">\kappa_t^{(i)}</code>.</p>
</td></tr>
<tr><td><code id="fit.rh_+3A_start.b0x">start.b0x</code></td>
<td>
<p>optional vector with starting values for <code class="reqn">\beta_x^{(0)}</code>.</p>
</td></tr>
<tr><td><code id="fit.rh_+3A_start.gc">start.gc</code></td>
<td>
<p>optional vector with starting values for <code class="reqn">\gamma_c</code>.</p>
</td></tr>
<tr><td><code id="fit.rh_+3A_verbose">verbose</code></td>
<td>
<p>a logical value. If <code>TRUE</code> progress indicators are 
printed as the model is fitted. Set <code>verbose = FALSE</code> to silent the 
fitting and avoid progress messages.</p>
</td></tr>
<tr><td><code id="fit.rh_+3A_tolerance">tolerance</code></td>
<td>
<p>a positive numeric value specifying the tolerance 
level for convergence.</p>
</td></tr>
<tr><td><code id="fit.rh_+3A_itermax">iterMax</code></td>
<td>
<p>a positive integer specifying the maximum number of 
iterations to perform.</p>
</td></tr>
<tr><td><code id="fit.rh_+3A_...">...</code></td>
<td>
<p>arguments to be passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>model</code></td>
<td>
<p> the object of class <code>"rh"</code> defining the fitted 
stochastic mortality model.</p>
</td></tr>
<tr><td><code>ax</code></td>
<td>
<p> vector with the fitted values of the static age function 
<code class="reqn">\alpha_x</code>. If the model does not have a static age function or 
failed to fit this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>bx</code></td>
<td>
<p> matrix with the values of the period age-modulating functions 
<code class="reqn">\beta_x^{(i)}, i=1, ..., N</code>. If the <code class="reqn">i</code>-th age-modulating 
function is non-parametric (e.g. as in the Lee-Carter model) 
<code>bx[, i]</code> contains the estimated values. If the model does not have 
any age-period terms (i.e. <code class="reqn">N=0</code>) or failed to fit this is set to 
<code>NULL</code>.</p>
</td></tr>
<tr><td><code>kt</code></td>
<td>
<p> matrix with the values of the fitted period indexes 
<code class="reqn">\kappa_t^{(i)}, i=1, ..., N</code>. <code>kt[i, ]</code> contains the estimated 
values of the <code class="reqn">i</code>-th period index. If the model does not have any 
age-period terms (i.e. <code class="reqn">N=0</code>) or failed to fit this is set to 
<code>NULL</code>.</p>
</td></tr>
<tr><td><code>b0x</code></td>
<td>
<p> vector with the values of the cohort age-modulating function 
<code class="reqn">\beta_x^{(0)}</code>. If the age-modulating function is non-parametric 
<code>b0x</code> contains the estimated values. If the model does not have a 
cohort effect or failed to fit this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>gc</code></td>
<td>
<p> vector with the fitted cohort index <code class="reqn">\gamma_{c}</code>.
If the model does not have a cohort effect or failed to fit this is set
to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p> StMoMoData object provided for fitting the model.</p>
</td></tr>
<tr><td><code>Dxt</code></td>
<td>
<p> matrix of deaths used in the fitting.</p>
</td></tr>
<tr><td><code>Ext</code></td>
<td>
<p> matrix of exposures used in the fitting.</p>
</td></tr>
<tr><td><code>oxt</code></td>
<td>
<p> matrix of known offset values used in the fitting.</p>
</td></tr>
<tr><td><code>wxt</code></td>
<td>
<p> matrix of 0-1 weights used in the fitting.</p>
</td></tr>
<tr><td><code>ages</code></td>
<td>
<p> vector of ages used in the fitting.</p>
</td></tr>
<tr><td><code>years</code></td>
<td>
<p> vector of years used in the fitting.</p>
</td></tr>
<tr><td><code>cohorts</code></td>
<td>
<p> vector of cohorts used in the fitting.</p>
</td></tr>
<tr><td><code>fittingModel</code></td>
<td>
<p> output from the iterative fitting algorithm.</p>
</td></tr>
<tr><td><code>loglik</code></td>
<td>
<p> log-likelihood of the model. If the fitting failed to 
converge this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>deviance</code></td>
<td>
<p> deviance of the model. If the fitting failed to 
converge this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>npar</code></td>
<td>
<p> effective number of parameters in the model. If the fitting
failed to converge this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>nobs</code></td>
<td>
<p> number of observations in the model fit. If the fitting
failed to converge this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>fail</code></td>
<td>
 <p><code>TRUE</code> if a model could not be fitted and 
<code>FALSE</code> otherwise.</p>
</td></tr>    
<tr><td><code>conv</code></td>
<td>
 <p><code>TRUE</code> if the model fitting converged and 
<code>FALSE</code> if it didn't.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Hunt, A., &amp; Villegas, A. M. (2015). Robustness and convergence in the 
Lee-Carter model with cohorts. Insurance: Mathematics and Economics, 
64, 186-202.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
LCfit &lt;-  fit(lc(), data = EWMaleData, ages.fit = 55:89)
wxt &lt;- genWeightMat(55:89,  EWMaleData$years, clip = 3)
RHfit &lt;- fit(rh(), data = EWMaleData, ages.fit = 55:89, 
             wxt = wxt, start.ax = LCfit$ax,
             start.bx = LCfit$bx, start.kt = LCfit$kt)
plot(RHfit)
 
#Impose approximate constraint as in Hunt and Villegas (2015)    
## Not run: 
RHapprox &lt;- rh(approxConst = TRUE)
RHapproxfit &lt;- fit(RHapprox, data = EWMaleData, ages.fit = 55:89, 
                    wxt = wxt)
plot(RHapproxfit) 

## End(Not run)

</code></pre>

<hr>
<h2 id='fit.StMoMo'>Fit a Stochastic Mortality Model</h2><span id='topic+fit.StMoMo'></span>

<h3>Description</h3>

<p>Fit a Stochastic Mortality Model to a given data set. The fitting is done 
using package <code>gnm</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'StMoMo'
fit(object, data = NULL, Dxt = NULL, Ext = NULL,
  ages = NULL, years = NULL, ages.fit = NULL, years.fit = NULL,
  oxt = NULL, wxt = NULL, start.ax = NULL, start.bx = NULL,
  start.kt = NULL, start.b0x = NULL, start.gc = NULL, verbose = TRUE,
  ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit.StMoMo_+3A_object">object</code></td>
<td>
<p>an object of class <code>"StMoMo"</code> defining the stochastic
mortality model.</p>
</td></tr>
<tr><td><code id="fit.StMoMo_+3A_data">data</code></td>
<td>
<p>an optional object of type StMoMoData containing information on
deaths and exposures to be used for fitting the model. This is typically created 
with  function <code><a href="#topic+StMoMoData">StMoMoData</a></code>. If this is not provided then the fitting 
data is taken from arguments, <code>Dxt</code>, <code>Ext</code>, <code>ages</code>, <code>years</code>.</p>
</td></tr>
<tr><td><code id="fit.StMoMo_+3A_dxt">Dxt</code></td>
<td>
<p>optional matrix of deaths data.</p>
</td></tr>
<tr><td><code id="fit.StMoMo_+3A_ext">Ext</code></td>
<td>
<p>optional matrix of observed exposures of the same dimension of 
<code>Dxt</code>.</p>
</td></tr>
<tr><td><code id="fit.StMoMo_+3A_ages">ages</code></td>
<td>
<p>optional vector of ages corresponding to rows of <code>Dxt</code> and 
<code>Ext</code>.</p>
</td></tr>
<tr><td><code id="fit.StMoMo_+3A_years">years</code></td>
<td>
<p>optional vector of years corresponding to rows of <code>Dxt</code> and 
<code>Ext</code>.</p>
</td></tr>
<tr><td><code id="fit.StMoMo_+3A_ages.fit">ages.fit</code></td>
<td>
<p>optional vector of ages to include in the fit. Must be a 
subset of <code>ages</code>.</p>
</td></tr>
<tr><td><code id="fit.StMoMo_+3A_years.fit">years.fit</code></td>
<td>
<p>optional vector of years to include in the fit. Must be a 
subset of <code>years</code>.</p>
</td></tr>
<tr><td><code id="fit.StMoMo_+3A_oxt">oxt</code></td>
<td>
<p>optional matrix/vector or scalar of known offset to be used in fitting
the model. This can be used to specify any a priori known component to be added to 
the predictor during fitting.</p>
</td></tr>
<tr><td><code id="fit.StMoMo_+3A_wxt">wxt</code></td>
<td>
<p>optional matrix of 0-1 weights to be used in the fitting process. 
This can be used, for instance, to zero weight some cohorts in the data.
See <code><a href="#topic+genWeightMat">genWeightMat</a></code> which is a helper function for defining 
weighting matrices.</p>
</td></tr>
<tr><td><code id="fit.StMoMo_+3A_start.ax">start.ax</code></td>
<td>
<p>optional vector with starting values for <code class="reqn">\alpha_x</code>.</p>
</td></tr>
<tr><td><code id="fit.StMoMo_+3A_start.bx">start.bx</code></td>
<td>
<p>optional matrix with starting values for <code class="reqn">\beta_x^{(i)}</code>.</p>
</td></tr>
<tr><td><code id="fit.StMoMo_+3A_start.kt">start.kt</code></td>
<td>
<p>optional matrix with starting values for <code class="reqn">\kappa_t^{(i)}</code>.</p>
</td></tr>
<tr><td><code id="fit.StMoMo_+3A_start.b0x">start.b0x</code></td>
<td>
<p>optional vector with starting values for <code class="reqn">\beta_x^{(0)}</code>.</p>
</td></tr>
<tr><td><code id="fit.StMoMo_+3A_start.gc">start.gc</code></td>
<td>
<p>optional vector with starting values for <code class="reqn">\gamma_c</code>.</p>
</td></tr>
<tr><td><code id="fit.StMoMo_+3A_verbose">verbose</code></td>
<td>
<p>a logical value. If <code>TRUE</code> progress indicators are 
printed as the model is fitted. Set <code>verbose = FALSE</code> to silent the 
fitting and avoid progress messages.</p>
</td></tr>
<tr><td><code id="fit.StMoMo_+3A_...">...</code></td>
<td>
<p>arguments to be passed to or from other methods. This can be 
used to control the fitting parameters of <code>gnm</code>. See 
<code><a href="gnm.html#topic+gnm">gnm</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Fitting is done using function <code><a href="gnm.html#topic+gnm">gnm</a></code> within package 
<code>gnm</code>. This is equivalent to minimising (maximising) the deviance 
(log-likelihood) of the  model. Ages and years in the data should be of 
type numeric. Data points with zero exposure are assigned a zero weight 
and are ignored in the fitting process. Similarly, <code>NA</code> are assigned a
zero weight and ignored in the fitting process. Parameter estimates can be 
plotted using function <code><a href="#topic+plot.fitStMoMo">plot.fitStMoMo</a></code>.
</p>


<h3>Value</h3>

<p>A list with class <code>"fitStMoMo"</code> with components:
</p>
<table>
<tr><td><code>model</code></td>
<td>
<p> the object of class <code>"StMoMo"</code> defining the fitted 
stochastic mortality model.</p>
</td></tr>
<tr><td><code>ax</code></td>
<td>
<p> vector with the fitted values of the static age function 
<code class="reqn">\alpha_x</code>. If the model does not have a static age function or 
failed to fit this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>bx</code></td>
<td>
<p> matrix with the values of the period age-modulating functions 
<code class="reqn">\beta_x^{(i)}, i=1, ..., N</code>. If the <code class="reqn">i</code>-th age-modulating 
function is non-parametric (e.g. as in the Lee-Carter model) 
<code>bx[, i]</code> contains the estimated values. If the model does not have 
any age-period terms (i.e. <code class="reqn">N=0</code>) or failed to fit this is set to 
<code>NULL</code>.</p>
</td></tr>
<tr><td><code>kt</code></td>
<td>
<p> matrix with the values of the fitted period indexes 
<code class="reqn">\kappa_t^{(i)}, i=1, ..., N</code>. <code>kt[i, ]</code> contains the estimated 
values of the <code class="reqn">i</code>-th period index. If the model does not have any 
age-period terms (i.e. <code class="reqn">N=0</code>) or failed to fit this is set to 
<code>NULL</code>.</p>
</td></tr>
<tr><td><code>b0x</code></td>
<td>
<p> vector with the values of the cohort age-modulating function 
<code class="reqn">\beta_x^{(0)}</code>. If the age-modulating function is non-parametric 
<code>b0x</code> contains the estimated values. If the model does not have a 
cohort effect or failed to fit this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>gc</code></td>
<td>
<p> vector with the fitted cohort index <code class="reqn">\gamma_{c}</code>.
If the model does not have a cohort effect or failed to fit this is set
to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p> StMoMoData object provided for fitting the model.</p>
</td></tr>
<tr><td><code>Dxt</code></td>
<td>
<p> matrix of deaths used in the fitting.</p>
</td></tr>
<tr><td><code>Ext</code></td>
<td>
<p> matrix of exposures used in the fitting.</p>
</td></tr>
<tr><td><code>oxt</code></td>
<td>
<p> matrix of known offset values used in the fitting.</p>
</td></tr>
<tr><td><code>wxt</code></td>
<td>
<p> matrix of 0-1 weights used in the fitting.</p>
</td></tr>
<tr><td><code>ages</code></td>
<td>
<p> vector of ages used in the fitting.</p>
</td></tr>
<tr><td><code>years</code></td>
<td>
<p> vector of years used in the fitting.</p>
</td></tr>
<tr><td><code>cohorts</code></td>
<td>
<p> vector of cohorts used in the fitting.</p>
</td></tr>
<tr><td><code>fittingModel</code></td>
<td>
<p> output from the call to <code>gnm</code> used to fit the 
model. If the fitting failed to converge this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>loglik</code></td>
<td>
<p> log-likelihood of the model. If the fitting failed to 
converge this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>deviance</code></td>
<td>
<p> deviance of the model. If the fitting failed to 
converge this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>npar</code></td>
<td>
<p> effective number of parameters in the model. If the fitting
failed to converge this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>nobs</code></td>
<td>
<p> number of observations in the model fit. If the fitting
failed to converge this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>fail</code></td>
<td>
 <p><code>TRUE</code> if a model could not be fitted and 
<code>FALSE</code> otherwise.</p>
</td></tr>    
<tr><td><code>conv</code></td>
<td>
 <p><code>TRUE</code> if the model fitting converged and 
<code>FALSE</code> if it didn't.</p>
</td></tr>
</table>
<p>@seealso <code><a href="#topic+StMoMoData">StMoMoData</a></code>, <code><a href="#topic+genWeightMat">genWeightMat</a></code>, 
<code><a href="#topic+plot.fitStMoMo">plot.fitStMoMo</a></code>, <code><a href="#topic+EWMaleData">EWMaleData</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>   

# Lee-Carter model only for older ages
LCfit &lt;- fit(lc(), data = EWMaleData, ages.fit = 55:89)
plot(LCfit)

# Use arguments Dxt, Ext, ages, years to pass fitting data
LCfit &lt;- fit(lc(), Dxt = EWMaleData$Dxt, Ext = EWMaleData$Ext, 
             ages = EWMaleData$ages, years = EWMaleData$years, 
             ages.fit = 55:89)
plot(LCfit)

# APC model weigthing out the 3 first and last cohorts
wxt &lt;- genWeightMat(EWMaleData$ages,  EWMaleData$years, clip = 3)
APCfit &lt;- fit(apc(), data = EWMaleData, wxt = wxt)
plot(APCfit, parametricbx = FALSE, nCol = 3)

# Set verbose = FALSE for silent fitting
APCfit &lt;- fit(apc(), data = EWMaleData,  wxt = wxt, 
              verbose = FALSE)
## Not run: 
  # Poisson Lee-Carter model with the static age function set to  
  # the mean over time of the log-death rates
  constLCfix_ax &lt;- function(ax, bx, kt, b0x, gc, wxt, ages){  
    c1 &lt;- sum(bx, na.rm = TRUE)
    bx &lt;- bx / c1
    kt &lt;- kt * c1  
    list(ax = ax, bx = bx, kt = kt, b0x = b0x, gc = gc)  
  }  
  LCfix_ax &lt;- StMoMo(link = "log", staticAgeFun = FALSE, 
                     periodAgeFun = "NP", constFun =  constLCfix_ax)
  LCfix_axfit &lt;- fit(LCfix_ax, data= EWMaleData, 
                     oxt = rowMeans(log(EWMaleData$Dxt / EWMaleData$Ext)))
  plot(LCfix_axfit)

## End(Not run)
</code></pre>

<hr>
<h2 id='fitted.fitStMoMo'>Compute fitted values for a Stochastic Mortality Model</h2><span id='topic+fitted.fitStMoMo'></span>

<h3>Description</h3>

<p>Returns fitted values for the data used in fitting a Stochastic Mortality 
Model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'fitStMoMo'
fitted(object, type = c("link", "rates", "deaths"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fitted.fitStMoMo_+3A_object">object</code></td>
<td>
<p>an object of class <code>"fitStMoMo"</code> with the fitted 
parameters of a stochastic mortality model.</p>
</td></tr>
<tr><td><code id="fitted.fitStMoMo_+3A_type">type</code></td>
<td>
<p>the type of the fitted values that should be returned. The 
alternatives are <code>"link"</code>(default), <code>"rates"</code>, and 
<code>"deaths"</code>.</p>
</td></tr>
<tr><td><code id="fitted.fitStMoMo_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix with the fitted values.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>LCfit &lt;- fit(lc(), data = EWMaleData, ages.fit = 55:89)
matplot(LCfit$ages, fitted(LCfit), type = "l", lty = 1, 
        col = rainbow(length(LCfit$years)), xlab = "year", 
        ylab = "log death rate", main = "Fitted rates")

uxthat &lt;- fitted(LCfit, type = "rates")
uxt &lt;- LCfit$Dxt / LCfit$Ext
plot(LCfit$years, uxt["65", ], xlab = "year", ylab = "death rate",
     main = "fitted vs. observed rates at age 65")
lines(LCfit$years, uxthat["65", ])
</code></pre>

<hr>
<h2 id='forecast.fitStMoMo'>Forecast mortality rates using a Stochastic Mortality Model</h2><span id='topic+forecast.fitStMoMo'></span>

<h3>Description</h3>

<p>Forecast mortality rates using a Stochastic Mortality Model fit.
The period indexes <code class="reqn">\kappa_t^{(i)}, i = 1,..N,</code> are forecasted
using ether a Multivariate Random Walk with Drift (MRWD) or 
<code class="reqn">N</code> independent ARIMA<code class="reqn">(p, d, q)</code> models. The cohort index 
<code class="reqn">\gamma_{t-x}</code> is forecasted using an ARIMA<code class="reqn">(p, d, q)</code>. 
By default an ARIMA<code class="reqn">(1, 1, 0)</code> with a constant is used.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'fitStMoMo'
forecast(object, h = 50, level = c(80, 95),
  oxt = NULL, gc.order = c(1, 1, 0), gc.include.constant = TRUE,
  jumpchoice = c("fit", "actual"), kt.method = c("mrwd", "iarima"),
  kt.order = NULL, kt.include.constant = TRUE, kt.lookback = NULL,
  gc.lookback = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="forecast.fitStMoMo_+3A_object">object</code></td>
<td>
<p>an object of class <code>"fitStMoMo"</code> with the fitted 
parameters of a stochastic mortality model.</p>
</td></tr>
<tr><td><code id="forecast.fitStMoMo_+3A_h">h</code></td>
<td>
<p>number of years ahead to forecast.</p>
</td></tr>
<tr><td><code id="forecast.fitStMoMo_+3A_level">level</code></td>
<td>
<p>confidence level for prediction intervals of the 
period and cohort indices.</p>
</td></tr>
<tr><td><code id="forecast.fitStMoMo_+3A_oxt">oxt</code></td>
<td>
<p>optional matrix/vector or scalar of known offset to be 
added in the forecasting. This can be used to specify any a priori 
known component to be added to the forecasted predictor.</p>
</td></tr>
<tr><td><code id="forecast.fitStMoMo_+3A_gc.order">gc.order</code></td>
<td>
<p>a specification of the ARIMA model for the cohort effect: 
the three components <code class="reqn">(p, d, q)</code> are the AR order, the degree of 
differencing, and the MA. The default is an ARIMA<code class="reqn">(1, 1, 0)</code>.</p>
</td></tr>
<tr><td><code id="forecast.fitStMoMo_+3A_gc.include.constant">gc.include.constant</code></td>
<td>
<p>a logical value indicating if the ARIMA model
should include a constant value. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="forecast.fitStMoMo_+3A_jumpchoice">jumpchoice</code></td>
<td>
<p>option to select the jump-off rates, i.e. the rates 
from the final year of observation, to use in projections of mortality 
rates. <code>"fit"</code>(default) uses the fitted rates and <code>"actual"</code> 
uses the actual rates from the final year.</p>
</td></tr>
<tr><td><code id="forecast.fitStMoMo_+3A_kt.method">kt.method</code></td>
<td>
<p>optional forecasting method for the period index. 
The alternatives are <code>"mrwd"</code>(default) and <code>"iarima"</code>. See details.</p>
</td></tr>
<tr><td><code id="forecast.fitStMoMo_+3A_kt.order">kt.order</code></td>
<td>
<p>an optional matrix with one row per period index
specifying the ARIMA models: for the ith row (ith period index) the three 
components <code class="reqn">(p, d, q)</code> are the AR order, the degree of  differencing, 
and the MA order. If absent the arima models are fitted using 
<code><a href="forecast.html#topic+auto.arima">auto.arima</a></code>. This argument is only used when
<code>kt.method</code> is <code>"iarima"</code>.</p>
</td></tr>
<tr><td><code id="forecast.fitStMoMo_+3A_kt.include.constant">kt.include.constant</code></td>
<td>
<p>an optional vector of logical values 
indicating if the ARIMA model for the ith period index should include a 
constant value. The default is <code>TRUE</code>.  This argument is only used 
when <code>kt.method</code> is <code>"iarima"</code>.</p>
</td></tr>
<tr><td><code id="forecast.fitStMoMo_+3A_kt.lookback">kt.lookback</code></td>
<td>
<p>optional argument to specify the look-back window to use
in the estimation of the time series model for the period indexes. By 
default all the estimated values are used. If 
<code>kt.lookback</code> is provided then the last <code>kt.lookback</code> 
years of <code class="reqn">\kappa_t^{(i)}, i = 1,..N,</code> are used.</p>
</td></tr>
<tr><td><code id="forecast.fitStMoMo_+3A_gc.lookback">gc.lookback</code></td>
<td>
<p>optional argument to specify the look-back window to use
in the estimation of the ARIMA model for the cohort effect. By 
default all the estimated values are used in estimating the ARIMA 
model. If <code>gc.lookback</code> is provided then the last 
<code>gc.lookback</code> years of <code class="reqn">\gamma_{t-x}</code> are used.</p>
</td></tr>
<tr><td><code id="forecast.fitStMoMo_+3A_...">...</code></td>
<td>
<p>other arguments for <code><a href="#topic+iarima">iarima</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>kt.method</code> is <code>"mrwd"</code>, fitting and forecasting of 
the time series model for the  period indexes is done with a 
Multivariate Random Walk with Drift using the function 
<code><a href="#topic+mrwd">mrwd</a></code>.
</p>
<p>If <code>kt.method</code> is <code>"iarima"</code>, fitting and forecasting of 
the time series model for the  period indexes is done with <code class="reqn">N</code> 
independent arima models using the function <code><a href="#topic+iarima">iarima</a></code>. 
See this latter function for details on input arguments 
<code>kt.order</code> and <code>kt.include.constant</code>.  
</p>
<p>Fitting and forecasting of the ARIMA model for the cohort index
is done with function <code><a href="forecast.html#topic+Arima">Arima</a></code> from package 
<span class="pkg">forecast</span>. See the latter function for further details on 
input arguments <code>gc.order</code> and <code>gc.include.constant</code>. 
</p>
<p>Note that in some cases forecast of the cohort effects may be
needed for a horizon longer than <code>h</code>. This is the case when 
in the fitted model the most recent cohorts have been zero weighted. 
The forecasted cohorts can be seen in <code>gc.f$cohorts</code>.
</p>


<h3>Value</h3>

<p>A list of class <code>"forStMoMo"</code> with components:
</p>
<table>
<tr><td><code>rates</code></td>
<td>
<p> a matrix with the point forecast of the rates.</p>
</td></tr>
<tr><td><code>ages</code></td>
<td>
<p> vector of ages corresponding to the rows of <code>rates</code>.</p>
</td></tr>
<tr><td><code>years</code></td>
<td>
<p>vector of years for which a forecast has been produced. This
corresponds to the columns of <code>rates</code>.</p>
</td></tr>
<tr><td><code>kt.f</code></td>
<td>
<p> forecasts of period indexes of the model. This is a list with 
the <code>model</code> fitted to <code class="reqn">\kappa_t</code>; the <code>mean</code>(central) 
forecast, the <code>lower</code> and <code>upper</code> limits of the prediction 
intervals; the confidence <code>level</code> associated with the prediction 
intervals; and the <code>years</code> for which a forecast was produced. If the 
model does not have any age-period terms (i.e. <code class="reqn">N=0</code>) this is set to 
<code>NULL</code>.</p>
</td></tr>
<tr><td><code>gc.f</code></td>
<td>
<p> forecasts of cohort index of the model. This is a list with 
the <code>model</code> fitted to <code class="reqn">\gamma_c</code>; the <code>mean</code>(point) forecast,
the <code>lower</code> and <code>upper</code> limits of the prediction intervals; the
confidence <code>level</code> associated with the prediction intervals; and the 
<code>cohorts</code> for which a forecast was produced. If the mortality model
does not have a cohort effect this is set to <code>NULL</code>.</p>
</td></tr> 
<tr><td><code>oxt.f</code></td>
<td>
<p> the offset used in the forecast.</p>
</td></tr>
<tr><td><code>fitted</code></td>
<td>
<p> a matrix with the fitted in-sample rates of the model for 
the years for which the mortality model was fitted.</p>
</td></tr>
<tr><td><code>model</code></td>
<td>
<p>the model fit from which the forecast was produced.</p>
</td></tr>
<tr><td><code>jumpchoice</code></td>
<td>
<p>Jump-off method used in the forecast.</p>
</td></tr>
<tr><td><code>kt.method</code></td>
<td>
<p>method used in the forecast of the period index.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>#Lee-Carter (random walk with drift)
LCfit &lt;- fit(lc(), data = EWMaleData, ages.fit = 55:89)
LCfor &lt;- forecast(LCfit)
plot(LCfor)

#Lee-Carter (forecast with ARIMA(1,1,2) with drift )
LCfor.iarima1 &lt;- forecast(LCfit, kt.method = "iarima", kt.order = c(1, 1 , 2))
plot(LCfor.iarima1)

#Lee-Carter (forecast with auto.arima)
LCfor.iarima2 &lt;- forecast(LCfit, kt.method = "iarima")
plot(LCfor.iarima2)

#CBD (Multivariate random walk with drift)
CBDfit &lt;- fit(cbd(), data = central2initial(EWMaleData), ages.fit = 55:89)
CBDfor &lt;- forecast(CBDfit)
plot(CBDfor, parametricbx = FALSE)

#CBD (Independent Arima models)
kt.order &lt;- matrix(c(1, 1, 2,  #ARIMA(1, 1, 2) for k[1]
                     0, 1, 1), #ARIMA(0, 1, 1) for k[2]
                   nrow = 2, ncol = 3, byrow = TRUE)
CBDfor.iarima &lt;- forecast(CBDfit, kt.method = "iarima", kt.order = kt.order)
plot(CBDfor.iarima, parametricbx = FALSE)

#APC: Compare forecast with different models for the cohort index
wxt &lt;- genWeightMat(55:89,  EWMaleData$years, clip = 3)
APCfit &lt;- fit(apc(), data = EWMaleData,  ages.fit = 55:89, 
              wxt = wxt)
APCfor1 &lt;- forecast(APCfit)
plot(APCfor1, parametricbx = FALSE, nCol = 3)
APCfor2 &lt;- forecast(APCfit, gc.order = c(0, 2, 2))
plot(APCfor2, only.gc = TRUE)
plot(c(APCfit$years, APCfor1$years), 
     cbind(APCfor1$fitted, APCfor1$rates)["65", ], 
     type = "l", xlab = "year", ylab = "Mortality rate at age 65", 
     main = "Forecasts with different models for gc")
lines(APCfor2$years, APCfor2$rates["65", ], col = "blue")
points(APCfit$years, (APCfit$Dxt / APCfit$Ext)["65", ], pch = 19) 

#Compare Lee-Carter forecast using: 
#  1. Fitted jump-off rates and all history for kt
#  2. Actual jump-off rates and all history for kt
#  3. Fitted jump-off rates and only history for 
#     the past 30 years of kt (i.e 1982-2011)

LCfor1 &lt;- forecast(LCfit)
LCfor2 &lt;- forecast(LCfit, jumpchoice = "actual")
LCfor3 &lt;- forecast(LCfit, kt.lookback = 30) 

plot(LCfit$years, (LCfit$Dxt / LCfit$Ext)["60", ],
     xlim = range(LCfit$years, LCfor1$years),
     ylim = range((LCfit$Dxt / LCfit$Ext)["60", ], LCfor1$rates["60", ],
                  LCfor2$rates["60", ], LCfor3$rates["60", ]),
     type = "p", xlab = "year", ylab = "rate",
     main = "Lee-Carter: Forecast of mortality rates at age 60")
lines(LCfit$years, fitted(LCfit, type = "rates")["60", ])
lines(LCfor1$years, LCfor1$rates["60", ], lty = 2)
lines(LCfor2$years, LCfor2$rates["60", ], lty = 3, col = "blue")
lines(LCfor3$years, LCfor3$rates["60", ], lty = 4, col = "red")
legend("topright",legend = c("Fitted jump-off", "Actual jump-off", 
       "Fitted jump-off, 30 year look-back"), 
       lty = 1:3, col = c("black", "blue", "red"))
</code></pre>

<hr>
<h2 id='forecast.iarima'>Forecast independent arima series</h2><span id='topic+forecast.iarima'></span>

<h3>Description</h3>

<p>Returns forecasts and other information for a group of
independent arima series.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'iarima'
forecast(object, h = 10, level = c(80, 95), fan = FALSE,
  ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="forecast.iarima_+3A_object">object</code></td>
<td>
<p>an object of class <code>"iarima"</code>.</p>
</td></tr>
<tr><td><code id="forecast.iarima_+3A_h">h</code></td>
<td>
<p>Number of periods for forecasting.</p>
</td></tr>
<tr><td><code id="forecast.iarima_+3A_level">level</code></td>
<td>
<p>confidence level for prediction intervals.</p>
</td></tr>
<tr><td><code id="forecast.iarima_+3A_fan">fan</code></td>
<td>
<p>if <code>TRUE</code>, level is set to <code>seq(50, 99, by = 1)</code>. 
This is suitable for fan plots.</p>
</td></tr>
<tr><td><code id="forecast.iarima_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>"iarimaForecast"</code> with components:
</p>
<table>
<tr><td><code>model</code></td>
<td>
<p>a list containing information about the fitted arima models.</p>
</td></tr>
<tr><td><code>mean</code></td>
<td>
<p> array with the central forecast.</p>
</td></tr>
<tr><td><code>lower</code></td>
<td>
<p> three dimensional array with lower limits for prediction 
intervals.</p>
</td></tr>
<tr><td><code>upper</code></td>
<td>
<p> three dimensional array with upper limits for prediction 
intervals.</p>
</td></tr>
<tr><td><code>level</code></td>
<td>
<p> the confidence values associated with the prediction 
intervals.</p>
</td></tr>
</table>
<p>@export
</p>

<hr>
<h2 id='forecast.mrwd'>Forecast a Multivariate Random Walk with Drift</h2><span id='topic+forecast.mrwd'></span>

<h3>Description</h3>

<p>Returns forecasts and other information for a Multivariate 
Random Walk with Drift model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mrwd'
forecast(object, h = 10, level = c(80, 95), fan = FALSE,
  ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="forecast.mrwd_+3A_object">object</code></td>
<td>
<p>an object of class <code>"mrwd"</code>.</p>
</td></tr>
<tr><td><code id="forecast.mrwd_+3A_h">h</code></td>
<td>
<p>Number of periods for forecasting.</p>
</td></tr>
<tr><td><code id="forecast.mrwd_+3A_level">level</code></td>
<td>
<p>confidence level for prediction intervals.</p>
</td></tr>
<tr><td><code id="forecast.mrwd_+3A_fan">fan</code></td>
<td>
<p>if <code>TRUE</code>, level is set to <code>seq(50, 99, by = 1)</code>. 
This is suitable for fan plots.</p>
</td></tr>
<tr><td><code id="forecast.mrwd_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>"mrwdForecast"</code> with components:
</p>
<table>
<tr><td><code>model</code></td>
<td>
<p>a list containing information about the fitted model.</p>
</td></tr>
<tr><td><code>mean</code></td>
<td>
<p> array with the central forecast.</p>
</td></tr>
<tr><td><code>lower</code></td>
<td>
<p> three dimensional array with lower limits for prediction 
intervals.</p>
</td></tr>
<tr><td><code>upper</code></td>
<td>
<p> three dimensional array with upper limits for prediction 
intervals.</p>
</td></tr>
<tr><td><code>level</code></td>
<td>
<p> the confidence values associated with the prediction 
intervals.</p>
</td></tr>
</table>
<p>@export
</p>

<hr>
<h2 id='genBinomialResBootSamples'>Generate Binomial residual bootstrap sample</h2><span id='topic+genBinomialResBootSamples'></span>

<h3>Description</h3>

<p>Generate Binomial bootstrap samples using the procedure
described in Debon et al. (2010, section 3)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>genBinomialResBootSamples(devRes, dhat, E, nBoot)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="genBinomialResBootSamples_+3A_devres">devRes</code></td>
<td>
<p>Matrix of deviance residuals</p>
</td></tr>
<tr><td><code id="genBinomialResBootSamples_+3A_dhat">dhat</code></td>
<td>
<p>Matrix of fitted deaths</p>
</td></tr>
<tr><td><code id="genBinomialResBootSamples_+3A_e">E</code></td>
<td>
<p>Matrix of observed exposures</p>
</td></tr>
<tr><td><code id="genBinomialResBootSamples_+3A_nboot">nBoot</code></td>
<td>
<p>number of bootstrap samples to produce.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of length <code>nBoot</code> of matrices with matching sampled 
deaths
</p>


<h3>References</h3>

<p>Debon, A., Martinez-Ruiz, F., &amp; Montes, F. (2010). A geostatistical 
approach for dynamic life tables: The effect of mortality on remaining 
lifetime and annuities. Insurance: Mathematics and Economics, 47(3), 
327-336.
</p>

<hr>
<h2 id='genBinomialSemiparametricBootSamples'>Generate Binomial semiparametric bootstrap samples</h2><span id='topic+genBinomialSemiparametricBootSamples'></span>

<h3>Description</h3>

<p>Generate Binomial semiparametric bootstrap samples using a suitable 
adaptation of the Poisson procedure described in Brouhns et al (2005).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>genBinomialSemiparametricBootSamples(D, E, nBoot)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="genBinomialSemiparametricBootSamples_+3A_d">D</code></td>
<td>
<p>matrix of deaths</p>
</td></tr>
<tr><td><code id="genBinomialSemiparametricBootSamples_+3A_e">E</code></td>
<td>
<p>matrix of exposures</p>
</td></tr>
<tr><td><code id="genBinomialSemiparametricBootSamples_+3A_nboot">nBoot</code></td>
<td>
<p>number of bootstrap samples to produce.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of length <code>nBoot</code> of matrices with sampled deaths
</p>


<h3>References</h3>

<p>Brouhns, N., Denuit M., &amp; Van Keilegom, I. (2005). Bootstrapping the 
Poisson log-bilinear model for mortality forecasting. 
Scandinavian Actuarial Journal, 2005(3), 212-224.
</p>

<hr>
<h2 id='genPoissonResBootSamples'>Generate Poisson residual bootstrap sample</h2><span id='topic+genPoissonResBootSamples'></span>

<h3>Description</h3>

<p>Generate Poisson bootstrap samples using the procedure
described in Renshaw and Haberman (2008)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>genPoissonResBootSamples(devRes, dhat, nBoot)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="genPoissonResBootSamples_+3A_devres">devRes</code></td>
<td>
<p>Matrix of deviance residuals</p>
</td></tr>
<tr><td><code id="genPoissonResBootSamples_+3A_dhat">dhat</code></td>
<td>
<p>Matrix of fitted deaths</p>
</td></tr>
<tr><td><code id="genPoissonResBootSamples_+3A_nboot">nBoot</code></td>
<td>
<p>number of bootstrap samples to produce.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of length <code>nBoot</code> of matrices with matching sampled 
deaths
</p>


<h3>References</h3>

<p>Renshaw, A. E., &amp; Haberman, S. (2008). On simulation-based approaches to 
risk measurement in mortality with specific reference to Poisson Lee-Carter 
modelling. Insurance: Mathematics and Economics, 42(2), 797-816.
</p>

<hr>
<h2 id='genPoissonSemiparametricBootSamples'>Generate Poisson semiparametric bootstrap samples</h2><span id='topic+genPoissonSemiparametricBootSamples'></span>

<h3>Description</h3>

<p>Generate Poisson semiparametric bootstrap samples using the procedure
described in Brouhns et al (2005).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>genPoissonSemiparametricBootSamples(D, nBoot)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="genPoissonSemiparametricBootSamples_+3A_d">D</code></td>
<td>
<p>matrix of deaths</p>
</td></tr>
<tr><td><code id="genPoissonSemiparametricBootSamples_+3A_nboot">nBoot</code></td>
<td>
<p>number of bootstrap samples to produce.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of length <code>nBoot</code> of matrices with sampled deaths
</p>


<h3>References</h3>

<p>Brouhns, N., Denuit M., &amp; Van Keilegom, I. (2005). Bootstrapping the 
Poisson log-bilinear model for mortality forecasting. 
Scandinavian Actuarial Journal, 2005(3), 212-224.
</p>

<hr>
<h2 id='genWeightMat'>Generate weight matrix</h2><span id='topic+genWeightMat'></span>

<h3>Description</h3>

<p>Generates a weight matrix given a group of ages and years
and a set of cohorts which are to be given zero weight. This
is useful for excluding some data points when fitting a 
Stochastic Mortality Model (see <code><a href="#topic+fit.StMoMo">fit.StMoMo</a></code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>genWeightMat(ages, years, clip = 0, zeroCohorts = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="genWeightMat_+3A_ages">ages</code></td>
<td>
<p>vector of ages.</p>
</td></tr>
<tr><td><code id="genWeightMat_+3A_years">years</code></td>
<td>
<p>vector of years.</p>
</td></tr>
<tr><td><code id="genWeightMat_+3A_clip">clip</code></td>
<td>
<p>number of cohorts in the boundary to assign a zero 
weight. This can be be used to zero weigh some of the first and 
last cohorts in the data.</p>
</td></tr>
<tr><td><code id="genWeightMat_+3A_zerocohorts">zeroCohorts</code></td>
<td>
<p>other cohort for which a zero weight is to be assigned.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A 0-1 matrix with 0 for the zero-weighed cohorts.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fit.StMoMo">fit.StMoMo</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Zero-weight the first three and last three cohorts
wxt1 &lt;- genWeightMat(55:89,  EWMaleData$years, clip = 3)
APCfit1 &lt;- fit(apc(), data = EWMaleData, ages.fit = 55:89, 
               wxt = wxt1)
plot(APCfit1, parametricbx = FALSE, nCol = 3)

#Also Zero-weight the 1886 cohort
wxt2 &lt;- genWeightMat(55:89,  EWMaleData$years, clip = 3, 
                     zeroCohorts = 1886)
APCfit2 &lt;- fit(apc(), data = EWMaleData, ages.fit = 55:89, 
               wxt = wxt2)
plot(APCfit2, parametricbx = FALSE, nCol = 3)

</code></pre>

<hr>
<h2 id='getMinimalFitStMoMo'>Extract a lighter version of a fitted Stochastic Mortality Model</h2><span id='topic+getMinimalFitStMoMo'></span>

<h3>Description</h3>

<p>Obtain a lighter version of a fitted Stochastic Mortality Model
with the essential information for plotting, forecasting, 
and simulation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getMinimalFitStMoMo(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getMinimalFitStMoMo_+3A_object">object</code></td>
<td>
<p>an object of class <code>"fitStMoMo"</code> with the fitted 
parameters of a stochastic mortality model.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with class <code>"fitStMoMo"</code> with components
</p>
<table>
<tr><td><code>model</code></td>
<td>
<p> The <code>StMoMo</code> defining the fitted stochastic 
mortality model.</p>
</td></tr>
<tr><td><code>ax</code></td>
<td>
<p> Vector with the fitted values of the static age function
<code class="reqn">\alpha_x</code>. If the model does not have a static age function or 
failed to fit this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>bx</code></td>
<td>
<p> Matrix with the values of the period age-modulating functions
<code class="reqn">\beta_x^{(i)}, i=1, ..., N</code>. If the <code class="reqn">i</code>-th age-modulating 
function is non-parametric (e.g. as in the Lee-Carter model) 
<code>bx[, i]</code> contains the estimated values. If the model does not have
any age-period terms (i.e. <code class="reqn">N=0</code>) or failed to fit this is set to
<code>NULL</code>.</p>
</td></tr>
<tr><td><code>kt</code></td>
<td>
<p> Matrix with the values of the fitted period indexes
<code class="reqn">\kappa_t^{(i)}, i=1, ..., N</code>. <code>kt[i, ]</code> contains the estimated
values of the <code class="reqn">i</code>-th period index. If the model does not have any 
age-period terms (i.e. <code class="reqn">N=0</code>) or failed to fit this is set to 
<code>NULL</code>.</p>
</td></tr>
<tr><td><code>b0x</code></td>
<td>
<p> Vector with the values of the cohort age-modulating function
<code class="reqn">\beta_x^{(0)}</code>. If the age-modulating function is non-parametric 
<code>b0x</code> contains the estimated values. If the model does not have a 
cohort effect or failed to fit this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>gc</code></td>
<td>
<p> Vector with the fitted cohort index <code class="reqn">\gamma_{c}</code>. If the
model does not have a cohort effect or failed to fit this is set to 
<code>NULL</code>.</p>
</td></tr>
<tr><td><code>Dxt</code></td>
<td>
<p> Matrix of deaths used in the fitting.</p>
</td></tr>
<tr><td><code>Ext</code></td>
<td>
<p> Matrix of exposures used in the fitting.</p>
</td></tr>
<tr><td><code>oxt</code></td>
<td>
<p> Matrix of known offset values used in the fitting.</p>
</td></tr>
<tr><td><code>wxt</code></td>
<td>
<p> Matrix of 0-1 weights used in the fitting.</p>
</td></tr>
<tr><td><code>ages</code></td>
<td>
<p> Vector of ages in the data.</p>
</td></tr>
<tr><td><code>years</code></td>
<td>
<p> Vector of years in the data.</p>
</td></tr>
<tr><td><code>cohorts</code></td>
<td>
<p> Vector of cohorts in the data.</p>
</td></tr>
</table>

<hr>
<h2 id='iarima'>Fit independent arima series to a multivariate time series</h2><span id='topic+iarima'></span>

<h3>Description</h3>

<p>Fits independent arima series to <code>x</code>, a multivariate 
time series.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>iarima(x, order = NULL, include.constant = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="iarima_+3A_x">x</code></td>
<td>
<p>numeric matrix with a multivariate time series.
Series are arranged in rows with columns representing time.</p>
</td></tr>
<tr><td><code id="iarima_+3A_order">order</code></td>
<td>
<p>an optional matrix with one row per time series
specifying the ARIMA models: for the ith row the three 
components <code class="reqn">(p, d, q)</code> are the AR order, the degree of 
differencing, and the MA order. If absent the arima models 
are fitted using <code><a href="forecast.html#topic+auto.arima">auto.arima</a></code>.</p>
</td></tr>
<tr><td><code id="iarima_+3A_include.constant">include.constant</code></td>
<td>
<p>an optional vector of logical values 
indicating if the ARIMA model for the ith series should include a 
constant value. The default is <code>TRUE</code>. This parameter is ignored
if <code>order</code> is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="iarima_+3A_...">...</code></td>
<td>
<p>additional parameters for <code><a href="forecast.html#topic+auto.arima">auto.arima</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The fitting of the ARIMA models for each time series is done with 
function <code><a href="forecast.html#topic+Arima">Arima</a></code> from package 
<span class="pkg">forecast</span>. See the latter function for further details on 
input arguments <code>kt.order</code> and <code>kt.include.constant</code>.
</p>


<h3>Value</h3>

<p>an object of class <code>"iarima"</code> with components:
</p>
<table>
<tr><td><code>models</code></td>
<td>
<p>a list with the arima models fitted to each time 
series.</p>
</td></tr>
<tr><td><code>x</code></td>
<td>
<p>the original time series.</p>
</td></tr>
</table>

<hr>
<h2 id='initial2central'>Transform StMoMoData from initial to central exposures</h2><span id='topic+initial2central'></span>

<h3>Description</h3>

<p>Transform StMoMoData from initial to central exposures. Central exposures
are computed by substracting one half of the deaths from the initial exposures.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>initial2central(data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="initial2central_+3A_data">data</code></td>
<td>
<p>StMoMoData object of type &quot;initial&quot; created with function 
<code><a href="#topic+StMoMoData">StMoMoData</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A StMoMoData object of type &quot;central&quot;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+central2initial">central2initial</a></code>
</p>

<hr>
<h2 id='invlogit'>Inverse Logit function
<code>invlogit</code> computes the inverse logit function</h2><span id='topic+invlogit'></span>

<h3>Description</h3>

<p>Inverse Logit function
<code>invlogit</code> computes the inverse logit function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>invlogit(x)
</code></pre>

<hr>
<h2 id='lc'>Create a Lee-Carter model</h2><span id='topic+lc'></span>

<h3>Description</h3>

<p>Utility function to initialise a <code>StMoMo</code> object representing a 
Lee-Carter model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lc(link = c("log", "logit"), const = c("sum", "last", "first"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lc_+3A_link">link</code></td>
<td>
<p>defines the link function and random component associated with 
the mortality model. <code>"log"</code> would assume that deaths follow a 
Poisson distribution and use a log link while <code>"logit"</code> would assume 
that deaths follow a Binomial distribution and a logit link.</p>
</td></tr>
<tr><td><code id="lc_+3A_const">const</code></td>
<td>
<p>defines the constraint to impose to the period index of the
model to ensure identifiability. The alternatives are 
<code>"sum"</code>(default),  <code>"last"</code> and <code>"first"</code> which apply 
constraints <code class="reqn">\sum_t\kappa_t = 0</code>, <code class="reqn">\kappa_n = 0</code> and 
<code class="reqn">\kappa_1 = 0</code>, respectively.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The created model is either a log-Poisson (see Brouhns et al (2002)) or a 
logit-Binomial version of the Lee-Carter model which has predictor structure   
</p>
<p style="text-align: center;"><code class="reqn">\eta_{xt} = \alpha_x + \beta_x\kappa_t.</code>
</p>

<p>To ensure identifiability one of the  following constraints is imposed
</p>
<p style="text-align: center;"><code class="reqn">\sum_t\kappa_t = 0,\,\kappa_1 = 0,\, \kappa_n = 0</code>
</p>

<p>depending on the value of <code>const</code>, and
</p>
<p style="text-align: center;"><code class="reqn">\sum_x\beta_x = 1.</code>
</p>



<h3>Value</h3>

<p>An object of class <code>"StMoMo"</code>.
</p>


<h3>References</h3>

<p>Brouhns, N., Denuit, M., &amp; Vermunt, J. K. (2002). A Poisson log-bilinear 
regression approach to the construction of projected lifetables.
Insurance: Mathematics and Economics, 31(3), 373-393.
</p>
<p>Lee, R. D., &amp; Carter, L. R. (1992). Modeling and forecasting U.S. mortality. 
Journal of the American Statistical Association, 87(419), 659-671.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+StMoMo">StMoMo</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#sum(kt) = 0 and log link
LC1 &lt;- lc()
LCfit1&lt;-fit(LC1, data = EWMaleData, ages.fit = 55:89)
plot(LCfit1)

#kt[1] = 0 and log link
LC2 &lt;- lc(const = "first")
LCfit2&lt;-fit(LC2, data = EWMaleData, ages.fit = 55:89)
plot(LCfit2)

#kt[n] = 0 and logit link
LC3 &lt;- lc("logit", "last")
LCfit3&lt;-fit(LC3, data = EWMaleData, ages.fit = 55:89)
plot(LCfit3)

</code></pre>

<hr>
<h2 id='logit'>Logit function
<code>logit</code> computes the logit function</h2><span id='topic+logit'></span>

<h3>Description</h3>

<p>Logit function
<code>logit</code> computes the logit function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>logit(x)
</code></pre>

<hr>
<h2 id='logLik.fitStMoMo'>Log-Likelihood of a fitStMoMo object</h2><span id='topic+logLik.fitStMoMo'></span>

<h3>Description</h3>

<p>Returns the log-likelihood of a fitted Stochastic Mortality Model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'fitStMoMo'
logLik(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="logLik.fitStMoMo_+3A_object">object</code></td>
<td>
<p>an object of class <code>fitStMoMo</code> representing a 
Stochastic Mortality Model fitted to some data.</p>
</td></tr>
<tr><td><code id="logLik.fitStMoMo_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The log-likelihood of the fitted model.
</p>

<hr>
<h2 id='m6'>Create an M6 type extension of the Cairns-Blake-Dowd mortality model</h2><span id='topic+m6'></span>

<h3>Description</h3>

<p>Utility function to initialise a <code>StMoMo</code> object representing the 
M6 (CBD with cohorts) extension of the Cairns-Blake-Dowd mortality model 
introduced in Cairns et al (2009).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>m6(link = c("logit", "log"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="m6_+3A_link">link</code></td>
<td>
<p>defines the link function and random component associated with 
the mortality model. <code>"log"</code> would assume that deaths follow a 
Poisson distribution and use a log link while <code>"logit"</code> would 
assume that deaths follow a Binomial distribution and a logit link. 
Note that the default is the logit link.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The created model is either a logit-Binomial or a log-Poisson version of the 
M6 model which has predictor structure 
</p>
<p style="text-align: center;"><code class="reqn">\eta_{xt} = \kappa_t^{(1)} + (x-\bar{x})\kappa_t^{(2)} + \gamma_{t-x},</code>
</p>
 
<p>where <code class="reqn">\bar{x}</code> is the average age in the data.
</p>
<p>Identifiability of the model is accomplished by applying parameters 
constraints
</p>
<p style="text-align: center;"><code class="reqn">\sum_c\gamma_c = 0, \sum_c c\gamma_c = 0</code>
</p>

<p>which ensure that the cohort effect fluctuates around zero and has no 
linear trend. These constraints are applied using the strategy discussed 
in Appendix A of Haberman and Renshaw (2011).
</p>


<h3>Value</h3>

<p>An object of class <code>"StMoMo"</code>.
</p>


<h3>References</h3>

<p>Cairns, A. J. G., Blake, D., Dowd, K., Coughlan, G. D., Epstein, D., 
Ong, A., &amp; Balevich, I. (2009). A quantitative comparison of stochastic 
mortality models using data from England and Wales and the United States. 
North American Actuarial Journal, 13(1), 1-35.
</p>
<p>Haberman, S., &amp; Renshaw, A. (2011). A comparative study of parametric 
mortality projection models. Insurance: Mathematics and Economics, 
48(1), 35-55.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+StMoMo">StMoMo</a></code>, <code><a href="#topic+central2initial">central2initial</a></code>, 
<code><a href="#topic+cbd">cbd</a></code>, <code><a href="#topic+m7">m7</a></code>, <code><a href="#topic+m8">m8</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
M6 &lt;- m6()
wxt &lt;- genWeightMat(55:89,  EWMaleData$years, clip = 3)
M6fit &lt;- fit(M6, data = central2initial(EWMaleData), ages.fit = 55:89)
plot(M6fit, parametricbx = FALSE)

</code></pre>

<hr>
<h2 id='m7'>Create an M7 type extension of the Cairns-Blake-Dowd mortality model</h2><span id='topic+m7'></span>

<h3>Description</h3>

<p>Utility function to initialise a <code>StMoMo</code> object representing the 
M7 extension of the Cairns-Blake-Dowd mortality model introduced
in Cairns et al (2009).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>m7(link = c("logit", "log"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="m7_+3A_link">link</code></td>
<td>
<p>defines the link function and random component associated with 
the mortality model. <code>"log"</code> would assume that deaths follow a 
Poisson distribution and use a log link while <code>"logit"</code> would 
assume that deaths follow a Binomial distribution and a logit link. 
Note that the default is the logit link.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The created model is either a logit-Binomial or a log-Poisson version of 
the M7 model which has predictor structure 
</p>
<p style="text-align: center;"><code class="reqn">\eta_{xt} = \kappa_t^{(1)} + (x-\bar{x})\kappa_t^{(2)} + 
                           ((x-\bar{x})^2 - \hat{\sigma}^2_x)\kappa_t^{(2)} +  \gamma_{t-x},</code>
</p>
 
<p>where <code class="reqn">\bar{x}</code> is the average age in the data and <code class="reqn">\hat{\sigma}^2_x</code> 
is the average value of <code class="reqn">(x-\bar{x})^2</code>.
</p>
<p>Identifiability of the model is accomplished by applying parameters 
constraints </p>
<p style="text-align: center;"><code class="reqn">\sum_c\gamma_c = 0, \sum_c c\gamma_c = 0, 
\sum_c c^2\gamma_c = 0</code>
</p>
<p> which ensure that the cohort effect fluctuates 
around zero and has no linear or quadratic trend. These constraints are 
applied using the strategy discussed in Appendix A of 
Haberman and Renshaw (2011).
</p>


<h3>Value</h3>

<p>An object of class <code>"StMoMo"</code>.
</p>


<h3>References</h3>

<p>Cairns, A. J. G., Blake, D., Dowd, K., Coughlan, G. D., Epstein, D.,
Ong, A., &amp; Balevich, I. (2009). A quantitative comparison of stochastic 
mortality models using data from England and Wales and the United States. 
North American Actuarial Journal, 13(1), 1-35.
</p>
<p>Haberman, S., &amp; Renshaw, A. (2011). A comparative study of parametric 
mortality projection models. Insurance: Mathematics and Economics, 
48(1), 35-55.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+StMoMo">StMoMo</a></code>, <code><a href="#topic+central2initial">central2initial</a></code>, 
<code><a href="#topic+cbd">cbd</a></code>, <code><a href="#topic+m6">m6</a></code>, <code><a href="#topic+m8">m8</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
M7 &lt;- m7()
wxt &lt;- genWeightMat(55:89,  EWMaleData$years, clip = 3)
M7fit &lt;- fit(M7, data = central2initial(EWMaleData), ages.fit = 55:89)
plot(M7fit, parametricbx = FALSE)

</code></pre>

<hr>
<h2 id='m8'>Create an M8 type extension of the Cairns-Blake-Dowd mortality model</h2><span id='topic+m8'></span>

<h3>Description</h3>

<p>Utility function to initialise a <code>StMoMo</code> object representing the 
M8 extension of the Cairns-Blake-Dowd mortality model introduced
in Cairns et al (2009).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>m8(link = c("logit", "log"), xc)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="m8_+3A_link">link</code></td>
<td>
<p>defines the link function and random component associated with 
the mortality model. <code>"log"</code> would assume that deaths follow a 
Poisson distribution and use a log link while <code>"logit"</code> would 
assume that deaths follow a Binomial distribution and a logit link. 
Note that the default is the logit link.</p>
</td></tr>
<tr><td><code id="m8_+3A_xc">xc</code></td>
<td>
<p>constant defining the cohort age-modulating parameter.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The created model is either a logit-Binomial or a log-Poisson version of 
the M8 model which has predictor structure 
</p>
<p style="text-align: center;"><code class="reqn">\eta_{xt} = \kappa_t^{(1)} + (x-\bar{x})\kappa_t^{(2)} + (x_c-x)\gamma_{t-x}</code>
</p>

<p>where <code class="reqn">\bar{x}</code> is the average age in the data and <code class="reqn">x_c</code> is a
predefined constant. 
Identifiability of the model is accomplished by applying parameters 
constraint
</p>
<p style="text-align: center;"><code class="reqn">\sum_c\gamma_c = 0.</code>
</p>



<h3>Value</h3>

<p>An object of class <code>"StMoMo"</code>.
</p>


<h3>References</h3>

<p>Cairns, A. J. G., Blake, D., Dowd, K., Coughlan, G. D., Epstein, D., 
Ong, A., &amp; Balevich, I. (2009). A quantitative comparison of stochastic
mortality models using data from England and Wales and the United States. 
North American Actuarial Journal, 13(1), 1-35.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+StMoMo">StMoMo</a></code>, <code><a href="#topic+central2initial">central2initial</a></code>, 
<code><a href="#topic+cbd">cbd</a></code>, <code><a href="#topic+m6">m6</a></code>, <code><a href="#topic+m7">m7</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
M8 &lt;- m8(xc = 89)
wxt &lt;- genWeightMat(55:89,  EWMaleData$years, clip = 3)
M8fit &lt;- fit(M8, data = central2initial(EWMaleData), ages.fit = 55:89)
plot(M8fit, parametricbx = FALSE)

</code></pre>

<hr>
<h2 id='mrwd'>Fit a Multivariate Random Walk with Drift</h2><span id='topic+mrwd'></span>

<h3>Description</h3>

<p>Fits a Multivariate Random Walk with Drift to <code>x</code>, a
multivariate time series.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mrwd(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mrwd_+3A_x">x</code></td>
<td>
<p>numeric matrix with a multivariate time series.
Series are arranged in rows with columns representing time.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For further information on the Multivariate Random Walk with
drift see Appendix B in Haberman and Renshaw (2011).
</p>


<h3>Value</h3>

<p>an object of class <code>"mrwd"</code> with components:
</p>
<table>
<tr><td><code>drift</code></td>
<td>
<p> a vector with the estimated drift.</p>
</td></tr>
<tr><td><code>sigma</code></td>
<td>
<p> a matrix with the estimated variance covariance 
matrix.</p>
</td></tr>
<tr><td><code>fitted</code></td>
<td>
<p> fitted values.</p>
</td></tr>
<tr><td><code>residuals</code></td>
<td>
<p> residuals from the fitted model. That is 
observed minus fitted values.</p>
</td></tr>
<tr><td><code>x</code></td>
<td>
<p>the original time series.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Haberman, S., &amp; Renshaw, A. (2011). A comparative study of parametric 
mortality projection models. Insurance: Mathematics and Economics, 
48(1), 35-55.
</p>

<hr>
<h2 id='plot.bootStMoMo'>Plot bootstrapped parameters of a Stochastic Mortality Model</h2><span id='topic+plot.bootStMoMo'></span>

<h3>Description</h3>

<p>Plot fancharts of bootstrapped parameters of a Stochastic Mortality Model 
stored in an object of class <code>"bootStMoMo"</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bootStMoMo'
plot(x, nCol = 2, parametricbx = TRUE, 
                          colour = rgb(0, 0, 0), 
                          probs = c(2.5, 10, 25, 50, 75, 90, 97.5), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.bootStMoMo_+3A_x">x</code></td>
<td>
<p>an object of class <code>"bootStMoMo"</code> with the bootstrapped 
parameters of a stochastic mortality model.</p>
</td></tr>
<tr><td><code id="plot.bootStMoMo_+3A_ncol">nCol</code></td>
<td>
<p>number of columns to use in the plot.</p>
</td></tr>
<tr><td><code id="plot.bootStMoMo_+3A_parametricbx">parametricbx</code></td>
<td>
<p>if <code>FALSE</code> parametric age-modulating terms, 
which don't need to be estimated, are not plotted.</p>
</td></tr>
<tr><td><code id="plot.bootStMoMo_+3A_colour">colour</code></td>
<td>
<p>colour to use in the fans.</p>
</td></tr>
<tr><td><code id="plot.bootStMoMo_+3A_probs">probs</code></td>
<td>
<p>probabilities related to percentiles to plot in the fan chart.
The  default <code>c(2.5,10,25,50,75,90,97.5)</code> plots the 50%, 80% and 
95% confidence intervals of the parameters.</p>
</td></tr>
<tr><td><code id="plot.bootStMoMo_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+plot.fitStMoMo">plot.fitStMoMo</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Long computing times
## Not run: 
CBDfit &lt;- fit(cbd(), data = central2initial(EWMaleData),
              ages.fit = 55:89)
CBDResBoot &lt;- bootstrap(CBDfit, nBoot = 500)
plot(CBDResBoot)
plot(CBDResBoot, parametricbx = FALSE, probs = seq(2.5, 97.5, 2.5))

## End(Not run)

</code></pre>

<hr>
<h2 id='plot.fitStMoMo'>Plot fitted parameters from a stochastic mortality model</h2><span id='topic+plot.fitStMoMo'></span>

<h3>Description</h3>

<p>Plot fitted parameters of a stochastic mortality model of class 
<code>"fitStMoMo"</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'fitStMoMo'
plot(x, nCol = 2, parametricbx = TRUE, type = "l", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.fitStMoMo_+3A_x">x</code></td>
<td>
<p>an object of class <code>"fitStMoMo"</code> with the fitted 
parameters of a stochastic mortality model.</p>
</td></tr>
<tr><td><code id="plot.fitStMoMo_+3A_ncol">nCol</code></td>
<td>
<p>number of columns to use in the plot.</p>
</td></tr>
<tr><td><code id="plot.fitStMoMo_+3A_parametricbx">parametricbx</code></td>
<td>
<p>if <code>FALSE</code> parametric age-modulating terms, 
which don't need to be estimated, are not plotted.</p>
</td></tr>
<tr><td><code id="plot.fitStMoMo_+3A_type">type</code></td>
<td>
<p>what type of plot should be drawn. See 
<code><a href="graphics.html#topic+plot">plot</a></code>.</p>
</td></tr>
<tr><td><code id="plot.fitStMoMo_+3A_...">...</code></td>
<td>
<p>additional arguments to control graphical appearance.
See <code><a href="graphics.html#topic+plot">plot</a></code>.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
#Fit and plot a Lee-Carter model
LCfit &lt;- fit(lc(), data = EWMaleData, ages.fit = 55:89)
plot(LCfit)
plot(LCfit, type = "p", pch = 19)

#Fit and plot a CBD model
CBDfit &lt;- fit(cbd(), data = central2initial(EWMaleData), ages.fit = 55:89)
plot(CBDfit)
plot(CBDfit, parametricbx = FALSE)
plot(CBDfit, nCol = 1, parametricbx = FALSE, lwd = 2)

</code></pre>

<hr>
<h2 id='plot.forStMoMo'>Plot a forecast from a Stochastic Mortality Model</h2><span id='topic+plot.forStMoMo'></span>

<h3>Description</h3>

<p>Plot a forecasted Stochastic Mortality Model of class <code>"forStMoMo"</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'forStMoMo'
plot(x, nCol = 2, parametricbx = TRUE, only.kt = FALSE,
 only.gc = FALSE,  colour = "grey60", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.forStMoMo_+3A_x">x</code></td>
<td>
<p>an object of class <code>"forStMoMo"</code> with the forecast 
of a stochastic mortality model.</p>
</td></tr>
<tr><td><code id="plot.forStMoMo_+3A_ncol">nCol</code></td>
<td>
<p>number of columns to use in the plot.</p>
</td></tr>
<tr><td><code id="plot.forStMoMo_+3A_parametricbx">parametricbx</code></td>
<td>
<p>if <code>FALSE</code> parametric age-modulating terms, 
which don't need to be estimated, are not plotted.</p>
</td></tr>
<tr><td><code id="plot.forStMoMo_+3A_only.kt">only.kt</code></td>
<td>
<p>If <code>TRUE</code> only the period indexes of the model are 
plotted.</p>
</td></tr>
<tr><td><code id="plot.forStMoMo_+3A_only.gc">only.gc</code></td>
<td>
<p>If <code>TRUE</code> only the cohort index of the model is 
plotted. This argument is ignored if <code>only.kt</code> is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.forStMoMo_+3A_colour">colour</code></td>
<td>
<p>colour to use in the prediction intervals.</p>
</td></tr>
<tr><td><code id="plot.forStMoMo_+3A_...">...</code></td>
<td>
<p>additional arguments to control graphical appearance.
See <code><a href="graphics.html#topic+plot">plot</a></code>.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+plot.fitStMoMo">plot.fitStMoMo</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>wxt &lt;- genWeightMat(55:89,  EWMaleData$years, clip = 3)
APCfit &lt;- fit(apc(), data = EWMaleData, ages.fit = 55:89, wxt = wxt)
APCfor &lt;- forecast(APCfit)
plot(APCfor)
plot(APCfor, parametricbx = FALSE, nCol = 3)
plot(APCfor, only.kt = TRUE)
plot(APCfor, only.gc = TRUE, lwd = 2)
</code></pre>

<hr>
<h2 id='plot.resStMoMo'>Plot the residuals of a Stochastic Mortality Model</h2><span id='topic+plot.resStMoMo'></span>

<h3>Description</h3>

<p>Plots the deviance residuals of a Stochastic Mortality Model which are 
of class <code>"resStMoMo"</code>. Three types of plots
are available: scatter plot of residuals by age, period and cohort,
colour map (heatmap) of the residuals, and a black and white signplot 
of the residuals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'resStMoMo'
plot(x, type = c("scatter", "colourmap", 
                                            "signplot"), 
                                reslim = NULL, plotAge = TRUE, 
                                plotYear = TRUE, plotCohort  = TRUE, 
                                pch = 20, col = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.resStMoMo_+3A_x">x</code></td>
<td>
<p>an object of class <code>resStMoMo</code> with the residuals of a 
Stochastic Mortality Model.</p>
</td></tr>
<tr><td><code id="plot.resStMoMo_+3A_type">type</code></td>
<td>
<p>the type of the plot. The alternatives are 
<code>"scatter"</code>(default), <code>"colourmap"</code>, and <code>"signplot"</code>.</p>
</td></tr>
<tr><td><code id="plot.resStMoMo_+3A_reslim">reslim</code></td>
<td>
<p>optional numeric vector of length 2, giving the range of the 
residuals.</p>
</td></tr>
<tr><td><code id="plot.resStMoMo_+3A_plotage">plotAge</code></td>
<td>
<p>logical value indicating if the age scatter plot should be 
produced. This is only used when <code>type = "scatter"</code>.</p>
</td></tr>
<tr><td><code id="plot.resStMoMo_+3A_plotyear">plotYear</code></td>
<td>
<p>logical value indicating if the calendar year scatter plot 
should be produced. This is only used when <code>type = "scatter"</code>.</p>
</td></tr>
<tr><td><code id="plot.resStMoMo_+3A_plotcohort">plotCohort</code></td>
<td>
<p>logical value indicating if the cohort scatter plot 
should be produced. This is only used when <code>type = "scatter"</code>.</p>
</td></tr>
<tr><td><code id="plot.resStMoMo_+3A_pch">pch</code></td>
<td>
<p>optional symbol to use for the points in a scatterplot. 
This is only used when <code>type = "scatter"</code>. See 
<code><a href="graphics.html#topic+plot">plot</a></code>.</p>
</td></tr>
<tr><td><code id="plot.resStMoMo_+3A_col">col</code></td>
<td>
<p>optional colours to use in plotting. If 
<code>type = "scatter"</code> this is a single colour to use in the points
in the scatter plots, while if <code>type = "colourmap"</code> this should
be a list of colours (see help in <code><a href="fields.html#topic+image.plot">image.plot</a></code> 
for details). This argument is ignored if <code>type = "signplot"</code>.</p>
</td></tr>
<tr><td><code id="plot.resStMoMo_+3A_...">...</code></td>
<td>
<p>other plotting parameters to be passed to the plotting 
functions. This can be used to control the appearance of the plots.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When <code>type = "scatter"</code> scatter plots of the residuals against age, 
calendar year and cohort (year of birth) are produced. 
</p>
<p>When <code>type = "colourmap"</code> a two dimensional colour map of the 
residuals is plotted. This is produced using function 
<code><a href="fields.html#topic+image.plot">image.plot</a></code>. See <code><a href="fields.html#topic+image.plot">image.plot</a></code> 
for further parameters that can be passed to this type of plots.
</p>
<p>When <code>type = "signplot"</code> a two dimensional black and white map of the
residuals is plotted with dark grey representing negative residuals and 
light grey representing positive residuals. This is produced using 
function <code><a href="graphics.html#topic+image.default">image.default</a></code>. 
</p>
<p>@seealso <code><a href="#topic+residuals.fitStMoMo">residuals.fitStMoMo</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>CBDfit &lt;- fit(cbd(), data = central2initial(EWMaleData), ages.fit = 55:89)
CBDres &lt;- residuals(CBDfit)
plot(CBDres)
plot(CBDres, type = "signplot")
plot(CBDres, type = "colourmap")
  
</code></pre>

<hr>
<h2 id='plotParameterFan'>Plot fanchart of the parameters</h2><span id='topic+plotParameterFan'></span>

<h3>Description</h3>

<p>Plot fanchart of the parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotParameterFan(x, y, yBoot, main, xlab, ylab, probs, fan.col, n.fan, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotParameterFan_+3A_x">x</code></td>
<td>
<p>value of x</p>
</td></tr>
<tr><td><code id="plotParameterFan_+3A_y">y</code></td>
<td>
<p>central value of y</p>
</td></tr>
<tr><td><code id="plotParameterFan_+3A_yboot">yBoot</code></td>
<td>
<p>matrix with the simulated values of y</p>
</td></tr>
<tr><td><code id="plotParameterFan_+3A_main">main</code></td>
<td>
<p>title of the plot</p>
</td></tr>
<tr><td><code id="plotParameterFan_+3A_xlab">xlab</code></td>
<td>
<p>label of x axis</p>
</td></tr>
<tr><td><code id="plotParameterFan_+3A_ylab">ylab</code></td>
<td>
<p>label of y axis</p>
</td></tr>
<tr><td><code id="plotParameterFan_+3A_probs">probs</code></td>
<td>
<p>probabilities related to percentiles to plot in the fan chart</p>
</td></tr>
<tr><td><code id="plotParameterFan_+3A_fan.col">fan.col</code></td>
<td>
<p>palette of colours used in the fan chart</p>
</td></tr>
<tr><td><code id="plotParameterFan_+3A_n.fan">n.fan</code></td>
<td>
<p>the number of colour to use in the fan</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In order for the plotting to look appropriately the intervals of 
the data with non missing values need to be found. Otherwise fanplot::fan 
doesn't work.
</p>

<hr>
<h2 id='poissonRes2death'>Map poisson deviance residuals into deaths</h2><span id='topic+poissonRes2death'></span>

<h3>Description</h3>

<p>This function uses the procedure described in Renshaw and Haberman (2008)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poissonRes2death(dhat, res)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="poissonRes2death_+3A_dhat">dhat</code></td>
<td>
<p>fitted number of deaths (scalar)</p>
</td></tr>
<tr><td><code id="poissonRes2death_+3A_res">res</code></td>
<td>
<p>deviance residual (scalar)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>matching observed deaths
</p>


<h3>References</h3>

<p>Renshaw, A. E., &amp; Haberman, S. (2008). On simulation-based approaches to 
risk measurement in mortality with specific reference to Poisson Lee-Carter 
modelling. Insurance: Mathematics and Economics, 42(2), 797-816.
</p>

<hr>
<h2 id='predict.fitStMoMo'>Predict method for Stochastic Mortality Models fits</h2><span id='topic+predict.fitStMoMo'></span>

<h3>Description</h3>

<p>Obtain predictions from a Stochastic Mortality Model
fit.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'fitStMoMo'
predict(object, years, kt = NULL, gc = NULL,
  oxt = NULL, type = c("link", "rates"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.fitStMoMo_+3A_object">object</code></td>
<td>
<p>an object of class <code>"fitStMoMo"</code> with the fitted 
parameters of a stochastic mortality model.</p>
</td></tr>
<tr><td><code id="predict.fitStMoMo_+3A_years">years</code></td>
<td>
<p>vector of years for which a prediction is required.</p>
</td></tr>
<tr><td><code id="predict.fitStMoMo_+3A_kt">kt</code></td>
<td>
<p>matrix of values of the period indexes to use for the prediction. 
If the model has any age-period term this argument needs to be provided and 
the number of rows in <code>kt</code> must be equal to the number of age-period 
terms in the model and the number of columns in <code>kt</code> must correspond 
to the length of <code>years</code>. If the Stochastic Mortality Model doesn't 
have any age-period terms this argument is ignored and needs not be 
provided.</p>
</td></tr>
<tr><td><code id="predict.fitStMoMo_+3A_gc">gc</code></td>
<td>
<p>vector of values of the cohort indexes to use for the prediction. 
If the model has a cohort effect this argument needs to be provided. 
In this case the length of <code>gc</code> must be equal to the number of cohorts 
for which a prediction is being produced, namely, 
<code>length(object$ages) + length(years) - 1</code>. If the Stochastic Mortality 
Model doesn't have a cohort effect  this argument is ignored and needs not 
be provided.</p>
</td></tr>
<tr><td><code id="predict.fitStMoMo_+3A_oxt">oxt</code></td>
<td>
<p>optional matrix/vector or scalar of known offset to be used in 
the prediction.</p>
</td></tr>
<tr><td><code id="predict.fitStMoMo_+3A_type">type</code></td>
<td>
<p>the type of the predicted values that should be returned. The 
alternatives are <code>"link"</code>(default) and <code>"rates"</code>.</p>
</td></tr>
<tr><td><code id="predict.fitStMoMo_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function evaluates 
</p>
<p style="text-align: center;"><code class="reqn">\hat{\eta}_{xt} = o_{xt} + \alpha_x + 
\sum_{i=1}^N \beta_x^{(i)}\kappa_t^{(i)} + \beta_x^{(0)}\gamma_{t-x}</code>
</p>

<p>for a fitted Stochastic Mortality model.
In producing a prediction the static age function, <code class="reqn">\alpha_x</code>, and the
age-modulating parameters, <code class="reqn">\beta_x^{(i)}, i=0, ..., N</code>, are taken from
the fitted model in <code>object</code> while the period indexes, 
<code class="reqn">\kappa_t^{(i)}, i=1,..., N</code>, and cohort index, <code class="reqn">\gamma_{t-x}</code>, 
are taken from the function arguments.
</p>
<p>This function can be useful, for instance, in producing forecasts of 
mortality rates using time series models different to those available 
in <code><a href="#topic+forecast.fitStMoMo">forecast.fitStMoMo</a></code> (See examples below).
</p>


<h3>Value</h3>

<p>A matrix with the predicted values.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+forecast.fitStMoMo">forecast.fitStMoMo</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
##M6 Forecast using VARIMA(1,1) model
library(MTS)

# fit m6
years &lt;- EWMaleData$years
ages.fit &lt;- 55:89
M6 &lt;- m6(link = "log")
M6fit &lt;- fit(M6, data = EWMaleData, ages.fit = ages.fit)

# Forecast kt using VARIMA(1,1) model from MTS
h &lt;- 50
kt.M6 &lt;- t(M6fit$kt) 
kt.M6.diff &lt;- apply(kt.M6, 2, diff)
fit.kt.M6.11 &lt;- VARMA(kt.M6.diff, p = 1, q = 1)
pred.ktdiff.M6.11 &lt;- VARMApred(fit.kt.M6.11, h = h)
pred.kt.M6.11 &lt;- apply(rbind(tail(kt.M6, n = 1),
                             pred.ktdiff.M6.11$pred), 
                       2, cumsum)[-1, ]

# set row names
years.forecast &lt;- seq(tail(years, 1) + 1, length.out = h)
rownames(pred.kt.M6.11) &lt;- years.forecast

# plot kt1
plot(x = c(years, years.forecast),
     y = c(kt.M6[, 1], pred.kt.M6.11[, 1]),
     col = rep(c("black", "red"), times = c(length(years), h)),
     xlab = "time",
     ylab = "k1")

plot(x = c(years, years.forecast),
     y = c(kt.M6[, 2], pred.kt.M6.11[, 2]),
     col = rep(c("black", "red"), times = c(length(years), h)),
     xlab = "time",
     ylab = "k2")

# forecast cohort effect
# the following cohorts are required:
# from 2012 - 89 = 1923
# to 2061 - 55 = 2006
pred.gc.M6 &lt;- forecast(auto.arima(M6fit$gc, max.d = 1), h = h)

# use predict to get rates
pred.qxt.M6.11 &lt;- predict(object = M6fit,
                          years = years.forecast,
                          kt = t(pred.kt.M6.11),
                          gc = c(tail(M6fit$gc, 34), pred.gc.M6$mean),
                          type = "rates")

qxthatM6 &lt;- fitted(M6fit, type = "rates")

# plot mortality profile at age 60, 70 and 80
matplot(1961 : 2061,
        t(cbind(qxthatM6, pred.qxt.M6.11)[c("60", "70", "80"), ]),
        type = "l", col = "black", xlab = "years", ylab = "rates",
        lwd = 1.5)

## End(Not run)
</code></pre>

<hr>
<h2 id='predictLink'>Compute the link for a given mortality models</h2><span id='topic+predictLink'></span>

<h3>Description</h3>

<p>Compute the link for a given mortality models
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predictLink(ax, bx, kt, b0x, gc, oxt, ages, years)
</code></pre>

<hr>
<h2 id='processStartValues'>Process the initial parameter supplied by the user</h2><span id='topic+processStartValues'></span>

<h3>Description</h3>

<p>Convert the initial parameters supplied by the user into parameters 
suitable for use within <code>gnm</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>processStartValues(object, coefNames, ax, bx, kt, b0x, gc, ages, years, cohorts)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="processStartValues_+3A_object">object</code></td>
<td>
<p>an object of class <code>"StMoMo"</code> defining the stochastic
mortality model.</p>
</td></tr>
<tr><td><code id="processStartValues_+3A_coefnames">coefNames</code></td>
<td>
<p>name of the coefficients in the gnm model</p>
</td></tr>
<tr><td><code id="processStartValues_+3A_ax">ax</code></td>
<td>
<p>vector with starting values for <code class="reqn">\alpha[x]</code></p>
</td></tr>
<tr><td><code id="processStartValues_+3A_bx">bx</code></td>
<td>
<p>matrix with starting values for <code class="reqn">\beta[x]</code></p>
</td></tr>
<tr><td><code id="processStartValues_+3A_kt">kt</code></td>
<td>
<p>matrix with starting values for <code class="reqn">\kappa[t]</code></p>
</td></tr>
<tr><td><code id="processStartValues_+3A_b0x">b0x</code></td>
<td>
<p>vector with starting values for <code class="reqn">\beta_x^{(0)}</code></p>
</td></tr>
<tr><td><code id="processStartValues_+3A_gc">gc</code></td>
<td>
<p>vector with starting values for <code class="reqn">\gamma[c]</code></p>
</td></tr>
<tr><td><code id="processStartValues_+3A_ages">ages</code></td>
<td>
<p>ages in the fitting data.</p>
</td></tr>
<tr><td><code id="processStartValues_+3A_years">years</code></td>
<td>
<p>years in the fitting data.</p>
</td></tr>
<tr><td><code id="processStartValues_+3A_cohorts">cohorts</code></td>
<td>
<p>cohorts in the fitting data.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector of initial parameter estimates
</p>

<hr>
<h2 id='residuals.fitStMoMo'>Extract deviance residuals of a Stochastic Mortality Model</h2><span id='topic+residuals.fitStMoMo'></span>

<h3>Description</h3>

<p>Compute deviance residuals of a fitted Stochastic Mortality Model. 
These residuals can be plotted using <code><a href="#topic+plot.resStMoMo">plot.resStMoMo</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'fitStMoMo'
residuals(object, scale = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="residuals.fitStMoMo_+3A_object">object</code></td>
<td>
<p>an object of class <code>"fitStMoMo"</code> with the fitted 
parameters of a stochastic mortality model.</p>
</td></tr>
<tr><td><code id="residuals.fitStMoMo_+3A_scale">scale</code></td>
<td>
<p>logical indicating whether the residuals should be scaled 
or not by dividing the deviance by the  overdispersion of the model.  
Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="residuals.fitStMoMo_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>"resStMoMo"</code> with the residuals. This 
object has components:
</p>
<table>
<tr><td><code>residuals</code></td>
<td>
<p> a matrix with the residuals.</p>
</td></tr>
<tr><td><code>ages</code></td>
<td>
<p> ages corresponding to the rows in <code>residuals</code>.</p>
</td></tr>
<tr><td><code>years</code></td>
<td>
<p> years corresponding to the columns in <code>residuals</code>.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+plot.resStMoMo">plot.resStMoMo</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>CBDfit &lt;- fit(cbd(), data = central2initial(EWMaleData), ages.fit = 55:89)
CBDres &lt;- residuals(CBDfit)
plot(CBDres)
</code></pre>

<hr>
<h2 id='rh'>Create a Renshaw and Haberman (Lee-Carter with cohorts) mortality model</h2><span id='topic+rh'></span>

<h3>Description</h3>

<p>Utility function to initialise a <code>StMoMo</code> object representing a 
Renshaw and Haberman (Lee-Carter with cohorts) mortality model introduced
in Renshaw and Haberman (2006).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rh(link = c("log", "logit"), cohortAgeFun = c("1", "NP"),
  approxConst = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rh_+3A_link">link</code></td>
<td>
<p>defines the link function and random component associated with 
the mortality model. <code>"log"</code> would assume that deaths follow a 
Poisson distribution and use a log link while <code>"logit"</code> would assume 
that deaths follow a Binomial distribution and a logit link.</p>
</td></tr>
<tr><td><code id="rh_+3A_cohortagefun">cohortAgeFun</code></td>
<td>
<p>defines the cohort age modulating parameter 
<code class="reqn">\beta_x^{(0)}</code>. It can take values: <code>"NP"</code> for a non-parametric age
term or <code>"1"</code> for <code class="reqn">\beta_x^{(0)}=1</code> (the default).</p>
</td></tr>
<tr><td><code id="rh_+3A_approxconst">approxConst</code></td>
<td>
<p>defines if the approximate identifiability constraint of 
Hunt and Villegas (2015) is applied or not. If <code>TRUE</code>, the output object 
is of class <code>rh</code> and subsequent model fitting is performed with 
<code><a href="#topic+fit.rh">fit.rh</a></code>. If <code>FALSE</code>, the output object is of class 
<code>StMoMo</code> and subsequent model fitting is performed with 
<code><a href="#topic+fit.StMoMo">fit.StMoMo</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The created model is either a log-Poisson or a  logit-Binomial version 
of the Renshaw and Haberman model which has predictor structure   
</p>
<p style="text-align: center;"><code class="reqn">\eta_{xt} = \alpha_x + \beta^{(1)}_x\kappa_t + \beta^{(0)} \gamma_{t-x}.</code>
</p>

<p>or
</p>
<p style="text-align: center;"><code class="reqn">\eta_{xt} = \alpha_x + \beta^{(1)}_x\kappa_t + \gamma_{t-x}.</code>
</p>

<p>depending on the value of argument <code>cohortAgeFun</code>.
</p>
<p>To ensure identifiability the following constraints are imposed
</p>
<p style="text-align: center;"><code class="reqn">\sum_t\kappa_t = 0, \sum_x\beta^{(1)}_x = 1, \sum_c\gamma_c = 0</code>
</p>

<p>plus
</p>
<p style="text-align: center;"><code class="reqn">\sum_x\beta^{(0)}_x = 1</code>
</p>

<p>if <code>cohortAgeFun = "NP"</code>
</p>
<p>In addition, if <code>approxConst=TRUE</code> then the approximate 
identifiability constraint
</p>
<p style="text-align: center;"><code class="reqn">\sum_c (c-\bar{c})\gamma_c = 0</code>
</p>

<p>is applied to improve the stability and robustness of the model 
(see Hunt and Villegas (2015)).
</p>
<p>By default <code class="reqn">\beta^{(0)}_x = 1</code> as this model has shown to be more
stable (see Haberman and Renshaw (2011) and Hunt and Villegas (2015)).
</p>


<h3>Value</h3>

<p>An object of class <code>"StMoMo"</code> or <code>"rh"</code>.
</p>


<h3>References</h3>

<p>Haberman, S., &amp; Renshaw, A. (2011). A comparative study of parametric 
mortality projection models. Insurance: Mathematics and Economics, 
48(1), 35-55. 
</p>
<p>Hunt, A., &amp; Villegas, A. M. (2015). Robustness and convergence in the 
Lee-Carter model with cohorts. Insurance: Mathematics and Economics, 
64, 186-202. 
</p>
<p>Renshaw, A. E., &amp; Haberman, S. (2006). A cohort-based extension to the 
Lee-Carter model for mortality reduction factors. 
Insurance: Mathematics and Economics, 38(3), 556-570.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fit.rh">fit.rh</a></code>, <code><a href="#topic+StMoMo">StMoMo</a></code>, <a href="#topic+lc">lc</a>, <a href="#topic+apc">apc</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
LCfit &lt;-  fit(lc(), data = EWMaleData, ages.fit = 55:89)
wxt &lt;- genWeightMat(55:89,  EWMaleData$years, clip = 3)
RHfit &lt;- fit(rh(), data = EWMaleData, ages.fit = 55:89, wxt = wxt, 
             start.ax = LCfit$ax, start.bx = LCfit$bx, start.kt = LCfit$kt)
plot(RHfit)

#Impose approximate constraint as in Hunt and Villegas (2015)    
## Not run: 
RHapprox &lt;- rh(approxConst = TRUE)
RHapproxfit &lt;- fit(RHapprox, data = EWMaleData, ages.fit = 55:89, 
                    wxt = wxt)
plot(RHapproxfit) 

## End(Not run)


</code></pre>

<hr>
<h2 id='scatterplotAPC'>Do a scatter plot of a matrix according to age-period-cohorts</h2><span id='topic+scatterplotAPC'></span>

<h3>Description</h3>

<p>Do a scatter plot of a matrix according to age-period-cohorts
</p>


<h3>Usage</h3>

<pre><code class='language-R'>scatterplotAPC(mat, ages, years, plotAge = TRUE, plotYear = TRUE,
  plotCohort = TRUE, zeroLine = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="scatterplotAPC_+3A_mat">mat</code></td>
<td>
<p>matrix with the data to plot.</p>
</td></tr>
<tr><td><code id="scatterplotAPC_+3A_ages">ages</code></td>
<td>
<p>ages corresponding to the rows in <code>mat</code>.</p>
</td></tr>
<tr><td><code id="scatterplotAPC_+3A_years">years</code></td>
<td>
<p>years corresponding to the columns in <code>mat</code>.</p>
</td></tr>
<tr><td><code id="scatterplotAPC_+3A_plotage">plotAge</code></td>
<td>
<p>logical value indicating if the age scatter plot should be 
produced.</p>
</td></tr>
<tr><td><code id="scatterplotAPC_+3A_plotyear">plotYear</code></td>
<td>
<p>logical value indicating if the calendar year scatter plot 
should be produced.</p>
</td></tr>
<tr><td><code id="scatterplotAPC_+3A_plotcohort">plotCohort</code></td>
<td>
<p>logical value indicating if the cohort scatter plot 
should be produced.</p>
</td></tr>
<tr><td><code id="scatterplotAPC_+3A_zeroline">zeroLine</code></td>
<td>
<p>logical value indicating if a horizontal line at zero
should be plotted.</p>
</td></tr>
<tr><td><code id="scatterplotAPC_+3A_...">...</code></td>
<td>
<p>other arguments to pass to the plot function.</p>
</td></tr>
</table>

<hr>
<h2 id='simulate.bootStMoMo'>Simulate future sample paths from a Bootstrapped Stochastic 
Mortality Model</h2><span id='topic+simulate.bootStMoMo'></span>

<h3>Description</h3>

<p>Simulate future sample paths from a Bootstrapped Stochastic Mortality Model.
The period indexes <code class="reqn">\kappa_t^{(i)}, i = 1,..N,</code> are modelled
using ether a Multivariate Random Walk with Drift (MRWD) or 
<code class="reqn">N</code> independent ARIMA<code class="reqn">(p, d, q)</code> models. The cohort index 
<code class="reqn">\gamma_{t-x}</code> is modelled using an ARIMA<code class="reqn">(p, d, q)</code>. 
By default an ARIMA<code class="reqn">(1, 1, 0)</code> with a constant is used.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bootStMoMo'
simulate(object, nsim = 1, seed = NULL, h = 50,
  oxt = NULL, gc.order = c(1, 1, 0), gc.include.constant = TRUE,
  jumpchoice = c("fit", "actual"), kt.method = c("mrwd", "iarima"),
  kt.order = NULL, kt.include.constant = TRUE, kt.lookback = NULL,
  gc.lookback = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simulate.bootStMoMo_+3A_object">object</code></td>
<td>
<p>an object of class <code>"bootStMoMo"</code> with the bootstrapped 
parameters of a stochastic mortality model.</p>
</td></tr>
<tr><td><code id="simulate.bootStMoMo_+3A_nsim">nsim</code></td>
<td>
<p>number of sample paths to simulate from each bootstrapped 
sample. Thus if there are <code>nBoot</code> bootstrapped samples the total 
number of paths will be <code>nsim * nBoot</code>.</p>
</td></tr>
<tr><td><code id="simulate.bootStMoMo_+3A_seed">seed</code></td>
<td>
<p>either <code>NULL</code> or an integer that will be used in a 
call to <code><a href="base.html#topic+set.seed">set.seed</a></code> before simulating the time series. 
The default, <code>NULL</code> will not change the random generator state.</p>
</td></tr>
<tr><td><code id="simulate.bootStMoMo_+3A_h">h</code></td>
<td>
<p>number of years ahead to forecast.</p>
</td></tr>
<tr><td><code id="simulate.bootStMoMo_+3A_oxt">oxt</code></td>
<td>
<p>optional array/matrix/vector or scalar of known offset to be 
added in the simulations. This can be used to specify any a priori known 
component to be added to the simulated predictor.</p>
</td></tr>
<tr><td><code id="simulate.bootStMoMo_+3A_gc.order">gc.order</code></td>
<td>
<p>a specification of the ARIMA model for the cohort effect: 
the three components <code class="reqn">(p, d, q)</code> are the AR order, the degree of 
differencing, and the MA. The default is an ARIMA<code class="reqn">(1, 1, 0)</code>.</p>
</td></tr>
<tr><td><code id="simulate.bootStMoMo_+3A_gc.include.constant">gc.include.constant</code></td>
<td>
<p>a logical value indicating if the ARIMA model
should include a constant value. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="simulate.bootStMoMo_+3A_jumpchoice">jumpchoice</code></td>
<td>
<p>option to select the jump-off rates, i.e. the rates 
from the final year of observation, to use in projections of mortality 
rates. <code>"fit"</code>(default) uses the fitted rates and <code>"actual"</code> 
uses the actual rates from the final year.</p>
</td></tr>
<tr><td><code id="simulate.bootStMoMo_+3A_kt.method">kt.method</code></td>
<td>
<p>optional forecasting method for the period index. 
The alternatives are <code>"mrwd"</code>(default) and <code>"iarima"</code>. See details.</p>
</td></tr>
<tr><td><code id="simulate.bootStMoMo_+3A_kt.order">kt.order</code></td>
<td>
<p>an optional matrix with one row per period index
specifying the ARIMA models: for the ith row (ith period index) the three 
components <code class="reqn">(p, d, q)</code> are the AR order, the degree of  differencing, 
and the MA order. If absent the arima models are fitted using 
<code><a href="forecast.html#topic+auto.arima">auto.arima</a></code>. This argument is only used when
<code>kt.method</code> is <code>"iarima"</code>.</p>
</td></tr>
<tr><td><code id="simulate.bootStMoMo_+3A_kt.include.constant">kt.include.constant</code></td>
<td>
<p>an optional vector of logical values 
indicating if the ARIMA model for the ith period index should include a 
constant value. The default is <code>TRUE</code>.  This argument is only used 
when <code>kt.method</code> is <code>"iarima"</code>.</p>
</td></tr>
<tr><td><code id="simulate.bootStMoMo_+3A_kt.lookback">kt.lookback</code></td>
<td>
<p>optional argument to specify the look-back window to use
in the estimation of the time series model for the period indexes. By 
default all the estimated values are used. If 
<code>kt.lookback</code> is provided then the last <code>kt.lookback</code> 
years of <code class="reqn">\kappa_t^{(i)}, i = 1,..N,</code> are used.</p>
</td></tr>
<tr><td><code id="simulate.bootStMoMo_+3A_gc.lookback">gc.lookback</code></td>
<td>
<p>optional argument to specify the look-back window to use
in the estimation of the ARIMA model for the cohort effect. By 
default all the estimated values are used in estimating the ARIMA 
model. If <code>gc.lookback</code> is provided then the last 
<code>gc.lookback</code> years of <code class="reqn">\gamma_{t-x}</code> are used.</p>
</td></tr>
<tr><td><code id="simulate.bootStMoMo_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details see <code><a href="#topic+simulate.fitStMoMo">simulate.fitStMoMo</a></code>.
</p>


<h3>Value</h3>

<p>A list of class <code>"simStMoMo"</code> with components
</p>
<table>
<tr><td><code>rates</code></td>
<td>
<p> a three dimensional array with the future simulated rates.</p>
</td></tr>
<tr><td><code>ages</code></td>
<td>
<p> vector of ages corresponding to the first dimension of 
<code>rates</code>.</p>
</td></tr>
<tr><td><code>years</code></td>
<td>
<p> vector of years for which a simulations has been produced. 
This corresponds to the second dimension of <code>rates</code>.</p>
</td></tr>  
<tr><td><code>kt.s</code></td>
<td>
<p> information on the simulated paths of the period indices of 
the model. This is a list with the simulated paths of <code class="reqn">\kappa_t</code>
(<code>sim</code>) and the <code>years</code> for which simulations were produced. 
If the mortality model does not have any age-period terms (i.e. <code class="reqn">N=0</code>)
this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>gc.s</code></td>
<td>
<p> information on the simulated paths of the cohort index of the
model. This is a list with the simulated paths of <code class="reqn">\gamma_c</code> 
(<code>sim</code>) and the <code>cohorts</code> for which simulations were produced. 
If the mortality model does not have a cohort effect this is set to 
<code>NULL</code>.</p>
</td></tr> 
<tr><td><code>oxt.s</code></td>
<td>
<p> a three dimensional array with the offset used in the 
simulations.</p>
</td></tr>
<tr><td><code>fitted</code></td>
<td>
<p> a three dimensional array with the in-sample rates of the 
model for the years for which the mortality model was fitted 
(and bootstrapped).</p>
</td></tr>
<tr><td><code>jumpchoice</code></td>
<td>
<p>Jump-off method used in the simulation.</p>
</td></tr>
<tr><td><code>kt.method</code></td>
<td>
<p>method used in the modelling of the period index.</p>
</td></tr>
<tr><td><code>model</code></td>
<td>
<p>the bootstrapped model from which the simulations were 
produced.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+bootstrap.fitStMoMo">bootstrap.fitStMoMo</a></code>, <code><a href="#topic+simulate.fitStMoMo">simulate.fitStMoMo</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Long computing times
## Not run: 
#Lee-Carter: Compare projection with and without parameter uncertainty
library(fanplot)
LCfit &lt;- fit(lc(), data = EWMaleData)
LCResBoot &lt;- bootstrap(LCfit, nBoot = 500)
LCResBootsim &lt;- simulate(LCResBoot)
LCsim &lt;- simulate(LCfit, nsim = 500) 
plot(LCfit$years, log(LCfit$Dxt / LCfit$Ext)["10", ], 
     xlim = range(LCfit$years, LCsim$years),
     ylim = range(log(LCfit$Dxt / LCfit$Ext)["10", ], 
                  log(LCsim$rates["10", , ])),
     type = "l", xlab = "year", ylab = "log rate", 
     main = "Mortality rate projection at age 10 with and without parameter uncertainty") 
fan(t(log(LCResBootsim$rates["10", , ])),start = LCResBootsim$years[1], 
    probs = c(2.5, 10, 25, 50, 75, 90, 97.5), n.fan = 4, 
    fan.col = colorRampPalette(c(rgb(0, 0, 1), rgb(1, 1, 1))), ln = NULL)
fan(t(log(LCsim$rates["10", 1:(length(LCsim$years) - 3), ])),
    start = LCsim$years[1], probs = c(2.5, 10, 25, 50, 75, 90, 97.5),
    n.fan = 4, fan.col = colorRampPalette(c(rgb(1, 0, 0), rgb(1, 1, 1))), 
    ln = NULL)

## End(Not run)

</code></pre>

<hr>
<h2 id='simulate.fitStMoMo'>Simulate future sample paths from a Stochastic Mortality Model</h2><span id='topic+simulate.fitStMoMo'></span>

<h3>Description</h3>

<p>Simulate future sample paths from a Stochastic Mortality Model.
The period indexes <code class="reqn">\kappa_t^{(i)}, i = 1,..N,</code> are modelled
using ether a Multivariate Random Walk with Drift (MRWD) or 
<code class="reqn">N</code> independent ARIMA<code class="reqn">(p, d, q)</code> models. The cohort index 
<code class="reqn">\gamma_{t-x}</code> is modelled using an ARIMA<code class="reqn">(p, d, q)</code>. 
By default an ARIMA<code class="reqn">(1, 1, 0)</code> with a constant is used.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'fitStMoMo'
simulate(object, nsim = 1000, seed = NULL, h = 50,
  oxt = NULL, gc.order = c(1, 1, 0), gc.include.constant = TRUE,
  jumpchoice = c("fit", "actual"), kt.method = c("mrwd", "iarima"),
  kt.order = NULL, kt.include.constant = TRUE, kt.lookback = NULL,
  gc.lookback = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simulate.fitStMoMo_+3A_object">object</code></td>
<td>
<p>an object of class <code>"fitStMoMo"</code> with the fitted 
parameters of a stochastic mortality model.</p>
</td></tr>
<tr><td><code id="simulate.fitStMoMo_+3A_nsim">nsim</code></td>
<td>
<p>number of sample paths to simulate.</p>
</td></tr>
<tr><td><code id="simulate.fitStMoMo_+3A_seed">seed</code></td>
<td>
<p>either <code>NULL</code> or an integer that will be used in a 
call to <code><a href="base.html#topic+set.seed">set.seed</a></code> before simulating the time series. 
The default, <code>NULL</code> will not change the random generator state.</p>
</td></tr>
<tr><td><code id="simulate.fitStMoMo_+3A_h">h</code></td>
<td>
<p>number of years ahead to forecast.</p>
</td></tr>
<tr><td><code id="simulate.fitStMoMo_+3A_oxt">oxt</code></td>
<td>
<p>optional matrix/vector or scalar of known offset to be 
added in the simulations. This can be used to specify any a priori 
known component to be added to the simulated predictor.</p>
</td></tr>
<tr><td><code id="simulate.fitStMoMo_+3A_gc.order">gc.order</code></td>
<td>
<p>a specification of the ARIMA model for the cohort effect: 
the three components <code class="reqn">(p, d, q)</code> are the AR order, the degree of 
differencing, and the MA. The default is an ARIMA<code class="reqn">(1, 1, 0)</code>.</p>
</td></tr>
<tr><td><code id="simulate.fitStMoMo_+3A_gc.include.constant">gc.include.constant</code></td>
<td>
<p>a logical value indicating if the ARIMA model
should include a constant value. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="simulate.fitStMoMo_+3A_jumpchoice">jumpchoice</code></td>
<td>
<p>option to select the jump-off rates, i.e. the rates 
from the final year of observation, to use in projections of mortality 
rates. <code>"fit"</code>(default) uses the fitted rates and <code>"actual"</code> 
uses the actual rates from the final year.</p>
</td></tr>
<tr><td><code id="simulate.fitStMoMo_+3A_kt.method">kt.method</code></td>
<td>
<p>optional forecasting method for the period index. 
The alternatives are <code>"mrwd"</code>(default) and <code>"iarima"</code>. See details.</p>
</td></tr>
<tr><td><code id="simulate.fitStMoMo_+3A_kt.order">kt.order</code></td>
<td>
<p>an optional matrix with one row per period index
specifying the ARIMA models: for the ith row (ith period index) the three 
components <code class="reqn">(p, d, q)</code> are the AR order, the degree of  differencing, 
and the MA order. If absent the arima models are fitted using 
<code><a href="forecast.html#topic+auto.arima">auto.arima</a></code>. This argument is only used when
<code>kt.method</code> is <code>"iarima"</code>.</p>
</td></tr>
<tr><td><code id="simulate.fitStMoMo_+3A_kt.include.constant">kt.include.constant</code></td>
<td>
<p>an optional vector of logical values 
indicating if the ARIMA model for the ith period index should include a 
constant value. The default is <code>TRUE</code>.  This argument is only used 
when <code>kt.method</code> is <code>"iarima"</code>.</p>
</td></tr>
<tr><td><code id="simulate.fitStMoMo_+3A_kt.lookback">kt.lookback</code></td>
<td>
<p>optional argument to specify the look-back window to use
in the estimation of the time series model for the period indexes. By 
default all the estimated values are used. If 
<code>kt.lookback</code> is provided then the last <code>kt.lookback</code> 
years of <code class="reqn">\kappa_t^{(i)}, i = 1,..N,</code> are used.</p>
</td></tr>
<tr><td><code id="simulate.fitStMoMo_+3A_gc.lookback">gc.lookback</code></td>
<td>
<p>optional argument to specify the look-back window to use
in the estimation of the ARIMA model for the cohort effect. By 
default all the estimated values are used in estimating the ARIMA 
model. If <code>gc.lookback</code> is provided then the last 
<code>gc.lookback</code> years of <code class="reqn">\gamma_{t-x}</code> are used.</p>
</td></tr>
<tr><td><code id="simulate.fitStMoMo_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>kt.method</code> is <code>"mrwd"</code>, fitting and simulation of 
the time series model for the  period indexes is done with a 
Multivariate Random Walk with Drift using the function 
<code><a href="#topic+mrwd">mrwd</a></code>.
</p>
<p>If <code>kt.method</code> is <code>"iarima"</code>, fitting and simulation of 
the time series model for the  period indexes is done with <code class="reqn">N</code> 
independent arima models using the function <code><a href="#topic+iarima">iarima</a></code>. 
See this latter function for details on input arguments 
<code>kt.order</code> and <code>kt.include.constant</code>.  
</p>
<p>Fitting and simulation of the ARIMA model for the cohort index
is done with function <code><a href="forecast.html#topic+Arima">Arima</a></code> from package 
<span class="pkg">forecast</span>. See the latter function for further details on 
input arguments <code>gc.order</code> and <code>gc.include.constant</code>. 
</p>
<p>Note that in some cases simulations of the 
cohort effects may be needed for a horizon longer than <code>h</code>.
This is the case when in the fitted model the most recent cohorts 
have been zero weighted. The simulated cohorts can be seen in 
<code>gc.s$cohorts</code>.
</p>


<h3>Value</h3>

<p>A list of class <code>"simStMoMo"</code> with components:
</p>
<table>
<tr><td><code>rates</code></td>
<td>
<p> a three dimensional array with the future simulated rates.</p>
</td></tr>
<tr><td><code>ages</code></td>
<td>
<p> vector of ages corresponding to the first dimension of 
<code>rates</code>.</p>
</td></tr>
<tr><td><code>years</code></td>
<td>
<p>vector of years for which a simulations has been produced. 
This corresponds to the second dimension of <code>rates</code>.</p>
</td></tr>  
<tr><td><code>kt.s</code></td>
<td>
<p> information on the simulated paths of the period indexes 
of the model. This is a list with the  <code>model</code> fitted to 
<code class="reqn">\kappa_t</code>; the simulated paths (<code>sim</code>); and the <code>years</code> 
for which simulations were produced. If the mortality model does not 
have any age-period terms (i.e. <code class="reqn">N=0</code>) this is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code>gc.s</code></td>
<td>
<p> information on the simulated paths of the cohort index of 
the model. This is a list with the <code>model</code> fitted to <code class="reqn">\gamma_c</code>; 
the simulated paths (<code>sim</code>); and the <code>cohorts</code> for which 
simulations were produced. If the mortality model does not have a cohort 
effect this is set to <code>NULL</code>.</p>
</td></tr> 
<tr><td><code>oxt.s</code></td>
<td>
<p> a three dimensional array with the offset used in the 
simulations.</p>
</td></tr>
<tr><td><code>fitted</code></td>
<td>
<p> a three dimensional array with the in-sample rates of 
the model for the years for which the mortality model was fitted.</p>
</td></tr>
<tr><td><code>jumpchoice</code></td>
<td>
<p>Jump-off method used in the simulation.</p>
</td></tr>
<tr><td><code>kt.method</code></td>
<td>
<p>method used in the modelling of the period index.</p>
</td></tr>
<tr><td><code>model</code></td>
<td>
<p> the model fit from which the simulations were produced.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+forecast.fitStMoMo">forecast.fitStMoMo</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Lee-Carter
LCfit &lt;- fit(lc(), data = EWMaleData, ages.fit = 55:89)
LCsim.mrwd &lt;- simulate(LCfit, nsim = 100)
LCsim.iarima &lt;- simulate(LCfit, nsim = 100, kt.method = "iarima", 
                         kt.order = c(1, 1, 2))

par(mfrow=c(2, 2))
plot(LCfit$years, LCfit$kt[1, ], xlim = range(LCfit$years, LCsim.mrwd$kt.s$years),
     ylim = range(LCfit$kt, LCsim.mrwd$kt.s$sim), type = "l", 
     xlab = "year", ylab = "kt", 
     main = "Lee-Carter: Simulated paths of the period index kt (mrwd)")
matlines(LCsim.mrwd$kt.s$years, LCsim.mrwd$kt.s$sim[1, , ], type = "l", lty = 1)

plot(LCfit$years, (LCfit$Dxt / LCfit$Ext)["65", ], 
     xlim = range(LCfit$years, LCsim.mrwd$years),
     ylim = range((LCfit$Dxt / LCfit$Ext)["65", ], LCsim.mrwd$rates["65", , ]), 
     type = "l", xlab = "year", ylab = "rate", 
     main = "Lee-Carter: Simulated mortality rates at age 65")
matlines(LCsim.mrwd$years, LCsim.mrwd$rates["65", , ], type = "l", lty = 1)

plot(LCfit$years, LCfit$kt[1, ], xlim = range(LCfit$years, LCsim.iarima$kt.s$years),
     ylim = range(LCfit$kt, LCsim.iarima$kt.s$sim), type = "l", 
     xlab = "year", ylab = "kt", 
     main = "Lee-Carter: Simulated paths of the period index kt (ARIMA(1, 1, 2))")
matlines(LCsim.iarima$kt.s$years, LCsim.iarima$kt.s$sim[1, , ], type = "l", lty = 1)

plot(LCfit$years, (LCfit$Dxt / LCfit$Ext)["65", ], 
     xlim = range(LCfit$years, LCsim.iarima$years),
     ylim = range((LCfit$Dxt / LCfit$Ext)["65", ], LCsim.iarima$rates["65", , ]), 
     type = "l", xlab = "year", ylab = "rate", 
     main = "Lee-Carter: Simulated mortality rates at age 65 (ARIMA(1, 1, 2))")
matlines(LCsim.iarima$years, LCsim.iarima$rates["65", , ], type = "l", lty = 1)

#APC
par(mfrow=c(1, 3))
wxt &lt;- genWeightMat(55:89,  EWMaleData$years, clip = 3)
APCfit &lt;- fit(apc(), data = EWMaleData, ages.fit = 55:89, wxt = wxt)
APCsim &lt;- simulate(APCfit, nsim = 100, gc.order = c(1, 1, 0))

plot(APCfit$years, APCfit$kt[1, ], 
     xlim = range(APCfit$years, APCsim$kt.s$years),
     ylim = range(APCfit$kt, APCsim$kt.s$sim), type = "l",
     xlab = "year", ylab = "kt",
     main = "APC: Simulated paths of the period index kt")
matlines(APCsim$kt.s$years, APCsim$kt.s$sim[1, , ], type = "l", lty = 1)

plot(APCfit$cohorts, APCfit$gc, 
     xlim = range(APCfit$cohorts, APCsim$gc.s$cohorts),
     ylim = range(APCfit$gc, APCsim$gc.s$sim, na.rm = TRUE), type = "l",
     xlab = "year", ylab = "kt", 
     main = "APC: Simulated paths of the cohort index (ARIMA(1,1,0))")
matlines(APCsim$gc.s$cohorts, APCsim$gc.s$sim, type = "l", lty = 1)

plot(APCfit$years, (APCfit$Dxt / APCfit$Ext)["65", ], 
     xlim = range(APCfit$years, APCsim$years),
     ylim = range((APCfit$Dxt/APCfit$Ext)["65", ], APCsim$rates["65", , ]), 
     type = "l", xlab = "year", ylab = "rate", 
     main = "APC: Simulated of mortality rates at age 65")
matlines(APCsim$years, APCsim$rates["65", , ], type = "l", lty = 1)

#Compare LC and APC
library(fanplot)
par(mfrow=c(1, 1))
plot(LCfit$years, (LCfit$Dxt / LCfit$Ext)["65", ], 
     xlim = range(LCfit$years, LCsim.mrwd$years),
     ylim = range((LCfit$Dxt / LCfit$Ext)["65", ], LCsim.mrwd$rates["65", , ], 
     APCsim$rates["65", , ]), type = "l", xlab = "year", ylab = "rate", 
     main = "Fan chart of mortality rates at age 65 (LC vs. APC)")
fan(t(LCsim.mrwd$rates["65", , ]), start = LCsim.mrwd$years[1], 
    probs = c(2.5, 10, 25, 50, 75, 90, 97.5), n.fan = 4,
    fan.col = colorRampPalette(c(rgb(1, 0, 0), rgb(1, 1, 1))), ln = NULL)
fan(t(APCsim$rates["65", 1:(length(APCsim$years) - 3), ]), 
    start = APCsim$years[1], probs = c(2.5, 10, 25, 50, 75, 90, 97.5), 
    n.fan = 4, fan.col = colorRampPalette(c(rgb(0, 0, 1), rgb(1, 1, 1))), 
    ln = NULL) 
</code></pre>

<hr>
<h2 id='simulate.iarima'>Simulate independent arima series</h2><span id='topic+simulate.iarima'></span>

<h3>Description</h3>

<p>Returns one simulated path of the group of independent 
arima series in <code>object</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'iarima'
simulate(object, nsim = 10, seed = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simulate.iarima_+3A_object">object</code></td>
<td>
<p>An object of class <code>"iarima"</code>.</p>
</td></tr>
<tr><td><code id="simulate.iarima_+3A_nsim">nsim</code></td>
<td>
<p>number of periods for the simulated series.</p>
</td></tr>
<tr><td><code id="simulate.iarima_+3A_seed">seed</code></td>
<td>
<p>either <code>NULL</code> or an integer that will be used in a 
call to <code><a href="base.html#topic+set.seed">set.seed</a></code> before simulating the time series. 
The default, <code>NULL</code> will not change the random generator state.</p>
</td></tr>
<tr><td><code id="simulate.iarima_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>

<hr>
<h2 id='simulate.mrwd'>Simulate a Multivariate Random Walk with Drift</h2><span id='topic+simulate.mrwd'></span>

<h3>Description</h3>

<p>Returns one simulated path of the Multivariate 
Random Walk with Drift model in <code>object</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mrwd'
simulate(object, nsim = 10, seed = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simulate.mrwd_+3A_object">object</code></td>
<td>
<p>An object of class <code>"mrwd"</code>.</p>
</td></tr>
<tr><td><code id="simulate.mrwd_+3A_nsim">nsim</code></td>
<td>
<p>number of periods for the simulated series.</p>
</td></tr>
<tr><td><code id="simulate.mrwd_+3A_seed">seed</code></td>
<td>
<p>either <code>NULL</code> or an integer that will be used in a 
call to <code><a href="base.html#topic+set.seed">set.seed</a></code> before simulating the time series. 
The default, <code>NULL</code> will not change the random generator state.</p>
</td></tr>
<tr><td><code id="simulate.mrwd_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>

<hr>
<h2 id='StMoMo'>Create a new Stochastic Mortality Model</h2><span id='topic+StMoMo'></span><span id='topic+StMoMo'></span><span id='topic+StMoMo-package'></span>

<h3>Description</h3>

<p>Initialises a StMoMo object which represents a Generalised 
Age-Period-Cohort Stochastic Mortality Model.
</p>
<p>StMoMo.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>StMoMo(link = c("log", "logit"), staticAgeFun = TRUE, periodAgeFun = "NP",
  cohortAgeFun = NULL, constFun = function(ax, bx, kt, b0x, gc, wxt, ages)
  list(ax = ax, bx = bx, kt = kt, b0x = b0x, gc = gc))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="StMoMo_+3A_link">link</code></td>
<td>
<p>defines the link function and random component associated with 
the mortality model. <code>"log"</code> would assume that deaths follow a 
Poisson distribution and use a log link while <code>"logit"</code> would assume 
that deaths follow a Binomial distribution and a logit link.</p>
</td></tr>
<tr><td><code id="StMoMo_+3A_staticagefun">staticAgeFun</code></td>
<td>
<p>logical value indicating if a static age function 
<code class="reqn">\alpha_x</code> is to be included.</p>
</td></tr>
<tr><td><code id="StMoMo_+3A_periodagefun">periodAgeFun</code></td>
<td>
<p>a list of length <code class="reqn">N</code> with the definitions of the 
period age modulating parameters <code class="reqn">\beta_x^{(i)}</code>. Each entry can take 
values: <code>"NP"</code> for non-parametric age terms, <code>"1"</code> for 
<code class="reqn">\beta_x^{(i)}=1</code> or a predefined parametric function of 
age (see details). Set this to <code>NULL</code> if there are no period terms 
in the model.</p>
</td></tr>
<tr><td><code id="StMoMo_+3A_cohortagefun">cohortAgeFun</code></td>
<td>
<p>defines the cohort age modulating parameter 
<code class="reqn">\beta_x^{(0)}</code>. It can take values: <code>"NP"</code> for non-parametric 
age terms, <code>"1"</code> for <code class="reqn">\beta_x^{(0)}=1</code>, a predefined parametric 
function of age (see details) or <code>NULL</code> if there is no cohort effect.</p>
</td></tr>
<tr><td><code id="StMoMo_+3A_constfun">constFun</code></td>
<td>
<p>function defining the identifiability constraints of the 
model. It must be a function of the form 
<code>constFun &lt;- function(ax, bx, kt, b0x, gc, wxt, ages)</code> taking a set
of fitted model parameters and returning a list 
<code>list(ax = ax, bx = bx, kt = kt, b0x = b0x, gc = gc)</code>
of the model parameters with the identifiability constraints applied. If 
omitted no identifiability constraints are applied to the model.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>R implementation of the family of Generalised Age-Period-Cohort 
stochastic mortality models.  This family of models encompasses
many models proposed in the literature including the well-known
Lee-Carter model, CBD model and APC model. 
</p>
<p><code>StMoMo</code> defines an abstract representation of a Generalised 
Age-Period-Cohort (GAPC) Stochastic model that fits within the 
general class of generalised non-linear models defined as follows 
</p>
<p style="text-align: center;"><code class="reqn">D_{xt} \sim Poisson(E_{xt}\mu_{xt}), D_{xt} \sim 
Binomial(E_{xt},q_{xt})</code>
</p>
 
<p style="text-align: center;"><code class="reqn">\eta_{xt} = \log \mu_{xt}, \eta_{xt} = \mathrm{logit}\,
q_{xt}</code>
</p>
 <p style="text-align: center;"><code class="reqn">\eta_{xt} = \alpha_x + \sum_{i=1}^N \beta_x^{(i)}\kappa_t^{(i)}
+ \beta_x^{(0)}\gamma_{t-x}</code>
</p>
 <p style="text-align: center;"><code class="reqn">v: \{\alpha_{x}, \beta_x^{(1)},..., 
\beta_x^{(N)}, \kappa_t^{(1)},..., \kappa_t^{(N)}, \beta_x^{(0)}, \gamma_{t-x}\} \mapsto 
\{\alpha_{x}, \beta_x^{(1)},..., \beta_x^{(N)}, \kappa_t^{(1)},..., \kappa_t^{(N)}, 
\beta_x^{(0)}, \gamma_{t-x}\},</code>
</p>
<p> where  
</p>

<ul>
<li> <p><code class="reqn">\alpha_x</code> is a static age function; 
</p>
</li>
<li> <p><code class="reqn">\beta_x^{(i)}\kappa_t^{(i)}, i = 1,..N</code>, are age/period terms; 
</p>
</li>
<li> <p><code class="reqn">\beta_x^{(0)}\gamma_{t-x}</code> is the age/cohort term; and 
</p>
</li>
<li> <p><code class="reqn">v</code> is a  function defining the identifiability constraints of 
the model. 
</p>
</li></ul>

<p>Most Stochastic mortality models proposed in the literature can be cast to
this representation (See Hunt and Blake (2015)).
</p>
<p>Parametric age functions should be scalar functions of the form 
<code>f &lt;- function(x, ages)</code> taking a scalar age <code>x</code> and a vector 
of model fitting <code>ages</code> (see examples below).
</p>
<p>Do to limitation of functions <code><a href="gnm.html#topic+gnm">gnm</a></code> within package 
<span class="pkg">gnm</span>, which is used for fitting <code>"StMoMo"</code> objects to data 
(see <code><a href="#topic+fit.StMoMo">fit.StMoMo</a></code>), models combining parametric and 
non-parametric age-modulating functions are not supported at the moment.
</p>


<h3>Value</h3>

<p>A list with class <code>"StMoMo"</code> with components:
</p>
<table>
<tr><td><code>link</code></td>
<td>
<p>a character string defining the link function of the model.</p>
</td></tr>
<tr><td><code>staticAgeFun</code></td>
<td>
<p>a logical value indicating if the model has a static 
age function.</p>
</td></tr>
<tr><td><code>periodAgeFun</code></td>
<td>
<p>a list defining the period age modulating parameters.</p>
</td></tr>
<tr><td><code>cohortAgeFun</code></td>
<td>
<p>an object defining the cohort age modulating 
parameters.</p>
</td></tr>
<tr><td><code>constFun</code></td>
<td>
<p>a function defining the identifiability constraints.</p>
</td></tr>
<tr><td><code>N</code></td>
<td>
<p>an integer specifying The number of age-period terms in the 
model.</p>
</td></tr>
<tr><td><code>textFormula</code></td>
<td>
<p>a character string of the model formula.</p>
</td></tr>
<tr><td><code>gnmFormula</code></td>
<td>
<p>a formula that can be used for fitting the model with 
package <span class="pkg">gnm</span>.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Plat, R. (2009). On stochastic mortality modeling. Insurance: Mathematics 
and Economics, 45(3), 393-404. 
</p>
<p>Hunt, A., &amp; Blake, D. (2015). On the Structure and Classification of 
Mortality Models Mortality Models. Pension Institute Working Paper.
<a href="http://www.pensions-institute.org/workingpapers/wp1506.pdf">http://www.pensions-institute.org/workingpapers/wp1506.pdf</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fit.StMoMo">fit.StMoMo</a></code>, <code><a href="#topic+lc">lc</a></code>, <code><a href="#topic+cbd">cbd</a></code>, 
<code><a href="#topic+apc">apc</a></code>, <code><a href="#topic+rh">rh</a></code>, <code><a href="#topic+m6">m6</a></code>, <code><a href="#topic+m7">m7</a></code>, 
<code><a href="#topic+m8">m8</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Lee-Carter model
constLC &lt;- function(ax, bx, kt, b0x, gc, wxt, ages) {
 c1 &lt;- mean(kt[1, ], na.rm = TRUE)
 c2 &lt;- sum(bx[, 1], na.rm = TRUE)
 list(ax = ax + c1 * bx, bx = bx / c2, kt = c2 * (kt - c1))
}
LC &lt;- StMoMo(link = "log", staticAgeFun = TRUE, periodAgeFun = "NP",
             constFun = constLC)

plot(fit(LC, data = EWMaleData, ages.fit = 55:89))


#CBD model   
f2 &lt;- function(x, ages) x - mean(ages)
CBD &lt;- StMoMo(link = "logit", staticAgeFun = FALSE,
              periodAgeFun = c("1", f2))
plot(fit(CBD, data = EWMaleData, ages.fit = 55:89))

#Reduced Plat model (Plat, 2009)
f2 &lt;- function(x, ages) mean(ages) - x
constPlat &lt;- function(ax, bx, kt, b0x, gc, wxt, ages) {
 nYears &lt;- dim(wxt)[2]
 x &lt;- ages
 t &lt;- 1:nYears
 c &lt;- (1 - tail(ages, 1)):(nYears - ages[1])
 xbar &lt;- mean(x)
 #nsum g(c)=0, nsum cg(c)=0, nsum c^2g(c)=0
 phiReg &lt;- lm(gc ~ 1 + c + I(c^2), na.action = na.omit)
 phi &lt;- coef(phiReg)
 gc &lt;- gc - phi[1] - phi[2] * c - phi[3] * c^2
 kt[2, ] &lt;- kt[2, ] + 2 * phi[3] * t
 kt[1, ] &lt;- kt[1, ] + phi[2] * t + phi[3] * (t^2 - 2 * xbar * t)
 ax &lt;- ax + phi[1] - phi[2] * x + phi[3] * x^2
 #nsum kt[i, ] = 0
 ci &lt;- rowMeans(kt, na.rm = TRUE)
 ax &lt;- ax + ci[1] + ci[2] * (xbar - x)
 kt[1, ] &lt;- kt[1, ] - ci[1]
 kt[2, ] &lt;- kt[2, ] - ci[2]
 list(ax = ax, bx = bx, kt = kt, b0x = b0x, gc = gc)
}
PLAT &lt;- StMoMo(link = "log", staticAgeFun = TRUE,
               periodAgeFun = c("1", f2), cohortAgeFun = "1",
               constFun = constPlat)

plot(fit(PLAT, data = EWMaleData, ages.fit = 55:89))

#Models not supported
## Not run: 
MnotSup1 &lt;- StMoMo(periodAgeFun = c(f2, "NP"))
MnotSup1 &lt;- StMoMo(periodAgeFun = f2, cohortAgeFun = "NP")

## End(Not run)
</code></pre>

<hr>
<h2 id='StMoMoData'>Create StMoMoData object from demogdata object</h2><span id='topic+StMoMoData'></span>

<h3>Description</h3>

<p>Create StMoMoData object suitable for fitting a Stochastic Mortality 
Model using function <code><a href="#topic+fit.StMoMo">fit.StMoMo</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>StMoMoData(data, series = names(data$rate)[1], type = c("central",
  "initial"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="StMoMoData_+3A_data">data</code></td>
<td>
<p>demogdata object of type &quot;mortality&quot;. It is either the
output from functions <code><a href="demography.html#topic+read.demogdata">read.demogdata</a></code> or 
<code><a href="demography.html#topic+hmd.mx">hmd.mx</a></code> of package <code>demography</code>.</p>
</td></tr>
<tr><td><code id="StMoMoData_+3A_series">series</code></td>
<td>
<p>name of series within <code>data</code> to use.</p>
</td></tr>
<tr><td><code id="StMoMoData_+3A_type">type</code></td>
<td>
<p>the type of exposure that should be included in the 
output. The alternatives are <code>"central"</code> (default) and 
<code>"initial"</code>.  <code>"central"</code> exposures are suitable for fitting
models under a log-Poisson framework while <code>"initial"</code> exposures
are suitable under a logit-Binomial framework.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with class <code>"StMoMoData"</code> with components:
</p>
<table>
<tr><td><code>Dxt</code></td>
<td>
<p> matrix of deaths data.</p>
</td></tr>   
<tr><td><code>Ext</code></td>
<td>
<p> matrix of observed exposures.</p>
</td></tr> 
<tr><td><code>ages</code></td>
<td>
<p> vector of ages corresponding to rows of <code>Dxt</code> and 
<code>Ext</code>.</p>
</td></tr> 
<tr><td><code>years</code></td>
<td>
<p> vector of years corresponding to rows of <code>Dxt</code> and 
<code>Ext</code>.</p>
</td></tr> 
<tr><td><code>type</code></td>
<td>
<p> the type of exposure in the data.</p>
</td></tr>
<tr><td><code>series</code></td>
<td>
<p> name of the extracted series.</p>
</td></tr>
<tr><td><code>label</code></td>
<td>
<p> label of the data.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(demography)
NZdata &lt;- hmd.mx(country = "NZL_NP", username = username, password = password, 
label = "New Zealand")
NZStMoMo &lt;- StMoMoData(NZdata, series = "male")
summary(NZStMoMo)

## End(Not run)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
