<!DOCTYPE html><html><head><title>Help for package WaMaSim</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {WaMaSim}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#$.statelist'><p>Extract time or budget as vectors</p></a></li>
<li><a href='#costs.per.year'><p>Calculate the total costs per year</p></a></li>
<li><a href='#do.nothing'><p>Rehabilitation strategy: no pipe replacement, repairs only</p></a></li>
<li><a href='#expand'><p>Model expansion of the network</p></a></li>
<li><a href='#fail'><p>Model failures of the network</p></a></li>
<li><a href='#failure.cost'><p>Calculate the (random) cost of a failure</p></a></li>
<li><a href='#failures.per.year'><p>Calculate number of failures per year</p></a></li>
<li><a href='#initiate.network'><p>creates the initial network</p></a></li>
<li><a href='#pipes.built.per.year'><p>Calculate number of newly built pipes for each year</p></a></li>
<li><a href='#pipes.inservice.per.year'><p>Returns the number of pipes in service for each year</p></a></li>
<li><a href='#replace.more.failures.than'><p>Rehabilitation strategy: replace pipes with too many failures</p></a></li>
<li><a href='#replace.n.highest.risk'><p>Rehabilitation strategy: replace the <code>n</code> pipes with the highest risk</p></a></li>
<li><a href='#replace.n.oldest'><p>Rehabilitation strategy: replace the <code>n</code> oldest pipes</p></a></li>
<li><a href='#replace.n.random'><p>Rehabilitation strategy: replace <code>n</code> randomly selected pipes</p></a></li>
<li><a href='#replace.older.than'><p>Rehabilitation strategy: replace pipes older than <code>age</code></p></a></li>
<li><a href='#replacement.value'><p>Calculate replacement value</p></a></li>
<li><a href='#sample.diameter'><p>Sample a diameter of a new pipe.</p></a></li>
<li><a href='#simulate_network'><p>Simulate the failures, expansion, rehabilitation, and costs of a network</p></a></li>
<li><a href='#simulate_network.period'><p>Simulate the network for a period of time</p></a></li>
<li><a href='#WaMaSim'><p>WaMaSim - Water Management Simulator</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Simulate Rehabilitation Strategies for Water Distribution
Systems</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2019-05-02</td>
</tr>
<tr>
<td>Author:</td>
<td>Andreas Scheidegger [aut],
  Rachel Barrett [aut],
  Christian Foerster [cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Christian Foerster &lt;christian.foerster@eawag.ch&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>The outcome of various rehabilitation strategies for water distribution systems can be modeled with the Water Management Simulator (WaMaSim). Pipe breaks and the corresponding damage and rehabilitation costs are simulated. It is mainly intended to be used as educational tool for the Water Infrastructure Experimental and Computer Laboratory at ETH Zurich, Switzerland.</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/scheidan/WaMaSim">https://github.com/scheidan/WaMaSim</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/scheidan/WaMaSim/issues">https://github.com/scheidan/WaMaSim/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.1.1</td>
</tr>
<tr>
<td>Depends:</td>
<td>magrittr (&ge; 1.5)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2019-05-03 06:59:43 UTC; heinrich</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2019-05-03 15:50:13 UTC</td>
</tr>
</table>
<hr>
<h2 id='+24.statelist'>Extract time or budget as vectors</h2><span id='topic++24.statelist'></span>

<h3>Description</h3>

<p>Convenient functions to extract the time or budget.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'statelist'
x$name
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="+2B24.statelist_+3A_x">x</code></td>
<td>
<p>a state list</p>
</td></tr>
<tr><td><code id="+2B24.statelist_+3A_name">name</code></td>
<td>
<p>name of the element to extract</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector of the time or budget, or a state
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
str(result)      # result is a 'statelist' returned from simulate_network
result$budget    # vector of budget
result$time      # vector of time
result$time.22   # state list of time 22

## End(Not run)
</code></pre>

<hr>
<h2 id='costs.per.year'>Calculate the total costs per year</h2><span id='topic+costs.per.year'></span>

<h3>Description</h3>

<p>The annual total costs are calculated. The total costs consist
of damage, failure and rehabilitation costs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>costs.per.year(statelist, income)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="costs.per.year_+3A_statelist">statelist</code></td>
<td>
<p>a state list</p>
</td></tr>
<tr><td><code id="costs.per.year_+3A_income">income</code></td>
<td>
<p>the same values as passed to
<code>simulate_network</code>. Either a scalar or vector.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector of the total cost per year
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>

<hr>
<h2 id='do.nothing'>Rehabilitation strategy: no pipe replacement, repairs only</h2><span id='topic+do.nothing'></span>

<h3>Description</h3>

<p>Dummy strategy to model no rehabilitation at all.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>do.nothing(state)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="do.nothing_+3A_state">state</code></td>
<td>
<p>a state list</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a state list
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>


<h3>See Also</h3>

<p><code><a href="#topic+replace.n.highest.risk">replace.n.highest.risk</a></code>,
<code><a href="#topic+replace.n.oldest">replace.n.oldest</a></code>, <code><a href="#topic+replace.n.random">replace.n.random</a></code>, <code><a href="#topic+replace.older.than">replace.older.than</a></code>,
<code><a href="#topic+replace.more.failures.than">replace.more.failures.than</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## define a strategy function that can be passed to simulate_network():
mystrategy &lt;- . %&gt;% do.nothing

</code></pre>

<hr>
<h2 id='expand'>Model expansion of the network</h2><span id='topic+expand'></span>

<h3>Description</h3>

<p>Expand the network with additional pipes. The diameter of these pipes is sampled.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expand(state, n.new, separate.budget = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expand_+3A_state">state</code></td>
<td>
<p>a state object</p>
</td></tr>
<tr><td><code id="expand_+3A_n.new">n.new</code></td>
<td>
<p><code>n.new</code> number of new pipes</p>
</td></tr>
<tr><td><code id="expand_+3A_separate.budget">separate.budget</code></td>
<td>
<p>boolean, if <code>TRUE</code> then expansion costs 
are not deducted from the normal budget</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the expanded inventory
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>

<hr>
<h2 id='fail'>Model failures of the network</h2><span id='topic+fail'></span>

<h3>Description</h3>

<p>Allows pipes to randomly fail. If a failure occurs, the failure costs (repair + damage) are
calculated and subtracted from the budget. Note, that this may result in a negative budget.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fail(state, prob.failure)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fail_+3A_state">state</code></td>
<td>
<p>a state object</p>
</td></tr>
<tr><td><code id="fail_+3A_prob.failure">prob.failure</code></td>
<td>
<p>function returning the annual failure rate; i.e. the probability of a 
pipe failing in the current year of simulation.
<code>prob.failure</code> must take <code>age, age.last.failure, n.failure</code> as input arguments.
Note that in the case of a pipe with zero previous failures (i.e. <code>n.failure</code>=0), 
<code>age.last.failure</code>=NA.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>inventory with new failures
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>

<hr>
<h2 id='failure.cost'>Calculate the (random) cost of a failure</h2><span id='topic+failure.cost'></span>

<h3>Description</h3>

<p>Calculate the costs caused by a failure according to Section 7.1 in
&quot;The Water Network Management Challenge&quot;, Max Maurer 2017.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>failure.cost(diameter, mean = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="failure.cost_+3A_diameter">diameter</code></td>
<td>
<p>diameter [mm]</p>
</td></tr>
<tr><td><code id="failure.cost_+3A_mean">mean</code></td>
<td>
<p>boolean. Should the expected cost be returned? Random otherwise.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>if <code>mean=FALSE</code>, the failure costs [CHF] are sampled
randomly. If <code>mean=TRUE</code>, the expected average costs are returned.
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>

<hr>
<h2 id='failures.per.year'>Calculate number of failures per year</h2><span id='topic+failures.per.year'></span>

<h3>Description</h3>

<p>The number of failures per year is calculated
from a state list produced by <code><a href="#topic+simulate_network">simulate_network</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>failures.per.year(statelist)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="failures.per.year_+3A_statelist">statelist</code></td>
<td>
<p>a state list</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector containing the number of failures per year
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>

<hr>
<h2 id='initiate.network'>creates the initial network</h2><span id='topic+initiate.network'></span>

<h3>Description</h3>

<p>Creates the initial network that can be used with <code><a href="#topic+simulate_network">simulate_network</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>initiate.network(inventory = 0, budget = Inf)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="initiate.network_+3A_inventory">inventory</code></td>
<td>
<p>if <code>inventory</code> is an integer it specifies the
number of initial pipes, or alternatively it can be a <code>data.frame</code>
containing the initial inventory of pipes.</p>
</td></tr>
<tr><td><code id="initiate.network_+3A_budget">budget</code></td>
<td>
<p>initial budget</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a state list
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>

<hr>
<h2 id='pipes.built.per.year'>Calculate number of newly built pipes for each year</h2><span id='topic+pipes.built.per.year'></span>

<h3>Description</h3>

<p>The number of newly built pipes per year is calculated
from a state list produced by <code><a href="#topic+simulate_network">simulate_network</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pipes.built.per.year(statelist)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pipes.built.per.year_+3A_statelist">statelist</code></td>
<td>
<p>a state list</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector containing the number of newly built pipes for each year
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>

<hr>
<h2 id='pipes.inservice.per.year'>Returns the number of pipes in service for each year</h2><span id='topic+pipes.inservice.per.year'></span>

<h3>Description</h3>

<p>The number of pipes in service is calculated for every year
based on a state list produced by <code><a href="#topic+simulate_network">simulate_network</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pipes.inservice.per.year(statelist)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pipes.inservice.per.year_+3A_statelist">statelist</code></td>
<td>
<p>a state list</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector containing the number of pipes in service
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>

<hr>
<h2 id='replace.more.failures.than'>Rehabilitation strategy: replace pipes with too many failures</h2><span id='topic+replace.more.failures.than'></span>

<h3>Description</h3>

<p>Replace pipes with a high number of failures. Pipes are only
replaced if the budget remains positive.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>replace.more.failures.than(state, failures, max.costs = Inf)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="replace.more.failures.than_+3A_state">state</code></td>
<td>
<p>a state list</p>
</td></tr>
<tr><td><code id="replace.more.failures.than_+3A_failures">failures</code></td>
<td>
<p>maximal allowed number of failures</p>
</td></tr>
<tr><td><code id="replace.more.failures.than_+3A_max.costs">max.costs</code></td>
<td>
<p>maximal amount of money allowed to be spent on this strategy</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a state list
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>


<h3>See Also</h3>

<p><code><a href="#topic+replace.n.highest.risk">replace.n.highest.risk</a></code>,
<code><a href="#topic+replace.n.oldest">replace.n.oldest</a></code>, <code><a href="#topic+replace.n.random">replace.n.random</a></code>, <code><a href="#topic+replace.older.than">replace.older.than</a></code>,
<code><a href="#topic+do.nothing">do.nothing</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## define a strategy function that can be passed to simulate_network():
mystrategy &lt;- . %&gt;% replace.more.failures.than(max.failure=3, max.costs=20000)

## or define a more complex strategy by combining multiple strategies
## into a prioritized sequence:
mystrategy &lt;- . %&gt;%
  replace.more.failures.than(failures=2) %&gt;%
  replace.n.oldest(n=3) %&gt;%
  replace.n.highest.risk(n=2, prob.failure=prob.failure.exp) %&gt;%
  replace.older.than(age=8) %&gt;%
  replace.n.random(n=4)


</code></pre>

<hr>
<h2 id='replace.n.highest.risk'>Rehabilitation strategy: replace the <code>n</code> pipes with the highest risk</h2><span id='topic+replace.n.highest.risk'></span>

<h3>Description</h3>

<p>Strategy to prioritize pipes with the highest risk. Pipes are only
replaced if the budget remains positive.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>replace.n.highest.risk(state, n, prob.failure, max.costs = Inf)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="replace.n.highest.risk_+3A_state">state</code></td>
<td>
<p>a state list</p>
</td></tr>
<tr><td><code id="replace.n.highest.risk_+3A_n">n</code></td>
<td>
<p>number of highest risk pipes to replace</p>
</td></tr>
<tr><td><code id="replace.n.highest.risk_+3A_prob.failure">prob.failure</code></td>
<td>
<p>failure rate function. Typically the same as passed to <code><a href="#topic+simulate_network">simulate_network</a></code>.</p>
</td></tr>
<tr><td><code id="replace.n.highest.risk_+3A_max.costs">max.costs</code></td>
<td>
<p>maximal amount of money allowed to be spent on this strategy</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The risk is defined as the product of the failure probability in the next year
and the expected failure costs.
</p>


<h3>Value</h3>

<p>a state list
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>


<h3>See Also</h3>

<p><code><a href="#topic+replace.n.oldest">replace.n.oldest</a></code>, <code><a href="#topic+replace.n.random">replace.n.random</a></code>,
<code><a href="#topic+replace.older.than">replace.older.than</a></code>,
<code><a href="#topic+replace.more.failures.than">replace.more.failures.than</a></code>, <code><a href="#topic+do.nothing">do.nothing</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## define a strategy function that can be passed to simulate_network():
mystrategy &lt;- . %&gt;% replace.n.highest.risk(n=2, prob.failure=prob.failure.exp, max.costs=30000)

## or define a more complex strategy by combining multiple strategies
## into a prioritized sequence:
mystrategy &lt;- . %&gt;%
  replace.more.failures.than(failures=2) %&gt;%
  replace.n.oldest(n=3) %&gt;%
  replace.n.highest.risk(n=2, prob.failure=prob.failure.exp) %&gt;%
  replace.older.than(age=8) %&gt;%
  replace.n.random(n=4)

</code></pre>

<hr>
<h2 id='replace.n.oldest'>Rehabilitation strategy: replace the <code>n</code> oldest pipes</h2><span id='topic+replace.n.oldest'></span>

<h3>Description</h3>

<p>Prioritize the oldest pipes for replacement. Pipes are only
replaced if the budget remains positive.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>replace.n.oldest(state, n, max.costs = Inf)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="replace.n.oldest_+3A_state">state</code></td>
<td>
<p>a state list</p>
</td></tr>
<tr><td><code id="replace.n.oldest_+3A_n">n</code></td>
<td>
<p>number of oldest pipes to replace</p>
</td></tr>
<tr><td><code id="replace.n.oldest_+3A_max.costs">max.costs</code></td>
<td>
<p>maximal amount of money allowed to be spent on this strategy</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a state list
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>


<h3>See Also</h3>

<p><code><a href="#topic+replace.n.highest.risk">replace.n.highest.risk</a></code>,
<code><a href="#topic+replace.n.random">replace.n.random</a></code>, <code><a href="#topic+replace.older.than">replace.older.than</a></code>,
<code><a href="#topic+replace.more.failures.than">replace.more.failures.than</a></code>, <code><a href="#topic+do.nothing">do.nothing</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## define a strategy function that can be passed to simulate_network():
mystrategy &lt;- . %&gt;% replace.n.oldest(n=10)

## or define a more complex strategy by combining multiple strategies
## into a prioritized sequence:
mystrategy &lt;- . %&gt;%
  replace.more.failures.than(failures=2) %&gt;%
  replace.n.oldest(n=3) %&gt;%
  replace.n.highest.risk(n=2, prob.failure=prob.failure.exp) %&gt;%
  replace.older.than(age=8) %&gt;%
  replace.n.random(n=4)

</code></pre>

<hr>
<h2 id='replace.n.random'>Rehabilitation strategy: replace <code>n</code> randomly selected pipes</h2><span id='topic+replace.n.random'></span>

<h3>Description</h3>

<p>Replace a certain number of randomly chosen pipes. Pipes are only
replaced if the budget remains positive.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>replace.n.random(state, n, max.costs = Inf)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="replace.n.random_+3A_state">state</code></td>
<td>
<p>a state list</p>
</td></tr>
<tr><td><code id="replace.n.random_+3A_n">n</code></td>
<td>
<p>number of random pipes to replace</p>
</td></tr>
<tr><td><code id="replace.n.random_+3A_max.costs">max.costs</code></td>
<td>
<p>maximal amount of money allowed to be spent on this strategy</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a state list
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>


<h3>See Also</h3>

<p><code><a href="#topic+replace.n.highest.risk">replace.n.highest.risk</a></code>,
<code><a href="#topic+replace.n.oldest">replace.n.oldest</a></code>, <code><a href="#topic+replace.older.than">replace.older.than</a></code>,
<code><a href="#topic+replace.more.failures.than">replace.more.failures.than</a></code>, <code><a href="#topic+do.nothing">do.nothing</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## define a strategy function that can be passed to simulate_network():
mystrategy &lt;- . %&gt;% replace.n.random(n=10)

## or define a more complex strategy by combining multiple strategies
## into a prioritized sequence:
mystrategy &lt;- . %&gt;%
  replace.more.failures.than(failures=2) %&gt;%
  replace.n.oldest(n=3) %&gt;%
  replace.n.highest.risk(n=2, prob.failure=prob.failure.exp) %&gt;%
  replace.older.than(age=8) %&gt;%
  replace.n.random(n=4)

</code></pre>

<hr>
<h2 id='replace.older.than'>Rehabilitation strategy: replace pipes older than <code>age</code></h2><span id='topic+replace.older.than'></span>

<h3>Description</h3>

<p>Strategy to replace pipes older than a given age. Pipes are only
replaced if the budget remains positive.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>replace.older.than(state, age, max.costs = Inf)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="replace.older.than_+3A_state">state</code></td>
<td>
<p>a state list</p>
</td></tr>
<tr><td><code id="replace.older.than_+3A_age">age</code></td>
<td>
<p>pipes older than age are replaced</p>
</td></tr>
<tr><td><code id="replace.older.than_+3A_max.costs">max.costs</code></td>
<td>
<p>maximal amount of money allowed to be spent on this strategy</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a state list
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>


<h3>See Also</h3>

<p><code><a href="#topic+replace.n.highest.risk">replace.n.highest.risk</a></code>,
<code><a href="#topic+replace.n.oldest">replace.n.oldest</a></code>, <code><a href="#topic+replace.n.random">replace.n.random</a></code>,
<code><a href="#topic+replace.more.failures.than">replace.more.failures.than</a></code>, <code><a href="#topic+do.nothing">do.nothing</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## define a strategy function that can be passed to simulate_network():
mystrategy &lt;- . %&gt;% replace.older.than(age=85, max.costs=20000)

## or define a more complex strategy by combining multiple strategies
## into a prioritized sequence:
mystrategy &lt;- . %&gt;%
  replace.more.failures.than(failures=2) %&gt;%
  replace.n.oldest(n=3) %&gt;%
  replace.n.highest.risk(n=2, prob.failure=prob.failure.exp) %&gt;%
  replace.older.than(age=8) %&gt;%
  replace.n.random(n=4)


</code></pre>

<hr>
<h2 id='replacement.value'>Calculate replacement value</h2><span id='topic+replacement.value'></span>

<h3>Description</h3>

<p>Based on Eq(14) of &quot;The Water Network Management Challenge, Max Maurer 2017&quot;,
assuming a pipe length of 100m.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>replacement.value(diameter)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="replacement.value_+3A_diameter">diameter</code></td>
<td>
<p>diameter of the pipe [mm]</p>
</td></tr>
</table>


<h3>Value</h3>

<p>replacement value [CHF]
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>

<hr>
<h2 id='sample.diameter'>Sample a diameter of a new pipe.</h2><span id='topic+sample.diameter'></span>

<h3>Description</h3>

<p>The diameter distribution is based on a real data set from Lisa Scholten 
(pipe_data.csv). Refer to the old exercise on watermain break modelling
in the ETH Infrastructure Systems course by Max Maurer.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sample.diameter(n = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sample.diameter_+3A_n">n</code></td>
<td>
<p>number of samples</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector of diameters
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>

<hr>
<h2 id='simulate_network'>Simulate the failures, expansion, rehabilitation, and costs of a network</h2><span id='topic+simulate_network'></span>

<h3>Description</h3>

<p>Simulates failures, expansion, rehabilitation, and costs of a water supply pipe network.
The simulation is stochastic.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate_network(n.years, expansion, rehabilitation, prob.failure,
  income = 0, initial.budget = Inf, initial.inventory = NULL,
  free.expansion = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simulate_network_+3A_n.years">n.years</code></td>
<td>
<p>number of years to simulate</p>
</td></tr>
<tr><td><code id="simulate_network_+3A_expansion">expansion</code></td>
<td>
<p>either a scalar describing the number of pipes added
every year to expand the pipe network, or a vector of length <code>n.years</code>.
Negative values are not allowed.</p>
</td></tr>
<tr><td><code id="simulate_network_+3A_rehabilitation">rehabilitation</code></td>
<td>
<p>a (combination of) rehabilitation strategy function(s). See details below.</p>
</td></tr>
<tr><td><code id="simulate_network_+3A_prob.failure">prob.failure</code></td>
<td>
<p>a function describing the probability of a pipe failing in the next year
given its age, number of previous failures, and the age at the last failure (if any).</p>
</td></tr>
<tr><td><code id="simulate_network_+3A_income">income</code></td>
<td>
<p>either a scalar describing the annual income, or a vector of length <code>n.years</code>.</p>
</td></tr>
<tr><td><code id="simulate_network_+3A_initial.budget">initial.budget</code></td>
<td>
<p>initial budget</p>
</td></tr>
<tr><td><code id="simulate_network_+3A_initial.inventory">initial.inventory</code></td>
<td>
<p>if it is an integer it specifies the
number of initial pipes, or alternatively it can be a <code>data.frame</code>
containing the initial inventory of pipes.</p>
</td></tr>
<tr><td><code id="simulate_network_+3A_free.expansion">free.expansion</code></td>
<td>
<p>if <code>TRUE</code> costs for network expansion are not deducted from the budget.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The rehabilitation is defined by combining different simple replacement strategies.
See the example for how this can be done using the <code>mystrategy</code> function input.
If the strategies vary over time, see <code><a href="#topic+initiate.network">initiate.network</a></code> and
<code><a href="#topic+simulate_network.period">simulate_network.period</a></code>.
</p>
<p>The failure behavior is defined by the function <code>prob.failure</code>.
It calculates the probability of a pipe failing within the next year based on pipe age,
pipe age at the last failure, and the number of failures. Note, the model
makes the assumption that a pipe cannot fail more than once per year.
</p>
<p>The costs are calculated as a function of the pipe diameter, assuming all pipes have a
length of 100 meters.
</p>


<h3>Value</h3>

<p>an updated state list
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>


<h3>See Also</h3>

<p>For more fine-grained control see <code><a href="#topic+initiate.network">initiate.network</a></code>
and <code><a href="#topic+simulate_network.period">simulate_network.period</a></code>. Different replacement strategies
are implemented: <code><a href="#topic+replace.n.highest.risk">replace.n.highest.risk</a></code>,
<code><a href="#topic+replace.n.oldest">replace.n.oldest</a></code>, <code><a href="#topic+replace.n.random">replace.n.random</a></code>, <code><a href="#topic+replace.older.than">replace.older.than</a></code>,
<code><a href="#topic+replace.more.failures.than">replace.more.failures.than</a></code>, <code><a href="#topic+do.nothing">do.nothing</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## -----------
## define model parameters

## Define the annual probability of a failure
prob.failure.exp &lt;- function(age, age.last.failure, n.failure) {
  if(n.failure==0){
    return(1/30)
  } else {
    return(1/10)
  }
}

## define a complicated (and probably useless) rehabilitation strategy
mystrategy &lt;- . %&gt;%
  replace.n.highest.risk(n=2, prob.failure=prob.failure.exp) %&gt;%
  replace.more.failures.than(failures=5) %&gt;%
  replace.older.than(age=70, max.cost=2e6)  %&gt;%
  replace.n.oldest(n=3) %&gt;%
  replace.n.random(n=2)
## This means: every year (if we have enough budget!), replace first the 2 pipes
## with the highest risk, then all pipes with more than 5 failures,
## then all pipes older then 70 years (up to costs of 2e6), then the 3
## oldest pipes remaining, and finally replace 2 randomly selected pipes. 


## -----------
## run the simulation

result &lt;- simulate_network(

    n.years = 100,                   # run it for 100 years
    expansion = 10,                  # build 10 pipes per year (if money is available)
    rehabilitation = mystrategy,     # use the strategy defined above
    prob.failure = prob.failure.exp, # use the probability function defined above
    income = 1e6,                    # the annual income
    initial.budget = 1e7,   
    initial.inventory = 50,          # start the simulation with 50 new pipes
    free.expansion = FALSE
     
     )          

## look at some results
## str(result)
## str(result$time.100)

</code></pre>

<hr>
<h2 id='simulate_network.period'>Simulate the network for a period of time</h2><span id='topic+simulate_network.period'></span>

<h3>Description</h3>

<p>Simulates failures, expansion, rehabilitation, and costs of a water supply pipe network.
The simulation is stochastic.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate_network.period(statelist, n.years, expansion, rehabilitation,
  prob.failure, income = 0, free.expansion = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simulate_network.period_+3A_statelist">statelist</code></td>
<td>
<p>a state list</p>
</td></tr>
<tr><td><code id="simulate_network.period_+3A_n.years">n.years</code></td>
<td>
<p>number of years to simulate</p>
</td></tr>
<tr><td><code id="simulate_network.period_+3A_expansion">expansion</code></td>
<td>
<p>either a scalar describing the number of pipes added
every year to expand the pipe network, or a vector of length <code>n.years</code>.
Negative values are not allowed.</p>
</td></tr>
<tr><td><code id="simulate_network.period_+3A_rehabilitation">rehabilitation</code></td>
<td>
<p>a (combination of) rehabilitation strategy function(s). See details below.</p>
</td></tr>
<tr><td><code id="simulate_network.period_+3A_prob.failure">prob.failure</code></td>
<td>
<p>a function describing the probability of a pipe failing in the next year
given its age, number of previous failures, and the age at the last failure (if any).</p>
</td></tr>
<tr><td><code id="simulate_network.period_+3A_income">income</code></td>
<td>
<p>either a scalar describing the annual income, or a vector of length <code>n.years</code>.</p>
</td></tr>
<tr><td><code id="simulate_network.period_+3A_free.expansion">free.expansion</code></td>
<td>
<p>if <code>TRUE</code> costs for network expansion are not deducted from the budget.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The rehabilitation is defined by combining different simple replacement strategies.
See the example for how this can be done using the <code>mystrategy</code> function input.
</p>
<p>The failure behavior is defined by the function <code>prob.failure</code>.
It calculates the probability of a pipe failing within the next year based on pipe age,
pipe age at the last failure, and the number of failures. Note, the model
makes the assumption that a pipe cannot fail more than once per year.
</p>
<p>The costs are calculated as a function of the pipe diameter, assuming all pipes have a
length of 100 meters.
</p>


<h3>Value</h3>

<p>an updated state list
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>


<h3>See Also</h3>

<p><code><a href="#topic+simulate_network">simulate_network</a></code> provides a slightly more convenient interface.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## -----------
## define model parameters

## Define the annual probability of a failure
prob.failure.exp &lt;- function(age, age.last.failure, n.failure) {
  if(n.failure==0){
    return(1/30)
  } else {
    return(1/10)
  }
}

## define a complicated (and probably useless) rehabilitation strategy
mystrategy &lt;- . %&gt;%
  replace.n.highest.risk(n=2, prob.failure=prob.failure.exp) %&gt;%
  replace.more.failures.than(failures=5) %&gt;%
  replace.older.than(age=70, max.cost=2e6)  %&gt;%
  replace.n.oldest(n=3) %&gt;%
  replace.n.random(n=2)
## This means: every year (if we have enough budget!), replace first the 2 pipes
## with the highest risk, then all pipes with more than 5 failures,
## then all pipes older then 70 years (up to costs of 2e6), then the 3
## oldest pipes remaining, and finally replace 2 randomly selected pipes. 


## -----------
## run the simulation in steps

statelist &lt;- initiate.network(inventory = 50, budget = 1e7)

statelist &lt;- simulate_network.period(

   statelist,                       # state list to update
   n.years = 20,                    # run it for 20 years
   expansion = 10,                  # build 10 pipes per year (if money is available)
   rehabilitation = mystrategy,     # use the strategy defined above
   prob.failure = prob.failure.exp, # use the probability function defined above
   income = 1e6                     # the annual income
                 
   )                    

statelist &lt;- simulate_network.period(
   
   statelist,                       # state list to update
   n.years = 10,                    # run it for 10 more years
   expansion = 2,                   # now, build only 2 pipes per year (if money is available)
   rehabilitation = mystrategy,     # use the strategy defined above
   prob.failure = prob.failure.exp, # use the probability function defined above
   income = 1e6                     # the annual income
                 
   )     


## look at some results
## str(statelist)
## str(statelist$time.30)

</code></pre>

<hr>
<h2 id='WaMaSim'>WaMaSim - Water Management Simulator</h2><span id='topic+WaMaSim'></span><span id='topic+WaMaSim-package'></span>

<h3>Description</h3>

<p>WaMaSim is a package that simulates the effect of different
rehabilitation strategies for water distribution systems. It is an education tool
used for the Water Infrastructure Experimental and Computer Laboratory at ETH Zurich, Switzerland.
See the documentation for <code><a href="#topic+simulate_network">simulate_network</a></code> to get started.
</p>


<h3>Author(s)</h3>

<p>Andreas Scheidegger
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
