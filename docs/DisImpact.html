<!DOCTYPE html><html lang="en"><head><title>Help for package DisImpact</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {DisImpact}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#di_80_index'><p>Calculate disproportionate impact per the 80% index</p></a></li>
<li><a href='#di_calc_dt'><p>Calculates disproportionate impact using multiple methods for data stored in a data.table object.</p></a></li>
<li><a href='#di_calc_sql'><p>Generate SQL code that calculates disproportionate impact using multiple methods for a specified table.</p></a></li>
<li><a href='#di_iterate'><p>Iteratively calculate disproportionate impact using multiple method for many variables.</p></a></li>
<li><a href='#di_iterate_dt'><p>Iteratively calculate disproportionate impact using multiple method for many variables, using data.table and collapse.</p></a></li>
<li><a href='#di_iterate_on_long'><p>Iteratively calculate disproportionate impact using multiple methods for a long and summarized data set</p></a></li>
<li><a href='#di_iterate_sql'><p>Iteratively calculate disproportionate impact using multiple methods for many variables, using SQL.</p></a></li>
<li><a href='#di_ppg'><p>Calculate disproportionate impact per the percentage point gap (PPG) method.</p></a></li>
<li><a href='#di_ppg_iterate'><p>Iteratively calculate disproportionate impact via the percentage point gap (PPG) method for many variables.</p></a></li>
<li><a href='#di_prop_index'><p>Calculate disproportionate impact per the proportionality index (PI) method.</p></a></li>
<li><a href='#ppg_moe'><p>Margin of error for the PPG</p></a></li>
<li><a href='#ssm_cohort'><p>Long summarized disaggregated data set</p></a></li>
<li><a href='#student_equity'><p>Fake data on student equity</p></a></li>
<li><a href='#surround_quote_if_needed'><p>Helper function: Surround character values with double quotes if not present.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Calculates Disproportionate Impact When Binary Success Data are
Disaggregated by Subgroups</td>
</tr>
<tr>
<td>Version:</td>
<td>0.0.21</td>
</tr>
<tr>
<td>Description:</td>
<td>Implements methods for calculating disproportionate impact: the percentage point gap, proportionality index, and the 80% index.
 California Community Colleges Chancellor's Office (2017).  Percentage Point Gap Method. <a href="https://www.cccco.edu/-/media/CCCCO-Website/About-Us/Divisions/Digital-Innovation-and-Infrastructure/Research/Files/PercentagePointGapMethod2017.ashx">https://www.cccco.edu/-/media/CCCCO-Website/About-Us/Divisions/Digital-Innovation-and-Infrastructure/Research/Files/PercentagePointGapMethod2017.ashx</a>.
 California Community Colleges Chancellor's Office (2014).  Guidelines for Measuring Disproportionate Impact in Equity Plans. <a href="https://www.cccco.edu/-/media/CCCCO-Website/Files/DII/guidelines-for-measuring-disproportionate-impact-in-equity-plans-tfa-ada.pdf">https://www.cccco.edu/-/media/CCCCO-Website/Files/DII/guidelines-for-measuring-disproportionate-impact-in-equity-plans-tfa-ada.pdf</a>.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.4.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr (&ge; 0.8.5), rlang, tidyselect, purrr, tidyr, parallel,
fst, DBI, duckdb (&ge; 0.5.0), glue, stringr, data.table (&ge;
1.14.2), collapse, sets</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/vinhdizzo/DisImpact">https://github.com/vinhdizzo/DisImpact</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/vinhdizzo/DisImpact/issues">https://github.com/vinhdizzo/DisImpact/issues</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, markdown, prettydoc, ggplot2, forcats,
scales, tinytest</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-10-10 17:26:29 UTC; vnguyen216</td>
</tr>
<tr>
<td>Author:</td>
<td>Vinh Nguyen [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Vinh Nguyen &lt;nguyenvq714@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-10-10 18:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='di_80_index'>Calculate disproportionate impact per the 80% index</h2><span id='topic+di_80_index'></span>

<h3>Description</h3>

<p>Calculate disproportionate impact per the 80% index method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>di_80_index(
  success,
  group,
  cohort,
  weight,
  data,
  di_80_index_cutoff = 0.8,
  reference_group = "hpg",
  check_valid_reference = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="di_80_index_+3A_success">success</code></td>
<td>
<p>A vector of success indicators (<code>1</code>/<code>0</code> or <code>TRUE</code>/<code>FALSE</code>) or an unquoted reference (name) to a column in <code>data</code> if it is specified.  It could also be a vector of counts, in which case <code>weight</code> should also be specified (group size).</p>
</td></tr>
<tr><td><code id="di_80_index_+3A_group">group</code></td>
<td>
<p>A vector of group names of the same length as <code>success</code> or an unquoted reference (name) to a column in <code>data</code> if it is specified.</p>
</td></tr>
<tr><td><code id="di_80_index_+3A_cohort">cohort</code></td>
<td>
<p>(Optional) A vector of cohort names of the same length as <code>success</code> or an unquoted reference (name) to a column in <code>data</code> if it is specified.  disproportionate impact is calculated for every group within each cohort.  When <code>cohort</code> is not specified, then the analysis assumes a single cohort.</p>
</td></tr>
<tr><td><code id="di_80_index_+3A_weight">weight</code></td>
<td>
<p>(Optional) A vector of case weights of the same length as <code>success</code> or an unquoted reference (name) to a column in <code>data</code> if it is specified.  If <code>success</code> consists of counts instead of success indicators (1/0), then <code>weight</code> should also be specified to indicate the group size.</p>
</td></tr>
<tr><td><code id="di_80_index_+3A_data">data</code></td>
<td>
<p>(Optional) A data frame containing the variables of interest.  If <code>data</code> is specified, then <code>success</code>, <code>group</code>, and <code>cohort</code> will be searched within it.</p>
</td></tr>
<tr><td><code id="di_80_index_+3A_di_80_index_cutoff">di_80_index_cutoff</code></td>
<td>
<p>A numeric value between 0 and 1 that is used to determine disproportionate impact if the index comparing the success rate of the current group to the reference group falls below this threshold; defaults to 0.80.</p>
</td></tr>
<tr><td><code id="di_80_index_+3A_reference_group">reference_group</code></td>
<td>
<p>The reference group value in <code>group</code> that each group should be compared to in order to determine disproportionate impact.  By default (<code>='hpg'</code>), the group with the highest success rate is used as reference.  The user could also specify a value of <code>'overall'</code> to use the overall rate as the reference for comparison, or <code>'all but current'</code> to use the combined success rate of all other groups excluding the current group for each comparison.</p>
</td></tr>
<tr><td><code id="di_80_index_+3A_check_valid_reference">check_valid_reference</code></td>
<td>
<p>Check whether <code>reference_group</code> is a valid value; defaults to <code>TRUE</code>.  This argument exists to be used in <a href="#topic+di_iterate">di_iterate</a> as when iterating DI calculations, there may be some scenarios where a specified reference group does not contain any students.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function determines disproportionate impact based on the 80% index method, as described in <a href="https://www.cccco.edu/-/media/CCCCO-Website/Files/DII/guidelines-for-measuring-disproportionate-impact-in-equity-plans-tfa-ada.pdf">this</a> reference from the California Community Colleges Chancellor's Office.  It assumes that a higher rate is good (&quot;success&quot;).  For rates that are deemed negative (eg, rate of drop-outs, high is bad), then consider looking at the converse of the non-success (eg, non drop-outs, high is good) instead in order to leverage this function properly.
</p>


<h3>Value</h3>

<p>A data frame consisting of:
</p>

<ul>
<li> <p><code>cohort</code> (if used),
</p>
</li>
<li> <p><code>group</code>,
</p>
</li>
<li> <p><code>n</code> (sample size),
</p>
</li>
<li> <p><code>success</code> (number of successes for the cohort-group),
</p>
</li>
<li> <p><code>pct</code> (proportion of successes for the cohort-group),
</p>
</li>
<li> <p><code>reference_group</code> (the reference group used to compare and determine disproportionate impact),
</p>
</li>
<li> <p><code>reference</code> (the reference rate used for comparison, corresponding to reference_group),
</p>
</li>
<li> <p><code>di_80_index</code> (ratio of pct to the reference),
</p>
</li>
<li> <p><code>di_indicator</code> (1 if <code>di_80_index &lt; di_80_index_cutoff</code>),
</p>
</li>
<li> <p><code>success_needed_not_di</code> (the number of additional successes needed in order to no longer be considered disproportionately impacted as compared to the reference), and
</p>
</li>
<li> <p><code>success_needed_full_parity</code> (the number of additional successes needed in order to achieve full parity with the reference).
</p>
</li></ul>



<h3>References</h3>

<p>California Community Colleges Chancellor's Office (2014).  <a href="https://www.cccco.edu/-/media/CCCCO-Website/About-Us/Divisions/Digital-Innovation-and-Infrastructure/Network-Operations/Accountability/Files/GUIDELINES-FOR-MEASURING-DISPROPORTIONATE-IMPACT-IN-EQUITY-PLANS.ashx">Guidelines for Measuring Disproportionate Impact in Equity Plans</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
data(student_equity)
di_80_index(success=Transfer, group=Ethnicity, data=student_equity) %&gt;%
  as.data.frame
</code></pre>

<hr>
<h2 id='di_calc_dt'>Calculates disproportionate impact using multiple methods for data stored in a <a href="data.table.html#topic+data.table">data.table</a> object.</h2><span id='topic+di_calc_dt'></span>

<h3>Description</h3>

<p>Calculate disproportionate impact via the percentage point gap (PPG), proportionality index, and 80% index methods for data stored in a <a href="data.table.html#topic+data.table">data.table</a> object.  This is the workhorse function leveraged by the <a href="#topic+di_iterate_dt">di_iterate_dt</a> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>di_calc_dt(
  dt,
  success_var,
  group_var,
  cohort_var = "",
  weight_var = NULL,
  ppg_reference_group = "overall",
  min_moe = 0.03,
  use_prop_in_moe = FALSE,
  prop_sub_0 = 0.5,
  prop_sub_1 = 0.5,
  di_prop_index_cutoff = 0.8,
  di_80_index_cutoff = 0.8,
  di_80_index_reference_group = "hpg",
  filter_subset = ""
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="di_calc_dt_+3A_dt">dt</code></td>
<td>
<p>A data frame of class <a href="data.table.html#topic+data.table">data.table</a>.  If the object is not a data table, one could surround the object with <a href="data.table.html#topic+as.data.table">as.data.table</a>.</p>
</td></tr>
<tr><td><code id="di_calc_dt_+3A_success_var">success_var</code></td>
<td>
<p>A character value specifying the success variable name.</p>
</td></tr>
<tr><td><code id="di_calc_dt_+3A_group_var">group_var</code></td>
<td>
<p>A character value specifying the group (disaggregation) variable name.</p>
</td></tr>
<tr><td><code id="di_calc_dt_+3A_cohort_var">cohort_var</code></td>
<td>
<p>(Optional) A character value specifying the cohort variable.  If not specified, then a single cohort is assumed (defaults to an empty string, <code>''</code>).</p>
</td></tr>
<tr><td><code id="di_calc_dt_+3A_weight_var">weight_var</code></td>
<td>
<p>(Optional) A character variable specifying the weight variable if the input data set is summarized (i.e.,  the the success variables specified in <code>success_vars</code> contain count of successes).  Weight here corresponds to the denominator when calculating the success rate.  Defaults to <code>NULL</code> for an input data set where each row describes an individual.</p>
</td></tr>
<tr><td><code id="di_calc_dt_+3A_ppg_reference_group">ppg_reference_group</code></td>
<td>
<p>Either <code>'overall'</code>, <code>'hpg'</code>, <code>'all but current'</code>, or a character value specifying a group from <code>group_var</code> to be used as the reference group for comparison using percentage point gap method.</p>
</td></tr>
<tr><td><code id="di_calc_dt_+3A_min_moe">min_moe</code></td>
<td>
<p>The minimum margin of error to be used in the PPG calculation; see <a href="#topic+di_ppg">di_ppg</a>.</p>
</td></tr>
<tr><td><code id="di_calc_dt_+3A_use_prop_in_moe">use_prop_in_moe</code></td>
<td>
<p>(<code>TRUE</code> or <code>FALSE</code>) Whether the estimated proportions should be used in the margin of error calculation by the PPG; see <a href="#topic+di_ppg">di_ppg</a>.</p>
</td></tr>
<tr><td><code id="di_calc_dt_+3A_prop_sub_0">prop_sub_0</code></td>
<td>
<p>Default is 0.50; see <a href="#topic+di_ppg">di_ppg</a>.</p>
</td></tr>
<tr><td><code id="di_calc_dt_+3A_prop_sub_1">prop_sub_1</code></td>
<td>
<p>Default is 0.50; see <a href="#topic+di_ppg">di_ppg</a>.</p>
</td></tr>
<tr><td><code id="di_calc_dt_+3A_di_prop_index_cutoff">di_prop_index_cutoff</code></td>
<td>
<p>Threshold used for determining disproportionate impact using the proportionality index; see <a href="#topic+di_prop_index">di_prop_index</a>; defaults to 0.80.</p>
</td></tr>
<tr><td><code id="di_calc_dt_+3A_di_80_index_cutoff">di_80_index_cutoff</code></td>
<td>
<p>Threshold used for determining disproportionate impact using the 80% index; see <a href="#topic+di_80_index">di_80_index</a>; defaults to 0.80.</p>
</td></tr>
<tr><td><code id="di_calc_dt_+3A_di_80_index_reference_group">di_80_index_reference_group</code></td>
<td>
<p>Either <code>'overall'</code>, <code>'hpg'</code>, <code>'all but current'</code>, or a character value specifying a group from <code>group_var</code> to be used as the reference group for comparison using 80% index.</p>
</td></tr>
<tr><td><code id="di_calc_dt_+3A_filter_subset">filter_subset</code></td>
<td>
<p>A character value such as <code>"Ethnicity == 'White' &amp; Gender == 'M'"</code> used in the <code>i</code> argument (filtering rows via <code>dt[i, j, by]</code>) to filter data in <code>dt</code>.  The character value is parsed using <code>eval(parse(text=filter_subset))</code>.  Defaults to <code>''</code> for no filtering.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <a href="data.table.html#topic+data.table">data.table</a> object with summarized results.
</p>

<hr>
<h2 id='di_calc_sql'>Generate SQL code that calculates disproportionate impact using multiple methods for a specified table.</h2><span id='topic+di_calc_sql'></span>

<h3>Description</h3>

<p>Generate SQL code that calculates disproportionate impact via the percentage point gap (PPG), proportionality index, and 80% index methods for a specified table name, success variable, group variable, and cohort variable.  This is the workhorse function leveraged by the <a href="#topic+di_iterate_sql">di_iterate_sql</a> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>di_calc_sql(
  db_table_name,
  success_var,
  group_var,
  cohort_var = "",
  weight_var = 1,
  ppg_reference_group = "overall",
  min_moe = 0.03,
  use_prop_in_moe = FALSE,
  prop_sub_0 = 0.5,
  prop_sub_1 = 0.5,
  di_prop_index_cutoff = 0.8,
  di_80_index_cutoff = 0.8,
  di_80_index_reference_group = "hpg",
  before_with_statement = "",
  after_with_statement = "",
  end_of_select_statement = "",
  where_statement = "",
  select_statement_add = ""
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="di_calc_sql_+3A_db_table_name">db_table_name</code></td>
<td>
<p>A character value specifying a database table name.</p>
</td></tr>
<tr><td><code id="di_calc_sql_+3A_success_var">success_var</code></td>
<td>
<p>A character value specifying the success variable name.</p>
</td></tr>
<tr><td><code id="di_calc_sql_+3A_group_var">group_var</code></td>
<td>
<p>A character value specifying the group (disaggregation) variable name.</p>
</td></tr>
<tr><td><code id="di_calc_sql_+3A_cohort_var">cohort_var</code></td>
<td>
<p>(Optional) A character value specifying the cohort variable.  If not specified, then a single cohort is assumed (defaults to an empty string, <code>''</code>).</p>
</td></tr>
<tr><td><code id="di_calc_sql_+3A_weight_var">weight_var</code></td>
<td>
<p>(Optional) A character variable specifying the weight variable if the input data set is summarized (i.e.,  the the success variables specified in <code>success_vars</code> contain count of successes).  Weight here corresponds to the denominator when calculating the success rate.  Defaults to a numeric <code>1</code> which treats each row as an individual.</p>
</td></tr>
<tr><td><code id="di_calc_sql_+3A_ppg_reference_group">ppg_reference_group</code></td>
<td>
<p>Either <code>'overall'</code>, <code>'hpg'</code>, <code>'all but current'</code>, or a character value specifying a group from <code>group_var</code> to be used as the reference group for comparison using the percentage point gap method.</p>
</td></tr>
<tr><td><code id="di_calc_sql_+3A_min_moe">min_moe</code></td>
<td>
<p>The minimum margin of error to be used in the PPG calculation; see <a href="#topic+di_ppg">di_ppg</a>.</p>
</td></tr>
<tr><td><code id="di_calc_sql_+3A_use_prop_in_moe">use_prop_in_moe</code></td>
<td>
<p>(<code>TRUE</code> or <code>FALSE</code>) Whether the estimated proportions should be used in the margin of error calculation by the PPG; see <a href="#topic+di_ppg">di_ppg</a>.</p>
</td></tr>
<tr><td><code id="di_calc_sql_+3A_prop_sub_0">prop_sub_0</code></td>
<td>
<p>Default is 0.50; see <a href="#topic+di_ppg">di_ppg</a>.</p>
</td></tr>
<tr><td><code id="di_calc_sql_+3A_prop_sub_1">prop_sub_1</code></td>
<td>
<p>Default is 0.50; see <a href="#topic+di_ppg">di_ppg</a>.</p>
</td></tr>
<tr><td><code id="di_calc_sql_+3A_di_prop_index_cutoff">di_prop_index_cutoff</code></td>
<td>
<p>Threshold used for determining disproportionate impact using the proportionality index; see <a href="#topic+di_prop_index">di_prop_index</a>; defaults to 0.80.</p>
</td></tr>
<tr><td><code id="di_calc_sql_+3A_di_80_index_cutoff">di_80_index_cutoff</code></td>
<td>
<p>Threshold used for determining disproportionate impact using the 80% index; see <a href="#topic+di_80_index">di_80_index</a>; defaults to 0.80.</p>
</td></tr>
<tr><td><code id="di_calc_sql_+3A_di_80_index_reference_group">di_80_index_reference_group</code></td>
<td>
<p>Either <code>'overall'</code>, <code>'hpg'</code>, <code>'all but current'</code>, or a character value specifying a group from <code>group_var</code> to be used as the reference group for comparison using 80% index.</p>
</td></tr>
<tr><td><code id="di_calc_sql_+3A_before_with_statement">before_with_statement</code></td>
<td>
<p>Character value to be added to the SQL query to allow for modification.  Defaults to <code>''</code> (empty string).</p>
</td></tr>
<tr><td><code id="di_calc_sql_+3A_after_with_statement">after_with_statement</code></td>
<td>
<p>Character value to be added to the SQL query to allow for modification.  Defaults to <code>''</code> (empty string).</p>
</td></tr>
<tr><td><code id="di_calc_sql_+3A_end_of_select_statement">end_of_select_statement</code></td>
<td>
<p>Character value to be added to the SQL query to allow for modification.  Defaults to <code>''</code> (empty string).</p>
</td></tr>
<tr><td><code id="di_calc_sql_+3A_where_statement">where_statement</code></td>
<td>
<p>Character value to be added to the SQL query to allow for modification.  Defaults to <code>''</code> (empty string).</p>
</td></tr>
<tr><td><code id="di_calc_sql_+3A_select_statement_add">select_statement_add</code></td>
<td>
<p>Character value to be added to the SQL query to allow for modification.  Defaults to <code>''</code> (empty string).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character value (SQL query) that could be executed on a database.
</p>

<hr>
<h2 id='di_iterate'>Iteratively calculate disproportionate impact using multiple method for many variables.</h2><span id='topic+di_iterate'></span>

<h3>Description</h3>

<p>Iteratively calculate disproportionate impact via the percentage point gap (PPG), proportionality index, and 80% index methods for many success variables, disaggregation variables, and scenarios.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>di_iterate(
  data,
  success_vars,
  group_vars,
  cohort_vars = NULL,
  scenario_repeat_by_vars = NULL,
  exclude_scenario_df = NULL,
  weight_var = NULL,
  include_non_disagg_results = TRUE,
  ppg_reference_groups = "overall",
  min_moe = 0.03,
  use_prop_in_moe = FALSE,
  prop_sub_0 = 0.5,
  prop_sub_1 = 0.5,
  di_prop_index_cutoff = 0.8,
  di_80_index_cutoff = 0.8,
  di_80_index_reference_groups = "hpg",
  check_valid_reference = TRUE,
  parallel = FALSE,
  parallel_n_cores = parallel::detectCores(),
  parallel_split_to_disk = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="di_iterate_+3A_data">data</code></td>
<td>
<p>A data frame for which to iterate DI calculations for a set of variables.</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_success_vars">success_vars</code></td>
<td>
<p>A character vector of success variable names to iterate across.</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_group_vars">group_vars</code></td>
<td>
<p>A character vector of group (disaggregation) variable names to iterate across.</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_cohort_vars">cohort_vars</code></td>
<td>
<p>(Optional) A character vector of the same length as <code>success_vars</code> to indicate the cohort variable to be used for each variable specified in <code>success_vars</code>.  A vector of length 1 could be specified, in which case the same cohort variable is used for each success variable.  If not specified, then a single cohort is assumed for all success variables.</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_scenario_repeat_by_vars">scenario_repeat_by_vars</code></td>
<td>
<p>(Optional) A character vector of variables to repeat DI calculations for across all combination of these variables.  For example, the following variables could be specified:
</p>

<ul>
<li><p> Ed Goal: Degree/Transfer, Shot-term Career, Non-credit
</p>
</li>
<li><p> First time college student: Yes, No
</p>
</li>
<li><p> Full-time status: Yes, No
</p>
</li></ul>

<p>Each combination of these variables (eg, full time, first time college students with an ed goal of degree/transfer as one combination) would constitute an iteration / sample for which to calculate disproportionate impact for outcomes listed in <code>success_vars</code> and for the disaggregation variables listed in <code>group_vars</code>. The overall rate of success for full time, first time college students with an ed goal of degree/transfer would just include these students and not others.  Each variable specified is also collapsed to an '- All' group so that the combinations also reflect all students of a particular category.  The total number of combinations for the previous example would be (+1 representing the all category): (3 + 1) x (2 + 1) x (2 + 1) = 36.</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_exclude_scenario_df">exclude_scenario_df</code></td>
<td>
<p>(Optional) A data frame with variables that match <code>scenario_repeat_by_vars</code> for specifying the combinations to exclude from DI calculations.  Following the example specified above, one could choose to exclude part-time non-credit students from consideration.</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_weight_var">weight_var</code></td>
<td>
<p>(Optional) A character variable specifying the weight variable if the input data set is summarized (i.e.,  the the success variables specified in <code>success_vars</code> contain count of successes).  Weight here corresponds to the denominator when calculating the success rate.  Defaults to <code>NULL</code> for an input data set where each row describes each individual.</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_include_non_disagg_results">include_non_disagg_results</code></td>
<td>
<p>A logical variable specifying whether or not the non-disaggregated results should be returned; defaults to <code>TRUE</code>.  When <code>TRUE</code>, a new variable <code>`- None`</code> is added to the data set with a single data value <code>'- All'</code>, and this variable is added <code>group_vars</code> as a disaggregation/group variable.  The user would want these results returned to review non-disaggregated results.</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_ppg_reference_groups">ppg_reference_groups</code></td>
<td>
<p>Either <code>'overall'</code>, <code>'hpg'</code>, <code>'all but current'</code>, or a character vector of the same length as <code>group_vars</code> that indicates the reference group value for each group variable in <code>group_vars</code> when determining disproportionate impact using the percentage point gap method.</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_min_moe">min_moe</code></td>
<td>
<p>The minimum margin of error to be used in the PPG calculation, passed to <a href="#topic+di_ppg">di_ppg</a>.</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_use_prop_in_moe">use_prop_in_moe</code></td>
<td>
<p>Whether the estimated proportions should be used in the margin of error calculation by the PPG, passed to <a href="#topic+di_ppg">di_ppg</a>.</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_prop_sub_0">prop_sub_0</code></td>
<td>
<p>passed to <a href="#topic+di_ppg">di_ppg</a>; defaults to 0.50.</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_prop_sub_1">prop_sub_1</code></td>
<td>
<p>passed to <a href="#topic+di_ppg">di_ppg</a>; defaults to 0.50.</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_di_prop_index_cutoff">di_prop_index_cutoff</code></td>
<td>
<p>Threshold used for determining disproportionate impact using the proportionality index; passed to <a href="#topic+di_prop_index">di_prop_index</a>; defaults to 0.80.</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_di_80_index_cutoff">di_80_index_cutoff</code></td>
<td>
<p>Threshold used for determining disproportionate impact using the 80% index; passed to <a href="#topic+di_80_index">di_80_index</a>; defaults to 0.80.</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_di_80_index_reference_groups">di_80_index_reference_groups</code></td>
<td>
<p>Either <code>'overall'</code>, <code>'hpg'</code>, <code>'all but current'</code>, or a character vector of the same length as <code>group_vars</code> that indicates the reference group value for each group variable in <code>group_vars</code> when determining disproportionate impact using the 80% index.</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_check_valid_reference">check_valid_reference</code></td>
<td>
<p>Check whether <code>ppg_reference_groups</code> and <code>di_80_index_reference_groups</code> contain valid values; defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_parallel">parallel</code></td>
<td>
<p>If <code>TRUE</code>, then perform calculations in parallel based on the scenarios specified by <code>scenario_repeat_by_vars</code>.  Defaults to <code>FALSE</code>.  Parallel execution is based on the <code>parallel</code> package included in base R, using <a href="parallel.html#topic+parLapply">parLapply</a> on Windows and <a href="parallel.html#topic+mclapply">mclapply</a> on POSIX-based systems (Linux/Mac).</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_parallel_n_cores">parallel_n_cores</code></td>
<td>
<p>The number of CPU cores to use if <code>parallel=TRUE</code>.  Defaults to the maximum number CPU cores on the system.</p>
</td></tr>
<tr><td><code id="di_iterate_+3A_parallel_split_to_disk">parallel_split_to_disk</code></td>
<td>
<p>If <code>TRUE</code> and <code>parallel=TRUE</code>, then create intermediate data sets for each scenario generated by <code>scenario_repeat_by_vars</code>, write them to disk, and import the required data set when necessary for each scenario executing in parallel.  This feature is useful when the data set specified by <code>data</code> is very large and parallel execution is desired for speed in order to reduce the likelihood of consuming all the system's memory and crashing.  Note that there is an overhead I/O cost on speed when this feature is used.  Defaults to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Iteratively calculate disproportionate impact via the percentage point gap (PPG), proportionality index, and 80% index methods for all combinations of <code>success_vars</code>, <code>group_vars</code>, and <code>cohort_vars</code>, for each combination of subgroups specified by <code>scenario_repeat_by_vars</code>.
</p>


<h3>Value</h3>

<p>A summarized data set (data frame) consisting of:
</p>

<ul>
<li> <p><code>success_variable</code> (elements of <code>success_vars</code>),
</p>
</li>
<li> <p><code>disaggregation</code> (elements of <code>group_vars</code>),
</p>
</li>
<li> <p><code>cohort</code> (values corresponding to the variables specified in <code>cohort_vars</code>,
</p>
</li>
<li> <p><code>di_indicator_ppg</code> (1 if there is disproportionate impact per the percentage point gap method, 0 otherwise),
</p>
</li>
<li> <p><code>di_indicator_prop_index</code> (1 if there is disproportionate impact per the proportionality index, 0 otherwise),
</p>
</li>
<li> <p><code>di_indicator_80_index</code> (1 if there is disproportionate impact per the 80% index, 0 otherwise), and
</p>
</li>
<li><p> other relevant fields returned from <a href="#topic+di_ppg">di_ppg</a>, <a href="#topic+di_prop_index">di_prop_index</a>,  and <a href="#topic+di_80_index">di_80_index</a>.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
data(student_equity)
# Multiple group variables
di_iterate(data=student_equity, success_vars=c('Transfer')
  , group_vars=c('Ethnicity', 'Gender'), cohort_vars=c('Cohort')
  , ppg_reference_groups='overall')
</code></pre>

<hr>
<h2 id='di_iterate_dt'>Iteratively calculate disproportionate impact using multiple method for many variables, using <a href="data.table.html#topic+data.table">data.table</a> and <a href="collapse.html#topic+collapse">collapse</a>.</h2><span id='topic+di_iterate_dt'></span>

<h3>Description</h3>

<p>Iteratively calculate disproportionate impact via the percentage point gap (PPG), proportionality index, and 80% index methods for many success variables, disaggregation variables, and scenarios, using <a href="data.table.html#topic+data.table">data.table</a> and <a href="collapse.html#topic+collapse">collapse</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>di_iterate_dt(
  dt,
  success_vars,
  group_vars,
  cohort_vars = NULL,
  scenario_repeat_by_vars = NULL,
  exclude_scenario_df = NULL,
  weight_var = NULL,
  include_non_disagg_results = TRUE,
  ppg_reference_groups = "overall",
  min_moe = 0.03,
  use_prop_in_moe = FALSE,
  prop_sub_0 = 0.5,
  prop_sub_1 = 0.5,
  di_prop_index_cutoff = 0.8,
  di_80_index_cutoff = 0.8,
  di_80_index_reference_groups = "hpg",
  check_valid_reference = TRUE,
  parallel = FALSE,
  parallel_n_cores = parallel::detectCores()/2
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="di_iterate_dt_+3A_dt">dt</code></td>
<td>
<p>A data frame of class <a href="data.table.html#topic+data.table">data.table</a>.  If the object is not a data table, one could surround the object with <a href="data.table.html#topic+as.data.table">as.data.table</a>.</p>
</td></tr>
<tr><td><code id="di_iterate_dt_+3A_success_vars">success_vars</code></td>
<td>
<p>A character vector of success variable names to iterate across.</p>
</td></tr>
<tr><td><code id="di_iterate_dt_+3A_group_vars">group_vars</code></td>
<td>
<p>A character vector of group (disaggregation) variable names to iterate across.</p>
</td></tr>
<tr><td><code id="di_iterate_dt_+3A_cohort_vars">cohort_vars</code></td>
<td>
<p>(Optional) A character vector of the same length as <code>success_vars</code> to indicate the cohort variable to be used for each variable specified in <code>success_vars</code>.  A vector of length 1 could be specified, in which case the same cohort variable is used for each success variable.  If not specified, then a single cohort is assumed for all success variables (defaults to <code>NULL</code>).</p>
</td></tr>
<tr><td><code id="di_iterate_dt_+3A_scenario_repeat_by_vars">scenario_repeat_by_vars</code></td>
<td>
<p>(Optional) A character vector of variables to repeat DI calculations for across all combination of these variables.  For example, the following variables could be specified:
</p>

<ul>
<li><p> Ed Goal: Degree/Transfer, Shot-term Career, Non-credit
</p>
</li>
<li><p> First time college student: Yes, No
</p>
</li>
<li><p> Full-time status: Yes, No
</p>
</li></ul>

<p>Each combination of these variables (eg, full time, first time college students with an ed goal of degree/transfer as one combination) would constitute an iteration / sample for which to calculate disproportionate impact for outcomes listed in <code>success_vars</code> and for the disaggregation variables listed in <code>group_vars</code>. The overall rate of success for full time, first time college students with an ed goal of degree/transfer would just include these students and not others.  Each variable specified is also collapsed to an '- All' group so that the combinations also reflect all students of a particular category.  The total number of combinations for the previous example would be (+1 representing the all category): (3 + 1) x (2 + 1) x (2 + 1) = 36.</p>
</td></tr>
<tr><td><code id="di_iterate_dt_+3A_exclude_scenario_df">exclude_scenario_df</code></td>
<td>
<p>(Optional) A data frame with variables that match <code>scenario_repeat_by_vars</code> for specifying the combinations to exclude from DI calculations.  Following the example specified above, one could choose to exclude part-time non-credit students from consideration.</p>
</td></tr>
<tr><td><code id="di_iterate_dt_+3A_weight_var">weight_var</code></td>
<td>
<p>(Optional) A character variable specifying the weight variable if the input data set is summarized (i.e., the the success variables specified in <code>success_vars</code> contain count of successes).  Weight here corresponds to the denominator when calculating the success rate.  Defaults to <code>NULL</code> for an input data set where each row describes an individual.</p>
</td></tr>
<tr><td><code id="di_iterate_dt_+3A_include_non_disagg_results">include_non_disagg_results</code></td>
<td>
<p>A logical variable specifying whether or not the non-disaggregated results should be returned; defaults to <code>TRUE</code>.  When <code>TRUE</code>, a new variable <code>`- None`</code> is added to the data set with a single data value <code>'- All'</code>, and this variable is added to <code>group_vars</code> as a disaggregation/group variable.  The user would want these results returned to review non-disaggregated results.</p>
</td></tr>
<tr><td><code id="di_iterate_dt_+3A_ppg_reference_groups">ppg_reference_groups</code></td>
<td>
<p>Either <code>'overall'</code>, <code>'hpg'</code>, <code>'all but current'</code>, or a character vector of the same length as <code>group_vars</code> that indicates the reference group value for each group variable in <code>group_vars</code> when determining disproportionate impact using the percentage point gap method.</p>
</td></tr>
<tr><td><code id="di_iterate_dt_+3A_min_moe">min_moe</code></td>
<td>
<p>The minimum margin of error to be used in the PPG calculation; see <a href="#topic+di_ppg">di_ppg</a>.</p>
</td></tr>
<tr><td><code id="di_iterate_dt_+3A_use_prop_in_moe">use_prop_in_moe</code></td>
<td>
<p>(<code>TRUE</code> or <code>FALSE</code>) Whether the estimated proportions should be used in the margin of error calculation by the PPG; see <a href="#topic+di_ppg">di_ppg</a>.</p>
</td></tr>
<tr><td><code id="di_iterate_dt_+3A_prop_sub_0">prop_sub_0</code></td>
<td>
<p>Default is 0.50; see <a href="#topic+di_ppg">di_ppg</a>.</p>
</td></tr>
<tr><td><code id="di_iterate_dt_+3A_prop_sub_1">prop_sub_1</code></td>
<td>
<p>Default is 0.50; see <a href="#topic+di_ppg">di_ppg</a>.</p>
</td></tr>
<tr><td><code id="di_iterate_dt_+3A_di_prop_index_cutoff">di_prop_index_cutoff</code></td>
<td>
<p>Threshold used for determining disproportionate impact using the proportionality index; see <a href="#topic+di_prop_index">di_prop_index</a>; defaults to 0.80.</p>
</td></tr>
<tr><td><code id="di_iterate_dt_+3A_di_80_index_cutoff">di_80_index_cutoff</code></td>
<td>
<p>Threshold used for determining disproportionate impact using the 80% index; see <a href="#topic+di_80_index">di_80_index</a>; defaults to 0.80.</p>
</td></tr>
<tr><td><code id="di_iterate_dt_+3A_di_80_index_reference_groups">di_80_index_reference_groups</code></td>
<td>
<p>Either <code>'overall'</code>, <code>'hpg'</code>, <code>'all but current'</code>, or a character vector of the same length as <code>group_vars</code> that indicates the reference group value for each group variable in <code>group_vars</code> when determining disproportionate impact using the 80% index.</p>
</td></tr>
<tr><td><code id="di_iterate_dt_+3A_check_valid_reference">check_valid_reference</code></td>
<td>
<p>(<code>TRUE</code> or <code>FALSE</code>) Check whether <code>ppg_reference_groups</code> and <code>di_80_index_reference_groups</code> contain valid values; defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="di_iterate_dt_+3A_parallel">parallel</code></td>
<td>
<p>If <code>TRUE</code>, then perform calculations in parallel.  Defaults to <code>FALSE</code>.  Parallel execution is based on the <code>parallel</code> package included in base R, using <a href="parallel.html#topic+parLapply">parLapply</a> on Windows and <a href="parallel.html#topic+mclapply">mclapply</a> on POSIX-based systems (Linux/Mac).</p>
</td></tr>
<tr><td><code id="di_iterate_dt_+3A_parallel_n_cores">parallel_n_cores</code></td>
<td>
<p>The number of CPU cores to use if <code>parallel=TRUE</code>.  Defaults to half of the maximum number of CPU cores on the system.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Iteratively calculate disproportionate impact via the percentage point gap (PPG), proportionality index, and 80% index methods for all combinations of <code>success_vars</code>, <code>group_vars</code>, and <code>cohort_vars</code>, for each combination of subgroups specified by <code>scenario_repeat_by_vars</code>, using <a href="data.table.html#topic+data.table">data.table</a> and <a href="collapse.html#topic+collapse">collapse</a>.
</p>


<h3>Value</h3>

<p>A summarized data set of class <a href="data.table.html#topic+data.table">data.table</a>, with variables as described in <a href="#topic+di_iterate">di_iterate</a>.
</p>

<hr>
<h2 id='di_iterate_on_long'>Iteratively calculate disproportionate impact using multiple methods for a long and summarized data set</h2><span id='topic+di_iterate_on_long'></span>

<h3>Description</h3>

<p>Calculate disproportionate impact via the percentage point gap (PPG), proportionality index, and 80% index methods for a &quot;long&quot; and summarized data set with many success variables and disaggregation variables, where the success counts and disaggregation groups are stored in a single column or variable for each.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>di_iterate_on_long(
  data,
  num_var,
  denom_var,
  disagg_var_col,
  group_var_col,
  disagg_var_col_2 = NULL,
  group_var_col_2 = NULL,
  cohort_var_col = NULL,
  summarize_by_vars = NULL,
  custom_reference_group_flag_var = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="di_iterate_on_long_+3A_data">data</code></td>
<td>
<p>A data frame for which to iterate DI calculations for a set of variables.</p>
</td></tr>
<tr><td><code id="di_iterate_on_long_+3A_num_var">num_var</code></td>
<td>
<p>A variable name (character value) from <code>data</code> where the variable stores success counts (the numerator in success rates).  Success rates are calculated by aggregating <code>num_var</code> and <code>denom_var</code> for each unique combination of values in <code>disagg_var_col</code>, <code>group_var_col</code>, <code>disagg_var_col_2</code>, <code>group_var_col_2</code>, <code>cohort_var_col</code>, and <code>summarize_by_vars</code>.  If such combinations are unique (single row), then rows are not collapsed.</p>
</td></tr>
<tr><td><code id="di_iterate_on_long_+3A_denom_var">denom_var</code></td>
<td>
<p>A variable name (character value) from <code>data</code> where the variable stores the group size (the denominator in success rates).</p>
</td></tr>
<tr><td><code id="di_iterate_on_long_+3A_disagg_var_col">disagg_var_col</code></td>
<td>
<p>A variable name (character value) from <code>data</code> where the variable stores the different disaggregation scenarios.  The disaggregation variable could include such values as 'Ethnicity', 'Age Group', and 'Foster Youth', corresponding to three disaggregation scenarios.</p>
</td></tr>
<tr><td><code id="di_iterate_on_long_+3A_group_var_col">group_var_col</code></td>
<td>
<p>A variable name (character value) from <code>data</code> where the variable stores the group name for each group within a level of disaggregation specified in <code>disagg_var_col</code>.  For example, the group names could include 'Asian', 'White', 'Black', 'Latinx', 'Native American', and 'Other' for a disaggregation on ethnicity; 'Under 18', '18-21', '22-25', and '25+' for an age group disaggregation; and 'Yes' and 'No' for a foster youth status disaggregation.</p>
</td></tr>
<tr><td><code id="di_iterate_on_long_+3A_disagg_var_col_2">disagg_var_col_2</code></td>
<td>
<p>(Optional) A variable name (character value) from <code>data</code> where the variable stores an optional second disaggregation variable, which allows for the intersectionality of variables listed in <code>disagg_var_col</code> and <code>disagg_var_col_2</code>.  The second disaggregation variable could describe something not in <code>disagg_var_col_2</code>, such as 'Gender', which would require all groups described in <code>group_var_col</code> to be broken out by gender.</p>
</td></tr>
<tr><td><code id="di_iterate_on_long_+3A_group_var_col_2">group_var_col_2</code></td>
<td>
<p>(Optional) A variable name (character value) from <code>data</code> where the variable stores the group name for each group within a second level of disaggregation specified in <code>disagg_var_col_2</code>.  For example, the group names could include 'Male', 'Female', 'Non-binary', and 'Unknown' if 'Gender' is a value in the variable <code>disagg_var_col_2</code>.</p>
</td></tr>
<tr><td><code id="di_iterate_on_long_+3A_cohort_var_col">cohort_var_col</code></td>
<td>
<p>(Optional) A variable name (character value) from <code>data</code> where the variable stores the cohort label for the data described in each row.</p>
</td></tr>
<tr><td><code id="di_iterate_on_long_+3A_summarize_by_vars">summarize_by_vars</code></td>
<td>
<p>(Optional) A character vector of variable names in <code>data</code> for which <code>num_var</code> and <code>denom_var</code> are used for aggregation to calculate success rates for the dispropotionate impact (DI) analysis set up by <code>disagg_var_col</code>, <code>group_var_col</code>, <code>disagg_var_col_2</code>, and <code>group_var_col_2</code>.  For example, <code>summarize_by_vars=c('Outcome')</code> could specify a single variable/column that describes the outcome or metric in <code>num_var</code>, where the outcome values might include 'Completion of Transfer-Level Math', 'Completion of Transfer-Level English','Transfer', 'Associate Degree'.</p>
</td></tr>
<tr><td><code id="di_iterate_on_long_+3A_custom_reference_group_flag_var">custom_reference_group_flag_var</code></td>
<td>
<p>(Optional) A variable name (character value) from <code>data</code> where the variable flags the row or group that should be used as the reference group (<code>1</code> if row is a reference group, <code>0</code> otherwise) for comparison in the percentage point gap method and the 80% index method.  When this argument is used, then the <code>ppg_reference_groups</code> and <code>di_80_index_reference_groups</code> arguments should not be specified.</p>
</td></tr>
<tr><td><code id="di_iterate_on_long_+3A_...">...</code></td>
<td>
<p>(Optional) Other arguments such as <code>ppg_reference_groups</code>, <code>min_moe</code>, <code>use_prop_in_moe</code>, <code>prop_sub_0</code>, <code>prop_sub_1</code>, <code>di_prop_index_cutoff</code>, <code>di_80_index_cutoff</code>, <code>di_80_index_reference_groups</code>, and <code>check_valid_reference</code> from <a href="#topic+di_iterate">di_iterate</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Iteratively calculate disproportionate impact via the percentage point gap (PPG), proportionality index, and 80% index methods for all combinations of <code>success_vars</code>, <code>group_vars</code>, and <code>cohort_vars</code>, for each combination of subgroups specified by <code>scenario_repeat_by_vars</code>.
</p>


<h3>Value</h3>

<p>A summarized data set (data frame) consisting of:
</p>

<ul>
<li><p> variables specified by <code>summarize_by_vars</code>, <code>disagg_var_col</code>, <code>group_var_col</code>, <code>disagg_var_col_2</code>, and <code>group_var_col_2</code>,
</p>
</li>
<li> <p><code>di_indicator_ppg</code> (1 if there is disproportionate impact per the percentage point gap method, 0 otherwise),
</p>
</li>
<li> <p><code>di_indicator_prop_index</code> (1 if there is disproportionate impact per the proportionality index, 0 otherwise),
</p>
</li>
<li> <p><code>di_indicator_80_index</code> (1 if there is disproportionate impact per the 80% index, 0 otherwise), and
</p>
</li>
<li><p> other relevant fields returned from <a href="#topic+di_ppg">di_ppg</a>, <a href="#topic+di_prop_index">di_prop_index</a>,  and <a href="#topic+di_80_index">di_80_index</a>.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
data(ssm_cohort)
di_iterate_on_long(data=ssm_cohort %&gt;% filter(missingFlag==0) # remove missing data
  , num_var='value', denom_var='denom'
  , disagg_var_col='disagg1', group_var_col='subgroup1'
  , cohort_var_col='academicYear', summarize_by_vars=c('categoryLabel')
  , ppg_reference_groups='all but current' # PPG-1
  , di_80_index_reference_groups='all but current')
</code></pre>

<hr>
<h2 id='di_iterate_sql'>Iteratively calculate disproportionate impact using multiple methods for many variables, using SQL.</h2><span id='topic+di_iterate_sql'></span>

<h3>Description</h3>

<p>Iteratively calculate disproportionate impact via the percentage point gap (PPG), proportionality index, and 80% index methods for many success variables, disaggregation variables, and scenarios, using SQL (for data stored in a database or in a parquet data file).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>di_iterate_sql(
  db_conn,
  db_table_name,
  success_vars,
  group_vars,
  cohort_vars = NULL,
  scenario_repeat_by_vars = NULL,
  exclude_scenario_df = NULL,
  weight_var = NULL,
  include_non_disagg_results = TRUE,
  ppg_reference_groups = "overall",
  min_moe = 0.03,
  use_prop_in_moe = FALSE,
  prop_sub_0 = 0.5,
  prop_sub_1 = 0.5,
  di_prop_index_cutoff = 0.8,
  di_80_index_cutoff = 0.8,
  di_80_index_reference_groups = "hpg",
  check_valid_reference = TRUE,
  parallel = FALSE,
  parallel_n_cores = parallel::detectCores()/2,
  mssql_flag = FALSE,
  return_what = "data",
  staging_table = paste0("DisImpact_Staging_", paste0(sample(1:9, size = 5, replace =
    TRUE), collapse = "")),
  drop_staging_table = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="di_iterate_sql_+3A_db_conn">db_conn</code></td>
<td>
<p>A database connection object, returned by <a href="DBI.html#topic+dbConnect">dbConnect</a>.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_db_table_name">db_table_name</code></td>
<td>
<p>A character value specifying a database table name.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_success_vars">success_vars</code></td>
<td>
<p>A character vector of success variable names to iterate across.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_group_vars">group_vars</code></td>
<td>
<p>A character vector of group (disaggregation) variable names to iterate across.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_cohort_vars">cohort_vars</code></td>
<td>
<p>(Optional) A character vector of the same length as <code>success_vars</code> to indicate the cohort variable to be used for each variable specified in <code>success_vars</code>.  A vector of length 1 could be specified, in which case the same cohort variable is used for each success variable.  If not specified, then a single cohort is assumed for all success variables (defaults to <code>NULL</code>).</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_scenario_repeat_by_vars">scenario_repeat_by_vars</code></td>
<td>
<p>(Optional) A character vector of variables to repeat DI calculations for across all combination of these variables.  For example, the following variables could be specified:
</p>

<ul>
<li><p> Ed Goal: Degree/Transfer, Shot-term Career, Non-credit
</p>
</li>
<li><p> First time college student: Yes, No
</p>
</li>
<li><p> Full-time status: Yes, No
</p>
</li></ul>

<p>Each combination of these variables (eg, full time, first time college students with an ed goal of degree/transfer as one combination) would constitute an iteration / sample for which to calculate disproportionate impact for outcomes listed in <code>success_vars</code> and for the disaggregation variables listed in <code>group_vars</code>. The overall rate of success for full time, first time college students with an ed goal of degree/transfer would just include these students and not others.  Each variable specified is also collapsed to an '- All' group so that the combinations also reflect all students of a particular category.  The total number of combinations for the previous example would be (+1 representing the all category): (3 + 1) x (2 + 1) x (2 + 1) = 36.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_exclude_scenario_df">exclude_scenario_df</code></td>
<td>
<p>(Optional) A data frame with variables that match <code>scenario_repeat_by_vars</code> for specifying the combinations to exclude from DI calculations.  Following the example specified above, one could choose to exclude part-time non-credit students from consideration.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_weight_var">weight_var</code></td>
<td>
<p>(Optional) A character variable specifying the weight variable if the input data set is summarized (i.e., the the success variables specified in <code>success_vars</code> contain count of successes).  Weight here corresponds to the denominator when calculating the success rate.  Defaults to <code>NULL</code> for an input data set where each row describes an individual.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_include_non_disagg_results">include_non_disagg_results</code></td>
<td>
<p>A logical variable specifying whether or not the non-disaggregated results should be returned; defaults to <code>TRUE</code>.  When <code>TRUE</code>, a new variable <code>`- None`</code> is added to the data set with a single data value <code>'- All'</code>, and this variable is added to <code>group_vars</code> as a disaggregation/group variable.  The user would want these results returned to review non-disaggregated results.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_ppg_reference_groups">ppg_reference_groups</code></td>
<td>
<p>Either <code>'overall'</code>, <code>'hpg'</code>, <code>'all but current'</code>, or a character vector of the same length as <code>group_vars</code> that indicates the reference group value for each group variable in <code>group_vars</code> when determining disproportionate impact using the percentage point gap method.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_min_moe">min_moe</code></td>
<td>
<p>The minimum margin of error to be used in the PPG calculation; see <a href="#topic+di_ppg">di_ppg</a>.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_use_prop_in_moe">use_prop_in_moe</code></td>
<td>
<p>(<code>TRUE</code> or <code>FALSE</code>) Whether the estimated proportions should be used in the margin of error calculation by the PPG; see <a href="#topic+di_ppg">di_ppg</a>.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_prop_sub_0">prop_sub_0</code></td>
<td>
<p>Default is 0.50; see <a href="#topic+di_ppg">di_ppg</a>.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_prop_sub_1">prop_sub_1</code></td>
<td>
<p>Default is 0.50; see <a href="#topic+di_ppg">di_ppg</a>.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_di_prop_index_cutoff">di_prop_index_cutoff</code></td>
<td>
<p>Threshold used for determining disproportionate impact using the proportionality index; see <a href="#topic+di_prop_index">di_prop_index</a>; defaults to 0.80.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_di_80_index_cutoff">di_80_index_cutoff</code></td>
<td>
<p>Threshold used for determining disproportionate impact using the 80% index; see <a href="#topic+di_80_index">di_80_index</a>; defaults to 0.80.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_di_80_index_reference_groups">di_80_index_reference_groups</code></td>
<td>
<p>Either <code>'overall'</code>, <code>'hpg'</code>, <code>'all but current'</code>, or a character vector of the same length as <code>group_vars</code> that indicates the reference group value for each group variable in <code>group_vars</code> when determining disproportionate impact using the 80% index.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_check_valid_reference">check_valid_reference</code></td>
<td>
<p>(<code>TRUE</code> or <code>FALSE</code>) Check whether <code>ppg_reference_groups</code> and <code>di_80_index_reference_groups</code> contain valid values; defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_parallel">parallel</code></td>
<td>
<p>If <code>TRUE</code>, then perform calculations in parallel.  The parallel feature is only supported when <code>db_table_name</code> is a path to a parquet file (<code>'/path/to/data.parquet'</code>) and that <code>db_conn</code> is a connection to a <a href="duckdb.html#topic+duckdb">duckdb</a> database (e.g.,  <code>dbConnect(duckdb(), dbdir=':memory:')</code>).  Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_parallel_n_cores">parallel_n_cores</code></td>
<td>
<p>The number of CPU cores to use if <code>parallel=TRUE</code>.  Defaults to half of the maximum number of CPU cores on the system.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_mssql_flag">mssql_flag</code></td>
<td>
<p>User-specified logical flag (<code>TRUE</code> or <code>FALSE</code>) that indicates if the MS SQL Server variant of the SQL language should be used.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_return_what">return_what</code></td>
<td>
<p>A character value specifying the return value for the function call.  For <code>'data'</code>, the function will return a long data frame with the disproportionate calculations and relevant statistics, after the calculations are performed on the SQL database engine.  For <code>'SQL'</code>, a list object of individual queries will be returned for the user to execute elsewhere.  Defaults to <code>'data'</code>.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_staging_table">staging_table</code></td>
<td>
<p>A character value indicating the name of the staging or results table in the database for storing the disproportionate impact calculations.</p>
</td></tr>
<tr><td><code id="di_iterate_sql_+3A_drop_staging_table">drop_staging_table</code></td>
<td>
<p><code>TRUE</code>/<code>FALSE</code> A logical flag indicating whether or not the staging table specified in <code>staging_table</code> should be dropped in the database after the results are returned to R; defaults to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Iteratively calculate disproportionate impact via the percentage point gap (PPG), proportionality index, and 80% index methods for all combinations of <code>success_vars</code>, <code>group_vars</code>, and <code>cohort_vars</code>, for each combination of subgroups specified by <code>scenario_repeat_by_vars</code>, using SQL (calculations done on the database engine or duckdb for parquet files).
</p>


<h3>Value</h3>

<p>When <code>return_what='data'</code> (default), a long data frame is returned (see the return value for <a href="#topic+di_iterate">di_iterate</a>).  When <code>return_what='SQL'</code> (default), a list object where each element is a query (character value) is returned.
</p>

<hr>
<h2 id='di_ppg'>Calculate disproportionate impact per the percentage point gap (PPG) method.</h2><span id='topic+di_ppg'></span>

<h3>Description</h3>

<p>Calculate disproportionate impact per the percentage point gap (PPG) method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>di_ppg(
  success,
  group,
  cohort,
  weight,
  reference = c("overall", "hpg", "all but current", unique(group)),
  data,
  min_moe = 0.03,
  use_prop_in_moe = FALSE,
  prop_sub_0 = 0.5,
  prop_sub_1 = 0.5,
  check_valid_reference = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="di_ppg_+3A_success">success</code></td>
<td>
<p>A vector of success indicators (<code>1</code>/<code>0</code> or <code>TRUE</code>/<code>FALSE</code>) or an unquoted reference (name) to a column in <code>data</code> if it is specified.  It could also be a vector of counts, in which case <code>weight</code> (group size) should also be specified.</p>
</td></tr>
<tr><td><code id="di_ppg_+3A_group">group</code></td>
<td>
<p>A vector of group names of the same length as <code>success</code> or an unquoted reference (name) to a column in <code>data</code> if it is specified.</p>
</td></tr>
<tr><td><code id="di_ppg_+3A_cohort">cohort</code></td>
<td>
<p>(Optional) A vector of cohort names of the same length as <code>success</code> or an unquoted reference (name) to a column in <code>data</code> if it is specified.  Disproportionate impact is calculated for every group within each cohort.  When <code>cohort</code> is not specified, then the analysis assumes a single cohort.</p>
</td></tr>
<tr><td><code id="di_ppg_+3A_weight">weight</code></td>
<td>
<p>(Optional) A vector of case weights of the same length as <code>success</code> or an unquoted reference (name) to a column in <code>data</code> if it is specified.  If <code>success</code> consists of counts instead of success indicators (1/0), then <code>weight</code> should also be specified to indicate the group size.</p>
</td></tr>
<tr><td><code id="di_ppg_+3A_reference">reference</code></td>
<td>
<p>Either <code>'overall'</code> (default), <code>'hpg'</code> (highest performing group), <code>'all but current'</code> (success rate of everyone excluding the comparison group; also known as 'ppg minus 1'), a value from <code>group</code> (specifying a reference group), a single proportion (eg, 0.50), or a vector of proportions (one for each cohort).  Reference is used as a point of comparison for disproportionate impact for each group.  When <code>cohort</code> is specified:
</p>

<ul>
<li> <p><code>'overall'</code> will use the overall success rate of each cohort group as the reference;
</p>
</li>
<li> <p><code>'hpg'</code> will use the highest performing group in each cohort as reference;
</p>
</li>
<li>  <p><code>'all but current'</code> will use the calculated success rate of each cohort group excluding the comparison group
</p>
</li>
<li><p> the success rate of the specified reference group from <code>group</code> in each cohort will be used;
</p>
</li>
<li><p> the specified proportion will be used for all cohorts;
</p>
</li>
<li><p> the specified vector of proportions will refer to the reference point for each cohort in alphabetical order (so the number of proportions should equal to the number of unique cohorts).
</p>
</li></ul>
</td></tr>
<tr><td><code id="di_ppg_+3A_data">data</code></td>
<td>
<p>(Optional) A data frame containing the variables of interest.  If <code>data</code> is specified, then <code>success</code>, <code>group</code>, and <code>cohort</code> will be searched within it.</p>
</td></tr>
<tr><td><code id="di_ppg_+3A_min_moe">min_moe</code></td>
<td>
<p>The minimum margin of error (MOE) to be used in the calculation of disproportionate impact and is passed to <a href="#topic+ppg_moe">ppg_moe</a>.  Defaults to <code>0.03</code>.</p>
</td></tr>
<tr><td><code id="di_ppg_+3A_use_prop_in_moe">use_prop_in_moe</code></td>
<td>
<p>A logical value indicating whether or not the MOE formula should use the observed success rates (<code>TRUE</code>).  Defaults to <code>FALSE</code>, which uses 0.50 as the proportion in the MOE formula.  If <code>TRUE</code>, the success rates are passed to the <code>proportion</code> argument of <a href="#topic+ppg_moe">ppg_moe</a>.</p>
</td></tr>
<tr><td><code id="di_ppg_+3A_prop_sub_0">prop_sub_0</code></td>
<td>
<p>For cases where <code>proportion</code> is 0, substitute with <code>prop_sub_0</code> (defaults to 0.5) to account for the zero MOE.  This is relevant only when <code>use_prop_in_moe=TRUE</code>.</p>
</td></tr>
<tr><td><code id="di_ppg_+3A_prop_sub_1">prop_sub_1</code></td>
<td>
<p>For cases where <code>proportion</code> is 1, substitute with <code>prop_sub_1</code> (defaults to 0.5) to account for the zero MOE.  This is relevant only when <code>use_prop_in_moe=TRUE</code>.</p>
</td></tr>
<tr><td><code id="di_ppg_+3A_check_valid_reference">check_valid_reference</code></td>
<td>
<p>Check whether <code>reference</code> is a valid value; defaults to <code>TRUE</code>.  This argument exists to be used in <a href="#topic+di_iterate">di_iterate</a> as when iterating DI calculations, there may be some scenarios where a specified reference group does not contain any students.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function determines disproportionate impact based on the percentage point gap (PPG) method, as described in <a href="https://www.cccco.edu/-/media/CCCCO-Website/About-Us/Divisions/Digital-Innovation-and-Infrastructure/Research/Files/PercentagePointGapMethod2017.ashx">this</a> reference from the California Community Colleges Chancellor's Office.  It assumes that a higher rate is good (&quot;success&quot;).  For rates that are deemed negative (eg, rate of drop-outs, high is bad), then consider looking at the converse of the non-success (eg, non drop-outs, high is good) instead in order to leverage this function properly.  Note that the margin of error (MOE) is calculated using using <code>1.96*sqrt(0.25^2/n)</code>, with a <code>min_moe</code> used as the minimum by default.
</p>


<h3>Value</h3>

<p>A data frame consisting of:
</p>

<ul>
<li> <p><code>cohort</code> (if used),
</p>
</li>
<li> <p><code>group</code>,
</p>
</li>
<li> <p><code>n</code> (sample size),
</p>
</li>
<li> <p><code>success</code> (number of successes for the cohort-group),
</p>
</li>
<li> <p><code>pct</code> (proportion of successes for the cohort-group),
</p>
</li>
<li> <p><code>reference_group</code> (reference group used in DI calculation),
</p>
</li>
<li> <p><code>reference</code> (reference value used in DI calculation),
</p>
</li>
<li> <p><code>moe</code> (margin of error),
</p>
</li>
<li> <p><code>pct_lo</code> (lower 95% confidence limit for pct),
</p>
</li>
<li> <p><code>pct_hi</code> (upper 95% confidence limit for pct),
</p>
</li>
<li> <p><code>di_indicator</code> (1 if there is disproportionate impact, ie, when <code>pct_hi &lt;= reference</code>), 
</p>
</li>
<li> <p><code>success_needed_not_di</code> (the number of additional successes needed in order to no longer be considered disproportionately impacted as compared to the reference), and
</p>
</li>
<li> <p><code>success_needed_full_parity</code> (the number of additional successes needed in order to achieve full parity with the reference).
</p>
</li></ul>



<h3>References</h3>

<p>California Community Colleges Chancellor's Office (2017).  <a href="https://www.cccco.edu/-/media/CCCCO-Website/About-Us/Divisions/Digital-Innovation-and-Infrastructure/Research/Files/PercentagePointGapMethod2017.ashx">Percentage Point Gap Method</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
data(student_equity)
# Vector
di_ppg(success=student_equity$Transfer
  , group=student_equity$Ethnicity) %&gt;% as.data.frame
# Tidy and column reference
di_ppg(success=Transfer, group=Ethnicity, data=student_equity) %&gt;%
  as.data.frame
# Cohort
di_ppg(success=Transfer, group=Ethnicity, cohort=Cohort
 , data=student_equity) %&gt;%
  as.data.frame
# With custom reference (single)
di_ppg(success=Transfer, group=Ethnicity, reference=0.54
  , data=student_equity) %&gt;%
  as.data.frame
# With custom reference (multiple)
di_ppg(success=Transfer, group=Ethnicity, cohort=Cohort
  , reference=c(0.5, 0.55), data=student_equity) %&gt;%
  as.data.frame
# min_moe
di_ppg(success=Transfer, group=Ethnicity, data=student_equity
  , min_moe=0.02) %&gt;%
  as.data.frame
# use_prop_in_moe
di_ppg(success=Transfer, group=Ethnicity, data=student_equity
  , min_moe=0.02
  , use_prop_in_moe=TRUE) %&gt;%
  as.data.frame
</code></pre>

<hr>
<h2 id='di_ppg_iterate'>Iteratively calculate disproportionate impact via the percentage point gap (PPG) method for many variables.</h2><span id='topic+di_ppg_iterate'></span>

<h3>Description</h3>

<p>Iteratively calculate disproportionate impact via the percentage point gap (PPG) method for many disaggregation variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>di_ppg_iterate(
  data,
  success_vars,
  group_vars,
  cohort_vars,
  reference_groups,
  repeat_by_vars = NULL,
  weight_var = NULL,
  min_moe = 0.03,
  use_prop_in_moe = FALSE,
  prop_sub_0 = 0.5,
  prop_sub_1 = 0.5
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="di_ppg_iterate_+3A_data">data</code></td>
<td>
<p>A data frame for which to iterate DI calculation for a set of variables.</p>
</td></tr>
<tr><td><code id="di_ppg_iterate_+3A_success_vars">success_vars</code></td>
<td>
<p>A character vector of success variable names to iterate across.</p>
</td></tr>
<tr><td><code id="di_ppg_iterate_+3A_group_vars">group_vars</code></td>
<td>
<p>A character vector of group (disaggregation) variable names to iterate across.</p>
</td></tr>
<tr><td><code id="di_ppg_iterate_+3A_cohort_vars">cohort_vars</code></td>
<td>
<p>A character vector of cohort variable names to iterate across.</p>
</td></tr>
<tr><td><code id="di_ppg_iterate_+3A_reference_groups">reference_groups</code></td>
<td>
<p>Either 'overall', 'hpg', or a character vector of the same length as 'group_vars' that indicates the reference group value for each group variable in 'group_vars'.</p>
</td></tr>
<tr><td><code id="di_ppg_iterate_+3A_repeat_by_vars">repeat_by_vars</code></td>
<td>
<p>A character vector of variables to repeat DI calculations for across all combination of these variables, including '- All' as a group for each variable.  The reference rate used for DI comparison differs for every combination of the variables listed here.</p>
</td></tr>
<tr><td><code id="di_ppg_iterate_+3A_weight_var">weight_var</code></td>
<td>
<p>A character scalar specifying the weight variable if the input data set is summarized (ie,  the the success variables specified in 'success_vars' contain count of successes).  Weight here corresponds to the denominator when calculating the success rate.  Defaults to 'NULL' for an input data set where each row describes each individual.</p>
</td></tr>
<tr><td><code id="di_ppg_iterate_+3A_min_moe">min_moe</code></td>
<td>
<p>The minimum margin of error to be used in the PPG calculation, passed to 'di_ppg'.</p>
</td></tr>
<tr><td><code id="di_ppg_iterate_+3A_use_prop_in_moe">use_prop_in_moe</code></td>
<td>
<p>Whether the estimated proportions should be used in the margin of error calculation by the PPG, passed to 'di_ppg'.</p>
</td></tr>
<tr><td><code id="di_ppg_iterate_+3A_prop_sub_0">prop_sub_0</code></td>
<td>
<p>Passed to 'di_ppg'.</p>
</td></tr>
<tr><td><code id="di_ppg_iterate_+3A_prop_sub_1">prop_sub_1</code></td>
<td>
<p>Passed to 'di_ppg'.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Iteratively calculate disproportionate impact via the percentage point gap (PPG) method for all combinations of 'success_vars', 'group_vars', and 'cohort_vars', for each combination of subgroups specified by 'repeat_by_vars'.
</p>


<h3>Value</h3>

<p>A data frame with all relevant returned fields from 'di_ppg' plus 'success_variable' (elements of 'success_vars'), 'disaggregation' (elements of 'group_vars'), and 'reference_group' (elements of 'reference_groups').
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
data(student_equity)
# Multiple group variables
di_ppg_iterate(data=student_equity, success_vars=c('Transfer')
  , group_vars=c('Ethnicity', 'Gender'), cohort_vars=c('Cohort')
  , reference_groups='overall')
</code></pre>

<hr>
<h2 id='di_prop_index'>Calculate disproportionate impact per the proportionality index (PI) method.</h2><span id='topic+di_prop_index'></span>

<h3>Description</h3>

<p>Calculate disproportionate impact per the proportionality index (PI) method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>di_prop_index(success, group, cohort, weight, data, di_prop_index_cutoff = 0.8)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="di_prop_index_+3A_success">success</code></td>
<td>
<p>A vector of success indicators (<code>1</code>/<code>0</code> or <code>TRUE</code>/<code>FALSE</code>) or an unquoted reference (name) to a column in <code>data</code> if it is specified.  It could also be a vector of counts, in which case <code>weight</code> should also be specified (group size).</p>
</td></tr>
<tr><td><code id="di_prop_index_+3A_group">group</code></td>
<td>
<p>A vector of group names of the same length as <code>success</code> or an unquoted reference (name) to a column in <code>data</code> if it is specified.</p>
</td></tr>
<tr><td><code id="di_prop_index_+3A_cohort">cohort</code></td>
<td>
<p>(Optional) A vector of cohort names of the same length as <code>success</code> or an unquoted reference (name) to a column in <code>data</code> if it is specified.  disproportionate impact is calculated for every group within each cohort.  When <code>cohort</code> is not specified, then the analysis assumes a single cohort.</p>
</td></tr>
<tr><td><code id="di_prop_index_+3A_weight">weight</code></td>
<td>
<p>(Optional) A vector of case weights of the same length as <code>success</code> or an unquoted reference (name) to a column in <code>data</code> if it is specified.  If <code>success</code> consists of counts instead of success indicators (1/0), then <code>weight</code> should also be specified to indicate the group size.</p>
</td></tr>
<tr><td><code id="di_prop_index_+3A_data">data</code></td>
<td>
<p>(Optional) A data frame containing the variables of interest.  If <code>data</code> is specified, then <code>success</code>, <code>group</code>, and <code>cohort</code> will be searched within it.</p>
</td></tr>
<tr><td><code id="di_prop_index_+3A_di_prop_index_cutoff">di_prop_index_cutoff</code></td>
<td>
<p>A numeric value between 0 and 1 that is used to determine disproportionate impact if the proportionality index falls below this threshold; defaults to 0.80.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function determines disproportionate impact based on the proportionality index (PI) method, as described in <a href="https://www.cccco.edu/-/media/CCCCO-Website/Files/DII/guidelines-for-measuring-disproportionate-impact-in-equity-plans-tfa-ada.pdf">this</a> reference from the California Community Colleges Chancellor's Office.  It assumes that a higher rate is good (&quot;success&quot;).  For rates that are deemed negative (eg, rate of drop-outs, high is bad), then consider looking at the converse of the non-success (eg, non drop-outs, high is good) instead in order to leverage this function properly.
</p>


<h3>Value</h3>

<p>A data frame consisting of:
</p>

<ul>
<li> <p><code>cohort</code> (if used),
</p>
</li>
<li> <p><code>group</code>,
</p>
</li>
<li> <p><code>n</code> (sample size),
</p>
</li>
<li> <p><code>success</code> (number of successes for the cohort-group),
</p>
</li>
<li> <p><code>pct_success</code> (proportion of successes attributed to the group within the cohort),
</p>
</li>
<li> <p><code>pct_group</code> (proportion of sample attributed to the group within the cohort),
</p>
</li>
<li> <p><code>di_prop_index</code> (ratio of pct_success to pct_group),
</p>
</li>
<li> <p><code>di_indicator</code> (1 if <code>di_prop_index &lt; di_prop_index_cutoff</code>), and
</p>
</li>
<li> <p><code>success_needed_not_di</code> (the number of additional successes needed in order to no longer be considered disproportionately impacted as compared to the reference), and
</p>
</li>
<li> <p><code>success_needed_full_parity</code> (the number of additional successes needed in order to achieve full parity with the reference).
</p>
</li></ul>

<p>When <code>di_prop_index &lt; 1</code>, then there are signs of disproportionate impact.
</p>


<h3>References</h3>

<p>California Community Colleges Chancellor's Office (2014).  <a href="https://www.cccco.edu/-/media/CCCCO-Website/About-Us/Divisions/Digital-Innovation-and-Infrastructure/Network-Operations/Accountability/Files/GUIDELINES-FOR-MEASURING-DISPROPORTIONATE-IMPACT-IN-EQUITY-PLANS.ashx">Guidelines for Measuring Disproportionate Impact in Equity Plans</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
data(student_equity)
di_prop_index(success=Transfer, group=Ethnicity, data=student_equity) %&gt;%
  as.data.frame
</code></pre>

<hr>
<h2 id='ppg_moe'>Margin of error for the PPG</h2><span id='topic+ppg_moe'></span>

<h3>Description</h3>

<p>Calculate the margin of error (MOE) for the percentage point gap (PPG) method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ppg_moe(n, proportion, min_moe = 0.03, prop_sub_0 = 0.5, prop_sub_1 = 0.5)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ppg_moe_+3A_n">n</code></td>
<td>
<p>Sample size for the group of interest.</p>
</td></tr>
<tr><td><code id="ppg_moe_+3A_proportion">proportion</code></td>
<td>
<p>(Optional) The proportion of successes for the group of interest.  If specified, then the proportion is used in the MOE formula.  Otherwise, a default proportion of 0.50 is used (conservative and yields the maximum MOE).</p>
</td></tr>
<tr><td><code id="ppg_moe_+3A_min_moe">min_moe</code></td>
<td>
<p>The minimum MOE returned even if the sample size is large.  Defaults to 0.03.  This equates to a minimum threshold gap for declaring disproportionate impact.</p>
</td></tr>
<tr><td><code id="ppg_moe_+3A_prop_sub_0">prop_sub_0</code></td>
<td>
<p>For cases where 'proportion' is 0, substitute with <code>prop_sub_0</code> (defaults to 0.5) to account for the zero MOE.</p>
</td></tr>
<tr><td><code id="ppg_moe_+3A_prop_sub_1">prop_sub_1</code></td>
<td>
<p>For cases where 'proportion' is 1, substitute with <code>prop_sub_1</code> (defaults to 0.5) to account for the zero MOE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The margin of error for the PPG given the specified sample size.
</p>


<h3>References</h3>

<p>California Community Colleges Chancellor's Office (2017).  <a href="https://www.cccco.edu/-/media/CCCCO-Website/About-Us/Divisions/Digital-Innovation-and-Infrastructure/Research/Files/PercentagePointGapMethod2017.ashx">Percentage Point Gap Method</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ppg_moe(n=800)
ppg_moe(n=c(200, 800, 1000, 2000))
ppg_moe(n=800, proportion=0.20)
ppg_moe(n=800, proportion=0.20, min_moe=0)
ppg_moe(n=c(200, 800, 1000, 2000), min_moe=0.01)
</code></pre>

<hr>
<h2 id='ssm_cohort'>Long summarized disaggregated data set</h2><span id='topic+ssm_cohort'></span>

<h3>Description</h3>

<p>Sample data downloaded from the California Community College's Chancellor's Office Student Success Metrics dashboard.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(ssm_cohort)
</code></pre>


<h3>Format</h3>

<p>A data frame with summarized data:
</p>

<dl>
<dt>value</dt><dd><p>Success count (numerator).</p>
</dd>
<dt>denom</dt><dd><p>Group size (denominator).</p>
</dd>
<dt>categoryLabel</dt><dd><p>Metric or outcome.</p>
</dd>
<dt>academicYear</dt><dd><p>Academic year for given data.</p>
</dd>
<dt>disagg1</dt><dd><p>Different levels of disaggregation.</p>
</dd>
<dt>subgroup1</dt><dd><p>Groups corresponding to each disaggregation in <code>disagg1</code>.</p>
</dd>
<dt>disagg2</dt><dd><p>Second level of disaggregation: 'None' or 'Gender'.</p>
</dd>
<dt>subgroup2</dt><dd><p>Groups corresponding to each disaggregation in <code>disagg2</code>.</p>
</dd>
<dt>cohort</dt><dd><p>Not actually a cohort, but the time-window for the outcome in <code>categoryLabel</code>.</p>
</dd>
<dt>localeName</dt><dd><p>College name.</p>
</dd>
<dt>metricID</dt><dd><p>ID for current metric.</p>
</dd>
<dt>title</dt><dd><p>Title of visualization.</p>
</dd>
<dt>categoryID</dt><dd><p>ID for <code>categoryLabel</code>.</p>
</dd>
<dt>perc</dt><dd><p><code>value / denom</code>.</p>
</dd>
<dt>dataType</dt><dd><p>All are 'Percent'.</p>
</dd>
<dt>missingFlag</dt><dd><p>1 if missing.</p>
</dd>
<dt>ferpaFlag</dt><dd><p>1 if FERPA-suppressed.</p>
</dd>
<dt>X20</dt><dd><p>Ignore.</p>
</dd>
<dt>description</dt><dd><p>Ignore.</p>
</dd>
<dt>source</dt><dd><p>Ignore.</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>data(ssm_cohort)
</code></pre>

<hr>
<h2 id='student_equity'>Fake data on student equity</h2><span id='topic+student_equity'></span>

<h3>Description</h3>

<p>Data randomly generated to illustrate the use of the package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(student_equity)
</code></pre>


<h3>Format</h3>

<p>A data frame with 20,000 rows:
</p>

<dl>
<dt>Ethnicity</dt><dd><p>ethnicity (one of: <code>Asian</code>, <code>Black</code>, <code>Hispanic</code>, <code>Multi-Ethnicity</code>, <code>Native American</code>, <code>White</code>).</p>
</dd>
<dt>Gender</dt><dd><p>gender (one of: <code>Male</code>, <code>Female</code>, <code>Other</code>).</p>
</dd>
<dt>Cohort</dt><dd><p>year student first enrolled in any credit course at the institution (one of: <code>2017</code>, <code>2018</code>).</p>
</dd>
<dt>Transfer</dt><dd><p>1 or 0 indicating whether or not a student transferred within 2 years of first enrollment (<code>Cohort</code>).</p>
</dd>
<dt>Cohort_Math</dt><dd><p>year student first enrolled in a math course at the institution; could be <code>NA</code> if the student have not attempted math.</p>
</dd>
<dt>Math</dt><dd><p>1 or 0 indicating whether or not a student completed transfer-level math within 1 year of their first math attempt (<code>Cohort_Math</code>); could be <code>NA</code> if the student have not attempted math.</p>
</dd>
<dt>Cohort_English</dt><dd><p>year student first enrolled in a math course at the institution; could be <code>NA</code> if the student have not attempted math.</p>
</dd>
<dt>English</dt><dd><p>1 or 0 indicating whether or not a student completed transfer-level English within 1 year of their first math attempt (<code>Cohort_English</code>); could be <code>NA</code> if the student have not attempted English.</p>
</dd>
<dt>Ed_Goal</dt><dd><p>student's educational goal (one of: <code>Deg/Transfer</code>, <code>Other</code>).</p>
</dd>
<dt>College_Status</dt><dd><p>student's educational status (one of: <code>First-time College</code>,  <code>Other</code>).</p>
</dd>
<dt>Student_ID</dt><dd><p>student's unique identifier.</p>
</dd>
<dt>EthnicityFlag_Asian</dt><dd><p>1 (yes) or 0 (no) indicating whether or not a student self-identifies as Asian.</p>
</dd>
<dt>EthnicityFlag_Black</dt><dd><p>1 (yes) or 0 (no) indicating whether or not a student self-identifies as Black.</p>
</dd>
<dt>EthnicityFlag_Hispanic</dt><dd><p>1 (yes) or 0 (no) indicating whether or not a student self-identifies as Hispanic.</p>
</dd>
<dt>EthnicityFlag_NativeAmerican</dt><dd><p>1 (yes) or 0 (no) indicating whether or not a student self-identifies as Native American.</p>
</dd>
<dt>EthnicityFlag_PacificIslander</dt><dd><p>1 (yes) or 0 (no) indicating whether or not a student self-identifies as Pacific Islander.</p>
</dd>
<dt>EthnicityFlag_White</dt><dd><p>1 (yes) or 0 (no) indicating whether or not a student self-identifies as White.</p>
</dd>
<dt>EthnicityFlag_Carribean</dt><dd><p>1 (yes) or 0 (no) indicating whether or not a student self-identifies as Carribean.</p>
</dd>
<dt>EthnicityFlag_EastAsian</dt><dd><p>1 (yes) or 0 (no) indicating whether or not a student self-identifies as East Asian.</p>
</dd>
<dt>EthnicityFlag_SouthEastAsian</dt><dd><p>1 (yes) or 0 (no) indicating whether or not a student self-identifies as Southeast Asian.</p>
</dd>
<dt>EthnicityFlag_SouthWestAsianNorthAfrican</dt><dd><p>1 (yes) or 0 (no) indicating whether or not a student self-identifies as Southwest Asian / North African (SWANA).</p>
</dd>
<dt>EthnicityFlag_AANAPI</dt><dd><p>1 (yes) or 0 (no) indicating whether or not a student self-identifies as Asian-American or Native American Pacific Islander (AANAPI).</p>
</dd>
<dt>EthnicityFlag_Unknown</dt><dd><p>1 (yes) or 0 (no) indicating whether or not a student self-identifies as Unknown.</p>
</dd>
<dt>EthnicityFlag_TwoorMoreRaces</dt><dd><p>1 (yes) or 0 (no) indicating whether or not a student self-identifies as two or more races.</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>data(student_equity)
</code></pre>

<hr>
<h2 id='surround_quote_if_needed'>Helper function: Surround character values with double quotes if not present.</h2><span id='topic+surround_quote_if_needed'></span>

<h3>Description</h3>

<p>Function used internally by <a href="#topic+di_calc_sql">di_calc_sql</a> and <a href="#topic+di_iterate_sql">di_iterate_sql</a> to surround variable names by double quotes in SQL queries in order to support non-alphanumeric characters in variable names.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>surround_quote_if_needed(value)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="surround_quote_if_needed_+3A_value">value</code></td>
<td>
<p>A character vector.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character vector with double quotes surrounding <code>value</code> if the first and last characters of <code>value</code> aren't yet double quotes.  For <code>value</code> that is already surrounded by double quotes, nothing is changed.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
