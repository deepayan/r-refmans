<!DOCTYPE html><html><head><title>Help for package missDiag</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {missDiag}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#anes08'><p>11 Variables from the 2008 American National Election Study</p></a></li>
<li><a href='#missDiag'><p>Comparing Observed and Imputed Values under MAR and MCAR</p></a></li>
<li><a href='#param_cobalt'><p>Construct parameter list for cobalt</p></a></li>
<li><a href='#param_ebal'><p>Construct parameter list for ebalance</p></a></li>
<li><a href='#param_sbw'><p>Construct parameter list for sbw</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Comparing Observed and Imputed Values under MAR and MCAR</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.1</td>
</tr>
<tr>
<td>Author:</td>
<td>Moritz Marbach &lt;moritz.marbach@tamu.edu&gt; [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Moritz Marbach &lt;moritz.marbach@tamu.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Implements the computation of discrepancy statistics summarizing differences between the density of imputed and observed values and the construction of weights to balance covariates that are part of the missing data mechanism as described in Marbach (2021) &lt;<a href="https://doi.org/10.48550/arXiv.2107.05427">doi:10.48550/arXiv.2107.05427</a>&gt;. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/sumtxt/missDiag/">https://github.com/sumtxt/missDiag/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/sumtxt/missDiag/issues">https://github.com/sumtxt/missDiag/issues</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Imports:</td>
<td>Formula (&ge; 1.2-3), cobalt (&ge; 4.1.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>mice (&ge; 3.13.0), sbw (&ge; 1.1.3), ebal (&ge; 0.1-6)</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-08-06 09:09:04 UTC; mmarbach</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-08-06 18:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='anes08'>11 Variables from the 2008 American National Election Study</h2><span id='topic+anes08'></span><span id='topic+anes08_rng'></span><span id='topic+anes08_pmm'></span>

<h3>Description</h3>

<p>The survey dataset includes 11 variables from the
2008 edition of the American National Election Study.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>anes08
</code></pre>


<h3>Format</h3>

<p>A data frame with 2265 rows and 11 variables:
</p>

<dl>
<dt>age</dt><dd><p>Age of the respondent</p>
</dd>
<dt>female</dt><dd><p>Sex of the respondent</p>
</dd>
<dt>white</dt><dd><p>Non-white vs. white</p>
</dd>
<dt>education</dt><dd><p>No high school,
some high school, high school diploma, college</p>
</dd>
<dt>income</dt><dd><p>Low, medium, high.</p>
</dd>
<dt>religion</dt><dd><p>Protestant, Catholic/Orthodox, Atheist/other</p>
</dd>
<dt>married</dt><dd><p>Single, married, no longer married</p>
</dd>
<dt>jobs_r</dt><dd><p>7 response categories ranging from
&quot;Govt should let each person get ahead on own&quot; (1)
to &quot;Govt should see to jobs and standard of living&quot; (7)</p>
</dd>
<dt>imp_enviro</dt><dd><p>Whether the respondent sees the environment
as an important issue (important/not important)</p>
</dd>
<dt>vote</dt><dd><p> Vote choice in the 2008 presidential
election: Obama, McCain, No vote/Other</p>
</dd>
<dt>time</dt><dd><p>Time for the respondent to complete the survey</p>
</dd>
</dl>



<h3>Details</h3>

<p>The dataset <code>anes</code> was prepared by Kropko et al. (2014). The nine
variables contain different levels of missingness.
</p>
<p>The dataset was imputed using random value imputation and predictive
mean matching via <code><a href="mice.html#topic+mice">mice::mice()</a></code> (Version: 3.13.0, seed=42).
</p>
<p>The imputed datasets are available in <code>anes_rng</code> (random value
imputation) and <code>anes_pmm</code> (predictive mean matching).
</p>


<h3>Source</h3>

<p><a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/24672">https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/24672</a>
</p>


<h3>References</h3>

<p>J. Kropko, B. Goodrich, A. Gelman, and J. Hill. 2014. Multiple Imputation
for Continuous and Categorical Data: Comparing Joint Multivariate Normal
and Conditional Approaches, Political Analysis 22(4):497–519.
</p>

<hr>
<h2 id='missDiag'>Comparing Observed and Imputed Values under MAR and MCAR</h2><span id='topic+missDiag'></span>

<h3>Description</h3>

<p>Function to compute discrepancy statistics comparing the (reweighted)
density of imputed and observed values. To compute the weights balancing
covariates that are part of the missing data mechanism, the function
relies on either entropy balancing or stable balancing weights.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>missDiag(
  original,
  imputed,
  formula = NULL,
  skip_n = 25,
  scale = FALSE,
  adjust = "ebal",
  use_imputed_cov = TRUE,
  convert = c("numeric"),
  categories = 3,
  verbose = 0,
  output_diag = FALSE,
  ebal_param = param_ebal(),
  sbw_param = param_sbw(),
  cobalt_param = param_cobalt()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="missDiag_+3A_original">original</code></td>
<td>
<p>data frame with missing values.</p>
</td></tr>
<tr><td><code id="missDiag_+3A_imputed">imputed</code></td>
<td>
<p>an imputed data frame, a list of imputed data frames or
a <code>mids</code> object from the <code><a href="mice.html#topic+mice">mice::mice()</a></code> package.</p>
</td></tr>
<tr><td><code id="missDiag_+3A_formula">formula</code></td>
<td>
<p>two-sided formula with the variables to compute discrepancy
statistics (right-hand side) and variables to balance (left-hand side).</p>
</td></tr>
<tr><td><code id="missDiag_+3A_skip_n">skip_n</code></td>
<td>
<p>skip variables with fewer than <code>skip_n</code> missing values.</p>
</td></tr>
<tr><td><code id="missDiag_+3A_scale">scale</code></td>
<td>
<p>scale the design matrix?</p>
</td></tr>
<tr><td><code id="missDiag_+3A_adjust">adjust</code></td>
<td>
<p>either 'none', 'sbw' or 'ebal'.</p>
</td></tr>
<tr><td><code id="missDiag_+3A_use_imputed_cov">use_imputed_cov</code></td>
<td>
<p>use imputed covariates?</p>
</td></tr>
<tr><td><code id="missDiag_+3A_convert">convert</code></td>
<td>
<p>vector of variable types to bin before coercion
(ignored if <code>use_imputed_cov=TRUE</code>).</p>
</td></tr>
<tr><td><code id="missDiag_+3A_categories">categories</code></td>
<td>
<p>how many bins (ignored if <code>use_imputed_cov=TRUE</code>).</p>
</td></tr>
<tr><td><code id="missDiag_+3A_verbose">verbose</code></td>
<td>
<p>one of three levels (0,1 or 2).</p>
</td></tr>
<tr><td><code id="missDiag_+3A_output_diag">output_diag</code></td>
<td>
<p>add covariate balance statistics to output?</p>
</td></tr>
<tr><td><code id="missDiag_+3A_ebal_param">ebal_param</code></td>
<td>
<p>list of parameters passed to <code>ebal</code>.</p>
</td></tr>
<tr><td><code id="missDiag_+3A_sbw_param">sbw_param</code></td>
<td>
<p>list of parameters passed to <code>sbw</code>.</p>
</td></tr>
<tr><td><code id="missDiag_+3A_cobalt_param">cobalt_param</code></td>
<td>
<p>list of parameters passed to <code>cobalt</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let y be a variable with observed and imputed values and let m be
a corresponding indicator if a value in y is observed (0) or imputed (1).
We use X to denote all K covariates and x_k as the k^th covariate.
</p>
<p>By default, <code>missDiag</code> computes discrepancy statistics (balance
statistics) comparing the distribution of observed and imputed values,
ie. comparing f(y|m=1) vs. f(y|m=0). The distribution are expected
to be equal under MCAR.
</p>
<p>If the data are missing at random (MAR), set <code>adjust="ebal"</code>
or <code>adjust="sbw"</code>, to construct weights to balance the
covariate distribution X before computing the discrepancy statistics.
</p>
<p>The left-hand side (lhs) of the <code>formula</code> gives the name of y while the
right-hand side (rhs) defines the covariates X to balance under MAR.
Rhs variables are transformed into a numeric matrix via the
<code><a href="stats.html#topic+model.matrix">stats::model.matrix()</a></code> function. Therefore  factor and string variables
are dummy encoded and functional transformations such as <code>log()</code>
are applied.
</p>
<p>To run <code>missDiag</code> on many y variables sequentially, supply a list
of formulas or name all y variables on the lhs separating each variable
with a &quot;|&quot;, e.g. <code>y1 | y2 ~ x1 + ... + xK</code>.
</p>
<p>If <code>formula=NULL</code>, <code>missDiag</code> runs on all variables with at
least <code>n_skip</code> missing values in <code>original</code>. Weights are
constructed such that all X covariates are balanced
(if <code>adjust!='none'</code>).
</p>
<p>If <code>use_imputed_cov=FALSE</code>, all imputed values in the covariates X
are deleted, variables are coerced to factor variables with missing
values encoded as one category. Numerical variables are binned by quantiles
before coercion. Use the parameter <code>categories</code> to define the
number of bins. By default only variables of class &quot;numeric&quot; are binned.
Use <code>convert = c("numeric", "integer")</code> to also bin integer
variables before coercion to factor variables.
</p>
<p>To balance the covariates, <code>missDiag</code> computes weights using either
the <code><a href="ebal.html#topic+ebalance">ebal::ebalance()</a></code> function or the <code><a href="sbw.html#topic+sbw">sbw::sbw()</a></code> function. These
two packages have to be installed separately by the user.
</p>
<p>To pass parameters to the <code><a href="sbw.html#topic+sbw">sbw::sbw()</a></code> or <code><a href="ebal.html#topic+ebalance">ebal::ebalance()</a></code> use the
functions <code><a href="#topic+param_sbw">param_sbw()</a></code> and <code><a href="#topic+param_sbw">param_sbw()</a></code> to generate valid parameter lists
and pass these lists via the parameters <code>sbw_param</code> or
<code>ebal_param</code>.
</p>
<p>To display information about the computations set verbose to the value
1 (some information) or 2 (more information when constructing weights).
</p>
<p>To compute the discrepancy statistics, <code>missDiag</code> relies on the function
<code><a href="cobalt.html#topic+bal.tab">cobalt::bal.tab()</a></code> from the cobalt package. To pass parameters to this
function use <code><a href="#topic+param_cobalt">param_cobalt()</a></code> to generate a valid parameter list and
pass this list via the parameter <code>cobalt_param</code>.
</p>


<h3>Value</h3>

<p>A single <code>data.frame</code> with the results for
each imputed dataset and all lhs variables.
</p>
<p>If <code>output_diag=FALSE</code>, the dataset only includes
the discrepancy statistics comparing y's observed values and
imputed values.
</p>
<p>If y is continuous, there will be exactly one row per imputed
dataset. The discrepancy statistics are reported in the
respective columns. For a categorical y cobalt
computes discrepancy statistics for all K categories which means
that there will be K rows for each imputed dataset in the
output. The label for each category is listed in <code>vname</code>.
</p>
<p>If the default settings are adopted, the dataset includes
the following discrepancy statistics for continuous variables:
</p>

<ul>
<li> <p><code>diff_adj</code>: Standardized mean difference
</p>
</li>
<li> <p><code>v_ratio_adj</code>: Variance ratio
</p>
</li>
<li> <p><code>ks_adj</code>: Kolmogorov–Smirnov statistic
</p>
</li>
<li> <p><code>ovl_adj</code>: 1-Overlap coefficient
</p>
</li></ul>

<p>No variance ratio is reported for categorical variables.
</p>
<p>If <code>output_diag=TRUE</code>, the dataset also includes
the balance statistics for all K covariates.
</p>
<p>These balance statistics are useful to diagnose if the fitted
weights are successful in balancing the covariate distribution.
</p>
<p>For these diagnostics the column <code>vname</code> lists
the covariate name (for continuous variables) or the
covariate category (for categorical variables).
</p>


<h3>References</h3>

<p>Moritz Marbach. 2021. Choosing Imputation Models.
</p>
<p>José R Zubizarreta. 2015. Stable Weights that Balance Covariates
for Estimation with Incomplete Outcome Data, Journal of the American
Statistical Association, 110(511): 910-922.
</p>
<p>Jens Hainmueller. 2012. Entropy Balancing for Causal Effects: A
Multivariate Reweighting Method to Produce Balanced Samples in
Observational Studies, Political Analysis 20(1): 25–46.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Compare random value imputation 
# with predictive mean imputation 
# under MCAR

diag_rng &lt;- missDiag( 
 original=anes08, 
 imputed=anes08_rng, 
 verbose = 1,
 adjust = 'none',
 formula = time ~ .)

diag_pmm &lt;- missDiag( 
 original=anes08, 
 imputed=anes08_pmm, 
 verbose = 1,
 adjust = 'none',
 formula = time ~ .)

# SMD: 

 mean(diag_pmm$diff_adj)
 mean(diag_rng$diff_adj)

# log(Variance ratio)
 mean(log(diag_pmm$v_ratio_adj))
 mean(log(diag_rng$v_ratio_adj))

# KS
 mean(diag_pmm$ks_adj)
 mean(diag_rng$ks_adj)

# 1-OVL
 mean(diag_pmm$ovl_adj)
 mean(diag_rng$ovl_adj)



</code></pre>

<hr>
<h2 id='param_cobalt'>Construct parameter list for cobalt</h2><span id='topic+param_cobalt'></span>

<h3>Description</h3>

<p>Construct parameter list for cobalt
</p>


<h3>Usage</h3>

<pre><code class='language-R'>param_cobalt(
  stats = c("m", "v", "ks", "ovl"),
  continuous = "std",
  binary = "std",
  abs = TRUE,
  s.d.denom = "pooled"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="param_cobalt_+3A_stats">stats</code></td>
<td>
<p>character; which statistic(s) should be reported.</p>
</td></tr>
<tr><td><code id="param_cobalt_+3A_continuous">continuous</code></td>
<td>
<p>whether mean differences for continuous variables
should be standardized (&quot;std&quot;) or raw (&quot;raw&quot;).</p>
</td></tr>
<tr><td><code id="param_cobalt_+3A_binary">binary</code></td>
<td>
<p>whether mean differences for binary variables (i.e.,
difference in proportion) should be standardized (&quot;std&quot;) or raw (&quot;raw&quot;).</p>
</td></tr>
<tr><td><code id="param_cobalt_+3A_abs">abs</code></td>
<td>
<p>logical; whether displayed balance statistics
should be in absolute value or not.</p>
</td></tr>
<tr><td><code id="param_cobalt_+3A_s.d.denom">s.d.denom</code></td>
<td>
<p>character; how the denominator for standardized
mean differences should be calculated, if requested.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For more information about these parameters, see
<code><a href="cobalt.html#topic+bal.tab">cobalt::bal.tab()</a></code>.
</p>


<h3>Value</h3>

<p>A <code>list</code> of parameters that can be passed to <code><a href="#topic+missDiag">missDiag()</a></code>.
</p>

<hr>
<h2 id='param_ebal'>Construct parameter list for ebalance</h2><span id='topic+param_ebal'></span>

<h3>Description</h3>

<p>Construct parameter list for ebalance
</p>


<h3>Usage</h3>

<pre><code class='language-R'>param_ebal(
  coefs = NULL,
  max.iterations = 200,
  base.weight = NULL,
  constraint.tolerance = 1,
  norm.constant = NULL,
  trim = FALSE,
  max.weight = NULL,
  min.weight = 0,
  max.trim.iterations = 200,
  max.weight.increment = 0.92,
  min.weight.increment = 1.08
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="param_ebal_+3A_coefs">coefs</code></td>
<td>
<p>starting values for model coefficients.</p>
</td></tr>
<tr><td><code id="param_ebal_+3A_max.iterations">max.iterations</code></td>
<td>
<p>maximum number of iterations.</p>
</td></tr>
<tr><td><code id="param_ebal_+3A_base.weight">base.weight</code></td>
<td>
<p>vector of base weights.</p>
</td></tr>
<tr><td><code id="param_ebal_+3A_constraint.tolerance">constraint.tolerance</code></td>
<td>
<p>tolerance level.</p>
</td></tr>
<tr><td><code id="param_ebal_+3A_norm.constant">norm.constant</code></td>
<td>
<p>An optional normalizing constant.</p>
</td></tr>
<tr><td><code id="param_ebal_+3A_trim">trim</code></td>
<td>
<p>trim weights via <code><a href="ebal.html#topic+ebalance.trim">ebalance.trim</a></code></p>
</td></tr>
<tr><td><code id="param_ebal_+3A_max.weight">max.weight</code></td>
<td>
<p>Target for the ratio of the maximum to mean weight.</p>
</td></tr>
<tr><td><code id="param_ebal_+3A_min.weight">min.weight</code></td>
<td>
<p>Target for the ratio of the minimum to mean weight.</p>
</td></tr>
<tr><td><code id="param_ebal_+3A_max.trim.iterations">max.trim.iterations</code></td>
<td>
<p>Maximum number of trimming iterations.</p>
</td></tr>
<tr><td><code id="param_ebal_+3A_max.weight.increment">max.weight.increment</code></td>
<td>
<p>Increment for iterative trimming of the
ratio of the maximum to mean weight.</p>
</td></tr>
<tr><td><code id="param_ebal_+3A_min.weight.increment">min.weight.increment</code></td>
<td>
<p>Increment for iterative trimming of the
ratio of the minimum to mean weight.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For more information about these parameters, see
<code><a href="ebal.html#topic+ebalance">ebal::ebalance()</a></code> and <code><a href="ebal.html#topic+ebalance.trim">ebal::ebalance.trim()</a></code>.
</p>


<h3>Value</h3>

<p>A <code>list</code> of parameters that can be passed to <code><a href="#topic+missDiag">missDiag()</a></code>.
</p>

<hr>
<h2 id='param_sbw'>Construct parameter list for sbw</h2><span id='topic+param_sbw'></span>

<h3>Description</h3>

<p>Construct parameter list for sbw
</p>


<h3>Usage</h3>

<pre><code class='language-R'>param_sbw(
  bal_alg = TRUE,
  bal_tol = 0,
  bal_std = "group",
  bal_gri = c(0.0001, 0.001, 0.002, 0.005, 0.01, 0.02, 0.05, 0.1),
  bal_sam = 1000,
  sol_nam = "quadprog"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="param_sbw_+3A_bal_alg">bal_alg</code></td>
<td>
<p>use tuning algorithm as in Wang and Zubizarreta (2020)?</p>
</td></tr>
<tr><td><code id="param_sbw_+3A_bal_tol">bal_tol</code></td>
<td>
<p>tolerance level.</p>
</td></tr>
<tr><td><code id="param_sbw_+3A_bal_std">bal_std</code></td>
<td>
<p>tolerances adjustment.</p>
</td></tr>
<tr><td><code id="param_sbw_+3A_bal_gri">bal_gri</code></td>
<td>
<p>grid of values for the tuning algorithm.</p>
</td></tr>
<tr><td><code id="param_sbw_+3A_bal_sam">bal_sam</code></td>
<td>
<p>number of replicates to be used by the tuning algorithm.</p>
</td></tr>
<tr><td><code id="param_sbw_+3A_sol_nam">sol_nam</code></td>
<td>
<p>solver name. Either &quot;cplex&quot;, &quot;gurobi&quot;, &quot;mosek&quot;,
&quot;pogs&quot;, or &quot;quadprog&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For more information about these parameters, see <code><a href="sbw.html#topic+sbw">sbw::sbw()</a></code>.
</p>


<h3>Value</h3>

<p>A <code>list</code> of parameters that can be passed to <code><a href="#topic+missDiag">missDiag()</a></code>.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
