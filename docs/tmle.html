<!DOCTYPE html><html lang="en"><head><title>Help for package tmle</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {tmle}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#tmle-package'><p>Targeted Maximum Likelihood Estimation with Super Learning</p></a></li>
<li><a href='#calcParameters'><p>Calculate Parameter Estimates (calcParameters)</p></a></li>
<li><a href='#calcSigma'><p>Calculate Variance-Covariance Matrix for MSM Parameters (calcSigma)</p></a></li>
<li><a href='#estimateG'><p>Estimate Treatment or Missingness Mechanism</p></a></li>
<li><a href='#estimateQ'>
<p>Initial Estimation of Q portion of the Likelihood</p></a></li>
<li><a href='#fev'><p>Forced Expiratory Volume (FEV) Data (fev)</p></a></li>
<li><a href='#oneStepATT'><p>Calculate Additive treatment effect among the treated (oneStepATT)</p></a></li>
<li><a href='#summary.tmle'><p>Summarization of the results of a call to the tmle routine</p></a></li>
<li><a href='#summary.tmleMSM'><p>Summarization of the results of a call to the tmleMSM function</p></a></li>
<li><a href='#tmle'><p>Targeted Maximum Likelihood Estimation</p></a></li>
<li><a href='#tmle.SL.dbarts2'><p>Super Learner wrappers for modeling and prediction using <code>bart</code> in the <code>dbarts</code> package</p></a></li>
<li><a href='#tmleMSM'>
<p>Targeted Maximum Likelihood Estimation of Parameter of MSM</p></a></li>
<li><a href='#tmleNews'><p>Show the NEWS file (tmleNews)</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Version:</td>
<td>2.0.1.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-05-14</td>
</tr>
<tr>
<td>Title:</td>
<td>Targeted Maximum Likelihood Estimation</td>
</tr>
<tr>
<td>Author:</td>
<td>Susan Gruber [aut, cre],
  Mark van der Laan [aut],
  Chris Kennedy [ctr]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Susan Gruber &lt;sgruber@cal.berkeley.edu&gt;</td>
</tr>
<tr>
<td>Copyright:</td>
<td>Copyright 2012. The Regents of the University of California
(Regents). All Rights Reserved.</td>
</tr>
<tr>
<td>Depends:</td>
<td>glmnet, SuperLearner (&ge; 2.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>dbarts (&ge; 0.9-18), gam (&ge; 1.15), ROCR (&ge; 1.0-7),
WeightedROC</td>
</tr>
<tr>
<td>Description:</td>
<td>Targeted maximum likelihood estimation of point treatment effects (Targeted Maximum Likelihood Learning, The International Journal of Biostatistics, 2(1), 2006.  This version automatically estimates the additive treatment effect among the treated (ATT) and among the controls (ATC).  The tmle() function calculates the adjusted marginal difference in mean outcome associated with a binary point treatment, for continuous or binary outcomes.  Relative risk and odds ratio estimates are also reported for binary outcomes. Missingness in the outcome is allowed, but not in treatment assignment or baseline covariate values.  The population mean is calculated when there is missingness, and no variation in the treatment assignment. The tmleMSM() function estimates the parameters of a marginal structural model for a binary point treatment effect. Effect estimation stratified by a binary mediating variable is also available. An ID argument can be used to identify repeated measures. Default settings call 'SuperLearner' to estimate the Q and g portions of the likelihood, unless values or a user-supplied regression function are passed in as arguments. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/BSD-3-Clause">BSD_3_clause</a> + file LICENSE | <a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://CRAN.R-project.org/package=tmle">https://CRAN.R-project.org/package=tmle</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-05-28 13:14:22 UTC; susan</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-05-28 14:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='tmle-package'>Targeted Maximum Likelihood Estimation with Super Learning</h2><span id='topic+tmle-package'></span>

<h3>Description</h3>

<p>Targeted maximum likelihood estimation of marginal treatment effect of a binary point treatment on a continuous or binary outcome, adjusting for baseline covariates (ATE: entire population, ATT: treated population, ATC: control population). Missingness in the outcome is accounted for in the estimation procedure. The population mean outcome is calculated when there is missingness and no treatment.  Controlled direct effect estimation is available, and MSM parameter estimation for binary point treatment effects. Optional data-adaptive estimation of <em>Q</em> and <em>g</em> portions of the likelihood using the <code>SuperLearner</code> package is strongly encouraged.</p>


<h3>Author(s)</h3>

<p>Susan Gruber, in collaboration with Mark van der Laan.
</p>
<p>Maintainer: Susan Gruber, <a href="mailto:sgruber@cal.berkeley.edu">sgruber@cal.berkeley.edu</a>
</p>


<h3>References</h3>

<p>1. Gruber, S. and van der Laan, M.J. (2012), tmle: An R Package for Targeted Maximum Likelihood Estimation. <em>Journal of Statistical Software</em>, 51(13), 1-35. <a href="https://www.jstatsoft.org/v51/i13/">https://www.jstatsoft.org/v51/i13/</a>
</p>
<p>2. Gruber, S. and van der Laan, M.J. (2009), Targeted Maximum Likelihood Estimation: A Gentle Introduction. <em>U.C. Berkeley Division of Biostatistics Working Paper Series</em>.  Working Paper 252.  <a href="https://biostats.bepress.com/ucbbiostat/paper252/">https://biostats.bepress.com/ucbbiostat/paper252/</a>
</p>
<p>3. Gruber, S. and van der Laan, M.J.  (2010), A Targeted Maximum Likelihood Estimator of a Causal Effect on a Bounded Continuous Outcome. <em>The International Journal of Biostatistics</em>, 6(1), 2010.
</p>
<p>4. Rosenblum, M. and van der Laan, M.J. (2010).Targeted Maximum Likelihood Estimation of the Parameter of a Marginal Structural Model. <em>The International Journal of Biostatistics</em>, 6(2), 2010.
</p>
<p>5. van der Laan, M.J. and Rubin, D. (2006), Targeted Maximum Likelihood Learning. <em>The International Journal of Biostatistics</em>, 2(1).
</p>
<p>6. van der Laan, M.J., Rose, S., and Gruber,S., editors, (2009) Readings in Targeted Maximum Likelihood Estimation . <em>U.C. Berkeley Division of Biostatistics Working Paper Series</em>.  Working Paper 254. <a href="https://biostats.bepress.com/ucbbiostat/paper254/">https://biostats.bepress.com/ucbbiostat/paper254/</a>
</p>
<p>7. van der Laan, M.J. and Gruber S. (2016), One-Step Targeted Minimum Loss-based Estimation Based on Universal Least Favorable One-Dimensional Submodels. <em>The International Journal of Biostatistics</em>, 12 (1), 351-378.
</p>
<p>8. Gruber, S., Phillips, R.V., Lee, H., van der Laan, M.J. Data-Adaptive Selection of the Propensity Score Truncation Level for Inverse Probability Weighted and Targeted Maximum Likelihood Estimators of Marginal Point Treatment Effects. <em>American Journal of Epidemiology</em> 2022; 191(9), 1640-1651.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+tmle">tmle</a></code>,
<code><a href="#topic+tmleMSM">tmleMSM</a></code>
</p>

<hr>
<h2 id='calcParameters'>Calculate Parameter Estimates (calcParameters)</h2><span id='topic+calcParameters'></span>

<h3>Description</h3>

<p>An internal function called by the <code>tmle</code> function to calculate the population mean effect when there is missingness in the data, but no treatment assignment.  When observations are in treatment and control groups, estimates the additive treatment effect among the entire population (ATE), among the treated (ATT), and among the controls (ATC). If the outcome is binary, also the relative risk and odds ratio parameters.  P-values and 95% confidence intervals are also calculated (on the log scale for RR and OR).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calcParameters(Y, A, I.Z, Delta, g1W, g0W, Q, mu1, mu0, id, family, 
	       obsWeights, alpha.sig=0.05, ICflag=TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calcParameters_+3A_y">Y</code></td>
<td>
<p>continuous or binary outcome variable</p>
</td></tr>
<tr><td><code id="calcParameters_+3A_a">A</code></td>
<td>
<p>binary treatment indicator, <code>1</code> - treatment, <code>0</code> - control</p>
</td></tr>
<tr><td><code id="calcParameters_+3A_i.z">I.Z</code></td>
<td>
<p>Indicator Z=z, needed for CDE estimation</p>
</td></tr>
<tr><td><code id="calcParameters_+3A_delta">Delta</code></td>
<td>
<p>indicator of missing outcome. <code>1</code> - observed, <code>0</code> - missing</p>
</td></tr>
<tr><td><code id="calcParameters_+3A_g1w">g1W</code></td>
<td>
<p>censoring mechanism estimates, <code class="reqn">P(A=1|W) \times P(Delta=1|A,W)</code></p>
</td></tr>
<tr><td><code id="calcParameters_+3A_g0w">g0W</code></td>
<td>
<p>censoring mechanism estimates, <code class="reqn">P(A=0|W) \times P(Delta=1|A,W)</code></p>
</td></tr>
<tr><td><code id="calcParameters_+3A_q">Q</code></td>
<td>
<p>a 3-column matrix <code>(Q(A,W), Q(1,W), Q(0,W))</code></p>
</td></tr>
<tr><td><code id="calcParameters_+3A_mu1">mu1</code></td>
<td>
<p>targeted estimate of <code class="reqn">E(Y|A=1,W)</code></p>
</td></tr>
<tr><td><code id="calcParameters_+3A_mu0">mu0</code></td>
<td>
<p>targeted estimate of <code class="reqn">E(Y|A=0,W)</code></p>
</td></tr>
<tr><td><code id="calcParameters_+3A_id">id</code></td>
<td>
<p>subject identifier</p>
</td></tr>
<tr><td><code id="calcParameters_+3A_family">family</code></td>
<td>
<p>family specification for regressions, generally &lsquo;gaussian&rsquo; for continuous outcomes, &lsquo;binomial&rsquo; for binary outcomes</p>
</td></tr>
<tr><td><code id="calcParameters_+3A_obsweights">obsWeights</code></td>
<td>
<p>sampling weights</p>
</td></tr>
<tr><td><code id="calcParameters_+3A_alpha.sig">alpha.sig</code></td>
<td>
<p>significance level for constructing CIs. Default = 0.05</p>
</td></tr>
<tr><td><code id="calcParameters_+3A_icflag">ICflag</code></td>
<td>
<p>set to FALSE to skip evaluating IC-based variance</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>EY1</code></td>
<td>
<p>Population mean outcome estimate, variance, p-value, 95% confidence interval (missingness only, no treatment assignment), or <code>NULL</code></p>
</td></tr>
<tr><td><code>ATE</code></td>
<td>
<p>additive treatment effect estimate, variance, p-value, 95% confidence interval, or <code>NULL</code></p>
</td></tr>
<tr><td><code>RR</code></td>
<td>
<p>relative risk estimate, p-value, 95% confidence interval, log(RR), variance(log(RR)), or <code>NULL</code></p>
</td></tr>
<tr><td><code>OR</code></td>
<td>
<p>odds ratio estimate, p-value, 95% confidence interval, log(OR), variance(log(OR)), or <code>NULL</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Susan Gruber</p>


<h3>See Also</h3>

<p><code><a href="#topic+tmle">tmle</a></code>,
<code><a href="#topic+estimateQ">estimateQ</a></code>,
<code><a href="#topic+estimateG">estimateG</a></code>,
<code><a href="#topic+tmleMSM">tmleMSM</a></code>,
<code><a href="#topic+calcSigma">calcSigma</a></code>
</p>

<hr>
<h2 id='calcSigma'>Calculate Variance-Covariance Matrix for MSM Parameters (calcSigma)</h2><span id='topic+calcSigma'></span>

<h3>Description</h3>

<p>An internal function called by the <code>tmleMSM</code> function to calculate the variance-covariance matrix of the 
parameter estimates based on the influence curve of the specified MSM.</p>


<h3>Usage</h3>

<pre><code class='language-R'>calcSigma(hAV, gAVW, Y, Q, mAV, covar.MSM, covar.MSMA0, covar.MSMA1, I.V, 
     Delta, ub, id, family)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calcSigma_+3A_hav">hAV</code></td>
<td>
<p>values used in numerator of weights applied to the estimation procedure</p>
</td></tr>
<tr><td><code id="calcSigma_+3A_gavw">gAVW</code></td>
<td>
<p><code class="reqn">P(A=a | V,W,T)*P(Delta=1 | A,V,W,T)</code></p>
</td></tr>
<tr><td><code id="calcSigma_+3A_y">Y</code></td>
<td>
<p>continuous or binary outcome variable</p>
</td></tr>
<tr><td><code id="calcSigma_+3A_q">Q</code></td>
<td>
<p>estimated <code class="reqn">P(Y | A, V, W, T, Delta=1)</code>, typically targeted values <code>Q*</code> are passed in</p>
</td></tr>
<tr><td><code id="calcSigma_+3A_mav">mAV</code></td>
<td>
<p>predicted values for <code class="reqn">EY1</code> from the MSM using the targeted estimates for <code class="reqn">psi</code></p>
</td></tr>
<tr><td><code id="calcSigma_+3A_covar.msm">covar.MSM</code></td>
<td>
<p>covariate values used as predictors for the MSM when <code>A=a</code></p>
</td></tr>
<tr><td><code id="calcSigma_+3A_covar.msma0">covar.MSMA0</code></td>
<td>
<p>covariate values used as predictors for the MSM when <code>A=0</code></p>
</td></tr>
<tr><td><code id="calcSigma_+3A_covar.msma1">covar.MSMA1</code></td>
<td>
<p>covariate values used as predictors for the MSM when <code>A=1</code></p>
</td></tr>
<tr><td><code id="calcSigma_+3A_i.v">I.V</code></td>
<td>
<p>indicator that observation is in stratum of interest</p>
</td></tr> 
<tr><td><code id="calcSigma_+3A_delta">Delta</code></td>
<td>
<p>indicator of missing outcome. <code>1</code> - observed, <code>0</code> - missing</p>
</td></tr>
<tr><td><code id="calcSigma_+3A_ub">ub</code></td>
<td>
<p>upper bound on weights</p>
</td></tr>
<tr><td><code id="calcSigma_+3A_id">id</code></td>
<td>
<p>subject identifier</p>
</td></tr>
<tr><td><code id="calcSigma_+3A_family">family</code></td>
<td>
<p>&lsquo;gaussian&rsquo; for continuous outcomes, &lsquo;binomial&rsquo; for binary outcomes</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>sigma</code></td>
<td>
<p>influence-curve based variance-covariance matrix. See Rosenblum&amp;vanderLaan2010 for details.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Susan Gruber</p>


<h3>See Also</h3>

<p><code><a href="#topic+tmle">tmle</a></code>,
<code><a href="#topic+estimateQ">estimateQ</a></code>,
<code><a href="#topic+estimateG">estimateG</a></code>,
<code><a href="#topic+tmleMSM">tmleMSM</a></code>
</p>

<hr>
<h2 id='estimateG'>Estimate Treatment or Missingness Mechanism</h2><span id='topic+estimateG'></span>

<h3>Description</h3>

<p>An internal function called by the <code>tmle</code> function to obtain an estimate of conditional treatment assignment probabiliites <code class="reqn">P(A=1|W)</code>, and conditional probabilites for missingness, <code class="reqn">P(Delta=1|A,W)</code>.  The estimate can be  based on user-supplied values, a user-supplied regression formula, or a data-adaptive super learner fit.  If the <code>SuperLearner</code> package is not available, and there are no user-specifications, estimation is carried out using main terms regression with <code>glm</code>.  These main terms-based estimates may yield poor results.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimateG(d, g1W, gform, SL.library, id, V, verbose, message, 
	outcome="A", newdata=d, discreteSL, obsWeights)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimateG_+3A_d">d</code></td>
<td>
<p>dataframe with binary dependent variable in the first column, predictors in remaining columns</p>
</td></tr>
<tr><td><code id="estimateG_+3A_g1w">g1W</code></td>
<td>
<p>vector of values for <code class="reqn">P(A=1|W)</code>, <code class="reqn">P(Z=1|A,W)</code>, or <code class="reqn">P(Delta=1|Z,A,W)</code></p>
</td></tr>
<tr><td><code id="estimateG_+3A_gform">gform</code></td>
<td>
<p>regression formula of the form <code>A~W1</code>, (dependent variable is one of <code class="reqn">A,Z,D</code>) if specified this overrides the call to <code>SuperLearner</code></p>
</td></tr>
<tr><td><code id="estimateG_+3A_sl.library">SL.library</code></td>
<td>
<p>vector of prediction algorithms used by <code>SuperLearner</code>, default value is (&lsquo;SL.glm&rsquo;, &lsquo;tmle.SL.dbarts.k.5&rsquo;, &lsquo;SL.gam&rsquo;)</p>
</td></tr>
<tr><td><code id="estimateG_+3A_id">id</code></td>
<td>
<p>subject identifier</p>
</td></tr>
<tr><td><code id="estimateG_+3A_v">V</code></td>
<td>
<p>Number of cross validation folds for Super Learning</p>
</td></tr>
<tr><td><code id="estimateG_+3A_verbose">verbose</code></td>
<td>
<p>status messages printed if set to TRUE</p>
</td></tr>
<tr><td><code id="estimateG_+3A_message">message</code></td>
<td>
<p>text specifies whether treatment or missingness mechanism is being estimated</p>
</td></tr>
<tr><td><code id="estimateG_+3A_outcome">outcome</code></td>
<td>
<p><code>A, D, Z</code> to indicate which quantity is being estimated.</p>
</td></tr>
<tr><td><code id="estimateG_+3A_newdata">newdata</code></td>
<td>
<p>optional dataset to be used for prediction after fitting on <code>d</code>.</p>
</td></tr>
<tr><td><code id="estimateG_+3A_discretesl">discreteSL</code></td>
<td>
<p>If true, returns discrete SL estimates, otherwise ensemble estimates. Ignored when SL is not used.</p>
</td></tr>
<tr><td><code id="estimateG_+3A_obsweights">obsWeights</code></td>
<td>
<p>sampling weights</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>g1W</code></td>
<td>
<p>a vector containing values for <code class="reqn">P(A=1|W)</code>, matrix for <code class="reqn">P(Z=1|A,W)</code>, evaluated at A=0, A=1, or matrix <code class="reqn">P(Delta=1|Z,A,W))</code> evaluated at (0,0), (0,1), (1,0), (1,1)</p>
</td></tr>
<tr><td><code>coef</code></td>
<td>
<p>coefficients for each term in the working model used for estimation if <code>glm</code> was used</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>estimation procedure</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Susan Gruber</p>


<h3>See Also</h3>

<p><code><a href="#topic+tmle">tmle</a></code>,
<code><a href="#topic+estimateQ">estimateQ</a></code>,
<code><a href="#topic+calcParameters">calcParameters</a></code>,
<code><a href="#topic+tmleMSM">tmleMSM</a></code>,
<code><a href="#topic+calcSigma">calcSigma</a></code>
</p>

<hr>
<h2 id='estimateQ'>
Initial Estimation of Q portion of the Likelihood</h2><span id='topic+estimateQ'></span>

<h3>Description</h3>

<p>An internal function called by the <code>tmle</code> function to obtain an initial estimate of the <code class="reqn">Q</code> portion of the likelihood based on user-supplied matrix values for predicted values of (counterfactual outcomes) <code>Q(0,W),Q(1,W)</code>, or a user-supplied regression formula, or based on a data-adaptively selected  <code>SuperLearner</code> fit.  In the absence of user-supplied values, a user-supplied regression formula takes precedence over data-adaptive super-learning. The default is to return cross-validated predictions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimateQ(Y, Z, A, W, Delta, Q, Qbounds, Qform, maptoYstar, SL.library, cvQinit, 
    family, id, V, verbose, discreteSL, obsWeights)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimateQ_+3A_y">Y</code></td>
<td>
<p>continuous or binary outcome variable</p>
</td></tr>
<tr><td><code id="estimateQ_+3A_z">Z</code></td>
<td>
<p>optional binary indicator for intermediate covariate for conrolled direct effect estimation</p>
</td></tr>
<tr><td><code id="estimateQ_+3A_a">A</code></td>
<td>
<p>binary treatment indicator, <code>1</code> - treatment, <code>0</code> - control</p>
</td></tr>
<tr><td><code id="estimateQ_+3A_w">W</code></td>
<td>
<p>vector, matrix, or dataframe containing baseline covariates</p>
</td></tr>
<tr><td><code id="estimateQ_+3A_delta">Delta</code></td>
<td>
<p>indicator of missing outcome. <code>1</code> - observed, <code>0</code> - missing</p>
</td></tr>
<tr><td><code id="estimateQ_+3A_q">Q</code></td>
<td>
<p>3-column matrix <code>(Q(A,W), Q(0,W), Q(1,W))</code></p>
</td></tr>
<tr><td><code id="estimateQ_+3A_qbounds">Qbounds</code></td>
<td>
<p>Bounds on predicted values for <code>Q</code>, set to <code>alpha</code> for logistic fluctuation, or <code>range(Y)</code> if not user-supplied</p>
</td></tr>
<tr><td><code id="estimateQ_+3A_qform">Qform</code></td>
<td>
<p>regression formula of the form <code>Y~A+W</code></p>
</td></tr>
<tr><td><code id="estimateQ_+3A_maptoystar">maptoYstar</code></td>
<td>
<p>if <code>TRUE</code> indicates continuous <code>Y</code> values should be shifted and scaled to fall between (0,1)</p>
</td></tr>
<tr><td><code id="estimateQ_+3A_sl.library">SL.library</code></td>
<td>
<p>specification of prediction algorithms, default is (&lsquo;SL.glm&rsquo;, &lsquo;SL.glmnet&rsquo;, &lsquo;tmle.SL.dbarts2&rsquo;). In practice, including more prediction algorithms in the library improves results.</p>
</td></tr>
<tr><td><code id="estimateQ_+3A_cvqinit">cvQinit</code></td>
<td>
<p>logical, whether or not to estimate cross-validated values for initial <code>Q</code>, default=<code>TRUE</code></p>
</td></tr>
<tr><td><code id="estimateQ_+3A_family">family</code></td>
<td>
<p>family specification for regressions, generally &lsquo;gaussian&rsquo; for continuous oucomes, &lsquo;binomial&rsquo; for binary outcomes</p>
</td></tr>
<tr><td><code id="estimateQ_+3A_id">id</code></td>
<td>
<p>subject identifier</p>
</td></tr>
<tr><td><code id="estimateQ_+3A_v">V</code></td>
<td>
<p>Number of cross-validation folds for Super Learning</p>
</td></tr>
<tr><td><code id="estimateQ_+3A_verbose">verbose</code></td>
<td>
<p>status message printed if set to <code>TRUE</code></p>
</td></tr>
<tr><td><code id="estimateQ_+3A_discretesl">discreteSL</code></td>
<td>
<p>If true, returns discrete SL estimates, otherwise ensemble estimates. Ignored when SL is not used.</p>
</td></tr>
<tr><td><code id="estimateQ_+3A_obsweights">obsWeights</code></td>
<td>
<p>sampling weights</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>Q</code></td>
<td>
<p><code class="reqn">nx3</code> matrix, columns contain the initial estimate of <code class="reqn">[Q(A,W)=E(Y|A=a,W), Q(0,W)=E(Y|A=0,W), Q(1,W)=E(Y|A=1,W)]</code>. For controlled direct estimation, <code class="reqn">nx5</code> matrix, <code class="reqn">E(Y|Z,A,W)</code>, evaluated at <code class="reqn">(z,a), (0,0), (0,1), (1,0), (1,1)</code> on scale of linear predictors</p>
</td></tr>
<tr><td><code>Qfamily</code></td>
<td>
<p>&lsquo;binomial&rsquo; for targeting with logistic fluctuation, &lsquo;gaussian&rsquo; for linear fluctuation</p>
</td></tr>
<tr><td><code>coef</code></td>
<td>
<p>coefficients for each term in working model used for initial estimation of <code>Q</code> if <code>glm</code> used.</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>type of estimation procedure</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Susan Gruber</p>


<h3>See Also</h3>

<p><code><a href="#topic+tmle">tmle</a></code>,
<code><a href="#topic+estimateG">estimateG</a></code>,
<code><a href="#topic+calcParameters">calcParameters</a></code>,
<code><a href="#topic+tmleMSM">tmleMSM</a></code>,
<code><a href="#topic+calcSigma">calcSigma</a></code>
</p>

<hr>
<h2 id='fev'>Forced Expiratory Volume (FEV) Data (fev)</h2><span id='topic+fev'></span>

<h3>Description</h3>

<p>Sample of 654 youths, aged 3 to 19, in the area of East Boston
during middle to late 1970's. Interest concerns the relationship
between smoking and FEV. Since the study is necessarily
observational, statistical adjustment via regression models
clarifies the relationship.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(fev)</code></pre>


<h3>Format</h3>

<p>A data frame with 654 observations on the following 5 variables.
</p>

<dl>
<dt><code>age</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>fev</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>ht</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>sex</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>smoke</code></dt><dd><p>a numeric vector</p>
</dd>
</dl>



<h3>Source</h3>

<p>Kahn M (2005). An Exhalent Problem for Teaching Statistics. The Journal of Statistical Education, 13(2).
</p>
<p>Rosner, B. (1999), Fundamentals of Biostatistics, 5th Ed., Pacific Grove, CA: Duxbury.
</p>

<hr>
<h2 id='oneStepATT'>Calculate Additive treatment effect among the treated (oneStepATT)</h2><span id='topic+oneStepATT'></span>

<h3>Description</h3>

<p>An internal function called by the <code>tmle</code> function to calculate the additive treatment effect among the treated (ATT) using a universal least favorable submodel (on the transformed scale if outcomes are continuous). The function is called a second time with updated arguments to calculate the additive treatment effect among the controls (ATC). Missingness in the outcome data is allowed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>oneStepATT(Y, A, Delta, Q, g1W, pDelta1, depsilon, max_iter, gbounds, Qbounds, obsWeights)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="oneStepATT_+3A_y">Y</code></td>
<td>
<p>continuous or binary outcome variable</p>
</td></tr>
<tr><td><code id="oneStepATT_+3A_a">A</code></td>
<td>
<p>binary treatment indicator, <code>1</code> - treatment, <code>0</code> - control</p>
</td></tr>
<tr><td><code id="oneStepATT_+3A_delta">Delta</code></td>
<td>
<p>indicator of missing outcome. <code>1</code> - observed, <code>0</code> - missing</p>
</td></tr>
<tr><td><code id="oneStepATT_+3A_q">Q</code></td>
<td>
<p>a 3-column matrix <code>(Q(A,W), Q(1,W), Q(0,W))</code></p>
</td></tr>
<tr><td><code id="oneStepATT_+3A_g1w">g1W</code></td>
<td>
<p>treatment mechanism estimates, <code class="reqn">P(A=1|W)</code></p>
</td></tr>
<tr><td><code id="oneStepATT_+3A_pdelta1">pDelta1</code></td>
<td>
<p>censoring mechanism estimates, a 2-column matrix [<code class="reqn">P(Delta=1|A=0,W)</code>, <code class="reqn">P(Delta=1|A=1,W)</code>]</p>
</td></tr>
<tr><td><code id="oneStepATT_+3A_depsilon">depsilon</code></td>
<td>
<p>step size for delta moves, set to 0.001</p>
</td></tr>
<tr><td><code id="oneStepATT_+3A_max_iter">max_iter</code></td>
<td>
<p>maximum number of iterations before terminating without convergence</p>
</td></tr>
<tr><td><code id="oneStepATT_+3A_gbounds">gbounds</code></td>
<td>
<p>bounds on the propensity score for untreated subjects</p>
</td></tr>
<tr><td><code id="oneStepATT_+3A_qbounds">Qbounds</code></td>
<td>
<p>alpha bounds on the logit scale</p>
</td></tr>
<tr><td><code id="oneStepATT_+3A_obsweights">obsWeights</code></td>
<td>
<p>sampling weights</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>psi</code></td>
<td>
<p>effect estimate (on the transformed scale for continuous outcomes)</p>
</td></tr>
<tr><td><code>IC</code></td>
<td>
<p>influence function</p>
</td></tr>
<tr><td><code>conv</code></td>
<td>
<p>TRUE if procedure converged, FALSE otherwise</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Susan Gruber</p>


<h3>See Also</h3>

<p><code><a href="#topic+tmle">tmle</a></code>,
</p>

<hr>
<h2 id='summary.tmle'>Summarization of the results of a call to the tmle routine</h2><span id='topic+summary.tmle'></span><span id='topic+print.summary.tmle'></span><span id='topic+print.tmle'></span><span id='topic+summary.tmle.list'></span><span id='topic+print.summary.tmle.list'></span><span id='topic+print.tmle.list'></span>

<h3>Description</h3>

<p>These functions are all <a href="utils.html#topic+methods">methods</a> for class <code>tmle</code>, <code>tmle.list</code>, <code>summary.tmle</code>, <code>summary.tmle.list</code> objects</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'tmle'
summary(object, ...)
## S3 method for class 'tmle.list'
summary(object, ...)
## S3 method for class 'tmle'
print(x, ...)
## S3 method for class 'tmle.list'
print(x, ...)
## S3 method for class 'summary.tmle'
print(x, ...)
## S3 method for class 'summary.tmle.list'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.tmle_+3A_object">object</code></td>
<td>
<p>an object of class <code>tmle</code> or <code>tmle.list</code>.</p>
</td></tr> 
<tr><td><code id="summary.tmle_+3A_x">x</code></td>
<td>
<p>an object of class <code>tmle</code> or <code>tmle.list</code> for summary functions, class <code>summary.tmle</code> or <code>summary.tmle.list</code> for print functions.</p>
</td></tr>
<tr><td><code id="summary.tmle_+3A_...">...</code></td>
<td>
<p>currently ignored.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>print.tmle</code> prints the estimate, variance, p-value, and 95% confidence interval only.  <code>print.summary.tmle</code>, called indirectly by entering the command <kbd>summary(result)</kbd> (where <code>result</code> has class <code>tmle</code>), outputs additional information.  Controlled direct effect estimates have class <code>tmle.list</code>,  a list of two objects of class <code>tmle</code>.  The first item corresponds to <code class="reqn">Z=0</code>, the second to <code class="reqn">Z=1</code></p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>estimates</code></td>
<td>
<p>list of parameter estimates, pvalues, and 95% confidence intervals</p>
</td></tr>
<tr><td><code>Qmodel</code></td>
<td>
<p>working model used to obtain initial estimate of <code>Q</code> portion of the likelihood, if <code>glm</code> used</p>
</td></tr>
<tr><td><code>Qterms</code></td>
<td>
<p>terms in the model for <code>Q</code></p>
</td></tr>
<tr><td><code>Qcoef</code></td>
<td>
<p>coefficient of each term in model for <code>Q</code></p>
</td></tr>
<tr><td><code>gmodel</code></td>
<td>
<p>model used to estimate treatment mechanism <code>g</code></p>
</td></tr>
<tr><td><code>gterms</code></td>
<td>
<p>terms in the treatment mechanism model</p>
</td></tr>
<tr><td><code>gcoef</code></td>
<td>
<p>coefficient of each term in model for treatment mechanism</p>
</td></tr>
<tr><td><code>gtype</code></td>
<td>
<p>description of estimation procedure for treatment mechanism, e.g. &quot;SuperLearner&quot;</p>
</td></tr>
<tr><td><code>gdiscreteSL</code></td>
<td>
<p>flag indicating whether discrete SL or ensemble SL was used for treatment mechanism estimation</p>
</td></tr>
<tr><td><code>g.Zmodel</code></td>
<td>
<p>model used to estimate intermediate variable assignment mechanism <code>g.Z</code></p>
</td></tr>
<tr><td><code>g.Zterms</code></td>
<td>
<p>terms in the intermediate mechanism model</p>
</td></tr>
<tr><td><code>g.Zcoef</code></td>
<td>
<p>coefficient of each term in model for intermediate mechanism</p>
</td></tr>
<tr><td><code>g.Ztype</code></td>
<td>
<p>description of estimation procedure for intermediate variable</p>
</td></tr>
<tr><td><code>g.ZdiscreteSL</code></td>
<td>
<p>flag indicating whether discrete SL or ensemble SL was used for intermediate variable estimation</p>
</td></tr>
<tr><td><code>g.Deltamodel</code></td>
<td>
<p>model used to estimate missingness mechanism <code>g.Delta</code></p>
</td></tr>
<tr><td><code>g.Deltaterms</code></td>
<td>
<p>terms in the missingness mechanism model</p>
</td></tr>
<tr><td><code>g.Deltacoef</code></td>
<td>
<p>coefficient of each term in model for missingness mechanism</p>
</td></tr>
<tr><td><code>g.Deltatype</code></td>
<td>
<p>description of estimation procedure for missingness</p>
</td></tr>
<tr><td><code>g.DeltadiscreteSL</code></td>
<td>
<p>flag indicating whether discrete SL or ensemble SL was used for missingness estimation</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Susan Gruber</p>


<h3>See Also</h3>

<p><code><a href="#topic+tmle">tmle</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># generate data
  set.seed(10)
  n &lt;- 500
  W &lt;- matrix(rnorm(n*3), ncol=3)
  A &lt;- rbinom(n,1, 1/(1+exp(-(.1*W[,1] - .1*W[,2] + .5*W[,3]))))
  Y &lt;- A + 2*W[,1] + W[,3] + W[,2]^2 + rnorm(n)
  colnames(W) &lt;- paste("W",1:3, sep="")

  result &lt;- tmle(Y,A,W, Qform="Y~A+W1", g1W=rep(.5, n))
  summary(result)
</code></pre>

<hr>
<h2 id='summary.tmleMSM'>Summarization of the results of a call to the tmleMSM function</h2><span id='topic+summary.tmleMSM'></span><span id='topic+print.summary.tmleMSM'></span><span id='topic+print.tmleMSM'></span>

<h3>Description</h3>

<p>These functions are all <a href="utils.html#topic+methods">methods</a> for class <code>tmleMSM</code>, <code>summary.tmleMSM</code> objects</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'tmleMSM'
summary(object, ...)
## S3 method for class 'tmleMSM'
print(x, ...)
## S3 method for class 'summary.tmleMSM'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.tmleMSM_+3A_object">object</code></td>
<td>
<p>an object of class <code>tmleMSM</code>.</p>
</td></tr> 
<tr><td><code id="summary.tmleMSM_+3A_x">x</code></td>
<td>
<p>an object of class <code>tmleMSM</code> for summary functions, class <code>summary.tmleMSM</code> for print functions.</p>
</td></tr>
<tr><td><code id="summary.tmleMSM_+3A_...">...</code></td>
<td>
<p>currently ignored.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>print.tmleMSM</code> prints the estimate, standard error, p-value, and 95% confidence interval only.  <code>print.summary.tmleMSM</code>, called indirectly by entering the command <kbd>summary(result)</kbd> (where <code>result</code> has class <code>tmleMSM</code>), outputs additional information.</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>estimates</code></td>
<td>
<p>matrix of MSM parameter estimates, standard errors, pvalues, upper and lower bounds on 95% confidence intervals</p>
</td></tr>
<tr><td><code>sigma</code></td>
<td>
<p>variance-covariance matrix</p>
</td></tr>
<tr><td><code>Qmodel</code></td>
<td>
<p>working model used to obtain initial estimate of <code>Q</code> portion of the likelihood, if <code>glm</code> used</p>
</td></tr>
<tr><td><code>Qterms</code></td>
<td>
<p>terms in the model for <code>Q</code></p>
</td></tr>
<tr><td><code>Qcoef</code></td>
<td>
<p>coefficient of each term in model for <code>Q</code></p>
</td></tr>
<tr><td><code>gmodel</code></td>
<td>
<p>model used to estimate treatment mechanism <code>g</code></p>
</td></tr>
<tr><td><code>gterms</code></td>
<td>
<p>terms in the treatment mechanism model</p>
</td></tr>
<tr><td><code>gcoef</code></td>
<td>
<p>coefficient of each term in model for treatment mechanism</p>
</td></tr>
<tr><td><code>gtype</code></td>
<td>
<p>description of estimation procedure for treatment mechanism, e.g. &quot;SuperLearner&quot;</p>
</td></tr>
<tr><td><code>g.AVmodel</code></td>
<td>
<p>model used to estimate h(A,V) (or h(A,T))</p>
</td></tr>
<tr><td><code>g.AVterms</code></td>
<td>
<p>terms in the model for h(A,V)</p>
</td></tr>
<tr><td><code>g.AVcoef</code></td>
<td>
<p>coefficient of each term in model for h(A,V)</p>
</td></tr>
<tr><td><code>g.AVtype</code></td>
<td>
<p>description of estimation procedure for h(A,V)</p>
</td></tr>
<tr><td><code>g.Deltamodel</code></td>
<td>
<p>model used to estimate missingness mechanism <code>g.Delta</code></p>
</td></tr>
<tr><td><code>g.Deltaterms</code></td>
<td>
<p>terms in the missingness mechanism model</p>
</td></tr>
<tr><td><code>g.Deltacoef</code></td>
<td>
<p>coefficient of each term in model for missingness mechanism</p>
</td></tr>
<tr><td><code>g.Deltatype</code></td>
<td>
<p>description of estimation procedure for missingness</p>
</td></tr>
<tr><td><code>psi.Qinit</code></td>
<td>
<p>MSM parameter estimates based on initial (untargeted) estimated <code>Q</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Susan Gruber</p>


<h3>See Also</h3>

<p><code><a href="#topic+tmleMSM">tmleMSM</a></code>
</p>

<hr>
<h2 id='tmle'>Targeted Maximum Likelihood Estimation</h2><span id='topic+tmle'></span>

<h3>Description</h3>

<p>Targeted maximum likelihood estimation of parameters of a marginal structural model, and of marginal treatment effects of a binary point treatment on an outcome. In addition to the additive treatment effect, risk ratio and odds ratio estimates are reported for binary outcomes. The <code>tmle</code> function is generally called with arguments <code>(Y,A,W)</code>, where  <code>Y</code> is a continuous or binary outcome variable, <code>A</code> is a binary treatment variable, (<code>A=1</code> for treatment, <code>A=0</code> for control), and <code>W</code> is a matrix or dataframe of baseline covariates. The population mean outcome is calculated when there is no variation in <code>A</code>. If values of binary mediating variable <code>Z</code> are supplied, estimates are returned at each level of <code>Z</code>. Missingness in the outcome is accounted for in the estimation procedure if missingness indicator <code>Delta</code> is 0 for some observations.  Repeated measures can be identified using the <code>id</code> argument. Option to adjust for biased sampling using the <code>obsWeights</code> argument. Targeted bootstrap inference can be obtained in addition to IC-based inference by setting <code>B</code> to a value greater than 1 (10,000 recommended for analyses requiring high precision).</p>


<h3>Usage</h3>

<pre><code class='language-R'>tmle(Y, A, W, Z=NULL, Delta = rep(1,length(Y)), Q = NULL, Q.Z1 = NULL, Qform = NULL, 
     Qbounds = NULL, Q.SL.library = c("SL.glm", "tmle.SL.dbarts2", "SL.glmnet"), 
     cvQinit = TRUE, g1W = NULL, gform = NULL, 
     gbound = NULL,  pZ1=NULL,
     g.Zform = NULL, pDelta1 = NULL, g.Deltaform = NULL, 
     g.SL.library = c("SL.glm", "tmle.SL.dbarts.k.5", "SL.gam"),
     g.Delta.SL.library =  c("SL.glm", "tmle.SL.dbarts.k.5", "SL.gam"),
     family = "gaussian", fluctuation = "logistic", alpha = 0.9995, id=1:length(Y), 
     V.Q = 10, V.g=10, V.Delta=10, V.Z = 10,
     verbose = FALSE, Q.discreteSL=FALSE, g.discreteSL=FALSE, g.Delta.discreteSL=FALSE,
     prescreenW.g=TRUE, min.retain = 5, target.gwt = TRUE, automate=FALSE,
     obsWeights = NULL, alpha.sig = 0.05, B = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tmle_+3A_y">Y</code></td>
<td>
<p>continuous or binary outcome variable</p>
</td></tr>
<tr><td><code id="tmle_+3A_a">A</code></td>
<td>
<p>binary treatment indicator, <code>1</code> - treatment, <code>0</code> - control</p>
</td></tr>
<tr><td><code id="tmle_+3A_w">W</code></td>
<td>
<p>vector, matrix, or dataframe containing baseline covariates</p>
</td></tr>
<tr><td><code id="tmle_+3A_z">Z</code></td>
<td>
<p>optional binary indicator for intermediate covariate for controlled direct effect estimation</p>
</td></tr>
<tr><td><code id="tmle_+3A_delta">Delta</code></td>
<td>
<p>indicator of missing outcome or treatment assignment.  <code>1</code> - observed, <code>0</code> - missing</p>
</td></tr>
<tr><td><code id="tmle_+3A_q">Q</code></td>
<td>
<p>optional <code class="reqn">n \times 2</code> matrix of initial values for <code class="reqn">Q</code> portion of the likelihood, <code class="reqn">(E(Y|A=0,W), E(Y|A=1,W))</code></p>
</td></tr>
<tr><td><code id="tmle_+3A_q.z1">Q.Z1</code></td>
<td>
<p>optional <code class="reqn">n \times 2</code> matrix of initial values for <code class="reqn">Q</code> portion of the likelihood, <code class="reqn">(E(Y|Z=1,A=0,W), E(Y|Z=1,A=1,W))</code>. (When specified, values for <code class="reqn">E(Y|Z=0,A=0,W), E(Y|Z=0,A=1,W)</code> are passed in using the <code>Q</code> argument</p>
</td></tr>
<tr><td><code id="tmle_+3A_qform">Qform</code></td>
<td>
<p>optional regression formula for estimation of <code class="reqn">E(Y|A,W)</code>, suitable for call to <code>glm</code></p>
</td></tr>
<tr><td><code id="tmle_+3A_qbounds">Qbounds</code></td>
<td>
<p>vector of upper and lower bounds on <code>Y</code> and predicted values for initial <code>Q</code>. Defaults to the range of <code>Y</code>, widened by 1% of the min and max values.</p>
</td></tr>
<tr><td><code id="tmle_+3A_q.sl.library">Q.SL.library</code></td>
<td>
<p>optional vector of prediction algorithms to use for <code>SuperLearner</code> estimation of initial <code>Q</code></p>
</td></tr>
<tr><td><code id="tmle_+3A_cvqinit">cvQinit</code></td>
<td>
<p>logical, if <code>TRUE</code>, estimates cross-validated predicted values, default=<code>TRUE</code></p>
</td></tr>
<tr><td><code id="tmle_+3A_g1w">g1W</code></td>
<td>
<p>optional vector of conditional treatment assingment probabilities, <code class="reqn">P(A=1|W)</code></p>
</td></tr>
<tr><td><code id="tmle_+3A_gform">gform</code></td>
<td>
<p>optional regression formula of the form <code>A~W</code>, if specified this overrides the call to <code>SuperLearner</code></p>
</td></tr>
<tr><td><code id="tmle_+3A_gbound">gbound</code></td>
<td>
<p>value between (0,1) for truncation of predicted probabilities. See <code>Details</code> section for more information</p>
</td></tr>
<tr><td><code id="tmle_+3A_pz1">pZ1</code></td>
<td>
<p>optional<code class="reqn">n \times 2</code> matrix of conditional probabilities <code class="reqn">P(Z=1|A=0,W), P(Z=1|A=1,W)</code></p>
</td></tr> 
<tr><td><code id="tmle_+3A_g.zform">g.Zform</code></td>
<td>
<p>optional regression formula of the form <code>Z~A+W</code>, if specified this overrides the call to <code>SuperLearner</code></p>
</td></tr> 
<tr><td><code id="tmle_+3A_pdelta1">pDelta1</code></td>
<td>
<p>optional matrix of conditional probabilities for missingness mechanism, <code class="reqn">n \times 2</code> when <code>Z</code> is <code>NULL</code> <code class="reqn">P(Delta=1|A=0,W), P(Delta=1|A=1,W)</code>. <code class="reqn">n \times 4</code> otherwise, <code class="reqn">P(Delta=1|Z=0,A=0,W), P(Delta=1|Z=0,A=1,W), P(Delta=1|Z=1,A=0,W), P(Delta=1|Z=1,A=1,W)</code></p>
</td></tr>
<tr><td><code id="tmle_+3A_g.deltaform">g.Deltaform</code></td>
<td>
<p>optional regression formula of the form <code>Delta~A+W</code>, if specified this overrides the call to <code>SuperLearner</code></p>
</td></tr>
<tr><td><code id="tmle_+3A_g.sl.library">g.SL.library</code></td>
<td>
<p>optional vector of prediction algorithms to use for <code>SuperLearner</code> estimation of <code>g1W</code></p>
</td></tr>
<tr><td><code id="tmle_+3A_g.delta.sl.library">g.Delta.SL.library</code></td>
<td>
<p>optional vector of prediction algorithms to use for <code>SuperLearner</code> estimation of <code>pDelta1</code> </p>
</td></tr>
<tr><td><code id="tmle_+3A_family">family</code></td>
<td>
<p>family specification for working regression models, generally &lsquo;gaussian&rsquo; for continuous outcomes (default), &lsquo;binomial&rsquo; for binary outcomes</p>
</td></tr>
<tr><td><code id="tmle_+3A_fluctuation">fluctuation</code></td>
<td>
<p>&lsquo;logistic&rsquo; (default), or &lsquo;linear&rsquo;</p>
</td></tr>
<tr><td><code id="tmle_+3A_alpha">alpha</code></td>
<td>
<p>used to keep predicted initial values bounded away from (0,1) for logistic fluctuation</p>
</td></tr>
<tr><td><code id="tmle_+3A_id">id</code></td>
<td>
<p>optional subject identifier</p>
</td></tr>
<tr><td><code id="tmle_+3A_v.q">V.Q</code></td>
<td>
<p>Number of cross-validation folds for super learner estimation of Q</p>
</td></tr>
<tr><td><code id="tmle_+3A_v.g">V.g</code></td>
<td>
<p>Number of cross-validation folds for super learner estimation of g</p>
</td></tr>
<tr><td><code id="tmle_+3A_v.delta">V.Delta</code></td>
<td>
<p>Number of cross-validation folds for super learner estimation of missingness mechanism</p>
</td></tr>
<tr><td><code id="tmle_+3A_v.z">V.Z</code></td>
<td>
<p>Number of cross-validation folds for super learner estimation of intermediate variable</p>
</td></tr>
<tr><td><code id="tmle_+3A_verbose">verbose</code></td>
<td>
<p>status messages printed if set to <code>TRUE</code> (default=<code>FALSE</code>)</p>
</td></tr>
<tr><td><code id="tmle_+3A_q.discretesl">Q.discreteSL</code></td>
<td>
<p>if TRUE, discreteSL is used instead of ensemble SL. Ignored when SL not used to estimate Q</p>
</td></tr> 
<tr><td><code id="tmle_+3A_g.discretesl">g.discreteSL</code></td>
<td>
<p>if TRUE, discreteSL is used instead of ensemble SL. Ignored when SL not used to estimate g1W</p>
</td></tr> 
<tr><td><code id="tmle_+3A_g.delta.discretesl">g.Delta.discreteSL</code></td>
<td>
<p>if TRUE, discreteSL is used instead of ensemble SL. Ignored when SL not used to estimate P(Delta = 1 | A,W)</p>
</td></tr> 
<tr><td><code id="tmle_+3A_prescreenw.g">prescreenW.g</code></td>
<td>
<p>Option to screen covariates before estimating g in order to retain only those associated with the outcome (Recommend FALSE in low dimensional datasets)</p>
</td></tr>
<tr><td><code id="tmle_+3A_min.retain">min.retain</code></td>
<td>
<p>Minimum number of covariates to retain when prescreening covariates for g. Ignored when prescreenW.g=FALSE</p>
</td></tr> 
<tr><td><code id="tmle_+3A_target.gwt">target.gwt</code></td>
<td>
<p>When TRUE, move g from denominator of clever covariate to the weight when fitting epsilon</p>
</td></tr>
<tr><td><code id="tmle_+3A_automate">automate</code></td>
<td>
<p>When TRUE, all tuning parameters are set to their default values. Number of cross validation folds, truncation level for g, and
decision to prescreen covariates for modeling g are set data-adaptively based on sample size (see details).</p>
</td></tr>
<tr><td><code id="tmle_+3A_obsweights">obsWeights</code></td>
<td>
<p>Optional observation weights to account for biased sampling</p>
</td></tr>
<tr><td><code id="tmle_+3A_alpha.sig">alpha.sig</code></td>
<td>
<p>significance level for constructing <code>1-alpha.sig</code> confidence intervals</p>
</td></tr>
<tr><td><code id="tmle_+3A_b">B</code></td>
<td>
<p>Number of boostrap iterations. Set <code class="reqn">B&gt;1</code> to obtain targeted bootstrap based inference in addition to IC-based inference (see Details).</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>gbounds</code> Lower bound defaults to lb = <code class="reqn">5/sqrt(n)/log(n)</code>. For treatment effect estimates and population mean outcome the upper bound defaults to 1. For ATT and ATC, the upper bound defaults to 1- lb.
</p>
<p><code>W</code> may contain factors. These are converted to indicators via a call to <code>model.matrix</code>.
</p>
<p>Controlled direct effects are estimated when binary covariate <code>Z</code> is non-null. The tmle function returns an object of class <code>tmle.list</code>, a list of two items of class <code>tmle</code>.  The first corresponds to estimates obtained when <code>Z</code> is fixed at <code class="reqn">0</code>, the second corresponds to estimates obtained when <code>Z</code> is fixed at <code class="reqn">1</code>.
</p>
<p>When automate = TRUE the sample size determines the number of cross validation folds, V based on the effective sample size. When Y is continuous n.effective = n. When Y is binary n.effective =  5 * size of minority class. When n.effective &lt;= 30 V= n.effective; When n.effective &lt;= 500 V= 20; When 500 &lt; n &lt;=1000 V=10; When 1000 &lt; n &lt;= 10000 V=5; Otherwise V=2. Bounds on <code>g</code> set to <code class="reqn">(5/sqrt(n)/log(n), 1)</code>, except for ATT and ATE, where upper bound is 1-lower bound. <code>Wretain.g</code> set to TRUE when number of covariates <code class="reqn">&gt;= n.effective  / 5</code>.
</p>
<p>Set <code>B</code> = 10,000 to obtain high precision targeted bootstrap quantile-based confidence intervals and variance of bootstrap point estimates. Set <code>B</code> = 1,000 for rough approximation, and <code>B</code> = 1 for IC-based inference only.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>estimates</code></td>
<td>
<p>list with elements EY1 (population mean), ATE (additive treatment effect), ATT (additive treatment effect among the treated), ATC (additive treatment effect among the controls), RR (relative risk), OR (odds ratio). Each element in the estimates of these is itself a list containing 
</p>

<ul>
<li><p> psi - parameter estimate 
</p>
</li>
<li><p> pvalue - two-sided p-value
</p>
</li>
<li><p> CI - 95% confidence interval
</p>
</li>
<li><p> var.psi - Influence-curve based variance of estimate (ATE parameter only)
</p>
</li>
<li><p> log.psi - Parameter estimate on log scale (RR and OR parameters)
</p>
</li>
<li><p> var.log.psi - Influence-curve based variance of estimate on log scale (RR and OR parameters)
</p>
</li>
<li><p> bs.var - Variance of bootstrap point estimates (when <code>B &gt; 1</code>)              
</p>
</li>
<li><p> bs.CI.twosided - Quantile-based 2-sided confidence interval bounds     
</p>
</li>
<li><p> bs.CI.onesided.lower - Quantile-based 1-sided lower confidence interval bounds
</p>
</li>
<li><p> bs.CI.onesided.upper - Quantile-based 1-sided upper confidence interval bounds
</p>
</li></ul>
</td></tr>
<tr><td><code>Qinit</code></td>
<td>
<p>initial estimate of <code>Q</code>. <code>Qinit$coef</code> are the coefficients for a <code>glm</code> model for <code>Q</code>, if applicable.  <code>Qinit$Q</code> is an <code class="reqn">n \times 2</code> matrix, where <code>n</code> is the number of observations.  Columns contain predicted values for <code>Q(0,W),Q(1,W)</code> using the initial fit.  <code>Qinit$type</code> is method for estimating <code>Q</code>. <code>Qinit$Rsq</code> is Rsq for initial estimate of Q. <code>Qinit$Rsq.type</code> empirical or cross-validated (depends on value of cvQinit), Rsq or pseudo-Rsq when Y is binary.</p>
</td></tr>
<tr><td><code>Qstar</code></td>
<td>
<p>targeted estimate of <code>Q</code>, an <code class="reqn">n \times 2</code> matrix with predicted values for <code>Q(0,W), Q(1,W)</code> using the updated fit</p>
</td></tr>
<tr><td><code>g</code></td>
<td>
<p>treatment mechanism estimate. A list with four items: <code>g$g1W</code> contains estimates of <code class="reqn">P(A=1|W)</code> for each observation, <code>g$coef</code> the coefficients for the model for <code class="reqn">g</code> when <code>glm</code> used, <code>g$type</code> estimation procedure, <code>g$discreteSL</code> flag, <code>g$AUC</code> empirical AUC if ROCR package is available</p>
</td></tr>
<tr><td><code>g.Z</code></td>
<td>
<p>intermediate covariate assignment estimate (when applicable). A list with four items: <code>g.Z$g1W</code> an <code class="reqn">n \times 2</code> matrix containing values of <code class="reqn">P(Z=1|A=1,W), P(Z=1|A=0,W)</code> for each observation, <code>g.Z$coef</code> the coefficients for the model for <code class="reqn">g</code> when <code>glm</code> used, <code>g.Z$type</code> estimation procedure, <code>g.Z$discreteSL</code> flag</p>
</td></tr>
<tr><td><code>g.Delta</code></td>
<td>
<p>missingness mechanism estimate. A list with four items: <code>g.Delta$g1W</code> an <code class="reqn">n \times 4</code> matrix containing values of <code class="reqn">P(Delta=1|Z,A,W)</code> for each observation, with (Z=0,A=0), (Z=0,A=1), (Z=1,A=0),(Z=1,A=1). (When <code>Z</code> is <code>NULL</code>, columns 3 and 4 are duplicates of 1 and 2.) <code>g.Delta$coef</code> the coefficients for the model for <code class="reqn">g</code> when <code>glm</code> used, <code>g.Delta$type</code> estimation procedure, <code>g.Delta$discreteSL</code> flag</p>
</td></tr>
<tr><td><code>gbound</code></td>
<td>
<p>bounds used to truncate g</p>
</td></tr>
<tr><td><code>gbound.ATT</code></td>
<td>
<p>bounds used to truncated g for ATT and ATC estimation</p>
</td></tr>
<tr><td><code>W.retained</code></td>
<td>
<p>names of covariates used to model the components of g</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Susan Gruber <a href="mailto:sgruber@cal.berkeley.edu">sgruber@cal.berkeley.edu</a>, in collaboration with Mark van der Laan.</p>


<h3>References</h3>

<p>1. Gruber, S. and van der Laan, M.J. (2012), tmle: An R Package for Targeted Maximum Likelihood Estimation. <em>Journal of Statistical Software</em>, 51(13), 1-35. <a href="https://www.jstatsoft.org/v51/i13/">https://www.jstatsoft.org/v51/i13/</a>
</p>
<p>2. Gruber, S. and van der Laan, M.J. (2009), Targeted Maximum Likelihood Estimation: A Gentle Introduction. <em>U.C. Berkeley Division of Biostatistics Working Paper Series</em>.  Working Paper 252.  <a href="https://biostats.bepress.com/ucbbiostat/paper252/">https://biostats.bepress.com/ucbbiostat/paper252/</a>
</p>
<p>3. Gruber, S. and van der Laan, M.J.  (2010), A Targeted Maximum Likelihood Estimator of a Causal Effect on a Bounded Continuous Outcome. <em>The International Journal of Biostatistics</em>, 6(1), 2010.
</p>
<p>4. Rosenblum, M. and van der Laan, M.J. (2010).Targeted Maximum Likelihood Estimation of the Parameter of a Marginal Structural Model. <em>The International Journal of Biostatistics</em>, 6(2), 2010.
</p>
<p>5. van der Laan, M.J. and Rubin, D. (2006), Targeted Maximum Likelihood Learning. <em>The International Journal of Biostatistics</em>, 2(1). <a href="https://biostats.bepress.com/ucbbiostat/paper252/">https://biostats.bepress.com/ucbbiostat/paper252/</a>
</p>
<p>6. van der Laan, M.J., Rose, S., and Gruber,S., editors, (2009) Readings in Targeted Maximum Likelihood Estimation . <em>U.C. Berkeley Division of Biostatistics Working Paper Series</em>.  Working Paper 254. <a href="https://biostats.bepress.com/ucbbiostat/paper254/">https://biostats.bepress.com/ucbbiostat/paper254/</a>
</p>
<p>7. van der Laan, M.J. and Gruber S. (2016), One-Step Targeted Minimum Loss-based Estimation Based on Universal Least Favorable One-Dimensional Submodels. <em>The International Journal of Biostatistics</em>, 12 (1), 351-378.
</p>
<p>8. Gruber, S., Phillips, R.V., Lee, H., van der Laan, M.J. Data-Adaptive Selection of the Propensity Score Truncation Level for Inverse Probability Weighted and Targeted Maximum Likelihood Estimators of Marginal Point Treatment Effects. <em>American Journal of Epidemiology</em> 2022; 191(9), 1640-1651.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+summary.tmle">summary.tmle</a></code>,
<code><a href="#topic+estimateQ">estimateQ</a></code>,
<code><a href="#topic+estimateG">estimateG</a></code>,
<code><a href="#topic+calcParameters">calcParameters</a></code>,
<code><a href="#topic+oneStepATT">oneStepATT</a></code>,
<code><a href="#topic+tmleMSM">tmleMSM</a></code>,
<code><a href="#topic+calcSigma">calcSigma</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(tmle)
  set.seed(1)
  n &lt;- 250
  W &lt;- matrix(rnorm(n*3), ncol=3)
  A &lt;- rbinom(n,1, 1/(1+exp(-(.2*W[,1] - .1*W[,2] + .4*W[,3]))))
  Y &lt;- A + 2*W[,1] + W[,3] + W[,2]^2 + rnorm(n)

# Example 1. Simplest function invocation 
# SuperLearner called to estimate Q, g
# Delta defaults to 1 for all observations   
## Not run: 
  result1 &lt;- tmle(Y,A,W)
  summary(result1)

## End(Not run)
# Example 2: 
# User-supplied regression formulas to estimate Q and g
# binary outcome
  n &lt;- 250
  W &lt;- matrix(rnorm(n*3), ncol=3)
  colnames(W) &lt;- paste("W",1:3, sep="")
  A &lt;- rbinom(n,1, plogis(0.6*W[,1] +0.4*W[,2] + 0.5*W[,3]))
  Y &lt;- rbinom(n,1, plogis(A + 0.2*W[,1] + 0.1*W[,2] + 0.2*W[,3]^2 ))
  result2 &lt;- tmle(Y,A,W, family="binomial", Qform="Y~A+W1+W2+W3", gform="A~W1+W2+W3")
  summary(result2)

## Not run: 
# Example 3:
# Incorporate sampling weights and
# request targeted bootstrap-based inference along with IC-based results
  pi &lt;- .25 + .5*W[,1] &gt; 0
  enroll &lt;- sample(1:n, size = n/2, p = pi)
  result3 &lt;- tmle(Y[enroll],A[enroll],W[enroll,], family="binomial", Qform="Y~A+W1+W2+W3",
             gform="A~W1+W2+W3", obsWeights = 1/pi[enroll],B=1000)
  summary(result3)

# Example 4: Population mean outcome
# User-supplied (misspecified) model for Q, 
# Super learner called to estimate g, g.Delta
# V set to 2 for demo, not recommended at this sample size
# approx. 20
  Y &lt;- W[,1] + W[,2]^2 + rnorm(n)
  Delta &lt;- rbinom(n, 1, 1/(1+exp(-(1.7-1*W[,1]))))
  result4 &lt;- tmle(Y,A=NULL,W, Delta=Delta, Qform="Y~A+W1+W2+W3", V.g=2, V.Delta=2)
  print(result4)

# Example 5: Controlled direct effect
# User-supplied models for g, g.Z
# V set to 2 for demo, not recommended at this sample size
  A &lt;- rbinom(n,1,.5)
  Z &lt;- rbinom(n, 1, plogis(.5*A + .1*W[,1]))
  Y &lt;- 1 + A + 10*Z + W[,1]+ rnorm(n)
  
  CDE &lt;- tmle(Y,A,W, Z, gform="A~1", g.Zform = "Z ~ A + W1", V.Q=2, V.g=2)
  print(CDE)
  total.effect &lt;- tmle(Y,A, W,  gform="A~1")
  print(total.effect)

## End(Not run)
</code></pre>

<hr>
<h2 id='tmle.SL.dbarts2'>Super Learner wrappers for modeling and prediction using <code>bart</code> in the <code>dbarts</code> package</h2><span id='topic+tmle.SL.dbarts2'></span><span id='topic+tmle.SL.dbarts.k.5'></span><span id='topic+predict.tmle.SL.dbarts2'></span>

<h3>Description</h3>

<p>These functions are used internally, not typically called by the user</p>


<h3>Usage</h3>

<pre><code class='language-R'>tmle.SL.dbarts2(Y, X, newX, family, obsWeights, id, sigest = NA, sigdf = 3, 
	sigquant = 0.90, k = 2, power = 2.0, base = 0.95, binaryOffset = 0.0, 
	ntree = 200, ndpost = 1000, nskip = 100, printevery = 100,  keepevery = 1,  
	keeptrainfits = TRUE, usequants = FALSE, numcut = 100,printcutoffs = 0,  
	nthread = 1,   keepcall = TRUE,verbose = FALSE, ...)
tmle.SL.dbarts.k.5(Y, X, newX, family, obsWeights, id, sigest = NA, sigdf = 3, 
	sigquant = 0.90, k = 0.5, power = 2.0, base = 0.95, binaryOffset = 0.0, 
	ntree = 200, ndpost = 1000, nskip = 100, printevery = 100,  keepevery = 1,  
	keeptrainfits = TRUE, usequants = FALSE, numcut = 100,printcutoffs = 0,  
	nthread = 1,   keepcall = TRUE,verbose = FALSE, ...)
## S3 method for class 'tmle.SL.dbarts2'
predict(object, newdata, family, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tmle.SL.dbarts2_+3A_y">Y</code></td>
<td>
<p>Dependent variable</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_x">X</code></td>
<td>
<p>Predictor covariate matrix or data frame used as training set</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_newx">newX</code></td>
<td>
<p>Predictor covariate matrix or data frame for which predictions should be made</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_family">family</code></td>
<td>
<p>Regression family, 'gaussian' or 'binomial'</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_obsweights">obsWeights</code></td>
<td>
<p>observation-level weights</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_id">id</code></td>
<td>
<p>identifier to group observations, not used</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_sigest">sigest</code></td>
<td>
<p>An estimate of error variance. See <code>bart</code> documentation</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_sigdf">sigdf</code></td>
<td>
<p>Degrees of freedom for error variance prior. See <code>bart</code> documentation</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_sigquant">sigquant</code></td>
<td>
<p>Quantile of error variance prior. See <code>bart</code> documentation</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_k">k</code></td>
<td>
<p>Tuning parameter that controls smoothing. Larger values are more conservative, see <code>Details</code></p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_power">power</code></td>
<td>
<p>Power parameter for tree prior</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_base">base</code></td>
<td>
<p>Base parameter for tree prior</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_binaryoffset">binaryOffset</code></td>
<td>
<p>Allows fits with probabilities shrunk towards values other than 0.5. See <code>bart</code> documentation</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_ntree">ntree</code></td>
<td>
<p>Number of trees in the sum-of-trees formulation</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_ndpost">ndpost</code></td>
<td>
<p>Number of posterior draws after burn in</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_nskip">nskip</code></td>
<td>
<p>Number of MCMC iterations treated as burn in</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_printevery">printevery</code></td>
<td>
<p>How often to print messages</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_keepevery">keepevery</code></td>
<td>
<p>Every <code>keepevery</code> draw is kept to be returned to the user</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_keeptrainfits">keeptrainfits</code></td>
<td>
<p>If <code>TRUE</code> the draws of <code class="reqn">f(x)</code> for <code class="reqn">x</code> corresponding to the rows of <code>x.train</code> are returned</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_usequants">usequants</code></td>
<td>
<p>Controls how tree decisions rules are determined. See <code>bart</code> documentation</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_numcut">numcut</code></td>
<td>
<p>Maximum number of possible values used in decision rules</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_printcutoffs">printcutoffs</code></td>
<td>
<p>Number of cutoff rules to print to screen. <code class="reqn">0</code> prints nothing</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_nthread">nthread</code></td>
<td>
<p>Integer specifying how many threads to use</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_keepcall">keepcall</code></td>
<td>
<p>Returns the call to BART when <code>TRUE</code></p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_verbose">verbose</code></td>
<td>
<p>Ignored for now</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_...">...</code></td>
<td>
<p>Additional arguments passed on to plot or control functions</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_object">object</code></td>
<td>
<p>Object of type tmle.SL.dbarts2</p>
</td></tr>
<tr><td><code id="tmle.SL.dbarts2_+3A_newdata">newdata</code></td>
<td>
<p>Matrix or dataframe used to get predictions from the fitted model</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>tmle.SL.dbarts2</code> is in the default library for estimating <code class="reqn">Q</code>. It uses the default setting in the <code>dbarts</code> package, <code class="reqn">k=2</code>. <code>tmle.SL.dbarts.k.5</code> is used to estimate the components of <code class="reqn">g</code>. It sets <code class="reqn">k=0.5</code>, to avoid shrinking predicted values too far from <code class="reqn">(0,1)</code>. See <code>bart</code> documentation for more information.
</p>


<h3>Value</h3>

<p>an object of type tmle.SL.dbarts2 used internally by <code>Super Learner</code>
</p>


<h3>Author(s)</h3>

<p>Chris Kennedy and Susan Gruber</p>


<h3>See Also</h3>

<p><code><a href="SuperLearner.html#topic+SuperLearner">SuperLearner</a></code>
</p>

<hr>
<h2 id='tmleMSM'>
Targeted Maximum Likelihood Estimation of Parameter of MSM</h2><span id='topic+tmleMSM'></span>

<h3>Description</h3>

<p>Targeted maximum likelihood estimation of the parameter of a marginal structural model (MSM) for binary point treatment effects. The <code>tmleMSM</code> function is minimally called with arguments <code>(Y,A,W, MSM)</code>, where  <code>Y</code> is a continuous or binary outcome variable, <code>A</code> is a binary treatment variable, (<code>A=1</code> for treatment, <code>A=0</code> for control), and <code>W</code> is a matrix or dataframe of baseline covariates. MSM is a valid regression formula for regressing <code>Y</code> on any combination of <code>A, V, W, T</code>, where <code>V</code> defines strata and <code>T</code> represents the time at which repeated measures on subjects are made.  Missingness in the outcome is accounted for in the estimation procedure if missingness indicator <code>Delta</code> is 0 for some observations.  Repeated measures can be identified using the <code>id</code> argument. Observation weigths (sampling weights) may optionally be provided</p>


<h3>Usage</h3>

<pre><code class='language-R'>tmleMSM(Y, A, W, V, T = rep(1,length(Y)), Delta = rep(1, length(Y)), MSM, 
        v = NULL, Q = NULL, Qform = NULL, Qbounds = c(-Inf, Inf), 
        Q.SL.library = c("SL.glm", "tmle.SL.dbarts2", "SL.glmnet"), 
        cvQinit = TRUE, hAV = NULL, hAVform = NULL, g1W = NULL, 
        gform = NULL, pDelta1 = NULL, g.Deltaform = NULL, 
	g.SL.library = c("SL.glm", "tmle.SL.dbarts.k.5", "SL.gam"),
	g.Delta.SL.library = c("SL.glm", "tmle.SL.dbarts.k.5", "SL.gam"),
	ub = sqrt(sum(Delta))* log(sum(Delta)) / 5, family = "gaussian", 
	fluctuation = "logistic", alpha  = 0.995, id = 1:length(Y), 
	V.Q = 10, V.g = 10, V.Delta = 10, inference = TRUE, verbose = FALSE, 
	Q.discreteSL = FALSE, g.discreteSL = FALSE, alpha.sig = 0.05, obsWeights = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tmleMSM_+3A_y">Y</code></td>
<td>
<p>continuous or binary outcome variable</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_a">A</code></td>
<td>
<p>binary treatment indicator, <code>1</code> - treatment, <code>0</code> - control</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_w">W</code></td>
<td>
<p>vector, matrix, or dataframe containing baseline covariates. Factors are not currently allowed.</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_v">V</code></td>
<td>
<p>vector, matrix, or dataframe of covariates used to define strata</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_t">T</code></td>
<td>
<p>optional time for repeated measures data</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_delta">Delta</code></td>
<td>
<p>indicator of missing outcome or treatment assignment.  <code>1</code> - observed, <code>0</code> - missing</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_msm">MSM</code></td>
<td>
<p>MSM of interest, specified as valid right hand side of a regression formula (see examples)</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_v">v</code></td>
<td>
<p>optional value defining the strata of interest (<code class="reqn">V=v</code>) for stratified estimation of MSM parameter</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_q">Q</code></td>
<td>
<p>optional <code class="reqn">n \times 2</code> matrix of initial values for <code class="reqn">Q</code> portion of the likelihood, <code class="reqn">(E(Y|A=0,W), E(Y|A=1,W))</code></p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_qform">Qform</code></td>
<td>
<p>optional regression formula for estimation of <code class="reqn">E(Y|A, W)</code>, suitable for call to <code>glm</code></p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_qbounds">Qbounds</code></td>
<td>
<p>vector of upper and lower bounds on <code>Y</code> and predicted values for initial <code>Q</code></p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_q.sl.library">Q.SL.library</code></td>
<td>
<p>optional vector of prediction algorithms to use for <code>SuperLearner</code> estimation of initial <code>Q</code> </p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_cvqinit">cvQinit</code></td>
<td>
<p>logical, if <code>TRUE</code>, estimates cross-validated predicted values using discrete super learning, default=<code>TRUE</code></p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_hav">hAV</code></td>
<td>
<p>optional <code class="reqn">n \times 2</code> matrix used in numerator of weights for updating covariate and the influence curve. If unspecified, defaults to conditional probabilities <code class="reqn">P(A=1|V)</code> or <code class="reqn">P(A=1|T)</code>, for repeated measures data. For unstabilized weights, pass in an <code class="reqn">n \times 2</code> matrix of all 1s</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_havform">hAVform</code></td>
<td>
<p>optionalregression formula of the form <code>A~V+T</code>, if specified this overrides the call to <code>SuperLearner</code></p>
</td></tr> 
<tr><td><code id="tmleMSM_+3A_g1w">g1W</code></td>
<td>
<p>optional vector of conditional treatment assingment probabilities, <code class="reqn">P(A=1|W)</code></p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_gform">gform</code></td>
<td>
<p>optional regression formula of the form <code>A~W</code>, if specified this overrides the call to <code>SuperLearner</code></p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_pdelta1">pDelta1</code></td>
<td>
<p>optional <code class="reqn">n \times 2</code> matrix of conditional probabilities for missingness mechanism,<code class="reqn">P(Delta=1|A=0,V,W,T), P(Delta=1|A=1,V,W,T)</code>.</p>
</td></tr> 
<tr><td><code id="tmleMSM_+3A_g.deltaform">g.Deltaform</code></td>
<td>
<p>optional regression formula of the form <code>Delta~A+W</code>, if specified this overrides the call to <code>SuperLearner</code></p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_g.sl.library">g.SL.library</code></td>
<td>
<p>optional vector of prediction algorithms to use for <code>SuperLearner</code> estimation of <code>g1W</code></p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_g.delta.sl.library">g.Delta.SL.library</code></td>
<td>
<p>optional vector of prediction algorithms to use for <code>SuperLearner</code> estimation of<code>pDelta1</code></p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_ub">ub</code></td>
<td>
<p>upper bound on inverse probability weights. See <code>Details</code> section for more information</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_family">family</code></td>
<td>
<p>family specification for working regression models, generally &lsquo;gaussian&rsquo; for continuous outcomes (default), &lsquo;binomial&rsquo; for binary outcomes</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_fluctuation">fluctuation</code></td>
<td>
<p>&lsquo;logistic&rsquo; (default), or &lsquo;linear&rsquo;</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_alpha">alpha</code></td>
<td>
<p>used to keep predicted initial values bounded away from (0,1) for logistic fluctuation</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_id">id</code></td>
<td>
<p>optional subject identifier</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_v.q">V.Q</code></td>
<td>
<p>number of cross-validation folds for Super Learner estimation of Q</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_v.g">V.g</code></td>
<td>
<p>number of cross-validation folds for Super Learner estimation of g</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_v.delta">V.Delta</code></td>
<td>
<p>number of cross-validation folds for Super Learner estimation of g_Delta</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_inference">inference</code></td>
<td>
<p>if <code>TRUE</code>, variance-covariance matrix, standard errors, pvalues, and 95% confidence intervals are calculated. Setting to FALSE saves a little time when bootstrapping.</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_verbose">verbose</code></td>
<td>
<p>status messages printed if set to <code>TRUE</code> (default=<code>FALSE</code>)</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_q.discretesl">Q.discreteSL</code></td>
<td>
<p>If true, use discrete SL to estimate Q, otherwise ensembleSL by default. Ignored when SL is not used.</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_g.discretesl">g.discreteSL</code></td>
<td>
<p>If true, use discrete SL to estimate each component of g, otherwise ensembleSL by default. Ignored when SL is not used.</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_alpha.sig">alpha.sig</code></td>
<td>
<p>significance level for constructing <code>1-alpha.sig</code> confidence intervals</p>
</td></tr>
<tr><td><code id="tmleMSM_+3A_obsweights">obsWeights</code></td>
<td>
<p>optional weights for biased sampling and two-stage designs.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>ub</code> bounds the IC by bounding the factor <code class="reqn">h(A,V)/[g(A,V,W)P(Delta=1|A,V,W)]</code> between 0 and <code>ub</code>, default value based on sample size.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>psi</code></td>
<td>
<p>MSM parameter estimate</p>
</td></tr> 
<tr><td><code>sigma</code></td>
<td>
<p>variance covariance matrix</p>
</td></tr>
<tr><td><code>se</code></td>
<td>
<p>standard errors extracted from sigma</p>
</td></tr>
<tr><td><code>pvalue</code></td>
<td>
<p>two-sided p-value</p>
</td></tr>
<tr><td><code>lb</code></td>
<td>
<p>lower bound on 95% confidence interval</p>
</td></tr>
<tr><td><code>ub</code></td>
<td>
<p>upper bound on 95% confidence interval</p>
</td></tr>
<tr><td><code>epsilon</code></td>
<td>
<p>fitted value of epsilon used to target initial <code>Q</code></p>
</td></tr>
<tr><td><code>psi.Qinit</code></td>
<td>
<p>MSM parameter estimate based on untargeted initial <code>Q</code></p>
</td></tr>
<tr><td><code>Qstar</code></td>
<td>
<p>targeted estimate of <code>Q</code>, an <code class="reqn">n \times 2</code> matrix with predicted values for <code>Q(0,W), Q(1,W)</code> using the updated fit</p>
</td></tr>
<tr><td><code>Qinit</code></td>
<td>
<p>initial estimate of <code>Q</code>. <code>Qinit$coef</code> are the coefficients for a <code>glm</code> model for <code>Q</code>, if applicable.  <code>Qinit$Q</code> is an <code class="reqn">n \times 2</code> matrix, where <code>n</code> is the number of observations.  Columns contain predicted values for <code>Q(0,W),Q(1,W)</code> using the initial fit.  <code>Qinit$type</code> is method for estimating <code>Q</code></p>
</td></tr>
<tr><td><code>g</code></td>
<td>
<p>treatment mechanism estimate. A list with three items: <code>g$g1W</code> contains estimates of <code class="reqn">P(A=1|W)</code> for each observation, <code>g$coef</code> the coefficients for the model for <code class="reqn">g</code> when <code>glm</code> used, <code>g$type</code> estimation procedure</p>
</td></tr>
<tr><td><code>g.AV</code></td>
<td>
<p>estimate for h(A,V) or h(A,T). A list with three items: <code>g.AV$g1W</code> an <code class="reqn">n \times 2</code> matrix containing values of <code class="reqn">P(A=0|V,T), P(A=1|V,T)</code> for each observation, <code>g.AV$coef</code> the coefficients for the model for <code class="reqn">g</code> when <code>glm</code> used, <code>g.AV$type</code> estimation procedure</p>
</td></tr>
<tr><td><code>g_Delta</code></td>
<td>
<p>missingness mechanism estimate. A list with three items: <code>g_Delta$g1W</code> an <code class="reqn">n \times 2</code> matrix containing values of <code class="reqn">P(Delta=1|A,V,W,T)</code> for each observation, <code>g_Delta$coef</code> the coefficients for the model for <code class="reqn">g</code> when <code>glm</code> used, <code>g_Delta$type</code> estimation procedure</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Susan Gruber <a href="mailto:sgruber@cal.berkeley.edu">sgruber@cal.berkeley.edu</a>, in collaboration with Mark van der Laan.</p>


<h3>References</h3>

<p>1. Gruber, S. and van der Laan, M.J. (2012), tmle: An R Package for Targeted Maximum Likelihood Estimation. <em>Journal of Statistical Software</em>, 51(13), 1-35. <a href="https://www.jstatsoft.org/v51/i13/">https://www.jstatsoft.org/v51/i13/</a>
</p>
<p>2. Rosenblum, M. and van der Laan, M.J. (2010), Targeted Maximum Likelihood Estimation of the Parameter of a Marginal Structural Model. <em>The International Journal of Biostatistics</em>,6(2), 2010.
</p>
<p>3. Gruber, S., Phillips, R.V., Lee, H., van der Laan, M.J. Data-Adaptive Selection of the Propensity Score Truncation Level for Inverse Probability Weighted and Targeted Maximum Likelihood Estimators of Marginal Point Treatment Effects. <em>American Journal of Epidemiology</em> 2022; 191(9), 1640-1651.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+summary.tmleMSM">summary.tmleMSM</a></code>,
<code><a href="#topic+estimateQ">estimateQ</a></code>,
<code><a href="#topic+estimateG">estimateG</a></code>,
<code><a href="#topic+calcSigma">calcSigma</a></code>,
<code><a href="#topic+tmle">tmle</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(tmle)
# Example 1. Estimating MSM parameter with correctly specified regression formulas
# MSM: psi0 + psi1*A + psi2*V + psi3*A*V  (saturated)
# true parameter value: psi = (0, 1, -2, 0.5) 
# generate data
  set.seed(100)
  n &lt;- 1000
  W &lt;- matrix(rnorm(n*3), ncol = 3)
  colnames(W) &lt;- c("W1", "W2", "W3")
  V &lt;- rbinom(n, 1, 0.5)
  A &lt;- rbinom(n, 1, 0.5)
  Y &lt;- rbinom(n, 1, plogis(A - 2*V + 0.5*A*V))
  result.ex1 &lt;- tmleMSM(Y, A, W, V, MSM = "A*V", Qform = "Y~.", gform = "A~1", 
                        hAVform = "A~1", family = "binomial")
  print(result.ex1)
## Not run: 

# Example 2. Biased sampling from example 1 population
# (observations having V = 1 twice as likely to be included in the dataset
  retain.ex2 &lt;- sample(1:n, size = n/2, p = c(1/3 + 1/3*V))
  wt.ex2 &lt;- 1/(1/3 + 1/3*V)
  result.ex2 &lt;- tmleMSM(Y[retain.ex2], A[retain.ex2], W[retain.ex2,], 
			V[retain.ex2], MSM = "A*V", Qform = "Y~.", gform = "A~1", 
                        hAVform = "A~1", family = "binomial",
			obsWeight = wt.ex2[retain.ex2])
  print(result.ex2)

# Example 3. Repeated measures data, two observations per id
# (e.g., crossover study design)
# MSM: psi0 + psi1*A + psi2*V + psi3*V^2 + psi4*T
# true parameter value: psi = (-2, 1, 0, -2, 0 )
# generate data in wide format (id,  W1, Y(t),  W2(t), V(t), A(t)) 
   set.seed(10)
   n &lt;- 250
   id &lt;- rep(1:n)
   W1   &lt;- rbinom(n, 1, 0.5)
   W2.1 &lt;- rnorm(n)
   W2.2 &lt;- rnorm(n)  
   V.1   &lt;- rnorm(n)  
   V.2   &lt;- rnorm(n)
   A.1 &lt;- rbinom(n, 1, plogis(0.5 + 0.3 * W2.1))
   A.2 &lt;- 1-A.1
   Y.1  &lt;- -2 + A.1 - 2*V.1^2 + W2.1 + rnorm(n)
   Y.2  &lt;- -2 + A.2 - 2*V.2^2 + W2.2 + rnorm(n)
   d &lt;- data.frame(id, W1, W2=W2.1, W2.2, V=V.1, V.2, A=A.1, A.2, Y=Y.1, Y.2)

# change dataset from wide to long format
   longd &lt;- reshape(d, 
          varying = cbind(c(3, 5, 7, 9), c(4, 6, 8, 10)),
          idvar = "id",
          direction = "long",
          timevar = "T",
          new.row.names = NULL,
          sep = "")
# misspecified model for initial Q, partial misspecification for g. 
# V set to 2 for Q and g to save time, not recommended at this sample size
   result.ex3 &lt;- tmleMSM(Y = longd$Y, A = longd$A, W = longd[,c("W1", "W2")], V = longd$V, 
          T = longd$T, MSM = "A + V + I(V^2) + T", Qform = "Y ~ A + V", gform = "A ~ W2", 
	id = longd$id, V.Q=2, V.g=2)
   print(result.ex3)


# Example 4:  Introduce 20
# V set to 2 for Q and g to save time, not recommended at this sample size
  Delta &lt;- rbinom(nrow(longd), 1, 0.8)
  result.ex4 &lt;- tmleMSM(Y = longd$Y, A = longd$A, W = longd[,c("W1", "W2")], V = longd$V, T=longd$T,
          Delta = Delta, MSM = "A + V + I(V^2) + T", Qform = "Y ~ A + V", gform = "A ~ W2",
	  g.Deltaform = "Delta ~ 1", id=longd$id, verbose = TRUE, V.Q=2, V.g=2)
  print(result.ex4)


## End(Not run)
</code></pre>

<hr>
<h2 id='tmleNews'>Show the NEWS file (tmleNews)</h2><span id='topic+tmleNews'></span>

<h3>Description</h3>

<p>Shows recent changes and bug fixes documented in the <code>tmle</code> package NEWS file.</p>


<h3>Usage</h3>

<pre><code class='language-R'>tmleNews(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tmleNews_+3A_...">...</code></td>
<td>
<p>additional arguments passed to <code>RShowDoc</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>NONE
</p>


<h3>Author(s)</h3>

<p>Susan Gruber</p>


<h3>See Also</h3>

<p><code><a href="#topic+tmle">tmle</a></code>,
<code><a href="#topic+tmleMSM">tmleMSM</a></code>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
