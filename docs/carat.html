<!DOCTYPE html><html><head><title>Help for package carat</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {carat}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#AdjBCD'><p>Covariate-adjusted Biased Coin Design</p></a></li>
<li><a href='#AdjBCD.sim'>
<p>Covariate-adjusted Biased Coin Design with Covariate Data Generating Mechanism</p></a></li>
<li><a href='#AdjBCD.ui'>
<p>Command-line User Interface Using Covariate-adjusted Biased Coin Design</p></a></li>
<li><a href='#boot.test'><p>Bootstrap t-test</p></a></li>
<li><a href='#carat-package'>
<p>carat-package: Covariate-Adaptive Randomization for Clinical Trials</p></a></li>
<li><a href='#compPower'><p>Comparison of Powers for Different Tests under Different Randomization methods</p></a></li>
<li><a href='#compRand'><p>Compare Different Randomization Procedures via Tables and Plots</p></a></li>
<li><a href='#corr.test'><p>Corrected t-test</p></a></li>
<li><a href='#DoptBCD'><p>Atkinson's <code class="reqn">D_A</code>-optimal Biased Coin Design</p></a></li>
<li><a href='#DoptBCD.sim'>
<p>Atkinson's <code class="reqn">D_A</code>-optimal Biased Coin Design with Covariate Data Generating Mechanism</p></a></li>
<li><a href='#DoptBCD.ui'>
<p>Command-line User Interface Using Atkinson's <code class="reqn">D_A</code>-optimal Biased Coin Design</p></a></li>
<li><a href='#evalPower'><p>Evaluation of Tests and Randomization Procedures through Power</p></a></li>
<li><a href='#evalRand'><p>Evaluation of Randomization Procedures</p></a></li>
<li><a href='#evalRand.sim'>
<p>Evaluation Randomization Procedures with Covariate Data Generating Mechanism</p></a></li>
<li><a href='#getData'><p>Data Generation</p></a></li>
<li><a href='#HuHuCAR'><p>Hu and Hu's General Covariate-Adaptive Randomization</p></a></li>
<li><a href='#HuHuCAR.sim'><p>Hu and Hu's General Covariate-Adaptive Randomization with Covariate Data Generating Mechanism</p></a></li>
<li><a href='#HuHuCAR.ui'>
<p>Command-line User Interface Using Hu and Hu's General Covariate-adaptive Randomization</p></a></li>
<li><a href='#pats'>
<p>Data of Covariate Profile of Patients</p></a></li>
<li><a href='#PocSimMIN'><p>Pocock and Simon's Method in the Two-Arms Case</p></a></li>
<li><a href='#PocSimMIN.sim'>
<p>Pocock and Simon's Method in the Two-Arms Case with Covariate Data Generating Mechanism</p></a></li>
<li><a href='#PocSimMIN.ui'>
<p>Command-line User Interface Using Pocock and Simon's Procedure with Two-Arms Case</p></a></li>
<li><a href='#rand.test'><p>Randomization Test</p></a></li>
<li><a href='#StrBCD'><p>Shao's Method in the Two-Arms Case</p></a></li>
<li><a href='#StrBCD.sim'>
<p>Shao's Method in the Two-Arms Case with Covariate Data Generating Mechanism</p></a></li>
<li><a href='#StrBCD.ui'>
<p>Command-line User Interface Using Shao's Method</p></a></li>
<li><a href='#StrPBR'><p>Stratified Permuted Block Randomization</p></a></li>
<li><a href='#StrPBR.sim'>
<p>Stratified Permuted Block Randomization with Covariate Data Generating Mechanism</p></a></li>
<li><a href='#StrPBR.ui'>
<p>Command-line User Interface Using Stratified Permuted Block Randomization with Two-Arms Case</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Covariate-Adaptive Randomization for Clinical Trials</td>
</tr>
<tr>
<td>Version:</td>
<td>2.2.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-09-05</td>
</tr>
<tr>
<td>Author:</td>
<td>Fuyi Tu [aut],
  Xiaoqing Ye [aut, cre],
  Wei Ma [aut, ths],
  Feifang Hu [aut, ths]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Xiaoqing Ye &lt;ye_xiaoq@163.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides functions and command-line user interface to generate allocation sequence by covariate-adaptive randomization for clinical trials. The package currently supports six covariate-adaptive randomization procedures. Three hypothesis testing methods that are valid and robust under covariate-adaptive randomization are also available in the package to facilitate the inference for treatment effect under the included randomization procedures. Additionally, the package provides comprehensive and efficient tools to allow one to evaluate and compare the performance of randomization procedures and tests based on various criteria. See Ma W, Ye X, Tu F, and Hu F (2023) &lt;<a href="https://doi.org/10.18637%2Fjss.v107.i02">doi:10.18637/jss.v107.i02</a>&gt; for details. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp (&ge; 1.0.4.6), ggplot2 (&ge; 3.3.0), gridExtra (&ge; 2.3),
stringr (&ge; 1.4.0), methods</td>
</tr>
<tr>
<td>Suggests:</td>
<td>dplyr (&ge; 0.8.5)</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6.0)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-09-05 06:21:06 UTC; YeXiaoqing</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-09-05 15:30:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='AdjBCD'>Covariate-adjusted Biased Coin Design</h2><span id='topic+AdjBCD'></span>

<h3>Description</h3>

<p>Allocates patients to one of two treatments based on covariate-adjusted biased coin design as proposed by Baldi Antognini A, Zagoraiou M (2011) &lt;doi:10.1093/biomet/asr021&gt;. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AdjBCD(data, a = 3)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AdjBCD_+3A_data">data</code></td>
<td>
<p>a data frame. A row of the dataframe corresponds to the covariate profile of a patient.</p>
</td></tr>
<tr><td><code id="AdjBCD_+3A_a">a</code></td>
<td>
<p>a design parameter governing the degree of randomness. The default is <code>3</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Consider <code class="reqn">I</code> covaraites and <code class="reqn">m_i</code> levels for the <code class="reqn">i</code>th covariate, <code class="reqn">i=1,\ldots,I</code>. <code class="reqn">T_j</code> is the assignment of the <code class="reqn">j</code>th patient and <code class="reqn">Z_j = (k_1,\dots,k_I)</code> indicates the covariate profile of the <code class="reqn">j</code>th patient, <code class="reqn">j=1,\ldots,n</code>. For convenience, <code class="reqn">(k_1,\dots,k_I)</code> and <code class="reqn">(i;k_i)</code> denote stratum and margin, respectively. <code class="reqn">D_j(.)</code> is the difference between numbers of patients assigned to treatment <code class="reqn">1</code> and treatment <code class="reqn">2</code> at the corresponding level after <code class="reqn">j</code> patients have been assigned.
</p>
<p>Let <code class="reqn">F^a</code> be a decreasing and symmetric function of <code class="reqn">D_j(.)</code>, which depends on a design parameter <code class="reqn">a\ge 0</code>. Then, the probability of allocating the <code class="reqn">(j+1)</code>th patient to treatment 1 is <code class="reqn">F^a(D_j(.))</code>, where
</p>
<p style="text-align: center;"><code class="reqn">F^a(x)=\frac{1}{x^a + 1},</code>
</p>
<p>  for <code class="reqn">x\ge 1</code>,
</p>
<p style="text-align: center;"><code class="reqn">F^a(x)=1 / 2, </code>
</p>
<p> for <code class="reqn"> x = 0</code>, and
</p>
<p style="text-align: center;"><code class="reqn">F^a(x)=\frac{|x|^a}{|x|^a + 1}, </code>
</p>
<p> for <code class="reqn">x\le -1.</code>
As <code class="reqn">a</code> goes to <code class="reqn">\infty</code>, the design becomes more deteministic.
</p>
<p>Details of the procedure can be found in Baldi Antognini and M. Zagoraiou (2011).
</p>


<h3>Value</h3>

<p>It returns an object of <code><a href="base.html#topic+class">class</a></code> <code>"carandom"</code>. 
</p>
<p>An object of class <code>"carandom"</code> is a list containing the following components: 
</p>
<table>
<tr><td><code>datanumeric</code></td>
<td>
<p>a bool indicating whether the data is a numeric data frame.</p>
</td></tr>
<tr><td><code>covariates</code></td>
<td>
<p>a character string giving the name(s) of the included covariates.</p>
</td></tr>
<tr><td><code>strt_num</code></td>
<td>
<p>the number of strata.</p>
</td></tr>
<tr><td><code>cov_num</code></td>
<td>
<p>the number of covariates.</p>
</td></tr>
<tr><td><code>level_num</code></td>
<td>
<p>a vector of level numbers for each covariate.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p>the number of patients.</p>
</td></tr>
<tr><td><code>Cov_Assig</code></td>
<td>
<p>a <code>(cov_num + 1) * n</code> matrix containing covariate profiles for all patients and the corresponding assignments. The <code class="reqn">i</code>th column represents the <code class="reqn">i</code>th patient. The first <code>cov_num</code> rows include patients' covariate profiles, and the last row contains the assignments.</p>
</td></tr>
<tr><td><code>assignments</code></td>
<td>
<p>the randomization sequence.</p>
</td></tr>
<tr><td><code>All strata</code></td>
<td>
<p>a matrix containing all strata involved.</p>
</td></tr>
<tr><td><code>Diff</code></td>
<td>
<p>a matrix with only one column. There are final differences at the overall, within-stratum, and within-covariate-margin levels.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>a character string describing the randomization procedure to be used.</p>
</td></tr>
<tr><td><code>Data Type</code></td>
<td>
<p>a character string giving the data type, <code>Real</code> or <code>Simulated</code>. </p>
</td></tr>
<tr><td><code>framework</code></td>
<td>
<p>the framework of the used randomization procedure: stratified randomization, or model-based method.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>the data frame.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Baldi Antognini A, Zagoraiou M. <em>The covariate-adaptive biased coin design for balancing clinical trials in the presence of prognostic factors</em>[J]. Biometrika, 2011, 98(3): 519-535.
</p>
<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47. 
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+AdjBCD.sim">AdjBCD.sim</a></code> for allocating patients with covariate data generating mechanism; 
See <code><a href="#topic+AdjBCD.ui">AdjBCD.ui</a></code> for the command-line user interface.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a simple use
## Real Data
## create a dataframe
df &lt;- data.frame("gender" = sample(c("female", "male"), 1000, TRUE, c(1 / 3, 2 / 3)), 
                 "age" = sample(c("0-30", "30-50", "&gt;50"), 1000, TRUE), 
                 "jobs" = sample(c("stu.", "teac.", "others"), 1000, TRUE), 
                 stringsAsFactors = TRUE)
Res &lt;- AdjBCD(df, a = 2)
## view the output
Res

  ## view all patients' profile and assignments
  Res$Cov_Assig
  

## Simulated Data
n &lt;- 1000
cov_num &lt;- 3
level_num &lt;- c(2, 3, 5) 
# Set pr to follow two tips:
#(1) length of pr should be sum(level_num);
#(2) sum of probabilities for each margin should be 1.
pr &lt;- c(0.4, 0.6, 0.3, 0.4, 0.3, rep(0.2, times = 5))
# set the design parameter
a &lt;- 1.8
# obtain result
Res.sim &lt;- AdjBCD.sim(n, cov_num, level_num, pr, a)

  # view the assignments of patients
  Res.sim$Cov_Assig[cov_num + 1, ]
  # view the differences between treatment 1 and treatment 2 at all levels
  Res.sim$Diff
  
</code></pre>

<hr>
<h2 id='AdjBCD.sim'>
Covariate-adjusted Biased Coin Design with Covariate Data Generating Mechanism
</h2><span id='topic+AdjBCD.sim'></span>

<h3>Description</h3>

<p>Allocates patients to one of two treatments based on the covariate-adjusted biased coin design as proposed by Baldi Antognini A, Zagoraiou M (2011) &lt;doi:10.1093/biomet/asr021&gt;, by simulating the covariates-profile under the assumption of independence between covariates and levels within each covariate.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AdjBCD.sim(n = 1000, cov_num = 2, level_num = c(2, 2), 
           pr = rep(0.5, 4), a = 3)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AdjBCD.sim_+3A_n">n</code></td>
<td>
<p>the number of patients. The default is <code>1000</code>.</p>
</td></tr>
<tr><td><code id="AdjBCD.sim_+3A_cov_num">cov_num</code></td>
<td>
<p>the number of covariates. The default is <code>2</code>.</p>
</td></tr>
<tr><td><code id="AdjBCD.sim_+3A_level_num">level_num</code></td>
<td>
<p>a vector of level numbers for each covariate. Hence the length of <code>level_num</code> should be equal to the number of covariates. The default is <code>c(2,2)</code>.</p>
</td></tr>
<tr><td><code id="AdjBCD.sim_+3A_pr">pr</code></td>
<td>
<p>a vector of probabilities. Under the assumption of independence between covariates, <code>pr</code> is a vector containing probabilities for each level of each covariate. The length of <code>pr</code> should correspond to the number of all levels, and the sum of the probabilities for each margin should be <code>1</code>. The default is <code>rep(0.5, 4)</code>, which corresponds to <code>cov_num = 2</code>, and <code>level_num = c(2, 2)</code>.</p>
</td></tr>
<tr><td><code id="AdjBCD.sim_+3A_a">a</code></td>
<td>
<p>a design parameter governing the degree of randomness. The default is <code>3</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+AdjBCD">AdjBCD</a></code>.
</p>


<h3>Value</h3>

<p>See <code><a href="#topic+AdjBCD">AdjBCD</a></code>. 
</p>


<h3>References</h3>

<p>Baldi Antognini A, Zagoraiou M. <em>The covariate-adaptive biased coin design for balancing clinical trials in the presence of prognostic factors</em>[J]. Biometrika, 2011, 98(3): 519-535.
</p>
<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47. 
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+AdjBCD">AdjBCD</a></code> for allocating patients with complete covariate data; See <code><a href="#topic+AdjBCD.ui">AdjBCD.ui</a></code> for the command-line user interface. 
</p>

<hr>
<h2 id='AdjBCD.ui'>
Command-line User Interface Using Covariate-adjusted Biased Coin Design
</h2><span id='topic+AdjBCD.ui'></span>

<h3>Description</h3>

<p>A call to the user-interface function for allocation of patients to one of two treatments, using covariate-adjusted biased coin design, as proposed by Baldi Antognini A, Zagoraiou M (2011) &lt;doi:10.1093/biomet/asr021&gt;. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AdjBCD.ui(path, folder = "AdjBCD")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AdjBCD.ui_+3A_path">path</code></td>
<td>
<p>the path in which a folder used to store variables will be created.</p>
</td></tr>
<tr><td><code id="AdjBCD.ui_+3A_folder">folder</code></td>
<td>
<p>name of the folder. If it is the default, a folder named <code>"AdjBCD"</code> will be created.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+AdjBCD">AdjBCD</a></code>.
</p>


<h3>Value</h3>

<p>It returns an object of <code><a href="base.html#topic+class">class</a></code> <code>"carseq"</code>.
</p>
<p>The function <code><a href="base.html#topic+print">print</a></code> is used to obtain results. The generic accessor functions <code>assignment</code>, <code>covariate</code>, <code>cov_num</code>, <code>cov_profile</code> and others extract various useful features of the value returned by <code>AdjBCD.ui</code>. 
</p>


<h3>Note</h3>

<p>This function provides a command-line user interface, and users should follow the prompts to enter data including covariates as well as levels for each covariate, design parameter <code>a</code> and the covariate profile of the new patient.
</p>


<h3>References</h3>

<p>Baldi Antognini A, Zagoraiou M. <em>The covariate-adaptive biased coin design for balancing clinical trials in the presence of prognostic factors</em>[J]. Biometrika, 2011, 98(3): 519-535.
</p>
<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47. 
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+AdjBCD">AdjBCD</a></code> for allocating patients with complete covariate data; See <code><a href="#topic+AdjBCD.sim">AdjBCD.sim</a></code> for allocating patients with covariate data generating mechanism.
</p>

<hr>
<h2 id='boot.test'>Bootstrap t-test</h2><span id='topic+boot.test'></span>

<h3>Description</h3>

<p>Performs bootstrap t-test on treatment effects. This test is proposed by Shao et al. (2010) &lt;doi:10.1093/biomet/asq014&gt;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  boot.test(data, B = 200, method = c("HuHuCAR", "PocSimMIN", "StrBCD", 
                                  "StrPBR", "DoptBCD", "AdjBCD"), 
          conf = 0.95, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="boot.test_+3A_data">data</code></td>
<td>
<p>a data frame. It consists of patients' profiles, treatment assignments and outputs. See <code><a href="#topic+getData">getData</a></code>.</p>
</td></tr>
<tr><td><code id="boot.test_+3A_b">B</code></td>
<td>
<p>an integer. It is the number of bootstrap samples. The default is <code>200</code>.</p>
</td></tr>
<tr><td><code id="boot.test_+3A_method">method</code></td>
<td>
<p>the randomization procedure to be used for testing. This package provides tests for <code>"HuHuCAR"</code>, <code>"PocSimMIN"</code>, <code>"StrBCD"</code>, <code>"StrPBR"</code>, <code>"AdjBCD"</code>, and <code>"DoptBCD"</code>.</p>
</td></tr>
<tr><td><code id="boot.test_+3A_conf">conf</code></td>
<td>
<p>confidence level of the interval. The default is <code>0.95</code>.</p>
</td></tr>
<tr><td><code id="boot.test_+3A_...">...</code></td>
<td>
<p>arguments to be passed to <code>method</code>. These arguments depend on the randomization method used and the following arguments are accepted:
</p>

<dl>
<dt>omega</dt><dd><p>a vector of weights at the overall, within-stratum, and within-covariate-margin levels. It is required that at least one element is larger than 0. Note that <code>omega</code> is only needed when <code>HuHuCAR</code> is to be used.</p>
</dd>
<dt>weight</dt><dd><p>a vector of weights for within-covariate-margin imbalances. It is required that at least one element is larger than 0. Note that <code>weight</code> is only needed when <code>PocSimMIN</code> is to be used.</p>
</dd>
<dt>p</dt><dd><p>the biased coin probability. <code>p</code> should be larger than <code>1/2</code> and less than <code>1</code>. Note that <code>p</code> is only needed when <code>"HuHuCAR", "PocSimMIN"</code> and <code>"StrBCD"</code> are to be used.</p>
</dd>
<dt>a</dt><dd><p>a design parameter governing the degree of randomness. Note that <code>a</code> is only needed when <code>"AdjBCD"</code> is to be used.</p>
</dd>
<dt>bsize</dt><dd><p>the block size for stratified randomization. It is required to be a multiple of 2. Note that <code>bsize</code> is only needed when <code>"StrPBR"</code> is to be used.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Details</h3>

<p>The bootstrap t-test is described as follows:
</p>
<p>1) Generate bootstrap data (<code class="reqn">Y_1^*,Z_1^*), \dots, (Y_n^*,Z_n^*)</code> as a simple random sample with replacement from the original data <code class="reqn">(Y_1,Z_1), \dots,(Y_n,Z_n)</code>, where <code class="reqn">Y_i</code> denotes the outcome and <code class="reqn">Z_i</code> denotes the profile of the <code class="reqn">i</code>th patient.
</p>
<p>2) Perform covariate-adaptive procedures on the patients' profiles to obtain new treatment assignments <code class="reqn">T_1^*,\dots,T_n^*</code>, and define
</p>
<p style="text-align: center;"><code class="reqn">\hat{\theta}^* = -\frac{1}{n_1^*}\sum\limits_{i=1}^n (T_i^*-2) \times Y_i^* - \frac{1}{n_0^*}\sum\limits_{i=1}^n (T_i^*-1) \times Y_i</code>
</p>

<p>where <code class="reqn">n_1^*</code> is the number of patients assigned to treatment <code class="reqn">1</code> and <code class="reqn">n_0^*</code> is the number of patients assigned to treatment <code class="reqn">2</code>.
</p>
<p>3) Repeat step 2 <code class="reqn">B</code> times to generate <code class="reqn">B</code> independent boostrap samples to obtain <code class="reqn">\hat{\theta}^*_b</code>, <code class="reqn">b = 1,\dots,B</code>. The variance of <code class="reqn">\bar{Y}_1 - \bar{Y}_0</code> can then be approximated by the sample variance of <code class="reqn">\hat{\theta}^*_b</code>. 
</p>


<h3>Value</h3>

<p>It returns an object of class <code>"htest"</code>.
</p>
<p>An object of class <code>"htest"</code> is a list containing the following components:
</p>
<table>
<tr><td><code>statistic</code></td>
<td>
<p>the value of the t-statistic.</p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>the p-value of the test,the null hypothesis is rejected if p-value is less than the pre-determined significance level.</p>
</td></tr>
<tr><td><code>conf.int</code></td>
<td>
<p>a confidence interval under the chosen level <code>conf</code> for the difference in treatment effect between treatment <code>1</code> and treatment <code>2</code>.</p>
</td></tr>
<tr><td><code>estimate</code></td>
<td>
<p>the estimated treatment effect difference between treatment <code>1</code> and treatment <code>2</code>.</p>
</td></tr>
<tr><td><code>stderr</code></td>
<td>
<p>the standard error of the mean (difference), used as denominator in the t-statistic formula.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>a character string indicating what type of test was performed.</p>
</td></tr>
<tr><td><code>data.name</code></td>
<td>
<p>a character string giving the name(s) of the data.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>
<p>Shao J, Yu X, Zhong B. <em>A theory for testing hypotheses under covariate-adaptive randomization</em>[J]. Biometrika, 2010, 97(2): 347-360.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Suppose the data used is patients' profile from real world, 
#  while it is generated here. Data needs to be preprocessed 
#  and then get assignments following certain randomization.
set.seed(100)
df&lt;- data.frame("gender" = sample(c("female", "male"), 100, TRUE, c(1 / 3, 2 / 3)),
                "age" = sample(c("0-30", "30-50", "&gt;50"), 100, TRUE),
                "jobs" = sample(c("stu.", "teac.", "other"), 100, TRUE, c(0.4, 0.2, 0.4)), 
                stringsAsFactors = TRUE)
##data preprocessing
data.pd &lt;- StrPBR(data = df, bsize = 4)$Cov_Assig

#Then we need to combine patients' profiles and outcomes after randomization and treatments.
outcome = runif(100)
data.combined = data.frame(rbind(data.pd,outcome), stringsAsFactors = TRUE)

#run the bootstrap t-test
B = 200
Strbt = boot.test(data.combined, B, "StrPBR", bsize = 4)
Strbt
</code></pre>

<hr>
<h2 id='carat-package'>
carat-package: Covariate-Adaptive Randomization for Clinical Trials
</h2><span id='topic+carat-package'></span><span id='topic+carat'></span>

<h3>Description</h3>

<p>Provides functions and a command-line user interface to generate allocation sequences for clinical trials with covariate-adaptive randomization methods. It currently supports six different covariate-adaptive randomization procedures, including stratified randomization, minimization, and a general family of designs proposed by Hu and Hu (2012) &lt;doi:10.1214/12-AOS983&gt;. Three hypothesis testing methods, all valid and robust under covariate-adaptive randomization are also included in the package to facilitate the inference for treatment effects under the included randomization procedures. Additionally, the package provides comprehensive and efficient tools for the performance evaluation and comparison of randomization procedures and tests based on various criteria.
</p>


<h3>Acknowledgement</h3>

<p>This work was supported by the Fundamental Research Funds for the Central Universities, and the Research Funds of Renmin University of China [grant number 20XNA023].
</p>


<h3>Author(s)</h3>

<p>Fuyi Tu <a href="mailto:fuyi.tu@ruc.edu.cn">fuyi.tu@ruc.edu.cn</a>;Xiaoqing Ye <a href="mailto:ye_xiaoq@163.com">ye_xiaoq@163.com</a>; 
Wei Ma <a href="mailto:mawei@ruc.edu.cn">mawei@ruc.edu.cn</a>;  Feifang Hu <a href="mailto:feifang@gwu.edu">feifang@gwu.edu</a>.
</p>


<h3>References</h3>

<p>Atkinson A C. <em>Optimum biased coin designs for sequential clinical trials with prognostic factors</em>[J]. Biometrika, 1982, 69(1): 61-67. &lt;doi:10.2307/2335853&gt;
</p>
<p>Baldi Antognini A, Zagoraiou M. <em>The covariate-adaptive biased coin design for balancing clinical trials in the presence of prognostic factors</em>[J]. Biometrika, 2011, 98(3): 519-535. &lt;doi:10.1093/biomet/asr021&gt;
</p>
<p>Hu Y, Hu F. <em>Asymptotic properties of covariate-adaptive randomization</em>[J]. The Annals of Statistics, 2012, 40(3): 1794-1815. &lt;doi:10.1214/12-AOS983&gt;
</p>
<p>Ma W, Hu F, Zhang L. <em>Testing hypotheses of covariate-adaptive randomized clinical trials</em>[J]. Journal of the American Statistical Association, 2015, 110(510): 669-680. &lt;doi:10.1080/01621459.2014.922469&gt;
</p>
<p>Ma W, Qin Y, Li Y, et al. <em>Statistical Inference for Covariate-Adaptive Randomization Procedures</em>[J]. Journal of the American Statistical Association, 2020, 115(531): 1488-1597. &lt;doi:10.1080/01621459.2019.1635483&gt;
</p>
<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47. &lt;doi: 10.18637/jss.v107.i02&gt;
</p>
<p>Pocock S J, Simon R. <em>Sequential treatment assignment with balancing for prognostic factors in the controlled clinical trial</em>[J]. Biometrics, 1975: 103-115. &lt;doi:10.2307/2529712&gt;
</p>
<p>Rosenberger W F, Lachin J M. <em>Randomization in clinical trials: theory and practice</em>[M]. John Wiley &amp; Sons, 2015. &lt;doi:10.1002/9781118742112&gt;
</p>
<p>Shao J., Yu, X. <em>Validity of tests under covariate-adaptive biased coin randomization and generalized linear models</em>[J]. Biometrics, 2013, 69(4), 960-969. &lt;doi:10.1111/biom.12062&gt;
</p>
<p>Shao J., Yu X, Zhong B. <em>A theory for testing hypotheses under covariate-adaptive randomization</em>[J]. Biometrika, 2010, 97(2): 347-360. &lt;doi:10.1093/biomet/asq014&gt;
</p>
<p>Zelen M. <em>The randomization and stratification of patients to clinical trials</em>[J]. Journal of chronic diseases, 1974, 27(7): 365-375. &lt;doi:10.1016/0021-9681(74)90015-0&gt;
</p>

<hr>
<h2 id='compPower'>Comparison of Powers for Different Tests under Different Randomization methods</h2><span id='topic+compPower'></span>

<h3>Description</h3>

<p>Compares the power of tests under different randomization methods and treatment effects through matrices and plots.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  compPower(powers, diffs, testname)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="compPower_+3A_powers">powers</code></td>
<td>
<p>a list. Each argument consists the power generated by <code>evalPower()</code> in this package or by other sources. The length of each argument must match.</p>
</td></tr>
<tr><td><code id="compPower_+3A_diffs">diffs</code></td>
<td>
<p>a vector. It contains values of group treatment effect differences. The length of this argument and the length of each argument of <code>powers</code> must match.</p>
</td></tr>
<tr><td><code id="compPower_+3A_testname">testname</code></td>
<td>
<p>a vector. Each element is the name of test and the randomization method used. For example, when applying <code>rand.test</code> and <code>corr.test</code> under <code>HuHuCAR</code>, it can be <code>c("HH.rand","HH.corr")</code>. The length of this argument must match the length of <code>diffs</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>This function returns a list. The first element is a matrix consisting of powers of chosen tests under different values of treatment effects. The second element of the list is a plot of powers. <code>diffs</code> forms the vertical axis of the plot.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##settings
set.seed(100)
n = 1000
cov_num = 5
level_num = c(2,2,2,2,2)
pr = rep(0.5,10)
beta = c(1,4,3,2,5,5,4,3,2,1)
di = seq(0,0.5,0.1)
sigma = 1
type = "linear"
p=0.85
Iternum = 10 #&lt;&lt;for demonstration,it is suggested to be around 1000
sl = 0.05
weight = rep(0.1,5)

#comparison of corrected t-test under StrBCD and PocSim
##data generation
library("ggplot2")
Strctp=evalPower(n,cov_num,level_num,pr,type,beta,di,
                sigma,Iternum,sl,"StrBCD","corr.test",FALSE,p)
PSctp=evalPower(n,cov_num,level_num,pr,type,beta,di,sigma,
                Iternum,sl,"PocSimMIN","corr.test",FALSE,weight,p)
powers = list(Strctp,PSctp)
testname = c("StrBCD.corr","PocSimMIN.corr")

#get plot and matrix for comparison
cp = compPower(powers,di,testname)
cp
</code></pre>

<hr>
<h2 id='compRand'>Compare Different Randomization Procedures via Tables and Plots</h2><span id='topic+compRand'></span>

<h3>Description</h3>

<p>Compares randomization procedures based on several different quantities of imbalances. Among all included randomization procedures of class <code>"careval"</code>, two or more procedures can be compared in this function. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compRand(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="compRand_+3A_...">...</code></td>
<td>
<p>objects of class <code>"careval"</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The primary goal of using covariate-adaptive randomization in practice is to achieve balance with respect to the key covariates. We choose four rules to measure the absolute imbalances at overall, within-covariate-margin, and within-stratum levels, which are maximal, 95%quantile, median and mean of the absolute imbalances at different aspects. The Monte Carlo method is used to calculate the four types of imbalances. Let <code class="reqn">D_{n,i}(\cdot)</code> be the final difference at the corresponding level for <code class="reqn">i</code>th iteration, <code class="reqn">i=1,\ldots</code>, <code>N</code>, and <code>N</code> is the number of iterations.
</p>
<p>(1) Maximal
</p>
<p style="text-align: center;"><code class="reqn">\max_{i = 1, \dots, N}|D_{n,i}(\cdot)|.</code>
</p>

<p>(2) 95% quantile
</p>
<p style="text-align: center;"><code class="reqn">|D_{n,\lceil0.95N\rceil}(\cdot)|.</code>
</p>

<p>(3) Median
</p>
<p style="text-align: center;"><code class="reqn">|D_{n,(N+1)/2}(\cdot)|</code>
</p>

<p>for <code>N</code> is odd, and
</p>
<p style="text-align: center;"><code class="reqn">\frac{1}{2}(|D_{(N/2)}(\cdot)|+|D_{(N/2+1)}(\cdot)|)</code>
</p>

<p>for <code>N</code> is even.
</p>
<p>(4) Mean
</p>
<p style="text-align: center;"><code class="reqn">\frac{1}{N}\sum_{i = 1}^{N}|D_{n, i}(\cdot)|.</code>
</p>



<h3>Value</h3>

<p>It returns an object of <code><a href="base.html#topic+class">class</a></code> <code>"carcomp"</code>. 
</p>
<p>An object of class <code>"carcomp"</code> is a list containing the following components: 
</p>
<table>
<tr><td><code>Overall Imbalances</code></td>
<td>
<p>a matrix containing the maximum, 95%-quantile, median, and mean of the absolute overall imbalances for the randomization method(s) to be evaluated.</p>
</td></tr>
<tr><td><code>Within-covariate-margin Imbalances Imbalances</code></td>
<td>
<p>a matrix containing the maximum, 95%-quantile, median, and mean of the absolute within-covariate-margin imbalances for the randomization method(s) to be evaluated.</p>
</td></tr>
<tr><td><code>Within-stratum Imbalances</code></td>
<td>
<p>a matrix containing the maximum, 95%-quantile, median, and mean of the absolute within-stratum imbalances for the randomization method(s) to be evaluated.</p>
</td></tr>
<tr><td><code>dfmm</code></td>
<td>
<p>a data frame containing the mean absolute imbalances at the overall, within-stratum, and within-covariate-margin levels for the randomization method(s) to be evaluated.</p>
</td></tr>
<tr><td><code>df_abm</code></td>
<td>
<p>a data frame containing the absolute imbalances at the overall, within-stratum, and within-covariate-margin levels.</p>
</td></tr>
<tr><td><code>mechanism</code></td>
<td>
<p>a character string giving the randomization method(s) to be evaluated.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p>the number of patients.</p>
</td></tr>
<tr><td><code>iteration</code></td>
<td>
<p>the number of iterations.</p>
</td></tr>
<tr><td><code>cov_num</code></td>
<td>
<p>the number of covariates.</p>
</td></tr>
<tr><td><code>level_num</code></td>
<td>
<p>a vector of level numbers for each covariate.</p>
</td></tr>
<tr><td><code>Data Type</code></td>
<td>
<p>a character string giving the data type, <code>Real</code> or <code>Simulated</code>. </p>
</td></tr>
<tr><td><code>DataGeneration</code></td>
<td>
<p>a bool vector indicating whether the data used for all the iterations is the same for the randomization method(s) to be evaluated.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Atkinson A C. <em>Optimum biased coin designs for sequential clinical trials with prognostic factors</em>[J]. Biometrika, 1982, 69(1): 61-67.
</p>
<p>Baldi Antognini A, Zagoraiou M. <em>The covariate-adaptive biased coin design for balancing clinical trials in the presence of prognostic factors</em>[J]. Biometrika, 2011, 98(3): 519-535.
</p>
<p>Hu Y, Hu F. <em>Asymptotic properties of covariate-adaptive randomization</em>[J]. The Annals of Statistics, 2012, 40(3): 1794-1815.
</p>
<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>
<p>Pocock S J, Simon R. <em>Sequential treatment assignment with balancing for prognostic factors in the controlled clinical trial</em>[J]. Biometrics, 1975: 103-115.
</p>
<p>Shao J, Yu X, Zhong B. <em>A theory for testing hypotheses under covariate-adaptive randomization</em>[J]. Biometrika, 2010, 97(2): 347-360. 
</p>
<p>Zelen M. <em>The randomization and stratification of patients to clinical trials</em>[J]. Journal of chronic diseases, 1974, 27(7): 365-375.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+evalRand">evalRand</a></code> or <code><a href="#topic+evalRand.sim">evalRand.sim</a></code> to evaluate a specific randomization procedure.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Compare stratified permuted block randomization and Hu and Hu's general CAR
cov_num &lt;- 2
level_num &lt;- c(2, 2)
pr &lt;- rep(0.5, 4)
n &lt;- 500
N &lt;- 20 # &lt;&lt;adjust according to CPU
bsize &lt;- 4
# set weight for Hu and Hu's method, it satisfies
# (1)Length should equal to cov_num
omega &lt;- c(1, 2, 1, 1)
# Assess Hu and Hu's general CAR
Obj1 &lt;- evalRand.sim(n = n, N = N, Replace = FALSE, cov_num = cov_num, 
                     level_num = level_num, pr = pr, method = "HuHuCAR", 
                     omega, p = 0.85)
# Assess stratified permuted block randomization
Obj2 &lt;- evalRand.sim(n = n, N = N, Replace = FALSE, cov_num = cov_num, 
                     level_num = level_num, pr = pr, method = "StrPBR", 
                     bsize)

RES &lt;- compRand(Obj1, Obj2)

</code></pre>

<hr>
<h2 id='corr.test'>Corrected t-test</h2><span id='topic+corr.test'></span>

<h3>Description</h3>

<p>Performs corrected t-test on treatment effects. This test follows the idea of Ma et al. (2015) &lt;doi:10.1080/01621459.2014.922469&gt;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  corr.test(data, conf = 0.95)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="corr.test_+3A_data">data</code></td>
<td>
<p>a data frame. It consists of patients' profiles, treatment assignments and outputs. See <code><a href="#topic+getData">getData</a></code>.</p>
</td></tr>
<tr><td><code id="corr.test_+3A_conf">conf</code></td>
<td>
<p>confidence level of the interval. The default is <code>0.95</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When the working model is the true underlying linear model, and the chosen covariate-adaptive design achieves that the overall imbalance and marginal imbalances for all covariates are bounded in probability, we can derive the asymptotic distribution under the null distribution, where the treatment effect of each group is the same. Subsequently, we can replace the variance estimator in a simple two sample t-test with an adjusted variance estimator. Details can be found in Ma et al.(2015). 
</p>


<h3>Value</h3>

<p>It returns an object of class <code>"htest"</code>.
</p>
<p>An object of class <code>"htest"</code> is a list containing the following components:
</p>
<table>
<tr><td><code>statistic</code></td>
<td>
<p>the value of the t-statistic.</p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>the p-value of the test,the null hypothesis is rejected if p-value is less than the pre-determined significance level.</p>
</td></tr>
<tr><td><code>conf.int</code></td>
<td>
<p>a confidence interval under the chosen level <code>conf</code> for the difference in treatment effect between treatment <code>1</code> and treatment <code>2</code>.</p>
</td></tr>
<tr><td><code>estimate</code></td>
<td>
<p>the estimated treatment effect difference between treatment <code>1</code> and treatment <code>2</code>.</p>
</td></tr>
<tr><td><code>stderr</code></td>
<td>
<p>the standard error of the mean (difference), used as denominator in the t-statistic formula.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>a character string indicating what type of test was performed.</p>
</td></tr>
<tr><td><code>data.name</code></td>
<td>
<p>a character string giving the name(s) of the data.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Ma W, Hu F, Zhang L. <em>Testing hypotheses of covariate-adaptive randomized clinical trials</em>[J]. Journal of the American Statistical Association, 2015, 110(510): 669-680.
</p>
<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##generate data
set.seed(100)
n = 1000
cov_num = 5
level_num = c(2,2,2,2,2)
pr = rep(0.5,10)
beta = c(0.1,0.4,0.3,0.2,0.5,0.5,0.4,0.3,0.2,0.1)
omega = c(0.1, 0.1, rep(0.8 / 5, times = 5))
mu1 = 0
mu2 = 0.7
sigma = 1
type = "linear"
p = 0.85

dataH = getData(n,cov_num,level_num,pr,type,beta,
                mu1,mu2,sigma,"HuHuCAR",omega,p)

#run the corrected t-test
HHct=corr.test(dataH)
HHct
</code></pre>

<hr>
<h2 id='DoptBCD'>Atkinson's <code class="reqn">D_A</code>-optimal Biased Coin Design</h2><span id='topic+DoptBCD'></span>

<h3>Description</h3>

<p>Allocates patients to one of two treatments based on the <code class="reqn">D_A</code>-optimal biased coin design in the presence of the prognostic factors proposed by Atkinson A C (1982) &lt;doi:10.2307/2335853&gt;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DoptBCD(data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="DoptBCD_+3A_data">data</code></td>
<td>
<p>a data frame. A row of the dataframe corresponds to the covariate profile of a patient.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Consider an experiment involving <code class="reqn">n</code> patients. Assuming a linear model between response and covariates, Atkinson's <code class="reqn">D_A</code>-optimal biased coin design sequentially assigns patients to minimize the variance of estimated treatment effects. Supposing <code class="reqn">j</code> patients have been assigned, the probability of assigning the <code class="reqn">(j+1)</code>th patient to treatment 1 is
</p>
<p style="text-align: center;"><code class="reqn">\frac{[1 - (1; \bold{x}^t_{j+1})(\bold{F}^t_j\bold{F}_j)^{-1}\bold{b}_j]^2}{[1-(1; \bold{x}^t_{j+1})(\bold{F}_j^t\bold{F}_j)^{-1}\bold{b}_j]^2+[1 + (1; \bold{x}_{j+1}^t)(\bold{F}_j^t\bold{F}_j)^{-1}\bold{b}_j]^2},</code>
</p>

<p>where <code class="reqn">\bold{X} = (\bold{x_i}, i = 1, \dots, j)</code> and <code class="reqn">\bold{x}_i = (x_{i1}, \dots, x_{ij})</code> denote the covariate profile of the <code class="reqn">i</code>th patient; and <code class="reqn">\bold{F}_j = [\bold{1}_j; \bold{X}]</code> is the information matrix; and <code class="reqn">\bold{b}_j^T=(2\bold{T}_j-\bold{1}_j)^T\bold{F}_j</code>, <code class="reqn">\bold{T}_j = (T_1, \dots, T_j)</code> is a sequence containing the first <code class="reqn">j</code> patients' allocations.
</p>
<p>Details of the procedure can be found in A.C.Atkinson (1982).
</p>


<h3>Value</h3>

<p>It returns an object of <code><a href="base.html#topic+class">class</a></code> <code>"carandom"</code>. 
</p>
<p>An object of class <code>"carandom"</code> is a list containing the following components: 
</p>
<table>
<tr><td><code>datanumeric</code></td>
<td>
<p>a bool indicating whether the data is a numeric data frame.</p>
</td></tr>
<tr><td><code>covariates</code></td>
<td>
<p>a character string giving the name(s) of the included covariates.</p>
</td></tr>
<tr><td><code>strt_num</code></td>
<td>
<p>the number of strata.</p>
</td></tr>
<tr><td><code>cov_num</code></td>
<td>
<p>the number of covariates.</p>
</td></tr>
<tr><td><code>level_num</code></td>
<td>
<p>a vector of level numbers for each covariate.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p>the number of patients.</p>
</td></tr>
<tr><td><code>Cov_Assig</code></td>
<td>
<p>a <code>(cov_num + 1) * n</code> matrix containing covariate profiles for all patients and the corresponding assignments. The <code class="reqn">i</code>th column represents the <code class="reqn">i</code>th patient. The first <code>cov_num</code> rows include patients' covariate profiles, and the last row contains the assignments.</p>
</td></tr>
<tr><td><code>assignments</code></td>
<td>
<p>the randomization sequence.</p>
</td></tr>
<tr><td><code>All strata</code></td>
<td>
<p>a matrix containing all strata involved.</p>
</td></tr>
<tr><td><code>Diff</code></td>
<td>
<p>a matrix with only one column. There are final differences at the overall, within-stratum, and within-covariate-margin levels.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>a character string describing the randomization procedure to be used.</p>
</td></tr>
<tr><td><code>Data Type</code></td>
<td>
<p>a character string giving the data type, <code>Real</code> or <code>Simulated</code>. </p>
</td></tr>
<tr><td><code>framework</code></td>
<td>
<p>the framework of the used randomization procedure: stratified randomization, or model-based method.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>the data frame.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Atkinson A C. <em>Optimum biased coin designs for sequential clinical trials with prognostic factors</em>[J]. Biometrika, 1982, 69(1): 61-67.
</p>
<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+DoptBCD.sim">DoptBCD.sim</a></code> for allocating patients with covariate data generating mechanism.  
See <code><a href="#topic+DoptBCD.ui">DoptBCD.ui</a></code> for the command-line user interface.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a simple use
## Real Data
df &lt;- data.frame("gender" = sample(c("female", "male"), 100, TRUE, c(1 / 3, 2 / 3)), 
                 "age" = sample(c("0-30", "30-50", "&gt;50"), 100, TRUE), 
                 "jobs" = sample(c("stu.", "teac.", "others"), 100, TRUE), 
                 stringsAsFactors = TRUE)
Res &lt;- DoptBCD(df)
## view the output
Res

## view all patients' profile and assignments
## Res$Cov_Assig

## Simulated Data
n &lt;- 1000
cov_num &lt;- 2 

level_num &lt;- c(2, 5)
# Set pr to follow two tips:
#(1) length of pr should be sum(level_num);
#(2)sum of probabilities for each margin should be 1.
pr &lt;- c(0.4, 0.6, rep(0.2, times = 5))
Res.sim &lt;- DoptBCD.sim(n, cov_num, level_num, pr)
## view the output
Res.sim

## view the difference between treatment 1 and treatment 2 
##             at overall, within-strt. and overall levels
Res.sim$Diff


N &lt;- 5
n &lt;- 100
cov_num &lt;- 2
level_num &lt;- c(3, 5) # &lt;&lt; adjust to your CPU and the length should correspond to cov_num
## Set pr to follow two tips:
## (1) length of pr should be sum(level_num);
## (2)sum of probabilities for each margin should be 1
pr &lt;- c(0.3, 0.4, 0.3, rep(0.2, times = 5))
omega &lt;- c(0.2, 0.2, rep(0.6 / cov_num, times = cov_num))

## generate a container to contain Diff
DH &lt;- matrix(NA, ncol = N, nrow = 1 + prod(level_num) + sum(level_num))
DA &lt;- matrix(NA, ncol = N, nrow = 1 + prod(level_num) + sum(level_num))
for(i in 1 : N){
  result &lt;- HuHuCAR.sim(n, cov_num, level_num, pr, omega)
  resultA &lt;- StrBCD.sim(n, cov_num, level_num, pr)
  DH[ , i] &lt;- result$Diff; DA[ , i] &lt;- resultA$Diff
}
## do some analysis
require(dplyr)

## analyze the overall imbalance
Ana_O &lt;- matrix(NA, nrow = 2, ncol = 3)
rownames(Ana_O) &lt;- c("HuHuCAR", "DoptBCD")
colnames(Ana_O) &lt;- c("mean", "median", "95%quantile")
temp &lt;- DH[1, ] %&gt;% abs
tempA &lt;- DA[1, ] %&gt;% abs
Ana_O[1, ] &lt;- c((temp %&gt;% mean), (temp %&gt;% median),
                (temp %&gt;% quantile(0.95)))
Ana_O[2, ] &lt;- c((tempA %&gt;% mean), (tempA %&gt;% median),
                (tempA %&gt;% quantile(0.95)))

## analyze the within-stratum imbalances
tempW &lt;- DH[2 : (1 + prod(level_num)), ] %&gt;% abs
tempWA &lt;- DA[2 : 1 + prod(level_num), ] %&gt;% abs
Ana_W &lt;- matrix(NA, nrow = 2, ncol = 3)
rownames(Ana_W) &lt;- c("HuHuCAR", "DoptBCD")
colnames(Ana_W) &lt;- c("mean", "median", "95%quantile")
Ana_W[1, ] = c((tempW %&gt;% apply(1, mean) %&gt;% mean),
               (tempW %&gt;% apply(1, median) %&gt;% mean),
               (tempW %&gt;% apply(1, mean) %&gt;% quantile(0.95)))
Ana_W[2, ] = c((tempWA %&gt;% apply(1, mean) %&gt;% mean),
               (tempWA %&gt;% apply(1, median) %&gt;% mean),
               (tempWA %&gt;% apply(1, mean) %&gt;% quantile(0.95)))

## analyze the marginal imbalance
tempM &lt;- DH[(1 + prod(level_num) + 1) :
              (1 + prod(level_num) + sum(level_num)), ] %&gt;% abs
tempMA &lt;- DA[(1 + prod(level_num) + 1) :
               (1 + prod(level_num) + sum(level_num)), ] %&gt;% abs
Ana_M &lt;- matrix(NA, nrow = 2, ncol = 3)
rownames(Ana_M) &lt;- c("HuHuCAR", "DoptBCD")
colnames(Ana_M) &lt;- c("mean", "median", "95%quantile")
Ana_M[1, ] = c((tempM %&gt;% apply(1, mean) %&gt;% mean),
               (tempM %&gt;% apply(1, median) %&gt;% mean),
               (tempM %&gt;% apply(1, mean) %&gt;% quantile(0.95)))
Ana_M[2, ] = c((tempMA %&gt;% apply(1, mean) %&gt;% mean),
               (tempMA %&gt;% apply(1, median) %&gt;% mean),
               (tempMA %&gt;% apply(1, mean) %&gt;% quantile(0.95)))

AnaHP &lt;- list(Ana_O, Ana_M, Ana_W)
names(AnaHP) &lt;- c("Overall", "Marginal", "Within-stratum")

AnaHP
</code></pre>

<hr>
<h2 id='DoptBCD.sim'>
Atkinson's <code class="reqn">D_A</code>-optimal Biased Coin Design with Covariate Data Generating Mechanism
</h2><span id='topic+DoptBCD.sim'></span>

<h3>Description</h3>

<p>Allocates patients generated by simulating covariates-profile under the assumption of independence between covariates and levels within each covariate, to one of two treatments based on the <code class="reqn">D_A</code>-optimal biased coin design in the presence of prognostic factors, as proposed by Atkinson A C (1982) &lt;doi:10.2307/2335853&gt;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DoptBCD.sim(n = 1000, cov_num = 2, level_num = c(2, 2), 
            pr = rep(0.5, 4))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="DoptBCD.sim_+3A_n">n</code></td>
<td>
<p>the number of patients. The default is <code>1000</code>.</p>
</td></tr>
<tr><td><code id="DoptBCD.sim_+3A_cov_num">cov_num</code></td>
<td>
<p>the number of covariates. The default is <code>2</code>.</p>
</td></tr>
<tr><td><code id="DoptBCD.sim_+3A_level_num">level_num</code></td>
<td>
<p>a vector of level numbers for each covariate. Hence the length of <code>level_num</code> should be equal to the number of covariates. The default is <code>c(2,2)</code>.</p>
</td></tr>
<tr><td><code id="DoptBCD.sim_+3A_pr">pr</code></td>
<td>
<p>a vector of probabilities. Under the assumption of independence between covariates, <code>pr</code> is a vector containing probabilities for each level of each covariate. The length of <code>pr</code> should correspond to the number of all levels, and the sum of the probabilities for each margin should be <code>1</code>. The default is <code>rep(0.5, 4)</code>, which corresponds to <code>cov_num = 2</code>, and <code>level_num = c(2, 2)</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+DoptBCD">DoptBCD</a></code>.
</p>


<h3>Value</h3>

<p>See <code><a href="#topic+DoptBCD">DoptBCD</a></code>. 
</p>


<h3>References</h3>

<p>Atkinson A C. <em>Optimum biased coin designs for sequential clinical trials with prognostic factors</em>[J]. Biometrika, 1982, 69(1): 61-67.
</p>
<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+DoptBCD">DoptBCD</a></code> for allocating patients with complete covariate data; See <code><a href="#topic+DoptBCD.ui">DoptBCD.ui</a></code> for the command-line user interface. 
</p>

<hr>
<h2 id='DoptBCD.ui'>
Command-line User Interface Using Atkinson's <code class="reqn">D_A</code>-optimal Biased Coin Design
</h2><span id='topic+DoptBCD.ui'></span>

<h3>Description</h3>

<p>A call to the user-interface function used to allocate patients to one of two treatments using Atkinson's <code class="reqn">D_A</code>-optimal biased coin design proposed by Atkinson A C (1982) &lt;doi:10.2307/2335853&gt;. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DoptBCD.ui(path, folder = "DoptBCD")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="DoptBCD.ui_+3A_path">path</code></td>
<td>
<p>the path in which a folder used to store variables will be created. </p>
</td></tr>
<tr><td><code id="DoptBCD.ui_+3A_folder">folder</code></td>
<td>
<p>name of the folder. If default, a folder named <code>"DoptBCD"</code> will be created.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+DoptBCD">DoptBCD</a></code>.
</p>


<h3>Value</h3>

<p>It returns an object of <code><a href="base.html#topic+class">class</a></code> <code>"carseq"</code>.
</p>
<p>The function <code><a href="base.html#topic+print">print</a></code> is used to obtain results. The generic accessor functions <code>assignment</code>, <code>covariate</code>, <code>cov_num</code>, <code>cov_profile</code> and others extract various useful features of the value returned by that function. 
</p>


<h3>Note</h3>

<p>This function provides a command-line user interface and users should follow the prompts to enter data including covariates, as well as levels for each covariate and the covariate profile of the new patient.
</p>


<h3>References</h3>

<p>Atkinson A C. <em>Optimum biased coin designs for sequential clinical trials with prognostic factors</em>[J]. Biometrika, 1982, 69(1): 61-67.
</p>
<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+DoptBCD">DoptBCD</a></code> for allocating patients with complete covariate data; See <code><a href="#topic+DoptBCD.sim">DoptBCD.sim</a></code> for allocating patients with covariate data generating mechanism.
</p>

<hr>
<h2 id='evalPower'>Evaluation of Tests and Randomization Procedures through Power</h2><span id='topic+evalPower'></span>

<h3>Description</h3>

<p>Returns powers and a plot of the chosen test and method under different treatment effects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  evalPower(n, cov_num, level_num, pr, type, beta, di = seq(0,0.5,0.1), sigma = 1,
          Iternum, sl = 0.05, method = c("HuHuCAR", "PocSimMIN", "StrBCD", "StrPBR", 
                                         "DoptBCD","AdjBCD"), 
          test = c("boot.test", "corr.test", "rand.test"), plot = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="evalPower_+3A_n">n</code></td>
<td>
<p>the number of patients.</p>
</td></tr>
<tr><td><code id="evalPower_+3A_cov_num">cov_num</code></td>
<td>
<p>the number of covariates.</p>
</td></tr>
<tr><td><code id="evalPower_+3A_level_num">level_num</code></td>
<td>
<p>a vector of level numbers for each covariate. Hence the length of <code>level_num</code> should be equal to the number of covariates.</p>
</td></tr>
<tr><td><code id="evalPower_+3A_pr">pr</code></td>
<td>
<p>a vector of probabilities. Under the assumption of independence between covariates, <code>pr</code> is a vector containing probabilities for each level of each covariate. The length of <code>pr</code> should correspond to the number of all levels, and the sum of the probabilities for each margin should be <code>1</code>.</p>
</td></tr>
<tr><td><code id="evalPower_+3A_type">type</code></td>
<td>
<p>a data-generating method. Optional input: <code>"linear"</code> or <code>"logit"</code>.</p>
</td></tr>
<tr><td><code id="evalPower_+3A_beta">beta</code></td>
<td>
<p>a vector of coefficients of covariates. The length of <code>beta</code> must correspond to the sum of all covariates' levels.</p>
</td></tr>
<tr><td><code id="evalPower_+3A_di">di</code></td>
<td>
<p>a value or a vector of values of difference in treatment effects. The default value is a sequence from <code>0</code> to <code>0.5</code> with increments of <code>0.1</code>. The value(s) forms the horizontal axis of the plot.</p>
</td></tr>
<tr><td><code id="evalPower_+3A_sigma">sigma</code></td>
<td>
<p>the error variance for the linear model. The default is 1. This should be a positive value and is only used when <code>type = linear</code>.</p>
</td></tr>
<tr><td><code id="evalPower_+3A_iternum">Iternum</code></td>
<td>
<p>an integer. It is the number of iterations required for power calculation.</p>
</td></tr>
<tr><td><code id="evalPower_+3A_sl">sl</code></td>
<td>
<p>the significance level. If the <code class="reqn">p</code> value returned by the test is less than <code>sl</code>, the null hypothesis will be rejected. The default value is <code>0.05</code>.</p>
</td></tr>
<tr><td><code id="evalPower_+3A_method">method</code></td>
<td>
<p>the randomization procedure to be used for power calculation. This package provides power calculation for <code>"HuHuCAR"</code>, <code>"PocSimMIN"</code>, <code>"StrBCD"</code>, <code>"StrPBR"</code>, <code>"AdjBCD"</code>, and <code>"DoptBCD"</code>.</p>
</td></tr>
<tr><td><code id="evalPower_+3A_test">test</code></td>
<td>
<p>a character string specifying the alternative tests used to verify hypothesis, must be one of <code>"boot.test"</code>, <code>"corr.test"</code> or <code>"rand.test"</code>, which are the bootstrap <code class="reqn">t</code> test, the corrected <code class="reqn">t</code> test, and the randomization test, respectively. The arguments associated with the testing function can be specified; otherwise, the default value will be used.</p>
</td></tr>
<tr><td><code id="evalPower_+3A_plot">plot</code></td>
<td>
<p>a bool. It indicates whether to plot or not. Optional input: <code>TRUE</code> or <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="evalPower_+3A_...">...</code></td>
<td>
<p>arguments to be passed to <code>method</code>. These arguments depend on the randomization method used and the following arguments are accepted:
</p>

<dl>
<dt>omega</dt><dd><p>a vector of weights at the overall, within-stratum, and within-covariate-margin levels. It is required that at least one element is larger than 0. Note that <code>omega</code> is only needed when <code>HuHuCAR</code> is to be used.</p>
</dd>
<dt>weight</dt><dd><p>a vector of weights for within-covariate-margin imbalances. It is required that at least one element is larger than 0. Note that <code>weight</code> is only needed when <code>PocSimMIN</code> is to be used.</p>
</dd>
<dt>p</dt><dd><p>the biased coin probability. <code>p</code> should be larger than <code>1/2</code> and less than <code>1</code>. Note that <code>p</code> is only needed when <code>"HuHuCAR", "PocSimMIN"</code> and <code>"StrBCD"</code> are to be used.</p>
</dd>
<dt>a</dt><dd><p>a design parameter governing the degree of randomness. Note that <code>a</code> is only needed when <code>"AdjBCD"</code> is to be used.</p>
</dd>
<dt>bsize</dt><dd><p>the block size for the stratified randomization. It is required to be a multiple of 2. Note that <code>bsize</code> is only needed when <code>"StrPBR"</code> is to be used.</p>
</dd>
<dt>B</dt><dd><p>an integer. It is the number of bootstrap samples. It is needed only when <code>test</code> is <code>boot.test</code>.</p>
</dd>
<dt>Reps</dt><dd><p>an integer. It is the number of randomized replications used in the randomization test. It is needed only when <code>test</code> is <code>rand.test</code>.</p>
</dd>
<dt>nthreads</dt><dd><p>the number of threads to be used in parallel computation. This is needed only under <code>rand.test</code> and <code>boot.test</code>. The default is <code>1</code>. </p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>This function returns a list. The first element is a dataframe representing the powers of the chosen test under different values of treatment effects. The second element is the execution time. An optional element is the plot of power in which <code>di</code> forms the vertical axis. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##settings
set.seed(2019)
n = 100#&lt;&lt;for demonstration,it is suggested to be larger than 1000
cov_num = 5
level_num = c(2,2,2,2,2)
pr = rep(0.5,10)
beta = c(0.1,0.4,0.3,0.2,0.5,0.5,0.4,0.3,0.2,0.1)
omega = c(0.1, 0.1, rep(0.8 / 5, times = 5))
di = seq(0,0.5,0.1)
sigma = 1
type = "linear"
p = 0.85
Iternum = 10#&lt;&lt;for demonstration,it is suggested to be around 1000
sl = 0.05
Reps = 10#&lt;&lt;for demonstration,it is suggested to be 200

#Evaluation of Power
library("ggplot2")
Strtp=evalPower(n,cov_num,level_num,pr,type,beta,di,sigma,
                Iternum,sl,"HuHuCAR","rand.test",TRUE,omega,p,Reps, nthreads = 1)
Strtp
</code></pre>

<hr>
<h2 id='evalRand'>Evaluation of Randomization Procedures</h2><span id='topic+evalRand'></span>

<h3>Description</h3>

<p>Evaluates a specific randomization procedure based on several different quantities of imbalances. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>evalRand(data, method = "HuHuCAR", N = 500, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="evalRand_+3A_data">data</code></td>
<td>
<p>a data frame. A row of the dataframe corresponds to the covariate profile of a patient.</p>
</td></tr>
<tr><td><code id="evalRand_+3A_n">N</code></td>
<td>
<p>the iteration number. The default is 500.</p>
</td></tr>
<tr><td><code id="evalRand_+3A_method">method</code></td>
<td>
<p>the randomization procedure to be evaluated. This package provides assessment for <code>"HuHuCAR"</code>, <code>"PocSimMIN"</code>, <code>"StrBCD"</code>, <code>"StrPBR"</code>, <code>"AdjBCD"</code>, and <code>"DoptBCD"</code>.</p>
</td></tr>
<tr><td><code id="evalRand_+3A_...">...</code></td>
<td>
<p>arguments to be passed to <code>method</code>. These arguments depend on the randomization method assessed and the following arguments are accepted:
</p>

<dl>
<dt>omega</dt><dd><p>a vector of weights at the overall, within-stratum, and within-covariate-margin levels. It is required that at least one element is larger than 0. Note that <code>omega</code> is only needed when <code>HuHuCAR</code> is to be assessed.</p>
</dd>
<dt>weight</dt><dd><p>a vector of weights for within-covariate-margin imbalances. It is required that at least one element is larger than 0. Note that <code>weight</code> is only needed when <code>PocSimMIN</code> is to be assessed.</p>
</dd>
<dt>p</dt><dd><p>the biased coin probability. <code>p</code> should be larger than <code>1/2</code> and less than <code>1</code>. Note that <code>p</code> is only needed when <code>"HuHuCAR"</code>,  <code>"PocSimMIN"</code> and <code>"StrBCD"</code> are to be assessed.</p>
</dd>
<dt>a</dt><dd><p>a design parameter governing the degree of randomness. Note that <code>a</code> is only needed when <code>"AdjBCD"</code> is to be assessed.</p>
</dd>
<dt>bsize</dt><dd><p>the block size for stratified permuted block randomization. It is required to be a multiple of <code>2</code>. Note that <code>bsize</code> is only needed when <code>"StrPBR"</code> is to be assessed.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>data</code> is designed for <code>N</code> times using <code>method</code>.
</p>


<h3>Value</h3>

<p>It returns an object of <code><a href="base.html#topic+class">class</a></code> <code>"careval"</code>. 
</p>
<p>An object of class <code>"careval"</code> is a list containing the following components: 
</p>
<table>
<tr><td><code>datanumeric</code></td>
<td>
<p>a bool indicating whether the data is a numeric data frame.</p>
</td></tr>
<tr><td><code>weight</code></td>
<td>
<p>a vector giving the weights imposed on each covariate.</p>
</td></tr>
<tr><td><code>bsize</code></td>
<td>
<p>the block size.</p>
</td></tr>
<tr><td><code>covariates</code></td>
<td>
<p>a character string giving the name(s) of the included covariates.</p>
</td></tr>
<tr><td><code>Assig</code></td>
<td>
<p>a <code>n*N</code> matrix containing assignments for each patient for N iterations.</p>
</td></tr>
<tr><td><code>strt_num</code></td>
<td>
<p>the number of strata.</p>
</td></tr>
<tr><td><code>All strata</code></td>
<td>
<p>a matrix containing all strata involved.</p>
</td></tr>
<tr><td><code>Imb</code></td>
<td>
<p>a matrix containing maximum, 95%-quantile, median, and mean of absolute imbalances at overall, within-stratum and within-covariate-margin levels. Note that, we refer users to the <code class="reqn">i</code>th column of <code>`All strata`</code> for details of <code>level</code> <code class="reqn">i, i=1,\ldots,</code><code>strt_num</code>. </p>
</td></tr>
<tr><td><code>SNUM</code></td>
<td>
<p>a matrix with <code>N</code> colunms containing the number of patients in each stratum for each iteration.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>the randomization method to be evaluated.</p>
</td></tr>
<tr><td><code>cov_num</code></td>
<td>
<p>the number of covariates.</p>
</td></tr>
<tr><td><code>level_num</code></td>
<td>
<p>a vector of level numbers for each covariate.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p>the number of patients.</p>
</td></tr>
<tr><td><code>iteration</code></td>
<td>
<p>the number of iterations.</p>
</td></tr>
<tr><td><code>Data Type</code></td>
<td>
<p>the data type. <code>Real</code> or <code>Simulated</code>.</p>
</td></tr>
<tr><td><code>DIF</code></td>
<td>
<p>a matrix containing the final differences at the overall, within-stratum, and within-covariate-margin levels for each iteration.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>the data frame.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Atkinson A C. <em>Optimum biased coin designs for sequential clinical trials with prognostic factors</em>[J]. Biometrika, 1982, 69(1): 61-67.
</p>
<p>Baldi Antognini A, Zagoraiou M. <em>The covariate-adaptive biased coin design for balancing clinical trials in the presence of prognostic factors</em>[J]. Biometrika, 2011, 98(3): 519-535.
</p>
<p>Hu Y, Hu F. <em>Asymptotic properties of covariate-adaptive randomization</em>[J]. The Annals of Statistics, 2012, 40(3): 1794-1815.
</p>
<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>
<p>Pocock S J, Simon R. <em>Sequential treatment assignment with balancing for prognostic factors in the controlled clinical trial</em>[J]. Biometrics, 1975: 103-115.
</p>
<p>Shao J, Yu X, Zhong B. <em>A theory for testing hypotheses under covariate-adaptive randomization</em>[J]. Biometrika, 2010, 97(2): 347-360. 
</p>
<p>Zelen M. <em>The randomization and stratification of patients to clinical trials</em>[J]. Journal of chronic diseases, 1974, 27(7): 365-375.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+evalRand.sim">evalRand.sim</a></code> to evaluate a randomization procedure with covariate data generating mechanism.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a simple use
## Access by real data
## create a dataframe
df &lt;- data.frame("gender" = sample(c("female", "male"), 1000, TRUE, c(1 / 3, 2 / 3)), 
                 "age" = sample(c("0-30", "30-50", "&gt;50"), 1000, TRUE), 
                 "jobs" = sample(c("stu.", "teac.", "others"), 1000, TRUE), 
                 stringsAsFactors = TRUE)
Res &lt;- evalRand(data = df, method = "HuHuCAR", N = 500, 
                omega = c(1, 2, rep(1, ncol(df))), p = 0.85)
## view the output
Res

  ## view all patients' assignments
  Res$Assig

## Assess by simulated data
cov_num &lt;- 3
level_num &lt;- c(2, 3, 5)
pr &lt;- c(0.35, 0.65, 0.25, 0.35, 0.4, 0.25, 0.15, 0.2, 0.15, 0.25)
n &lt;- 1000
N &lt;- 50
omega = c(1, 2, 1, 1, 2)
# assess Hu and Hu's procedure with the same group of patients
Res.sim &lt;- evalRand.sim(n = n, N = N, Replace = FALSE, cov_num = cov_num, 
                        level_num = level_num, pr = pr, method = "HuHuCAR", 
                        omega, p = 0.85)
 
  ## Compare four procedures
  cov_num &lt;- 3
  level_num &lt;- c(2, 10, 2)
  pr &lt;- c(rep(0.5, times = 2), rep(0.1, times = 10), rep(0.5, times = 2))
  n &lt;- 100
  N &lt;- 200 # &lt;&lt;adjust according to CPU
  bsize &lt;- 4
  ## set weights for HuHuCAR
  omega &lt;- c(1, 2, rep(1, cov_num)); 
  ## set weights for PocSimMIN
  weight = rep(1, cov_num); 
  ## set biased probability
  p = 0.80
  # assess Hu and Hu's procedure
  RH &lt;- evalRand.sim(n = n, N = N, Replace = FALSE, cov_num = cov_num, 
                     level_num = level_num, pr = pr, method = "HuHuCAR", 
                     omega = omega, p = p)
  # assess Pocock and Simon's method
  RPS &lt;- evalRand.sim(n = n, N = N, Replace = FALSE, cov_num = cov_num, 
                      level_num = level_num, pr = pr, method = "PocSimMIN", 
                      weight, p = p)
  # assess Shao's procedure
  RS &lt;- evalRand.sim(n = n, N = N, Replace = FALSE, cov_num = cov_num, 
                     level_num = level_num, pr = pr, method = "StrBCD", 
                     p = p)
  # assess stratified randomization
  RSR &lt;- evalRand.sim(n = n, N = N, Replace = FALSE, cov_num = cov_num, 
                      level_num = level_num, pr = pr, method = "StrPBR", 
                      bsize)
  
  # create containers
  C_M = C_O = C_WS = matrix(NA, nrow = 4, ncol = 4)
  colnames(C_M) = colnames(C_O) = colnames(C_WS) = 
    c("max", "95%quan", "med", "mean")
  rownames(C_M) = rownames(C_O) = rownames(C_WS) = 
    c("HH", "PocSim", "Shao", "StraRand")
  
  # assess the overall imbalance
  C_O[1, ] = RH$Imb[1, ]
  C_O[2, ] = RPS$Imb[1, ]
  C_O[3, ] = RS$Imb[1, ]
  C_O[4, ] = RSR$Imb[1, ]
  # view the result
  C_O
  
  # assess the marginal imbalances
  C_M[1, ] = apply(RH$Imb[(1 + RH$strt_num) : (1 + RH$strt_num + sum(level_num)), ], 2, mean)
  C_M[2, ] = apply(RPS$Imb[(1 + RPS$strt_num) : (1 + RPS$strt_num + sum(level_num)), ], 2, mean)
  C_M[3, ] = apply(RS$Imb[(1 + RS$strt_num) : (1 + RS$strt_num + sum(level_num)), ], 2, mean)
  C_M[4, ] = apply(RSR$Imb[(1 + RSR$strt_num) : (1 + RSR$strt_num + sum(level_num)), ], 2, mean)
  # view the result
  C_M
  
  # assess the within-stratum imbalances
  C_WS[1, ] = apply(RH$Imb[2 : (1 + RH$strt_num), ], 2, mean)
  C_WS[2, ] = apply(RPS$Imb[2 : (1 + RPS$strt_num), ], 2, mean)
  C_WS[3, ] = apply(RS$Imb[2 : (1 + RS$strt_num), ], 2, mean)
  C_WS[4, ] = apply(RSR$Imb[2 : (1 + RSR$strt_num), ], 2, mean)
  # view the result
  C_WS
  
  # Compare the four procedures through plots
  meth = rep(c("Hu", "PS", "Shao", "STR"), times = 3)
  shape &lt;- rep(1 : 4, times = 3)
  crt &lt;- rep(1 : 3, each = 4)
  crt_c &lt;- rep(c("O", "M", "WS"), each = 4)
  mean &lt;- c(C_O[, 4], C_M[, 4], C_WS[, 4])
  df_1 &lt;- data.frame(meth, shape, crt, crt_c, mean, 
                     stringsAsFactors = TRUE)
  
  require(ggplot2)
  p1 &lt;- ggplot(df_1, aes(x = meth, y = mean, color = crt_c, group = crt,
                         linetype = crt_c, shape = crt_c)) +
    geom_line(size = 1) +
    geom_point(size = 2) +
    xlab("method") +
    ylab("absolute mean") +
    theme(plot.title = element_text(hjust = 0.5))
  p1

</code></pre>

<hr>
<h2 id='evalRand.sim'>
Evaluation Randomization Procedures with Covariate Data Generating Mechanism
</h2><span id='topic+evalRand.sim'></span>

<h3>Description</h3>

<p>Evaluates randomization procedure based on several different quantities of imbalances by simulating patients' covariate profiles under the assumption of independence between covariates and levels within each covariate. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>evalRand.sim(n = 1000, N = 500, Replace = FALSE, cov_num = 2, 
             level_num = c(2, 2), pr = rep(0.5, 4), method = "HuHuCAR", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="evalRand.sim_+3A_n">N</code></td>
<td>
<p>the iteration number. The default is 500. </p>
</td></tr>
<tr><td><code id="evalRand.sim_+3A_n">n</code></td>
<td>
<p>the number of patients. The default is <code>1000</code>.</p>
</td></tr>
<tr><td><code id="evalRand.sim_+3A_replace">Replace</code></td>
<td>
<p>a bool. If <code>Replace = FALSE</code>, the function does clinical trial design for <code>N</code> iterations for one group of patients. If <code>Replace = TRUE</code>, the function dose clinical trial design for <code>N</code> iterations for <code>N</code> different groups of patients.</p>
</td></tr>
<tr><td><code id="evalRand.sim_+3A_cov_num">cov_num</code></td>
<td>
<p>the number of covariates. The default is <code>2</code>.</p>
</td></tr>
<tr><td><code id="evalRand.sim_+3A_level_num">level_num</code></td>
<td>
<p>a vector of level numbers for each covariate. Hence the length of <code>level_num</code> should be equal to the number of covariates. The default is <code>c(2, 2)</code>. </p>
</td></tr>
<tr><td><code id="evalRand.sim_+3A_pr">pr</code></td>
<td>
<p>a vector of probabilities. Under the assumption of independence between covariates, <code>pr</code> is a vector containing probabilities for each level of each covariate. The length of <code>pr</code> should correspond to the number of all levels, and the sum of the probabilities for each margin should be <code>1</code>. The default is <code>rep(0.5, 4)</code>, which corresponds to <code>cov_num = 2</code>, and <code>level_num = c(2, 2)</code>.</p>
</td></tr>
<tr><td><code id="evalRand.sim_+3A_method">method</code></td>
<td>
<p>the randomization procedure to be evaluated. This package provides assessment for <code>"HuHuCAR"</code>, <code>"PocSimMIN"</code>, <code>"StrBCD"</code>, <code>"StrPBR"</code>, <code>"AdjBCD"</code>, and <code>"DoptBCD"</code>.</p>
</td></tr>
<tr><td><code id="evalRand.sim_+3A_...">...</code></td>
<td>
<p>arguments to be passed to <code>method</code>. These arguments depend on the randomization method assessed and the following arguments are accepted:
</p>

<dl>
<dt>omega</dt><dd><p>a vector of weights at the overall, within-stratum, and within-covariate-margin levels. It is required that at least one element is larger than 0. Note that <code>omega</code> is only needed when <code>HuHuCAR</code> are to be assessed.</p>
</dd>
<dt>weight</dt><dd><p>a vector of weights for within-covariate-margin imbalances. It is required that at least one element is larger than 0. Note that <code>weight</code> is only needed when <code>PocSimMIN</code> is to be assessed.</p>
</dd>
<dt>p</dt><dd><p>the biased coin probability. <code>p</code> should be larger than <code>1/2</code> and less than <code>1</code>. Note that <code>p</code> is only needed when <code>"HuHuCAR"</code>,  <code>"PocSimMIN"</code> and <code>"StrBCD"</code> is to be assessed.</p>
</dd>
<dt>a</dt><dd><p>a design parameter governing the degree of randomness. Note that <code>a</code> is only needed when <code>"AdjBCD"</code> is to be assessed.</p>
</dd>
<dt>bsize</dt><dd><p>the block size for stratified permuted block randomization. It is required to be a multiple of <code>2</code>. Note that <code>bsize</code> is only needed when <code>"StrPBR"</code> is to be assessed.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+evalRand">evalRand</a></code>.
</p>


<h3>Value</h3>

<p>See <code><a href="#topic+evalRand">evalRand</a></code>.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+evalRand">evalRand</a></code> to evaluate a randomization procedure with complete covariate data.
</p>

<hr>
<h2 id='getData'>Data Generation</h2><span id='topic+getData'></span>

<h3>Description</h3>

<p>Generates continuous or binary outcomes given patients' covariates, the underlying model and the randomization procedure.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  getData(n, cov_num, level_num, pr, type, beta, 
          mu1, mu2, sigma = 1, method = "HuHuCAR", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getData_+3A_n">n</code></td>
<td>
<p>the number of patients.</p>
</td></tr>
<tr><td><code id="getData_+3A_cov_num">cov_num</code></td>
<td>
<p>the number of covariates.</p>
</td></tr>
<tr><td><code id="getData_+3A_level_num">level_num</code></td>
<td>
<p>a vector of level numbers for each covariate. Hence the length of <code>level_num</code> should be equal to the number of covariates.</p>
</td></tr>
<tr><td><code id="getData_+3A_pr">pr</code></td>
<td>
<p>a vector of probabilities. Under the assumption of independence between covariates, <code>pr</code> is a vector containing probabilities for each level of each covariate. The length of <code>pr</code> should correspond to the number of all levels, and the sum of the probabilities for each margin should be <code>1</code>.</p>
</td></tr>
<tr><td><code id="getData_+3A_type">type</code></td>
<td>
<p>a data-generating method. Optional input: <code>"linear"</code> or <code>"logit"</code>.</p>
</td></tr>
<tr><td><code id="getData_+3A_beta">beta</code></td>
<td>
<p>a vector of coefficients of covariates. The length of <code>beta</code> must correspond to the sum of all covariates' levels.</p>
</td></tr>
<tr><td><code id="getData_+3A_mu1">mu1</code>, <code id="getData_+3A_mu2">mu2</code></td>
<td>
<p>main effects of treatment <code>1</code> and treatment <code>2</code>.</p>
</td></tr>
<tr><td><code id="getData_+3A_sigma">sigma</code></td>
<td>
<p>the error variance for the linear model. The default is 1. This should be a positive value and is only used when <code>type = linear</code>.</p>
</td></tr>
<tr><td><code id="getData_+3A_method">method</code></td>
<td>
<p>the randomization procedure to be used for generating randomization sequences. This package provides data-generating function for <code>"HuHuCAR"</code>, <code>"PocSimMIN"</code>, <code>"StrBCD"</code>, <code>"StrPBR"</code>, <code>"AdjBCD"</code>, and <code>"DoptBCD"</code>.</p>
</td></tr>
<tr><td><code id="getData_+3A_...">...</code></td>
<td>
<p>arguments to be passed to <code>method</code>. These arguments depend on the randomization method used and the following arguments are accepted:
</p>

<dl>
<dt>omega</dt><dd><p>a vector of weights at the overall, within-stratum, and within-covariate-margin levels. It is required that at least one element is larger than 0. Note that <code>omega</code> is only needed when <code>HuHuCAR</code> is to be used.</p>
</dd>
<dt>weight</dt><dd><p>a vector of weights for within-covariate-margin imbalances. It is required that at least one element is larger than 0. Note that <code>weight</code> is only needed when <code>PocSimMIN</code> is to be used.</p>
</dd>
<dt>p</dt><dd><p>the biased coin probability. <code>p</code> should be larger than <code>1/2</code> and less than <code>1</code>. Note that <code>p</code> is only needed when <code>"HuHuCAR", "PocSimMIN"</code> and <code>"StrBCD"</code> are to be used.</p>
</dd>
<dt>a</dt><dd><p>a design parameter governing the degree of randomness. Note that <code>a</code> is only needed when <code>"AdjBCD"</code> is to be used.</p>
</dd>
<dt>bsize</dt><dd><p>the block size for stratified randomization. It is required to be a multiple of 2. Note that <code>bsize</code> is only needed when <code>"StrPBR"</code> is to be used.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Details</h3>

<p>To generate continuous outcomes, we use the linear model:</p>
<p style="text-align: center;"><code class="reqn">y_i = \mu_j+x_i^T\beta+\epsilon_i,</code>
</p>

<p>to generate binary outcomes, we use the logit link function:</p>
<p style="text-align: center;"><code class="reqn">P(y_i=1) = \frac{exp\{\mu_j+x_i^T\beta \}}{1+exp \{\mu_j+x_i^T\beta }</code>
</p>
<p>,
</p>
<p>where <code class="reqn">j</code> indicates patient <code class="reqn">i</code> belongs to treatment <code class="reqn">j</code>.
</p>


<h3>Value</h3>

<p><code>getData</code> returns a size <code class="reqn">cov_num+2 \times n</code> dataframe. The first <code>cov_num</code> rows represent patients' profile. The next row consists of patients' assignments and the final row consists of generated outcomes.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Parameters' Setting
set.seed(100)
n = 1000
cov_num = 5
level_num = c(2,2,2,2,2)
beta = c(1,4,3,2,5,5,4,3,2,1)
mu1 = 0
mu2 = 0
sigma = 1
type = "linear"
p = 0.85
omega = c(0.1, 0.1, rep(0.8 / 5, times = 5))
pr = rep(0.5,10)

#Data Generation
dataH = getData(n, cov_num,level_num, pr, type, beta,
                mu1, mu2, sigma, "HuHuCAR", omega, p)
dataH[1:(cov_num+2),1:5]
</code></pre>

<hr>
<h2 id='HuHuCAR'>Hu and Hu's General Covariate-Adaptive Randomization</h2><span id='topic+HuHuCAR'></span>

<h3>Description</h3>

<p>Allocates patients to one of two treatments using Hu and Hu's general covariate-adaptive randomization proposed by Hu Y, Hu F (2012) &lt;doi:10.1214/12-AOS983&gt;. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HuHuCAR(data, omega = NULL, p = 0.85)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="HuHuCAR_+3A_data">data</code></td>
<td>
<p>a data frame. A row of the dataframe corresponds to the covariate profile of a patient.</p>
</td></tr>
<tr><td><code id="HuHuCAR_+3A_omega">omega</code></td>
<td>
<p>a vector of weights at the overall, within-stratum, and within-covariate-margin levels. It is required that at least one element is larger than 0. If <code>omega = NULL</code> (default), the overall, within-stratum, and within-covariate-margin imbalances are weighted with porportions <code>0.2</code>, <code>0.3</code>, and <code>0.5/cov_num</code> for each covariate-margin, respectively, where <code>cov_num</code> is the number of covariates of interest.</p>
</td></tr>
<tr><td><code id="HuHuCAR_+3A_p">p</code></td>
<td>
<p>the biased coin probability. <code>p</code> should be larger than <code>1/2</code> and less than <code>1</code>. The default is <code>0.85</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Consider <code class="reqn">I</code> covariates and <code class="reqn">m_i</code> levels for the <code class="reqn">i</code>th covariate, <code class="reqn">i=1,\ldots,I</code>. <code class="reqn">T_j</code> is the assignment of the <code class="reqn">j</code>th patient and <code class="reqn">Z_j = (k_1,\dots,k_I)</code> indicates the covariate profile of this patient, <code class="reqn">j=1,\ldots,n</code>. For convenience, <code class="reqn">(k_1,\dots,k_I)</code> and <code class="reqn">(i;k_i)</code> denote the stratum and margin, respectively. <code class="reqn">D_j(.)</code> is the difference between the numbers of patients assigned to treatment <code class="reqn">1</code> and treatment <code class="reqn">2</code> at the corresponding levels after <code class="reqn">j</code> patients have been assigned. The general covariate-adaptive randomization procedure is as follows:
</p>
<p>(1) The first patient is assigned to treatment <code class="reqn">1</code> with probability <code class="reqn">1/2</code>;
</p>
<p>(2) Suppose that <code class="reqn">j-1</code> patients have been assigned (<code class="reqn">1&lt;j\le n</code>) and the <code class="reqn">j</code>th patient falls within <code class="reqn">(k_1^*,\dots,k_I^*)</code>;
</p>
<p>(3) If the <code class="reqn">j</code>th patient were assigned to treatment <code class="reqn">1</code>, then the potential overall, within-covariate-margin, and within-stratum differences between the two treatments would be
</p>
<p style="text-align: center;"><code class="reqn">D_j^{(1)}=D_{j-1}+1,</code>
</p>

<p style="text-align: center;"><code class="reqn">D_j^{(1)}(i;k_i^*)=D_{j-1}(i,k_i^*)+1,</code>
</p>

<p style="text-align: center;"><code class="reqn">D_j^{(1)}(k_1^*,\dots,k_I^*)=D_j(k_1^*,\dots,k_I^*)+1,</code>
</p>

<p>for margin <code class="reqn">(i;k_i^*)</code> and stratum <code class="reqn">(k_1^*,\ldots,k_I^*)</code>. Similarly, the potential differences at the overall, within-covariate-margin, and within-stratum levels would be obtained if the <code class="reqn">j</code>th patient were assigned to treatment 2; 
</p>
<p>(4) An imbalance measure is defined by
</p>
<p style="text-align: center;"><code class="reqn">Imb_j^{(l)}=\omega_o[D_j^{(l)}]^2+\sum_{i=1}^{I}\omega_{m,i}[D_j^{(l)}(i;k_i^*)]^2+\omega_s[D_j^{(l)}(k_1^*,\dots,k_I^*)]^2,l=1,2;</code>
</p>

<p>(5) Conditional on the assignments of the first (<code class="reqn">j-1</code>) patients as well as the covariate profiles of the first <code class="reqn">j</code> patients, assign the <code class="reqn">j</code>th patient to treatment <code class="reqn">1</code> with probability
</p>
<p style="text-align: center;"><code class="reqn">P(T_j=1|Z_j,T_1,\dots,T_{j-1})=q</code>
</p>
<p> for <code class="reqn">Imb_j^{(1)}&gt;Imb_j^{(2)},</code>
</p>
<p style="text-align: center;"><code class="reqn">P(T_j=1|Z_j,T_1,\dots,T_{j-1})=p</code>
</p>
<p> for <code class="reqn">Imb_j^{(1)}&lt;Imb_j^{(2)}</code>, and
</p>
<p style="text-align: center;"><code class="reqn">P(T_j=1|Z_j,T_1,\dots,T_{j-1})=0.5</code>
</p>
<p> for <code class="reqn">Imb_j^{(1)}=Imb_j^{(2)}.</code>
</p>
<p>Details of the procedure can be found in Hu and Hu (2012).
</p>


<h3>Value</h3>

<p>It returns an object of <code><a href="base.html#topic+class">class</a></code> <code>"carandom"</code>. 
</p>
<p>An object of class <code>"carandom"</code> is a list containing the following components: 
</p>
<table>
<tr><td><code>datanumeric</code></td>
<td>
<p>a bool indicating whether the data is a numeric data frame.</p>
</td></tr>
<tr><td><code>covariates</code></td>
<td>
<p>a character string giving the name(s) of the included covariates.</p>
</td></tr>
<tr><td><code>strt_num</code></td>
<td>
<p>the number of strata.</p>
</td></tr>
<tr><td><code>cov_num</code></td>
<td>
<p>the number of covariates.</p>
</td></tr>
<tr><td><code>level_num</code></td>
<td>
<p>a vector of level numbers for each covariate.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p>the number of patients.</p>
</td></tr>
<tr><td><code>Cov_Assig</code></td>
<td>
<p>a <code>(cov_num + 1) * n</code> matrix containing covariate profiles for all patients and the corresponding assignments. The <code class="reqn">i</code>th column represents the <code class="reqn">i</code>th patient. The first <code>cov_num</code> rows include patients' covariate profiles, and the last row contains the assignments.</p>
</td></tr>
<tr><td><code>assignments</code></td>
<td>
<p>the randomization sequence.</p>
</td></tr>
<tr><td><code>All strata</code></td>
<td>
<p>a matrix containing all strata involved.</p>
</td></tr>
<tr><td><code>Diff</code></td>
<td>
<p>a matrix with only one column. There are final differences at the overall, within-stratum, and within-covariate-margin levels.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>a character string describing the randomization procedure to be used.</p>
</td></tr>
<tr><td><code>Data Type</code></td>
<td>
<p>a character string giving the data type, <code>Real</code> or <code>Simulated</code>. </p>
</td></tr>
<tr><td><code>weight</code></td>
<td>
<p>a vector giving the weights imposed on each covariate.</p>
</td></tr>
<tr><td><code>framework</code></td>
<td>
<p>the framework of the used randomization procedure: stratified randomization, or model-based method.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>the data frame.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Hu Y, Hu F. <em>Asymptotic properties of covariate-adaptive randomization</em>[J]. The Annals of Statistics, 2012, 40(3): 1794-1815.
</p>
<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+HuHuCAR.sim">HuHuCAR.sim</a></code> for allocating patients with covariate data generating mechanism. 
See <code><a href="#topic+HuHuCAR.ui">HuHuCAR.ui</a></code> for the command-line user interface.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a simple use
## Real Data
## create a dataframe
df &lt;- data.frame("gender" = sample(c("female", "male"), 1000, TRUE, c(1 / 3, 2 / 3)), 
                 "age" = sample(c("0-30", "30-50", "&gt;50"), 1000, TRUE), 
                 "jobs" = sample(c("stu.", "teac.", "others"), 1000, TRUE), 
                 stringsAsFactors = TRUE)
omega &lt;- c(1, 2, rep(1, 3))
Res &lt;- HuHuCAR(data = df, omega)
## view the output
Res

## view all patients' profile and assignments
Res$Cov_Assig

## Simulated data
cov_num &lt;- 3
level_num &lt;- c(2, 3, 3)
pr &lt;- c(0.4, 0.6, 0.3, 0.4, 0.3, 0.4, 0.3, 0.3)
omega &lt;- rep(0.2, times = 5)
Res.sim &lt;- HuHuCAR.sim(n = 100, cov_num, level_num, pr, omega)
## view the output
Res.sim

## view the detials of difference
Res.sim$Diff


N &lt;- 100 # &lt;&lt; adjust according to your CPU
n &lt;- 1000
cov_num &lt;- 3
level_num &lt;- c(2, 3, 5) # &lt;&lt; adjust to your CPU and the length should correspond to cov_num
# Set pr to follow two tips:
#(1) length of pr should be sum(level_num);
#(2)sum of probabilities for each margin should be 1.
pr &lt;- c(0.4, 0.6, 0.3, 0.4, 0.3, rep(0.2, times = 5))
omega &lt;- c(0.2, 0.2, rep(0.6 / cov_num, times = cov_num))
# Set omega0 = omegaS = 0
omegaP &lt;- c(0, 0, rep(1 / cov_num, times = cov_num))

## generate a container to contain Diff
DH &lt;- matrix(NA, ncol = N, nrow = 1 + prod(level_num) + sum(level_num))
DP &lt;- matrix(NA, ncol = N, nrow = 1 + prod(level_num) + sum(level_num))
for(i in 1 : N){
  result &lt;- HuHuCAR.sim(n, cov_num, level_num, pr, omega)
  resultP &lt;- HuHuCAR.sim(n, cov_num, level_num, pr, omegaP)
  DH[ , i] &lt;- result$Diff; DP[ , i] &lt;- resultP$Diff
}

## do some analysis
require(dplyr)

## analyze the overall imbalance
Ana_O &lt;- matrix(NA, nrow = 2, ncol = 3)
rownames(Ana_O) &lt;- c("NEW", "PS")
colnames(Ana_O) &lt;- c("mean", "median", "95%quantile")
temp &lt;- DH[1, ] %&gt;% abs
tempP &lt;- DP[1, ] %&gt;% abs
Ana_O[1, ] &lt;- c((temp %&gt;% mean), (temp %&gt;% median),
                (temp %&gt;% quantile(0.95)))
Ana_O[2, ] &lt;- c((tempP %&gt;% mean), (tempP %&gt;% median),
                (tempP %&gt;% quantile(0.95)))
## analyze the within-stratum imbalances
tempW &lt;- DH[2 : (1 + prod(level_num)), ] %&gt;% abs
tempWP &lt;- DP[2 : 1 + prod(level_num), ] %&gt;% abs
Ana_W &lt;- matrix(NA, nrow = 2, ncol = 3)
rownames(Ana_W) &lt;- c("NEW", "PS")
colnames(Ana_W) &lt;- c("mean", "median", "95%quantile")
Ana_W[1, ] = c((tempW %&gt;% apply(1, mean) %&gt;% mean),
               (tempW %&gt;% apply(1, median) %&gt;% mean),
               (tempW %&gt;% apply(1, mean) %&gt;% quantile(0.95)))
Ana_W[2, ] = c((tempWP %&gt;% apply(1, mean) %&gt;% mean),
               (tempWP %&gt;% apply(1, median) %&gt;% mean),
               (tempWP %&gt;% apply(1, mean) %&gt;% quantile(0.95)))

## analyze the marginal imbalance
tempM &lt;- DH[(1 + prod(level_num) + 1) : (1 + prod(level_num) + sum(level_num)), ] %&gt;% abs
tempMP &lt;- DP[(1 + prod(level_num) + 1) : (1 + prod(level_num) + sum(level_num)), ] %&gt;% abs
Ana_M &lt;- matrix(NA, nrow = 2, ncol = 3)
rownames(Ana_M) &lt;- c("NEW", "PS"); colnames(Ana_M) &lt;- c("mean", "median", "95%quantile")
Ana_M[1, ] = c((tempM %&gt;% apply(1, mean) %&gt;% mean),
               (tempM %&gt;% apply(1, median) %&gt;% mean),
               (tempM %&gt;% apply(1, mean) %&gt;% quantile(0.95)))
Ana_M[2, ] = c((tempMP %&gt;% apply(1, mean) %&gt;% mean),
               (tempMP %&gt;% apply(1, median) %&gt;% mean),
               (tempMP %&gt;% apply(1, mean) %&gt;% quantile(0.95)))

AnaHP &lt;- list(Ana_O, Ana_M, Ana_W)
names(AnaHP) &lt;- c("Overall", "Marginal", "Within-stratum")

AnaHP
</code></pre>

<hr>
<h2 id='HuHuCAR.sim'>Hu and Hu's General Covariate-Adaptive Randomization with Covariate Data Generating Mechanism</h2><span id='topic+HuHuCAR.sim'></span>

<h3>Description</h3>

<p>Allocates patients to one of two treatments using general covariate-adaptive randomization proposed by Hu Y, Hu F (2012) &lt;doi:10.1214/12-AOS983&gt;, by simulating covariate profiles based on the assumption of independence between covariates and levels within each covariate.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HuHuCAR.sim(n = 1000, cov_num = 2, level_num = c(2, 2), 
            pr = rep(0.5, 4), omega = NULL, p = 0.85)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="HuHuCAR.sim_+3A_n">n</code></td>
<td>
<p>the number of patients. The default is <code>1000</code>.</p>
</td></tr>
<tr><td><code id="HuHuCAR.sim_+3A_cov_num">cov_num</code></td>
<td>
<p>the number of covariates. The default is <code>2</code>.</p>
</td></tr>
<tr><td><code id="HuHuCAR.sim_+3A_level_num">level_num</code></td>
<td>
<p>a vector of level numbers for each covariate. Hence the length of <code>level_num</code> should be equal to the number of covariates. The default is <code>c(2, 2)</code>.</p>
</td></tr>
<tr><td><code id="HuHuCAR.sim_+3A_pr">pr</code></td>
<td>
<p>a vector of probabilities. Under the assumption of independence between covariates, <code>pr</code> is a vector containing probabilities for each level of each covariate. The length of <code>pr</code> should correspond to the number of all levels, and the sum of the probabilities for each margin should be <code>1</code>. The default is <code>rep(0.5, 4)</code>, which corresponds to <code>cov_num = 2</code>, and <code>level_num = c(2, 2)</code>.</p>
</td></tr>
<tr><td><code id="HuHuCAR.sim_+3A_omega">omega</code></td>
<td>
<p>a vector of weights at the overall, within-stratum, and within-covariate-margin levels. It is required that at least one element is larger than 0. If <code>omega = NULL</code> (default), the overall, within-stratum, and within-covariate-margin imbalances are weighted with porportions <code>0.2</code>, <code>0.3</code>, and <code>0.5/cov_num</code> for each covariate-margin, respectively, where <code>cov_num</code> is the number of covariates of interest.</p>
</td></tr>
<tr><td><code id="HuHuCAR.sim_+3A_p">p</code></td>
<td>
<p>the biased coin probability. <code>p</code> should be larger than <code>1/2</code> and less than <code>1</code>. The default is <code>0.85</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+HuHuCAR">HuHuCAR</a></code>.
</p>


<h3>Value</h3>

<p>See <code><a href="#topic+HuHuCAR">HuHuCAR</a></code>. 
</p>


<h3>References</h3>

<p>Hu Y, Hu F. <em>Asymptotic properties of covariate-adaptive randomization</em>[J]. The Annals of Statistics, 2012, 40(3): 1794-1815.
</p>
<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+HuHuCAR">HuHuCAR</a></code> for allocating patients with complete covariate data; See <code><a href="#topic+HuHuCAR.ui">HuHuCAR.ui</a></code> for the command-line user interface. 
</p>

<hr>
<h2 id='HuHuCAR.ui'>
Command-line User Interface Using Hu and Hu's General Covariate-adaptive Randomization
</h2><span id='topic+HuHuCAR.ui'></span>

<h3>Description</h3>

<p>A call to the user-iterface function used to allocate patients to one of two treatments using Hu and Hu's general covariate-adaptive randomization method as proposed by Hu Y, Hu F (2012) &lt;doi:10.1214/12-AOS983&gt;. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HuHuCAR.ui(path, folder = "HuHuCAR")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="HuHuCAR.ui_+3A_path">path</code></td>
<td>
<p>the path in which a folder used to store variables will be created. </p>
</td></tr>
<tr><td><code id="HuHuCAR.ui_+3A_folder">folder</code></td>
<td>
<p>name of the folder. If default, a folder named <code>"HuHuCAR"</code> will be created.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+HuHuCAR">HuHuCAR</a></code>
</p>


<h3>Value</h3>

<p>It returns an object of <code><a href="base.html#topic+class">class</a></code> <code>"carseq"</code>.
</p>
<p>The function <code><a href="base.html#topic+print">print</a></code> is used to obtain results. The generic accessor functions <code>assignment</code>, <code>covariate</code>, <code>cov_num</code>, <code>cov_profile</code> and others extract various useful features of the value returned by <code>HuHuCAR.ui</code>. 
</p>


<h3>Note</h3>

<p>This function provides a command-line interface so that users should follow the prompts to enter data, including covariates as well as levels for each covariate, weights <code>omega</code>, biased probability <code>p</code> and the covariate profile of the new patient. 
</p>


<h3>References</h3>

<p>Hu Y, Hu F. <em>Asymptotic properties of covariate-adaptive randomization</em>[J]. The Annals of Statistics, 2012, 40(3): 1794-1815.
</p>
<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+HuHuCAR">HuHuCAR</a></code> for allocating patients with complete covariate data; See <code><a href="#topic+HuHuCAR.sim">HuHuCAR.sim</a></code> for allocating patients with covariate data generating mechanism.
</p>

<hr>
<h2 id='pats'>
Data of Covariate Profile of Patients
</h2><span id='topic+pats'></span>

<h3>Description</h3>

<p>Gives the simulated covariate profile of patients for clincal trials. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(pats)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pats_+3A_pats">pats</code></td>
<td>
<p>a data frame. Each row contains an individual's covariate profile and each column corresponds to a covariate. It contains the following columns:
</p>

<dl>
<dt>gender</dt><dd><p>Options are <code>male</code> and <code>female</code>. </p>
</dd>
<dt>employment status</dt><dd><p>Options are &quot;unemployment&quot; (<code>unemp</code>), &quot;part time&quot; (<code>part.</code>), and &quot;full time&quot; (<code>full.</code>).</p>
</dd>
<dt>income</dt><dd><p>Options are <code>&gt;= 1w</code>, <code>&lt;= 0.5w</code>, and <code>0.5~1w</code>.</p>
</dd>
<dt>marriage status</dt><dd><p>Options are <code>unmarried</code>, <code>married</code>, and <code>divorced</code></p>
</dd>
</dl>

</td></tr>
</table>

<hr>
<h2 id='PocSimMIN'>Pocock and Simon's Method in the Two-Arms Case</h2><span id='topic+PocSimMIN'></span>

<h3>Description</h3>

<p>Allocates patients to one of two treatments using Pocock and Simon's method proposed by Pocock S J, Simon R (1975) &lt;doi:10.2307/2529712&gt;. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PocSimMIN(data, weight = NULL, p = 0.85)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PocSimMIN_+3A_data">data</code></td>
<td>
<p>a data frame. A row of the dataframe corresponds to the covariate profile of a patient.</p>
</td></tr>
<tr><td><code id="PocSimMIN_+3A_weight">weight</code></td>
<td>
<p>a vector of weights for within-covariate-margin imbalances. It is required that at least one element is larger than 0. If <code>weight = NULL</code> (default), the within-covariate-margin imbalances are weighted with an equal proportion, <code>1/cov_num</code>, for each covariate-margin.</p>
</td></tr>
<tr><td><code id="PocSimMIN_+3A_p">p</code></td>
<td>
<p>the biased coin probability. <code>p</code> should be larger than <code>1/2</code> and less than <code>1</code>. The default is <code>0.85</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Consider <code class="reqn">I</code> covariates and <code class="reqn">m_i</code> levels for the <code class="reqn">i</code>th covariate, <code class="reqn">i=1,\ldots,I</code>. <code class="reqn">T_j</code> is the assignment of the <code class="reqn">j</code>th patient and <code class="reqn">Z_j = (k_1,\dots,k_I)</code> indicates the covariate profile of this patient, <code class="reqn">j=1,\ldots,n</code>. For convenience, <code class="reqn">(k_1,\dots,k_I)</code> and <code class="reqn">(i;k_i)</code> denote the stratum and margin, respectively. <code class="reqn">D_j(.)</code> is the difference between the numbers of patients assigned to treatment <code class="reqn">1</code> and treatment <code class="reqn">2</code> at the corresponding levels after <code class="reqn">j</code> patients have been assigned. The Pocock and Simon's minimization procedure is as follows:
</p>
<p>(1) The first patient is assigned to treatment <code class="reqn">1</code> with probability <code class="reqn">1/2</code>;
</p>
<p>(2) Suppose that <code class="reqn">j-1</code> patients have been assigned (<code class="reqn">1&lt;j\le n</code>) and the <code class="reqn">j</code>th patient falls within <code class="reqn">(k_1^*,\dots,k_I^*)</code>;
</p>
<p>(3) If the <code class="reqn">j</code>th patient were assigned to treatment <code class="reqn">1</code>, then the potential within-covariate-margin differences between the two treatments would be
</p>
<p style="text-align: center;"><code class="reqn">D_j^{(1)}(i;k_i^*)=D_{j-1}(i,k_i^*)+1</code>
</p>

<p>for margin <code class="reqn">(i;k_i^*)</code>. Similarly, the potential differences would be obtained in the same way if the <code class="reqn">j</code>th patient were assigned to treatment <code class="reqn">2</code>;
</p>
<p>(4) An imbalance measure is defined by
</p>
<p style="text-align: center;"><code class="reqn">Imb_j^{(l)}=\sum_{i=1}^{I}\omega_{m,i}[D_j^{(l)}(i;k_i^*)]^2,l=1,2;</code>
</p>

<p>(5) Conditional on the assignments of the first (<code class="reqn">j-1</code>) patients as well as the covariate profiles of the first <code class="reqn">j</code> patients, assign the <code class="reqn">j</code>th patient to treatment <code class="reqn">1</code> with the probability
</p>
<p style="text-align: center;"><code class="reqn">P(T_j=1|Z_j,T_1,\dots,T_{j-1})=q</code>
</p>
<p> for <code class="reqn">Imb_j^{(1)}&gt;Imb_j^{(2)},</code>
</p>
<p style="text-align: center;"><code class="reqn">P(T_j=1|Z_j,T_1,\dots,T_{j-1})=p</code>
</p>
<p> for <code class="reqn">Imb_j^{(1)}&lt;Imb_j^{(2)}</code>, and
</p>
<p style="text-align: center;"><code class="reqn">P(T_j=1|Z_j,T_1,\dots,T_{j-1})=0.5</code>
</p>
<p> for <code class="reqn">Imb_j^{(1)}=Imb_j^{(2)}.</code>
</p>
<p>Details of the procedure can be found in Pocock S J, Simon R (1975).
</p>


<h3>Value</h3>

<p>It returns an object of <code><a href="base.html#topic+class">class</a></code> <code>"carandom"</code>. 
</p>
<p>An object of class <code>"carandom"</code> is a list containing the following components: 
</p>
<table>
<tr><td><code>datanumeric</code></td>
<td>
<p>a bool indicating whether the data is a numeric data frame.</p>
</td></tr>
<tr><td><code>covariates</code></td>
<td>
<p>a character string giving the name(s) of the included covariates.</p>
</td></tr>
<tr><td><code>strt_num</code></td>
<td>
<p>the number of strata.</p>
</td></tr>
<tr><td><code>cov_num</code></td>
<td>
<p>the number of covariates.</p>
</td></tr>
<tr><td><code>level_num</code></td>
<td>
<p>a vector of level numbers for each covariate.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p>the number of patients.</p>
</td></tr>
<tr><td><code>Cov_Assig</code></td>
<td>
<p>a <code>(cov_num + 1) * n</code> matrix containing covariate profiles for all patients and the corresponding assignments. The <code class="reqn">i</code>th column represents the <code class="reqn">i</code>th patient. The first <code>cov_num</code> rows include patients' covariate profiles, and the last row contains the assignments.</p>
</td></tr>
<tr><td><code>assignments</code></td>
<td>
<p>the randomization sequence.</p>
</td></tr>
<tr><td><code>All strata</code></td>
<td>
<p>a matrix containing all strata involved.</p>
</td></tr>
<tr><td><code>Diff</code></td>
<td>
<p>a matrix with only one column. There are final differences at the overall, within-stratum, and within-covariate-margin levels.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>a character string describing the randomization procedure to be used.</p>
</td></tr>
<tr><td><code>Data Type</code></td>
<td>
<p>a character string giving the data type, <code>Real</code> or <code>Simulated</code>. </p>
</td></tr>
<tr><td><code>weight</code></td>
<td>
<p>a vector giving the weights imposed on each covariate.</p>
</td></tr>
<tr><td><code>framework</code></td>
<td>
<p>the framework of the used randomization procedure: stratified randomization, or model-based method.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>the data frame.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>
<p>Pocock S J, Simon R. <em>Sequential treatment assignment with balancing for prognostic factors in the controlled clinical trial</em>[J]. Biometrics, 1975: 103-115.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+PocSimMIN.sim">PocSimMIN.sim</a></code> for allocating patients with covariate data generating mechanism. 
See <code><a href="#topic+PocSimMIN.ui">PocSimMIN.ui</a></code> for the command-line user interface.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a simple use
## Real Data
## creat a dataframe
df &lt;- data.frame("gender" = sample(c("female", "male"), 1000, TRUE, c(1 / 3, 2 / 3)), 
                 "age" = sample(c("0-30", "30-50", "&gt;50"), 1000, TRUE), 
                 "jobs" = sample(c("stu.", "teac.", "others"), 1000, TRUE), 
                 stringsAsFactors = TRUE)
weight &lt;- c(1, 2, 1)
Res &lt;- PocSimMIN(data = df, weight)
## view the output
Res

## view all patients' profile and assignments
Res$Cov_Assig

## Simulated Data
cov_num = 3
level_num = c(2, 3, 3)
pr = c(0.4, 0.6, 0.3, 0.3, 0.4, 0.4, 0.3, 0.3)
Res.sim &lt;- PocSimMIN.sim(n = 1000, cov_num, level_num, pr)
## view the output
Res.sim

## view the detials of difference
Res.sim$Diff


N &lt;- 5
n &lt;- 1000
cov_num &lt;- 3
level_num &lt;- c(2, 3, 5) 
# Set pr to follow two tips:
# (1) length of pr should be sum(level_num);
# (2)sum of probabilities for each margin should be 1.
pr &lt;- c(0.4, 0.6, 0.3, 0.4, 0.3, rep(0.2, times = 5))
omega &lt;- c(0.2, 0.2, rep(0.6 / cov_num, times = cov_num))
weight &lt;- c(2, rep(1, times = cov_num - 1))

## generate a container to contain Diff
DH &lt;- matrix(NA, ncol = N, nrow = 1 + prod(level_num) + sum(level_num))
DP &lt;- matrix(NA, ncol = N, nrow = 1 + prod(level_num) + sum(level_num))
for(i in 1 : N){
  result &lt;- HuHuCAR.sim(n, cov_num, level_num, pr, omega)
  resultP &lt;- PocSimMIN.sim(n, cov_num, level_num, pr, weight)
  DH[ , i] &lt;- result$Diff; DP[ , i] &lt;- resultP$Diff
}

## do some analysis
require(dplyr)

## analyze the overall imbalance
Ana_O &lt;- matrix(NA, nrow = 2, ncol = 3)
rownames(Ana_O) &lt;- c("NEW", "PS")
colnames(Ana_O) &lt;- c("mean", "median", "95%quantile")
temp &lt;- DH[1, ] %&gt;% abs
tempP &lt;- DP[1, ] %&gt;% abs
Ana_O[1, ] &lt;- c((temp %&gt;% mean), (temp %&gt;% median),
                (temp %&gt;% quantile(0.95)))
Ana_O[2, ] &lt;- c((tempP %&gt;% mean), (tempP %&gt;% median),
                (tempP %&gt;% quantile(0.95)))

## analyze the within-stratum imbalances
tempW &lt;- DH[2 : (1 + prod(level_num)), ] %&gt;% abs
tempWP &lt;- DP[2 : 1 + prod(level_num), ] %&gt;% abs
Ana_W &lt;- matrix(NA, nrow = 2, ncol = 3)
rownames(Ana_W) &lt;- c("NEW", "PS")
colnames(Ana_W) &lt;- c("mean", "median", "95%quantile")
Ana_W[1, ] = c((tempW %&gt;% apply(1, mean) %&gt;% mean),
               (tempW %&gt;% apply(1, median) %&gt;% mean),
               (tempW %&gt;% apply(1, mean) %&gt;% quantile(0.95)))
Ana_W[2, ] = c((tempWP %&gt;% apply(1, mean) %&gt;% mean),
               (tempWP %&gt;% apply(1, median) %&gt;% mean),
               (tempWP %&gt;% apply(1, mean) %&gt;% quantile(0.95)))

## analyze the marginal imbalance
tempM &lt;- DH[(1 + prod(level_num) + 1) :
              (1 + prod(level_num) + sum(level_num)), ] %&gt;% abs
tempMP &lt;- DP[(1 + prod(level_num) + 1) :
               (1 + prod(level_num) + sum(level_num)), ] %&gt;% abs
Ana_M &lt;- matrix(NA, nrow = 2, ncol = 3)
rownames(Ana_M) &lt;- c("NEW", "PS")
colnames(Ana_M) &lt;- c("mean", "median", "95%quantile")
Ana_M[1, ] = c((tempM %&gt;% apply(1, mean) %&gt;% mean),
               (tempM %&gt;% apply(1, median) %&gt;% mean),
               (tempM %&gt;% apply(1, mean) %&gt;% quantile(0.95)))
Ana_M[2, ] = c((tempMP %&gt;% apply(1, mean) %&gt;% mean),
               (tempMP %&gt;% apply(1, median) %&gt;% mean),
               (tempMP %&gt;% apply(1, mean) %&gt;% quantile(0.95)))

AnaHP &lt;- list(Ana_O, Ana_M, Ana_W)
names(AnaHP) &lt;- c("Overall", "Marginal", "Within-stratum")

AnaHP

</code></pre>

<hr>
<h2 id='PocSimMIN.sim'>
Pocock and Simon's Method in the Two-Arms Case with Covariate Data Generating Mechanism
</h2><span id='topic+PocSimMIN.sim'></span>

<h3>Description</h3>

<p>Allocates patients to one of two treatments using Pocock and Simon's method proposed by Pocock S J, Simon R (1975) &lt;doi:10.2307/2529712&gt;, by simulating covariate profiles under the assumption of independence between covariates and levels within each covariate.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PocSimMIN.sim(n = 1000, cov_num = 2, level_num = c(2, 2), 
              pr = rep(0.5, 4), weight = NULL, p = 0.85)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PocSimMIN.sim_+3A_n">n</code></td>
<td>
<p>the number of patients. The default is <code>1000</code>.</p>
</td></tr>
<tr><td><code id="PocSimMIN.sim_+3A_cov_num">cov_num</code></td>
<td>
<p>the number of covariates. The default is <code>2</code>.</p>
</td></tr>
<tr><td><code id="PocSimMIN.sim_+3A_level_num">level_num</code></td>
<td>
<p>a vector of level numbers for each covariate. Hence the length of <code>level_num</code> should be equal to the number of covariates. The default is <code>c(2, 2)</code>. </p>
</td></tr>
<tr><td><code id="PocSimMIN.sim_+3A_pr">pr</code></td>
<td>
<p>a vector of probabilities. Under the assumption of independence between covariates, <code>pr</code> is a vector containing probabilities for each level of each covariate. The length of <code>pr</code> should correspond to the number of all levels, and the sum of the probabilities for each margin should be <code>1</code>. The default is <code>rep(0.5, 4)</code>, which corresponds to <code>cov_num = 2</code>, and <code>level_num = c(2, 2)</code>.</p>
</td></tr>
<tr><td><code id="PocSimMIN.sim_+3A_weight">weight</code></td>
<td>
<p>a vector of weights for within-covariate-margin imbalances. It is required that at least one element is larger than 0. If <code>weight = NULL</code> (default), the within-covariate-margin imbalances are weighted with an equal proportion, <code>1/cov_num</code>, for each covariate-margin.</p>
</td></tr>
<tr><td><code id="PocSimMIN.sim_+3A_p">p</code></td>
<td>
<p>the biased coin probability. <code>p</code> should be larger than <code>1/2</code> and less than <code>1</code>. The default is <code>0.85</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+PocSimMIN">PocSimMIN</a></code>.
</p>


<h3>Value</h3>

<p>See <code><a href="#topic+PocSimMIN">PocSimMIN</a></code>. 
</p>


<h3>References</h3>

<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>
<p>Pocock S J, Simon R. <em>Sequential treatment assignment with balancing for prognostic factors in the controlled clinical trial</em>[J]. Biometrics, 1975: 103-115.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+PocSimMIN">PocSimMIN</a></code> for allocating patients with complete covariate data; See <code><a href="#topic+PocSimMIN.ui">PocSimMIN.ui</a></code> for the command-line user interface. 
</p>

<hr>
<h2 id='PocSimMIN.ui'>
Command-line User Interface Using Pocock and Simon's Procedure with Two-Arms Case
</h2><span id='topic+PocSimMIN.ui'></span>

<h3>Description</h3>

<p>A call to the user-iterface function used to allocate patients to one of two treatments using Pocock and Simon's method proposed by Pocock S J, Simon R (1975) &lt;doi:10.2307/2529712&gt;. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PocSimMIN.ui(path, folder = "PocSimMIN")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PocSimMIN.ui_+3A_path">path</code></td>
<td>
<p>the path in which a folder used to storage variables will be created. </p>
</td></tr>
<tr><td><code id="PocSimMIN.ui_+3A_folder">folder</code></td>
<td>
<p>name of the folder. If default, a folder named <code>"PocSimMIN"</code> will be created.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+PocSimMIN">PocSimMIN</a></code>.
</p>


<h3>Value</h3>

<p>It returns an object of <code><a href="base.html#topic+class">class</a></code> <code>"carseq"</code>.
</p>
<p>The function <code><a href="base.html#topic+print">print</a></code> is used to obtain results. The generic accessor functions <code>assignment</code>, <code>covariate</code>, <code>cov_num</code>, <code>cov_profile</code> and others extract various useful features of the value returned by <code>PocSimMIN.ui</code>. 
</p>


<h3>Note</h3>

<p>This function provides a command-line interface and users should follow the prompts to enter data including covariates as well as levels for each covariate, <code>weight</code>, biased probability <code>p</code> and the covariate profile of the new patient. 
</p>


<h3>References</h3>

<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>
<p>Pocock S J, Simon R. <em>Sequential treatment assignment with balancing for prognostic factors in the controlled clinical trial</em>[J]. Biometrics, 1975: 103-115.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+PocSimMIN">PocSimMIN</a></code> for allocating a given completely collected data; See <code><a href="#topic+PocSimMIN.sim">PocSimMIN.sim</a></code> for allocating patients with covariate data generating mechanism.
</p>

<hr>
<h2 id='rand.test'>Randomization Test</h2><span id='topic+rand.test'></span>

<h3>Description</h3>

<p>Performs randomization test on treatment effects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  rand.test(data, Reps = 200, method = c("HuHuCAR", "PocSimMIN", "StrBCD", 
                                       "StrPBR", "DoptBCD", "AdjBCD"), 
          conf = 0.95, binwidth = 30, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rand.test_+3A_data">data</code></td>
<td>
<p>a data frame. It consists of patients' profiles, treatment assignments and outputs. See <code><a href="#topic+getData">getData</a></code>.</p>
</td></tr>
<tr><td><code id="rand.test_+3A_reps">Reps</code></td>
<td>
<p>an integer. It is the number of randomized replications used in the randomization test. The default is <code>200</code>.</p>
</td></tr>
<tr><td><code id="rand.test_+3A_method">method</code></td>
<td>
<p>the randomization procedure to be used for testing. This package provides tests for <code>"HuHuCAR"</code>, <code>"PocSimMIN"</code>, <code>"StrBCD"</code>, <code>"StrPBR"</code>, <code>"AdjBCD"</code>, and <code>"DoptBCD"</code>.</p>
</td></tr>
<tr><td><code id="rand.test_+3A_conf">conf</code></td>
<td>
<p>confidence level of the interval. The default is <code>0.95</code>.</p>
</td></tr>
<tr><td><code id="rand.test_+3A_binwidth">binwidth</code></td>
<td>
<p>the number of bins for each bar in histogram. The default is 30.</p>
</td></tr>
<tr><td><code id="rand.test_+3A_...">...</code></td>
<td>
<p>arguments to be passed to <code>method</code>. These arguments depend on the randomization method used and the following arguments are accepted:
</p>

<dl>
<dt>omega</dt><dd><p>a vector of weights at the overall, within-stratum, and within-covariate-margin levels. It is required that at least one element is larger than 0. Note that <code>omega</code> is only needed when <code>HuHuCAR</code> is to be used.</p>
</dd>
<dt>weight</dt><dd><p>a vector of weights for within-covariate-margin imbalances. It is required that at least one element is larger than 0. Note that <code>weight</code> is only needed when <code>PocSimMIN</code> is to be used.</p>
</dd>
<dt>p</dt><dd><p>the biased coin probability. <code>p</code> should be larger than <code>1/2</code> and less than <code>1</code>. Note that <code>p</code> is only needed when <code>"HuHuCAR", "PocSimMIN"</code> and <code>"StrBCD"</code> are to be used.</p>
</dd>
<dt>a</dt><dd><p>a design parameter governing the degree of randomness. Note that <code>a</code> is only needed when <code>"AdjBCD"</code> is to be used.</p>
</dd>
<dt>bsize</dt><dd><p>the block size for stratified randomization. It is required to be a multiple of 2. Note that <code>bsize</code> is only needed when <code>"StrPBR"</code> is to be used.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Details</h3>

<p>The randomization test is described as follows:
1) For the observed responses <code class="reqn">Y_1,\dots,Y_n</code> and the treatment assignments <code class="reqn">T_1,T_2,\dots,T_n</code>, compute the observed test statistic
</p>
<p style="text-align: center;"><code class="reqn">S_{obs} = \frac{-\sum_{i=1}^nY_i*(T_i-2)}{n_1}-\frac{\sum_{i=1}^n Y_i*(T_i-1)}{n_0}</code>
</p>

<p>where <code class="reqn">n_1</code> is the number of patients assigned to treatment <code class="reqn">1</code> and <code class="reqn">n_0</code> is the number of patients assigned to treatment <code class="reqn">2</code>;
</p>
<p>2) Perform the covariate-adaptive randomization procedure to obtain the new treatment assignments and calculate the corresponding test statistic <code class="reqn">S_i</code>. And repeat this process <code class="reqn">L</code> times;
</p>
<p>3) Calculate the two-sided Monte Carlo p-value estimator
</p>
<p style="text-align: center;"><code class="reqn">p = \frac{\sum_{l=1}^L I(|S_l|\ge |S_{obs}|)}{L}</code>
</p>



<h3>Value</h3>

<p>It returns an object of class <code>"htest"</code>.
</p>
<p>An object of class <code>"htest"</code> is a list containing the following components:
</p>
<table>
<tr><td><code>p.value</code></td>
<td>
<p>p-value of the test, the null hypothesis is rejected if the p-value is less than <code>sl</code>.</p>
</td></tr>
<tr><td><code>estimate</code></td>
<td>
<p>the estimated difference in treatment effects between treatment <code>1</code> and treatment <code>2</code>.</p>
</td></tr>
<tr><td><code>conf.int</code></td>
<td>
<p>a confidence interval under the chosen level <code>conf</code> for the difference in treatment effect between treatment <code>1</code> and treatment <code>2</code>.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>a character string indicating what type of test was performed.</p>
</td></tr>
<tr><td><code>data.name</code></td>
<td>
<p>a character string giving the name(s) of the data.</p>
</td></tr>
<tr><td><code>statistic</code></td>
<td>
<p>the value of the t-statistic. As the randomization test is a nonparametric method, we cannot calculate the t-statistic, so it is hidden in this result.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>
<p>Rosenberger W F, Lachin J M. Randomization in clinical trials: <em>theory and practice</em>[M]. John Wiley &amp; Sons, 2015.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##generate data
set.seed(100)
n = 1000
cov_num = 5
level_num = c(2,2,2,2,2)
pr = rep(0.5,10)
beta = c(0.1,0.4,0.3,0.2,0.5,0.5,0.4,0.3,0.2,0.1)
mu1 = 0
mu2 = 0.01
sigma = 1
type = "linear"
p = 0.85

dataS = getData(n, cov_num, level_num, pr, type,
               beta, mu1, mu2, sigma, "StrBCD", p)

#run the randomization test
library("ggplot2")
Strt = rand.test(data = dataS, Reps = 200,method = "StrBCD", 
                conf = 0.95, binwidth = 30,
                p = 0.85)
Strt
</code></pre>

<hr>
<h2 id='StrBCD'>Shao's Method in the Two-Arms Case</h2><span id='topic+StrBCD'></span>

<h3>Description</h3>

<p>Allocates patients to one of the two treatments using Shao's method proposed by Shao J, Yu X, Zhong B (2010) &lt;doi:10.1093/biomet/asq014&gt;. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>StrBCD(data, p = 0.85)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="StrBCD_+3A_data">data</code></td>
<td>
<p>a data frame. A row of the dataframe corresponds to the covariate profile of a patient.</p>
</td></tr>
<tr><td><code id="StrBCD_+3A_p">p</code></td>
<td>
<p>the biased coin probability. <code>p</code> should be larger than <code>1/2</code> and less than <code>1</code>. The default is <code>0.85</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Consider <code class="reqn">I</code> covariates and <code class="reqn">m_i</code> levels for the <code class="reqn">i</code>th covariate, <code class="reqn">i=1,\ldots,I</code>. <code class="reqn">T_j</code> is the assignment of the <code class="reqn">j</code>th patient and <code class="reqn">Z_j = (k_1,\dots,k_I)</code> indicates the covariate profile of this patient, <code class="reqn">j=1,\ldots,n</code>. For convenience, <code class="reqn">(k_1,\dots,k_I)</code> and <code class="reqn">(i;k_i)</code> denote the stratum and margin, respectively. <code class="reqn">D_j(.)</code> is the difference between the numbers of patients assigned to treatment <code class="reqn">1</code> and treatment <code class="reqn">2</code> at the corresponding levels after <code class="reqn">j</code> patients have been assigned. The stratified biased coin design is as follows:
</p>
<p>(1) The first patient is assigned to treatment <code class="reqn">1</code> with probability <code class="reqn">1/2</code>;
</p>
<p>(2) Suppose <code class="reqn">j-1</code> patients have been assigned (<code class="reqn">1&lt;j\le n</code>) and the <code class="reqn">j</code>th patient falls within <code class="reqn">(k_1^*,\dots,k_I^*)</code>;
</p>
<p>(3) If the <code class="reqn">j</code>th patient were assigned to treatment <code class="reqn">1</code>, then the potential within-stratum difference between the two treatments would be
</p>
<p style="text-align: center;"><code class="reqn">D_j^{(1)}(k_1^*,\dots,k_I^*)=D_j(k_1^*,\dots,k_I^*)+1</code>
</p>

<p>for stratum <code class="reqn">(k_1^*,\ldots,k_I^*)</code>. Similarly, the potential difference would be obtained in the same way if the <code class="reqn">j</code>th patient were assigned to treatment <code class="reqn">2</code>;
</p>
<p>(4) An imbalance measure is defined by
</p>
<p style="text-align: center;"><code class="reqn">Imb_j^{(l)}=[D_j^{(l)}(k_1^*,\dots,k_I^*)]^2,l=1,2;</code>
</p>

<p>(5) Conditional on the assignments of the first (<code class="reqn">j-1</code>) patients as well as the covariates'profiles of the first <code class="reqn">j</code> patients, assign the <code class="reqn">j</code>th patient to treatment <code class="reqn">1</code> with probability
</p>
<p style="text-align: center;"><code class="reqn">P(T_j=1|Z_j,T_1,\dots,T_{j-1})=q</code>
</p>
<p> for <code class="reqn">Imb_j^{(1)}&gt;Imb_j^{(2)},</code>
</p>
<p style="text-align: center;"><code class="reqn">P(T_j=1|Z_j,T_1,\dots,T_{j-1})=p</code>
</p>
<p> for <code class="reqn">Imb_j^{(1)}&lt;Imb_j^{(2)}</code>, and
</p>
<p style="text-align: center;"><code class="reqn">P(T_j=1|Z_j,T_1,\dots,T_{j-1})=0.5</code>
</p>
<p> for <code class="reqn">Imb_j^{(1)}=Imb_j^{(2)}.</code>
</p>
<p>Details of the procedure can be found in Shao J, Yu X, Zhong B (2010).
</p>


<h3>Value</h3>

<p>It returns an object of <code><a href="base.html#topic+class">class</a></code> <code>"carandom"</code>. 
</p>
<p>An object of class <code>"carandom"</code> is a list containing the following components: 
</p>
<table>
<tr><td><code>datanumeric</code></td>
<td>
<p>a bool indicating whether the data is a numeric data frame.</p>
</td></tr>
<tr><td><code>covariates</code></td>
<td>
<p>a character string giving the name(s) of the included covariates.</p>
</td></tr>
<tr><td><code>strt_num</code></td>
<td>
<p>the number of strata.</p>
</td></tr>
<tr><td><code>cov_num</code></td>
<td>
<p>the number of covariates.</p>
</td></tr>
<tr><td><code>level_num</code></td>
<td>
<p>a vector of level numbers for each covariate.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p>the number of patients.</p>
</td></tr>
<tr><td><code>Cov_Assig</code></td>
<td>
<p>a <code>(cov_num + 1) * n</code> matrix containing covariate profiles for all patients and the corresponding assignments. The <code class="reqn">i</code>th column represents the <code class="reqn">i</code>th patient. The first <code>cov_num</code> rows include patients' covariate profiles, and the last row contains the assignments.</p>
</td></tr>
<tr><td><code>assignments</code></td>
<td>
<p>the randomization sequence.</p>
</td></tr>
<tr><td><code>All strata</code></td>
<td>
<p>a matrix containing all strata involved.</p>
</td></tr>
<tr><td><code>Diff</code></td>
<td>
<p>a matrix with only one column. There are final differences at the overall, within-stratum, and within-covariate-margin levels.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>a character string describing the randomization procedure to be used.</p>
</td></tr>
<tr><td><code>Data Type</code></td>
<td>
<p>a character string giving the data type, <code>Real</code> or <code>Simulated</code>. </p>
</td></tr>
<tr><td><code>framework</code></td>
<td>
<p>the framework of the used randomization procedure: stratified randomization, or model-based method.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>the data frame.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>
<p>Shao J, Yu X, Zhong B. <em>A theory for testing hypotheses under covariate-adaptive randomization</em>[J]. Biometrika, 2010, 97(2): 347-360. 
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+StrBCD.sim">StrBCD.sim</a></code> for allocating patients with covariate data generating mechanism. 
See <code><a href="#topic+StrBCD.ui">StrBCD.ui</a></code> for command-line user interface.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a simple use
## Real Data
## creat a dataframe
df &lt;- data.frame("gender" = sample(c("female", "male"), 1000, TRUE, c(1 / 3, 2 / 3)), 
                 "age" = sample(c("0-30", "30-50", "&gt;50"), 1000, TRUE), 
                 "jobs" = sample(c("stu.", "teac.", "others"), 1000, TRUE), 
                 stringsAsFactors = TRUE)
Res &lt;- StrBCD(data = df)
## view the output
Res

## view all patients' profile and assignments
Res$Cov_Assig

## Simulated Data
cov_num = 3
level_num = c(2, 3, 3)
pr = c(0.4, 0.6, 0.3, 0.4, 0.3, 0.4, 0.3, 0.3)
Res.sim &lt;- StrBCD.sim(n = 1000, cov_num, level_num, pr)
## view the output
Res.sim

## view the detials of difference
Res.sim$Diff


N &lt;- 5
n &lt;- 1000
cov_num &lt;- 3
level_num &lt;- c(2, 3, 5) 
# Set pr to follow two tips:
# (1) length of pr should be sum(level_num);
# (2)sum of probabilities for each margin should be 1
pr &lt;- c(0.4, 0.6, 0.3, 0.4, 0.3, rep(0.2, times = 5))
omega &lt;- c(0.2, 0.2, rep(0.6 / cov_num, times = cov_num))

## generate a container to contain Diff
DH &lt;- matrix(NA, ncol = N, nrow = 1 + prod(level_num) + sum(level_num))
DS &lt;- matrix(NA, ncol = N, nrow = 1 + prod(level_num) + sum(level_num))
for(i in 1 : N){
  result &lt;- HuHuCAR.sim(n, cov_num, level_num, pr, omega)
  resultS &lt;- StrBCD.sim(n, cov_num, level_num, pr)
  DH[ , i] &lt;- result$Diff; DS[ , i] &lt;- resultS$Diff
}

## do some analysis
require(dplyr)

## analyze the overall imbalance
Ana_O &lt;- matrix(NA, nrow = 2, ncol = 3)
rownames(Ana_O) &lt;- c("NEW", "Shao")
colnames(Ana_O) &lt;- c("mean", "median", "95%quantile")
temp &lt;- DH[1, ] %&gt;% abs
tempS &lt;- DS[1, ] %&gt;% abs
Ana_O[1, ] &lt;- c((temp %&gt;% mean), (temp %&gt;% median),
                (temp %&gt;% quantile(0.95)))
Ana_O[2, ] &lt;- c((tempS %&gt;% mean), (tempS %&gt;% median),
                (tempS %&gt;% quantile(0.95)))

## analyze the within-stratum imbalances
tempW &lt;- DH[2 : (1 + prod(level_num)), ] %&gt;% abs
tempWS &lt;- DS[2 : 1 + prod(level_num), ] %&gt;% abs
Ana_W &lt;- matrix(NA, nrow = 2, ncol = 3)
rownames(Ana_W) &lt;- c("NEW", "Shao")
colnames(Ana_W) &lt;- c("mean", "median", "95%quantile")
Ana_W[1, ] = c((tempW %&gt;% apply(1, mean) %&gt;% mean),
               (tempW %&gt;% apply(1, median) %&gt;% mean),
               (tempW %&gt;% apply(1, mean) %&gt;% quantile(0.95)))
Ana_W[2, ] = c((tempWS %&gt;% apply(1, mean) %&gt;% mean),
               (tempWS %&gt;% apply(1, median) %&gt;% mean),
               (tempWS %&gt;% apply(1, mean) %&gt;% quantile(0.95)))

## analyze the marginal imbalance
tempM &lt;- DH[(1 + prod(level_num) + 1) :
              (1 + prod(level_num) + sum(level_num)), ] %&gt;% abs
tempMS &lt;- DS[(1 + prod(level_num) + 1) :
               (1 + prod(level_num) + sum(level_num)), ] %&gt;% abs
Ana_M &lt;- matrix(NA, nrow = 2, ncol = 3)
rownames(Ana_M) &lt;- c("NEW", "Shao")
colnames(Ana_M) &lt;- c("mean", "median", "95%quantile")
Ana_M[1, ] = c((tempM %&gt;% apply(1, mean) %&gt;% mean),
               (tempM %&gt;% apply(1, median) %&gt;% mean),
               (tempM %&gt;% apply(1, mean) %&gt;% quantile(0.95)))
Ana_M[2, ] = c((tempMS %&gt;% apply(1, mean) %&gt;% mean),
               (tempMS %&gt;% apply(1, median) %&gt;% mean),
               (tempMS %&gt;% apply(1, mean) %&gt;% quantile(0.95)))

AnaHP &lt;- list(Ana_O, Ana_M, Ana_W)
names(AnaHP) &lt;- c("Overall", "Marginal", "Within-stratum")

AnaHP

</code></pre>

<hr>
<h2 id='StrBCD.sim'>
Shao's Method in the Two-Arms Case with Covariate Data Generating Mechanism
</h2><span id='topic+StrBCD.sim'></span>

<h3>Description</h3>

<p>Allocates patients to one of two treatments using Shao's method proposed by Shao J, Yu X, Zhong B (2010) &lt;doi:10.1093/biomet/asq014&gt;, by simulating covariate profiles under the assumption of independence between covariates and levels within each covariate.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>StrBCD.sim(n = 1000, cov_num = 2, level_num = c(2, 2), 
           pr = rep(0.5, 4), p = 0.85)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="StrBCD.sim_+3A_n">n</code></td>
<td>
<p>the number of patients. The default is <code>1000</code>.</p>
</td></tr>
<tr><td><code id="StrBCD.sim_+3A_cov_num">cov_num</code></td>
<td>
<p>the number of covariates. The default is <code>2</code>.</p>
</td></tr>
<tr><td><code id="StrBCD.sim_+3A_level_num">level_num</code></td>
<td>
<p>a vector of level numbers for each covariate. Hence the length of <code>level_num</code> should be equal to the number of covariates. The default is <code>c(2, 2)</code>. </p>
</td></tr>
<tr><td><code id="StrBCD.sim_+3A_pr">pr</code></td>
<td>
<p>a vector of probabilities. Under the assumption of independence between covariates, <code>pr</code> is a vector containing probabilities for each level of each covariate. The length of <code>pr</code> should correspond to the number of all levels, and the sum of the probabilities for each margin should be <code>1</code>. The default is <code>rep(0.5, 4)</code>, which corresponds to <code>cov_num = 2</code>, and <code>level_num = c(2, 2)</code>.</p>
</td></tr>
<tr><td><code id="StrBCD.sim_+3A_p">p</code></td>
<td>
<p>the biased coin probability. <code>p</code> should be larger than <code>1/2</code> and less than <code>1</code>. The default is <code>0.85</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+StrBCD">StrBCD</a></code>.
</p>


<h3>Value</h3>

<p>See <code><a href="#topic+StrBCD">StrBCD</a></code>.
</p>


<h3>References</h3>

<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>
<p>Shao J, Yu X, Zhong B. <em>A theory for testing hypotheses under covariate-adaptive randomization</em>[J]. Biometrika, 2010, 97(2): 347-360. 
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+StrBCD">StrBCD</a></code> for allocating patients with complete covariate data; See <code><a href="#topic+StrBCD.ui">StrBCD.ui</a></code> for the command-line user interface. 
</p>

<hr>
<h2 id='StrBCD.ui'>
Command-line User Interface Using Shao's Method 
</h2><span id='topic+StrBCD.ui'></span>

<h3>Description</h3>

<p>A call to the user-interface function used to allocate patients to one of two treatments using Shao's method proposed by Shao J, Yu X, Zhong B (2010) &lt;doi:10.1093/biomet/asq014&gt;. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>StrBCD.ui(path, folder = "StrBCD")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="StrBCD.ui_+3A_path">path</code></td>
<td>
<p>the path in which a folder used to storage variables will be created. </p>
</td></tr>
<tr><td><code id="StrBCD.ui_+3A_folder">folder</code></td>
<td>
<p>name of the folder. If default, a folder named <code>"StrBCD"</code> will be created.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+StrBCD">StrBCD</a></code>.
</p>


<h3>Value</h3>

<p>It returns an object of <code><a href="base.html#topic+class">class</a></code> <code>"carseq"</code>.
</p>
<p>The function <code><a href="base.html#topic+print">print</a></code> is used to obtain results. The generic accessor functions <code>assignment</code>, <code>covariate</code>, <code>cov_num</code>, <code>cov_profile</code> and others extract various useful features of the value returned by <code>StrBCD.ui</code>. 
</p>


<h3>Note</h3>

<p>This function provides a command-line interface and users should follow the prompts to enter data including covariates as well as levels for each covariate, biased probability <code>p</code> and the covariate profile of the new patient. 
</p>


<h3>References</h3>

<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>
<p>Shao J, Yu X, Zhong B. <em>A theory for testing hypotheses under covariate-adaptive randomization</em>[J]. Biometrika, 2010, 97(2): 347-360. 
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+StrBCD">StrBCD</a></code> for allocating patients with complete covariate data; See <code><a href="#topic+StrBCD.sim">StrBCD.sim</a></code> for allocating patients with covariate data generating mechanism.
</p>

<hr>
<h2 id='StrPBR'>Stratified Permuted Block Randomization</h2><span id='topic+StrPBR'></span>

<h3>Description</h3>

<p>Allocates patients to one of two treatments using stratified permuted block randomization proposed by Zelen M (1974) &lt;doi:10.1016/0021-9681(74)90015-0&gt;. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>StrPBR(data, bsize = 4)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="StrPBR_+3A_data">data</code></td>
<td>
<p>a data frame. A row of the dataframe corresponds to the covariate profile of a patient.</p>
</td></tr>
<tr><td><code id="StrPBR_+3A_bsize">bsize</code></td>
<td>
<p>the block size for stratified randomization. It is required to be a multiple of 2. The default is <code>4</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Different covariate profiles are defined to be strata, and then permuted block randomization is applied to each stratum. It works efficiently when the number of strata is small. However, when the number of strata increases, the stratified permuted block randomization fails to obtain balance between two treatments.
</p>
<p>Permuted block randomization, or blocking, is used to balance treatments within a block so that there are the same number of subjects in each treatment. A block contains the same number of each treatment and blocks of different sizes are combined to make up the randomization list. 
</p>
<p>Details of the procedure can be found in Zelen M (1974).
</p>


<h3>Value</h3>

<p>It returns an object of <code><a href="base.html#topic+class">class</a></code> <code>"carandom"</code>. 
</p>
<p>An object of class <code>"carandom"</code> is a list containing the following components: 
</p>
<table>
<tr><td><code>datanumeric</code></td>
<td>
<p>a bool indicating whether the data is a numeric data frame.</p>
</td></tr>
<tr><td><code>covariates</code></td>
<td>
<p>a character string giving the name(s) of the included covariates.</p>
</td></tr>
<tr><td><code>strt_num</code></td>
<td>
<p>the number of strata.</p>
</td></tr>
<tr><td><code>cov_num</code></td>
<td>
<p>the number of covariates.</p>
</td></tr>
<tr><td><code>level_num</code></td>
<td>
<p>a vector of level numbers for each covariate.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p>the number of patients.</p>
</td></tr>
<tr><td><code>Cov_Assig</code></td>
<td>
<p>a <code>(cov_num + 1) * n</code> matrix containing covariate profiles for all patients and the corresponding assignments. The <code class="reqn">i</code>th column represents the <code class="reqn">i</code>th patient. The first <code>cov_num</code> rows include patients' covariate profiles, and the last row contains the assignments.</p>
</td></tr>
<tr><td><code>assignments</code></td>
<td>
<p>the randomization sequence.</p>
</td></tr>
<tr><td><code>All strata</code></td>
<td>
<p>a matrix containing all strata involved.</p>
</td></tr>
<tr><td><code>Diff</code></td>
<td>
<p>a matrix with only one column. There are final differences at the overall, within-stratum, and within-covariate-margin levels.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>a character string describing the randomization procedure to be used.</p>
</td></tr>
<tr><td><code>Data Type</code></td>
<td>
<p>a character string giving the data type, <code>Real</code> or <code>Simulated</code>. </p>
</td></tr>
<tr><td><code>framework</code></td>
<td>
<p>the framework of the used randomization procedure: stratified randomization, or model-based method.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>the data frame.</p>
</td></tr>
<tr><td><code>bsize</code></td>
<td>
<p>the block size.</p>
</td></tr>
<tr><td><code>numbers of pats for each stratum</code></td>
<td>
<p>a vector giving the numbers of patients for each stratum.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>
<p>Zelen M. <em>The randomization and stratification of patients to clinical trials</em>[J]. Journal of chronic diseases, 1974, 27(7): 365-375.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+StrPBR.sim">StrPBR.sim</a></code> for allocating patients with covariate data generating mechanism. 
See <code><a href="#topic+StrPBR.ui">StrPBR.ui</a></code> for the command-line user interface.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a simple use
## Real Data
## creat a dataframe
df &lt;- data.frame("gender" = sample(c("female", "male"), 100, TRUE, c(1 / 3, 2 / 3)), 
                 "age" = sample(c("0-30", "30-50", "&gt;50"), 100, TRUE), 
                 "jobs" = sample(c("stu.", "teac.", "others"), 100, TRUE), 
                 stringsAsFactors = TRUE)
Res &lt;- StrPBR(data = df, bsize = 4)
## view the output
Res

## view all patients' profile and assignments
Res$Cov_Assig

## Simulated data
cov_num &lt;- 3
level_num &lt;- c(2, 3, 3)
pr &lt;- c(0.4, 0.6, 0.3, 0.4, 0.3, 0.4, 0.3, 0.3)
Res.sim &lt;- StrPBR.sim(n = 100, cov_num, level_num, pr)
## view the output
Res.sim

## view the detials of difference
Res.sim$Diff


N &lt;- 5
n &lt;- 1000
cov_num &lt;- 3
level_num &lt;- c(2, 3, 5) 
# Set pr to follow two tips:
#(1) length of pr should be sum(level_num);
#(2)sum of probabilities for each margin should be 1.
pr &lt;- c(0.4, 0.6, 0.3, 0.4, 0.3, rep(0.2, times = 5))
omega &lt;- c(0.2, 0.2, rep(0.6 / cov_num, times = cov_num))
# Set block size for stratified randomization
bsize &lt;- 4

## generate a container to contain Diff
DS &lt;- matrix(NA, ncol = N, nrow = 1 + prod(level_num) + sum(level_num))
for(i in 1 : N){
  rtS &lt;- StrPBR.sim(n, cov_num, level_num, pr, bsize)
  DS[ , i] &lt;- rtS$Diff
}

## do some analysis
require(dplyr)

## analyze the overall imbalance
Ana_O &lt;- matrix(NA, nrow = 1, ncol = 3)
rownames(Ana_O) &lt;- c("Str.R")
colnames(Ana_O) &lt;- c("mean", "median", "95%quantile")
tempS &lt;- DS[1, ] %&gt;% abs
Ana_O[1, ] &lt;- c((tempS %&gt;% mean), (tempS %&gt;% median),
                (tempS %&gt;% quantile(0.95)))
## analyze the within-stratum imbalances
tempWS &lt;- DS[2 : 1 + prod(level_num), ] %&gt;% abs
Ana_W &lt;- matrix(NA, nrow = 1, ncol = 3)
rownames(Ana_W) &lt;- c("Str.R")
colnames(Ana_W) &lt;- c("mean", "median", "95%quantile")
Ana_W[1, ] = c((tempWS %&gt;% apply(1, mean) %&gt;% mean),
               (tempWS %&gt;% apply(1, median) %&gt;% mean),
               (tempWS %&gt;% apply(1, mean) %&gt;% quantile(0.95)))

## analyze the marginal imbalance
tempMS &lt;- DS[(1 + prod(level_num) + 1) : (1 + prod(level_num) + sum(level_num)), ] %&gt;% abs
Ana_M &lt;- matrix(NA, nrow = 1, ncol = 3)
rownames(Ana_M) &lt;- c("Str.R");
colnames(Ana_M) &lt;- c("mean", "median", "95%quantile")
Ana_M[1, ] = c((tempMS %&gt;% apply(1, mean) %&gt;% mean),
               (tempMS %&gt;% apply(1, median) %&gt;% mean),
               (tempMS %&gt;% apply(1, mean) %&gt;% quantile(0.95)))

AnaHP &lt;- list(Ana_O, Ana_M, Ana_W)
names(AnaHP) &lt;- c("Overall", "Marginal", "Within-stratum")

AnaHP

</code></pre>

<hr>
<h2 id='StrPBR.sim'>
Stratified Permuted Block Randomization with Covariate Data Generating Mechanism
</h2><span id='topic+StrPBR.sim'></span>

<h3>Description</h3>

<p>Allocates patients to one of two treatments using stratified randomization proposed by Zelen M (1974) &lt;doi:10.1016/0021-9681(74)90015-0&gt;, by simulating covariates-profile on assumption of independence between covariates and levels within each covariate.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>StrPBR.sim(n = 1000, cov_num = 2, level_num = c(2, 2), 
           pr = rep(0.5, 4), bsize = 4)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="StrPBR.sim_+3A_n">n</code></td>
<td>
<p>the number of patients. The default is <code>1000</code>.</p>
</td></tr>
<tr><td><code id="StrPBR.sim_+3A_cov_num">cov_num</code></td>
<td>
<p>the number of covariates. The default is <code>2</code>.</p>
</td></tr>
<tr><td><code id="StrPBR.sim_+3A_level_num">level_num</code></td>
<td>
<p>a vector of level numbers for each covariate. Hence the length of <code>level_num</code> should be equal to the number of covariates. The default is <code>c(2, 2)</code>. </p>
</td></tr>
<tr><td><code id="StrPBR.sim_+3A_pr">pr</code></td>
<td>
<p>a vector of probabilities. Under the assumption of independence between covariates, <code>pr</code> is a vector containing probabilities for each level of each covariate. The length of <code>pr</code> should correspond to the number of all levels, and the sum of the probabilities for each margin should be <code>1</code>. The default is <code>rep(0.5, 4)</code>, which corresponds to <code>cov_num = 2</code>, and <code>level_num = c(2, 2)</code>.</p>
</td></tr>
<tr><td><code id="StrPBR.sim_+3A_bsize">bsize</code></td>
<td>
<p>the block size for the stratified randomization. It is required to be a multiple of 2. The default is <code>4</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+StrPBR">StrPBR</a></code>.
</p>


<h3>Value</h3>

<p>See <code><a href="#topic+StrPBR">StrPBR</a></code>.
</p>


<h3>References</h3>

<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>
<p>Zelen M. <em>The randomization and stratification of patients to clinical trials</em>[J]. Journal of chronic diseases, 1974, 27(7): 365-375.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+StrPBR">StrPBR</a></code> for allocating patients with complete covariate data; See <code><a href="#topic+StrPBR.ui">StrPBR.ui</a></code> for the command-line user interface. 
</p>

<hr>
<h2 id='StrPBR.ui'>
Command-line User Interface Using Stratified Permuted Block Randomization with Two-Arms Case
</h2><span id='topic+StrPBR.ui'></span>

<h3>Description</h3>

<p>A call to the user-iterface function used to allocate patients to one of two treatments using stratified permuted block randomization proposed by Zelen M (1974) &lt;doi: 10.1016/0021-9681(74)90015-0&gt;. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>StrPBR.ui(path, folder = "StrPBR")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="StrPBR.ui_+3A_path">path</code></td>
<td>
<p>the path in which a folder used to storage variables will be created. </p>
</td></tr>
<tr><td><code id="StrPBR.ui_+3A_folder">folder</code></td>
<td>
<p>name of the folder. If default, a folder named <code>"StrPBR"</code> will be created.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+StrPBR">StrPBR</a></code>.
</p>


<h3>Value</h3>

<p>It returns an object of <code><a href="base.html#topic+class">class</a></code> <code>"carseq"</code>.
</p>
<p>The function <code><a href="base.html#topic+print">print</a></code> is used to obtain results. The generic accessor functions <code>assignment</code>, <code>covariate</code>, <code>cov_num</code>, <code>cov_profile</code> and others extract various useful features of the value returned by <code>StrPBR.ui</code>. 
</p>


<h3>Note</h3>

<p>This function provides a command-line interface and users should follow the prompts to enter data including covariates as well as levels for each covariate, block size <code>bsize</code> and the covariate profile of the new patient.
</p>


<h3>References</h3>

<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>
<p>Zelen M. <em>The randomization and stratification of patients to clinical trials</em>[J]. Journal of chronic diseases, 1974, 27(7): 365-375.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+StrPBR">StrPBR</a></code> for allocating patients with complete covariate data; See <code><a href="#topic+StrPBR.sim">StrPBR.sim</a></code> for allocating patients with covariate data generating mechanism.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
