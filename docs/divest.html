<!DOCTYPE html><html><head><title>Help for package divest</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {divest}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#fromBidsJson'><p>Conversion to and from BIDS JSON</p></a></li>
<li><a href='#imageAttributes'><p>Extended image attributes</p></a></li>
<li><a href='#readDicom'><p>Read one or more DICOM directories</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>1.0.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-02-12</td>
</tr>
<tr>
<td>Title:</td>
<td>Get Images Out of DICOM Format Quickly</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jon Clayden &lt;code@clayden.org&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp, RNifti</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RNifti</td>
</tr>
<tr>
<td>Suggests:</td>
<td>jsonlite, tinytest, covr</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides tools to sort DICOM-format medical image files, and
    convert them to NIfTI-1 format.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/BSD-3-Clause">BSD_3_clause</a> + file LICENCE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/jonclayden/divest">https://github.com/jonclayden/divest</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/jonclayden/divest/issues">https://github.com/jonclayden/divest/issues</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-12 16:47:58 UTC; jon</td>
</tr>
<tr>
<td>Author:</td>
<td>Jon Clayden <a href="https://orcid.org/0000-0002-6608-0619"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre],
  Chris Rorden [aut],
  Martin J Fiedler [cph],
  Cong Xu [cph],
  Pascal Gloor [cph]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-02-12 17:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='fromBidsJson'>Conversion to and from BIDS JSON</h2><span id='topic+fromBidsJson'></span><span id='topic+toBidsJson'></span>

<h3>Description</h3>

<p>Functions to convert to and from BIDS JSON format for image metadata. They
are wrappers around functions from the <code>jsonlite</code> package, with the
additional ability to convert between <code>divest</code>'s tag naming convention
and the BIDS equivalent. The differences are mostly in capitalisation, and
the units used for magnetic resonance echo, repetition and inversion times.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fromBidsJson(source, rename = FALSE)

toBidsJson(source, path = NULL, rename = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fromBidsJson_+3A_source">source</code></td>
<td>
<p>A list containing metadata (see <code><a href="#topic+imageAttributes">imageAttributes</a></code>)
or, for <code>fromBidsJson</code>, a string containing literal JSON or the path
to a file containing it.</p>
</td></tr>
<tr><td><code id="fromBidsJson_+3A_rename">rename</code></td>
<td>
<p>Logical value. If <code>TRUE</code>, element names are also
converted to or from the BIDS convention; otherwise this is just a
conversion between an R list and a JSON string.</p>
</td></tr>
<tr><td><code id="fromBidsJson_+3A_path">path</code></td>
<td>
<p>For <code>toBidsJson</code>, the path to write the JSON output to. If
<code>NULL</code>, the default, the JSON text is returned in an object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>fromBidsJson</code> returns a list of image attributes.
<code>toBidsJson</code> returns a character vector if <code>path</code> is
<code>NULL</code>, otherwise nothing.
</p>


<h3>Author(s)</h3>

<p>Jon Clayden &lt;code@clayden.org&gt;
</p>


<h3>References</h3>

<p>More information about metadata captured by the BIDS format can
be found at <a href="https://bids.neuroimaging.io">https://bids.neuroimaging.io</a> or in the paper cited
below.
</p>
<p>K.J. Gorgolewski, T. Auer, V.D. Calhoun, et al. The brain imaging data
structure, a format for organizing and describing outputs of neuroimaging
experiments (2016). Scientific Data 3:160044. <a href="https://doi.org/10.1038/sdata.2016.44">doi:10.1038/sdata.2016.44</a>.
</p>

<hr>
<h2 id='imageAttributes'>Extended image attributes</h2><span id='topic+imageAttributes'></span><span id='topic+imageAttributes+3C-'></span>

<h3>Description</h3>

<p>These functions extract and replace medical image attributes that go beyond
the core metadata associated with the NIfTI-1 file format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>imageAttributes(x)

imageAttributes(x) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="imageAttributes_+3A_x">x</code></td>
<td>
<p>An R object, generally an image object like those returned by
<code><a href="#topic+readDicom">readDicom</a></code>.</p>
</td></tr>
<tr><td><code id="imageAttributes_+3A_value">value</code></td>
<td>
<p>A list of new image attributes to replace any existing ones.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The DICOM format can encapsulate copious amounts of metadata about the scan
and the patient, which can be useful for more advanced or research-focussed
post-processing methods. Some of this information is extracted during the
DICOM-to-NIfTI conversion process and stored in additional named attributes;
the <code>imageAttributes</code> function returns a list of just these extended
attributes. The replacement form allows this metadata to be modified or
removed. These functions currently only act on objects inheriting from the
<code>niftiImage</code> class.
</p>


<h3>Value</h3>

<p>A list of image attributes, or a modified object with these changed.
These are essentially all attributes except those used for basic
<code>niftiImage</code> objects by the <code>RNifti</code> package.
</p>


<h3>Note</h3>

<p>Attributes may include sensitive or identifiable information such as
a patient's name, sex, date of birth, etc., if this was included in the
original DICOM files. These functions make no attempt to identify or
anonymise this metadata, and so this must be handled by the user if
necessary.
</p>


<h3>Author(s)</h3>

<p>Jon Clayden &lt;code@clayden.org&gt;
</p>


<h3>References</h3>

<p>More information about metadata captured by the BIDS format can
be found at <a href="https://bids.neuroimaging.io">https://bids.neuroimaging.io</a> or in the paper cited
below.
</p>
<p>K.J. Gorgolewski, T. Auer, V.D. Calhoun, et al. The brain imaging data
structure, a format for organizing and describing outputs of neuroimaging
experiments (2016). Scientific Data 3:160044. <a href="https://doi.org/10.1038/sdata.2016.44">doi:10.1038/sdata.2016.44</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>path &lt;- system.file("extdata", "raw", package="divest")
images &lt;- readDicom(path, interactive=FALSE)
imageAttributes(images[[1]])
</code></pre>

<hr>
<h2 id='readDicom'>Read one or more DICOM directories</h2><span id='topic+readDicom'></span><span id='topic+convertDicom'></span><span id='topic+sortDicom'></span><span id='topic+scanDicom'></span>

<h3>Description</h3>

<p>These functions are R wrappers around the DICOM-to-NIfTI conversion routines
provided by <code>dcm2niix</code>. They scan directories containing DICOM files,
potentially pertaining to more than one image series, read them and/or merge
them into a list of <code>niftiImage</code> objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>readDicom(path = ".", subset = NULL, flipY = TRUE, crop = FALSE,
  forceStack = FALSE, verbosity = 0L, labelFormat = "T%t_N%n_S%s",
  depth = 5L, interactive = base::interactive(), output = NULL)

convertDicom(path = ".", subset = NULL, flipY = TRUE, crop = FALSE,
  forceStack = FALSE, verbosity = 0L, labelFormat = "T%t_N%n_S%s",
  depth = 5L, interactive = base::interactive(), output = path)

sortDicom(path = ".", forceStack = FALSE, verbosity = 0L,
  labelFormat = "T%t_N%n_S%s/%b", depth = 5L, nested = NA,
  keepUnsorted = FALSE, output = path)

scanDicom(path = ".", forceStack = FALSE, verbosity = 0L,
  labelFormat = "T%t_N%n_S%s", depth = 5L)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="readDicom_+3A_path">path</code></td>
<td>
<p>A character vector of paths to scan for DICOM files. Each will
examined in turn. The default is the current working directory.
<code>readDicom</code> (only) will accept paths to individual DICOM files,
rather than directories. Alternatively, for <code>readDicom</code> and
<code>sortDicom</code>, a data frame like the one returned by <code>scanDicom</code>,
from which file paths will be read.</p>
</td></tr>
<tr><td><code id="readDicom_+3A_subset">subset</code></td>
<td>
<p>If <code>path</code> is a data frame, an expression which will be
evaluated in the context of the data frame to determine which series to
convert. Should evaluate to a logical vector. If <code>path</code> is a
character vector, <code>scanDicom</code> is called on the path(s) first to
produce the data frame. If this is specified, and does not evaluate to
<code>NULL</code>, the read will be noninteractive, irrespective of the value of
the <code>interactive</code> argument.</p>
</td></tr>
<tr><td><code id="readDicom_+3A_flipy">flipY</code></td>
<td>
<p>If <code>TRUE</code>, the default, then images will be flipped in the
Y-axis. This is usually desirable, given the difference between
orientation conventions in the DICOM and NIfTI-1 formats.</p>
</td></tr>
<tr><td><code id="readDicom_+3A_crop">crop</code></td>
<td>
<p>If <code>TRUE</code>, then <code>dcm2niix</code> will attempt to crop excess
neck slices from brain images.</p>
</td></tr>
<tr><td><code id="readDicom_+3A_forcestack">forceStack</code></td>
<td>
<p>If <code>TRUE</code>, images with the same series number will
always be stacked together as long as their dimensions are compatible. If
<code>FALSE</code>, the default, images will be separated if they differ in
echo, coil or exposure number, echo time, protocol name or orientation.</p>
</td></tr>
<tr><td><code id="readDicom_+3A_verbosity">verbosity</code></td>
<td>
<p>Integer value between -2 and 3, controlling the amount of
output generated during the conversion. A value of -1 will suppress all
output from <code>dcm2niix</code> except warnings and errors; -2 also suppresses
warnings.</p>
</td></tr>
<tr><td><code id="readDicom_+3A_labelformat">labelFormat</code></td>
<td>
<p>A <code><a href="base.html#topic+sprintf">sprintf</a></code>-style string specifying the
format to use for the final image labels or paths. See Details.</p>
</td></tr>
<tr><td><code id="readDicom_+3A_depth">depth</code></td>
<td>
<p>The maximum subdirectory depth in which to search for DICOM
files, relative to each <code>path</code>.</p>
</td></tr>
<tr><td><code id="readDicom_+3A_interactive">interactive</code></td>
<td>
<p>If <code>TRUE</code>, the default in interactive sessions, the
requested paths will first be scanned and a list of DICOM series will be
presented. You may then choose which series to convert.</p>
</td></tr>
<tr><td><code id="readDicom_+3A_output">output</code></td>
<td>
<p>The directory to write converted or copied NIfTI files to, or
<code>NULL</code>. In the latter case, which isn't valid for <code>sortDicom</code>,
images are converted in memory and returned as R objects.</p>
</td></tr>
<tr><td><code id="readDicom_+3A_nested">nested</code></td>
<td>
<p>For <code>sortDicom</code>, should the sorted files be created
within the source directory (<code>TRUE</code>), or in the current working
directory (<code>FALSE</code>)? Now soft-deprecated in favour of <code>output</code>,
which is more flexible.</p>
</td></tr>
<tr><td><code id="readDicom_+3A_keepunsorted">keepUnsorted</code></td>
<td>
<p>For <code>sortDicom</code>, should the unsorted files be left
in place, or removed after they are copied into their new locations? The
default, <code>FALSE</code>, corresponds to a move rather than a copy. If
creating new files fails then the old ones will not be deleted.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>scanDicom</code> function parses directories full of DICOM files and
returns information about the acquisition series they contain.
<code>readDicom</code> reads these files and converts them to (internal) NIfTI
images (whose pixel data can be extracted using <code>as.array</code>).
<code>convertDicom</code> performs the same conversion but writes to NIfTI files
by default, instead of retaining the images in memory. <code>sortDicom</code>
renames the files, but does not convert them.
</p>
<p>The <code>labelFormat</code> argument describes the string format used for image
labels and sorted files. Valid codes, each escaped with a percentage sign,
include <code>a</code> for coil number, <code>b</code> for the source file base name,
<code>c</code> for image comments, <code>d</code> for series description, <code>e</code> for
echo number, <code>f</code> for the source directory, <code>i</code> for patient ID,
<code>j</code> for the series instance UID, <code>k</code> for the study instance UID,
<code>l</code> for the procedure step description, <code>m</code> for manufacturer,
<code>n</code> for patient name, <code>p</code> for protocol name, <code>q</code> for
scanning sequence, <code>r</code> for instance number, <code>s</code> for series number,
<code>t</code> for the date and time, <code>u</code> for acquisition number, <code>v</code>
for vendor, <code>x</code> for study ID and <code>z</code> for sequence name. For
<code>sortDicom</code> the label forms the new file path, and may include one or
more slashes to create subdirectories. A &quot;.dcm&quot; suffix will be added to file
names if no extension is specified.
</p>


<h3>Value</h3>

<p><code>readDicom</code> and <code>convertDicom</code> return a list of
<code>niftiImage</code> objects if <code>output</code> is <code>NULL</code>; otherwise a
vector of paths to NIfTI-1 files created in the target directory. The
<code>scanDicom</code> function returns a data frame containing information
about each DICOM series found. <code>sortDicom</code> is mostly called for its
side-effect, but also (invisibly) returns a list detailing source and
target paths.
</p>


<h3>Author(s)</h3>

<p>Jon Clayden &lt;code@clayden.org&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>path &lt;- system.file("extdata", "raw", package="divest")
scanDicom(path)
readDicom(path, interactive=FALSE)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
