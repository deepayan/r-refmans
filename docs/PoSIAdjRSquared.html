<!DOCTYPE html><html lang="en"><head><title>Help for package PoSIAdjRSquared</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {PoSIAdjRSquared}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#compute_ci_with_specified_interval'><p>Compute post-selection confidence interval with specified interval</p></a></li>
<li><a href='#construct_adj_r_squared'><p>Construct adjusted R squared</p></a></li>
<li><a href='#construct_selection_event'>
<p>Construct selection event</p></a></li>
<li><a href='#construct_test_statistic'><p>Construct test statistic</p></a></li>
<li><a href='#datagen.norm'><p>Data generation normal</p></a></li>
<li><a href='#datagen.norm.intercept'><p>Data generation normal with intercept</p></a></li>
<li><a href='#equal_tailed_interval'><p>Equal tailed interval</p></a></li>
<li><a href='#f'><p>f</p></a></li>
<li><a href='#find_root'><p>Find root</p></a></li>
<li><a href='#fit_all_subset_linear_models'><p>Fit all subset linear models</p></a></li>
<li><a href='#fit_specified_size_subset_linear_models'><p>Fit all linear models of a specified size</p></a></li>
<li><a href='#pivot_with_specified_interval'><p>Pivot with specified interval</p></a></li>
<li><a href='#postselp_value_specified_interval'><p>Post-selection p-value specified interval</p></a></li>
<li><a href='#solve_selection_event'><p>Solve selection event</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Post-Selection Inference for Adjusted R Squared</td>
</tr>
<tr>
<td>Version:</td>
<td>0.0.0.1</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Sarah Pirenne &lt;sarah.pirenne@kuleuven.be&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Conduct post-selection inference for regression coefficients in linear models after they have been selected by adjusted R squared. The p-values and confidence intervals are valid after model selection with the same data. This allows the user to use all data for both model selection and inference without losing control over the type I error rate. The provided tests are more powerful than data splitting, which bases inference on less data since it discards all information used for selection.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Imports:</td>
<td>lmf, stats, utils, VGAM</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-08-20 12:19:14 UTC; u0146964</td>
</tr>
<tr>
<td>Author:</td>
<td>Sarah Pirenne <a href="https://orcid.org/0000-0003-1787-2035"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Gerda Claeskens [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-08-26 13:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='compute_ci_with_specified_interval'>Compute post-selection confidence interval with specified interval</h2><span id='topic+compute_ci_with_specified_interval'></span>

<h3>Description</h3>

<p>This function inverts a post-selection p-value to a confidence interval.
</p>


<h3>Usage</h3>

<pre><code class='language-R'> compute_ci_with_specified_interval(z_interval,etaj,etajTy,Sigma,tn_mu,alpha)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compute_ci_with_specified_interval_+3A_z_interval">z_interval</code></td>
<td>

<p>The intervals of type &quot;list&quot; where the OLS estimator gets selected: can be obtained from function &quot;solve_selection_event&quot;
</p>
</td></tr>
<tr><td><code id="compute_ci_with_specified_interval_+3A_etaj">etaj</code></td>
<td>

<p>Vector of type &quot;matrix&quot; and dimension nx1: useful in orthogonal decomposition of y (see Lemma 1 for details)
</p>
</td></tr>
<tr><td><code id="compute_ci_with_specified_interval_+3A_etajty">etajTy</code></td>
<td>

<p>The OLS estimator of the j'th selected coefficient in the selected model of type &quot;matrix&quot; and dimension 1x1
</p>
</td></tr>
<tr><td><code id="compute_ci_with_specified_interval_+3A_sigma">Sigma</code></td>
<td>

<p>The variance covariance matrix of dimension nxn of the error in the model
</p>
</td></tr>
<tr><td><code id="compute_ci_with_specified_interval_+3A_tn_mu">tn_mu</code></td>
<td>

<p>Integer for the mean of the truncated sampling distribution of the test statistic under the null hypothesis: for example, if you want to test beta_j=0, specify 0 for the mean
</p>
</td></tr>
<tr><td><code id="compute_ci_with_specified_interval_+3A_alpha">alpha</code></td>
<td>

<p>Integer for the desired significance level of the confidence interval
</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>ci</code></td>
<td>

<p>The two-sided (1-alpha)% confidence interval valid after model selection
</p>
</td></tr>
</table>


<h3>References</h3>

<p>Pirenne, S. and Claeskens, G. (2024). Exact Post-Selection Inference for Adjusted R Squared.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # Generate data
  n &lt;- 100
  Data &lt;- datagen.norm(seed = 7, n, p = 10, rho = 0, beta_vec = c(1,0.5,0,0.5,0,0,0,0,0,0))
  X &lt;- Data$X
  y &lt;- Data$y

  # Select model
  result &lt;- fit_all_subset_linear_models(y, X, intercept=FALSE)
  phat &lt;- result$phat
  X_M_phat &lt;- result$X_M_phat
  k &lt;- result$k
  R_M_phat &lt;- result$R_M_phat
  kappa_M_phat &lt;- result$kappa_M_phat
  R_M_k &lt;- result$R_M_k
  kappa_M_k &lt;- result$kappa_M_k

  # Estimate Sigma from residuals of full model
  full_model &lt;- lm(y ~ 0 + X)
  sigma_hat &lt;- sd(resid(full_model))
  Sigma &lt;- diag(n)*(sigma_hat)^2

  # Construct test statistic
  Construct_test &lt;- construct_test_statistic(j = 5, X_M_phat, y, phat, Sigma, intercept=FALSE)
  a &lt;- Construct_test$a
  b &lt;- Construct_test$b
  etaj &lt;- Construct_test$etaj
  etajTy &lt;- Construct_test$etajTy

  # Solve selection event
  Solve &lt;- solve_selection_event(a,b,R_M_k,kappa_M_k,R_M_phat,kappa_M_phat,k)
  z_interval &lt;- Solve$z_interval

  # Post-selection confidence interval
  compute_ci_with_specified_interval(z_interval, etaj, etajTy, Sigma, tn_mu = 0, alpha = 0.05)
</code></pre>

<hr>
<h2 id='construct_adj_r_squared'>Construct adjusted R squared</h2><span id='topic+construct_adj_r_squared'></span>

<h3>Description</h3>

<p>This function computes the adjusted R squared and returns some useful matrices from this computation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>construct_adj_r_squared(X, k, y, n, intercept = c(TRUE, FALSE), sst)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="construct_adj_r_squared_+3A_x">X</code></td>
<td>
<p>Design matrix of type &quot;matrix&quot;  and dimension nxp</p>
</td></tr>
<tr><td><code id="construct_adj_r_squared_+3A_k">k</code></td>
<td>
<p>Index set included in model k</p>
</td></tr>
<tr><td><code id="construct_adj_r_squared_+3A_y">y</code></td>
<td>
<p>Response vector of type &quot;matrix&quot;  and dimension nx1</p>
</td></tr>
<tr><td><code id="construct_adj_r_squared_+3A_n">n</code></td>
<td>
<p>An integer for the sample size</p>
</td></tr>
<tr><td><code id="construct_adj_r_squared_+3A_intercept">intercept</code></td>
<td>
<p>Logical value: TRUE if fitted models should contain intercept, FALSE if not</p>
</td></tr>
<tr><td><code id="construct_adj_r_squared_+3A_sst">sst</code></td>
<td>
<p>An integer for the total sum of squares</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>X_M_k</code></td>
<td>
<p>The design matrix of model k</p>
</td></tr>
<tr><td><code>P_M_k</code></td>
<td>
<p>The projection matrix of model k</p>
</td></tr>
<tr><td><code>R_M_k</code></td>
<td>
<p>The orthogonal projection matrix of model k</p>
</td></tr>
<tr><td><code>kappa_M_k</code></td>
<td>
<p>Adjustment factor for model complexity kappa of model k</p>
</td></tr>
<tr><td><code>adj_r_squared</code></td>
<td>
<p>The adjusted R squared value of model k</p>
</td></tr>
</table>


<h3>References</h3>

<p>Pirenne, S. and Claeskens, G. (2024). Exact Post-Selection Inference for Adjusted R Squared.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Generate data
n &lt;- 100
k &lt;- 1:10
Data &lt;- datagen.norm(seed = 7, n, p = 10, rho = 0, beta_vec = c(1,0.5,0,0.5,0,0,0,0,0,0))
X &lt;- Data$X
y &lt;- Data$y
sst &lt;- sum((y-mean(y))^2)

construct_adj_r_squared(X, k, y, n, intercept=FALSE, sst)
</code></pre>

<hr>
<h2 id='construct_selection_event'>
Construct selection event
</h2><span id='topic+construct_selection_event'></span>

<h3>Description</h3>

<p>This function contructs the selection event by computing c_k, d_k and e_k which are the constants in the quadratic inequalities which characterize the model selection event. The function is used internally by the function solve_selection_event, which returns the intervals of the OLS estimator where the selection event takes place. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>construct_selection_event(a,b,R_M_k,kappa_M_k,R_M_phat,kappa_M_phat)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="construct_selection_event_+3A_a">a</code></td>
<td>

<p>Residual vector of type &quot;matrix&quot; and dimension nx1 (see Lemma 1 for details)
</p>
</td></tr>
<tr><td><code id="construct_selection_event_+3A_b">b</code></td>
<td>

<p>Vector of type &quot;matrix&quot; and dimension nx1: useful in orthogonal decomposition of y (see Lemma 1 for details)
</p>
</td></tr>
<tr><td><code id="construct_selection_event_+3A_r_m_k">R_M_k</code></td>
<td>

<p>The orthogonal projection matrix of model k
</p>
</td></tr>
<tr><td><code id="construct_selection_event_+3A_kappa_m_k">kappa_M_k</code></td>
<td>

<p>Adjustment factor for model complexity kappa of model k
</p>
</td></tr>
<tr><td><code id="construct_selection_event_+3A_r_m_phat">R_M_phat</code></td>
<td>

<p>The orthogonal projection matrix of the selected model
</p>
</td></tr>
<tr><td><code id="construct_selection_event_+3A_kappa_m_phat">kappa_M_phat</code></td>
<td>

<p>Adjustment factor for model complexity kappa of the selected model
</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>c_k</code></td>
<td>

<p>Constant c_k in the quadratic inequality c_k*Z^2+d_k*Z+e_k&gt;=0 which characterizes the model selection event of the selected model compared to model k (see Lemma 1 for details)
</p>
</td></tr>
<tr><td><code>d_k</code></td>
<td>

<p>Constant d_k in the quadratic inequality c_k*Z^2+d_k*Z+e_k&gt;=0 which characterizes the model selection event of the selected model compared to model k (see Lemma 1 for details)
</p>
</td></tr>
<tr><td><code>e_k</code></td>
<td>

<p>Constant e_k in the quadratic inequality c_k*Z^2+d_k*Z+e_k&gt;=0 which characterizes the model selection event of the selected model compared to model k (see Lemma 1 for details)
</p>
</td></tr>
</table>


<h3>References</h3>

<p>Pirenne, S. and Claeskens, G. (2024). Exact Post-Selection Inference for Adjusted R Squared.
</p>

<hr>
<h2 id='construct_test_statistic'>Construct test statistic</h2><span id='topic+construct_test_statistic'></span>

<h3>Description</h3>

<p>This function constructs the OLS estimator of the j'th selected coefficient in the selected model. The functions also returns some useful vectors for post-selection inference (a and b).
</p>


<h3>Usage</h3>

<pre><code class='language-R'> construct_test_statistic(j, X_M_phat, y, phat, Sigma, intercept)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="construct_test_statistic_+3A_j">j</code></td>
<td>

<p>The index of type &quot;integer&quot; of the regression coefficient
</p>
</td></tr>
<tr><td><code id="construct_test_statistic_+3A_x_m_phat">X_M_phat</code></td>
<td>

<p>The design matrix in the selected model
</p>
</td></tr>
<tr><td><code id="construct_test_statistic_+3A_y">y</code></td>
<td>

<p>Response vector of type &quot;matrix&quot;  and dimension nx1
</p>
</td></tr>
<tr><td><code id="construct_test_statistic_+3A_phat">phat</code></td>
<td>

<p>Index set included in the selected model
</p>
</td></tr>
<tr><td><code id="construct_test_statistic_+3A_sigma">Sigma</code></td>
<td>

<p>The variance covariance matrix of dimension nxn of the error in the model
</p>
</td></tr>
<tr><td><code id="construct_test_statistic_+3A_intercept">intercept</code></td>
<td>

<p>Logical value: TRUE if the selected model contains an intercept, FALSE if not
</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>etaj</code></td>
<td>

<p>Vector of type &quot;matrix&quot; and dimension nx1: useful in orthogonal decomposition of y (see Lemma 1 for details)
</p>
</td></tr>
<tr><td><code>etajTy</code></td>
<td>

<p>The OLS estimator of the j'th selected coefficient in the selected model of type &quot;matrix&quot; and dimension 1x1
</p>
</td></tr>
<tr><td><code>a</code></td>
<td>

<p>Residual vector of type &quot;matrix&quot; and dimension nx1 (see Lemma 1 for details)
</p>
</td></tr>
<tr><td><code>b</code></td>
<td>

<p>Vector of type &quot;matrix&quot; and dimension nx1: useful in orthogonal decomposition of y (see Lemma 1 for details)
</p>
</td></tr>
</table>


<h3>References</h3>

<p>Pirenne, S. and Claeskens, G. (2024). Exact Post-Selection Inference for Adjusted R Squared.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # Generate data
  n &lt;- 100
  Data &lt;- datagen.norm(seed = 7, n, p = 10, rho = 0, beta_vec = c(1,0.5,0,0.5,0,0,0,0,0,0))
  X &lt;- Data$X
  y &lt;- Data$y

  # Select model
  result &lt;- fit_all_subset_linear_models(y, X, intercept=FALSE)
  phat &lt;- result$phat
  X_M_phat &lt;- result$X_M_phat

  # Estimate Sigma from residuals of full model
  full_model &lt;- lm(y ~ 0 + X)
  sigma_hat &lt;- sd(resid(full_model))
  Sigma &lt;- diag(n)*(sigma_hat)^2

  # Construct test statistic
  construct_test_statistic(j = 5, X_M_phat, y, phat, Sigma, intercept=FALSE)
</code></pre>

<hr>
<h2 id='datagen.norm'>Data generation normal</h2><span id='topic+datagen.norm'></span>

<h3>Description</h3>

<p>Function to generate data according to the linear model of the form Y = X*beta + epsilon where the noise epsilon follows a standard normal distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  datagen.norm(seed, n, p, rho, beta_vec)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="datagen.norm_+3A_seed">seed</code></td>
<td>

<p>Integer for seed
</p>
</td></tr>
<tr><td><code id="datagen.norm_+3A_n">n</code></td>
<td>

<p>Integer for sample size
</p>
</td></tr>
<tr><td><code id="datagen.norm_+3A_p">p</code></td>
<td>

<p>Integer for number of variables in the design matrix
</p>
</td></tr>
<tr><td><code id="datagen.norm_+3A_rho">rho</code></td>
<td>

<p>Integer for correlation between variables in the design matrix
</p>
</td></tr>
<tr><td><code id="datagen.norm_+3A_beta_vec">beta_vec</code></td>
<td>

<p>True regression coefficient vector of length p
</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>X</code></td>
<td>

<p>Design matrix of type &quot;matrix&quot;  and dimension nxp
</p>
</td></tr>
<tr><td><code>y</code></td>
<td>

<p>Response vector of type &quot;matrix&quot;  and dimension nx1
</p>
</td></tr>
<tr><td><code>true_y</code></td>
<td>

<p>True response vector, i.e. without the noise, of type &quot;matrix&quot; and dimension nx1
</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>  datagen.norm(seed = 7, n = 100, p = 10, rho = 0, beta_vec = c(1,0.5,0,0.5,0,0,0,0,0,0))
</code></pre>

<hr>
<h2 id='datagen.norm.intercept'>Data generation normal with intercept</h2><span id='topic+datagen.norm.intercept'></span>

<h3>Description</h3>

<p>Function to generate data according to the linear model of the form Y = X*beta + epsilon where the noise epsilon follows a standard normal distribution and the first column of X consists of 1's such that an intercept is included in the model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  datagen.norm.intercept(seed, n, p, rho, beta_vec)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="datagen.norm.intercept_+3A_seed">seed</code></td>
<td>

<p>Integer for seed
</p>
</td></tr>
<tr><td><code id="datagen.norm.intercept_+3A_n">n</code></td>
<td>

<p>Integer for sample size
</p>
</td></tr>
<tr><td><code id="datagen.norm.intercept_+3A_p">p</code></td>
<td>

<p>Integer for number of variables in the design matrix
</p>
</td></tr>
<tr><td><code id="datagen.norm.intercept_+3A_rho">rho</code></td>
<td>

<p>Integer for correlation between variables in the design matrix
</p>
</td></tr>
<tr><td><code id="datagen.norm.intercept_+3A_beta_vec">beta_vec</code></td>
<td>

<p>True regression coefficient vector of length p
</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>X</code></td>
<td>

<p>Design matrix of type &quot;matrix&quot;  and dimension nxp
</p>
</td></tr>
<tr><td><code>y</code></td>
<td>

<p>Response vector of type &quot;matrix&quot;  and dimension nx1
</p>
</td></tr>
<tr><td><code>true_y</code></td>
<td>

<p>True response vector, i.e. without the noise, of type &quot;matrix&quot; and dimension nx1
</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>  datagen.norm.intercept(seed = 7, n = 100, p = 10, rho = 0, beta_vec = c(1,0.5,0,0.5,0,0,0,0,0,0))
</code></pre>

<hr>
<h2 id='equal_tailed_interval'>Equal tailed interval</h2><span id='topic+equal_tailed_interval'></span>

<h3>Description</h3>

<p>This function inverts a post-selection p-value to a confidence interval.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>equal_tailed_interval(z_interval, etajTy, alpha, tn_mu, tn_sigma)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="equal_tailed_interval_+3A_z_interval">z_interval</code></td>
<td>
<p>The intervals of type &quot;list&quot; where the OLS estimator gets selected: can be obtained from function &quot;solve_selection_event&quot;</p>
</td></tr>
<tr><td><code id="equal_tailed_interval_+3A_etajty">etajTy</code></td>
<td>
<p>The OLS estimator of the j'th selected coefficient in the selected model of type &quot;matrix&quot; and dimension 1x1</p>
</td></tr>
<tr><td><code id="equal_tailed_interval_+3A_alpha">alpha</code></td>
<td>
<p>Integer for the desired significance level of the confidence interval</p>
</td></tr>
<tr><td><code id="equal_tailed_interval_+3A_tn_mu">tn_mu</code></td>
<td>
<p>Integer for the mean of the truncated sampling distribution of the test statistic under the null hypothesis: for example, if you want to test beta_j=0, specify 0 for the mean</p>
</td></tr>
<tr><td><code id="equal_tailed_interval_+3A_tn_sigma">tn_sigma</code></td>
<td>
<p>Integer for the variance of the truncated sampling distribution of the test statistic</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>L</code></td>
<td>
<p>lower bound</p>
</td></tr>
<tr><td><code>U</code></td>
<td>
<p>upper bound</p>
</td></tr>
</table>


<h3>References</h3>

<p>Pirenne, S. and Claeskens, G. (2024). Exact Post-Selection Inference for Adjusted R Squared.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Generate data
n &lt;- 100
Data &lt;- datagen.norm(seed = 7, n, p = 10, rho = 0, beta_vec = c(1,0.5,0,0.5,0,0,0,0,0,0))
X &lt;- Data$X
y &lt;- Data$y

# Select model
result &lt;- fit_all_subset_linear_models(y, X, intercept=FALSE)
phat &lt;- result$phat
X_M_phat &lt;- result$X_M_phat
k &lt;- result$k
R_M_phat &lt;- result$R_M_phat
kappa_M_phat &lt;- result$kappa_M_phat
R_M_k &lt;- result$R_M_k
kappa_M_k &lt;- result$kappa_M_k

# Estimate Sigma from residuals of full model
full_model &lt;- lm(y ~ 0 + X)
sigma_hat &lt;- sd(resid(full_model))
Sigma &lt;- diag(n)*(sigma_hat)^2

# Construct test statistic
Construct_test &lt;- construct_test_statistic(j = 5, X_M_phat, y, phat, Sigma, intercept=FALSE)
a &lt;- Construct_test$a
b &lt;- Construct_test$b
etaj &lt;- Construct_test$etaj
etajTy &lt;- Construct_test$etajTy

# Solve selection event
Solve &lt;- solve_selection_event(a,b,R_M_k,kappa_M_k,R_M_phat,kappa_M_phat,k)
z_interval &lt;- Solve$z_interval

# Post-selection confidence interval
tn_sigma &lt;- sqrt((t(etaj)%*%Sigma)%*%etaj)
equal_tailed_interval(z_interval, etajTy, alpha = 0.05, tn_mu = 0, tn_sigma)

</code></pre>

<hr>
<h2 id='f'>f</h2><span id='topic+f'></span>

<h3>Description</h3>

<p>Function used internally by compute_ci_with_specified_interval for calculating valid confidence intervals post-selection. 
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="f_+3A_z_interval">z_interval</code></td>
<td>

<p>The intervals of type &quot;list&quot; where the OLS estimator gets selected: can be obtained from function &quot;solve_selection_event&quot;
</p>
</td></tr>
<tr><td><code id="f_+3A_etajty">etajTy</code></td>
<td>

<p>The OLS estimator of the j'th selected coefficient in the selected model of type &quot;matrix&quot; and dimension 1x1
</p>
</td></tr>
<tr><td><code id="f_+3A_mu">mu</code></td>
<td>

<p>Integer for the mean of the truncated sampling distribution of the test statistic (updated iteratively in compute_ci_with_specified_interval)
</p>
</td></tr>
<tr><td><code id="f_+3A_tn_sigma">tn_sigma</code></td>
<td>

<p>Integer for the variance of the truncated sampling distribution of the test statistic
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The cumulative distribution function of a truncated gaussian distribution evaluated in the observed test statistic
</p>


<h3>References</h3>

<p>Pirenne, S. and Claeskens, G. (2024). Exact Post-Selection Inference for Adjusted R Squared.
</p>

<hr>
<h2 id='find_root'>Find root</h2><span id='topic+find_root'></span>

<h3>Description</h3>

<p>This function is used internally by the function compute_ci_with_specified_interval for inverting post-selection p-values to confidence intervals. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>find_root(z_interval, etajTy, tn_sigma, y, lb, ub, tol=1e-6)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="find_root_+3A_z_interval">z_interval</code></td>
<td>

<p>The intervals of type &quot;list&quot; where the OLS estimator gets selected: can be obtained from function &quot;solve_selection_event&quot;
</p>
</td></tr>
<tr><td><code id="find_root_+3A_etajty">etajTy</code></td>
<td>

<p>The OLS estimator of the j'th selected coefficient in the selected model of type &quot;matrix&quot; and dimension 1x1
</p>
</td></tr> 
<tr><td><code id="find_root_+3A_tn_sigma">tn_sigma</code></td>
<td>

<p>Integer for the variance of the truncated sampling distribution of the test statistic
</p>
</td></tr> 
<tr><td><code id="find_root_+3A_y">y</code></td>
<td>

<p>For example 1.0-0.5*alpha for finding the lower bound of a (1-alpha)% confidence interval, and 0.5*alpha for finding the upper bound of a (1-alpha)% confidence interval
</p>
</td></tr> 
<tr><td><code id="find_root_+3A_lb">lb</code></td>
<td>

<p>Lower bound in current iteration
</p>
</td></tr>
<tr><td><code id="find_root_+3A_ub">ub</code></td>
<td>

<p>Upper bound in current iteration
</p>
</td></tr>
<tr><td><code id="find_root_+3A_tol">tol</code></td>
<td>

<p>Tolerance parameter: default set to 1e-6
</p>
</td></tr>
</table>


<h3>Value</h3>

 
<p>Returns confidence interval bound
</p>


<h3>References</h3>

<p>Pirenne, S. and Claeskens, G. (2024). Exact Post-Selection Inference for Adjusted R Squared.
</p>

<hr>
<h2 id='fit_all_subset_linear_models'>Fit all subset linear models</h2><span id='topic+fit_all_subset_linear_models'></span>

<h3>Description</h3>

<p>This function fits all possible combinations of linear models and returns the selected model based on adjusted R^2.
</p>


<h3>Usage</h3>

<pre><code class='language-R'> fit_all_subset_linear_models(y, X, intercept)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fit_all_subset_linear_models_+3A_y">y</code></td>
<td>

<p>Response vector of type &quot;matrix&quot;  and dimension nx1
</p>
</td></tr>
<tr><td><code id="fit_all_subset_linear_models_+3A_x">X</code></td>
<td>

<p>Design matrix of type &quot;matrix&quot;  and dimension nxp
</p>
</td></tr>
<tr><td><code id="fit_all_subset_linear_models_+3A_intercept">intercept</code></td>
<td>

<p>Logical value: TRUE if fitted models should contain intercept, FALSE if not
</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>k</code></td>
<td>

<p>Index set included in model k
</p>
</td></tr>
<tr><td><code>best_model</code></td>
<td>

<p>The selected model fit (lm object)
</p>
</td></tr>
<tr><td><code>phat</code></td>
<td>

<p>Index set included in the selected model
</p>
</td></tr>
<tr><td><code>X_M_phat</code></td>
<td>

<p>The design matrix in the selected model
</p>
</td></tr>
<tr><td><code>best_adj_r_squared</code></td>
<td>

<p>The adjusted R^2 value of the selected model
</p>
</td></tr>
<tr><td><code>R_M_phat</code></td>
<td>

<p>The orthogonal projection matrix of the selected model
</p>
</td></tr>
<tr><td><code>kappa_M_phat</code></td>
<td>

<p>Adjustment factor for model complexity kappa of the selected model
</p>
</td></tr>
<tr><td><code>R_M_k</code></td>
<td>

<p>The orthogonal projection matrix of model k</p>
</td></tr>
<tr><td><code>kappa_M_k</code></td>
<td>

<p>Adjustment factor for model complexity kappa of model k
</p>
</td></tr>
</table>


<h3>References</h3>

<p>Pirenne, S. and Claeskens, G. (2024). Exact Post-Selection Inference for Adjusted R Squared.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # Generate data
  Data &lt;- datagen.norm(seed = 7, n = 100, p = 3, rho = 0, beta_vec = c(1,0.5,0))
  X &lt;- Data$X
  y &lt;- Data$y

  # Select model
  fit_all_subset_linear_models(y, X, intercept=FALSE)
</code></pre>

<hr>
<h2 id='fit_specified_size_subset_linear_models'>Fit all linear models of a specified size</h2><span id='topic+fit_specified_size_subset_linear_models'></span>

<h3>Description</h3>

<p>This function fits all possible combinations of a pre-specified size of linear models and returns the selected model based on adjusted R^2.
</p>


<h3>Usage</h3>

<pre><code class='language-R'> fit_specified_size_subset_linear_models(y, X, size, intercept)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fit_specified_size_subset_linear_models_+3A_y">y</code></td>
<td>

<p>Response vector of type &quot;matrix&quot;  and dimension nx1
</p>
</td></tr>
<tr><td><code id="fit_specified_size_subset_linear_models_+3A_x">X</code></td>
<td>

<p>Design matrix of type &quot;matrix&quot;  and dimension nxp
</p>
</td></tr>
<tr><td><code id="fit_specified_size_subset_linear_models_+3A_size">size</code></td>
<td>

<p>Size of type &quot;integer&quot; of the fitted models
</p>
</td></tr>
<tr><td><code id="fit_specified_size_subset_linear_models_+3A_intercept">intercept</code></td>
<td>

<p>Logical value: TRUE if fitted models should contain intercept, FALSE if not
</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>k</code></td>
<td>

<p>Index set included in model k
</p>
</td></tr>
<tr><td><code>best_model</code></td>
<td>

<p>The selected model fit (lm object)
</p>
</td></tr>
<tr><td><code>phat</code></td>
<td>

<p>Index set included in the selected model
</p>
</td></tr>
<tr><td><code>X_M_phat</code></td>
<td>

<p>The design matrix in the selected model
</p>
</td></tr>
<tr><td><code>best_adj_r_squared</code></td>
<td>

<p>The adjusted R^2 value of the selected model
</p>
</td></tr>
<tr><td><code>R_M_phat</code></td>
<td>

<p>The orthogonal projection matrix of the selected model
</p>
</td></tr>
<tr><td><code>kappa_M_phat</code></td>
<td>

<p>Adjustment factor for model complexity kappa of the selected model
</p>
</td></tr>
<tr><td><code>R_M_k</code></td>
<td>

<p>The orthogonal projection matrix of model k
</p>
</td></tr>
<tr><td><code>kappa_M_k</code></td>
<td>

<p>Adjustment factor for model complexity kappa of model k
</p>
</td></tr>
</table>


<h3>References</h3>

<p>Pirenne, S. and Claeskens, G. (2024). Exact Post-Selection Inference for Adjusted R Squared.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # Generate data
  Data &lt;- datagen.norm(seed = 7, n = 100, p = 10, rho = 0, beta_vec = c(1,0.5,0,0.5,0,0,0,0,0,0))
  X &lt;- Data$X
  y &lt;- Data$y

  # Select model
  fit_specified_size_subset_linear_models(y, X, size = 9, intercept=FALSE)
</code></pre>

<hr>
<h2 id='pivot_with_specified_interval'>Pivot with specified interval
</h2><span id='topic+pivot_with_specified_interval'></span>

<h3>Description</h3>

<p>This function returns the value of the cumulative distribution function of a truncated gaussian distribution evaluated in the observed test statistic. Its output is used by the function postselp_value_specified_interval by taking 2*min(output,1-output) for a p-value for a two-sided test. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pivot_with_specified_interval(z_interval, etaj, etajTy, tn_mu, tn_sigma)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pivot_with_specified_interval_+3A_z_interval">z_interval</code></td>
<td>

<p>The intervals of type &quot;list&quot; where the OLS estimator gets selected: can be obtained from function &quot;solve_selection_event&quot;
</p>
</td></tr>
<tr><td><code id="pivot_with_specified_interval_+3A_etaj">etaj</code></td>
<td>

<p>Vector of type &quot;matrix&quot; and dimension nx1: useful in orthogonal decomposition of y (see Lemma 1 for details)
</p>
</td></tr>
<tr><td><code id="pivot_with_specified_interval_+3A_etajty">etajTy</code></td>
<td>

<p>The OLS estimator of the j'th selected coefficient in the selected model of type &quot;matrix&quot; and dimension 1x1
</p>
</td></tr>
<tr><td><code id="pivot_with_specified_interval_+3A_tn_mu">tn_mu</code></td>
<td>

<p>Integer for the mean of the truncated sampling distribution of the test statistic under the null hypothesis: for example, if you want to test beta_j=0, specify 0 for the mean
</p>
</td></tr>
<tr><td><code id="pivot_with_specified_interval_+3A_tn_sigma">tn_sigma</code></td>
<td>

<p>Integer for the variance of the truncated sampling distribution of the test statistic
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The cumulative distribution function of a truncated gaussian distribution evaluated in the observed test statistic
</p>


<h3>References</h3>

<p>Pirenne, S. and Claeskens, G. (2024). Exact Post-Selection Inference for Adjusted R Squared.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # Generate data
  n &lt;- 100
  Data &lt;- datagen.norm(seed = 7, n, p = 10, rho = 0, beta_vec = c(1,0.5,0,0.5,0,0,0,0,0,0))
  X &lt;- Data$X
  y &lt;- Data$y

  # Select model
  result &lt;- fit_all_subset_linear_models(y, X, intercept=FALSE)
  phat &lt;- result$phat
  X_M_phat &lt;- result$X_M_phat
  k &lt;- result$k
  R_M_phat &lt;- result$R_M_phat
  kappa_M_phat &lt;- result$kappa_M_phat
  R_M_k &lt;- result$R_M_k
  kappa_M_k &lt;- result$kappa_M_k

  # Estimate Sigma from residuals of full model
  full_model &lt;- lm(y ~ 0 + X)
  sigma_hat &lt;- sd(resid(full_model))
  Sigma &lt;- diag(n)*(sigma_hat)^2

  # Construct test statistic
  Construct_test &lt;- construct_test_statistic(j = 5, X_M_phat, y, phat, Sigma, intercept=FALSE)
  a &lt;- Construct_test$a
  b &lt;- Construct_test$b
  etaj &lt;- Construct_test$etaj
  etajTy &lt;- Construct_test$etajTy

  # Solve selection event
  Solve &lt;- solve_selection_event(a,b,R_M_k,kappa_M_k,R_M_phat,kappa_M_phat,k)
  z_interval &lt;- Solve$z_interval

  # Post-selection inference for beta_j=0
  tn_sigma &lt;- sqrt((t(etaj)%*%Sigma)%*%etaj)
  pivot_with_specified_interval(z_interval, etaj, etajTy, tn_mu = 0, tn_sigma)
</code></pre>

<hr>
<h2 id='postselp_value_specified_interval'>Post-selection p-value specified interval</h2><span id='topic+postselp_value_specified_interval'></span>

<h3>Description</h3>

<p>This function returns a p-value for the test whether the regression coefficient equals tn_mu (e.g. 0) with a two-sided alternative. The p-value is valid given the model selection, because it conditions on the specified intervals of the OLS estimator where the regression coefficient actually gets selected. The intervals contained in the object &quot;z_interval&quot; can be obtained from the function &quot;solve_selection_event&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'> postselp_value_specified_interval(z_interval, etaj, etajTy, tn_mu, tn_sigma)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="postselp_value_specified_interval_+3A_z_interval">z_interval</code></td>
<td>

<p>The intervals of type &quot;list&quot; where the OLS estimator gets selected: can be obtained from function &quot;solve_selection_event&quot;
</p>
</td></tr>
<tr><td><code id="postselp_value_specified_interval_+3A_etaj">etaj</code></td>
<td>

<p>Vector of type &quot;matrix&quot; and dimension nx1: useful in orthogonal decomposition of y (see Lemma 1 for details)
</p>
</td></tr>
<tr><td><code id="postselp_value_specified_interval_+3A_etajty">etajTy</code></td>
<td>

<p>The OLS estimator of the j'th selected coefficient in the selected model of type &quot;matrix&quot; and dimension 1x1
</p>
</td></tr>
<tr><td><code id="postselp_value_specified_interval_+3A_tn_mu">tn_mu</code></td>
<td>

<p>Integer for the mean of the truncated sampling distribution of the test statistic under the null hypothesis: for example, if you want to test beta_j=0, specify 0 for the mean
</p>
</td></tr>
<tr><td><code id="postselp_value_specified_interval_+3A_tn_sigma">tn_sigma</code></td>
<td>

<p>Integer for the variance of the truncated sampling distribution of the test statistic
</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>p_value</code></td>
<td>

<p>The p-value for a two-sided test which is valid after model selection
</p>
</td></tr>
</table>


<h3>References</h3>

<p>Pirenne, S. and Claeskens, G. (2024). Exact Post-Selection Inference for Adjusted R Squared.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # Generate data
  n &lt;- 100
  Data &lt;- datagen.norm(seed = 7, n, p = 10, rho = 0, beta_vec = c(1,0.5,0,0.5,0,0,0,0,0,0))
  X &lt;- Data$X
  y &lt;- Data$y

  # Select model
  result &lt;- fit_all_subset_linear_models(y, X, intercept=FALSE)
  phat &lt;- result$phat
  X_M_phat &lt;- result$X_M_phat
  k &lt;- result$k
  R_M_phat &lt;- result$R_M_phat
  kappa_M_phat &lt;- result$kappa_M_phat
  R_M_k &lt;- result$R_M_k
  kappa_M_k &lt;- result$kappa_M_k

  # Estimate Sigma from residuals of full model
  full_model &lt;- lm(y ~ 0 + X)
  sigma_hat &lt;- sd(resid(full_model))
  Sigma &lt;- diag(n)*(sigma_hat)^2

  # Construct test statistic
  Construct_test &lt;- construct_test_statistic(j = 5, X_M_phat, y, phat, Sigma, intercept=FALSE)
  a &lt;- Construct_test$a
  b &lt;- Construct_test$b
  etaj &lt;- Construct_test$etaj
  etajTy &lt;- Construct_test$etajTy

  # Solve selection event
  Solve &lt;- solve_selection_event(a,b,R_M_k,kappa_M_k,R_M_phat,kappa_M_phat,k)
  z_interval &lt;- Solve$z_interval

  # Post-selection inference for beta_j=0
  tn_sigma &lt;- sqrt((t(etaj)%*%Sigma)%*%etaj)
  postselp_value_specified_interval(z_interval, etaj, etajTy, tn_mu = 0, tn_sigma)
</code></pre>

<hr>
<h2 id='solve_selection_event'>Solve selection event</h2><span id='topic+solve_selection_event'></span>

<h3>Description</h3>

<p>This function solves the selection event by calculating the intervals of the OLS estimator where the regression coefficient actually gets selected.
</p>


<h3>Usage</h3>

<pre><code class='language-R'> solve_selection_event(a,b,R_M_k,kappa_M_k,R_M_phat,kappa_M_phat,k)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solve_selection_event_+3A_a">a</code></td>
<td>

<p>Residual vector of type &quot;matrix&quot; and dimension nx1 (see Lemma 1 for details)
</p>
</td></tr>
<tr><td><code id="solve_selection_event_+3A_b">b</code></td>
<td>

<p>Vector of type &quot;matrix&quot; and dimension nx1: useful in orthogonal decomposition of y (see Lemma 1 for details)
</p>
</td></tr>
<tr><td><code id="solve_selection_event_+3A_r_m_k">R_M_k</code></td>
<td>

<p>The orthogonal projection matrix of model k
</p>
</td></tr>
<tr><td><code id="solve_selection_event_+3A_kappa_m_k">kappa_M_k</code></td>
<td>

<p>Adjustment factor for model complexity kappa of model k
</p>
</td></tr>
<tr><td><code id="solve_selection_event_+3A_r_m_phat">R_M_phat</code></td>
<td>

<p>The orthogonal projection matrix of the selected model
</p>
</td></tr>
<tr><td><code id="solve_selection_event_+3A_kappa_m_phat">kappa_M_phat</code></td>
<td>

<p>Adjustment factor for model complexity kappa of the selected model
</p>
</td></tr>
<tr><td><code id="solve_selection_event_+3A_k">k</code></td>
<td>

<p>Index set included in model k
</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>intervals_list</code></td>
<td>

<p>The intervals of the OLS estimator for which the inequality in Lemma 1 holds
</p>
</td></tr>
<tr><td><code>z_interval</code></td>
<td>

<p>The intersection of the intervals of the OLS estimator for which the inequality in Lemma 1 holds: post-selection inference is conditioned on those intervals
</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This function will give the error message: &quot;Error in if (D &gt;= 0.001): missing value where TRUE/FALSE needed&quot; if it is run for a coefficient which is not part of the selected model. Only run solve_selection_event for selected indices.
</p>


<h3>References</h3>

<p>Pirenne, S. and Claeskens, G. (2024). Exact Post-Selection Inference for Adjusted R Squared.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # Generate data
  n &lt;- 100
  Data &lt;- datagen.norm(seed = 7, n, p = 10, rho = 0, beta_vec = c(1,0.5,0,0.5,0,0,0,0,0,0))
  X &lt;- Data$X
  y &lt;- Data$y

  # Select model
  result &lt;- fit_all_subset_linear_models(y, X, intercept=FALSE)
  phat &lt;- result$phat
  X_M_phat &lt;- result$X_M_phat
  k &lt;- result$k
  R_M_phat &lt;- result$R_M_phat
  kappa_M_phat &lt;- result$kappa_M_phat
  R_M_k &lt;- result$R_M_k
  kappa_M_k &lt;- result$kappa_M_k

  # Estimate Sigma from residuals of full model
  full_model &lt;- lm(y ~ 0 + X)
  sigma_hat &lt;- sd(resid(full_model))
  Sigma &lt;- diag(n)*(sigma_hat)^2

  # Construct test statistic
  Construct_test &lt;- construct_test_statistic(j = 5, X_M_phat, y, phat, Sigma, intercept=FALSE)
  a &lt;- Construct_test$a
  b &lt;- Construct_test$b

  # Solve selection event
  solve_selection_event(a,b,R_M_k,kappa_M_k,R_M_phat,kappa_M_phat,k)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
