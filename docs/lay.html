<!DOCTYPE html><html><head><title>Help for package lay</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {lay}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#drugs'><p>Pain relievers misuse in the US</p></a></li>
<li><a href='#lay'><p>Apply a function within each row</p></a></li>
<li><a href='#reexports'><p>Objects exported from other packages</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Simple but Efficient Rowwise Jobs</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.3</td>
</tr>
<tr>
<td>Description:</td>
<td>Creating efficiently new column(s) in a data frame (including tibble) by applying a function one row at a time.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://courtiol.github.io/lay/">https://courtiol.github.io/lay/</a>, <a href="https://github.com/courtiol/lay/">https://github.com/courtiol/lay/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/courtiol/lay/issues/">https://github.com/courtiol/lay/issues/</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Imports:</td>
<td>rlang, purrr, vctrs, tibble</td>
</tr>
<tr>
<td>Suggests:</td>
<td>bench, covr, data.table, dplyr (&ge; 1.0), forcats, ggplot2,
ggbeeswarm, knitr, rmarkdown, slider, testthat (&ge; 2.1.0),
tidyr, spelling</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-28 15:31:18 UTC; courtiol</td>
</tr>
<tr>
<td>Author:</td>
<td>Alexandre Courtiol
    <a href="https://orcid.org/0000-0003-0637-2959"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre],
  Romain Fran√ßois <a href="https://orcid.org/0000-0002-2444-4226"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Alexandre Courtiol &lt;alexandre.courtiol@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-30 13:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='drugs'>Pain relievers misuse in the US</h2><span id='topic+drugs'></span><span id='topic+drugs_full'></span>

<h3>Description</h3>

<p>Datasets containing information about the use of pain relievers for non medical purpose.
</p>


<h3>Format</h3>

<p>A tibble with either 100 or 55271 rows, and 8 variables:
</p>

<dl>
<dt>caseid</dt><dd><p>The identifier code of the respondent</p>
</dd>
<dt>hydrocd</dt><dd><p>Ever use hydrocodone nonmedically?</p>
</dd>
<dt>oxycodp</dt><dd><p>Ever use ever percocet, percodan, tylox, oxycontin... nonmedically?</p>
</dd>
<dt>codeine</dt><dd><p>Ever used codeine nonmedically?</p>
</dd>
<dt>tramadl</dt><dd><p>Ever used tramadol nonmedically?</p>
</dd>
<dt>morphin</dt><dd><p>Ever used morphine nonmedically?</p>
</dd>
<dt>methdon</dt><dd><p>Ever used methadone nonmedically?</p>
</dd>
<dt>vicolor</dt><dd><p>Ever used vicodin, lortab or lorcert nonmedically?</p>
</dd>
</dl>



<h3>Details</h3>

<p>These datasets are a small subset from the &quot;National Survey on Drug Use and Health, 2014&quot;.
All variables related to drug use have been recoded into vectors of integers talking value 0 for
&quot;No/Unknown&quot; and value 1 for &quot;Yes&quot;. The original variable names were the same as those defined
here but in upper case and ending with the number 2. The dataset called <code>drugs</code> contain the first
100 rows of the one called <code>drugs_full</code>.
</p>


<h3>Source</h3>

<p><a href="https://www.icpsr.umich.edu/web/NAHDAP/studies/36361">https://www.icpsr.umich.edu/web/NAHDAP/studies/36361</a>
</p>


<h3>References</h3>

<p>United States Department of Health and Human Services.
Substance Abuse and Mental Health Services Administration.
Center for Behavioral Health Statistics and Quality.
National Survey on Drug Use and Health, 2014.
Ann Arbor, MI: Inter-university Consortium for Political and Social Research (distributor), 2016-03-22.
<a href="https://doi.org/10.3886/ICPSR36361.v1">doi:10.3886/ICPSR36361.v1</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>drugs
drugs_full
</code></pre>

<hr>
<h2 id='lay'>Apply a function within each row</h2><span id='topic+lay'></span>

<h3>Description</h3>

<p>Create efficiently new column(s) in data frame (including tibble) by applying a function one row
at a time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lay(.data, .fn, ..., .method = c("apply", "tidy"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lay_+3A_.data">.data</code></td>
<td>
<p>A data frame or tibble (or other data frame extensions).</p>
</td></tr>
<tr><td><code id="lay_+3A_.fn">.fn</code></td>
<td>
<p>A function to apply to each row of <code>.data</code>.
Possible values are:
</p>

<ul>
<li><p> A function, e.g. <code>mean</code>
</p>
</li>
<li><p> An anonymous function, .e.g. <code>function(x) mean(x, na.rm = TRUE)</code>
</p>
</li>
<li><p> An anonymous function with shorthand, .e.g. <code style="white-space: pre;">&#8288;\(x) mean(x, na.rm = TRUE)&#8288;</code>
</p>
</li>
<li><p> A purrr-style lambda, e.g. <code>~ mean(.x, na.rm = TRUE)</code>
</p>
<p>(wrap the output in a data frame to apply several functions at once, e.g.
<code>~ tibble(min = min(.x), max = max(.x))</code>)
</p>
</li></ul>
</td></tr>
<tr><td><code id="lay_+3A_...">...</code></td>
<td>
<p>Additional arguments for the function calls in <code>.fn</code> (must be named!).</p>
</td></tr>
<tr><td><code id="lay_+3A_.method">.method</code></td>
<td>
<p>This is an experimental argument that allows you to control which internal method
is used to apply the rowwise job:
</p>

<ul>
<li><p> &quot;apply&quot;, the default internally uses the function <code><a href="base.html#topic+apply">apply()</a></code>.
</p>
</li>
<li><p> &quot;tidy&quot;, internally uses <code><a href="purrr.html#topic+pmap">purrr::pmap()</a></code> and is stricter with respect to class coercion
across columns.
</p>
</li></ul>

<p>The default has been chosen based on these <a href="https://courtiol.github.io/lay/articles/benchmarks.html"><strong>benchmarks</strong></a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>lay()</code> create a vector or a data frame (or tibble), by considering in turns each row of a data
frame (<code>.data</code>) as the vector input of some function(s) <code>.fn</code>.
</p>
<p>This makes the creation of new columns based on a rowwise operation both simple (see
<strong>Examples</strong>; below) and efficient (see the Article <a href="https://courtiol.github.io/lay/articles/benchmarks.html"><strong>benchmarks</strong></a>).
</p>
<p>The function should be fully compatible with <code>{dplyr}</code>-based workflows and follows a syntax close
to <code><a href="dplyr.html#topic+across">dplyr::across()</a></code>.
</p>
<p>Yet, it takes <code>.data</code> instead of <code>.cols</code> as a main argument, which makes it possible to also use
<code>lay()</code> outside <code>dplyr</code> verbs (see <strong>Examples</strong>).
</p>
<p>The function <code>lay()</code> should work in a wide range of situations, provided that:
</p>

<ul>
<li><p> The input <code>.data</code> should be a data frame (including tibble) with columns of same class, or of
classes similar enough to be easily coerced into a single class. Note that <code>.method = "apply"</code>
also allows for the input to be a matrix and is more permissive in terms of data coercion.
</p>
</li>
<li><p> The output of <code>.fn</code> should be a scalar (i.e., vector of length 1) or a 1 row data frame (or
tibble).
</p>
</li></ul>

<p>If you use <code>lay()</code> within <code><a href="dplyr.html#topic+mutate">dplyr::mutate()</a></code>, make sure that the data used by <code><a href="dplyr.html#topic+mutate">dplyr::mutate()</a></code>
contain no row-grouping, i.e., what is passed to <code>.data</code> in <code><a href="dplyr.html#topic+mutate">dplyr::mutate()</a></code> should not be of
class <code>grouped_df</code> or <code>rowwise_df</code>. If it is, <code>lay()</code> will be called multiple times, which will
slow down the computation despite not influencing the output.
</p>


<h3>Value</h3>

<p>A vector with one element per row of <code>.data</code>, or a data frame (or tibble) with one row per row of <code>.data</code>. The class of the output is determined by <code>.fn</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# usage without dplyr -------------------------------------------------------------------------

# lay can return a vector
lay(drugs[1:10, -1], any)

# lay can return a data frame
## using the shorthand function syntax \(x) .fn(x)
lay(drugs[1:10, -1],
   \(x) data.frame(drugs_taken = sum(x), drugs_not_taken = sum(x == 0)))

## using the rlang lambda syntax ~ fn(.x)
lay(drugs[1:10, -1],
   ~ data.frame(drugs_taken = sum(.x), drugs_not_taken = sum(.x == 0)))

# lay can be used to augment a data frame
cbind(drugs[1:10, ],
      lay(drugs[1:10, -1],
         ~ data.frame(drugs_taken = sum(.x), drugs_not_taken = sum(.x == 0))))


# usage with dplyr ----------------------------------------------------------------------------

if (require("dplyr")) {

  # apply any() to each row
  drugs |&gt;
    mutate(everused = lay(pick(-caseid), any))

  # apply any() to each row using all columns
  drugs |&gt;
    select(-caseid) |&gt;
    mutate(everused = lay(pick(everything()), any))

  # a workaround would be to use `rowSums`
  drugs |&gt;
    mutate(everused = rowSums(pick(-caseid)) &gt; 0)

  # but we can lay any function taking a vector as input, e.g. median
  drugs |&gt;
    mutate(used_median = lay(pick(-caseid), median))

  # you can pass arguments to the function
  drugs_with_NA &lt;- drugs
  drugs_with_NA[1, 2] &lt;- NA

  drugs_with_NA |&gt;
    mutate(everused = lay(pick(-caseid), any))
  drugs_with_NA |&gt;
    mutate(everused = lay(pick(-caseid), any, na.rm = TRUE))

  # you can lay the output into a 1-row tibble (or data.frame)
  # if you want to apply multiple functions
  drugs |&gt;
    mutate(lay(pick(-caseid),
             ~ tibble(drugs_taken = sum(.x), drugs_not_taken = sum(.x == 0))))

  # note that naming the output prevent the automatic splicing and you obtain a df-column
  drugs |&gt;
    mutate(usage = lay(pick(-caseid),
              ~ tibble(drugs_taken = sum(.x), drugs_not_taken = sum(.x == 0))))

  # if your function returns a vector longer than a scalar, you should turn the output
  # into a tibble, which is the job of as_tibble_row()
  drugs |&gt;
    mutate(lay(pick(-caseid), ~ as_tibble_row(quantile(.x))))

  # note that you could also wrap the output in a list and name it to obtain a list-column
  drugs |&gt;
    mutate(usage_quantiles = lay(pick(-caseid), ~ list(quantile(.x))))
}

</code></pre>

<hr>
<h2 id='reexports'>Objects exported from other packages</h2><span id='topic+reexports'></span><span id='topic+tibble'></span><span id='topic+as_tibble_row'></span>

<h3>Description</h3>

<p>These objects are imported from other packages. Follow the links
below to see their documentation.
</p>

<dl>
<dt>tibble</dt><dd><p><code><a href="tibble.html#topic+as_tibble">as_tibble_row</a></code>, <code><a href="tibble.html#topic+tibble">tibble</a></code></p>
</dd>
</dl>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
