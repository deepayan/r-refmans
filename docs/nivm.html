<!DOCTYPE html><html><head><title>Help for package nivm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {nivm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#brkControl'>
<p>Arguments for Algorithm Control for <code>brkTest</code>.</p></a></li>
<li><a href='#brkTest'>
<p>Barnard-Rohmel-Kieser Test</p></a></li>
<li><a href='#findPowerR'>
<p>Get power from <code>brkTest</code>).</p></a></li>
<li><a href='#fmecTest'>
<p>Odds Ratio/Difference Non-inferiority tests</p></a></li>
<li><a href='#getfx2'>
<p>Internal functions for <code>nicqTest</code>.</p></a></li>
<li><a href='#getimaxpower'>
<p>Get i that maiximizes power when F1=F2 for a specified g function</p></a></li>
<li><a href='#getPossibleR'>
<p>Internal functions used for tests from Rohmel and Kieser ( <code>fmecTest</code>, <code>fmecExact</code>, and <code>brkTest</code>).</p></a></li>
<li><a href='#nicqControl'>
<p>Function that returns a list of algorithm controls for nicq</p></a></li>
<li><a href='#nicqTest'>
<p>Non-inferiority control quantile test</p></a></li>
<li><a href='#nimDiffOR'>
<p>Variable margin functions</p></a></li>
<li><a href='#nivm-package'>
<p>Non-inferiority Tests with Variable Margins</p></a></li>
<li><a href='#powerNicqTest'>
<p>Power or Sample Size for Non-inferiority Control Quantile Test</p></a></li>
<li><a href='#print.brk'>
<p>Print Method for <code>brk</code> or <code>nicq</code> Object.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Noninferiority Tests with Variable Margins</td>
</tr>
<tr>
<td>Version:</td>
<td>0.5</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-01-25</td>
</tr>
<tr>
<td>Author:</td>
<td>Michael P. Fay</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Michael P. Fay &lt;mfay@niaid.nih.gov&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>stats, bpcp, ssanv</td>
</tr>
<tr>
<td>Description:</td>
<td>Noninferiority tests for difference in failure rates at a prespecified control rate or prespecified time. For details, see Fay and Follmann, 2016 &lt;<a href="https://doi.org/10.1177%2F1740774516654861">doi:10.1177/1740774516654861</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-25 18:54:23 UTC; faym</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-25 22:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='brkControl'>
Arguments for Algorithm Control for <code><a href="#topic+brkTest">brkTest</a></code>.
</h2><span id='topic+brkControl'></span>

<h3>Description</h3>

<p>Function that gives a list. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>brkControl(alpha = 0.025, alphastar = 0.001, ngrid = 1000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="brkControl_+3A_alpha">alpha</code></td>
<td>

<p>significance level for test
</p>
</td></tr>
<tr><td><code id="brkControl_+3A_alphastar">alphastar</code></td>
<td>

<p>a value that is much much less than the significance level. Used to speed up calculations since we group all values less than alphastar together and do not need to add them one-at-a-time.
</p>
</td></tr>
<tr><td><code id="brkControl_+3A_ngrid">ngrid</code></td>
<td>

<p>number of elements in the grid search over the control proportion.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list with values names the same as the arguments.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+brkTest">brkTest</a></code>
</p>

<hr>
<h2 id='brkTest'>
Barnard-Rohmel-Kieser Test
</h2><span id='topic+brkTest'></span>

<h3>Description</h3>

<p>A variable margin difference in proportion test for non-inferiority. The test is based on Barnard's test.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>brkTest(x1, n1, x2, n2, threshold = 0.2, delta = 0.1, control = brkControl())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="brkTest_+3A_x1">x1</code></td>
<td>

<p>number of events in the control group
</p>
</td></tr>
<tr><td><code id="brkTest_+3A_n1">n1</code></td>
<td>

<p>number of individuals in the control group
</p>
</td></tr>
<tr><td><code id="brkTest_+3A_x2">x2</code></td>
<td>

<p>number of events in the test group
</p>
</td></tr>
<tr><td><code id="brkTest_+3A_n2">n2</code></td>
<td>

<p>number of events in the test group
</p>
</td></tr>
<tr><td><code id="brkTest_+3A_threshold">threshold</code></td>
<td>

<p>proportion in the control group associated with the threshold, above that threshold use a constant difference margin, below the 
threshold use a difference margin with a constant odds ratio. We use only continuous variable margins that meet at the threshold.
</p>
</td></tr>
<tr><td><code id="brkTest_+3A_delta">delta</code></td>
<td>

<p>difference in proportions at the threshold
</p>
</td></tr>
<tr><td><code id="brkTest_+3A_control">control</code></td>
<td>

<p>list of parameters for algorithm control, see <code><a href="#topic+brkControl">brkControl</a></code>
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This test is labeled T4 in Rohmel and Keiser (2013).
</p>


<h3>Value</h3>

<p>a list of class <code>brk</code>, with elements:
</p>
<table>
<tr><td><code>statistic</code></td>
<td>
<p>the threshold, delta (difference margin at threshold), and odds ratio at threshold</p>
</td></tr>
<tr><td><code>data.name</code></td>
<td>
<p> gives x1,x2,n1,n2 as a character string</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>description of test</p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>one-sided p-value</p>
</td></tr>
<tr><td><code>FullResults</code></td>
<td>
<p>a list with 4 matrices, each n1+1 by n2+1 representing the total sample space. R=a matrix with logical values with TRUE elements representing the rejection region, its 'sig.level' attribute gives the significance level of the test; 
PVALbounds=a matrix of p-value bounds, pb; PVALsymbols=a matrix of symbols that describe the pb, '&lt;=' means 'p&lt;=pb',  '=' means 'p=pb' and  '&gt;' means 'p&gt;pb'; PVALUES=a matrix giving the p-value expression, e.g., 'p&lt;=.00321' or 'p&gt;0.025'.  
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Michael P. Fay
</p>


<h3>References</h3>

<p>Rohmel, J, and Kieser, M (2013). &quot;Investigations on non-inferiority - - the Food and Drug Administration draft guidance on treatments for nosocomial pneumonia as a case for exact tests for binomial proportions&quot; Statistics in Medicine 32:2335-2348.
</p>


<h3>See Also</h3>

<p>See Also <code><a href="#topic+nicqTest">nicqTest</a></code>, ~~~</p>


<h3>Examples</h3>

<pre><code class='language-R'>x&lt;-brkTest(3,8,0,6)
x
x$FullResults$PVALUES
</code></pre>

<hr>
<h2 id='findPowerR'>
Get power from <code><a href="#topic+brkTest">brkTest</a></code>).
</h2><span id='topic+findPowerR'></span>

<h3>Description</h3>

<p>Power under an alternative F1 and F2 relationship, represented by a F2=g(F1).  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>findPowerR(R, g, psearch = (0:1000)/1000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="findPowerR_+3A_r">R</code></td>
<td>
<p>matrix of rejection region, if x is the output from <code>brk.test</code>, then R=x$FullResults$R
</p>
</td></tr>
<tr><td><code id="findPowerR_+3A_g">g</code></td>
<td>
<p>function under which to calculate the power, F2=g(F1).</p>
</td></tr>
<tr><td><code id="findPowerR_+3A_psearch">psearch</code></td>
<td>
<p>vector of values over which to calculate the power</p>
</td></tr>
</table>

<hr>
<h2 id='fmecTest'>
Odds Ratio/Difference Non-inferiority tests
</h2><span id='topic+fmecTest'></span><span id='topic+fmecExact'></span>

<h3>Description</h3>

<p>Rohmel and Keier (2013) developed these non-inferioirty tests with variable margins. One margin function, NiM3, has the variable margin measuring a constant difference in proportions  (0.10 in paper) after a threshold (0.20 proportion in the control group), or tests for differences defined in terms of a constant odds ratio (1.71 in paper) at values less than the threshold.  The <code>fmecTest</code> with type='max' gives the maximum of two p-values, either a difference in proportions test (one-sided asymptotic method of Farrington and Manning, 1990) or an odds ratio test (one-sided Fisher's exact). This test is NiM3/T2 in Rohmel and Keier (2013). We also provide an exact version of this test with <code>fmecExact</code>, denoted NiM3/T3 in Rohmel and Keier (2013). When type='switch' the tests are like T1 of Rohmel and Keier (2013).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fmecTest(x1, n1, x2, n2, threshold = 0.2, delta = 0.1,
    alternative = c("less","greater"), 
    type = c("max", "switch"))

fmecExact(x1, n1, x2, n2, threshold = 0.2, delta = 0.1, 
    alternative = c("less", "greater"), 
    type = c("max", "switch"), ngrid = 1000)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fmecTest_+3A_x1">x1</code></td>
<td>

<p>number of failures in control group
</p>
</td></tr>
<tr><td><code id="fmecTest_+3A_n1">n1</code></td>
<td>

<p>number of individuals in control group
</p>
</td></tr>
<tr><td><code id="fmecTest_+3A_x2">x2</code></td>
<td>

<p>number of failures in test group
</p>
</td></tr>
<tr><td><code id="fmecTest_+3A_n2">n2</code></td>
<td>

<p>number of individuals in test group
</p>
</td></tr>
<tr><td><code id="fmecTest_+3A_threshold">threshold</code></td>
<td>

<p>threshold on proportion in control group: above it use constant difference margin, below it use difference margin with constant odds ratio
</p>
</td></tr>
<tr><td><code id="fmecTest_+3A_delta">delta</code></td>
<td>

<p>difference margin at threshold
</p>
</td></tr>
<tr><td><code id="fmecTest_+3A_alternative">alternative</code></td>
<td>

<p>must be 'less'. the value 'greater' is not supported at this time.
</p>
</td></tr>
<tr><td><code id="fmecTest_+3A_type">type</code></td>
<td>

<p>either 'max' (maximum of Fisher's exact p-value or Farrington and Manning p-value) or 'switch' (Fisher's exact p-value below threhold and Farington and Manning p-value above threhold).
</p>
</td></tr>
<tr><td><code id="fmecTest_+3A_ngrid">ngrid</code></td>
<td>

<p>grid size for the search for the maximum p-value. Search over the control proportion values 0:ngrid/ngrid. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For details see Rohmel and Keier (2013, Section 3). These functions only use NiM3.
</p>


<h3>Value</h3>

<p>a list of class 'htest':
</p>
<table>
<tr><td><code>statistic</code></td>
<td>
<p>the threshold, delta (difference margin at threshold), and odds ratio at threshold</p>
</td></tr>
<tr><td><code>data.name</code></td>
<td>
<p> gives x1,x2,n1,n2 as a character string</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>description of test</p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>one-sided p-value</p>
</td></tr>
<tr><td><code>null.value</code></td>
<td>
<p>delta, the difference margin at threshold</p>
</td></tr>
<tr><td><code>alternative</code></td>
<td>
<p>direction of alternative hypothesis</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Michael P. Fay
</p>


<h3>References</h3>

<p>Farrington, CP and Manning G (1990). &quot;Test statistics and sample size formulae for comparative binomial trials with null hypothesis of non-zero risk difference or non-unit relative risk&quot; Statistics in Medicine 9:1447-1454.
</p>
<p>Rohmel, J, and Kieser, M (2013). &quot;Investigations on non-inferiority - -  the Food and Drug Administration draft guidance on treatments for nosocomial pneumonia as a case for exact tests for binomial proportions&quot; Statistics in Medicine 32:2335-2348.
</p>


<h3>See Also</h3>

 <p><code><a href="#topic+nicqTest">nicqTest</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>fmecTest(6,10,2,12,alternative="less",type="max")
fmecExact(6,10,2,12,alternative="less",type="max")
</code></pre>

<hr>
<h2 id='getfx2'>
Internal functions for <code><a href="#topic+nicqTest">nicqTest</a></code>.
</h2><span id='topic+getfx2'></span><span id='topic+nicqCalc'></span><span id='topic+nicqGetpvalue'></span>

<h3>Description</h3>

<p>Usually not directly called, called by <code><a href="#topic+nicqTest">nicqTest</a></code>. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getfx2(i, n1, n2, g, slowint = FALSE, mint = 100, interr = 10^-3)
nicqCalc(X2T1i,g,i0,n1,n2,delta0=.10,q0=.20,
    conf.int=TRUE,
    conf.level=0.95,
    conf.sided=c("two.sided","one.sided"), alternative="less",
    control=nicqControl())

nicqGetpvalue(X2T1i,n1,n2,g,i0,alternative="less",
control=nicqControl())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getfx2_+3A_i">i</code></td>
<td>

<p>ic value
</p>
</td></tr>
<tr><td><code id="getfx2_+3A_n1">n1</code></td>
<td>

<p>number in control group
</p>
</td></tr>
<tr><td><code id="getfx2_+3A_n2">n2</code></td>
<td>

<p>number in test group
</p>
</td></tr>
<tr><td><code id="getfx2_+3A_g">g</code></td>
<td>

<p>function
</p>
</td></tr>
<tr><td><code id="getfx2_+3A_slowint">slowint</code></td>
<td>

<p>logical, if true use built-in integrate function. But this is slower.
</p>
</td></tr>
<tr><td><code id="getfx2_+3A_mint">mint</code></td>
<td>

<p>number of trapizoids for calculation with slowint=FALSE
</p>
</td></tr>
<tr><td><code id="getfx2_+3A_interr">interr</code></td>
<td>

<p>tolerance for integration
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function <code>getfx2</code> gets probability mass function for x2=number of failures in the test group at or before the ith failure in the control group. Uses very simple numeric integration (slowint=FALSE) that just adds mint trapazoids (rectangles with triangle tops).
</p>


<h3>Value</h3>

<p>vector of probabilities for all possible x2 values, forced to sum to 1. 
</p>

<hr>
<h2 id='getimaxpower'>
Get i that maiximizes power when F1=F2 for a specified g function
</h2><span id='topic+getimaxpower'></span>

<h3>Description</h3>

<p> Usually not directly called, called by <code><a href="#topic+nicqTest">nicqTest</a></code>.</p>


<h3>Usage</h3>

<pre><code class='language-R'>getimaxpower(n1, n2, g, alpha = 0.05, rdig = 5, maxprop=1, alt="less", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getimaxpower_+3A_n1">n1</code></td>
<td>

<p>number in control group
</p>
</td></tr>
<tr><td><code id="getimaxpower_+3A_n2">n2</code></td>
<td>

<p>number in test group
</p>
</td></tr>
<tr><td><code id="getimaxpower_+3A_g">g</code></td>
<td>

<p>function
</p>
</td></tr>
<tr><td><code id="getimaxpower_+3A_alpha">alpha</code></td>
<td>

<p>alpha level
</p>
</td></tr>
<tr><td><code id="getimaxpower_+3A_rdig">rdig</code></td>
<td>

<p>number of rounding digits
</p>
</td></tr>
<tr><td><code id="getimaxpower_+3A_...">...</code></td>
<td>

<p>for passing arguments
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the i value
</p>

<hr>
<h2 id='getPossibleR'>
Internal functions used for tests from Rohmel and Kieser ( <code><a href="#topic+fmecTest">fmecTest</a></code>, <code><a href="#topic+fmecExact">fmecExact</a></code>, and <code><a href="#topic+brkTest">brkTest</a></code>).
</h2><span id='topic+getPossibleR'></span><span id='topic+getR'></span><span id='topic+getpadd'></span><span id='topic+getij'></span><span id='topic+getieje'></span><span id='topic+getfij'></span><span id='topic+findPower'></span><span id='topic+FarrMann'></span><span id='topic+EC'></span><span id='topic+brkCalc'></span>

<h3>Description</h3>

<p>Not to be called directly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>brkCalc(n1, n2, threshold, delta, g = nimDiffOR, 
    alpha = 0.025, alphastar = 0.001, ngrid = 1000)

EC(X1, X2, M1, M2, or = 1.71, alternative = c("less", "greater", "two.sided"))

FarrMann(X1, X2, M1, M2, delta0, 
    alternative = c("less", "greater", "two.sided"), 
    fudgeDigits = 8)

findPower(ir, jr, n1, n2, psearch, qsearch)

getfij(n1, n2, p, q)

getieje(ir, jr)

getij(R)

getPossibleR(ie, je, n1, n2, decreasei = TRUE, increasej = TRUE)
getpadd(i, j, n1, n2, psearch, qsearch)
getR(i, j, n1, n2)


</code></pre>


<h3>Details</h3>

<p>Fill in details later. For now see code.</p>

<hr>
<h2 id='nicqControl'>
Function that returns a list of algorithm controls for nicq
</h2><span id='topic+nicqControl'></span>

<h3>Description</h3>

<p>Controls for numeric integration, etc. Mostly used in <code><a href="#topic+getfx2">getfx2</a></code> that is called by <code><a href="#topic+nicqTest">nicqTest</a></code>.
</p>
<p>Defined as a function instead of a list, so sanity checks can be built in (but none have been included yet). 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nicqControl(rdig = 5, slowint = FALSE, mint = 100, 
    interr = 10^-3,  epsilon=10^(-4), alpha = 0.025,
    tau.conf.level=0.95)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nicqControl_+3A_rdig">rdig</code></td>
<td>

<p>number of digits for rounding, used to eliminate some computer errors.  Used in <code><a href="#topic+getimaxpower">getimaxpower</a></code> called by <code><a href="#topic+nicqTest">nicqTest</a></code> when ic=&quot;maxpower&quot;.
</p>
</td></tr>
<tr><td><code id="nicqControl_+3A_slowint">slowint</code></td>
<td>

<p>use slow integration for <code><a href="#topic+getfx2">getfx2</a></code>
</p>
</td></tr>
<tr><td><code id="nicqControl_+3A_mint">mint</code></td>
<td>

<p>number of summands in numeric integration for <code><a href="#topic+getfx2">getfx2</a></code>
</p>
</td></tr>
<tr><td><code id="nicqControl_+3A_interr">interr</code></td>
<td>

<p>tolerance for integration for <code><a href="#topic+getfx2">getfx2</a></code>
</p>
</td></tr>
<tr><td><code id="nicqControl_+3A_epsilon">epsilon</code></td>
<td>

<p>small value to give the range for the uniroot function that calculates the confidence intervals. It searches from -q+epsilon to 1-q-epsilon. Used in <code>nicq.calc</code> called by <code><a href="#topic+nicqTest">nicqTest</a></code>.
</p>
</td></tr>
<tr><td><code id="nicqControl_+3A_alpha">alpha</code></td>
<td>

<p>significance level for calculation of <code><a href="#topic+getimaxpower">getimaxpower</a></code> called by <code><a href="#topic+nicqTest">nicqTest</a></code> when ic=&quot;maxpower&quot;.
</p>
</td></tr>
<tr><td><code id="nicqControl_+3A_tau.conf.level">tau.conf.level</code></td>
<td>

<p>confidence level for tau, where F1(tau)=q. Uses <code>bpcp</code> then <code>quantile.kmciLR</code>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list with each argument as a named value
</p>


<h3>See Also</h3>

<p><code><a href="#topic+nicqTest">nicqTest</a></code>
</p>

<hr>
<h2 id='nicqTest'>
Non-inferiority control quantile test
</h2><span id='topic+nicqTest'></span>

<h3>Description</h3>

<p>Tests for a difference in proportion of failures between test and control by the time the qth quantile of the contol group has failed. Uses a variable margin function, and the time of the qth quantile of the control group is unknown. 
</p>
<p>If the cumulative distributions for the two groups are F1 (control) and F2 (test), then we are interested in the difference: delta=F2(t0)-F1(t0), where F1(t0)=q. Note F1,F2 are unknown and non-parametric, and t0 is unknown. In this case, using a constant delta does not give practical non-inferiority margins, therefore we use a variable margin function, so that we test (when alternative='less')  H0: F2(t) &gt;= g(F1(t)) versus H1: F2(t) &lt; g(F1(t)) for all t.  
</p>
<p>The test also works for other types of continuous responses besides time to failure (see details), but the help description uses time to failure for brevity. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nicqTest(x,delta0,q,g=nimDiffOR,yc=NULL,nc=NULL,nt=NULL,
    ic="prop",
    z=NULL,status=NULL,ties=c("cons","approx"),
    alternative=c("less","greater"),
    conf.level=0.95,
    conf.int=TRUE,
    conf.sided=c("two.sided","one.sided"), 
    gname=NULL,
    control=nicqControl())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nicqTest_+3A_x">x</code></td>
<td>

<p>either a vector of failure times for the both groups (when z is given), a vector of failure times for the test group (when yc is given), or the number of failures in the test group that have occured by the ic^th failure in the control group (when ic is an integer, nc and nt are given). See details.
</p>
</td></tr>
<tr><td><code id="nicqTest_+3A_delta0">delta0</code></td>
<td>

<p>difference, F2(t0)-F1(t0), on the boundary between the null and alternative hypotheses, where t0 is defined so 
that F1(t0)=q.
</p>
</td></tr>
<tr><td><code id="nicqTest_+3A_q">q</code></td>
<td>

<p>probability associated with the quantile of interest in control group
</p>
</td></tr>
<tr><td><code id="nicqTest_+3A_g">g</code></td>
<td>

<p>non-inferiority margin function. Must have arguments <code>q</code> (representing the quantile of interest in the control group) and <code>delta</code> (representing the difference, F2(t0)-F1(t0), where F2 and F2 are the cumulative distributions of failures for the test (F2) and control (F1) at t, where F1(t)=q). Default values for <code>q</code> and <code>delta</code> are ignored. Default function is  <code><a href="#topic+nimDiffOR">nimDiffOR</a></code>.
</p>
</td></tr>
<tr><td><code id="nicqTest_+3A_yc">yc</code></td>
<td>

<p>vector of failure times in the control group. If given, <code>x</code> is the vector of failure times in the test group.
</p>
</td></tr>
<tr><td><code id="nicqTest_+3A_nc">nc</code></td>
<td>

<p>number of individuals in the control group. Not needed if <code>z</code> or <code>yc</code> is given.
</p>
</td></tr>
<tr><td><code id="nicqTest_+3A_nt">nt</code></td>
<td>

<p>number of individuals in the test group. Not needed if <code>z</code> or <code>yc</code> is given.
</p>
</td></tr>
<tr><td><code id="nicqTest_+3A_ic">ic</code></td>
<td>

<p>used to find i.
The test is based on the number of failures in the test group that have occured by the ith failure in the control group. 
ic=&quot;prop&quot; gives i=ceiling(q*nc), ic=&quot;maxpower&quot; gives the i value that maximizes the power given F1=F2 and g, and ic=a postive integer gives i=ic (with  ic between 1 and nc inclusive).
</p>
</td></tr>
<tr><td><code id="nicqTest_+3A_z">z</code></td>
<td>

<p>a vector of group indicators, with either 1 (for control) or
2 (for test). If given, x is a vector of all failures in both groups.   
</p>
</td></tr>
<tr><td><code id="nicqTest_+3A_status">status</code></td>
<td>

<p>a vector denoting right censoring (0) or not (1). Not needed if there is no censoring. Only used when <code>z</code> is given. If any censoring occurs at or before the ith failure (see ic argument) in the control group, then the test is undefined. 
</p>
</td></tr>
<tr><td><code id="nicqTest_+3A_ties">ties</code></td>
<td>

<p>how should ties be handled, &quot;cons&quot; use a conservative adjustment for ties, &quot;approx&quot; use an approximate adjustment. See  details.
</p>
</td></tr>
<tr><td><code id="nicqTest_+3A_alternative">alternative</code></td>
<td>

<p>direction of alternative hypothesis.
</p>
</td></tr>
<tr><td><code id="nicqTest_+3A_conf.level">conf.level</code></td>
<td>
<p>confidence level</p>
</td></tr>
<tr><td><code id="nicqTest_+3A_conf.int">conf.int</code></td>
<td>
<p>logical, do confidence intervals</p>
</td></tr>
<tr><td><code id="nicqTest_+3A_conf.sided">conf.sided</code></td>
<td>
<p>character, either 'one.sided' or 'two.sided' (see warning)</p>
</td></tr>
<tr><td><code id="nicqTest_+3A_gname">gname</code></td>
<td>
<p>name for g function, if NULL uses name of inputed g function</p>
</td></tr>
<tr><td><code id="nicqTest_+3A_control">control</code></td>
<td>

<p>a list of arguments for numeric calculation settings, see <code><a href="#topic+nicqControl">nicqControl</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data may be entered in 3 different formats, and the first argument <code>x</code> changes depending on which format. When <code>z</code> is given then <code>x</code> is the vector of failure times from both groups and z gives the group membership of each of those failures. If there is right censoring this may be given using <code>status</code>, and the <code>nicq</code> function will make sure that the censoring happens late enough so that the test can still be calculated.  When <code>yc</code> is given then <code>x</code> is a vector of failure times in the test group and <code>yc</code> are the failure times in the control group. When <code>ic</code>  is an integer, then <code>x</code> represents the number of failure times that have occurred in the test group at or before the time of the icth failure in the control group. In this last format only  <code>nc</code> (number in control group) and <code>nt</code> (number in the test group) must be given. 
</p>
<p>The confidence interval is calculated on the difference, F2(t0)-F1(t0), where t0 is unknonwn and defined so that F1(t0)=q, with q given.
</p>
<p>The responses can be any numeric values, as long as the difference, F2(t0)- F1(t0), is of interest.  
</p>
<p>For more details see Fay and Follmann (2015). 
</p>
<p>The confidence intervals for the qth quantile of the control is calculated using the <code>bpcp</code> function followed by the <code>quantile.kmciLR</code> from the <code>bpcp</code> R package.
</p>


<h3>Value</h3>

<p>An <code>nicq</code> object which inherits from <code>htest</code> class (the print method for is slightly different). A list with elements:
</p>
<table>
<tr><td><code>statistic</code></td>
<td>
<p>number of failure in test group at or before the qth quantile of the control group</p>
</td></tr>
<tr><td><code>parameter</code></td>
<td>
<p>vector with elements: q (quantile of interest in control group),i (rank of qth quantile), n1 (number in control group), n2 (number in test group) </p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>one-sided p.value</p>
</td></tr>
<tr><td><code>conf.int</code></td>
<td>
<p>confidence interval on F2(t0)-F1(t0), may be one- or two-sided, see attributes</p>
</td></tr>
<tr><td><code>estimate</code></td>
<td>
<p>vector of estimates. Values are: x2/n2= proportion of failures in test group by  i, i/n1= proportion failures in control group by i, 'x2/n2-i/n1'=difference, tau=qth quantile of control (same at t0), lower CL=lower confidence limit for tau, upper CL, conf.level=conf.level for CI on tau</p>
</td></tr>
<tr><td><code>null.value</code></td>
<td>
<p>null value for the difference</p>
</td></tr>
<tr><td><code>alternative</code></td>
<td>
<p>either 'less' or 'greater'. two.sided is not allowed</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>description of test</p>
</td></tr>
</table>


<h3>warning</h3>

<p> Since 'two.sided' alternatives are not allowed, the p-values may not match the confidence intervals in the usual way if <code>conf.sided</code>='two.sided' (the default). Consider the example below, 
with  <code>alternative</code>='less' and  <code>delta0</code>=0.10. The p-value is 0.04, so we might expect that the upper limit of the 95 percent confidence limit would be less than 0.10, but this is not so because <code>conf.sided</code>='two.sided' and we are using the two-sided confidence interval and p is greater than 0.05/2=0.025. </p>


<h3>Author(s)</h3>

<p>Michael P. Fay (mfay@niaid.nih.gov)
</p>


<h3>References</h3>

<p>Fay, MP and Follmann DA (2016). Non-inferiority Tests for Anti-Infective Drugs using Control Group Quantiles. Clinical Trials. 13(6): 632-640.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## if you know that q=0.20 and there are no ties then ic=q*nc=40 
nicqTest(66,g=nimDiffOR,delta0=.1,q=.2,nc=200,nt=300,ic=40,conf.int=FALSE)
## examples with confidence intervals may be slower: see
##  demo(nicqTest.examples)
</code></pre>

<hr>
<h2 id='nimDiffOR'>
Variable margin functions
</h2><span id='topic+nimDiffOR'></span><span id='topic+nimDiff'></span><span id='topic+nimOR'></span>

<h3>Description</h3>

<p>For testing the alternative F2(t)&lt; g(F1(t)). We give several built-in choices for the function g.  All functions must be defined in terms of delta and q, where F1(t0)=q and t0 is defined implicitly, and delta = F2(t0) - g(F1(t0)).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nimDiffOR(p, delta = 0.1, q = 0.2)
nimOR(p, delta=0.1, q=0.2)
nimDiff(p,delta=.1, q=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nimDiffOR_+3A_p">p</code></td>
<td>

<p>a vector of F1(t) values, where F1(t) is the proportion of control that failed by t. 
</p>
</td></tr>
<tr><td><code id="nimDiffOR_+3A_q">q</code></td>
<td>

<p>the probability associated with the control quantile of interest, not used for calculations in <code>nimDiff</code> but needs to be in the call.
</p>
</td></tr>
<tr><td><code id="nimDiffOR_+3A_delta">delta</code></td>
<td>

<p>the difference: F2(t0) - g(F1(t0))
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The functions are defined in terms of <code>delta</code> and <code>q</code> so that the function can change as a function of <code>delta</code> and we can use the function to get confidence intervals for delta (defined in terms of q, since q=F1(t0) which defines t0).  
</p>
<p>Functions should handle vectors of F1(t) values, and the output is a vector of the same length. The results should be between 0 and 1.   
</p>
<p>The function <code>nimDiffOR</code> gives the minimum of the difference (defined by delta) or the odds ratio (defined in terms of q and delta) when delta&gt;0, and the maximum when delta&lt;0.
</p>
<p>For plots of the functions see Fay and Follmann (2015). 
</p>


<h3>Value</h3>

<p>a vector of values g(F1(t)).
</p>


<h3>References</h3>

<p>Fay, MP and Follmann DA (2016). Non-inferiority Tests for Anti-Infective Drugs using Control Group Quantiles. (to appear in Clinical Trials).</p>


<h3>See Also</h3>

<p><code><a href="#topic+nicqTest">nicqTest</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## notice that the second values, F1(t)=0.20=q, 
## all equal 
##  q+delta=0.30
nimDiff(c(1:9)/10)
nimOR(c(1:9)/10)
nimDiffOR(c(1:9)/10)
## for delta&lt;0, take max of difference and odds ratio
nimDiffOR(c(1:9)/10,delta=-.1)

</code></pre>

<hr>
<h2 id='nivm-package'>
Non-inferiority Tests with Variable Margins
</h2><span id='topic+nivm-package'></span><span id='topic+nivm'></span>

<h3>Description</h3>

<p>This package was developed to give the control quantile non-inferiority test described in Fay and Follmann (2015), and the function to calculate that test is <code><a href="#topic+nicqTest">nicqTest</a></code>. Some competitors to that test are some tests described in Rohmel and Kieser (2013): <code><a href="#topic+brkTest">brkTest</a></code>, <code><a href="#topic+fmecTest">fmecTest</a></code>, and <code><a href="#topic+fmecExact">fmecExact</a></code>. 
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> nivm</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 0.5</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2024-01-25</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> &gt;=GPL3</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Michael P. Fay
</p>
<p>Maintainer: Michael P. Fay &lt;mfay@niaid.nih.gov&gt;
</p>


<h3>References</h3>

<p>Fay, MP and Follmann DA (2016). Non-inferiority Tests for Anti-Infective Drugs using Control Group Quantiles. Clinical Trials. 13(6): 632-640.
</p>
<p>Rohmel, J and Kieser, M (2013). Investigations on non-inferiority&ndash;the Food and Drug Administration draft guidance on treatments for nosocomial pneumonia as a case for exact tests for binomial proportions. Statistics in Medicine. 32: 2335-2348.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+nicqTest">nicqTest</a></code></p>

<hr>
<h2 id='powerNicqTest'>
Power or Sample Size for Non-inferiority Control Quantile Test
</h2><span id='topic+powerNicqTest'></span>

<h3>Description</h3>

<p>Function gives power (if n1=NULL) or sample size (if power=NULL). Assumes no ties.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>powerNicqTest(n1 = NULL, n2 = NULL, power = NULL, 
    sig.level = 0.025, n2.over.n1 = 1, q = 0.2, 
    delta0 = 0.1, alternative = c("less", "greater"), 
    gnull = nimDiffOR, galt = function(x){x}, 
    minn=5, maxn = 10^5, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="powerNicqTest_+3A_n1">n1</code></td>
<td>

<p>sample size of control group, calculated if NULL
</p>
</td></tr>
<tr><td><code id="powerNicqTest_+3A_n2">n2</code></td>
<td>

<p>sample size of test group. If n1=NULL, n2 is ignored and calculated based on power and n2.over.n1. If power=NULL, then n2=ceiling(n2.over.n1*n1).
</p>
</td></tr>
<tr><td><code id="powerNicqTest_+3A_power">power</code></td>
<td>

<p>power under galt, calculated if NULL
</p>
</td></tr>
<tr><td><code id="powerNicqTest_+3A_sig.level">sig.level</code></td>
<td>

<p>significance level
</p>
</td></tr>
<tr><td><code id="powerNicqTest_+3A_n2.over.n1">n2.over.n1</code></td>
<td>

<p>ratio of sample sizes
</p>
</td></tr>
<tr><td><code id="powerNicqTest_+3A_q">q</code></td>
<td>

<p>probability associated with control quantile of interest
</p>
</td></tr>
<tr><td><code id="powerNicqTest_+3A_delta0">delta0</code></td>
<td>

<p>difference in proportions at control quantile of interest
</p>
</td></tr>
<tr><td><code id="powerNicqTest_+3A_alternative">alternative</code></td>
<td>

<p>alternative hypothesis direction, 'less' means F2(t) less than gnull(F1(t)) for some t.
</p>
</td></tr>
<tr><td><code id="powerNicqTest_+3A_gnull">gnull</code></td>
<td>

<p>variable margin function under null hypothesis (more formally, at the boundary between the null and alternative hypotheses for the pre-specified hypotheses) 
</p>
</td></tr>
<tr><td><code id="powerNicqTest_+3A_galt">galt</code></td>
<td>

<p>variable margin function for which we calculate the power
</p>
</td></tr>
<tr><td><code id="powerNicqTest_+3A_minn">minn</code></td>
<td>

<p>minimum value for sample size for n1, input into <code>uniroot.integer</code>.
</p>
</td></tr>
<tr><td><code id="powerNicqTest_+3A_maxn">maxn</code></td>
<td>

<p>maximum value for sample size for n1, input into <code>uniroot.integer</code>.
</p>
</td></tr>
<tr><td><code id="powerNicqTest_+3A_...">...</code></td>
<td>
<p>extra arguments passed to <code>uniroot.integer</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function either calculates the power (if n1=NULL) or calculates n1 and n2 (if power=NULL). In the latter case,
we use <code>uniroot.integer</code> to find the smallest n1 
that gives power at least as large as the given power [with n2 defined as ceiling(n2.over.n1*n1)].
</p>


<h3>Value</h3>

<p>a <code>power.htest</code> object. A list with elements:
</p>
<table>
<tr><td><code>n1</code></td>
<td>
<p>sample size for control group</p>
</td></tr>
<tr><td><code>n2</code></td>
<td>
<p>sample size for test group</p>
</td></tr>
<tr><td><code>delta0</code></td>
<td>
<p>F2(tau)-F1(tau), with tau defined by F1(tau)=q</p>
</td></tr>
<tr><td><code>q</code></td>
<td>
<p>probability associated with tau</p>
</td></tr>
<tr><td><code>sig.level</code></td>
<td>
<p>significance level</p>
</td></tr>
<tr><td><code>power</code></td>
<td>
<p>power under galt</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>character description of method</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+nicqTest">nicqTest</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'># to calculate power, leave power=NULL and supply n1 and n2
powerNicqTest(n1=200,n2=300)
# or supply n1 and n2.over.n1
powerNicqTest(n1=200,n2.over.n1=3/2)
## to calculate n1 and n2, supply power
## find minimum n1 that have power greater than 0.80
## takes 13 iterations to find n1=346
## so do not run it here
#powerNicqTest(power=.80,print.steps=TRUE)
</code></pre>

<hr>
<h2 id='print.brk'>
Print Method for <code>brk</code> or <code>nicq</code> Object.
</h2><span id='topic+print.brk'></span><span id='topic+print.nicq'></span>

<h3>Description</h3>

<p>For <code>brk</code> did not use <code>print.htest</code> because the p-values are just bounds for some values (e.g., p greater than 0.025). So I needed to print the results differently.
</p>
<p>For <code>nicq</code>, uses <code>print.htest</code> except for $estimates has some special printing instructions since there may be some extra confidence intervals on the control quantile of interest.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'brk'
print(x, digits = getOption("digits"), prefix = "\t", ...)

## S3 method for class 'nicq'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.brk_+3A_x">x</code></td>
<td>

<p>the <code>brk</code> object
</p>
</td></tr>
<tr><td><code id="print.brk_+3A_digits">digits</code></td>
<td>

<p>number of significant digits for printing 
</p>
</td></tr>
<tr><td><code id="print.brk_+3A_prefix">prefix</code></td>
<td>

<p>prefix below some values
</p>
</td></tr>
<tr><td><code id="print.brk_+3A_...">...</code></td>
<td>

<p>for passing arguments. In <code>nicq</code> passed to <code>print.htest</code>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Does not print out FullResults list because it is generally too large.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
