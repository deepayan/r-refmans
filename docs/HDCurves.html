<!DOCTYPE html><html><head><title>Help for package HDCurves</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {HDCurves}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#emp_deriv'><p>Estimate of empirical derivative based on sequence of quotient differences.</p></a></li>
<li><a href='#growth'>
<p>Berkeley Growth Study data.</p></a></li>
<li><a href='#HDCurves'><p>R wrapper that accesses C code to fit hierarchical model for derivative curves based on sequence of quotient differences</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Hierarchical Derivative Curve Estimation</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.2</td>
</tr>
<tr>
<td>Description:</td>
<td>A procedure that fits derivative curves based on a sequence of quotient differences.  In a hierarchical setting the package produces estimates of subject-specific and group-specific derivative curves.  In a non-hierarchical setting the package produces a single derivative curve.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL]</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-03-30 05:17:01 UTC; gpage</td>
</tr>
<tr>
<td>Author:</td>
<td>Garritt L. Page [aut, cre],
  Maria Xose Rodriguez-Alvarez [aut],
  Dae-Jin Lee [ctb],
  S. McKay Curtis [ctb],
  Radford M. Neal Neal [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Garritt L. Page &lt;page@stat.byu.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-03-30 06:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='emp_deriv'>Estimate of empirical derivative based on sequence of quotient differences.</h2><span id='topic+emp_deriv'></span>

<h3>Description</h3>

<p><code>emp_deriv</code> Provides an estimate of an empirical derivative curve using one of the two sequence of quotient differences detailed in Page, Rodriguez-Alvarez, Lee (2020).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>emp_deriv(y, t, D, u, ztype = 0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="emp_deriv_+3A_y">y</code></td>
<td>
<p>numeric vector (response variable).</p>
</td></tr>
<tr><td><code id="emp_deriv_+3A_t">t</code></td>
<td>
<p>numeric vector (time variable).</p>
</td></tr>
<tr><td><code id="emp_deriv_+3A_d">D</code></td>
<td>
<p>integer indicating the bin width when estimating empirical derivatives</p>
</td></tr>
<tr><td><code id="emp_deriv_+3A_u">u</code></td>
<td>
<p>real indicating the bandwidth with regards to smoothing when estimating empirical derivatives.</p>
</td></tr>
<tr><td><code id="emp_deriv_+3A_ztype">ztype</code></td>
<td>
<p>integer indicating which sequence of empirical derivatives will be employed.  (<code>0</code> indicates that which is parameterized by D and u while <code>1</code> indicates that which is parametrized by u)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of the same length as the input variable &quot;y&quot; that contains empirical derivative estimates for each entry of &quot;y&quot;.
</p>


<h3>References</h3>

<p>Page, G. L.; Rodriguez-Alvarez, M. X.; Lee, DJ; (2020)  &ldquo;Bayesian Hierarchical Modeling of Growth Curve Derivatives via Sequences of Quotient Differences&rdquo; Journal of the Royal Statistical Society: Series C 69(2) 459-481
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  # Our R-package
  library(HDCurves)

  data(growth)

  y &lt;- growth$hgtm[,1]
  t &lt;- growth$age

  fprime &lt;- emp_deriv(y=y, t=t, D=10, u=1, ztype=0)

  plot(t,y, type="b")
  plot(t, fprime, type="b")

</code></pre>

<hr>
<h2 id='growth'>
Berkeley Growth Study data.
</h2><span id='topic+growth'></span>

<h3>Description</h3>

<p>A list containing the heights of 39 boys and 54 girls from age 1 to 18
and the ages at which they were collected.
</p>


<h3>Format</h3>

<p>This list contains the following components:
</p>

<dl>
<dt>hgtm</dt><dd>
<p>a 31 by 39 numeric matrix giving the heights in centimeters of
39 boys at 31 ages.
</p>
</dd>
<dt>hgtf</dt><dd>
<p>a 31 by 54 numeric matrix giving the heights in centimeters of
54 girls at 31 ages.
</p>
</dd>
<dt>age</dt><dd>
<p>a numeric vector of length 31 giving the ages at which the
heights were measured.
</p>
</dd>
</dl>



<h3>Details</h3>

<p>These data are included here for convenience as they are also available
in the &quot;fda&quot; R-package.
</p>


<h3>Source</h3>

<p>Ramsay, James O., and Silverman, Bernard W. (2006,ISBN 978-0-387-22751-1), <em>Functional
Data Analysis, 2nd ed.</em>, Springer, New York.
</p>
<p>Ramsay, James O., and Silverman, Bernard W. (2002, ISBN 978-0-387-22465-7), <em>Applied
Functional Data Analysis</em>, Springer, New York, ch. 6.
</p>
<p>Tuddenham, R. D., and Snyder, M. M. (1954) &quot;Physical growth of
California boys and girls from birth to age 18&quot;, <em>University of
California Publications in Child Development</em>, 1, 183-364.
</p>
<p>Ramsay, James O., Wickham, Hadley, Graves, Spencer, and Hooker, Giles (2018)&lt;https://CRAN.R-project.org/package=fda&gt;,
<em>fda: Functional Data Analysis</em>,R package version 2.4.8,
</p>

<hr>
<h2 id='HDCurves'>R wrapper that accesses C code to fit hierarchical model for derivative curves based on sequence of quotient differences</h2><span id='topic+HDCurves'></span>

<h3>Description</h3>

<p><code>HDCurves</code> is the main function used to fit the the hierarchical model for derivative curves. This function also fits single derivative curves.  Derivative curves are estimated based on a sequence of empirical derivatives.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HDCurves(y, t, trt, ids, balanced = TRUE, tpred = NULL, ztype = 0,
  p = 0.5, au = 1, bu = 1, A = 2, as = 1, bs = 1, atau = 1,
  btau = 1/0.005, ndx = 10, q = 3, verbose = FALSE, draws = 1100,
  burn = 100, thin = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="HDCurves_+3A_y">y</code></td>
<td>
<p>numeric vector (response variable).  Must be in long format.</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_t">t</code></td>
<td>
<p>numeric vector (time variable). Must be in long format.</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_trt">trt</code></td>
<td>
<p>numeric vector indicating to which treatment each subject belongs.  The length of this vector is the same as &quot;y&quot; and &quot;t&quot; and must begin with 1.  The remaining treatment labels must form a contiguous sequence of integers.  See example below.</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_ids">ids</code></td>
<td>
<p>numeric vector containing subject id number.  The length of this vector is the same as &quot;y&quot; and &quot;t&quot;.  Subject id numbers must begin with 1 and subsequent subject id numbers need to remain a contiguous sequence of integers.  See example below.</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_balanced">balanced</code></td>
<td>
<p>logical with <code>TRUE</code> corresponding to a balanced case, and <code>FALSE</code> to an unbalanced case</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_tpred">tpred</code></td>
<td>
<p>numeric (time points for prediction).  If not supplied, the predictions at each observed time point are returned for subject-specific derivative curves.  For treatment-specific derivative curves a sequence of time points is produced based on the mininum and maximum observed time points.</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_ztype">ztype</code></td>
<td>
<p>integer indicating which sequence of empirical derivatives will be employed.  (<code>0</code> indicates that which is parameterized by D and u while <code>1</code> indicates that which is parametrized by u)</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_p">p</code></td>
<td>
<p>prior parameter for D, default is 0.5.  This value is not used if ztype=1.</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_au">au</code></td>
<td>
<p>shape prior parameter for u, default is 1</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_bu">bu</code></td>
<td>
<p>scale prior parameter for u, default is 1</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_a">A</code></td>
<td>
<p>parameter that defines upper bound for lambda.  Default is 2.  This parameter is not used in the case that a single derivative curve is being estimated.</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_as">as</code></td>
<td>
<p>shape prior parameter associated with subject-specific variance (sigma2), default is 1</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_bs">bs</code></td>
<td>
<p>rate prior parameter associated with subject-specific variance (sigma2), default is 1</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_atau">atau</code></td>
<td>
<p>shape prior parameter associated with penalty parameter (tau2), default is 1</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_btau">btau</code></td>
<td>
<p>rate prior parameter associated with penalty parameter (tau2), default is 1/0.005</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_ndx">ndx</code></td>
<td>
<p>number of segments (default is 10)</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_q">q</code></td>
<td>
<p>degree of the B-spline (default is 3)</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_verbose">verbose</code></td>
<td>
<p>If TRUE, then details associated with data being fit are printed to screen along with MCMC iterate counter</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_draws">draws</code></td>
<td>
<p>number of MCMC iterates to be collected. default is 1100</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_burn">burn</code></td>
<td>
<p>number of MCMC iterates discared as burn-in. default is 100</p>
</td></tr>
<tr><td><code id="HDCurves_+3A_thin">thin</code></td>
<td>
<p>number by which the MCMC chain is thinne. default is 1</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing arrays filled with MCMC iterates corresponding to model parameters, sequence of empirical derivatives, and derivative curves.  In order to provide more detail, in what follows let
</p>
<p>&quot;T&quot; - be the number of MCMC iterates collected,
</p>
<p>&quot;M&quot; - be the number of subjects,
</p>
<p>&quot;N&quot; - be the total number of measured responses,
</p>
<p>&quot;K&quot; - be the maximum number of observations measured across the M subjects,
</p>
<p>&quot;V&quot; - the number of prediction points in the user supplied vector tpred,
</p>
<p>&quot;P&quot; - the number of P-spline basis coefficients, and
</p>
<p>&quot;G&quot; - the number of treatment groups.
</p>
<p>The output list contains the following
</p>
<table>
<tr><td><code>z</code></td>
<td>
<p>an array of dimension (K, M, T) containing MCMC iterates associated with sequence of empirical derivatives for each subject. In the case of an unbalanced design, for subjects with less than K observations the values in the array beyond the number of measured responses for the subject are of no use.</p>
</td></tr>
<tr><td><code>beta</code></td>
<td>
<p>an array of dimension (M, P, T) containing MCMC iterates assocated with subject-specific B-spline basis coefficients.</p>
</td></tr>
<tr><td><code>tpred</code></td>
<td>
<p>vector of size V containing the prediction points supplied in the &quot;tpred&quot; argument of the function.</p>
</td></tr>
<tr><td><code>fprime</code></td>
<td>
<p>an array of dimension (V, M, T) if &quot;tpred&quot; is supplied or (K, M, T) if not that contains MCMC iterates associated with derivative curves for each subject. In the case of an unbalanced design and &quot;tpred&quot; not being supplied, for subjects with less than K observations the values in the array beyond the number of measured responses for the subject are of no use.</p>
</td></tr>
<tr><td><code>u</code></td>
<td>
<p>a matrix of dimension (T, M) containing MCMC interates associated with &quot;u&quot;.</p>
</td></tr>
<tr><td><code>d</code></td>
<td>
<p>a matrix of dimension (T, M) containing MCMC interates associated with &quot;d&quot;.  If ztype=1, then this array is of no use.</p>
</td></tr>
<tr><td><code>sig2</code></td>
<td>
<p>a matrix of dimension (T, M) containing MCMC interates associated with &quot;sigma2&quot;.</p>
</td></tr>
<tr><td><code>theta</code></td>
<td>
<p>an array of dimension (G, P, T) containing MCMC iterates associated with group-specific B-spline basis coefficients (&quot;theta&quot;). In the case of a single subject, this array is of no use.</p>
</td></tr>
<tr><td><code>fgprime</code></td>
<td>
<p>an array of dimension (V, M, T) if &quot;tpred&quot; is supplied or (K, M, T) if not that contains MCMC iterates associated with group-specific derivative curves.  In the case of a single subject, this array is of no use.</p>
</td></tr>
<tr><td><code>lam</code></td>
<td>
<p>a matrix of dimension (T, G) containing MCMC iterates associated with &quot;lambda&quot; the upper bound of &quot;sigma2&quot;. In the case of a single subject, this array is of no use.</p>
</td></tr>
<tr><td><code>tau2</code></td>
<td>
<p>a matrix of dimesino (T, G) containing MCMC iterates associated with &quot;tau2&quot; the penalty parameters the the P-spline specification.</p>
</td></tr>
<tr><td><code>HmatBySubject</code></td>
<td>
<p>an array that contains the basis design matrix for each subject.  If the study is balanced, then this is a single matrix of dimensino (M, P).  If the design is not balanced, this is a one-dimensional array of size P x (the total number of observations).</p>
</td></tr>
<tr><td><code>Htheta</code></td>
<td>
<p>a matrix of dimension (M, P) that contains the basis design matrix used for each treatment group.</p>
</td></tr>
</table>


<h3>References</h3>

<p>&ldquo;Bayesian Hierarchical Modeling of Growth Curve Derivatives via Sequences of Quotient Differences&rdquo; Journal of the Royal Statistical Society: Series C 69(2) 459-481
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  # Our R-package
  library(HDCurves)

  data(growth)

  nmale &lt;- ncol(growth$hgtm)
  nfemale &lt;- ncol(growth$hgtf)
  ntime &lt;- nrow(growth$hgtf)

  dat &lt;- data.frame(age=rep(growth$age, nmale + nfemale),
        height = c(growth$hgtm, growth$hgtf),
        tmt = c(rep(1, nmale*ntime),
                rep(2, nfemale*ntime)),
        case = rep(1:(nmale+nfemale), each=ntime))


  ############
  # MCMC Specs
  ############
  ni &lt;- 20000
  nb &lt;- 10000
  nt &lt;- 10
  nout &lt;- (ni - nb)/nt

  # B-spline details
  ndx &lt;- 40  	# number of segments (inner knots)
  bdeg &lt;- 3 	# Degree of the B-spline
  tt &lt;- sort(unique(dat$age))

  
  # This takes about 5 minutes to run
  date();
  fit &lt;- HDCurves(y = dat$height, t = dat$age, tpred = tt, trt = dat$tmt,
                  ids = dat$case, ztype = 0,  p = 0.9, A = 1,  au = 1, bu = 1,
                  as = 1, bs = 1, atau = 1, btau = 1/0.5, ndx = ndx, q = bdeg,
                  balanced = TRUE,draws=ni, burn=nb, thin=nt)
  date();

  # subject-specific derivative curve means
  fpmn &lt;- apply(fit$fprime,c(1,2),mean)


  # group-specific derivative curve means
  gfpmn &lt;- apply(fit$fgprime,c(1,2),mean)
  gfpci &lt;- apply(fit$fgprime,c(1,2),
        function(x) quantile(x, c(0.0275, 0.975)))

  plot(tt,gfpmn[,1], type="n", ylim=range(c(gfpmn)),
      ylab="Height  Rate of Change", xlab="age",
      xaxp=c(2,18,n=8),cex.axis=1.45, cex.lab=1.45)
  lines(tt, gfpmn[,1], type='o', col='blue', pch=20)
  lines(tt, gfpci[1,,1],  col='blue', pch=20,lty=2)
  lines(tt, gfpci[2,,1],  col='blue', pch=20,lty=2)

  lines(tt, gfpmn[,2], type='o', col='red', pch=20)
  lines(tt, gfpci[1,,2],  col='red', pch=20,lty=2)
  lines(tt, gfpci[2,,2],  col='red', pch=20,lty=2)
  legend(x="topright", lty=1, pch=20, cex=1.45,
        legend=c("Girls","Boys"), col=c("red","blue"))
  

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
