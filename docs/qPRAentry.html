<!DOCTYPE html><html lang="en"><head><title>Help for package qPRAentry</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {qPRAentry}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#qPRAentry-package'><p>qPRAentry: Quantitative Pest Risk Assessment at the Entry Step</p></a></li>
<li><a href='#datatrade_EU'><p>Example Trade Data for the European Union</p></a></li>
<li><a href='#datatrade_NorthAm'><p>Example Trade Data for Northern America</p></a></li>
<li><a href='#load_csv'><p>Load a CSV file with automatic separator detection</p></a></li>
<li><a href='#ntrade'><p>Ntrade calculation</p></a></li>
<li><a href='#ntrade_app'><p>Shiny app for Ntrade</p></a></li>
<li><a href='#pathway_app'><p>Shiny app for pathway model</p></a></li>
<li><a href='#pathway_model'><p>Pathway model</p></a></li>
<li><a href='#plot_countries'><p>Plot values on a map at country level</p></a></li>
<li><a href='#plot_nuts'><p>Plot NUTS region values on a map</p></a></li>
<li><a href='#redist_iso'><p>Data redistribution to country subdivisions</p></a></li>
<li><a href='#redist_nuts'><p>Data redistribution to NUTS subdivisions</p></a></li>
<li><a href='#trade_data'><p>Prepare Trade Data</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Quantitative Pest Risk Assessment at the Entry Step</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Supports risk assessors in performing the entry step of the
    quantitative Pest Risk Assessment. It allows the estimation of the
    amount of a plant pest entering a risk assessment area (in terms of
    founder populations) through the calculation of the imported
    commodities that could be potential pathways of pest entry, and the
    development of a pathway model. Two 'Shiny' apps based on the
    functionalities of the package are included, that simplify the process
    of assessing the risk of entry of plant pests. The approach is based
    on the work of the European Food Safety Authority (EFSA PLH Panel et
    al., 2018) &lt;<a href="https://doi.org/10.2903%2Fj.efsa.2018.5350">doi:10.2903/j.efsa.2018.5350</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Imports:</td>
<td>bsplus, dplyr, DT, eurostat (&ge; 4.0.0), ggiraph, ggplot2,
giscoR (&ge; 0.6.0), memoise, purrr, sf, shiny, shinycssloaders,
shinyjs, shinyWidgets, stats, tidyr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-12-16 20:16:57 UTC; Usuario</td>
</tr>
<tr>
<td>Author:</td>
<td>Martina Cendoya <a href="https://orcid.org/0000-0002-0134-7781"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Maria Chiara Rosace
    <a href="https://orcid.org/0000-0002-7263-8228"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Martina Cendoya &lt;cendoya_marmar@gva.es&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-12-17 10:00:01 UTC</td>
</tr>
</table>
<hr>
<h2 id='qPRAentry-package'>qPRAentry: Quantitative Pest Risk Assessment at the Entry Step</h2><span id='topic+qPRAentry'></span><span id='topic+qPRAentry-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Supports risk assessors in performing the entry step of the quantitative Pest Risk Assessment. It allows the estimation of the amount of a plant pest entering a risk assessment area (in terms of founder populations) through the calculation of the imported commodities that could be potential pathways of pest entry, and the development of a pathway model. Two 'Shiny' apps based on the functionalities of the package are included, that simplify the process of assessing the risk of entry of plant pests. The approach is based on the work of the European Food Safety Authority (EFSA PLH Panel et al., 2018) <a href="https://doi.org/10.2903/j.efsa.2018.5350">doi:10.2903/j.efsa.2018.5350</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Martina Cendoya <a href="mailto:cendoya_marmar@gva.es">cendoya_marmar@gva.es</a> (<a href="https://orcid.org/0000-0002-0134-7781">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Maria Chiara Rosace <a href="mailto:mariachiara.rosace@unicatt.it">mariachiara.rosace@unicatt.it</a> (<a href="https://orcid.org/0000-0002-7263-8228">ORCID</a>)
</p>
</li></ul>


<hr>
<h2 id='datatrade_EU'>Example Trade Data for the European Union</h2><span id='topic+datatrade_EU'></span>

<h3>Description</h3>

<p>Simulated trade data for a commodity within the European Union (EU).
This dataset illustrates the trade and production flow of a commodity that could
serve as a potential pathway for the entry of a pest into EU countries, in yearly
time periods. It also includes simulated consumption data for the commodity at NUTS1 level.
This dataset serves as a reference for how the data should be structured and as
a basis for the examples included in the <a href="#topic+qPRAentry">qPRAentry</a> package to deal with the NUTS
code system
(<a href="https://ec.europa.eu/eurostat/web/nuts">Nomenclature of territorial units for statistics</a>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>datatrade_EU
</code></pre>


<h3>Format</h3>

<p>A list of four data frames:
</p>

<ul>
<li> <p><strong>extra_import</strong> <code style="white-space: pre;">&#8288; &#8288;</code> Data on imports from countries outside of the EU.
A data frame with 216 rows and 4 columns:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>reporter</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> NUTS0 code of the importing country.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>partner</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> ID of the exporting countries, coded
as "Extra_Total" for all external countries, and "CNTR_1", "CNTR_2",
"CNTR_3" to indicate individual non-EU countries where the pest is present.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>time_period</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Time period of trade, with values
2020 and 2021.</td>
</tr>
<tr>
 <td style="text-align: left;"> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>value</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Quantity of the commodity imported.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>
</li></ul>


<ul>
<li> <p><strong>intra_trade</strong> <code style="white-space: pre;">&#8288; &#8288;</code> Data on internal trade within EU member countries.
A data frame with 1404 rows and 4 columns:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>reporter</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> NUTS0 code of the importing country.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>partner</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> NUTS0 code of the exporting country.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>time_period</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Time period of trade, with values
2020 and 2021.</td>
</tr>
<tr>
 <td style="text-align: left;"> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>value</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Quantity of the commodity imported.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>
</li></ul>


<ul>
<li> <p><strong>internal_production</strong> <code style="white-space: pre;">&#8288; &#8288;</code> Data on the internal production of
the commodity within the EU. A data frame with 54 rows and 3 columns:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>reporter</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> NUTS0 code of the producing country.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>time_period</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Time period of trade, in years
(2020 and 2021).</td>
</tr>
<tr>
 <td style="text-align: left;"> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>value</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Quantity of the commodity produced.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>
</li></ul>


<ul>
<li> <p><strong>consumption_nuts1</strong> <code style="white-space: pre;">&#8288; &#8288;</code> Data on the consumption of the commodity
in the EU at NUTS1 level (administrative divisions). A data frame with 92 rows
and 2 columns:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>NUTS_ID</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> NUTS1 code of the administrative division.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>value</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Quantity of the commodity consumed.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>
</li></ul>


<hr>
<h2 id='datatrade_NorthAm'>Example Trade Data for Northern America</h2><span id='topic+datatrade_NorthAm'></span>

<h3>Description</h3>

<p>Simulated trade data for a commodity within Northern America.
This dataset illustrates the trade and production flow of a commodity that could
serve as a potential pathway for the entry of a pest into Northern American
countries. The data is organised in three-month periods within a year.
It also includes simulated consumption data of the commodity at at the level of
principal sub-national divisions (ISO 3166-2 codes).
This dataset serves as a reference on how the data should be structured and provides
the basis for the examples included in the <a href="#topic+qPRAentry">qPRAentry</a> package to deal with the ISO
3166 code system
(<a href="https://www.iso.org/iso-3166-country-codes.html">ISO 3166 Maintenance Agency</a>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>datatrade_NorthAm
</code></pre>


<h3>Format</h3>

<p>A list of four data frames:
</p>

<ul>
<li> <p><strong>extra_import</strong> <code style="white-space: pre;">&#8288; &#8288;</code> Data on imports from countries outside of
Northern America. A data frame with 100 rows and 4 columns:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>reporter</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> ISO 3166-1 alpha-2 code of the importing country.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>partner</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> ID of the exporting country, coded as
"CNTR_1" to "CNTR_5" to represent specific  non-Northern American countries.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>time_period</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Time period of trade, in three-month
periods ("January-March", "April-June", "July-September", "October-December").</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>value</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Quantity of the commodity imported.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>
</li></ul>


<ul>
<li> <p><strong>intra_trade</strong> <code style="white-space: pre;">&#8288; &#8288;</code> Data on internal trade within Northern American countries.
A data frame with 80 rows and 4 columns:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>reporter</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> ISO 3166-1 alpha-2 code of the importing
country.</td>
</tr>
<tr>
 <td style="text-align: left;"> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>partner</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> ISO 3166-1 alpha-2 code  of the exporting
country.</td>
</tr>
<tr>
 <td style="text-align: left;"> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>time_period</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Time period of trade, in three-month
periods ("January-March", "April-June", "July-September", "October-December").</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>value</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Quantity of the commodity imported.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>
</li></ul>


<ul>
<li> <p><strong>internal_production</strong> <code style="white-space: pre;">&#8288; &#8288;</code> Data on the internal production of the commodity
within Northern America. A data frame with 20 rows and 3 columns:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>reporter</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> ISO 3166-1 alpha-2 code of the producing
country.</td>
</tr>
<tr>
 <td style="text-align: left;"> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>time_period</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Time period of trade, in three-month
periods ("January-March", "April-June", "July-September", "October-December").</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>value</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Quantity of the commodity produced.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>
</li></ul>


<ul>
<li> <p><strong>consumption_iso2</strong> <code style="white-space: pre;">&#8288; &#8288;</code> Data on the consumption of the commodity in
Northern America at ISO 3166-2 level (principal subdivisions of countries).
A data frame with 83 rows and 2 columns:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>iso_3166_2</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> ISO 3166-2 code of the subdivision.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>value</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Quantity of the commodity consumed.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>
</li></ul>


<hr>
<h2 id='load_csv'>Load a CSV file with automatic separator detection</h2><span id='topic+load_csv'></span>

<h3>Description</h3>

<p>Reads CSV files containing more than one column of
data. It automatically detects common separators (i.e., comma, semicolon, tab),
while allowing users to specify encoding and decimal separators as required.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>load_csv(filepath, dec = ".", encoding = getOption("encoding"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="load_csv_+3A_filepath">filepath</code></td>
<td>
<p>A string specifying the path to the CSV file (.csv extension).</p>
</td></tr>
<tr><td><code id="load_csv_+3A_dec">dec</code></td>
<td>
<p>A character specifying the decimal separator to use.
Default is &quot;.&quot; (period).</p>
</td></tr>
<tr><td><code id="load_csv_+3A_encoding">encoding</code></td>
<td>
<p>A string specifying the encoding of the file. Default is the native
system encoding set by <code>getOption("encoding")</code>. For more details on encoding
see <a href="base.html#topic+file">file</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame containing the data from the CSV file.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># file path
fpath &lt;- system.file("extdata", "data_ex.csv", package="qPRAentry")
# Load a CSV file
df &lt;- load_csv(fpath) 
head(df) # value as character
# Load a CSV file with comma separated decimals
df &lt;- load_csv(fpath, dec = ",") # value as numeric

</code></pre>

<hr>
<h2 id='ntrade'>Ntrade calculation</h2><span id='topic+ntrade'></span>

<h3>Description</h3>

<p>Calculates the quantity of potentially infested imported commodity
(<code class="reqn">N_{trade}</code>) from third countries where the pest is present, based on the
provided trade data (<code>TradeData</code> object output of the <code><a href="#topic+trade_data">trade_data()</a></code>
function).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ntrade(
  trade_data,
  filter_IDs = NULL,
  filter_period = NULL,
  summarise_result = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ntrade_+3A_trade_data">trade_data</code></td>
<td>
<p>An object of class <code>TradeData</code> that can be the output of
<code><a href="#topic+trade_data">trade_data()</a></code>.</p>
</td></tr>
<tr><td><code id="ntrade_+3A_filter_ids">filter_IDs</code></td>
<td>
<p>A vector containing the country IDs to filter (identification codes
of the countries of interest). By default, it is set to <code>NULL</code>, meaning all
<code>reporter</code> countries in the data frames will be considered.</p>
</td></tr>
<tr><td><code id="ntrade_+3A_filter_period">filter_period</code></td>
<td>
<p>A vector specifying the time periods to filter, based on
the <code>time_period</code> column. By default, it is set to <code>NULL</code>, meaning
all time periods in the data frames will be considered.</p>
</td></tr>
<tr><td><code id="ntrade_+3A_summarise_result">summarise_result</code></td>
<td>
<p>A character vector specifying functions to summarise the
<code class="reqn">N_{trade}</code> result for the selected time periods (<code>filter_period</code>).
It accepts the expressions <code>"mean"</code> for the mean, <code>"sd"</code> for the standard
deviation, <code>"median"</code> for the median value and <code>"quantile(p)"</code> where
<code>p</code> is the probability for the quantiles to the given probabilities. See examples.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The calculation of <code class="reqn">N_{trade_i}</code> for each country of interest <code class="reqn">i</code>
is based on the equation:
</p>
<p style="text-align: center;"><code class="reqn">N_{trade_i} = ExtraPest_i - ExtraPest_i \sum_{j \neq i} R_{ij} + 
\sum_{j \neq i} ExtraPest_j R_{ji},</code>
</p>

<p>where:
</p>

<ul>
<li> <p><code class="reqn">N_{trade_i}</code>: quantity of commodity from third countries remaining in
country <code class="reqn">i</code>, taking into account the direct importation from third countries
where the pest is present, the re-exportation to other countries of interest,
and the indirect importation of the commodity from other countries of interest.
</p>
</li>
<li> <p><code class="reqn">ExtraPest_i</code> and <code class="reqn">ExtraPest_j</code>: quantity of commodity imported by
country <code class="reqn">i</code> and country <code class="reqn">j</code> from third countries where the pest is present
(direct import), during the period of time considered.
</p>
</li>
<li> <p><code class="reqn">R_{ij}</code> and <code class="reqn">R_{ji}</code>: proportion of intra-regional trade relative
to the total available quantity in the exporting country defined as:
</p>
<p style="text-align: center;"><code class="reqn">R_{ij} = IntraExp_{ij}/(IP_i + ExtraTotal_i), \\
R_{ji} = IntraExp_{ji}/(IP_j + ExtraTotal_j).</code>
</p>

<p>Specifically, <code class="reqn">R_{ij}</code> indicates the proportion of the commodity that is exported
from country <code class="reqn">i</code> to country <code class="reqn">j</code> (<code class="reqn">IntraExp_{ij}</code>), while <code class="reqn">R_{ji}</code>
indicates the proportion exported from country <code class="reqn">j</code> to country <code class="reqn">i</code> (<code class="reqn">IntraExp_{ji}</code>),
in both cases out of the total available commodity in the exporter country. The total
available quantity is considered as tha sum of the internal production of the country
(<code class="reqn">IP</code>) and the total quantity imported from third countries (<code class="reqn">ExtraTotal</code>).
Thus, the quantity of <code class="reqn">ExtraPest_i</code> re-exported from country <code class="reqn">i</code> to all countries
<code class="reqn">j</code> is approximated by <code class="reqn">ExtraPest_i \sum_{j \neq i} R_{ij}</code>, and the quantity
of <code class="reqn">ExtraPest_j</code> re-exported from all countries <code class="reqn">j</code> to country <code class="reqn">i</code> as
<code class="reqn">\sum_{j \neq i} ExtraPest_j R_{ji}</code>.
</p>
</li></ul>



<h3>Value</h3>

<p>A data frame with the quantity of commodity imported by each country of interest
(<code>country_IDs</code>) from countries or regions where the pest is present. The result
is returned for each time period if <code>summarise_result</code> is not specified
(default is <code>NULL</code>). If a summary function is specified, the result will be
summarised accordingly.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+trade_data">trade_data()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Example with simulated trade data for Northern America
library(dplyr)
data("datatrade_NorthAm")
# Total extra-import data: data contains imports from 5 third countries (column partner). 
extra_total &lt;- datatrade_NorthAm$extra_import
# Extra-import data from countries where the pest is present (e.g., CNTR_1 and CNTR_2)
CNTR_pest &lt;- c("CNTR_1", "CNTR_2")
extra_pest &lt;- datatrade_NorthAm$extra_import %&gt;% filter(partner%in%CNTR_pest)
# Intra-trade data
intra_trade  &lt;- datatrade_NorthAm$intra_trade
# Internal production data
internal_production  &lt;- datatrade_NorthAm$internal_production
# Generate trade data (TradeData object)
trade_NorthAm &lt;- trade_data(extra_total = extra_total,
                            extra_pest = extra_pest,
                            intra_trade = intra_trade,
                            internal_production = internal_production)
# Calculation of the Ntrade for each time period
ntrade_NorthAm &lt;- ntrade(trade_data = trade_NorthAm)
head(ntrade_NorthAm)
# Ntrade summary for the time periods
ntrade_NorthAm_summary &lt;- ntrade(trade_data = trade_NorthAm,
                                 summarise_result = c("mean", "sd", 
                                                      "quantile(0.025)", 
                                                      "median",
                                                      "quantile(0.975)"))
head(ntrade_NorthAm_summary)
# Plot the median of Ntrade
library(ggplot2)
plot_countries(data = ntrade_NorthAm_summary,
               iso_col = "country_IDs", 
               values_col = "median") +
  xlim(-180,-20) + ylim(0,90)

## Example with simulated trade data for Europe 
# Load data
data("datatrade_EU")
# Total extra-import data: the total import is identified as partner "Extra_Total"
extra_total &lt;- datatrade_EU$extra_import %&gt;% filter(partner=="Extra_Total")
# Extra-import data from countries where the pest is present
extra_pest &lt;- datatrade_EU$extra_import %&gt;% filter(partner!="Extra_Total")
# Intra-trade data
intra_trade  &lt;- datatrade_EU$intra_trade
# Internal production data
internal_production  &lt;- datatrade_EU$internal_production
# Generate trade data (TradeData object)
trade_EU &lt;- trade_data(extra_total = extra_total,
                       extra_pest = extra_pest,
                       intra_trade = intra_trade,
                       internal_production = internal_production)
# Ntrade mean and sd for the time periods
ntrade_EU &lt;- ntrade(trade_data = trade_EU,
                    summarise_result = c("mean", "sd"))
# Plot Ntrade mean
plot_countries(data = ntrade_EU, 
               iso_col="country_IDs", 
               values_col="mean") +
  xlim(-40,50) + ylim(25,70)
# Ntrade for selected countries and a specific time period
# Sample 5 countries from trade data
country_IDs &lt;- sample(unique(trade_EU$total_trade$country_IDs), 5)
ntrade_EU_s &lt;- ntrade(trade_data = trade_EU,
                      filter_IDs = country_IDs,
                      filter_period = 2020)
head(ntrade_EU_s)
# Plot Ntrade result
plot_countries(data = ntrade_EU_s, 
               iso_col="country_IDs", 
               values_col="Ntrade_2020") +
  xlim(-40,50) + ylim(25,70)

</code></pre>

<hr>
<h2 id='ntrade_app'>Shiny app for Ntrade</h2><span id='topic+ntrade_app'></span>

<h3>Description</h3>

<p>Interactive application for the calculation and redistribution of the potentially
infected/infested quantity of commodities imported by a country from third countries
where the pest is present (<code class="reqn">N_{trade}</code>) using the NUTS coding system. See
<a href="https://ec.europa.eu/eurostat/web/nuts">Nomenclature of territorial units for statistics</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ntrade_app()
</code></pre>


<h3>Value</h3>

<p>No return value, called for side effects
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ntrade">ntrade()</a></code>, <code><a href="#topic+redist_nuts">redist_nuts()</a></code>, <code><a href="#topic+redist_iso">redist_iso()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if (interactive()) {
ntrade_app()
}
</code></pre>

<hr>
<h2 id='pathway_app'>Shiny app for pathway model</h2><span id='topic+pathway_app'></span>

<h3>Description</h3>

<p>Interactive application to estimate the number of potential founder populations (<code class="reqn">NPFP</code>)
of a pest in different regions or countries using the NUTS
coding system. See
<a href="https://ec.europa.eu/eurostat/web/nuts">Nomenclature of territorial units for statistics</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pathway_app()
</code></pre>


<h3>Value</h3>

<p>No return value, called for side effects
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pathway_model">pathway_model()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if (interactive()) {
pathway_app()
}
</code></pre>

<hr>
<h2 id='pathway_model'>Pathway model</h2><span id='topic+pathway_model'></span>

<h3>Description</h3>

<p>Estimates the number of potential founder populations (<code class="reqn">NPFP</code>) of a pest
in different regions, using <code class="reqn">N_{trade}</code> data combined with additional user-defined
parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pathway_model(
  ntrade_data,
  IDs_col,
  values_col,
  expression,
  parameters,
  niter = 100
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pathway_model_+3A_ntrade_data">ntrade_data</code></td>
<td>
<p>A data frame with the quantity of potentially infested commodities
imported from third countries where the pest is present (<code class="reqn">N_{trade}</code>).
It can be calculated using the <code><a href="#topic+ntrade">ntrade()</a></code> function.</p>
</td></tr>
<tr><td><code id="pathway_model_+3A_ids_col">IDs_col</code></td>
<td>
<p>A string specifying the column name in <code>ntrade_data</code> with the
country or region IDs of interest. See details on
<strong>IDs - country or region identification codes</strong>.</p>
</td></tr>
<tr><td><code id="pathway_model_+3A_values_col">values_col</code></td>
<td>
<p>A string specifying the column name in <code>ntrade_data</code> with
the <code class="reqn">N_{trade}</code> values (quantity of potentially infested commodity imports)
to be used in the pathway model.</p>
</td></tr>
<tr><td><code id="pathway_model_+3A_expression">expression</code></td>
<td>
<p>A string of characters representing the equation for the pathway model.
This expression must not include <code class="reqn">N_{trade}</code>, since it is added multiplicatively to the
entered equation by default. The resulting equation will be of the form:
</p>
<p style="text-align: center;"><code class="reqn">NPFP = N_{trade_i} \cdot \; ``expression"</code>
</p>
</td></tr>
<tr><td><code id="pathway_model_+3A_parameters">parameters</code></td>
<td>
<p>A named list specifying the distributions for each parameter
used in <code>expression</code>. Each element of the list must be another list containing:
</p>

<ul>
<li> <p><code>dist</code>: A string indicating the distribution name (e.g., &quot;norm&quot;, &quot;beta&quot;).
</p>
</li>
<li><p> Additional arguments required by the specified distribution (e.g., <code>mean</code>,
<code>sd</code> for &quot;norm&quot;).
</p>
</li></ul>

<p>See details on <strong>Parameter distributions</strong> for a list of available distributions
and examples on how to specify them.</p>
</td></tr>
<tr><td><code id="pathway_model_+3A_niter">niter</code></td>
<td>
<p>The number of iterations to generate random samples from the distributions.
The default is 100 iterations.</p>
</td></tr>
</table>


<h3>Details</h3>



<h4>IDs - country or region identification codes:</h4>

<p>The use of ISO 3166 (alpha-2) codes
(<a href="https://www.iso.org/iso-3166-country-codes.html">ISO 3166 Maintenance Agency</a>),
or NUTS codes in the case of European countries
<a href="https://ec.europa.eu/eurostat/web/nuts">Nomenclature of territorial units for statistics</a>,
as country or region identifiers (<code>IDs_col</code>) is recommended
for subsequent compatibility with other functions of the  <a href="#topic+qPRAentry">qPRAentry</a> package.
</p>



<h4>Parameter distributions:</h4>

<p>The following distributions are supported. For details on their parameters, refer
to the linked R documentation:
</p>

<table>
<tr>
 <td style="text-align: left;">
<strong>Distribution</strong> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"><strong>Documentation</strong> </td>
</tr>
<tr>
 <td style="text-align: left;">
"beta"    </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> <code><a href="stats.html#topic+rbeta">rbeta()</a></code> (Beta distribution) </td>
</tr>
<tr>
 <td style="text-align: left;">
"binom"   </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> <code><a href="stats.html#topic+rbinom">rbinom()</a></code> (Binomial distribution) </td>
</tr>
<tr>
 <td style="text-align: left;">
"cauchy"  </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> <code><a href="stats.html#topic+rcauchy">rcauchy()</a></code> (Cauchy distribution) </td>
</tr>
<tr>
 <td style="text-align: left;">
"chisq"   </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> <code><a href="stats.html#topic+rchisq">rchisq()</a></code> (Chi-squared distribution) </td>
</tr>
<tr>
 <td style="text-align: left;">
"exp"     </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> <code><a href="stats.html#topic+rexp">rexp()</a></code> (Exponential distribution) </td>
</tr>
<tr>
 <td style="text-align: left;">
"f"       </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> <code><a href="stats.html#topic+rf">rf()</a></code> (F distribution) </td>
</tr>
<tr>
 <td style="text-align: left;">
"gamma"   </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> <code><a href="stats.html#topic+rgamma">rgamma()</a></code> (Gamma distribution) </td>
</tr>
<tr>
 <td style="text-align: left;">
"geom"    </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> <code><a href="stats.html#topic+rgeom">rgeom()</a></code> (Geometric distribution) </td>
</tr>
<tr>
 <td style="text-align: left;">
"lnorm"   </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> <code><a href="stats.html#topic+rlnorm">rlnorm()</a></code> (Log-normal distribution) </td>
</tr>
<tr>
 <td style="text-align: left;">
"nbinom"  </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> <code><a href="stats.html#topic+rnbinom">rnbinom()</a></code> (Negative Binomial distribution) </td>
</tr>
<tr>
 <td style="text-align: left;">
"norm"    </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> <code><a href="stats.html#topic+rnorm">rnorm()</a></code> (Normal distribution) </td>
</tr>
<tr>
 <td style="text-align: left;">
"pois"    </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> <code><a href="stats.html#topic+rpois">rpois()</a></code> (Poisson distribution) </td>
</tr>
<tr>
 <td style="text-align: left;">
"t"       </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> <code><a href="stats.html#topic+rt">rt()</a></code> (Student's t distribution) </td>
</tr>
<tr>
 <td style="text-align: left;">
"unif"    </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> <code><a href="stats.html#topic+runif">runif()</a></code> (Uniform distribution) </td>
</tr>
<tr>
 <td style="text-align: left;">
"weibull" </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> <code><a href="stats.html#topic+rweibull">rweibull()</a></code> (Weibull distribution) </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>For example, to specify a normal distribution with mean 0 and standard deviation 1:<br />
<code>list(dist = "norm", mean = 0, sd = 1)</code>
</p>
<p>Ensure that all parameters required by the chosen distribution are included.
</p>



<h3>Value</h3>

<p>A data frame with the statistics (mean, SD, minimum, first quartile,
median, third quartile, and maximum) resulting from the iterations of the <code class="reqn">NPFP</code>
for each country/region and for the total (i.e., the results for the set of all
countries/regions).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ntrade">ntrade()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Example using Northern American countries and ntrade simulated data
data("datatrade_NorthAm")
# Extract country IDs and simulate ntrade data
IDs &lt;- datatrade_NorthAm$internal_production$reporter
df &lt;- data.frame(IDs = IDs,
                 ntrade_values = abs(rnorm(length(IDs), 10000, 2000)))
# Expression for the pathway model using 3 parameters
eq &lt;- "(1/P1)*P2*P3"
# Distribution for each parameter
parameters &lt;- list(
  P1 = list(dist = "beta", shape1 = 0.5, shape2 = 1),
  P2 = list(dist = "gamma", shape = 1.5, scale = 100),
  P3 = list(dist = "lnorm", mean = 5, sd = 2)
)
# Run pathway_model()
res_pathway &lt;- pathway_model(ntrade_data = df,
                             IDs_col = "IDs",
                             values_col = "ntrade_values",
                             expression = eq,
                             parameters = parameters,
                             niter = 100)
head(res_pathway)
# summary of the total for all countries
res_pathway[res_pathway$IDs == "Total",]
# plot
plot_countries(res_pathway, "IDs", "Median")

</code></pre>

<hr>
<h2 id='plot_countries'>Plot values on a map at country level</h2><span id='topic+plot_countries'></span>

<h3>Description</h3>

<p>Plots country values on a map using data provided and allows
customisation of various aesthetics, such as colors, legend title, and title.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_countries(
  data,
  iso_col,
  values_col,
  colors = NULL,
  na_value = "grey",
  title = NULL,
  legend_title = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_countries_+3A_data">data</code></td>
<td>
<p>A data frame containing the values to be plotted on the map.</p>
</td></tr>
<tr><td><code id="plot_countries_+3A_iso_col">iso_col</code></td>
<td>
<p>A string specifying the column name in <code>data</code>
with the ISO 3166-1 (alpha-2) country codes. See
<a href="https://www.iso.org/iso-3166-country-codes.html">ISO 3166 Maintenance Agency</a>
for details on country codes.</p>
</td></tr>
<tr><td><code id="plot_countries_+3A_values_col">values_col</code></td>
<td>
<p>A string specifying the column name in <code>data</code> with the
values to be plotted.</p>
</td></tr>
<tr><td><code id="plot_countries_+3A_colors">colors</code></td>
<td>
<p>Optional vector of colors used in the gradient scale.</p>
</td></tr>
<tr><td><code id="plot_countries_+3A_na_value">na_value</code></td>
<td>
<p>Color for missing values (default is &quot;grey&quot;).</p>
</td></tr>
<tr><td><code id="plot_countries_+3A_title">title</code></td>
<td>
<p>A title for the plot (default is <code>NULL</code>).</p>
</td></tr>
<tr><td><code id="plot_countries_+3A_legend_title">legend_title</code></td>
<td>
<p>A title for the legend. Default <code>NULL</code>, name in the
<code>values_col</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Extracts an <code><a href="sf.html#topic+sf">sf</a></code> object from the <code><a href="giscoR.html#topic+giscoR-package">giscoR</a></code> package.
It uses the <code><a href="ggplot2.html#topic+ggplot2-package">ggplot2</a></code> package for the representation. Also, it supports the addition
of other <code><a href="ggplot2.html#topic+ggplot2-package">ggplot2</a></code> options (see examples).
</p>


<h3>Value</h3>

<p>A <code>ggplot</code> object with the plotted countries.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulated data trade in Northern America
data("datatrade_NorthAm")
# Mean of internal production for each country
library(dplyr)
data_plot &lt;- datatrade_NorthAm$internal_production %&gt;% 
  group_by(reporter) %&gt;% 
  summarise(mean_value = mean(value))

head(data_plot)

#Plot
pl &lt;- plot_countries(data = data_plot,
                     iso_col = "reporter",
                     values_col = "mean_value")
pl

# Changing colors and adding other ggplot2 options
library(ggplot2)
pl &lt;- plot_countries(data = data_plot,
                     iso_col = "reporter",
                     values_col = "mean_value",
                     colors = c("white", "lightblue", "darkblue"),
                     title = "Plot internal production",
                     legend_title = "units")
pl + 
  xlim(-170, -20) + ylim(10, 90) +
  theme_bw()
               
</code></pre>

<hr>
<h2 id='plot_nuts'>Plot NUTS region values on a map</h2><span id='topic+plot_nuts'></span>

<h3>Description</h3>

<p>Plots NUTS region values on a map using the provided data and allows
customisation of various aesthetics, such as colors, legend title, and title.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_nuts(
  data,
  nuts_col,
  values_col,
  nuts_level = 2,
  nuts_year = "2016",
  colors = NULL,
  na_value = "grey",
  title = NULL,
  legend_title = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_nuts_+3A_data">data</code></td>
<td>
<p>A data frame containing the values to be plotted on the map.</p>
</td></tr>
<tr><td><code id="plot_nuts_+3A_nuts_col">nuts_col</code></td>
<td>
<p>A string specifying the column name in <code>data</code> containing
NUTS codes.</p>
</td></tr>
<tr><td><code id="plot_nuts_+3A_values_col">values_col</code></td>
<td>
<p>A string specifying the column name in <code>data</code> with the
values to be plotted.</p>
</td></tr>
<tr><td><code id="plot_nuts_+3A_nuts_level">nuts_level</code></td>
<td>
<p>A numeric value (0, 1, 2, or 3) specifying the NUTS level to plot.
Default is 2 indicating NUTS2. See
<a href="https://ec.europa.eu/eurostat/web/nuts">Nomenclature of territorial units for statistics</a>.</p>
</td></tr>
<tr><td><code id="plot_nuts_+3A_nuts_year">nuts_year</code></td>
<td>
<p>Year of NUTS classification. Accepted values are '2003','2006',
'2010','2013','2016' (default),'2021', or '2024'. See
<a href="https://ec.europa.eu/eurostat/web/nuts/history">NUTS - History</a>.</p>
</td></tr>
<tr><td><code id="plot_nuts_+3A_colors">colors</code></td>
<td>
<p>Optional vector of colors used in the gradient scale.</p>
</td></tr>
<tr><td><code id="plot_nuts_+3A_na_value">na_value</code></td>
<td>
<p>Color for missing values (default is &quot;grey&quot;).</p>
</td></tr>
<tr><td><code id="plot_nuts_+3A_title">title</code></td>
<td>
<p>A title for the plot (default is <code>NULL</code>).</p>
</td></tr>
<tr><td><code id="plot_nuts_+3A_legend_title">legend_title</code></td>
<td>
<p>A title for the legend. Default <code>NULL</code>, name in the
<code>values_col</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Extracts an <code><a href="sf.html#topic+sf">sf</a></code> object from the <code><a href="giscoR.html#topic+giscoR-package">giscoR</a></code> package.
It uses the <code><a href="ggplot2.html#topic+ggplot2-package">ggplot2</a></code> package for the representation. Also, it supports the addition
of other <code><a href="ggplot2.html#topic+ggplot2-package">ggplot2</a></code> options (see examples).
</p>


<h3>Value</h3>

<p>A ggplot object with the plotted NUTS regions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Example plot at NUTS0 level (country level)
# Simulated data trade in European countries
data("datatrade_EU")
# Mean of internal production for each country
library(dplyr)
data_plot &lt;- datatrade_EU$internal_production %&gt;% 
  group_by(reporter) %&gt;% 
  summarise(mean_value = mean(value))

head(data_plot)

#Plot
pl &lt;- plot_nuts(data = data_plot,
                nuts_col = "reporter",
                values_col = "mean_value",
                nuts_level = 0)
pl

## Example plot at NUTS1 level (codes extracted from 'giscoR' package)
library(dplyr)
library(giscoR)
data_plot &lt;- gisco_get_nuts(nuts_level=1) %&gt;% 
  select(NUTS_ID) %&gt;% 
  # simulate values for each NUTS1
  mutate(values = abs(rnorm(nrow(.), 0, 1000)))

#Plot
pl &lt;- plot_nuts(data = data_plot,
                nuts_col = "NUTS_ID",
                values_col = "values",
                nuts_level = 1,
                colors = c("white", "lightblue", "darkblue"),
                title = "NUTS1",
                legend_title = "units")

# Changing colors and adding other ggplot2 options
library(ggplot2)
pl + 
  xlim(-40, 50) + ylim(20, 70) +
  theme_bw()

</code></pre>

<hr>
<h2 id='redist_iso'>Data redistribution to country subdivisions</h2><span id='topic+redist_iso'></span>

<h3>Description</h3>

<p>Value redistribution from country-level (i.e., ISO 3166-1 alpha-2 codes) to principal
subdivisions (i.e., ISO 3166-2 codes). See
<a href="https://www.iso.org/iso-3166-country-codes.html">ISO 3166 Maintenance Agency</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>redist_iso(
  data,
  iso_col,
  values_col,
  redist_data,
  redist_iso_col,
  redist_values_col
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="redist_iso_+3A_data">data</code></td>
<td>
<p>A data frame containing the data at the country-level to
redistribute.</p>
</td></tr>
<tr><td><code id="redist_iso_+3A_iso_col">iso_col</code></td>
<td>
<p>A string specifying the column name in <code>data</code>
with the ISO 3166-1 (alpha-2) country codes.</p>
</td></tr>
<tr><td><code id="redist_iso_+3A_values_col">values_col</code></td>
<td>
<p>A string or vector specifying the column name(s) in
<code>data</code> with the values to be redistributed.</p>
</td></tr>
<tr><td><code id="redist_iso_+3A_redist_data">redist_data</code></td>
<td>
<p>A data frame with values for each subdivision that will be
used as the basis for redistribution.</p>
</td></tr>
<tr><td><code id="redist_iso_+3A_redist_iso_col">redist_iso_col</code></td>
<td>
<p>A string specifying the column name in <code>redist_data</code>
that contains the destination ISO 3166-2 codes.</p>
</td></tr>
<tr><td><code id="redist_iso_+3A_redist_values_col">redist_values_col</code></td>
<td>
<p>A string specifying the column name in <code>redist_data</code>
with the values for proportional redistribution. This will define the weights
used for the redistribution.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function enables redistribution of values from country-level
to principal subdivisions (e.g., provinces or states), proportionally
to user-supplied redistribution proportions.
</p>
<p>Note that more than one column of values provided in the data frame data can be
redistributed at the same time. The values in columns <code>values_col</code> and
<code>redist_values_col</code> must be numeric and positive.
</p>


<h4>Common uses</h4>

<p>In the context of quantitative pest risk assessment (qPRA) at the entry step,
this function can be applied to redistribute the quantity of potentially infested
commodities (<code class="reqn">N_{trade}</code>, see <code><a href="#topic+ntrade">ntrade()</a></code>) or the number of potential
founder populations (<code class="reqn">NPFP</code>, see <code><a href="#topic+pathway_model">pathway_model()</a></code>). For this purpose,
human population or consumption data from subdivisions are often used for redistribution.
</p>



<h3>Value</h3>

<p>A data frame with the redistributed values across the specified subnational
level. The data frame contains the columns <code>ISO_1</code> with the codes at country
level, <code>ISO_2</code> with the codes at subdivision level, <code>proportion</code> with the
proportion according to which the values have been redistributed, and the columns
corresponding to the redistributed values with the same name specified in <code>values_col</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ntrade">ntrade()</a></code>, <code><a href="#topic+pathway_model">pathway_model()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Example of data redistribution in Northern American countries
data(datatrade_NorthAm)
# Selection of internal production data from January to March to be proportionally 
# redistributed based on sub-national consumption data
data_ip &lt;- datatrade_NorthAm$internal_production
data_ip &lt;- data_ip[data_ip$time_period=="January-March",]
# consumption data at sub-national level
data_sub &lt;- datatrade_NorthAm$consumption_iso2

# Redistribution
data_redist &lt;- redist_iso(data = data_ip,
                          iso_col = "reporter",
                          values_col = "value",
                          redist_data = data_sub,
                          redist_iso_col = "iso_3166_2",
                          redist_values_col = "value")

head(data_redist)

</code></pre>

<hr>
<h2 id='redist_nuts'>Data redistribution to NUTS subdivisions</h2><span id='topic+redist_nuts'></span>

<h3>Description</h3>

<p>Value redistribution from country-level (NUTS0) to smaller territories (i.e.,
NUTS1, NUTS2 or NUTS3). See
<a href="https://ec.europa.eu/eurostat/web/nuts">Nomenclature of territorial units for statistics</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>redist_nuts(
  data,
  nuts_col,
  values_col,
  to_nuts = 2,
  redist_data = "population",
  redist_nuts_col = NULL,
  redist_values_col = NULL,
  population_year = 2023,
  nuts_year = 2016
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="redist_nuts_+3A_data">data</code></td>
<td>
<p>A data frame containing the data at the country-level to
redistribute.</p>
</td></tr>
<tr><td><code id="redist_nuts_+3A_nuts_col">nuts_col</code></td>
<td>
<p>A string specifying the column name in <code>data</code>
with the NUTS0 codes.</p>
</td></tr>
<tr><td><code id="redist_nuts_+3A_values_col">values_col</code></td>
<td>
<p>A string or vector specifying the column name(s) in <code>data</code>
with the values to be redistributed.</p>
</td></tr>
<tr><td><code id="redist_nuts_+3A_to_nuts">to_nuts</code></td>
<td>
<p>A numeric value (1, 2, or 3) specifying the NUTS level for redistribution.
Default 2, indicating redistribution to NUTS2.</p>
</td></tr>
<tr><td><code id="redist_nuts_+3A_redist_data">redist_data</code></td>
<td>
<p>A data frame containing values for each subdivision that will be
used as the basis for proportional redistribution. By default, this is set to
<code>"population"</code>, indicating redistribution based on human population data from
<a href="https://ec.europa.eu/eurostat/databrowser/product/page/demo_r_pjangrp3">Eurostat</a>.</p>
</td></tr>
<tr><td><code id="redist_nuts_+3A_redist_nuts_col">redist_nuts_col</code></td>
<td>
<p>A string specifying the column name in <code>redist_data</code>
that contains the destination NUTS codes. The NUTS level should correspond to the
value specified in  <code>to_nuts</code>. <code>NULL</code> (default) if a data frame is not
incorporated in <code>redist_data</code> (i.e., <code>redist_data = "population"</code>).</p>
</td></tr>
<tr><td><code id="redist_nuts_+3A_redist_values_col">redist_values_col</code></td>
<td>
<p>A string specifying the column name in <code>redist_data</code>
with the values for proportional redistribution. These values will serve as the
weights for the redistribution process. <code>NULL</code> (default) if a data frame
is not incorporated in <code>redist_data</code> (i.e., <code>redist_data = "population"</code>).</p>
</td></tr>
<tr><td><code id="redist_nuts_+3A_population_year">population_year</code></td>
<td>
<p>A numeric value specifying the year(s) of the human population
data to be used for redistribution. Only necessary if <code>"population"</code> is specified in
<code>redist_data</code> (default is 2023). If multiple years are provided, the average
human population across those years will be used. Available years can be found at
<a href="https://ec.europa.eu/eurostat/databrowser/product/page/demo_r_pjangrp3">Eurostat</a>.</p>
</td></tr>
<tr><td><code id="redist_nuts_+3A_nuts_year">nuts_year</code></td>
<td>
<p>Year of NUTS classification. Accepted values are '2003','2006','2010','2013',
'2016' (default),'2021', or '2024'. See
<a href="https://ec.europa.eu/eurostat/web/nuts/history">NUTS - History</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function enables redistribution of values from national-level NUTS0
to smaller territorial units (i.e., NUTS1, NUTS2, or NUTS3), either proportionally
based on human population data from
<a href="https://ec.europa.eu/eurostat/databrowser/product/page/demo_r_pjangrp3">Eurostat</a>
or using user-supplied redistribution proportions.
Human population data for redistribution is automatically fetched for the specified time
period from the Eurostat database.
</p>
<p>Note that more than one column of values provided in the data frame <code>data</code>
can be redistributed at the same time. The values in columns <code>values_col</code>
and <code>redist_values_col</code> must be numeric and positive.
</p>


<h4>Common uses</h4>

<p>In the context of quantitative pest risk assessment (qPRA) at the entry step,
this function can be applied to redistribute the quantity of potentially infested
commodities (<code class="reqn">N_{trade}</code>, see <code><a href="#topic+ntrade">ntrade()</a></code>) or the number of potential
founder populations (<code class="reqn">NPFP</code>, see <code><a href="#topic+pathway_model">pathway_model()</a></code>). For this purpose,
human population or consumption data from subdivisions are often used for redistribution.
</p>



<h3>Value</h3>

<p>A data frame with the redistributed values across the specified NUTS
level. The data frame contains the columns <code>NUTSX</code> with the codes at the
selected NUTS level, <code>NUTS0</code> with the codes at country level, <code>proportion</code> with the
proportion according to which the values have been redistributed, and the columns
corresponding to the redistributed values with the same name specified in <code>values_col</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ntrade">ntrade()</a></code>, <code><a href="#topic+pathway_model">pathway_model()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Example of data redistribution to NUTS2 using human population data
data("datatrade_EU")
# extract NUTS0 codes (country level)
nuts0 &lt;- unique(datatrade_EU$internal_production$reporter)
# simulate values for each country
nuts0_data &lt;- data.frame(nuts0 = nuts0,
                         value = abs(rnorm(length(nuts0), 30000, 10000)))


# Redistribution
data_redist &lt;- redist_nuts(data = nuts0_data,
                           nuts_col = "nuts0",
                           values_col = "value",
                           to_nuts = 2,
                           redist_data = "population",
                           population_year = c(2017, 2018, 2019))
head(data_redist)

# Plot
plot_nuts(data = data_redist,
          nuts_level = 2,
          nuts_col = "NUTS2", 
          values_col = "value")


## Example of data redistribution to NUTS1 using custom data
# consumption data at NUTS1 level
nuts1_data &lt;- datatrade_EU$consumption_nuts1

# Redistribution
data_redist &lt;- redist_nuts(data = nuts0_data,
                           nuts_col = "nuts0",
                           values_col = "value",
                           to_nuts = 1,
                           redist_data = nuts1_data,
                           redist_nuts_col = "NUTS_ID",
                           redist_values_col = "value")

head(data_redist)

# Plot
plot_nuts(data = data_redist,
          nuts_level = 1,
          nuts_col = "NUTS1", 
          values_col = "value")

</code></pre>

<hr>
<h2 id='trade_data'>Prepare Trade Data</h2><span id='topic+trade_data'></span>

<h3>Description</h3>

<p>Prepares trade data for each country of interest based on the provided data.
Generates objects of class <code>TradeData</code> required to be used
in the <code><a href="#topic+ntrade">ntrade()</a></code> function of the <a href="#topic+qPRAentry">qPRAentry</a> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trade_data(
  extra_total,
  extra_pest,
  intra_trade,
  internal_production,
  filter_IDs = NULL,
  filter_period = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="trade_data_+3A_extra_total">extra_total</code></td>
<td>
<p>A data frame containing the total quantity of commodity imported
from third countries (pest-free and pest-present countries). It must contain the
following columns: <code>reporter</code> (importing country), <code>partner</code> (exporting country),
<code>value</code> (quantity of commodity) and <code>time_period</code> (time period of the trade activity).</p>
</td></tr>
<tr><td><code id="trade_data_+3A_extra_pest">extra_pest</code></td>
<td>
<p>A data frame containing the quantity of commodity imported
from third countries where the pest is present. It must contain the following columns:
<code>reporter</code> (importing country), <code>partner</code> (exporting country),
<code>value</code> (quantity of commodity) and <code>time_period</code> (time period of the trade activity).
The quantity of imported commodity detailed in this data frame must also be included
in the <code>extra_total</code> data frame.</p>
</td></tr>
<tr><td><code id="trade_data_+3A_intra_trade">intra_trade</code></td>
<td>
<p>A data frame containing the quantity of commodity traded between
countries of interest. It must contain the following columns:
<code>reporter</code> (importing country), <code>partner</code> (exporting country),
<code>value</code> (quantity of commodity) and <code>time_period</code> (time period of the trade activity).</p>
</td></tr>
<tr><td><code id="trade_data_+3A_internal_production">internal_production</code></td>
<td>
<p>A data frame containing the quantity of commodity
produced internally within each country of interest. It must contain the following columns:
<code>reporter</code> (producing country), <code>value</code> (quantity of commodity) and
<code>time_period</code> (time period of the production).</p>
</td></tr>
<tr><td><code id="trade_data_+3A_filter_ids">filter_IDs</code></td>
<td>
<p>A vector containing the country IDs to filter (identification codes
of the countries of interest). By default, it is set to <code>NULL</code>, meaning all
<code>reporter</code> countries in the data frames will be considered.</p>
</td></tr>
<tr><td><code id="trade_data_+3A_filter_period">filter_period</code></td>
<td>
<p>A vector specifying the time periods to filter, based on
the <code>time_period</code> column. By default, it is set to <code>NULL</code>, meaning
all time periods in the data frames will be considered.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function combines external imports from third countries, internal trade between
the countries of interest and internal production data. It calculates the total amount
of product available per country in each time period as the sum of external imports
(from pest-free and pest-present countries) and internal production.
</p>


<h4>IDs - country identification codes:</h4>

<p>For the IDs of the countries of interest (i.e., in the the columns
<code>reporter</code> of the four trade data frames and in the column <code>partner</code>
of <code>intra_trade</code>) it is recommended to use the the ISO 3166-1 (alpha-2) codes
(<a href="https://www.iso.org/iso-3166-country-codes.html">ISO 3166 Maintenance Agency</a>)
or NUTS0 codes in case of European countries
(<a href="https://ec.europa.eu/eurostat/web/nuts">Nomenclature of territorial units for statistics</a>)
for subsequent compatibility with other functions of the <a href="#topic+qPRAentry">qPRAentry</a> package.
</p>



<h4>Time periods:</h4>

<p>Time periods can be specified in any way, both numeric and character formatting is supported.
For example, it can be expressed as years, months, specific periods, seasons, etc.
</p>



<h4>Trade adjustments:</h4>

<p>Trade imbalances are adjusted, so that in case the internal export
for a given country exceeds the total quantity available in that country, the internal
export is recalculated proportionally based on the total available.
Missing values are treated as zeros.
</p>



<h3>Value</h3>

<p>An object of class <code>TradeData</code> is returned containing the following list of data frames:
</p>

<ul>
<li> <p><code>total_trade</code> <code style="white-space: pre;">&#8288; &#8288;</code> A data frame with one row for each ID and each time period with 9 variables:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>country_IDs</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> IDs of the countries of interest.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>time_period</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Time period.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>extra_total</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Total imports from third countries. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>extra_pest</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Imports from third countries where the pest of
interest is present.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>intra_import</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Internal import from the countries of
interest.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>intra_export</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Internal export to the countries of
interest.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>internal_production</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Internal production in the countries
of interest.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>total_available</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Total available quantity in the countries
of interest.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>export_prop</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Proportion of internal export to the total
available commodity. A value of 1 indicates that internal export is less than
or equal to the total available commodity; a value less than 1 [0, 1) indicates
that internal export exceeds the total available.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

</li></ul>


<ul>
<li> <p><code>intra_trade</code> <code style="white-space: pre;">&#8288; &#8288;</code> A data frame with values of trade commodity between
countries of interest:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>reporter</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Importing country ID.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>partner</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Exporting country ID.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>time_period</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Time period.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>value</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Quantity of the commodity traded.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>export_prop</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288; &#8288;</code> </td><td style="text-align: left;"> Proportion of internal export to the total
available commodity for each trading partner according to the proportion for
each partner (<code>export_prop</code> in <code>total_trade</code>).</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+load_csv">load_csv()</a></code>, <code><a href="#topic+ntrade">ntrade()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Example with simulated trade data for Northern America
library(dplyr)
# Load data
data("datatrade_NorthAm")
# Total extra-import data: data contains imports from 5 third countries (column partner). 
extra_total &lt;- datatrade_NorthAm$extra_import
# Extra-import data from countries where the pest is present (e.g., CNTR_1 and CNTR_2)
CNTR_pest &lt;- c("CNTR_1", "CNTR_2")
extra_pest &lt;- datatrade_NorthAm$extra_import %&gt;% filter(partner%in%CNTR_pest)
# Intra-trade data
intra_trade  &lt;- datatrade_NorthAm$intra_trade
# Internal production data
internal_production  &lt;- datatrade_NorthAm$internal_production
# Generate trade data (TradeData object)
trade_NorthAm &lt;- trade_data(extra_total = extra_total,
                            extra_pest = extra_pest,
                            intra_trade = intra_trade,
                            internal_production = internal_production)
head(trade_NorthAm$total_trade)
head(trade_NorthAm$intra_trade)
# Plot the total available quantity of commodity available in each country
library(ggplot2)
plot_countries(data = trade_NorthAm$total_trade,
               iso_col = "country_IDs", 
               values_col = "total_available") +
  xlim(-180,-20) + ylim(0,90)

## Example with simulated trade data for Europe 
# with selected countries and a specific time period
# Load data
data("datatrade_EU")
# Total extra-import data: the total import is identified as partner "Extra_Total"
extra_total &lt;- datatrade_EU$extra_import %&gt;% filter(partner=="Extra_Total")
# Extra-import data from countries where the pest is present
extra_pest &lt;- datatrade_EU$extra_import %&gt;% filter(partner!="Extra_Total")
# Intra-trade data
intra_trade  &lt;- datatrade_EU$intra_trade
# Internal production data
internal_production  &lt;- datatrade_EU$internal_production
# Sample 5 countries from data
filter_IDs &lt;- sample(unique(extra_total$reporter), 5)
# Generate trade data (TradeData object)
trade_EU &lt;- trade_data(extra_total = extra_total,
                       extra_pest = extra_pest,
                       intra_trade = intra_trade,
                       internal_production = internal_production,
                       filter_IDs = filter_IDs,
                       filter_period = 2020)
# Plot the total available quantity of commodity available in each country
plot_countries(data = trade_EU$total_trade, 
               iso_col = "country_IDs", 
               values_col = "total_available") +
  xlim(-30,50) + ylim(25,70)
  
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
