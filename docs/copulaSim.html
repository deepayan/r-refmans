<!DOCTYPE html><html><head><title>Help for package copulaSim</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {copulaSim}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#compare.copula.sim'><p>Performing the comparison between empirical data and multiple simulated datasets.</p></a></li>
<li><a href='#copula.sim'><p>To generate simulated datasets from empirical data by utilizing the copula invariance property.</p></a></li>
<li><a href='#copulaSim-package'><p>copulaSim: Virtual Patient Simulation by Copula Invariance Property</p></a></li>
<li><a href='#data.diff.test'><p>Performing the hypothesis test to compare the difference between the empirical data and the simulated data</p></a></li>
<li><a href='#ecdf.inv'><p>Obtaining the inverse of marginal empirical cumulative distribution (ECDF)</p></a></li>
<li><a href='#extract.data.sim'><p>Converting data.simul in a copula.sim object into a list of wide-form matrices</p></a></li>
<li><a href='#new.arm.copula.sim'><p>Simulating new multivariate datasets with shifted mean vector from existing empirical data</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Virtual Patient Simulation by Copula Invariance Property</td>
</tr>
<tr>
<td>Version:</td>
<td>0.0.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-08-06</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Pei-Shan Yen &lt;peishan0824@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>To optimize clinical trial designs and data analysis methods consistently through trial simulation, we need to simulate multivariate mixed-type virtual patient data independent of designs and analysis methods under evaluation. To make the outcome of optimization more realistic, relevant empirical patient level data should be utilized when it’s available. However, a few problems arise in simulating trials based on small empirical data, where the underlying marginal distributions and their dependence structure cannot be understood or verified thoroughly due to the limited sample size. To resolve this issue, we use the copula invariance property, which can generate the joint distribution without making a strong parametric assumption. The function copula.sim can generate virtual patient data with optional data validation methods that are based on energy distance and ball divergence measurement. The function compare.copula.sim can conduct comparison of marginal mean and covariance of simulated data. To simulate patient-level data from a hypothetical treatment arm that would perform differently from the observed data, the function new.arm.copula.sim can be used to generate new multivariate data with the same dependence structure of the original data but with a shifted mean vector.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr (&ge; 1.0.0), magrittr (&ge; 1.5), mvtnorm (&ge; 1.0-12),
rlang, stats, tibble, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>rmarkdown, knitr, ggplot2, testthat (&ge; 3.1.1), Ball (&ge;
1.3.0), energy (&ge; 1.7-0),</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/psyen0824/copulaSim">https://github.com/psyen0824/copulaSim</a></td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-08-18 01:47:02 UTC; pyen2</td>
</tr>
<tr>
<td>Author:</td>
<td>Pei-Shan Yen <a href="https://orcid.org/0000-0001-7386-0552"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Xuemin Gu [ctb],
  Jenny Jiao [ctb],
  Jane Zhang [ctb]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-08-19 12:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='compare.copula.sim'>Performing the comparison between empirical data and multiple simulated datasets.</h2><span id='topic+compare.copula.sim'></span>

<h3>Description</h3>

<p>Performing the comparison between empirical data and multiple simulated datasets.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compare.copula.sim(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="compare.copula.sim_+3A_object">object</code></td>
<td>
<p>A copula.sim object for the comparison.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returned the comparison of marginal parameter and covariance.
</p>

<ol>
<li><p> mean.comparison: comparison between empirical marginal mean and average value of simulated marginal mean.
(1) simu.mean: average value of simulated mean
(2) simu.sd: average value of simulated standard error
(3) simu.mean.low.lim: lower limit of 95% percentile confidence interval
(4) simu.mean.upp.lim: upper limit of 95% percentile confidence interval
(5) simu.mean.RB: relative bias
(6) simu.mean.SB: standardized bias
(7) simu.mean.RMSE: root mean square error
</p>
</li>
<li><p> cov.comparison: comparison between empirical covariance and average value of simulated covariance
</p>
</li></ol>



<h3>Author(s)</h3>

<p>Pei-Shan Yen, Xuemin Gu
</p>

<hr>
<h2 id='copula.sim'>To generate simulated datasets from empirical data by utilizing the copula invariance property.</h2><span id='topic+copula.sim'></span>

<h3>Description</h3>

<p>Based on the empirical data, generating simulated datasets through the copula invariance property.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>copula.sim(
  data.input,
  id.vec,
  arm.vec,
  n.patient,
  n.simulation,
  seed = NULL,
  validation.type = "none",
  validation.sig.lvl = 0.05,
  rmvnorm.matrix.decomp.method = "svd",
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="copula.sim_+3A_data.input">data.input</code></td>
<td>
<p>The empirical patient-level data to be used to simulate new virtual patient data.</p>
</td></tr>
<tr><td><code id="copula.sim_+3A_id.vec">id.vec</code></td>
<td>
<p>The ID for individual patient in the input data.</p>
</td></tr>
<tr><td><code id="copula.sim_+3A_arm.vec">arm.vec</code></td>
<td>
<p>The column to identify the arm in clinical trial.</p>
</td></tr>
<tr><td><code id="copula.sim_+3A_n.patient">n.patient</code></td>
<td>
<p>The targeted number of patients in each simulated dataset.</p>
</td></tr>
<tr><td><code id="copula.sim_+3A_n.simulation">n.simulation</code></td>
<td>
<p>The number of simulated datasets.</p>
</td></tr>
<tr><td><code id="copula.sim_+3A_seed">seed</code></td>
<td>
<p>The random seed. Default is NULL to use the current seed.</p>
</td></tr>
<tr><td><code id="copula.sim_+3A_validation.type">validation.type</code></td>
<td>
<p>A string to specify the hypothesis test used to detect the difference
between input data and the simulated data. Default is &quot;none&quot;. Possible methods are
energy distance (&quot;energy&quot;) and  ball divergence (&quot;ball&quot;). The R packages &quot;energy&quot; and &quot;Ball&quot; are needed.</p>
</td></tr>
<tr><td><code id="copula.sim_+3A_validation.sig.lvl">validation.sig.lvl</code></td>
<td>
<p>The significant level (alpha) value for the hypothesis test.</p>
</td></tr>
<tr><td><code id="copula.sim_+3A_rmvnorm.matrix.decomp.method">rmvnorm.matrix.decomp.method</code></td>
<td>
<p>The method to do the matrix decomposition used in the function <code>rmvnorm</code>. Default is &quot;svd&quot;.</p>
</td></tr>
<tr><td><code id="copula.sim_+3A_verbose">verbose</code></td>
<td>
<p>A logical value to specify whether to print message for simulation process or not.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A copula.sim object with four elements.
</p>

<ol>
<li><p> data.input: empirical data (wide-form)
</p>
</li>
<li><p> data.input.long: empirical data (long-form)
</p>
</li>
<li><p> data.transform: quantile transformation of data.input
</p>
</li>
<li><p> data.simul: simulated data
</p>
</li></ol>



<h3>Author(s)</h3>

<p>Pei-Shan Yen, Xuemin Gu
</p>


<h3>References</h3>

<p>Sklar, A. (1959). Functions de repartition an dimensionset leursmarges., Paris: PublInst Stat.
</p>
<p>Nelsen, R. B. (2007). An introduction to copulas. Springer Science &amp; Business Media.
</p>
<p>Ross, S. M. (2013). Simulation. Academic Press.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(copulaSim)

## Generate Empirical Data
 # Assume the 2-arm, 5-dimensional empirical data follows multivariate normal data.
library(mvtnorm)
arm1 &lt;- rmvnorm(n = 40, mean  = rep(10, 5), sigma = diag(5) + 0.5)
arm2 &lt;- rmvnorm(n = 40, mean  = rep(12, 5), sigma = diag(5) + 0.5)
test_data &lt;- as.data.frame(cbind(1:80, rep(1:2, each = 40), rbind(arm1, arm2)))
colnames(test_data) &lt;- c("id","arm",paste0("time_", 1:5))

## Generate 100 simulated datasets
copula.sim(data.input = test_data[,-c(1,2)], id.vec = test_data$id, arm.vec = test_data$arm,
n.patient = 100 , n.simulation = 100, seed = 2022)
</code></pre>

<hr>
<h2 id='copulaSim-package'>copulaSim: Virtual Patient Simulation by Copula Invariance Property</h2><span id='topic+copulaSim'></span><span id='topic+copulaSim-package'></span>

<h3>Description</h3>

<p>To optimize clinical trial designs and data analysis methods consistently through trial simulation, we need to simulate multivariate mixed-type virtual patient data independent of designs and analysis methods under evaluation. To make the outcome of optimization more realistic, relevant empirical patient level data should be utilized when it’s available. However, a few problems arise in simulating trials based on small empirical data, where the underlying marginal distributions and their dependence structure cannot be understood or verified thoroughly due to the limited sample size. To resolve this issue, we use the copula invariance property, which can generate the joint distribution without making a strong parametric assumption. The function copula.sim can generate virtual patient data with optional data validation methods that are based on energy distance and ball divergence measurement. The function compare.copula.sim can conduct comparison of marginal mean and covariance of simulated data. To simulate patient-level data from a hypothetical treatment arm that would perform differently from the observed data, the function new.arm.copula.sim can be used to generate new multivariate data with the same dependence structure of the original data but with a shifted mean vector.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Pei-Shan Yen <a href="mailto:peishan0824@gmail.com">peishan0824@gmail.com</a> (<a href="https://orcid.org/0000-0001-7386-0552">ORCID</a>)
</p>
<p>Other contributors:
</p>

<ul>
<li><p> Xuemin Gu <a href="mailto:xuemin.gu@abbvie.com">xuemin.gu@abbvie.com</a> [contributor]
</p>
</li>
<li><p> Jenny Jiao <a href="mailto:jenny.jiao@abbvie.com">jenny.jiao@abbvie.com</a> [contributor]
</p>
</li>
<li><p> Jane Zhang <a href="mailto:jane.zhang@abbvie.com">jane.zhang@abbvie.com</a> [contributor]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/psyen0824/copulaSim">https://github.com/psyen0824/copulaSim</a>
</p>
</li></ul>


<hr>
<h2 id='data.diff.test'>Performing the hypothesis test to compare the difference between the empirical data and the simulated data</h2><span id='topic+data.diff.test'></span>

<h3>Description</h3>

<p>Performing the hypothesis test to compare the difference between the empirical data and the simulated data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data.diff.test(x, y, test.method)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="data.diff.test_+3A_x">x</code></td>
<td>
<p>A numeric matrix.</p>
</td></tr>
<tr><td><code id="data.diff.test_+3A_y">y</code></td>
<td>
<p>A numeric matrix which is compared to <code>x</code>.</p>
</td></tr>
<tr><td><code id="data.diff.test_+3A_test.method">test.method</code></td>
<td>
<p>A string to specify the hypothesis test used to detect the difference
between input data and the simulated data. Default is &quot;none&quot;. Possible methods are
energy distance (&quot;energy&quot;) and  ball divergence (&quot;ball&quot;). The R packages &quot;energy&quot; and &quot;Ball&quot; are needed.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with two elements.
</p>

<ol>
<li><p> p.value: the p-value of the hypothesis test.
</p>
</li>
<li><p> test.result: the returned object of the hypothesis test.
</p>
</li></ol>


<hr>
<h2 id='ecdf.inv'>Obtaining the inverse of marginal empirical cumulative distribution (ECDF)</h2><span id='topic+ecdf.inv'></span>

<h3>Description</h3>

<p>Obtaining the inverse of marginal empirical cumulative distribution (ECDF)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ecdf.inv(x, p, sort.flag = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ecdf.inv_+3A_x">x</code></td>
<td>
<p>A vector of numbers which is the marginal empirical data.</p>
</td></tr>
<tr><td><code id="ecdf.inv_+3A_p">p</code></td>
<td>
<p>A vector of numbers which is the probability of the simulated data.</p>
</td></tr>
<tr><td><code id="ecdf.inv_+3A_sort.flag">sort.flag</code></td>
<td>
<p>A logical value to specify whether to sort the output data.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The inverse values of <code>p</code> based on ECDF of <code>x</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ecdf.inv(0:10, c(0.25, 0.75))
ecdf.inv(0:10, c(0.25, 0.75), FALSE)
</code></pre>

<hr>
<h2 id='extract.data.sim'>Converting data.simul in a copula.sim object into a list of wide-form matrices</h2><span id='topic+extract.data.sim'></span>

<h3>Description</h3>

<p>Converting data.simul in a copula.sim object into a list of wide-form matrices
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract.data.sim(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract.data.sim_+3A_object">object</code></td>
<td>
<p>A copula object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of matrices for simulated data.
</p>

<hr>
<h2 id='new.arm.copula.sim'>Simulating new multivariate datasets with shifted mean vector from existing empirical data</h2><span id='topic+new.arm.copula.sim'></span>

<h3>Description</h3>

<p>Simulating new multivariate datasets with shifted mean vector from existing empirical data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>new.arm.copula.sim(
  data.input,
  id.vec,
  arm.vec,
  shift.vec.list,
  n.patient,
  n.simulation,
  seed = NULL,
  validation.type = "none",
  validation.sig.lvl = 0.05,
  rmvnorm.matrix.decomp.method = "svd",
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="new.arm.copula.sim_+3A_data.input">data.input</code>, <code id="new.arm.copula.sim_+3A_id.vec">id.vec</code>, <code id="new.arm.copula.sim_+3A_arm.vec">arm.vec</code>, <code id="new.arm.copula.sim_+3A_n.patient">n.patient</code>, <code id="new.arm.copula.sim_+3A_n.simulation">n.simulation</code>, <code id="new.arm.copula.sim_+3A_seed">seed</code></td>
<td>
<p>Please refer to the function <a href="#topic+copula.sim">copula.sim</a>.</p>
</td></tr>
<tr><td><code id="new.arm.copula.sim_+3A_shift.vec.list">shift.vec.list</code></td>
<td>
<p>A list of numeric vectors to specify the mean-shifted values for new arms.</p>
</td></tr>
<tr><td><code id="new.arm.copula.sim_+3A_validation.type">validation.type</code>, <code id="new.arm.copula.sim_+3A_validation.sig.lvl">validation.sig.lvl</code>, <code id="new.arm.copula.sim_+3A_rmvnorm.matrix.decomp.method">rmvnorm.matrix.decomp.method</code>, <code id="new.arm.copula.sim_+3A_verbose">verbose</code></td>
<td>
<p>Please refer to the function <a href="#topic+copula.sim">copula.sim</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Please refer to the function <a href="#topic+copula.sim">copula.sim</a>.
</p>


<h3>Author(s)</h3>

<p>Pei-Shan Yen, Xuemin Gu, Jenny Jiao, Jane Zhang
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(copulaSim)

## Generate Empirical Data
 # Assume that the single-arm, 3-dimensional empirical data follows multivariate normal data
library(mvtnorm)
arm1 &lt;- rmvnorm(n = 80, mean = c(10,10.5,11), sigma = diag(3) + 0.5)
test_data &lt;- as.data.frame(cbind(1:80, rep(1,80), arm1))
colnames(test_data) &lt;- c("id", "arm", paste0("time_", 1:3))

## Generate 1 simulated datasets with one empirical arm and two new-arm.
## The mean difference between empirical arm and
 # (i) the 1st new arm is assumed to be 2.5, 2.55, and 2.6 at each time point
 # (ii) the 2nd new arm is assumed to be 4.5, 4.55, and 4.6 at each time point
new.arm.copula.sim(data.input = test_data[,-c(1,2)],
  id.vec = test_data$id, arm.vec = test_data$arm,
  n.patient = 100 , n.simulation = 1, seed = 2022,
  shift.vec.list = list(c(2.5,2.55,2.6), c(4.5,4.55,4.6)))
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
