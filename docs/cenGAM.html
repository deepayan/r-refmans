<!DOCTYPE html><html><head><title>Help for package cenGAM</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {cenGAM}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#cenGAM-package'><p>Censored response additive modelling for mgcv</p></a></li>
<li><a href='#nutrient'><p>Nutrient dataset</p></a></li>
<li><a href='#tobit1'><p>Tobit I family for censored GAM</p></a></li>
<li><a href='#tobit2'><p>Tobit II family for censored GAM</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Censored Regression with Smooth Terms</td>
</tr>
<tr>
<td>Version:</td>
<td>0.5.3</td>
</tr>
<tr>
<td>Date:</td>
<td>2017-08-28</td>
</tr>
<tr>
<td>Author:</td>
<td>Zhou Fang &lt;zhou.fang@bioss.ac.uk&gt;</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Zhou Fang &lt;zhou.fang@bioss.ac.uk&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.2.5), mgcv (&ge; 1.8-19)</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats</td>
</tr>
<tr>
<td>ByteCompile:</td>
<td>yes</td>
</tr>
<tr>
<td>Description:</td>
<td>Implementation of Tobit type I and type II families for censored regression using the 'mgcv' package, based on methods detailed in Woods (2016) &lt;<a href="https://doi.org/10.1080%2F01621459.2016.1180986">doi:10.1080/01621459.2016.1180986</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2017-08-30 17:11:29 UTC; zfang</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2017-08-30 18:45:20 UTC</td>
</tr>
</table>
<hr>
<h2 id='cenGAM-package'>Censored response additive modelling for mgcv</h2><span id='topic+cenGAM-package'></span><span id='topic+cenGAM'></span>

<h3>Description</h3>

<p><code>cenGAM</code> provides <code><a href="#topic+tobit1">tobit1</a></code> and <code><a href="#topic+tobit2">tobit2</a></code> families for generalized additive modelling with the <code>gam</code> function in the <code>mgcv</code> package.
</p>
<p>Under the Tobit I model, the user supplies a left and/or right threshold (optionally differing between observations, and potentially infinite to denote no censorship) and the response is assumed to be censored if it falls over this threshold. Under the Tobit II model, a more generalised model is assumed where we fit a second additive model that gives whether each observation is censored, with a possible correlation between the error in the response and the censorship.
</p>
<p>Seen help for the individual functions for more details.
</p>


<h3>Author(s)</h3>

<p>Zhou Fang &lt;zhou.fang@bioss.ac.uk&gt;
</p>
<p>with contributions and help from Javier Palarea.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## see examples for tobit1 and tobit2
</code></pre>

<hr>
<h2 id='nutrient'>Nutrient dataset</h2><span id='topic+nutrient'></span>

<h3>Description</h3>

<p>Simulated nutrient concentration data, with 1200 rows and 3 columns.
</p>


<h3>Format</h3>

<p>This data frame contains the following columns:
</p>
<p>day - a day of the year
</p>
<p>location - one of four locations A B C D
</p>
<p>y - a nutrient value, either a number or a censoring threshold
</p>

<hr>
<h2 id='tobit1'>Tobit I family for censored GAM</h2><span id='topic+tobit1'></span>

<h3>Description</h3>

<p>This function implements the Tobit I family for the mgcv package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tobit1(link="identity", left.threshold=-Inf, right.threshold=Inf, 
theta=NULL, initial.theta=0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tobit1_+3A_link">link</code></td>
<td>
<p>The link function: one of <code>"log"</code>, <code>"identity"</code>, <code>"inverse"</code>, <code>"sqrt"</code>, or a 
<code><a href="stats.html#topic+power">power</a></code> link.</p>
</td></tr>
<tr><td><code id="tobit1_+3A_left.threshold">left.threshold</code></td>
<td>
<p>Threshold value, for which response values below this will be censored. Can be a scalar or a vector of same length as the response.</p>
</td></tr>
<tr><td><code id="tobit1_+3A_right.threshold">right.threshold</code></td>
<td>
<p>Threshold value, for which response values above this will be censored. Can be a scalar or a vector of same length as the response.</p>
</td></tr>
<tr><td><code id="tobit1_+3A_theta">theta</code></td>
<td>
<p>The log std error. If left NULL, it is estimated.</p>
</td></tr>
<tr><td><code id="tobit1_+3A_initial.theta">initial.theta</code></td>
<td>
<p>Optional parameter to set initial theta value if it is being estimated - change this value if the variance is very different from 1.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Under the Tobit I model, given a value sigma and a conditional mean of mu, and left and right threshold values lt and rt, response values y are distributed as
</p>
<p>lt if z &lt; lt
</p>
<p>rt if z &gt; rt
</p>
<p>z otherwise
</p>
<p>where z is distribution Normal(mu, sigma). (Note that we have extended the model to include right as well as left censoring.
</p>
<p>This function allows a non-linear relationship be estimated between mu and the covariates in a restricted maximum likelihood approach, via application of Wood (2016). We allow differing levels of censorship across dataset by allowing the left and right thresholds to be different between data points.
</p>
<p>See the examples for more details of how to fit in practice.
</p>


<h3>Value</h3>

<p>An object inheriting from class <code>family</code> for use with the mgcv package.
</p>


<h3>References</h3>

<p>Wood, S.N., N. Pya and B. Saefken (2016), Smoothing parameter and
model selection for general smooth models. Journal of the American
Statistical Association. &lt;URL: http://arxiv.org/abs/1511.03864&gt;
</p>


<h3>See Also</h3>

<p><code><a href="mgcv.html#topic+gam">gam</a></code>,<code><a href="mgcv.html#topic+ziplss">ziplss</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'># Generate random data
set.seed(1)
x &lt;- matrix(2*rnorm(300), 100)
yn &lt;- 2*x[,3] + 4*cos(x[,1]*2)
y &lt;- yn + rnorm(100)
ycensored &lt;- pmax(y, 0) # data left-censored at 0
ycensored &lt;- pmin(ycensored, 4) # data right-censored at 4

par(mfrow = c(3,3))

# True model
plot(gam(y ~ s(x[,1]) + s(x[,2]) + s(x[, 3])), ylim=c(-5, 5), main = "True")

# Naive estimation
plot(gam(ycensored ~ s(x[,1]) + s(x[,2]) + s(x[, 3])), ylim=c(-5, 5), main = "Naive")

# Tobit I estimation
m &lt;- gam(ycensored ~ s(x[,1]) + s(x[,2]) + s(x[, 3]), family = tobit1(left.threshold=0))
summary(m) #note x[,2] is not significant
m$family$getTheta(FALSE) #estimate of theta
m$family$getTheta(TRUE) #estimate of sigma = exp(theta)
plot(m, ylim = c(-5, 5), main = "Tobit I") 

# More realistic dataset requires some data processing
data(nutrient)
# For this dataset, all values &gt;1 are censored. At location D values are censored below at 0, other
# locations are censored at 0.1.
head(nutrient)
nut = data.frame(day = nutrient$day, location = factor(nutrient$location), y=as.numeric(nutrient$y))
table(nutrient$y[is.na(nut$y)])
summary(nut$y)
nut$upper = 10
nut$lower = ifelse(nut$location == "D", 0, 1)
# Recode the data to communicate which is and isn't censored
nut$y[nutrient$y %in% c("&lt;1", "&lt;0")] = -Inf
nut$y[nutrient$y %in% c("&gt;10")] = Inf
# Missing values are best removed here, or can cause confusion later
nut = na.omit(nut)

# Fit including a random effect for location
m = gam(y~ s(day) + s(location, bs="re") , data = nut, 
family = tobit1(left.threshold=nut$lower, right.threshold = nut$upper))

gam.vcomp(m)
anova(m)
summary(m)

</code></pre>

<hr>
<h2 id='tobit2'>Tobit II family for censored GAM</h2><span id='topic+tobit2'></span>

<h3>Description</h3>

<p>This function implements the Tobit II family for the mgcv package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tobit2(link=list("identity","identity","log","logit2" ), 
censoring = FALSE, rho=NULL, eps = 1e-3) 
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tobit2_+3A_link">link</code></td>
<td>
<p>The link functions: Corresponds to <code>mu1</code>, <code>mu2</code>, <code>sigma</code> and <code>rho</code> respectively.</p>
</td></tr>
<tr><td><code id="tobit2_+3A_censoring">censoring</code></td>
<td>
<p>Vector of TRUE/FALSE values to denote censorship. TRUE values are censored</p>
</td></tr>
<tr><td><code id="tobit2_+3A_rho">rho</code></td>
<td>
<p>Value of rho. If NULL, is estimated.</p>
</td></tr>
<tr><td><code id="tobit2_+3A_eps">eps</code></td>
<td>
<p>Parameter to perturb rho in estimation if very close to -1 or 1.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Under the Tobit II model, given a value sigma and a conditional mean of mu1, and a censoring parameter mu2, response values are censored if mu2 + epsilon2 &lt; 0, and mu1 + sigma*epsilon1 otherwise.
</p>
<p>Here epsilon1, epsilon2 are distributed Normal(0, 1) with correlated rho.
</p>
<p>This function allows a non-linear relationship be estimated between mu1, mu2, sigma, rho and the covariates in a restricted maximum likelihood approach, via application of Wood (2016). Note that this allows for heteroskedastic errors.
</p>
<p>Estimation of rho depends on the distributional qualities near the censorship boundary, and is hence typically very inaccurate for typical sample sizes. Hence in practice it is often better to supply a value of rho (for example 0 to imply independent censorship) instead. eps is used when estimating rho to avoid errors when rho is close to 1 or -1. Smaller values may produce more accurate results.
</p>
<p>This method is still currently very *experimental*. It's not suggested to be used to important applications. Errors can occur if the default starting point for the function cause problems, consider changing the <code>start</code> argument to <code>gam</code>.
</p>


<h3>Value</h3>

<p>An object inheriting from class <code>family</code> for use with the mgcv package.
</p>


<h3>References</h3>

<p>Wood, S.N., N. Pya and B. Saefken (2016), Smoothing parameter and
model selection for general smooth models. Journal of the American
Statistical Association. &lt;URL: http://arxiv.org/abs/1511.03864&gt;
</p>


<h3>See Also</h3>

<p><code><a href="mgcv.html#topic+gam">gam</a></code>,<code><a href="mgcv.html#topic+ziplss">ziplss</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'># Generate a small example
set.seed(1)
x &lt;- matrix(2*rnorm(400), 200)
yn &lt;-  x[,1]^2 + x[,2]
y &lt;- yn + rnorm(200)
censored &lt;- (rnorm(200) + 2*x[,2]+1) &lt; 0 #censored according to x[,2]
ycensored &lt;- replace(y, censored, 0) 
m &lt;- gam(c(ycensored ~ s(x[,1]) + s(x[,2]) , ~x[,1]+x[,2], ~1,~1), 
family = tobit2(censoring = censored)) #estimated rho
par(mfrow = c(3,2))
plot(gam(y ~ s(x[,1]) + s(x[,2]) ), ylim=c(-5, 5), main = "True")
plot(m, ylim = c(-5, 5), main = "Tobit II estimated rho") 

summary(m) 
m$fitted #gives for each observation fitted mu1, mu2, sigma, rho

m2 &lt;- gam(c(ycensored ~ s(x[,1]) + s(x[,2]) , ~x[,1]+x[,2], ~1), 
family = tobit2(censoring = censored, rho=0)) #non estimated rho
plot(m2, ylim = c(-5, 5), main = "Tobit II fixed rho") 

## Not run: 
#Larger example
set.seed(1)
x &lt;- matrix(2*rnorm(1500), 500)
yn &lt;- 2*x[,3] + 4*cos(x[,1]*2)
y &lt;- yn + 3*rnorm(500)
censored &lt;- (rnorm(500) + 2*x[,2]) &lt; 0 #censored according to x[,2]
ycensored &lt;- replace(y, censored, 0)  

par(mfrow = c(3,3))

# True model
plot(gam(y ~ s(x[,1]) + s(x[,2]) + s(x[, 3])), ylim=c(-5, 5), main = "True")

# Naive estimation
plot(gam(ycensored ~ s(x[,1]) + s(x[,2]) + s(x[, 3])), ylim=c(-5, 5), main = "Naive")

# Tobit II estimation
m &lt;- gam(c(ycensored ~ s(x[,1]) + s(x[,2]) + s(x[, 3]), ~x[,1]+x[,2]+x[,3], ~1,~1), 
family = tobit2(censoring = censored))
plot(m, ylim = c(-5, 5), main = "Tobit II") 

#fitting with non-estimated rho
m2 &lt;- gam(c(ycensored ~ s(x[,1]) + s(x[,2]) + s(x[, 3]), ~x[,1]+x[,2]+x[,3],~1), 
family = tobit2(censoring = censored, rho=0))

## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
