<!DOCTYPE html><html lang="en"><head><title>Help for package vetiver</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {vetiver}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#vetiver-package'><p>vetiver: Version, Share, Deploy, and Monitor Models</p></a></li>
<li><a href='#api_spec'><p>Update the OpenAPI specification using model metadata</p></a></li>
<li><a href='#attach_pkgs'><p>Fully attach or load packages for making model predictions</p></a></li>
<li><a href='#augment.vetiver_endpoint'><p>Post new data to a deployed model API endpoint and augment with predictions</p></a></li>
<li><a href='#augment.vetiver_endpoint_sagemaker'><p>Post new data to a deployed SageMaker model endpoint and augment with predictions</p></a></li>
<li><a href='#handler_startup.train'><p>Model handler functions for API endpoint</p></a></li>
<li><a href='#map_request_body'><p>Identify data types for each column in an input data prototype</p></a></li>
<li><a href='#predict.vetiver_endpoint'><p>Post new data to a deployed model API endpoint and return predictions</p></a></li>
<li><a href='#predict.vetiver_endpoint_sagemaker'><p>Post new data to a deployed SageMaker model endpoint and return predictions</p></a></li>
<li><a href='#reexports'><p>Objects exported from other packages</p></a></li>
<li><a href='#vetiver_api'><p>Create a Plumber API to predict with a deployable <code>vetiver_model()</code> object</p></a></li>
<li><a href='#vetiver_compute_metrics'><p>Aggregate model metrics over time for monitoring</p></a></li>
<li><a href='#vetiver_create_description.train'><p>Model constructor methods</p></a></li>
<li><a href='#vetiver_create_meta.train'><p>Metadata constructors for <code>vetiver_model()</code> object</p></a></li>
<li><a href='#vetiver_create_rsconnect_bundle'><p>Create an Posit Connect bundle for a vetiver model API</p></a></li>
<li><a href='#vetiver_dashboard'><p>R Markdown format for model monitoring dashboards</p></a></li>
<li><a href='#vetiver_deploy_rsconnect'><p>Deploy a vetiver model API to Posit Connect</p></a></li>
<li><a href='#vetiver_deploy_sagemaker'><p>Deploy a vetiver model API to Amazon SageMaker</p></a></li>
<li><a href='#vetiver_endpoint'><p>Create a model API endpoint object for prediction</p></a></li>
<li><a href='#vetiver_endpoint_sagemaker'><p>Create a SageMaker model API endpoint object for prediction</p></a></li>
<li><a href='#vetiver_model'><p>Create a vetiver object for deployment of a trained model</p></a></li>
<li><a href='#vetiver_pin_metrics'><p>Update model metrics over time for monitoring</p></a></li>
<li><a href='#vetiver_pin_write'><p>Read and write a trained model to a board of models</p></a></li>
<li><a href='#vetiver_plot_metrics'><p>Plot model metrics over time for monitoring</p></a></li>
<li><a href='#vetiver_pr_predict'><p>Create a Plumber API to predict with a deployable <code>vetiver_model()</code> object</p></a></li>
<li><a href='#vetiver_prepare_docker'><p>Generate files necessary to build a Docker container for a vetiver model</p></a></li>
<li><a href='#vetiver_ptype.train'><p>Create a vetiver input data prototype</p></a></li>
<li><a href='#vetiver_python_requirements.keras.engine.training.Model'><p>Use extra files required for deployment</p></a></li>
<li><a href='#vetiver_sm_build'><p>Deploy a vetiver model API to Amazon SageMaker with modular functions</p></a></li>
<li><a href='#vetiver_sm_delete'><p>Delete Amazon SageMaker model, endpoint, and endpoint configuration</p></a></li>
<li><a href='#vetiver_type_convert'><p>Convert new data at prediction time using input data prototype</p></a></li>
<li><a href='#vetiver_write_docker'><p>Write a Dockerfile for a vetiver model</p></a></li>
<li><a href='#vetiver_write_plumber'><p>Write a deployable Plumber file for a vetiver model</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Version, Share, Deploy, and Monitor Models</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.5</td>
</tr>
<tr>
<td>Description:</td>
<td>The goal of 'vetiver' is to provide fluent tooling to
    version, share, deploy, and monitor a trained model. Functions handle
    both recording and checking the model's input data prototype, and
    predicting from a remote API endpoint. The 'vetiver' package is
    extensible, with generics that can support many kinds of models.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://vetiver.rstudio.com">https://vetiver.rstudio.com</a>, <a href="https://rstudio.github.io/vetiver-r/">https://rstudio.github.io/vetiver-r/</a>,
<a href="https://github.com/rstudio/vetiver-r/">https://github.com/rstudio/vetiver-r/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/rstudio/vetiver-r/issues">https://github.com/rstudio/vetiver-r/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6)</td>
</tr>
<tr>
<td>Imports:</td>
<td>bundle, butcher (&ge; 0.3.1), cereal, cli, ellipsis, fs,
generics, glue, hardhat, lifecycle, magrittr (&ge; 2.0.3), pins
(&ge; 1.3.0), purrr, rapidoc, readr (&ge; 1.4.0), rlang (&ge; 1.1.0),
tibble, vctrs, withr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>arrow, callr, caret, clustMixType, covr, curl, dplyr,
flexdashboard, ggplot2, httpuv, httr, jsonlite, keras, knitr,
LiblineaR, luz, mgcv, mlr3, mlr3data, mlr3learners, mockery,
modeldata, parsnip, paws.machine.learning (&ge; 0.2.0), pingr,
plotly, plumber (&ge; 1.0.0), ranger, recipes, reticulate,
rmarkdown, rpart, rsconnect, slider (&ge; 0.2.2), smdocker (&ge;
0.1.2), stacks, tensorflow, testthat (&ge; 3.1.8), tidyselect,
torch, vdiffr, workflows, xgboost, yardstick</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/Needs/website:</td>
<td>tidyverse/tidytemplate</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-11-16 22:12:03 UTC; juliasilge</td>
</tr>
<tr>
<td>Author:</td>
<td>Julia Silge <a href="https://orcid.org/0000-0002-3671-836X"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [cre,
    aut],
  Posit Software, PBC [cph, fnd]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Julia Silge &lt;julia.silge@posit.co&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-11-16 22:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='vetiver-package'>vetiver: Version, Share, Deploy, and Monitor Models</h2><span id='topic+vetiver'></span><span id='topic+vetiver-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>The goal of 'vetiver' is to provide fluent tooling to version, share, deploy, and monitor a trained model. Functions handle both recording and checking the model's input data prototype, and predicting from a remote API endpoint. The 'vetiver' package is extensible, with generics that can support many kinds of models.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Julia Silge <a href="mailto:julia.silge@posit.co">julia.silge@posit.co</a> (<a href="https://orcid.org/0000-0002-3671-836X">ORCID</a>)
</p>
<p>Other contributors:
</p>

<ul>
<li><p> Posit Software, PBC [copyright holder, funder]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://vetiver.rstudio.com">https://vetiver.rstudio.com</a>
</p>
</li>
<li> <p><a href="https://rstudio.github.io/vetiver-r/">https://rstudio.github.io/vetiver-r/</a>
</p>
</li>
<li> <p><a href="https://github.com/rstudio/vetiver-r/">https://github.com/rstudio/vetiver-r/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/rstudio/vetiver-r/issues">https://github.com/rstudio/vetiver-r/issues</a>
</p>
</li></ul>


<hr>
<h2 id='api_spec'>Update the OpenAPI specification using model metadata</h2><span id='topic+api_spec'></span><span id='topic+glue_spec_summary'></span><span id='topic+glue_spec_summary.default'></span><span id='topic+glue_spec_summary.data.frame'></span><span id='topic+glue_spec_summary.array'></span>

<h3>Description</h3>

<p>Update the OpenAPI specification using model metadata
</p>


<h3>Usage</h3>

<pre><code class='language-R'>api_spec(spec, vetiver_model, path, all_docs = TRUE)

glue_spec_summary(prototype, return_type)

## Default S3 method:
glue_spec_summary(prototype, return_type = NULL)

## S3 method for class 'data.frame'
glue_spec_summary(prototype, return_type = "predictions")

## S3 method for class 'array'
glue_spec_summary(prototype, return_type = "predictions")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="api_spec_+3A_spec">spec</code></td>
<td>
<p>An OpenAPI Specification formatted list object</p>
</td></tr>
<tr><td><code id="api_spec_+3A_vetiver_model">vetiver_model</code></td>
<td>
<p>A deployable <code><a href="#topic+vetiver_model">vetiver_model()</a></code> object</p>
</td></tr>
<tr><td><code id="api_spec_+3A_path">path</code></td>
<td>
<p>The endpoint path</p>
</td></tr>
<tr><td><code id="api_spec_+3A_all_docs">all_docs</code></td>
<td>
<p>Should the interactive visual API documentation be created
for <em>all</em> POST endpoints in the router <code>pr</code>? This defaults to <code>TRUE</code>, and
assumes that all POST endpoints use the <code><a href="#topic+vetiver_model">vetiver_model()</a></code> input data
prototype.</p>
</td></tr>
<tr><td><code id="api_spec_+3A_prototype">prototype</code></td>
<td>
<p>An input data prototype from a model</p>
</td></tr>
<tr><td><code id="api_spec_+3A_return_type">return_type</code></td>
<td>
<p>Character string to describe what endpoint returns, such
as &quot;predictions&quot;</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>api_spec()</code> returns the updated OpenAPI Specification object. This
function uses <code>glue_spec_summary()</code> internally, which returns a <code>glue</code>
character string.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(plumber)
cars_lm &lt;- lm(mpg ~ ., data = mtcars)
v &lt;- vetiver_model(cars_lm, "cars_linear")

glue_spec_summary(v$prototype)

modify_spec &lt;- function(spec) api_spec(spec, v, "/predict")
pr() %&gt;% pr_set_api_spec(api = modify_spec)

</code></pre>

<hr>
<h2 id='attach_pkgs'>Fully attach or load packages for making model predictions</h2><span id='topic+attach_pkgs'></span><span id='topic+load_pkgs'></span>

<h3>Description</h3>

<p>These are developer-facing functions, useful for supporting new model types.
Some models require one or more R packages to be fully attached to make
predictions, and some require only that the namespace of one or more R
packages is loaded.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>attach_pkgs(pkgs)

load_pkgs(pkgs)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="attach_pkgs_+3A_pkgs">pkgs</code></td>
<td>
<p>A character vector of package names to load or fully attach.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These two functions will attempt either to:
</p>

<ul>
<li><p> fully attach or
</p>
</li>
<li><p> load
</p>
</li></ul>

<p>the namespace of the <code>pkgs</code> vector of package names, preserving the current
random seed.
</p>
<p>To learn more about load vs. attach, read the <a href="https://r-pkgs.org/dependencies-mindset-background.html#sec-dependencies-attach-vs-load">&quot;Dependencies&quot; chapter of <em>R Packages</em></a>.
For deploying a model, it is likely safer to fully attach needed packages
but that comes with the risk of naming conflicts between packages.
</p>


<h3>Value</h3>

<p>An invisible <code>TRUE</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## succeed
load_pkgs(c("knitr", "readr"))
attach_pkgs(c("knitr", "readr"))

## fail
try(load_pkgs(c("bloopy", "readr")))
try(attach_pkgs(c("bloopy", "readr")))

</code></pre>

<hr>
<h2 id='augment.vetiver_endpoint'>Post new data to a deployed model API endpoint and augment with predictions</h2><span id='topic+augment.vetiver_endpoint'></span>

<h3>Description</h3>

<p>Post new data to a deployed model API endpoint and augment with predictions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'vetiver_endpoint'
augment(x, new_data, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="augment.vetiver_endpoint_+3A_x">x</code></td>
<td>
<p>A model API endpoint object created with <code><a href="#topic+vetiver_endpoint">vetiver_endpoint()</a></code>.</p>
</td></tr>
<tr><td><code id="augment.vetiver_endpoint_+3A_new_data">new_data</code></td>
<td>
<p>New data for making predictions, such as a data frame.</p>
</td></tr>
<tr><td><code id="augment.vetiver_endpoint_+3A_...">...</code></td>
<td>
<p>Extra arguments passed to <code><a href="httr.html#topic+POST">httr::POST()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>The <code>new_data</code> with added prediction column(s).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+predict.vetiver_endpoint">predict.vetiver_endpoint()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if (FALSE) {
endpoint &lt;- vetiver_endpoint("http://127.0.0.1:8088/predict")
augment(endpoint, mtcars[4:7, -1])
}

</code></pre>

<hr>
<h2 id='augment.vetiver_endpoint_sagemaker'>Post new data to a deployed SageMaker model endpoint and augment with predictions</h2><span id='topic+augment.vetiver_endpoint_sagemaker'></span>

<h3>Description</h3>

<p>Post new data to a deployed SageMaker model endpoint and augment with predictions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'vetiver_endpoint_sagemaker'
augment(x, new_data, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="augment.vetiver_endpoint_sagemaker_+3A_x">x</code></td>
<td>
<p>A SageMaker model endpoint object created with <code><a href="#topic+vetiver_endpoint_sagemaker">vetiver_endpoint_sagemaker()</a></code>.</p>
</td></tr>
<tr><td><code id="augment.vetiver_endpoint_sagemaker_+3A_new_data">new_data</code></td>
<td>
<p>New data for making predictions, such as a data frame.</p>
</td></tr>
<tr><td><code id="augment.vetiver_endpoint_sagemaker_+3A_...">...</code></td>
<td>
<p>Extra arguments passed to <code><a href="paws.machine.learning.html#topic+sagemakerruntime_invoke_endpoint">paws.machine.learning::sagemakerruntime_invoke_endpoint()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>The <code>new_data</code> with added prediction column(s).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+predict.vetiver_endpoint_sagemaker">predict.vetiver_endpoint_sagemaker()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if (FALSE) {
  endpoint &lt;- vetiver_endpoint_sagemaker("sagemaker-demo-model")
  augment(endpoint, mtcars[4:7, -1])
}

</code></pre>

<hr>
<h2 id='handler_startup.train'>Model handler functions for API endpoint</h2><span id='topic+handler_startup.train'></span><span id='topic+handler_predict.train'></span><span id='topic+handler_startup.gam'></span><span id='topic+handler_predict.gam'></span><span id='topic+handler_predict.glm'></span><span id='topic+handler_startup'></span><span id='topic+handler_startup.default'></span><span id='topic+handler_predict'></span><span id='topic+handler_predict.default'></span><span id='topic+handler_startup.keras.engine.training.Model'></span><span id='topic+handler_predict.keras.engine.training.Model'></span><span id='topic+handler_predict.kproto'></span><span id='topic+handler_predict.lm'></span><span id='topic+handler_startup.luz_module_fitted'></span><span id='topic+handler_predict.luz_module_fitted'></span><span id='topic+handler_startup.Learner'></span><span id='topic+handler_predict.Learner'></span><span id='topic+handler_startup.ranger'></span><span id='topic+handler_predict.ranger'></span><span id='topic+handler_startup.recipe'></span><span id='topic+handler_predict.recipe'></span><span id='topic+handler_startup.model_stack'></span><span id='topic+handler_predict.model_stack'></span><span id='topic+handler_startup.workflow'></span><span id='topic+handler_predict.workflow'></span><span id='topic+handler_startup.xgb.Booster'></span><span id='topic+handler_predict.xgb.Booster'></span>

<h3>Description</h3>

<p>These are developer-facing functions, useful for supporting new model types.
Each model supported by <code>vetiver_model()</code> uses two handler functions
in <code><a href="#topic+vetiver_api">vetiver_api()</a></code>:
</p>

<ul>
<li><p> The <code>handler_startup</code> function executes when the API starts. Use this
function for tasks like loading packages. A model can use the default
method here, which is <code>NULL</code> (to do nothing at startup).
</p>
</li>
<li><p> The <code>handler_predict</code> function executes at each API call. Use this
function for calling <code>predict()</code> and any other tasks that must be executed
at each API call.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'train'
handler_startup(vetiver_model)

## S3 method for class 'train'
handler_predict(vetiver_model, ...)

## S3 method for class 'gam'
handler_startup(vetiver_model)

## S3 method for class 'gam'
handler_predict(vetiver_model, ...)

## S3 method for class 'glm'
handler_predict(vetiver_model, ...)

handler_startup(vetiver_model)

## Default S3 method:
handler_startup(vetiver_model)

handler_predict(vetiver_model, ...)

## Default S3 method:
handler_predict(vetiver_model, ...)

## S3 method for class 'keras.engine.training.Model'
handler_startup(vetiver_model)

## S3 method for class 'keras.engine.training.Model'
handler_predict(vetiver_model, ...)

## S3 method for class 'kproto'
handler_predict(vetiver_model, ...)

## S3 method for class 'lm'
handler_predict(vetiver_model, ...)

## S3 method for class 'luz_module_fitted'
handler_startup(vetiver_model)

## S3 method for class 'luz_module_fitted'
handler_predict(vetiver_model, ...)

## S3 method for class 'Learner'
handler_startup(vetiver_model)

## S3 method for class 'Learner'
handler_predict(vetiver_model, ...)

## S3 method for class 'ranger'
handler_startup(vetiver_model)

## S3 method for class 'ranger'
handler_predict(vetiver_model, ...)

## S3 method for class 'recipe'
handler_startup(vetiver_model)

## S3 method for class 'recipe'
handler_predict(vetiver_model, ...)

## S3 method for class 'model_stack'
handler_startup(vetiver_model)

## S3 method for class 'model_stack'
handler_predict(vetiver_model, ...)

## S3 method for class 'workflow'
handler_startup(vetiver_model)

## S3 method for class 'workflow'
handler_predict(vetiver_model, ...)

## S3 method for class 'xgb.Booster'
handler_startup(vetiver_model)

## S3 method for class 'xgb.Booster'
handler_predict(vetiver_model, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="handler_startup.train_+3A_vetiver_model">vetiver_model</code></td>
<td>
<p>A deployable <code><a href="#topic+vetiver_model">vetiver_model()</a></code> object</p>
</td></tr>
<tr><td><code id="handler_startup.train_+3A_...">...</code></td>
<td>
<p>Other arguments passed to <code>predict()</code>, such as prediction <code>type</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>These are two generics that use the class of <code>vetiver_model$model</code>
for dispatch.
</p>


<h3>Value</h3>

<p>A <code>handler_startup</code> function should return invisibly, while a
<code>handler_predict</code> function should return a function with the signature
<code style="white-space: pre;">&#8288;function(req)&#8288;</code>. The request body (<code>req$body</code>) consists of the new data
at prediction time; this function should return predictions either as a
tibble or as a list coercable to a tibble via <code><a href="tibble.html#topic+as_tibble">tibble::as_tibble()</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cars_lm &lt;- lm(mpg ~ ., data = mtcars)
v &lt;- vetiver_model(cars_lm, "cars_linear")
handler_startup(v)
handler_predict(v)

</code></pre>

<hr>
<h2 id='map_request_body'>Identify data types for each column in an input data prototype</h2><span id='topic+map_request_body'></span>

<h3>Description</h3>

<p>The OpenAPI specification of a Plumber API created via <code><a href="plumber.html#topic+pr">plumber::pr()</a></code> can
be modified via <code><a href="plumber.html#topic+pr_set_api_spec">plumber::pr_set_api_spec()</a></code>, and this helper function will
identify data types of predictors and create a list to use in this
specification. These are <em>not</em> R data types, but instead basic JSON data
types. For example, factors in R will be documented as strings in the
OpenAPI specification.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>map_request_body(prototype)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="map_request_body_+3A_prototype">prototype</code></td>
<td>
<p>An input data prototype from a model</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is a developer-facing function, useful for supporting new model types.
It is called by <code><a href="#topic+api_spec">api_spec()</a></code>.
</p>


<h3>Value</h3>

<p>A list to be used within <code><a href="plumber.html#topic+pr_set_api_spec">plumber::pr_set_api_spec()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>map_request_body(vctrs::vec_slice(chickwts, 0))

</code></pre>

<hr>
<h2 id='predict.vetiver_endpoint'>Post new data to a deployed model API endpoint and return predictions</h2><span id='topic+predict.vetiver_endpoint'></span>

<h3>Description</h3>

<p>Post new data to a deployed model API endpoint and return predictions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'vetiver_endpoint'
predict(object, new_data, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.vetiver_endpoint_+3A_object">object</code></td>
<td>
<p>A model API endpoint object created with <code><a href="#topic+vetiver_endpoint">vetiver_endpoint()</a></code>.</p>
</td></tr>
<tr><td><code id="predict.vetiver_endpoint_+3A_new_data">new_data</code></td>
<td>
<p>New data for making predictions, such as a data frame.</p>
</td></tr>
<tr><td><code id="predict.vetiver_endpoint_+3A_...">...</code></td>
<td>
<p>Extra arguments passed to <code><a href="httr.html#topic+POST">httr::POST()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble of model predictions with as many rows as in <code>new_data</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+augment.vetiver_endpoint">augment.vetiver_endpoint()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if (FALSE) {
endpoint &lt;- vetiver_endpoint("http://127.0.0.1:8088/predict")
predict(endpoint, mtcars[4:7, -1])
}


</code></pre>

<hr>
<h2 id='predict.vetiver_endpoint_sagemaker'>Post new data to a deployed SageMaker model endpoint and return predictions</h2><span id='topic+predict.vetiver_endpoint_sagemaker'></span>

<h3>Description</h3>

<p>Post new data to a deployed SageMaker model endpoint and return predictions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'vetiver_endpoint_sagemaker'
predict(object, new_data, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.vetiver_endpoint_sagemaker_+3A_object">object</code></td>
<td>
<p>A SageMaker model endpoint object created with <code><a href="#topic+vetiver_endpoint_sagemaker">vetiver_endpoint_sagemaker()</a></code>.</p>
</td></tr>
<tr><td><code id="predict.vetiver_endpoint_sagemaker_+3A_new_data">new_data</code></td>
<td>
<p>New data for making predictions, such as a data frame.</p>
</td></tr>
<tr><td><code id="predict.vetiver_endpoint_sagemaker_+3A_...">...</code></td>
<td>
<p>Extra arguments passed to <code><a href="paws.machine.learning.html#topic+sagemakerruntime_invoke_endpoint">paws.machine.learning::sagemakerruntime_invoke_endpoint()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble of model predictions with as many rows as in <code>new_data</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+augment.vetiver_endpoint_sagemaker">augment.vetiver_endpoint_sagemaker()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if (FALSE) {
  endpoint &lt;- vetiver_endpoint_sagemaker("sagemaker-demo-model")
  predict(endpoint, mtcars[4:7, -1])
}
</code></pre>

<hr>
<h2 id='reexports'>Objects exported from other packages</h2><span id='topic+reexports'></span><span id='topic+augment'></span><span id='topic+required_pkgs'></span>

<h3>Description</h3>

<p>These objects are imported from other packages. Follow the links
below to see their documentation.
</p>

<dl>
<dt>generics</dt><dd><p><code><a href="generics.html#topic+augment">augment</a></code>, <code><a href="generics.html#topic+required_pkgs">required_pkgs</a></code></p>
</dd>
</dl>

<hr>
<h2 id='vetiver_api'>Create a Plumber API to predict with a deployable <code>vetiver_model()</code> object</h2><span id='topic+vetiver_api'></span><span id='topic+vetiver_pr_post'></span><span id='topic+vetiver_pr_docs'></span>

<h3>Description</h3>

<p>Use <code>vetiver_api()</code> to add a POST endpoint for predictions from a
trained <code><a href="#topic+vetiver_model">vetiver_model()</a></code> to a Plumber router.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vetiver_api(
  pr,
  vetiver_model,
  path = "/predict",
  debug = is_interactive(),
  ...
)

vetiver_pr_post(
  pr,
  vetiver_model,
  path = "/predict",
  debug = is_interactive(),
  ...,
  check_prototype = TRUE,
  check_ptype = deprecated()
)

vetiver_pr_docs(pr, vetiver_model, path = "/predict", all_docs = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_api_+3A_pr">pr</code></td>
<td>
<p>A Plumber router, such as from <code><a href="plumber.html#topic+pr">plumber::pr()</a></code>.</p>
</td></tr>
<tr><td><code id="vetiver_api_+3A_vetiver_model">vetiver_model</code></td>
<td>
<p>A deployable <code><a href="#topic+vetiver_model">vetiver_model()</a></code> object</p>
</td></tr>
<tr><td><code id="vetiver_api_+3A_path">path</code></td>
<td>
<p>The endpoint path</p>
</td></tr>
<tr><td><code id="vetiver_api_+3A_debug">debug</code></td>
<td>
<p><code>TRUE</code> provides more insight into your API errors.</p>
</td></tr>
<tr><td><code id="vetiver_api_+3A_...">...</code></td>
<td>
<p>Other arguments passed to <code>predict()</code>, such as prediction <code>type</code></p>
</td></tr>
<tr><td><code id="vetiver_api_+3A_check_prototype">check_prototype</code></td>
<td>
<p>Should the input data prototype stored in
<code>vetiver_model</code> (used for visual API documentation) also be used to check
new data at prediction time? Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="vetiver_api_+3A_check_ptype">check_ptype</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a></p>
</td></tr>
<tr><td><code id="vetiver_api_+3A_all_docs">all_docs</code></td>
<td>
<p>Should the interactive visual API documentation be created
for <em>all</em> POST endpoints in the router <code>pr</code>? This defaults to <code>TRUE</code>, and
assumes that all POST endpoints use the <code><a href="#topic+vetiver_model">vetiver_model()</a></code> input data
prototype.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>You can first store and version your <code><a href="#topic+vetiver_model">vetiver_model()</a></code> with
<code><a href="#topic+vetiver_pin_write">vetiver_pin_write()</a></code>, and then create an API endpoint with <code>vetiver_api()</code>.
</p>
<p>Setting <code>debug = TRUE</code> may expose any sensitive data from your model in
API errors.
</p>
<p>Several GET endpoints will also be added to the router <code>pr</code>, depending on the
characteristics of the model object:
</p>

<ul>
<li><p> a <code style="white-space: pre;">&#8288;/pin-url&#8288;</code> endpoint to return the URL of the pinned model
</p>
</li>
<li><p> a <code style="white-space: pre;">&#8288;/metadata&#8288;</code> endpoint to return any metadata stored with the model
</p>
</li>
<li><p> a <code style="white-space: pre;">&#8288;/ping&#8288;</code> endpoint for the API health
</p>
</li>
<li><p> a <code style="white-space: pre;">&#8288;/prototype&#8288;</code> endpoint for the model's input data prototype (use
<code><a href="cereal.html#topic+cereal_to_json">cereal::cereal_from_json()</a></code>) to convert this back to a <a href="https://vctrs.r-lib.org/articles/type-size.html">vctrs ptype</a>
</p>
</li></ul>

<p>The function <code>vetiver_api()</code> uses:
</p>

<ul>
<li> <p><code>vetiver_pr_post()</code> for endpoint definition and
</p>
</li>
<li> <p><code>vetiver_pr_docs()</code> to create visual API documentation
</p>
</li></ul>

<p>These modular functions are available for more advanced use cases.
</p>


<h3>Value</h3>

<p>A Plumber router with the prediction endpoint added.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

cars_lm &lt;- lm(mpg ~ ., data = mtcars)
v &lt;- vetiver_model(cars_lm, "cars_linear")

library(plumber)
pr() %&gt;% vetiver_api(v)
## is the same as:
pr() %&gt;% vetiver_pr_post(v) %&gt;% vetiver_pr_docs(v)
## for either, next, pipe to `pr_run()`

</code></pre>

<hr>
<h2 id='vetiver_compute_metrics'>Aggregate model metrics over time for monitoring</h2><span id='topic+vetiver_compute_metrics'></span>

<h3>Description</h3>

<p>These three functions can be used for model monitoring (such as in a
monitoring dashboard):
</p>

<ul>
<li> <p><code>vetiver_compute_metrics()</code> computes metrics (such as accuracy for a
classification model or RMSE for a regression model) at a chosen time
aggregation <code>period</code>
</p>
</li>
<li> <p><code><a href="#topic+vetiver_pin_metrics">vetiver_pin_metrics()</a></code> updates an existing pin storing model metrics
over time
</p>
</li>
<li> <p><code><a href="#topic+vetiver_plot_metrics">vetiver_plot_metrics()</a></code> creates a plot of metrics over time
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>vetiver_compute_metrics(
  data,
  date_var,
  period,
  truth,
  estimate,
  ...,
  metric_set = yardstick::metrics,
  every = 1L,
  origin = NULL,
  before = 0L,
  after = 0L,
  complete = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_compute_metrics_+3A_data">data</code></td>
<td>
<p>A <code>data.frame</code> containing the columns specified by <code>truth</code>,
<code>estimate</code>, and <code>...</code>.</p>
</td></tr>
<tr><td><code id="vetiver_compute_metrics_+3A_date_var">date_var</code></td>
<td>
<p>The column in <code>data</code> containing dates or date-times for
monitoring, to be aggregated with <code>.period</code></p>
</td></tr>
<tr><td><code id="vetiver_compute_metrics_+3A_period">period</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character(1)]&#8288;</code>
</p>
<p>A string defining the period to group by. Valid inputs can be roughly
broken into:
</p>

<ul>
<li> <p><code>"year"</code>, <code>"quarter"</code>, <code>"month"</code>, <code>"week"</code>, <code>"day"</code>
</p>
</li>
<li> <p><code>"hour"</code>, <code>"minute"</code>, <code>"second"</code>, <code>"millisecond"</code>
</p>
</li>
<li> <p><code>"yweek"</code>, <code>"mweek"</code>
</p>
</li>
<li> <p><code>"yday"</code>, <code>"mday"</code>
</p>
</li></ul>
</td></tr>
<tr><td><code id="vetiver_compute_metrics_+3A_truth">truth</code></td>
<td>
<p>The column identifier for the true results (that
is <code>numeric</code> or <code>factor</code>). This should be an unquoted column name
although this argument is passed by expression and support
<a href="rlang.html#topic+topic-inject">quasiquotation</a> (you can unquote column
names).</p>
</td></tr>
<tr><td><code id="vetiver_compute_metrics_+3A_estimate">estimate</code></td>
<td>
<p>The column identifier for the predicted results
(that is also <code>numeric</code> or <code>factor</code>). As with <code>truth</code> this can be
specified different ways but the primary method is to use an
unquoted variable name.</p>
</td></tr>
<tr><td><code id="vetiver_compute_metrics_+3A_...">...</code></td>
<td>
<p>A set of unquoted column names or one or more
<code>dplyr</code> selector functions to choose which variables contain the
class probabilities. If <code>truth</code> is binary, only 1 column should be selected,
and it should correspond to the value of <code>event_level</code>. Otherwise, there
should be as many columns as factor levels of <code>truth</code> and the ordering of
the columns should be the same as the factor levels of <code>truth</code>.</p>
</td></tr>
<tr><td><code id="vetiver_compute_metrics_+3A_metric_set">metric_set</code></td>
<td>
<p>A <code><a href="yardstick.html#topic+metric_set">yardstick::metric_set()</a></code> function for computing metrics.
Defaults to <code><a href="yardstick.html#topic+metrics">yardstick::metrics()</a></code>.</p>
</td></tr>
<tr><td><code id="vetiver_compute_metrics_+3A_every">every</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[positive integer(1)]&#8288;</code>
</p>
<p>The number of periods to group together.
</p>
<p>For example, if the period was set to <code>"year"</code> with an every value of <code>2</code>,
then the years 1970 and 1971 would be placed in the same group.</p>
</td></tr>
<tr><td><code id="vetiver_compute_metrics_+3A_origin">origin</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[Date(1) / POSIXct(1) / POSIXlt(1) / NULL]&#8288;</code>
</p>
<p>The reference date time value. The default when left as <code>NULL</code> is the
epoch time of <code style="white-space: pre;">&#8288;1970-01-01 00:00:00&#8288;</code>, <em>in the time zone of the index</em>.
</p>
<p>This is generally used to define the anchor time to count from, which is
relevant when the every value is <code style="white-space: pre;">&#8288;&gt; 1&#8288;</code>.</p>
</td></tr>
<tr><td><code id="vetiver_compute_metrics_+3A_before">before</code>, <code id="vetiver_compute_metrics_+3A_after">after</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[integer(1) / Inf]&#8288;</code>
</p>
<p>The number of values before or after the current element to
include in the sliding window. Set to <code>Inf</code> to select all elements
before or after the current element. Negative values are allowed, which
allows you to &quot;look forward&quot; from the current element if used as the
<code>.before</code> value, or &quot;look backwards&quot; if used as <code>.after</code>.</p>
</td></tr>
<tr><td><code id="vetiver_compute_metrics_+3A_complete">complete</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[logical(1)]&#8288;</code>
</p>
<p>Should the function be evaluated on complete windows only? If <code>FALSE</code>,
the default, then partial computations will be allowed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For arguments used more than once in your monitoring dashboard,
such as <code>date_var</code>, consider using
<a href="https://bookdown.org/yihui/rmarkdown/parameterized-reports.html">R Markdown parameters</a>
to reduce repetition and/or errors.
</p>


<h3>Value</h3>

<p>A dataframe of metrics.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vetiver_pin_metrics">vetiver_pin_metrics()</a></code>, <code><a href="#topic+vetiver_plot_metrics">vetiver_plot_metrics()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(parsnip)
data(Chicago, package = "modeldata")
Chicago &lt;- Chicago %&gt;% select(ridership, date, all_of(stations))
training_data &lt;- Chicago %&gt;% filter(date &lt; "2009-01-01")
testing_data &lt;- Chicago %&gt;% filter(date &gt;= "2009-01-01", date &lt; "2011-01-01")
monitoring &lt;- Chicago %&gt;% filter(date &gt;= "2011-01-01", date &lt; "2012-12-31")
lm_fit &lt;- linear_reg() %&gt;% fit(ridership ~ ., data = training_data)

library(pins)
b &lt;- board_temp()

original_metrics &lt;-
    augment(lm_fit, new_data = testing_data) %&gt;%
    vetiver_compute_metrics(date, "week", ridership, .pred, every = 4L)

new_metrics &lt;-
    augment(lm_fit, new_data = monitoring) %&gt;%
    vetiver_compute_metrics(date, "week", ridership, .pred, every = 4L)

</code></pre>

<hr>
<h2 id='vetiver_create_description.train'>Model constructor methods</h2><span id='topic+vetiver_create_description.train'></span><span id='topic+vetiver_prepare_model.train'></span><span id='topic+vetiver_create_description.gam'></span><span id='topic+vetiver_prepare_model.gam'></span><span id='topic+vetiver_create_description.glm'></span><span id='topic+vetiver_prepare_model.glm'></span><span id='topic+vetiver_create_description.keras.engine.training.Model'></span><span id='topic+vetiver_prepare_model.keras.engine.training.Model'></span><span id='topic+vetiver_create_description.kproto'></span><span id='topic+vetiver_prepare_model.kproto'></span><span id='topic+vetiver_create_description.lm'></span><span id='topic+vetiver_prepare_model.lm'></span><span id='topic+vetiver_create_description.luz_module_fitted'></span><span id='topic+vetiver_prepare_model.luz_module_fitted'></span><span id='topic+vetiver_create_description.Learner'></span><span id='topic+vetiver_prepare_model.Learner'></span><span id='topic+vetiver_create_description'></span><span id='topic+vetiver_create_description.default'></span><span id='topic+vetiver_prepare_model'></span><span id='topic+vetiver_prepare_model.default'></span><span id='topic+vetiver_create_description.ranger'></span><span id='topic+vetiver_prepare_model.ranger'></span><span id='topic+vetiver_create_description.recipe'></span><span id='topic+vetiver_prepare_model.recipe'></span><span id='topic+vetiver_create_description.model_stack'></span><span id='topic+vetiver_prepare_model.model_stack'></span><span id='topic+vetiver_create_description.workflow'></span><span id='topic+vetiver_prepare_model.workflow'></span><span id='topic+vetiver_create_description.xgb.Booster'></span><span id='topic+vetiver_prepare_model.xgb.Booster'></span>

<h3>Description</h3>

<p>These are developer-facing functions, useful for supporting new model types.
Each model supported by <code><a href="#topic+vetiver_model">vetiver_model()</a></code> uses up to four methods when the
deployable object is created:
</p>

<ul>
<li><p> The <code>vetiver_create_description()</code> function generates a helpful description
of the model based on its characteristics. This method is required.
</p>
</li>
<li><p> The <code><a href="#topic+vetiver_create_meta">vetiver_create_meta()</a></code> function creates the correct <code><a href="#topic+vetiver_meta">vetiver_meta()</a></code>
for the model. This is especially helpful for specifying which packages are
needed for prediction. A model can use the default method here, which is
to have no special metadata.
</p>
</li>
<li><p> The <code><a href="#topic+vetiver_ptype">vetiver_ptype()</a></code> function finds an input data prototype from the
training data (a zero-row slice) to use for checking at prediction time.
This method is required.
</p>
</li>
<li><p> The <code>vetiver_prepare_model()</code> function executes last. Use this function
for tasks like checking if the model is trained and reducing the size of the
model via <code><a href="butcher.html#topic+butcher">butcher::butcher()</a></code>. A model can use the default method here,
which is to return the model without changes.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'train'
vetiver_create_description(model)

## S3 method for class 'train'
vetiver_prepare_model(model)

## S3 method for class 'gam'
vetiver_create_description(model)

## S3 method for class 'gam'
vetiver_prepare_model(model)

## S3 method for class 'glm'
vetiver_create_description(model)

## S3 method for class 'glm'
vetiver_prepare_model(model)

## S3 method for class 'keras.engine.training.Model'
vetiver_create_description(model)

## S3 method for class 'keras.engine.training.Model'
vetiver_prepare_model(model)

## S3 method for class 'kproto'
vetiver_create_description(model)

## S3 method for class 'kproto'
vetiver_prepare_model(model)

## S3 method for class 'lm'
vetiver_create_description(model)

## S3 method for class 'lm'
vetiver_prepare_model(model)

## S3 method for class 'luz_module_fitted'
vetiver_create_description(model)

## S3 method for class 'luz_module_fitted'
vetiver_prepare_model(model)

## S3 method for class 'Learner'
vetiver_create_description(model)

## S3 method for class 'Learner'
vetiver_prepare_model(model)

vetiver_create_description(model)

## Default S3 method:
vetiver_create_description(model)

vetiver_prepare_model(model)

## Default S3 method:
vetiver_prepare_model(model)

## S3 method for class 'ranger'
vetiver_create_description(model)

## S3 method for class 'ranger'
vetiver_prepare_model(model)

## S3 method for class 'recipe'
vetiver_create_description(model)

## S3 method for class 'recipe'
vetiver_prepare_model(model)

## S3 method for class 'model_stack'
vetiver_create_description(model)

## S3 method for class 'model_stack'
vetiver_prepare_model(model)

## S3 method for class 'workflow'
vetiver_create_description(model)

## S3 method for class 'workflow'
vetiver_prepare_model(model)

## S3 method for class 'xgb.Booster'
vetiver_create_description(model)

## S3 method for class 'xgb.Booster'
vetiver_prepare_model(model)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_create_description.train_+3A_model">model</code></td>
<td>
<p>A trained model, such as an <code>lm()</code> model or a tidymodels
<code><a href="workflows.html#topic+workflow">workflows::workflow()</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These are four generics that use the class of <code>model</code> for dispatch.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cars_lm &lt;- lm(mpg ~ ., data = mtcars)
vetiver_create_description(cars_lm)
vetiver_prepare_model(cars_lm)

</code></pre>

<hr>
<h2 id='vetiver_create_meta.train'>Metadata constructors for <code>vetiver_model()</code> object</h2><span id='topic+vetiver_create_meta.train'></span><span id='topic+vetiver_create_meta.gam'></span><span id='topic+vetiver_create_meta.keras.engine.training.Model'></span><span id='topic+vetiver_create_meta.kproto'></span><span id='topic+vetiver_create_meta.luz_module_fitted'></span><span id='topic+vetiver_meta'></span><span id='topic+vetiver_create_meta'></span><span id='topic+vetiver_create_meta.default'></span><span id='topic+vetiver_create_meta.Learner'></span><span id='topic+vetiver_create_meta.ranger'></span><span id='topic+vetiver_create_meta.recipe'></span><span id='topic+vetiver_create_meta.model_stack'></span><span id='topic+vetiver_create_meta.workflow'></span><span id='topic+vetiver_create_meta.xgb.Booster'></span>

<h3>Description</h3>

<p>These are developer-facing functions, useful for supporting new model types.
The metadata stored in a <code><a href="#topic+vetiver_model">vetiver_model()</a></code> object has four elements:
</p>

<ul>
<li> <p><code style="white-space: pre;">&#8288;$user&#8288;</code>, the metadata supplied by the user
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;$version&#8288;</code>, the version of the pin (which can be <code>NULL</code> before pinning)
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;$url&#8288;</code>, the URL where the pin is located, if any
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;$required_pkgs&#8288;</code>, a character string of R packages required for prediction
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'train'
vetiver_create_meta(model, metadata)

## S3 method for class 'gam'
vetiver_create_meta(model, metadata)

## S3 method for class 'keras.engine.training.Model'
vetiver_create_meta(model, metadata)

## S3 method for class 'kproto'
vetiver_create_meta(model, metadata)

## S3 method for class 'luz_module_fitted'
vetiver_create_meta(model, metadata)

vetiver_meta(user = list(), version = NULL, url = NULL, required_pkgs = NULL)

vetiver_create_meta(model, metadata)

## Default S3 method:
vetiver_create_meta(model, metadata)

## S3 method for class 'Learner'
vetiver_create_meta(model, metadata)

## S3 method for class 'ranger'
vetiver_create_meta(model, metadata)

## S3 method for class 'recipe'
vetiver_create_meta(model, metadata)

## S3 method for class 'model_stack'
vetiver_create_meta(model, metadata)

## S3 method for class 'workflow'
vetiver_create_meta(model, metadata)

## S3 method for class 'xgb.Booster'
vetiver_create_meta(model, metadata)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_create_meta.train_+3A_model">model</code></td>
<td>
<p>A trained model, such as an <code>lm()</code> model or a tidymodels
<code><a href="workflows.html#topic+workflow">workflows::workflow()</a></code>.</p>
</td></tr>
<tr><td><code id="vetiver_create_meta.train_+3A_metadata">metadata</code></td>
<td>
<p>A list containing additional metadata to store with the pin.
When retrieving the pin, this will be stored in the <code>user</code> key, to
avoid potential clashes with the metadata that pins itself uses.</p>
</td></tr>
<tr><td><code id="vetiver_create_meta.train_+3A_user">user</code></td>
<td>
<p>Metadata supplied by the user</p>
</td></tr>
<tr><td><code id="vetiver_create_meta.train_+3A_version">version</code></td>
<td>
<p>Version of the pin</p>
</td></tr>
<tr><td><code id="vetiver_create_meta.train_+3A_url">url</code></td>
<td>
<p>URL for the pin, if any</p>
</td></tr>
<tr><td><code id="vetiver_create_meta.train_+3A_required_pkgs">required_pkgs</code></td>
<td>
<p>Character string of R packages required for prediction</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The <code>vetiver_meta()</code> constructor returns a list. The
<code>vetiver_create_meta</code> function returns a <code>vetiver_meta()</code> list.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>vetiver_meta()

cars_lm &lt;- lm(mpg ~ ., data = mtcars)
vetiver_create_meta(cars_lm, list())

</code></pre>

<hr>
<h2 id='vetiver_create_rsconnect_bundle'>Create an Posit Connect bundle for a vetiver model API</h2><span id='topic+vetiver_create_rsconnect_bundle'></span>

<h3>Description</h3>

<p>Use <code>vetiver_create_rsconnect_bundle()</code> to create an Posit Connect model
API bundle for a <code><a href="#topic+vetiver_model">vetiver_model()</a></code> that has been versioned and stored via
<code><a href="#topic+vetiver_pin_write">vetiver_pin_write()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vetiver_create_rsconnect_bundle(
  board,
  name,
  version = NULL,
  predict_args = list(),
  filename = fs::file_temp(pattern = "bundle", ext = ".tar.gz")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_create_rsconnect_bundle_+3A_board">board</code></td>
<td>
<p>A pin board, created by <code><a href="pins.html#topic+board_folder">board_folder()</a></code>, <code><a href="pins.html#topic+board_connect">board_connect()</a></code>,
<code><a href="pins.html#topic+board_url">board_url()</a></code> or another <code>board_</code> function.</p>
</td></tr>
<tr><td><code id="vetiver_create_rsconnect_bundle_+3A_name">name</code></td>
<td>
<p>Pin name.</p>
</td></tr>
<tr><td><code id="vetiver_create_rsconnect_bundle_+3A_version">version</code></td>
<td>
<p>Retrieve a specific version of a pin. Use <code><a href="pins.html#topic+pin_versions">pin_versions()</a></code> to
find out which versions are available and when they were created.</p>
</td></tr>
<tr><td><code id="vetiver_create_rsconnect_bundle_+3A_predict_args">predict_args</code></td>
<td>
<p>A list of optional arguments passed to <code><a href="#topic+vetiver_api">vetiver_api()</a></code>
such as the prediction <code>type</code>.</p>
</td></tr>
<tr><td><code id="vetiver_create_rsconnect_bundle_+3A_filename">filename</code></td>
<td>
<p>The path for the model API bundle to be created (can be
used as the argument to <code>connectapi::bundle_path()</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function creates a deployable bundle. See
<a href="https://docs.posit.co/connect/cookbook/deploying/">Posit Connect docs</a>
for how to deploy this bundle, as well as the
<a href="https://pkgs.rstudio.com/connectapi/">connectapi</a> R package for how to
integrate with Connect's API from R.
</p>
<p>The two functions <code>vetiver_create_rsconnect_bundle()</code> and
<code><a href="#topic+vetiver_deploy_rsconnect">vetiver_deploy_rsconnect()</a></code> are alternatives to each other, providing
different strategies for deploying a vetiver model API to Posit Connect.
</p>


<h3>Value</h3>

<p>The location of the model API bundle <code>filename</code>, invisibly.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vetiver_write_plumber">vetiver_write_plumber()</a></code>, <code><a href="#topic+vetiver_deploy_rsconnect">vetiver_deploy_rsconnect()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(pins)
b &lt;- board_temp(versioned = TRUE)
cars_lm &lt;- lm(mpg ~ ., data = mtcars)
v &lt;- vetiver_model(cars_lm, "cars_linear")
vetiver_pin_write(b, v)

## when you pin to Posit Connect, your pin name will be typically be like:
## "user.name/cars_linear"
vetiver_create_rsconnect_bundle(
    b,
    "cars_linear",
    predict_args = list(debug = TRUE)
)

</code></pre>

<hr>
<h2 id='vetiver_dashboard'>R Markdown format for model monitoring dashboards</h2><span id='topic+vetiver_dashboard'></span><span id='topic+get_vetiver_dashboard_pins'></span><span id='topic+pin_example_kc_housing_model'></span>

<h3>Description</h3>

<p>R Markdown format for model monitoring dashboards
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vetiver_dashboard(pins = list(), display_pins = TRUE, ...)

get_vetiver_dashboard_pins()

pin_example_kc_housing_model(board = pins::board_local(), name = "seattle_rf")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_dashboard_+3A_pins">pins</code></td>
<td>
<p>A list containing <code>board</code>, <code>name</code>, and <code>version</code>, as in
<code><a href="pins.html#topic+pin_read">pins::pin_read()</a></code></p>
</td></tr>
<tr><td><code id="vetiver_dashboard_+3A_display_pins">display_pins</code></td>
<td>
<p>Should the dashboard display a link to the pin(s)?
Defaults to <code>TRUE</code>, but only creates a link if the pin contains a URL in
its metadata.</p>
</td></tr>
<tr><td><code id="vetiver_dashboard_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="flexdashboard.html#topic+flex_dashboard">flexdashboard::flex_dashboard()</a></code></p>
</td></tr>
<tr><td><code id="vetiver_dashboard_+3A_board">board</code></td>
<td>
<p>A pin board, created by <code><a href="pins.html#topic+board_folder">board_folder()</a></code>, <code><a href="pins.html#topic+board_connect">board_connect()</a></code>,
<code><a href="pins.html#topic+board_url">board_url()</a></code> or another <code>board_</code> function.</p>
</td></tr>
<tr><td><code id="vetiver_dashboard_+3A_name">name</code></td>
<td>
<p>Pin name.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>vetiver_dashboard()</code> function is a specialized type of
<span class="pkg">flexdashboard</span>. See the flexdashboard website for additional
documentation:
<a href="https://pkgs.rstudio.com/flexdashboard/">https://pkgs.rstudio.com/flexdashboard/</a>
</p>
<p>Before knitting the example <code>vetiver_dashboard()</code> template, execute the
helper function <code>pin_example_kc_housing_model()</code> to set up demonstration
model and metrics pins needed for the monitoring demo. This function will:
</p>

<ul>
<li><p> fit an example model to training data
</p>
</li>
<li><p> pin the vetiver model to your own <code><a href="pins.html#topic+board_folder">pins::board_local()</a></code>
</p>
</li>
<li><p> compute metrics from testing data
</p>
</li>
<li><p> pin these metrics to the same local board
</p>
</li></ul>

<p>These are the steps you need to complete before setting up monitoring your
real model.
</p>

<hr>
<h2 id='vetiver_deploy_rsconnect'>Deploy a vetiver model API to Posit Connect</h2><span id='topic+vetiver_deploy_rsconnect'></span>

<h3>Description</h3>

<p>Use <code>vetiver_deploy_rsconnect()</code> to deploy a <code><a href="#topic+vetiver_model">vetiver_model()</a></code> that has been
versioned and stored via <code><a href="#topic+vetiver_pin_write">vetiver_pin_write()</a></code> as a Plumber API on RStudio
Connect.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vetiver_deploy_rsconnect(
  board,
  name,
  version = NULL,
  predict_args = list(),
  appTitle = glue::glue("{name} model API"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_deploy_rsconnect_+3A_board">board</code></td>
<td>
<p>A pin board, created by <code><a href="pins.html#topic+board_folder">board_folder()</a></code>, <code><a href="pins.html#topic+board_connect">board_connect()</a></code>,
<code><a href="pins.html#topic+board_url">board_url()</a></code> or another <code>board_</code> function.</p>
</td></tr>
<tr><td><code id="vetiver_deploy_rsconnect_+3A_name">name</code></td>
<td>
<p>Pin name.</p>
</td></tr>
<tr><td><code id="vetiver_deploy_rsconnect_+3A_version">version</code></td>
<td>
<p>Retrieve a specific version of a pin. Use <code><a href="pins.html#topic+pin_versions">pin_versions()</a></code> to
find out which versions are available and when they were created.</p>
</td></tr>
<tr><td><code id="vetiver_deploy_rsconnect_+3A_predict_args">predict_args</code></td>
<td>
<p>A list of optional arguments passed to <code><a href="#topic+vetiver_api">vetiver_api()</a></code>
such as the prediction <code>type</code>.</p>
</td></tr>
<tr><td><code id="vetiver_deploy_rsconnect_+3A_apptitle">appTitle</code></td>
<td>
<p>The API title on Posit Connect. Use the default based on
<code>name</code>, or pass in your own title.</p>
</td></tr>
<tr><td><code id="vetiver_deploy_rsconnect_+3A_...">...</code></td>
<td>
<p>Other arguments passed to <code><a href="rsconnect.html#topic+deployApp">rsconnect::deployApp()</a></code> such as
<code>appName</code>, <code>account</code>, or <code>launch.browser</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The two functions <code>vetiver_deploy_rsconnect()</code> and
<code><a href="#topic+vetiver_create_rsconnect_bundle">vetiver_create_rsconnect_bundle()</a></code> are alternatives to each other, providing
different strategies for deploying a vetiver model API to Posit Connect.
</p>
<p>When you first deploy to Connect, your API will only be accessible to you.
You can <a href="https://docs.posit.co/connect/user/content-settings/#set-viewers">change the access settings</a>
so others can also access the API. For all access settings other than
&quot;Anyone - no login required&quot;, anyone querying your API (including you)
will need to pass authentication details with your API call,
<a href="https://docs.posit.co/connect/user/vetiver/#predict-from-your-model-endpoint">as shown in the Connect documentation</a>.
</p>


<h3>Value</h3>

<p>The deployment success (<code>TRUE</code> or <code>FALSE</code>), invisibly.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vetiver_write_plumber">vetiver_write_plumber()</a></code>, <code><a href="#topic+vetiver_create_rsconnect_bundle">vetiver_create_rsconnect_bundle()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(pins)
b &lt;- board_temp(versioned = TRUE)
cars_lm &lt;- lm(mpg ~ ., data = mtcars)
v &lt;- vetiver_model(cars_lm, "cars_linear")
vetiver_pin_write(b, v)

if (FALSE) {
## pass args for predicting:
vetiver_deploy_rsconnect(
    b,
    "user.name/cars_linear",
    predict_args = list(debug = TRUE)
)

## specify an account name through `...`:
vetiver_deploy_rsconnect(
    b,
    "user.name/cars_linear",
    account = "user.name"
)
}

</code></pre>

<hr>
<h2 id='vetiver_deploy_sagemaker'>Deploy a vetiver model API to Amazon SageMaker</h2><span id='topic+vetiver_deploy_sagemaker'></span>

<h3>Description</h3>

<p>Use <code>vetiver_deploy_sagemaker()</code> to deploy a <code><a href="#topic+vetiver_model">vetiver_model()</a></code>
that has been versioned and stored via <code><a href="#topic+vetiver_pin_write">vetiver_pin_write()</a></code> as a Plumber API
on Amazon SageMaker.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vetiver_deploy_sagemaker(
  board,
  name,
  instance_type,
  ...,
  predict_args = list(),
  docker_args = list(),
  build_args = list(),
  endpoint_args = list(),
  repo_name = glue("vetiver-sagemaker-{name}")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_deploy_sagemaker_+3A_board">board</code></td>
<td>
<p>An AWS S3 board created with <code><a href="pins.html#topic+board_s3">pins::board_s3()</a></code>. This board
must be in the correct region for your SageMaker instance.</p>
</td></tr>
<tr><td><code id="vetiver_deploy_sagemaker_+3A_name">name</code></td>
<td>
<p>Pin name.</p>
</td></tr>
<tr><td><code id="vetiver_deploy_sagemaker_+3A_instance_type">instance_type</code></td>
<td>
<p>Type of EC2 instance to use; see
<a href="https://aws.amazon.com/sagemaker/pricing/">Amazon SageMaker pricing</a>.</p>
</td></tr>
<tr><td><code id="vetiver_deploy_sagemaker_+3A_...">...</code></td>
<td>
<p>Not currently used.</p>
</td></tr>
<tr><td><code id="vetiver_deploy_sagemaker_+3A_predict_args">predict_args</code></td>
<td>
<p>A list of optional arguments passed to <code><a href="#topic+vetiver_api">vetiver_api()</a></code>
such as the prediction <code>type</code>.</p>
</td></tr>
<tr><td><code id="vetiver_deploy_sagemaker_+3A_docker_args">docker_args</code></td>
<td>
<p>A list of optional arguments passed to
<code><a href="#topic+vetiver_write_docker">vetiver_write_docker()</a></code> such as the <code>lockfile</code> name or whether to use
<code>rspm</code>. Do not pass <code>additional_pkgs</code> here, as this function uses
<code>additional_pkgs = required_pkgs(board)</code>.</p>
</td></tr>
<tr><td><code id="vetiver_deploy_sagemaker_+3A_build_args">build_args</code></td>
<td>
<p>A list of optional arguments passed to
<code><a href="#topic+vetiver_sm_build">vetiver_sm_build()</a></code> such as the model <code>version</code> or the <code>compute_type</code>.</p>
</td></tr>
<tr><td><code id="vetiver_deploy_sagemaker_+3A_endpoint_args">endpoint_args</code></td>
<td>
<p>A list of optional arguments passed to
<code><a href="#topic+vetiver_sm_endpoint">vetiver_sm_endpoint()</a></code> such as <code>accelerator_type</code> or <code>data_capture_config</code>.</p>
</td></tr>
<tr><td><code id="vetiver_deploy_sagemaker_+3A_repo_name">repo_name</code></td>
<td>
<p>The name for the AWS ECR repository to store the model.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function stores your model deployment image in the same bucket used
by <code>board</code>.
</p>
<p>The function <code>vetiver_deploy_sagemaker()</code> uses:
</p>

<ul>
<li> <p><code><a href="#topic+vetiver_sm_build">vetiver_sm_build()</a></code> to build and push a Docker image to ECR,
</p>
</li>
<li> <p><code><a href="#topic+vetiver_sm_model">vetiver_sm_model()</a></code> to create a SageMaker model, and
</p>
</li>
<li> <p><code><a href="#topic+vetiver_sm_endpoint">vetiver_sm_endpoint()</a></code> to deploy a SageMaker model endpoint.
</p>
</li></ul>

<p>These modular functions are available for more advanced use cases.
</p>
<p>If you are working locally, you will likely need to explicitly set up
your execution role to work correctly. Check out
<a href="https://dyfanjones.r-universe.dev/smdocker">&quot;Execution role requirements&quot;</a>
in the smdocker documentation, and especially note that the bucket containing
your vetiver model needs to be added as a resource in your IAM role policy.
</p>


<h3>Value</h3>

<p>The deployed <code><a href="#topic+vetiver_endpoint_sagemaker">vetiver_endpoint_sagemaker()</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vetiver_sm_build">vetiver_sm_build()</a></code>, <code><a href="#topic+vetiver_sm_model">vetiver_sm_model()</a></code>, <code><a href="#topic+vetiver_sm_endpoint">vetiver_sm_endpoint()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if (FALSE) {
library(pins)
b &lt;- board_s3(bucket = "my-existing-bucket")
cars_lm &lt;- lm(mpg ~ ., data = mtcars)
v &lt;- vetiver_model(cars_lm, "cars_linear")
vetiver_pin_write(b, v)

endpoint &lt;- vetiver_deploy_sagemaker(
    board = b,
    name = "cars_linear",
    instance_type = "ml.t2.medium",
    predict_args = list(type = "class", debug = TRUE)
)
}

</code></pre>

<hr>
<h2 id='vetiver_endpoint'>Create a model API endpoint object for prediction</h2><span id='topic+vetiver_endpoint'></span>

<h3>Description</h3>

<p>This function creates a model API endpoint for prediction from a URL. No
HTTP calls are made until you actually
<code><a href="#topic+predict.vetiver_endpoint">predict()</a></code> with your endpoint.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vetiver_endpoint(url)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_endpoint_+3A_url">url</code></td>
<td>
<p>An API endpoint URL</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A new <code>vetiver_endpoint</code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>vetiver_endpoint("https://colorado.rstudio.com/rsc/seattle-housing/predict")

</code></pre>

<hr>
<h2 id='vetiver_endpoint_sagemaker'>Create a SageMaker model API endpoint object for prediction</h2><span id='topic+vetiver_endpoint_sagemaker'></span>

<h3>Description</h3>

<p>This function creates a model API endpoint for prediction from a Sagemaker Model.
No HTTP calls are made until you actually
<code><a href="#topic+predict.vetiver_endpoint_sagemaker">predict()</a></code> with your endpoint.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vetiver_endpoint_sagemaker(model_endpoint)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_endpoint_sagemaker_+3A_model_endpoint">model_endpoint</code></td>
<td>
<p>The name of the Amazon SageMaker model endpoint.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A new <code>vetiver_endpoint_sagemaker</code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
vetiver_endpoint_sagemaker("vetiver-sagemaker-demo-model")

</code></pre>

<hr>
<h2 id='vetiver_model'>Create a vetiver object for deployment of a trained model</h2><span id='topic+vetiver_model'></span><span id='topic+new_vetiver_model'></span>

<h3>Description</h3>

<p>A <code>vetiver_model()</code> object collects the information needed to store, version,
and deploy a trained model. Once your <code>vetiver_model()</code> object has been
created, you can:
</p>

<ul>
<li><p> store and version it as a pin with <code><a href="#topic+vetiver_pin_write">vetiver_pin_write()</a></code>
</p>
</li>
<li><p> create an API endpoint for it with <code><a href="#topic+vetiver_api">vetiver_api()</a></code>
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>vetiver_model(
  model,
  model_name,
  ...,
  description = NULL,
  metadata = list(),
  save_prototype = TRUE,
  save_ptype = deprecated(),
  versioned = NULL
)

new_vetiver_model(
  model,
  model_name,
  description,
  metadata,
  prototype,
  versioned
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_model_+3A_model">model</code></td>
<td>
<p>A trained model, such as an <code>lm()</code> model or a tidymodels
<code><a href="workflows.html#topic+workflow">workflows::workflow()</a></code>.</p>
</td></tr>
<tr><td><code id="vetiver_model_+3A_model_name">model_name</code></td>
<td>
<p>Model name or ID.</p>
</td></tr>
<tr><td><code id="vetiver_model_+3A_...">...</code></td>
<td>
<p>Other method-specific arguments passed to <code><a href="#topic+vetiver_ptype">vetiver_ptype()</a></code>
to compute an input data prototype, such as <code>prototype_data</code> (a sample of
training features).</p>
</td></tr>
<tr><td><code id="vetiver_model_+3A_description">description</code></td>
<td>
<p>A detailed description of the model. If omitted, a brief
description of the model will be generated.</p>
</td></tr>
<tr><td><code id="vetiver_model_+3A_metadata">metadata</code></td>
<td>
<p>A list containing additional metadata to store with the pin.
When retrieving the pin, this will be stored in the <code>user</code> key, to
avoid potential clashes with the metadata that pins itself uses.</p>
</td></tr>
<tr><td><code id="vetiver_model_+3A_save_prototype">save_prototype</code></td>
<td>
<p>Should an input data prototype be stored with the model?
The options are <code>TRUE</code> (the default, which stores a zero-row slice of the
training data), <code>FALSE</code> (no input data prototype for visual documentation or
checking), or a dataframe to be used for both checking at prediction time
<em>and</em> examples in API visual documentation.</p>
</td></tr>
<tr><td><code id="vetiver_model_+3A_save_ptype">save_ptype</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a></p>
</td></tr>
<tr><td><code id="vetiver_model_+3A_versioned">versioned</code></td>
<td>
<p>Should the model object be versioned when stored with
<code><a href="#topic+vetiver_pin_write">vetiver_pin_write()</a></code>? The default, <code>NULL</code>, will use the default for the
<code>board</code> where you store the model.</p>
</td></tr>
<tr><td><code id="vetiver_model_+3A_prototype">prototype</code></td>
<td>
<p>An input data prototype. If <code>NULL</code>, there is no checking of
new data at prediction time.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>You can provide your own data to <code>save_prototype</code> to use as examples in the
visual documentation created by <code><a href="#topic+vetiver_api">vetiver_api()</a></code>. If you do this,
consider checking that your input data prototype has the same structure
as your training data (perhaps with <code><a href="hardhat.html#topic+scream">hardhat::scream()</a></code>) and/or simulating
data to avoid leaking PII via your deployed model.
</p>
<p>Some models, like <code><a href="ranger.html#topic+ranger">ranger::ranger()</a></code>, <a href="https://tensorflow.rstudio.com/">keras</a>,
and <a href="https://torch.mlverse.org/">luz (torch)</a>,
<em>require</em> that you pass in example training data as <code>prototype_data</code>
or else explicitly set <code>save_prototype = FALSE</code>. For non-rectangular data
input to models, such as image input for a keras or torch model, we currently
recommend that you turn off prototype checking via <code>save_prototype = FALSE</code>.
</p>


<h3>Value</h3>

<p>A new <code>vetiver_model</code> object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cars_lm &lt;- lm(mpg ~ ., data = mtcars)
vetiver_model(cars_lm, "cars-linear")

</code></pre>

<hr>
<h2 id='vetiver_pin_metrics'>Update model metrics over time for monitoring</h2><span id='topic+vetiver_pin_metrics'></span>

<h3>Description</h3>

<p>These three functions can be used for model monitoring (such as in a
monitoring dashboard):
</p>

<ul>
<li> <p><code><a href="#topic+vetiver_compute_metrics">vetiver_compute_metrics()</a></code> computes metrics (such as accuracy for a
classification model or RMSE for a regression model) at a chosen time
aggregation <code>period</code>
</p>
</li>
<li> <p><code>vetiver_pin_metrics()</code> updates an existing pin storing model metrics
over time
</p>
</li>
<li> <p><code><a href="#topic+vetiver_plot_metrics">vetiver_plot_metrics()</a></code> creates a plot of metrics over time
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>vetiver_pin_metrics(
  board,
  df_metrics,
  metrics_pin_name,
  .index = .index,
  overwrite = FALSE,
  type = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_pin_metrics_+3A_board">board</code></td>
<td>
<p>A pin board, created by <code><a href="pins.html#topic+board_folder">board_folder()</a></code>, <code><a href="pins.html#topic+board_connect">board_connect()</a></code>,
<code><a href="pins.html#topic+board_url">board_url()</a></code> or another <code>board_</code> function.</p>
</td></tr>
<tr><td><code id="vetiver_pin_metrics_+3A_df_metrics">df_metrics</code></td>
<td>
<p>A tidy dataframe of metrics over time, such as created by
<code><a href="#topic+vetiver_compute_metrics">vetiver_compute_metrics()</a></code>.</p>
</td></tr>
<tr><td><code id="vetiver_pin_metrics_+3A_metrics_pin_name">metrics_pin_name</code></td>
<td>
<p>Pin name for where the <em>metrics</em> are stored (as
opposed to where the model object is stored with <code><a href="#topic+vetiver_pin_write">vetiver_pin_write()</a></code>).</p>
</td></tr>
<tr><td><code id="vetiver_pin_metrics_+3A_.index">.index</code></td>
<td>
<p>The variable in <code>df_metrics</code> containing the aggregated dates
or date-times (from <code>time_var</code> in <code>data</code>). Defaults to <code>.index</code>.</p>
</td></tr>
<tr><td><code id="vetiver_pin_metrics_+3A_overwrite">overwrite</code></td>
<td>
<p>If <code>FALSE</code> (the default), error when the new metrics contain
overlapping dates with the existing pin.If <code>TRUE</code>, overwrite any metrics for
dates that exist both in the existing pin and new metrics with the <em>new</em>
values.</p>
</td></tr>
<tr><td><code id="vetiver_pin_metrics_+3A_type">type</code></td>
<td>
<p>File type used to save metrics to disk. With the default <code>NULL</code>,
uses the <code>type</code> of the existing pin. Options are &quot;rds&quot; and &quot;arrow&quot;.</p>
</td></tr>
<tr><td><code id="vetiver_pin_metrics_+3A_...">...</code></td>
<td>
<p>Additional arguments passed on to methods for a specific board.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Sometimes when you monitor a model at a given time aggregation, you
may end up with dates in your new metrics (like <code>new_metrics</code> in the example)
that are the same as dates in your existing aggregated metrics (like
<code>original_metrics</code> in the example). This can happen if you need to re-run a
monitoring report because something failed. With <code>overwrite = FALSE</code> (the
default), <code>vetiver_pin_metrics()</code> will error when there are overlapping
dates. With <code>overwrite = TRUE</code>, <code>vetiver_pin_metrics()</code> will replace such
metrics with the new values. You probably want <code>FALSE</code> for interactive use
and <code>TRUE</code> for dashboards or reports that run on a schedule.
</p>
<p>You can initially create your pin with <code>type = "arrow"</code> or the default
(<code>type = "rds"</code>). <code>vetiver_pin_metrics()</code> will update the pin using the
same <code>type</code> by default.
</p>


<h3>Value</h3>

<p>A dataframe of metrics.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vetiver_compute_metrics">vetiver_compute_metrics()</a></code>, <code><a href="#topic+vetiver_plot_metrics">vetiver_plot_metrics()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(parsnip)
data(Chicago, package = "modeldata")
Chicago &lt;- Chicago %&gt;% select(ridership, date, all_of(stations))
training_data &lt;- Chicago %&gt;% filter(date &lt; "2009-01-01")
testing_data &lt;- Chicago %&gt;% filter(date &gt;= "2009-01-01", date &lt; "2011-01-01")
monitoring &lt;- Chicago %&gt;% filter(date &gt;= "2011-01-01", date &lt; "2012-12-31")
lm_fit &lt;- linear_reg() %&gt;% fit(ridership ~ ., data = training_data)

library(pins)
b &lt;- board_temp()

## before starting monitoring, initiate the metrics and pin
## (for example, with the testing data):
original_metrics &lt;-
    augment(lm_fit, new_data = testing_data) %&gt;%
    vetiver_compute_metrics(date, "week", ridership, .pred, every = 4L)
pin_write(b, original_metrics, "lm_fit_metrics", type = "arrow")

## to continue monitoring with new data, compute metrics and update pin:
new_metrics &lt;-
    augment(lm_fit, new_data = monitoring) %&gt;%
    vetiver_compute_metrics(date, "week", ridership, .pred, every = 4L)
vetiver_pin_metrics(b, new_metrics, "lm_fit_metrics")

</code></pre>

<hr>
<h2 id='vetiver_pin_write'>Read and write a trained model to a board of models</h2><span id='topic+vetiver_pin_write'></span><span id='topic+vetiver_pin_read'></span>

<h3>Description</h3>

<p>Use <code>vetiver_pin_write()</code> to pin a trained model to a board of models,
along with an input prototype for new data and other model metadata. Use
<code>vetiver_pin_read()</code> to retrieve that pinned object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vetiver_pin_write(board, vetiver_model, ..., check_renv = FALSE)

vetiver_pin_read(board, name, version = NULL, check_renv = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_pin_write_+3A_board">board</code></td>
<td>
<p>A pin board, created by <code><a href="pins.html#topic+board_folder">board_folder()</a></code>, <code><a href="pins.html#topic+board_connect">board_connect()</a></code>,
<code><a href="pins.html#topic+board_url">board_url()</a></code> or another <code>board_</code> function.</p>
</td></tr>
<tr><td><code id="vetiver_pin_write_+3A_vetiver_model">vetiver_model</code></td>
<td>
<p>A deployable <code><a href="#topic+vetiver_model">vetiver_model()</a></code> object</p>
</td></tr>
<tr><td><code id="vetiver_pin_write_+3A_...">...</code></td>
<td>
<p>Additional arguments passed on to methods for a specific board.</p>
</td></tr>
<tr><td><code id="vetiver_pin_write_+3A_check_renv">check_renv</code></td>
<td>
<p>Use <a href="https://rstudio.github.io/renv/">renv</a> to record the
packages used at training time with <code>vetiver_pin_write()</code> and check for
differences with <code>vetiver_pin_read()</code>. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="vetiver_pin_write_+3A_name">name</code></td>
<td>
<p>Pin name.</p>
</td></tr>
<tr><td><code id="vetiver_pin_write_+3A_version">version</code></td>
<td>
<p>Retrieve a specific version of a pin. Use <code><a href="pins.html#topic+pin_versions">pin_versions()</a></code> to
find out which versions are available and when they were created.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These functions read and write a <code><a href="#topic+vetiver_model">vetiver_model()</a></code> pin on the
specified <code>board</code> containing the model object itself and other elements
needed for prediction, such as the model's input data prototype or which
packages are needed at prediction time. You may use <code><a href="pins.html#topic+pin_read">pins::pin_read()</a></code> or
<code><a href="pins.html#topic+pin_meta">pins::pin_meta()</a></code> to handle the pin, but <code>vetiver_pin_read()</code> returns a
<code><a href="#topic+vetiver_model">vetiver_model()</a></code> object ready for deployment.
</p>


<h3>Value</h3>

<p><code>vetiver_pin_read()</code> returns a <code><a href="#topic+vetiver_model">vetiver_model()</a></code>; <code>vetiver_pin_write()</code>
returns the name of the new pin, invisibly.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(pins)
model_board &lt;- board_temp()

cars_lm &lt;- lm(mpg ~ ., data = mtcars)
v &lt;- vetiver_model(cars_lm, "cars_linear")
vetiver_pin_write(model_board, v)
model_board

vetiver_pin_read(model_board, "cars_linear")

# can use `version` argument to read a specific version:
pin_versions(model_board, "cars_linear")

# can store an renv lockfile as part of the pin:
vetiver_pin_write(model_board, v, check_renv = TRUE)

</code></pre>

<hr>
<h2 id='vetiver_plot_metrics'>Plot model metrics over time for monitoring</h2><span id='topic+vetiver_plot_metrics'></span>

<h3>Description</h3>

<p>These three functions can be used for model monitoring (such as in a
monitoring dashboard):
</p>

<ul>
<li> <p><code><a href="#topic+vetiver_compute_metrics">vetiver_compute_metrics()</a></code> computes metrics (such as accuracy for a
classification model or RMSE for a regression model) at a chosen time
aggregation <code>period</code>
</p>
</li>
<li> <p><code><a href="#topic+vetiver_pin_metrics">vetiver_pin_metrics()</a></code> updates an existing pin storing model metrics
over time
</p>
</li>
<li> <p><code>vetiver_plot_metrics()</code> creates a plot of metrics over time
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>vetiver_plot_metrics(
  df_metrics,
  .index = .index,
  .estimate = .estimate,
  .metric = .metric,
  .n = .n
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_plot_metrics_+3A_df_metrics">df_metrics</code></td>
<td>
<p>A tidy dataframe of metrics over time, such as created by
<code><a href="#topic+vetiver_compute_metrics">vetiver_compute_metrics()</a></code>.</p>
</td></tr>
<tr><td><code id="vetiver_plot_metrics_+3A_.index">.index</code></td>
<td>
<p>The variable in <code>df_metrics</code> containing the aggregated dates
or date-times (from <code>time_var</code> in <code>data</code>). Defaults to <code>.index</code>.</p>
</td></tr>
<tr><td><code id="vetiver_plot_metrics_+3A_.estimate">.estimate</code></td>
<td>
<p>The variable in <code>df_metrics</code> containing the metric estimate.
Defaults to <code>.estimate</code>.</p>
</td></tr>
<tr><td><code id="vetiver_plot_metrics_+3A_.metric">.metric</code></td>
<td>
<p>The variable in <code>df_metrics</code> containing the metric type.
Defaults to <code>.metric</code>.</p>
</td></tr>
<tr><td><code id="vetiver_plot_metrics_+3A_.n">.n</code></td>
<td>
<p>The variable in <code>df_metrics</code> containing the number of observations
used for estimating the metric.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot2</code> object.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vetiver_compute_metrics">vetiver_compute_metrics()</a></code>, <code><a href="#topic+vetiver_pin_metrics">vetiver_pin_metrics()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(parsnip)
data(Chicago, package = "modeldata")
Chicago &lt;- Chicago %&gt;% select(ridership, date, all_of(stations))
training_data &lt;- Chicago %&gt;% filter(date &lt; "2009-01-01")
testing_data &lt;- Chicago %&gt;% filter(date &gt;= "2009-01-01", date &lt; "2011-01-01")
monitoring &lt;- Chicago %&gt;% filter(date &gt;= "2011-01-01", date &lt; "2012-12-31")
lm_fit &lt;- linear_reg() %&gt;% fit(ridership ~ ., data = training_data)

library(pins)
b &lt;- board_temp()

## before starting monitoring, initiate the metrics and pin
## (for example, with the testing data):
original_metrics &lt;-
    augment(lm_fit, new_data = testing_data) %&gt;%
    vetiver_compute_metrics(date, "week", ridership, .pred, every = 4L)
pin_write(b, original_metrics, "lm_fit_metrics", type = "arrow")

## to continue monitoring with new data, compute metrics and update pin:
new_metrics &lt;-
    augment(lm_fit, new_data = monitoring) %&gt;%
    vetiver_compute_metrics(date, "week", ridership, .pred, every = 4L)
vetiver_pin_metrics(b, new_metrics, "lm_fit_metrics")

library(ggplot2)
vetiver_plot_metrics(new_metrics) +
    scale_size(range = c(2, 4))

</code></pre>

<hr>
<h2 id='vetiver_pr_predict'>Create a Plumber API to predict with a deployable <code>vetiver_model()</code> object</h2><span id='topic+vetiver_pr_predict'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>
<p>This function was deprecated to use <a href="#topic+vetiver_api">vetiver_api</a> directly instead.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vetiver_pr_predict(
  pr,
  vetiver_model,
  path = "/predict",
  debug = is_interactive(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_pr_predict_+3A_pr">pr</code></td>
<td>
<p>A Plumber router, such as from <code><a href="plumber.html#topic+pr">plumber::pr()</a></code>.</p>
</td></tr>
<tr><td><code id="vetiver_pr_predict_+3A_vetiver_model">vetiver_model</code></td>
<td>
<p>A deployable <code><a href="#topic+vetiver_model">vetiver_model()</a></code> object</p>
</td></tr>
<tr><td><code id="vetiver_pr_predict_+3A_path">path</code></td>
<td>
<p>The endpoint path</p>
</td></tr>
<tr><td><code id="vetiver_pr_predict_+3A_debug">debug</code></td>
<td>
<p><code>TRUE</code> provides more insight into your API errors.</p>
</td></tr>
<tr><td><code id="vetiver_pr_predict_+3A_...">...</code></td>
<td>
<p>Other arguments passed to <code>predict()</code>, such as prediction <code>type</code></p>
</td></tr>
</table>

<hr>
<h2 id='vetiver_prepare_docker'>Generate files necessary to build a Docker container for a vetiver model</h2><span id='topic+vetiver_prepare_docker'></span>

<h3>Description</h3>

<p>Deploying a vetiver model via Docker requires several files. Use this
function to create these needed files in the directory located at <code>path</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vetiver_prepare_docker(
  board,
  name,
  version = NULL,
  path = ".",
  predict_args = list(),
  docker_args = list()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_prepare_docker_+3A_board">board</code></td>
<td>
<p>A pin board, created by <code><a href="pins.html#topic+board_folder">board_folder()</a></code>, <code><a href="pins.html#topic+board_connect">board_connect()</a></code>,
<code><a href="pins.html#topic+board_url">board_url()</a></code> or another <code>board_</code> function.</p>
</td></tr>
<tr><td><code id="vetiver_prepare_docker_+3A_name">name</code></td>
<td>
<p>Pin name.</p>
</td></tr>
<tr><td><code id="vetiver_prepare_docker_+3A_version">version</code></td>
<td>
<p>Retrieve a specific version of a pin. Use <code><a href="pins.html#topic+pin_versions">pin_versions()</a></code> to
find out which versions are available and when they were created.</p>
</td></tr>
<tr><td><code id="vetiver_prepare_docker_+3A_path">path</code></td>
<td>
<p>A path to write the Plumber file, Dockerfile, and lockfile,
capturing the model's dependencies.</p>
</td></tr>
<tr><td><code id="vetiver_prepare_docker_+3A_predict_args">predict_args</code></td>
<td>
<p>A list of optional arguments passed to <code><a href="#topic+vetiver_api">vetiver_api()</a></code>
such as the prediction <code>type</code>.</p>
</td></tr>
<tr><td><code id="vetiver_prepare_docker_+3A_docker_args">docker_args</code></td>
<td>
<p>A list of optional arguments passed to
<code><a href="#topic+vetiver_write_docker">vetiver_write_docker()</a></code> such as the <code>lockfile</code> name or whether to use
<code>rspm</code>. Do not pass <code>additional_pkgs</code> here, as this function uses
<code>additional_pkgs = required_pkgs(board)</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function <code>vetiver_prepare_docker()</code> uses:
</p>

<ul>
<li> <p><code><a href="#topic+vetiver_write_plumber">vetiver_write_plumber()</a></code> to create a Plumber file and
</p>
</li>
<li> <p><code><a href="#topic+vetiver_write_docker">vetiver_write_docker()</a></code> to create a Dockerfile and renv lockfile
</p>
</li></ul>

<p>These modular functions are available for more advanced use cases. For
models such as keras and torch, you will need to edit the generated
Dockerfile to, for example, <code style="white-space: pre;">&#8288;COPY requirements.txt requirements.txt&#8288;</code> or
similar.
</p>


<h3>Value</h3>

<p>An invisible <code>TRUE</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(pins)
b &lt;- board_temp(versioned = TRUE)
cars_lm &lt;- lm(mpg ~ ., data = mtcars)
v &lt;- vetiver_model(cars_lm, "cars_linear")
vetiver_pin_write(b, v)

vetiver_prepare_docker(b, "cars_linear", path = tempdir())

</code></pre>

<hr>
<h2 id='vetiver_ptype.train'>Create a vetiver input data prototype</h2><span id='topic+vetiver_ptype.train'></span><span id='topic+vetiver_ptype.gam'></span><span id='topic+vetiver_ptype.glm'></span><span id='topic+vetiver_ptype.keras.engine.training.Model'></span><span id='topic+vetiver_ptype.kproto'></span><span id='topic+vetiver_ptype.lm'></span><span id='topic+vetiver_ptype.luz_module_fitted'></span><span id='topic+vetiver_ptype.Learner'></span><span id='topic+vetiver_ptype'></span><span id='topic+vetiver_ptype.default'></span><span id='topic+vetiver_create_ptype'></span><span id='topic+vetiver_ptype.ranger'></span><span id='topic+vetiver_ptype.recipe'></span><span id='topic+vetiver_ptype.model_stack'></span><span id='topic+vetiver_ptype.workflow'></span><span id='topic+vetiver_ptype.xgb.Booster'></span>

<h3>Description</h3>

<p>Optionally find and return an input data prototype for a model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'train'
vetiver_ptype(model, ...)

## S3 method for class 'gam'
vetiver_ptype(model, ...)

## S3 method for class 'glm'
vetiver_ptype(model, ...)

## S3 method for class 'keras.engine.training.Model'
vetiver_ptype(model, ...)

## S3 method for class 'kproto'
vetiver_ptype(model, ...)

## S3 method for class 'lm'
vetiver_ptype(model, ...)

## S3 method for class 'luz_module_fitted'
vetiver_ptype(model, ...)

## S3 method for class 'Learner'
vetiver_ptype(model, ...)

vetiver_ptype(model, ...)

## Default S3 method:
vetiver_ptype(model, ...)

vetiver_create_ptype(model, save_prototype, ...)

## S3 method for class 'ranger'
vetiver_ptype(model, ...)

## S3 method for class 'recipe'
vetiver_ptype(model, ...)

## S3 method for class 'model_stack'
vetiver_ptype(model, ...)

## S3 method for class 'workflow'
vetiver_ptype(model, ...)

## S3 method for class 'xgb.Booster'
vetiver_ptype(model, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_ptype.train_+3A_model">model</code></td>
<td>
<p>A trained model, such as an <code>lm()</code> model or a tidymodels
<code><a href="workflows.html#topic+workflow">workflows::workflow()</a></code>.</p>
</td></tr>
<tr><td><code id="vetiver_ptype.train_+3A_...">...</code></td>
<td>
<p>Other method-specific arguments passed to <code><a href="#topic+vetiver_ptype">vetiver_ptype()</a></code>
to compute an input data prototype, such as <code>prototype_data</code> (a sample of
training features).</p>
</td></tr>
<tr><td><code id="vetiver_ptype.train_+3A_save_prototype">save_prototype</code></td>
<td>
<p>Should an input data prototype be stored with the model?
The options are <code>TRUE</code> (the default, which stores a zero-row slice of the
training data), <code>FALSE</code> (no input data prototype for visual documentation or
checking), or a dataframe to be used for both checking at prediction time
<em>and</em> examples in API visual documentation.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These are developer-facing functions, useful for supporting new model types.
A <code><a href="#topic+vetiver_model">vetiver_model()</a></code> object optionally stores an input data prototype for
checking at prediction time.
</p>

<ul>
<li><p> The default for <code>save_prototype</code>, <code>TRUE</code>, finds an input data prototype (a
zero-row slice of the training data) via <code><a href="#topic+vetiver_ptype">vetiver_ptype()</a></code>.
</p>
</li>
<li> <p><code>save_prototype = FALSE</code> opts out of storing any input data prototype.
</p>
</li>
<li><p> You may pass your own data to <code>save_prototype</code>, but be sure to check that it
has the same structure as your training data, perhaps with
<code><a href="hardhat.html#topic+scream">hardhat::scream()</a></code>.
</p>
</li></ul>



<h3>Value</h3>

<p>A <code>vetiver_ptype</code> method returns a zero-row dataframe, and
<code>vetiver_create_ptype()</code> returns either such a zero-row dataframe, <code>NULL</code>,
or the dataframe passed to <code>save_prototype</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cars_lm &lt;- lm(mpg ~ cyl + disp, data = mtcars)

vetiver_create_ptype(cars_lm, TRUE)

## calls the right method for `model` via:
vetiver_ptype(cars_lm)

## can also turn off prototype
vetiver_create_ptype(cars_lm, FALSE)

## some models require that you pass in training features
cars_rf &lt;- ranger::ranger(mpg ~ ., data = mtcars)
vetiver_ptype(cars_rf, prototype_data = mtcars[,-1])

</code></pre>

<hr>
<h2 id='vetiver_python_requirements.keras.engine.training.Model'>Use extra files required for deployment</h2><span id='topic+vetiver_python_requirements.keras.engine.training.Model'></span><span id='topic+vetiver_renviron_requirements.luz_module_fitted'></span><span id='topic+vetiver_python_requirements'></span><span id='topic+vetiver_python_requirements.default'></span><span id='topic+vetiver_renviron_requirements'></span><span id='topic+vetiver_renviron_requirements.default'></span>

<h3>Description</h3>

<p>Create files required for deploying an app generated via
<code><a href="#topic+vetiver_write_plumber">vetiver_write_plumber()</a></code>, such as a Python <code>requirements.txt</code> or an
<code>.Renviron</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'keras.engine.training.Model'
vetiver_python_requirements(model)

## S3 method for class 'luz_module_fitted'
vetiver_renviron_requirements(model)

vetiver_python_requirements(model)

## Default S3 method:
vetiver_python_requirements(model)

vetiver_renviron_requirements(model)

## Default S3 method:
vetiver_renviron_requirements(model)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_python_requirements.keras.engine.training.Model_+3A_model">model</code></td>
<td>
<p>A trained model, such as an <code>lm()</code> model or a tidymodels
<code><a href="workflows.html#topic+workflow">workflows::workflow()</a></code>.</p>
</td></tr>
</table>

<hr>
<h2 id='vetiver_sm_build'>Deploy a vetiver model API to Amazon SageMaker with modular functions</h2><span id='topic+vetiver_sm_build'></span><span id='topic+vetiver_sm_model'></span><span id='topic+vetiver_sm_endpoint'></span>

<h3>Description</h3>

<p>Use the function <code><a href="#topic+vetiver_deploy_sagemaker">vetiver_deploy_sagemaker()</a></code> for basic deployment on
SageMaker, or these three functions together for more advanced use cases:
</p>

<ul>
<li> <p><code>vetiver_sm_build()</code> generates and builds a Docker image on SageMaker for
a vetiver model
</p>
</li>
<li> <p><code>vetiver_sm_model()</code> creates an Amazon SageMaker model
</p>
</li>
<li> <p><code>vetiver_sm_endpoint()</code> deploys an Amazon SageMaker model endpoint
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>vetiver_sm_build(
  board,
  name,
  version = NULL,
  path = fs::dir_create(tempdir(), "vetiver"),
  predict_args = list(),
  docker_args = list(),
  repository = NULL,
  compute_type = c("BUILD_GENERAL1_SMALL", "BUILD_GENERAL1_MEDIUM",
    "BUILD_GENERAL1_LARGE", "BUILD_GENERAL1_2XLARGE"),
  role = NULL,
  bucket = NULL,
  vpc_id = NULL,
  subnet_ids = list(),
  security_group_ids = list(),
  log = TRUE,
  ...
)

vetiver_sm_model(
  image_uri,
  model_name,
  role = NULL,
  vpc_config = list(),
  enable_network_isolation = FALSE,
  tags = list()
)

vetiver_sm_endpoint(
  model_name,
  instance_type,
  endpoint_name = NULL,
  initial_instance_count = 1,
  accelerator_type = NULL,
  tags = list(),
  kms_key = NULL,
  data_capture_config = list(),
  volume_size = NULL,
  model_data_download_timeout = NULL,
  wait = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_sm_build_+3A_board">board</code></td>
<td>
<p>An AWS S3 board created with <code><a href="pins.html#topic+board_s3">pins::board_s3()</a></code>. This board
must be in the correct region for your SageMaker instance.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_name">name</code></td>
<td>
<p>Pin name.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_version">version</code></td>
<td>
<p>Retrieve a specific version of a pin. Use <code><a href="pins.html#topic+pin_versions">pin_versions()</a></code> to
find out which versions are available and when they were created.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_path">path</code></td>
<td>
<p>A path to write the Plumber file, Dockerfile, and lockfile,
capturing the model's dependencies.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_predict_args">predict_args</code></td>
<td>
<p>A list of optional arguments passed to <code><a href="#topic+vetiver_api">vetiver_api()</a></code>
such as the prediction <code>type</code>.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_docker_args">docker_args</code></td>
<td>
<p>A list of optional arguments passed to
<code><a href="#topic+vetiver_write_docker">vetiver_write_docker()</a></code> such as the <code>lockfile</code> name or whether to use
<code>rspm</code>. Do not pass <code>additional_pkgs</code> here, as this function uses
<code>additional_pkgs = required_pkgs(board)</code>.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_repository">repository</code></td>
<td>
<p>The ECR repository and tag for the image as a character.
Defaults to <code style="white-space: pre;">&#8288;sagemaker-studio-${domain_id}:latest&#8288;</code>.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_compute_type">compute_type</code></td>
<td>
<p>The <a href="https://aws.amazon.com/codebuild/">CodeBuild</a>
compute type as a character. Defaults to <code>BUILD_GENERAL1_SMALL</code>.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_role">role</code></td>
<td>
<p>The ARN IAM role name (as a character) to be used with:
</p>

<ul>
<li><p> CodeBuild for <code>vetiver_sm_build()</code>
</p>
</li>
<li><p> the SageMaker model for <code>vetiver_sm_model()</code>
</p>
</li></ul>

<p>Defaults to the SageMaker Studio execution role.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_bucket">bucket</code></td>
<td>
<p>The S3 bucket to use for sending data to CodeBuild as a
character. Defaults to the SageMaker SDK default bucket.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_vpc_id">vpc_id</code></td>
<td>
<p>ID of the VPC that will host the CodeBuild project such as
<code>"vpc-05c09f91d48831c8c"</code>.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_subnet_ids">subnet_ids</code></td>
<td>
<p>List of subnet IDs for the CodeBuild project, such as
<code>list("subnet-0b31f1863e9d31a67")</code>.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_security_group_ids">security_group_ids</code></td>
<td>
<p>List of security group IDs for the CodeBuild
project, such as <code>list("sg-0ce4ec0d0414d2ddc")</code>.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_log">log</code></td>
<td>
<p>A logical to show the logs of the running CodeBuild build.
Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_...">...</code></td>
<td>
<p><a href="https://docs.docker.com/engine/reference/commandline/build/#options%3E">Docker build parameters</a>
(Use &quot;_&quot; instead of &quot;-&quot;; for example, Docker optional parameter
<code>build-arg</code> becomes <code>build_arg</code>).</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_image_uri">image_uri</code></td>
<td>
<p>The AWS ECR image URI for the Amazon SageMaker Model to be
created (for example, as returned by <code><a href="#topic+vetiver_sm_build">vetiver_sm_build()</a></code>).</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_model_name">model_name</code></td>
<td>
<p>The Amazon SageMaker model name to be deployed.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_vpc_config">vpc_config</code></td>
<td>
<p>A list containing the VPC configuration for the Amazon
SageMaker model <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_VpcConfig.html">API VpcConfig</a>
(optional).
</p>

<ul>
<li> <p><code>Subnets</code>: List of subnet ids
</p>
</li>
<li> <p><code>SecurityGroupIds</code>: List of security group ids
</p>
</li></ul>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_enable_network_isolation">enable_network_isolation</code></td>
<td>
<p>A logical to specify whether the container
will run in network isolation mode. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_tags">tags</code></td>
<td>
<p>A named list of tags for labeling the Amazon SageMaker model or
model endpint to be created.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_instance_type">instance_type</code></td>
<td>
<p>Type of EC2 instance to use; see
<a href="https://aws.amazon.com/sagemaker/pricing/">Amazon SageMaker pricing</a>.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_endpoint_name">endpoint_name</code></td>
<td>
<p>The name to use for the Amazon SageMaker model endpoint
to be created, if to be different from <code>model_name</code>.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_initial_instance_count">initial_instance_count</code></td>
<td>
<p>The initial number of instances to run
in the endpoint.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_accelerator_type">accelerator_type</code></td>
<td>
<p>Type of Elastic Inference accelerator to
attach to an endpoint for model loading and inference, for
example, <code>"ml.eia1.medium"</code>.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_kms_key">kms_key</code></td>
<td>
<p>The ARN of the KMS key used to encrypt the data on the
storage volume attached to the instance hosting the endpoint.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_data_capture_config">data_capture_config</code></td>
<td>
<p>A list for configuration to control how Amazon
SageMaker captures inference data.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_volume_size">volume_size</code></td>
<td>
<p>The size, in GB, of the ML storage volume attached to
the individual inference instance associated with the production variant.
Currently only Amazon EBS gp2 storage volumes are supported.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_model_data_download_timeout">model_data_download_timeout</code></td>
<td>
<p>The timeout value, in seconds, to download
and extract model data from Amazon S3.</p>
</td></tr>
<tr><td><code id="vetiver_sm_build_+3A_wait">wait</code></td>
<td>
<p>A logical for whether to wait for the endpoint to be deployed.
Defaults to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function <code>vetiver_sm_build()</code> generates the files necessary to
build a Docker container to deploy a vetiver model in SageMaker and then
builds the image on <a href="https://aws.amazon.com/codebuild/">AWS CodeBuild</a>. The
resulting image is stored in <a href="https://aws.amazon.com/ecr/">AWS ECR</a>.
This function creates a Plumber file and Dockerfile appropriate for
SageMaker, for example, with <code>path = "/invocations"</code> and <code>port = 8080</code>.
</p>
<p>If you run into problems with Docker rate limits, then either
</p>

<ul>
<li><p> authenticate to Docker from SageMaker, or
</p>
</li>
<li><p> use a <a href="https://gallery.ecr.aws/docker/library/r-base">public ECR base image</a>,
passed through <code>docker_args</code>
</p>
</li></ul>



<h3>Value</h3>

<p><code>vetiver_sm_build()</code> returns the AWS ECR image URI and
<code>vetiver_sm_model()</code> returns the model name (both as characters).
<code>vetiver_sm_endpoint()</code> returns a new <code><a href="#topic+vetiver_endpoint_sagemaker">vetiver_endpoint_sagemaker()</a></code> object.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vetiver_prepare_docker">vetiver_prepare_docker()</a></code>, <code><a href="#topic+vetiver_deploy_sagemaker">vetiver_deploy_sagemaker()</a></code>, <code><a href="#topic+vetiver_endpoint_sagemaker">vetiver_endpoint_sagemaker()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if (FALSE) {
library(pins)
b &lt;- board_s3(bucket = "my-existing-bucket")
cars_lm &lt;- lm(mpg ~ ., data = mtcars)
v &lt;- vetiver_model(cars_lm, "cars_linear")
vetiver_pin_write(b, v)

new_image_uri &lt;- vetiver_sm_build(
    board = b,
    name = "cars_linear",
    predict_args = list(type = "class", debug = TRUE),
    docker_args = list(
        base_image = "FROM public.ecr.aws/docker/library/r-base:4.2.2"
    )
)

model_name &lt;- vetiver_sm_model(
    new_image_uri,
    tags = list("my_custom_tag" = "fuel_efficiency")
)

vetiver_sm_endpoint(model_name, "ml.t2.medium")
}
</code></pre>

<hr>
<h2 id='vetiver_sm_delete'>Delete Amazon SageMaker model, endpoint, and endpoint configuration</h2><span id='topic+vetiver_sm_delete'></span>

<h3>Description</h3>

<p>Use this function to delete the Amazon SageMaker components used in a
<code><a href="#topic+vetiver_endpoint_sagemaker">vetiver_endpoint_sagemaker()</a></code> object. This function does <em>not</em> delete
any pinned model object in S3.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vetiver_sm_delete(object, delete_model = TRUE, delete_endpoint = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_sm_delete_+3A_object">object</code></td>
<td>
<p>The model API endpoint object to be deleted, created with
<code><a href="#topic+vetiver_endpoint_sagemaker">vetiver_endpoint_sagemaker()</a></code>.</p>
</td></tr>
<tr><td><code id="vetiver_sm_delete_+3A_delete_model">delete_model</code></td>
<td>
<p>Delete the SageMaker model? Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="vetiver_sm_delete_+3A_delete_endpoint">delete_endpoint</code></td>
<td>
<p>Delete both the endpoint and endpoint configuration?
Defaults to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>TRUE</code>, invisibly
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vetiver_deploy_sagemaker">vetiver_deploy_sagemaker()</a></code>, <code><a href="#topic+vetiver_sm_build">vetiver_sm_build()</a></code>, <code><a href="#topic+vetiver_endpoint_sagemaker">vetiver_endpoint_sagemaker()</a></code>
</p>

<hr>
<h2 id='vetiver_type_convert'>Convert new data at prediction time using input data prototype</h2><span id='topic+vetiver_type_convert'></span>

<h3>Description</h3>

<p>This is a developer-facing function, useful for supporting new model types.
At prediction time, new observations typically must be checked and sometimes
converted to the data types from training time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vetiver_type_convert(new_data, ptype)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_type_convert_+3A_new_data">new_data</code></td>
<td>
<p>New data for making predictions, such as a data frame.</p>
</td></tr>
<tr><td><code id="vetiver_type_convert_+3A_ptype">ptype</code></td>
<td>
<p>An input data prototype, such as a 0-row slice of the training
data</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A converted dataframe
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(tibble)
training_df &lt;- tibble(x = as.Date("2021-01-01") + 0:9,
                      y = LETTERS[1:10], z = letters[11:20])
training_df

prototype &lt;- vctrs::vec_slice(training_df, 0)
vetiver_type_convert(tibble(x = "2021-02-01", y = "J", z = "k"), prototype)

## unsuccessful conversion generates an error:
try(vetiver_type_convert(tibble(x = "potato", y = "J", z = "k"), prototype))

## error for missing column:
try(vetiver_type_convert(tibble(x = "potato", y = "J"), prototype))

</code></pre>

<hr>
<h2 id='vetiver_write_docker'>Write a Dockerfile for a vetiver model</h2><span id='topic+vetiver_write_docker'></span>

<h3>Description</h3>

<p>After creating a Plumber file with <code><a href="#topic+vetiver_write_plumber">vetiver_write_plumber()</a></code>, use
<code>vetiver_write_docker()</code> to create a Dockerfile plus a <code>vetiver_renv.lock</code>
file for a pinned <code><a href="#topic+vetiver_model">vetiver_model()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vetiver_write_docker(
  vetiver_model,
  plumber_file = "plumber.R",
  path = ".",
  ...,
  lockfile = "vetiver_renv.lock",
  rspm = TRUE,
  base_image = glue::glue("FROM rocker/r-ver:{getRversion()}"),
  port = 8000,
  expose = TRUE,
  additional_pkgs = character(0)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_write_docker_+3A_vetiver_model">vetiver_model</code></td>
<td>
<p>A deployable <code><a href="#topic+vetiver_model">vetiver_model()</a></code> object</p>
</td></tr>
<tr><td><code id="vetiver_write_docker_+3A_plumber_file">plumber_file</code></td>
<td>
<p>A path for your Plumber file, created via
<code><a href="#topic+vetiver_write_plumber">vetiver_write_plumber()</a></code>. Defaults to <code>plumber.R</code> in the working directory.</p>
</td></tr>
<tr><td><code id="vetiver_write_docker_+3A_path">path</code></td>
<td>
<p>A path to write the Dockerfile and <code>lockfile</code>, capturing the
model's package dependencies. Defaults to the working directory.</p>
</td></tr>
<tr><td><code id="vetiver_write_docker_+3A_...">...</code></td>
<td>
<p>Not currently used.</p>
</td></tr>
<tr><td><code id="vetiver_write_docker_+3A_lockfile">lockfile</code></td>
<td>
<p>The generated lockfile in <code>path</code>. Defaults to
<code>"vetiver_renv.lock"</code>.</p>
</td></tr>
<tr><td><code id="vetiver_write_docker_+3A_rspm">rspm</code></td>
<td>
<p>A logical to use the
<a href="https://packagemanager.rstudio.com/">RStudio Public Package Manager</a> for
<code>renv::restore()</code> in the Docker image. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="vetiver_write_docker_+3A_base_image">base_image</code></td>
<td>
<p>The base Docker image to start with. Defaults to
<code>rocker/r-ver</code> for the version of R you are working with, but models like
keras will require a different base image.</p>
</td></tr>
<tr><td><code id="vetiver_write_docker_+3A_port">port</code></td>
<td>
<p>The server port for listening: a number such as 8080 or an
expression like <code>'as.numeric(Sys.getenv("PORT"))'</code> when the port is injected
as an environment variable.</p>
</td></tr>
<tr><td><code id="vetiver_write_docker_+3A_expose">expose</code></td>
<td>
<p>Add <code>EXPOSE</code> to the Dockerfile? This is helpful for using
Docker Desktop but does not work with an expression for <code>port</code>.</p>
</td></tr>
<tr><td><code id="vetiver_write_docker_+3A_additional_pkgs">additional_pkgs</code></td>
<td>
<p>A character vector of additional package names to add
to the Docker image. For example, some boards like <code><a href="pins.html#topic+board_s3">pins::board_s3()</a></code> require
additional software; you can use <code>required_pkgs(board)</code> here.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The content of the Dockerfile, invisibly.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

library(pins)
tmp_plumber &lt;- tempfile()
b &lt;- board_temp(versioned = TRUE)
cars_lm &lt;- lm(mpg ~ ., data = mtcars)
v &lt;- vetiver_model(cars_lm, "cars_linear")
vetiver_pin_write(b, v)
vetiver_write_plumber(b, "cars_linear", file = tmp_plumber)

## default port
vetiver_write_docker(v, tmp_plumber, tempdir())
## install more pkgs, like those required to access board
vetiver_write_docker(v, tmp_plumber, tempdir(),
                     additional_pkgs = required_pkgs(b))
## port from env variable
vetiver_write_docker(v, tmp_plumber, tempdir(),
                     port = 'as.numeric(Sys.getenv("PORT"))',
                     expose = FALSE)

</code></pre>

<hr>
<h2 id='vetiver_write_plumber'>Write a deployable Plumber file for a vetiver model</h2><span id='topic+vetiver_write_plumber'></span>

<h3>Description</h3>

<p>Use <code>vetiver_write_plumber()</code> to create a <code>plumber.R</code> file for a
<code><a href="#topic+vetiver_model">vetiver_model()</a></code> that has been versioned and stored via
<code><a href="#topic+vetiver_pin_write">vetiver_pin_write()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vetiver_write_plumber(
  board,
  name,
  version = NULL,
  ...,
  file = "plumber.R",
  rsconnect = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vetiver_write_plumber_+3A_board">board</code></td>
<td>
<p>A pin board, created by <code><a href="pins.html#topic+board_folder">board_folder()</a></code>, <code><a href="pins.html#topic+board_connect">board_connect()</a></code>,
<code><a href="pins.html#topic+board_url">board_url()</a></code> or another <code>board_</code> function.</p>
</td></tr>
<tr><td><code id="vetiver_write_plumber_+3A_name">name</code></td>
<td>
<p>Pin name.</p>
</td></tr>
<tr><td><code id="vetiver_write_plumber_+3A_version">version</code></td>
<td>
<p>Retrieve a specific version of a pin. Use <code><a href="pins.html#topic+pin_versions">pin_versions()</a></code> to
find out which versions are available and when they were created.</p>
</td></tr>
<tr><td><code id="vetiver_write_plumber_+3A_...">...</code></td>
<td>
<p>Other arguments passed to <code><a href="#topic+vetiver_api">vetiver_api()</a></code> such as the endpoint
<code>path</code> or prediction <code>type</code>.</p>
</td></tr>
<tr><td><code id="vetiver_write_plumber_+3A_file">file</code></td>
<td>
<p>A path to write the Plumber file. Defaults to <code>plumber.R</code> in the
working directory. See <code><a href="plumber.html#topic+plumb">plumber::plumb()</a></code> for naming precedence rules.</p>
</td></tr>
<tr><td><code id="vetiver_write_plumber_+3A_rsconnect">rsconnect</code></td>
<td>
<p>Create a Plumber file with features needed for <a href="https://posit.co/products/enterprise/connect/">Posit Connect</a>? Defaults to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>By default, this function will find and use the latest version of your
vetiver model; the model API (when deployed) will be linked to that specific
version. You can override this default behavior by choosing a specific
<code>version</code>.
</p>


<h3>Value</h3>

<p>The content of the <code>plumber.R</code> file, invisibly.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(pins)
tmp &lt;- tempfile()
b &lt;- board_temp(versioned = TRUE)
cars_lm &lt;- lm(mpg ~ ., data = mtcars)
v &lt;- vetiver_model(cars_lm, "cars_linear")
vetiver_pin_write(b, v)

vetiver_write_plumber(b, "cars_linear", file = tmp)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
