<!DOCTYPE html><html><head><title>Help for package AIPW</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {AIPW}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#AIPW'><p>Augmented Inverse Probability Weighting (AIPW)</p></a></li>
<li><a href='#AIPW_base'><p>Augmented Inverse Probability Weighting Base Class (AIPW_base)</p></a></li>
<li><a href='#AIPW_nuis'><p>Augmented Inverse Probability Weighting (AIPW) uses tmle or tmle3 as inputs</p></a></li>
<li><a href='#AIPW_tmle'><p>Augmented Inverse Probability Weighting (AIPW) uses tmle or tmle3 as inputs</p></a></li>
<li><a href='#aipw_wrapper'><p>AIPW wrapper function</p></a></li>
<li><a href='#eager_sim_obs'><p>Simulated Observational Study</p></a></li>
<li><a href='#eager_sim_rct'><p>Simulated Randomized Trial</p></a></li>
<li><a href='#fit'><p>Fit the data to the AIPW object</p></a></li>
<li><a href='#plot.ip_weights'><p>Plot the inverse probability weights using truncated propensity scores by exposure status</p></a></li>
<li><a href='#plot.p_score'><p>Plot the propensity scores by exposure status</p></a></li>
<li><a href='#stratified_fit'><p>Fit the data to the AIPW object stratified by <code>A</code> for the outcome model</p></a></li>
<li><a href='#summary'><p>Summary of the average treatment effects from AIPW</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Augmented Inverse Probability Weighting</td>
</tr>
<tr>
<td>Version:</td>
<td>0.6.3.2</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Yongqi Zhong &lt;yq.zhong7@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>The 'AIPW' pacakge implements the augmented inverse probability weighting, a doubly robust estimator, for average causal effect estimation with user-defined stacked machine learning algorithms. To cite the 'AIPW' package, please use: "Yongqi Zhong, Edward H. Kennedy, Lisa M. Bodnar, Ashley I. Naimi (2021, In Press). AIPW: An R Package for Augmented Inverse Probability Weighted Estimation of Average Causal Effects. American Journal of Epidemiology". Visit: <a href="https://yqzhong7.github.io/AIPW/">https://yqzhong7.github.io/AIPW/</a> for more information.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Language:</td>
<td>es</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 2.1.0), knitr, rmarkdown, covr, tmle</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.0</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats, utils, R6, SuperLearner, ggplot2, future.apply,
progressr, Rsolnp</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/yqzhong7/AIPW">https://github.com/yqzhong7/AIPW</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/yqzhong7/AIPW/issues">https://github.com/yqzhong7/AIPW/issues</a></td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-06-10 14:44:41 UTC; k</td>
</tr>
<tr>
<td>Author:</td>
<td>Yongqi Zhong <a href="https://orcid.org/0000-0002-4042-7450"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Ashley Naimi <a href="https://orcid.org/0000-0002-1510-8175"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Gabriel Conzuelo [ctb],
  Edward Kennedy [ctb]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-06-11 09:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='AIPW'>Augmented Inverse Probability Weighting (AIPW)</h2><span id='topic+AIPW'></span>

<h3>Description</h3>

<p>An R6Class of AIPW for estimating the average causal effects with users' inputs of exposure, outcome, covariates and related
libraries for estimating the efficient influence function.
</p>


<h3>Details</h3>

<p>An AIPW object is constructed by <code>new()</code> with users' inputs of data and causal structures, then it <code>fit()</code> the data using the
libraries in <code>Q.SL.library</code> and <code>g.SL.library</code> with <code>k_split</code> cross-fitting, and provides results via the <code>summary()</code> method.
After using <code>fit()</code> and/or <code>summary()</code> methods, propensity scores  and inverse probability weights by exposure status can be
examined with <code>plot.p_score()</code> and <code>plot.ip_weights()</code>, respectively.
</p>
<p>If outcome is missing, analysis assumes missing at random (MAR) by estimating propensity scores of I(A=a, observed=1) with all covariates <code>W</code>.
(<code>W.Q</code> and <code>W.g</code> are disabled.) Missing exposure is not supported.
</p>
<p>See examples for illustration.
</p>


<h3>Value</h3>

<p><code>AIPW</code> object
</p>


<h3>Constructor</h3>

<p><code>AIPW$new(Y = NULL, A = NULL, W = NULL, W.Q = NULL, W.g = NULL, Q.SL.library = NULL, g.SL.library = NULL, k_split = 10, verbose = TRUE, save.sl.fit = FALSE)</code>
</p>


<h4>Constructor Arguments</h4>


<table>
<tr>
 <td style="text-align: left;">
<strong>Argument</strong>      </td><td style="text-align: left;">   <strong>Type</strong>     </td><td style="text-align: left;">     <strong>Details</strong> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>Y</code>               </td><td style="text-align: left;">   Integer           </td><td style="text-align: left;">     A vector of outcome (binary (0, 1) or continuous) </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>A</code>               </td><td style="text-align: left;">   Integer           </td><td style="text-align: left;">     A vector of binary exposure (0 or 1) </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>W</code>               </td><td style="text-align: left;">   Data              </td><td style="text-align: left;">     Covariates for <strong>both</strong> exposure and outcome models. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>W.Q</code>             </td><td style="text-align: left;">   Data              </td><td style="text-align: left;">     Covariates for the <strong>outcome</strong> model (Q).</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>W.g</code>             </td><td style="text-align: left;">   Data              </td><td style="text-align: left;">     Covariates for the <strong>exposure</strong> model (g). </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>Q.SL.library</code>    </td><td style="text-align: left;">   SL.library        </td><td style="text-align: left;">     Algorithms used for the <strong>outcome</strong> model (Q). </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>g.SL.library</code>    </td><td style="text-align: left;">   SL.library         </td><td style="text-align: left;">    Algorithms used for the <strong>exposure</strong> model (g). </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>k_split</code>         </td><td style="text-align: left;">   Integer           </td><td style="text-align: left;">    Number of folds for splitting (Default = 10).</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>verbose</code>         </td><td style="text-align: left;">   Logical           </td><td style="text-align: left;">    Whether to print the result (Default = TRUE) </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>save.sl.fit</code>     </td><td style="text-align: left;">   Logical          </td><td style="text-align: left;">     Whether to save Q.fit and g.fit (Default = FALSE) </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>




<h4>Constructor Argument Details</h4>


<dl>
<dt><code>W</code>, <code>W.Q</code> &amp; <code>W.g</code></dt><dd><p>It can be a vector, matrix or data.frame. If and only if <code>W == NULL</code>, <code>W</code> would be replaced by <code>W.Q</code> and <code>W.g</code>. </p>
</dd>
<dt><code>Q.SL.library</code> &amp; <code>g.SL.library</code></dt><dd><p>Machine learning algorithms from SuperLearner libraries</p>
</dd>
<dt><code>k_split</code></dt><dd><p>It ranges from 1 to number of observation-1.
If k_split=1, no cross-fitting; if k_split&gt;=2, cross-fitting is used
(e.g., <code>k_split=10</code>, use 9/10 of the data to estimate and the remaining 1/10 leftover to predict).
<strong>NOTE: it's recommended to use cross-fitting.</strong> </p>
</dd>
<dt><code>save.sl.fit</code></dt><dd><p>This option allows users to save the fitted sl object (libs$Q.fit &amp; libs$g.fit) for debug use.
<strong>Warning: Saving the SuperLearner fitted object may cause a substantive storage/memory use.</strong></p>
</dd>
</dl>




<h3>Public Methods</h3>


<table>
<tr>
 <td style="text-align: left;">
<strong>Methods</strong>      </td><td style="text-align: left;">   <strong>Details</strong>                                      </td><td style="text-align: left;"> <strong>Link</strong>     </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>fit()</code>          </td><td style="text-align: left;">   Fit the data to the <a href="#topic+AIPW">AIPW</a> object                     </td><td style="text-align: left;">   <a href="#topic+fit.AIPW">fit.AIPW</a>  </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>stratified_fit()</code></td><td style="text-align: left;">   Fit the data to the <a href="#topic+AIPW">AIPW</a> object stratified by <code>A</code>  </td><td style="text-align: left;">   <a href="#topic+stratified_fit.AIPW">stratified_fit.AIPW</a>  </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>summary()</code>      </td><td style="text-align: left;">   Summary of the average treatment effects from AIPW    </td><td style="text-align: left;">   <a href="#topic+summary.AIPW_base">summary.AIPW_base</a></td>
</tr>
<tr>
 <td style="text-align: left;">
<code>plot.p_score()</code> </td><td style="text-align: left;">   Plot the propensity scores by exposure status         </td><td style="text-align: left;">   <a href="#topic+plot.p_score">plot.p_score</a></td>
</tr>
<tr>
 <td style="text-align: left;">
<code>plot.ip_weights()</code> </td><td style="text-align: left;">   Plot the inverse probability weights using truncated propensity scores  </td><td style="text-align: left;">   <a href="#topic+plot.ip_weights">plot.ip_weights</a></td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Public Variables</h3>


<table>
<tr>
 <td style="text-align: left;">
<strong>Variable</strong>     </td><td style="text-align: left;">   <strong>Generated by</strong>      </td><td style="text-align: left;">     <strong>Return</strong> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>n</code>              </td><td style="text-align: left;">   Constructor                </td><td style="text-align: left;">     Number of observations </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>stratified_fitted</code> </td><td style="text-align: left;">   <code>stratified_fit()</code>      </td><td style="text-align: left;">    Fit the outcome model stratified by exposure status </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>obs_est</code>        </td><td style="text-align: left;">   <code>fit()</code> &amp; <code>summary()</code>      </td><td style="text-align: left;">     Components calculating average causal effects </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>estimates</code>      </td><td style="text-align: left;">   <code>summary()</code>                </td><td style="text-align: left;">     A list of Risk difference, risk ratio, odds ratio </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>result</code>         </td><td style="text-align: left;">   <code>summary()</code>                </td><td style="text-align: left;">     A matrix contains RD, ATT, ATC, RR and OR with their SE and 95%CI </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>g.plot</code>         </td><td style="text-align: left;">   <code>plot.p_score()</code>           </td><td style="text-align: left;">     A density plot of propensity scores by exposure status</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>ip_weights.plot</code>         </td><td style="text-align: left;">   <code>plot.ip_weights()</code>           </td><td style="text-align: left;">     A box plot of inverse probability weights </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>libs</code>           </td><td style="text-align: left;">   <code>fit()</code>                    </td><td style="text-align: left;">     SuperLearner libraries and their fitted objects </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>sl.fit</code>         </td><td style="text-align: left;">   Constructor                </td><td style="text-align: left;">     A wrapper function for fitting SuperLearner </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>sl.predict</code>     </td><td style="text-align: left;">   Constructor                </td><td style="text-align: left;">     A wrapper function using <code>sl.fit</code> to predict </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h4>Public Variable Details</h4>


<dl>
<dt><code>stratified_fit</code></dt><dd><p>An indicator for whether the outcome model is fitted stratified by exposure status in the<code>fit()</code> method.
Only when using <code>stratified_fit()</code> to turn on <code>stratified_fit = TRUE</code>, <code>summary</code> outputs average treatment effects among the treated and the controls.</p>
</dd>
<dt><code>obs_est</code></dt><dd><p>After using <code>fit()</code> and <code>summary()</code> methods, this list contains the propensity scores (<code>p_score</code>),
counterfactual predictions (<code>mu</code>, <code>mu1</code> &amp; <code>mu0</code>) and
efficient influence functions (<code>aipw_eif1</code> &amp; <code>aipw_eif0</code>) for later average treatment effect calculations.</p>
</dd>
<dt><code>g.plot</code></dt><dd><p>This plot is generated by <code>ggplot2::geom_density</code></p>
</dd>
<dt><code>ip_weights.plot</code></dt><dd><p>This plot uses truncated propensity scores stratified by exposure status (<code>ggplot2::geom_boxplot</code>)</p>
</dd>
</dl>




<h3>References</h3>

<p>Zhong Y, Kennedy EH, Bodnar LM, Naimi AI (2021, In Press). AIPW: An R Package for Augmented Inverse Probability Weighted Estimation of Average Causal Effects. <em>American Journal of Epidemiology</em>.
</p>
<p>Robins JM, Rotnitzky A (1995). Semiparametric efficiency in multivariate regression models with missing data. <em>Journal of the American Statistical Association</em>.
</p>
<p>Chernozhukov V, Chetverikov V, Demirer M, et al (2018). Double/debiased machine learning for treatment and structural parameters. <em>The Econometrics Journal</em>.
</p>
<p>Kennedy EH, Sjolander A, Small DS (2015). Semiparametric causal inference in matched cohort studies. <em>Biometrika</em>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(SuperLearner)
library(ggplot2)

#create an object
aipw_sl &lt;- AIPW$new(Y=rbinom(100,1,0.5), A=rbinom(100,1,0.5),
                    W.Q=rbinom(100,1,0.5), W.g=rbinom(100,1,0.5),
                    Q.SL.library="SL.mean",g.SL.library="SL.mean",
                    k_split=1,verbose=FALSE)

#fit the object
aipw_sl$fit()
# or use `aipw_sl$stratified_fit()` to estimate ATE and ATT/ATC

#calculate the results
aipw_sl$summary(g.bound = 0.025)

#check the propensity scores by exposure status after truncation
aipw_sl$plot.p_score()

</code></pre>

<hr>
<h2 id='AIPW_base'>Augmented Inverse Probability Weighting Base Class (AIPW_base)</h2><span id='topic+AIPW_base'></span>

<h3>Description</h3>

<p>A base class for AIPW that implements the common methods, such as <code>summary()</code> and <code>plot.p_score()</code>, inheritted by <a href="#topic+AIPW">AIPW</a> and <a href="#topic+AIPW_tmle">AIPW_tmle</a> class
</p>


<h3>Format</h3>

<p><code><a href="R6.html#topic+R6Class">R6Class</a></code> object.
</p>


<h3>Value</h3>

<p><code>AIPW</code> base object
</p>


<h3>See Also</h3>

<p><a href="#topic+AIPW">AIPW</a> and <a href="#topic+AIPW_tmle">AIPW_tmle</a>
</p>

<hr>
<h2 id='AIPW_nuis'>Augmented Inverse Probability Weighting (AIPW) uses tmle or tmle3 as inputs</h2><span id='topic+AIPW_nuis'></span>

<h3>Description</h3>

<p><code>AIPW_nuis</code> class for users to manually input nuisance functions (estimates from the exposure and the outcome models)
</p>


<h3>Details</h3>

<p>Create an AIPW_nuis object that uses users' input nuisance functions from the exposure model <code class="reqn">P(A| W)</code>,
and the outcome models <code class="reqn">P(Y| do(A=0), W)</code> and <code class="reqn">P(Y| do(A=1), W.Q)</code>:
</p>
<p style="text-align: center;"><code class="reqn">
     \psi(a) = E{[ I(A=a) / P(A=a|W) ] * [Y-P(Y=1|A,W)] + P(Y=1| do(A=a),W) }
     </code>
</p>

<p>Note: If outcome is missing, replace (A=a) with (A=a, observed=1) when estimating the propensity scores.
</p>


<h3>Value</h3>

<p><code>AIPW_nuis</code> object
</p>


<h3>Constructor</h3>

<p><code>AIPW$new(Y = NULL, A = NULL, tmle_fit = NULL, verbose = TRUE)</code>
</p>


<h4>Constructor Arguments</h4>


<table>
<tr>
 <td style="text-align: left;">
<strong>Argument</strong>      </td><td style="text-align: left;">   <strong>Type</strong>     </td><td style="text-align: left;">     <strong>Details</strong> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>Y</code>               </td><td style="text-align: left;">   Integer           </td><td style="text-align: left;">     A vector of outcome (binary (0, 1) or continuous) </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>A</code>               </td><td style="text-align: left;">   Integer           </td><td style="text-align: left;">     A vector of binary exposure (0 or 1) </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>mu0</code>             </td><td style="text-align: left;">   Numeric             </td><td style="text-align: left;">    User input of <code class="reqn">P(Y=1| do(A = 0),W_Q)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>mu1</code>             </td><td style="text-align: left;">   Numeric             </td><td style="text-align: left;">    User input of <code class="reqn">P(Y=1| do(A = 1),W_Q)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>raw_p_score</code>     </td><td style="text-align: left;">   Numeric             </td><td style="text-align: left;">    User input of <code class="reqn">P(A=a|W_g)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>verbose</code>         </td><td style="text-align: left;">   Logical           </td><td style="text-align: left;">    Whether to print the result (Default = TRUE) </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>stratified_fitted</code>  </td><td style="text-align: left;">   Logical           </td><td style="text-align: left;">    Whether mu0 &amp; mu1 was estimated only using <code>A=0</code> &amp; <code>A=1</code> (Default = FALSE) </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>




<h3>Public Methods</h3>


<table>
<tr>
 <td style="text-align: left;">
<strong>Methods</strong>      </td><td style="text-align: left;">   <strong>Details</strong>                                      </td><td style="text-align: left;"> <strong>Link</strong>     </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>summary()</code>      </td><td style="text-align: left;">   Summary of the average treatment effects from AIPW    </td><td style="text-align: left;">   <a href="#topic+summary.AIPW_base">summary.AIPW_base</a></td>
</tr>
<tr>
 <td style="text-align: left;">
<code>plot.p_score()</code> </td><td style="text-align: left;">   Plot the propensity scores by exposure status         </td><td style="text-align: left;">   <a href="#topic+plot.p_score">plot.p_score</a></td>
</tr>
<tr>
 <td style="text-align: left;">
<code>plot.ip_weights()</code> </td><td style="text-align: left;">   Plot the inverse probability weights using truncated propensity scores  </td><td style="text-align: left;">   <a href="#topic+plot.ip_weights">plot.ip_weights</a></td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Public Variables</h3>


<table>
<tr>
 <td style="text-align: left;">
<strong>Variable</strong>     </td><td style="text-align: left;">   <strong>Generated by</strong>      </td><td style="text-align: left;">     <strong>Return</strong> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>n</code>              </td><td style="text-align: left;">   Constructor                </td><td style="text-align: left;">     Number of observations </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>obs_est</code>        </td><td style="text-align: left;">   Constructor                </td><td style="text-align: left;">     Components calculating average causal effects </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>estimates</code>      </td><td style="text-align: left;">   <code>summary()</code>                </td><td style="text-align: left;">     A list of Risk difference, risk ratio, odds ratio </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>result</code>         </td><td style="text-align: left;">   <code>summary()</code>                </td><td style="text-align: left;">     A matrix contains RD, ATT, ATC, RR and OR with their SE and 95%CI </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>g.plot</code>         </td><td style="text-align: left;">   <code>plot.p_score()</code>           </td><td style="text-align: left;">     A density plot of propensity scores by exposure status </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>ip_weights.plot</code>         </td><td style="text-align: left;">   <code>plot.ip_weights()</code>           </td><td style="text-align: left;">     A box plot of inverse probability weights </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h4>Public Variable Details</h4>


<dl>
<dt><code>stratified_fit</code></dt><dd><p>An indicator for whether the outcome model is fitted stratified by exposure status in the<code>fit()</code> method.
Only when using <code>stratified_fit()</code> to turn on <code>stratified_fit = TRUE</code>, <code>summary</code> outputs average treatment effects among the treated and the controls.</p>
</dd>
<dt><code>obs_est</code></dt><dd><p>This list includes propensity scores (<code>p_score</code>), counterfactual predictions (<code>mu</code>, <code>mu1</code> &amp; <code>mu0</code>) and efficient influence functions (<code>aipw_eif1</code> &amp; <code>aipw_eif0</code>)</p>
</dd>
<dt><code>g.plot</code></dt><dd><p>This plot is generated by <code>ggplot2::geom_density</code></p>
</dd>
<dt><code>ip_weights.plot</code></dt><dd><p>This plot uses truncated propensity scores stratified by exposure status (<code>ggplot2::geom_boxplot</code>)</p>
</dd>
</dl>



<hr>
<h2 id='AIPW_tmle'>Augmented Inverse Probability Weighting (AIPW) uses tmle or tmle3 as inputs</h2><span id='topic+AIPW_tmle'></span>

<h3>Description</h3>

<p><code>AIPW_tmle</code> class uses a fitted <code>tmle</code> or <code>tmle3</code> object as input
</p>


<h3>Details</h3>

<p>Create an AIPW_tmle object that uses the estimated efficient influence function from a fitted <code>tmle</code> or <code>tmle3</code> object
</p>


<h3>Value</h3>

<p><code>AIPW_tmle</code> object
</p>


<h3>Constructor</h3>

<p><code>AIPW$new(Y = NULL, A = NULL, tmle_fit = NULL, verbose = TRUE)</code>
</p>


<h4>Constructor Arguments</h4>


<table>
<tr>
 <td style="text-align: left;">
<strong>Argument</strong>      </td><td style="text-align: left;">   <strong>Type</strong>     </td><td style="text-align: left;">     <strong>Details</strong> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>Y</code>               </td><td style="text-align: left;">   Integer           </td><td style="text-align: left;">     A vector of outcome (binary (0, 1) or continuous) </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>A</code>               </td><td style="text-align: left;">   Integer           </td><td style="text-align: left;">     A vector of binary exposure (0 or 1) </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>tmle_fit</code>        </td><td style="text-align: left;">   Object             </td><td style="text-align: left;">    A fitted <code>tmle</code> or <code>tmle3</code> object </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>verbose</code>         </td><td style="text-align: left;">   Logical           </td><td style="text-align: left;">    Whether to print the result (Default = TRUE)
</td>
</tr>

</table>




<h3>Public Methods</h3>


<table>
<tr>
 <td style="text-align: left;">
<strong>Methods</strong>      </td><td style="text-align: left;">   <strong>Details</strong>                                      </td><td style="text-align: left;"> <strong>Link</strong>     </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>summary()</code>      </td><td style="text-align: left;">   Summary of the average treatment effects from AIPW    </td><td style="text-align: left;">   <a href="#topic+summary.AIPW_base">summary.AIPW_base</a></td>
</tr>
<tr>
 <td style="text-align: left;">
<code>plot.p_score()</code> </td><td style="text-align: left;">   Plot the propensity scores by exposure status         </td><td style="text-align: left;">   <a href="#topic+plot.p_score">plot.p_score</a></td>
</tr>
<tr>
 <td style="text-align: left;">
<code>plot.ip_weights()</code> </td><td style="text-align: left;">   Plot the inverse probability weights using truncated propensity scores  </td><td style="text-align: left;">   <a href="#topic+plot.ip_weights">plot.ip_weights</a></td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Public Variables</h3>


<table>
<tr>
 <td style="text-align: left;">
<strong>Variable</strong>     </td><td style="text-align: left;">   <strong>Generated by</strong>      </td><td style="text-align: left;">     <strong>Return</strong> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>n</code>              </td><td style="text-align: left;">   Constructor                </td><td style="text-align: left;">     Number of observations </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>obs_est</code>        </td><td style="text-align: left;">   Constructor                </td><td style="text-align: left;">     Components calculating average causal effects </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>estimates</code>      </td><td style="text-align: left;">   <code>summary()</code>                </td><td style="text-align: left;">     A list of Risk difference, risk ratio, odds ratio </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>result</code>         </td><td style="text-align: left;">   <code>summary()</code>                </td><td style="text-align: left;">     A matrix contains RD, ATT, ATC, RR and OR with their SE and 95%CI </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>g.plot</code>         </td><td style="text-align: left;">   <code>plot.p_score()</code>           </td><td style="text-align: left;">     A density plot of propensity scores by exposure status </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>ip_weights.plot</code>         </td><td style="text-align: left;">   <code>plot.ip_weights()</code>           </td><td style="text-align: left;">     A box plot of inverse probability weights </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h4>Public Variable Details</h4>


<dl>
<dt><code>obs_est</code></dt><dd><p>This list extracts from the fitted <code>tmle</code> object.
It includes propensity scores (<code>p_score</code>), counterfactual predictions (<code>mu</code>, <code>mu1</code> &amp; <code>mu0</code>) and efficient influence functions (<code>aipw_eif1</code> &amp; <code>aipw_eif0</code>)</p>
</dd>
<dt><code>g.plot</code></dt><dd><p>This plot is generated by <code>ggplot2::geom_density</code></p>
</dd>
<dt><code>ip_weights.plot</code></dt><dd><p>This plot uses truncated propensity scores stratified by exposure status (<code>ggplot2::geom_boxplot</code>)</p>
</dd>
</dl>




<h3>Examples</h3>

<pre><code class='language-R'>vec &lt;- function() sample(0:1,100,replace = TRUE)
df &lt;- data.frame(replicate(4,vec()))
names(df) &lt;- c("A","Y","W1","W2")

## From tmle
library(tmle)
library(SuperLearner)
tmle_fit &lt;- tmle(Y=df$Y,A=df$A,W=subset(df,select=c("W1","W2")),
                 Q.SL.library="SL.glm",
                 g.SL.library="SL.glm",
                 family="binomial")
AIPW_tmle$new(A=df$A,Y=df$Y,tmle_fit = tmle_fit,verbose = TRUE)$summary()
</code></pre>

<hr>
<h2 id='aipw_wrapper'>AIPW wrapper function</h2><span id='topic+aipw_wrapper'></span>

<h3>Description</h3>

<p>A wrapper function for <code>AIPW$new()$fit()$summary()</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>aipw_wrapper(
  Y,
  A,
  verbose = TRUE,
  W = NULL,
  W.Q = NULL,
  W.g = NULL,
  Q.SL.library,
  g.SL.library,
  k_split = 10,
  g.bound = 0.025,
  stratified_fit = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="aipw_wrapper_+3A_y">Y</code></td>
<td>
<p>Outcome (binary integer: 0 or 1)</p>
</td></tr>
<tr><td><code id="aipw_wrapper_+3A_a">A</code></td>
<td>
<p>Exposure (binary integer: 0 or 1)</p>
</td></tr>
<tr><td><code id="aipw_wrapper_+3A_verbose">verbose</code></td>
<td>
<p>Whether to print the result (logical; Default = FALSE)</p>
</td></tr>
<tr><td><code id="aipw_wrapper_+3A_w">W</code></td>
<td>
<p>covariates for both exposure and outcome models  (vector, matrix or data.frame). If null, this function will seek for
inputs from <code>W.Q</code> and <code>W.g</code>.</p>
</td></tr>
<tr><td><code id="aipw_wrapper_+3A_w.q">W.Q</code></td>
<td>
<p>Only valid when <code>W</code> is null, otherwise it would be replaced by <code>W</code>.
Covariates for outcome model (vector, matrix or data.frame).</p>
</td></tr>
<tr><td><code id="aipw_wrapper_+3A_w.g">W.g</code></td>
<td>
<p>Only valid when <code>W</code> is null, otherwise it would be replaced by <code>W</code>.
Covariates for exposure model (vector, matrix or data.frame)</p>
</td></tr>
<tr><td><code id="aipw_wrapper_+3A_q.sl.library">Q.SL.library</code></td>
<td>
<p>SuperLearner libraries for outcome model</p>
</td></tr>
<tr><td><code id="aipw_wrapper_+3A_g.sl.library">g.SL.library</code></td>
<td>
<p>SuperLearner libraries for exposure model</p>
</td></tr>
<tr><td><code id="aipw_wrapper_+3A_k_split">k_split</code></td>
<td>
<p>Number of splitting (integer; range: from 1 to number of observation-1):
if k_split=1, no cross-fitting;
if k_split&gt;=2, cross-fitting is used
(e.g., <code>k_split=10</code>, use 9/10 of the data to estimate and the remaining 1/10 leftover to predict).
NOTE: it's recommended to use cross-fitting.</p>
</td></tr>
<tr><td><code id="aipw_wrapper_+3A_g.bound">g.bound</code></td>
<td>
<p>Value between [0,1] at which the propensity score should be truncated. Defaults to 0.025.</p>
</td></tr>
<tr><td><code id="aipw_wrapper_+3A_stratified_fit">stratified_fit</code></td>
<td>
<p>An indicator for whether the outcome model is fitted stratified by exposure status in the<code>fit()</code> method.
Only when using <code>stratified_fit()</code> to turn on <code>stratified_fit = TRUE</code>, <code>summary</code> outputs average treatment effects among the treated and the controls.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A fitted <code>AIPW</code> object with summarised results
</p>


<h3>See Also</h3>

<p><a href="#topic+AIPW">AIPW</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(SuperLearner)
aipw_sl &lt;- aipw_wrapper(Y=rbinom(100,1,0.5), A=rbinom(100,1,0.5),
                    W.Q=rbinom(100,1,0.5), W.g=rbinom(100,1,0.5),
                    Q.SL.library="SL.mean",g.SL.library="SL.mean",
                    k_split=1,verbose=FALSE)
</code></pre>

<hr>
<h2 id='eager_sim_obs'>Simulated Observational Study</h2><span id='topic+eager_sim_obs'></span>

<h3>Description</h3>

<p>Datasets were simulated using baseline covariates (sampling with replacement) from the Effects of Aspirin in Gestation and Reproduction (EAGeR) study.
Data generating mechanisms were described in our manuscript (Zhong et al. (inpreparation), Am. J. Epidemiol.).
True marginal causal effects on risk difference, log risk ratio and log odds ratio scales were attached to the dataset attributes (true_rd, true_logrr,true_logor).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(eager_sim_obs)
</code></pre>


<h3>Format</h3>

<p>An object of class data.frame with 200 rows and 8 column:
</p>

<dl>
<dt>sim_Y</dt><dd><p>binary, simulated  outcome which is condition on all other covariates in the dataset</p>
</dd>
<dt>sim_A</dt><dd><p>binary, simulated exposure which is conditon on all other covarites expect sim_Y.</p>
</dd>
<dt>eligibility</dt><dd><p>binary, indicator of the eligibility stratum</p>
</dd>
<dt>loss_num</dt><dd><p>count, number of prior pregnancy losses</p>
</dd>
<dt>age</dt><dd><p>continuous, age in years</p>
</dd>
<dt>time_try_pregnant</dt><dd><p>count, months of conception attempts prior to randomization</p>
</dd>
<dt>BMI</dt><dd><p>continuous, body mass index</p>
</dd>
<dt>meanAP</dt><dd><p>continuous, mean arterial blood pressure</p>
</dd>
</dl>



<h3>References</h3>

<p>Schisterman, E.F., Silver, R.M., Lesher, L.L., Faraggi, D., Wactawski-Wende, J., Townsend, J.M., Lynch, A.M., Perkins, N.J., Mumford, S.L. and Galai, N., 2014. Preconception low-dose aspirin and pregnancy outcomes: results from the EAGeR randomised trial. The Lancet, 384(9937), pp.29-36.
</p>
<p>Zhong, Y., Naimi, A.I., Kennedy, E.H., (In preparation). AIPW: An R package for Augmented Inverse Probability Weighted Estimation of Average Causal Effects. American Journal of Epidemiology
</p>


<h3>See Also</h3>

<p><a href="#topic+eager_sim_rct">eager_sim_rct</a>
</p>

<hr>
<h2 id='eager_sim_rct'>Simulated Randomized Trial</h2><span id='topic+eager_sim_rct'></span>

<h3>Description</h3>

<p>Datasets were simulated using baseline covariates (sampling with replacement) from the Effects of Aspirin in Gestation and Reproduction (EAGeR) study.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(eager_sim_rct)
</code></pre>


<h3>Format</h3>

<p>An object of class data.frame with 1228 rows and 8 column:
</p>

<dl>
<dt>sim_Y</dt><dd><p>binary, simulated  outcome which is condition on all other covariates in the dataset</p>
</dd>
<dt>sim_T</dt><dd><p>binary, simulated treatment which is condition on eligibility only.</p>
</dd>
<dt>eligibility</dt><dd><p>binary, indicator of the eligibility stratum</p>
</dd>
<dt>loss_num</dt><dd><p>count, number of prior pregnancy losses</p>
</dd>
<dt>age</dt><dd><p>continuous, age in years</p>
</dd>
<dt>time_try_pregnant</dt><dd><p>count, months of conception attempts prior to randomization</p>
</dd>
<dt>BMI</dt><dd><p>continuous, body mass index</p>
</dd>
<dt>meanAP</dt><dd><p>continuous, mean arterial blood pressure</p>
</dd>
</dl>



<h3>References</h3>

<p>Schisterman, E.F., Silver, R.M., Lesher, L.L., Faraggi, D., Wactawski-Wende, J., Townsend, J.M., Lynch, A.M., Perkins, N.J., Mumford, S.L. and Galai, N., 2014. Preconception low-dose aspirin and pregnancy outcomes: results from the EAGeR randomised trial. The Lancet, 384(9937), pp.29-36.
</p>
<p>Zhong, Y., Naimi, A.I., Kennedy, E.H., (In preparation). AIPW: An R package for Augmented Inverse Probability Weighted Estimation of Average Causal Effects. American Journal of Epidemiology
</p>


<h3>See Also</h3>

<p><a href="#topic+eager_sim_obs">eager_sim_obs</a>
</p>

<hr>
<h2 id='fit'>Fit the data to the <a href="#topic+AIPW">AIPW</a> object</h2><span id='topic+fit'></span><span id='topic+fit.AIPW'></span>

<h3>Description</h3>

<p>Fitting the data into the <a href="#topic+AIPW">AIPW</a> object with/without cross-fitting to estimate the efficient influence functions
</p>


<h3>Value</h3>

<p>A fitted <a href="#topic+AIPW">AIPW</a> object with <code>obs_est</code> and <code>libs</code> (public variables)
</p>


<h3>R6 Usage</h3>

<p><code>$fit()</code>
</p>


<h3>See Also</h3>

<p><a href="#topic+AIPW">AIPW</a>
</p>

<hr>
<h2 id='plot.ip_weights'>Plot the inverse probability weights using truncated propensity scores by exposure status</h2><span id='topic+plot.ip_weights'></span>

<h3>Description</h3>

<p>Plot and check the balance of propensity scores by exposure status
</p>


<h3>Value</h3>

<p><code>ip_weights.plot</code> (public variable): A box plot of inverse probability weights using truncated propensity scores by exposure status (<code>ggplot2::geom_boxplot</code>)
</p>


<h3>R6 Usage</h3>

<p><code>$plot.ip_weights()</code>
</p>


<h3>See Also</h3>

<p><a href="#topic+AIPW">AIPW</a> and <a href="#topic+AIPW_tmle">AIPW_tmle</a>
</p>

<hr>
<h2 id='plot.p_score'>Plot the propensity scores by exposure status</h2><span id='topic+plot.p_score'></span>

<h3>Description</h3>

<p>Plot and check the balance of propensity scores by exposure status
</p>


<h3>Value</h3>

<p><code>g.plot</code> (public variable): A density plot of propensity scores by exposure status (<code>ggplot2::geom_density</code>)
</p>


<h3>R6 Usage</h3>

<p><code>$plot.p_plot()</code>
</p>


<h3>See Also</h3>

<p><a href="#topic+AIPW">AIPW</a> and <a href="#topic+AIPW_tmle">AIPW_tmle</a>
</p>

<hr>
<h2 id='stratified_fit'>Fit the data to the <a href="#topic+AIPW">AIPW</a> object stratified by <code>A</code> for the outcome model</h2><span id='topic+stratified_fit'></span><span id='topic+stratified_fit.AIPW'></span>

<h3>Description</h3>

<p>Fitting the data into the <a href="#topic+AIPW">AIPW</a> object with/without cross-fitting to estimate the efficient influence functions.
Outcome model is fitted, stratified by exposure status <code>A</code>
</p>


<h3>Value</h3>

<p>A fitted <a href="#topic+AIPW">AIPW</a> object with <code>obs_est</code> and <code>libs</code> (public variables)
</p>


<h3>R6 Usage</h3>

<p><code>$stratified_fit.AIPW()</code>
</p>


<h3>See Also</h3>

<p><a href="#topic+AIPW">AIPW</a>
</p>

<hr>
<h2 id='summary'>Summary of the average treatment effects from AIPW</h2><span id='topic+summary'></span><span id='topic+summary.AIPW_base'></span>

<h3>Description</h3>

<p>Calculate average causal effects in RD, RR and OR in the fitted <a href="#topic+AIPW">AIPW</a> or <a href="#topic+AIPW_tmle">AIPW_tmle</a> object using the estimated efficient influence functions
</p>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary_+3A_g.bound">g.bound</code></td>
<td>
<p>Value between [0,1] at which the propensity score should be truncated.
Propensity score will be truncated to <code class="reqn">[g.bound, 1-g.bound]</code> when one g.bound value is provided, or to <code class="reqn">[min(g.bound), max(g.bound)]</code> when two values are provided.
<strong>Defaults to 0.025</strong>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>estimates</code> and <code>result</code> (public variables): Risks, Average treatment effect in RD, RR and OR.
</p>


<h3>R6 Usage</h3>

<p><code>$summary(g.bound = 0.025)</code> <br />
<code>$summary(g.bound = c(0.025,0.975))</code>
</p>


<h3>See Also</h3>

<p><a href="#topic+AIPW">AIPW</a> and <a href="#topic+AIPW_tmle">AIPW_tmle</a>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
