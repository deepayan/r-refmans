<!DOCTYPE html><html lang="en-US"><head><title>Help for package fHMM</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {fHMM}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#fHMM-package'><p>fHMM: Fitting Hidden Markov Models to Financial Data</p></a></li>
<li><a href='#check_date'><p>Check date format</p></a></li>
<li><a href='#compare_models'><p>Compare multiple models</p></a></li>
<li><a href='#compute_ci'><p>Compute confidence intervals</p></a></li>
<li><a href='#compute_residuals'><p>Compute (pseudo-) residuals</p></a></li>
<li><a href='#compute_T_star'><p>Compute lengths of fine-scale chunks</p></a></li>
<li><a href='#dax'><p>Deutscher Aktienindex (DAX) index data</p></a></li>
<li><a href='#dax_model_2n'><p>DAX 2-state HMM with normal distributions</p></a></li>
<li><a href='#dax_model_3t'><p>DAX 3-state HMM with t-distributions</p></a></li>
<li><a href='#dax_vw_model'><p>DAX/VW hierarchical HMM with t-distributions</p></a></li>
<li><a href='#decode_states'><p>Decode the underlying hidden state sequence</p></a></li>
<li><a href='#download_data'><p>Download financial data from Yahoo Finance</p></a></li>
<li><a href='#fHMM_colors'><p>Set color scheme for visualizations</p></a></li>
<li><a href='#fHMM_data'><p>Constructor of an <code>fHMM_data</code> object</p></a></li>
<li><a href='#fHMM_events'><p>Checking events</p></a></li>
<li><a href='#fHMM_model'><p>Constructor of a model object</p></a></li>
<li><a href='#fHMM_parameters'><p>Set and check model parameters</p></a></li>
<li><a href='#fHMM_sdds'><p>Define state-dependent distributions</p></a></li>
<li><a href='#find_closest_year'><p>Find closest year</p></a></li>
<li><a href='#fit_model'><p>Model fitting</p></a></li>
<li><a href='#get_initial_values'><p>Initialization of numerical likelihood optimization</p></a></li>
<li><a href='#list_to_vector'><p>List to vector</p></a></li>
<li><a href='#ll_hmm'><p>Log-likelihood function of an (H)HMM</p></a></li>
<li><a href='#nLL_hhmm'><p>Negative log-likelihood function of an HHMM</p></a></li>
<li><a href='#nLL_hmm'><p>Negative log-likelihood function of an HMM</p></a></li>
<li><a href='#parameter_labels'><p>Create labels for estimated parameters</p></a></li>
<li><a href='#parameter_transformations'><p>Parameter transformations</p></a></li>
<li><a href='#plot_ll'><p>Visualization of log-likelihood values</p></a></li>
<li><a href='#plot_pr'><p>Visualize pseudo residuals</p></a></li>
<li><a href='#plot_sdds'><p>Visualization of estimated state-dependent distributions</p></a></li>
<li><a href='#plot_ts'><p>Visualize time series</p></a></li>
<li><a href='#plot.fHMM_data'><p>Plot method for an object of class <code>fHMM_data</code></p></a></li>
<li><a href='#plot.fHMM_model'><p>Plot method for an object of class <code>fHMM_model</code></p></a></li>
<li><a href='#prepare_data'><p>Prepare data</p></a></li>
<li><a href='#read_data'><p>Read data</p></a></li>
<li><a href='#reorder_states'><p>Reorder estimated states</p></a></li>
<li><a href='#set_controls'><p>Define and validate model specifications</p></a></li>
<li><a href='#sim_model_2gamma'><p>Simulated 2-state HMM with gamma distributions</p></a></li>
<li><a href='#simulate_hmm'><p>Simulate data</p></a></li>
<li><a href='#simulate_observations'><p>Simulate state-dependent observations</p></a></li>
<li><a href='#spx'><p>Standard &amp; Poor’s 500 (S&amp;P 500) index data</p></a></li>
<li><a href='#unemp'><p>Unemployment rate data USA</p></a></li>
<li><a href='#unemp_spx_model_3_2'><p>Unemployment rate and S&amp;P 500 hierarchical HMM</p></a></li>
<li><a href='#vw'><p>Volkswagen AG (VW) stock data</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Fitting Hidden Markov Models to Financial Data</td>
</tr>
<tr>
<td>Version:</td>
<td>1.4.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Fitting (hierarchical) hidden Markov models to financial data
    via maximum likelihood estimation. See Oelschläger, L. and Adam, T.
    "Detecting Bearish and Bullish Markets in Financial Time Series Using 
    Hierarchical Hidden Markov Models" (2021, Statistical Modelling) 
    &lt;<a href="https://doi.org/10.1177%2F1471082X211034048">doi:10.1177/1471082X211034048</a>&gt; for a reference on the method. A user guide 
    is provided by the accompanying software paper "fHMM: Hidden Markov Models 
    for Financial Time Series in R", Oelschläger, L., Adam, T., and Michels, R.
    (2024, Journal of Statistical Software)  &lt;<a href="https://doi.org/10.18637%2Fjss.v109.i09">doi:10.18637/jss.v109.i09</a>&gt;.</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://loelschlaeger.de/fHMM/">https://loelschlaeger.de/fHMM/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/loelschlaeger/fHMM/issues">https://github.com/loelschlaeger/fHMM/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>checkmate, cli, curl, foreach, graphics, grDevices, httr,
jsonlite, MASS, oeli (&ge; 0.3.0), padr, pracma, progress, Rcpp,
stats, utils</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, doSNOW, knitr, parallel, rmarkdown, testthat (&ge;
3.0.0), tseries</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>LazyDataCompression:</td>
<td>xz</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-09-16 09:45:12 UTC; Lennart Oelschläger</td>
</tr>
<tr>
<td>Author:</td>
<td>Lennart Oelschläger
    <a href="https://orcid.org/0000-0001-5421-9313"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre],
  Timo Adam <a href="https://orcid.org/0000-0001-9079-3259"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Rouven Michels <a href="https://orcid.org/0000-0002-5433-6197"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Lennart Oelschläger &lt;oelschlaeger.lennart@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-09-16 10:00:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='fHMM-package'>fHMM: Fitting Hidden Markov Models to Financial Data</h2><span id='topic+fHMM'></span><span id='topic+fHMM-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Fitting (hierarchical) hidden Markov models to financial data via maximum likelihood estimation. See Oelschläger, L. and Adam, T. &quot;Detecting Bearish and Bullish Markets in Financial Time Series Using Hierarchical Hidden Markov Models&quot; (2021, Statistical Modelling) <a href="https://doi.org/10.1177/1471082X211034048">doi:10.1177/1471082X211034048</a> for a reference on the method. A user guide is provided by the accompanying software paper &quot;fHMM: Hidden Markov Models for Financial Time Series in R&quot;, Oelschläger, L., Adam, T., and Michels, R. (2024, Journal of Statistical Software) <a href="https://doi.org/10.18637/jss.v109.i09">doi:10.18637/jss.v109.i09</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Lennart Oelschläger <a href="mailto:oelschlaeger.lennart@gmail.com">oelschlaeger.lennart@gmail.com</a> (<a href="https://orcid.org/0000-0001-5421-9313">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Timo Adam <a href="mailto:ta59@st-andrews.ac.uk">ta59@st-andrews.ac.uk</a> (<a href="https://orcid.org/0000-0001-9079-3259">ORCID</a>)
</p>
</li>
<li><p> Rouven Michels <a href="mailto:r.michels@uni-bielefeld.de">r.michels@uni-bielefeld.de</a> (<a href="https://orcid.org/0000-0002-5433-6197">ORCID</a>)
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://loelschlaeger.de/fHMM/">https://loelschlaeger.de/fHMM/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/loelschlaeger/fHMM/issues">https://github.com/loelschlaeger/fHMM/issues</a>
</p>
</li></ul>


<hr>
<h2 id='check_date'>Check date format</h2><span id='topic+check_date'></span>

<h3>Description</h3>

<p>This function checks if the input <code>date</code> has the format
<code>"YYYY-MM-DD"</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_date(date)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_date_+3A_date">date</code></td>
<td>
<p>[<code>character(1)</code>]<br />
The date in format <code>"YYYY-MM-DD"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>as.Date(date)</code> if <code>date</code> has the format <code>"YYYY-MM-DD"</code>.
Otherwise, the function throws an error.
</p>

<hr>
<h2 id='compare_models'>Compare multiple models</h2><span id='topic+compare_models'></span>

<h3>Description</h3>

<p>This function performs model comparison by comparing multiple
<code><a href="#topic+fHMM_model">fHMM_model</a></code> objects with respect to
</p>

<ul>
<li><p> the number of model parameters,
</p>
</li>
<li><p> the log-likelihood value,
</p>
</li>
<li><p> the AIC value,
</p>
</li>
<li><p> the BIC value.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>compare_models(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compare_models_+3A_...">...</code></td>
<td>
<p>A list of one or more objects of class <code><a href="#topic+fHMM_model">fHMM_model</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.frame</code> with models in rows and comparison criteria in columns.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>### 3-state HMM with t-distributions is preferred over 2-state HMM with
### normal distributions for the DAX data based on AIC and BIC
compare_models(dax_model_2n, dax_model_3t)

</code></pre>

<hr>
<h2 id='compute_ci'>Compute confidence intervals</h2><span id='topic+compute_ci'></span>

<h3>Description</h3>

<p>This helper function computes confidence intervals for the estimates of an
<code><a href="#topic+fHMM_model">fHMM_model</a></code> object using the inverse Fisher information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute_ci(x, alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compute_ci_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+fHMM_model">fHMM_model</a></code>.</p>
</td></tr>
<tr><td><code id="compute_ci_+3A_alpha">alpha</code></td>
<td>
<p>A <code>numeric</code> between 0 and 1, the alpha level for the confidence interval.
By default, <code>alpha = 0.05</code>, which computes a 95% confidence interval.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>list</code> containing the following elements:
</p>

<ul>
<li> <p><code>lb</code>: lower bound of confidence
</p>
</li>
<li> <p><code>estimate</code>: point estimate
</p>
</li>
<li> <p><code>ub</code>: upper bound of confidence
</p>
</li></ul>


<hr>
<h2 id='compute_residuals'>Compute (pseudo-) residuals</h2><span id='topic+compute_residuals'></span>

<h3>Description</h3>

<p>This function computes (pseudo-) residuals of an <code><a href="#topic+fHMM_model">fHMM_model</a></code>
object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute_residuals(x, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compute_residuals_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+fHMM_model">fHMM_model</a></code>.</p>
</td></tr>
<tr><td><code id="compute_residuals_+3A_verbose">verbose</code></td>
<td>
<p>Set to <code>TRUE</code> (default) to print progress messages.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code><a href="#topic+fHMM_model">fHMM_model</a></code> with residuals included.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>compute_residuals(dax_model_3t)
summary(residuals(dax_model_3t))
</code></pre>

<hr>
<h2 id='compute_T_star'>Compute lengths of fine-scale chunks</h2><span id='topic+compute_T_star'></span>

<h3>Description</h3>

<p>This helper function computes lengths of fine-scale chunks in the
hierarchical case.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute_T_star(horizon, period, dates = NULL, seed = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compute_T_star_+3A_horizon">horizon</code></td>
<td>
<p>The element <code>controls$horizon</code>, i.e., an integer vector of length 2,
where the second entry can be <code>NA_integer_</code>.</p>
</td></tr>
<tr><td><code id="compute_T_star_+3A_period">period</code></td>
<td>
<p>The element <code>controls$period</code>, i.e. one of <code>"w"</code>,
<code>"m"</code>, <code>"q"</code>, or <code>"y"</code>.</p>
</td></tr>
<tr><td><code id="compute_T_star_+3A_dates">dates</code></td>
<td>
<p>A <code>character</code> vector of dates of empirical fine-scale data (if any).
By default, <code>dates = NULL</code>.</p>
</td></tr>
<tr><td><code id="compute_T_star_+3A_seed">seed</code></td>
<td>
<p>Set a seed for the simulation of flexible chunk lengths.
By default, <code>seed = NULL</code> (i.e., no seed).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An <code>integer</code> vector of fine-scale chunk sizes.
</p>

<hr>
<h2 id='dax'>Deutscher Aktienindex (DAX) index data</h2><span id='topic+dax'></span>

<h3>Description</h3>

<p>Deutscher Aktienindex (DAX) index data from 1988 to 2022 from Yahoo Finance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dax
</code></pre>


<h3>Format</h3>

<p>A <code>data.frame</code> with 9012 rows and the following 7 columns:
</p>

<ul>
<li> <p><code>Date</code>: The date.
</p>
</li>
<li> <p><code>Open</code>: Opening price.
</p>
</li>
<li> <p><code>High</code>: Highest price.
</p>
</li>
<li> <p><code>Low</code>: Lowest price.
</p>
</li>
<li> <p><code>Close</code>: Close price adjusted for splits.
</p>
</li>
<li> <p><code>Adj.Close</code>: Close price adjusted for dividends and splits.
</p>
</li>
<li> <p><code>Volume</code>: Trade volume.
</p>
</li></ul>



<h3>Details</h3>

<p>The data was obtained via:
</p>
<pre>
dax &lt;- download_data(
  symbol = "^GDAXI",   # DAX identifier on Yahoo Finance
  from = "1988-01-01", # first observation
  to = "2022-12-31"    # last observation
)
</pre>

<hr>
<h2 id='dax_model_2n'>DAX 2-state HMM with normal distributions</h2><span id='topic+dax_model_2n'></span>

<h3>Description</h3>

<p>A pre-computed HMM on closing prices of the DAX from 2000 to 2022
with two hidden states and normal state-dependent distributions for
demonstration purpose.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("dax_model_2n")
</code></pre>


<h3>Format</h3>

<p>An object of class <code><a href="#topic+fHMM_model">fHMM_model</a></code>.
</p>


<h3>Details</h3>

<p>The model was estimated via:
</p>
<pre>
controls &lt;- set_controls(
  states = 2,
  sdds   = "normal",
  data   = list(
    file        = dax,
    date_column = "Date",
    data_column = "Close",
    logreturns  = TRUE,
    from        = "2000-01-03",
    to          = "2022-12-31"
  ),
  fit    = list("runs" = 10, "gradtol" = 1e-6, "steptol" = 1e-6)
)
dax_data &lt;- prepare_data(controls)
dax_model_2n &lt;- fit_model(dax_data, seed = 1)
dax_model_2n &lt;- decode_states(dax_model_2n)
dax_model_2n &lt;- compute_residuals(dax_model_2n)
summary(dax_model_2n)
</pre>

<hr>
<h2 id='dax_model_3t'>DAX 3-state HMM with t-distributions</h2><span id='topic+dax_model_3t'></span>

<h3>Description</h3>

<p>A pre-computed HMM on closing prices of the DAX from 2000 to 2022
with three hidden states and state-dependent t-distributions for
demonstration purpose.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("dax_model_3t")
</code></pre>


<h3>Format</h3>

<p>An object of class <code><a href="#topic+fHMM_model">fHMM_model</a></code>.
</p>


<h3>Details</h3>

<p>The model was estimated via:
</p>
<pre>
controls &lt;- set_controls(
  states = 3,
  sdds   = "t",
  data   = list(
    file        = dax,
    date_column = "Date",
    data_column = "Close",
    logreturns  = TRUE,
    from        = "2000-01-03",
    to          = "2022-12-31"
  ),
  fit    = list(
    runs        = 100, 
    iterlim     = 300,
    gradtol     = 1e-6,
    steptol     = 1e-6
  )
)
dax_data &lt;- prepare_data(controls)
dax_model_3t &lt;- fit_model(dax_data, seed = 1, ncluster = 10)
dax_model_3t &lt;- decode_states(dax_model_3t)
dax_model_3t &lt;- compute_residuals(dax_model_3t)
summary(dax_model_3t)
</pre>

<hr>
<h2 id='dax_vw_model'>DAX/VW hierarchical HMM with t-distributions</h2><span id='topic+dax_vw_model'></span>

<h3>Description</h3>

<p>A pre-computed HHMM with monthly averaged closing prices of the
DAX from 2010 to 2022 on the coarse scale, Volkswagen AG stock data on the
fine scale, two hidden fine-scale and coarse-scale states, respectively, and
state-dependent t-distributions for demonstration purpose.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("dax_vw_model")
</code></pre>


<h3>Format</h3>

<p>An object of class <code><a href="#topic+fHMM_model">fHMM_model</a></code>.
</p>


<h3>Details</h3>

<p>The model was estimated via:
</p>
<pre>
controls &lt;- set_controls(
  hierarchy = TRUE,
  states    = c(2, 2),
  sdds      = c("t", "t"),
  period    = "m",
  data      = list(
    file       = list(dax, vw),
    from       = "2010-01-01",
    to         = "2022-12-31",
    logreturns = c(TRUE, TRUE)
  ),
  fit       = list(
    runs       = 200, 
    iterlim    = 300,
    gradtol    = 1e-6,
    steptol    = 1e-6
  )
)
dax_vw_data &lt;- prepare_data(controls)
dax_vw_model &lt;- fit_model(dax_vw_data, seed = 1, ncluster = 10)
dax_vw_model &lt;- decode_states(dax_vw_model)
dax_vw_model &lt;- compute_residuals(dax_vw_model)
summary(dax_vw_model)
</pre>

<hr>
<h2 id='decode_states'>Decode the underlying hidden state sequence</h2><span id='topic+decode_states'></span><span id='topic+viterbi'></span>

<h3>Description</h3>

<p>This function decodes the (most likely) underlying hidden state sequence by
applying the Viterbi algorithm for global decoding.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>decode_states(x, verbose = TRUE)

viterbi(observations, nstates, sdd, Gamma, mu, sigma = NULL, df = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="decode_states_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+fHMM_model">fHMM_model</a></code>.</p>
</td></tr>
<tr><td><code id="decode_states_+3A_verbose">verbose</code></td>
<td>
<p>Set to <code>TRUE</code> to print progress messages.</p>
</td></tr>
<tr><td><code id="decode_states_+3A_observations">observations</code></td>
<td>
<p>A <code>numeric</code> <code>vector</code> of state-dependent observations.</p>
</td></tr>
<tr><td><code id="decode_states_+3A_nstates">nstates</code></td>
<td>
<p>The number of states.</p>
</td></tr>
<tr><td><code id="decode_states_+3A_sdd">sdd</code></td>
<td>
<p>A <code>character</code>, specifying the state-dependent distribution. One of
</p>

<ul>
<li> <p><code>"normal"</code> (the normal distribution),
</p>
</li>
<li> <p><code>"lognormal"</code> (the log-normal distribution),
</p>
</li>
<li> <p><code>"t"</code> (the t-distribution),
</p>
</li>
<li> <p><code>"gamma"</code> (the gamma distribution),
</p>
</li>
<li> <p><code>"poisson"</code> (the Poisson distribution).
</p>
</li></ul>
</td></tr>
<tr><td><code id="decode_states_+3A_gamma">Gamma</code></td>
<td>
<p>A transition probability <code>matrix</code> of dimension <code>nstates</code>.</p>
</td></tr>
<tr><td><code id="decode_states_+3A_mu">mu</code></td>
<td>
<p>A <code>numeric</code> vector of expected values for the state-dependent
distribution in the different states of length <code>nstates</code>.
</p>
<p>For the gamma- or Poisson-distribution, <code>mu</code> must be positive.</p>
</td></tr>
<tr><td><code id="decode_states_+3A_sigma">sigma</code></td>
<td>
<p>A positive <code>numeric</code> vector of standard deviations for the
state-dependent distribution in the different states of length <code>nstates</code>.
</p>
<p>Not relevant in case of a state-dependent Poisson distribution.</p>
</td></tr>
<tr><td><code id="decode_states_+3A_df">df</code></td>
<td>
<p>A positive <code>numeric</code> vector of degrees of freedom for the
state-dependent distribution in the different states of length <code>nstates</code>.
</p>
<p>Only relevant in case of a state-dependent t-distribution.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code><a href="#topic+fHMM_model">fHMM_model</a></code> with decoded state sequence
included.
</p>


<h3>References</h3>

<p><a href="https://en.wikipedia.org/wiki/Viterbi_algorithm">https://en.wikipedia.org/wiki/Viterbi_algorithm</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>decode_states(dax_model_3t)
plot(dax_model_3t, type = "ts")
viterbi(
  observations = c(1, 1, 1, 10, 10, 10),
  nstates      = 2,
  sdd          = "poisson",
  Gamma        = matrix(0.5, 2, 2),
  mu           = c(1, 10)
)

</code></pre>

<hr>
<h2 id='download_data'>Download financial data from Yahoo Finance</h2><span id='topic+download_data'></span>

<h3>Description</h3>

<p>This function downloads financial data from <a href="https://finance.yahoo.com/">https://finance.yahoo.com/</a>
and returns it as a <code>data.frame</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>download_data(
  symbol,
  from = "1902-01-01",
  to = Sys.Date(),
  fill_dates = FALSE,
  columns = c("Date", "Open", "High", "Low", "Close", "Adj.Close", "Volume")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="download_data_+3A_symbol">symbol</code></td>
<td>
<p>A <code>character</code>, the stock's symbol.
</p>
<p>It must match the identifier on <a href="https://finance.yahoo.com/">https://finance.yahoo.com/</a>.</p>
</td></tr>
<tr><td><code id="download_data_+3A_from">from</code></td>
<td>
<p>A <code>character</code> in the format <code>"YYYY-MM-DD"</code>, setting the lower
data bound.
</p>
<p>Must not be earlier than <code>"1902-01-01"</code> (default).</p>
</td></tr>
<tr><td><code id="download_data_+3A_to">to</code></td>
<td>
<p>A <code>character</code> in the format <code>"YYYY-MM-DD"</code>, setting the upper
data bound.
</p>
<p>Default is the current date <code>Sys.date()</code>.</p>
</td></tr>
<tr><td><code id="download_data_+3A_fill_dates">fill_dates</code></td>
<td>
<p>Set to <code>TRUE</code> to fill missing dates (e.g., days at which the stock
market is closed) with <code>NA</code>'s.
</p>
<p>By default, <code>fill_dates = FALSE</code>.</p>
</td></tr>
<tr><td><code id="download_data_+3A_columns">columns</code></td>
<td>
<p>A <code>character</code> of requested data columns, see the details.
</p>
<p>By default, all columns are returned.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Yahoo Finance provides historical daily data for stocks or indices.
The following data columns are available:
</p>

<ul>
<li> <p><code>Date</code>: The date.
</p>
</li>
<li> <p><code>Open</code>: Opening price.
</p>
</li>
<li> <p><code>High</code>: Highest price.
</p>
</li>
<li> <p><code>Low</code>: Lowest price.
</p>
</li>
<li> <p><code>Close</code>: Close price adjusted for splits.
</p>
</li>
<li> <p><code>Adj.Close</code>: Close price adjusted for dividends and splits.
</p>
</li>
<li> <p><code>Volume</code>: Trade volume.
</p>
</li></ul>



<h3>Value</h3>

<p>A <code>data.frame</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>### 21st century DAX closing prices
data &lt;- download_data(
  symbol = "^GDAXI", from = "2000-01-01", columns = c("Date", "Close"),
  fill_dates = TRUE
)
head(data)

</code></pre>

<hr>
<h2 id='fHMM_colors'>Set color scheme for visualizations</h2><span id='topic+fHMM_colors'></span>

<h3>Description</h3>

<p>This helper function defines a color scheme for visualizations in the
{fHMM} package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fHMM_colors(controls, colors = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fHMM_colors_+3A_controls">controls</code></td>
<td>
<p>An object of class <code>fHMM_controls</code>.
It can be created with <code><a href="#topic+set_controls">set_controls</a></code>.</p>
</td></tr>
<tr><td><code id="fHMM_colors_+3A_colors">colors</code></td>
<td>
<p>Either <code>NULL</code> (default) or a <code>character</code> vector of color names or
hexadecimal RGB triplets.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>fHMM_colors</code>, which is:
</p>

<ul>
<li><p> for <code>controls$hierarchy == FALSE</code> a <code>character</code> vector of
length <code>controls$states</code> of color codes,
</p>
</li>
<li><p> for <code>controls$hierarchy == TRUE</code> a <code>list</code> of
</p>

<ul>
<li><p> a <code>character</code> vector of length  <code>controls$states[1]</code> and
</p>
</li>
<li><p> a <code>character</code> matrix of dimensions <code>controls$states</code>
</p>
</li></ul>

<p>with color codes.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
controls &lt;- set_controls()
fHMM_colors(controls, colors = c("red", "blue"))

## End(Not run)

</code></pre>

<hr>
<h2 id='fHMM_data'>Constructor of an <code>fHMM_data</code> object</h2><span id='topic+fHMM_data'></span><span id='topic+print.fHMM_data'></span><span id='topic+summary.fHMM_data'></span>

<h3>Description</h3>

<p>This function constructs an object of class <code>fHMM_data</code>, which contains
the financial data for modeling.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fHMM_data(
  dates,
  time_points,
  markov_chain,
  data,
  time_series,
  T_star,
  controls,
  true_parameters
)

## S3 method for class 'fHMM_data'
print(x, ...)

## S3 method for class 'fHMM_data'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fHMM_data_+3A_dates">dates</code></td>
<td>
<p>The dates in the empirical case.</p>
</td></tr>
<tr><td><code id="fHMM_data_+3A_time_points">time_points</code></td>
<td>
<p>The time points in the simulated case.</p>
</td></tr>
<tr><td><code id="fHMM_data_+3A_markov_chain">markov_chain</code></td>
<td>
<p>The states in the simulated case.</p>
</td></tr>
<tr><td><code id="fHMM_data_+3A_data">data</code></td>
<td>
<p>The data for modeling.</p>
</td></tr>
<tr><td><code id="fHMM_data_+3A_time_series">time_series</code></td>
<td>
<p>The data before transformation.</p>
</td></tr>
<tr><td><code id="fHMM_data_+3A_t_star">T_star</code></td>
<td>
<p>The fine-scale chunk sizes.</p>
</td></tr>
<tr><td><code id="fHMM_data_+3A_controls">controls</code></td>
<td>
<p>The <code>fHMM_controls</code> object.</p>
</td></tr>
<tr><td><code id="fHMM_data_+3A_true_parameters">true_parameters</code></td>
<td>
<p>The <code>fHMM_parameters</code> object in the simulated case.</p>
</td></tr>
<tr><td><code id="fHMM_data_+3A_x">x</code></td>
<td>
<p>An object of class <code>fHMM_data</code>.</p>
</td></tr>
<tr><td><code id="fHMM_data_+3A_...">...</code></td>
<td>
<p>Currently not used.</p>
</td></tr>
<tr><td><code id="fHMM_data_+3A_object">object</code></td>
<td>
<p>An object of class <code>fHMM_data</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>fHMM_data</code>, which is a <code>list</code> containing
the following elements:
</p>

<ul>
<li><p> The <code>matrix</code> of the <code>dates</code> if <code>simulated = FALSE</code> and
<code>controls$data$data_column</code> is specified,
</p>
</li>
<li><p> the <code>matrix</code> of the <code>time_points</code> if <code>simulated = TRUE</code>
or <code>controls$data$data_column</code> is not specified,
</p>
</li>
<li><p> the <code>matrix</code> of the simulated <code>markov_chain</code> if
<code>simulated = TRUE</code>,
</p>
</li>
<li><p> the <code>matrix</code> of the simulated or empirical <code>data</code> used for
estimation,
</p>
</li>
<li><p> the <code>matrix</code> <code>time_series</code> of empirical data before the
transformation to log-returns if <code>simulated = FALSE</code>,
</p>
</li>
<li><p> the <code>vector</code> of fine-scale chunk sizes <code>T_star</code> if
<code>controls$hierarchy = TRUE</code>,
</p>
</li>
<li><p> the input <code>controls</code>,
</p>
</li>
<li><p> the <code>true_parameters</code>.
</p>
</li></ul>


<hr>
<h2 id='fHMM_events'>Checking events</h2><span id='topic+fHMM_events'></span><span id='topic+print.fHMM_events'></span>

<h3>Description</h3>

<p>This function checks the input <code>events</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fHMM_events(events)

## S3 method for class 'fHMM_events'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fHMM_events_+3A_events">events</code></td>
<td>
<p>A <code>list</code> of two elements.
</p>

<ul>
<li><p> The first element is named <code>"dates"</code> and contains a <code>character</code>
vector in format <code>"YYYY-MM-DD"</code>.
</p>
</li>
<li><p> The second element is named <code>"labels"</code> and is a <code>character</code>
vector of the same length as <code>"dates"</code>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="fHMM_events_+3A_x">x</code></td>
<td>
<p>An object of class <code>fHMM_events</code>.</p>
</td></tr>
<tr><td><code id="fHMM_events_+3A_...">...</code></td>
<td>
<p>Currently not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>fHMM_events</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>events &lt;- list(
  dates = c("2001-09-11", "2008-09-15", "2020-01-27"),
  labels = c(
    "9/11 terrorist attack", "Bankruptcy Lehman Brothers",
    "First COVID-19 case Germany"
  )
)
events &lt;- fHMM_events(events)

</code></pre>

<hr>
<h2 id='fHMM_model'>Constructor of a model object</h2><span id='topic+fHMM_model'></span><span id='topic+print.fHMM_model'></span><span id='topic+residuals.fHMM_model'></span><span id='topic+summary.fHMM_model'></span><span id='topic+coef.fHMM_model'></span><span id='topic+AIC.fHMM_model'></span><span id='topic+BIC.fHMM_model'></span><span id='topic+nobs.fHMM_model'></span><span id='topic+logLik.fHMM_model'></span><span id='topic+npar'></span><span id='topic+npar.fHMM_model'></span><span id='topic+predict.fHMM_model'></span>

<h3>Description</h3>

<p>This function constructs an object of class <code><a href="#topic+fHMM_model">fHMM_model</a></code>, which
contains details about the fitted (hierarchical) Hidden Markov model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fHMM_model(
  data,
  estimate,
  nlm_output,
  estimation_time,
  ll,
  lls,
  gradient,
  inverse_fisher,
  decoding
)

## S3 method for class 'fHMM_model'
print(x, ...)

## S3 method for class 'fHMM_model'
residuals(object, ...)

## S3 method for class 'fHMM_model'
summary(object, alpha = 0.05, ...)

## S3 method for class 'fHMM_model'
coef(object, alpha = 0.05, digits = 2, ...)

## S3 method for class 'fHMM_model'
AIC(object, ..., k = 2)

## S3 method for class 'fHMM_model'
BIC(object, ...)

## S3 method for class 'fHMM_model'
nobs(object, ...)

## S3 method for class 'fHMM_model'
logLik(object, ...)

npar(object, ...)

## S3 method for class 'fHMM_model'
npar(object, ...)

## S3 method for class 'fHMM_model'
predict(object, ahead = 5, alpha = 0.05, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fHMM_model_+3A_data">data</code></td>
<td>
<p>An object of class <code><a href="#topic+fHMM_data">fHMM_data</a></code>.</p>
</td></tr>
<tr><td><code id="fHMM_model_+3A_estimate">estimate</code></td>
<td>
<p>A <code>numeric</code> vector of unconstrained model estimates.</p>
</td></tr>
<tr><td><code id="fHMM_model_+3A_nlm_output">nlm_output</code></td>
<td>
<p>The output of <code><a href="stats.html#topic+nlm">nlm</a></code> for the selected optimization run.</p>
</td></tr>
<tr><td><code id="fHMM_model_+3A_estimation_time">estimation_time</code></td>
<td>
<p>A <code>diff.time</code> object, the total estimation time.</p>
</td></tr>
<tr><td><code id="fHMM_model_+3A_ll">ll</code></td>
<td>
<p>A <code>numeric</code>, the model log-likelihood.</p>
</td></tr>
<tr><td><code id="fHMM_model_+3A_lls">lls</code></td>
<td>
<p>A <code>numeric</code> vector, the model log-likelihoods in all optimization runs.</p>
</td></tr>
<tr><td><code id="fHMM_model_+3A_gradient">gradient</code></td>
<td>
<p>A <code>numeric</code> vector, the gradient at the optimum.</p>
</td></tr>
<tr><td><code id="fHMM_model_+3A_inverse_fisher">inverse_fisher</code></td>
<td>
<p>A <code>numeric</code> vector, the inverse Fisher information for each parameter.</p>
</td></tr>
<tr><td><code id="fHMM_model_+3A_decoding">decoding</code></td>
<td>
<p>A <code>numeric</code> vector, the decoded time series.</p>
</td></tr>
<tr><td><code id="fHMM_model_+3A_x">x</code>, <code id="fHMM_model_+3A_object">object</code></td>
<td>
<p>An object of class <code><a href="#topic+fHMM_model">fHMM_model</a></code>.</p>
</td></tr>
<tr><td><code id="fHMM_model_+3A_...">...</code></td>
<td>
<p>Currently not used.</p>
</td></tr>
<tr><td><code id="fHMM_model_+3A_alpha">alpha</code></td>
<td>
<p>A <code>numeric</code> between 0 and 1, the confidence level.</p>
</td></tr>
<tr><td><code id="fHMM_model_+3A_digits">digits</code></td>
<td>
<p>The number of decimal places.</p>
</td></tr>
<tr><td><code id="fHMM_model_+3A_k">k</code></td>
<td>
<p>Passed on to <code><a href="stats.html#topic+AIC">AIC</a></code>.</p>
</td></tr>
<tr><td><code id="fHMM_model_+3A_ahead">ahead</code></td>
<td>
<p>The number of time points to predict ahead.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code><a href="#topic+fHMM_model">fHMM_model</a></code>.
</p>

<hr>
<h2 id='fHMM_parameters'>Set and check model parameters</h2><span id='topic+fHMM_parameters'></span><span id='topic+print.fHMM_parameters'></span>

<h3>Description</h3>

<p>This function sets and checks model parameters.
Unspecified parameters are sampled.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fHMM_parameters(
  controls = list(),
  hierarchy = FALSE,
  states = if (!hierarchy) 2 else c(2, 2),
  sdds = if (!hierarchy) "normal" else c("normal", "normal"),
  Gamma = NULL,
  mu = NULL,
  sigma = NULL,
  df = NULL,
  Gamma_star = NULL,
  mu_star = NULL,
  sigma_star = NULL,
  df_star = NULL,
  scale_par = c(1, 1),
  seed = NULL,
  check_controls = TRUE
)

## S3 method for class 'fHMM_parameters'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fHMM_parameters_+3A_controls">controls</code></td>
<td>
<p>Either a <code>list</code> or an object of class <code>fHMM_controls</code>.
</p>
<p>The <code>list</code> can contain the following elements, which are described
in more detail below:
</p>

<ul>
<li> <p><code>hierarchy</code>, defines an hierarchical HMM,
</p>
</li>
<li> <p><code>states</code>, defines the number of states,
</p>
</li>
<li> <p><code>sdds</code>, defines the state-dependent distributions,
</p>
</li>
<li> <p><code>horizon</code>, defines the time horizon,
</p>
</li>
<li> <p><code>period</code>, defines a flexible, periodic fine-scale time horizon,
</p>
</li>
<li> <p><code>data</code>, a <code>list</code> of controls that define the data,
</p>
</li>
<li> <p><code>fit</code>, a <code>list</code> of controls that define the model fitting
</p>
</li></ul>

<p>Either none, all, or selected elements can be specified.
</p>
<p>Unspecified parameters are set to their default values.
</p>
<p>Important: Specifications in <code>controls</code> always override individual
specifications.</p>
</td></tr>
<tr><td><code id="fHMM_parameters_+3A_hierarchy">hierarchy</code></td>
<td>
<p>A <code>logical</code>, set to <code>TRUE</code> for an hierarchical HMM.
</p>
<p>If <code>hierarchy = TRUE</code>, some of the other controls must be specified for
the coarse-scale and the fine-scale layer.
</p>
<p>By default, <code>hierarchy = FALSE</code>.</p>
</td></tr>
<tr><td><code id="fHMM_parameters_+3A_states">states</code></td>
<td>
<p>An <code>integer</code>, the number of states of the underlying Markov chain.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>states</code> must be a <code>vector</code> of length
2. The first entry corresponds to the coarse-scale layer, while the second
entry corresponds to the fine-scale layer.
</p>
<p>By default, <code>states = 2</code> if <code>hierarchy = FALSE</code> and
<code>states = c(2, 2)</code> if <code>hierarchy = TRUE</code>.</p>
</td></tr>
<tr><td><code id="fHMM_parameters_+3A_sdds">sdds</code></td>
<td>
<p>A <code>character</code>, specifying the state-dependent distribution. One of
</p>

<ul>
<li> <p><code>"normal"</code> (the normal distribution),
</p>
</li>
<li> <p><code>"lognormal"</code> (the log-normal distribution),
</p>
</li>
<li> <p><code>"t"</code> (the t-distribution),
</p>
</li>
<li> <p><code>"gamma"</code> (the gamma distribution),
</p>
</li>
<li> <p><code>"poisson"</code> (the Poisson distribution).
</p>
</li></ul>

<p>The distribution parameters, i.e. the
</p>

<ul>
<li><p> mean <code>mu</code>,
</p>
</li>
<li><p> standard deviation <code>sigma</code> (not for the Poisson distribution),
</p>
</li>
<li><p> degrees of freedom <code>df</code> (only for the t-distribution),
</p>
</li></ul>

<p>can be fixed via, e.g., <code>"t(df = 1)"</code> or
<code>"gamma(mu = 0, sigma = 1)"</code>.
To fix different values of a parameter for different states, separate by
&quot;|&quot;, e.g. <code>"poisson(mu = 1|2|3)"</code>.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>sdds</code> must be a <code>vector</code> of length 2.
The first entry corresponds to the coarse-scale layer, while the second entry
corresponds to the fine-scale layer.
</p>
<p>By default, <code>sdds = "normal"</code> if <code>hierarchy = FALSE</code> and
<code>sdds = c("normal", "normal")</code> if <code>hierarchy = TRUE</code>.</p>
</td></tr>
<tr><td><code id="fHMM_parameters_+3A_gamma">Gamma</code>, <code id="fHMM_parameters_+3A_gamma_star">Gamma_star</code></td>
<td>
<p>A transition probability <code>matrix</code>.
</p>
<p>It should have dimension <code>states[1]</code>.
</p>
<p><code>Gamma_star</code> is a <code>list</code> of fine-scale transition probability
matrices. The <code>list</code> must be of length <code>states[1]</code>.
Each transition probability matrix must be of dimension <code>states[2]</code>.</p>
</td></tr>
<tr><td><code id="fHMM_parameters_+3A_mu">mu</code>, <code id="fHMM_parameters_+3A_mu_star">mu_star</code></td>
<td>
<p>A <code>numeric</code> vector of expected values for the state-dependent
distribution in the different states.
</p>
<p>For the gamma- or Poisson-distribution, <code>mu</code> must be positive.
</p>
<p>It should have length <code>states[1]</code>.
</p>
<p><code>mu_star</code> is a <code>list</code> of <code>vectors</code> with fine-scale
expectations. The <code>list</code> must be of length <code>states[1]</code>.
Each <code>vector</code> must be of length <code>states[2]</code>.</p>
</td></tr>
<tr><td><code id="fHMM_parameters_+3A_sigma">sigma</code>, <code id="fHMM_parameters_+3A_sigma_star">sigma_star</code></td>
<td>
<p>A positive <code>numeric</code> vector of standard deviations for the
state-dependent distribution in the different states.
</p>
<p>It should have length <code>states[1]</code>.
</p>
<p><code>sigma_star</code> is a <code>list</code> of <code>vectors</code> with fine-scale
standard deviations. The <code>list</code> must be of length <code>states[1]</code>.
Each vector must be of length <code>states[2]</code>.</p>
</td></tr>
<tr><td><code id="fHMM_parameters_+3A_df">df</code>, <code id="fHMM_parameters_+3A_df_star">df_star</code></td>
<td>
<p>A positive <code>numeric</code> vector of degrees of freedom for the
state-dependent distribution in the different states.
</p>
<p>It should have length <code>states[1]</code>.
</p>
<p>Only relevant in case of a state-dependent t-distribution.
</p>
<p><code>df_star</code> is a <code>list</code> of <code>vectors</code> with fine-scale
degrees of freedom. The <code>list</code> must be of length <code>states[1]</code>.
Each vector must be of length <code>states[2]</code>.
Only relevant in case of a fine-scale state-dependent t-distribution.</p>
</td></tr>
<tr><td><code id="fHMM_parameters_+3A_scale_par">scale_par</code></td>
<td>
<p>A positive <code>numeric</code> vector of length two, containing scales for sampled
expectations and standard deviations.
</p>
<p>The first entry is the scale for
<code>mu</code> and <code>sigma</code>, the second entry is the scale for
<code>mu_star</code> and <code>sigma_star</code> (if any).</p>
</td></tr>
<tr><td><code id="fHMM_parameters_+3A_seed">seed</code></td>
<td>
<p>Sets a seed for the sampling of parameters.</p>
</td></tr>
<tr><td><code id="fHMM_parameters_+3A_check_controls">check_controls</code></td>
<td>
<p>Either <code>TRUE</code> to check the defined controls or <code>FALSE</code> to not check
them (which saves computation time), else.</p>
</td></tr>
<tr><td><code id="fHMM_parameters_+3A_x">x</code></td>
<td>
<p>An object of class <code>fHMM_parameters</code>.</p>
</td></tr>
<tr><td><code id="fHMM_parameters_+3A_...">...</code></td>
<td>
<p>Currently not used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See the <a href="https://loelschlaeger.de/fHMM/articles/">vignette on the model definition</a>
for more details.
</p>


<h3>Value</h3>

<p>An object of class <code>fHMM_parameters</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>parameters &lt;- fHMM_parameters(states = 2, sdds = "normal")
parameters$Gamma
</code></pre>

<hr>
<h2 id='fHMM_sdds'>Define state-dependent distributions</h2><span id='topic+fHMM_sdds'></span><span id='topic+print.fHMM_sdds'></span>

<h3>Description</h3>

<p>This helper function defines state-dependent distributions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fHMM_sdds(sdds, states)

## S3 method for class 'fHMM_sdds'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fHMM_sdds_+3A_sdds">sdds</code></td>
<td>
<p>A <code>character</code>, specifying the state-dependent distribution. One of
</p>

<ul>
<li> <p><code>"normal"</code> (the normal distribution),
</p>
</li>
<li> <p><code>"lognormal"</code> (the log-normal distribution),
</p>
</li>
<li> <p><code>"t"</code> (the t-distribution),
</p>
</li>
<li> <p><code>"gamma"</code> (the gamma distribution),
</p>
</li>
<li> <p><code>"poisson"</code> (the Poisson distribution).
</p>
</li></ul>

<p>The distribution parameters, i.e. the
</p>

<ul>
<li><p> mean <code>mu</code>,
</p>
</li>
<li><p> standard deviation <code>sigma</code> (not for the Poisson distribution),
</p>
</li>
<li><p> degrees of freedom <code>df</code> (only for the t-distribution),
</p>
</li></ul>

<p>can be fixed via, e.g., <code>"t(df = 1)"</code> or
<code>"gamma(mu = 0, sigma = 1)"</code>.
To fix different values of a parameter for different states, separate by
&quot;|&quot;, e.g. <code>"poisson(mu = 1|2|3)"</code>.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>sdds</code> must be a <code>vector</code> of length 2.
The first entry corresponds to the coarse-scale layer, while the second entry
corresponds to the fine-scale layer.
</p>
<p>By default, <code>sdds = "normal"</code> if <code>hierarchy = FALSE</code> and
<code>sdds = c("normal", "normal")</code> if <code>hierarchy = TRUE</code>.</p>
</td></tr>
<tr><td><code id="fHMM_sdds_+3A_states">states</code></td>
<td>
<p>An <code>integer</code>, the number of states of the underlying Markov chain.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>states</code> must be a <code>vector</code> of length
2. The first entry corresponds to the coarse-scale layer, while the second
entry corresponds to the fine-scale layer.
</p>
<p>By default, <code>states = 2</code> if <code>hierarchy = FALSE</code> and
<code>states = c(2, 2)</code> if <code>hierarchy = TRUE</code>.</p>
</td></tr>
<tr><td><code id="fHMM_sdds_+3A_...">...</code></td>
<td>
<p>Currently not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>list</code> of length <code>1</code> (or <code>2</code> in the hierarchical case).
Each element again is a <code>list</code>, containing
</p>

<ul>
<li><p> the <code>"name"</code> of the distribution
</p>
</li>
<li><p> and a list <code>"pars"</code> of its parameters, where unknown parameters are
set to <code>NULL</code>.
</p>
</li></ul>


<hr>
<h2 id='find_closest_year'>Find closest year</h2><span id='topic+find_closest_year'></span>

<h3>Description</h3>

<p>This function takes a <code>date</code> as input and returns the closest year.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>find_closest_year(date)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="find_closest_year_+3A_date">date</code></td>
<td>
<p>[<code>character(1)</code>]<br />
The date in format <code>"YYYY-MM-DD"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An <code>integer</code>, the closest year to the input date.
</p>

<hr>
<h2 id='fit_model'>Model fitting</h2><span id='topic+fit_model'></span>

<h3>Description</h3>

<p>This function fits a hidden Markov model via numerical likelihood
maximization.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_model(
  data,
  controls = data[["controls"]],
  fit = list(),
  runs = 10,
  origin = FALSE,
  accept = 1:3,
  gradtol = 0.01,
  iterlim = 100,
  print.level = 0,
  steptol = 0.01,
  ncluster = 1,
  seed = NULL,
  verbose = TRUE,
  initial_estimate = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fit_model_+3A_data">data</code></td>
<td>
<p>An object of class <code><a href="#topic+fHMM_data">fHMM_data</a></code>.</p>
</td></tr>
<tr><td><code id="fit_model_+3A_controls">controls</code></td>
<td>
<p>Either a <code>list</code> or an object of class <code>fHMM_controls</code>.
</p>
<p>The <code>list</code> can contain the following elements, which are described
in more detail below:
</p>

<ul>
<li> <p><code>hierarchy</code>, defines an hierarchical HMM,
</p>
</li>
<li> <p><code>states</code>, defines the number of states,
</p>
</li>
<li> <p><code>sdds</code>, defines the state-dependent distributions,
</p>
</li>
<li> <p><code>horizon</code>, defines the time horizon,
</p>
</li>
<li> <p><code>period</code>, defines a flexible, periodic fine-scale time horizon,
</p>
</li>
<li> <p><code>data</code>, a <code>list</code> of controls that define the data,
</p>
</li>
<li> <p><code>fit</code>, a <code>list</code> of controls that define the model fitting
</p>
</li></ul>

<p>Either none, all, or selected elements can be specified.
</p>
<p>Unspecified parameters are set to their default values.
</p>
<p>Important: Specifications in <code>controls</code> always override individual
specifications.</p>
</td></tr>
<tr><td><code id="fit_model_+3A_fit">fit</code></td>
<td>
<p>A <code>list</code> of controls specifying the model fitting.
</p>
<p>The <code>list</code> can contain the following elements, which are described
in more detail below:
</p>

<ul>
<li> <p><code>runs</code>, defines the number of numerical optimization runs,
</p>
</li>
<li> <p><code>origin</code>, defines initialization at the true parameters,
</p>
</li>
<li> <p><code>accept</code>, defines the set of accepted optimization runs,
</p>
</li>
<li> <p><code>gradtol</code>, defines the gradient tolerance,
</p>
</li>
<li> <p><code>iterlim</code>, defines the iteration limit,
</p>
</li>
<li> <p><code>print.level</code>, defines the level of printing,
</p>
</li>
<li> <p><code>steptol</code>, defines the minimum allowable relative step length.
</p>
</li></ul>

<p>Either none, all, or selected elements can be specified.
</p>
<p>Unspecified parameters are set to their default values, see below.
</p>
<p>Specifications in <code>fit</code> override individual specifications.</p>
</td></tr>
<tr><td><code id="fit_model_+3A_runs">runs</code></td>
<td>
<p>An <code>integer</code>, setting the number of randomly initialized
optimization runs of the model likelihood from which the best one is selected
as the final model.
</p>
<p>By default, <code>runs = 10</code>.</p>
</td></tr>
<tr><td><code id="fit_model_+3A_origin">origin</code></td>
<td>
<p>Only relevant for simulated data, i.e., if the <code>data</code> control is
<code>NA</code>.
</p>
<p>In this case, a <code>logical</code>. If <code>origin = TRUE</code> the optimization is
initialized at the true parameter values.
This sets <code>run = 1</code> and <code>accept = 1:5</code>.
</p>
<p>By default, <code>origin = FALSE</code>.</p>
</td></tr>
<tr><td><code id="fit_model_+3A_accept">accept</code></td>
<td>
<p>An <code>integer</code> (vector), specifying which optimization runs are
accepted based on the output code of <code><a href="stats.html#topic+nlm">nlm</a></code>.
</p>
<p>By default, <code>accept = 1:3</code>.</p>
</td></tr>
<tr><td><code id="fit_model_+3A_gradtol">gradtol</code></td>
<td>
<p>A positive <code>numeric</code> value, specifying the gradient tolerance, passed on
to <code><a href="stats.html#topic+nlm">nlm</a></code>.
</p>
<p>By default, <code>gradtol = 0.01</code>.</p>
</td></tr>
<tr><td><code id="fit_model_+3A_iterlim">iterlim</code></td>
<td>
<p>A positive <code>integer</code> value, specifying the iteration limit, passed on
to <code><a href="stats.html#topic+nlm">nlm</a></code>.
</p>
<p>By default, <code>iterlim = 100</code>.</p>
</td></tr>
<tr><td><code id="fit_model_+3A_print.level">print.level</code></td>
<td>
<p>One of <code>0</code>, <code>1</code>, and <code>2</code> to control the verbosity of the
numerical likelihood optimization, passed on to <code><a href="stats.html#topic+nlm">nlm</a></code>.
</p>
<p>By default, <code>print.level = 0</code>.</p>
</td></tr>
<tr><td><code id="fit_model_+3A_steptol">steptol</code></td>
<td>
<p>A positive <code>numeric</code> value, specifying the step tolerance, passed on
to <code><a href="stats.html#topic+nlm">nlm</a></code>.
</p>
<p>By default, <code>gradtol = 0.01</code>.</p>
</td></tr>
<tr><td><code id="fit_model_+3A_ncluster">ncluster</code></td>
<td>
<p>Set the number of clusters for parallel optimization runs to reduce
optimization time.
By default, <code>ncluster = 1</code> (no clustering).</p>
</td></tr>
<tr><td><code id="fit_model_+3A_seed">seed</code></td>
<td>
<p>Set a seed for the generation of initial values.
No seed by default.</p>
</td></tr>
<tr><td><code id="fit_model_+3A_verbose">verbose</code></td>
<td>
<p>Set to <code>TRUE</code> to print progress messages.</p>
</td></tr>
<tr><td><code id="fit_model_+3A_initial_estimate">initial_estimate</code></td>
<td>
<p>Optionally defines an initial estimate for the numerical likelihood
optimization. Good initial estimates can improve the optimization process.
Can be:
</p>

<ul>
<li> <p><code>NULL</code> (the default), in this case
</p>

<ul>
<li><p> applies a heuristic to calculate a good initial estimate
</p>
</li>
<li><p> or uses the true parameter values (if available and
<code>data$controls$origin</code> is <code>TRUE</code>)
</p>
</li></ul>

</li>
<li><p> or an object of class <code>parUncon</code> (i.e., a <code>numeric</code> of
unconstrained model parameters), for example the estimate of a
previously fitted model (i.e. the element <code>model$estimate</code>).
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>Multiple optimization runs starting from different initial values are
computed in parallel if <code>ncluster &gt; 1</code>.
</p>


<h3>Value</h3>

<p>An object of class <code><a href="#topic+fHMM_model">fHMM_model</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>### 2-state HMM with normal distributions

# set specifications
controls &lt;- set_controls(
  states = 2, sdds = "normal", horizon = 100, runs = 10
)

# define parameters
parameters &lt;- fHMM_parameters(controls, mu = c(-1, 1), seed = 1)

# sample data
data &lt;- prepare_data(controls, true_parameter = parameters, seed = 1)

# fit model
model &lt;- fit_model(data, seed = 1)

# inspect fit
summary(model)
plot(model, "sdds")

# decode states
model &lt;- decode_states(model)
plot(model, "ts")

# predict
predict(model, ahead = 5)

</code></pre>

<hr>
<h2 id='get_initial_values'>Initialization of numerical likelihood optimization</h2><span id='topic+get_initial_values'></span>

<h3>Description</h3>

<p>This helper function generates a set of initial values for the numerical
optimization of the model likelihood function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_initial_values(
  data,
  ncluster = 1,
  seed = NULL,
  verbose = TRUE,
  initial_estimate = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_initial_values_+3A_data">data</code></td>
<td>
<p>An object of class <code><a href="#topic+fHMM_data">fHMM_data</a></code>.</p>
</td></tr>
<tr><td><code id="get_initial_values_+3A_ncluster">ncluster</code></td>
<td>
<p>Set the number of clusters for parallel optimization runs to reduce
optimization time.
By default, <code>ncluster = 1</code> (no clustering).</p>
</td></tr>
<tr><td><code id="get_initial_values_+3A_seed">seed</code></td>
<td>
<p>Set a seed for the generation of initial values.
No seed by default.</p>
</td></tr>
<tr><td><code id="get_initial_values_+3A_verbose">verbose</code></td>
<td>
<p>Set to <code>TRUE</code> to print progress messages.</p>
</td></tr>
<tr><td><code id="get_initial_values_+3A_initial_estimate">initial_estimate</code></td>
<td>
<p>Optionally defines an initial estimate for the numerical likelihood
optimization. Good initial estimates can improve the optimization process.
Can be:
</p>

<ul>
<li> <p><code>NULL</code> (the default), in this case
</p>

<ul>
<li><p> applies a heuristic to calculate a good initial estimate
</p>
</li>
<li><p> or uses the true parameter values (if available and
<code>data$controls$origin</code> is <code>TRUE</code>)
</p>
</li></ul>

</li>
<li><p> or an object of class <code>parUncon</code> (i.e., a <code>numeric</code> of
unconstrained model parameters), for example the estimate of a
previously fitted model (i.e. the element <code>model$estimate</code>).
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>list</code>, where each element is an object of class <code>parUncon</code>.
</p>

<hr>
<h2 id='list_to_vector'>List to vector</h2><span id='topic+list_to_vector'></span>

<h3>Description</h3>

<p>This function produces a <code>vector</code> from a <code>list</code> structure and
replaces <code>NULL</code> elements by <code>NA</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>list_to_vector(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="list_to_vector_+3A_x">x</code></td>
<td>
<p>[<code>list()</code>]<br />
A <code>list</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>numeric</code>.
</p>

<hr>
<h2 id='ll_hmm'>Log-likelihood function of an (H)HMM</h2><span id='topic+ll_hmm'></span>

<h3>Description</h3>

<p>This function computes the log-likelihood value of a (hierarchical) hidden
Markov model for given observations and parameter values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ll_hmm(
  parUncon,
  observations,
  controls = list(),
  hierarchy = FALSE,
  states = if (!hierarchy) 2 else c(2, 2),
  sdds = if (!hierarchy) "normal" else c("normal", "normal"),
  negative = FALSE,
  check_controls = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ll_hmm_+3A_paruncon">parUncon</code></td>
<td>
<p>An object of class <code>parUncon</code>, which is a <code>numeric</code> <code>vector</code>
with identified and unconstrained model parameters in the following order:
</p>

<ol>
<li><p> non-diagonal transition probabilities <code>gammasUncon</code>
</p>
</li>
<li><p> expectations <code>muUncon</code>
</p>
</li>
<li><p> standard deviations <code>sigmaUncon</code> (if any)
</p>
</li>
<li><p> degrees of freedom <code>dfUncon</code> (if any)
</p>
</li>
<li><p> fine-scale parameters for each coarse-scale state, in the same order (if any)
</p>
</li></ol>
</td></tr>
<tr><td><code id="ll_hmm_+3A_observations">observations</code></td>
<td>
<p>A <code>numeric</code> <code>vector</code> of time-series data.
</p>
<p>In the hierarchical case (<code>hierarchy = TRUE</code>), a <code>matrix</code> with
coarse-scale data in the first column and corresponding fine-scale data in
the rows.</p>
</td></tr>
<tr><td><code id="ll_hmm_+3A_controls">controls</code></td>
<td>
<p>Either a <code>list</code> or an object of class <code>fHMM_controls</code>.
</p>
<p>The <code>list</code> can contain the following elements, which are described
in more detail below:
</p>

<ul>
<li> <p><code>hierarchy</code>, defines an hierarchical HMM,
</p>
</li>
<li> <p><code>states</code>, defines the number of states,
</p>
</li>
<li> <p><code>sdds</code>, defines the state-dependent distributions,
</p>
</li>
<li> <p><code>horizon</code>, defines the time horizon,
</p>
</li>
<li> <p><code>period</code>, defines a flexible, periodic fine-scale time horizon,
</p>
</li>
<li> <p><code>data</code>, a <code>list</code> of controls that define the data,
</p>
</li>
<li> <p><code>fit</code>, a <code>list</code> of controls that define the model fitting
</p>
</li></ul>

<p>Either none, all, or selected elements can be specified.
</p>
<p>Unspecified parameters are set to their default values.
</p>
<p>Important: Specifications in <code>controls</code> always override individual
specifications.</p>
</td></tr>
<tr><td><code id="ll_hmm_+3A_hierarchy">hierarchy</code></td>
<td>
<p>A <code>logical</code>, set to <code>TRUE</code> for an hierarchical HMM.
</p>
<p>If <code>hierarchy = TRUE</code>, some of the other controls must be specified for
the coarse-scale and the fine-scale layer.
</p>
<p>By default, <code>hierarchy = FALSE</code>.</p>
</td></tr>
<tr><td><code id="ll_hmm_+3A_states">states</code></td>
<td>
<p>An <code>integer</code>, the number of states of the underlying Markov chain.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>states</code> must be a <code>vector</code> of length
2. The first entry corresponds to the coarse-scale layer, while the second
entry corresponds to the fine-scale layer.
</p>
<p>By default, <code>states = 2</code> if <code>hierarchy = FALSE</code> and
<code>states = c(2, 2)</code> if <code>hierarchy = TRUE</code>.</p>
</td></tr>
<tr><td><code id="ll_hmm_+3A_sdds">sdds</code></td>
<td>
<p>A <code>character</code>, specifying the state-dependent distribution. One of
</p>

<ul>
<li> <p><code>"normal"</code> (the normal distribution),
</p>
</li>
<li> <p><code>"lognormal"</code> (the log-normal distribution),
</p>
</li>
<li> <p><code>"t"</code> (the t-distribution),
</p>
</li>
<li> <p><code>"gamma"</code> (the gamma distribution),
</p>
</li>
<li> <p><code>"poisson"</code> (the Poisson distribution).
</p>
</li></ul>

<p>The distribution parameters, i.e. the
</p>

<ul>
<li><p> mean <code>mu</code>,
</p>
</li>
<li><p> standard deviation <code>sigma</code> (not for the Poisson distribution),
</p>
</li>
<li><p> degrees of freedom <code>df</code> (only for the t-distribution),
</p>
</li></ul>

<p>can be fixed via, e.g., <code>"t(df = 1)"</code> or
<code>"gamma(mu = 0, sigma = 1)"</code>.
To fix different values of a parameter for different states, separate by
&quot;|&quot;, e.g. <code>"poisson(mu = 1|2|3)"</code>.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>sdds</code> must be a <code>vector</code> of length 2.
The first entry corresponds to the coarse-scale layer, while the second entry
corresponds to the fine-scale layer.
</p>
<p>By default, <code>sdds = "normal"</code> if <code>hierarchy = FALSE</code> and
<code>sdds = c("normal", "normal")</code> if <code>hierarchy = TRUE</code>.</p>
</td></tr>
<tr><td><code id="ll_hmm_+3A_negative">negative</code></td>
<td>
<p>Either <code>TRUE</code> to return the negative log-likelihood value (useful for
optimization) or <code>FALSE</code> (default), else.</p>
</td></tr>
<tr><td><code id="ll_hmm_+3A_check_controls">check_controls</code></td>
<td>
<p>Either <code>TRUE</code> to check the defined controls or <code>FALSE</code> to not check
them (which saves computation time), else.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The (negative) log-likelihood value.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>### HMM log-likelihood 
controls &lt;- set_controls(states = 2, sdds = "normal")
parameters &lt;- fHMM_parameters(controls)
parUncon &lt;- par2parUncon(parameters, controls)
observations &lt;- 1:10
ll_hmm(parUncon, observations, controls)

### HHMM log-likelihood 
controls &lt;- set_controls(
  hierarchy = TRUE, states = c(2, 2), sdds = c("normal", "normal")
)
parameters &lt;- fHMM_parameters(controls)
parUncon &lt;- par2parUncon(parameters, controls)
observations &lt;- matrix(dnorm(110), ncol = 11, nrow = 10)
ll_hmm(parUncon, observations, controls)

</code></pre>

<hr>
<h2 id='nLL_hhmm'>Negative log-likelihood function of an HHMM</h2><span id='topic+nLL_hhmm'></span>

<h3>Description</h3>

<p>This function computes the negative log-likelihood of an HHMM.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nLL_hhmm(parUncon, observations, controls)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="nLL_hhmm_+3A_paruncon">parUncon</code></td>
<td>
<p>An object of class <code>parUncon</code>.</p>
</td></tr>
<tr><td><code id="nLL_hhmm_+3A_observations">observations</code></td>
<td>
<p>The matrix of the simulated or empirical data used for estimation.</p>
</td></tr>
<tr><td><code id="nLL_hhmm_+3A_controls">controls</code></td>
<td>
<p>An object of class <code>fHMM_controls</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The negative log-likelihood value.
</p>

<hr>
<h2 id='nLL_hmm'>Negative log-likelihood function of an HMM</h2><span id='topic+nLL_hmm'></span>

<h3>Description</h3>

<p>This function computes the negative log-likelihood of an HMM.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nLL_hmm(parUncon, observations, controls)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="nLL_hmm_+3A_paruncon">parUncon</code></td>
<td>
<p>An object of class <code>parUncon</code>.</p>
</td></tr>
<tr><td><code id="nLL_hmm_+3A_observations">observations</code></td>
<td>
<p>The vector of the simulated or empirical data used for estimation.</p>
</td></tr>
<tr><td><code id="nLL_hmm_+3A_controls">controls</code></td>
<td>
<p>An object of class <code>fHMM_controls</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The negative log-likelihood value.
</p>

<hr>
<h2 id='parameter_labels'>Create labels for estimated parameters</h2><span id='topic+parameter_labels'></span>

<h3>Description</h3>

<p>This helper function creates labels for the estimated HMM parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>parameter_labels(controls, expected_length = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="parameter_labels_+3A_controls">controls</code></td>
<td>
<p>An object of class <code>fHMM_controls</code>.</p>
</td></tr>
<tr><td><code id="parameter_labels_+3A_expected_length">expected_length</code></td>
<td>
<p>The expected output length. If <code>NULL</code> (default), this is not checked.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>character</code> vector of parameter labels.
</p>

<hr>
<h2 id='parameter_transformations'>Parameter transformations</h2><span id='topic+parameter_transformations'></span><span id='topic+par2parUncon'></span><span id='topic+parUncon2parCon'></span><span id='topic+parCon2par'></span><span id='topic+par2parCon'></span><span id='topic+parCon2parUncon'></span><span id='topic+parUncon2par'></span><span id='topic+muCon2muUncon'></span><span id='topic+muUncon2muCon'></span><span id='topic+sigmaCon2sigmaUncon'></span><span id='topic+sigmaUncon2sigmaCon'></span><span id='topic+dfCon2dfUncon'></span><span id='topic+dfUncon2dfCon'></span><span id='topic+Gamma2gammasCon'></span><span id='topic+Gamma2gammasUncon'></span><span id='topic+gammasCon2Gamma'></span><span id='topic+gammasCon2gammasUncon'></span><span id='topic+gammasUncon2Gamma'></span><span id='topic+gammasUncon2gammasCon'></span>

<h3>Description</h3>

<p>These helper functions transform model parameters between
</p>

<ul>
<li><p> constrained spaces (suffix <code>*Con</code>)
</p>
</li>
<li><p> and unconstrained spaces (suffix <code>*Uncon</code>).
</p>
</li></ul>

<p>The former is useful for interpretation, the latter for unconstrained
optimization.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>par2parUncon(par, controls, use_parameter_labels = TRUE)

parUncon2parCon(
  parUncon,
  controls,
  use_parameter_labels = TRUE,
  numerical_safeguard = FALSE
)

parCon2par(parCon, controls, use_parameter_labels = TRUE)

par2parCon(par, controls, use_parameter_labels = TRUE)

parCon2parUncon(parCon, controls, use_parameter_labels = TRUE)

parUncon2par(
  parUncon,
  controls,
  use_parameter_labels = TRUE,
  numerical_safeguard = FALSE
)

muCon2muUncon(muCon, link, prefix = "muUncon_", use_parameter_labels = TRUE)

muUncon2muCon(muUncon, link, prefix = "muCon_", use_parameter_labels = TRUE)

sigmaCon2sigmaUncon(
  sigmaCon,
  prefix = "sigmaUncon_",
  use_parameter_labels = TRUE
)

sigmaUncon2sigmaCon(
  sigmaUncon,
  prefix = "sigmaCon_",
  use_parameter_labels = TRUE,
  numerical_safeguard = FALSE
)

dfCon2dfUncon(dfCon, prefix = "dfUncon_", use_parameter_labels = TRUE)

dfUncon2dfCon(
  dfUncon,
  prefix = "dfCon_",
  use_parameter_labels = TRUE,
  numerical_safeguard = FALSE
)

Gamma2gammasCon(
  Gamma,
  prefix = "gammasCon_",
  use_parameter_labels = TRUE,
  numerical_safeguard = FALSE
)

Gamma2gammasUncon(Gamma, prefix = "gammasUncon_", use_parameter_labels = TRUE)

gammasCon2Gamma(gammasCon, dim, prefix = "state_", use_parameter_labels = TRUE)

gammasCon2gammasUncon(
  gammasCon,
  dim,
  prefix = "gammasUncon_",
  use_parameter_labels = TRUE
)

gammasUncon2Gamma(
  gammasUncon,
  dim,
  prefix = "state_",
  use_parameter_labels = TRUE,
  numerical_safeguard = FALSE
)

gammasUncon2gammasCon(
  gammasUncon,
  dim,
  prefix = "gammasCon_",
  use_parameter_labels = TRUE,
  numerical_safeguard = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="parameter_transformations_+3A_par">par</code></td>
<td>
<p>An object of class <code><a href="#topic+fHMM_parameters">fHMM_parameters</a></code>, which is a <code>list</code>
of model parameters.</p>
</td></tr>
<tr><td><code id="parameter_transformations_+3A_controls">controls</code></td>
<td>
<p>Either a <code>list</code> or an object of class <code>fHMM_controls</code>.
</p>
<p>The <code>list</code> can contain the following elements, which are described
in more detail below:
</p>

<ul>
<li> <p><code>hierarchy</code>, defines an hierarchical HMM,
</p>
</li>
<li> <p><code>states</code>, defines the number of states,
</p>
</li>
<li> <p><code>sdds</code>, defines the state-dependent distributions,
</p>
</li>
<li> <p><code>horizon</code>, defines the time horizon,
</p>
</li>
<li> <p><code>period</code>, defines a flexible, periodic fine-scale time horizon,
</p>
</li>
<li> <p><code>data</code>, a <code>list</code> of controls that define the data,
</p>
</li>
<li> <p><code>fit</code>, a <code>list</code> of controls that define the model fitting
</p>
</li></ul>

<p>Either none, all, or selected elements can be specified.
</p>
<p>Unspecified parameters are set to their default values.
</p>
<p>Important: Specifications in <code>controls</code> always override individual
specifications.</p>
</td></tr>
<tr><td><code id="parameter_transformations_+3A_use_parameter_labels">use_parameter_labels</code></td>
<td>
<p>Either <code>TRUE</code> to label the parameters or <code>FALSE</code>, if not (this can
save computation time).</p>
</td></tr>
<tr><td><code id="parameter_transformations_+3A_paruncon">parUncon</code></td>
<td>
<p>An object of class <code>parUncon</code>, which is a <code>numeric</code> <code>vector</code>
with identified and unconstrained model parameters in the following order:
</p>

<ol>
<li><p> non-diagonal transition probabilities <code>gammasUncon</code>
</p>
</li>
<li><p> expectations <code>muUncon</code>
</p>
</li>
<li><p> standard deviations <code>sigmaUncon</code> (if any)
</p>
</li>
<li><p> degrees of freedom <code>dfUncon</code> (if any)
</p>
</li>
<li><p> fine-scale parameters for each coarse-scale state, in the same order (if any)
</p>
</li></ol>
</td></tr>
<tr><td><code id="parameter_transformations_+3A_numerical_safeguard">numerical_safeguard</code></td>
<td>
<p>Either <code>TRUE</code> or <code>FALSE</code>, determining whether to apply the
following small corrections to boundary parameters to improve numerical
performance when calculating and optimizing the likelihood function:
</p>

<ul>
<li><p> transition probabilities equal to 0 or 1 are shifted towards the center
by <code>1e-3</code>
</p>
</li>
<li><p> standard deviations and degrees of freedom are bounded above by <code>100</code>
</p>
</li></ul>
</td></tr>
<tr><td><code id="parameter_transformations_+3A_parcon">parCon</code></td>
<td>
<p>An object of class <code>parCon</code>, which is a <code>numeric</code> <code>vector</code>
with identified (and constrained) model parameters in the following order:
</p>

<ol>
<li><p> non-diagonal transition probabilities <code>gammasCon</code>
</p>
</li>
<li><p> expectations <code>muCon</code>
</p>
</li>
<li><p> standard deviations <code>sigmaCon</code> (if any)
</p>
</li>
<li><p> degrees of freedom <code>dfCon</code> (if any)
</p>
</li>
<li><p> fine-scale parameters for each coarse-scale state, in the same order (if any)
</p>
</li></ol>
</td></tr>
<tr><td><code id="parameter_transformations_+3A_mucon">muCon</code>, <code id="parameter_transformations_+3A_muuncon">muUncon</code></td>
<td>
<p>A vector of (un-) constrained expected values.</p>
</td></tr>
<tr><td><code id="parameter_transformations_+3A_link">link</code></td>
<td>
<p>Either <code>TRUE</code> or <code>FALSE</code>, determining whether to apply the link
function.</p>
</td></tr>
<tr><td><code id="parameter_transformations_+3A_prefix">prefix</code></td>
<td>
<p>A <code>character</code> prefix for labeling the parameters.</p>
</td></tr>
<tr><td><code id="parameter_transformations_+3A_sigmacon">sigmaCon</code>, <code id="parameter_transformations_+3A_sigmauncon">sigmaUncon</code></td>
<td>
<p>A vector of (un-) constrained standard deviations.</p>
</td></tr>
<tr><td><code id="parameter_transformations_+3A_dfcon">dfCon</code>, <code id="parameter_transformations_+3A_dfuncon">dfUncon</code></td>
<td>
<p>A vector of (un-) constrained degrees of freedom.</p>
</td></tr>
<tr><td><code id="parameter_transformations_+3A_gammascon">gammasCon</code>, <code id="parameter_transformations_+3A_gammasuncon">gammasUncon</code></td>
<td>
<p>A vector of (un-) constrained non-diagonal transition probabilities.</p>
</td></tr>
<tr><td><code id="parameter_transformations_+3A_dim">dim</code></td>
<td>
<p>An <code>integer</code>, the dimension of the transition probability matrix.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>For <code>par2parUncon</code>: a vector of unconstrained model parameters.
</p>
<p>For <code>parUncon2parCon</code>: a vector of constrained model parameters.
</p>
<p>For <code>parCon2par</code>: an object of class <code><a href="#topic+fHMM_parameters">fHMM_parameters</a></code>.
</p>
<p>For <code>par2parCon</code>: a vector of constrained model parameters.
</p>
<p>For <code>parCon2parUncon</code>: a vector of unconstrained model parameters.
</p>
<p>For <code>parUncon2par</code>: an object of class <code>fHMM_parameters</code>.
</p>
<p>For <code>muCon2muUncon</code>: a vector of unconstrained expected values.
</p>
<p>For <code>muUncon2muCon</code>: a vector of constrained expected values.
</p>
<p>For <code>sigmaCon2sigmaUncon</code>: a vector of unconstrained standard
deviations.
</p>
<p>For <code>sigmaUncon2sigmaCon</code>: a vector of constrained standard deviations.
</p>
<p>For <code>dfCon2dfUncon</code>: a vector of unconstrained degrees of freedom.
</p>
<p>For <code>dfUncon2dfCon</code>: a vector of constrained degrees of freedom.
</p>
<p>For <code>Gamma2gammasCon</code>: a vector of constrained non-diagonal matrix
elements (column-wise).
</p>
<p>For <code>Gamma2gammasUncon</code>: a vector of unconstrained non-diagonal matrix
elements (column-wise).
</p>
<p>For <code>gammasCon2Gamma</code>: a transition probability matrix.
</p>
<p>For <code>gammasCon2gammasUncon</code>: a vector of unconstrained non-diagonal
elements of the transition probability matrix.
</p>
<p>For <code>gammasUncon2Gamma</code>: a transition probability matrix.
</p>
<p>For <code>gammasUncon2gammasCon</code>: a vector of constrained non-diagonal
elements of a transition probability matrix.
</p>

<hr>
<h2 id='plot_ll'>Visualization of log-likelihood values</h2><span id='topic+plot_ll'></span>

<h3>Description</h3>

<p>This function plots the log-likelihood values of the different optimization
runs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_ll(lls, ll_relative = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_ll_+3A_lls">lls</code></td>
<td>
<p>A <code>numeric</code> vector of log-likelihood values.</p>
</td></tr>
<tr><td><code id="plot_ll_+3A_ll_relative">ll_relative</code></td>
<td>
<p>A <code>logical</code>, set to <code>TRUE</code> (default) to plot the differences from
the best log-likelihood value. Set to <code>FALSE</code> to plot the absolute
values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value. Draws a plot to the current device.
</p>

<hr>
<h2 id='plot_pr'>Visualize pseudo residuals</h2><span id='topic+plot_pr'></span>

<h3>Description</h3>

<p>This function visualizes the pseudo residuals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_pr(residuals, hierarchy)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_pr_+3A_residuals">residuals</code></td>
<td>
<p>An object of class <code>fHMM_residuals</code>.</p>
</td></tr>
<tr><td><code id="plot_pr_+3A_hierarchy">hierarchy</code></td>
<td>
<p>The element <code>controls$hierarchy</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value. Draws a plot to the current device.
</p>

<hr>
<h2 id='plot_sdds'>Visualization of estimated state-dependent distributions</h2><span id='topic+plot_sdds'></span>

<h3>Description</h3>

<p>This function plots the estimated state-dependent distributions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_sdds(est, true = NULL, controls, colors)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_sdds_+3A_est">est</code></td>
<td>
<p>An object of class <code>fHMM_parameters</code> with estimated parameters.</p>
</td></tr>
<tr><td><code id="plot_sdds_+3A_true">true</code></td>
<td>
<p>Either <code>NULL</code> or an object of class <code>fHMM_parameters</code> with true
parameters.</p>
</td></tr>
<tr><td><code id="plot_sdds_+3A_controls">controls</code></td>
<td>
<p>An object of class <code>fHMM_controls</code>.</p>
</td></tr>
<tr><td><code id="plot_sdds_+3A_colors">colors</code></td>
<td>
<p>Either <code>NULL</code> (default) or a <code>character</code> vector of color names or
hexadecimal RGB triplets.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value. Draws a plot to the current device.
</p>

<hr>
<h2 id='plot_ts'>Visualize time series</h2><span id='topic+plot_ts'></span>

<h3>Description</h3>

<p>This function visualizes the data time series.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_ts(
  data,
  decoding,
  colors,
  events = NULL,
  title = NULL,
  from = NULL,
  to = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_ts_+3A_data">data</code></td>
<td>
<p>An object of class <code>fHMM_data</code>.</p>
</td></tr>
<tr><td><code id="plot_ts_+3A_decoding">decoding</code></td>
<td>
<p>Either <code>NULL</code> or an object of class <code>fHMM_decoding</code>.</p>
</td></tr>
<tr><td><code id="plot_ts_+3A_colors">colors</code></td>
<td>
<p>Either <code>NULL</code> (default) or a <code>character</code> vector of color names or
hexadecimal RGB triplets.</p>
</td></tr>
<tr><td><code id="plot_ts_+3A_events">events</code></td>
<td>
<p>An object of class <code><a href="#topic+fHMM_events">fHMM_events</a></code>.</p>
</td></tr>
<tr><td><code id="plot_ts_+3A_title">title</code></td>
<td>
<p>Optionally a <code>character</code> for a custom title.</p>
</td></tr>
<tr><td><code id="plot_ts_+3A_from">from</code></td>
<td>
<p>Optionally a <code>character</code>, a date in format <code>"YYYY-MM-DD"</code>,
setting the lower date bound for plotting.
By default, <code>from = NULL</code>, i.e. no lower bound.</p>
</td></tr>
<tr><td><code id="plot_ts_+3A_to">to</code></td>
<td>
<p>Optionally a <code>character</code>, a date in format <code>"YYYY-MM-DD"</code>,
setting the upper date bound for plotting.
By default, <code>to = NULL</code>, i.e. no upper bound.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value. Draws a plot to the current device.
</p>

<hr>
<h2 id='plot.fHMM_data'>Plot method for an object of class <code>fHMM_data</code></h2><span id='topic+plot.fHMM_data'></span>

<h3>Description</h3>

<p>This function is the plot method for an object of class <code>fHMM_data</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'fHMM_data'
plot(x, events = NULL, title = NULL, from = NULL, to = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.fHMM_data_+3A_x">x</code></td>
<td>
<p>An object of class <code>fHMM_data</code>.</p>
</td></tr>
<tr><td><code id="plot.fHMM_data_+3A_events">events</code></td>
<td>
<p>An object of class <code><a href="#topic+fHMM_events">fHMM_events</a></code>.</p>
</td></tr>
<tr><td><code id="plot.fHMM_data_+3A_title">title</code></td>
<td>
<p>Optionally a <code>character</code> for a custom title.</p>
</td></tr>
<tr><td><code id="plot.fHMM_data_+3A_from">from</code></td>
<td>
<p>Optionally a <code>character</code>, a date in format <code>"YYYY-MM-DD"</code>,
setting the lower date bound for plotting.
By default, <code>from = NULL</code>, i.e. no lower bound.</p>
</td></tr>
<tr><td><code id="plot.fHMM_data_+3A_to">to</code></td>
<td>
<p>Optionally a <code>character</code>, a date in format <code>"YYYY-MM-DD"</code>,
setting the upper date bound for plotting.
By default, <code>to = NULL</code>, i.e. no upper bound.</p>
</td></tr>
<tr><td><code id="plot.fHMM_data_+3A_...">...</code></td>
<td>
<p>Currently not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value. Draws a plot to the current device.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>plot(dax_model_3t$data, title = "DAX time series")

</code></pre>

<hr>
<h2 id='plot.fHMM_model'>Plot method for an object of class <code><a href="#topic+fHMM_model">fHMM_model</a></code></h2><span id='topic+plot.fHMM_model'></span>

<h3>Description</h3>

<p>This function is the plot method for an object of class
<code><a href="#topic+fHMM_model">fHMM_model</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'fHMM_model'
plot(
  x,
  plot_type = "ts",
  events = NULL,
  colors = NULL,
  ll_relative = TRUE,
  title = NULL,
  from = NULL,
  to = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.fHMM_model_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+fHMM_model">fHMM_model</a></code>.</p>
</td></tr>
<tr><td><code id="plot.fHMM_model_+3A_plot_type">plot_type</code></td>
<td>
<p>A character (vector), specifying the type of plot and can be one (or more) of
</p>

<ul>
<li> <p><code>"ll"</code> for a visualization of the likelihood values in the
different optimization runs,
</p>
</li>
<li> <p><code>"sdds"</code> for a visualization of the estimated state-dependent
distributions,
</p>
</li>
<li> <p><code>"pr"</code> for a visualization of the model's (pseudo-) residuals,
</p>
</li>
<li> <p><code>"ts"</code> for a visualization of the financial time series.
</p>
</li></ul>
</td></tr>
<tr><td><code id="plot.fHMM_model_+3A_events">events</code></td>
<td>
<p>An object of class <code><a href="#topic+fHMM_events">fHMM_events</a></code>.</p>
</td></tr>
<tr><td><code id="plot.fHMM_model_+3A_colors">colors</code></td>
<td>
<p>Either <code>NULL</code> (default) or a <code>character</code> vector of color names or
hexadecimal RGB triplets.</p>
</td></tr>
<tr><td><code id="plot.fHMM_model_+3A_ll_relative">ll_relative</code></td>
<td>
<p>A <code>logical</code>, set to <code>TRUE</code> (default) to plot the differences from
the best log-likelihood value. Set to <code>FALSE</code> to plot the absolute
values.</p>
</td></tr>
<tr><td><code id="plot.fHMM_model_+3A_title">title</code></td>
<td>
<p>Optionally a <code>character</code> for a custom title.</p>
</td></tr>
<tr><td><code id="plot.fHMM_model_+3A_from">from</code></td>
<td>
<p>Optionally a <code>character</code>, a date in format <code>"YYYY-MM-DD"</code>,
setting the lower date bound for plotting.
By default, <code>from = NULL</code>, i.e. no lower bound.</p>
</td></tr>
<tr><td><code id="plot.fHMM_model_+3A_to">to</code></td>
<td>
<p>Optionally a <code>character</code>, a date in format <code>"YYYY-MM-DD"</code>,
setting the upper date bound for plotting.
By default, <code>to = NULL</code>, i.e. no upper bound.</p>
</td></tr>
<tr><td><code id="plot.fHMM_model_+3A_...">...</code></td>
<td>
<p>Currently not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value. Draws a plot to the current device.
</p>

<hr>
<h2 id='prepare_data'>Prepare data</h2><span id='topic+prepare_data'></span>

<h3>Description</h3>

<p>This function simulates or reads financial data for the {fHMM} package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prepare_data(controls, true_parameters = NULL, seed = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="prepare_data_+3A_controls">controls</code></td>
<td>
<p>An object of class <code>fHMM_controls</code>.</p>
</td></tr>
<tr><td><code id="prepare_data_+3A_true_parameters">true_parameters</code></td>
<td>
<p>An object of class <code>fHMM_parameters</code>, used as simulation parameters.
By default, <code>true_parameters = NULL</code>, i.e., sampled true parameters.</p>
</td></tr>
<tr><td><code id="prepare_data_+3A_seed">seed</code></td>
<td>
<p>Set a seed for the data simulation.
No seed per default.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code><a href="#topic+fHMM_data">fHMM_data</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>controls &lt;- set_controls()
data &lt;- prepare_data(controls)
class(data)
summary(data)

</code></pre>

<hr>
<h2 id='read_data'>Read data</h2><span id='topic+read_data'></span>

<h3>Description</h3>

<p>This helper function reads financial data for the {fHMM} package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_data(controls)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_data_+3A_controls">controls</code></td>
<td>
<p>An object of class <code>fHMM_controls</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>list</code> containing the following elements:
</p>

<ul>
<li><p> the <code>matrix</code> of the <code>dates</code> if <code>controls$simulated = FALSE</code>
and <code>controls$data$data_column</code> is specified,
</p>
</li>
<li><p> the <code>matrix</code> of the <code>time_points</code> if <code>controls$simulated = TRUE</code>
or <code>controls$data$data_column</code> is not specified,
</p>
</li>
<li><p> the <code>matrix</code> of the empirical <code>data</code> used for estimation,
</p>
</li>
<li><p> the <code>matrix</code> named <code>time_series</code> of empirical data before
the transformation to log-returns,
</p>
</li>
<li><p> the <code>vector</code> of fine-scale chunk sizes <code>T_star</code> if
<code>controls$hierarchy = TRUE</code>.
</p>
</li></ul>


<hr>
<h2 id='reorder_states'>Reorder estimated states</h2><span id='topic+reorder_states'></span>

<h3>Description</h3>

<p>This function reorders the estimated states, which can be useful for a
comparison to true parameters or the interpretation of states.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>reorder_states(x, state_order = "mean")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="reorder_states_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+fHMM_model">fHMM_model</a></code>.</p>
</td></tr>
<tr><td><code id="reorder_states_+3A_state_order">state_order</code></td>
<td>
<p>Either
</p>

<ul>
<li> <p><code>"mean"</code>, in which case the states are ordered according to the means
of the state-dependent distributions,
</p>
</li>
<li><p> or a vector (or a matrix) which determines the new ordering:
</p>

<ul>
<li><p> If <code>x$data$controls$hierarchy = FALSE</code>, <code>state_order</code> must
be a vector of length <code>x$data$controls$states</code> with integer
values from <code>1</code> to <code>x$data$controls$states</code>. If the old
state number <code>x</code> should be the new state number <code>y</code>, put
the value <code>x</code> at the position <code>y</code> of <code>state_order</code>.
E.g. for a 2-state HMM, specifying <code>state_order = c(2, 1)</code> swaps
the states.
</p>
</li>
<li><p> If <code>x$data$controls$hierarchy = TRUE</code>, <code>state_order</code> must
be a matrix of dimension <code>x$data$controls$states[1]</code> x
<code>x$data$controls$states[2] + 1</code>. The first column orders the
coarse-scale states with the logic as described above. For each row,
the elements from second to last position order the fine-scale states
of the coarse-scale state specified by the first element. E.g. for an
HHMM with 2 coarse-scale and 2 fine-scale states, specifying
<code>state_order = matrix(c(2, 1, 2, 1, 1, 2), 2, 3)</code> swaps the
coarse-scale states and the fine-scale states connected to
coarse-scale state 2.
</p>
</li></ul>

</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code><a href="#topic+fHMM_model">fHMM_model</a></code>, in which states are reordered.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dax_model_3t_reordered &lt;- reorder_states(dax_model_3t, state_order = 3:1)

</code></pre>

<hr>
<h2 id='set_controls'>Define and validate model specifications</h2><span id='topic+set_controls'></span><span id='topic+validate_controls'></span><span id='topic+print.fHMM_controls'></span><span id='topic+summary.fHMM_controls'></span>

<h3>Description</h3>

<p>This function defines and validates specifications for model estimation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_controls(
  controls = list(),
  hierarchy = FALSE,
  states = if (!hierarchy) 2 else c(2, 2),
  sdds = if (!hierarchy) "normal" else c("normal", "normal"),
  horizon = if (!hierarchy) 100 else c(100, 30),
  period = NA,
  data = NA,
  file = NA,
  date_column = if (!hierarchy) "Date" else c("Date", "Date"),
  data_column = if (!hierarchy) "Close" else c("Close", "Close"),
  from = NA,
  to = NA,
  logreturns = if (!hierarchy) FALSE else c(FALSE, FALSE),
  merge = function(x) mean(x),
  fit = list(),
  runs = 10,
  origin = FALSE,
  accept = 1:3,
  gradtol = 0.01,
  iterlim = 100,
  print.level = 0,
  steptol = 0.01
)

validate_controls(controls)

## S3 method for class 'fHMM_controls'
print(x, ...)

## S3 method for class 'fHMM_controls'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_controls_+3A_controls">controls</code></td>
<td>
<p>Either a <code>list</code> or an object of class <code>fHMM_controls</code>.
</p>
<p>The <code>list</code> can contain the following elements, which are described
in more detail below:
</p>

<ul>
<li> <p><code>hierarchy</code>, defines an hierarchical HMM,
</p>
</li>
<li> <p><code>states</code>, defines the number of states,
</p>
</li>
<li> <p><code>sdds</code>, defines the state-dependent distributions,
</p>
</li>
<li> <p><code>horizon</code>, defines the time horizon,
</p>
</li>
<li> <p><code>period</code>, defines a flexible, periodic fine-scale time horizon,
</p>
</li>
<li> <p><code>data</code>, a <code>list</code> of controls that define the data,
</p>
</li>
<li> <p><code>fit</code>, a <code>list</code> of controls that define the model fitting
</p>
</li></ul>

<p>Either none, all, or selected elements can be specified.
</p>
<p>Unspecified parameters are set to their default values.
</p>
<p>Important: Specifications in <code>controls</code> always override individual
specifications.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_hierarchy">hierarchy</code></td>
<td>
<p>A <code>logical</code>, set to <code>TRUE</code> for an hierarchical HMM.
</p>
<p>If <code>hierarchy = TRUE</code>, some of the other controls must be specified for
the coarse-scale and the fine-scale layer.
</p>
<p>By default, <code>hierarchy = FALSE</code>.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_states">states</code></td>
<td>
<p>An <code>integer</code>, the number of states of the underlying Markov chain.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>states</code> must be a <code>vector</code> of length
2. The first entry corresponds to the coarse-scale layer, while the second
entry corresponds to the fine-scale layer.
</p>
<p>By default, <code>states = 2</code> if <code>hierarchy = FALSE</code> and
<code>states = c(2, 2)</code> if <code>hierarchy = TRUE</code>.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_sdds">sdds</code></td>
<td>
<p>A <code>character</code>, specifying the state-dependent distribution. One of
</p>

<ul>
<li> <p><code>"normal"</code> (the normal distribution),
</p>
</li>
<li> <p><code>"lognormal"</code> (the log-normal distribution),
</p>
</li>
<li> <p><code>"t"</code> (the t-distribution),
</p>
</li>
<li> <p><code>"gamma"</code> (the gamma distribution),
</p>
</li>
<li> <p><code>"poisson"</code> (the Poisson distribution).
</p>
</li></ul>

<p>The distribution parameters, i.e. the
</p>

<ul>
<li><p> mean <code>mu</code>,
</p>
</li>
<li><p> standard deviation <code>sigma</code> (not for the Poisson distribution),
</p>
</li>
<li><p> degrees of freedom <code>df</code> (only for the t-distribution),
</p>
</li></ul>

<p>can be fixed via, e.g., <code>"t(df = 1)"</code> or
<code>"gamma(mu = 0, sigma = 1)"</code>.
To fix different values of a parameter for different states, separate by
&quot;|&quot;, e.g. <code>"poisson(mu = 1|2|3)"</code>.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>sdds</code> must be a <code>vector</code> of length 2.
The first entry corresponds to the coarse-scale layer, while the second entry
corresponds to the fine-scale layer.
</p>
<p>By default, <code>sdds = "normal"</code> if <code>hierarchy = FALSE</code> and
<code>sdds = c("normal", "normal")</code> if <code>hierarchy = TRUE</code>.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_horizon">horizon</code></td>
<td>
<p>A <code>numeric</code>, specifying the length of the time horizon.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>horizon</code> must be a <code>vector</code> of length
2. The first entry corresponds to the coarse-scale layer, while the second
entry corresponds to the fine-scale layer.
</p>
<p>By default, <code>horizon = 100</code> if <code>hierarchy = FALSE</code> and
<code>horizon = c(100, 30)</code> if <code>hierarchy = TRUE</code>.
</p>
<p>If <code>data</code> is specified (i.e., not <code>NA</code>), the first entry of
<code>horizon</code> is ignored and the (coarse-scale) time horizon is defined by
available data.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_period">period</code></td>
<td>
<p>Only relevant if <code>hierarchy = TRUE</code>.
</p>
<p>In this case, a <code>character</code> which specifies a flexible, periodic
fine-scale time horizon and can be one of
</p>

<ul>
<li> <p><code>"w"</code> for a week,
</p>
</li>
<li> <p><code>"m"</code> for a month,
</p>
</li>
<li> <p><code>"q"</code> for a quarter,
</p>
</li>
<li> <p><code>"y"</code> for a year.
</p>
</li></ul>

<p>By default, <code>period = NA</code>. If <code>period</code> is not <code>NA</code>, it
overrules <code>horizon[2]</code>.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_data">data</code></td>
<td>
<p>Either <code>NA</code>, in which case data is simulated (the default), or a
<code>list</code> of controls specifying the empirical data set.
</p>
<p>The <code>list</code> can contain the following elements, which are described
in more detail below:
</p>

<ul>
<li> <p><code>file</code>, defines the data set,
</p>
</li>
<li> <p><code>date_column</code>, defines the date column,
</p>
</li>
<li> <p><code>data_column</code>, defines the data column,
</p>
</li>
<li> <p><code>from</code>, defines a lower date limit,
</p>
</li>
<li> <p><code>to</code>, defines an upper date limit,
</p>
</li>
<li> <p><code>logreturns</code>, defines a data transformation to log-returns,
</p>
</li>
<li> <p><code>merge</code>, defines the merging for coarse-scale observations.
</p>
</li></ul>

<p>Either none, all, or selected elements can be specified.
</p>
<p>Unspecified parameters are set to their default values, see below.
</p>
<p>Specifications in <code>data</code> override individual specifications.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_file">file</code></td>
<td>
<p>A <code>data.frame</code> with data and dates for modeling.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>file</code> can be a <code>list</code> of
length 2. The first entry is a <code>data.frame</code> and provides the data for
the coarse-scale layer, while the second entry corresponds to the fine-scale
layer. If <code>file</code> is a single <code>data.frame</code>, then the same
<code>data.frame</code> is used for both layers.
</p>
<p>Alternatively, it can be a <code>character</code> (of length two), the path to a
.csv-file with financial data.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_date_column">date_column</code></td>
<td>
<p>A <code>character</code>, the name of the column in <code>file</code> with dates.
</p>
<p>If <code>hierarchy = TRUE</code> and <code>file</code> is a <code>list</code> of two
<code>data.frame</code>s, <code>data_column</code> must be a <code>vector</code> of
length 2. The first entry corresponds to the coarse-scale layer, while the
second entry corresponds to the fine-scale layer.
</p>
<p>By default, <code>date_column = "Date"</code>.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_data_column">data_column</code></td>
<td>
<p>A <code>character</code>, the name of the column in <code>file</code> with observations.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>data_column</code> must be a <code>vector</code> of
length 2. The first entry corresponds to the coarse-scale layer, while the
second entry corresponds to the fine-scale layer.
</p>
<p>By default, <code>data_column = "Close"</code> if <code>hierarchy = FALSE</code> and
<code>data_column = c("Close", "Close")</code> if <code>hierarchy = TRUE</code>.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_from">from</code></td>
<td>
<p>A <code>character</code> of the format <code>"YYYY-MM-DD"</code>, setting a lower
date limit. No lower limit if <code>from = NA</code> (default).</p>
</td></tr>
<tr><td><code id="set_controls_+3A_to">to</code></td>
<td>
<p>A <code>character</code> of the format <code>"YYYY-MM-DD"</code>, setting an upper
date limit. No lower limit if <code>to = NA</code> (default).</p>
</td></tr>
<tr><td><code id="set_controls_+3A_logreturns">logreturns</code></td>
<td>
<p>A <code>logical</code>, if <code>TRUE</code> the data is transformed to log-returns.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>logreturns</code> must be a <code>vector</code> of
length 2. The first entry corresponds to the coarse-scale layer, while the
second entry corresponds to the fine-scale layer.
</p>
<p>By default, <code>logreturns = FALSE</code> if <code>hierarchy = FALSE</code> and
<code>logreturns = c(FALSE, FALSE)</code> if <code>hierarchy = TRUE</code>.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_merge">merge</code></td>
<td>
<p>Only relevant if <code>hierarchy = TRUE</code>.
</p>
<p>In this case, a <code>function</code>
which merges an input numeric vector of fine-scale data <code>x</code> into one
coarse-scale observation. For example,
</p>

<ul>
<li> <p><code>merge = function(x) mean(x)</code> (default) defines the mean of the
fine-scale data as the coarse-scale observation,
</p>
</li>
<li> <p><code>merge = function(x) mean(abs(x))</code> for the mean of the
absolute values,
</p>
</li>
<li> <p><code>merge = function(x) sum(abs(x))</code> for the sum of the
absolute values,
</p>
</li>
<li> <p><code>merge = function(x) (tail(x, 1) - head(x, 1)) / head(x, 1)</code> for
the relative change of the first to the last fine-scale observation.
</p>
</li></ul>
</td></tr>
<tr><td><code id="set_controls_+3A_fit">fit</code></td>
<td>
<p>A <code>list</code> of controls specifying the model fitting.
</p>
<p>The <code>list</code> can contain the following elements, which are described
in more detail below:
</p>

<ul>
<li> <p><code>runs</code>, defines the number of numerical optimization runs,
</p>
</li>
<li> <p><code>origin</code>, defines initialization at the true parameters,
</p>
</li>
<li> <p><code>accept</code>, defines the set of accepted optimization runs,
</p>
</li>
<li> <p><code>gradtol</code>, defines the gradient tolerance,
</p>
</li>
<li> <p><code>iterlim</code>, defines the iteration limit,
</p>
</li>
<li> <p><code>print.level</code>, defines the level of printing,
</p>
</li>
<li> <p><code>steptol</code>, defines the minimum allowable relative step length.
</p>
</li></ul>

<p>Either none, all, or selected elements can be specified.
</p>
<p>Unspecified parameters are set to their default values, see below.
</p>
<p>Specifications in <code>fit</code> override individual specifications.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_runs">runs</code></td>
<td>
<p>An <code>integer</code>, setting the number of randomly initialized
optimization runs of the model likelihood from which the best one is selected
as the final model.
</p>
<p>By default, <code>runs = 10</code>.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_origin">origin</code></td>
<td>
<p>Only relevant for simulated data, i.e., if the <code>data</code> control is
<code>NA</code>.
</p>
<p>In this case, a <code>logical</code>. If <code>origin = TRUE</code> the optimization is
initialized at the true parameter values.
This sets <code>run = 1</code> and <code>accept = 1:5</code>.
</p>
<p>By default, <code>origin = FALSE</code>.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_accept">accept</code></td>
<td>
<p>An <code>integer</code> (vector), specifying which optimization runs are
accepted based on the output code of <code><a href="stats.html#topic+nlm">nlm</a></code>.
</p>
<p>By default, <code>accept = 1:3</code>.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_gradtol">gradtol</code></td>
<td>
<p>A positive <code>numeric</code> value, specifying the gradient tolerance, passed on
to <code><a href="stats.html#topic+nlm">nlm</a></code>.
</p>
<p>By default, <code>gradtol = 0.01</code>.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_iterlim">iterlim</code></td>
<td>
<p>A positive <code>integer</code> value, specifying the iteration limit, passed on
to <code><a href="stats.html#topic+nlm">nlm</a></code>.
</p>
<p>By default, <code>iterlim = 100</code>.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_print.level">print.level</code></td>
<td>
<p>One of <code>0</code>, <code>1</code>, and <code>2</code> to control the verbosity of the
numerical likelihood optimization, passed on to <code><a href="stats.html#topic+nlm">nlm</a></code>.
</p>
<p>By default, <code>print.level = 0</code>.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_steptol">steptol</code></td>
<td>
<p>A positive <code>numeric</code> value, specifying the step tolerance, passed on
to <code><a href="stats.html#topic+nlm">nlm</a></code>.
</p>
<p>By default, <code>gradtol = 0.01</code>.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_x">x</code>, <code id="set_controls_+3A_object">object</code></td>
<td>
<p>An object of class <code>fHMM_controls</code>.</p>
</td></tr>
<tr><td><code id="set_controls_+3A_...">...</code></td>
<td>
<p>Currently not used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See the <a href="https://loelschlaeger.de/fHMM/articles/">vignette on controls</a>
for more details.
</p>


<h3>Value</h3>

<p>An object of class <code>fHMM_controls</code>, which is a <code>list</code> that contains
model and estimation specifications.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># 2-state HMM with t-distributions for simulated data
set_controls(
  states = 2,   # the number of states
  sdds   = "t", # the state-dependent distribution
  runs   = 50   # the number of optimization runs
)

# 3-state HMM with normal distributions for the DAX closing prices
set_controls(
  states      = 3,
  sdds        = "normal",
  file        = download_data("^GDAXI"), # the data set
  date_column = "Date",                   # the column with the dates
  data_column = "Close"                   # the column with the data
)

# hierarchical HMM with Gamma and Poisson state distributions
set_controls(
  hierarchy = TRUE,                  # defines a hierarchy
  states    = c(3, 2),               # coarse scale and fine scale states
  sdds      = c("gamma", "poisson"), # distributions for both layers
  horizon   = c(100, NA),            # 100 simulated coarse-scale data points 
  period    = "m"                    # monthly simulated fine-scale data
)

# hierarchical HMM with data from .csv-file
set_controls(
  hierarchy = TRUE,
  states    = c(3, 2),
  sdds      = c("t", "t"),
  file      = c(               
    system.file("extdata", "dax.csv", package = "fHMM"),
    system.file("extdata", "dax.csv", package = "fHMM")
  ),
  date_column = c("Date", "Date"), 
  data_column = c("Close", "Close"),
  logreturns  = c(TRUE, TRUE)
)

</code></pre>

<hr>
<h2 id='sim_model_2gamma'>Simulated 2-state HMM with gamma distributions</h2><span id='topic+sim_model_2gamma'></span>

<h3>Description</h3>

<p>A pre-computed 2-state HMM with state-dependent gamma distributions with
means fixed to <code>0.5</code> and <code>2</code> on <code>500</code> simulated observations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("sim_model_2gamma")
</code></pre>


<h3>Format</h3>

<p>An object of class <code><a href="#topic+fHMM_model">fHMM_model</a></code>.
</p>


<h3>Details</h3>

<p>The model was estimated via:
</p>
<pre>
controls &lt;- set_controls(
  states  = 2,
  sdds    = "gamma(mu = 1|2)",
  horizon = 200,
  runs    = 10
)
pars &lt;- fHMM_parameters(
  controls = controls,
  Gamma = matrix(c(0.9, 0.2, 0.1, 0.8), nrow = 2),
  sigma = c(0.5, 1),
  seed = 1
)
data_sim &lt;- prepare_data(controls, true_parameters = pars, seed = 1)
sim_model_2gamma &lt;- fit_model(data_sim, seed = 1)
sim_model_2gamma &lt;- decode_states(sim_model_2gamma)
sim_model_2gamma &lt;- compute_residuals(sim_model_2gamma)
summary(sim_model_2gamma)
</pre>

<hr>
<h2 id='simulate_hmm'>Simulate data</h2><span id='topic+simulate_hmm'></span>

<h3>Description</h3>

<p>This helper function simulates HMM data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate_hmm(
  controls = list(),
  hierarchy = FALSE,
  states = if (!hierarchy) 2 else c(2, 2),
  sdds = if (!hierarchy) "normal" else c("normal", "normal"),
  horizon = if (!hierarchy) 100 else c(100, 30),
  period = NA,
  true_parameters = fHMM_parameters(controls = controls, hierarchy = hierarchy, states =
    states, sdds = sdds),
  seed = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="simulate_hmm_+3A_controls">controls</code></td>
<td>
<p>Either a <code>list</code> or an object of class <code>fHMM_controls</code>.
</p>
<p>The <code>list</code> can contain the following elements, which are described
in more detail below:
</p>

<ul>
<li> <p><code>hierarchy</code>, defines an hierarchical HMM,
</p>
</li>
<li> <p><code>states</code>, defines the number of states,
</p>
</li>
<li> <p><code>sdds</code>, defines the state-dependent distributions,
</p>
</li>
<li> <p><code>horizon</code>, defines the time horizon,
</p>
</li>
<li> <p><code>period</code>, defines a flexible, periodic fine-scale time horizon,
</p>
</li>
<li> <p><code>data</code>, a <code>list</code> of controls that define the data,
</p>
</li>
<li> <p><code>fit</code>, a <code>list</code> of controls that define the model fitting
</p>
</li></ul>

<p>Either none, all, or selected elements can be specified.
</p>
<p>Unspecified parameters are set to their default values.
</p>
<p>Important: Specifications in <code>controls</code> always override individual
specifications.</p>
</td></tr>
<tr><td><code id="simulate_hmm_+3A_hierarchy">hierarchy</code></td>
<td>
<p>A <code>logical</code>, set to <code>TRUE</code> for an hierarchical HMM.
</p>
<p>If <code>hierarchy = TRUE</code>, some of the other controls must be specified for
the coarse-scale and the fine-scale layer.
</p>
<p>By default, <code>hierarchy = FALSE</code>.</p>
</td></tr>
<tr><td><code id="simulate_hmm_+3A_states">states</code></td>
<td>
<p>An <code>integer</code>, the number of states of the underlying Markov chain.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>states</code> must be a <code>vector</code> of length
2. The first entry corresponds to the coarse-scale layer, while the second
entry corresponds to the fine-scale layer.
</p>
<p>By default, <code>states = 2</code> if <code>hierarchy = FALSE</code> and
<code>states = c(2, 2)</code> if <code>hierarchy = TRUE</code>.</p>
</td></tr>
<tr><td><code id="simulate_hmm_+3A_sdds">sdds</code></td>
<td>
<p>A <code>character</code>, specifying the state-dependent distribution. One of
</p>

<ul>
<li> <p><code>"normal"</code> (the normal distribution),
</p>
</li>
<li> <p><code>"lognormal"</code> (the log-normal distribution),
</p>
</li>
<li> <p><code>"t"</code> (the t-distribution),
</p>
</li>
<li> <p><code>"gamma"</code> (the gamma distribution),
</p>
</li>
<li> <p><code>"poisson"</code> (the Poisson distribution).
</p>
</li></ul>

<p>The distribution parameters, i.e. the
</p>

<ul>
<li><p> mean <code>mu</code>,
</p>
</li>
<li><p> standard deviation <code>sigma</code> (not for the Poisson distribution),
</p>
</li>
<li><p> degrees of freedom <code>df</code> (only for the t-distribution),
</p>
</li></ul>

<p>can be fixed via, e.g., <code>"t(df = 1)"</code> or
<code>"gamma(mu = 0, sigma = 1)"</code>.
To fix different values of a parameter for different states, separate by
&quot;|&quot;, e.g. <code>"poisson(mu = 1|2|3)"</code>.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>sdds</code> must be a <code>vector</code> of length 2.
The first entry corresponds to the coarse-scale layer, while the second entry
corresponds to the fine-scale layer.
</p>
<p>By default, <code>sdds = "normal"</code> if <code>hierarchy = FALSE</code> and
<code>sdds = c("normal", "normal")</code> if <code>hierarchy = TRUE</code>.</p>
</td></tr>
<tr><td><code id="simulate_hmm_+3A_horizon">horizon</code></td>
<td>
<p>A <code>numeric</code>, specifying the length of the time horizon.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>horizon</code> must be a <code>vector</code> of length
2. The first entry corresponds to the coarse-scale layer, while the second
entry corresponds to the fine-scale layer.
</p>
<p>By default, <code>horizon = 100</code> if <code>hierarchy = FALSE</code> and
<code>horizon = c(100, 30)</code> if <code>hierarchy = TRUE</code>.
</p>
<p>If <code>data</code> is specified (i.e., not <code>NA</code>), the first entry of
<code>horizon</code> is ignored and the (coarse-scale) time horizon is defined by
available data.</p>
</td></tr>
<tr><td><code id="simulate_hmm_+3A_period">period</code></td>
<td>
<p>Only relevant if <code>hierarchy = TRUE</code>.
</p>
<p>In this case, a <code>character</code> which specifies a flexible, periodic
fine-scale time horizon and can be one of
</p>

<ul>
<li> <p><code>"w"</code> for a week,
</p>
</li>
<li> <p><code>"m"</code> for a month,
</p>
</li>
<li> <p><code>"q"</code> for a quarter,
</p>
</li>
<li> <p><code>"y"</code> for a year.
</p>
</li></ul>

<p>By default, <code>period = NA</code>. If <code>period</code> is not <code>NA</code>, it
overrules <code>horizon[2]</code>.</p>
</td></tr>
<tr><td><code id="simulate_hmm_+3A_true_parameters">true_parameters</code></td>
<td>
<p>An object of class <code>fHMM_parameters</code>, used as simulation parameters.
By default, <code>true_parameters = NULL</code>, i.e., sampled true parameters.</p>
</td></tr>
<tr><td><code id="simulate_hmm_+3A_seed">seed</code></td>
<td>
<p>Set a seed for the data simulation.
No seed per default.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>list</code> containing the following elements:
</p>

<ul>
<li> <p><code>time_points</code>, the <code>vector</code> (or <code>matrix</code> in the
hierarchical case) of time points,
</p>
</li>
<li> <p><code>markov_chain</code>, the <code>vector</code> (or <code>matrix</code> in the
hierarchical case) of the simulated states,
</p>
</li>
<li> <p><code>data</code>, the <code>vector</code> (or <code>matrix</code> in the hierarchical
case) of the simulated state-dependent observations,
</p>
</li>
<li> <p><code>T_star</code>, the <code>numeric</code> vector of fine-scale chunk sizes
in the hierarchical case
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>simulate_hmm(states = 2, sdds = "normal", horizon = 10)

</code></pre>

<hr>
<h2 id='simulate_observations'>Simulate state-dependent observations</h2><span id='topic+simulate_observations'></span>

<h3>Description</h3>

<p>This function simulates state-dependent observations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate_observations(
  markov_chain,
  sdd,
  mu,
  sigma = NULL,
  df = NULL,
  seed = NULL,
  total_length = length(markov_chain)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="simulate_observations_+3A_markov_chain">markov_chain</code></td>
<td>
<p>A <code>numeric</code> vector of states of a Markov chain.</p>
</td></tr>
<tr><td><code id="simulate_observations_+3A_sdd">sdd</code></td>
<td>
<p>A <code>character</code>, the name of the state-dependent distribution.</p>
</td></tr>
<tr><td><code id="simulate_observations_+3A_mu">mu</code></td>
<td>
<p>A <code>numeric</code> vector of expected values.</p>
</td></tr>
<tr><td><code id="simulate_observations_+3A_sigma">sigma</code></td>
<td>
<p>A <code>numeric</code> vector of standard deviations (if any).</p>
</td></tr>
<tr><td><code id="simulate_observations_+3A_df">df</code></td>
<td>
<p>A <code>numeric</code> vector of degrees of freedom (if any).</p>
</td></tr>
<tr><td><code id="simulate_observations_+3A_seed">seed</code></td>
<td>
<p>Sets a seed for the observation sampling.</p>
</td></tr>
<tr><td><code id="simulate_observations_+3A_total_length">total_length</code></td>
<td>
<p>An <code>integer</code>, the total length of the output vector.
Must be greater or equal than <code>length(markov_chain)</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>numeric</code> vector of length <code>total_length</code>, where the first
<code>length(markov_chain)</code> elements are numeric values and the last
<code>total_length - length(markov_chain)</code> elements are <code>NA_real_</code>.
</p>

<hr>
<h2 id='spx'>Standard &amp; Poor’s 500 (S&amp;P 500) index data</h2><span id='topic+spx'></span>

<h3>Description</h3>

<p>Standard &amp; Poor’s 500 (S&amp;P 500) index data from 1928 to 2022 from Yahoo
Finance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spx
</code></pre>


<h3>Format</h3>

<p>A <code>data.frame</code> with 23864 rows and the following 7 columns:
</p>

<ul>
<li> <p><code>Date</code>: The date.
</p>
</li>
<li> <p><code>Open</code>: Opening price.
</p>
</li>
<li> <p><code>High</code>: Highest price.
</p>
</li>
<li> <p><code>Low</code>: Lowest price.
</p>
</li>
<li> <p><code>Close</code>: Close price adjusted for splits.
</p>
</li>
<li> <p><code>Adj.Close</code>: Close price adjusted for dividends and splits.
</p>
</li>
<li> <p><code>Volume</code>: Trade volume.
</p>
</li></ul>



<h3>Details</h3>

<p>The data was obtained via:
</p>
<pre>
spx &lt;- download_data(
  symbol = "^GSPC",    # S&amp;P 500 identifier on Yahoo Finance
  from = "1928-01-01", # first observation
  to = "2022-12-31"    # last observation
)
</pre>

<hr>
<h2 id='unemp'>Unemployment rate data USA</h2><span id='topic+unemp'></span>

<h3>Description</h3>

<p>The monthly unemployment rate in the USA from 1955 to 2022 on a daily
observation basis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>unemp
</code></pre>


<h3>Format</h3>

<p>A <code>data.frame</code> with 24806 rows and the following 3 columns:
</p>

<ul>
<li> <p><code>date</code>: The date.
</p>
</li>
<li> <p><code>rate</code>: The unemployment rate.
</p>
</li>
<li> <p><code>rate_diff</code>: The difference rate to previous month.
</p>
</li></ul>



<h3>Source</h3>

<p>OECD (2023), Unemployment rate (indicator).
doi: 10.1787/52570002-en (Accessed on 18 January 2023)
<a href="https://data.oecd.org/unemp/unemployment-rate.htm">https://data.oecd.org/unemp/unemployment-rate.htm</a>
</p>

<hr>
<h2 id='unemp_spx_model_3_2'>Unemployment rate and S&amp;P 500 hierarchical HMM</h2><span id='topic+unemp_spx_model_3_2'></span>

<h3>Description</h3>

<p>A pre-computed HHMM with monthly unemployment rate in the US on the coarse
scale using 3 states and S&amp;P 500 index data on the fine scale using 2 states
from 1970 to 2020 for demonstration purpose.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("unemp_spx_model_3_2")
</code></pre>


<h3>Format</h3>

<p>An object of class <code><a href="#topic+fHMM_model">fHMM_model</a></code>.
</p>


<h3>Details</h3>

<p>The model was estimated via:
</p>
<pre>
controls &lt;- list(
  hierarchy = TRUE, states = c(3, 2), 
  sdds = c("t", "t"), period = "m",
  data = list(
    file = list(unemp, spx), 
    data_column = c("rate_diff", "Close"), 
    date_column = c("date", "Date"), 
    from = "1970-01-01", to = "2020-01-01", 
    logreturns = c(FALSE, TRUE)
  ),
  fit = list(runs = 50, iterlim = 1000, gradtol = 1e-6, steptol = 1e-6)
)
controls &lt;- set_controls(controls)
unemp_spx_data &lt;- prepare_data(controls)
unemp_spx_model_3_2 &lt;- fit_model(unemp_spx_data, seed = 1, ncluster = 10)
unemp_spx_model_3_2 &lt;- decode_states(unemp_spx_model_3_2)
unemp_spx_model_3_2 &lt;- compute_residuals(unemp_spx_model_3_2)
summary(unemp_spx_model_3_2)
state_order &lt;- matrix(c(3, 2, 1, 2, 2, 2, 1, 1, 1), 3, 3)
unemp_spx_model_3_2 &lt;- reorder_states(unemp_spx_model_3_2, state_order)
</pre>

<hr>
<h2 id='vw'>Volkswagen AG (VW) stock data</h2><span id='topic+vw'></span>

<h3>Description</h3>

<p>Volkswagen AG (VW) stock data from 1998 to 2022 from Yahoo Finance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vw
</code></pre>


<h3>Format</h3>

<p>A <code>data.frame</code> with 6260 rows and the following 7 columns:
</p>

<ul>
<li> <p><code>Date</code>: The date.
</p>
</li>
<li> <p><code>Open</code>: Opening price.
</p>
</li>
<li> <p><code>High</code>: Highest price.
</p>
</li>
<li> <p><code>Low</code>: Lowest price.
</p>
</li>
<li> <p><code>Close</code>: Close price adjusted for splits.
</p>
</li>
<li> <p><code>Adj.Close</code>: Close price adjusted for dividends and splits.
</p>
</li>
<li> <p><code>Volume</code>: Trade volume.
</p>
</li></ul>



<h3>Details</h3>

<p>The data was obtained via:
</p>
<pre>
vw &lt;- download_data(
  symbol = "VOW3.DE",  # Volkswagen AG identifier on Yahoo Finance
  from = "1988-07-22", # first observation
  to = "2022-12-31"    # last observation
)
</pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
