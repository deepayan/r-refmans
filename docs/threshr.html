<!DOCTYPE html><html><head><title>Help for package threshr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {threshr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#gom'><p>Storm peak significant wave heights from the Gulf of Mexico</p></a></li>
<li><a href='#ithresh'><p>Threshold selection in the i.i.d. case (peaks over threshold)</p></a></li>
<li><a href='#ns'><p>Storm peak significant wave heights from the North Sea</p></a></li>
<li><a href='#plot.ithresh'><p>Plot diagnostics an ithresh object</p></a></li>
<li><a href='#plot.ithreshpred'><p>Plot diagnostics an ithreshpred object</p></a></li>
<li><a href='#plot.stability'><p>Plot diagnostics for a stability object</p></a></li>
<li><a href='#predict.ithresh'><p>Predictive inference for the largest value observed in N years.</p></a></li>
<li><a href='#print.ithresh'><p>Print method for objects of class <code>"ithresh"</code></p></a></li>
<li><a href='#stability'><p>Generalized Pareto parameter estimate stability</p></a></li>
<li><a href='#summary.ithresh'><p>Summarizing measures of threshold predictive performance</p></a></li>
<li><a href='#threshr-internal'><p>Internal threshr functions</p></a></li>
<li><a href='#threshr-package'><p>threshr: Threshold Selection and Uncertainty for Extreme Value Analysis</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Threshold Selection and Uncertainty for Extreme Value Analysis</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.5</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-12-02</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides functions for the selection of thresholds for use in 
    extreme value models, based mainly on the methodology in 
    Northrop, Attalides and Jonathan (2017) &lt;<a href="https://doi.org/10.1111%2Frssc.12159">doi:10.1111/rssc.12159</a>&gt;.
    It also performs predictive inferences about future extreme values, 
    based either on a single threshold or on a weighted average of inferences 
    from multiple thresholds, using the 'revdbayes' package 
    <a href="https://cran.r-project.org/package=revdbayes">https://cran.r-project.org/package=revdbayes</a>.   
    At the moment only the case where the data can be treated as 
    independent identically distributed observations is considered.</td>
</tr>
<tr>
<td>Imports:</td>
<td>graphics, methods, revdbayes (&ge; 1.3.4), rust (&ge; 1.2.2),
stats</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>LazyData:</td>
<td>TRUE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.3.0)</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://paulnorthrop.github.io/threshr/">https://paulnorthrop.github.io/threshr/</a>,
<a href="https://github.com/paulnorthrop/threshr">https://github.com/paulnorthrop/threshr</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/paulnorthrop/threshr/issues">https://github.com/paulnorthrop/threshr/issues</a></td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-12-02 22:19:29 UTC; Paul</td>
</tr>
<tr>
<td>Author:</td>
<td>Paul J. Northrop [aut, cre, cph],
  Nicolas Attalides [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Paul J. Northrop &lt;p.northrop@ucl.ac.uk&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-12-02 22:40:01 UTC</td>
</tr>
</table>
<hr>
<h2 id='gom'>Storm peak significant wave heights from the Gulf of Mexico</h2><span id='topic+gom'></span>

<h3>Description</h3>

<p>A numeric vector containing 315 hindcasts of storm peak significant wave
heights, in metres, from 1900 to 2005 at an unnamed location in the Gulf
of Mexico.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gom
</code></pre>


<h3>Format</h3>

<p>A vector containing 315 observations.
</p>


<h3>Source</h3>

<p>Oceanweather Inc. (2005) GOMOS &ndash; Gulf of Mexico hindcast study.
</p>


<h3>References</h3>

<p>Northrop, P. J., N. Attalides, and P. Jonathan. (2017).
Cross-Validatory Extreme Value Threshold Selection and Uncertainty with
Application to Ocean Storm Severity. <em>Journal of the Royal
Statistical Society: Series C (Applied Statistics)</em>, <strong>66</strong>(1),
93-120. <a href="https://doi.org/10.1111/rssc.12159">doi:10.1111/rssc.12159</a>.
</p>

<hr>
<h2 id='ithresh'>Threshold selection in the i.i.d. case (peaks over threshold)</h2><span id='topic+ithresh'></span>

<h3>Description</h3>

<p>Produces a diagnostic plot to assist in the selection of an extreme value
threshold in the case where the data can be treated as independent and
identically distributed (i.i.d.) observations.  For example, it could be
that these observations are the cluster maxima resulting from the
declustering of time series data.  The predictive ability of models
fitted using each of a user-supplied set of thresholds is assessed using
leave-one-out cross-validation in a Bayesian setup.
These models are based on a Generalized Pareto (GP) distribution for
threshold excesses and a binomial model for the probability of threshold
exceedance.  See Northrop et al. (2017) for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ithresh(data, u_vec, ..., n_v = 1, npy = NULL, use_rcpp = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ithresh_+3A_data">data</code></td>
<td>
<p>A numeric vector of observations.  Any missing values will
be removed.  The argument <code>npy</code> (see below) may be supplied
as an attribute of <code>data</code> using <code>attr(data, "npy") &lt;- value</code>,
where <code>value</code> is the value of <code>npy</code> (see <code><a href="base.html#topic+attr">attr</a></code>).
If <code>npy</code> is supplied twice, as both <code>attr(data, "npy")</code>)
and using the <code>npy</code> argument, then the former is used.</p>
</td></tr>
<tr><td><code id="ithresh_+3A_u_vec">u_vec</code></td>
<td>
<p>A numeric vector. A vector of <em>training</em> thresholds
at which inferences are made from a binomial-GP model.  These could be
set at sample quantiles of  <code>data</code> using
<code><a href="stats.html#topic+quantile">quantile</a></code>.  Any duplicated values will be removed.</p>
</td></tr>
<tr><td><code id="ithresh_+3A_...">...</code></td>
<td>
<p>Further (optional) arguments to be passed to the
<code><a href="revdbayes.html#topic+revdbayes">revdbayes</a></code> function
<code><a href="revdbayes.html#topic+rpost_rcpp">rpost_rcpp</a></code> (or <code><a href="revdbayes.html#topic+rpost">rpost</a></code>),
which use the generalized ratio-of-uniforms method to simulate from
extreme value posterior distributions.
In particular:
</p>

<ul>
<li> <p><code>n</code>. The size of the posterior sample used to perform
predictive inference.  Default: <code>n = 1000</code>.
</p>
</li>
<li> <p><code>prior</code>. A prior for GP parameters to be passed to the
<strong>revdbayes</strong> function <code><a href="revdbayes.html#topic+set_prior">set_prior</a></code>.
Can be either a character scalar that chooses an in-built prior,
or a user-supplied R function or pointer to a compiled C++ function.
See the <code><a href="revdbayes.html#topic+set_prior">set_prior</a></code> documentation for details
of the in-built priors.
See the <strong>revdbayes</strong> vignette
<a href="https://cran.r-project.org/package=revdbayes">Faster simulation
using revdbayes</a> for information about creating
a pointer to a C++ function.  See also the <strong>Examples</strong> section.
</p>
<p>If the user supplies an R function then <code><a href="revdbayes.html#topic+rpost">rpost</a></code> will be
used for posterior simulation, rather than (the faster)
<code><a href="revdbayes.html#topic+rpost_rcpp">rpost_rcpp</a></code>, regardless of the input value of
<code>use_rcpp</code>.
</p>
<p>Default: <code>prior = "mdi"</code> with <code>a = 0.6</code> and <code>min_xi = -1</code>.
This particular prior is studied in Northrop et al. (2017).
</p>
</li>
<li> <p><code>h_prior</code>. A <em>list</em> of further arguments
(hyperparameters) for the GP prior specified in <code>prior</code>.
</p>
</li>
<li> <p><code>bin_prior</code>. A prior for the threshold exceedance probability
<code class="reqn">p</code> to be passed to the <strong>revdbayes</strong> function
<code><a href="revdbayes.html#topic+set_bin_prior">set_bin_prior</a></code>.
Can either be a character scalar that chooses an in-built prior,
or a user_supplied R function.
</p>
<p>Default: <code>prior = "jeffreys"</code>, i.e. Beta(1/2, 1/2).
</p>
</li>
<li> <p><code>h_bin_prior</code>. A <em>list</em> of further arguments
(hyperparameters) for the binomial prior specified in <code>bin_prior</code>.
See the <code><a href="revdbayes.html#topic+set_bin_prior">set_bin_prior</a></code> documentation for details
of the in-built priors.
</p>
</li>
<li> <p><code>trans</code>. A character scalar: either <code>"none"</code> or
<code>"BC"</code>.  See <code><a href="revdbayes.html#topic+rpost_rcpp">rpost_rcpp</a></code> for details.
The default is <code>"none"</code>, which is usually faster than <code>"BC"</code>.
However, if there are very few threshold excesses then using
<code>trans = "BC"</code> can make the optimizations involved in the
generalized ratio-of-uniforms algorithm more stable.  If using
<code>trans = "none"</code> produces an error for a particular posterior
simulation then <code>trans = "BC"</code> is used instead.
</p>
</li></ul>
</td></tr>
<tr><td><code id="ithresh_+3A_n_v">n_v</code></td>
<td>
<p>A numeric scalar.
Each of the <code>n_v</code> largest values in <code>u_vec</code> will be used
(separately) as a <em>validation</em> threshold for the training thresholds
in <code>u_vec</code> that lie at or below that validation threshold.
If <code>n_v = 1</code> then all the training thresholds are used with
validation performed using the threshold <code>u_vec[length(u_vec)]</code>.
If <code>n_v = 2</code> then, in addition, the assessment is performed using
<code>u_vec[1], ..., u_vec[length(u_vec) - 1]</code> with
validation threshold <code>u_vec[length(u_vec) - 1]</code>,
and so on.</p>
</td></tr>
<tr><td><code id="ithresh_+3A_npy">npy</code></td>
<td>
<p>A numeric scalar. The mean number of observations per year
of data, after excluding any missing values, i.e. the number of
non-missing observations divided by total number of years of non-missing
data.  May be supplied using as an attribute <code>attr(data, "npy")</code>
of <code>data</code> instead.
</p>
<p>The value of <code>npy</code> does not affect any calculation in
<code>ithresh</code>, it only affects subsequent extreme value inferences using
<code>predict.ithresh</code>.  However, setting <code>npy</code> in the call to
<code>rpost</code>, or as an attribute of <code>data</code> avoids the need to
supply <code>npy</code> when calling <code>predict.ithresh</code>.</p>
</td></tr>
<tr><td><code id="ithresh_+3A_use_rcpp">use_rcpp</code></td>
<td>
<p>A logical scalar.  If <code>TRUE</code> (the default) the
revdbayes function <code><a href="revdbayes.html#topic+rpost_rcpp">rpost_rcpp</a></code> is used for
posterior simulation.  If <code>FALSE</code>, or if the user supplies an R
function to set the prior for GP parameters,
the (slower) function <code><a href="revdbayes.html#topic+rpost">rpost</a></code> is used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For a given threshold in <code>u_vec</code>:
</p>

<ul>
<li><p> the number of values in <code>data</code> that exceed the threshold,
and the amounts (the <em>threshold excesses</em>) by which these value
exceed the threshold are calculated;
</p>
</li>
<li> <p><code><a href="revdbayes.html#topic+rpost_rcpp">rpost_rcpp</a></code>
(or <code><a href="revdbayes.html#topic+rpost">rpost</a></code>) is used to sample from the posterior
distributions of the parameters of a GP model for the threshold
excesses and a binomial model for the probability of threshold
exceedance;
</p>
</li>
<li><p> the ability of this binomial-GP model to predict data
thresholded at the validation threshold(s) specified by <code>n_v</code> is
assessed using leave-one-out cross-validation (the measure of
this is given in equation (7) of Northrop et al. (2017).
</p>
</li></ul>

<p>See Northrop et al. (2017) and the introductory threshr vignette for
further details and examples.
</p>


<h3>Value</h3>

<p>An object (list) of class <code>"ithresh"</code>, containing the
components
</p>

<ul>
<li> <p><code>pred_perf</code>: A numeric matrix with <code>length(u_vec)</code>
rows and <code>n_v</code> columns.  Each column contains the values of
the measure of predictive performance.  Entries corresponding
to cases where the training threshold is above the validation
threshold will be <code>NA</code>.
</p>
</li>
<li> <p><code>u_vec</code>: The argument <code>u_vec</code> to <code>ithresh</code>.
</p>
</li>
<li> <p><code>v_vec</code>: A numeric vector.  The validation thresholds
implied by the argument <code>n_v</code> to <code>ithresh</code>.
</p>
</li>
<li> <p><code>u_ps</code>: A numeric vector. The approximate levels of the
sample quantiles to which the values in <code>u_vec</code> correspond,
i.e. the approximate percentage of the data the lie at or below
each element in <code>u_vec</code>.
</p>
</li>
<li> <p><code>v_ps</code>: A numeric vector.  The values in <code>u_ps</code>
that correspond to the validation thresholds.
</p>
</li>
<li> <p><code>sim_vals</code>: A numeric matrix with 4 columns and
<code>n</code> x <code>length(u_vec)</code> rows.  The <code class="reqn">j</code>th block of
<code>n</code> rows contains in columns 1-3 the posterior samples of
the threshold exceedance probability, the GP scale
parameter and the GP shape parameter respectively,
based on training threshold <code>u_vec[i]</code>,
and in column 4 the value of <code class="reqn">j</code>.
</p>
</li>
<li> <p><code>n</code>: A numeric scalar.  The value of <code>n</code>.
</p>
</li>
<li> <p><code>npy</code>: A numeric scalar.  The value of <code>npy</code>.
</p>
</li>
<li> <p><code>data</code>: The argument <code>data</code> to <code>ithresh</code>
detailed above, with any missing values removed.
</p>
</li>
<li> <p><code>use_rcpp</code>: A logical scalar indicating whether
<code><a href="revdbayes.html#topic+rpost_rcpp">rpost_rcpp</a></code> (<code>use_rcpp = TRUE</code>) or
<code><a href="revdbayes.html#topic+rpost">rpost</a></code> (<code>use_rcpp = FALSE</code>)
was used for posterior simulation.
</p>
</li>
<li> <p><code>for_post</code>: A list containing arguments with which
<code><a href="revdbayes.html#topic+rpost_rcpp">rpost_rcpp</a></code>
(or <code><a href="revdbayes.html#topic+rpost">rpost</a></code>) was called, including
any user-supplied arguments to these functions.
</p>
</li>
<li> <p><code>call:</code> The call to <code>ithresh</code>.
</p>
</li></ul>



<h3>References</h3>

<p>Northrop, P.J. and Attalides, N. (2016) Posterior propriety in
Bayesian extreme value analyses using reference priors
<em>Statistica Sinica</em>, <strong>26</strong>(2), 721&ndash;743
<a href="https://doi.org/10.5705/ss.2014.034">doi:10.5705/ss.2014.034</a>.
</p>
<p>Northrop, P. J., Attalides, N. and Jonathan, P. (2017)
Cross-validatory extreme value threshold selection and uncertainty
with application to ocean storm severity.
<em>Journal of the Royal Statistical Society Series C: Applied
Statistics</em>, <strong>66</strong>(1), 93-120.
<a href="https://doi.org/10.1111/rssc.12159">doi:10.1111/rssc.12159</a>
</p>
<p>Jonathan, P. and Ewans, K. (2013) Statistical modelling
of extreme ocean environments for marine design : a review.
<em>Ocean Engineering</em>, <strong>62</strong>, 91-109.
<a href="https://doi.org/10.1016/j.oceaneng.2013.01.004">doi:10.1016/j.oceaneng.2013.01.004</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.ithresh">plot.ithresh</a></code> for the S3 plot method for objects of
class <code>ithresh</code>.
</p>
<p><code><a href="#topic+summary.ithresh">summary.ithresh</a></code> Summarizing measures of threshold
predictive performance.
</p>
<p><code><a href="#topic+predict.ithresh">predict.ithresh</a></code> for predictive inference for the
largest value observed in N years.
</p>
<p><code><a href="revdbayes.html#topic+rpost">rpost</a></code> in the
<code><a href="revdbayes.html#topic+revdbayes">revdbayes</a></code> package for details of the arguments
that can be passed to
<code><a href="revdbayes.html#topic+rpost_rcpp">rpost_rcpp</a></code>/<code><a href="revdbayes.html#topic+rpost">rpost</a></code>.
</p>
<p><code><a href="revdbayes.html#topic+set_prior">set_prior</a></code> and
<code><a href="revdbayes.html#topic+set_bin_prior">set_bin_prior</a></code> in the
<code><a href="revdbayes.html#topic+revdbayes">revdbayes</a></code> package for details of how to set a
prior distributions for GP parameters and for the exceedance probability
<code class="reqn">p</code>.
</p>
<p><code><a href="stats.html#topic+quantile">quantile</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Note:
# 1. Smoother plots result from making n larger than the default n = 1000.
# 2. In some examples below validation thresholds rather higher than is
#    advisable have been used, with far fewer excesses than the minimum of
#    50 suggested by Jonathan and Ewans (2013).

## North Sea significant wave heights, default prior -----------------------
#' # A plot akin to the top left of Figure 7 in Northrop et al. (2017)
#' # ... but with fewer training thresholds

u_vec_ns &lt;- quantile(ns, probs = seq(0.1, 0.9, by = 0.1))
ns_cv &lt;- ithresh(data = ns, u_vec = u_vec_ns, n_v = 2)
plot(ns_cv, lwd = 2, add_legend = TRUE, legend_pos = "topright")
mtext("significant wave height / m", side = 3, line = 2.5)

## Gulf of Mexico significant wave heights, default prior ------------------

u_vec_gom &lt;- quantile(gom, probs = seq(0.2, 0.9, by = 0.1))
# Setting a prior using its name and parameter value(s) --------------------
# This example gives the same prior as the default
gom_cv &lt;- ithresh(data = gom, u_vec = u_vec_gom, n_v = 2, prior = "mdi",
                  h_prior = list(a = 0.6))

## Setting a user-defined (log-)prior R function ---------------------------
# This example also gives the same prior as the default
# (It will take longer to run than the example above because ithresh detects
#  that the prior is an R function and sets use_rcpp to FALSE.)

user_prior &lt;- function(pars, a, min_xi = -1) {
  if (pars[1] &lt;= 0 | pars[2] &lt; min_xi) {
    return(-Inf)
  }
  return(-log(pars[1]) - a * pars[2])
}
user_bin_prior &lt;- function(p, ab) {
  return(stats::dbeta(p, shape1 = ab[1], shape2 = ab[2], log = TRUE))
}
gom_cv &lt;- ithresh(data = gom, u_vec = u_vec_gom, n_v = 2, prior = user_prior,
                  h_prior = list(a = 0.6), bin_prior = user_bin_prior,
                  h_bin_prior = list(ab = c(1 / 2, 1 / 2)))

## Setting a user-defined (log-)prior (pointer to a) C++ function ----------
# We make use of a C++ function and function create_prior_xptr() to create
# the required pointer from the revdbayes package

prior_ptr &lt;- revdbayes::create_prior_xptr("gp_flat")
gom_cv &lt;- ithresh(data = gom, u_vec = u_vec_gom, n_v = 2, prior = prior_ptr,
                  h_prior = list(min_xi = -1))
</code></pre>

<hr>
<h2 id='ns'>Storm peak significant wave heights from the North Sea</h2><span id='topic+ns'></span>

<h3>Description</h3>

<p>A numeric vector containing 628 hindcasts of storm peak significant wave
heights, in metres, from 1964 to 1995 at an unnamed location in the North
Sea.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ns
</code></pre>


<h3>Format</h3>

<p>A vector containing 628 observations.
</p>


<h3>Source</h3>

<p>Oceanweather Inc. (1995) NEXT &ndash; North Sea hindcast study.
</p>


<h3>References</h3>

<p>Northrop, P. J., N. Attalides, and P. Jonathan. (2017).
Cross-Validatory Extreme Value Threshold Selection and Uncertainty with
Application to Ocean Storm Severity. <em>Journal of the Royal
Statistical Society: Series C (Applied Statistics)</em>, <strong>66</strong>(1),
93-120. <a href="https://doi.org/10.1111/rssc.12159">doi:10.1111/rssc.12159</a>.
</p>

<hr>
<h2 id='plot.ithresh'>Plot diagnostics an ithresh object</h2><span id='topic+plot.ithresh'></span>

<h3>Description</h3>

<p><code>plot</code> method for class <code>"ithresh"</code>.  Produces an extreme value
threshold diagnostic plot based on an analysis performed by
<code><a href="#topic+ithresh">ithresh</a></code>.  Can also be used to produce a plot of
the posterior sample generated by <code><a href="#topic+ithresh">ithresh</a></code> for a particular
training threshold.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ithresh'
plot(
  x,
  y,
  ...,
  which_v = NULL,
  prob = TRUE,
  top_scale = TRUE,
  add_legend = FALSE,
  legend_pos = "topleft",
  which_u = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.ithresh_+3A_x">x</code></td>
<td>
<p>an object of class <code>"ithresh"</code>, a result of a call to
<code><a href="#topic+ithresh">ithresh</a></code>.</p>
</td></tr>
<tr><td><code id="plot.ithresh_+3A_y">y</code></td>
<td>
<p>Not used.</p>
</td></tr>
<tr><td><code id="plot.ithresh_+3A_...">...</code></td>
<td>
<p>Additional arguments passed on to <code><a href="graphics.html#topic+matplot">matplot</a></code>
and/or <code><a href="graphics.html#topic+legend">legend</a></code> and/or <code><a href="graphics.html#topic+axis">axis</a></code>.
If <code>which_u</code> is supplied then these arguments are passed to
<code><a href="revdbayes.html#topic+plot.evpost">plot.evpost</a></code>.</p>
</td></tr>
<tr><td><code id="plot.ithresh_+3A_which_v">which_v</code></td>
<td>
<p>A numeric scalar or vector.
</p>
<p>If <code>which_u</code> is not supplied (a threshold diagnostic plot is
required) <code>which_v</code> specifies the validation thresholds, that
is, the components of <code>x$v_vec</code>, to include in the plot.
</p>
<p>If <code>which_u</code> is supplied (a plot of a posterior sample for a given
threshold is required) then <code>which_v</code> is a numeric scalar
that indicates which element of <code>object$v_vec</code> is used in selecting
a single threshold (if <code>which_u = "best"</code>).
Note: the default, <code>which_v = 1</code> gives the <em>lowest</em> of the
validation thresholds in <code>object$v_vec</code>.</p>
</td></tr>
<tr><td><code id="plot.ithresh_+3A_prob">prob</code></td>
<td>
<p>A logical scalar.  If <code>TRUE</code> then the levels of thresholds
are represented by the proportion of observations that lie below a
threshold.  If <code>prob = FALSE</code> then the values of the thresholds are
used.</p>
</td></tr>
<tr><td><code id="plot.ithresh_+3A_top_scale">top_scale</code></td>
<td>
<p>A logical scalar indicating Whether or not to add a scale
to the top horizontal axis.  If this is added it gives the threshold on
the scale not chosen by <code>prob</code>.</p>
</td></tr>
<tr><td><code id="plot.ithresh_+3A_add_legend">add_legend</code></td>
<td>
<p>A logical scalar indicating whether or not to add a
legend to the plot.  If <code>method = "cv"</code> then the legend gives the
levels of the validation thresholds.</p>
</td></tr>
<tr><td><code id="plot.ithresh_+3A_legend_pos">legend_pos</code></td>
<td>
<p>The position of the legend (if required) specified using
the argument <code>x</code> in <code><a href="graphics.html#topic+legend">legend</a></code>.</p>
</td></tr>
<tr><td><code id="plot.ithresh_+3A_which_u">which_u</code></td>
<td>
<p>Either a character scalar or a numeric scalar.
If <code>which_u</code> is supplied then <code><a href="revdbayes.html#topic+plot.evpost">plot.evpost</a></code>
is used to produce a plot of the posterior sample generated using
a particular training threshold. By default a scatter plot of the posterior
sample of Generalized Pareto parameters is produced.
</p>
<p>If <code>which_u = "best"</code> then the training threshold achieving the largest
measure of predictive performance in <code>object$pred_perf</code>, based
on the validation threshold selected using <code>which_v</code>, is used.
See <code><a href="#topic+summary.ithresh">summary.ithresh</a></code> to print the best thresholds for each
validation threshold.
</p>
<p>Otherwise, <code>which_u</code> is a numeric scalar that selects training
threshold <code>x$u_vec[which_u]</code>.  Therefore, <code>which_u</code> must
be an integer in <code>1, ..., length(x$u_vec)</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Produces plots of the <em>threshold weights</em>, defined in
equation (14) of Northrop et al. (2017) against training threshold.  A line
is produced for each of the validation thresholds chosen in <code>which_v</code>.
The result is a plot like those in the top row of Figure 7 in
Northrop et al. (2017).
</p>
<p>It is possible that a curve on the plot may be incomplete.  This indicates
that, for a particular threshold level, a measure of predictive
performance is <code>-Inf</code>. This occurs when an observation in the data
lies above the estimated upper end point of the predictive distribution
produced when this observation is removed.
</p>


<h3>Value</h3>

<p>If <code>which_u</code> is supplied then the object with which
<code><a href="revdbayes.html#topic+plot.evpost">plot.evpost</a></code> was called is returned (invisibly).
Otherwise, a list is returned (again invisibly) with two components.
<code>x</code> is a vector containing the coordinates plotted on the
(lower) horizontal axis.
<code>y</code> is an <code>length(u_vec)</code> by <code>n_v</code> matrix of
<em>threshold weights</em> obtained by normalising the columns of the
matrix <code>pred_perf</code> returned by <code><a href="#topic+ithresh">ithresh</a></code>.
See equation (14) of Northrop et al. (2017).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ithresh">ithresh</a></code> for threshold selection in the i.i.d. case
based on leave-one-out cross-validation.
</p>
<p><code><a href="#topic+summary.ithresh">summary.ithresh</a></code> Summarizing measures of threshold
predictive performance.
</p>
<p><code><a href="#topic+print.ithresh">print.ithresh</a></code> Prints the threshold weights.
</p>
<p><code><a href="#topic+predict.ithresh">predict.ithresh</a></code> for predictive inference for the
largest value observed in N years.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># [Smoother plots result from making n larger than the default n = 1000.]

# Threshold diagnostic plot
u_vec_gom &lt;- quantile(gom, probs = seq(0, 0.9, by = 0.05))
gom_cv &lt;- ithresh(data = gom, u_vec = u_vec_gom, n_v = 3)
plot(gom_cv, lwd = 2, add_legend = TRUE, legend_pos = "topleft")
mtext("significant wave height / m", side = 3, line = 2.5)

# Plot of Generalized Pareto posterior sample at the best threshold
# (based on the lowest validation threshold)
plot(gom_cv, which_u = "best")
# See which threshold was used
summary(gom_cv)

# Plot of Generalized Pareto posterior sample at the highest threshold
n_u &lt;- length(u_vec_gom)
plot(gom_cv, which_u = n_u, points_par = list(pch = 20, col = "grey"))
</code></pre>

<hr>
<h2 id='plot.ithreshpred'>Plot diagnostics an ithreshpred object</h2><span id='topic+plot.ithreshpred'></span>

<h3>Description</h3>

<p><code>plot</code> method for class <code>"ithreshpred"</code>.  Produces plots to
summarise the predictive inferences made by <code><a href="#topic+predict.ithresh">predict.ithresh</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ithreshpred'
plot(x, ..., ave_only = FALSE, add_best = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.ithreshpred_+3A_x">x</code></td>
<td>
<p>an object of class <code>"ithreshpred"</code>, a result of a call to
<code><a href="#topic+ithresh">ithresh</a></code>.</p>
</td></tr>
<tr><td><code id="plot.ithreshpred_+3A_...">...</code></td>
<td>
<p>Additional arguments passed on to
<code><a href="revdbayes.html#topic+plot.evpred">plot.evpred</a></code>.</p>
</td></tr>
<tr><td><code id="plot.ithreshpred_+3A_ave_only">ave_only</code></td>
<td>
<p>A logical scalar.  Only relevant if
<code><a href="#topic+predict.ithresh">predict.ithresh</a></code> was called with <code>which_u = "all"</code>.
If <code>TRUE</code> then plot only
a curve for the weighted average over multiple training thresholds.
If <code>FALSE</code> then also plot a curve for each training threshold.</p>
</td></tr>
<tr><td><code id="plot.ithreshpred_+3A_add_best">add_best</code></td>
<td>
<p>A logical scalar.  If <code>TRUE</code> then the best
threshold, as judged using the validation threshold selected using the
argument <code>which_v</code> supplied to <code><a href="#topic+predict.ithresh">predict.ithresh</a></code>, is
highlighted by plotting it with a different line style.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><em>Single threshold case</em>, where
<code><a href="#topic+predict.ithresh">predict.ithresh</a></code> was called with numeric scalar
<code>which_u</code> or <code>which_u = "best"</code>.
<code><a href="revdbayes.html#topic+plot.evpred">plot.evpred</a></code> is called to produce the plot.
</p>
<p><em>Multiple threshold</em> case, where
<code><a href="#topic+predict.ithresh">predict.ithresh</a></code> was called with <code>which_u = "all"</code>.
Again, <code><a href="revdbayes.html#topic+plot.evpred">plot.evpred</a></code> is called but now the
estimated predictive distribution function (<code>type = "p"</code> used
in the call to <code><a href="#topic+predict.ithresh">predict.ithresh</a></code>) or density function
(<code>type = "d"</code>) is plotted for each of the training thresholds
(grey lines) as is the result of the weighted average over the
different training thresholds (black line).
If graphical parameters, such as <code>lty</code>, <code>lwd</code> or <code>col</code>
are passed via <code>...</code> then the first element relates to the
weighted average and the remaining <code>length(x$u_vec)</code> elements to
the respective training thresholds in <code>u_vec</code>.
</p>


<h3>Value</h3>

<p>A list containing the graphical parameters using in producing the
plot including any arguments supplied via ... is returned (invisibly).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ithresh">ithresh</a></code> for threshold selection in the i.i.d. case
based on leave-one-out cross-validation.
</p>
<p><code><a href="#topic+predict.ithresh">predict.ithresh</a></code> for predictive inference for the
largest value observed in N years.
</p>
<p><code><a href="#topic+plot.ithresh">plot.ithresh</a></code> for the S3 plot method for objects of
class <code>ithresh</code>.
</p>
<p><code><a href="#topic+summary.ithresh">summary.ithresh</a></code> Summarizing measures of threshold
predictive performance.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>u_vec_gom &lt;- quantile(gom, probs = seq(0, 0.9, by = 0.05))
gom_cv &lt;- ithresh(data = gom, u_vec = u_vec_gom, n_v = 3)

# Note: gom_cv$npy contains the correct value of npy (it was set in the
#       call to ithresh, via attr(gom, "npy").
#       If object$npy doesn't exist then the argument npy must be supplied
#       in the call to predict().

### Best training threshold based on the lowest validation threshold

# Predictive distribution function
npy_gom &lt;- length(gom)/105
best_p &lt;- predict(gom_cv, n_years = c(100, 1000))
plot(best_p)

# Predictive density function
best_d &lt;- predict(gom_cv, type = "d", n_years = c(100, 1000))
plot(best_d)

### All thresholds plus weighted average of inferences over all thresholds

# Predictive distribution function
all_p &lt;- predict(gom_cv, which_u = "all")
plot(all_p)

# Predictive density function
all_d &lt;- predict(gom_cv, which_u = "all", type = "d")
plot(all_d)

### ... and highlight the best threshold

plot(all_p, add_best = TRUE)
plot(all_d, add_best = TRUE)
</code></pre>

<hr>
<h2 id='plot.stability'>Plot diagnostics for a stability object</h2><span id='topic+plot.stability'></span>

<h3>Description</h3>

<p><code>plot</code> method for objects of class <code>"stability"</code> returned from
<code><a href="#topic+stability">stability</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'stability'
plot(
  x,
  y,
  ...,
  prob = TRUE,
  top_scale = c("none", "excesses", "opposite"),
  vertical = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.stability_+3A_x">x</code></td>
<td>
<p>an object of class <code>"stability"</code>, a result of a call to
<code><a href="#topic+stability">stability</a></code>.</p>
</td></tr>
<tr><td><code id="plot.stability_+3A_y">y</code></td>
<td>
<p>Not used.</p>
</td></tr>
<tr><td><code id="plot.stability_+3A_...">...</code></td>
<td>
<p>Additional arguments passed on to
<code><a href="graphics.html#topic+matplot">matplot</a></code>, <code><a href="graphics.html#topic+axis">axis</a></code>
and/or <code><a href="graphics.html#topic+segments">segments</a></code>.</p>
</td></tr>
<tr><td><code id="plot.stability_+3A_prob">prob</code></td>
<td>
<p>A logical scalar.  If <code>TRUE</code> then the levels of thresholds
on the lower horizontal axis are represented by the proportion of
observations that lie below a threshold.  If <code>prob = FALSE</code> then the
values of the thresholds are used.</p>
</td></tr>
<tr><td><code id="plot.stability_+3A_top_scale">top_scale</code></td>
<td>
<p>A character scalar.
If <code>top_scale = "none"</code> then no axis labels appear on the upper
horizontal axis.
If <code>top_scale = "excesses"</code> then the number of threshold excesses
at each threshold are indicated.
If <code>top_scale = "opposite"</code> then the type of threshold level
<em>not</em> chosen using <code>prob</code> is indicated.</p>
</td></tr>
<tr><td><code id="plot.stability_+3A_vertical">vertical</code></td>
<td>
<p>A logical scalar.  Should the confidence intervals be
depicted using a vertical line for each threshold (<code>TRUE</code>) or by
joining up confidence limits across thresholds (<code>FALSE</code>)?</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Produces a simple threshold diagnostic plot based on the object
returned from <code><a href="#topic+stability">stability</a></code>.
The MLEs of the GP shape parameter $<code class="reqn">\xi</code>$ and
approximate <code>conf</code>% confidence intervals
for <code class="reqn">\xi</code> are plotted against the threshold used to fit the GP model.
This plot is used to choose a threshold above which the underlying GP
shape parameter may be approximately constant. See Chapter 4 of
Coles (2001).  See also the vignette &quot;Introducing threshr&quot;.
as described in .
See also the vignette &quot;Introducing threshr&quot;.
</p>


<h3>Value</h3>

<p>In addition to producing the plot a list of the arguments used
by <code><a href="graphics.html#topic+matplot">matplot</a></code>, <code><a href="graphics.html#topic+axis">axis</a></code> is
returned (invisibly).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+stability">stability</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>u_vec_gom &lt;- quantile(gom, probs = seq(0, 0.9, by = 0.05))
gom_stab &lt;- stability(data = gom, u_vec = u_vec_gom)
plot(gom_stab)
</code></pre>

<hr>
<h2 id='predict.ithresh'>Predictive inference for the largest value observed in N years.</h2><span id='topic+predict.ithresh'></span>

<h3>Description</h3>

<p><code>predict</code> method for class <code>"ithresh"</code>.  Predictive inferences can
either be based on a <em>single training threshold</em> or using a weighted
average of inferences over <em>multiple training thresholds</em>.  A single
threshold may chosen to be the best performing threshold, as judged by the
measure of predictive performance calculated by <code><a href="#topic+ithresh">ithresh</a></code> or
chosen by the user.  The weights used in the latter case are based on the
measures of predictive performance and prior probabilities assigned to the
training thresholds.  By default all thresholds are given the same
prior probability but the user can specify their own prior.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ithresh'
predict(
  object,
  npy = NULL,
  n_years = 100,
  which_u = c("best", "all"),
  which_v = 1L,
  u_prior = rep(1, length(object$u_vec)),
  type = c("p", "d", "q", "i", "r"),
  hpd = FALSE,
  x = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.ithresh_+3A_object">object</code></td>
<td>
<p>An object of class <code>"ithresh"</code>, a result of a call to
<code><a href="#topic+ithresh">ithresh</a></code>.</p>
</td></tr>
<tr><td><code id="predict.ithresh_+3A_npy">npy</code></td>
<td>
<p>A numeric scalar. The mean number of observations per year
of data, after excluding any missing values, i.e. the number of
non-missing observations divided by total number of years of non-missing
data.</p>
</td></tr>
<tr><td><code id="predict.ithresh_+3A_n_years">n_years</code></td>
<td>
<p>A numeric vector. Value(s) of N.  If <code>which_u = "all"</code>
then <code>n_years</code> must have length one.</p>
</td></tr>
<tr><td><code id="predict.ithresh_+3A_which_u">which_u</code></td>
<td>
<p>Either a character scalar or a numeric scalar.
If <code>which_u</code> is a character scalar it must be either &quot;best&quot; or &quot;all&quot;.
</p>
<p>If <code>which_u = "best"</code> then the single threshold achieving the largest
measure of predictive performance in <code>object$pred_perf</code>, based
on the validation threshold selected using <code>which_v</code>, is used to
perform prediction.  See <code><a href="#topic+summary.ithresh">summary.ithresh</a></code> to print the
best thresholds for each validation threshold.
</p>
<p>If <code>which_u = "all"</code> then <em>all</em> the thresholds are used to
perform prediction.  The inferences from each threshold are weighted
according to the <em>posterior threshold weights</em> given in
equation (15) of Northrop et al. (2017) based on the prior probabilities
of thresholds in <code>u_prior</code> and column <code>which_v</code> of the measures
of predictive performance in <code>object$pred_perf</code>.
</p>
<p>Otherwise, <code>which_u</code> is a numeric scalar that indicates which
element of <code>object$u_vec</code> the user wishes to select as a single
threshold on which to base prediction, that is, <code>which_u</code> must
be an integer in <code>1, ..., length(object$u_vec)</code>.</p>
</td></tr>
<tr><td><code id="predict.ithresh_+3A_which_v">which_v</code></td>
<td>
<p>A numeric scalar. Indicates which element of
<code>object$v_vec</code> is used in selecting a single threshold
(if <code>which_u = "best"</code>) or weighting the inferences from
all thresholds (if <code>which_u = "all"</code>).
Note: the default, <code>which_v = 1</code> gives the <em>lowest</em> of the
validation thresholds in <code>object$v_vec</code>.</p>
</td></tr>
<tr><td><code id="predict.ithresh_+3A_u_prior">u_prior</code></td>
<td>
<p>A numeric vector.  Prior probabilities for the training
thresholds in <code>object$u_vec</code>.  Only used if <code>which_u = "all"</code>.
</p>
<p>Only the first
<code>length(object$u_vec) - length(object$v_vec) + which_v</code>
elements of <code>u_prior</code> are used.  This is because only training
thresholds up to and including <code>object$v_vec[which_v]</code> are relevant.
<code>u_prior</code> must have length <code>length(object$u_vec)</code> or
<code>length(object$u_vec) - length(object$v_vec) + which_v</code>.
</p>
<p>If <code>u_prior</code> is not supplied then all (relevant) training thresholds
are given equal prior probability.
<code>u_prior</code> is normalized to have sum equal to 1 inside
<code>predict.ithresh</code>.</p>
</td></tr>
<tr><td><code id="predict.ithresh_+3A_type">type</code></td>
<td>
<p>A character vector.
Passed to <code><a href="revdbayes.html#topic+predict.evpost">predict.evpost</a></code>.
Indicates which type of inference is required:
</p>

<ul>
<li><p> &quot;p&quot; for the predictive distribution function,
</p>
</li>
<li><p> &quot;d&quot; for the predictive density function,
</p>
</li>
<li><p> &quot;q&quot; for the predictive quantile function,
</p>
</li>
<li><p> &quot;i&quot; for predictive intervals (see <code>...</code> to set <code>level</code>),
</p>
</li>
<li><p> &quot;r&quot; for random generation from the predictive distribution.
</p>
</li></ul>

<p>If <code>which_u = "all"</code> then only <code>type = "p"</code> or <code>type = "d"</code>
are allowed.</p>
</td></tr>
<tr><td><code id="predict.ithresh_+3A_hpd">hpd</code></td>
<td>
<p>A logical scalar.  The argument <code>hpd</code> of
<code><a href="revdbayes.html#topic+predict.evpost">predict.evpost</a></code>. Only relevant if
<code>type = "i"</code>.</p>
</td></tr>
<tr><td><code id="predict.ithresh_+3A_x">x</code></td>
<td>
<p>A numeric vector.  The argument <code>x</code> of
<code><a href="revdbayes.html#topic+predict.evpost">predict.evpost</a></code>.  In the current context this
must be a vector (not a matrix, as suggested by the documentation of
<code><a href="revdbayes.html#topic+predict.evpost">predict.evpost</a></code>).  If <code>x</code> is not supplied
then a default value is set within
<code><a href="revdbayes.html#topic+predict.evpost">predict.evpost</a></code>.</p>
</td></tr>
<tr><td><code id="predict.ithresh_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed to
<code><a href="revdbayes.html#topic+predict.evpost">predict.evpost</a></code>.  In particular:
<code>level</code>, which can be used to set (multiple) levels
for predictive intervals when <code>type = "i"</code>;
<code>lower_tail</code> (relevant when <code>type = "p"</code> or <code>"q"</code>) and
<code>log</code> (relevant when <code>type = "d"</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function <code><a href="revdbayes.html#topic+predict.evpost">predict.evpost</a></code> is used to
perform predictive based on the binomial-GP posterior sample generated
using a given training threshold.  For mathematical details of the
single threshold and multiple threshold cases see Sections 2.3 and 3 of
Northrop et al. (2017) respectively.
</p>


<h3>Value</h3>

<p>An list object of class <code>"ithreshpred"</code> with a similar
structure to an object of class <code>"evpred"</code> returned from
<code><a href="revdbayes.html#topic+predict.evpost">predict.evpost</a></code> is returned <em>invisibly</em>.
In addition, the object contains
<code>u_vec = object$u_vec</code> and <code>v_vec = object$v_vec</code>,
<code>which_v</code> and the index <code>best_u</code> in
<code>u_vec = object$u_vec</code> of the best training threshold based on
the value of <code>which_v</code>.
It also contains the value of the Box-Cox transformation parameter
<code>lambda</code>.  This will always be equal to 1 if <code>object</code> was
returned from <code>ithresh</code>.
</p>
<p>If <code>which_u = "all"</code> then
</p>

<ul>
<li><p> the list also contains the <em>posterior threshold weights</em>
in component <code>post_thresh_wts</code>
</p>
</li>
<li><p> the component <code>y</code> is a matrix with <code>length{x}</code> rows
and 1 + <code>length(object$u_vec) - length(object$v_vec) + which_v</code>
columns.  Column 1 contains the estimated predictive distribution
function (<code>type = "p"</code>) or density function (<code>type = "d"</code>)
obtained using a weighted average of the inferences over different
training thresholds.  The other columns contain the estimated
functions for each of the training thresholds in <code>u_vec</code>.
</p>
</li></ul>



<h3>References</h3>

<p>Northrop, P. J., Attalides, N. and Jonathan, P. (2017)
Cross-validatory extreme value threshold selection and uncertainty
with application to ocean storm severity.
<em>Journal of the Royal Statistical Society Series C: Applied
Statistics</em>, <strong>66</strong>(1), 93-120. <a href="https://doi.org/10.1111/rssc.12159">doi:10.1111/rssc.12159</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ithresh">ithresh</a></code> for threshold selection in the i.i.d. case
based on leave-one-out cross-validation.
</p>
<p><code><a href="#topic+plot.ithreshpred">plot.ithreshpred</a></code> for the S3 plot method for objects
of class <code>ithreshpred</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Note:
#'  In the examples below validation thresholds rather higher than is
#   advisable have been used, with far fewer excesses than the minimum of
#   50 suggested by Jonathan and Ewans (2013).

# Gulf of Mexico significant wave heights, default priors.
u_vec_gom &lt;- quantile(gom, probs = seq(0, 0.9, by = 0.05))
gom_cv &lt;- ithresh(data = gom, u_vec = u_vec_gom, n_v = 3)

# Note: gom_cv$npy contains the correct value of npy (it was set in the
#       call to ithresh, via attr(gom, "npy").
#       If object$npy doesn't exist then the argument npy must be supplied
#       in the call to predict().

### Best training threshold based on the lowest validation threshold

# Predictive distribution function
best_p &lt;- predict(gom_cv, n_years = c(100, 1000))
plot(best_p)

# Predictive density function
best_d &lt;- predict(gom_cv, type = "d", n_years = c(100, 1000))
plot(best_d)

# Predictive intervals
best_i &lt;- predict(gom_cv, n_years = c(100, 1000), type = "i", hpd = TRUE,
                  level = c(95, 99))
plot(best_i, which_int = "both")

# See which threshold was used
summary(gom_cv)

### All thresholds plus weighted average of inferences over all thresholds

# Predictive distribution function
all_p &lt;- predict(gom_cv, which_u = "all")
plot(all_p)

# Predictive density function
all_d &lt;- predict(gom_cv, which_u = "all", type = "d")
plot(all_d)
</code></pre>

<hr>
<h2 id='print.ithresh'>Print method for objects of class <code>"ithresh"</code></h2><span id='topic+print.ithresh'></span>

<h3>Description</h3>

<p><code>print</code> method for class <code>"ithresh"</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ithresh'
print(x, digits = 2, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.ithresh_+3A_x">x</code></td>
<td>
<p>an object inheriting from class <code>"ithresh"</code>, a result of a
call to <code><a href="#topic+ithresh">ithresh</a></code>.</p>
</td></tr>
<tr><td><code id="print.ithresh_+3A_digits">digits</code></td>
<td>
<p>An integer. Used for number formatting with
<code><a href="base.html#topic+format">format</a></code> and <code><a href="base.html#topic+Round">signif</a></code>.</p>
</td></tr>
<tr><td><code id="print.ithresh_+3A_...">...</code></td>
<td>
<p>Additional optional arguments. At present no optional
arguments are used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Prints a matrix of the estimated threshold weights.
Each row gives the weights for each training threshold for a given
validation threshold.  The row and column names are the approximate
quantile levels of the thresholds.
</p>


<h3>Value</h3>

<p>The argument <code>x</code>, invisibly, as for all
<code><a href="base.html#topic+print">print</a></code> methods.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ithresh">ithresh</a></code> for threshold selection in the i.i.d. case
based on leave-one-out cross-validation.
</p>
<p><code><a href="#topic+summary.ithresh">summary.ithresh</a></code> Summarizing measures of threshold
predictive performance.
</p>
<p><code><a href="#topic+plot.ithresh">plot.ithresh</a></code> for the S3 plot method for objects of
class <code>ithresh</code>.
</p>
<p><code><a href="#topic+predict.ithresh">predict.ithresh</a></code> for predictive inference for the
largest value observed in N years.
</p>

<hr>
<h2 id='stability'>Generalized Pareto parameter estimate stability</h2><span id='topic+stability'></span>

<h3>Description</h3>

<p>Uses maximum likelihood estimation to fit a Generalized Pareto (GP)
model to threshold excesses over a range of thresholds.
The threshold excesses are treated as independent and identically
distributed (i.i.d.) observations.
The resulting estimates and confidence intervals can be plotted,
using <code><a href="#topic+plot.stability">plot.stability</a></code>,
to produce a crude graphical diagnostic for threshold choice.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stability(
  data,
  u_vec,
  prof = FALSE,
  conf = 95,
  mult = 1:2,
  plot_prof = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stability_+3A_data">data</code></td>
<td>
<p>A numeric vector of observations.</p>
</td></tr>
<tr><td><code id="stability_+3A_u_vec">u_vec</code></td>
<td>
<p>A numeric vector of thresholds to be applied to the data.
Any duplicated values will be removed.  These could be set at sample
quantiles of <code>data</code> using <code><a href="stats.html#topic+quantile">quantile</a></code>.</p>
</td></tr>
<tr><td><code id="stability_+3A_prof">prof</code></td>
<td>
<p>A logical scalar.  Whether to calculate confidence intervals
for the GP shape parameter <code class="reqn">\xi</code> based on the profile-likelihood
for <code class="reqn">\xi</code> or using the MLE plus or minus a multiple of the estimated
standard error (SE) of the MLE.  The intervals produced by the former
may be better but they take longer to calculate.
Default: <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="stability_+3A_conf">conf</code></td>
<td>
<p>A numeric scalar in (0, 100).  Confidence level for the
confidence intervals.  Default: 95%.</p>
</td></tr>
<tr><td><code id="stability_+3A_mult">mult</code></td>
<td>
<p>A numeric vector of length 2.  The range of values over
which the profile log-likelihood for <code class="reqn">\xi</code> is calculated is
(MLE - <code>mult[1]</code> c SE, MLE + <code>mult[2]</code> c SE),
where MLE and SE are the MLE and estimated standard error of <code class="reqn">\xi</code>
and c is the constant for which this interval gives
an approximate 100<code>conf</code>% level confidence interval for <code class="reqn">\xi</code>
when <code>mult = c(1, 1)</code>.  The default, <code>mult = c(1, 2)</code>, works
well in most cases.  If the routine fails because the range of <code class="reqn">\xi</code>
is not sufficiently wide then the relevant components of <code>mult</code>
should be increased.</p>
</td></tr>
<tr><td><code id="stability_+3A_plot_prof">plot_prof</code></td>
<td>
<p>A logical scalar.  Only relevant if <code>prof = TRUE</code>.
If <code>plot_prof = TRUE</code> then the profile log-likelihood is plotted
for each threshold.  If <code>FALSE</code> then nothing is plotted.</p>
</td></tr>
<tr><td><code id="stability_+3A_...">...</code></td>
<td>
<p>Further (optional) arguments to be passed to the
<code><a href="stats.html#topic+optim">optim</a></code> function for the optimizations on which
the profile-likelihood for <code class="reqn">xi</code> is based.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For each threshold in <code>u_vec</code> a GP model is fitted by maximum
likelihood estimation to the threshold excesses, i.e. the amounts
by which the data exceed that threshold.  The MLEs of the GP shape
parameter <code class="reqn">\xi</code> and approximate <code>conf</code>% confidence intervals
for <code class="reqn">\xi</code> are stored for plotting (by <code><a href="#topic+plot.stability">plot.stability</a></code>)
to produce a simple graphical diagnostic to inform threshold selection.
This plot is used to choose a threshold above which the underlying GP
shape parameter may be approximately constant. See Chapter 4 of
Coles (2001).  See also the vignette &quot;Introducing threshr&quot;.
</p>


<h3>Value</h3>

<p>An object (list) of class <code>"stability"</code> with components:
</p>
<table>
<tr><td><code>ests</code></td>
<td>
<p>MLEs of the GP shape parameter <code class="reqn">\xi</code>.</p>
</td></tr>
<tr><td><code>ses</code></td>
<td>
<p>Estimated SEs of the MLEs of <code class="reqn">\xi</code>.</p>
</td></tr>
<tr><td><code>lower</code></td>
<td>
<p>Lower limit of 100<code>conf</code>% confidence intervals
for <code class="reqn">\xi</code>.</p>
</td></tr>
<tr><td><code>upper</code></td>
<td>
<p>Upper limit of 100<code>conf</code>% confidence intervals
for <code class="reqn">\xi</code>.</p>
</td></tr>
<tr><td><code>nexc</code></td>
<td>
<p>The number of threshold excesses.</p>
</td></tr>
<tr><td><code>u_vec</code></td>
<td>
<p>The thresholds supplied by the user.</p>
</td></tr>
<tr><td><code>u_ps</code></td>
<td>
<p>The approximate sample quantiles to which the thresholds
in <code>u_vec</code> correspond.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>The input <code>data</code>.</p>
</td></tr>
<tr><td><code>conf</code></td>
<td>
<p>The input <code>conf</code>.</p>
</td></tr>
</table>
<p>Each of these components is a numeric vector of length
<code>length(u_vec)</code>.
</p>


<h3>References</h3>

<p>Coles, S. G. (2001) <em>An Introduction to Statistical
Modeling of Extreme Values</em>, Springer-Verlag, London.
<a href="https://doi.org/10.1007/978-1-4471-3675-0_3">doi:10.1007/978-1-4471-3675-0_3</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ithresh">ithresh</a></code> for threshold selection in the i.i.d. case
based on leave-one-out cross-validation.
</p>
<p><code><a href="#topic+plot.stability">plot.stability</a></code> for the S3 <code>plot</code> method for
objects of class <code>stability</code>.
</p>
<p><code><a href="stats.html#topic+quantile">quantile</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Set a vector of thresholds
u_vec_gom &lt;- quantile(gom, probs = seq(0, 0.9, by = 0.05))

# Symmetric confidence intervals
gom_stab &lt;- stability(data = gom, u_vec = u_vec_gom)
plot(gom_stab)

# Profile-likelihood-based confidence intervals
gom_stab &lt;- stability(data = gom, u_vec = u_vec_gom, prof = TRUE)
plot(gom_stab)
</code></pre>

<hr>
<h2 id='summary.ithresh'>Summarizing measures of threshold predictive performance</h2><span id='topic+summary.ithresh'></span>

<h3>Description</h3>

<p><code>summary</code> method for class <code>"ithresh"</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ithresh'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.ithresh_+3A_object">object</code></td>
<td>
<p>an object of class <code>"ithresh"</code>, a result of a call to
<code>ithresh</code>.</p>
</td></tr>
<tr><td><code id="summary.ithresh_+3A_...">...</code></td>
<td>
<p>Additional optional arguments. At present no optional
arguments are used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a numeric matrix with 5 columns and <code>n_v</code> rows,
where <code>n_v</code> is an argument to <code><a href="#topic+ithresh">ithresh</a></code> that
determines how many of the largest training thresholds are used
a validation thresholds.  The columns contain:
</p>

<ul>
<li><p> column 1: the validation threshold v
</p>
</li>
<li><p> column 2: the sample quantile to which the validation threshold
corresponds
</p>
</li>
<li><p> column 3: the best training threshold u judged using the
validation threshold v
</p>
</li>
<li><p> column 4: the sample quantile to which the best training
threshold corresponds
</p>
</li>
<li><p> column 5: the index of the vector <code>u_vec</code> of training
thresholds to which the threshold in column2 corresponds
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+ithresh">ithresh</a></code> for threshold selection in the i.i.d. case
based on leave-one-out cross-validation.
</p>
<p><code><a href="#topic+plot.ithresh">plot.ithresh</a></code> for the S3 plot method for objects of
class <code>ithresh</code>.
</p>
<p><code><a href="#topic+print.ithresh">print.ithresh</a></code> Prints the threshold weights.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>u_vec_gom &lt;- quantile(gom, probs = seq(0, 0.9, by = 0.05))
gom_cv &lt;- ithresh(data = gom, u_vec = u_vec_gom, n_v = 3)
summary(gom_cv)
</code></pre>

<hr>
<h2 id='threshr-internal'>Internal threshr functions</h2><span id='topic+threshr-internal'></span><span id='topic+bc'></span><span id='topic+inv_bc'></span><span id='topic+yj'></span><span id='topic+inv_yj'></span>

<h3>Description</h3>

<p>Internal threshr functions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bc(x, lambda = 1, lambda_tol = 1/50, m = 4)

inv_bc(x, lambda = 1, lambda_tol = 1/50, m = 4)

yj(x, lambda = 1, lambda_tol = 1/50, m = 4)

inv_yj(x, lambda = 1, lambda_tol = 1/50, m = 4)
</code></pre>


<h3>Details</h3>

<p>These functions are not intended to be called by the user.
</p>

<hr>
<h2 id='threshr-package'>threshr: Threshold Selection and Uncertainty for Extreme Value Analysis</h2><span id='topic+threshr'></span><span id='topic+threshr-package'></span>

<h3>Description</h3>

<p>Provides functions for the selection of extreme value threshold.
At the moment only the simplest case, where the data can be treated as
independent identically distributed observations, is considered.
Future releases will tackle more general situations.
See the 'threshr' website for more information, documentation
and examples.
</p>


<h3>Details</h3>

<p>The main function in the threshr package is <code><a href="#topic+ithresh">ithresh</a></code>,
which uses leave-one-out cross-validation in a Bayesian setup to compare
the predictive ability resulting from the use of each of a user-supplied
set of thresholds.
</p>
<p>See <code>vignette("threshr-vignette", package = "threshr")</code> for an
overview of the package.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Paul J. Northrop <a href="mailto:p.northrop@ucl.ac.uk">p.northrop@ucl.ac.uk</a> [copyright holder]
</p>
<p>Authors:
</p>

<ul>
<li><p> Nicolas Attalides
</p>
</li></ul>



<h3>References</h3>

<p>Northrop, P. J. (2017). revdbayes: Ratio-of-Uniforms Sampling
for Bayesian Extreme Value Analysis. R package version 1.2.1.
<a href="https://cran.r-project.org/package=revdbayes">https://cran.r-project.org/package=revdbayes</a>.
</p>
<p>Northrop, P. J., Attalides, N. and Jonathan, P. (2017)
Cross-validatory extreme value threshold selection and uncertainty
with application to ocean storm severity.
<em>Journal of the Royal Statistical Society Series C: Applied
Statistics</em>, <strong>66</strong>(1), 93-120. <a href="https://doi.org/10.1111/rssc.12159">doi:10.1111/rssc.12159</a>
</p>


<h3>See Also</h3>

<p>The packages <code><a href="revdbayes.html#topic+revdbayes">revdbayes</a></code> and
<code><a href="rust.html#topic+rust">rust</a></code>.
</p>
<p><code><a href="#topic+ithresh">ithresh</a></code> for threshold selection in the i.i.d. case
based on leave-one-out cross-validation.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
