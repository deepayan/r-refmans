<!DOCTYPE html><html><head><title>Help for package nhdplusTools</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {nhdplusTools}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#add_plus_network_attributes'><p>Add NHDPlus Network Attributes to a provided network.</p></a></li>
<li><a href='#align_nhdplus_names'><p>Align NHD Dataset Names</p></a></li>
<li><a href='#calculate_arbolate_sum'><p>Calculate Arbolate Sum</p></a></li>
<li><a href='#calculate_total_drainage_area'><p>Total Drainage Area</p></a></li>
<li><a href='#disambiguate_flowline_indexes'><p>Disambiguate Flowline Indexes</p></a></li>
<li><a href='#discover_nhdplus_id'><p>Discover NHDPlus ID</p></a></li>
<li><a href='#discover_nldi_characteristics'><p>Discover Characteristics Metadata</p></a></li>
<li><a href='#download_nhd'><p>Download NHD</p></a></li>
<li><a href='#download_nhdplushr'><p>Download NHDPlus HiRes</p></a></li>
<li><a href='#download_nhdplusv2'><p>Download seamless National Hydrography Dataset Version 2 (NHDPlusV2)</p></a></li>
<li><a href='#download_rf1'><p>Download the seamless Reach File (RF1) Database</p></a></li>
<li><a href='#download_vaa'><p>Download NHDPlusVAA data from HydroShare</p></a></li>
<li><a href='#download_wbd'><p>Download the seamless Watershed Boundary Dataset (WBD)</p></a></li>
<li><a href='#get_boundaries'><p>Return RPU or VPU boundaries</p></a></li>
<li><a href='#get_catchment_characteristics'><p>Get Catchment Characteristics</p></a></li>
<li><a href='#get_characteristics_metadata'><p>Get catchment characteristics metadata table</p></a></li>
<li><a href='#get_DD'><p>Navigate Downstream with Diversions</p></a></li>
<li><a href='#get_DM'><p>Navigate Downstream Mainstem</p></a></li>
<li><a href='#get_elev_along_path'><p>Get Elevation Along Path (experimental)</p></a></li>
<li><a href='#get_flowline_index'><p>Get Flowline Index</p></a></li>
<li><a href='#get_gagesII'><p>Find gagesII Features</p></a></li>
<li><a href='#get_hr_data'><p>Get NHDPlus HiRes Data</p></a></li>
<li><a href='#get_huc'><p>Find WBD HUC 12 unit subsets</p></a></li>
<li><a href='#get_huc12'><p>Find WBD HUC 12 unit subsets (DEPRECATED)</p></a></li>
<li><a href='#get_huc8'><p>Find WBD HUC 08 unit subsets (DEPRECATED)</p></a></li>
<li><a href='#get_levelpaths'><p>Get Level Paths (DEPRECATED)</p></a></li>
<li><a href='#get_nhdarea'><p>Find NHD Areas</p></a></li>
<li><a href='#get_nhdplus'><p>Get National Hydrography Dataset V2 Subsets (Multirealization)</p></a></li>
<li><a href='#get_nhdplushr'><p>Get NHDPlus HiRes</p></a></li>
<li><a href='#get_nldi_basin'><p>Get NLDI Basin Boundary</p></a></li>
<li><a href='#get_nldi_characteristics'><p>Get Catchment Characteristics</p></a></li>
<li><a href='#get_nldi_feature'><p>Get NLDI Feature</p></a></li>
<li><a href='#get_nldi_index'><p>Get NLDI Index</p></a></li>
<li><a href='#get_nwis'><p>Discover USGS NWIS Stream Gages</p></a></li>
<li><a href='#get_path_lengths'><p>Get Path Lengths (DEPRECATED)</p></a></li>
<li><a href='#get_path_members'><p>Get Path Members (DEPRECATED)</p></a></li>
<li><a href='#get_pathlength'><p>Get Path Length</p></a></li>
<li><a href='#get_pfaf'><p>Get Pfafstetter Codes (DEPRECATED)</p></a></li>
<li><a href='#get_raindrop_trace'><p>Get Raindrop Trace</p></a></li>
<li><a href='#get_sorted'><p>Get Sorted Network</p></a></li>
<li><a href='#get_split_catchment'><p>Get split catchment</p></a></li>
<li><a href='#get_streamlevel'><p>Get Streamlevel</p></a></li>
<li><a href='#get_streamorder'><p>Get Streamorder</p></a></li>
<li><a href='#get_terminal'><p>Get Terminal ID (DEPRECATED)</p></a></li>
<li><a href='#get_tocomid'><p>Get tocomid</p></a></li>
<li><a href='#get_UM'><p>Navigate Upstream Mainstem</p></a></li>
<li><a href='#get_UT'><p>Navigate Upstream with Tributaries</p></a></li>
<li><a href='#get_vaa'><p>NHDPlusV2 Attribute Subset</p></a></li>
<li><a href='#get_vaa_names'><p>Available NHDPlusV2 Attributes</p></a></li>
<li><a href='#get_vaa_path'><p>File path to value added attribute (vaa) Cache</p></a></li>
<li><a href='#get_waterbodies'><p>Find NHD Water Bodies</p></a></li>
<li><a href='#get_waterbody_index'><p>Get Waterbody Index</p></a></li>
<li><a href='#get_wb_outlet'><p>Get Waterbody Outlet</p></a></li>
<li><a href='#get_xs_point'><p>Get Cross Section From Point (experimental)</p></a></li>
<li><a href='#get_xs_points'><p>Get Cross Section Endpoints (experimental)</p></a></li>
<li><a href='#make_node_topology'><p>get node topology from edge topology (DEPRECATED)</p></a></li>
<li><a href='#make_standalone'><p>Make isolated NHDPlusHR region a standalone dataset</p></a></li>
<li><a href='#map_nhdplus'><p>Make Interactive Map of NHDPlus</p></a></li>
<li><a href='#navigate_network'><p>Navigate Network</p></a></li>
<li><a href='#navigate_nldi'><p>Navigate NLDI</p></a></li>
<li><a href='#nhdplus_path'><p>NHDPlus Data Path</p></a></li>
<li><a href='#nhdplusTools_data_dir'><p>Get or set nhdplusTools data directory</p></a></li>
<li><a href='#plot_nhdplus'><p>Plot NHDPlus</p></a></li>
<li><a href='#prepare_nhdplus'><p>Prep NHDPlus Data</p></a></li>
<li><a href='#query_usgs_geoserver'><p>Query USGS Geoserver</p></a></li>
<li><a href='#reexports'><p>Objects exported from other packages</p></a></li>
<li><a href='#rescale_catchment_characteristics'><p>Rescale Catchment Characteristics</p></a></li>
<li><a href='#rpu_boundaries'><p>RPU Boundaries</p>
Raster Processing Unit boundaries</a></li>
<li><a href='#subset_nhdplus'><p>Subset NHDPlus</p></a></li>
<li><a href='#subset_rpu'><p>Subset by Raster Processing Unit</p></a></li>
<li><a href='#subset_vpu'><p>Subset by Vector Processing Unit</p></a></li>
<li><a href='#vpu_boundaries'><p>VPU Boundaries</p>
Vector Processing Unit boundaries</a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>NHDPlus Tools</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Tools for traversing and working with National Hydrography Dataset Plus (NHDPlus) data. All methods implemented in 'nhdplusTools' are available in the NHDPlus documentation available from the US Environmental Protection Agency <a href="https://www.epa.gov/waterdata/basic-information">https://www.epa.gov/waterdata/basic-information</a>.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://doi-usgs.github.io/nhdplusTools/">https://doi-usgs.github.io/nhdplusTools/</a>
<a href="https://github.com/doi-usgs/nhdplusTools/">https://github.com/doi-usgs/nhdplusTools/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/doi-usgs/nhdplusTools/issues/">https://github.com/doi-usgs/nhdplusTools/issues/</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>hydroloom, dataRetrieval, dplyr, sf, units, magrittr,
jsonlite, httr, xml2, R.utils, utils, tidyr, methods, maptiles,
mapsf, fst, arrow, tools, zip, pbapply</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, knitr, rmarkdown, ggmap, ggplot2, lwgeom, gifski,
leaflet, httptest, future</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://creativecommons.org/publicdomain/zero/1.0/legalcode">CC0</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/parallel:</td>
<td>true</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-02 02:12:55 UTC; dblodgett</td>
</tr>
<tr>
<td>Author:</td>
<td>David Blodgett <a href="https://orcid.org/0000-0001-9489-1710"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Mike Johnson <a href="https://orcid.org/0000-0002-5288-8350"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Marc Weber <a href="https://orcid.org/0000-0002-9742-4744"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [ctb],
  Josh Erickson [ctb],
  Lauren Koenig <a href="https://orcid.org/0000-0002-7790-330X"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>David Blodgett &lt;dblodgett@usgs.gov&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-02 14:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='add_plus_network_attributes'>Add NHDPlus Network Attributes to a provided network.</h2><span id='topic+add_plus_network_attributes'></span>

<h3>Description</h3>

<p>Given a river network with required base attributes, adds the
NHDPlus network attributes: hydrosequence, levelpath, terminalpath, pathlength,
down levelpath, down hydroseq, total drainage area, and terminalflag.
The function implements two parallelization schemes for small and large basins
respectively. If a number of cores is specified, parallel execution will be used.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_plus_network_attributes(
  net,
  override = 5,
  cores = NULL,
  split_temp = NULL,
  status = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="add_plus_network_attributes_+3A_net">net</code></td>
<td>
<p>data.frame containing comid, tocomid, nameID, lengthkm, and areasqkm.
Additional attributes will be passed through unchanged.
tocomid == 0 is the convention used for outlets.
If a &quot;weight&quot; column is provided, it will be used in <a href="#topic+get_levelpaths">get_levelpaths</a>
otherwise, arbolate sum is calculated for the network and used as the weight.</p>
</td></tr>
<tr><td><code id="add_plus_network_attributes_+3A_override">override</code></td>
<td>
<p>numeric factor to be passed to <a href="#topic+get_levelpaths">get_levelpaths</a></p>
</td></tr>
<tr><td><code id="add_plus_network_attributes_+3A_cores">cores</code></td>
<td>
<p>integer number of processes to spawn if run in parallel.</p>
</td></tr>
<tr><td><code id="add_plus_network_attributes_+3A_split_temp">split_temp</code></td>
<td>
<p>character path to optional temporary copy of the network
split into independent sub-networks. If it exists, it will be read from disk
rather than recreated.</p>
</td></tr>
<tr><td><code id="add_plus_network_attributes_+3A_status">status</code></td>
<td>
<p>logical should progress be printed?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame with added attributes
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
source(system.file("extdata", "walker_data.R", package = "nhdplusTools"))

test_flowline &lt;- prepare_nhdplus(walker_flowline, 0, 0, FALSE)

test_flowline &lt;- data.frame(
  comid = test_flowline$COMID,
  tocomid = test_flowline$toCOMID,
  nameID = walker_flowline$GNIS_ID,
  lengthkm = test_flowline$LENGTHKM,
  areasqkm = walker_flowline$AreaSqKM)

add_plus_network_attributes(test_flowline)
</code></pre>

<hr>
<h2 id='align_nhdplus_names'>Align NHD Dataset Names</h2><span id='topic+align_nhdplus_names'></span>

<h3>Description</h3>

<p>this function takes any NHDPlus dataset and aligns the attribute names with those used in nhdplusTools.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>align_nhdplus_names(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="align_nhdplus_names_+3A_x">x</code></td>
<td>
<p>a <code>sf</code> object of nhdplus flowlines</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame renamed <code>sf</code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>source(system.file("extdata/new_hope_data.R", package = "nhdplusTools"))

names(new_hope_flowline)

names(new_hope_flowline) &lt;- tolower(names(new_hope_flowline))

new_hope_flowline &lt;- align_nhdplus_names(new_hope_flowline)

names(new_hope_flowline)

</code></pre>

<hr>
<h2 id='calculate_arbolate_sum'>Calculate Arbolate Sum</h2><span id='topic+calculate_arbolate_sum'></span>

<h3>Description</h3>

<p>Calculates arbolate sum given a dendritic
network and incremental lengths. Arbolate sum is the total length
of all upstream flowlines.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_arbolate_sum(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calculate_arbolate_sum_+3A_x">x</code></td>
<td>
<p>data.frame with ID, toID, and length columns.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>numeric with arbolate sum.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
source(system.file("extdata", "walker_data.R", package = "nhdplusTools"))
catchment_length &lt;- select(walker_flowline, COMID, AreaSqKM) %&gt;%
  right_join(prepare_nhdplus(walker_flowline, 0, 0,
                            purge_non_dendritic = FALSE, warn = FALSE), by = "COMID") %&gt;%
  select(ID = COMID, toID = toCOMID, length = LENGTHKM)

arb_sum &lt;- calculate_arbolate_sum(catchment_length)

catchment_length$arb_sum &lt;- arb_sum
catchment_length$nhd_arb_sum &lt;- walker_flowline$ArbolateSu

mean(abs(catchment_length$arb_sum - catchment_length$nhd_arb_sum))
max(abs(catchment_length$arb_sum - catchment_length$nhd_arb_sum))

</code></pre>

<hr>
<h2 id='calculate_total_drainage_area'>Total Drainage Area</h2><span id='topic+calculate_total_drainage_area'></span>

<h3>Description</h3>

<p>Calculates total drainage area given a dendritic
network and incremental areas.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_total_drainage_area(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calculate_total_drainage_area_+3A_x">x</code></td>
<td>
<p>data.frame with ID, toID, and area columns.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>numeric with total area.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
source(system.file("extdata", "walker_data.R", package = "nhdplusTools"))
catchment_area &lt;- select(walker_flowline, COMID, AreaSqKM) %&gt;%
  right_join(prepare_nhdplus(walker_flowline, 0, 0,
                            purge_non_dendritic = FALSE, warn = FALSE), by = "COMID") %&gt;%
  select(ID = COMID, toID = toCOMID, area = AreaSqKM)

new_da &lt;- calculate_total_drainage_area(catchment_area)

catchment_area$totda &lt;- new_da
catchment_area$nhdptotda &lt;- walker_flowline$TotDASqKM

mean(abs(catchment_area$totda - catchment_area$nhdptotda))
max(abs(catchment_area$totda - catchment_area$nhdptotda))

</code></pre>

<hr>
<h2 id='disambiguate_flowline_indexes'>Disambiguate Flowline Indexes</h2><span id='topic+disambiguate_flowline_indexes'></span>

<h3>Description</h3>

<p>Given a set of flowline indexes and numeric or ascii criteria,
return closest match. If numeric criteria are used, the minimum difference
in the numeric attribute is used for disambiguation. If ascii criteria are used,
the <a href="utils.html#topic+adist">adist</a> function is used with the following algorithm:
'1 - adist_score / max_string_length'. Comparisons ignore case.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>disambiguate_flowline_indexes(indexes, flowpath, hydro_location)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="disambiguate_flowline_indexes_+3A_indexes">indexes</code></td>
<td>
<p>data.frame as output from <a href="#topic+get_flowline_index">get_flowline_index</a> with more than
one hydrologic location per indexed point.</p>
</td></tr>
<tr><td><code id="disambiguate_flowline_indexes_+3A_flowpath">flowpath</code></td>
<td>
<p>data.frame with two columns. The first should join to the COMID
field of the indexes and the second should be the numeric or ascii metric such as drainage
area or GNIS Name. Names of this data.frame are not used.</p>
</td></tr>
<tr><td><code id="disambiguate_flowline_indexes_+3A_hydro_location">hydro_location</code></td>
<td>
<p>data.frame with two columns. The first should join to the
id field of the indexes and the second should be the numeric or ascii metric such as drainage
area or GNIS Name.. Names of this data,frame are not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame indexes deduplicated according to the minimum difference
between the values in the metric columns. If two or more result in the same &quot;minimum&quot;
value, duplicates will be returned.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>source(system.file("extdata", "sample_flines.R", package = "nhdplusTools"))

hydro_location &lt;- sf::st_sf(id = c(1, 2, 3),
                            geom = sf::st_sfc(list(sf::st_point(c(-76.86934, 39.49328)),
                                                   sf::st_point(c(-76.91711, 39.40884)),
                                                   sf::st_point(c(-76.88081, 39.36354))),
                                              crs = 4326),
                            totda = c(23.6, 7.3, 427.9),
                            nameid = c("Patapsco", "", "Falls Run River"))

flowpath &lt;- dplyr::select(sample_flines,
                          comid = COMID,
                          totda = TotDASqKM,
                          nameid = GNIS_NAME,
                          REACHCODE,
                          ToMeas,
                          FromMeas)

indexes &lt;- get_flowline_index(flowpath,
                              hydro_location,
                              search_radius = 0.2,
                              max_matches = 10)

disambiguate_flowline_indexes(indexes,
                              dplyr::select(flowpath, comid, totda),
                              dplyr::select(hydro_location, id, totda))

result &lt;- disambiguate_flowline_indexes(indexes,
                                        dplyr::select(flowpath, comid, nameid),
                                        dplyr::select(hydro_location, id, nameid))

result[result$id == 1, ]

result[result$id == 2, ]

result[result$id == 3, ]

</code></pre>

<hr>
<h2 id='discover_nhdplus_id'>Discover NHDPlus ID</h2><span id='topic+discover_nhdplus_id'></span>

<h3>Description</h3>

<p>Multipurpose function to find a COMID of interest.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>discover_nhdplus_id(point = NULL, nldi_feature = NULL, raindrop = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="discover_nhdplus_id_+3A_point">point</code></td>
<td>
<p>sfc POINT including crs as created by:
<code>sf::st_sfc(sf::st_point(.. ,..), crs)</code></p>
</td></tr>
<tr><td><code id="discover_nhdplus_id_+3A_nldi_feature">nldi_feature</code></td>
<td>
<p>list with names 'featureSource' and 'featureID' where
'featureSource' is derived from the &quot;source&quot; column of  the response of
<a href="dataRetrieval.html#topic+get_nldi_sources">get_nldi_sources</a> and the 'featureSource' is a known identifier
from the specified 'featureSource'.</p>
</td></tr>
<tr><td><code id="discover_nhdplus_id_+3A_raindrop">raindrop</code></td>
<td>
<p>logical if <code>TRUE</code> will call a raindrop trace web service and
return will be the same as <a href="#topic+get_raindrop_trace">get_raindrop_trace</a> with direction &quot;none&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>integer COMID or list containing COMID and raindrop trace.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
point &lt;- sf::st_sfc(sf::st_point(c(-76.874, 39.482)), crs = 4326)
discover_nhdplus_id(point)

discover_nhdplus_id(point, raindrop = TRUE)

nldi_nwis &lt;- list(featureSource = "nwissite", featureID = "USGS-08279500")
discover_nhdplus_id(nldi_feature = nldi_nwis)


</code></pre>

<hr>
<h2 id='discover_nldi_characteristics'>Discover Characteristics Metadata</h2><span id='topic+discover_nldi_characteristics'></span>

<h3>Description</h3>

<p>Provides access to metadata for characteristics that are returned by 'get_nldi_characteristics()'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>discover_nldi_characteristics(type = "all")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="discover_nldi_characteristics_+3A_type">type</code></td>
<td>
<p>character &quot;all&quot;, &quot;local&quot;, &quot;total&quot;, or &quot;divergence_routed&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame containing available characteristics
</p>


<h3>Examples</h3>

<pre><code class='language-R'>chars &lt;- discover_nldi_characteristics()
names(chars)
head(chars$local, 10)
</code></pre>

<hr>
<h2 id='download_nhd'>Download NHD</h2><span id='topic+download_nhd'></span>

<h3>Description</h3>

<p>Download NHD
</p>


<h3>Usage</h3>

<pre><code class='language-R'>download_nhd(nhd_dir, hu_list, download_files = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="download_nhd_+3A_nhd_dir">nhd_dir</code></td>
<td>
<p>character directory to save output into</p>
</td></tr>
<tr><td><code id="download_nhd_+3A_hu_list">hu_list</code></td>
<td>
<p>character vector of hydrologic region(s) to download.
Use <a href="#topic+get_huc">get_huc</a> to find HU codes of interest. Accepts two digit
and four digit codes.</p>
</td></tr>
<tr><td><code id="download_nhd_+3A_download_files">download_files</code></td>
<td>
<p>boolean if FALSE, only URLs to files will be returned
can be hu02s and/or hu04s</p>
</td></tr>
</table>


<h3>Value</h3>

<p>character Paths to geodatabases created.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
hu &lt;- get_huc(sf::st_sfc(sf::st_point(c(-73, 42)), crs = 4326),
                            type = "huc08")

(hu &lt;- substr(hu$huc8, 1, 2))

download_nhd(tempdir(), c(hu, "0203"), download_files = FALSE)

</code></pre>

<hr>
<h2 id='download_nhdplushr'>Download NHDPlus HiRes</h2><span id='topic+download_nhdplushr'></span>

<h3>Description</h3>

<p>Download NHDPlus HiRes
</p>


<h3>Usage</h3>

<pre><code class='language-R'>download_nhdplushr(nhd_dir, hu_list, download_files = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="download_nhdplushr_+3A_nhd_dir">nhd_dir</code></td>
<td>
<p>character directory to save output into</p>
</td></tr>
<tr><td><code id="download_nhdplushr_+3A_hu_list">hu_list</code></td>
<td>
<p>character vector of hydrologic region(s) to download.
Use <a href="#topic+get_huc">get_huc</a> to find HU codes of interest. Accepts two digit
and four digit codes.</p>
</td></tr>
<tr><td><code id="download_nhdplushr_+3A_download_files">download_files</code></td>
<td>
<p>boolean if FALSE, only URLs to files will be returned
can be hu02s and/or hu04s</p>
</td></tr>
</table>


<h3>Value</h3>

<p>character Paths to geodatabases created.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
hu &lt;- get_huc(sf::st_sfc(sf::st_point(c(-73, 42)), crs = 4326),
                            type = "huc08")

(hu &lt;- substr(hu$huc8, 1, 2))

download_nhdplushr(tempdir(), c(hu, "0203"), download_files = FALSE)

</code></pre>

<hr>
<h2 id='download_nhdplusv2'>Download seamless National Hydrography Dataset Version 2 (NHDPlusV2)</h2><span id='topic+download_nhdplusv2'></span>

<h3>Description</h3>

<p>This function downloads and decompresses staged seamless NHDPlusV2 data.
The following requirements are needed: p7zip (MacOS), 7zip (windows) Please see:
https://www.epa.gov/waterdata/get-nhdplus-national-hydrography-dataset-plus-data
for more information and metadata about this data.
</p>
<p>Default downloads lower-48 only. See examples for islands. No Alaska data
are available.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>download_nhdplusv2(
  outdir,
  url = paste0("https://edap-ow-data-commons.s3.amazonaws.com/NHDPlusV21/",
    "Data/NationalData/NHDPlusV21_NationalData_Seamless", "_Geodatabase_Lower48_07.7z"),
  progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="download_nhdplusv2_+3A_outdir">outdir</code></td>
<td>
<p>The folder path where data should be downloaded and extracted</p>
</td></tr>
<tr><td><code id="download_nhdplusv2_+3A_url">url</code></td>
<td>
<p>the location of the online resource</p>
</td></tr>
<tr><td><code id="download_nhdplusv2_+3A_progress">progress</code></td>
<td>
<p>boolean display download progress?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>character path to the local geodatabase
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  download_nhdplusV2("./data/nhd/")

  download_nhdplusv2(outdir = "./inst/",
      url = paste0("https://edap-ow-data-commons.s3.amazonaws.com/NHDPlusV21/",
                   "Data/NationalData/NHDPlusV21_NationalData_Seamless",
                   "_Geodatabase_HI_PR_VI_PI_03.7z"))

## End(Not run)
</code></pre>

<hr>
<h2 id='download_rf1'>Download the seamless Reach File (RF1) Database</h2><span id='topic+download_rf1'></span>

<h3>Description</h3>

<p>This function downloads and decompresses staged RF1 data.
See: https://water.usgs.gov/GIS/metadata/usgswrd/XML/erf1_2.xml for metadata.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>download_rf1(
  outdir,
  url = "https://water.usgs.gov/GIS/dsdl/erf1_2.e00.gz",
  progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="download_rf1_+3A_outdir">outdir</code></td>
<td>
<p>The folder path where data should be downloaded and extracted</p>
</td></tr>
<tr><td><code id="download_rf1_+3A_url">url</code></td>
<td>
<p>the location of the online resource</p>
</td></tr>
<tr><td><code id="download_rf1_+3A_progress">progress</code></td>
<td>
<p>boolean display download progress?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>character path to the local e00 file
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  download_wbd("./data/rf1/")

## End(Not run)
</code></pre>

<hr>
<h2 id='download_vaa'>Download NHDPlusVAA data from HydroShare</h2><span id='topic+download_vaa'></span>

<h3>Description</h3>

<p>downloads and caches NHDPlusVAA data on your computer
</p>


<h3>Usage</h3>

<pre><code class='language-R'>download_vaa(
  path = get_vaa_path(updated_network),
  force = FALSE,
  updated_network = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="download_vaa_+3A_path">path</code></td>
<td>
<p>character path where the file should be saved. Default is a
persistent system data as retrieved by <a href="#topic+nhdplusTools_data_dir">nhdplusTools_data_dir</a>.
Also see: <a href="#topic+get_vaa_path">get_vaa_path</a></p>
</td></tr>
<tr><td><code id="download_vaa_+3A_force">force</code></td>
<td>
<p>logical. Force data re-download. Default = FALSE</p>
</td></tr>
<tr><td><code id="download_vaa_+3A_updated_network">updated_network</code></td>
<td>
<p>logical default FALSE. If TRUE, updated network attributes
from E2NHD and National Water Model retrieved from
<a href="https://doi.org/10.5066/P976XCVT">doi:10.5066/P976XCVT</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The VAA data is a aggregate table of information from the NHDPlusV2
elevslope.dbf(s), PlusFlowlineVAA.dbf(s); and NHDFlowlines. All data
originates from the EPA NHDPlus Homepage
<a href="https://www.epa.gov/waterdata/get-nhdplus-national-hydrography-dataset-plus-data">here</a>.
To see the location of cached data on your machine use
<code><a href="#topic+get_vaa_path">get_vaa_path</a></code>.
To view aggregate data and documentation, see
<a href="https://www.hydroshare.org/resource/6092c8a62fac45be97a09bfd0b0bf726/">here</a>
</p>


<h3>Value</h3>

<p>character path to cached data
</p>

<hr>
<h2 id='download_wbd'>Download the seamless Watershed Boundary Dataset (WBD)</h2><span id='topic+download_wbd'></span>

<h3>Description</h3>

<p>This function downloads and decompresses staged seamless WBD data.
Please see:
https://prd-tnm.s3.amazonaws.com/StagedProducts/Hydrography/WBD/National/GDB/WBD_National_GDB.xml
for metadata.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>download_wbd(
  outdir,
  url = paste0("https://prd-tnm.s3.amazonaws.com/StagedProducts/",
    "Hydrography/WBD/National/GDB/WBD_National_GDB.zip"),
  progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="download_wbd_+3A_outdir">outdir</code></td>
<td>
<p>The folder path where data should be downloaded and extracted</p>
</td></tr>
<tr><td><code id="download_wbd_+3A_url">url</code></td>
<td>
<p>the location of the online resource</p>
</td></tr>
<tr><td><code id="download_wbd_+3A_progress">progress</code></td>
<td>
<p>boolean display download progress?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>character path to the local geodatabase
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  download_wbd("./data/wbd/")

## End(Not run)
</code></pre>

<hr>
<h2 id='get_boundaries'>Return RPU or VPU boundaries</h2><span id='topic+get_boundaries'></span>

<h3>Description</h3>

<p>Return RPU or VPU boundaries
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_boundaries(type = "vpu")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_boundaries_+3A_type">type</code></td>
<td>
<p>character. Either &quot;RPU&quot; or &quot;VPU&quot;</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>"sf"</code>
</p>

<hr>
<h2 id='get_catchment_characteristics'>Get Catchment Characteristics</h2><span id='topic+get_catchment_characteristics'></span>

<h3>Description</h3>

<p>Downloads (subsets of) catchment characteristics from a cloud data
store. See <a href="#topic+get_characteristics_metadata">get_characteristics_metadata</a> for available characteristics.
</p>
<p>Source:
Wieczorek, M.E., Jackson, S.E., and Schwarz, G.E., 2018, Select Attributes
for NHDPlus Version 2.1 Reach Catchments and Modified Network Routed Upstream
Watersheds for the Conterminous United States (ver. 3.0, January 2021): U.S.
Geological Survey data release, <a href="https://doi.org/10.5066/F7765D7V">doi:10.5066/F7765D7V</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_catchment_characteristics(varname, ids, reference_fabric = "nhdplusv2")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_catchment_characteristics_+3A_varname">varname</code></td>
<td>
<p>character vector of desired variables. If repeated varnames
are provided, they will be downloaded once but duplicated in the output.</p>
</td></tr>
<tr><td><code id="get_catchment_characteristics_+3A_ids">ids</code></td>
<td>
<p>numeric vector of identifiers (comids) from the specified fabric</p>
</td></tr>
<tr><td><code id="get_catchment_characteristics_+3A_reference_fabric">reference_fabric</code></td>
<td>
<p>(not used) will be used to allow future specification
of alternate reference fabrics</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
  get_catchment_characteristics("CAT_BFI", c(5329343, 5329427))

</code></pre>

<hr>
<h2 id='get_characteristics_metadata'>Get catchment characteristics metadata table</h2><span id='topic+get_characteristics_metadata'></span>

<h3>Description</h3>

<p>Download and cache table of catchment characteristics.
</p>
<p>Wieczorek, M.E., Jackson, S.E., and Schwarz, G.E., 2018, Select Attributes
for NHDPlus Version 2.1 Reach Catchments and Modified Network Routed Upstream
Watersheds for the Conterminous United States (ver. 3.0, January 2021): U.S.
Geological Survey data release, <a href="https://doi.org/10.5066/F7765D7V">doi:10.5066/F7765D7V</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_characteristics_metadata(search, cache = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_characteristics_metadata_+3A_search">search</code></td>
<td>
<p>character string of length 1 to free search the metadata table.
If no search term is provided the entire table is returned.</p>
</td></tr>
<tr><td><code id="get_characteristics_metadata_+3A_cache">cache</code></td>
<td>
<p>logical should cached metadata be used?</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>get_characteristics_metadata()
</code></pre>

<hr>
<h2 id='get_DD'>Navigate Downstream with Diversions</h2><span id='topic+get_DD'></span>

<h3>Description</h3>

<p>Traverse NHDPlus network downstream with diversions
NOTE: This algorithm may not scale well in large watersheds.
For reference, the lower Mississippi will take over a minute.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_DD(network, comid, distance = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_DD_+3A_network">network</code></td>
<td>
<p>data.frame NHDPlus flowlines including at a minimum:
COMID, DnMinorHyd, DnHydroseq, and Hydroseq.</p>
</td></tr>
<tr><td><code id="get_DD_+3A_comid">comid</code></td>
<td>
<p>integer identifier to start navigating from.</p>
</td></tr>
<tr><td><code id="get_DD_+3A_distance">distance</code></td>
<td>
<p>numeric distance in km to limit how many
COMIDs are returned.
The COMID that exceeds the distance specified is returned.
The longest of the diverted paths is used for limiting distance.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>integer vector of all COMIDs downstream of the starting COMID
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(sf)
start_COMID &lt;- 11688818

source(system.file("extdata", "sample_flines.R", package = "nhdplusTools"))

DD_COMIDs &lt;- get_DD(sample_flines, start_COMID, distance = 4)
plot(dplyr::filter(sample_flines, COMID %in% DD_COMIDs)$geom,
     col = "red", lwd = 2)

DM_COMIDs &lt;- get_DM(sample_flines, start_COMID, distance = 4)
plot(dplyr::filter(sample_flines, COMID %in% DM_COMIDs)$geom,
     col = "blue", add = TRUE, lwd = 2)

</code></pre>

<hr>
<h2 id='get_DM'>Navigate Downstream Mainstem</h2><span id='topic+get_DM'></span>

<h3>Description</h3>

<p>Traverse NHDPlus network downstream main stem
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_DM(network, comid, distance = NULL, sort = FALSE, include = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_DM_+3A_network">network</code></td>
<td>
<p>data.frame NHDPlus flowlines including at a minimum:
COMID, LENGTHKM, DnHydroseq, and Hydroseq.</p>
</td></tr>
<tr><td><code id="get_DM_+3A_comid">comid</code></td>
<td>
<p>integer identifier to start navigating from.</p>
</td></tr>
<tr><td><code id="get_DM_+3A_distance">distance</code></td>
<td>
<p>numeric distance in km to limit how many COMIDs are
returned. The COMID that exceeds the distance specified is returned.</p>
</td></tr>
<tr><td><code id="get_DM_+3A_sort">sort</code></td>
<td>
<p>if TRUE, the returned COMID vector will be sorted in order of distance from the input COMID (nearest to farthest)</p>
</td></tr>
<tr><td><code id="get_DM_+3A_include">include</code></td>
<td>
<p>if TRUE, the input COMID will be included in the returned COMID vector</p>
</td></tr>
</table>


<h3>Value</h3>

<p>integer vector of all COMIDs downstream of the starting COMID
along the mainstem
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(sf)

source(system.file("extdata", "sample_flines.R", package = "nhdplusTools"))

plot(sample_flines$geom)
start_COMID &lt;- 11690092
DM_COMIDs &lt;- get_DM(sample_flines, start_COMID)
plot(dplyr::filter(sample_flines, COMID %in% DM_COMIDs)$geom,
     col = "red", add = TRUE, lwd = 3)

DM_COMIDs &lt;- get_DM(sample_flines, start_COMID, distance = 40)
plot(dplyr::filter(sample_flines, COMID %in% DM_COMIDs)$geom,
     col = "blue", add = TRUE, lwd = 2)

</code></pre>

<hr>
<h2 id='get_elev_along_path'>Get Elevation Along Path (experimental)</h2><span id='topic+get_elev_along_path'></span>

<h3>Description</h3>

<p>Uses a cross section retrieval web services to retrieve elevation
along a path.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_elev_along_path(points, num_pts, res = 1, status = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_elev_along_path_+3A_points">points</code></td>
<td>
<p>sf data.frame containing a point column.</p>
</td></tr>
<tr><td><code id="get_elev_along_path_+3A_num_pts">num_pts</code></td>
<td>
<p>numeric number of points to retrieve along the cross section.</p>
</td></tr>
<tr><td><code id="get_elev_along_path_+3A_res">res</code></td>
<td>
<p>integer resolution of 3D Elevation Program data to request.
Must be on of: 1, 3, 5, 10, 30, 60.</p>
</td></tr>
<tr><td><code id="get_elev_along_path_+3A_status">status</code></td>
<td>
<p>logical</p>
</td></tr>
</table>


<h3>Value</h3>

<p>sf data.frame containing points retrieved. Names include
&quot;id&quot;, &quot;distance_m&quot;, &quot;elevation_m&quot;, &quot;spatial_ref&quot;, &quot;geometry&quot;,
and &quot;.group&quot;. .group tracks which input point each set of output
points belongs to.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
point1 &lt;- sf::st_sfc(sf::st_point(x = c(-105.9667, 36.17602)), crs = 4326)
point2 &lt;- sf::st_sfc(sf::st_point(x = c(-105.97768, 36.17526)), crs = 4326)
point3 &lt;- sf::st_sfc(sf::st_point(x = c(-105.98869, 36.17450)), crs = 4326)

points &lt;- sf::st_as_sf(c(point1, point2, point3))

(xs &lt;- get_elev_along_path(points, 100))

if(inherits(xs, "sf")) {

bbox &lt;- sf::st_bbox(xs) + c(-0.005, -0.005, 0.005, 0.005)

nhdplusTools::plot_nhdplus(bbox = bbox, cache_data = FALSE)

plot(sf::st_transform(sf::st_geometry(xs), 3857), pch = ".", add = TRUE, col = "red")
plot(sf::st_transform(sf::st_sfc(point1, crs = 4326), 3857), add = TRUE)
plot(sf::st_transform(sf::st_sfc(point2, crs = 4326), 3857), add = TRUE)
plot(sf::st_transform(sf::st_sfc(point3, crs = 4326), 3857), add = TRUE)

plot(xs$distance_m, xs$elevation_m)
}



</code></pre>

<hr>
<h2 id='get_flowline_index'>Get Flowline Index</h2><span id='topic+get_flowline_index'></span>

<h3>Description</h3>

<p>given an sf point geometry column, return COMID, reachcode,
and measure for each.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_flowline_index(
  flines,
  points,
  search_radius = NULL,
  precision = NA,
  max_matches = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_flowline_index_+3A_flines">flines</code></td>
<td>
<p>sf data.frame of type LINESTRING or MULTILINESTRING including
COMID, REACHCODE, ToMeas, and FromMeas. Can be &quot;download_nhdplusv2&quot; and remote
nhdplusv2 data will be downloaded for the bounding box surround the submitted points.
NOTE: The download option may not work for large areas, use with caution.</p>
</td></tr>
<tr><td><code id="get_flowline_index_+3A_points">points</code></td>
<td>
<p>sf or sfc of type POINT in analysis projection. NOTE: flines will
be projected to the projection of the points layer.</p>
</td></tr>
<tr><td><code id="get_flowline_index_+3A_search_radius">search_radius</code></td>
<td>
<p>units distance for the nearest neighbor search
to extend in analysis projection. If missing or NULL, and points are in a lon
lat projection, a default of 0.01 degree is used, otherwise 200 m is used.
Conversion to the linear unit used by the provided crs of points is attempted.
See RANN nn2 documentation for more details.</p>
</td></tr>
<tr><td><code id="get_flowline_index_+3A_precision">precision</code></td>
<td>
<p>numeric the resolution of measure precision in the output in meters.</p>
</td></tr>
<tr><td><code id="get_flowline_index_+3A_max_matches">max_matches</code></td>
<td>
<p>numeric the maximum number of matches to return if multiple are
found in search_radius</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note 1: Inputs are cast into LINESTRINGS. Because of this,
the measure output
of inputs that are true multipart lines may be in error.
</p>
<p>Note 2: This algorithm finds the nearest node in the input flowlines to
identify which flowline the point should belong to. As a second pass,
it can calculate the measure to greater precision than the nearest flowline
geometry node.
</p>
<p>Note 3: Offset is returned in units consistent with the projection of
the input points.
</p>
<p>Note 4: See 'dfMaxLength' input to sf::st_segmentize() for details of
handling of precision parameter.
</p>
<p>Note 5: &quot;from&quot; is downstream &ndash; 0 is the outlet &quot;to&quot; is upstream &ndash; 100 is the inlet
</p>


<h3>Value</h3>

<p>data.frame with five columns, id, COMID, REACHCODE, REACH_meas, and offset. id is the
row or list element in the point input.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

source(system.file("extdata", "sample_flines.R", package = "nhdplusTools"))

point &lt;- sf::st_sfc(sf::st_point(c(-76.87479, 39.48233)),
                    crs = 4326)

get_flowline_index(sample_flines, point)

point &lt;- sf::st_transform(point, 5070)

get_flowline_index(sample_flines, point,
                   search_radius = units::set_units(200, "m"))

get_flowline_index("download_nhdplusv2", point)

get_flowline_index(sample_flines, point, precision = 30)

get_flowline_index(sample_flines,
                   sf::st_sfc(list(sf::st_point(c(-76.86934, 39.49328)),
                                   sf::st_point(c(-76.91711, 39.40884)),
                                   sf::st_point(c(-76.88081, 39.36354))),
                              crs = 4326),
                   search_radius = units::set_units(0.2, "degrees"),
                   max_matches = 10)



</code></pre>

<hr>
<h2 id='get_gagesII'>Find gagesII Features</h2><span id='topic+get_gagesII'></span>

<h3>Description</h3>

<p>Subsets the gagesII dataset by location (POINT),
area (POLYGON), or set of IDs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_gagesII(AOI = NULL, id = NULL, t_srs = NULL, buffer = 0.5, basin = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_gagesII_+3A_aoi">AOI</code></td>
<td>
<p>sf (MULTI)POINT or (MULTI)POLYGON. An 'area of interest' can
be provided as either a location (sf POINT) or area (sf POLYGON)
in any Spatial Reference System.</p>
</td></tr>
<tr><td><code id="get_gagesII_+3A_id">id</code></td>
<td>
<p>character NWIS Gage ID(s)</p>
</td></tr>
<tr><td><code id="get_gagesII_+3A_t_srs">t_srs</code></td>
<td>
<p>character (PROJ string or EPSG code) or numeric (EPSG code).
A user specified - target -Spatial Reference System (SRS/CRS) for returned objects.
Will default to the CRS of the input AOI if provided, and to 4326 for ID requests.</p>
</td></tr>
<tr><td><code id="get_gagesII_+3A_buffer">buffer</code></td>
<td>
<p>numeric. The amount (in meters) to buffer a POINT AOI by for an
extended search. Default = 0.5</p>
</td></tr>
<tr><td><code id="get_gagesII_+3A_basin">basin</code></td>
<td>
<p>logical should the gagesII basin also be returned? If True,
return value will be a list with &quot;site&quot; and &quot;basin&quot; elements.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The returned object(s) will have the same
Spatial Reference System (SRS) as the input AOI. If a individual or set of
IDs are used to query, then the default geoserver CRS of EPSG:4326 is
preserved. In all cases, a user-defined SRS can be passed to <code>t_srs</code>
which will override all previous SRS (either input or default).
All buffer and distance operations are handled internally using in
EPSG:5070 Albers Equal Area projection
</p>


<h3>Value</h3>

<p>a simple features (sf) object
</p>

<hr>
<h2 id='get_hr_data'>Get NHDPlus HiRes Data</h2><span id='topic+get_hr_data'></span>

<h3>Description</h3>

<p>Use to remove unwanted detail NHDPlusHR data
See <a href="#topic+get_nhdplushr">get_nhdplushr</a> for examples.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_hr_data(
  gdb,
  layer = NULL,
  min_size_sqkm = NULL,
  simp = NULL,
  proj = NULL,
  rename = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_hr_data_+3A_gdb">gdb</code></td>
<td>
<p>character path to geodatabase to get data from.</p>
</td></tr>
<tr><td><code id="get_hr_data_+3A_layer">layer</code></td>
<td>
<p>character layer name from geodatabase found with <a href="sf.html#topic+st_layers">st_layers</a></p>
</td></tr>
<tr><td><code id="get_hr_data_+3A_min_size_sqkm">min_size_sqkm</code></td>
<td>
<p>numeric minimum basin size to be included in the output</p>
</td></tr>
<tr><td><code id="get_hr_data_+3A_simp">simp</code></td>
<td>
<p>numeric simplification tolerance in units of projection</p>
</td></tr>
<tr><td><code id="get_hr_data_+3A_proj">proj</code></td>
<td>
<p>a projection specification compatible with <a href="sf.html#topic+st_crs">st_crs</a></p>
</td></tr>
<tr><td><code id="get_hr_data_+3A_rename">rename</code></td>
<td>
<p>boolean if TRUE, nhdplusTools standard attribute values will
be applied.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>sf data.frame containing requested data
</p>

<hr>
<h2 id='get_huc'>Find WBD HUC 12 unit subsets</h2><span id='topic+get_huc'></span>

<h3>Description</h3>

<p>Subsets the WBD level 12 features by location (POINT),
area (POLYGON), or set of IDs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_huc(AOI = NULL, id = NULL, t_srs = NULL, buffer = 0.5, type = "huc12")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_huc_+3A_aoi">AOI</code></td>
<td>
<p>sf (MULTI)POINT or (MULTI)POLYGON. An 'area of interest' can
be provided as either a location (sf POINT) or area (sf POLYGON)
in any Spatial Reference System.</p>
</td></tr>
<tr><td><code id="get_huc_+3A_id">id</code></td>
<td>
<p>WBD HUC ID(s)</p>
</td></tr>
<tr><td><code id="get_huc_+3A_t_srs">t_srs</code></td>
<td>
<p>character (PROJ string or EPSG code) or numeric (EPSG code).
A user specified - target -Spatial Reference System (SRS/CRS) for returned objects.
Will default to the CRS of the input AOI if provided, and to 4326 for ID requests.</p>
</td></tr>
<tr><td><code id="get_huc_+3A_buffer">buffer</code></td>
<td>
<p>numeric. The amount (in meters) to buffer a POINT AOI by for an
extended search. Default = 0.5</p>
</td></tr>
<tr><td><code id="get_huc_+3A_type">type</code></td>
<td>
<p>character. Type of feature to return
('huc02', 'huc04', 'huc06', 'huc08', 'huc10', 'huc12').
See /linkdownload_nhdplusv2 for documentation of that dataset.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The returned object(s) will have the same
Spatial Reference System (SRS) as the input AOI. If a individual or set of
IDs are used to query, then the default geoserver CRS of EPSG:4326 is
preserved. In all cases, a user-defined SRS can be passed to <code>t_srs</code>
which will override all previous SRS (either input or default).
All buffer and distance operations are handled internally using in
EPSG:5070 Albers Equal Area projection
</p>


<h3>Value</h3>

<p>a simple features (sf) object
</p>

<hr>
<h2 id='get_huc12'>Find WBD HUC 12 unit subsets (DEPRECATED)</h2><span id='topic+get_huc12'></span>

<h3>Description</h3>

<p>Subsets the WBD level 12 features by location (POINT),
area (POLYGON), or set of IDs. Derived from a static snapshot of
HUC 12s from: &lt;doi:10.5066/P9BTKP3T&gt;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_huc12(AOI = NULL, id = NULL, t_srs = NULL, buffer = 0.5)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_huc12_+3A_aoi">AOI</code></td>
<td>
<p>sf (MULTI)POINT or (MULTI)POLYGON. An 'area of interest' can
be provided as either a location (sf POINT) or area (sf POLYGON)
in any Spatial Reference System.</p>
</td></tr>
<tr><td><code id="get_huc12_+3A_id">id</code></td>
<td>
<p>WBD HUC12 ID(s)
See /linkdownload_nhdplusv2 for documentation of that dataset.</p>
</td></tr>
<tr><td><code id="get_huc12_+3A_t_srs">t_srs</code></td>
<td>
<p>character (PROJ string or EPSG code) or numeric (EPSG code).
A user specified - target -Spatial Reference System (SRS/CRS) for returned objects.
Will default to the CRS of the input AOI if provided, and to 4326 for ID requests.</p>
</td></tr>
<tr><td><code id="get_huc12_+3A_buffer">buffer</code></td>
<td>
<p>numeric. The amount (in meters) to buffer a POINT AOI by for an
extended search. Default = 0.5</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The returned object(s) will have the same
Spatial Reference System (SRS) as the input AOI. If a individual or set of
IDs are used to query, then the default geoserver CRS of EPSG:4326 is
preserved. In all cases, a user-defined SRS can be passed to <code>t_srs</code>
which will override all previous SRS (either input or default).
All buffer and distance operations are handled internally using in
EPSG:5070 Albers Equal Area projection
</p>


<h3>Value</h3>

<p>a simple features (sf) object
</p>

<hr>
<h2 id='get_huc8'>Find WBD HUC 08 unit subsets (DEPRECATED)</h2><span id='topic+get_huc8'></span>

<h3>Description</h3>

<p>Subsets the WBD level 08 features by location (POINT),
area (POLYGON), or set of IDs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_huc8(AOI = NULL, id = NULL, t_srs = NULL, buffer = 0.5)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_huc8_+3A_aoi">AOI</code></td>
<td>
<p>sf (MULTI)POINT or (MULTI)POLYGON. An 'area of interest' can
be provided as either a location (sf POINT) or area (sf POLYGON)
in any Spatial Reference System.</p>
</td></tr>
<tr><td><code id="get_huc8_+3A_id">id</code></td>
<td>
<p>WBD HUC08 ID(s)</p>
</td></tr>
<tr><td><code id="get_huc8_+3A_t_srs">t_srs</code></td>
<td>
<p>character (PROJ string or EPSG code) or numeric (EPSG code).
A user specified - target -Spatial Reference System (SRS/CRS) for returned objects.
Will default to the CRS of the input AOI if provided, and to 4326 for ID requests.</p>
</td></tr>
<tr><td><code id="get_huc8_+3A_buffer">buffer</code></td>
<td>
<p>numeric. The amount (in meters) to buffer a POINT AOI by for an
extended search. Default = 0.5</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The returned object(s) will have the same
Spatial Reference System (SRS) as the input AOI. If a individual or set of
IDs are used to query, then the default geoserver CRS of EPSG:4326 is
preserved. In all cases, a user-defined SRS can be passed to <code>t_srs</code>
which will override all previous SRS (either input or default).
All buffer and distance operations are handled internally using in
EPSG:5070 Albers Equal Area projection
</p>


<h3>Value</h3>

<p>a simple features (sf) object
</p>

<hr>
<h2 id='get_levelpaths'>Get Level Paths (DEPRECATED)</h2><span id='topic+get_levelpaths'></span>

<h3>Description</h3>

<p>Calculates level paths using the stream-leveling approach of
NHD and NHDPlus. In addition to a levelpath identifier, a topological sort and
levelpath outlet identifier is provided in output. If arbolate sum is provided in
the weight column, this will match the behavior of NHDPlus. Any numeric value can be
included in this column and the largest value will be followed when no nameID is available.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_levelpaths(x, override_factor = NULL, status = FALSE, cores = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_levelpaths_+3A_x">x</code></td>
<td>
<p>data.frame with ID, toID, nameID, and weight columns.</p>
</td></tr>
<tr><td><code id="get_levelpaths_+3A_override_factor">override_factor</code></td>
<td>
<p>numeric factor to use to override nameID.
If 'weight' is 'numeric_factor' times larger on a path, it will be followed
regardless of the nameID indication.</p>
</td></tr>
<tr><td><code id="get_levelpaths_+3A_status">status</code></td>
<td>
<p>boolean if status updates should be printed.</p>
</td></tr>
<tr><td><code id="get_levelpaths_+3A_cores">cores</code></td>
<td>
<p>numeric number of cores to use in initial path ranking calculations.</p>
</td></tr>
</table>


<h3>Details</h3>


<ol>
<li><p> levelpath provides an identifier for the collection of flowlines
that make up the single mainstem flowpath of a total upstream aggregate catchment.
</p>
</li>
<li><p> outletID is the catchment ID (COMID in the case of NHDPlus) for the catchment
at the outlet of the levelpath the catchment is part of.
</p>
</li>
<li><p> topo_sort is similar to Hydroseq in NHDPlus in that large topo_sort values
are upstream of small topo_sort values. Note that there are many valid topological
sort orders of a directed graph.
</p>
</li></ol>



<h3>Value</h3>

<p>data.frame with ID, outletID, topo_sort, and levelpath columns.
See details for more info.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>source(system.file("extdata", "walker_data.R", package = "nhdplusTools"))

test_flowline &lt;- prepare_nhdplus(walker_flowline, 0, 0, FALSE)

test_flowline &lt;- data.frame(
  ID = test_flowline$COMID,
  toID = test_flowline$toCOMID,
  nameID = walker_flowline$GNIS_ID,
  weight = walker_flowline$ArbolateSu,
  stringsAsFactors = FALSE)

get_levelpaths(test_flowline)


</code></pre>

<hr>
<h2 id='get_nhdarea'>Find NHD Areas</h2><span id='topic+get_nhdarea'></span>

<h3>Description</h3>

<p>Subsets NHD Area features by location (POINT),
area (POLYGON), or set of IDs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_nhdarea(AOI = NULL, id = NULL, t_srs = NULL, buffer = 0.5)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_nhdarea_+3A_aoi">AOI</code></td>
<td>
<p>sf (MULTI)POINT or (MULTI)POLYGON. An 'area of interest' can
be provided as either a location (sf POINT) or area (sf POLYGON)
in any Spatial Reference System.</p>
</td></tr>
<tr><td><code id="get_nhdarea_+3A_id">id</code></td>
<td>
<p>NHD Area COMID(s)</p>
</td></tr>
<tr><td><code id="get_nhdarea_+3A_t_srs">t_srs</code></td>
<td>
<p>character (PROJ string or EPSG code) or numeric (EPSG code).
A user specified - target -Spatial Reference System (SRS/CRS) for returned objects.
Will default to the CRS of the input AOI if provided, and to 4326 for ID requests.</p>
</td></tr>
<tr><td><code id="get_nhdarea_+3A_buffer">buffer</code></td>
<td>
<p>numeric. The amount (in meters) to buffer a POINT AOI by for an
extended search. Default = 0.5</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The returned object(s) will have the same
Spatial Reference System (SRS) as the input AOI. If a individual or set of
IDs are used to query, then the default geoserver CRS of EPSG:4326 is
preserved. In all cases, a user-defined SRS can be passed to <code>t_srs</code>
which will override all previous SRS (either input or default).
All buffer and distance operations are handled internally using in
EPSG:5070 Albers Equal Area projection
</p>


<h3>Value</h3>

<p>a simple features (sf) object
</p>

<hr>
<h2 id='get_nhdplus'>Get National Hydrography Dataset V2 Subsets (Multirealization)</h2><span id='topic+get_nhdplus'></span>

<h3>Description</h3>

<p>Subsets NHDPlusV2 features by location (POINT), area (POLYGON),
or set of COMIDs. Multi realizations are supported allowing you to query
for flowlines, catchments, or outlets.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_nhdplus(
  AOI = NULL,
  comid = NULL,
  nwis = NULL,
  realization = "flowline",
  streamorder = NULL,
  t_srs = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_nhdplus_+3A_aoi">AOI</code></td>
<td>
<p>sf (MULTI)POINT or (MULTI)POLYGON. An 'area of interest' can
be provided as either a location (sf POINT) or area (sf POLYGON)
in any Spatial Reference System.</p>
</td></tr>
<tr><td><code id="get_nhdplus_+3A_comid">comid</code></td>
<td>
<p>numeric or character. Search for NHD features by COMID(s)</p>
</td></tr>
<tr><td><code id="get_nhdplus_+3A_nwis">nwis</code></td>
<td>
<p>numeric or character. Search for NHD features by
collocated NWIS identifiers</p>
</td></tr>
<tr><td><code id="get_nhdplus_+3A_realization">realization</code></td>
<td>
<p>character. What realization to return.
Default is flowline and options include: outlet, flowline, catchment,
and all</p>
</td></tr>
<tr><td><code id="get_nhdplus_+3A_streamorder">streamorder</code></td>
<td>
<p>numeric or character. Only return NHD flowlines with a
streamorder greater then or equal to this value
for input value and higher.
Only usable with AOI and flowline realizations.</p>
</td></tr>
<tr><td><code id="get_nhdplus_+3A_t_srs">t_srs</code></td>
<td>
<p>character (PROJ string or EPSG code) or numeric (EPSG code).
A user specified - target -Spatial Reference System (SRS/CRS) for returned objects.
Will default to the CRS of the input AOI if provided, and to 4326 for ID requests.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The returned object(s) will have the same
Spatial Reference System (SRS) as the input AOI. If a individual or set of
IDs are used to query, then the default geoserver CRS of EPSG:4326 is
preserved. In all cases, a user-defined SRS can be passed to <code>t_srs</code>
which will override all previous SRS (either input or default).
All buffer and distance operations are handled internally using in
EPSG:5070 Albers Equal Area projection
</p>


<h3>Value</h3>

<p>sfc a single, or list, of simple feature objects
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 point &lt;- sf::st_sfc(sf::st_point(c(-119.845, 34.4146)), crs = 4326)
 get_nhdplus(point)
 get_nhdplus(point, realization = "catchment")
 get_nhdplus(point, realization = "all")
 get_nhdplus(comid = 101)
 get_nhdplus(nwis  = c(11120000, 11120500))
 area &lt;- sf::st_as_sfc(sf::st_bbox(c(xmin = -119.8851, xmax =-119.8361,
 ymax = 34.42439, ymin = 34.40473), crs = 4326))
 get_nhdplus(area)
 get_nhdplus(area, realization = "flowline", streamorder = 3)
 
</code></pre>

<hr>
<h2 id='get_nhdplushr'>Get NHDPlus HiRes</h2><span id='topic+get_nhdplushr'></span>

<h3>Description</h3>

<p>Get NHDPlus HiRes
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_nhdplushr(
  hr_dir,
  out_gpkg = NULL,
  layers = c("NHDFlowline", "NHDPlusCatchment"),
  pattern = ".*GDB.gdb$",
  check_terminals = TRUE,
  overwrite = FALSE,
  keep_cols = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_nhdplushr_+3A_hr_dir">hr_dir</code></td>
<td>
<p>character directory with geodatabases (gdb search is recursive)</p>
</td></tr>
<tr><td><code id="get_nhdplushr_+3A_out_gpkg">out_gpkg</code></td>
<td>
<p>character path to write output geopackage</p>
</td></tr>
<tr><td><code id="get_nhdplushr_+3A_layers">layers</code></td>
<td>
<p>character vector with desired layers to return.
c(&quot;NHDFlowline&quot;, &quot;NHDPlusCatchment&quot;) is default.
Choose from:
c(&quot;NHDFlowline&quot;, &quot;NHDPlusCatchment&quot;, &quot;NHDWaterbody&quot;, &quot;NHDArea&quot;, &quot;NHDLine&quot;,
&quot;NHDPlusSink&quot;, &quot;NHDPlusWall&quot;, &quot;NHDPoint&quot;, &quot;NHDPlusBurnWaterbody&quot;,
&quot;NHDPlusBurnLineEvent&quot;, &quot;HYDRO_NET_Junctions&quot;,
&quot;WBDHU2&quot;, &quot;WBDHU4&quot;,&quot;WBDHU6&quot;, &quot;WBDHU8&quot; &quot;WBDHU10&quot;, &quot;WBDHU12&quot;, &quot;WBDLine&quot;)
Set to NULL to get all available.</p>
</td></tr>
<tr><td><code id="get_nhdplushr_+3A_pattern">pattern</code></td>
<td>
<p>character optional regex to select certain files in hr_dir</p>
</td></tr>
<tr><td><code id="get_nhdplushr_+3A_check_terminals">check_terminals</code></td>
<td>
<p>boolean if TRUE, run <a href="#topic+make_standalone">make_standalone</a> on output.</p>
</td></tr>
<tr><td><code id="get_nhdplushr_+3A_overwrite">overwrite</code></td>
<td>
<p>boolean should the output overwrite? If false and the output layer
exists, it will be read and returned so this function will always return data even
if called a second time for the same output. This is useful for workflows. Note that
this will NOT delete the entire Geopackage. It will overwrite on a per layer basis.</p>
</td></tr>
<tr><td><code id="get_nhdplushr_+3A_keep_cols">keep_cols</code></td>
<td>
<p>character vector of column names to keep in the output. If NULL,
all will be kept.</p>
</td></tr>
<tr><td><code id="get_nhdplushr_+3A_...">...</code></td>
<td>
<p>parameters passed along to <a href="#topic+get_hr_data">get_hr_data</a>
for &quot;NHDFlowline&quot; layers.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>NHDFlowline is joined to value added attributes prior to being
returned.
Names are not modified from the NHDPlusHR geodatabase.
Set layers to &quot;NULL&quot; to get all layers.
</p>


<h3>Value</h3>

<p>sf data.frames containing output that may also be written
to a geopackage for later use.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Note this will download a lot of data to a temp directory.
# Change 'temp_dir' to your directory of choice.
temp_dir &lt;- file.path(nhdplusTools_data_dir(), "temp_hr_cache")

download_dir &lt;- download_nhdplushr(temp_dir, c("0302", "0303"))

get_nhdplushr(download_dir, file.path(download_dir, "nhdplus_0302-03.gpkg"))

get_nhdplushr(download_dir,
              file.path(download_dir, "nhdplus_0302-03.gpkg"),
              layers = NULL, overwrite = TRUE)

get_nhdplushr(download_dir,
              file.path(download_dir, "nhdplus_0302-03.gpkg"),
              layers = "NHDFlowline", overwrite = TRUE,
              min_size_sqkm = 10, simp = 10, proj = "+init=epsg:5070")

# Cleanup
unlink(temp_dir, recursive = TRUE)


## End(Not run)
</code></pre>

<hr>
<h2 id='get_nldi_basin'>Get NLDI Basin Boundary</h2><span id='topic+get_nldi_basin'></span>

<h3>Description</h3>

<p>Get a basin boundary for a given NLDI feature.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_nldi_basin(nldi_feature, simplify = TRUE, split = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_nldi_basin_+3A_nldi_feature">nldi_feature</code></td>
<td>
<p>list with names 'featureSource' and 'featureID' where
'featureSource' is derived from the &quot;source&quot; column of  the response of
<a href="dataRetrieval.html#topic+get_nldi_sources">get_nldi_sources</a> and the 'featureID' is a known identifier
from the specified 'featureSource'.</p>
</td></tr>
<tr><td><code id="get_nldi_basin_+3A_simplify">simplify</code></td>
<td>
<p>logical should response geometry be simplified for
visualization and performance?</p>
</td></tr>
<tr><td><code id="get_nldi_basin_+3A_split">split</code></td>
<td>
<p>logical should response resolve precisely to the location
of the 'nldi_feature'? Setting 'TRUE' calls an additional service and
will be slower and less robust.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Only resolves to the nearest NHDPlus catchment divide. See:
https://waterdata.usgs.gov/blog/nldi-intro/ for more info on the nldi.
</p>


<h3>Value</h3>

<p>sf data.frame with result basin boundary
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(sf)
library(dplyr)

nldi_nwis &lt;- list(featureSource = "nwissite", featureID = "USGS-05428500")

site &lt;- get_nldi_feature(nldi_nwis)

basin &lt;- get_nldi_basin(nldi_feature = nldi_nwis)

plot(st_geometry(basin))

basin

basin2 &lt;- get_nldi_basin(nldi_feature = nldi_nwis,
                         simplify = FALSE, split = TRUE)

if(inherits(basin, "sf") &amp; inherits(basin2, "sf")) {

length(st_coordinates(basin))
length(st_coordinates(basin2))

plot(st_geometry(st_buffer(site, units::set_units(3000, "m"))), border = NA)

plot(st_geometry(site), add = TRUE)
plot(st_geometry(basin2), add = TRUE)

plot(st_geometry(basin), border = "red", add = TRUE)

}

</code></pre>

<hr>
<h2 id='get_nldi_characteristics'>Get Catchment Characteristics</h2><span id='topic+get_nldi_characteristics'></span>

<h3>Description</h3>

<p>Retrieves catchment characteristics from the Network Linked Data Index.
Metadata for these characteristics can be found using 'discover_nldi_characteristics()'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_nldi_characteristics(nldi_feature, type = "local")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_nldi_characteristics_+3A_nldi_feature">nldi_feature</code></td>
<td>
<p>list with names 'featureSource' and 'featureID' where
'featureSource' is derived from the &quot;source&quot; column of  the response of
<a href="dataRetrieval.html#topic+get_nldi_sources">get_nldi_sources</a> and the 'featureID' is a known identifier
from the specified 'featureSource'.</p>
</td></tr>
<tr><td><code id="get_nldi_characteristics_+3A_type">type</code></td>
<td>
<p>character &quot;all&quot;, &quot;local&quot;, &quot;total&quot;, or &quot;divergence_routed&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame containing requested characteristics
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
chars &lt;- get_nldi_characteristics(list(featureSource = "nwissite", featureID = "USGS-05429700"))
names(chars)
head(chars$local, 10)

</code></pre>

<hr>
<h2 id='get_nldi_feature'>Get NLDI Feature</h2><span id='topic+get_nldi_feature'></span>

<h3>Description</h3>

<p>Get a single feature from the NLDI
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_nldi_feature(nldi_feature)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_nldi_feature_+3A_nldi_feature">nldi_feature</code></td>
<td>
<p>list with names 'featureSource' and 'featureID' where
'featureSource' is derived from the &quot;source&quot; column of  the response of
<a href="dataRetrieval.html#topic+get_nldi_sources">get_nldi_sources</a> and the 'featureID' is a known identifier
from the specified 'featureSource'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>sf data.frame with one feature
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
get_nldi_feature(list("featureSource" = "nwissite", featureID = "USGS-05428500"))

</code></pre>

<hr>
<h2 id='get_nldi_index'>Get NLDI Index</h2><span id='topic+get_nldi_index'></span>

<h3>Description</h3>

<p>uses the Network Linked Data Index to retrieve and estimated
network location for the given point. If not within a grid cell of a flowline,
will use a raindrop trace service to find the nearest downslope flowline
location.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_nldi_index(location)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_nldi_index_+3A_location">location</code></td>
<td>
<p>numeric WGS84 lon/lat pair (X, Y)</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
index &lt;- get_nldi_index(c(-89.276, 42.988))

if(inherits(index, "sf")) {

plot_nhdplus(bbox = sf::st_bbox(sf::st_buffer(index[1,], units::set_units(1000, "m"))))
plot(sf::st_geometry(sf::st_transform(index, 3857)), add = TRUE)

}

</code></pre>

<hr>
<h2 id='get_nwis'>Discover USGS NWIS Stream Gages</h2><span id='topic+get_nwis'></span>

<h3>Description</h3>

<p>Returns a POINT feature class of active, stream network,
NWIS gages for an Area of Interest. If a POINT feature is used as an AOI,
then the returned sites within the requested buffer, are sorted by distance (in meters) from that POINT.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_nwis(AOI = NULL, t_srs = NULL, buffer = 20000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_nwis_+3A_aoi">AOI</code></td>
<td>
<p>sf (MULTI)POINT or (MULTI)POLYGON. An 'area of interest' can
be provided as either a location (sf POINT) or area (sf POLYGON)
in any Spatial Reference System.</p>
</td></tr>
<tr><td><code id="get_nwis_+3A_t_srs">t_srs</code></td>
<td>
<p>character (PROJ string or EPSG code) or numeric (EPSG code).
A user specified - target -Spatial Reference System (SRS/CRS) for returned objects.
Will default to the CRS of the input AOI if provided, and to 4326 for ID requests.</p>
</td></tr>
<tr><td><code id="get_nwis_+3A_buffer">buffer</code></td>
<td>
<p>numeric. The amount (in meters) to buffer a POINT AOI by
for an extended search. Default = 20,000. Returned results are arrange
by distance from POINT AOI</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The returned object(s) will have the same
Spatial Reference System (SRS) as the input AOI. If a individual or set of
IDs are used to query, then the default geoserver CRS of EPSG:4326 is
preserved. In all cases, a user-defined SRS can be passed to <code>t_srs</code>
which will override all previous SRS (either input or default).
All buffer and distance operations are handled internally using in
EPSG:5070 Albers Equal Area projection
</p>


<h3>Value</h3>

<p>a simple features (sf) object
</p>

<hr>
<h2 id='get_path_lengths'>Get Path Lengths (DEPRECATED)</h2><span id='topic+get_path_lengths'></span>

<h3>Description</h3>

<p>Given a network and set of IDs, finds path lengths between all
identified flowpath outlets. This algorithm finds distance between outlets
regardless of flow direction.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_path_lengths(outlets, network, cores = 1, status = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_path_lengths_+3A_outlets">outlets</code></td>
<td>
<p>vector of IDs from data.frame</p>
</td></tr>
<tr><td><code id="get_path_lengths_+3A_network">network</code></td>
<td>
<p>data.frame with ID, toID, and lengthkm attributes.</p>
</td></tr>
<tr><td><code id="get_path_lengths_+3A_cores">cores</code></td>
<td>
<p>integer number of cores to use for parallel computation.</p>
</td></tr>
<tr><td><code id="get_path_lengths_+3A_status">status</code></td>
<td>
<p>logical print status and progress bars?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame containing the distance between pairs of network outlets.
For a network with one terminal outlet, the data.frame will have
'nrow(network)^2' rows.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>source(system.file("extdata", "walker_data.R", package = "nhdplusTools"))
fline &lt;- walker_flowline

outlets &lt;- c(5329303, 5329357, 5329317, 5329365, 5329435, 5329817)

# Add toCOMID
fline &lt;- nhdplusTools::get_tocomid(fline, add = TRUE)

fl &lt;- dplyr::select(fline, ID = comid, toID = tocomid, lengthkm)

get_path_lengths(outlets, fl)

</code></pre>

<hr>
<h2 id='get_path_members'>Get Path Members (DEPRECATED)</h2><span id='topic+get_path_members'></span>

<h3>Description</h3>

<p>Given a network and set of IDs, finds paths between all
identified flowpath outlets. This algorithm finds members between outlets
regardless of flow direction.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_path_members(outlets, network, cores = 1, status = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_path_members_+3A_outlets">outlets</code></td>
<td>
<p>vector of IDs from data.frame</p>
</td></tr>
<tr><td><code id="get_path_members_+3A_network">network</code></td>
<td>
<p>data.frame with ID, toID, and lengthkm attributes.</p>
</td></tr>
<tr><td><code id="get_path_members_+3A_cores">cores</code></td>
<td>
<p>integer number of cores to use for parallel computation.</p>
</td></tr>
<tr><td><code id="get_path_members_+3A_status">status</code></td>
<td>
<p>logical print status and progress bars?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list of lists containing flowpath identifiers along path that connect
outlets.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>source(system.file("extdata", "walker_data.R", package = "nhdplusTools"))
fline &lt;- walker_flowline

outlets &lt;- c(5329303, 5329357, 5329317, 5329365, 5329435, 5329817)

# Add toCOMID
fline &lt;- nhdplusTools::get_tocomid(fline, add = TRUE)

fl &lt;- dplyr::select(fline, ID = comid, toID = tocomid, lengthkm)

get_path_members(outlets, fl)

</code></pre>

<hr>
<h2 id='get_pathlength'>Get Path Length</h2><span id='topic+get_pathlength'></span>

<h3>Description</h3>

<p>Generates the main path length to a basin's terminal path.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_pathlength(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_pathlength_+3A_x">x</code></td>
<td>
<p>data.frame with ID, toID, length columns.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame containing pathlength for each ID
</p>


<h3>Examples</h3>

<pre><code class='language-R'>source(system.file("extdata", "walker_data.R", package = "nhdplusTools"))

fl &lt;- dplyr::select(prepare_nhdplus(walker_flowline, 0, 0),
                    ID = COMID, toID = toCOMID, length = LENGTHKM)

get_pathlength(fl)

</code></pre>

<hr>
<h2 id='get_pfaf'>Get Pfafstetter Codes (DEPRECATED)</h2><span id='topic+get_pfaf'></span>

<h3>Description</h3>

<p>Determines Pfafstetter codes for a dendritic network with
total drainage area, levelpath, and topo_sort attributes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_pfaf(x, max_level = 2, status = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_pfaf_+3A_x">x</code></td>
<td>
<p>sf data.frame with ID, toID, totda, outletID, topo_sort,
and levelpath attributes.</p>
</td></tr>
<tr><td><code id="get_pfaf_+3A_max_level">max_level</code></td>
<td>
<p>integer number of pfaf levels to attempt to calculate.
If the network doesn't have resolution to support the desired level,
unexpected behavior may occur.</p>
</td></tr>
<tr><td><code id="get_pfaf_+3A_status">status</code></td>
<td>
<p>boolean print status or not</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame with ID and pfaf columns.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
source(system.file("extdata/nhdplushr_data.R", package = "nhdplusTools"))
hr_flowline &lt;- align_nhdplus_names(hr_data$NHDFlowline)

fl &lt;-  select(hr_flowline, COMID, AreaSqKM) %&gt;%
  right_join(prepare_nhdplus(hr_flowline, 0, 0,
                             purge_non_dendritic = FALSE,
                             warn = FALSE),
             by = "COMID") %&gt;%
  sf::st_sf() %&gt;%
  select(ID = COMID, toID = toCOMID, area = AreaSqKM)

fl$nameID = ""
fl$totda &lt;- calculate_total_drainage_area(sf::st_set_geometry(fl, NULL))
fl &lt;- left_join(fl, get_levelpaths(rename(sf::st_set_geometry(fl, NULL),
                                   weight = totda)), by = "ID")

pfaf &lt;- get_pfaf(fl, max_level = 3)

fl &lt;- left_join(fl, pfaf, by = "ID")

plot(fl["pf_level_3"], lwd = 2)

pfaf &lt;- get_pfaf(fl, max_level = 4)

hr_catchment &lt;- left_join(hr_data$NHDPlusCatchment, pfaf, by = c("FEATUREID" = "ID"))

colors &lt;- data.frame(pf_level_4 = unique(hr_catchment$pf_level_4),
                     color = sample(terrain.colors(length(unique(hr_catchment$pf_level_4)))),
                    stringsAsFactors = FALSE)
hr_catchment &lt;- left_join(hr_catchment, colors, by = "pf_level_4")
plot(hr_catchment["color"], border = NA, reset = FALSE)
plot(sf::st_geometry(hr_flowline), col = "blue", add = TRUE)

source(system.file("extdata", "walker_data.R", package = "nhdplusTools"))

fl &lt;- select(walker_flowline, COMID, AreaSqKM) %&gt;%
  right_join(prepare_nhdplus(walker_flowline, 0, 0,
                            purge_non_dendritic = FALSE, warn = FALSE),
            by = "COMID") %&gt;%
  sf::st_sf() %&gt;%
  select(ID = COMID, toID = toCOMID, area = AreaSqKM)

fl$nameID = ""
fl$totda &lt;- calculate_total_drainage_area(sf::st_set_geometry(fl, NULL))
fl &lt;- left_join(fl, get_levelpaths(rename(sf::st_set_geometry(fl, NULL),
                                   weight = totda)), by = "ID")

pfaf &lt;- get_pfaf(fl, max_level = 2)

fl &lt;- left_join(fl, pfaf, by = "ID")

plot(fl["pf_level_2"], lwd = 2)

</code></pre>

<hr>
<h2 id='get_raindrop_trace'>Get Raindrop Trace</h2><span id='topic+get_raindrop_trace'></span>

<h3>Description</h3>

<p>Uses a raindrop trace web service to trace the
nhdplus digital elevation model to the nearest downslope flowline.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_raindrop_trace(point, direction = "down")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_raindrop_trace_+3A_point">point</code></td>
<td>
<p>sfc POINT including crs as created by:
<code>sf::st_sfc(sf::st_point(.. ,..), crs)</code></p>
</td></tr>
<tr><td><code id="get_raindrop_trace_+3A_direction">direction</code></td>
<td>
<p>character <code>"up"</code>, <code>"down"</code>, or <code>"none"</code>.
Controls the portion of the split flowline that is returned along with
the raindrop trace line.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>sf data.frame containing raindrop trace and requested
portion of flowline.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
point &lt;- sf::st_sfc(sf::st_point(x = c(-89.2158, 42.9561)), crs = 4326)

(trace &lt;- get_raindrop_trace(point))

if(inherits(trace, "sf")) {
bbox &lt;- sf::st_bbox(trace) + c(-0.005, -0.005, 0.005, 0.005)

nhdplusTools::plot_nhdplus(bbox = bbox, cache_data = FALSE)

plot(sf::st_transform(sf::st_sfc(point, crs = 4326), 3857), add = TRUE)
plot(sf::st_transform(sf::st_geometry(trace)[1], 3857), add = TRUE, col = "red")
plot(sf::st_transform(sf::st_geometry(trace)[2], 3857), add = TRUE, col = "black")
}


</code></pre>

<hr>
<h2 id='get_sorted'>Get Sorted Network</h2><span id='topic+get_sorted'></span>

<h3>Description</h3>

<p>given a tree with an id and and toid in the
first and second columns, returns a sorted and potentially
split set of output.
</p>
<p>Can also be used as a very fast implementation of upstream
with tributaries navigation. The full network from each
outlet is returned in sorted order.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_sorted(x, split = FALSE, outlets = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_sorted_+3A_x">x</code></td>
<td>
<p>data.frame with an identifier and to identifier in the
first and second columns.</p>
</td></tr>
<tr><td><code id="get_sorted_+3A_split">split</code></td>
<td>
<p>logical if TRUE, the result will be split into
independent networks identified by the id of their outlet. The
outlet id of each independent network is added as a &quot;terminalID&quot;
attribute.</p>
</td></tr>
<tr><td><code id="get_sorted_+3A_outlets">outlets</code></td>
<td>
<p>same as id in x; if specified only the network
emanating from these outlets will be considered and returned.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame containing a topologically sorted version
of the requested network and optionally a terminal id.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>source(system.file("extdata/new_hope_data.R", package = "nhdplusTools"))

fpath &lt;- get_tocomid(
  dplyr::select(new_hope_flowline, COMID, FromNode, ToNode, Divergence, FTYPE,
                AreaSqKM, LENGTHKM, GNIS_ID)
)

head(fpath &lt;- get_sorted(fpath, split = TRUE))

fpath['sort_order'] &lt;- 1:nrow(fpath)

plot(fpath['sort_order'])

</code></pre>

<hr>
<h2 id='get_split_catchment'>Get split catchment</h2><span id='topic+get_split_catchment'></span>

<h3>Description</h3>

<p>Uses catchment splitting web service to retrieve
the portion of a catchment upstream of the point provided.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_split_catchment(point, upstream = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_split_catchment_+3A_point">point</code></td>
<td>
<p>scf POINT including crs as created by:
<code>sf::st_sfc(sf::st_point(.. ,..), crs)</code></p>
</td></tr>
<tr><td><code id="get_split_catchment_+3A_upstream">upstream</code></td>
<td>
<p>logical If TRUE, the entire drainage basin upstream
of the point provided is returned in addition to the local catchment.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>sf data.frame containing the local catchment, the split portion
and optionally the total drainage basin.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
point &lt;- sf::st_sfc(sf::st_point(x = c(-89.2158, 42.9561)), crs = 4326)

trace &lt;- get_raindrop_trace(point)

if(inherits(trace, "sf")) {

(snap_point &lt;- sf::st_sfc(sf::st_point(trace$intersection_point[[1]]),
                          crs = 4326))

(catchment &lt;- get_split_catchment(snap_point))

bbox &lt;- sf::st_bbox(catchment) + c(-0.005, -0.005, 0.005, 0.005)

nhdplusTools::plot_nhdplus(bbox = bbox, cache_data = FALSE)

plot(sf::st_transform(sf::st_geometry(catchment)[2], 3857), add = TRUE, col = "black")
plot(sf::st_transform(sf::st_geometry(catchment)[1], 3857), add = TRUE, col = "red")
plot(sf::st_transform(sf::st_sfc(point, crs = 4326), 3857), add = TRUE, col = "white")

(catchment &lt;- get_split_catchment(snap_point, upstream = FALSE))

bbox &lt;- sf::st_bbox(catchment) + c(-0.005, -0.005, 0.005, 0.005)

nhdplusTools::plot_nhdplus(bbox = bbox, cache_data = FALSE)

plot(sf::st_transform(sf::st_geometry(catchment)[1], 3857), add = TRUE, col = "red")
plot(sf::st_transform(sf::st_geometry(catchment)[2], 3857), add = TRUE, col = "black")
plot(sf::st_transform(sf::st_sfc(point, crs = 4326), 3857), add = TRUE, col = "white")

pour_point &lt;- sf::st_sfc(sf::st_point(x = c(-89.25619, 42.98646)), crs = 4326)

(catchment &lt;- get_split_catchment(pour_point, upstream = FALSE))

bbox &lt;- sf::st_bbox(catchment) + c(-0.005, -0.005, 0.005, 0.005)

nhdplusTools::plot_nhdplus(bbox = bbox, cache_data = FALSE)

plot(sf::st_transform(sf::st_geometry(catchment)[1], 3857), add = TRUE, col = "red")
plot(sf::st_transform(sf::st_geometry(catchment)[2], 3857), add = TRUE, col = "black")
plot(sf::st_transform(sf::st_sfc(pour_point, crs = 4326), 3857), add = TRUE, col = "white")
}


</code></pre>

<hr>
<h2 id='get_streamlevel'>Get Streamlevel</h2><span id='topic+get_streamlevel'></span>

<h3>Description</h3>

<p>Applies a topological sort and calculates stream level.
Algorithm: Terminal level paths are assigned level 1 (see note 1).
Paths that terminate at a level 1 are assigned level 2. This pattern is
repeated until no paths remain.
</p>
<p>If a TRUE/FALSE coastal attribute is included, coastal terminal paths
begin at 1 and internal terminal paths begin at 4 as is implemented by
the NHD stream leveling rules.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_streamlevel(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_streamlevel_+3A_x">x</code></td>
<td>
<p>data.frame with levelpathi, dnlevelpat, and optionally a
coastal flag. If no coastal flag is included, all terminal paths are
assumed to be coastal.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>numeric stream order in same order as input
</p>


<h3>Examples</h3>

<pre><code class='language-R'>source(system.file("extdata", "walker_data.R", package = "nhdplusTools"))

test_flowline &lt;- data.frame(
 levelpathi = walker_flowline$LevelPathI,
 dnlevelpat = walker_flowline$DnLevelPat)

 test_flowline$dnlevelpat[1] &lt;- 0

(level &lt;- get_streamlevel(test_flowline))

walker_flowline$level &lt;- level

plot(sf::st_geometry(walker_flowline), lwd = walker_flowline$level, col = "blue")

test_flowline$coastal &lt;- rep(FALSE, nrow(test_flowline))
(level &lt;- get_streamlevel(test_flowline))

test_flowline$coastal[!test_flowline$dnlevelpat %in% test_flowline$levelpathi] &lt;- TRUE
(level &lt;- get_streamlevel(test_flowline))

</code></pre>

<hr>
<h2 id='get_streamorder'>Get Streamorder</h2><span id='topic+get_streamorder'></span>

<h3>Description</h3>

<p>Applies a topological sort and calculates strahler stream order.
Algorithm: If more than one upstream flowpath has an order equal to the
maximum upstream order then the downstream flowpath is assigned the maximum
upstream order plus one. Otherwise it is assigned the max upstream order.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_streamorder(x, status = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_streamorder_+3A_x">x</code></td>
<td>
<p>data.frame with dendritic ID and toID columns.</p>
</td></tr>
<tr><td><code id="get_streamorder_+3A_status">status</code></td>
<td>
<p>logical show progress update messages?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>numeric stream order in same order as input
</p>


<h3>Examples</h3>

<pre><code class='language-R'>source(system.file("extdata", "walker_data.R", package = "nhdplusTools"))

test_flowline &lt;- prepare_nhdplus(walker_flowline, 0, 0, FALSE)

test_flowline &lt;- data.frame(
  ID = test_flowline$COMID,
  toID = test_flowline$toCOMID)

(order &lt;- get_streamorder(test_flowline))

walker_flowline$order &lt;- order

plot(sf::st_geometry(walker_flowline), lwd = walker_flowline$order, col = "blue")

</code></pre>

<hr>
<h2 id='get_terminal'>Get Terminal ID (DEPRECATED)</h2><span id='topic+get_terminal'></span>

<h3>Description</h3>

<p>Get the ID of the basin outlet for each flowline.
This function has been deprecated in favor of get_sorted.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_terminal(x, outlets)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_terminal_+3A_x">x</code></td>
<td>
<p>two column data.frame with IDs and toIDs. Names are ignored.</p>
</td></tr>
<tr><td><code id="get_terminal_+3A_outlets">outlets</code></td>
<td>
<p>IDs of outlet flowlines</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame containing the terminal ID for each outlet
</p>


<h3>Examples</h3>

<pre><code class='language-R'>source(system.file("extdata", "walker_data.R", package = "nhdplusTools"))

fl &lt;- dplyr::select(prepare_nhdplus(walker_flowline, 0, 0),
                    ID = COMID, toID = toCOMID)

outlet &lt;- fl$ID[which(!fl$toID %in% fl$ID)]

get_terminal(fl, outlet)

</code></pre>

<hr>
<h2 id='get_tocomid'>Get tocomid</h2><span id='topic+get_tocomid'></span>

<h3>Description</h3>

<p>Given flowlines with fromnode and tonode attributes,
will return a toid attribute that is the result of joining
tonode and fromnode attributes. In the case that a terminalpa
attribute is included, the join is executed by terminalpa group.
This is done grouped by terminalpathID because duplicate node
ids have been encountered across basins in some datasets. If
'remove_coastal' is 'TRUE' (the default) either ftype or fcode are
required. Uses the <a href="hydroloom.html#topic+add_toids">add_toids</a> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_tocomid(
  x,
  return_dendritic = TRUE,
  missing = 0,
  remove_coastal = TRUE,
  add = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_tocomid_+3A_x">x</code></td>
<td>
<p>data.frame with comid, tonode, fromnode, and (optionally)
divergence and terminalpa attributes.</p>
</td></tr>
<tr><td><code id="get_tocomid_+3A_return_dendritic">return_dendritic</code></td>
<td>
<p>logical if TRUE, a divergence attribute is required
(2 indicates diverted path, 1 is main) and diverted paths will be treated
as headwaters. If this is FALSE, the return value is a data.frame including
the comid and tocomid attributes.</p>
</td></tr>
<tr><td><code id="get_tocomid_+3A_missing">missing</code></td>
<td>
<p>integer value to use for terminal nodes.</p>
</td></tr>
<tr><td><code id="get_tocomid_+3A_remove_coastal">remove_coastal</code></td>
<td>
<p>logical remove coastal features prior to generating
tocomid values? ftype or fcode are required if 'TRUE'. fcode == 56600 or
fcode == &quot;Coastline&quot; will be removed.</p>
</td></tr>
<tr><td><code id="get_tocomid_+3A_add">add</code></td>
<td>
<p>logical if TRUE, a tocomid column will be added, otherwise
a data.frame with two columns will be returned.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame containing comid and tocomid attributes or all
attributes provided with comid and tocomid in the first and second columns..
</p>


<h3>Examples</h3>

<pre><code class='language-R'>source(system.file("extdata", "sample_flines.R", package = "nhdplusTools"))

tocomid &lt;- get_tocomid(sample_flines)

tocomid &lt;- get_tocomid(sample_flines, return_dendritic = FALSE)

</code></pre>

<hr>
<h2 id='get_UM'>Navigate Upstream Mainstem</h2><span id='topic+get_UM'></span>

<h3>Description</h3>

<p>Traverse NHDPlus network upstream main stem
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_UM(network, comid, distance = NULL, sort = FALSE, include = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_UM_+3A_network">network</code></td>
<td>
<p>data.frame NHDPlus flowlines including at a minimum:
COMID,Pathlength, LevelPathI, and Hydroseq.</p>
</td></tr>
<tr><td><code id="get_UM_+3A_comid">comid</code></td>
<td>
<p>integer identifier to start navigating from.</p>
</td></tr>
<tr><td><code id="get_UM_+3A_distance">distance</code></td>
<td>
<p>numeric distance in km to limit how many COMIDs are</p>
</td></tr>
<tr><td><code id="get_UM_+3A_sort">sort</code></td>
<td>
<p>if TRUE, the returned COMID vector will be sorted in order of distance from the input COMID (nearest to farthest)</p>
</td></tr>
<tr><td><code id="get_UM_+3A_include">include</code></td>
<td>
<p>if TRUE, the input COMID will be included in the returned COMID vector
returned. The COMID that exceeds the distance specified is returned.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>integer vector of all COMIDs upstream of the starting COMID
along the mainstem
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(sf)

source(system.file("extdata", "sample_flines.R", package = "nhdplusTools"))

plot(sample_flines$geom)
start_COMID &lt;- 11690196
UM_COMIDs &lt;- get_UM(sample_flines, start_COMID)
plot(dplyr::filter(sample_flines, COMID %in% UM_COMIDs)$geom,
     col = "red", add = TRUE, lwd = 3)

UM_COMIDs &lt;- get_UM(sample_flines, start_COMID, distance = 50)
plot(dplyr::filter(sample_flines, COMID %in% UM_COMIDs)$geom,
     col = "blue", add = TRUE, lwd = 2)

</code></pre>

<hr>
<h2 id='get_UT'>Navigate Upstream with Tributaries</h2><span id='topic+get_UT'></span>

<h3>Description</h3>

<p>Traverse NHDPlus network upstream with tributaries
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_UT(network, comid, distance = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_UT_+3A_network">network</code></td>
<td>
<p>data.frame NHDPlus flowlines including at a minimum:
COMID, Pathlength, LENGTHKM, and Hydroseq.</p>
</td></tr>
<tr><td><code id="get_UT_+3A_comid">comid</code></td>
<td>
<p>integer Identifier to start navigating from.</p>
</td></tr>
<tr><td><code id="get_UT_+3A_distance">distance</code></td>
<td>
<p>numeric distance in km to limit how many COMIDs are
returned. The COMID that exceeds the distance specified is returned.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>integer vector of all COMIDs upstream with tributaries of the
starting COMID.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(sf)
source(system.file("extdata", "sample_flines.R", package = "nhdplusTools"))
plot(sample_flines$geom)
start_COMID &lt;- 11690196
UT_COMIDs &lt;- get_UT(sample_flines, start_COMID)
plot(dplyr::filter(sample_flines, COMID %in% UT_COMIDs)$geom,
     col = "red", add = TRUE)

UT_COMIDs &lt;- get_UT(sample_flines, start_COMID, distance = 50)
plot(dplyr::filter(sample_flines, COMID %in% UT_COMIDs)$geom,
     col = "blue", add = TRUE)

</code></pre>

<hr>
<h2 id='get_vaa'>NHDPlusV2 Attribute Subset</h2><span id='topic+get_vaa'></span>

<h3>Description</h3>

<p>Return requested NHDPlusV2 Attributes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_vaa(
  atts = NULL,
  path = get_vaa_path(),
  download = TRUE,
  updated_network = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_vaa_+3A_atts">atts</code></td>
<td>
<p>character The variable names you would like, always includes comid</p>
</td></tr>
<tr><td><code id="get_vaa_+3A_path">path</code></td>
<td>
<p>character path where the file should be saved. Default is a
persistent system data as retrieved by <a href="#topic+nhdplusTools_data_dir">nhdplusTools_data_dir</a>.
Also see: <a href="#topic+get_vaa_path">get_vaa_path</a></p>
</td></tr>
<tr><td><code id="get_vaa_+3A_download">download</code></td>
<td>
<p>logical if TRUE, the default, will download VAA table if not
found at path.</p>
</td></tr>
<tr><td><code id="get_vaa_+3A_updated_network">updated_network</code></td>
<td>
<p>logical default FALSE. If TRUE, updated network attributes
from E2NHD and National Water Model retrieved from
<a href="https://doi.org/10.5066/P976XCVT">doi:10.5066/P976XCVT</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The VAA data is a aggregate table of information from the NHDPlusV2
elevslope.dbf(s), PlusFlowlineVAA.dbf(s); and NHDFlowlines. All data
originates from the EPA NHDPlus Homepage
<a href="https://www.epa.gov/waterdata/get-nhdplus-national-hydrography-dataset-plus-data">here</a>.
To see the location of cached data on your machine use
<code><a href="#topic+get_vaa_path">get_vaa_path</a></code>.
To view aggregate data and documentation, see
<a href="https://www.hydroshare.org/resource/6092c8a62fac45be97a09bfd0b0bf726/">here</a>
</p>


<h3>Value</h3>

<p>data.frame containing requested VAA data
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# This will download the vaa file to the path from get_vaa_path()

get_vaa("slope")
get_vaa(c("slope", "lengthkm"))

get_vaa(updated_network = TRUE)
get_vaa("reachcode", updated_network = TRUE)

#cleanup if desired
unlink(dirname(get_vaa_path()), recursive = TRUE)

## End(Not run)
</code></pre>

<hr>
<h2 id='get_vaa_names'>Available NHDPlusV2 Attributes</h2><span id='topic+get_vaa_names'></span>

<h3>Description</h3>

<p>Find variables available from the NHDPlusV2 attribute data.frame
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_vaa_names(updated_network = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_vaa_names_+3A_updated_network">updated_network</code></td>
<td>
<p>logical default FALSE. If TRUE, updated network attributes
from E2NHD and National Water Model retrieved from
<a href="https://doi.org/10.5066/P976XCVT">doi:10.5066/P976XCVT</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The VAA data is a aggregate table of information from the NHDPlusV2
elevslope.dbf(s), PlusFlowlineVAA.dbf(s); and NHDFlowlines. All data
originates from the EPA NHDPlus Homepage
<a href="https://www.epa.gov/waterdata/get-nhdplus-national-hydrography-dataset-plus-data">here</a>.
To see the location of cached data on your machine use
<code><a href="#topic+get_vaa_path">get_vaa_path</a></code>.
To view aggregate data and documentation, see
<a href="https://www.hydroshare.org/resource/6092c8a62fac45be97a09bfd0b0bf726/">here</a>
</p>


<h3>Value</h3>

<p>character vector
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# This will download the vaa file to the path from get_vaa_path()
get_vaa_names()

#cleanup if desired
unlink(dirname(get_vaa_path()), recursive = TRUE)

## End(Not run)
</code></pre>

<hr>
<h2 id='get_vaa_path'>File path to value added attribute (vaa) Cache</h2><span id='topic+get_vaa_path'></span>

<h3>Description</h3>

<p>nhdplusTools will download and cache an 'fst' file with
NHDPlusV2 attribute data sans geometry. This function returns the
file path to the cached file. Will use the user data dir indicated
by <a href="#topic+nhdplusTools_data_dir">nhdplusTools_data_dir</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_vaa_path(updated_network = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_vaa_path_+3A_updated_network">updated_network</code></td>
<td>
<p>logical default FALSE. If TRUE, returns path to updated
network parameters. See <a href="#topic+get_vaa">get_vaa</a> for more.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The VAA data is a aggregate table of information from the NHDPlusV2
elevslope.dbf(s), PlusFlowlineVAA.dbf(s); and NHDFlowlines. All data
originates from the EPA NHDPlus Homepage
<a href="https://www.epa.gov/waterdata/get-nhdplus-national-hydrography-dataset-plus-data">here</a>.
To see the location of cached data on your machine use
<code><a href="#topic+get_vaa_path">get_vaa_path</a></code>.
To view aggregate data and documentation, see
<a href="https://www.hydroshare.org/resource/6092c8a62fac45be97a09bfd0b0bf726/">here</a>
</p>


<h3>Value</h3>

<p>character file path
</p>


<h3>Examples</h3>

<pre><code class='language-R'>get_vaa_path()

get_vaa_path(updated_network = TRUE)

</code></pre>

<hr>
<h2 id='get_waterbodies'>Find NHD Water Bodies</h2><span id='topic+get_waterbodies'></span>

<h3>Description</h3>

<p>Subsets NHD waterbody features by location (POINT),
area (POLYGON), or set of IDs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_waterbodies(AOI = NULL, id = NULL, t_srs = NULL, buffer = 0.5)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_waterbodies_+3A_aoi">AOI</code></td>
<td>
<p>sf (MULTI)POINT or (MULTI)POLYGON. An 'area of interest' can
be provided as either a location (sf POINT) or area (sf POLYGON)
in any Spatial Reference System.</p>
</td></tr>
<tr><td><code id="get_waterbodies_+3A_id">id</code></td>
<td>
<p>NHD Waterbody COMID(s)</p>
</td></tr>
<tr><td><code id="get_waterbodies_+3A_t_srs">t_srs</code></td>
<td>
<p>character (PROJ string or EPSG code) or numeric (EPSG code).
A user specified - target -Spatial Reference System (SRS/CRS) for returned objects.
Will default to the CRS of the input AOI if provided, and to 4326 for ID requests.</p>
</td></tr>
<tr><td><code id="get_waterbodies_+3A_buffer">buffer</code></td>
<td>
<p>numeric. The amount (in meters) to buffer a POINT AOI by for an
extended search. Default = 0.5</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The returned object(s) will have the same
Spatial Reference System (SRS) as the input AOI. If a individual or set of
IDs are used to query, then the default geoserver CRS of EPSG:4326 is
preserved. In all cases, a user-defined SRS can be passed to <code>t_srs</code>
which will override all previous SRS (either input or default).
All buffer and distance operations are handled internally using in
EPSG:5070 Albers Equal Area projection
</p>


<h3>Value</h3>

<p>a simple features (sf) object
</p>

<hr>
<h2 id='get_waterbody_index'>Get Waterbody Index</h2><span id='topic+get_waterbody_index'></span>

<h3>Description</h3>

<p>given an sf point geometry column, return waterbody id, and
COMID of dominant artificial path
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_waterbody_index(waterbodies, points, flines = NULL, search_radius = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_waterbody_index_+3A_waterbodies">waterbodies</code></td>
<td>
<p>sf data.frame of type POLYGON or MULTIPOLYGON including
COMID attributes.</p>
</td></tr>
<tr><td><code id="get_waterbody_index_+3A_points">points</code></td>
<td>
<p>sfc of type POINT</p>
</td></tr>
<tr><td><code id="get_waterbody_index_+3A_flines">flines</code></td>
<td>
<p>sf data.frame of type LINESTRING or MULTILINESTRING including
COMID, WBAREACOMI, and Hydroseq attributes</p>
</td></tr>
<tr><td><code id="get_waterbody_index_+3A_search_radius">search_radius</code></td>
<td>
<p>units class with a numeric value indicating how far to
search for a waterbody boundary in units of provided projection. Set units with
<a href="units.html#topic+set_units">set_units</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame with two columns, COMID, in_wb_COMID, near_wb_COMID,
near_wb_dist, and outlet_fline_COMID. Distance is in units of provided projection.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
source(system.file("extdata/sample_data.R", package = "nhdplusTools"))

waterbodies &lt;- sf::st_transform(
  sf::read_sf(sample_data, "NHDWaterbody"), 5070)

points &lt;- sf::st_transform(
  sf::st_sfc(sf::st_point(c(-89.356086, 43.079943)),
             crs = 4326), 5070)

get_waterbody_index(waterbodies, points,
                    search_radius = units::set_units(500, "m"))

</code></pre>

<hr>
<h2 id='get_wb_outlet'>Get Waterbody Outlet</h2><span id='topic+get_wb_outlet'></span>

<h3>Description</h3>

<p>Get Waterbody Outlet
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_wb_outlet(lake_id, network)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_wb_outlet_+3A_lake_id">lake_id</code></td>
<td>
<p>integer COMID (or character permanent identifier for hi res) of lake.</p>
</td></tr>
<tr><td><code id="get_wb_outlet_+3A_network">network</code></td>
<td>
<p>data.frame of network features containing wbareacomi, and Hydroseq</p>
</td></tr>
</table>


<h3>Value</h3>

<p>sf data.frame with single record of network COMID
associated with most-downstream reach in the NHD Waterbody
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

source(system.file("extdata/sample_data.R", package = "nhdplusTools"))

fline &lt;- sf::read_sf(sample_data, "NHDFlowline_Network")
wtbdy &lt;- sf::read_sf(sample_data, "NHDWaterbody")

lake_COMID &lt;- wtbdy$COMID[wtbdy$GNIS_NAME=='Lake Mendota 254']

get_wb_outlet(13293262, fline)


</code></pre>

<hr>
<h2 id='get_xs_point'>Get Cross Section From Point (experimental)</h2><span id='topic+get_xs_point'></span>

<h3>Description</h3>

<p>Uses a cross section retrieval web services to retrieve a
cross section given a point and specified width. Orientation is determined
based on direction of a the flowline found near point. This function uses
a 10m National Elevation Dataset request on the back end.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_xs_point(point, width, num_pts)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_xs_point_+3A_point">point</code></td>
<td>
<p>sfc POINT including crs as created by:
<code>sf::st_sfc(sf::st_point(.. ,..), crs)</code>crs.</p>
</td></tr>
<tr><td><code id="get_xs_point_+3A_width">width</code></td>
<td>
<p>Cross section width in meters.</p>
</td></tr>
<tr><td><code id="get_xs_point_+3A_num_pts">num_pts</code></td>
<td>
<p>numeric number of points to retrieve along the cross section.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>sf data.frame containing points retrieved.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
point &lt;- sf::st_sfc(sf::st_point(x = c(-105.97218, 36.17592)), crs = 4326)

(xs &lt;- get_xs_point(point, 300, 100))

if(inherits(xs, "sf")) {

bbox &lt;- sf::st_bbox(xs) + c(-0.005, -0.005, 0.005, 0.005)

nhdplusTools::plot_nhdplus(bbox = bbox, cache_data = FALSE)

plot(sf::st_transform(sf::st_geometry(xs), 3857), pch = ".", add = TRUE, col = "red")
plot(sf::st_transform(sf::st_sfc(point, crs = 4326), 3857), add = TRUE)

plot(xs$distance_m, xs$elevation_m)
}


</code></pre>

<hr>
<h2 id='get_xs_points'>Get Cross Section Endpoints (experimental)</h2><span id='topic+get_xs_points'></span>

<h3>Description</h3>

<p>Uses a cross section retrieval web services to retrieve a
cross section between two endpoints.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_xs_points(point1, point2, num_pts, res = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_xs_points_+3A_point1">point1</code></td>
<td>
<p>sfc POINT including crs as created by:
<code>sf::st_sfc(sf::st_point(.. ,..), crs)</code></p>
</td></tr>
<tr><td><code id="get_xs_points_+3A_point2">point2</code></td>
<td>
<p>sfc POINT including crs.</p>
</td></tr>
<tr><td><code id="get_xs_points_+3A_num_pts">num_pts</code></td>
<td>
<p>numeric number of points to retrieve along the cross section.</p>
</td></tr>
<tr><td><code id="get_xs_points_+3A_res">res</code></td>
<td>
<p>integer resolution of 3D Elevation Program data to request.
Must be on of: 1, 3, 5, 10, 30, 60.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>sf data.frame containing points retrieved.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
point1 &lt;- sf::st_sfc(sf::st_point(x = c(-105.9667, 36.17602)), crs = 4326)
point2 &lt;- sf::st_sfc(sf::st_point(x = c(-105.97768, 36.17526)), crs = 4326)

(xs &lt;- get_xs_points(point1, point2, 100))

if(inherits(xs, "sf")) {

bbox &lt;- sf::st_bbox(xs) + c(-0.005, -0.005, 0.005, 0.005)

nhdplusTools::plot_nhdplus(bbox = bbox, cache_data = FALSE)

plot(sf::st_transform(sf::st_geometry(xs), 3857), pch = ".", add = TRUE, col = "red")
plot(sf::st_transform(sf::st_sfc(point1, crs = 4326), 3857), add = TRUE)
plot(sf::st_transform(sf::st_sfc(point2, crs = 4326), 3857), add = TRUE)

plot(xs$distance_m, xs$elevation_m)
}


</code></pre>

<hr>
<h2 id='make_node_topology'>get node topology from edge topology (DEPRECATED)</h2><span id='topic+make_node_topology'></span>

<h3>Description</h3>

<p>creates a node topology table from an edge topology
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_node_topology(x, add_div = NULL, add = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="make_node_topology_+3A_x">x</code></td>
<td>
<p>data.frame with an identifier and to identifier in the
first and second columns.</p>
</td></tr>
<tr><td><code id="make_node_topology_+3A_add_div">add_div</code></td>
<td>
<p>data.frame containing id and toid diverted paths to add.
Should have id and toid fields in the first and second columns. Names
are not used.</p>
</td></tr>
<tr><td><code id="make_node_topology_+3A_add">add</code></td>
<td>
<p>logical if TRUE, a tocomid column will be added, otherwise
a data.frame with two columns will be returned.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame containing id, fromnode, and tonode attributes or all
attributes provided with id, fromnode and tonode in the first three columns.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>source(system.file("extdata/new_hope_data.R", package = "nhdplusTools"))

x &lt;- dplyr::select(get_tocomid(
  dplyr::select(new_hope_flowline, COMID, FromNode, ToNode, Divergence, FTYPE,
                AreaSqKM, LENGTHKM, GNIS_ID)
), -tonode, -fromnode)

head(y &lt;- make_node_topology(x))

# just the divergences which have unique fromids in x but don't in new hope.
div &lt;- get_tocomid(dplyr::select(new_hope_flowline, COMID, FromNode, ToNode),
                   return_dendritic = FALSE,
                   remove_coastal = FALSE)
div &lt;- div[div$tocomid %in%
             new_hope_flowline$COMID[new_hope_flowline$Divergence == 2],]

y &lt;- make_node_topology(x, div)

</code></pre>

<hr>
<h2 id='make_standalone'>Make isolated NHDPlusHR region a standalone dataset</h2><span id='topic+make_standalone'></span>

<h3>Description</h3>

<p>Cleans up and prepares NHDPlusHR regional data for use as complete NHDPlus
data. The primary modification applied is to ensure that any flowpath that exits the
domain is labeled as a terminal path and attributes are propagated upstream such that
the domain is independently complete.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_standalone(flowlines)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="make_standalone_+3A_flowlines">flowlines</code></td>
<td>
<p>sf data.frame of NHDPlusHR flowlines.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>sf data.frame containing standalone network
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(sf)
source(system.file("extdata/nhdplushr_data.R", package = "nhdplusTools"))

(outlet &lt;- filter(hr_data$NHDFlowline, Hydroseq == min(Hydroseq)))
nrow(filter(hr_data$NHDFlowline, TerminalPa == outlet$Hydroseq))

hr_data$NHDFlowline &lt;- make_standalone(hr_data$NHDFlowline)

(outlet &lt;- filter(hr_data$NHDFlowline, Hydroseq == min(Hydroseq)))
nrow(filter(hr_data$NHDFlowline, TerminalPa == outlet$Hydroseq))

source(system.file("extdata/nhdplushr_data.R", package = "nhdplusTools"))

# Remove mainstem and non-dendritic stuff.
subset &lt;- filter(hr_data$NHDFlowline,
                        StreamLeve &gt; min(hr_data$NHDFlowline$StreamLeve) &amp;
                          StreamOrde == StreamCalc)

subset &lt;- subset_nhdplus(subset$COMID, nhdplus_data = hr_gpkg)$NHDFlowline

plot(sf::st_geometry(hr_data$NHDFlowline))

flowline_mod &lt;- make_standalone(subset)

terminals &lt;- unique(flowline_mod$TerminalPa)

colors &lt;- sample(hcl.colors(length(terminals), palette = "Zissou 1"))

for(i in 1:length(terminals)) {
  fl &lt;- flowline_mod[flowline_mod$TerminalPa == terminals[i], ]
  plot(st_geometry(fl), col = colors[i], lwd = 2, add = TRUE)
}

ol &lt;- filter(flowline_mod, TerminalFl == 1 &amp; TerminalPa %in% terminals)

plot(st_geometry(ol), lwd = 2, add = TRUE)

</code></pre>

<hr>
<h2 id='map_nhdplus'>Make Interactive Map of NHDPlus</h2><span id='topic+map_nhdplus'></span>

<h3>Description</h3>

<p>Given a list of outlets, get their basin boundaries and network and return a leaflet map in
EPSG:4326.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>map_nhdplus(
  outlets = NULL,
  bbox = NULL,
  streamorder = NULL,
  nhdplus_data = NULL,
  gpkg = NULL,
  flowline_only = NULL,
  plot_config = NULL,
  overwrite = TRUE,
  cache_data = NULL,
  return_map = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="map_nhdplus_+3A_outlets">outlets</code></td>
<td>
<p>list of nldi outlets. Other inputs are coerced into nldi outlets, see details.</p>
</td></tr>
<tr><td><code id="map_nhdplus_+3A_bbox">bbox</code></td>
<td>
<p>object of class bbox with a defined crs. See examples.</p>
</td></tr>
<tr><td><code id="map_nhdplus_+3A_streamorder">streamorder</code></td>
<td>
<p>integer only streams of order greater than or equal will be returned</p>
</td></tr>
<tr><td><code id="map_nhdplus_+3A_nhdplus_data">nhdplus_data</code></td>
<td>
<p>geopackage containing source nhdplus data (omit to download)</p>
</td></tr>
<tr><td><code id="map_nhdplus_+3A_gpkg">gpkg</code></td>
<td>
<p>path and file with .gpkg ending. If omitted, no file is written.</p>
</td></tr>
<tr><td><code id="map_nhdplus_+3A_flowline_only">flowline_only</code></td>
<td>
<p>boolean only subset and plot flowlines only, default=FALSE</p>
</td></tr>
<tr><td><code id="map_nhdplus_+3A_plot_config">plot_config</code></td>
<td>
<p>list containing plot configuration, see details.</p>
</td></tr>
<tr><td><code id="map_nhdplus_+3A_overwrite">overwrite</code></td>
<td>
<p>passed on the <a href="#topic+subset_nhdplus">subset_nhdplus</a>.</p>
</td></tr>
<tr><td><code id="map_nhdplus_+3A_cache_data">cache_data</code></td>
<td>
<p>character path to rds file where all plot data can be cached.
If file doesn't exist, it will be created. If set to FALSE, all caching will
be turned off &ndash; this includes basemap tiles.</p>
</td></tr>
<tr><td><code id="map_nhdplus_+3A_return_map">return_map</code></td>
<td>
<p>if FALSE (default), a data.frame of plot data is returned invisibly in NAD83 Lat/Lon, if TRUE the leaflet object is returned</p>
</td></tr>
</table>


<h3>Details</h3>

<p>map_nhdplus supports several input specifications. An unexported function &quot;as_outlet&quot;
is used to convert the outlet formats as described below.
</p>

<ol>
<li><p> if outlets is omitted, the bbox input is required and all nhdplus data
in the bounding box is plotted.
</p>
</li>
<li><p> If outlets is a list of integers, it is assumed to be NHDPlus IDs (comids)
and all upstream tributaries are plotted.
</p>
</li>
<li><p> if outlets is an integer vector, it is assumed to be all NHDPlus IDs (comids)
that should be plotted. Allows custom filtering.
</p>
</li>
<li><p> If outlets is a character vector, it is assumed to be NWIS site ids.
</p>
</li>
<li><p> if outlets is a list containing only characters, it is assumed to be a list
of nldi features and all upstream tributaries are plotted.
</p>
</li>
<li><p> if outlets is a data.frame with point geometry, a point in polygon match
is performed and upstream with tributaries from the identified catchments is plotted.
</p>
</li></ol>

<p>See <a href="#topic+plot_nhdplus">plot_nhdplus</a> for details on plot configuration.
</p>


<h3>Value</h3>

<p>data.frame or leaflet map (see return_map)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
map_nhdplus("05428500")

map_nhdplus("05428500", streamorder = 2)

map_nhdplus(list(13293970, 13293750))

source(system.file("extdata/sample_data.R", package = "nhdplusTools"))

map_nhdplus(list(13293970, 13293750), streamorder = 3, nhdplus_data = sample_data)

#return leaflet object
map_nhdplus("05428500", return_map = TRUE)

</code></pre>

<hr>
<h2 id='navigate_network'>Navigate Network</h2><span id='topic+navigate_network'></span>

<h3>Description</h3>

<p>Provides a full feature network navigation function that
will work with local or web service data. Parameter details provide
context.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>navigate_network(
  start,
  mode = "UM",
  network = NULL,
  output = "flowlines",
  distance_km = 10,
  trim_start = FALSE,
  trim_stop = FALSE,
  trim_tolerance = 5
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="navigate_network_+3A_start">start</code></td>
<td>
<p>list, integer, sf, or sfc if list must be a valid NLDI feature
if integer must be a valid comid. If sf, must contain a &quot;comid&quot; field.</p>
</td></tr>
<tr><td><code id="navigate_network_+3A_mode">mode</code></td>
<td>
<p>character chosen from c(UM, DM, UT, or DD)</p>
</td></tr>
<tr><td><code id="navigate_network_+3A_network">network</code></td>
<td>
<p>sf should be compatible with network navigation functions
If NULL, network will be derived from requests to the NLDI</p>
</td></tr>
<tr><td><code id="navigate_network_+3A_output">output</code></td>
<td>
<p>character flowline or a valid NLDI data source</p>
</td></tr>
<tr><td><code id="navigate_network_+3A_distance_km">distance_km</code></td>
<td>
<p>numeric distance to navigate in km</p>
</td></tr>
<tr><td><code id="navigate_network_+3A_trim_start">trim_start</code></td>
<td>
<p>logical should start be trimmed or include entire catchment?</p>
</td></tr>
<tr><td><code id="navigate_network_+3A_trim_stop">trim_stop</code></td>
<td>
<p>logical should stop(s) be trimmed or include entire catchment(s)?
# Not supported</p>
</td></tr>
<tr><td><code id="navigate_network_+3A_trim_tolerance">trim_tolerance</code></td>
<td>
<p>numeric from 0 to 100 percent of flowline length. If amount
to trim is less than this tolerance, no trim will be applied.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>

navigate_network(list(featureSource = "nwissite", featureID = "USGS-06287800"),
                "UM",
                output = "flowlines",
                trim_start = TRUE)


source(system.file("extdata", "walker_data.R", package = "nhdplusTools"))
hydro_location &lt;- list(comid = 5329339,
                      reachcode = "18050005000078",
                       reach_meas = 30)

hydro_location &lt;- sf::st_sf(
  hydro_location,
  geom = nhdplusTools::get_hydro_location(data.frame(hydro_location),
                                          walker_flowline))

net &lt;- navigate_network(hydro_location,
                       mode = "DM", network = walker_flowline,
                       trim_start = TRUE, distance_km = 20)

plot(sf::st_geometry(walker_flowline))
plot(sf::st_geometry(hydro_location), add = TRUE)
plot(sf::st_geometry(net), add = TRUE, col = "blue", lwd = 2)

</code></pre>

<hr>
<h2 id='navigate_nldi'>Navigate NLDI</h2><span id='topic+navigate_nldi'></span>

<h3>Description</h3>

<p>Navigate the Network Linked Data Index network.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>navigate_nldi(
  nldi_feature,
  mode = "upstreamMain",
  data_source = "flowlines",
  distance_km = 10
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="navigate_nldi_+3A_nldi_feature">nldi_feature</code></td>
<td>
<p>list with names 'featureSource' and 'featureID' where
'featureSource' is derived from the &quot;source&quot; column of  the response of
<a href="dataRetrieval.html#topic+get_nldi_sources">get_nldi_sources</a> and the 'featureID' is a known identifier
from the specified 'featureSource'.</p>
</td></tr>
<tr><td><code id="navigate_nldi_+3A_mode">mode</code></td>
<td>
<p>character chosen from (&quot;UM&quot;, &quot;UT&quot;, DM&quot;, &quot;DD&quot;). See examples.</p>
</td></tr>
<tr><td><code id="navigate_nldi_+3A_data_source">data_source</code></td>
<td>
<p>character chosen from &quot;source&quot; column of the response
of <a href="dataRetrieval.html#topic+get_nldi_sources">get_nldi_sources</a> or empty string for flowline geometry.</p>
</td></tr>
<tr><td><code id="navigate_nldi_+3A_distance_km">distance_km</code></td>
<td>
<p>numeric distance in km to stop navigating.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>sf data.frame with result
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(sf)
library(dplyr)

nldi_nwis &lt;- list(featureSource = "nwissite", featureID = "USGS-05428500")

navigate_nldi(nldi_feature = nldi_nwis,
              mode = "upstreamTributaries")$UT %&gt;%
  st_geometry() %&gt;%
  plot()

navigate_nldi(nldi_feature = nldi_nwis,
              mode = "UM")$UM %&gt;%
  st_geometry() %&gt;%
  plot(col = "blue", add = TRUE)



nwissite &lt;- navigate_nldi(nldi_feature = nldi_nwis,
                          mode = "UT",
                          data_source = "nwissite")$UT_nwissite

st_geometry(nwissite) %&gt;%
  plot(col = "green", add = TRUE)

nwissite


</code></pre>

<hr>
<h2 id='nhdplus_path'>NHDPlus Data Path</h2><span id='topic+nhdplus_path'></span>

<h3>Description</h3>

<p>Allows specification of a custom path to a source dataset.
Typically this will be the national seamless dataset in
geodatabase or geopackage format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nhdplus_path(path = NULL, warn = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nhdplus_path_+3A_path">path</code></td>
<td>
<p>character path ending in .gdb or .gpkg</p>
</td></tr>
<tr><td><code id="nhdplus_path_+3A_warn">warn</code></td>
<td>
<p>boolean controls whether warning an status messages are printed</p>
</td></tr>
</table>


<h3>Value</h3>

<p>0 (invisibly) if set successfully, character path if no input.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>nhdplus_path("/data/NHDPlusV21_National_Seamless.gdb")

nhdplus_path("/data/NHDPlusV21_National_Seamless.gdb", warn=FALSE)

nhdplus_path()

</code></pre>

<hr>
<h2 id='nhdplusTools_data_dir'>Get or set nhdplusTools data directory</h2><span id='topic+nhdplusTools_data_dir'></span>

<h3>Description</h3>

<p>if left unset, will return the user data dir
as returned by 'tools::R_user_dir' for this package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nhdplusTools_data_dir(dir = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nhdplusTools_data_dir_+3A_dir">dir</code></td>
<td>
<p>path of desired data directory</p>
</td></tr>
</table>


<h3>Value</h3>

<p>character path of data directory (silent when setting)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>nhdplusTools_data_dir()

nhdplusTools_data_dir("demo")

nhdplusTools_data_dir(tools::R_user_dir("nhdplusTools"))

</code></pre>

<hr>
<h2 id='plot_nhdplus'>Plot NHDPlus</h2><span id='topic+plot_nhdplus'></span>

<h3>Description</h3>

<p>Given a list of outlets, get their basin boundaries and network and return a plot in
EPSG:3857 Web Mercator Projection.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_nhdplus(
  outlets = NULL,
  bbox = NULL,
  streamorder = NULL,
  nhdplus_data = NULL,
  gpkg = NULL,
  plot_config = NULL,
  basemap = "Esri.NatGeoWorldMap",
  zoom = NULL,
  add = FALSE,
  actually_plot = TRUE,
  overwrite = TRUE,
  flowline_only = NULL,
  cache_data = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_nhdplus_+3A_outlets">outlets</code></td>
<td>
<p>list of nldi outlets. Other inputs are coerced into nldi outlets, see details.</p>
</td></tr>
<tr><td><code id="plot_nhdplus_+3A_bbox">bbox</code></td>
<td>
<p>object of class bbox with a defined crs. See examples.</p>
</td></tr>
<tr><td><code id="plot_nhdplus_+3A_streamorder">streamorder</code></td>
<td>
<p>integer only streams of order greater than or equal will be returned</p>
</td></tr>
<tr><td><code id="plot_nhdplus_+3A_nhdplus_data">nhdplus_data</code></td>
<td>
<p>geopackage containing source nhdplus data (omit to download)</p>
</td></tr>
<tr><td><code id="plot_nhdplus_+3A_gpkg">gpkg</code></td>
<td>
<p>path and file with .gpkg ending. If omitted, no file is written.</p>
</td></tr>
<tr><td><code id="plot_nhdplus_+3A_plot_config">plot_config</code></td>
<td>
<p>list containing plot configuration, see details.</p>
</td></tr>
<tr><td><code id="plot_nhdplus_+3A_basemap">basemap</code></td>
<td>
<p>character indicating which basemap type to use. Chose from:
<a href="maptiles.html#topic+get_tiles">get_tiles</a>.</p>
</td></tr>
<tr><td><code id="plot_nhdplus_+3A_zoom">zoom</code></td>
<td>
<p>integer passed on to <a href="maptiles.html#topic+get_tiles">get_tiles</a>. This value will
override the default set by the package.</p>
</td></tr>
<tr><td><code id="plot_nhdplus_+3A_add">add</code></td>
<td>
<p>boolean should this plot be added to an already built map.</p>
</td></tr>
<tr><td><code id="plot_nhdplus_+3A_actually_plot">actually_plot</code></td>
<td>
<p>boolean actually draw the plot? Use to get data subset only.</p>
</td></tr>
<tr><td><code id="plot_nhdplus_+3A_overwrite">overwrite</code></td>
<td>
<p>passed on the <a href="#topic+subset_nhdplus">subset_nhdplus</a>.</p>
</td></tr>
<tr><td><code id="plot_nhdplus_+3A_flowline_only">flowline_only</code></td>
<td>
<p>boolean only subset and plot flowlines only, default=FALSE</p>
</td></tr>
<tr><td><code id="plot_nhdplus_+3A_cache_data">cache_data</code></td>
<td>
<p>character path to rds file where all plot data can be cached.
If file doesn't exist, it will be created. If set to FALSE, all caching will
be turned off &ndash; this includes basemap tiles.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>plot_nhdplus supports several input specifications. An unexported function &quot;as_outlet&quot;
is used to convert the outlet formats as described below.
</p>

<ol>
<li><p> if outlets is omitted, the bbox input is required and all nhdplus data
in the bounding box is plotted.
</p>
</li>
<li><p> If outlets is a list of integers, it is assumed to be NHDPlus IDs (comids)
and all upstream tributaries are plotted.
</p>
</li>
<li><p> if outlets is an integer vector, it is assumed to be all NHDPlus IDs (comids)
that should be plotted. Allows custom filtering.
</p>
</li>
<li><p> If outlets is a character vector, it is assumed to be NWIS site ids.
</p>
</li>
<li><p> if outlets is a list containing only characters, it is assumed to be a list
of nldi features and all upstream tributaries are plotted.
</p>
</li>
<li><p> if outlets is a data.frame with point geometry, a point in polygon match
is performed and upstream with tributaries from the identified catchments is plotted.
</p>
</li></ol>

<p>The <code>plot_config</code> parameter is a list with names &quot;basin&quot;, &quot;flowline&quot;, &quot;outlets&quot;,
&quot;network_wtbd&quot;, and &quot;off_network_wtbd&quot;.
The following shows the defaults that can be altered.
</p>

<ol>
<li><p> basin </p>
<pre>
    list(lwd = 1, col = NA, border = "black")</pre>
</li>
<li><p> flowline </p>
<pre>
    list(lwd = 1, col = "blue")</pre>
</li>
<li><p> outlets </p>
<pre>
   list(default = list(col = "black", border = NA, pch = 19, cex = 1),
        nwissite = list(col = "grey40", border = NA, pch = 17, cex = 1),
        huc12pp = list(col = "white", border = "black", pch = 22, cex = 1),
        wqp = list(col = "red", border = NA, pch = 20, cex = 1))</pre>
</li>
<li><p> network_wtbd  <code>list(lwd = 1, col = "lightblue", border = "black")</code>
</p>
</li>
<li><p> off_network_wtbd  <code>list(lwd = 1, col = "darkblue", border = "black")</code>
</p>
</li></ol>

<p>If adding additional layers to the plot, data must be projected to EPSG:3857 with
'sf::st_transform(x, 3857)' prior to adding to the plot.
</p>


<h3>Value</h3>

<p>data.frame plot data is returned invisibly in NAD83 Lat/Lon.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
options("rgdal_show_exportToProj4_warnings"="none")
# Beware plot_nhdplus caches data to the default location.
# If you do not want data in "user space" change the default.
old_dir &lt;- nhdplusTools::nhdplusTools_data_dir()
nhdplusTools_data_dir(tempdir())

plot_nhdplus("05428500")

plot_nhdplus("05428500", streamorder = 2)

plot_nhdplus(list(13293970, 13293750))

source(system.file("extdata/sample_data.R", package = "nhdplusTools"))

plot_nhdplus(list(13293970, 13293750), streamorder = 3, nhdplus_data = sample_data)

plot_nhdplus(list(list("comid", "13293970"),
                  list("nwissite", "USGS-05428500"),
                  list("huc12pp", "070900020603"),
                  list("huc12pp", "070900020602")),
             streamorder = 2,
             nhdplus_data = sample_data)


plot_nhdplus(sf::st_as_sf(data.frame(x = -89.36083,
                                     y = 43.08944),
                          coords = c("x", "y"), crs = 4326),
             streamorder = 2,
             nhdplus_data = sample_data)

plot_nhdplus(list(list("comid", "13293970"),
                  list("nwissite", "USGS-05428500"),
                  list("huc12pp", "070900020603"),
                  list("huc12pp", "070900020602")),
             streamorder = 2,
             nhdplus_data = sample_data,
             plot_config = list(basin = list(lwd = 2),
                                outlets = list(huc12pp = list(cex = 1.5),
                                               comid = list(col = "green"))))

bbox &lt;- sf::st_bbox(c(xmin = -89.43, ymin = 43, xmax = -89.28, ymax = 43.1),
                    crs = "+proj=longlat +datum=WGS84 +no_defs")

fline &lt;- sf::read_sf(sample_data, "NHDFlowline_Network")
comids &lt;- nhdplusTools::get_UT(fline, 13293970)

plot_nhdplus(comids)

#' # With Local Data
plot_nhdplus(bbox = bbox, nhdplus_data = sample_data)

# With downloaded data
plot_nhdplus(bbox = bbox, streamorder = 3)

# Can also plot on top of the previous!
plot_nhdplus(bbox = bbox, nhdplus_data = sample_data,
             plot_config = list(flowline = list(lwd = 0.5)))
plot_nhdplus(comids, nhdplus_data = sample_data, streamorder = 3, add = TRUE,
             plot_config = list(flowline = list(col = "darkblue")))

nhdplusTools::nhdplusTools_data_dir(old_dir)

</code></pre>

<hr>
<h2 id='prepare_nhdplus'>Prep NHDPlus Data</h2><span id='topic+prepare_nhdplus'></span>

<h3>Description</h3>

<p>Function to prep NHDPlus data for use by nhdplusTools functions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prepare_nhdplus(
  flines,
  min_network_size = 0,
  min_path_length = 0,
  min_path_size = 0,
  purge_non_dendritic = TRUE,
  warn = TRUE,
  error = TRUE,
  skip_toCOMID = FALSE,
  align_names = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="prepare_nhdplus_+3A_flines">flines</code></td>
<td>
<p>data.frame NHDPlus flowlines including:
COMID, LENGTHKM, FTYPE (or FCODE), TerminalFl, FromNode, ToNode, TotDASqKM,
StartFlag, StreamOrde, StreamCalc, TerminalPa, Pathlength,
and Divergence variables.</p>
</td></tr>
<tr><td><code id="prepare_nhdplus_+3A_min_network_size">min_network_size</code></td>
<td>
<p>numeric Minimum size (sqkm) of drainage network
to include in output.</p>
</td></tr>
<tr><td><code id="prepare_nhdplus_+3A_min_path_length">min_path_length</code></td>
<td>
<p>numeric Minimum length (km) of terminal level
path of a network.</p>
</td></tr>
<tr><td><code id="prepare_nhdplus_+3A_min_path_size">min_path_size</code></td>
<td>
<p>numeric Minimum size (sqkm) of outlet level
path of a drainage basin. Drainage basins with an outlet drainage area
smaller than this will be removed.</p>
</td></tr>
<tr><td><code id="prepare_nhdplus_+3A_purge_non_dendritic">purge_non_dendritic</code></td>
<td>
<p>logical Should non dendritic paths be removed
or not.</p>
</td></tr>
<tr><td><code id="prepare_nhdplus_+3A_warn">warn</code></td>
<td>
<p>logical controls whether warning an status messages are printed</p>
</td></tr>
<tr><td><code id="prepare_nhdplus_+3A_error">error</code></td>
<td>
<p>logical controls whether to return potentially invalid data with a warning rather than an error</p>
</td></tr>
<tr><td><code id="prepare_nhdplus_+3A_skip_tocomid">skip_toCOMID</code></td>
<td>
<p>logical if TRUE, toCOMID will not be added to output.</p>
</td></tr>
<tr><td><code id="prepare_nhdplus_+3A_align_names">align_names</code></td>
<td>
<p>logical</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame ready to be used with the refactor_flowlines function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
source(system.file("extdata", "sample_flines.R", package = "nhdplusTools"))

prepare_nhdplus(sample_flines,
                min_network_size = 10,
                min_path_length = 1,
                warn = FALSE)

</code></pre>

<hr>
<h2 id='query_usgs_geoserver'>Query USGS Geoserver</h2><span id='topic+query_usgs_geoserver'></span>

<h3>Description</h3>

<p>Query the USGS  geoserver for spatial data by location,
area, or ID.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>query_usgs_geoserver(
  AOI = NULL,
  ids = NULL,
  type = NULL,
  filter = NULL,
  t_srs = NULL,
  buffer = 0.5
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="query_usgs_geoserver_+3A_aoi">AOI</code></td>
<td>
<p>sf (MULTI)POINT or (MULTI)POLYGON. An 'area of interest' can
be provided as either a location (sf POINT) or area (sf POLYGON)
in any Spatial Reference System.</p>
</td></tr>
<tr><td><code id="query_usgs_geoserver_+3A_ids">ids</code></td>
<td>
<p>character or numeric. A set of identifier(s) from the data
type requested, for example if NHD, then a set of COMID(s).</p>
</td></tr>
<tr><td><code id="query_usgs_geoserver_+3A_type">type</code></td>
<td>
<p>character. Type of feature to return
('huc08','huc12', 'nhd', 'catchment', 'waterbodies', 'gagesII').
If NULL (default) a data.frame of available resources is returned</p>
</td></tr>
<tr><td><code id="query_usgs_geoserver_+3A_filter">filter</code></td>
<td>
<p>character. An XML filter to pass to httr POST query</p>
</td></tr>
<tr><td><code id="query_usgs_geoserver_+3A_t_srs">t_srs</code></td>
<td>
<p>character (PROJ string or EPSG code) or numeric (EPSG code).
A user specified - target -Spatial Reference System (SRS/CRS) for returned objects.
Will default to the CRS of the input AOI if provided, and to 4326 for ID requests.</p>
</td></tr>
<tr><td><code id="query_usgs_geoserver_+3A_buffer">buffer</code></td>
<td>
<p>numeric. The amount (in meters) to buffer a POINT AOI by for an
extended search. Default = 0.5</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The returned object(s) will have the same
Spatial Reference System (SRS) as the input AOI. If a individual or set of
IDs are used to query, then the default geoserver CRS of EPSG:4326 is
preserved. In all cases, a user-defined SRS can be passed to <code>t_srs</code>
which will override all previous SRS (either input or default).
All buffer and distance operations are handled internally using in
EPSG:5070 Albers Equal Area projection
</p>


<h3>Value</h3>

<p>a simple features (sf) object
</p>

<hr>
<h2 id='reexports'>Objects exported from other packages</h2><span id='topic+reexports'></span><span id='topic+st_compatibalize'></span><span id='topic+rename_geometry'></span><span id='topic+get_node'></span><span id='topic+fix_flowdir'></span><span id='topic+rescale_measures'></span><span id='topic+get_hydro_location'></span><span id='topic+get_partial_length'></span>

<h3>Description</h3>

<p>These objects are imported from other packages. Follow the links
below to see their documentation.
</p>

<dl>
<dt>hydroloom</dt><dd><p><code><a href="hydroloom.html#topic+fix_flowdir">fix_flowdir</a></code>, <code><a href="hydroloom.html#topic+get_hydro_location">get_hydro_location</a></code>, <code><a href="hydroloom.html#topic+get_node">get_node</a></code>, <code><a href="hydroloom.html#topic+get_partial_length">get_partial_length</a></code>, <code><a href="hydroloom.html#topic+rename_geometry">rename_geometry</a></code>, <code><a href="hydroloom.html#topic+rescale_measures">rescale_measures</a></code>, <code><a href="hydroloom.html#topic+st_compatibalize">st_compatibalize</a></code></p>
</dd>
</dl>

<hr>
<h2 id='rescale_catchment_characteristics'>Rescale Catchment Characteristics</h2><span id='topic+rescale_catchment_characteristics'></span>

<h3>Description</h3>

<p>Given catchment characteristics to retrieve or process will
aggregate and / or split the characteristics according to a lookup table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rescale_catchment_characteristics(
  vars,
  lookup_table,
  refactored_areas = NULL,
  catchment_characteristics = NULL,
  catchment_areas = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rescale_catchment_characteristics_+3A_vars">vars</code></td>
<td>
<p>data.frame containing 'characteristic_id' retrieved from
<a href="#topic+get_characteristics_metadata">get_characteristics_metadata</a> and 'summary_statistic' indicating
which summary statistic should be applied to rescale each characteristic.
Accepted values are &quot;sum,&quot; &quot;length_weighted_mean,&quot; &quot;area_weighted_mean,&quot;
&quot;min,&quot; and &quot;max.&quot;</p>
</td></tr>
<tr><td><code id="rescale_catchment_characteristics_+3A_lookup_table">lookup_table</code></td>
<td>
<p>data.frame containing 'id' numeric vector of identifiers
at the desired scale; &quot;comid&quot; is a numeric vector of NHDPlusV2 identifiers;
&quot;member_comid&quot; contains formatted NHDPlusV2 COMIDs indicating that the
catchments in question need to be split. If catchments have not been split,
the columns &quot;comid&quot; and &quot;member_comid&quot; should be identical.</p>
</td></tr>
<tr><td><code id="rescale_catchment_characteristics_+3A_refactored_areas">refactored_areas</code></td>
<td>
<p>data.frame containing columns &quot;featureid&quot; and &quot;areasqkm.&quot;
Used to retrieve adjusted catchment areas in the case of split catchments. If
not provided, either no split catchments can be considered or the 'catchment_areas'
parameter is required.</p>
</td></tr>
<tr><td><code id="rescale_catchment_characteristics_+3A_catchment_characteristics">catchment_characteristics</code></td>
<td>
<p>data.frame containing columns
&quot;characteristic_id&quot;, &quot;comid&quot;, &quot;characteristic_value&quot;, and &quot;percent_nodata&quot;.
If not provided, it will be retrieved from <a href="#topic+get_catchment_characteristics">get_catchment_characteristics</a>
using the characteristic ids from 'vars' and the comids from 'lookup_table'.</p>
</td></tr>
<tr><td><code id="rescale_catchment_characteristics_+3A_catchment_areas">catchment_areas</code></td>
<td>
<p>data.frame containing columns &quot;comid&quot;, &quot;areasqkm&quot;,
&quot;split_catchment_areasqkm&quot;, and &quot;split_area_prop&quot;. If not provided, it will
be retrieved from 'refactored_areas' and/or <a href="#topic+get_vaa">get_vaa</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>NOTE: Since this algorithm works on catchment characteristics that are
spatial averages, when splitting, the average condition is apportioned evenly
to each split. In some cases, such as with land cover or elevation, this may
not be appropriate and source data should be used to derive new characteristics.
In addition, this function handles catchment areas for split catchments but
makes no adjustments for the length of flowlines in those catchments.
Therefore, requests for length-weighted mean values may not be appropriate
when working with split catchments.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
vars &lt;- data.frame(characteristic_id = c("CAT_IMPV11","CAT_BASIN_AREA"),
                   summary_statistic = c("area_weighted_mean","sum"))
lookup_table &lt;- data.frame(id = rep(10012268, 2),
                           comid = c(4146596, 4147382),
                           member_comid = c(4146596, 4147382))
rescale_catchment_characteristics(vars, lookup_table)

vars &lt;- data.frame(characteristic_id = c("CAT_ELEV_MIN","CAT_ELEV_MAX"),
                   summary_statistic = c("min","max"))
lookup_table &lt;- data.frame(id = rep(10012268, 2),
                           comid = c(4146596, 4147382),
                           member_comid = c(4146596, 4147382))
rescale_catchment_characteristics(vars, lookup_table)

vars &lt;- data.frame(characteristic_id = c("CAT_EWT","CAT_TWI", "CAT_BASIN_AREA"),
                   summary_statistic = c("area_weighted_mean", "area_weighted_mean","sum"))
lookup_table &lt;- data.frame(id = c(10012268, 10012268, 10024047, 10024048),
                           comid = c(4146596, 4147382, 4147396, 4147396),
                           member_comid = c("4146596", "4147382", "4147396.1", "4147396.2"))
comid_areas &lt;- data.frame(featureid = c("4146596", "4147382", "4147396.1", "4147396.2"),
                               areasqkm = c(0.9558, 11.9790, 6.513294, 1.439999))
rescale_catchment_characteristics(vars, lookup_table, refactored_areas = comid_areas)

 

</code></pre>

<hr>
<h2 id='rpu_boundaries'>RPU Boundaries
Raster Processing Unit boundaries</h2><span id='topic+rpu_boundaries'></span>

<h3>Description</h3>

<p>RPU Boundaries
Raster Processing Unit boundaries
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rpu_boundaries
</code></pre>


<h3>Format</h3>

<p>An object of class <code>"sf"</code>
</p>

<hr>
<h2 id='subset_nhdplus'>Subset NHDPlus</h2><span id='topic+subset_nhdplus'></span>

<h3>Description</h3>

<p>Saves a subset of the National Seamless database or other
nhdplusTools compatible data based on a specified collection of COMIDs.
This function uses <code><a href="#topic+get_nhdplus">get_nhdplus</a></code> for the &quot;download&quot; data
source but returns data consistent with local data subsets in a subset
file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>subset_nhdplus(
  comids = NULL,
  output_file = NULL,
  nhdplus_data = NULL,
  bbox = NULL,
  simplified = TRUE,
  overwrite = FALSE,
  return_data = TRUE,
  status = TRUE,
  flowline_only = NULL,
  streamorder = NULL,
  out_prj = 4269
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="subset_nhdplus_+3A_comids">comids</code></td>
<td>
<p>integer vector of COMIDs to include.</p>
</td></tr>
<tr><td><code id="subset_nhdplus_+3A_output_file">output_file</code></td>
<td>
<p>character path to save the output to defaults
to the directory of the nhdplus_data.</p>
</td></tr>
<tr><td><code id="subset_nhdplus_+3A_nhdplus_data">nhdplus_data</code></td>
<td>
<p>character path to the .gpkg or .gdb containing
the national seamless database, a subset of NHDPlusHR,
or &quot;download&quot; to use a web service to download NHDPlusV2.1 data.
Not required if <code><a href="#topic+nhdplus_path">nhdplus_path</a></code> has been set or the default
has been adopted. See details for more.</p>
</td></tr>
<tr><td><code id="subset_nhdplus_+3A_bbox">bbox</code></td>
<td>
<p>object of class &quot;bbox&quot; as returned by sf::st_bbox in Latitude/Longitude.
If no CRS is present, will be assumed to be in WGS84 Latitude Longitude.</p>
</td></tr>
<tr><td><code id="subset_nhdplus_+3A_simplified">simplified</code></td>
<td>
<p>boolean if TRUE (the default) the CatchmentSP layer
will be included. Not relevant to the &quot;download&quot; option or NHDPlusHR data.</p>
</td></tr>
<tr><td><code id="subset_nhdplus_+3A_overwrite">overwrite</code></td>
<td>
<p>boolean should the output file be overwritten</p>
</td></tr>
<tr><td><code id="subset_nhdplus_+3A_return_data">return_data</code></td>
<td>
<p>boolean if FALSE path to output file is returned silently otherwise
data is returned in a list.</p>
</td></tr>
<tr><td><code id="subset_nhdplus_+3A_status">status</code></td>
<td>
<p>boolean should the function print status messages</p>
</td></tr>
<tr><td><code id="subset_nhdplus_+3A_flowline_only">flowline_only</code></td>
<td>
<p>boolean WARNING: experimental
if TRUE only the flowline network and attributes will be returned</p>
</td></tr>
<tr><td><code id="subset_nhdplus_+3A_streamorder">streamorder</code></td>
<td>
<p>integer only streams of order greater than or equal will be downloaded.
Not implemented for local data.</p>
</td></tr>
<tr><td><code id="subset_nhdplus_+3A_out_prj">out_prj</code></td>
<td>
<p>character override the default output CRS of NAD83 lat/lon (EPSG:4269)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function relies on the National Seamless Geodatabase or Geopackage.
It can be downloaded
<a href="https://www.epa.gov/waterdata/nhdplus-national-data">here.</a>
</p>
<p>The &quot;download&quot; option of this function should be considered preliminary
and subject to revision. It does not include as many layers and may not
be available permanently.
</p>


<h3>Value</h3>

<p>character path to the saved subset geopackage
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

source(system.file("extdata/sample_data.R", package = "nhdplusTools"))

nhdplus_path(sample_data)

sample_flines &lt;- sf::st_zm(sf::read_sf(nhdplus_path(), "NHDFlowline_Network"))

plot(sf::st_geometry(sample_flines),
     lwd = 3)

start_point &lt;- sf::st_sfc(sf::st_point(c(-89.362239, 43.090266)),
                          crs = 4326)

plot(start_point, cex = 1.5, lwd = 2, col = "red", add = TRUE)

start_comid &lt;- discover_nhdplus_id(start_point)

comids &lt;- get_UT(sample_flines, start_comid)

plot(sf::st_geometry(dplyr::filter(sample_flines, COMID %in% comids)),
     add=TRUE, col = "red", lwd = 2)

output_file &lt;- tempfile(fileext = ".gpkg")

subset_nhdplus(comids = comids,
               output_file = output_file,
               nhdplus_data = sample_data,
               overwrite = TRUE,
               status = TRUE)

sf::st_layers(output_file)

catchment &lt;- sf::read_sf(output_file, "CatchmentSP")

plot(sf::st_geometry(catchment), add = TRUE)

waterbody &lt;- sf::read_sf(output_file, "NHDWaterbody")

plot(sf::st_geometry(waterbody),
     col = rgb(0, 0, 1, alpha = 0.5), add = TRUE)

# Cleanup temp
unlink(output_file)

# Download Option:
subset_nhdplus(comids = comids,
               output_file = output_file,
               nhdplus_data = "download",
               overwrite = TRUE,
               status = TRUE, flowline_only = FALSE)

sf::st_layers(output_file)

# NHDPlusHR
source(system.file("extdata/nhdplushr_data.R", package = "nhdplusTools"))

up_ids &lt;- get_UT(hr_data$NHDFlowline, 15000500028335)

sub_gpkg &lt;- file.path(work_dir, "sub.gpkg")
sub_nhdhr &lt;- subset_nhdplus(up_ids, output_file = sub_gpkg,
                            nhdplus_data = hr_gpkg, overwrite = TRUE)

sf::st_layers(sub_gpkg)
names(sub_nhdhr)

plot(sf::st_geometry(hr_data$NHDFlowline), lwd = 0.5)
plot(sf::st_geometry(sub_nhdhr$NHDFlowline), lwd = 0.6, col = "red", add = TRUE)

unlink(output_file)
unlink(sub_gpkg)



</code></pre>

<hr>
<h2 id='subset_rpu'>Subset by Raster Processing Unit</h2><span id='topic+subset_rpu'></span>

<h3>Description</h3>

<p>Given flowlines and an rpu_code, performs a network-safe subset such
that the result can be used in downstream processing. Has been tested to work
against the entire NHDPlusV2 domain and satisfies a number of edge cases.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>subset_rpu(fline, rpu, run_make_standalone = TRUE, strict = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="subset_rpu_+3A_fline">fline</code></td>
<td>
<p>sf data.frame NHD Flowlines with comid, pathlength, lengthkm,
hydroseq, levelpathi, rpuid, and arbolatesu (dnhydroseq
is required if tocomid is not provided).</p>
</td></tr>
<tr><td><code id="subset_rpu_+3A_rpu">rpu</code></td>
<td>
<p>character e.g. &quot;01a&quot;</p>
</td></tr>
<tr><td><code id="subset_rpu_+3A_run_make_standalone">run_make_standalone</code></td>
<td>
<p>logical default TRUE
should the run_make_standalone function be run on result?</p>
</td></tr>
<tr><td><code id="subset_rpu_+3A_strict">strict</code></td>
<td>
<p>logical if TRUE, paths that extend outside the RPU but
have no tributaries in the upstream RPU will be included in the output.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame containing subset network
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
source(system.file("extdata/sample_data.R", package = "nhdplusTools"))

sample_flines &lt;- sf::read_sf(sample_data, "NHDFlowline_Network")

subset_rpu(sample_flines, rpu = "07b")

</code></pre>

<hr>
<h2 id='subset_vpu'>Subset by Vector Processing Unit</h2><span id='topic+subset_vpu'></span>

<h3>Description</h3>

<p>Calls <a href="#topic+subset_rpu">subset_rpu</a> for all raster processing units for the
requested vector processing unit.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>subset_vpu(fline, vpu, include_null_rpuid = TRUE, run_make_standalone = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="subset_vpu_+3A_fline">fline</code></td>
<td>
<p>sf data.frame NHD Flowlines with comid, pathlength, lengthkm,
hydroseq, levelpathi, rpuid, vpuid, and arbolatesu
(dnhydroseq is required if tocomid is not provided).</p>
</td></tr>
<tr><td><code id="subset_vpu_+3A_vpu">vpu</code></td>
<td>
<p>character e.g. &quot;01&quot;</p>
</td></tr>
<tr><td><code id="subset_vpu_+3A_include_null_rpuid">include_null_rpuid</code></td>
<td>
<p>logical default TRUE. Note that there are some
flowlines that may have a NULL rpuid but be included in the vector
processing unit.</p>
</td></tr>
<tr><td><code id="subset_vpu_+3A_run_make_standalone">run_make_standalone</code></td>
<td>
<p>logical default TRUE
should the run_make_standalone function be run on result?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame containing subset network
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
source(system.file("extdata/sample_data.R", package = "nhdplusTools"))

sample_flines &lt;- sf::read_sf(sample_data, "NHDFlowline_Network")

subset_vpu(sample_flines, "07")

</code></pre>

<hr>
<h2 id='vpu_boundaries'>VPU Boundaries
Vector Processing Unit boundaries</h2><span id='topic+vpu_boundaries'></span>

<h3>Description</h3>

<p>VPU Boundaries
Vector Processing Unit boundaries
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vpu_boundaries
</code></pre>


<h3>Format</h3>

<p>An object of class <code>"sf"</code>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
