<!DOCTYPE html><html><head><title>Help for package wru</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {wru}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#.name_preproc'><p>Pre-process vector of names to match census style. Internal function</p></a></li>
<li><a href='#as_fips_code'><p>Convert between state names, postal abbreviations, and FIPS codes</p></a></li>
<li><a href='#census_data_preflight'><p>Preflight census data</p></a></li>
<li><a href='#census_geo_api'><p>Census Data download function.</p></a></li>
<li><a href='#census_geo_api_names'><p>Census geo API helper functions</p></a></li>
<li><a href='#census_helper'><p>Census helper function.</p></a></li>
<li><a href='#census_helper_new'><p>Census helper function.</p></a></li>
<li><a href='#format_legacy_data'><p>Legacy data formatting function.</p></a></li>
<li><a href='#get_census_api'><p>Census API function.</p></a></li>
<li><a href='#get_census_api_2'><p>Census API URL assembler.</p></a></li>
<li><a href='#get_census_data'><p>Multilevel Census data download function.</p></a></li>
<li><a href='#merge_names'><p>Surname probability merging function.</p></a></li>
<li><a href='#merge_surnames'><p>Surname probability merging function.</p></a></li>
<li><a href='#modfuns'><p>Internal model fitting functions</p></a></li>
<li><a href='#predict_race'><p>Race prediction function.</p></a></li>
<li><a href='#sample_me'><p>Collapsed Gibbs sampler for hWRU. Internal function</p></a></li>
<li><a href='#state_fips'><p>Dataset with FIPS codes for US states</p></a></li>
<li><a href='#surnames2000'><p>Census Surname List (2000).</p></a></li>
<li><a href='#surnames2010'><p>Census Surname List (2010).</p></a></li>
<li><a href='#vec_to_chunk'><p>Variable vector into chunks.</p></a></li>
<li><a href='#voters'><p>Example voter file.</p></a></li>
<li><a href='#wru_data_preflight'><p>Preflight for name data</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Who are You? Bayesian Prediction of Racial Category Using
Surname, First Name, Middle Name, and Geolocation</td>
</tr>
<tr>
<td>Version:</td>
<td>3.0.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-04-04</td>
</tr>
<tr>
<td>Description:</td>
<td>Predicts individual race/ethnicity using surname, first name,
    middle name, geolocation, and other attributes, such as gender and
    age. The method utilizes Bayes' Rule (with optional measurement error
    correction) to compute the posterior probability of each racial
    category for any given individual. The package implements methods
    described in Imai and Khanna (2016) "Improving Ecological Inference by
    Predicting Individual Ethnicity from Voter Registration Records"
    Political Analysis &lt;<a href="https://doi.org/10.1093%2Fpan%2Fmpw001">doi:10.1093/pan/mpw001</a>&gt; and Imai, Olivella, and
    Rosenman (2022) "Addressing census data problems in race imputation
    via fully Bayesian Improved Surname Geocoding and name supplements"
    &lt;<a href="https://doi.org/10.1126%2Fsciadv.adc9824">doi:10.1126/sciadv.adc9824</a>&gt;.  The package also incorporates the data
    described in Rosenman, Olivella, and Imai (2023) "Race and ethnicity
    data for first, middle, and surnames"
    &lt;<a href="https://doi.org/10.1038%2Fs41597-023-02202-2">doi:10.1038/s41597-023-02202-2</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/kosukeimai/wru">https://github.com/kosukeimai/wru</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/kosukeimai/wru/issues">https://github.com/kosukeimai/wru/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1.0), utils</td>
</tr>
<tr>
<td>Imports:</td>
<td>cli, dplyr, tidyr, furrr, future, piggyback (&ge; 0.1.4),
PL94171, purrr, Rcpp, rlang</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, testthat (&ge; 3.0.0), tidycensus</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>yes</td>
</tr>
<tr>
<td>LazyDataCompression:</td>
<td>xz</td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-04-04 04:37:33 UTC; beb</td>
</tr>
<tr>
<td>Author:</td>
<td>Kabir Khanna [aut],
  Brandon Bertelsen [aut, cre],
  Santiago Olivella [aut],
  Evan Rosenman [aut],
  Alexander Rossell Hayes [aut],
  Kosuke Imai [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Brandon Bertelsen &lt;brandon@bertelsen.ca&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-04-04 04:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='.name_preproc'>Pre-process vector of names to match census style. Internal function</h2><span id='topic+.name_preproc'></span>

<h3>Description</h3>

<p>Pre-process vector of names to match census style. Internal function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.name_preproc(voter_names, target_names)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id=".name_preproc_+3A_voter_names">voter_names</code></td>
<td>
<p>Character vector to be pre-processed.</p>
</td></tr>
<tr><td><code id=".name_preproc_+3A_target_names">target_names</code></td>
<td>
<p>Character vector of census names to be matched.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character vector of pre-processed named
</p>

<hr>
<h2 id='as_fips_code'>Convert between state names, postal abbreviations, and FIPS codes</h2><span id='topic+as_fips_code'></span><span id='topic+as_state_abbreviation'></span>

<h3>Description</h3>

<p>Convert between state names, postal abbreviations, and FIPS codes
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as_fips_code(x)

as_state_abbreviation(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="as_fips_code_+3A_x">x</code></td>
<td>
<p>A <a href="base.html#topic+numeric">numeric</a> or <a href="base.html#topic+character">character</a> vector of state names,
postal abbreviations, or FIPS codes.
Matches for state names and abbreviations are not case sensitive.
FIPS codes may be matched from numeric or character vectors,
with or without leading zeroes.</p>
</td></tr>
</table>


<h3>Value</h3>


<dl>
<dt><code>as_state_fips_code()</code></dt><dd>
<p>A <a href="base.html#topic+character">character</a> vector of two-digit FIPS codes.
One-digit FIPS codes are prefixed with a leading zero,
e.g., <code>"06"</code> for California.
</p>
</dd>
<dt><code>as_state_abbreviation()</code></dt><dd>
<p>A <a href="base.html#topic+character">character</a> vector of two-letter postal abbreviations,
e.g., <code>"CA"</code> for California.
</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>as_fips_code("california")
as_state_abbreviation("california")

# Character vector matches ignore case
as_fips_code(c("DC", "Md", "va"))
as_state_abbreviation(c("district of columbia", "Maryland", "VIRGINIA"))

# Note that `3` and `7` are standardized to `NA`,
# because no state is assigned those FIPS codes
as_fips_code(1:10)
as_state_abbreviation(1:10)

# You can even mix methods in the same vector
as_fips_code(c("utah", "NM", 8, "04"))
as_state_abbreviation(c("utah", "NM", 8, "04"))

</code></pre>

<hr>
<h2 id='census_data_preflight'>Preflight census data</h2><span id='topic+census_data_preflight'></span>

<h3>Description</h3>

<p>Preflight census data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>census_data_preflight(census.data, census.geo, year)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="census_data_preflight_+3A_census.data">census.data</code></td>
<td>
<p>A list indexed by two-letter state abbreviations,
which contains pre-saved Census geographic data.
Can be generated using <code>get_census_data</code> function.</p>
</td></tr>
<tr><td><code id="census_data_preflight_+3A_census.geo">census.geo</code></td>
<td>
<p>An optional character vector specifying what level of
geography to use to merge in U.S. Census geographic data. Currently
<code>"county"</code>, <code>"tract"</code>, <code>"block_group"</code>, <code>"block"</code>, and <code>"place"</code>
are supported.
Note: sufficient information must be in user-defined <code><var>voter.file</var></code> object.
If <code><var>census.geo</var> = "county"</code>, then <code><var>voter.file</var></code>
must have column named <code>county</code>.
If <code><var>census.geo</var> = "tract"</code>, then <code><var>voter.file</var></code>
must have columns named <code>county</code> and <code>tract</code>.
And if <code><var>census.geo</var> = "block"</code>, then <code><var>voter.file</var></code>
must have columns named <code>county</code>, <code>tract</code>, and <code>block</code>.
If <code><var>census.geo</var> = "place"</code>, then <code><var>voter.file</var></code>
must have column named <code>place</code>.
If <code>census.geo = "zcta"</code>, then <code>voter.file</code> must have column named <code>zcta</code>.
Specifying <code><var>census.geo</var></code> will call <code>census_helper</code> function
to merge Census geographic data at specified level of geography.</p>
</td></tr>
<tr><td><code id="census_data_preflight_+3A_year">year</code></td>
<td>
<p>An optional character vector specifying the year of U.S. Census geographic
data to be downloaded. Use <code>"2010"</code>, or <code>"2020"</code>. Default is <code>"2020"</code>.</p>
</td></tr>
</table>

<hr>
<h2 id='census_geo_api'>Census Data download function.</h2><span id='topic+census_geo_api'></span>

<h3>Description</h3>

<p><code>census_geo_api</code> retrieves U.S. Census geographic data for a given state.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>census_geo_api(
  key = Sys.getenv("CENSUS_API_KEY"),
  state,
  geo = c("tract", "block", "block_group", "county", "place", "zcta"),
  age = FALSE,
  sex = FALSE,
  year = c("2020", "2010"),
  retry = 3,
  save_temp = NULL,
  counties = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="census_geo_api_+3A_key">key</code></td>
<td>
<p>A character string containing a valid Census API key,
which can be requested from the
<a href="https://api.census.gov/data/key_signup.html">U.S. Census API key signup page</a>.
</p>
<p>By default, attempts to find a census key stored in an
<a href="base.html#topic+Sys.getenv">environment variable</a> named <code>CENSUS_API_KEY</code>.</p>
</td></tr>
<tr><td><code id="census_geo_api_+3A_state">state</code></td>
<td>
<p>A required character object specifying which state to extract Census data for,
e.g., <code>"NJ"</code>.</p>
</td></tr>
<tr><td><code id="census_geo_api_+3A_geo">geo</code></td>
<td>
<p>A character object specifying what aggregation level to use.
Use <code>"block"</code>, <code>"block_group"</code>, <code>"county"</code>, <code>"place"</code>, <code>"tract"</code>, or <code>"zcta"</code>.
Default is <code>"tract"</code>. Warning: extracting block-level data takes very long.</p>
</td></tr>
<tr><td><code id="census_geo_api_+3A_age">age</code></td>
<td>
<p>A <code>TRUE</code>/<code>FALSE</code> object indicating whether to condition on
age or not. If <code>FALSE</code> (default), function will return Pr(Geolocation | Race).
If <code>TRUE</code>, function will return Pr(Geolocation, Age | Race).
If <code><var>sex</var></code> is also <code>TRUE</code>, function will return Pr(Geolocation, Age, Sex | Race).</p>
</td></tr>
<tr><td><code id="census_geo_api_+3A_sex">sex</code></td>
<td>
<p>A <code>TRUE</code>/<code>FALSE</code> object indicating whether to condition on
sex or not. If <code>FALSE</code> (default), function will return Pr(Geolocation | Race).
If <code>TRUE</code>, function will return Pr(Geolocation, Sex | Race).
If <code><var>age</var></code> is also <code>TRUE</code>, function will return Pr(Geolocation, Age, Sex | Race).</p>
</td></tr>
<tr><td><code id="census_geo_api_+3A_year">year</code></td>
<td>
<p>A character object specifying the year of U.S. Census data to be downloaded.
Use <code>"2010"</code>, or <code>"2020"</code>. Default is <code>"2020"</code>.
Warning: 2020 U.S. Census data is downloaded only when <code><var>age</var></code> and
<code><var>sex</var></code> are both <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="census_geo_api_+3A_retry">retry</code></td>
<td>
<p>The number of retries at the census website if network interruption occurs.</p>
</td></tr>
<tr><td><code id="census_geo_api_+3A_save_temp">save_temp</code></td>
<td>
<p>File indicating where to save the temporary outputs.
Defaults to NULL. If specified, the function will look for an .RData file
with the same format as the expected output.</p>
</td></tr>
<tr><td><code id="census_geo_api_+3A_counties">counties</code></td>
<td>
<p>A vector of counties contained in your data. If <code>NULL</code>, all counties are pulled.
Useful for smaller predictions where only a few counties are considered. Must be zero padded.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function allows users to download U.S. Census geographic data (2010 or 2020),
at either the county, tract, block, or place level, for a particular state.
</p>


<h3>Value</h3>

<p>Output will be an object of class <code>list</code>, indexed by state names. It will
consist of the original user-input data with additional columns of Census geographic data.
</p>


<h3>References</h3>

<p>Relies on <code>get_census_api()</code>, <code>get_census_api_2()</code>, and <code>vec_to_chunk()</code> functions authored by Nicholas Nagle,
available <a href="https://rstudio-pubs-static.s3.amazonaws.com/19337_2e7f827190514c569ea136db788ce850.html">here</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: census_geo_api(states = c("NJ", "DE"), geo = "block")
## Not run: census_geo_api(states = "FL", geo = "tract", age = TRUE, sex = TRUE)
## Not run: census_geo_api(states = "MA", geo = "place", age = FALSE, sex = FALSE,
 year = "2020")
## End(Not run)

</code></pre>

<hr>
<h2 id='census_geo_api_names'>Census geo API helper functions</h2><span id='topic+census_geo_api_names'></span><span id='topic+census_geo_api_url'></span>

<h3>Description</h3>

<p>Census geo API helper functions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>census_geo_api_names(
  year = c("2020", "2010", "2000"),
  age = FALSE,
  sex = FALSE
)

census_geo_api_url(year = c("2020", "2010", "2000"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="census_geo_api_names_+3A_year">year</code></td>
<td>
<p>A character object specifying the year of U.S. Census data to be downloaded.
Use <code>"2010"</code>, or <code>"2020"</code>. Default is <code>"2020"</code>.
Warning: 2020 U.S. Census data is downloaded only when <code><var>age</var></code> and
<code><var>sex</var></code> are both <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="census_geo_api_names_+3A_age">age</code></td>
<td>
<p>A <code>TRUE</code>/<code>FALSE</code> object indicating whether to condition on
age or not. If <code>FALSE</code> (default), function will return Pr(Geolocation | Race).
If <code>TRUE</code>, function will return Pr(Geolocation, Age | Race).
If <code><var>sex</var></code> is also <code>TRUE</code>, function will return Pr(Geolocation, Age, Sex | Race).</p>
</td></tr>
<tr><td><code id="census_geo_api_names_+3A_sex">sex</code></td>
<td>
<p>A <code>TRUE</code>/<code>FALSE</code> object indicating whether to condition on
sex or not. If <code>FALSE</code> (default), function will return Pr(Geolocation | Race).
If <code>TRUE</code>, function will return Pr(Geolocation, Sex | Race).
If <code><var>age</var></code> is also <code>TRUE</code>, function will return Pr(Geolocation, Age, Sex | Race).</p>
</td></tr>
</table>


<h3>Value</h3>


<dl>
<dt><code>census_geo_api_names()</code></dt><dd>
<p>A named list of <a href="base.html#topic+character">character</a> vectors whose values correspond to columns
of a Census API table and whose names represent the new columns they are
used to calculate in <code><a href="#topic+census_geo_api">census_geo_api()</a></code>.
</p>
</dd>
<dt><code>census_geo_api_url()</code></dt><dd>
<p>A <a href="base.html#topic+character">character</a> string containing the base of the URL to a
Census API table.
</p>
</dd>
</dl>


<hr>
<h2 id='census_helper'>Census helper function.</h2><span id='topic+census_helper'></span>

<h3>Description</h3>

<p><code>census_helper</code> links user-input dataset with Census geographic data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>census_helper(
  key = Sys.getenv("CENSUS_API_KEY"),
  voter.file,
  states = "all",
  geo = "tract",
  age = FALSE,
  sex = FALSE,
  year = "2020",
  census.data = NULL,
  retry = 3,
  use.counties = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="census_helper_+3A_key">key</code></td>
<td>
<p>A character string containing a valid Census API key,
which can be requested from the
<a href="https://api.census.gov/data/key_signup.html">U.S. Census API key signup page</a>.
</p>
<p>By default, attempts to find a census key stored in an
<a href="base.html#topic+Sys.getenv">environment variable</a> named <code>CENSUS_API_KEY</code>.</p>
</td></tr>
<tr><td><code id="census_helper_+3A_voter.file">voter.file</code></td>
<td>
<p>An object of class <code>data.frame</code>. Must contain field(s) named
<code><var>county</var></code>, <code><var>tract</var></code>, <code><var>block</var></code>, and/or <code><var>place</var></code>
specifying geolocation. These should be character variables that match up with
U.S. Census categories. County should be three characters (e.g., &quot;031&quot; not &quot;31&quot;),
tract should be six characters, and block should be four characters.
Place should be five characters if it is included.</p>
</td></tr>
<tr><td><code id="census_helper_+3A_states">states</code></td>
<td>
<p>A character vector specifying which states to extract
Census data for, e.g. <code>c("NJ", "NY")</code>. Default is <code>"all"</code>, which extracts
Census data for all states contained in user-input data.</p>
</td></tr>
<tr><td><code id="census_helper_+3A_geo">geo</code></td>
<td>
<p>A character object specifying what aggregation level to use.
Use <code>"county"</code>, <code>"tract"</code>, <code>"block"</code> or <code>"place"</code>. Default is <code>"tract"</code>.
Warning: extracting block-level data takes very long.</p>
</td></tr>
<tr><td><code id="census_helper_+3A_age">age</code></td>
<td>
<p>A <code>TRUE</code>/<code>FALSE</code> object indicating whether to condition on
age or not. If <code>FALSE</code> (default), function will return Pr(Geolocation | Race).
If <code>TRUE</code>, function will return Pr(Geolocation, Age | Race).
If <code><var>sex</var></code> is also <code>TRUE</code>, function will return Pr(Geolocation, Age, Sex | Race).</p>
</td></tr>
<tr><td><code id="census_helper_+3A_sex">sex</code></td>
<td>
<p>A <code>TRUE</code>/<code>FALSE</code> object indicating whether to condition on
sex or not. If <code>FALSE</code> (default), function will return Pr(Geolocation | Race).
If <code>TRUE</code>, function will return Pr(Geolocation, Sex | Race).
If <code><var>age</var></code> is also <code>TRUE</code>, function will return Pr(Geolocation, Age, Sex | Race).</p>
</td></tr>
<tr><td><code id="census_helper_+3A_year">year</code></td>
<td>
<p>A character object specifying the year of U.S. Census data to be downloaded.
Use <code>"2010"</code>, or <code>"2020"</code>. Default is <code>"2020"</code>.
Warning: 2020 U.S. Census data is downloaded only when <code><var>age</var></code> and
<code><var>sex</var></code> are both <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="census_helper_+3A_census.data">census.data</code></td>
<td>
<p>A optional census object of class <code>list</code> containing
pre-saved Census geographic data. Can be created using <code>get_census_data</code> function.
If <code><var>census.data</var></code> is provided, the <code><var>age</var></code> element must have the same value
as the <code><var>age</var></code> option specified in this function (i.e., <code>TRUE</code> in both or
<code>FALSE</code> in both). Similarly, the <code><var>sex</var></code> element in the object provided in
<code><var>census.data</var></code> must have the same value as the <code><var>sex</var></code> option here.
Moreover, the <code><var>year</var></code> element in the object provided in <code><var>census.data</var></code>
must have the same value as the <code><var>year</var></code> option in the function (i.e., <code>"2010"</code>
in both or <code>"2020"</code> in both).
If <code><var>census.data</var></code> is missing, Census geographic data will be obtained via Census API.</p>
</td></tr>
<tr><td><code id="census_helper_+3A_retry">retry</code></td>
<td>
<p>The number of retries at the census website if network interruption occurs.</p>
</td></tr>
<tr><td><code id="census_helper_+3A_use.counties">use.counties</code></td>
<td>
<p>A logical, defaulting to FALSE. Should census data be filtered by counties available in <var>census.data</var>?</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function allows users to link their geocoded dataset (e.g., voter file)
with U.S. Census data (2010 or 2020). The function extracts Census Summary File data
at the county, tract, block, or place level. Census data calculated are
Pr(Geolocation | Race) where geolocation is county, tract, block, or place.
</p>


<h3>Value</h3>

<p>Output will be an object of class <code>data.frame</code>. It will
consist of the original user-input data with additional columns of
Census data.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
census_helper(voter.file = voters, states = "nj", geo = "block")

## End(Not run)
## Not run: 
census_helper(
  voter.file = voters, states = "all", geo = "tract",
  age = TRUE, sex = TRUE
)

## End(Not run)
## Not run: 
census_helper(
  voter.file = voters, states = "all", geo = "county",
  age = FALSE, sex = FALSE, year = "2020"
)

## End(Not run)

</code></pre>

<hr>
<h2 id='census_helper_new'>Census helper function.</h2><span id='topic+census_helper_new'></span>

<h3>Description</h3>

<p><code>census_helper_new</code> links user-input dataset with Census geographic data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>census_helper_new(
  key = Sys.getenv("CENSUS_API_KEY"),
  voter.file,
  states = "all",
  geo = c("tract", "block", "block_group", "county", "place", "zcta"),
  age = FALSE,
  sex = FALSE,
  year = "2020",
  census.data = NULL,
  retry = 3,
  use.counties = FALSE,
  skip_bad_geos = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="census_helper_new_+3A_key">key</code></td>
<td>
<p>A character string containing a valid Census API key,
which can be requested from the
<a href="https://api.census.gov/data/key_signup.html">U.S. Census API key signup page</a>.
</p>
<p>By default, attempts to find a census key stored in an
<a href="base.html#topic+Sys.getenv">environment variable</a> named <code>CENSUS_API_KEY</code>.</p>
</td></tr>
<tr><td><code id="census_helper_new_+3A_voter.file">voter.file</code></td>
<td>
<p>An object of class <code>data.frame</code>. Must contain field(s) named
<code><var>county</var></code>, <code><var>tract</var></code>, <code><var>block</var></code>, and/or <code><var>place</var></code>
specifying geolocation. These should be character variables that match up with
U.S. Census categories. County should be three characters (e.g., &quot;031&quot; not &quot;31&quot;),
tract should be six characters, and block should be four characters.
Place should be five characters if it is included.</p>
</td></tr>
<tr><td><code id="census_helper_new_+3A_states">states</code></td>
<td>
<p>A character vector specifying which states to extract
Census data for, e.g. <code>c("NJ", "NY")</code>. Default is <code>"all"</code>, which extracts
Census data for all states contained in user-input data.</p>
</td></tr>
<tr><td><code id="census_helper_new_+3A_geo">geo</code></td>
<td>
<p>A character object specifying what aggregation level to use.
Use <code>"county"</code>, <code>"tract"</code>, <code>"block"</code>, or <code>"place"</code>.
Default is <code>"tract"</code>. Warning: extracting block-level data takes very long.</p>
</td></tr>
<tr><td><code id="census_helper_new_+3A_age">age</code></td>
<td>
<p>A <code>TRUE</code>/<code>FALSE</code> object indicating whether to condition on
age or not. If <code>FALSE</code> (default), function will return Pr(Geolocation | Race).
If <code>TRUE</code>, function will return Pr(Geolocation, Age | Race).
If <code><var>sex</var></code> is also <code>TRUE</code>, function will return Pr(Geolocation, Age, Sex | Race).</p>
</td></tr>
<tr><td><code id="census_helper_new_+3A_sex">sex</code></td>
<td>
<p>A <code>TRUE</code>/<code>FALSE</code> object indicating whether to condition on
sex or not. If <code>FALSE</code> (default), function will return Pr(Geolocation | Race).
If <code>TRUE</code>, function will return Pr(Geolocation, Sex | Race).
If <code><var>age</var></code> is also <code>TRUE</code>, function will return Pr(Geolocation, Age, Sex | Race).</p>
</td></tr>
<tr><td><code id="census_helper_new_+3A_year">year</code></td>
<td>
<p>A character object specifying the year of U.S. Census data to be downloaded.
Use <code>"2010"</code>, or <code>"2020"</code>. Default is <code>"2020"</code>.</p>
</td></tr>
<tr><td><code id="census_helper_new_+3A_census.data">census.data</code></td>
<td>
<p>A optional census object of class <code>list</code> containing
pre-saved Census geographic data. Can be created using <code>get_census_data</code> function.
If <code><var>census.data</var></code> is provided, the <code><var>year</var></code> element must
have the same value as the <code><var>year</var></code> option specified in this function
(i.e., <code>"2010"</code> in both or <code>"2020"</code> in both).
If <code><var>census.data</var></code> is provided, the <code><var>age</var></code> and the <code><var>sex</var></code>
elements must be <code>FALSE</code>. This corresponds to the defaults of <code>census_geo_api</code>.
If <code><var>census.data</var></code> is missing, Census geographic data will be obtained via Census API.</p>
</td></tr>
<tr><td><code id="census_helper_new_+3A_retry">retry</code></td>
<td>
<p>The number of retries at the census website if network interruption occurs.</p>
</td></tr>
<tr><td><code id="census_helper_new_+3A_use.counties">use.counties</code></td>
<td>
<p>A logical, defaulting to FALSE. Should census data be filtered by counties
available in <var>census.data</var>?</p>
</td></tr>
<tr><td><code id="census_helper_new_+3A_skip_bad_geos">skip_bad_geos</code></td>
<td>
<p>Logical. Option to have the function skip any geolocations that are not present
in the census data, returning a partial data set. Default is set to <code>FALSE</code>, which case it will
break and provide error message with a list of offending geolocations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function allows users to link their geocoded dataset (e.g., voter file)
with U.S. Census data (2010 or 2020). The function extracts Census Summary File data
at the county, tract, block, or place level. Census data calculated are
Pr(Geolocation | Race) where geolocation is county, tract, block, or place.
</p>


<h3>Value</h3>

<p>Output will be an object of class <code>data.frame</code>. It will
consist of the original user-input data with additional columns of
Census data.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: census_helper_new(voter.file = voters, states = "nj", geo = "block")
## Not run: census_helper_new(voter.file = voters, states = "all", geo = "tract")
## Not run: census_helper_new(voter.file = voters, states = "all", geo = "place",
 year = "2020")
## End(Not run)

</code></pre>

<hr>
<h2 id='format_legacy_data'>Legacy data formatting function.</h2><span id='topic+format_legacy_data'></span>

<h3>Description</h3>

<p><code>format_legacy_data</code> formats legacy data from the U.S. census to allow
for Bayesian name geocoding.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>format_legacy_data(legacyFilePath, state, outFile = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="format_legacy_data_+3A_legacyfilepath">legacyFilePath</code></td>
<td>
<p>A character vector giving the location of a legacy census data folder,
sourced from https://www2.census.gov/programs-surveys/decennial/2020/data/01-Redistricting_File&ndash;PL_94-171/.
These file names should end in &quot;.pl&quot;.</p>
</td></tr>
<tr><td><code id="format_legacy_data_+3A_state">state</code></td>
<td>
<p>The two letter state postal code.</p>
</td></tr>
<tr><td><code id="format_legacy_data_+3A_outfile">outFile</code></td>
<td>
<p>Optional character vector determining whether the formatted RData object should be saved. The
filepath should end in &quot;.RData&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function allows users to construct datasets for analysis using the census legacy data format.
These data are available for the 2020 census at
https://www2.census.gov/programs-surveys/decennial/2020/data/01-Redistricting_File&ndash;PL_94-171/.
This function returns data structured analogously to data from the Census API, which is not yet
available for the 2020 Census as of September 2021.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
gaCensusData &lt;- format_legacy_data(PL94171::pl_url('GA', 2020))
predict_race_new(ga.voter.file, namesToUse = 'last, first, mid', census.geo = 'block',
     census.data = gaCensusData)

## End(Not run)

</code></pre>

<hr>
<h2 id='get_census_api'>Census API function.</h2><span id='topic+get_census_api'></span>

<h3>Description</h3>

<p><code>get_census_api</code> obtains U.S. Census data via the public API.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_census_api(
  data_url,
  key = Sys.getenv("CENSUS_API_KEY"),
  var.names,
  region,
  retry = 0
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_census_api_+3A_data_url">data_url</code></td>
<td>
<p>URL root of the API,
e.g., <code>"https://api.census.gov/data/2020/dec/pl"</code>.</p>
</td></tr>
<tr><td><code id="get_census_api_+3A_key">key</code></td>
<td>
<p>A character string containing a valid Census API key,
which can be requested from the
<a href="https://api.census.gov/data/key_signup.html">U.S. Census API key signup page</a>.
</p>
<p>By default, attempts to find a census key stored in an
<a href="base.html#topic+Sys.getenv">environment variable</a> named <code>CENSUS_API_KEY</code>.</p>
</td></tr>
<tr><td><code id="get_census_api_+3A_var.names">var.names</code></td>
<td>
<p>A character vector of variables to get,
e.g., <code>c("P2_005N", "P2_006N", "P2_007N", "P2_008N")</code>.
If there are more than 50 variables, then function will automatically
split variables into separate queries.</p>
</td></tr>
<tr><td><code id="get_census_api_+3A_region">region</code></td>
<td>
<p>Character object specifying which region to obtain data for.
Must contain &quot;for&quot; and possibly &quot;in&quot;,
e.g., <code>"for=block:1213&amp;in=state:47+county:015+tract:*"</code>.</p>
</td></tr>
<tr><td><code id="get_census_api_+3A_retry">retry</code></td>
<td>
<p>The number of retries at the census website if network interruption occurs.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function obtains U.S. Census data via the public API. User
can specify the variables and region(s) for which to obtain data.
</p>


<h3>Value</h3>

<p>If successful, output will be an object of class <code>data.frame</code>.
If unsuccessful, function prints the URL query that caused the error.
</p>


<h3>References</h3>

<p>Based on code authored by Nicholas Nagle, which is available
<a href="https://rstudio-pubs-static.s3.amazonaws.com/19337_2e7f827190514c569ea136db788ce850.html">here</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
get_census_api(
  data_url = "https://api.census.gov/data/2020/dec/pl",
  var.names = c("P2_005N", "P2_006N", "P2_007N", "P2_008N"), region = "for=county:*&amp;in=state:34"
)

## End(Not run)

</code></pre>

<hr>
<h2 id='get_census_api_2'>Census API URL assembler.</h2><span id='topic+get_census_api_2'></span>

<h3>Description</h3>

<p><code>get_census_api_2</code> assembles URL components for <code>get_census_api</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_census_api_2(
  data_url,
  key = Sys.getenv("CENSUS_API_KEY"),
  get,
  region,
  retry = 3
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_census_api_2_+3A_data_url">data_url</code></td>
<td>
<p>URL root of the API,
e.g., <code>"https://api.census.gov/data/2020/dec/pl"</code>.</p>
</td></tr>
<tr><td><code id="get_census_api_2_+3A_key">key</code></td>
<td>
<p>A character string containing a valid Census API key,
which can be requested from the
<a href="https://api.census.gov/data/key_signup.html">U.S. Census API key signup page</a>.
</p>
<p>By default, attempts to find a census key stored in an
<a href="base.html#topic+Sys.getenv">environment variable</a> named <code>CENSUS_API_KEY</code>.</p>
</td></tr>
<tr><td><code id="get_census_api_2_+3A_get">get</code></td>
<td>
<p>A character vector of variables to get,
e.g., <code>c("P2_005N", "P2_006N", "P2_007N", "P2_008N")</code>.
If there are more than 50 variables, then function will automatically
split variables into separate queries.</p>
</td></tr>
<tr><td><code id="get_census_api_2_+3A_region">region</code></td>
<td>
<p>Character object specifying which region to obtain data for.
Must contain &quot;for&quot; and possibly &quot;in&quot;,
e.g., <code>"for=block:1213&amp;in=state:47+county:015+tract:*"</code>.</p>
</td></tr>
<tr><td><code id="get_census_api_2_+3A_retry">retry</code></td>
<td>
<p>The number of retries at the census website if network interruption occurs.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function assembles the URL components and sends the request to the Census server.
It is used by the <code>get_census_api</code> function. The user should not need to call this
function directly.
</p>


<h3>Value</h3>

<p>If successful, output will be an object of class <code>data.frame</code>.
If unsuccessful, function prints the URL query that was constructed.
</p>


<h3>References</h3>

<p>Based on code authored by Nicholas Nagle, which is available
<a href="https://rstudio-pubs-static.s3.amazonaws.com/19337_2e7f827190514c569ea136db788ce850.html">here</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: try(get_census_api_2(data_url = "https://api.census.gov/data/2020/dec/pl",
get = c("P2_005N", "P2_006N", "P2_007N", "P2_008N"), region = "for=county:*&amp;in=state:34"))
## End(Not run)

</code></pre>

<hr>
<h2 id='get_census_data'>Multilevel Census data download function.</h2><span id='topic+get_census_data'></span>

<h3>Description</h3>

<p><code>get_census_data</code> returns county-, tract-, and block-level Census data
for specified state(s). Using this function to download Census data in advance
can save considerable time when running <code>predict_race</code> and <code>census_helper</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_census_data(
  key = Sys.getenv("CENSUS_API_KEY"),
  states,
  age = FALSE,
  sex = FALSE,
  year = "2020",
  census.geo = c("tract", "block", "block_group", "county", "place", "zcta"),
  retry = 3,
  county.list = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_census_data_+3A_key">key</code></td>
<td>
<p>A character string containing a valid Census API key,
which can be requested from the
<a href="https://api.census.gov/data/key_signup.html">U.S. Census API key signup page</a>.
</p>
<p>By default, attempts to find a census key stored in an
<a href="base.html#topic+Sys.getenv">environment variable</a> named <code>CENSUS_API_KEY</code>.</p>
</td></tr>
<tr><td><code id="get_census_data_+3A_states">states</code></td>
<td>
<p>which states to extract Census data for, e.g., <code>c("NJ", "NY")</code>.</p>
</td></tr>
<tr><td><code id="get_census_data_+3A_age">age</code></td>
<td>
<p>A <code>TRUE</code>/<code>FALSE</code> object indicating whether to condition on
age or not. If <code>FALSE</code> (default), function will return Pr(Geolocation | Race).
If <code>TRUE</code>, function will return Pr(Geolocation, Age | Race).
If <code><var>sex</var></code> is also <code>TRUE</code>, function will return Pr(Geolocation, Age, Sex | Race).</p>
</td></tr>
<tr><td><code id="get_census_data_+3A_sex">sex</code></td>
<td>
<p>A <code>TRUE</code>/<code>FALSE</code> object indicating whether to condition on
sex or not. If <code>FALSE</code> (default), function will return Pr(Geolocation | Race).
If <code>TRUE</code>, function will return Pr(Geolocation, Sex | Race).
If <code><var>age</var></code> is also <code>TRUE</code>, function will return Pr(Geolocation, Age, Sex | Race).</p>
</td></tr>
<tr><td><code id="get_census_data_+3A_year">year</code></td>
<td>
<p>A character object specifying the year of U.S. Census data to be downloaded.
Use <code>"2010"</code>, or <code>"2020"</code>. Default is <code>"2020"</code>.
Warning: 2020 U.S. Census data is downloaded only when <code><var>age</var></code> and
<code><var>sex</var></code> are both <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="get_census_data_+3A_census.geo">census.geo</code></td>
<td>
<p>An optional character vector specifying what level of
geography to use to merge in U.S. Census 2010 geographic data. Currently
<code>"county"</code>, <code>"tract"</code>, <code>"block"</code>, and <code>"place"</code> are supported.</p>
</td></tr>
<tr><td><code id="get_census_data_+3A_retry">retry</code></td>
<td>
<p>The number of retries at the census website if network interruption occurs.</p>
</td></tr>
<tr><td><code id="get_census_data_+3A_county.list">county.list</code></td>
<td>
<p>A named list of character vectors of counties present in your <var>voter.file</var>, per state.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Output will be an object of class <code>list</code> indexed by state.
Output will contain a subset of the following elements:
<code>state</code>, <code>age</code>, <code>sex</code>,
<code>county</code>, <code>tract</code>, <code>block_group</code>, <code>block</code>, and <code>place</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: get_census_data(states = c("NJ", "NY"), age = TRUE, sex = FALSE)
## Not run: get_census_data(states = "MN", age = FALSE, sex = FALSE, year = "2020")
</code></pre>

<hr>
<h2 id='merge_names'>Surname probability merging function.</h2><span id='topic+merge_names'></span>

<h3>Description</h3>

<p><code>merge_names</code> merges names in a user-input dataset with corresponding
race/ethnicity probabilities derived from both the U.S. Census Surname List
and Spanish Surname List and voter files from states in the Southern U.S.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>merge_names(
  voter.file,
  namesToUse,
  census.surname,
  table.surnames = NULL,
  table.first = NULL,
  table.middle = NULL,
  clean.names = TRUE,
  impute.missing = FALSE,
  model = "BISG"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="merge_names_+3A_voter.file">voter.file</code></td>
<td>
<p>An object of class <code>data.frame</code>.  Must contain a row for each individual being predicted,
as well as a field named <code><var>last</var></code> containing each individual's surname.
If first name is also being used for prediction, the file must also contain a field
named <code><var>first</var></code>. If middle name is also being used for prediction, the field
must also contain a field named <code><var>middle</var></code>.</p>
</td></tr>
<tr><td><code id="merge_names_+3A_namestouse">namesToUse</code></td>
<td>
<p>A character vector identifying which names to use for the prediction.
The default value is <code>"last"</code>, indicating that only the last name will be used.
Other options are <code>"last, first"</code>, indicating that both last and first names will be
used, and <code>"last, first, middle"</code>, indicating that last, first, and middle names will all
be used.</p>
</td></tr>
<tr><td><code id="merge_names_+3A_census.surname">census.surname</code></td>
<td>
<p>A <code>TRUE</code>/<code>FALSE</code> object. If <code>TRUE</code>,
function will call <code>merge_surnames</code> to merge in Pr(Race | Surname)
from U.S. Census Surname List (2000, 2010, or 2020) and Spanish Surname List.
If <code>FALSE</code>, user must provide a <code>name.dictionary</code> (see below).
Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="merge_names_+3A_table.surnames">table.surnames</code></td>
<td>
<p>An object of class <code>data.frame</code> provided by the
users as an alternative surname dictionary. It will consist of a list of
U.S. surnames, along with the associated probabilities P(name | ethnicity)
for ethnicities: white, Black, Hispanic, Asian, and other. Default is <code>NULL</code>.
(<code><var>last_name</var></code> for U.S. surnames, <code><var>p_whi_last</var></code> for White,
<code><var>p_bla_last</var></code> for Black, <code><var>p_his_last</var></code> for Hispanic,
<code><var>p_asi_last</var></code> for Asian, <code><var>p_oth_last</var></code> for other).</p>
</td></tr>
<tr><td><code id="merge_names_+3A_table.first">table.first</code></td>
<td>
<p>See <code><var>table.surnames</var></code>.</p>
</td></tr>
<tr><td><code id="merge_names_+3A_table.middle">table.middle</code></td>
<td>
<p>See <code><var>table.surnames</var></code>.</p>
</td></tr>
<tr><td><code id="merge_names_+3A_clean.names">clean.names</code></td>
<td>
<p>A <code>TRUE</code>/<code>FALSE</code> object. If <code>TRUE</code>,
any surnames in <code><var>voter.file</var></code> that cannot initially be matched
to the database will be cleaned, according to U.S. Census specifications,
in order to increase the chance of finding a match. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="merge_names_+3A_impute.missing">impute.missing</code></td>
<td>
<p>See <code>predict_race</code>.</p>
</td></tr>
<tr><td><code id="merge_names_+3A_model">model</code></td>
<td>
<p>See <code>predict_race</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function allows users to match names in their dataset with database entries
estimating P(name | ethnicity) for each of the five major racial groups for each
name. The database probabilities are derived from both the U.S. Census Surname List
and Spanish Surname List and voter files from states in the Southern U.S.
</p>
<p>By default, the function matches names as follows:
</p>

<ol>
<li><p> Search raw surnames in the database;
</p>
</li>
<li><p> Remove any punctuation and search again;
</p>
</li>
<li><p> Remove any spaces and search again;
</p>
</li>
<li><p> Remove suffixes (e.g., &quot;Jr&quot;) and search again (last names only)
</p>
</li>
<li><p> Split double-barreled names into two parts and search first part of name;
</p>
</li>
<li><p> Split double-barreled names into two parts and search second part of name;
</p>
</li></ol>

<p>Each step only applies to names not matched in a previous step.
Steps 2 through 6 are not applied if <code>clean.surname</code> is FALSE.
</p>
<p>Note: Any name appearing only on the Spanish Surname List is assigned a
probability of 1 for Hispanics/Latinos and 0 for all other racial groups.
</p>


<h3>Value</h3>

<p>Output will be an object of class <code>data.frame</code>. It will
consist of the original user-input data with additional columns that
specify the part of the name matched with Census data (<code><var>surname.match</var></code>),
and the probabilities Pr(Race | Surname) for each racial group
(<code><var>p_whi</var></code> for White, <code><var>p_bla</var></code> for Black,
<code><var>p_his</var></code> for Hispanic/Latino,
<code><var>p_asi</var></code> for Asian and Pacific Islander, and
<code><var>p_oth</var></code> for Other/Mixed).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(voters)
## Not run: try(merge_names(voters, namesToUse = "surname", census.surname = TRUE))
</code></pre>

<hr>
<h2 id='merge_surnames'>Surname probability merging function.</h2><span id='topic+merge_surnames'></span>

<h3>Description</h3>

<p><code>merge_surnames</code> merges surnames in user-input dataset with corresponding
race/ethnicity probabilities from U.S. Census Surname List and Spanish Surname List.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>merge_surnames(
  voter.file,
  surname.year = 2020,
  name.data,
  clean.surname = TRUE,
  impute.missing = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="merge_surnames_+3A_voter.file">voter.file</code></td>
<td>
<p>An object of class <code>data.frame</code>. Must contain a field
named 'surname' containing list of surnames to be merged with Census lists.</p>
</td></tr>
<tr><td><code id="merge_surnames_+3A_surname.year">surname.year</code></td>
<td>
<p>An object of class <code>numeric</code> indicating which year
Census Surname List is from. Accepted values are <code>2010</code> and <code>2000</code>.
Default is <code>2020</code>.</p>
</td></tr>
<tr><td><code id="merge_surnames_+3A_name.data">name.data</code></td>
<td>
<p>An object of class <code>data.frame</code>. Must contain a leading
column of surnames, and 5 subsequent columns, with Pr(Race | Surname) for each
of the five major racial categories.</p>
</td></tr>
<tr><td><code id="merge_surnames_+3A_clean.surname">clean.surname</code></td>
<td>
<p>A <code>TRUE</code>/<code>FALSE</code> object. If <code>TRUE</code>,
any surnames in <code><var>voter.file</var></code> that cannot initially be matched
to surname lists will be cleaned, according to U.S. Census specifications,
in order to increase the chance of finding a match. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="merge_surnames_+3A_impute.missing">impute.missing</code></td>
<td>
<p>A <code>TRUE</code>/<code>FALSE</code> object. If <code>TRUE</code>,
race/ethnicity probabilities will be imputed for unmatched names using
race/ethnicity distribution for all other names (i.e., not on Census List).
Default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function allows users to match surnames in their dataset with the U.S.
Census Surname List (from 2000 or 2010) and Spanish Surname List to obtain
Pr(Race | Surname) for each of the five major racial groups.
</p>
<p>By default, the function matches surnames to the Census list as follows:
</p>

<ol>
<li><p> Search raw surnames in Census surname list;
</p>
</li>
<li><p> Remove any punctuation and search again;
</p>
</li>
<li><p> Remove any spaces and search again;
</p>
</li>
<li><p> Remove suffixes (e.g., Jr) and search again;
</p>
</li>
<li><p> Split double-barreled surnames into two parts and search first part of name;
</p>
</li>
<li><p> Split double-barreled surnames into two parts and search second part of name;
</p>
</li>
<li><p> For any remaining names, impute probabilities using distribution
for all names not appearing on Census list.
</p>
</li></ol>

<p>Each step only applies to surnames not matched in a previous ste.
Steps 2 through 7 are not applied if <code>clean.surname</code> is FALSE.
</p>
<p>Note: Any name appearing only on the Spanish Surname List is assigned a
probability of 1 for Hispanics/Latinos and 0 for all other racial groups.
</p>


<h3>Value</h3>

<p>Output will be an object of class <code>data.frame</code>. It will
consist of the original user-input data with additional columns that
specify the part of the name matched with Census data (<code><var>surname.match</var></code>),
and the probabilities Pr(Race | Surname) for each racial group
(<code><var>p_whi</var></code> for White, <code><var>p_bla</var></code> for Black,
<code><var>p_his</var></code> for Hispanic/Latino,
<code><var>p_asi</var></code> for Asian and Pacific Islander, and
<code><var>p_oth</var></code> for Other/Mixed).
#'
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(voters)
## Not run: try(merge_surnames(voters))

</code></pre>

<hr>
<h2 id='modfuns'>Internal model fitting functions</h2><span id='topic+modfuns'></span><span id='topic+.predict_race_old'></span><span id='topic+predict_race_new'></span><span id='topic+predict_race_me'></span>

<h3>Description</h3>

<p>These functions are intended for internal use only. Users should use the
<code><a href="#topic+predict_race">predict_race()</a></code> interface rather any of these functions directly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.predict_race_old(
  voter.file,
  census.surname = TRUE,
  surname.only = FALSE,
  surname.year = 2020,
  name.dictionaries = NULL,
  census.geo,
  census.key = Sys.getenv("CENSUS_API_KEY"),
  census.data = NULL,
  age = FALSE,
  sex = FALSE,
  year = "2020",
  party,
  retry = 3,
  impute.missing = TRUE,
  use.counties = FALSE
)

predict_race_new(
  voter.file,
  names.to.use,
  year = "2020",
  age = FALSE,
  sex = FALSE,
  census.geo = c("tract", "block", "block_group", "county", "place", "zcta"),
  census.key = Sys.getenv("CENSUS_API_KEY"),
  name.dictionaries,
  surname.only = FALSE,
  census.data = NULL,
  retry = 0,
  impute.missing = TRUE,
  skip_bad_geos = FALSE,
  census.surname = FALSE,
  use.counties = FALSE
)

predict_race_me(
  voter.file,
  names.to.use,
  year = "2020",
  age = FALSE,
  sex = FALSE,
  census.geo = c("tract", "block", "block_group", "county", "place", "zcta"),
  census.key = Sys.getenv("CENSUS_API_KEY"),
  name.dictionaries,
  surname.only = FALSE,
  census.data = NULL,
  retry = 0,
  impute.missing = TRUE,
  census.surname = FALSE,
  use.counties = FALSE,
  race.init,
  ctrl
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="modfuns_+3A_voter.file">voter.file</code></td>
<td>
<p>See documentation in <code>race_predict</code>.</p>
</td></tr>
<tr><td><code id="modfuns_+3A_census.surname">census.surname</code></td>
<td>
<p>See documentation in <code>race_predict</code>.</p>
</td></tr>
<tr><td><code id="modfuns_+3A_surname.only">surname.only</code></td>
<td>
<p>See documentation in <code>race_predict</code>.</p>
</td></tr>
<tr><td><code id="modfuns_+3A_surname.year">surname.year</code></td>
<td>
<p>See documentation in <code>race_predict</code>.</p>
</td></tr>
<tr><td><code id="modfuns_+3A_name.dictionaries">name.dictionaries</code></td>
<td>
<p>See documentation in <code>race_predict</code>.</p>
</td></tr>
<tr><td><code id="modfuns_+3A_census.geo">census.geo</code></td>
<td>
<p>See documentation in <code>race_predict</code>.</p>
</td></tr>
<tr><td><code id="modfuns_+3A_census.key">census.key</code></td>
<td>
<p>A character object specifying user's Census API key.
Required if <code>census.geo</code> is specified, because a valid Census API key is
required to download Census geographic data.
</p>
<p>If <code><a href="base.html#topic+NULL">NULL</a></code>, the default, attempts to find a census key stored in an
<a href="base.html#topic+Sys.getenv">environment variable</a> named <code>CENSUS_API_KEY</code>.</p>
</td></tr>
<tr><td><code id="modfuns_+3A_census.data">census.data</code></td>
<td>
<p>See documentation in <code>race_predict</code>.</p>
</td></tr>
<tr><td><code id="modfuns_+3A_age">age</code></td>
<td>
<p>See documentation in <code>race_predict</code>.</p>
</td></tr>
<tr><td><code id="modfuns_+3A_sex">sex</code></td>
<td>
<p>See documentation in <code>race_predict</code>.</p>
</td></tr>
<tr><td><code id="modfuns_+3A_year">year</code></td>
<td>
<p>See documentation in <code>race_predict</code>.</p>
</td></tr>
<tr><td><code id="modfuns_+3A_party">party</code></td>
<td>
<p>See documentation in <code>race_predict</code>.</p>
</td></tr>
<tr><td><code id="modfuns_+3A_retry">retry</code></td>
<td>
<p>See documentation in <code>race_predict</code>.</p>
</td></tr>
<tr><td><code id="modfuns_+3A_impute.missing">impute.missing</code></td>
<td>
<p>See documentation in <code>race_predict</code>.</p>
</td></tr>
<tr><td><code id="modfuns_+3A_use.counties">use.counties</code></td>
<td>
<p>A logical, defaulting to FALSE. Should census data be filtered by counties available in <var>census.data</var>?</p>
</td></tr>
<tr><td><code id="modfuns_+3A_names.to.use">names.to.use</code></td>
<td>
<p>See documentation in <code>race_predict</code>.</p>
</td></tr>
<tr><td><code id="modfuns_+3A_skip_bad_geos">skip_bad_geos</code></td>
<td>
<p>See documentation in <code>race_predict</code>.</p>
</td></tr>
<tr><td><code id="modfuns_+3A_race.init">race.init</code></td>
<td>
<p>See documentation in <code>race_predict</code>.</p>
</td></tr>
<tr><td><code id="modfuns_+3A_ctrl">ctrl</code></td>
<td>
<p>See <code>control</code> in documentation for <code><a href="#topic+predict_race">predict_race()</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These functions fit different versions of WRU. <code>.predict_race_old</code> fits
the original WRU model, also known as BISG with census-based surname dictionary.
<code>.predict_race_new</code> fits a new version of BISG which uses a new, augmented
surname dictionary, and can also accommodate the use of first and middle
name information. Finally, <code>.predict_race_me</code> fits a fully Bayesian Improved
Surname Geocoding model (fBISG), which fits a model with measurement-error
correction of erroneous zeros in census tables, in addition to also accommodating
the augmented surname dictionary, and the first and middle name
dictionaries when making predictions.
</p>


<h3>Value</h3>

<p>Output will be an object of class <code>data.frame</code>. It will
consist of the original user-input <code>voter.file</code> with additional columns with
predicted probabilities for each of the five major racial categories:
<code><var>pred.whi</var></code> for White,
<code><var>pred.bla</var></code> for Black,
<code><var>pred.his</var></code> for Hispanic/Latino,
<code><var>pred.asi</var></code> for Asian/Pacific Islander, and
<code><var>pred.oth</var></code> for Other/Mixed.
</p>


<h3>.predict_race_old</h3>

<p>Original WRU race prediction function, implementing classical BISG with census-based
surname dictionary.
</p>


<h3>.predict_race_new </h3>

<p>New race prediction function, implementing classical BISG with augmented
surname dictionary, as well as first and middle name information.
</p>


<h3>.predict_race_me</h3>

<p>New race prediction function, implementing fBISG (i.e. measurement
error correction, fully Bayesian model) with augmented
surname dictionary, as well as first and middle name information.
</p>

<hr>
<h2 id='predict_race'>Race prediction function.</h2><span id='topic+predict_race'></span>

<h3>Description</h3>

<p><code>predict_race</code> makes probabilistic estimates of individual-level race/ethnicity.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predict_race(
  voter.file,
  census.surname = TRUE,
  surname.only = FALSE,
  census.geo = c("tract", "block", "block_group", "county", "place", "zcta"),
  census.key = Sys.getenv("CENSUS_API_KEY"),
  census.data = NULL,
  age = FALSE,
  sex = FALSE,
  year = "2020",
  party = NULL,
  retry = 3,
  impute.missing = TRUE,
  skip_bad_geos = FALSE,
  use.counties = FALSE,
  model = "BISG",
  race.init = NULL,
  name.dictionaries = NULL,
  names.to.use = "surname",
  control = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict_race_+3A_voter.file">voter.file</code></td>
<td>
<p>An object of class <code>data.frame</code>.
Must contain a row for each individual being predicted,
as well as a field named <code><var>surname</var></code> containing each individual's surname.
If using geolocation in predictions, <code><var>voter.file</var></code> must contain a field named
<code><var>state</var></code>, which contains the two-character abbreviation for each individual's
state of residence (e.g., <code>"nj"</code> for New Jersey).
If using Census geographic data in race/ethnicity predictions,
<code><var>voter.file</var></code> must also contain at least one of the following fields:
<code><var>county</var></code>, <code><var>tract</var></code>, <code><var>block_group</var></code>, <code><var>block</var></code>,
and/or <code><var>place</var></code>.
These fields should contain character strings matching U.S. Census categories.
County is three characters (e.g., <code>"031"</code> not <code>"31"</code>),
tract is six characters, block group is usually a single character and block
is four characters. Place is five characters.
See below for other optional fields.</p>
</td></tr>
<tr><td><code id="predict_race_+3A_census.surname">census.surname</code></td>
<td>
<p>A <code>TRUE</code>/<code>FALSE</code> object. If <code>TRUE</code>,
function will call <code>merge_surnames</code> to merge in Pr(Race | Surname)
from U.S. Census Surname List (2000, 2010, or 2020) and Spanish Surname List.
If <code>FALSE</code>, user must provide a <code>name.dictionary</code> (see below).
Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="predict_race_+3A_surname.only">surname.only</code></td>
<td>
<p>A <code>TRUE</code>/<code>FALSE</code> object. If <code>TRUE</code>, race predictions will
only use surname data and calculate Pr(Race | Surname). Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="predict_race_+3A_census.geo">census.geo</code></td>
<td>
<p>An optional character vector specifying what level of
geography to use to merge in U.S. Census geographic data. Currently
<code>"county"</code>, <code>"tract"</code>, <code>"block_group"</code>, <code>"block"</code>, and <code>"place"</code>
are supported.
Note: sufficient information must be in user-defined <code><var>voter.file</var></code> object.
If <code><var>census.geo</var> = "county"</code>, then <code><var>voter.file</var></code>
must have column named <code>county</code>.
If <code><var>census.geo</var> = "tract"</code>, then <code><var>voter.file</var></code>
must have columns named <code>county</code> and <code>tract</code>.
And if <code><var>census.geo</var> = "block"</code>, then <code><var>voter.file</var></code>
must have columns named <code>county</code>, <code>tract</code>, and <code>block</code>.
If <code><var>census.geo</var> = "place"</code>, then <code><var>voter.file</var></code>
must have column named <code>place</code>.
If <code>census.geo = "zcta"</code>, then <code>voter.file</code> must have column named <code>zcta</code>.
Specifying <code><var>census.geo</var></code> will call <code>census_helper</code> function
to merge Census geographic data at specified level of geography.</p>
</td></tr>
<tr><td><code id="predict_race_+3A_census.key">census.key</code></td>
<td>
<p>A character object specifying user's Census API key.
Required if <code>census.geo</code> is specified, because a valid Census API key is
required to download Census geographic data.
</p>
<p>If <code><a href="base.html#topic+NULL">NULL</a></code>, the default, attempts to find a census key stored in an
<a href="base.html#topic+Sys.getenv">environment variable</a> named <code>CENSUS_API_KEY</code>.</p>
</td></tr>
<tr><td><code id="predict_race_+3A_census.data">census.data</code></td>
<td>
<p>A list indexed by two-letter state abbreviations,
which contains pre-saved Census geographic data.
Can be generated using <code>get_census_data</code> function.</p>
</td></tr>
<tr><td><code id="predict_race_+3A_age">age</code></td>
<td>
<p>An optional <code>TRUE</code>/<code>FALSE</code> object specifying whether to
condition race predictions on age (in addition to surname and geolocation).
Default is <code>FALSE</code>. Must be same as <code><var>age</var></code> in <code><var>census.data</var></code> object.
May only be set to <code>TRUE</code> if <code>census.geo</code> option is specified.
If <code>TRUE</code>, <code><var>voter.file</var></code> should include a numerical variable <code><var>age</var></code>.</p>
</td></tr>
<tr><td><code id="predict_race_+3A_sex">sex</code></td>
<td>
<p>optional <code>TRUE</code>/<code>FALSE</code> object specifying whether to
condition race predictions on sex (in addition to surname and geolocation).
Default is <code>FALSE</code>. Must be same as <code><var>sex</var></code> in <code><var>census.data</var></code> object.
May only be set to <code>TRUE</code> if <code>census.geo</code> option is specified.
If <code>TRUE</code>, <code><var>voter.file</var></code> should include a numerical variable <code><var>sex</var></code>,
where <code><var>sex</var></code> is coded as 0 for males and 1 for females.</p>
</td></tr>
<tr><td><code id="predict_race_+3A_year">year</code></td>
<td>
<p>An optional character vector specifying the year of U.S. Census geographic
data to be downloaded. Use <code>"2010"</code>, or <code>"2020"</code>. Default is <code>"2020"</code>.</p>
</td></tr>
<tr><td><code id="predict_race_+3A_party">party</code></td>
<td>
<p>An optional character object specifying party registration field
in <code><var>voter.file</var></code>, e.g., <code><var>party</var> = "PartyReg"</code>.
If specified, race/ethnicity predictions will be conditioned
on individual's party registration (in addition to geolocation).
Whatever the name of the party registration field in <code><var>voter.file</var></code>,
it should be coded as 1 for Democrat, 2 for Republican, and 0 for Other.</p>
</td></tr>
<tr><td><code id="predict_race_+3A_retry">retry</code></td>
<td>
<p>The number of retries at the census website if network interruption occurs.</p>
</td></tr>
<tr><td><code id="predict_race_+3A_impute.missing">impute.missing</code></td>
<td>
<p>Logical, defaults to TRUE. Should missing be imputed?</p>
</td></tr>
<tr><td><code id="predict_race_+3A_skip_bad_geos">skip_bad_geos</code></td>
<td>
<p>Logical. Option to have the function skip any geolocations that are not present
in the census data, returning a partial data set. Default is set to <code>FALSE</code>, in which case it
will break and provide error message with a list of offending geolocations.</p>
</td></tr>
<tr><td><code id="predict_race_+3A_use.counties">use.counties</code></td>
<td>
<p>A logical, defaulting to FALSE. Should census data be filtered by counties
available in <var>census.data</var>?</p>
</td></tr>
<tr><td><code id="predict_race_+3A_model">model</code></td>
<td>
<p>Character string, either &quot;BISG&quot; (default) or &quot;fBISG&quot; (for error-correction,
fully-Bayesian model).</p>
</td></tr>
<tr><td><code id="predict_race_+3A_race.init">race.init</code></td>
<td>
<p>Vector of initial race for each observation in voter.file.
Must be an integer vector, with 1=white, 2=black, 3=hispanic, 4=asian, and
5=other. Defaults to values obtained using <code>model="BISG_surname"</code>.</p>
</td></tr>
<tr><td><code id="predict_race_+3A_name.dictionaries">name.dictionaries</code></td>
<td>
<p>Optional named list of <code>data.frame</code>'s
containing counts of names by race. Any of the following named elements
are allowed: &quot;surname&quot;, &quot;first&quot;, &quot;middle&quot;. When present, the objects must
follow the same structure as <code>last_c</code>, <code>first_c</code>,
<code>mid_c</code>, respectively.</p>
</td></tr>
<tr><td><code id="predict_race_+3A_names.to.use">names.to.use</code></td>
<td>
<p>One of 'surname', 'surname, first', or  'surname, first,
middle'. Defaults to 'surname'.</p>
</td></tr>
<tr><td><code id="predict_race_+3A_control">control</code></td>
<td>
<p>List of control arguments only used when <code>model="fBISG"</code>, including
</p>

<dl>
<dt>iter</dt><dd><p>Number of MCMC iterations. Defaults to 1000.</p>
</dd>
<dt>burnin</dt><dd><p>Number of iterations discarded as burnin. Defaults to half of <code>iter</code>.</p>
</dd>
<dt>verbose</dt><dd><p>Print progress information. Defaults to <code>TRUE</code>.</p>
</dd>
<dt>me.correct</dt><dd><p>Boolean. Should the model correct measurement error for <code>races|geo</code>? Defaults to <code>TRUE</code>.</p>
</dd>
<dt>seed</dt><dd><p>RNG seed. If <code>NULL</code>, a seed is generated and returned as an attribute for reproducibility.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Details</h3>

<p>This function implements the Bayesian race prediction methods outlined in
Imai and Khanna (2015). The function produces probabilistic estimates of
individual-level race/ethnicity, based on surname, geolocation, and party.
</p>


<h3>Value</h3>

<p>Output will be an object of class <code>data.frame</code>. It will
consist of the original user-input <code>voter.file</code> with additional columns with
predicted probabilities for each of the five major racial categories:
<code><var>pred.whi</var></code> for White,
<code><var>pred.bla</var></code> for Black,
<code><var>pred.his</var></code> for Hispanic/Latino,
<code><var>pred.asi</var></code> for Asian/Pacific Islander, and
<code><var>pred.oth</var></code> for Other/Mixed.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#' data(voters)
try(predict_race(voter.file = voters, surname.only = TRUE))
## Not run: 
try(predict_race(voter.file = voters, census.geo = "tract"))

## End(Not run)
## Not run: 
try(predict_race(
  voter.file = voters, census.geo = "place", year = "2020"))

## End(Not run)
## Not run: 
CensusObj &lt;- try(get_census_data(state = c("NY", "DC", "NJ")))
try(predict_race(
  voter.file = voters, census.geo = "tract", census.data = CensusObj, party = "PID")
  )

## End(Not run)
## Not run: 
CensusObj2 &lt;- try(get_census_data(state = c("NY", "DC", "NJ"), age = T, sex = T))
try(predict_race(
  voter.file = voters, census.geo = "tract", census.data = CensusObj2, age = T, sex = T))

## End(Not run)
## Not run: 
CensusObj3 &lt;- try(get_census_data(state = c("NY", "DC", "NJ"), census.geo = "place"))
try(predict_race(voter.file = voters, census.geo = "place", census.data = CensusObj3))

## End(Not run)

</code></pre>

<hr>
<h2 id='sample_me'>Collapsed Gibbs sampler for hWRU. Internal function</h2><span id='topic+sample_me'></span>

<h3>Description</h3>

<p>Collapsed Gibbs sampler for hWRU. Internal function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sample_me(
  last_name,
  first_name,
  mid_name,
  geo,
  N_rg,
  pi_s,
  pi_f,
  pi_m,
  pi_nr,
  which_names,
  samples,
  burnin,
  race_init,
  verbose
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sample_me_+3A_last_name">last_name</code></td>
<td>
<p>Integer vector of last name identifiers for each record (zero indexed; as all that follow). Must match columns numbers in M_rs.</p>
</td></tr>
<tr><td><code id="sample_me_+3A_first_name">first_name</code></td>
<td>
<p>See last_name</p>
</td></tr>
<tr><td><code id="sample_me_+3A_mid_name">mid_name</code></td>
<td>
<p>See last_name</p>
</td></tr>
<tr><td><code id="sample_me_+3A_geo">geo</code></td>
<td>
<p>Integer vector of geographic units for each record. Must match column number in N_rg</p>
</td></tr>
<tr><td><code id="sample_me_+3A_n_rg">N_rg</code></td>
<td>
<p>Integer matrix of race | geography counts in census (geograpgies in columns).</p>
</td></tr>
<tr><td><code id="sample_me_+3A_pi_s">pi_s</code></td>
<td>
<p>Numeric matrix of race | surname prior probabilities.</p>
</td></tr>
<tr><td><code id="sample_me_+3A_pi_f">pi_f</code></td>
<td>
<p>Same as <code>pi_s</code>, but for first names.</p>
</td></tr>
<tr><td><code id="sample_me_+3A_pi_m">pi_m</code></td>
<td>
<p>Same as <code>pi_s</code>, but for middle names.</p>
</td></tr>
<tr><td><code id="sample_me_+3A_pi_nr">pi_nr</code></td>
<td>
<p>Matrix of marginal probability distribution over missing names; non-keyword names default to this distribution.</p>
</td></tr>
<tr><td><code id="sample_me_+3A_which_names">which_names</code></td>
<td>
<p>Integer; 0=surname only. 1=surname + first name. 2= surname, first, and middle names.</p>
</td></tr>
<tr><td><code id="sample_me_+3A_samples">samples</code></td>
<td>
<p>Integer number of samples to take after (in total)</p>
</td></tr>
<tr><td><code id="sample_me_+3A_burnin">burnin</code></td>
<td>
<p>Integer number of samples to discard as burn-in of Markov chain</p>
</td></tr>
<tr><td><code id="sample_me_+3A_race_init">race_init</code></td>
<td>
<p>Integer vector of initial race assignments</p>
</td></tr>
<tr><td><code id="sample_me_+3A_verbose">verbose</code></td>
<td>
<p>Boolean; should informative messages be printed?</p>
</td></tr>
</table>

<hr>
<h2 id='state_fips'>Dataset with FIPS codes for US states</h2><span id='topic+state_fips'></span>

<h3>Description</h3>

<p>Dataset including FIPS codes and postal abbreviations for each U.S. state,
district, and territory.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>state_fips
</code></pre>


<h3>Format</h3>

<p>A tibble with 57 rows and 3 columns:
</p>

<dl>
<dt><code>state</code></dt><dd><p>Two-letter postal abbreviation</p>
</dd>
<dt><code>state_code</code></dt><dd><p>Two-digit FIPS code</p>
</dd>
<dt><code>state_name</code></dt><dd><p>English name</p>
</dd>
</dl>



<h3>Source</h3>

<p>Derived from <code><a href="tidycensus.html#topic+fips_codes">tidycensus::fips_codes()</a></code>
</p>

<hr>
<h2 id='surnames2000'>Census Surname List (2000).</h2><span id='topic+surnames2000'></span>

<h3>Description</h3>

<p>Census Surname List from 2000 with race/ethnicity probabilities by surname.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>surnames2000
</code></pre>


<h3>Format</h3>

<p>A data frame with 157,728 rows and 6 variables:
</p>

<dl>
<dt>surname</dt><dd><p>Surname</p>
</dd>
<dt>p_whi</dt><dd><p>Pr(White | Surname)</p>
</dd>
<dt>p_bla</dt><dd><p>Pr(Black | Surname)</p>
</dd>
<dt>p_his</dt><dd><p>Pr(Hispanic/Latino | Surname)</p>
</dd>
<dt>p_asi</dt><dd><p>Pr(Asian/Pacific Islander | Surname)</p>
</dd>
<dt>p_oth</dt><dd><p>Pr(Other | Surname)</p>
</dd>
</dl>
<p>#' 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(surnames2000)
</code></pre>

<hr>
<h2 id='surnames2010'>Census Surname List (2010).</h2><span id='topic+surnames2010'></span>

<h3>Description</h3>

<p>Census Surname List from 2010 with race/ethnicity probabilities by surname.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>surnames2010
</code></pre>


<h3>Format</h3>

<p>A data frame with 167,613 rows and 6 variables:
</p>

<dl>
<dt>surname</dt><dd><p>Surname</p>
</dd>
<dt>p_whi</dt><dd><p>Pr(White | Surname)</p>
</dd>
<dt>p_bla</dt><dd><p>Pr(Black | Surname)</p>
</dd>
<dt>p_his</dt><dd><p>Pr(Hispanic/Latino | Surname)</p>
</dd>
<dt>p_asi</dt><dd><p>Pr(Asian/Pacific Islander | Surname)</p>
</dd>
<dt>p_oth</dt><dd><p>Pr(Other | Surname)</p>
</dd>
</dl>
<p>#' 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(surnames)
</code></pre>

<hr>
<h2 id='vec_to_chunk'>Variable vector into chunks.</h2><span id='topic+vec_to_chunk'></span>

<h3>Description</h3>

<p><code>vec_to_chunk</code> takes a list of variables and collects them into 50-variable chunks.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vec_to_chunk(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vec_to_chunk_+3A_x">x</code></td>
<td>
<p>Character vector of variable names.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function takes a list of variable names and collects them into chunks with no more than
50 variables each. This helps to get around requests with more than 50 variables,because the
API only allows queries of 50 variables at a time.
The user should not need to call this function directly.
</p>


<h3>Value</h3>

<p>Object of class <code>list</code>.
</p>


<h3>References</h3>

<p>Based on code authored by Nicholas Nagle, which is available
<a href="https://rstudio-pubs-static.s3.amazonaws.com/19337_2e7f827190514c569ea136db788ce850.html">here</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
vec_to_chunk(x = c(paste("P012F0", seq(10:49), sep = ""),
              paste("P012I0", seq(10, 49), sep = "")))

## End(Not run)

</code></pre>

<hr>
<h2 id='voters'>Example voter file.</h2><span id='topic+voters'></span>

<h3>Description</h3>

<p>An example dataset containing voter file information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>voters
</code></pre>


<h3>Format</h3>

<p>A data frame with 10 rows and 12 variables:
</p>

<dl>
<dt>VoterID</dt><dd><p>Voter identifier (numeric)</p>
</dd>
<dt>surname</dt><dd><p>Surname</p>
</dd>
<dt>state</dt><dd><p>State of residence</p>
</dd>
<dt>CD</dt><dd><p>Congressional district</p>
</dd>
<dt>county</dt><dd><p>Census county (three-digit code)</p>
</dd>
<dt>first</dt><dd><p>First name</p>
</dd>
<dt>last</dt><dd><p>Last name or surname</p>
</dd>
<dt>tract</dt><dd><p>Census tract (six-digit code)</p>
</dd>
<dt>block</dt><dd><p>Census block (four-digit code)</p>
</dd>
<dt>precinct</dt><dd><p>Voting precinct</p>
</dd>
<dt>place</dt><dd><p>Voting place</p>
</dd>
<dt>age</dt><dd><p>Age in years</p>
</dd>
<dt>sex</dt><dd><p>0=male, 1=female</p>
</dd>
<dt>party</dt><dd><p>Party registration (character)</p>
</dd>
<dt>PID</dt><dd><p>Party registration (numeric)</p>
</dd>
</dl>
<p>#' 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(voters)
</code></pre>

<hr>
<h2 id='wru_data_preflight'>Preflight for name data</h2><span id='topic+wru_data_preflight'></span>

<h3>Description</h3>

<p>Checks if namedata is available in the current working directory, if not
downloads it from github using piggyback. By default, wru will download the
data to a temporary directory that lasts as long as your session does.
However, you may wish to set the <code>wru_data_wd</code> option to save the
downloaded data to your current working directory for more permanence.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wru_data_preflight()
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
