<!DOCTYPE html><html lang="en-US"><head><title>Help for package teal.code</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {teal.code}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#teal.code-package'><p><code>teal.code</code>: Code storage and execution class for teal applications</p></a></li>
<li><a href='#.check_joinable'><p>If two <code>qenv</code> can be joined</p></a></li>
<li><a href='#c.qenv'><p>Join <code>qenv</code> objects</p></a></li>
<li><a href='#concat'><p>Concatenate two <code>qenv</code> objects</p></a></li>
<li><a href='#dev_suppress'><p>Suppresses plot display in the IDE by opening a PDF graphics device</p></a></li>
<li><a href='#eval_code'><p>Evaluate code in <code>qenv</code></p></a></li>
<li><a href='#get_code'><p>Get code from <code>qenv</code></p></a></li>
<li><a href='#get_code_dependency'><p>Get code dependency of an object</p></a></li>
<li><a href='#get_env'><p>Access environment included in <code>qenv</code></p></a></li>
<li><a href='#get_messages'><p>Get messages from <code>qenv</code> object</p></a></li>
<li><a href='#get_var'><p>Get object from <code>qenv</code></p></a></li>
<li><a href='#get_warn_message_util'><p>Obtain warnings or messages from code slot</p></a></li>
<li><a href='#get_warnings'><p>Get warnings from <code>qenv</code> object</p></a></li>
<li><a href='#lang2calls'><p>Separate calls</p></a></li>
<li><a href='#qenv'><p>Instantiates a <code>qenv</code> environment</p></a></li>
<li><a href='#qenv-class'><p>Reproducible class with environment and code</p></a></li>
<li><a href='#show+2Cqenv-method'><p>Display <code>qenv</code> object</p></a></li>
<li><a href='#subset-qenv'><p>Subsets <code>qenv</code></p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Code Storage and Execution Class for 'teal' Applications</td>
</tr>
<tr>
<td>Version:</td>
<td>0.6.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2025-02-13</td>
</tr>
<tr>
<td>Description:</td>
<td>Introduction of 'qenv' S4 class, that facilitates code
    execution and reproducibility in 'teal' applications.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://insightsengineering.github.io/teal.code/">https://insightsengineering.github.io/teal.code/</a>,
<a href="https://github.com/insightsengineering/teal.code">https://github.com/insightsengineering/teal.code</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/insightsengineering/teal.code/issues">https://github.com/insightsengineering/teal.code/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>methods, R (&ge; 4.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>checkmate (&ge; 2.1.0), cli (&ge; 3.4.0), grDevices, lifecycle (&ge;
0.2.0), rlang (&ge; 1.1.0), stats, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr (&ge; 1.42), rmarkdown (&ge; 2.23), shiny (&ge; 1.6.0),
testthat (&ge; 3.1.8), withr (&ge; 2.0.0)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>RdMacros:</td>
<td>lifecycle</td>
</tr>
<tr>
<td>Config/Needs/verdepcheck:</td>
<td>mllg/checkmate, r-lib/cli, r-lib/lifecycle,
r-lib/rlang, r-lib/cli, yihui/knitr, rstudio/rmarkdown,
rstudio/shiny, r-lib/testthat, r-lib/withr</td>
</tr>
<tr>
<td>Config/Needs/website:</td>
<td>insightsengineering/nesttemplate</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Collate:</td>
<td>'qenv-c.R' 'qenv-class.R' 'qenv-errors.R' 'qenv-concat.R'
'qenv-constructor.R' 'qenv-eval_code.R' 'qenv-extract.R'
'qenv-get_code.R' 'qenv-get_env.R' 'qenv-get_messages.r'
'qenv-get_var.R' 'qenv-get_warnings.R' 'qenv-join.R'
'qenv-length.R' 'qenv-show.R' 'qenv-within.R'
'teal.code-package.R' 'utils-get_code_dependency.R' 'utils.R'</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-02-14 01:12:45 UTC; unardid</td>
</tr>
<tr>
<td>Author:</td>
<td>Dawid Kaledkowski [aut, cre],
  Aleksander Chlebowski [aut],
  Marcin Kosinski [aut],
  Pawel Rucki [aut],
  Nikolas Burkoff [aut],
  Mahmoud Hallal [aut],
  Maciej Nasinski [aut],
  Konrad Pagacz [aut],
  Junlue Zhao [aut],
  Chendi Liao [rev],
  Dony Unardi [rev],
  F. Hoffmann-La Roche AG [cph, fnd]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Dawid Kaledkowski &lt;dawid.kaledkowski@roche.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-02-14 05:40:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='teal.code-package'><code>teal.code</code>: Code storage and execution class for teal applications</h2><span id='topic+teal.code'></span><span id='topic+teal.code-package'></span>

<h3>Description</h3>

<p>The <code>teal.code</code> package contains functionalities that can be used
to store and execute R calls. <code>qenv</code> class allows to create a <code>teal</code>
module which returns code to reproduce application outputs.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Dawid Kaledkowski <a href="mailto:dawid.kaledkowski@roche.com">dawid.kaledkowski@roche.com</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Aleksander Chlebowski <a href="mailto:aleksander.chlebowski@contractors.roche.com">aleksander.chlebowski@contractors.roche.com</a>
</p>
</li>
<li><p> Marcin Kosinski <a href="mailto:marcin.kosinski.mk1@roche.com">marcin.kosinski.mk1@roche.com</a>
</p>
</li>
<li><p> Pawel Rucki <a href="mailto:pawel.rucki@roche.com">pawel.rucki@roche.com</a>
</p>
</li>
<li><p> Nikolas Burkoff <a href="mailto:nikolas.burkoff@roche.com">nikolas.burkoff@roche.com</a>
</p>
</li>
<li><p> Mahmoud Hallal <a href="mailto:mahmoud.hallal@roche.com">mahmoud.hallal@roche.com</a>
</p>
</li>
<li><p> Maciej Nasinski <a href="mailto:maciej.nasinski@contractors.roche.com">maciej.nasinski@contractors.roche.com</a>
</p>
</li>
<li><p> Konrad Pagacz <a href="mailto:konrad.pagacz@contractors.roche.com">konrad.pagacz@contractors.roche.com</a>
</p>
</li>
<li><p> Junlue Zhao <a href="mailto:zhaoj88@gene.com">zhaoj88@gene.com</a>
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Chendi Liao <a href="mailto:chendi.liao@roche.com">chendi.liao@roche.com</a> [reviewer]
</p>
</li>
<li><p> Dony Unardi <a href="mailto:unardid@gene.com">unardid@gene.com</a> [reviewer]
</p>
</li>
<li><p> F. Hoffmann-La Roche AG [copyright holder, funder]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://insightsengineering.github.io/teal.code/">https://insightsengineering.github.io/teal.code/</a>
</p>
</li>
<li> <p><a href="https://github.com/insightsengineering/teal.code">https://github.com/insightsengineering/teal.code</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/insightsengineering/teal.code/issues">https://github.com/insightsengineering/teal.code/issues</a>
</p>
</li></ul>


<hr>
<h2 id='.check_joinable'>If two <code>qenv</code> can be joined</h2><span id='topic+.check_joinable'></span>

<h3>Description</h3>

<p>Checks if two <code>qenv</code> objects can be combined.
For more information, please see <code><a href="#topic+join">join</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.check_joinable(x, y)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id=".check_joinable_+3A_x">x</code></td>
<td>
<p>(<code>qenv</code>)</p>
</td></tr>
<tr><td><code id=".check_joinable_+3A_y">y</code></td>
<td>
<p>(<code>qenv</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>TRUE</code> if able to join or <code>character</code> used to print error message.
</p>

<hr>
<h2 id='c.qenv'>Join <code>qenv</code> objects</h2><span id='topic+c.qenv'></span><span id='topic+c.qenv.error'></span><span id='topic+join'></span><span id='topic+join+2Cqenv+2Cqenv-method'></span><span id='topic+join+2Cqenv+2Cqenv.error-method'></span><span id='topic+join+2Cqenv.error+2CANY-method'></span>

<h3>Description</h3>

<p>Checks and merges two <code>qenv</code> objects into one <code>qenv</code> object.
</p>
<p>The <code>join()</code> function is superseded by the <code>c()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'qenv'
c(...)

## S3 method for class 'qenv.error'
c(...)

join(x, y)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="c.qenv_+3A_...">...</code></td>
<td>
<p>(<code>qenv</code> or <code>qenv.error</code>).</p>
</td></tr>
<tr><td><code id="c.qenv_+3A_x">x</code></td>
<td>
<p>(<code>qenv</code>)</p>
</td></tr>
<tr><td><code id="c.qenv_+3A_y">y</code></td>
<td>
<p>(<code>qenv</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Any common code at the start of the <code>qenvs</code> is only placed once at the start of the joined <code>qenv</code>.
This allows consistent behavior when joining <code>qenvs</code> which share a common ancestor.
See below for an example.
</p>
<p>There are some situations where <code>join()</code> cannot be properly performed, such as these three scenarios:
</p>

<ol>
<li><p> Both <code>qenv</code> objects contain an object of the same name but are not identical.
</p>
<p>Example:
</p>
<div class="sourceCode r"><pre>x &lt;- eval_code(qenv(), expression(mtcars1 &lt;- mtcars))
y &lt;- eval_code(qenv(), expression(mtcars1 &lt;- mtcars['wt']))

z &lt;- c(x, y)
# Error message will occur
</pre></div>
<p>In this example, <code>mtcars1</code> object exists in both <code>x</code> and <code>y</code> objects but the content are not identical.
<code>mtcars1</code> in the <code style="white-space: pre;">&#8288;x qenv&#8288;</code> object has more columns than <code>mtcars1</code> in the <code style="white-space: pre;">&#8288;y qenv&#8288;</code> object (only has one column).
</p>
</li>
<li> <p><code>join()</code> will look for identical code elements in both <code>qenv</code> objects.
The index position of these code elements must be the same to determine the evaluation order.
Otherwise, <code>join()</code> will throw an error message.
</p>
<p>Example:
</p>
<div class="sourceCode r"><pre>common_q &lt;- eval_code(qenv(), expression(v &lt;- 1))
x &lt;- eval_code(
  common_q,
  "x &lt;- v"
)
y &lt;- eval_code(
  common_q,
  "y &lt;- v"
)
z &lt;- eval_code(
  y,
  "z &lt;- v"
)
q &lt;- c(x, y)
join_q &lt;- c(q, z)
# Error message will occur

# Check the order of evaluation based on the id slot
</pre></div>
<p>The error occurs because the index position of common code elements in the two objects is not the same.
</p>
</li>
<li><p> The usage of temporary variable in the code expression could cause <code>join()</code> to fail.
</p>
<p>Example:
</p>
<div class="sourceCode r"><pre>common_q &lt;- qenv()
x &lt;- eval_code(
  common_q,
  "x &lt;- numeric(0)
   for (i in 1:2) {
     x &lt;- c(x, i)
   }"
)
y &lt;- eval_code(
  common_q,
  "y &lt;- numeric(0)
   for (i in 1:3) {
     y &lt;- c(y, i)
   }"
)
q &lt;- join(x,y)
# Error message will occur

# Check the value of temporary variable i in both objects
x$i # Output: 2
y$i # Output: 3
</pre></div>
<p><code>c()</code> fails to provide a proper result because of the temporary variable <code>i</code> exists
in both objects but has different value.
To fix this, we can set <code>i &lt;- NULL</code> in the code expression for both objects.
</p>
<div class="sourceCode r"><pre>common_q &lt;- qenv()
x &lt;- eval_code(
  common_q,
  "x &lt;- numeric(0)
   for (i in 1:2) {
     x &lt;- c(x, i)
   }
   # dummy i variable to fix it
   i &lt;- NULL"
)
y &lt;- eval_code(
  common_q,
  "y &lt;- numeric(0)
   for (i in 1:3) {
     y &lt;- c(y, i)
   }
   # dummy i variable to fix it
   i &lt;- NULL"
)
q &lt;- c(x,y)
</pre></div>
</li></ol>



<h3>Value</h3>

<p><code>qenv</code> object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>q &lt;- qenv()
q1 &lt;- within(q, {
  iris1 &lt;- iris
  mtcars1 &lt;- mtcars
})
q1 &lt;- within(q1, iris2 &lt;- iris)
q2 &lt;- within(q1, mtcars2 &lt;- mtcars)
qq &lt;- c(q1, q2)
cat(get_code(qq))

q &lt;- qenv()
q1 &lt;- eval_code(q, expression(iris1 &lt;- iris, mtcars1 &lt;- mtcars))
q2 &lt;- q1
q1 &lt;- eval_code(q1, "iris2 &lt;- iris")
q2 &lt;- eval_code(q2, "mtcars2 &lt;- mtcars")
qq &lt;- join(q1, q2)
cat(get_code(qq))

common_q &lt;- eval_code(q, quote(x &lt;- 1))
y_q &lt;- eval_code(common_q, quote(y &lt;- x * 2))
z_q &lt;- eval_code(common_q, quote(z &lt;- x * 3))
join_q &lt;- join(y_q, z_q)
# get_code only has "x &lt;- 1" occurring once
cat(get_code(join_q))

</code></pre>

<hr>
<h2 id='concat'>Concatenate two <code>qenv</code> objects</h2><span id='topic+concat'></span><span id='topic+concat+2Cqenv+2Cqenv-method'></span><span id='topic+concat+2Cqenv.error+2CANY-method'></span><span id='topic+concat+2Cqenv+2Cqenv.error-method'></span>

<h3>Description</h3>

<p>Combine two <code>qenv</code> objects by simple concatenate their environments and the code.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>concat(x, y)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="concat_+3A_x">x</code></td>
<td>
<p>(<code>qenv</code>)</p>
</td></tr>
<tr><td><code id="concat_+3A_y">y</code></td>
<td>
<p>(<code>qenv</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We recommend to use the <code>join</code> method to have a stricter control
in case <code>x</code> and <code>y</code> contain duplicated bindings and code.
RHS argument content has priority over the LHS one.
</p>


<h3>Value</h3>

<p><code>qenv</code> object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>q &lt;- qenv()
q1 &lt;- eval_code(q, expression(iris1 &lt;- iris, mtcars1 &lt;- mtcars))
q2 &lt;- q1
q1 &lt;- eval_code(q1, "iris2 &lt;- iris")
q2 &lt;- eval_code(q2, "mtcars2 &lt;- mtcars")
qq &lt;- concat(q1, q2)
get_code(qq)

</code></pre>

<hr>
<h2 id='dev_suppress'>Suppresses plot display in the IDE by opening a PDF graphics device</h2><span id='topic+dev_suppress'></span>

<h3>Description</h3>

<p>This function opens a PDF graphics device using <code><a href="grDevices.html#topic+pdf">grDevices::pdf</a></code> to suppress
the plot display in the IDE. The purpose of this function is to avoid opening graphic devices
directly in the IDE.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dev_suppress(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dev_suppress_+3A_x">x</code></td>
<td>
<p>lazy binding which generates the plot(s)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function uses <code><a href="base.html#topic+on.exit">base::on.exit</a></code> to ensure that the PDF graphics
device is closed (using <code><a href="grDevices.html#topic+dev">grDevices::dev.off</a></code>) when the function exits,
regardless of whether it exits normally or due to an error. This is necessary to
clean up the graphics device properly and avoid any potential issues.
</p>


<h3>Value</h3>

<p>No return value, called for side effects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dev_suppress(plot(1:10))
</code></pre>

<hr>
<h2 id='eval_code'>Evaluate code in <code>qenv</code></h2><span id='topic+eval_code'></span><span id='topic+eval_code+2Cqenv+2Ccharacter-method'></span><span id='topic+eval_code+2Cqenv+2Clanguage-method'></span><span id='topic+eval_code+2Cqenv+2Cexpression-method'></span><span id='topic+eval_code+2Cqenv.error+2CANY-method'></span><span id='topic+within.qenv'></span>

<h3>Description</h3>

<p>Evaluate code in <code>qenv</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>eval_code(object, code)

## S3 method for class 'qenv'
within(data, expr, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="eval_code_+3A_object">object</code></td>
<td>
<p>(<code>qenv</code>)</p>
</td></tr>
<tr><td><code id="eval_code_+3A_code">code</code></td>
<td>
<p>(<code>character</code>, <code>language</code> or <code>expression</code>) code to evaluate.
It is possible to preserve original formatting of the <code>code</code> by providing a <code>character</code> or an
<code>expression</code> being a result of <code>parse(keep.source = TRUE)</code>.</p>
</td></tr>
<tr><td><code id="eval_code_+3A_data">data</code></td>
<td>
<p>(<code>qenv</code>)</p>
</td></tr>
<tr><td><code id="eval_code_+3A_expr">expr</code></td>
<td>
<p>(<code>expression</code>) to evaluate. Must be inline code, see <code style="white-space: pre;">&#8288;Using language objects...&#8288;</code></p>
</td></tr>
<tr><td><code id="eval_code_+3A_...">...</code></td>
<td>
<p>named argument value will substitute a symbol in the <code>expr</code> matched by the name.
For practical usage see Examples section below.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>eval_code()</code> evaluates given code in the <code>qenv</code> environment and appends it to the <code>code</code> slot.
Thus, if the <code>qenv</code> had been instantiated empty, contents of the environment are always a result of the stored code.
</p>
<p><code>within()</code> is a convenience method that wraps <code>eval_code</code> to provide a simplified way of passing expression.
<code>within</code> accepts only inline expressions (both simple and compound) and allows to substitute <code>expr</code>
with <code>...</code> named argument values.
</p>


<h3>Value</h3>

<p><code>qenv</code> environment with <code>code/expr</code> evaluated or <code>qenv.error</code> if evaluation fails.
</p>


<h3>Using language objects with <code>within</code></h3>

<p>Passing language objects to <code>expr</code> is generally not intended but can be achieved with <code>do.call</code>.
Only single <code>expression</code>s will work and substitution is not available. See examples.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># evaluate code in qenv
q &lt;- qenv()
q &lt;- eval_code(q, "a &lt;- 1")
q &lt;- eval_code(q, "b &lt;- 2L # with comment")
q &lt;- eval_code(q, quote(library(checkmate)))
q &lt;- eval_code(q, expression(assert_number(a)))

# evaluate code using within
q &lt;- qenv()
q &lt;- within(q, {
  i &lt;- iris
})
q &lt;- within(q, {
  m &lt;- mtcars
  f &lt;- faithful
})
q
get_code(q)

# inject values into code
q &lt;- qenv()
q &lt;- within(q, i &lt;- iris)
within(q, print(dim(subset(i, Species == "virginica"))))
within(q, print(dim(subset(i, Species == species)))) # fails
within(q, print(dim(subset(i, Species == species))), species = "versicolor")
species_external &lt;- "versicolor"
within(q, print(dim(subset(i, Species == species))), species = species_external)

# pass language objects
expr &lt;- expression(i &lt;- iris, m &lt;- mtcars)
within(q, expr) # fails
do.call(within, list(q, expr))

exprlist &lt;- list(expression(i &lt;- iris), expression(m &lt;- mtcars))
within(q, exprlist) # fails
do.call(within, list(q, do.call(c, exprlist)))

</code></pre>

<hr>
<h2 id='get_code'>Get code from <code>qenv</code></h2><span id='topic+get_code'></span><span id='topic+get_code+2Cqenv-method'></span><span id='topic+get_code+2Cqenv.error-method'></span>

<h3>Description</h3>

<p>Retrieves the code stored in the <code>qenv</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_code(object, deparse = TRUE, names = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_code_+3A_object">object</code></td>
<td>
<p>(<code>qenv</code>)</p>
</td></tr>
<tr><td><code id="get_code_+3A_deparse">deparse</code></td>
<td>
<p>(<code>logical(1)</code>) flag specifying whether to return code as <code>character</code> or <code>expression</code>.</p>
</td></tr>
<tr><td><code id="get_code_+3A_names">names</code></td>
<td>
<p>(<code>character</code>) <a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a> vector of object names to return the code for.
For more details see the &quot;Extracting dataset-specific code&quot; section.</p>
</td></tr>
<tr><td><code id="get_code_+3A_...">...</code></td>
<td>
<p>internal usage, please ignore.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The code used in the <code>qenv</code> in the form specified by <code>deparse</code>.
</p>


<h3>Extracting dataset-specific code</h3>

<p><code>get_code(object, names)</code> limits the returned code to contain only those lines needed to <em>create</em>
the requested objects. The code stored in the <code>qenv</code> is analyzed statically to determine
which lines the objects of interest depend upon. The analysis works well when objects are created
with standard infix assignment operators (see <code>?assignOps</code>) but it can fail in some situations.
</p>
<p>Consider the following examples:
</p>
<p><em>Case 1: Usual assignments.</em>
</p>
<div class="sourceCode r"><pre>q1 &lt;-
  within(qenv(), {
    foo &lt;- function(x) {
      x + 1
    }
    x &lt;- 0
    y &lt;- foo(x)
  })
get_code(q1, names = "y")
</pre></div>
<p><code>x</code> has no dependencies, so <code>get_code(data, names = "x")</code> will return only the second call.<br />
<code>y</code> depends on <code>x</code> and <code>foo</code>, so <code>get_code(data, names = "y")</code> will contain all three calls.
</p>
<p><em>Case 2: Some objects are created by a function's side effects.</em>
</p>
<div class="sourceCode r"><pre>q2 &lt;-
  within(qenv(){
    foo &lt;- function() {
      x &lt;&lt;- x + 1
    }
    x &lt;- 0
    foo()
    y &lt;- x
  })
get_code(q2, names = "y")
</pre></div>
<p>Here, <code>y</code> depends on <code>x</code> but <code>x</code> is modified by <code>foo</code> as a side effect (not by reassignment)
and so <code>get_code(data, names = "y")</code> will not return the <code>foo()</code> call.<br />
To overcome this limitation, code dependencies can be specified manually.
Lines where side effects occur can be flagged by adding &quot;<code style="white-space: pre;">&#8288;# @linksto &lt;object name&gt;&#8288;</code>&quot; at the end.<br />
Note that <code>within</code> evaluates code passed to <code>expr</code> as is and comments are ignored.
In order to include comments in code one must use the <code>eval_code</code> function instead.
</p>
<div class="sourceCode r"><pre>q3 &lt;-
  eval_code(qenv(), "
    foo &lt;- function() {
      x &lt;&lt;- x + 1
    }
    x &lt;- 0
    foo() # @linksto x
    y &lt;- x
  ")
get_code(q3, names = "y")
</pre></div>
<p>Now the <code>foo()</code> call will be properly included in the code required to recreate <code>y</code>.
</p>
<p>Note that two functions that create objects as side effects, <code>assign</code> and <code>data</code>, are handled automatically.
</p>
<p>Here are known cases where manual tagging is necessary:
</p>

<ul>
<li><p> non-standard assignment operators, <em>e.g.</em> <code style="white-space: pre;">&#8288;%&lt;&gt;%&#8288;</code>
</p>
</li>
<li><p> objects used as conditions in <code>if</code> statements: <code style="white-space: pre;">&#8288;if (&lt;condition&gt;)&#8288;</code>
</p>
</li>
<li><p> objects used to iterate over in <code>for</code> loops: <code style="white-space: pre;">&#8288;for(i in &lt;sequence&gt;)&#8288;</code>
</p>
</li>
<li><p> creating and evaluating language objects, <em>e.g.</em> <code style="white-space: pre;">&#8288;eval(&lt;call&gt;)&#8288;</code>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># retrieve code
q &lt;- within(qenv(), {
  a &lt;- 1
  b &lt;- 2
})
get_code(q)
get_code(q, deparse = FALSE)
get_code(q, names = "a")

q &lt;- qenv()
q &lt;- eval_code(q, code = c("a &lt;- 1", "b &lt;- 2"))
get_code(q, names = "a")

</code></pre>

<hr>
<h2 id='get_code_dependency'>Get code dependency of an object</h2><span id='topic+get_code_dependency'></span>

<h3>Description</h3>

<p>Extract subset of code required to reproduce specific object(s), including code producing side-effects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_code_dependency(code, names, check_code_names = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_code_dependency_+3A_code">code</code></td>
<td>
<p><code>character</code> with the code.</p>
</td></tr>
<tr><td><code id="get_code_dependency_+3A_names">names</code></td>
<td>
<p><code>character</code> vector of object names.</p>
</td></tr>
<tr><td><code id="get_code_dependency_+3A_check_code_names">check_code_names</code></td>
<td>
<p><code>logical(1)</code> flag specifying if a warning for non-existing names should be displayed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Given a character vector with code, this function will extract the part of the code responsible for creating
the variables specified by <code>names</code>.
This includes the final call that creates the variable(s) in question as well as all <em>parent calls</em>,
<em>i.e.</em> calls that create variables used in the final call and their parents, etc.
Also included are calls that create side-effects like establishing connections.
</p>
<p>It is assumed that object dependency is established by using three assignment operators: <code style="white-space: pre;">&#8288;&lt;-&#8288;</code>, <code>=</code>, and <code style="white-space: pre;">&#8288;-&gt;&#8288;</code> .
Other assignment methods (<code>assign</code>, <code style="white-space: pre;">&#8288;&lt;&lt;-&#8288;</code>) or non-standard-evaluation methods are not supported.
</p>
<p>Side-effects are not detected automatically and must be marked in the code.
Add <code style="white-space: pre;">&#8288;# @linksto object&#8288;</code> at the end of a line where a side-effect occurs to specify that this line is required
to reproduce a variable called <code>object</code>.
</p>


<h3>Value</h3>

<p>Character vector, a subset of <code>code</code>.
Note that subsetting is actually done on the calls <code>code</code>, not necessarily on the elements of the vector.
</p>

<hr>
<h2 id='get_env'>Access environment included in <code>qenv</code></h2><span id='topic+get_env'></span><span id='topic+get_env+2Cqenv-method'></span><span id='topic+get_env+2Cqenv.error-method'></span>

<h3>Description</h3>

<p>The access of environment included in the <code>qenv</code> that contains all data objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_env(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_env_+3A_object">object</code></td>
<td>
<p>(<code>qenv</code>).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An <code>environment</code> stored in <code>qenv</code> with all data objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>q &lt;- qenv()
q1 &lt;- within(q, {
  a &lt;- 5
  b &lt;- data.frame(x = 1:10)
})
get_env(q1)

</code></pre>

<hr>
<h2 id='get_messages'>Get messages from <code>qenv</code> object</h2><span id='topic+get_messages'></span><span id='topic+get_messages+2Cqenv-method'></span><span id='topic+get_messages+2Cqenv.error-method'></span><span id='topic+get_messages+2CNULL-method'></span>

<h3>Description</h3>

<p>Retrieve all messages raised during code evaluation in a <code>qenv</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_messages(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_messages_+3A_object">object</code></td>
<td>
<p>(<code>qenv</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>character</code> containing warning information or <code>NULL</code> if no messages.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data_q &lt;- qenv()
data_q &lt;- eval_code(data_q, "iris_data &lt;- iris")
warning_qenv &lt;- eval_code(
  data_q,
  bquote(p &lt;- hist(iris_data[, .("Sepal.Length")], ff = ""))
)
cat(get_messages(warning_qenv))

</code></pre>

<hr>
<h2 id='get_var'>Get object from <code>qenv</code></h2><span id='topic+get_var'></span><span id='topic+get_var+2Cqenv+2Ccharacter-method'></span><span id='topic+get_var+2Cqenv.error+2CANY-method'></span><span id='topic++5B+5B.qenv.error'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
Instead of <code><a href="#topic+get_var">get_var()</a></code> use native <span class="rlang"><b>R</b></span> operators/functions:
<code>x[[name]]</code>, <code>x$name</code> or <code><a href="base.html#topic+get">get()</a></code>:
</p>
<p>Retrieve variables from the <code>qenv</code> environment.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_var(object, var)

## S3 method for class 'qenv.error'
x[[i]]
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_var_+3A_object">object</code>, <code id="get_var_+3A_x">x</code></td>
<td>
<p>(<code>qenv</code>)</p>
</td></tr>
<tr><td><code id="get_var_+3A_var">var</code>, <code id="get_var_+3A_i">i</code></td>
<td>
<p>(<code>character(1)</code>) variable name.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The value of required variable (<code>var</code>) within <code>qenv</code> object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>q &lt;- qenv()
q1 &lt;- eval_code(q, code = quote(a &lt;- 1))
q2 &lt;- eval_code(q1, code = "b &lt;- a")
get_var(q2, "b")

</code></pre>

<hr>
<h2 id='get_warn_message_util'>Obtain warnings or messages from code slot</h2><span id='topic+get_warn_message_util'></span>

<h3>Description</h3>

<p>Obtain warnings or messages from code slot
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_warn_message_util(object, what)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_warn_message_util_+3A_object">object</code></td>
<td>
<p>(<code>qenv</code>)</p>
</td></tr>
<tr><td><code id="get_warn_message_util_+3A_what">what</code></td>
<td>
<p>(<code>"warning"</code> or <code>"message"</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>character(1)</code> containing combined message or <code>NULL</code> when no warnings/messages
</p>

<hr>
<h2 id='get_warnings'>Get warnings from <code>qenv</code> object</h2><span id='topic+get_warnings'></span><span id='topic+get_warnings+2Cqenv-method'></span><span id='topic+get_warnings+2Cqenv.error-method'></span><span id='topic+get_warnings+2CNULL-method'></span>

<h3>Description</h3>

<p>Retrieve all warnings raised during code evaluation in a <code>qenv</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_warnings(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_warnings_+3A_object">object</code></td>
<td>
<p>(<code>qenv</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>character</code> containing warning information or <code>NULL</code> if no warnings.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data_q &lt;- qenv()
data_q &lt;- eval_code(data_q, "iris_data &lt;- iris")
warning_qenv &lt;- eval_code(
  data_q,
  bquote(p &lt;- hist(iris_data[, .("Sepal.Length")], ff = ""))
)
cat(get_warnings(warning_qenv))

</code></pre>

<hr>
<h2 id='lang2calls'>Separate calls</h2><span id='topic+lang2calls'></span>

<h3>Description</h3>

<p>Converts language object or lists of language objects to list of simple calls.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lang2calls(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lang2calls_+3A_x">x</code></td>
<td>
<p><code>language</code> object or a list of thereof</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Given a <code>call</code>, an <code>expression</code>, a list of <code>call</code>s or a list of <code>expression</code>s, returns a list of <code>calls</code>.
Symbols and atomic vectors (which may get mixed up in a list) are returned wrapped in list.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># use non-exported function from teal.code
lang2calls &lt;- getFromNamespace("lang2calls", "teal.code")
expr &lt;- expression(
  i &lt;- iris,
  m &lt;- mtcars
)
lang2calls(expr)
</code></pre>

<hr>
<h2 id='qenv'>Instantiates a <code>qenv</code> environment</h2><span id='topic+qenv'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>
<p>Instantiates a <code>qenv</code> environment.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>qenv()
</code></pre>


<h3>Details</h3>

<p><code>qenv</code> class has following characteristics:
</p>

<ul>
<li><p> It inherits from the environment and methods such as <code><a href="base.html#topic++24">$</a></code>, <code><a href="base.html#topic+get">get()</a></code>, <code><a href="base.html#topic+ls">ls()</a></code>, <code><a href="base.html#topic+as.list">as.list()</a></code>,
<code><a href="base.html#topic+parent.env">parent.env()</a></code> work out of the box.
</p>
</li>
<li> <p><code>qenv</code> is a locked environment, and data modification is only possible through the <code><a href="#topic+eval_code">eval_code()</a></code>
and <code><a href="#topic+within.qenv">within.qenv()</a></code> functions.
</p>
</li>
<li><p> It stores metadata about the code used to create the data (see <code><a href="#topic+get_code">get_code()</a></code>).
</p>
</li>
<li><p> It supports slicing (see <code><a href="#topic+subset-qenv">subset-qenv</a></code>)
</p>
</li>
<li><p> It is immutable which means that each code evaluation does not modify the original <code>qenv</code>
environment directly. See the following code:
</p>
<div class="sourceCode"><pre>q1 &lt;- qenv()
q2 &lt;- eval_code(q1, "a &lt;- 1")
identical(q1, q2) # FALSE
</pre></div>
</li></ul>



<h3>Value</h3>

<p><code>qenv</code> environment.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+eval_code">eval_code()</a></code>, <code><a href="#topic+get_var">get_var()</a></code>, <code><a href="#topic+subset-qenv">subset-qenv</a></code>, <code><a href="#topic+get_env">get_env()</a></code>,<code><a href="#topic+get_warnings">get_warnings()</a></code>, <code><a href="#topic+join">join()</a></code>, <code><a href="#topic+concat">concat()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>q &lt;- qenv()
q2 &lt;- within(q, a &lt;- 1)
ls(q2)
q2$a
</code></pre>

<hr>
<h2 id='qenv-class'>Reproducible class with environment and code</h2><span id='topic+qenv-class'></span>

<h3>Description</h3>

<p>Reproducible class with environment and code.
</p>


<h3>Slots</h3>


<dl>
<dt><code>.xData</code></dt><dd><p>(<code>environment</code>) environment with content was generated by the evaluation</p>
</dd>
<dt><code>code</code></dt><dd><p>(<code style="white-space: pre;">&#8288;named list&#8288;</code> of <code>character</code>) representing code necessary to reproduce the environment.
Read more in Code section.
of the <code>code</code> slot.</p>
</dd>
</dl>


<h3>Code</h3>

<p>Each code element is a character representing one call. Each element is named with the random
identifier to make sure uniqueness when joining. Each element has possible attributes:
</p>

<ul>
<li> <p><code>warnings</code> (<code>character</code>) the warnings output when evaluating the code element.
</p>
</li>
<li> <p><code>messages</code> (<code>character</code>) the messages output when evaluating the code element.
</p>
</li>
<li> <p><code>dependency</code> (<code>character</code>) names of objects that appear in this call and gets affected by this call,
separated by <code style="white-space: pre;">&#8288;&lt;-&#8288;</code> (objects on LHS of <code style="white-space: pre;">&#8288;&lt;-&#8288;</code> are affected by this line, and objects on RHS are affecting this line).
</p>
</li></ul>


<hr>
<h2 id='show+2Cqenv-method'>Display <code>qenv</code> object</h2><span id='topic+show+2Cqenv-method'></span><span id='topic+show-qenv'></span>

<h3>Description</h3>

<p>Prints the <code>qenv</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'qenv'
show(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="show+2B2Cqenv-method_+3A_object">object</code></td>
<td>
<p>(<code>qenv</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>object</code>, invisibly.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>q &lt;- qenv()
q1 &lt;- eval_code(q, expression(a &lt;- 5, b &lt;- data.frame(x = 1:10)))
q1

</code></pre>

<hr>
<h2 id='subset-qenv'>Subsets <code>qenv</code></h2><span id='topic+subset-qenv'></span><span id='topic++5B.qenv'></span>

<h3>Description</h3>

<p>Subsets <code><a href="#topic+qenv">qenv</a></code> environment and limits the code to the necessary needed to build limited objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'qenv'
x[names, ...]
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="subset-qenv_+3A_x">x</code></td>
<td>
<p>(<code>qenv</code>)</p>
</td></tr>
<tr><td><code id="subset-qenv_+3A_names">names</code></td>
<td>
<p>(<code>character</code>) names of objects included in <code><a href="#topic+qenv">qenv</a></code> to subset. Names not present in <code><a href="#topic+qenv">qenv</a></code>
are skipped.</p>
</td></tr>
<tr><td><code id="subset-qenv_+3A_...">...</code></td>
<td>
<p>internal usage, please ignore.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>q &lt;- qenv()
q &lt;- eval_code(q, "a &lt;- 1;b&lt;-2")
q["a"]
q[c("a", "b")]

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
