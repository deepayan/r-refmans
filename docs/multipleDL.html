<!DOCTYPE html><html><head><title>Help for package multipleDL</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {multipleDL}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#multipleDL-package'><p>Address Detection Limits by Cumulative Probability Models</p></a></li>
<li><a href='#cdf_dl'><p>Calculate conditional CDFs</p></a></li>
<li><a href='#func_link'><p>Link functions</p></a></li>
<li><a href='#func_link_num'><p>Link functions (number)</p></a></li>
<li><a href='#func_V'><p>Calculate the covariance matrix</p></a></li>
<li><a href='#multipleDL'><p>CPMs for multiple detection limits</p></a></li>
<li><a href='#quantile_dl'><p>Calculate conditional quantiles</p></a></li>
<li><a href='#selectedQr'><p>QR Decomposition Preserving Selected Columns</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>1.0.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-11-17</td>
</tr>
<tr>
<td>Title:</td>
<td>Addressing Detection Limits by Cumulative Probability Models
(CPMs)</td>
</tr>
<tr>
<td>Description:</td>
<td>Build CPMs (cumulative probability models, also known as cumulative link models) to account for detection limits (both single and multiple detection limits) in response variables. Conditional quantiles and conditional CDFs can be calculated based on fitted models. The package implements methods described in Tian, Y., Li, C., Tu, S., James, N. T., Harrell, F. E., &amp; Shepherd, B. E. (2022). "Addressing Detection Limits with Semiparametric Cumulative Probability Models". &lt;<a href="https://doi.org/10.48550/arXiv.2207.02815">doi:10.48550/arXiv.2207.02815</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>Biarch:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.4.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>methods, stats, Rcpp (&ge; 0.12.0), RcppParallel (&ge; 5.0.1),
rstan (&ge; 2.18.1), rstantools (&ge; 2.1.1), SparseM</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>BH (&ge; 1.66.0), Rcpp (&ge; 0.12.0), RcppEigen (&ge; 0.3.3.3.0),
RcppParallel (&ge; 5.0.1), rstan (&ge; 2.18.1), StanHeaders (&ge;
2.18.0)</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>GNU make</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-11-23 17:40:43 UTC; yuqitian</td>
</tr>
<tr>
<td>Author:</td>
<td>Yuqi Tian [aut, cre],
  Chun Li [aut],
  Shengxin Tu [aut],
  Nathan James [aut],
  Frank Harrell [aut],
  Bryan Shepherd [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Yuqi Tian &lt;yuqitian35@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-11-24 13:20:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='multipleDL-package'>Address Detection Limits by Cumulative Probability Models</h2><span id='topic+multipleDL-package'></span>

<h3>Description</h3>

<p>The package allows fitting regression models on continuous/ordinal response data subject to detection limits (DLs)
based on cumulative probability models (CPMs). Both single and multiple DLs can be handled. Conditional quantiles and CDFs
(cumulative distribution functions) can obtained from fitted models.
</p>


<h3>Details</h3>

<p>The 'multipleDL' package.
</p>


<h3>References</h3>

<p>Stan Development Team (2020). RSroxygen2::roxygenize()tan: the R interface to Stan. R package version 2.19.3. https://mc-stan.org
Harrell, F. (2020). rms: Regression modeling strategies. R package version 6.1.0. https://CRAN.R-project.org/package=rms
Tian et al. &quot;Addressing detection limits by semiparametric cumulative probability models.&quot; (2022) (to be submitted)
</p>

<hr>
<h2 id='cdf_dl'>Calculate conditional CDFs</h2><span id='topic+cdf_dl'></span>

<h3>Description</h3>

<p>This functions calculates the conditional CDFs based on the fitted model
and new data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cdf_dl(mod, new.data, at.y = 0, se = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cdf_dl_+3A_mod">mod</code></td>
<td>
<p>the model</p>
</td></tr>
<tr><td><code id="cdf_dl_+3A_new.data">new.data</code></td>
<td>
<p>the new data</p>
</td></tr>
<tr><td><code id="cdf_dl_+3A_at.y">at.y</code></td>
<td>
<p>a numeric vector of cut-off points P(y &lt;= at.y | new.data)</p>
</td></tr>
<tr><td><code id="cdf_dl_+3A_se">se</code></td>
<td>
<p>if confidence intervals needed (default = TRUE)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components:
</p>
<table>
<tr><td><code>est</code></td>
<td>
<p>a vector of estimated condtional CDFs</p>
</td></tr>
<tr><td><code>se</code></td>
<td>
<p>a vector of estimated standard errors</p>
</td></tr>
<tr><td><code>lb</code></td>
<td>
<p>a vector of estimated lower bounds of 95% confidence intervals</p>
</td></tr>
<tr><td><code>ub</code></td>
<td>
<p>a vector of estimated upper bounds of 95% confidence intervals</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>#' @examples
## Multiple DLs
## generate a small example data: 3 sites with different lower and upper DLs
## lower DLs: site 1: - 0.2; site 2: 0.3; site 3: no lower DL
## upper DLs: site 1: no upper DL; site 2: 4; site 3: 3.5
## each site includes 100 subjects
n &lt;- 100
x &lt;- rnorm(n * 3)
e &lt;- rnorm(n * 3)
y &lt;- exp(x + e)
no_dl &lt;- 1e6
data &lt;- data.frame(y = y, x = x, subset = rep(c(1, 2, 3), each=n))
data$dl_l &lt;- ifelse(data$subset == 1, 0.2, ifelse(data$subset == 2, 0.3, -no_dl))
data$dl_u &lt;- ifelse(data$subset == 1, no_dl, ifelse(data$subset == 2, 4, 3.5))
data$delta_l &lt;- ifelse(data$y &gt;= data$dl_l, 1, 0)
data$delta_u &lt;- ifelse(data$y &lt;= data$dl_u, 1, 0)
data$z &lt;- ifelse(data$delta_l == 0, data$dl_l, ifelse(data$delta_u == 0, data$dl_u, data$y))
# model
mod &lt;- multipleDL(formula = z ~ x, data = data,
                 delta_lower = data$delta_l, delta_upper = data$delta_u, link='probit')
# new data
new.data &lt;- data.frame(x = c(0, 1))
conditional_median &lt;- quantile_dl(mod, new.data, probs = 0.5)
conditional_cdf &lt;- cdf_dl(mod, new.data, at.y = 1.5) # P(y &lt;= 1.5 | new.data)


</code></pre>

<hr>
<h2 id='func_link'>Link functions</h2><span id='topic+func_link'></span>

<h3>Description</h3>

<p>This function includes necessary functions related to each link function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>func_link(link)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="func_link_+3A_link">link</code></td>
<td>
<p>the link function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of functions subject to a link function
</p>

<hr>
<h2 id='func_link_num'>Link functions (number)</h2><span id='topic+func_link_num'></span>

<h3>Description</h3>

<p>This function faciliates the stan code (used as an internal function)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>func_link_num(link)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="func_link_num_+3A_link">link</code></td>
<td>
<p>the link function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An integer representing corresponding link function
</p>

<hr>
<h2 id='func_V'>Calculate the covariance matrix</h2><span id='topic+func_V'></span>

<h3>Description</h3>

<p>This functions calculates the covariance matrix based on the point estimates
</p>


<h3>Usage</h3>

<pre><code class='language-R'>func_V(coef, n, x, y, delta, k, p, fam)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="func_V_+3A_coef">coef</code></td>
<td>
<p>coefficients (alpha, beta)</p>
</td></tr>
<tr><td><code id="func_V_+3A_n">n</code></td>
<td>
<p>number of subjects</p>
</td></tr>
<tr><td><code id="func_V_+3A_x">x</code></td>
<td>
<p>original covariate matrix</p>
</td></tr>
<tr><td><code id="func_V_+3A_y">y</code></td>
<td>
<p>ranks of code values</p>
</td></tr>
<tr><td><code id="func_V_+3A_delta">delta</code></td>
<td>
<p>censoring indicators</p>
</td></tr>
<tr><td><code id="func_V_+3A_k">k</code></td>
<td>
<p>the number of unique code values</p>
</td></tr>
<tr><td><code id="func_V_+3A_p">p</code></td>
<td>
<p>the number of covariates</p>
</td></tr>
<tr><td><code id="func_V_+3A_fam">fam</code></td>
<td>
<p>a list of functions subject to the link function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A covariance matrix of coefficients
</p>

<hr>
<h2 id='multipleDL'>CPMs for multiple detection limits</h2><span id='topic+multipleDL'></span>

<h3>Description</h3>

<p>This function build the CPM for multiple detection limits (DLs).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>multipleDL(formula, data, delta_lower = NULL, delta_upper = NULL, link)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="multipleDL_+3A_formula">formula</code></td>
<td>
<p>an R formula object</p>
</td></tr>
<tr><td><code id="multipleDL_+3A_data">data</code></td>
<td>
<p>a data frame including response data and covariates</p>
</td></tr>
<tr><td><code id="multipleDL_+3A_delta_lower">delta_lower</code></td>
<td>
<p>(optional) indicators of lower DLs censoring (1: observed; 0:censored). If not specified, treat as observed.</p>
</td></tr>
<tr><td><code id="multipleDL_+3A_delta_upper">delta_upper</code></td>
<td>
<p>(optional) indicators of upper DLs censoring(1: observed; 0:censored). If not specified, treat as observed.</p>
</td></tr>
<tr><td><code id="multipleDL_+3A_link">link</code></td>
<td>
<p>the link function (probit, logit, loglog, cloglog)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When there are multiple DLs, we appropriately modify the CPM likelihood.
If a value is below a lower DL, set the censored value as the lower DL and set the
lower DL indicator <code>delta_lower</code> to be 0. Similarly, if a value is above an upper DL,
set the censored value as the upper DL and set the upper DL indicator <code>delta_upper</code> to be 0.
This function also works when there is only a single lower and/or upper DL.
</p>
<p>Conditional quantiles and CDFs and corresponding 95% confidence intervals can be calculated
from the model fit.
</p>


<h3>Value</h3>

<p>A list containing the following components:
</p>
<table>
<tr><td><code>coef</code></td>
<td>
<p>a numeric vector of estimated coeffiencts</p>
</td></tr>
<tr><td><code>var</code></td>
<td>
<p>covariance matrix of estimated coeffiencts</p>
</td></tr>
<tr><td><code>yunique</code></td>
<td>
<p>a numeric vector of unique response values</p>
</td></tr>
<tr><td><code>kint</code></td>
<td>
<p>number of alphas (intercept terms)</p>
</td></tr>
<tr><td><code>p</code></td>
<td>
<p>number of betas (regression coeffiencts)</p>
</td></tr>
<tr><td><code>fam</code></td>
<td>
<p>a list of functions associated with the specified link function</p>
</td></tr>
<tr><td><code>x</code></td>
<td>
<p>the design matrix</p>
</td></tr>
<tr><td><code>log_likelihood</code></td>
<td>
<p>the log-likelihood</p>
</td></tr>
</table>


<h3>References</h3>

<p>Tian, Y., Li, C., Tu, S., James, N. T., Harrell, F. E., &amp; Shepherd, B. E. (2022). Addressing Detection Limits with Semiparametric Cumulative Probability Models. arXiv preprint arXiv:2207.02815.
</p>
<p>Stan Development Team (2020). RSroxygen2::roxygenize()tan: the R interface to Stan. R package version 2.19.3. https://mc-stan.org
</p>
<p>Harrell, F. (2020). rms: Regression modeling strategies. R package version 6.1.0. https://CRAN.R-project.org/package=rms
</p>


<h3>See Also</h3>

<p><code><a href="#topic+cdf_dl">cdf_dl</a>, <a href="#topic+quantile_dl">quantile_dl</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Multiple DLs
## generate a small example data: 3 sites with different lower and upper DLs
## lower DLs: site 1: - 0.2; site 2: 0.3; site 3: no lower DL
## upper DLs: site 1: no upper DL; site 2: 4; site 3: 3.5
## each site includes 100 subjects
n &lt;- 100
x &lt;- rnorm(n * 3)
e &lt;- rnorm(n * 3)
y &lt;- exp(x + e)
no_dl &lt;- 1e6
data &lt;- data.frame(y = y, x = x, subset = rep(c(1, 2, 3), each=n))
data$dl_l &lt;- ifelse(data$subset == 1, 0.2, ifelse(data$subset == 2, 0.3, -no_dl))
data$dl_u &lt;- ifelse(data$subset == 1, no_dl, ifelse(data$subset == 2, 4, 3.5))
data$delta_l &lt;- ifelse(data$y &gt;= data$dl_l, 1, 0)
data$delta_u &lt;- ifelse(data$y &lt;= data$dl_u, 1, 0)
data$z &lt;- ifelse(data$delta_l == 0, data$dl_l, ifelse(data$delta_u == 0, data$dl_u, data$y))
# model
mod &lt;- multipleDL(formula = z ~ x, data = data,
                 delta_lower = data$delta_l, delta_upper = data$delta_u, link='probit')
# new data
new.data &lt;- data.frame(x = c(0, 1))
conditional_median &lt;- quantile_dl(mod, new.data, probs = 0.5)
conditional_cdf &lt;- cdf_dl(mod, new.data, at.y = 1.5) # P(y &lt;= 1.5 | new.data)


## Single DL: lower DL at 0.5
n &lt;- 100
x &lt;- rnorm(n)
e &lt;- rnorm(n)
y &lt;- exp(x + e)
lower_dl &lt;- 0.5
data &lt;- data.frame(y = y, x = x)
data$delta_lower &lt;- ifelse(data$y &gt;= lower_dl, 1, 0)
data$z &lt;- ifelse(data$delta_lower == 0, lower_dl, data$y)
mod &lt;- multipleDL(formula = z ~ x, data = data,
                  delta_lower = data$delta_l, link='probit')
</code></pre>

<hr>
<h2 id='quantile_dl'>Calculate conditional quantiles</h2><span id='topic+quantile_dl'></span>

<h3>Description</h3>

<p>This functions calculates the conditional weighted quantiles based on the fitted model
and new data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>quantile_dl(mod, new.data, probs = 0.5, se = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="quantile_dl_+3A_mod">mod</code></td>
<td>
<p>the model</p>
</td></tr>
<tr><td><code id="quantile_dl_+3A_new.data">new.data</code></td>
<td>
<p>the new data</p>
</td></tr>
<tr><td><code id="quantile_dl_+3A_probs">probs</code></td>
<td>
<p>a numeric vector of pth quantiles</p>
</td></tr>
<tr><td><code id="quantile_dl_+3A_se">se</code></td>
<td>
<p>if confidence intervals needed (default = TRUE)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components:
</p>
<table>
<tr><td><code>est</code></td>
<td>
<p>a vector of estimated condtional quantiles</p>
</td></tr>
<tr><td><code>lb</code></td>
<td>
<p>a vector of estimated lower bounds of 95% confidence intervals</p>
</td></tr>
<tr><td><code>ub</code></td>
<td>
<p>a vector of estimated upper bounds of 95% confidence intervals</p>
</td></tr>
</table>

<hr>
<h2 id='selectedQr'>QR Decomposition Preserving Selected Columns</h2><span id='topic+selectedQr'></span>

<h3>Description</h3>

<p>Runs a matrix through the QR decomposition and returns the transformed matrix and the forward and inverse transforming matrices
<code style="white-space: pre;">&#8288;R, Rinv&#8288;</code>.  If columns of the input matrix <code>X</code> are centered the QR transformed matrix will be orthogonal.
This is helpful in understanding the transformation and in scaling prior distributions on the transformed scale.
<code>not</code> can be specified to keep selected columns as-is.
<code>cornerQr</code> leaves the last column of <code>X</code> alone (possibly after centering).
When <code>not</code> is specified, the square transforming matrices have appropriate identity submatrices inserted
so that recreation of original <code>X</code> is automatic.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>selectedQr(X, not = NULL, corner = FALSE, center = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="selectedQr_+3A_x">X</code></td>
<td>
<p>a numeric matrix</p>
</td></tr>
<tr><td><code id="selectedQr_+3A_not">not</code></td>
<td>
<p>an integer vector specifying which columns of <code>X</code> are to be kept with their original values</p>
</td></tr>
<tr><td><code id="selectedQr_+3A_corner">corner</code></td>
<td>
<p>set to <code>FALSE</code> to not treat the last column specially.  You may not specify both <code>not</code> and <code>corner</code>.</p>
</td></tr>
<tr><td><code id="selectedQr_+3A_center">center</code></td>
<td>
<p>set to <code>FALSE</code> to not center columns of <code>X</code> first</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with elements <code style="white-space: pre;">&#8288;X, R, Rinv, xbar&#8288;</code> where <code>xbar</code> is the vector of means (vector of zeros if <code>center=FALSE</code>)
@export
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
