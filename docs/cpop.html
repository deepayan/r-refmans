<!DOCTYPE html><html lang="en"><head><title>Help for package cpop</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {cpop}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#changepoints'><p>Changepoint locations</p></a></li>
<li><a href='#cost'><p>Calculate the cost of a model fitted by cpop</p></a></li>
<li><a href='#cpop'><p>Find the best segmentation of data for a change-in-slope model</p></a></li>
<li><a href='#cpop.crops'><p>Calculate changepoint locations over a range of penalty values</p></a></li>
<li><a href='#cpop.crops.models'><p>Extract the cpop models created by cpop.crops</p></a></li>
<li><a href='#estimate'><p>Estimate the fit of a cpop model</p></a></li>
<li><a href='#fitted'><p>Extract model fitted values</p></a></li>
<li><a href='#plot'><p>Visualise changepoint locations and associated data</p></a></li>
<li><a href='#residuals'><p>Extract residuals from a cpop model</p></a></li>
<li><a href='#show'><p>Display the S4 object produced by cpop</p></a></li>
<li><a href='#simchangeslope'><p>Generate simulated data</p></a></li>
<li><a href='#summary'><p>Summarise a cpop analysis</p></a></li>
<li><a href='#wavenumber_spectra'><p>Wavenumber power spectra data</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Detection of Multiple Changes in Slope in Univariate Time-Series</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.7</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-05-28</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Daniel Grose &lt;dan.grose@lancaster.ac.uk&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Detects multiple changes in slope using the CPOP dynamic programming approach of Fearnhead, Maidstone, and Letchford (2019) &lt;<a href="https://doi.org/10.1080%2F10618600.2018.1512868">doi:10.1080/10618600.2018.1512868</a>&gt;. This method finds the best continuous piecewise linear fit to data under a criterion that measures fit to data using the residual sum of squares, but penalizes complexity based on an L0 penalty on changes in slope. Further information regarding the use of this package with detailed examples can be found in Fearnhead and Grose (2024) &lt;<a href="https://doi.org/10.18637%2Fjss.v109.i07">doi:10.18637/jss.v109.i07</a>&gt;.  </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0),crops,pacman</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rdpack,Rcpp (&ge; 0.12.13), ggplot2,mathjaxr,pracma,methods</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>RdMacros:</td>
<td>Rdpack,mathjaxr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-05-28 15:19:40 UTC; grosed</td>
</tr>
<tr>
<td>Author:</td>
<td>Daniel Grose [aut, cre],
  Paul Fearnhead [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-05-28 22:30:07 UTC</td>
</tr>
</table>
<hr>
<h2 id='changepoints'>Changepoint locations</h2><span id='topic+changepoints'></span><span id='topic+changepoints+2Ccpop.class-method'></span>

<h3>Description</h3>

<p>Creates a data frame containing the locations of the changepoints in terms of the index of the data and the value of the location at that index.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="changepoints_+3A_object">object</code></td>
<td>
<p>An instance of an cpop S4 class produced by <code><a href="#topic+cpop">cpop</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame.
</p>


<h3>References</h3>

<p>Fearnhead P, Grose D (2024).
&ldquo;cpop: Detecting Changes in Piecewise-Linear Signals.&rdquo;
<em>Journal of Statistical Software</em>, <b>109</b>(7), 1&ndash;30.
<a href="https://doi.org/10.18637/jss.v109.i07">doi:10.18637/jss.v109.i07</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cpop)

# generate some test data
set.seed(0)
x &lt;- seq(0,1,0.01)
n &lt;- length(x)
sd &lt;- rep(0.1,n)
mu &lt;- c(2*x[1:floor(n/2)],2 - 2*x[(floor(n/2)+1):n])
y &lt;- rnorm(n,mu,sd)

# use the locations in x
res &lt;- cpop(y,x,beta=2*log(length(y)),sd=sd)
changepoints(res)

</code></pre>

<hr>
<h2 id='cost'>Calculate the cost of a model fitted by cpop</h2><span id='topic+cost'></span><span id='topic+cost+2Ccpop.class-method'></span>

<h3>Description</h3>

<p>Calculate the penalised cost of a model fitted by cpop using the residual sum of squares and the penalty values.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cost_+3A_object">object</code></td>
<td>
<p>An instance of an S4 class produced by <code><a href="#topic+cpop">cpop</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numerical value of the penalised cost associated with the segmentations determined by using <code><a href="#topic+cpop">cpop</a></code>
</p>


<h3>References</h3>

<p>Fearnhead P, Grose D (2024).
&ldquo;cpop: Detecting Changes in Piecewise-Linear Signals.&rdquo;
<em>Journal of Statistical Software</em>, <b>109</b>(7), 1&ndash;30.
<a href="https://doi.org/10.18637/jss.v109.i07">doi:10.18637/jss.v109.i07</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cpop)

# simulate data with change in gradient
set.seed(1)
x &lt;- (1:50/5)^2
y &lt;- simchangeslope(x,changepoints=c(10,50),change.slope=c(0.25,-0.25),sd=1)

# determine changepoints
res &lt;- cpop(y,x,beta=2*log(length(y)))

# calculate the penalised cost 
cost(res)

</code></pre>

<hr>
<h2 id='cpop'>Find the best segmentation of data for a change-in-slope model</h2><span id='topic+cpop'></span>

<h3>Description</h3>

<p>The CPOP algorithm fits a change-in-slope model to data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cpop(
  y,
  x = 1:length(y) - 1,
  grid = x,
  beta = 2 * log(length(y)),
  sd = sqrt(mean(diff(diff(y))^2)/6),
  minseglen = 0,
  prune.approx = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cpop_+3A_y">y</code></td>
<td>
<p>A vector of length n containing the data.</p>
</td></tr>
<tr><td><code id="cpop_+3A_x">x</code></td>
<td>
<p>A vector of length n containing the locations of y. Default value is NULL, in which case the locations <code>x = 1:length(y)-1</code> are assumed.</p>
</td></tr>
<tr><td><code id="cpop_+3A_grid">grid</code></td>
<td>
<p>An ordered vector of possible locations for the change points. If this is NULL, then this is set to x, the vector of times/locations of the data points.</p>
</td></tr>
<tr><td><code id="cpop_+3A_beta">beta</code></td>
<td>
<p>A positive real value for the penalty incurred for adding a changepoint (prevents over-fitting). Default value is <code>2*log(length(y))</code>.</p>
</td></tr>
<tr><td><code id="cpop_+3A_sd">sd</code></td>
<td>
<p>Estimate of residual standard deviation. Can be a single numerical value or a vector of values for the case of varying standard deviation.
Default value is <code>sd = sqrt(mean(diff(diff(y))^2)/6)</code>.</p>
</td></tr>
<tr><td><code id="cpop_+3A_minseglen">minseglen</code></td>
<td>
<p>The minimum allowable segment length, i.e. distance between successive changepoints. Default is 0.</p>
</td></tr>
<tr><td><code id="cpop_+3A_prune.approx">prune.approx</code></td>
<td>
<p>Only relevant if a minimum segment length is set. If True, cpop will use an approximate pruning algorithm that will speed up computation but may
occasionally lead to a sub-optimal solution in terms of the estimate change point locations. If the minimum segment length is 0, then an exact pruning algorithm is possible and is used.</p>
</td></tr>
</table>


<h3>Details</h3>

<script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script><p> The CPOP algorithm fits a change-in-slope model to data. It assumes that we have we have data points \((y_1,x_1),\ldots,(y_n,x_n)\), ordered
so that \(x_1 < x_2 < \cdots < x_n\). For example  \(x_i\) could be a time-stamp of when response \(y_i\) is obtained. We model the response, \(y\), as a signal
plus noise where the signal is modelled as a continuous piecewise linear function of \(x\). That is \[y_i=f(x_i)+\epsilon_i\] where \(f(x)\) is a continuous
piecewise linear function.
</p>
<p>To estimate the function \(f(x)\) we specify a set of \(N\) grid points, \(g_{1:N}\) with these ordered so that \(g_i < g_j\) if and only if \(i < j\),
and allow the slope of \(f(x)\) to only change at these grid points. We then estimate the number of changes, the location of the changes, and hence the resulting
function \(f(x)\) by minimising a penalised weighted least squares criteria. This criteria includes a term which measures fit to the data, which is calculated as the sum of the
square residuals of the fitted function, scaled by the variance of the noise. The penalty is proportional to the number of changes.
</p>
<p>That is our estimated function will depend on \(K\), the number of changes in slope, their locations, \(\tau_1,\ldots,\tau_K\), and the value of the function
\(f(x)\) at these change points, \(\alpha_1,\ldots,\alpha_K\), and its values, \(\alpha_0\) at  \(\tau_0 < x_1\) and
\(\alpha_{K+1}\) at some \(\tau_{K+1} > x_N\). The CPOP algorithm then estimates \(K\), \(\tau_{1:K}\) and \(\alpha_{0:K+1}\) 
as the values that solve the following minimisation problem
\[\min_{K,\tau_{1:K}\in g_{1:N}, \alpha_{0:K+1} }\left\lbrace\sum_{i=1}^n \frac{1}{\sigma^2_i} \left(y_i -  \alpha_{j(i)}-(\alpha_{j(i)+1}-  \alpha_{j(i)})\frac{x_i-\tau_{j(i)}}{\tau_{j(i)+1}-\tau_{j(i)}}\right)^2+K\beta\right\rbrace\]
</p>
<p>where \(\sigma^2_1,\ldots,\sigma^2_n\) are the variances of the noise \(\epsilon_i\) for \(i=1,\ldots,n\), and \(\beta\) is the
penalty for adding a changepoint. The sum in this expression is the weighted residual sum of squares, and the \(K\beta\) term is the penalty for having \(K\) changes. 
</p>
<p>If we know, or have a good estimate of, the residual variances, and the noise is (close to) independent over time then an appropriate choice for the penalty is
\(\beta=2 \log n\), and this is the default for CPOP. However in many applications these assumptions will not hold and it is advised to look at segmentations for
different value of \(\beta\) &ndash; this is possible
using CPOP with the CROPS algorithm <code><a href="#topic+cpop.crops">cpop.crops</a></code>. Larger values of \(\beta\) will lead to functions with fewer changes. Also there is a trade-off between the variances of the residuals
and \(\beta\): e.g. if we double the variances and half the value of \(\beta\) we will obtain the same estimates for the number and location of the changes and the
underlying function.
</p>


<h3>Value</h3>

<p>An instance of an S4 class of type cpop.class.
</p>


<h3>References</h3>

<p>Fearnhead P, Maidstone R, Letchford A (2019).
&ldquo;Detecting Changes in Slope With an L0 Penalty.&rdquo;
<em>Journal of Computational and Graphical Statistics</em>, <b>28</b>(2), 265-275.
<a href="https://doi.org/10.1080/10618600.2018.1512868">doi:10.1080/10618600.2018.1512868</a>.
</p>
<p>Fearnhead P, Grose D (2024).
&ldquo;cpop: Detecting Changes in Piecewise-Linear Signals.&rdquo;
<em>Journal of Statistical Software</em>, <b>109</b>(7), 1&ndash;30.
<a href="https://doi.org/10.18637/jss.v109.i07">doi:10.18637/jss.v109.i07</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cpop)

# simulate data with change in gradient
set.seed(1)
x &lt;- (1:50/5)^2
y &lt;- simchangeslope(x,changepoints=c(10,50),change.slope=c(0.25,-0.25),sd=1)
# analyse using cpop
res &lt;- cpop(y,x)
p &lt;- plot(res)
print(p)
 
# generate the "true" mean
mu &lt;- simchangeslope(x,changepoints=c(10,50),change.slope=c(0.25,-0.25),sd=0)
# add the true mean to the plot
library(pacman)
p_load(ggplot2)
p &lt;- p + geom_line(aes(y = mu), color = "blue", linetype = "dotted")
print(p)

# heterogeneous data
set.seed(1)
sd &lt;- (1:50)/25
y &lt;- simchangeslope(x,changepoints=c(10,50),change.slope=c(0.25,-0.25),sd=sd)

# analysis assuming constant noise standard deviation
res &lt;- cpop(y,x,beta=2*log(length(y)),sd=sqrt(mean(sd^2)))
p &lt;- plot(res)
print(p)

# analysis with the true noise standard deviation
res.true &lt;- cpop(y,x,beta=2*log(length(y)),sd=sd)
p &lt;- plot(res.true)
print(p)

# add the true mean to the plot
p &lt;- p + geom_line(aes(y = mu), color = "blue", linetype = "dotted")
print(p)

</code></pre>

<hr>
<h2 id='cpop.crops'>Calculate changepoint locations over a range of penalty values</h2><span id='topic+cpop.crops'></span><span id='topic+crops.cpop+2Ccpop.crops.class-method'></span>

<h3>Description</h3>

<p>Runs the Changepoints for a Range of Penalties (CROPS) algorithm of Haynes et al. (2017) to find all of the optimal segmentations for multiple penalty values over a continuous range.
For details of the CROPS method see the <span class="pkg"><a href="crops.html#topic+crops">crops</a></span> package. To obtain details for each segmentation determined by <code><a href="#topic+cpop.crops">cpop.crops</a></code> use the 
<code><a href="crops.html#topic+segmentations">segmentations</a></code> method (see example below).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cpop.crops(
  y,
  x = 1:length(y),
  grid = x,
  beta_min = 1.5 * log(length(y)),
  beta_max = 2.5 * log(length(y)),
  sd = sqrt(mean(diff(diff(y))^2)/6),
  minseglen = 0,
  prune.approx = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cpop.crops_+3A_y">y</code></td>
<td>
<p>A vector of length n containing the data.</p>
</td></tr>
<tr><td><code id="cpop.crops_+3A_x">x</code></td>
<td>
<p>A vector of length n containing the locations of y. Default value is NULL, in which case the locations <code>x = 1:length(y)-1</code> are assumed.</p>
</td></tr>
<tr><td><code id="cpop.crops_+3A_grid">grid</code></td>
<td>
<p>An ordered vector of possible locations for the change points. If this is NULL, then this is set to x, the vector of times/locations of the data points.</p>
</td></tr>
<tr><td><code id="cpop.crops_+3A_beta_min">beta_min</code></td>
<td>
<p>Minimum value of the penalty range to be searched. Default is <code>1.5*log(length(y))</code></p>
</td></tr>
<tr><td><code id="cpop.crops_+3A_beta_max">beta_max</code></td>
<td>
<p>Maximum value of the penalty range to be searched. Default is <code>2.5*log(length(y))</code></p>
</td></tr>
<tr><td><code id="cpop.crops_+3A_sd">sd</code></td>
<td>
<p>Estimate of residual standard deviation. Can be a single numerical value or a vector of values for the case of varying standard deviation.
Default value is <code>sd = sqrt(mean(diff(diff(y))^2)/6)</code>.</p>
</td></tr>
<tr><td><code id="cpop.crops_+3A_minseglen">minseglen</code></td>
<td>
<p>The minimum allowable segment length, i.e. distance between successive changepoints. Default is 0.</p>
</td></tr>
<tr><td><code id="cpop.crops_+3A_prune.approx">prune.approx</code></td>
<td>
<p>Only relevant if a minimum segment length is set. If TRUE, cpop will use an approximate pruning algorithm that will speed up computation but may
occasionally lead to a sub-optimal solution in terms of the estimate change point locations. If the minimum segment length is 0, then an exact pruning algorithm is possible and is used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An instance of an S4 class of type cpop.crops.class which extends the crops.class in <span class="pkg">crops</span>.
</p>


<h3>References</h3>

<p>Haynes K, Eckley IA, Fearnhead P (2017).
&ldquo;Computationally Efficient Changepoint Detection for a Range of Penalties.&rdquo;
<em>Journal of Computational and Graphical Statistics</em>, <b>26</b>(1), 134-143.
<a href="https://doi.org/10.1080/10618600.2015.1116445">doi:10.1080/10618600.2015.1116445</a>.
</p>
<p>Grose D, Fearnhead P (2021).
<em>crops: Changepoints for a Range of Penalties (CROPS)</em>.
R package version 1.0.1, <a href="https://CRAN.R-project.org/package=crops">https://CRAN.R-project.org/package=crops</a>.
</p>
<p>Fearnhead P, Grose D (2024).
&ldquo;cpop: Detecting Changes in Piecewise-Linear Signals.&rdquo;
<em>Journal of Statistical Software</em>, <b>109</b>(7), 1&ndash;30.
<a href="https://doi.org/10.18637/jss.v109.i07">doi:10.18637/jss.v109.i07</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(cpop)

# generate some data
set.seed(0)
x &lt;- seq(0,1,0.01)
n &lt;- length(x)
sd &lt;- rep(0.1,n)
mu &lt;- c(2*x[1:floor(n/2)],2 - 2*x[(floor(n/2)+1):n])
y &lt;- rnorm(n,mu,sd)
# calculate the changepoint locations and cost over a range of penalty values
res &lt;- cpop.crops(y,x,sd=sd,beta_min=0.4*log(length(y)),beta_max=2.5*log(length(y)))
summary(res)

# plot the results
plot(res) 

# show the segmentations
 segmentations(res)


</code></pre>

<hr>
<h2 id='cpop.crops.models'>Extract the cpop models created by cpop.crops</h2><span id='topic+cpop.crops.models'></span><span id='topic+cpop.crops.models+2Ccpop.crops.class-method'></span>

<h3>Description</h3>

<p>Obtains a list of models corresponding to each of the beta (penalty) values considered during a <code>cpop.crops</code> analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cpop.crops.models(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cpop.crops.models_+3A_object">object</code></td>
<td>
<p>An S4 object of type <code>cpop.crops.class</code> produced by <code>cpop.crops</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of S4 <code>cpop.class</code> objects corresponding to the beta values considered by a <code>cpop.crops</code> analysis.
</p>


<h3>References</h3>

<p>Haynes K, Eckley IA, Fearnhead P (2017).
&ldquo;Computationally Efficient Changepoint Detection for a Range of Penalties.&rdquo;
<em>Journal of Computational and Graphical Statistics</em>, <b>26</b>(1), 134-143.
<a href="https://doi.org/10.1080/10618600.2015.1116445">doi:10.1080/10618600.2015.1116445</a>.
</p>
<p>Grose D, Fearnhead P (2021).
<em>crops: Changepoints for a Range of Penalties (CROPS)</em>.
R package version 1.0.1, <a href="https://CRAN.R-project.org/package=crops">https://CRAN.R-project.org/package=crops</a>.
</p>
<p>Fearnhead P, Grose D (2024).
&ldquo;cpop: Detecting Changes in Piecewise-Linear Signals.&rdquo;
<em>Journal of Statistical Software</em>, <b>109</b>(7), 1&ndash;30.
<a href="https://doi.org/10.18637/jss.v109.i07">doi:10.18637/jss.v109.i07</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+cpop.crops">cpop.crops</a></code>,<code><a href="crops.html#topic+crops">crops</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(cpop)

set.seed(1)
n &lt;- 500
x &lt;- 1:n
m &lt;- 10
mu &lt;- simchangeslope(x,changepoints=(n/(m+1))*0:m,change.slope=c(0.1,0.2*(-1)^(1:m)),sd=0)
epsilon &lt;- rnorm(n+2)
y &lt;- mu+(epsilon[1:n]+epsilon[2:(n+1)]+epsilon[3:(n+2)])/sqrt(3)
res.crops &lt;- cpop.crops(y,x,beta_min=0.5*log(length(y)),beta_max=40*log(length(y)))
models &lt;- cpop.crops.models(res.crops)
for(m in models)
{
  plot(m)
}


</code></pre>

<hr>
<h2 id='estimate'>Estimate the fit of a cpop model</h2><span id='topic+estimate'></span><span id='topic+estimate+2Ccpop.class-method'></span>

<h3>Description</h3>

<p>Estimates the fit of a cpop model at the specified locations. If no locations are specified it evaluates the estimates
at the locations specified when calling <code><a href="#topic+cpop">cpop</a></code>.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimate_+3A_object">object</code></td>
<td>
<p>An instance of an S4 class produced by <code><a href="#topic+cpop">cpop</a></code>.</p>
</td></tr>
<tr><td><code id="estimate_+3A_x">x</code></td>
<td>
<p>Locations at which the fit is to be estimated. Default value is the x locations at which the cpop object was defined.</p>
</td></tr>
<tr><td><code id="estimate_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with two columns containing the locations x and the corresponding estimates y_hat.
</p>


<h3>References</h3>

<p>Fearnhead P, Grose D (2024).
&ldquo;cpop: Detecting Changes in Piecewise-Linear Signals.&rdquo;
<em>Journal of Statistical Software</em>, <b>109</b>(7), 1&ndash;30.
<a href="https://doi.org/10.18637/jss.v109.i07">doi:10.18637/jss.v109.i07</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cpop)

# simulate data with change in gradient
set.seed(1)
x &lt;- (1:50/5)^2
y &lt;- simchangeslope(x,changepoints=c(10,50),change.slope=c(0.25,-0.25),sd=1)

# determine changepoints
res &lt;- cpop(y,x,beta=2*log(length(y)))

# estimate fit at points used in call to cpop
estimate(res)

# estimate fit at specified locations
estimate(res,seq(0,100,10))

#extrapolate fit
estimate(res,seq(-20,140,20))

</code></pre>

<hr>
<h2 id='fitted'>Extract model fitted values</h2><span id='topic+fitted'></span><span id='topic+fitted+2Ccpop.class-method'></span>

<h3>Description</h3>

<p>Extracts the fitted values produced by <code><a href="#topic+cpop">cpop</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'cpop.class'
fitted(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fitted_+3A_object">object</code></td>
<td>
<p>An instance of an S4 class produced by <code><a href="#topic+cpop">cpop</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame containing the endpoint coordinates for each line segment fitted between
the detected changepoints. The data frame also contains the gradient and intercept values
for each segment and the corresponding residual sum of squares (RSS).
</p>


<h3>References</h3>

<p>Fearnhead P, Grose D (2024).
&ldquo;cpop: Detecting Changes in Piecewise-Linear Signals.&rdquo;
<em>Journal of Statistical Software</em>, <b>109</b>(7), 1&ndash;30.
<a href="https://doi.org/10.18637/jss.v109.i07">doi:10.18637/jss.v109.i07</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cpop)

# simulate data with change in gradient
set.seed(1)
x &lt;- (1:50/5)^2
y &lt;- simchangeslope(x,changepoints=c(10,50),change.slope=c(0.25,-0.25),sd=1)

# determine changepoints
res &lt;- cpop(y,x,beta=2*log(length(y)))

# calculate segments
fitted(res)

</code></pre>

<hr>
<h2 id='plot'>Visualise changepoint locations and associated data</h2><span id='topic+plot'></span><span id='topic+plot+2Ccpop.class+2CANY-method'></span>

<h3>Description</h3>

<p>Plot methods for S4 objects returned by <code><a href="#topic+cpop">cpop</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'cpop.class,ANY'
plot(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_+3A_x">x</code></td>
<td>
<p>An instance of an cpop S4 class produced by <code><a href="#topic+cpop">cpop</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot object.
</p>


<h3>References</h3>

<p>Fearnhead P, Grose D (2024).
&ldquo;cpop: Detecting Changes in Piecewise-Linear Signals.&rdquo;
<em>Journal of Statistical Software</em>, <b>109</b>(7), 1&ndash;30.
<a href="https://doi.org/10.18637/jss.v109.i07">doi:10.18637/jss.v109.i07</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cpop)

# simulate data with change in gradient
set.seed(1)
x &lt;- (1:50/5)^2
y &lt;- simchangeslope(x,changepoints=c(10,50),change.slope=c(0.25,-0.25),sd=1)

# analyse data
res &lt;- cpop(y,x,beta=2*log(length(y)))

# generate plot object
p &lt;- plot(res)

# visualise
print(p)

</code></pre>

<hr>
<h2 id='residuals'>Extract residuals from a cpop model</h2><span id='topic+residuals'></span><span id='topic+residuals+2Ccpop.class-method'></span>

<h3>Description</h3>

<p>Extracts residuals from a cpop model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'cpop.class'
residuals(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="residuals_+3A_object">object</code></td>
<td>
<p>An instance of an S4 class produced by <code><a href="#topic+cpop">cpop</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A single column matrix containing the residuals.
</p>


<h3>References</h3>

<p>Fearnhead P, Grose D (2024).
&ldquo;cpop: Detecting Changes in Piecewise-Linear Signals.&rdquo;
<em>Journal of Statistical Software</em>, <b>109</b>(7), 1&ndash;30.
<a href="https://doi.org/10.18637/jss.v109.i07">doi:10.18637/jss.v109.i07</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cpop)

# simulate data with change in gradient
set.seed(1)
x &lt;- (1:50/5)^2
y &lt;- simchangeslope(x,changepoints=c(10,50),change.slope=c(0.25,-0.25),sd=1)

# determine changepoints
res &lt;- cpop(y,x,beta=2*log(length(y)))

# calculate the residuals
residuals(res)

</code></pre>

<hr>
<h2 id='show'>Display the S4 object produced by cpop</h2><span id='topic+show'></span><span id='topic+show+2Ccpop.class-method'></span>

<h3>Description</h3>

<p>Displays an S4 object produced by <code><a href="#topic+cpop">cpop</a></code>.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="show_+3A_object">object</code></td>
<td>
<p>An instance of an S4 class produced by <code><a href="#topic+cpop">cpop</a></code>.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Fearnhead P, Grose D (2024).
&ldquo;cpop: Detecting Changes in Piecewise-Linear Signals.&rdquo;
<em>Journal of Statistical Software</em>, <b>109</b>(7), 1&ndash;30.
<a href="https://doi.org/10.18637/jss.v109.i07">doi:10.18637/jss.v109.i07</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cpop)

# simulate data with change in gradient
set.seed(1)
x &lt;- (1:50/5)^2
y &lt;- simchangeslope(x,changepoints=c(10,50),change.slope=c(0.25,-0.25),sd=1)

# determine changepoints
res &lt;- cpop(y,x,beta=2*log(length(y)))

# display a summary of the results using show
show(res)

</code></pre>

<hr>
<h2 id='simchangeslope'>Generate simulated data</h2><span id='topic+simchangeslope'></span>

<h3>Description</h3>

<p>Generates simulated data for use with <code><a href="#topic+cpop">cpop</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simchangeslope(x, changepoints, change.slope, sd = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="simchangeslope_+3A_x">x</code></td>
<td>
<p>A numeric vector containing the locations of the data.</p>
</td></tr>
<tr><td><code id="simchangeslope_+3A_changepoints">changepoints</code></td>
<td>
<p>A numeric vector of changepoint locations.</p>
</td></tr>
<tr><td><code id="simchangeslope_+3A_change.slope">change.slope</code></td>
<td>
<p>A numeric vector indicating the change in slope at each changepoint. The initial slope is assumed to be 0.</p>
</td></tr>
<tr><td><code id="simchangeslope_+3A_sd">sd</code></td>
<td>
<p>The residual standard deviation. Can be a single numerical value or a vector of values for the case of varying residual standard deviation. Default value is 1.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of simulated y values.
</p>


<h3>References</h3>

<p>Fearnhead P, Grose D (2024).
&ldquo;cpop: Detecting Changes in Piecewise-Linear Signals.&rdquo;
<em>Journal of Statistical Software</em>, <b>109</b>(7), 1&ndash;30.
<a href="https://doi.org/10.18637/jss.v109.i07">doi:10.18637/jss.v109.i07</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cpop)
library(pacman)
p_load(ggplot2)

# simulate changepoints with constant sd
set.seed(1)
changepoints &lt;- c(0,25,50,100)
change.slope &lt;- c(0.2,-0.3,0.2,-0.1)
x &lt;- 1:200
sd &lt;- 0.2
y &lt;- simchangeslope(x,changepoints,change.slope,sd)
df &lt;- data.frame("x"=x,"y"=y)
p &lt;- ggplot(data=df,aes(x=x,y=y))
p &lt;- p + geom_point()
p &lt;- p + geom_vline(xintercept=changepoints,
                    color="red",
                    linetype="dashed")
print(p)

# simulate changepoints with varying sd
sd &lt;- 0.2 + x/200
y &lt;- simchangeslope(x,changepoints,change.slope,sd)
df$y &lt;- y
p &lt;- ggplot(data=df,aes(x=x,y=y))
p &lt;- p + geom_point()
p &lt;- p + geom_vline(xintercept=changepoints,
                    color="red",
                    linetype="dashed")
print(p)

</code></pre>

<hr>
<h2 id='summary'>Summarise a cpop analysis</h2><span id='topic+summary'></span><span id='topic+summary+2Ccpop.class-method'></span>

<h3>Description</h3>

<p>Summary method for results produced by <code><a href="#topic+cpop">cpop</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'cpop.class'
summary(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary_+3A_object">object</code></td>
<td>
<p>An instance of an S4 class produced by <code><a href="#topic+cpop">cpop</a></code>.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Fearnhead P, Grose D (2024).
&ldquo;cpop: Detecting Changes in Piecewise-Linear Signals.&rdquo;
<em>Journal of Statistical Software</em>, <b>109</b>(7), 1&ndash;30.
<a href="https://doi.org/10.18637/jss.v109.i07">doi:10.18637/jss.v109.i07</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cpop)

# simulate data with change in gradient
set.seed(1)
x &lt;- (1:50/5)^2
y &lt;- simchangeslope(x,changepoints=c(10,50),change.slope=c(0.25,-0.25),sd=1)

# determine changepoints
res &lt;- cpop(y,x,beta=2*log(length(y)))

# display a summary of the results
summary(res)

</code></pre>

<hr>
<h2 id='wavenumber_spectra'>Wavenumber power spectra data</h2><span id='topic+wavenumber_spectra'></span>

<h3>Description</h3>

<p>Data of power spectra of velocity as a function of wavenumber obtained from climate models of the Atlantic Ocean for two different months and
two climate scenarios: a present-day one (run 2000) and a future scenario (run 2100). See Richards KJ, Whitt DB, Brett G, Bryan FO, Feloy K, Long MC (2021).
&ldquo;The Impact of Climate Change on Ocean Submesoscale Activity.&rdquo;
<em>Journal of Geophysical Research: Oceans</em>, <b>126</b>(5).
<a href="https://doi.org/10.1002/essoar.10503524.1">doi:10.1002/essoar.10503524.1</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(wavenumber_spectra)
</code></pre>


<h3>Format</h3>

<p>A dataframe with 5 columns and 247 rows. The first column is wavenumber (cycles per metre). 
The other columns are the power spectra values for different months (Feb run 2000, Aug run 2000, Feb run 2100, Aug run 2100).
The original data is documented in Richards KJ, Whitt DB, Brett GJ (2020).
&ldquo;Climate change impact on submesoscale ROMS data.&rdquo;
<a href="https://doi.org/10.5281/zenodo.4615129">doi:10.5281/zenodo.4615129</a>.
</p>


<h3>References</h3>

<p>Richards KJ, Whitt DB, Brett G, Bryan FO, Feloy K, Long MC (2021).
&ldquo;The Impact of Climate Change on Ocean Submesoscale Activity.&rdquo;
<em>Journal of Geophysical Research: Oceans</em>, <b>126</b>(5).
<a href="https://doi.org/10.1002/essoar.10503524.1">doi:10.1002/essoar.10503524.1</a>.
</p>
<p>Richards KJ, Whitt DB, Brett GJ (2020).
&ldquo;Climate change impact on submesoscale ROMS data.&rdquo;
<a href="https://doi.org/10.5281/zenodo.4615129">doi:10.5281/zenodo.4615129</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cpop)
library(pacman)
p_load(tidyr,ggplot2,dplyr)

data(wavenumber_spectra)

# take logs of variables
data &lt;-  wavenumber_spectra %&gt;%  mutate_all(log) %&gt;% rename_all( ~ paste0("log_", .x))
head(data)

# reproduce figure 4 in "The Impact of Climate Change on Ocean Submesoscale 
# Activity" - Richards and Whitt (2021)
data %&gt;%
gather(variable,log_power_spectra,-log_wavenumber) %&gt;%
ggplot(aes(x=log_wavenumber, y=log_power_spectra, colour=variable)) +
geom_line() + theme_bw()

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
