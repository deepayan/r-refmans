<!DOCTYPE html><html lang="en"><head><title>Help for package templateICAr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {templateICAr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#activations'><p>Activations of (spatial) template ICA</p></a></li>
<li><a href='#add_str'><p>Combine additive terms in string</p></a></li>
<li><a href='#bdiag_m'><p>Block diagonal matrix</p></a></li>
<li><a href='#bdiag_m2'><p>Bdiag m2</p></a></li>
<li><a href='#check_parallel_packages'><p>Check for required parallel packages</p></a></li>
<li><a href='#check_req_ifti_pkg'><p>Check required packages for the data format</p></a></li>
<li><a href='#Chol_samp_fun'><p>Cholesky-based FC sampling</p></a></li>
<li><a href='#compute_LL_std'><p>Compute LL for EM Template ICA</p></a></li>
<li><a href='#compute_mu_s'><p>Compute posterior mean and precision of s</p></a></li>
<li><a href='#compute_R_inv'><p>Compute SPDE and prior precision matrices for S</p></a></li>
<li><a href='#dim_reduce'><p>PCA-based Dimension Reduction and Prewhitening</p></a></li>
<li><a href='#dual_reg2'><p>Dual Regression wrapper</p></a></li>
<li><a href='#EM_templateICA'><p>EM Algorithms for Template ICA Models</p></a></li>
<li><a href='#estimate_nu'><p>Universally estimate IW dof parameter nu based on method of moments, so</p>
that no empirical variance is under-estimated</a></li>
<li><a href='#estimate_nu_matrix'><p>Estimate IW dof parameter nu based on method of moments</p></a></li>
<li><a href='#estimate_template'><p>Estimate template</p></a></li>
<li><a href='#estimate_template_FC'><p>Estimate FC template</p></a></li>
<li><a href='#estimate_template_from_DR'><p>Estimate template from DR</p></a></li>
<li><a href='#estimate_template_from_DR_two'><p>Estimate template from DR estimates (when there are two measurements)</p></a></li>
<li><a href='#estimate.ESS'><p>Estimation of effective sample size</p></a></li>
<li><a href='#export_template'><p>Export template</p></a></li>
<li><a href='#format_activation_name'><p>Format activation name</p></a></li>
<li><a href='#get_FORMAT'><p>Get FORMAT from format</p></a></li>
<li><a href='#getInvCovAR'><p>Compute inverse covariance matrix for AR process (up to a constant scaling factor)</p></a></li>
<li><a href='#groupICA.cifti'><p>Perform group ICA based on CIFTI data</p></a></li>
<li><a href='#GSR_Param'><p>GSR</p></a></li>
<li><a href='#halflogdetX'><p>Half log determinant</p></a></li>
<li><a href='#hpf_param'><p>hpf</p></a></li>
<li><a href='#INLA_check'><p>Check for INLA</p></a></li>
<li><a href='#IW_var'><p>Compute theoretical Inverse-Wishart variance of covariance matrix elements</p></a></li>
<li><a href='#IW_var_cor'><p>Compute theoretical Inverse-Wishart variance of correlation matrix elements</p></a></li>
<li><a href='#lik'><p>Compute likelihood in SPDE model for ESS estimation</p></a></li>
<li><a href='#LL_SQUAREM'><p>Log-likelihood SQUAREM</p></a></li>
<li><a href='#LL2_kappa'><p>Compute part of kappa log-likelihood</p></a></li>
<li><a href='#loglik_kappa_est'><p>Kappa log-likelihood</p></a></li>
<li><a href='#make_mask'><p>Create a mask based on vertices that are invalid</p></a></li>
<li><a href='#make_mesh'><p>Make INLA mesh from <code>"surf"</code> object</p></a></li>
<li><a href='#make_mesh_2D'><p>Make 2D INLA mesh</p></a></li>
<li><a href='#make_Pmat'><p>Make permutation matrix</p></a></li>
<li><a href='#norm_BOLD'><p>Normalize BOLD data</p></a></li>
<li><a href='#orthonorm'><p>Orthonormalizes a square, invertible matrix</p></a></li>
<li><a href='#plot.template.cifti'><p>Plot template</p></a></li>
<li><a href='#plot.template.gifti'><p>Plot template</p></a></li>
<li><a href='#plot.template.matrix'><p>Plot template</p></a></li>
<li><a href='#plot.template.nifti'><p>Plot template</p></a></li>
<li><a href='#plot.tICA_act.cifti'><p>Plot activations</p></a></li>
<li><a href='#plot.tICA.cifti'><p>Plot template</p></a></li>
<li><a href='#plot.tICA.matrix'><p>Plot template</p></a></li>
<li><a href='#plot.tICA.nifti'><p>Plot template</p></a></li>
<li><a href='#pw_estimate'><p>Estimate residual autocorrelation for prewhitening</p></a></li>
<li><a href='#Q2_max_check'><p>Check <code>Q2_max</code></p></a></li>
<li><a href='#removebs_template'><p>Remove brain structure from CIFTI template</p></a></li>
<li><a href='#resample_template'><p>Resample CIFTI template</p></a></li>
<li><a href='#rm_nuisIC'><p>Remove nuisance ICs from data</p></a></li>
<li><a href='#scale_Param'><p>scale</p></a></li>
<li><a href='#sqrt_XtX'><p>Compute matrix square root of X'X</p></a></li>
<li><a href='#struct_template'><p>Apply data structure to templates</p></a></li>
<li><a href='#summary.template.cifti'><p>Summarize a <code>"template.cifti"</code> object</p></a></li>
<li><a href='#summary.template.gifti'><p>Summarize a <code>"template.gifti"</code> object</p></a></li>
<li><a href='#summary.template.matrix'><p>Summarize a <code>"template.matrix"</code> object</p></a></li>
<li><a href='#summary.template.nifti'><p>Summarize a <code>"template.nifti"</code> object</p></a></li>
<li><a href='#summary.tICA_act.cifti'><p>Summarize a <code>"tICA_act.cifti"</code> object</p></a></li>
<li><a href='#summary.tICA_act.matrix'><p>Summarize a <code>"tICA_act.matrix"</code> object</p></a></li>
<li><a href='#summary.tICA_act.nifti'><p>Summarize a <code>"tICA_act.nifti"</code> object</p></a></li>
<li><a href='#summary.tICA.cifti'><p>Summarize a <code>"tICA.cifti"</code> object</p></a></li>
<li><a href='#summary.tICA.matrix'><p>Summarize a <code>"tICA.matrix"</code> object</p></a></li>
<li><a href='#summary.tICA.nifti'><p>Summarize a <code>"tICA.nifti"</code> object</p></a></li>
<li><a href='#templateICA'><p>Template ICA</p></a></li>
<li><a href='#TR_param'><p>TR</p></a></li>
<li><a href='#update_A'><p>Update A for VB FC Template ICA using IW prior on FC</p></a></li>
<li><a href='#update_A_Chol'><p>Update A for VB FC Template ICA using Cholesky prior for FC</p></a></li>
<li><a href='#update_S'><p>Update S for VB FC Template ICA</p></a></li>
<li><a href='#update_tau2'><p>Update tau for VB FC Template ICA</p></a></li>
<li><a href='#UpdateTheta_templateICA'><p>Parameter Estimates in EM Algorithm for Template ICA Model</p></a></li>
<li><a href='#UpdateThetaSQUAREM_templateICA'><p>Update theta SQUAREM</p></a></li>
<li><a href='#UT2mat'><p>Transform upper-triangular elements to matrix form</p></a></li>
<li><a href='#var_sq_err'><p>Compute the error between empirical and theoretical variance of covariance matrix elements</p></a></li>
<li><a href='#var_sq_err_constrained'><p>Compute the overall error between empirical and theoretical variance of CORRELATION matrix elements</p></a></li>
<li><a href='#varTol_Param'><p>varTol</p></a></li>
<li><a href='#VB_FCtemplateICA'><p>VB_FCtemplateICA</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Estimate Brain Networks and Connectivity with ICA and Empirical
Priors</td>
</tr>
<tr>
<td>Version:</td>
<td>0.9.1</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Amanda Mejia &lt;mandy.mejia@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Implements the template ICA (independent components analysis) model
    proposed in Mejia et al. (2020) &lt;<a href="https://doi.org/10.1080%2F01621459.2019.1679638">doi:10.1080/01621459.2019.1679638</a>&gt; and the 
    spatial template ICA model proposed in proposed in Mejia et al. (2022)
    &lt;<a href="https://doi.org/10.1080%2F10618600.2022.2104289">doi:10.1080/10618600.2022.2104289</a>&gt;. Both models estimate subject-level 
    brain as deviations from known population-level networks, which are 
    estimated using standard ICA algorithms. Both models employ an 
    expectation-maximization algorithm for estimation of the latent brain 
    networks and unknown model parameters. Includes direct support for 'CIFTI',
    'GIFTI', and 'NIFTI' neuroimaging file formats.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Additional_repositories:</td>
<td><a href="https://inla.r-inla-download.org/R/testing">https://inla.r-inla-download.org/R/testing</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Imports:</td>
<td>abind, fMRItools (&ge; 0.4.4), fMRIscrub, foreach, ica, Matrix,
matrixStats, methods, pesel, SQUAREM, stats, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>ciftiTools (&ge; 0.13.2), excursions, RNifti, oro.nifti, gifti,
covr, parallel, doParallel, knitr, rmarkdown, INLA, testthat
(&ge; 3.0.0)</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/mandymejia/templateICAr">https://github.com/mandymejia/templateICAr</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/mandymejia/templateICAr/issues">https://github.com/mandymejia/templateICAr/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-11-21 14:36:31 UTC; ddpham</td>
</tr>
<tr>
<td>Author:</td>
<td>Amanda Mejia [aut, cre],
  Damon Pham <a href="https://orcid.org/0000-0001-7563-4727"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Daniel Spencer <a href="https://orcid.org/0000-0002-9705-3605"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Mary Beth Nebel [ctb]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-11-21 16:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='activations'>Activations of (spatial) template ICA</h2><span id='topic+activations'></span>

<h3>Description</h3>

<p>Identify areas of activation in each independent component map from the
result of (spatial) template ICA.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>activations(
  tICA,
  u = NULL,
  z = NULL,
  alpha = 0.01,
  type = c("&gt;", "abs &gt;", "&lt;", "!="),
  method_p = "BH",
  verbose = FALSE,
  which.ICs = NULL,
  deviation = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="activations_+3A_tica">tICA</code></td>
<td>
<p>Fitted (spatial) template ICA object from <code><a href="#topic+templateICA">templateICA</a></code>.</p>
</td></tr>
<tr><td><code id="activations_+3A_u">u</code>, <code id="activations_+3A_z">z</code></td>
<td>
<p>Set a threshold value for activation? A threshold value can be
specified directly with <code>u</code>, or a z-score-like threshold in terms of
standard deviations (the SD of values in the mean template) can be specified
with <code>z</code>. Only one type of threshold can be used. Default: <code>NULL</code>
(do not use a threshold). Either argument can also be a vector to test
multiple thresholds at once, as long as <code>type</code> is not <code>"!="</code>
(to ensure the activation regions are successive subsets).</p>
</td></tr>
<tr><td><code id="activations_+3A_alpha">alpha</code></td>
<td>
<p>Significance level for hypothesis testing. Default: <code>0.01</code>.</p>
</td></tr>
<tr><td><code id="activations_+3A_type">type</code></td>
<td>
<p>Type of region: <code>"&gt;"</code> (default), <code>"abs &gt;"</code>, <code>"&lt;"</code>,
or <code>"!="</code>. <code>"abs &gt;"</code> tests for magnitude by taking the absolute
value and then testing if they are greater than... .</p>
</td></tr>
<tr><td><code id="activations_+3A_method_p">method_p</code></td>
<td>
<p>If the input is a <code>"tICA.[format]"</code> model object, the type of
multiple comparisons correction to use for p-values, or <code>NULL</code> for no
correction. See <code>help(p.adjust)</code>. Default: <code>"BH"</code> (Benjamini &amp;
Hochberg, i.e. the false discovery rate). Note that multiple comparisons
will account for data locations, but not ICs.</p>
</td></tr>
<tr><td><code id="activations_+3A_verbose">verbose</code></td>
<td>
<p>If <code>TRUE</code>, display progress of algorithm. Default:
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="activations_+3A_which.ics">which.ICs</code></td>
<td>
<p>Indices of ICs for which to identify activations.  If
<code>NULL</code> (default), use all ICs.</p>
</td></tr>
<tr><td><code id="activations_+3A_deviation">deviation</code></td>
<td>
<p>If <code>TRUE</code> identify significant deviations from the
template mean, rather than significant areas of engagement. Default:
<code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing activation maps for each IC, the joint and
marginal PPMs for each IC, and the parameters used for computing activation.
If the input represented CIFTI- or NIFTI-format data, then the activations
maps will be formatted accordingly.
</p>
<p>Use <code>summary</code> to obtain information about the activations results.
For CIFTI-format activations, use <code>plot</code> to visualize the activation
maps.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
 activations(tICA_result, alpha=.05, deviation=TRUE)

## End(Not run)
</code></pre>

<hr>
<h2 id='add_str'>Combine additive terms in string</h2><span id='topic+add_str'></span>

<h3>Description</h3>

<p>Combine two terms with &quot;+&quot; or &quot;-&quot; in a string
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_str(a, b)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_str_+3A_a">a</code>, <code id="add_str_+3A_b">b</code></td>
<td>
<p>The two terms. Each is a length-one character vector.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The result as a length-one character vector.
</p>

<hr>
<h2 id='bdiag_m'>Block diagonal matrix</h2><span id='topic+bdiag_m'></span>

<h3>Description</h3>

<p>Code for function provided in examples of bdiag function from Matrix package
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bdiag_m(lmat)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bdiag_m_+3A_lmat">lmat</code></td>
<td>
<p>List of matrices</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Construct block diagonal matrix of many small blocks
</p>


<h3>Value</h3>

<p>A sparse matrix obtained by combining the arguments into a block diagonal matrix
</p>

<hr>
<h2 id='bdiag_m2'>Bdiag m2</h2><span id='topic+bdiag_m2'></span>

<h3>Description</h3>

<p>Bdiag m2
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bdiag_m2(mat, N)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bdiag_m2_+3A_mat">mat</code></td>
<td>
<p>a k x k 'matrix'</p>
</td></tr>
<tr><td><code id="bdiag_m2_+3A_n">N</code></td>
<td>
<p>how many times to repeat <code>mat</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a sparse (N<em>k x N</em>k) matrix of class <code>"dgCMatrix"</code>.
</p>

<hr>
<h2 id='check_parallel_packages'>Check for required parallel packages</h2><span id='topic+check_parallel_packages'></span>

<h3>Description</h3>

<p>Check that required packages for parallel computation are available. If not,
stop execution with a helpful error message.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_parallel_packages()
</code></pre>


<h3>Value</h3>

<p><code>NULL</code>, invisibly
</p>

<hr>
<h2 id='check_req_ifti_pkg'>Check required packages for the data format</h2><span id='topic+check_req_ifti_pkg'></span>

<h3>Description</h3>

<p>Check required packages for the data format
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_req_ifti_pkg(FORMAT)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_req_ifti_pkg_+3A_format">FORMAT</code></td>
<td>
<p>The data FORMAT</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>NULL</code>, invisibly
</p>

<hr>
<h2 id='Chol_samp_fun'>Cholesky-based FC sampling</h2><span id='topic+Chol_samp_fun'></span>

<h3>Description</h3>

<p>Cholesky-based FC sampling
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Chol_samp_fun(Chol_vals, p, M, chol_diag, chol_offdiag, Chol_mat_blank)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Chol_samp_fun_+3A_chol_vals">Chol_vals</code></td>
<td>
<p>Matrix of Cholesky factorizations (upper triangular values) for all template sessions (nN*nM x nChol)</p>
</td></tr>
<tr><td><code id="Chol_samp_fun_+3A_p">p</code></td>
<td>
<p>Pivot/reordering applied to FC matrices prior to Cholesky factorization</p>
</td></tr>
<tr><td><code id="Chol_samp_fun_+3A_m">M</code></td>
<td>
<p>Number of samples to draw</p>
</td></tr>
<tr><td><code id="Chol_samp_fun_+3A_chol_diag">chol_diag</code></td>
<td>
<p>Indices of diagonal upper triangular elements</p>
</td></tr>
<tr><td><code id="Chol_samp_fun_+3A_chol_offdiag">chol_offdiag</code></td>
<td>
<p>Indices of off-diagonal upper triangular elements</p>
</td></tr>
<tr><td><code id="Chol_samp_fun_+3A_chol_mat_blank">Chol_mat_blank</code></td>
<td>
<p>A nLxnL matrix indexing the upper triangular elements</p>
</td></tr>
</table>

<hr>
<h2 id='compute_LL_std'>Compute LL for EM Template ICA</h2><span id='topic+compute_LL_std'></span>

<h3>Description</h3>

<p>Compute the expected log posterior for EM Standard Template ICA
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute_LL_std(theta, template_mean, template_var, C_diag, BOLD, verbose)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compute_LL_std_+3A_theta">theta</code></td>
<td>
<p>The current parameter estimates</p>
</td></tr>
<tr><td><code id="compute_LL_std_+3A_template_mean">template_mean</code>, <code id="compute_LL_std_+3A_template_var">template_var</code></td>
<td>
<p>The template</p>
</td></tr>
<tr><td><code id="compute_LL_std_+3A_c_diag">C_diag</code></td>
<td>
<p>The C matrix</p>
</td></tr>
<tr><td><code id="compute_LL_std_+3A_bold">BOLD</code></td>
<td>
<p>(<code class="reqn">V \times T</code> matrix) preprocessed fMRI data</p>
</td></tr>
<tr><td><code id="compute_LL_std_+3A_verbose">verbose</code></td>
<td>
<p>Print LL components?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The expected log posterior at the current values
</p>

<hr>
<h2 id='compute_mu_s'>Compute posterior mean and precision of s</h2><span id='topic+compute_mu_s'></span>

<h3>Description</h3>

<p>Compute posterior mean and precision matrix of s
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute_mu_s(y_vec, D, Dinv_s0, R_inv, theta, P, C_diag)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compute_mu_s_+3A_y_vec">y_vec</code></td>
<td>
<p>Vectorized, dimension-reduced fMRI data, grouped by locations. A vector of length <code class="reqn">QV</code>.</p>
</td></tr>
<tr><td><code id="compute_mu_s_+3A_d">D</code></td>
<td>
<p>Sparse diagonal matrix of template standard deviations</p>
</td></tr>
<tr><td><code id="compute_mu_s_+3A_dinv_s0">Dinv_s0</code></td>
<td>
<p>The inverse of D times s0_vec</p>
</td></tr>
<tr><td><code id="compute_mu_s_+3A_r_inv">R_inv</code></td>
<td>
<p>Estimate of inverse spatial correlation matrix (sparse)</p>
</td></tr>
<tr><td><code id="compute_mu_s_+3A_theta">theta</code></td>
<td>
<p>List of current parameter estimates</p>
</td></tr>
<tr><td><code id="compute_mu_s_+3A_p">P</code></td>
<td>
<p>Permutation matrix for regrouping by locations (instead of by ICs.)</p>
</td></tr>
<tr><td><code id="compute_mu_s_+3A_c_diag">C_diag</code></td>
<td>
<p>Diagonals of residual covariance of the first level model. A vector of length <code class="reqn">Q</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the posterior mean <code class="reqn">\mu</code> (mu) and precision
<code class="reqn">\Omega</code> (Omega) of s=(s1,...,sQ), along with the supporting vector m,
where <code class="reqn">\mu = \Omega^{-1}m</code>.
</p>

<hr>
<h2 id='compute_R_inv'>Compute SPDE and prior precision matrices for S</h2><span id='topic+compute_R_inv'></span>

<h3>Description</h3>

<p>Compute SPDE matrices (F, G and GFinvG) and prior precision matrix for S
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute_R_inv(meshes, kappa, C1 = 1/(4 * pi), rm_extra = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compute_R_inv_+3A_meshes">meshes</code></td>
<td>
<p><code>NULL</code> for spatial independence model, otherwise a list of
objects of class &quot;templateICA_mesh&quot; containing the triangular mesh (see
<code><a href="#topic+make_mesh">make_mesh</a></code>) for each brain structure.</p>
</td></tr>
<tr><td><code id="compute_R_inv_+3A_kappa">kappa</code></td>
<td>
<p>Current estimates of SPDE parameter kappa for each latent field</p>
</td></tr>
<tr><td><code id="compute_R_inv_+3A_c1">C1</code></td>
<td>
<p>Constant, equal to <code class="reqn">1/(4*pi)</code> for a 2-dimensional field with alpha=2</p>
</td></tr>
<tr><td><code id="compute_R_inv_+3A_rm_extra">rm_extra</code></td>
<td>
<p>If <code>TRUE</code>. remove extra (non-data) vertices from the mesh for greater computational efficiency</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing R inverse and SPDE matrices
</p>

<hr>
<h2 id='dim_reduce'>PCA-based Dimension Reduction and Prewhitening</h2><span id='topic+dim_reduce'></span>

<h3>Description</h3>

<p>Performs dimension reduction and prewhitening based on probabilistic PCA using
SVD. If dimensionality is not specified, it is estimated using the method
described in Minka (2008).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dim_reduce(X, Q = NULL, Q_max = 100)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dim_reduce_+3A_x">X</code></td>
<td>
<p>A numeric matrix, with each column being a centered timeseries.
For fMRI data, <code>X</code> should be <code>T</code> timepoints by <code>V</code> brain
locations.</p>
</td></tr>
<tr><td><code id="dim_reduce_+3A_q">Q</code></td>
<td>
<p>Number of latent dimensions to estimate. If <code>NULL</code> (default),
estimated using PESEL (Sobczyka et al. 2020).</p>
</td></tr>
<tr><td><code id="dim_reduce_+3A_q_max">Q_max</code></td>
<td>
<p>Maximal number of principal components for automatic
dimensionality selection with PESEL. Default: <code>100</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the dimension-reduced data (<code>data_reduced</code>, a
<code class="reqn">V \times Q</code> matrix), prewhitening/dimension reduction matrix (<code>H</code>,
a <code class="reqn">QxT</code> matrix) and its (pseudo-)inverse (<code>Hinv</code>, a <code class="reqn">TxQ</code>
matrix), the noise variance (<code>sigma_sq</code>), the correlation matrix of the
dimension-reduced data (<code>C_diag</code>, a <code class="reqn">QxQ</code> matrix), and the
dimensionality (<code>Q</code>).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>nT &lt;- 30
nV &lt;- 400
nQ &lt;- 7
X &lt;- matrix(rnorm(nV*nQ), nrow=nV) %*% diag(seq(nQ, 1)) %*% matrix(rnorm(nQ*nT), nrow=nQ) 
dim_reduce(X, Q=nQ)

</code></pre>

<hr>
<h2 id='dual_reg2'>Dual Regression wrapper</h2><span id='topic+dual_reg2'></span>

<h3>Description</h3>

<p>Wrapper to <code>dual_reg</code> used by <code>estimate_template</code>. The format of <code>BOLD</code>
(and <code>BOLD2</code>) must be provided, and <code>GICA</code> must be vectorized if applicable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dual_reg2(
  BOLD,
  BOLD2 = NULL,
  format = c("CIFTI", "xifti", "GIFTI", "gifti", "NIFTI", "nifti", "RDS", "data"),
  GICA,
  GICA_parc_table = NULL,
  mask = NULL,
  keepA = FALSE,
  scale = c("local", "global", "none"),
  scale_sm_surfL = NULL,
  scale_sm_surfR = NULL,
  scale_sm_FWHM = 2,
  TR = NULL,
  hpf = 0.01,
  GSR = FALSE,
  Q2 = 0,
  Q2_max = NULL,
  NA_limit = 0.1,
  brainstructures = "all",
  resamp_res = NULL,
  varTol = 1e-06,
  maskTol = 0.1,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dual_reg2_+3A_bold">BOLD</code>, <code id="dual_reg2_+3A_bold2">BOLD2</code></td>
<td>
<p>Subject-level fMRI data in one of the following formats:
a CIFTI file path, a <code>"xifti"</code> object, a NIFTI file path, a <code>"nifti"</code> object, or
<code class="reqn">V \times T</code> numeric matrices, where <code class="reqn">V</code> is the number of data locations and
<code class="reqn">T</code> is the number of timepoints.
</p>
<p>If <code>BOLD2</code> is provided it must be in the same format as <code>BOLD</code>;
<code>BOLD</code> will be the test data and <code>BOLD2</code> will be the retest data.
</p>
<p>If <code>BOLD2</code> is not provided, <code>BOLD</code> will be split in half;
the first half will be the test data and the second half will be the retest data.</p>
</td></tr>
<tr><td><code id="dual_reg2_+3A_format">format</code></td>
<td>
<p>Expected format of <code>BOLD</code> and <code>BOLD2</code>. Should be one
of the following: a <code>"CIFTI"</code> file path, a <code>"xifti"</code> object, a
<code>"NIFTI"</code> file path, a <code>"nifti"</code> object, or a <code>"data"</code> matrix.</p>
</td></tr>
<tr><td><code id="dual_reg2_+3A_gica">GICA</code></td>
<td>
<p>Group ICA maps as a (vectorized) numeric matrix
(<code class="reqn">V \times Q</code>). Its columns will be centered.</p>
</td></tr>
<tr><td><code id="dual_reg2_+3A_gica_parc_table">GICA_parc_table</code></td>
<td>
<p>Is the GICA actually a parcellation? If so, provide
the parcellation table here. Default: <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="dual_reg2_+3A_mask">mask</code></td>
<td>
<p>Required if and only if the entries of <code>BOLD</code> are NIFTI file paths or
<code>"nifti"</code> objects. This is a brain map formatted as a binary array of the same
size as the fMRI data, with <code>TRUE</code> corresponding to in-mask voxels.</p>
</td></tr>
<tr><td><code id="dual_reg2_+3A_keepa">keepA</code></td>
<td>
<p>Keep the resulting <strong>A</strong> matrices, or only return the <strong>S</strong> matrices
(default)?</p>
</td></tr>
<tr><td><code id="dual_reg2_+3A_scale">scale</code></td>
<td>
<p><code>"local"</code> (default), <code>"global"</code>, or <code>"none"</code>.
Local scaling will divide each data location's time series by its estimated
standard deviation. Global scaling will divide the entire data matrix by the
mean image standard deviation (<code>mean(sqrt(rowVars(BOLD)))</code>).</p>
</td></tr>
<tr><td><code id="dual_reg2_+3A_scale_sm_surfl">scale_sm_surfL</code>, <code id="dual_reg2_+3A_scale_sm_surfr">scale_sm_surfR</code>, <code id="dual_reg2_+3A_scale_sm_fwhm">scale_sm_FWHM</code></td>
<td>
<p>Only applies if
<code>scale=="local"</code> and <code>BOLD</code> represents CIFTI-format data. To
smooth the standard deviation estimates used for local scaling, provide the
surface geometries along which to smooth as GIFTI geometry files or
<code>"surf"</code> objects, as well as the smoothing FWHM (default: <code>2</code>).
</p>
<p>If <code>scale_sm_FWHM==0</code>, no smoothing of the local standard deviation
estimates will be performed.
</p>
<p>If <code>scale_sm_FWHM&gt;0</code> but <code>scale_sm_surfL</code> and
<code>scale_sm_surfR</code> are not provided, the default inflated surfaces from
the HCP will be used.
</p>
<p>To create a <code>"surf"</code> object from data, see
<code><a href="ciftiTools.html#topic+make_surf">make_surf</a></code>. The surfaces must be in the same
resolution as the <code>BOLD</code> data.</p>
</td></tr>
<tr><td><code id="dual_reg2_+3A_tr">TR</code></td>
<td>
<p>The temporal resolution of the data, i.e. the time between volumes,
in seconds. <code>TR</code> is required for detrending with <code>hpf</code>.</p>
</td></tr>
<tr><td><code id="dual_reg2_+3A_hpf">hpf</code></td>
<td>
<p>The frequency at which to apply a highpass filter to the data
during pre-processing, in Hertz. Default: <code>0.01</code> Hertz. Set to <code>0</code>
to disable the highpass filter.
</p>
<p>The highpass filter serves to detrend the data, since low-frequency
variance is associated with noise. Highpass filtering is accomplished by
nuisance regression of discrete cosine transform (DCT) bases.
</p>
<p>Note the <code>TR</code> argument is required for highpass filtering. If
<code>TR</code> is not provided, <code>hpf</code> will be ignored.</p>
</td></tr>
<tr><td><code id="dual_reg2_+3A_gsr">GSR</code></td>
<td>
<p>Center BOLD across columns (each image)? This
is equivalent to performing global signal regression. Default:
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="dual_reg2_+3A_q2">Q2</code>, <code id="dual_reg2_+3A_q2_max">Q2_max</code></td>
<td>
<p>Obtain dual regression estimates after denoising? Denoising is
based on modeling and removing nuisance ICs. It may result in a cleaner
estimate for smaller datasets, but it may be unnecessary (and time-consuming)
for larger datasets.
</p>
<p>Set <code>Q2</code> to control denoising: use a positive integer to specify the
number of nuisance ICs, <code>NULL</code> to have the number of nuisance ICs
estimated by PESEL, or zero (default) to skip denoising.
</p>
<p>If <code>is.null(Q2)</code>, use <code>Q2_max</code> to specify the maximum number of
nuisance ICs that should be estimated by PESEL. <code>Q2_max</code> must be less
than <code class="reqn">T * .75 - Q</code> where <code class="reqn">T</code> is the minimum number of timepoints in
each fMRI scan and <code class="reqn">Q</code> is the number of group ICs. If <code>NULL</code>
(default), <code>Q2_max</code> will be set to <code class="reqn">T * .50 - Q</code>, rounded.</p>
</td></tr>
<tr><td><code id="dual_reg2_+3A_brainstructures">brainstructures</code></td>
<td>
<p>Only applies if the entries of <code>BOLD</code> are CIFTI file paths.
Character vector indicating which brain structure(s)
to obtain: <code>"left"</code> (left cortical surface), <code>"right"</code> (right
cortical surface) and/or <code>"subcortical"</code> (subcortical and cerebellar
gray matter). Can also be <code>"all"</code> (obtain all three brain structures).
Default: <code>c("all")</code>.</p>
</td></tr>
<tr><td><code id="dual_reg2_+3A_resamp_res">resamp_res</code></td>
<td>
<p>Only applies if the entries of <code>BOLD</code> are CIFTI file paths.
Resample the data upon reading it in? Default: <code>NULL</code> (no resampling).</p>
</td></tr>
<tr><td><code id="dual_reg2_+3A_vartol">varTol</code></td>
<td>
<p>Tolerance for variance of each data location. For each scan,
locations which do not meet this threshold are masked out of the analysis.
Default: <code>1e-6</code>. Variance is calculated on the original data, before
any normalization. Set to <code>0</code> to avoid removing locations due to
low variance.</p>
</td></tr>
<tr><td><code id="dual_reg2_+3A_masktol">maskTol</code></td>
<td>
<p>Tolerance for number of locations masked out due to low
variance or missing values. If more than this many locations are masked out,
this subject is skipped without calculating dual regression. <code>maskTol</code>
can be specified either as a proportion of the number of locations (between
zero and one), or as a number of locations (integers greater than one).
Default: <code>.1</code>, i.e. up to 10\
</p>
<p>If <code>BOLD2</code> is provided, masks are calculated for each scan and then
the intersection of the masks is used.</p>
</td></tr>
<tr><td><code id="dual_reg2_+3A_verbose">verbose</code></td>
<td>
<p>Display progress updates? Default: <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The dual regression <strong>S</strong> matrices, or both the <strong>S</strong>
and <strong>A</strong> matrices if <code>keepA</code>, or <code>NULL</code> if dual
regression was skipped due to too many masked data locations.
</p>

<hr>
<h2 id='EM_templateICA'>EM Algorithms for Template ICA Models</h2><span id='topic+EM_templateICA'></span><span id='topic+EM_templateICA.spatial'></span><span id='topic+EM_templateICA.independent'></span>

<h3>Description</h3>

<p>EM Algorithms for Template ICA Models
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EM_templateICA.spatial(
  template_mean,
  template_var,
  meshes,
  BOLD,
  theta0,
  C_diag,
  H,
  Hinv,
  maxiter = 100,
  usePar = FALSE,
  epsilon = 0.001,
  reduce_dim = TRUE,
  verbose = FALSE
)

EM_templateICA.independent(
  template_mean,
  template_var,
  BOLD,
  theta0,
  C_diag,
  H,
  Hinv,
  maxiter = 100,
  epsilon = 0.001,
  reduce_dim = FALSE,
  usePar = FALSE,
  verbose
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="EM_templateICA_+3A_template_mean">template_mean</code></td>
<td>
<p>(<code class="reqn">V \times Q</code> matrix) mean maps for each IC in template,
where <code class="reqn">Q</code> is the number of ICs, <code class="reqn">V=nvox</code> is the number of data locations.</p>
</td></tr>
<tr><td><code id="EM_templateICA_+3A_template_var">template_var</code></td>
<td>
<p>(<code class="reqn">V \times Q</code> matrix) between-subject variance maps
for each IC in template</p>
</td></tr>
<tr><td><code id="EM_templateICA_+3A_meshes">meshes</code></td>
<td>
<p><code>NULL</code> for spatial independence model, otherwise a list of
objects of class &quot;templateICA_mesh&quot; containing the triangular mesh (see
<code><a href="#topic+make_mesh">make_mesh</a></code>) for each brain structure.</p>
</td></tr>
<tr><td><code id="EM_templateICA_+3A_bold">BOLD</code></td>
<td>
<p>(<code class="reqn">V \times Q</code> matrix) dimension-reduced fMRI data</p>
</td></tr>
<tr><td><code id="EM_templateICA_+3A_theta0">theta0</code></td>
<td>
<p>(list) initial guess at parameter values: A (<code class="reqn">QxQ</code> mixing matrix),
nu0_sq (residual variance from first level) and (for spatial model only)
kappa (SPDE smoothness parameter for each IC map)</p>
</td></tr>
<tr><td><code id="EM_templateICA_+3A_c_diag">C_diag</code></td>
<td>
<p>(<code class="reqn">Qx1</code>) diagonal elements of matrix proportional to
residual variance.</p>
</td></tr>
<tr><td><code id="EM_templateICA_+3A_h">H</code>, <code id="EM_templateICA_+3A_hinv">Hinv</code></td>
<td>
<p>For dimension reduction
of the spatial template ICA model, which assumes that all IC's have the
same smoothness parameter, <code class="reqn">\kappa</code></p>
</td></tr>
<tr><td><code id="EM_templateICA_+3A_maxiter">maxiter</code></td>
<td>
<p>Maximum number of EM iterations. Default: 100.</p>
</td></tr>
<tr><td><code id="EM_templateICA_+3A_usepar">usePar</code></td>
<td>
<p>Parallelize the computation? Default: <code>FALSE</code>. Can be the
number of cores to use or <code>TRUE</code>, which will use the number available minus two.
Not yet implemented for spatial template ICA.</p>
</td></tr>
<tr><td><code id="EM_templateICA_+3A_epsilon">epsilon</code></td>
<td>
<p>Smallest proportion change between iterations. Default: 0.001.</p>
</td></tr>
<tr><td><code id="EM_templateICA_+3A_reduce_dim">reduce_dim</code></td>
<td>
<p>Reduce the temporal dimension of the data using PCA?
Default: <code>TRUE</code> for the spatial EM algorithm, and <code>FALSE</code> for the
independent EM algorithm.</p>
</td></tr>
<tr><td><code id="EM_templateICA_+3A_verbose">verbose</code></td>
<td>
<p>If <code>TRUE</code>, display progress of algorithm. Default: <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>EM_templateICA.spatial</code> implements the expectation-maximization
(EM) algorithm described in Mejia et al. (2019+) for estimating the
subject-level ICs and unknown parameters in the template ICA model with
spatial priors on subject effects.
</p>
<p>In both models, if original fMRI timeseries has covariance
<code class="reqn">\sigma^2 I_T</code>, the prewhitened timeseries achieved by premultiplying
by (<code class="reqn">QxT</code>) matrix <code class="reqn">H</code> from PCA has diagonal covariance
<code class="reqn">\sigma^2HH'</code>, so C_diag is <code class="reqn">diag(HH')</code>.
</p>


<h3>Value</h3>

<p>A list: theta (list of final parameter estimates), subICmean
(estimates of subject-level ICs), subICvar (variance of subject-level ICs,
for non-spatial model) or subjICcov (covariance matrix of subject-level ICs,
for spatial model &ndash; note that only diagonal and values for neighbors are
computed), and success (flag indicating convergence (<code>TRUE</code>) or not
(<code>FALSE</code>))
</p>

<hr>
<h2 id='estimate_nu'>Universally estimate IW dof parameter nu based on method of moments, so
that no empirical variance is under-estimated</h2><span id='topic+estimate_nu'></span>

<h3>Description</h3>

<p>Universally estimate IW dof parameter nu based on method of moments, so
that no empirical variance is under-estimated
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_nu(var_FC, mean_FC)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimate_nu_+3A_var_fc">var_FC</code></td>
<td>
<p>Empirical between-subject variance of covariance matrices (QxQ)</p>
</td></tr>
<tr><td><code id="estimate_nu_+3A_mean_fc">mean_FC</code></td>
<td>
<p>Empirical mean of covariance matrices (QxQ)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>estimate for nu
</p>

<hr>
<h2 id='estimate_nu_matrix'>Estimate IW dof parameter nu based on method of moments</h2><span id='topic+estimate_nu_matrix'></span>

<h3>Description</h3>

<p>Estimate IW dof parameter nu based on method of moments
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_nu_matrix(var_FC, mean_FC)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimate_nu_matrix_+3A_var_fc">var_FC</code></td>
<td>
<p>Empirical between-subject variance of covariance matrices (QxQ)</p>
</td></tr>
<tr><td><code id="estimate_nu_matrix_+3A_mean_fc">mean_FC</code></td>
<td>
<p>Empirical mean of covariance matrices (QxQ)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>QxQ matrix of estimates for nu
</p>

<hr>
<h2 id='estimate_template'>Estimate template</h2><span id='topic+estimate_template'></span><span id='topic+estimate_template.cifti'></span><span id='topic+estimate_template.gifti'></span><span id='topic+estimate_template.nifti'></span>

<h3>Description</h3>

<p>Estimate template for Template ICA based on fMRI data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_template(
  BOLD,
  BOLD2 = NULL,
  GICA,
  mask = NULL,
  inds = NULL,
  scale = c("local", "global", "none"),
  scale_sm_surfL = NULL,
  scale_sm_surfR = NULL,
  scale_sm_FWHM = 2,
  TR = NULL,
  hpf = 0.01,
  GSR = FALSE,
  Q2 = 0,
  Q2_max = NULL,
  brainstructures = "all",
  resamp_res = NULL,
  keep_S = FALSE,
  keep_FC = FALSE,
  FC = TRUE,
  FC_nPivots = 100,
  FC_nSamp = 50000,
  varTol = 1e-06,
  maskTol = 0.1,
  missingTol = 0.1,
  usePar = FALSE,
  wb_path = NULL,
  verbose = TRUE
)

estimate_template.cifti(
  BOLD,
  BOLD2 = NULL,
  GICA,
  inds = NULL,
  scale = c("local", "global", "none"),
  scale_sm_surfL = NULL,
  scale_sm_surfR = NULL,
  scale_sm_FWHM = 2,
  TR = NULL,
  hpf = 0.01,
  GSR = FALSE,
  Q2 = 0,
  Q2_max = NULL,
  brainstructures = "all",
  resamp_res = resamp_res,
  keep_S = FALSE,
  keep_FC = FALSE,
  FC = FALSE,
  varTol = 1e-06,
  maskTol = 0.1,
  missingTol = 0.1,
  usePar = FALSE,
  wb_path = NULL,
  verbose = TRUE
)

estimate_template.gifti(
  BOLD,
  BOLD2 = NULL,
  GICA,
  inds = NULL,
  scale = c("local", "global", "none"),
  scale_sm_surfL = NULL,
  scale_sm_surfR = NULL,
  scale_sm_FWHM = 2,
  TR = NULL,
  hpf = 0.01,
  GSR = FALSE,
  Q2 = 0,
  Q2_max = NULL,
  brainstructures = "all",
  keep_S = FALSE,
  keep_FC = FALSE,
  FC = FALSE,
  varTol = 1e-06,
  maskTol = 0.1,
  missingTol = 0.1,
  usePar = FALSE,
  wb_path = NULL,
  verbose = TRUE
)

estimate_template.nifti(
  BOLD,
  BOLD2 = NULL,
  GICA,
  inds = NULL,
  scale = c("local", "global", "none"),
  TR = NULL,
  hpf = 0.01,
  GSR = FALSE,
  Q2 = 0,
  Q2_max = NULL,
  mask = NULL,
  keep_S = FALSE,
  keep_FC = FALSE,
  FC = FALSE,
  varTol = 1e-06,
  maskTol = 0.1,
  missingTol = 0.1,
  usePar = FALSE,
  wb_path = NULL,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimate_template_+3A_bold">BOLD</code>, <code id="estimate_template_+3A_bold2">BOLD2</code></td>
<td>
<p>Vector of subject-level fMRI data in one of the following
formats: CIFTI file paths, <code>"xifti"</code> objects, GIFTI file paths,
<code>"gifti"</code> objects, NIFTI file paths, <code>"nifti"</code> objects,
or <code class="reqn">V \times T</code> numeric matrices, where <code class="reqn">V</code> is the number of data
locations and <code class="reqn">T</code> is the number of timepoints.
</p>
<p>If <code>BOLD2</code> is provided it must be in the same format as <code>BOLD</code>;
<code>BOLD</code> will be the test data and <code>BOLD2</code> will be the retest data.
<code>BOLD2</code> should be the same length as <code>BOLD</code> and have the same
subjects in the same order. If <code>BOLD2</code> is not provided, <code>BOLD</code>
will be split in half; the first half will be the test data and the second
half will be the retest data.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_gica">GICA</code></td>
<td>
<p>Group ICA maps in a format compatible with <code>BOLD</code>. Can also
be a (vectorized) numeric matrix (<code class="reqn">V \times Q</code>) no matter the format of
<code>BOLD</code>. Its columns will be centered.
</p>
<p>New: can also be a parcellation in CIFTI format (other formats to be
implemented in the future). The parcellation should have the same locations
and one column, with integer values indicating the parcel to which each
location belongs to. Each parcel is modeled as a brain map; instead of the
first step of dual regression, the medial timecourse of each parcel is used.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_mask">mask</code></td>
<td>
<p>Required if <code>BOLD</code> are NIFTI file paths or <code>"nifti"</code>
objects, and optional for other formats. For NIFTI data, this is a brain map
formatted as a logical array of the same spatial dimensions as the fMRI
data, with <code>TRUE</code> corresponding to in-mask voxels. For other data, this
is a logical vector with the same length as the number of locations in
<code>GICA</code>, with <code>TRUE</code> corresponding to in-mask locations.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_inds">inds</code></td>
<td>
<p>Numeric indices of the group ICs to include in the template. If
<code>NULL</code>, use all group ICs (default).
</p>
<p>If <code>inds</code> is provided, the ICs not included will be removed after
calculating dual regression, not before. This is because removing the ICs
prior to dual regression would leave unmodelled signals in the data, which
could bias the templates.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_scale">scale</code></td>
<td>
<p><code>"local"</code> (default), <code>"global"</code>, or <code>"none"</code>.
Local scaling will divide each data location's time series by its estimated
standard deviation. Global scaling will divide the entire data matrix by the
mean image standard deviation (<code>mean(sqrt(rowVars(BOLD)))</code>).</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_scale_sm_surfl">scale_sm_surfL</code>, <code id="estimate_template_+3A_scale_sm_surfr">scale_sm_surfR</code>, <code id="estimate_template_+3A_scale_sm_fwhm">scale_sm_FWHM</code></td>
<td>
<p>Only applies if
<code>scale=="local"</code> and <code>BOLD</code> represents surface data (CIFTI or
GIFTI). To smooth the standard deviation estimates used for local scaling,
provide the surface geometries along which to smooth as GIFTI geometry files
or <code>"surf"</code> objects, as well as the smoothing FWHM (default: <code>2</code>).
</p>
<p>If <code>scale_sm_FWHM==0</code>, no smoothing of the local standard deviation
estimates will be performed.
</p>
<p>If <code>scale_sm_FWHM&gt;0</code> but <code>scale_sm_surfL</code> and
<code>scale_sm_surfR</code> are not provided, the default inflated surfaces from
the HCP will be used.
</p>
<p>To create a <code>"surf"</code> object from data, see
<code><a href="ciftiTools.html#topic+make_surf">make_surf</a></code>. The surfaces must be in the same
resolution as the <code>BOLD</code> data.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_tr">TR</code></td>
<td>
<p>The temporal resolution of the data, i.e. the time between volumes,
in seconds. <code>TR</code> is required for detrending with <code>hpf</code>.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_hpf">hpf</code></td>
<td>
<p>The frequency at which to apply a highpass filter to the data
during pre-processing, in Hertz. Default: <code>0.01</code> Hertz. Set to <code>0</code>
to disable the highpass filter.
</p>
<p>The highpass filter serves to detrend the data, since low-frequency
variance is associated with noise. Highpass filtering is accomplished by
nuisance regression of discrete cosine transform (DCT) bases.
</p>
<p>Note the <code>TR</code> argument is required for highpass filtering. If
<code>TR</code> is not provided, <code>hpf</code> will be ignored.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_gsr">GSR</code></td>
<td>
<p>Center BOLD across columns (each image)? This
is equivalent to performing global signal regression. Default:
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_q2">Q2</code>, <code id="estimate_template_+3A_q2_max">Q2_max</code></td>
<td>
<p>Obtain dual regression estimates after denoising? Denoising is
based on modeling and removing nuisance ICs. It may result in a cleaner
estimate for smaller datasets, but it may be unnecessary (and time-consuming)
for larger datasets.
</p>
<p>Set <code>Q2</code> to control denoising: use a positive integer to specify the
number of nuisance ICs, <code>NULL</code> to have the number of nuisance ICs
estimated by PESEL, or zero (default) to skip denoising.
</p>
<p>If <code>is.null(Q2)</code>, use <code>Q2_max</code> to specify the maximum number of
nuisance ICs that should be estimated by PESEL. <code>Q2_max</code> must be less
than <code class="reqn">T * .75 - Q</code> where <code class="reqn">T</code> is the minimum number of timepoints in
each fMRI scan and <code class="reqn">Q</code> is the number of group ICs. If <code>NULL</code>
(default), <code>Q2_max</code> will be set to <code class="reqn">T * .50 - Q</code>, rounded.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_brainstructures">brainstructures</code></td>
<td>
<p>Only applies if the entries of <code>BOLD</code> are CIFTI
file paths. This is a character vector indicating which brain structure(s)
to obtain: <code>"left"</code> (left cortical surface), <code>"right"</code> (right
cortical surface) and/or <code>"subcortical"</code> (subcortical and cerebellar
gray matter). Can also be <code>"all"</code> (obtain all three brain structures).
Default: <code>c("all")</code>.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_resamp_res">resamp_res</code></td>
<td>
<p>Only applies if the entries of <code>BOLD</code> are CIFTI file paths.
Resample the data upon reading it in? Default: <code>NULL</code> (no resampling).</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_keep_s">keep_S</code></td>
<td>
<p>Keep the DR estimates of S? If <code>FALSE</code> (default), do not save
the DR estimates and only return the templates. If <code>TRUE</code>, the DR
estimates of S are returned too. If a single file path, save the DR estimates as
an RDS file at that location rather than returning them.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_keep_fc">keep_FC</code></td>
<td>
<p>Keep the DR estimates of the FC cor(A)? If <code>FALSE</code> (default), do not save
the DR estimates and only return the templates. If <code>TRUE</code>, the DR
estimates of cor(A) and its Cholesky factor are returned too.
If a single file path, save the DR estimates as
an RDS file at that location rather than returning them.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_fc">FC</code></td>
<td>
<p>Include the functional connectivity template? Default: <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_fc_npivots">FC_nPivots</code></td>
<td>
<p>Number of pivots to use in Cholesky-based FC template
estimation.  Set to zero to skip Cholesky-based FC template estimation. Default: 100.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_fc_nsamp">FC_nSamp</code></td>
<td>
<p>Number of FC matrix samples to generate across all pivots. This
should be a multiple of FC_nPivots.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_vartol">varTol</code></td>
<td>
<p>Tolerance for variance of each data location. For each scan,
locations which do not meet this threshold are masked out of the analysis.
Default: <code>1e-6</code>. Variance is calculated on the original data, before
any normalization.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_masktol">maskTol</code></td>
<td>
<p>For computing the dual regression results for each subject:
tolerance for number of locations masked out due to low
variance or missing values. If more than this many locations are masked out,
a subject is skipped without calculating dual regression. <code>maskTol</code>
can be specified either as a proportion of the number of locations (between
zero and one), or as a number of locations (integers greater than one).
Default: <code>.1</code>, i.e. up to 10 percent of locations can be masked out.
</p>
<p>If <code>BOLD2</code> is provided, masks are calculated for both scans and then
the intersection of the masks is used, for each subject.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_missingtol">missingTol</code></td>
<td>
<p>For computing the variance decomposition across all subjects:
tolerance for number of subjects masked out due to low variance or missing
values at a given location. If more than this many subjects are masked out,
the location's value will be <code>NA</code> in the templates. <code>missingTol</code>
can be specified either as a proportion of the number of locations (between
zero and one), or as a number of locations (integers greater than one).
Default: <code>.1</code>, i.e. up to 10 percent of subjects can be masked out
at a given location.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_usepar">usePar</code>, <code id="estimate_template_+3A_wb_path">wb_path</code></td>
<td>
<p>Parallelize the DR computations over subjects? Default:
<code>FALSE</code>. Can be the number of cores to use or <code>TRUE</code>, which will
use the number on the PC minus two. If the input data is in CIFTI format, the
<code>wb_path</code> must also be provided.</p>
</td></tr>
<tr><td><code id="estimate_template_+3A_verbose">verbose</code></td>
<td>
<p>Display progress updates? Default: <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>All fMRI data (entries in <code>BOLD</code> and <code>BOLD2</code>, and <code>GICA</code>) must
be in the same spatial resolution.
</p>


<h3>Value</h3>

<p>A list: the <code>template</code> and <code>var_decomp</code> with entries in
matrix format; the <code>mask</code> of locations without template values due to
too many low variance or missing values; the function <code>params</code> such as
the type of scaling and detrending performed; the <code>dat_struct</code> which can be
used to convert <code>template</code> and <code>var_decomp</code> to <code>"xifti"</code> or
<code>"nifti"</code> objects if the <code>BOLD</code> format was CIFTI or NIFTI data;
and DR results if <code>isTRUE(keep_S)</code> and/or <code>isTRUE(keep_FC)</code>.
</p>
<p>Use <code>summary</code> to print a description of the template results, and
for CIFTI-format data use <code>plot</code> to plot the template mean and variance
estimates. Use <code><a href="#topic+export_template">export_template</a></code> to save the templates to
individual RDS, CIFTI, or NIFTI files (depending on the <code>BOLD</code> format).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>nT &lt;- 21
nV &lt;- 140
nQ &lt;- 6
mU &lt;- matrix(rnorm(nV*nQ), nrow=nV)
mS &lt;- mU %*% diag(seq(nQ, 1)) %*% matrix(rnorm(nQ*nT), nrow=nQ)
BOLD &lt;- list(B1=mS, B2=mS, B3=mS)
BOLD &lt;- lapply(BOLD, function(x){x + rnorm(nV*nT, sd=.05)})
GICA &lt;- mU
estimate_template(BOLD=BOLD, GICA=mU, FC_nSamp=2000)

## Not run: 
 estimate_template(
   run1_cifti_fnames, run2_cifti_fnames,
   gICA_cifti_fname, brainstructures="all",
   scale="global", TR=0.71, Q2=NULL, varTol=10
 )

## End(Not run)
</code></pre>

<hr>
<h2 id='estimate_template_FC'>Estimate FC template</h2><span id='topic+estimate_template_FC'></span>

<h3>Description</h3>

<p>Estimate FC template
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_template_FC(FC0, nu_adjust = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimate_template_FC_+3A_fc0">FC0</code></td>
<td>
<p>The FC estimates from <code><a href="#topic+estimate_template">estimate_template</a></code>.</p>
</td></tr>
<tr><td><code id="estimate_template_FC_+3A_nu_adjust">nu_adjust</code></td>
<td>
<p>Factor by which to adjust estimate of nu.  Values &lt; 1 will
inflate the template variance to avoid an over-informative prior on FC.</p>
</td></tr>
</table>

<hr>
<h2 id='estimate_template_from_DR'>Estimate template from DR</h2><span id='topic+estimate_template_from_DR'></span>

<h3>Description</h3>

<p>Estimate variance decomposition and templates from DR estimates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_template_from_DR(DR, LV = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimate_template_from_DR_+3A_dr">DR</code></td>
<td>
<p>the test/retest dual regression estimates, as an array with
dimensions <code class="reqn">M \times N \times (L \times V)</code>, where <code class="reqn">M</code> is the number
of visits (2), <code class="reqn">N</code> is the number of subjects, <code class="reqn">L</code> is the number of
IC networks, and <code class="reqn">V</code> is the number of data locations.
</p>
<p>(<code class="reqn">L</code> and <code class="reqn">V</code> are collapsed because they are treated equivalently
in the context of calculating the variance decomposition and templates).</p>
</td></tr>
<tr><td><code id="estimate_template_from_DR_+3A_lv">LV</code></td>
<td>
<p>A length-two integer vector giving the dimensions <code class="reqn">L</code> and
<code class="reqn">V</code> to reshape the result. Default: <code>NULL</code> (do not reshape the
result).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of two elements: the templates and the variance decomposition.
</p>
<p>There are two version of the variance template: <code>varUB</code> gives the
unbiased variance estimate, and <code>varNN</code> gives the upwardly-biased
non-negative variance estimate. Values in <code>varUB</code> will need to be
clamped above zero before using in <code>templateICA</code>.
</p>

<hr>
<h2 id='estimate_template_from_DR_two'>Estimate template from DR estimates (when there are two measurements)</h2><span id='topic+estimate_template_from_DR_two'></span>

<h3>Description</h3>

<p>Legacy version of <code><a href="#topic+estimate_template_from_DR">estimate_template_from_DR</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_template_from_DR_two(DR1, DR2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimate_template_from_DR_two_+3A_dr1">DR1</code>, <code id="estimate_template_from_DR_two_+3A_dr2">DR2</code></td>
<td>
<p>the test and retest dual regression estimates (<code class="reqn">N \times L \times V</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of two elements: the mean and variance templates
</p>

<hr>
<h2 id='estimate.ESS'>Estimation of effective sample size</h2><span id='topic+estimate.ESS'></span>

<h3>Description</h3>

<p>Estimation of effective sample size
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate.ESS(mesh, Y, ind = NULL, trace = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimate.ESS_+3A_mesh">mesh</code></td>
<td>
<p>INLA mesh</p>
</td></tr>
<tr><td><code id="estimate.ESS_+3A_y">Y</code></td>
<td>
<p>data</p>
</td></tr>
<tr><td><code id="estimate.ESS_+3A_ind">ind</code></td>
<td>
<p>index of the data locations in the mesh</p>
</td></tr>
<tr><td><code id="estimate.ESS_+3A_trace">trace</code></td>
<td>
<p>If <code>TRUE</code>, a formula based on the trace is used, otherwise the inverse correlation is used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The functions computes the effective sample size as <code class="reqn">trace(Q^{-1})/trace(Q*Q)</code>
as in Bretherton et al. (1999), Journal of Climate.
</p>


<h3>Value</h3>

<p>Estimate of the effective sample size
</p>

<hr>
<h2 id='export_template'>Export template</h2><span id='topic+export_template'></span>

<h3>Description</h3>

<p>Export the templates (mean and variance) as separate files for
visualization or processing outside of <code>templateICAr</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>export_template(
  x,
  out_fname = NULL,
  var_method = c("non-negative", "unbiased")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="export_template_+3A_x">x</code></td>
<td>
<p>The result of <code>estimate_template</code></p>
</td></tr>
<tr><td><code id="export_template_+3A_out_fname">out_fname</code></td>
<td>
<p>Use <code>NULL</code> (default) to just return the template
objects directly. Otherwise, use a character vector of length 3 or 4 of file
path(s) to save the output to:
the mean template, the variance template, the variance decomposition, and
the FC template if present, in that order. If one file name is provided,
it will be appended with
<code>"_mean.[file_ext]"</code> for the template mean map,
<code>"_var.[file_ext]"</code> for the template variance map,
<code>"_varDecomp.rds"</code> for the variance decomposition, and
<code>"_FC.rds"</code> where <code>[file_ext]</code>
will be <code>"dscalar.nii"</code> for CIFTI input, <code>"nii"</code> for NIFTI input,
and <code>"rds"</code> for data input.</p>
</td></tr>
<tr><td><code id="export_template_+3A_var_method">var_method</code></td>
<td>
<p><code>"non-negative"</code> (default) or <code>"unbiased"</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>is.null(out_fname)</code>, the templates in data matrix,
<code>"xifti"</code>, or <code>"nifti"</code> format, to match the format of the
original BOLD data. Otherwise, the paths to the new files specified by
<code>out_fname</code>. If template includes functional connectivity components,
the FC template and its mean and variance will be included.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
 tm &lt;- estimate_template(cii1_fnames, cii2_fnames, gICA_fname)
 export_template(tm, out_fname="my_template", var_method="unbiased")

## End(Not run)

</code></pre>

<hr>
<h2 id='format_activation_name'>Format activation name</h2><span id='topic+format_activation_name'></span>

<h3>Description</h3>

<p>Format the name of an activation, given parameters of the statistical test.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>format_activation_name(u, z, type, deviation, collapse = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="format_activation_name_+3A_u">u</code>, <code id="format_activation_name_+3A_z">z</code>, <code id="format_activation_name_+3A_type">type</code>, <code id="format_activation_name_+3A_deviation">deviation</code></td>
<td>
<p>See <code><a href="#topic+activations">activations</a></code>.</p>
</td></tr>
<tr><td><code id="format_activation_name_+3A_collapse">collapse</code></td>
<td>
<p>If multiple <code>u</code> or <code>z</code> were provided, should just
one name be returned? Default: <code>FALSE</code></p>
</td></tr>
</table>

<hr>
<h2 id='get_FORMAT'>Get FORMAT from format</h2><span id='topic+get_FORMAT'></span>

<h3>Description</h3>

<p>Get FORMAT from format
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_FORMAT(format)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_FORMAT_+3A_format">format</code></td>
<td>
<p>the file format</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The file FORMAT
</p>

<hr>
<h2 id='getInvCovAR'>Compute inverse covariance matrix for AR process (up to a constant scaling factor)</h2><span id='topic+getInvCovAR'></span>

<h3>Description</h3>

<p>Compute inverse covariance matrix for AR process (up to a constant scaling factor)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getInvCovAR(ar, ntime)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="getInvCovAR_+3A_ar">ar</code></td>
<td>
<p>vector of p AR parameters</p>
</td></tr>
<tr><td><code id="getInvCovAR_+3A_ntime">ntime</code></td>
<td>
<p>number of time points in timeseries</p>
</td></tr>
</table>


<h3>Value</h3>

<p>inverse covariance matrix for AR process (up to a constant scaling factor)
</p>

<hr>
<h2 id='groupICA.cifti'>Perform group ICA based on CIFTI data</h2><span id='topic+groupICA.cifti'></span>

<h3>Description</h3>

<p>Perform group ICA based on CIFTI data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>groupICA.cifti(
  cifti_fnames,
  subjects = NULL,
  brainstructures = "all",
  num_PCs = 100,
  num_ICs,
  max_rows_GPCA = 10000,
  GSR = FALSE,
  scale = c("local", "global", "none"),
  scale_sm_FWHM = 2,
  TR = NULL,
  hpf = 0.01,
  verbose = TRUE,
  out_fname = NULL,
  surfL = NULL,
  surfR = NULL,
  smooth = TRUE,
  smooth_surf_FWHM = 5,
  smooth_vol_FWHM = 5,
  smooth_zeroes_as_NA = FALSE,
  smooth_subcortical_merged = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="groupICA.cifti_+3A_cifti_fnames">cifti_fnames</code></td>
<td>
<p>Vector of file paths of CIFTI-format fMRI timeseries
(*.dtseries.nii) for which to calculate group ICA</p>
</td></tr>
<tr><td><code id="groupICA.cifti_+3A_subjects">subjects</code></td>
<td>
<p>Use this argument if some subjects have more than one scan.
This is a numeric or factor vector the same length as <code>cifti_fnames</code>. Scans
for the same subject should have the same value. For example, if there are four
subjects with two visits each, and the scans are ordered with the first subject's
two scans first, then the second subject's two scans next, etc., then this argument
should be <code>rep(seq(4), each=2)</code>. If there are three subjects and four scans,
with the last two scans belonging to the same subject, this argument should be
<code>c(1,2,3,3)</code>. If all subjects only have one scan, keep this argument as
<code>NULL</code> (default).</p>
</td></tr>
<tr><td><code id="groupICA.cifti_+3A_brainstructures">brainstructures</code></td>
<td>
<p>Character vector indicating which brain structure(s)
to obtain: <code>"left"</code> (left cortical surface), <code>"right"</code> (right
cortical surface) and/or <code>"subcortical"</code> (subcortical and cerebellar
gray matter). Can also be <code>"all"</code> (obtain all three brain structures).
Default: <code>c("all")</code>.</p>
</td></tr>
<tr><td><code id="groupICA.cifti_+3A_num_pcs">num_PCs</code></td>
<td>
<p>Maximum number of PCs to retain in initial subject-level PCA</p>
</td></tr>
<tr><td><code id="groupICA.cifti_+3A_num_ics">num_ICs</code></td>
<td>
<p>Number of independent components to identify.</p>
</td></tr>
<tr><td><code id="groupICA.cifti_+3A_max_rows_gpca">max_rows_GPCA</code></td>
<td>
<p>The maximum number of rows for the matrix on which group
level PCA will be performed.  This matrix is the result of temporal concatenation
and contains <code>length(cifti_fnames) * num_PCs</code> rows.</p>
</td></tr>
<tr><td><code id="groupICA.cifti_+3A_gsr">GSR</code>, <code id="groupICA.cifti_+3A_scale">scale</code>, <code id="groupICA.cifti_+3A_scale_sm_fwhm">scale_sm_FWHM</code>, <code id="groupICA.cifti_+3A_tr">TR</code>, <code id="groupICA.cifti_+3A_hpf">hpf</code></td>
<td>
<p>Center BOLD columns, scale by the
standard deviation, and detrend voxel timecourses? See
<code><a href="#topic+norm_BOLD">norm_BOLD</a></code>. Normalization is applied separately to each scan.
Defaults: Center BOLD columns, scale by the global standard deviation, and
apply a .01 Hz HPF if the <code>TR</code> is provided.</p>
</td></tr>
<tr><td><code id="groupICA.cifti_+3A_verbose">verbose</code></td>
<td>
<p>If <code>TRUE</code>, display progress updates</p>
</td></tr>
<tr><td><code id="groupICA.cifti_+3A_out_fname">out_fname</code></td>
<td>
<p>(Optional) If not specified, a xifti object will be returned but
the GICA maps will not be written to a CIFTI file.</p>
</td></tr>
<tr><td><code id="groupICA.cifti_+3A_surfl">surfL</code></td>
<td>
<p>(Optional) File path to a surface GIFTI for the left cortex.
If provided, will be part of xifti result object for visualization in R.
Will also be used to perform any smoothing.</p>
</td></tr>
<tr><td><code id="groupICA.cifti_+3A_surfr">surfR</code></td>
<td>
<p>(Optional) File path to a surface GIFTI for the right cortex.
If provided, will be part of xifti result object for visualization in R.
Will also be used to perform any smoothing.</p>
</td></tr>
<tr><td><code id="groupICA.cifti_+3A_smooth">smooth</code></td>
<td>
<p>Smooth the CIFTI data prior to reading in each file? Default:
<code>TRUE</code>. Use the following arguments to control the smoothing parameters.</p>
</td></tr>
<tr><td><code id="groupICA.cifti_+3A_smooth_surf_fwhm">smooth_surf_FWHM</code>, <code id="groupICA.cifti_+3A_smooth_vol_fwhm">smooth_vol_FWHM</code>, <code id="groupICA.cifti_+3A_smooth_zeroes_as_na">smooth_zeroes_as_NA</code>, <code id="groupICA.cifti_+3A_smooth_subcortical_merged">smooth_subcortical_merged</code></td>
<td>
<p>See <code><a href="ciftiTools.html#topic+smooth_cifti">smooth_cifti</a></code>. The defaults here are the same.
Note that <code>smooth_zeroes_as_NA</code> will control both of the corresponding
surface and volume arguments to <code><a href="ciftiTools.html#topic+smooth_cifti">smooth_cifti</a></code>.
These arguments only apply if <code>smooth</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>out_fname</code> if a file was written, or the GICA as a <code>"xifti"</code> object
if not.
</p>

<hr>
<h2 id='GSR_Param'>GSR</h2><span id='topic+GSR_Param'></span>

<h3>Description</h3>

<p>GSR
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="GSR_Param_+3A_gsr">GSR</code></td>
<td>
<p>Center BOLD across columns (each image)? This
is equivalent to performing global signal regression. Default:
<code>FALSE</code>.</p>
</td></tr>
</table>

<hr>
<h2 id='halflogdetX'>Half log determinant</h2><span id='topic+halflogdetX'></span>

<h3>Description</h3>

<p>Computes half log determinant of <code>X</code>, by <code>sum(log(diag(chol(X))))</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>halflogdetX(X)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="halflogdetX_+3A_x">X</code></td>
<td>
<p>A numeric matrix</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The half log determinant of <code>X</code>.
</p>

<hr>
<h2 id='hpf_param'>hpf</h2><span id='topic+hpf_param'></span>

<h3>Description</h3>

<p>hpf
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hpf_param_+3A_hpf">hpf</code></td>
<td>
<p>The frequency at which to apply a highpass filter to the data
during pre-processing, in Hertz. Default: <code>0.01</code> Hertz. Set to <code>0</code>
to disable the highpass filter.
</p>
<p>The highpass filter serves to detrend the data, since low-frequency
variance is associated with noise. Highpass filtering is accomplished by
nuisance regression of discrete cosine transform (DCT) bases.
</p>
<p>Note the <code>TR</code> argument is required for highpass filtering. If
<code>TR</code> is not provided, <code>hpf</code> will be ignored.</p>
</td></tr>
</table>

<hr>
<h2 id='INLA_check'>Check for INLA</h2><span id='topic+INLA_check'></span>

<h3>Description</h3>

<p>Check for INLA
</p>


<h3>Usage</h3>

<pre><code class='language-R'>INLA_check()
</code></pre>


<h3>Value</h3>

<p><code>NULL</code>, invisibly
</p>

<hr>
<h2 id='IW_var'>Compute theoretical Inverse-Wishart variance of covariance matrix elements</h2><span id='topic+IW_var'></span>

<h3>Description</h3>

<p>Compute theoretical Inverse-Wishart variance of covariance matrix elements
</p>


<h3>Usage</h3>

<pre><code class='language-R'>IW_var(nu, p, xbar_ij, xbar_ii, xbar_jj)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="IW_var_+3A_nu">nu</code></td>
<td>
<p>Inverse Wishart degrees of freedom parameter</p>
</td></tr>
<tr><td><code id="IW_var_+3A_p">p</code></td>
<td>
<p>Matrix dimension for IW distribution</p>
</td></tr>
<tr><td><code id="IW_var_+3A_xbar_ij">xbar_ij</code></td>
<td>
<p>Empirical mean of covariance matrices at element (i,j)</p>
</td></tr>
<tr><td><code id="IW_var_+3A_xbar_ii">xbar_ii</code></td>
<td>
<p>Empirical mean of covariance matrices at the ith diagonal element</p>
</td></tr>
<tr><td><code id="IW_var_+3A_xbar_jj">xbar_jj</code></td>
<td>
<p>Empirical mean of covariance matrices at the jth diagonal element</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Theoretical IW variance for covariance element (i,j)
</p>

<hr>
<h2 id='IW_var_cor'>Compute theoretical Inverse-Wishart variance of correlation matrix elements</h2><span id='topic+IW_var_cor'></span>

<h3>Description</h3>

<p>Compute theoretical Inverse-Wishart variance of correlation matrix elements
</p>


<h3>Usage</h3>

<pre><code class='language-R'>IW_var_cor(nu, p, xbar_ij)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="IW_var_cor_+3A_nu">nu</code></td>
<td>
<p>Inverse Wishart degrees of freedom parameter</p>
</td></tr>
<tr><td><code id="IW_var_cor_+3A_p">p</code></td>
<td>
<p>Matrix dimension for IW distribution</p>
</td></tr>
<tr><td><code id="IW_var_cor_+3A_xbar_ij">xbar_ij</code></td>
<td>
<p>Empirical mean of covariance matrices at element (i,j)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Theoretical IW variance for correlation element (i,j)
</p>

<hr>
<h2 id='lik'>Compute likelihood in SPDE model for ESS estimation</h2><span id='topic+lik'></span>

<h3>Description</h3>

<p>Compute likelihood in SPDE model for ESS estimation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lik(theta, Y, G, C, ind = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lik_+3A_theta">theta</code></td>
<td>
<p>Value of hyperparameters</p>
</td></tr>
<tr><td><code id="lik_+3A_y">Y</code></td>
<td>
<p>Data vector</p>
</td></tr>
<tr><td><code id="lik_+3A_g">G</code></td>
<td>
<p>SPDE G matrix</p>
</td></tr>
<tr><td><code id="lik_+3A_c">C</code></td>
<td>
<p>SPDE C matrix</p>
</td></tr>
<tr><td><code id="lik_+3A_ind">ind</code></td>
<td>
<p>Indices of data locations in the mesh</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Log likelihood value
</p>

<hr>
<h2 id='LL_SQUAREM'>Log-likelihood SQUAREM</h2><span id='topic+LL_SQUAREM'></span>

<h3>Description</h3>

<p>Helper function for SQUAREM for extracting log likelihood
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LL_SQUAREM(theta_vec, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="LL_SQUAREM_+3A_theta_vec">theta_vec</code></td>
<td>
<p>Vector of current parameter values</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Negative log-likelihood given current values of parameters
</p>

<hr>
<h2 id='LL2_kappa'>Compute part of kappa log-likelihood</h2><span id='topic+LL2_kappa'></span>

<h3>Description</h3>

<p>Compute part of log-likelihood involving kappa (or kappa_q) for numerical optimization
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LL2_kappa(
  kappa,
  Amat,
  Fmat,
  Gmat,
  GFinvG,
  OplusW,
  u,
  v,
  C1 = 1/(4 * pi),
  Q = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="LL2_kappa_+3A_kappa">kappa</code></td>
<td>
<p>Value of kappa for which to compute log-likelihood</p>
</td></tr>
<tr><td><code id="LL2_kappa_+3A_amat">Amat</code></td>
<td>
<p>Mesh projection matrix</p>
</td></tr>
<tr><td><code id="LL2_kappa_+3A_fmat">Fmat</code></td>
<td>
<p>Matrix used in computation of SPDE precision</p>
</td></tr>
<tr><td><code id="LL2_kappa_+3A_gmat">Gmat</code></td>
<td>
<p>Matrix used in computation of SPDE precision</p>
</td></tr>
<tr><td><code id="LL2_kappa_+3A_gfinvg">GFinvG</code></td>
<td>
<p>Matrix used in computation of SPDE precision</p>
</td></tr>
<tr><td><code id="LL2_kappa_+3A_oplusw">OplusW</code></td>
<td>
<p>Sparse matrix containing estimated values of RHS of trace in part 2 of log-likelihood. In common smoothness model, represents the sum over q=1,...,Q.</p>
</td></tr>
<tr><td><code id="LL2_kappa_+3A_u">u</code></td>
<td>
<p>Vector needed for part 3 of log-likelihood</p>
</td></tr>
<tr><td><code id="LL2_kappa_+3A_v">v</code></td>
<td>
<p>Vector needed for part 3 of log-likelihood</p>
</td></tr>
<tr><td><code id="LL2_kappa_+3A_c1">C1</code></td>
<td>
<p>For the unit variance case, <code class="reqn">\tau^2 = C1/\kappa^2</code>, where <code class="reqn">C1 = 1/(4\pi)</code> when <code class="reqn">\alpha=2</code>, <code class="reqn">\nu=1</code>, <code class="reqn">d=2</code></p>
</td></tr>
<tr><td><code id="LL2_kappa_+3A_q">Q</code></td>
<td>
<p>Equal to the number of ICs for the common smoothness model, or NULL for the IC-specific smoothness model</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is the function to be maximized in order to determine the MLE for <code class="reqn">\kappa</code> or the <code class="reqn">\kappa_q</code>'s in the M-step of the EM algorithm in spatial
template ICA.  In the model where <code class="reqn">\kappa_q</code> can be different for each IC <code class="reqn">q</code>, the optimization function factorizes over the <code class="reqn">\kappa_q</code>'s.  This function computes
the value of the part of the optimization function pertaining to one of the <code class="reqn">\kappa_q</code>'s.
</p>


<h3>Value</h3>

<p>Value of log-likelihood at logkappa
</p>

<hr>
<h2 id='loglik_kappa_est'>Kappa log-likelihood</h2><span id='topic+loglik_kappa_est'></span>

<h3>Description</h3>

<p>Applicable to a single latent field, or multiple latent fields if common smoothness is assumed
</p>


<h3>Usage</h3>

<pre><code class='language-R'>loglik_kappa_est(par, delta, D_diag, mesh, C1 = 1/(4 * pi), Q = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="loglik_kappa_est_+3A_par">par</code></td>
<td>
<p>Vector of length two containing values of log kappa and log residual variance at which to compute log likelihood</p>
</td></tr>
<tr><td><code id="loglik_kappa_est_+3A_delta">delta</code></td>
<td>
<p>Estimate of delta (subject effect or deviation)</p>
</td></tr>
<tr><td><code id="loglik_kappa_est_+3A_d_diag">D_diag</code></td>
<td>
<p>Diagonal values of D matrix (template standard deviations)</p>
</td></tr>
<tr><td><code id="loglik_kappa_est_+3A_mesh">mesh</code></td>
<td>
<p>Object of class &quot;templateICA_mesh&quot; containing the triangular mesh (see <code><a href="#topic+make_mesh">make_mesh</a></code>)</p>
</td></tr>
<tr><td><code id="loglik_kappa_est_+3A_c1">C1</code></td>
<td>
<p>For the unit variance case, <code class="reqn">\tau^2 = C1/\kappa^2</code>, where <code class="reqn">C1 = 1/(4\pi)</code> when <code class="reqn">\alpha=2</code>, <code class="reqn">\nu=1</code>, <code class="reqn">d=2</code></p>
</td></tr>
<tr><td><code id="loglik_kappa_est_+3A_q">Q</code></td>
<td>
<p>Equal to the number of ICs for the common smoothness model, or NULL for the IC-specific smoothness model</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Compute log-likelihood of kappa given an initial estimate of delta
</p>


<h3>Value</h3>

<p>Value of negative log likelihood
</p>

<hr>
<h2 id='make_mask'>Create a mask based on vertices that are invalid</h2><span id='topic+make_mask'></span>

<h3>Description</h3>

<p>Create a mask based on vertices that are invalid
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_mask(BOLD, meanTol = -Inf, varTol = 1e-06, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="make_mask_+3A_bold">BOLD</code></td>
<td>
<p>A <code class="reqn">V \times T</code> numeric matrix. Each row is a location.</p>
</td></tr>
<tr><td><code id="make_mask_+3A_meantol">meanTol</code>, <code id="make_mask_+3A_vartol">varTol</code></td>
<td>
<p>Tolerance for mean and variance of each data location.
Locations which do not meet these thresholds are masked out of the analysis.
Defaults: <code>-Inf</code> for <code>meanTol</code> (ignore), and <code>1e-6</code> for
<code>varTol</code>.</p>
</td></tr>
<tr><td><code id="make_mask_+3A_verbose">verbose</code></td>
<td>
<p>Print messages counting how many locations are removed?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A logical vector indicating valid vertices
</p>

<hr>
<h2 id='make_mesh'>Make INLA mesh from <code>"surf"</code> object</h2><span id='topic+make_mesh'></span>

<h3>Description</h3>

<p>Create INLA mesh and observation weight matrix based on a <code>"surf"</code> object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_mesh(surf = NULL, inds_data = NULL, inds_mesh = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="make_mesh_+3A_surf">surf</code></td>
<td>
<p>Object of class <code>"surf"</code>. See
<code><a href="ciftiTools.html#topic+make_surf">make_surf</a></code> and <code><a href="ciftiTools.html#topic+is.surf">is.surf</a></code>.</p>
</td></tr>
<tr><td><code id="make_mesh_+3A_inds_data">inds_data</code></td>
<td>
<p>Subset of vertices to include in analysis, e.g. non-medial
wall locations.</p>
</td></tr>
<tr><td><code id="make_mesh_+3A_inds_mesh">inds_mesh</code></td>
<td>
<p>Subset of vertices to retain in mesh, e.g. non-medial wall
locations. Must be a superset of <code>inds_data</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List containing INLA mesh, observation weight matrix <strong>A</strong> for
translating between mesh locations and original data locations, the brain
mask used to create the mesh, and the number of original and mesh data
locations.
</p>

<hr>
<h2 id='make_mesh_2D'>Make 2D INLA mesh</h2><span id='topic+make_mesh_2D'></span>

<h3>Description</h3>

<p>Create INLA mesh and observation weight matrix based on a binary brain mask
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_mesh_2D(mask)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="make_mesh_2D_+3A_mask">mask</code></td>
<td>
<p>Brain mask (matrix of 0 and 1 or <code>TRUE</code> and <code>FALSE</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function requires the <code>INLA</code> package, which is not a CRAN
package. See <a href="https://www.r-inla.org/download-install">https://www.r-inla.org/download-install</a> for easy
installation instructions.
</p>


<h3>Value</h3>

<p>List containing INLA mesh, observation weight matrix <strong>A</strong> for
translating between mesh locations and original data locations, the brain
mask used to create the mesh, and the number of original and mesh data
locations.
</p>

<hr>
<h2 id='make_Pmat'>Make permutation matrix</h2><span id='topic+make_Pmat'></span>

<h3>Description</h3>

<p>Create permutation matrix P to regroup elements of s by locations instead of by ICs
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_Pmat(Q, nvox)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="make_Pmat_+3A_q">Q</code></td>
<td>
<p>The number of template ICs</p>
</td></tr>
<tr><td><code id="make_Pmat_+3A_nvox">nvox</code></td>
<td>
<p>The number of spatial locations (<code class="reqn">V</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If s=(s1,...,sQ) is grouped by ICs 1,...Q, then Ps=(s(1),...,s(nvox)) is grouped by locations 1,...,nvox
</p>


<h3>Value</h3>

<p>P Permutation matrix size <code class="reqn">QVxQV</code>
</p>

<hr>
<h2 id='norm_BOLD'>Normalize BOLD data</h2><span id='topic+norm_BOLD'></span>

<h3>Description</h3>

<p>Center the data across space and/or time, detrend, and scale, in that order.
For dual regression, row centering is required and column centering is not
recommended. Scaling and detrending depend on the user preference.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>norm_BOLD(
  BOLD,
  center_rows = TRUE,
  center_cols = FALSE,
  scale = c("local", "global", "none"),
  scale_sm_xifti = NULL,
  scale_sm_FWHM = 2,
  scale_sm_xifti_mask = NULL,
  TR = NULL,
  hpf = 0.01
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="norm_BOLD_+3A_bold">BOLD</code></td>
<td>
<p>fMRI numeric data matrix (<code class="reqn">V \times T</code>)</p>
</td></tr>
<tr><td><code id="norm_BOLD_+3A_center_rows">center_rows</code>, <code id="norm_BOLD_+3A_center_cols">center_cols</code></td>
<td>
<p>Center BOLD data across rows (each data
location's time series) or columns (each time point's image)? Default:
<code>TRUE</code> for row centering, and <code>FALSE</code> for column centering.</p>
</td></tr>
<tr><td><code id="norm_BOLD_+3A_scale">scale</code></td>
<td>
<p><code>"local"</code> (default), <code>"global"</code>, or <code>"none"</code>.
Local scaling will divide each data location's time series by its estimated
standard deviation. Global scaling will divide the entire data matrix by the
mean image standard deviation (<code>mean(sqrt(rowVars(BOLD)))</code>).</p>
</td></tr>
<tr><td><code id="norm_BOLD_+3A_scale_sm_xifti">scale_sm_xifti</code>, <code id="norm_BOLD_+3A_scale_sm_fwhm">scale_sm_FWHM</code></td>
<td>
<p>Only applies if <code>scale=="local"</code> and
<code>BOLD</code> represents CIFTI-format data. To smooth the standard deviation
estimates used for local scaling, provide a <code>"xifti"</code> object with data
locations in alignment with <code>BOLD</code>, as well as the smoothing FWHM
(default: <code>2</code>). If no <code>"xifti"</code> object is provided (default), do
not smooth.</p>
</td></tr>
<tr><td><code id="norm_BOLD_+3A_scale_sm_xifti_mask">scale_sm_xifti_mask</code></td>
<td>
<p>For local scaling with smoothing, the data must
be unmasked to be mapped back to the surface. So if the data are masked,
provide the mask here.</p>
</td></tr>
<tr><td><code id="norm_BOLD_+3A_tr">TR</code></td>
<td>
<p>The temporal resolution of the data, i.e. the time between volumes,
in seconds. <code>TR</code> is required for detrending with <code>hpf</code>.</p>
</td></tr>
<tr><td><code id="norm_BOLD_+3A_hpf">hpf</code></td>
<td>
<p>The frequency at which to apply a highpass filter to the data
during pre-processing, in Hertz. Default: <code>0.01</code> Hertz. Set to <code>0</code>
to disable the highpass filter.
</p>
<p>The highpass filter serves to detrend the data, since low-frequency
variance is associated with noise. Highpass filtering is accomplished by
nuisance regression of discrete cosine transform (DCT) bases.
</p>
<p>Note the <code>TR</code> argument is required for highpass filtering. If
<code>TR</code> is not provided, <code>hpf</code> will be ignored.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Normalized BOLD data matrix (<code class="reqn">V \times T</code>)
</p>

<hr>
<h2 id='orthonorm'>Orthonormalizes a square, invertible matrix</h2><span id='topic+orthonorm'></span>

<h3>Description</h3>

<p>Orthonormalizes a square, invertible matrix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>orthonorm(X)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="orthonorm_+3A_x">X</code></td>
<td>
<p>A square matrix to be orthonormalized.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Y is orthonormal if $YY'=Y'Y=I$. Orthonormalization of X is given by $X (X'X)^(-.5)$.
</p>


<h3>Value</h3>

<p>X after orthonormalization
</p>

<hr>
<h2 id='plot.template.cifti'>Plot template</h2><span id='topic+plot.template.cifti'></span>

<h3>Description</h3>

<p>Plot template
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'template.cifti'
plot(
  x,
  stat = c("both", "mean", "sd", "var"),
  var_method = c("non-negative", "unbiased"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.template.cifti_+3A_x">x</code></td>
<td>
<p>The template from <code>estimate_template.cifti</code></p>
</td></tr>
<tr><td><code id="plot.template.cifti_+3A_stat">stat</code></td>
<td>
<p><code>"mean"</code>, <code>"sd"</code>, or <code>"both"</code> (default). By
default the square root of the variance template is shown; another option is
<code>stat="var"</code> to instead display the variance template directly.</p>
</td></tr>
<tr><td><code id="plot.template.cifti_+3A_var_method">var_method</code></td>
<td>
<p><code>"non-negative"</code> (default) or <code>"unbiased"</code></p>
</td></tr>
<tr><td><code id="plot.template.cifti_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code>view_xifti</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>The plot
</p>

<hr>
<h2 id='plot.template.gifti'>Plot template</h2><span id='topic+plot.template.gifti'></span>

<h3>Description</h3>

<p>Plot template
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'template.gifti'
plot(
  x,
  stat = c("both", "mean", "sd", "var"),
  var_method = c("non-negative", "unbiased"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.template.gifti_+3A_x">x</code></td>
<td>
<p>The template from <code>estimate_template.gifti</code></p>
</td></tr>
<tr><td><code id="plot.template.gifti_+3A_stat">stat</code></td>
<td>
<p><code>"mean"</code>, <code>"sd"</code>, or <code>"both"</code> (default). By
default the square root of the variance template is shown; another option is
<code>stat="var"</code> to instead display the variance template directly.</p>
</td></tr>
<tr><td><code id="plot.template.gifti_+3A_var_method">var_method</code></td>
<td>
<p><code>"non-negative"</code> (default) or <code>"unbiased"</code></p>
</td></tr>
<tr><td><code id="plot.template.gifti_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code>view_xifti</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>The plot
</p>

<hr>
<h2 id='plot.template.matrix'>Plot template</h2><span id='topic+plot.template.matrix'></span>

<h3>Description</h3>

<p>Plot template
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'template.matrix'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.template.matrix_+3A_x">x</code></td>
<td>
<p>The template from <code>estimate_template.matrix</code></p>
</td></tr>
<tr><td><code id="plot.template.matrix_+3A_...">...</code></td>
<td>
<p>Additional arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The plot
</p>

<hr>
<h2 id='plot.template.nifti'>Plot template</h2><span id='topic+plot.template.nifti'></span>

<h3>Description</h3>

<p>Based on <code>oro.nifti::image</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'template.nifti'
plot(
  x,
  stat = c("mean", "sd", "var"),
  plane = c("axial", "sagittal", "coronal"),
  n_slices = 9,
  slices = NULL,
  var_method = c("non-negative", "unbiased"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.template.nifti_+3A_x">x</code></td>
<td>
<p>The template from <code>estimate_template.nifti</code></p>
</td></tr>
<tr><td><code id="plot.template.nifti_+3A_stat">stat</code></td>
<td>
<p><code>"mean"</code> (default), <code>"sd"</code>, or <code>"var"</code>.
(<code>"sd"</code> will show the square root of the variance template.)</p>
</td></tr>
<tr><td><code id="plot.template.nifti_+3A_plane">plane</code>, <code id="plot.template.nifti_+3A_n_slices">n_slices</code>, <code id="plot.template.nifti_+3A_slices">slices</code></td>
<td>
<p>Anatomical plane and which slice indices to
show.
Default: 9 axial slices.</p>
</td></tr>
<tr><td><code id="plot.template.nifti_+3A_var_method">var_method</code></td>
<td>
<p><code>"non-negative"</code> (default) or <code>"unbiased"</code></p>
</td></tr>
<tr><td><code id="plot.template.nifti_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code>oro.nifti::image</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Consider using <code>struct_template</code> to obtain the 3D volumes to plot with a different
viewer function (e.g. from <code>oro.nifti</code>) if desired.
</p>


<h3>Value</h3>

<p>The plot
</p>

<hr>
<h2 id='plot.tICA_act.cifti'>Plot activations</h2><span id='topic+plot.tICA_act.cifti'></span>

<h3>Description</h3>

<p>Plot activations
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'tICA_act.cifti'
plot(x, stat = c("active", "pvals", "pvals_adj", "tstats", "se"), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.tICA_act.cifti_+3A_x">x</code></td>
<td>
<p>The activations from <code>activations.cifti</code></p>
</td></tr>
<tr><td><code id="plot.tICA_act.cifti_+3A_stat">stat</code></td>
<td>
<p><code>"active"</code> (default), <code>"pvals"</code>, <code>"pvals_adj"</code>,
<code>"tstats"</code>, or <code>"vars"</code>.</p>
</td></tr>
<tr><td><code id="plot.tICA_act.cifti_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code>view_xifti</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>The activations plot
</p>

<hr>
<h2 id='plot.tICA.cifti'>Plot template</h2><span id='topic+plot.tICA.cifti'></span>

<h3>Description</h3>

<p>Plot template
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'tICA.cifti'
plot(x, stat = c("mean", "se", "both"), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.tICA.cifti_+3A_x">x</code></td>
<td>
<p>The result of <code>templateICA</code> with CIFTI data</p>
</td></tr>
<tr><td><code id="plot.tICA.cifti_+3A_stat">stat</code></td>
<td>
<p><code>"mean"</code> (default), <code>"se"</code>, or <code>"both"</code></p>
</td></tr>
<tr><td><code id="plot.tICA.cifti_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code>view_xifti</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>The plot
</p>

<hr>
<h2 id='plot.tICA.matrix'>Plot template</h2><span id='topic+plot.tICA.matrix'></span>

<h3>Description</h3>

<p>This feature is not supported yet.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'tICA.matrix'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.tICA.matrix_+3A_x">x</code></td>
<td>
<p>The result of <code>templateICA</code> with NIFTI data</p>
</td></tr>
<tr><td><code id="plot.tICA.matrix_+3A_...">...</code></td>
<td>
<p>Additional arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing, because an error is raised.
</p>

<hr>
<h2 id='plot.tICA.nifti'>Plot template</h2><span id='topic+plot.tICA.nifti'></span>

<h3>Description</h3>

<p>Plot template
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'tICA.nifti'
plot(
  x,
  stat = c("mean", "se"),
  plane = c("axial", "sagittal", "coronal"),
  n_slices = 9,
  slices = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.tICA.nifti_+3A_x">x</code></td>
<td>
<p>The result of <code>templateICA</code> with NIFTI data</p>
</td></tr>
<tr><td><code id="plot.tICA.nifti_+3A_stat">stat</code></td>
<td>
<p><code>"mean"</code> (default), <code>"se"</code></p>
</td></tr>
<tr><td><code id="plot.tICA.nifti_+3A_plane">plane</code>, <code id="plot.tICA.nifti_+3A_n_slices">n_slices</code>, <code id="plot.tICA.nifti_+3A_slices">slices</code></td>
<td>
<p>Anatomical plane and which slice indices to show.
Default: 9 axial slices.</p>
</td></tr>
<tr><td><code id="plot.tICA.nifti_+3A_...">...</code></td>
<td>
<p>Additional arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The plot
</p>

<hr>
<h2 id='pw_estimate'>Estimate residual autocorrelation for prewhitening</h2><span id='topic+pw_estimate'></span>

<h3>Description</h3>

<p>Estimate residual autocorrelation for prewhitening
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pw_estimate(A, ar_order, aic = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pw_estimate_+3A_a">A</code></td>
<td>
<p>Estimated A matrix (T x Q)</p>
</td></tr>
<tr><td><code id="pw_estimate_+3A_ar_order">ar_order</code>, <code id="pw_estimate_+3A_aic">aic</code></td>
<td>
<p>Order of the AR model used to prewhiten the data at each location.
If <code>!aic</code> (default), the order will be exactly <code>ar_order</code>. If <code>aic</code>,
the order will be between zero and <code>ar_order</code>, as determined by the AIC.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Estimated AR coefficients and residual variance at every vertex
</p>

<hr>
<h2 id='Q2_max_check'>Check <code>Q2_max</code></h2><span id='topic+Q2_max_check'></span>

<h3>Description</h3>

<p>Check <code>Q2_max</code> and set it if <code>NULL</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Q2_max_check(Q2_max, nQ, nT)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Q2_max_check_+3A_q2_max">Q2_max</code>, <code id="Q2_max_check_+3A_nq">nQ</code>, <code id="Q2_max_check_+3A_nt">nT</code></td>
<td>
<p>The args</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>Q2_max</code>, clamped to acceptable range of values.
</p>

<hr>
<h2 id='removebs_template'>Remove brain structure from CIFTI template</h2><span id='topic+removebs_template'></span>

<h3>Description</h3>

<p>Remove a brain structure from a CIFTI template
</p>


<h3>Usage</h3>

<pre><code class='language-R'>removebs_template(x, remove = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="removebs_template_+3A_x">x</code></td>
<td>
<p>The <code>"template.cifti"</code> object.</p>
</td></tr>
<tr><td><code id="removebs_template_+3A_remove">remove</code></td>
<td>
<p><code>"cortex_left"</code>, <code>"cortex_right"</code>, and/or <code>"subcortical"</code>.</p>
</td></tr>
</table>

<hr>
<h2 id='resample_template'>Resample CIFTI template</h2><span id='topic+resample_template'></span>

<h3>Description</h3>

<p>Resample a CIFTI template to a new spatial resolution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>resample_template(x, resamp_res, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="resample_template_+3A_x">x</code></td>
<td>
<p>The <code>"template.cifti"</code> object.</p>
</td></tr>
<tr><td><code id="resample_template_+3A_resamp_res">resamp_res</code></td>
<td>
<p>The new resampling resolution.</p>
</td></tr>
<tr><td><code id="resample_template_+3A_verbose">verbose</code></td>
<td>
<p>Give occasional updates? Default: <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The resampled <code>"template.cifti"</code> object.
</p>

<hr>
<h2 id='rm_nuisIC'>Remove nuisance ICs from data</h2><span id='topic+rm_nuisIC'></span>

<h3>Description</h3>

<p>Subtract estimated nuisance ICs from data matrix. If the number of
nuisance ICs is not provided, will estimate using PESEL (the nuisance ICs
are a rotation of the nuisance PCs).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rm_nuisIC(
  BOLD,
  DR = NULL,
  template_mean = NULL,
  Q2 = NULL,
  Q2_max = NULL,
  checkRowCenter = TRUE,
  verbose = FALSE,
  return_Q2 = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rm_nuisIC_+3A_bold">BOLD</code></td>
<td>
<p>the row-centered <code class="reqn">V</code> by <code class="reqn">T</code> data</p>
</td></tr>
<tr><td><code id="rm_nuisIC_+3A_dr">DR</code>, <code id="rm_nuisIC_+3A_template_mean">template_mean</code></td>
<td>
<p>We need an initial estimate of the group ICs, so
that we can avoid removing them during removal of the estimated noise ICs.
Provide either <code>DR</code> if dual regression has already been calculated, or
<code>template_mean</code> (in this context, equivalent to a GICA result) if it
hasn't. Exactly one must be provided.</p>
</td></tr>
<tr><td><code id="rm_nuisIC_+3A_q2">Q2</code></td>
<td>
<p>The number of nuisance ICs. If <code>NULL</code> (default) will estimate
using PESEL.</p>
</td></tr>
<tr><td><code id="rm_nuisIC_+3A_q2_max">Q2_max</code></td>
<td>
<p>If <code>Q2</code> is <code>NULL</code>, PESEL's estimate will be less than
or equal to <code>Q2_max</code>. If <code>Q2_max</code> is <code>NULL</code> (default), do not
limit PESEL's estimate.</p>
</td></tr>
<tr><td><code id="rm_nuisIC_+3A_checkrowcenter">checkRowCenter</code></td>
<td>
<p>Check row means, and raise an error if they are
nonzero? Default: <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="rm_nuisIC_+3A_verbose">verbose</code></td>
<td>
<p>If <code>TRUE</code>, display progress updates.</p>
</td></tr>
<tr><td><code id="rm_nuisIC_+3A_return_q2">return_Q2</code></td>
<td>
<p>Return (estimated) <code>Q2</code> too? Default: <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The <code class="reqn">V</code> by <code class="reqn">T</code> data with the estimated nuisance ICs
subtracted from it. If <code>return_Q2</code>, a list of length two: the second
entry will be <code>Q2</code>.
</p>

<hr>
<h2 id='scale_Param'>scale</h2><span id='topic+scale_Param'></span>

<h3>Description</h3>

<p>scale
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="scale_Param_+3A_scale">scale</code></td>
<td>
<p><code>"local"</code> (default), <code>"global"</code>, or <code>"none"</code>.
Local scaling will divide each data location's time series by its estimated
standard deviation. Global scaling will divide the entire data matrix by the
mean image standard deviation (<code>mean(sqrt(rowVars(BOLD)))</code>).</p>
</td></tr>
</table>

<hr>
<h2 id='sqrt_XtX'>Compute matrix square root of X'X</h2><span id='topic+sqrt_XtX'></span>

<h3>Description</h3>

<p>Compute matrix square root of X'X
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sqrt_XtX(X, inverse = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sqrt_XtX_+3A_x">X</code></td>
<td>
<p>A numerical matrix</p>
</td></tr>
<tr><td><code id="sqrt_XtX_+3A_inverse">inverse</code></td>
<td>
<p>if inverse=TRUE, compute inverse of square root</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix equalling the (inverse) matrix square root of X'X
</p>

<hr>
<h2 id='struct_template'>Apply data structure to templates</h2><span id='topic+struct_template'></span>

<h3>Description</h3>

<p>Apply data structure to templates
</p>


<h3>Usage</h3>

<pre><code class='language-R'>struct_template(
  template,
  FORMAT,
  mask_input,
  params,
  dat_struct,
  GICA_parc_table
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="struct_template_+3A_template">template</code></td>
<td>
<p>The template</p>
</td></tr>
<tr><td><code id="struct_template_+3A_format">FORMAT</code></td>
<td>
<p>&quot;CIFTI&quot;, &quot;GIFTI&quot;, &quot;NIFTI&quot;, or &quot;DATA&quot;</p>
</td></tr>
<tr><td><code id="struct_template_+3A_mask_input">mask_input</code></td>
<td>
<p>The input mask</p>
</td></tr>
<tr><td><code id="struct_template_+3A_params">params</code></td>
<td>
<p>The params</p>
</td></tr>
<tr><td><code id="struct_template_+3A_dat_struct">dat_struct</code></td>
<td>
<p>The data structure</p>
</td></tr>
</table>

<hr>
<h2 id='summary.template.cifti'>Summarize a <code>"template.cifti"</code> object</h2><span id='topic+summary.template.cifti'></span><span id='topic+print.summary.template.cifti'></span><span id='topic+print.template.cifti'></span>

<h3>Description</h3>

<p>Summary method for class <code>"template.cifti"</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'template.cifti'
summary(object, ...)

## S3 method for class 'summary.template.cifti'
print(x, ...)

## S3 method for class 'template.cifti'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.template.cifti_+3A_object">object</code></td>
<td>
<p>Object of class <code>"template.cifti"</code>.</p>
</td></tr>
<tr><td><code id="summary.template.cifti_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="summary.template.cifti_+3A_x">x</code></td>
<td>
<p>The template from <code>estimate_template.cifti</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list summarizing the template: data dimensions, options used for
template estimation, etc.
</p>
<p>Nothing, invisibly.
</p>
<p>Nothing, invisibly.
</p>

<hr>
<h2 id='summary.template.gifti'>Summarize a <code>"template.gifti"</code> object</h2><span id='topic+summary.template.gifti'></span><span id='topic+print.summary.template.gifti'></span><span id='topic+print.template.gifti'></span>

<h3>Description</h3>

<p>Summary method for class <code>"template.gifti"</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'template.gifti'
summary(object, ...)

## S3 method for class 'summary.template.gifti'
print(x, ...)

## S3 method for class 'template.gifti'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.template.gifti_+3A_object">object</code></td>
<td>
<p>Object of class <code>"template.gifti"</code>.</p>
</td></tr>
<tr><td><code id="summary.template.gifti_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="summary.template.gifti_+3A_x">x</code></td>
<td>
<p>The template from <code>estimate_template.gifti</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list summarizing the template: data dimensions, options used for
template estimation, etc.
</p>
<p>Nothing, invisibly.
</p>
<p>Nothing, invisibly.
</p>

<hr>
<h2 id='summary.template.matrix'>Summarize a <code>"template.matrix"</code> object</h2><span id='topic+summary.template.matrix'></span><span id='topic+print.summary.template.matrix'></span><span id='topic+print.template.matrix'></span>

<h3>Description</h3>

<p>Summary method for class <code>"template.matrix"</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'template.matrix'
summary(object, ...)

## S3 method for class 'summary.template.matrix'
print(x, ...)

## S3 method for class 'template.matrix'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.template.matrix_+3A_object">object</code></td>
<td>
<p>Object of class <code>"template.matrix"</code>.</p>
</td></tr>
<tr><td><code id="summary.template.matrix_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="summary.template.matrix_+3A_x">x</code></td>
<td>
<p>The template from <code>estimate_template.cifti</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list summarizing the template: data dimensions, options used for
template estimation, etc.
</p>
<p>Nothing, invisibly.
</p>
<p>Nothing, invisibly.
</p>

<hr>
<h2 id='summary.template.nifti'>Summarize a <code>"template.nifti"</code> object</h2><span id='topic+summary.template.nifti'></span><span id='topic+print.summary.template.nifti'></span><span id='topic+print.template.nifti'></span>

<h3>Description</h3>

<p>Summary method for class <code>"template.nifti"</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'template.nifti'
summary(object, ...)

## S3 method for class 'summary.template.nifti'
print(x, ...)

## S3 method for class 'template.nifti'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.template.nifti_+3A_object">object</code></td>
<td>
<p>Object of class <code>"template.nifti"</code>.</p>
</td></tr>
<tr><td><code id="summary.template.nifti_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="summary.template.nifti_+3A_x">x</code></td>
<td>
<p>The template from <code>estimate_template.nifti</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list summarizing the template: data dimensions, options used for
template estimation, etc.
</p>
<p>Nothing, invisibly.
</p>
<p>Nothing, invisibly.
</p>

<hr>
<h2 id='summary.tICA_act.cifti'>Summarize a <code>"tICA_act.cifti"</code> object</h2><span id='topic+summary.tICA_act.cifti'></span><span id='topic+print.summary.tICA_act.cifti'></span><span id='topic+print.tICA_act.cifti'></span>

<h3>Description</h3>

<p>Summary method for class <code>"tICA_act.cifti"</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'tICA_act.cifti'
summary(object, ...)

## S3 method for class 'summary.tICA_act.cifti'
print(x, ...)

## S3 method for class 'tICA_act.cifti'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.tICA_act.cifti_+3A_object">object</code></td>
<td>
<p>Object of class <code>"tICA_act.cifti"</code>.</p>
</td></tr>
<tr><td><code id="summary.tICA_act.cifti_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="summary.tICA_act.cifti_+3A_x">x</code></td>
<td>
<p>The activations from <code>activations.cifti</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list summarizing the data and results for the activations analysis.
</p>
<p>Nothing, invisibly.
</p>
<p>Nothing, invisibly.
</p>

<hr>
<h2 id='summary.tICA_act.matrix'>Summarize a <code>"tICA_act.matrix"</code> object</h2><span id='topic+summary.tICA_act.matrix'></span><span id='topic+print.summary.tICA_act.matrix'></span><span id='topic+print.tICA_act.matrix'></span>

<h3>Description</h3>

<p>Summary method for class <code>"tICA_act.matrix"</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'tICA_act.matrix'
summary(object, ...)

## S3 method for class 'summary.tICA_act.matrix'
print(x, ...)

## S3 method for class 'tICA_act.matrix'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.tICA_act.matrix_+3A_object">object</code></td>
<td>
<p>Object of class <code>"tICA_act.matrix"</code>.</p>
</td></tr>
<tr><td><code id="summary.tICA_act.matrix_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="summary.tICA_act.matrix_+3A_x">x</code></td>
<td>
<p>The activations from <code>activations</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list summarizing the data and results for the activations analysis.
</p>
<p>Nothing, invisibly.
</p>
<p>Nothing, invisibly.
</p>

<hr>
<h2 id='summary.tICA_act.nifti'>Summarize a <code>"tICA_act.nifti"</code> object</h2><span id='topic+summary.tICA_act.nifti'></span><span id='topic+print.summary.tICA_act.nifti'></span><span id='topic+print.tICA_act.nifti'></span>

<h3>Description</h3>

<p>Summary method for class <code>"tICA_act.nifti"</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'tICA_act.nifti'
summary(object, ...)

## S3 method for class 'summary.tICA_act.nifti'
print(x, ...)

## S3 method for class 'tICA_act.nifti'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.tICA_act.nifti_+3A_object">object</code></td>
<td>
<p>Object of class <code>"tICA_act.nifti"</code>.</p>
</td></tr>
<tr><td><code id="summary.tICA_act.nifti_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="summary.tICA_act.nifti_+3A_x">x</code></td>
<td>
<p>The activations from <code>activations</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list summarizing the data and results for the activations analysis.
</p>
<p>Nothing, invisibly.
</p>
<p>Nothing, invisibly.
</p>

<hr>
<h2 id='summary.tICA.cifti'>Summarize a <code>"tICA.cifti"</code> object</h2><span id='topic+summary.tICA.cifti'></span><span id='topic+print.summary.tICA.cifti'></span><span id='topic+print.tICA.cifti'></span>

<h3>Description</h3>

<p>Summary method for class <code>"tICA.cifti"</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'tICA.cifti'
summary(object, ...)

## S3 method for class 'summary.tICA.cifti'
print(x, ...)

## S3 method for class 'tICA.cifti'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.tICA.cifti_+3A_object">object</code></td>
<td>
<p>Object of class <code>"tICA.cifti"</code>.</p>
</td></tr>
<tr><td><code id="summary.tICA.cifti_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="summary.tICA.cifti_+3A_x">x</code></td>
<td>
<p>The result of <code>templateICA</code> with CIFTI data</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list summarizing of the results of the templateICA analysis.
</p>
<p>Nothing, invisibly.
</p>
<p>Nothing, invisibly.
</p>

<hr>
<h2 id='summary.tICA.matrix'>Summarize a <code>"tICA.matrix"</code> object</h2><span id='topic+summary.tICA.matrix'></span><span id='topic+print.summary.tICA.matrix'></span><span id='topic+print.tICA.matrix'></span>

<h3>Description</h3>

<p>Summary method for class <code>"tICA.matrix"</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'tICA.matrix'
summary(object, ...)

## S3 method for class 'summary.tICA.matrix'
print(x, ...)

## S3 method for class 'tICA.matrix'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.tICA.matrix_+3A_object">object</code></td>
<td>
<p>Object of class <code>"tICA.matrix"</code>.</p>
</td></tr>
<tr><td><code id="summary.tICA.matrix_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="summary.tICA.matrix_+3A_x">x</code></td>
<td>
<p>The template from <code>estimate_template.cifti</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list summarizing of the results of the templateICA analysis.
</p>
<p>Nothing, invisibly.
</p>
<p>Nothing, invisibly.
</p>

<hr>
<h2 id='summary.tICA.nifti'>Summarize a <code>"tICA.nifti"</code> object</h2><span id='topic+summary.tICA.nifti'></span><span id='topic+print.summary.tICA.nifti'></span><span id='topic+print.tICA.nifti'></span>

<h3>Description</h3>

<p>Summary method for class <code>"tICA.nifti"</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'tICA.nifti'
summary(object, ...)

## S3 method for class 'summary.tICA.nifti'
print(x, ...)

## S3 method for class 'tICA.nifti'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.tICA.nifti_+3A_object">object</code></td>
<td>
<p>Object of class <code>"tICA.nifti"</code>.</p>
</td></tr>
<tr><td><code id="summary.tICA.nifti_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="summary.tICA.nifti_+3A_x">x</code></td>
<td>
<p>The template from <code>estimate_template.cifti</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list summarizing of the results of the templateICA analysis.
</p>
<p>Nothing, invisibly.
</p>
<p>Nothing, invisibly.
</p>

<hr>
<h2 id='templateICA'>Template ICA</h2><span id='topic+templateICA'></span>

<h3>Description</h3>

<p>Perform template independent component analysis (ICA) using variational Bayes
(VB) or expectation-maximization (EM).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>templateICA(
  BOLD,
  template,
  tvar_method = c("non-negative", "unbiased"),
  scale = c("template", "global", "local", "none"),
  scale_sm_surfL = NULL,
  scale_sm_surfR = NULL,
  scale_sm_FWHM = "template",
  nuisance = NULL,
  scrub = NULL,
  TR = NULL,
  hpf = "template",
  GSR = "template",
  Q2 = "template",
  Q2_max = "template",
  brainstructures = "template",
  mask = NULL,
  time_inds = NULL,
  varTol = "template",
  spatial_model = NULL,
  resamp_res = NULL,
  rm_mwall = TRUE,
  reduce_dim = FALSE,
  method_FC = c("VB1", "VB2", "none"),
  maxiter = 100,
  miniter = 3,
  epsilon = 0.001,
  kappa_init = 0.2,
  usePar = TRUE,
  PW = FALSE,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="templateICA_+3A_bold">BOLD</code></td>
<td>
<p>Vector of subject-level fMRI data in one of the following
formats: CIFTI file paths, <code>"xifti"</code> objects, NIFTI file paths,
<code>"nifti"</code> objects, or <code class="reqn">V \times T</code> numeric matrices, where <code class="reqn">V</code>
is the number of data locations and <code class="reqn">T</code> is the number of timepoints.
</p>
<p>If multiple BOLD data are provided, they will be independently centered,
scaled, detrended (if applicable), and denoised (if applicable). Then they
will be concatenated together followed by computing the initial dual
regression estimate.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_template">template</code></td>
<td>
<p>Template estimates in a format compatible with <code>BOLD</code>,
from <code><a href="#topic+estimate_template">estimate_template</a></code>.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_tvar_method">tvar_method</code></td>
<td>
<p>Which calculation of the template variance to use:
<code>"non-negative"</code> (default) or <code>"unbiased"</code>. The unbiased template
variance is based on the assumed mixed effects/ANOVA model, whereas the
non-negative template variance adds to it to account for greater potential
between-subjects variation. (The template mean is the same for either choice
of <code>tvar_method</code>.)</p>
</td></tr>
<tr><td><code id="templateICA_+3A_scale">scale</code></td>
<td>
<p><code>"global"</code>, <code>"local"</code>, or <code>"none"</code>.
Global scaling will divide the entire data matrix by the mean image standard
deviation (<code>mean(sqrt(rowVars(BOLD)))</code>). Local scaling will divide each
data location's time series by its estimated standard deviation. Default:
<code>"template"</code>, to use the same option used for estimation of the
<code>template</code>.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_scale_sm_surfl">scale_sm_surfL</code>, <code id="templateICA_+3A_scale_sm_surfr">scale_sm_surfR</code>, <code id="templateICA_+3A_scale_sm_fwhm">scale_sm_FWHM</code></td>
<td>
<p>Only applies if
<code>scale=="local"</code> and <code>BOLD</code> represents CIFTI-format data. To
smooth the standard deviation estimates used for local scaling, provide the
surface geometries along which to smooth as GIFTI geometry files or
<code>"surf"</code> objects, as well as the smoothing FWHM (default:
<code>"template"</code> to use the same option used for estimation of the
<code>template</code>).
</p>
<p>If <code>scale_sm_FWHM==0</code>, no smoothing of the local standard deviation
estimates will be performed.
</p>
<p>If <code>scale_sm_FWHM&gt;0</code> but <code>scale_sm_surfL</code> and
<code>scale_sm_surfR</code> are not provided, the default inflated surfaces from
the HCP will be used.
</p>
<p>To create a <code>"surf"</code> object from data, see
<code><a href="ciftiTools.html#topic+make_surf">make_surf</a></code>. The surfaces must be in the same
resolution as the <code>BOLD</code> data.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_nuisance">nuisance</code></td>
<td>
<p>(Optional) Signals to regress from the data, given as a
numeric matrix with the same number of rows as there are volumes in the
<code>BOLD</code> data. If multiple <code>BOLD</code> sessions are provided,
this argument can be a list to use different nuisance regressors for
different sessions. Nuisance regression is performed as a first step, before
centering, scaling, and denoising. An intercept column will automatically be
added to <code>nuisance</code>. If <code>NULL</code>, no extra nuisance signals will be
regressed from the data, but a nuisance regression will still be used if
warranted by <code>scrub</code> or <code>hpf</code>.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_scrub">scrub</code></td>
<td>
<p>(Optional) A numeric vector of integers indicating the indices
of volumes to scrub from the BOLD data. (List the volumes to remove, not the
ones to keep.) If multiple <code>BOLD</code> sessions are provided, this
argument can be a list to remove different volumes for different sessions.
Scrubbing is performed within nuisance regression by adding a spike
regressor to the nuisance design matrix for each volume to scrub. If
<code>NULL</code>, do not scrub.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_tr">TR</code>, <code id="templateICA_+3A_hpf">hpf</code></td>
<td>
<p>These arguments control detrending. <code>TR</code> is the temporal
resolution of the data, i.e. the time between volumes, in seconds;
<code>hpf</code> is the frequency of the high-pass filter, in Hertz. Detrending
is performed via nuisance regression of DCT bases. Default:
<code>"template"</code> to use the values from the template. Be sure to set the
correct <code>TR</code> if it's different for the new data compared to the data
used in <code>estimate_template</code>.
</p>
<p>Note that if multiple <code>BOLD</code> sessions are provided, their
<code>TR</code> and <code>hpf</code> must be the same; both arguments accept only one
value.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_gsr">GSR</code></td>
<td>
<p>Center BOLD across columns (each image)? This
is equivalent to performing global signal regression. Default:
<code>"template"</code>, to use the same option used for estimation of the
<code>template</code>.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_q2">Q2</code>, <code id="templateICA_+3A_q2_max">Q2_max</code></td>
<td>
<p>Denoise the BOLD data? Denoising is based on modeling and
removing nuisance ICs. It may result in a cleaner estimate for smaller
datasets, but it may be unnecessary (and time-consuming) for larger datasets.
</p>
<p>Set <code>Q2</code> to control denoising: use a positive integer to specify the
number of nuisance ICs, <code>NULL</code> to have the number of nuisance ICs
estimated by PESEL, or zero to skip denoising.
</p>
<p>If <code>is.null(Q2)</code>, use <code>Q2_max</code> to specify the maximum number of
nuisance ICs that should be estimated by PESEL. <code>Q2_max</code> must be less
than <code class="reqn">T * .75 - Q</code> where <code class="reqn">T</code> is the number of timepoints in BOLD
and <code class="reqn">Q</code> is the number of group ICs. If <code>NULL</code>, <code>Q2_max</code> will
be set to <code class="reqn">T * .50 - Q</code>, rounded.
</p>
<p>The defaults for both arguments is <code>"template"</code>, to use the same option
used for estimation of the <code>template</code>.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_brainstructures">brainstructures</code></td>
<td>
<p>Only applies if the entries of <code>BOLD</code> are CIFTI
file paths. This is a character vector indicating which brain structure(s)
to obtain: <code>"left"</code> (left cortical surface), <code>"right"</code> (right
cortical surface) and/or <code>"subcortical"</code> (subcortical and cerebellar
gray matter). Can also be <code>"all"</code> (obtain all three brain structures).
Default: <code>"template"</code> to use the same brainstructures present in the
<code>template</code>).</p>
</td></tr>
<tr><td><code id="templateICA_+3A_mask">mask</code></td>
<td>
<p>Required if and only if the entries of <code>BOLD</code> are NIFTI
file paths or <code>"nifti"</code> objects. This is a brain map formatted as a
binary array of the same spatial dimensions as the fMRI data, with
<code>TRUE</code> corresponding to in-mask voxels.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_time_inds">time_inds</code></td>
<td>
<p>Subset of fMRI BOLD volumes to include in analysis, as a
vector of numeric integers. If <code>NULL</code> (default), use all volumes.
Subsetting is performed before any centering, scaling, detrending, and
denoising. If multiple <code>BOLD</code> are provided, <code>time_inds</code> can be a
list of the same length, with each element being a vector of numeric
integers indicating the timepoints to include for each BOLD.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_vartol">varTol</code></td>
<td>
<p>Tolerance for variance of each data location. For each scan,
locations which do not meet this threshold are masked out of the analysis.
Default: <code>"template"</code> to use the same brainstructures present in the
<code>template</code>). Variance is calculated on the original data, before
any normalization. Set to <code>0</code> to avoid removing locations due to
low variance.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_spatial_model">spatial_model</code></td>
<td>
<p>Should spatial modeling be performed? If <code>NULL</code>, assume
spatial independence. Otherwise, provide meshes specifying the spatial priors assumed on
each independent component. Each should represent a brain structure, between which
spatial independence can be assumed.
</p>
<p>If <code>BOLD</code> represents CIFTI-format data, <code>spatial_model</code> should give the left and
right cortex surface geometries (whichever one(s) are being used) as <code>"surf"</code>
objects or GIFTI surface geometry file paths. Spatial modeling is not yet available for
the subcortex. This argument can also be <code>TRUE</code>, in which case spatial modeling
will be performed with the surfaces included in the first entry of <code>BOLD</code> if it is a
<code>"xifti"</code> object, or if those are not present available, the default inflated
surfaces from <code>ciftiTools</code>.
</p>
<p>If <code>BOLD</code> represents NIFTI-format data, spatial modeling is not yet available.
</p>
<p>If <code>BOLD</code> is a numeric matrix, <code>spatial_model</code> should be a list of meshes
(see <code><a href="#topic+make_mesh">make_mesh</a></code>).</p>
</td></tr>
<tr><td><code id="templateICA_+3A_resamp_res">resamp_res</code></td>
<td>
<p>Only applies if <code>BOLD</code> represents CIFTI-format data.
The target resolution for resampling (number of cortical surface vertices
per hemisphere). For spatial modelling, a value less than 10000 is
recommended for computational feasibility. If <code>NULL</code> (default), do not
perform resampling.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_rm_mwall">rm_mwall</code></td>
<td>
<p>Only applies if <code>BOLD</code> represents CIFTI-format data.
Should medial wall (missing data) locations be removed from the mesh?
If <code>TRUE</code>, faster computation but less accurate estimates at the
boundary of wall.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_reduce_dim">reduce_dim</code></td>
<td>
<p>Reduce the temporal dimension of the data using PCA?
Default: <code>TRUE</code>. Skipping dimension reduction will slow the model
estimation, but may result in more accurate results. Ignored for FC template
ICA</p>
</td></tr>
<tr><td><code id="templateICA_+3A_method_fc">method_FC</code></td>
<td>
<p>Variational Bayes (VB) method for FC template ICA model:
<code>"VB1"</code> (default) uses a conjugate Inverse-Wishart prior for the cor(A);
<code>"VB2"</code> draws samples from p(cor(A)) to emulate the population distribution
using a combination of Cholesky, SVD, and random pivoting.
<code>"none"</code> Uses standard template ICA without FC prior</p>
</td></tr>
<tr><td><code id="templateICA_+3A_maxiter">maxiter</code></td>
<td>
<p>Maximum number of EM or VB iterations. Default: <code>100</code>.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_miniter">miniter</code></td>
<td>
<p>Minimum number of EM or VB iterations. Default: <code>3</code>.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_epsilon">epsilon</code></td>
<td>
<p>Smallest proportion change between iterations. Default:
<code>.001</code>.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_kappa_init">kappa_init</code></td>
<td>
<p>Starting value for kappa. Default: <code>0.2</code>.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_usepar">usePar</code></td>
<td>
<p>Parallelize the computation? Default: <code>TRUE</code>. Can be the
number of cores to use or <code>TRUE</code>, which will use the number available minus two.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_pw">PW</code></td>
<td>
<p>Prewhiten to account for residual autocorrelation? Default: <code>FALSE</code>.
Only affects FC template ICA models.</p>
</td></tr>
<tr><td><code id="templateICA_+3A_verbose">verbose</code></td>
<td>
<p>If <code>TRUE</code>, display progress of algorithm</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A (spatial) template ICA object, which is a list containing:
<code>subjICmean</code>, the <code class="reqn">V \times L</code> estimated independent components
<strong>S</strong>; <code>subjICse</code>, the standard errors of <strong>S</strong>; the
<code>mask</code> of locations without template values due to too many low
variance or missing values; the <code>nuisance</code> design matrix or matrices if
applicable; and the function <code>params</code> such as the type of scaling and
detrending performed.
</p>
<p>If <code>BOLD</code> represented CIFTI or NIFTI data, <code>subjICmean</code> and
<code>subjICse</code> will be formatted as <code>"xifti"</code> or <code>"nifti"</code>
objects, respectively.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
 tm &lt;- estimate_template(cii1_fnames, cii2_fnames, gICA_fname)
 templateICA(newcii_fname, tm, spatial_model=TRUE, resamp_res=2000)

## End(Not run)
</code></pre>

<hr>
<h2 id='TR_param'>TR</h2><span id='topic+TR_param'></span>

<h3>Description</h3>

<p>TR
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="TR_param_+3A_tr">TR</code></td>
<td>
<p>The temporal resolution of the data, i.e. the time between volumes,
in seconds. <code>TR</code> is required for detrending with <code>hpf</code>.</p>
</td></tr>
</table>

<hr>
<h2 id='update_A'>Update A for VB FC Template ICA using IW prior on FC</h2><span id='topic+update_A'></span>

<h3>Description</h3>

<p>Update A for VB FC Template ICA using IW prior on FC
</p>


<h3>Usage</h3>

<pre><code class='language-R'>update_A(
  mu_tau2,
  mu_S,
  E_SSt,
  BOLD,
  ntime,
  nICs,
  nvox,
  u_samps,
  template_FC,
  usePar = TRUE,
  final = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="update_A_+3A_mu_tau2">mu_tau2</code>, <code id="update_A_+3A_mu_s">mu_S</code>, <code id="update_A_+3A_e_sst">E_SSt</code></td>
<td>
<p>Most recent estimates of posterior
moments for these variables.</p>
</td></tr>
<tr><td><code id="update_A_+3A_bold">BOLD</code></td>
<td>
<p>(<code class="reqn">T \times V</code> matrix) preprocessed fMRI data.</p>
</td></tr>
<tr><td><code id="update_A_+3A_ntime">ntime</code>, <code id="update_A_+3A_nics">nICs</code>, <code id="update_A_+3A_nvox">nvox</code></td>
<td>
<p>Number of timepoints, number of ICs, number of locations</p>
</td></tr>
<tr><td><code id="update_A_+3A_u_samps">u_samps</code></td>
<td>
<p>Samples from Gamma for multivariate t prior on A</p>
</td></tr>
<tr><td><code id="update_A_+3A_template_fc">template_FC</code></td>
<td>
<p>IW parameters for FC template</p>
</td></tr>
<tr><td><code id="update_A_+3A_usepar">usePar</code></td>
<td>
<p>Parallelize the computation? Default: <code>FALSE</code>. Can be the
number of cores to use or <code>TRUE</code>, which will use the number available minus two.</p>
</td></tr>
<tr><td><code id="update_A_+3A_final">final</code></td>
<td>
<p>If TRUE, return cov_A. Default: <code>FALSE</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of length two: <code>mu_A</code> (TxQ) and <code>E_AtA</code> (QxQ).
</p>

<hr>
<h2 id='update_A_Chol'>Update A for VB FC Template ICA using Cholesky prior for FC</h2><span id='topic+update_A_Chol'></span>

<h3>Description</h3>

<p>Update A for VB FC Template ICA using Cholesky prior for FC
</p>


<h3>Usage</h3>

<pre><code class='language-R'>update_A_Chol(
  mu_tau2,
  mu_S,
  E_SSt,
  BOLD,
  ntime,
  nICs,
  nvox,
  template_FC,
  final = FALSE,
  exact = FALSE,
  usePar = TRUE,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="update_A_Chol_+3A_mu_tau2">mu_tau2</code>, <code id="update_A_Chol_+3A_mu_s">mu_S</code>, <code id="update_A_Chol_+3A_e_sst">E_SSt</code></td>
<td>
<p>Most recent estimates of posterior
moments for these variables.</p>
</td></tr>
<tr><td><code id="update_A_Chol_+3A_bold">BOLD</code></td>
<td>
<p>(<code class="reqn">T \times V</code> matrix) preprocessed fMRI data.</p>
</td></tr>
<tr><td><code id="update_A_Chol_+3A_ntime">ntime</code>, <code id="update_A_Chol_+3A_nics">nICs</code>, <code id="update_A_Chol_+3A_nvox">nvox</code></td>
<td>
<p>Number of timepoints, number of ICs, number of locations</p>
</td></tr>
<tr><td><code id="update_A_Chol_+3A_template_fc">template_FC</code></td>
<td>
<p>IW parameters for FC template</p>
</td></tr>
<tr><td><code id="update_A_Chol_+3A_final">final</code></td>
<td>
<p>If TRUE, return cov_A. Default: <code>FALSE</code></p>
</td></tr>
<tr><td><code id="update_A_Chol_+3A_exact">exact</code></td>
<td>
<p>If FALSE, at intermediate steps (final = <code>FALSE</code>) will attempt to
approximate V_k as described in the appendix of Mejia et al. 2024. Setting
<code>exact = TRUE</code> may be helpful when using spatial ESS correction,
which can lead to a lower rate of usable prior samples for the approximation.</p>
</td></tr>
<tr><td><code id="update_A_Chol_+3A_usepar">usePar</code></td>
<td>
<p>Parallelize the computation? Default: <code>FALSE</code>. Can be the
number of cores to use or <code>TRUE</code>, which will use the number available minus two.</p>
</td></tr>
<tr><td><code id="update_A_Chol_+3A_verbose">verbose</code></td>
<td>
<p>If <code>TRUE</code>, display progress of algorithm. Default: <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of length two: <code>mu_A</code> (TxQ) and <code>E_AtA</code> (QxQ).
</p>

<hr>
<h2 id='update_S'>Update S for VB FC Template ICA</h2><span id='topic+update_S'></span>

<h3>Description</h3>

<p>Update S for VB FC Template ICA
</p>


<h3>Usage</h3>

<pre><code class='language-R'>update_S(
  mu_tau2,
  mu_A,
  E_AtA,
  D_inv,
  D_inv_S,
  BOLD,
  nICs,
  nvox,
  ntime,
  final = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="update_S_+3A_mu_tau2">mu_tau2</code>, <code id="update_S_+3A_mu_a">mu_A</code>, <code id="update_S_+3A_e_ata">E_AtA</code></td>
<td>
<p>Most recent posterior estimates</p>
</td></tr>
<tr><td><code id="update_S_+3A_d_inv">D_inv</code>, <code id="update_S_+3A_d_inv_s">D_inv_S</code></td>
<td>
<p>Some pre-computed quantities.</p>
</td></tr>
<tr><td><code id="update_S_+3A_bold">BOLD</code></td>
<td>
<p>(<code class="reqn">T \times V</code> matrix) preprocessed fMRI data.</p>
</td></tr>
<tr><td><code id="update_S_+3A_nics">nICs</code>, <code id="update_S_+3A_nvox">nvox</code>, <code id="update_S_+3A_ntime">ntime</code></td>
<td>
<p>Number of ICs, number of data locations, and time series length</p>
</td></tr>
<tr><td><code id="update_S_+3A_final">final</code></td>
<td>
<p>If TRUE, return cov_S. Default: <code>FALSE</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of length three: <code>mu_S</code> (QxV), <code>E_SSt</code> (QxQ), and <code>cov_S</code> (QxQxV).
</p>

<hr>
<h2 id='update_tau2'>Update tau for VB FC Template ICA</h2><span id='topic+update_tau2'></span>

<h3>Description</h3>

<p>Update tau for VB FC Template ICA
</p>


<h3>Usage</h3>

<pre><code class='language-R'>update_tau2(BOLD, BOLD2, mu_A, E_AtA, mu_S, E_SSt, prior_params, ntime, nvox)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="update_tau2_+3A_bold">BOLD</code></td>
<td>
<p>(<code class="reqn">T \times V</code> matrix) preprocessed fMRI data.</p>
</td></tr>
<tr><td><code id="update_tau2_+3A_bold2">BOLD2</code></td>
<td>
<p>A precomputed quantity, <code>sum(BOLD^2)</code></p>
</td></tr>
<tr><td><code id="update_tau2_+3A_mu_a">mu_A</code>, <code id="update_tau2_+3A_e_ata">E_AtA</code>, <code id="update_tau2_+3A_mu_s">mu_S</code>, <code id="update_tau2_+3A_e_sst">E_SSt</code></td>
<td>
<p>Current posterior estimates</p>
</td></tr>
<tr><td><code id="update_tau2_+3A_prior_params">prior_params</code></td>
<td>
<p>Alpha and beta parameters of IG prior on <code class="reqn">\tau^2</code>
(error variance).</p>
</td></tr>
<tr><td><code id="update_tau2_+3A_ntime">ntime</code>, <code id="update_tau2_+3A_nvox">nvox</code></td>
<td>
<p>Number of timepoints in data and the number of data
locations.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of length two: <code>alpha1</code> and <code>beta1</code>.
</p>

<hr>
<h2 id='UpdateTheta_templateICA'>Parameter Estimates in EM Algorithm for Template ICA Model</h2><span id='topic+UpdateTheta_templateICA'></span><span id='topic+UpdateTheta_templateICA.spatial'></span><span id='topic+UpdateTheta_templateICA.independent'></span>

<h3>Description</h3>

<p>Parameter Estimates in EM Algorithm for Template ICA Model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>UpdateTheta_templateICA.spatial(
  template_mean,
  template_var,
  meshes,
  BOLD,
  theta,
  C_diag,
  H,
  Hinv,
  s0_vec,
  D,
  Dinv_s0,
  verbose = FALSE,
  return_MAP = FALSE,
  update = c("all", "kappa", "A")
)

UpdateTheta_templateICA.independent(
  template_mean,
  template_var,
  BOLD,
  theta,
  C_diag,
  H,
  Hinv,
  update_nu0sq = TRUE,
  return_MAP = FALSE,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="UpdateTheta_templateICA_+3A_template_mean">template_mean</code></td>
<td>
<p>(<code class="reqn">V \times Q</code> matrix) mean maps for each IC in template</p>
</td></tr>
<tr><td><code id="UpdateTheta_templateICA_+3A_template_var">template_var</code></td>
<td>
<p>(<code class="reqn">V \times Q</code> matrix) between-subject variance maps for each IC in template</p>
</td></tr>
<tr><td><code id="UpdateTheta_templateICA_+3A_meshes">meshes</code></td>
<td>
<p><code>NULL</code> for spatial independence model, otherwise a list of
objects of class &quot;templateICA_mesh&quot; containing the triangular mesh (see
<code><a href="#topic+make_mesh">make_mesh</a></code>) for each brain structure.</p>
</td></tr>
<tr><td><code id="UpdateTheta_templateICA_+3A_bold">BOLD</code></td>
<td>
<p>(<code class="reqn">V \times Q</code> matrix) dimension-reduced fMRI data</p>
</td></tr>
<tr><td><code id="UpdateTheta_templateICA_+3A_theta">theta</code></td>
<td>
<p>(list) current parameter estimates</p>
</td></tr>
<tr><td><code id="UpdateTheta_templateICA_+3A_c_diag">C_diag</code></td>
<td>
<p><code class="reqn">(Qx1)</code> diagonal elements of residual covariance after dimension reduction</p>
</td></tr>
<tr><td><code id="UpdateTheta_templateICA_+3A_h">H</code>, <code id="UpdateTheta_templateICA_+3A_hinv">Hinv</code></td>
<td>
<p>For dimension reduction</p>
</td></tr>
<tr><td><code id="UpdateTheta_templateICA_+3A_s0_vec">s0_vec</code></td>
<td>
<p>Vectorized template means</p>
</td></tr>
<tr><td><code id="UpdateTheta_templateICA_+3A_d">D</code></td>
<td>
<p>Sparse diagonal matrix of template standard deviations</p>
</td></tr>
<tr><td><code id="UpdateTheta_templateICA_+3A_dinv_s0">Dinv_s0</code></td>
<td>
<p>The inverse of D times s0_vec</p>
</td></tr>
<tr><td><code id="UpdateTheta_templateICA_+3A_verbose">verbose</code></td>
<td>
<p>If <code>TRUE</code>, display progress of algorithm. Default: <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="UpdateTheta_templateICA_+3A_return_map">return_MAP</code></td>
<td>
<p>If <code>TRUE</code>. return the posterior mean and precision of
the latent fields instead of the parameter estimates. Default: <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="UpdateTheta_templateICA_+3A_update">update</code></td>
<td>
<p>Which parameters to update. Either <code>"all"</code>, <code>"A"</code> or <code>"kappa"</code>.</p>
</td></tr>
<tr><td><code id="UpdateTheta_templateICA_+3A_update_nu0sq">update_nu0sq</code></td>
<td>
<p>For non-spatial model: updating <code>nu0sq</code> is recommended
if dimension reduction was not performed, and is not recommended if it was.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An updated list of parameter estimates, theta, OR if
<code>return_MAP=TRUE</code>, the posterior mean and precision of the latent fields
</p>

<hr>
<h2 id='UpdateThetaSQUAREM_templateICA'>Update theta SQUAREM</h2><span id='topic+UpdateThetaSQUAREM_templateICA'></span>

<h3>Description</h3>

<p>Helper function for SQUAREM for estimating parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>UpdateThetaSQUAREM_templateICA(
  theta_vec,
  template_mean,
  template_var,
  meshes,
  BOLD,
  C_diag,
  H,
  Hinv,
  s0_vec,
  D,
  Dinv_s0,
  update_nu0sq,
  verbose
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="UpdateThetaSQUAREM_templateICA_+3A_theta_vec">theta_vec</code></td>
<td>
<p>Vector of initial parameter values</p>
</td></tr>
<tr><td><code id="UpdateThetaSQUAREM_templateICA_+3A_template_mean">template_mean</code></td>
<td>
<p>Passed to UpdateTheta_templateICA function</p>
</td></tr>
<tr><td><code id="UpdateThetaSQUAREM_templateICA_+3A_template_var">template_var</code></td>
<td>
<p>Passed to UpdateTheta_templateICA function</p>
</td></tr>
<tr><td><code id="UpdateThetaSQUAREM_templateICA_+3A_meshes">meshes</code></td>
<td>
<p>Passed to UpdateTheta_templateICA function</p>
</td></tr>
<tr><td><code id="UpdateThetaSQUAREM_templateICA_+3A_bold">BOLD</code></td>
<td>
<p>Passed to UpdateTheta_templateICA function</p>
</td></tr>
<tr><td><code id="UpdateThetaSQUAREM_templateICA_+3A_c_diag">C_diag</code></td>
<td>
<p>Passed to UpdateTheta_templateICA function</p>
</td></tr>
<tr><td><code id="UpdateThetaSQUAREM_templateICA_+3A_s0_vec">s0_vec</code></td>
<td>
<p>Passed to UpdateTheta_templateICA function</p>
</td></tr>
<tr><td><code id="UpdateThetaSQUAREM_templateICA_+3A_d">D</code></td>
<td>
<p>Passed to UpdateTheta_templateICA function</p>
</td></tr>
<tr><td><code id="UpdateThetaSQUAREM_templateICA_+3A_dinv_s0">Dinv_s0</code></td>
<td>
<p>Passed to UpdateTheta_templateICA function</p>
</td></tr>
<tr><td><code id="UpdateThetaSQUAREM_templateICA_+3A_update_nu0sq">update_nu0sq</code></td>
<td>
<p>For non-spatial model: updating <code>nu0sq</code> is recommended
if dimension reduction was not performed, and is not recommended if it was.</p>
</td></tr>
<tr><td><code id="UpdateThetaSQUAREM_templateICA_+3A_verbose">verbose</code></td>
<td>
<p>Passed to UpdateTheta_templateICA function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Vector of updated parameter values
</p>

<hr>
<h2 id='UT2mat'>Transform upper-triangular elements to matrix form</h2><span id='topic+UT2mat'></span>

<h3>Description</h3>

<p>Transform upper-triangular elements to matrix form
</p>


<h3>Usage</h3>

<pre><code class='language-R'>UT2mat(x, diag = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="UT2mat_+3A_x">x</code></td>
<td>
<p>Vector of upper triangular values</p>
</td></tr>
<tr><td><code id="UT2mat_+3A_diag">diag</code></td>
<td>
<p>Are diagonal values included in x?  Default: <code>TRUE</code>.</p>
</td></tr>
</table>

<hr>
<h2 id='var_sq_err'>Compute the error between empirical and theoretical variance of covariance matrix elements</h2><span id='topic+var_sq_err'></span>

<h3>Description</h3>

<p>Compute the error between empirical and theoretical variance of covariance matrix elements
</p>


<h3>Usage</h3>

<pre><code class='language-R'>var_sq_err(nu, p, var_ij, xbar_ij, xbar_ii, xbar_jj)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="var_sq_err_+3A_nu">nu</code></td>
<td>
<p>Inverse Wishart degrees of freedom parameter</p>
</td></tr>
<tr><td><code id="var_sq_err_+3A_p">p</code></td>
<td>
<p>Matrix dimension for IW distribution</p>
</td></tr>
<tr><td><code id="var_sq_err_+3A_var_ij">var_ij</code></td>
<td>
<p>Empirical between-subject variance of covariance matrices at element (i,j)</p>
</td></tr>
<tr><td><code id="var_sq_err_+3A_xbar_ij">xbar_ij</code></td>
<td>
<p>Empirical mean of covariance matrices at element (i,j)</p>
</td></tr>
<tr><td><code id="var_sq_err_+3A_xbar_ii">xbar_ii</code></td>
<td>
<p>Empirical mean of covariance matrices at the ith diagonal element</p>
</td></tr>
<tr><td><code id="var_sq_err_+3A_xbar_jj">xbar_jj</code></td>
<td>
<p>Empirical mean of covariance matrices at the jth diagonal element</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Squared difference between the empirical and theoretical IW variance of covariance matrices at element (i,j)
</p>

<hr>
<h2 id='var_sq_err_constrained'>Compute the overall error between empirical and theoretical variance of CORRELATION matrix elements</h2><span id='topic+var_sq_err_constrained'></span>

<h3>Description</h3>

<p>Compute the overall error between empirical and theoretical variance of CORRELATION matrix elements
</p>


<h3>Usage</h3>

<pre><code class='language-R'>var_sq_err_constrained(nu, p, var, xbar, M = 10000)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="var_sq_err_constrained_+3A_nu">nu</code></td>
<td>
<p>Inverse Wishart degrees of freedom parameter</p>
</td></tr>
<tr><td><code id="var_sq_err_constrained_+3A_p">p</code></td>
<td>
<p>Matrix dimension for IW distribution</p>
</td></tr>
<tr><td><code id="var_sq_err_constrained_+3A_var">var</code></td>
<td>
<p>Empirical between-subject variances of CORRELATION matrix (upper triangle)</p>
</td></tr>
<tr><td><code id="var_sq_err_constrained_+3A_xbar">xbar</code></td>
<td>
<p>Empirical mean of CORRELATION matrix (upper triangle)</p>
</td></tr>
<tr><td><code id="var_sq_err_constrained_+3A_m">M</code></td>
<td>
<p>Penalty to assign if theoretical variance is smaller than empirical variance</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Sum of squared difference between the empirical and theoretical IW variance of CORRELATION matrix,
but with constraint that theoretical variances must not be smaller than empirical variances
</p>

<hr>
<h2 id='varTol_Param'>varTol</h2><span id='topic+varTol_Param'></span>

<h3>Description</h3>

<p>varTol
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="varTol_Param_+3A_vartol">varTol</code></td>
<td>
<p>Tolerance for variance of each data location. For each scan,
locations which do not meet this threshold are masked out of the analysis.
Default: <code>1e-6</code>. Variance is calculated on the original data, before
any normalization. Set to <code>0</code> to avoid removing locations due to
low variance.</p>
</td></tr>
</table>

<hr>
<h2 id='VB_FCtemplateICA'>VB_FCtemplateICA</h2><span id='topic+VB_FCtemplateICA'></span>

<h3>Description</h3>

<p>VB Algorithm for FC Template ICA Model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>VB_FCtemplateICA(
  template_mean,
  template_var,
  template_FC,
  method_FC = c("VB1", "VB2"),
  nsamp_u = 10000,
  CI_FC = 0.95,
  return_FC_samp = FALSE,
  prior_params = c(0.001, 0.001),
  BOLD,
  TR = NULL,
  A0,
  S0,
  S0_var,
  maxiter = 100,
  miniter = 3,
  epsilon = 0.001,
  usePar = TRUE,
  PW = FALSE,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="VB_FCtemplateICA_+3A_template_mean">template_mean</code></td>
<td>
<p>(<code class="reqn">V \times Q</code> matrix) mean maps for each IC in the
template, where <code class="reqn">Q</code> is the number of ICs, and <code class="reqn">V=nvox</code> is the number
of data locations.</p>
</td></tr>
<tr><td><code id="VB_FCtemplateICA_+3A_template_var">template_var</code></td>
<td>
<p>(<code class="reqn">V \times Q</code> matrix) between-subject variance maps
for each IC in the template.</p>
</td></tr>
<tr><td><code id="VB_FCtemplateICA_+3A_template_fc">template_FC</code></td>
<td>
<p>(list) Parameters of functional connectivity template.</p>
</td></tr>
<tr><td><code id="VB_FCtemplateICA_+3A_method_fc">method_FC</code></td>
<td>
<p>Variational Bayes (VB) method for FC template ICA model:
<code>"VB1"</code> (default) uses a conjugate Inverse-Wishart prior for the cor(A);
<code>"VB2"</code> draws samples from p(cor(A)) to emulate the population distribution
using a combination of Cholesky, SVD, and random pivoting.</p>
</td></tr>
<tr><td><code id="VB_FCtemplateICA_+3A_nsamp_u">nsamp_u</code></td>
<td>
<p>For VB1, the number of samples to generate from u ~ Gamma, where
A is Gaussian conditional on u. Default: <code>10000</code>.</p>
</td></tr>
<tr><td><code id="VB_FCtemplateICA_+3A_ci_fc">CI_FC</code></td>
<td>
<p>Level of posterior credible interval to construct for each FC element.
Default: <code>0.95</code>.</p>
</td></tr>
<tr><td><code id="VB_FCtemplateICA_+3A_return_fc_samp">return_FC_samp</code></td>
<td>
<p>Should the FC samples (<code class="reqn">QxQxK</code>) be returned, where K
is the number of posterior samples generated? May be a large object.  For VB1,
K is equal to nsamp_u. For VB2, K is equal to the number of samples from p(G)
contained in template_FC.</p>
</td></tr>
<tr><td><code id="VB_FCtemplateICA_+3A_prior_params">prior_params</code></td>
<td>
<p>Alpha and beta parameters of IG prior on <code class="reqn">\tau^2</code>
(error variance). Default: <code>0.001</code> for both.</p>
</td></tr>
<tr><td><code id="VB_FCtemplateICA_+3A_bold">BOLD</code></td>
<td>
<p>(<code class="reqn">V \times T</code> matrix) preprocessed fMRI data.</p>
</td></tr>
<tr><td><code id="VB_FCtemplateICA_+3A_a0">A0</code>, <code id="VB_FCtemplateICA_+3A_s0">S0</code>, <code id="VB_FCtemplateICA_+3A_s0_var">S0_var</code></td>
<td>
<p>Initial guesses at latent variables: <code>A</code> (<code class="reqn">TxQ</code>
mixing matrix), <code>S</code> (<code class="reqn">QxV</code> matrix of spatial ICs), and
variance matrix <code>S0_var</code>.</p>
</td></tr>
<tr><td><code id="VB_FCtemplateICA_+3A_maxiter">maxiter</code></td>
<td>
<p>Maximum number of VB iterations. Default: <code>100</code>.</p>
</td></tr>
<tr><td><code id="VB_FCtemplateICA_+3A_miniter">miniter</code></td>
<td>
<p>Minimum number of VB iterations. Default: <code>3</code>.</p>
</td></tr>
<tr><td><code id="VB_FCtemplateICA_+3A_epsilon">epsilon</code></td>
<td>
<p>Smallest proportion change in parameter estimates between iterations.
Default: <code>0.001</code>.</p>
</td></tr>
<tr><td><code id="VB_FCtemplateICA_+3A_usepar">usePar</code></td>
<td>
<p>Parallelize the computation? Default: <code>FALSE</code>. Can be the
number of cores to use or <code>TRUE</code>, which will use the number available minus two.</p>
</td></tr>
<tr><td><code id="VB_FCtemplateICA_+3A_pw">PW</code></td>
<td>
<p>Prewhiten to account for residual autocorrelation?</p>
</td></tr>
<tr><td><code id="VB_FCtemplateICA_+3A_verbose">verbose</code></td>
<td>
<p>If <code>TRUE</code>, display progress of algorithm. Default: <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of computed values, including the final parameter estimates.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
