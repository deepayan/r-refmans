<!DOCTYPE html><html lang="en"><head><title>Help for package cAIC4</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {cAIC4}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#cAIC4-package'>
<p>Conditional Akaike Information Criterion for 'lme4' and 'nlme'</p></a></li>
<li><a href='#anocAIC'><p>Comparison of several lmer objects via cAIC</p></a></li>
<li><a href='#cAIC'><p>Conditional Akaike Information for 'lme4' and 'lme'</p></a></li>
<li><a href='#deleteZeroComponents'><p>Delete random effect terms with zero variance</p></a></li>
<li><a href='#getcondLL'><p>Function to calculate the conditional log-likelihood</p></a></li>
<li><a href='#getWeights'><p>Optimize weights for model averaging.</p></a></li>
<li><a href='#guWahbaData'><p>Data from Gu and Wahba (1991)</p></a></li>
<li><a href='#modelAvg'><p>Model Averaging for Linear Mixed Models</p></a></li>
<li><a href='#predictMA'><p>Prediction of model averaged linear mixed models</p></a></li>
<li><a href='#print.cAIC'><p>Print method for cAIC</p></a></li>
<li><a href='#stepcAIC'><p>Function to stepwise select the (generalized) linear mixed model</p>
fitted via (g)lmer() or (generalized) additive (mixed) model
fitted via gamm4() with the smallest cAIC.</a></li>
<li><a href='#summaryMA'><p>Summary of model averaged linear mixed models</p></a></li>
<li><a href='#Zambia'><p>Subset of the Zambia data set on childhood malnutrition</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Conditional Akaike Information Criterion for 'lme4' and 'nlme'</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2021-09-22</td>
</tr>
<tr>
<td>Author:</td>
<td>Benjamin Saefken, David Ruegamer, Philipp Baumann and Rene-Marcel Kruse, with contributions from Sonja
    Greven and Thomas Kneib</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>David Ruegamer &lt;david.ruegamer@gmail.com&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>lme4(&ge; 1.1-6), methods, Matrix, stats4, nlme</td>
</tr>
<tr>
<td>Imports:</td>
<td>RLRsim, mgcv, mvtnorm</td>
</tr>
<tr>
<td>Suggests:</td>
<td>gamm4</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides functions for the estimation of the conditional Akaike
    information in generalized mixed-effect models fitted with (g)lmer() 
    from 'lme4', lme() from 'nlme' and gamm() from 'mgcv'.
    For a manual on how to use 'cAIC4', see Saefken et al. (2021) &lt;<a href="https://doi.org/10.18637%2Fjss.v099.i08">doi:10.18637/jss.v099.i08</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-09-22 09:54:18 UTC; david</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-09-22 10:10:16 UTC</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
</table>
<hr>
<h2 id='cAIC4-package'>
Conditional Akaike Information Criterion for 'lme4' and 'nlme'
</h2><span id='topic+cAIC4-package'></span><span id='topic+cAIC4'></span>

<h3>Description</h3>

<p>Provides functions for the estimation of the conditional Akaike
    information in generalized mixed-effect models fitted with (g)lmer() 
    from 'lme4', lme() from 'nlme' and gamm() from 'mgcv'.
    For a manual on how to use 'cAIC4', see Saefken et al. (2021) &lt;doi:10.18637/jss.v099.i08&gt;.
</p>


<h3>Details</h3>

<p>The DESCRIPTION file:
</p>

<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> cAIC4</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Title: </td><td style="text-align: left;"> Conditional Akaike Information Criterion for 'lme4' and 'nlme'</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.0</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2021-09-22</td>
</tr>
<tr>
 <td style="text-align: left;">
Author: </td><td style="text-align: left;"> Benjamin Saefken, David Ruegamer, Philipp Baumann and Rene-Marcel Kruse, with contributions from Sonja
    Greven and Thomas Kneib</td>
</tr>
<tr>
 <td style="text-align: left;">
Maintainer: </td><td style="text-align: left;"> David Ruegamer &lt;david.ruegamer@gmail.com&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
Depends: </td><td style="text-align: left;"> lme4(&gt;= 1.1-6), methods, Matrix, stats4, nlme</td>
</tr>
<tr>
 <td style="text-align: left;">
Imports: </td><td style="text-align: left;"> RLRsim, mgcv, mvtnorm</td>
</tr>
<tr>
 <td style="text-align: left;">
Suggests: </td><td style="text-align: left;"> gamm4</td>
</tr>
<tr>
 <td style="text-align: left;">
Description: </td><td style="text-align: left;"> Provides functions for the estimation of the conditional Akaike
    information in generalized mixed-effect models fitted with (g)lmer() 
    from 'lme4', lme() from 'nlme' and gamm() from 'mgcv'.
    For a manual on how to use 'cAIC4', see Saefken et al. (2021) &lt;doi:10.18637/jss.v099.i08&gt;.</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL (&gt;= 2)</td>
</tr>
<tr>
 <td style="text-align: left;">
Packaged: </td><td style="text-align: left;"> 2021-09-22 12:34:56 UTC; david</td>
</tr>
<tr>
 <td style="text-align: left;">
NeedsCompilation: </td><td style="text-align: left;"> no</td>
</tr>
<tr>
 <td style="text-align: left;">
Date/Publication: </td><td style="text-align: left;"> 2014-08-12 11:48:10</td>
</tr>
<tr>
 <td style="text-align: left;">
RoxygenNote: </td><td style="text-align: left;"> 7.1.1</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>


<p>Index of help topics:
</p>
<pre>
Zambia                  Subset of the Zambia data set on childhood
                        malnutrition
anocAIC                 Comparison of several lmer objects via cAIC
cAIC                    Conditional Akaike Information for 'lme4' and
                        'lme'
cAIC4-package           Conditional Akaike Information Criterion for
                        'lme4' and 'nlme'
deleteZeroComponents    Delete random effect terms with zero variance
getWeights              Optimize weights for model averaging.
getcondLL               Function to calculate the conditional
                        log-likelihood
guWahbaData             Data from Gu and Wahba (1991)
modelAvg                Model Averaging for Linear Mixed Models
predictMA               Prediction of model averaged linear mixed
                        models
print.cAIC              Print method for cAIC
stepcAIC                Function to stepwise select the (generalized)
                        linear mixed model fitted via (g)lmer() or
                        (generalized) additive (mixed) model fitted via
                        gamm4() with the smallest cAIC.
summaryMA               Summary of model averaged linear mixed models
</pre>


<h3>Author(s)</h3>

<p>Benjamin Saefken, David Ruegamer, Philipp Baumann and Rene-Marcel Kruse, with contributions from Sonja
    Greven and Thomas Kneib
</p>
<p>Maintainer: David Ruegamer &lt;david.ruegamer@gmail.com&gt;
</p>


<h3>References</h3>

<p>Saefken, B., Kneib T., van Waveren C.-S. and Greven, S. (2014) A unifying 
approach to the estimation of the conditional Akaike information in generalized 
linear mixed models. Electronic Journal Statistics Vol. 8, 201-225.
</p>
<p>Greven, S. and Kneib T. (2010) On the behaviour of marginal and conditional AIC 
in linear mixed models. Biometrika 97(4), 773-789.
</p>
<p>Efron , B. (2004) The estimation of prediction error. J. Amer. Statist. Ass. 
99(467), 619-632. 
</p>


<h3>See Also</h3>

<p><code><a href="lme4.html#topic+lme4-package">lme4</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>b &lt;- lmer(Reaction ~ Days + (Days | Subject), sleepstudy)

cAIC(b)
</code></pre>

<hr>
<h2 id='anocAIC'>Comparison of several lmer objects via cAIC</h2><span id='topic+anocAIC'></span>

<h3>Description</h3>

<p>Takes one or more <code>lmer</code>-objects and produces a table 
to the console.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>anocAIC(object, ..., digits = 2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="anocAIC_+3A_object">object</code></td>
<td>
<p>a fitted <code>lme4</code>-object</p>
</td></tr>
<tr><td><code id="anocAIC_+3A_...">...</code></td>
<td>
<p>additional objects of the same type</p>
</td></tr>
<tr><td><code id="anocAIC_+3A_digits">digits</code></td>
<td>
<p>number of digits to print</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a table comparing the cAIC relevant information of all models
</p>


<h3>See Also</h3>

<p><code><a href="#topic+cAIC">cAIC</a></code> for the model fit.
</p>

<hr>
<h2 id='cAIC'>Conditional Akaike Information for 'lme4' and 'lme'</h2><span id='topic+cAIC'></span>

<h3>Description</h3>

<p>Estimates the conditional Akaike information for models that were fitted in
'lme4' or with 'lme'. Currently all distributions are supported for 'lme4' models, 
based on parametric conditional bootstrap. 
For the Gaussian distribution (from a <code><a href="lme4.html#topic+lmer">lmer</a></code> or <code><a href="nlme.html#topic+lme">lme</a></code>
call) and the Poisson distribution analytical estimators for the degrees of
freedom are available, based on Stein type formulas. Also the conditional
Akaike information for generalized additive models based on a fit via the
'gamm4' or <code><a href="mgcv.html#topic+gamm">gamm</a></code> calls from the 'mgcv' package can be estimated.
A hands-on tutorial for the package can be found at <a href="https://arxiv.org/abs/1803.05664">https://arxiv.org/abs/1803.05664</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cAIC(object, method = NULL, B = NULL, sigma.penalty = 1, analytic = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cAIC_+3A_object">object</code></td>
<td>
<p>An object of class merMod either fitted by
<code><a href="lme4.html#topic+lmer">lmer</a></code> or <code><a href="lme4.html#topic+glmer">glmer</a></code> of the lme4-package
or an <code><a href="nlme.html#topic+lme">lme</a></code> object fro the nlme-package.
Also objects returned form a <code><a href="gamm4.html#topic+gamm4">gamm4</a></code> call are possible.</p>
</td></tr>
<tr><td><code id="cAIC_+3A_method">method</code></td>
<td>
<p>Either <code>"conditionalBootstrap"</code> for the estimation of the
degrees of freedom with the help of conditional Bootstrap or
<code>"steinian"</code> for analytical representations based on Stein type
formulas. The default is <code>NULL</code>. In this case the method is choosen
automatically based on the <code>family</code> argument of the
<code>(g)lmer</code>-object. For <code>"gaussian"</code> and <code>"poisson"</code> this is
the Steinian type estimator, for all others it is the conditional Bootstrap.
For models from the nlme package, only <code><a href="nlme.html#topic+lme">lme</a></code> objects, i.e.,
with gaussian response are supported.</p>
</td></tr>
<tr><td><code id="cAIC_+3A_b">B</code></td>
<td>
<p>Number of Bootstrap replications. The default is <code>NULL</code>. Then
B is the minimum of 100 and the length of the response vector.</p>
</td></tr>
<tr><td><code id="cAIC_+3A_sigma.penalty">sigma.penalty</code></td>
<td>
<p>An integer value for additional penalization in the analytic 
Gaussian calculation to account for estimated variance components in the residual (co-)variance. 
Per default <code>sigma.penalty</code> is equal <code>1</code>, corresponding to a diagonal error 
covariance matrix with only one estimated parameter (sigma). If 
all variance components are known, the value should be set to <code>0</code>. 
For individual weights (individual variances), this value should be set
to the number of estimated weights. For <code><a href="nlme.html#topic+lme">lme</a></code> objects
the penalty term is automatically set by extracting the number of estimated
variance components.</p>
</td></tr>
<tr><td><code id="cAIC_+3A_analytic">analytic</code></td>
<td>
<p>FALSE if the numeric hessian of the (restricted) marginal
log-likelihood from the lmer optimization procedure should be used.
Otherwise (default) TRUE, i.e.  use a analytical version that has to be
computed. Only used for the analytical version of Gaussian responses.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For <code>method = "steinian"</code> and an object of class <code>merMod</code> computed
the analytic representation of the corrected conditional AIC in Greven and
Kneib (2010). This is based on a the Stein formula and uses implicit
differentiation to calculate the derivative of the random effects covariance
parameters w.r.t.  the data. The code is adapted form the one provided in
the supplementary material of the paper by Greven and Kneib (2010). The
supplied <code><a href="lme4.html#topic+merMod">merMod</a></code> model needs to be checked if a random
effects covariance parameter has an optimum on the boundary, i.e. is zero.
And if so the model needs to be refitted with the according random effect
terms omitted. This is also done by the function and the refitted model is
also returned. Notice that the <code>boundary.tol</code> argument in
<code><a href="lme4.html#topic+lmerControl">lmerControl</a></code> has an impact on whether a parameter is
estimated to lie on the boundary of the parameter space. For estimated error
variance the degrees of freedom are increased by one per default. 
<code>sigma.penalty</code> can be set manually for <code><a href="lme4.html#topic+merMod">merMod</a></code> models 
if no (0) or more than one variance component (&gt;1) has been estimated. For 
<code><a href="nlme.html#topic+lme">lme</a></code> objects this value is automatically defined.
</p>
<p>If the object is of class <code><a href="lme4.html#topic+merMod">merMod</a></code> and has <code>family =
"poisson"</code> there is also an analytic representation of the conditional AIC
based on the Chen-Stein formula, see for instance Saefken et. al (2014). For
the calculation the model needs to be refitted for each observed response
variable minus the number of response variables that are exactly zero. The
calculation therefore takes longer then for models with Gaussian responses.
Due to the speed and stability of 'lme4' this is still possible, also for
larger datasets.
</p>
<p>If the model has Bernoulli distributed responses and <code>method =
"steinian"</code>, <code><a href="#topic+cAIC">cAIC</a></code> calculates the degrees of freedom based on a
proposed estimator by Efron (2004). This estimator is asymptotically
unbiased if the estimated conditional mean is consistent. The calculation
needs as many model refits as there are data points.
</p>
<p>Another more general method for the estimation of the degrees of freedom is
the conditional bootstrap. This is proposed in Efron (2004). For the B
boostrap samples the degrees of freedom are estimated by </p>
<p style="text-align: center;"><code class="reqn">\frac{1}{B -
1}\sum_{i=1}^n\theta_i(z_i)(z_i-\bar{z}),</code>
</p>
<p> where <code class="reqn">\theta_i(z_i)</code> is the
i-th element of the estimated natural parameter.
</p>
<p>For models with no random effects, i.e. (g)lms, the <code><a href="#topic+cAIC">cAIC</a></code>
function returns the AIC of the model with scale parameter estimated by REML.
</p>


<h3>Value</h3>

<p>A <code>cAIC</code> object, which is a list consisting of: 
1. the conditional log likelihood, i.e. the log likelihood with the random 
effects as penalized parameters; 2. the estimated degrees of freedom; 
3. a list element that is either <code>NULL</code>
if no new model was fitted otherwise the new (reduced) model, see details;
4. a boolean variable indicating whether a new model was fitted or not; 5.
the estimator of the conditional Akaike information, i.e. minus twice the
log likelihood plus twice the degrees of freedom.
</p>


<h3>WARNINGS </h3>

<p>Currently the cAIC can only be estimated for
<code>family</code> equal to <code>"gaussian"</code>, <code>"poisson"</code> and
<code>"binomial"</code>. Neither negative binomial nor gamma distributed responses
are available. 
Weighted Gaussian models are not yet implemented.
</p>


<h3>Author(s)</h3>

<p>Benjamin Saefken, David Ruegamer
</p>


<h3>References</h3>

<p>Saefken, B., Ruegamer, D., Kneib, T. and Greven, S. (2021):
Conditional Model Selection in Mixed-Effects Models with cAIC4.
&lt;doi:10.18637/jss.v099.i08&gt;
</p>
<p>Saefken, B., Kneib T., van Waveren C.-S. and Greven, S. (2014) A
unifying approach to the estimation of the conditional Akaike information in
generalized linear mixed models. Electronic Journal Statistics Vol. 8,
201-225.
</p>
<p>Greven, S. and Kneib T. (2010) On the behaviour of marginal and conditional
AIC in linear mixed models. Biometrika 97(4), 773-789.
</p>
<p>Efron , B. (2004) The estimation of prediction error. J. Amer. Statist. Ass.
99(467), 619-632.
</p>


<h3>See Also</h3>

<p><code><a href="lme4.html#topic+lme4-package">lme4-package</a></code>, <code><a href="lme4.html#topic+lmer">lmer</a></code>,
<code><a href="lme4.html#topic+glmer">glmer</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
### Three application examples
b &lt;- lmer(Reaction ~ Days + (Days | Subject), sleepstudy)
cAIC(b)

b2 &lt;- lmer(Reaction ~ (1 | Days) + (1 | Subject), sleepstudy)
cAIC(b2)

b2ML &lt;- lmer(Reaction ~ (1 + Days | Subject), sleepstudy, REML = FALSE)
cAIC(b2ML)

### Demonstration of boundary case
## Not run: 
set.seed(2017-1-1)
n &lt;- 50
beta &lt;- 2
x &lt;- rnorm(n)
eta &lt;- x*beta
id &lt;- gl(5,10)
epsvar &lt;- 1
data &lt;- data.frame(x = x, id = id)
y_wo_bi &lt;- eta + rnorm(n, 0, sd = epsvar) 

# use a very small RE variance
ranvar &lt;- 0.05
nrExperiments &lt;- 100

sim &lt;- sapply(1:nrExperiments, function(j){

b_i &lt;- scale(rnorm(5, 0, ranvar), scale = FALSE)
y &lt;- y_wo_bi + model.matrix(~ -1 + id) %*% b_i
data$y &lt;- y

mixedmod &lt;- lmer(y ~ x + (1 | id), data = data)
linmod &lt;- lm(y ~ x, data = data)

c(cAIC(mixedmod)$caic, cAIC(linmod)$caic)
})

rownames(sim) &lt;- c("mixed model", "linear model")

boxplot(t(sim))



## End(Not run)



</code></pre>

<hr>
<h2 id='deleteZeroComponents'>Delete random effect terms with zero variance</h2><span id='topic+deleteZeroComponents'></span><span id='topic+deleteZeroComponents.lme'></span><span id='topic+deleteZeroComponents.merMod'></span>

<h3>Description</h3>

<p>Is used in the <code><a href="#topic+cAIC">cAIC</a></code> function if <code>method = "steinian"</code> and
<code>family = "gaussian"</code>. The function deletes all random effects terms
from the call if corresponding variance parameter is estimated to zero and
updates the model in <code><a href="lme4.html#topic+merMod">merMod</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>deleteZeroComponents(m)

## S3 method for class 'lme'
deleteZeroComponents(m)

## S3 method for class 'merMod'
deleteZeroComponents(m)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="deleteZeroComponents_+3A_m">m</code></td>
<td>
<p>An object of class <code><a href="lme4.html#topic+merMod">merMod</a></code> fitted by
<code><a href="lme4.html#topic+lmer">lmer</a></code> of the lme4-package or of class
<code><a href="nlme.html#topic+lme">lme</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For <code>merMod</code> class models:
Uses the <code>cnms</code> slot of <code>m</code> and the relative covariance factors to
rewrite the random effects part of the formula, reduced by those parameters
that have an optimum on the boundary. This is necessary to obtain the true
conditional corrected Akaike information. For the theoretical justification
see Greven and Kneib (2010). The reduced model formula is then updated. The
function deleteZeroComponents is then called iteratively to check if in the
updated model there are relative covariance factors parameters on the
boundary.
</p>
<p>For <code><a href="nlme.html#topic+lme">lme</a></code> class models:
...
</p>


<h3>Value</h3>

<p>An updated object of class <code><a href="lme4.html#topic+merMod">merMod</a></code>
or of class <code><a href="nlme.html#topic+lme">lme</a></code>.
</p>
<p><code>NULL</code>
</p>
<p><code>NULL</code>
</p>


<h3>WARNINGS </h3>

<p>For models called via <code>gamm4</code> or <code>gamm</code> 
no automated update is available. 
Instead a warning with terms to omit from the model is returned.
</p>


<h3>Author(s)</h3>

<p>Benjamin Saefken \&amp; David Ruegamer \&amp; Philipp Baumann
</p>


<h3>References</h3>

<p>Greven, S. and Kneib T. (2010) On the behaviour of marginal and
conditional AIC in linear mixed models. Biometrika 97(4), 773-789.
</p>


<h3>See Also</h3>

<p><code><a href="lme4.html#topic+lme4-package">lme4-package</a></code>, <code><a href="lme4.html#topic+lmer">lmer</a></code>,
<code><a href="lme4.html#topic+getME">getME</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Currently no data with variance equal to zero...
b &lt;- lmer(Reaction ~ Days + (Days | Subject), sleepstudy)

deleteZeroComponents(b)
</code></pre>

<hr>
<h2 id='getcondLL'>Function to calculate the conditional log-likelihood</h2><span id='topic+getcondLL'></span><span id='topic+getcondLL.lme'></span><span id='topic+getcondLL.merMod'></span>

<h3>Description</h3>

<p>Function to calculate the conditional log-likelihood
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getcondLL(object)

## S3 method for class 'lme'
getcondLL(object)

## S3 method for class 'merMod'
getcondLL(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="getcondLL_+3A_object">object</code></td>
<td>
<p>An object of class <code>merMod</code> either fitted by
<code><a href="lme4.html#topic+lmer">lmer</a></code> or <code><a href="lme4.html#topic+glmer">glmer</a></code> of the 'lme4' package.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>conditional log-likelihood value
</p>
<p><code>NULL</code>
</p>
<p><code>NULL</code>
</p>

<hr>
<h2 id='getWeights'>Optimize weights for model averaging.</h2><span id='topic+getWeights'></span>

<h3>Description</h3>

<p>Function to determine optimal weights for model averaging based on a proposal 
by Zhang et al. ( 2014) to derive a weight choice criterion based on the 
conditional Akaike Information Criterion as proposed by Greven and Kneib 
(2010). The underlying optimization is a customized version of the 
Augmented Lagrangian Method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getWeights(models)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="getWeights_+3A_models">models</code></td>
<td>
<p>An list object containing all considered candidate models fitted by
<code><a href="lme4.html#topic+lmer">lmer</a></code> of the lme4-package or of class
<code><a href="nlme.html#topic+lme">lme</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object containing a vector of optimized weights, 
value of the minimized target function and the duration of the optimization 
process.
</p>


<h3>WARNINGS </h3>

<p>No weight-determination is currently possible for models called via <code>gamm4</code>.
</p>


<h3>Author(s)</h3>

<p>Benjamin Saefken &amp; Rene-Marcel Kruse
</p>


<h3>References</h3>

<p>Greven, S. and Kneib T. (2010) On the behaviour of marginal and
conditional AIC in linear mixed models. Biometrika 97(4), 773-789.
</p>
<p>Zhang, X., Zou, G., &amp; Liang, H. (2014). Model averaging and
weight choice in linear mixed-effects models. Biometrika, 101(1), 205-218.
</p>
<p>Nocedal, J., &amp; Wright, S. (2006). Numerical optimization.
Springer Science &amp; Business Media.
</p>


<h3>See Also</h3>

<p><code><a href="lme4.html#topic+lme4-package">lme4-package</a></code>, <code><a href="lme4.html#topic+lmer">lmer</a></code>,
<code><a href="lme4.html#topic+getME">getME</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Orthodont, package = "nlme")
models &lt;- list(
    model1 &lt;- lmer(formula = distance ~ age + Sex + (1 | Subject) + age:Sex,
               data = Orthodont),
    model2 &lt;- lmer(formula = distance ~ age + Sex + (1 | Subject),
               data = Orthodont),
    model3 &lt;- lmer(formula = distance ~ age + (1 | Subject),
                 data = Orthodont),
    model4 &lt;- lmer(formula = distance ~ Sex + (1 | Subject),
                data = Orthodont))

foo &lt;- getWeights(models = models)
foo


</code></pre>

<hr>
<h2 id='guWahbaData'>Data from Gu and Wahba (1991)</h2><span id='topic+guWahbaData'></span>

<h3>Description</h3>

<p>Data from Gu and Wahba (1991) which is used for demonstrative purposes to exemplarily fit 
a generalized additive mixed model.
</p>


<h3>References</h3>

<p>Gu and Wahba (1991) Minimizing GCV/GML scores with multiple smoothing parameters 
via the Newton method. SIAM J. Sci. Statist. Comput. 12:383-398
</p>

<hr>
<h2 id='modelAvg'>Model Averaging for Linear Mixed Models</h2><span id='topic+modelAvg'></span>

<h3>Description</h3>

<p>Function to perform model averaging for linear mixed models based
on the weight selection criterion as proposed by Zhang et al. (2014).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>modelAvg(models, opt = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="modelAvg_+3A_models">models</code></td>
<td>
<p>A list object containing all considered candidate models fitted by
<code><a href="lme4.html#topic+lmer">lmer</a></code> of the lme4-package or of class
<code><a href="nlme.html#topic+lme">lme</a></code>.</p>
</td></tr>
<tr><td><code id="modelAvg_+3A_opt">opt</code></td>
<td>
<p>logical. If TRUE (the default) the model averaging approach based 
on Zhang et al. is applied. If FALSE the underlying weights are calculated 
as smoothed weights as proposed by Buckland et al. (1997).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object containing the function calls of the underlying candidate models,
the values of the model averaged fixed effects, the values of the model averaged random effects,
the results of the weight optimization process, as well as a list of the candidate models themselves.
</p>


<h3>Author(s)</h3>

<p>Benjamin Saefken &amp; Rene-Marcel Kruse
</p>


<h3>References</h3>

<p>Greven, S. and Kneib T. (2010) On the behaviour of marginal and
conditional AIC in linear mixed models. Biometrika 97(4), 773-789.
</p>
<p>Zhang, X., Zou, G., &amp; Liang, H. (2014). Model averaging and
weight choice in linear mixed-effects models. Biometrika, 101(1), 205-218.
</p>


<h3>See Also</h3>

<p><code><a href="lme4.html#topic+lme4-package">lme4-package</a></code>, <code><a href="lme4.html#topic+lmer">lmer</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Orthodont, package = "nlme")
models &lt;- list(
    model1 &lt;- lmer(formula = distance ~ age + Sex + (1 | Subject) + age:Sex,
               data = Orthodont),
    model2 &lt;- lmer(formula = distance ~ age + Sex + (1 | Subject),
               data = Orthodont),
    model3 &lt;- lmer(formula = distance ~ age + (1 | Subject),
                 data = Orthodont),
    model4 &lt;- lmer(formula = distance ~ Sex + (1 | Subject),
                data = Orthodont))
foo &lt;- modelAvg(models = models)
foo


</code></pre>

<hr>
<h2 id='predictMA'>Prediction of model averaged linear mixed models</h2><span id='topic+predictMA'></span>

<h3>Description</h3>

<p>Function to perform prediction for model averaged linear mixed models based
on the weight selection criterion as proposed by Zhang et al.(2014)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predictMA(object, new.data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predictMA_+3A_object">object</code></td>
<td>
<p>A object created by the model averaging function.</p>
</td></tr>
<tr><td><code id="predictMA_+3A_new.data">new.data</code></td>
<td>
<p>Object that contains the data on which the prediction 
is to be based on.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object that contains predictions calculated based on the given 
dataset and the assumed underlying model average.
</p>


<h3>Author(s)</h3>

<p>Benjamin Saefken &amp; Rene-Marcel Kruse
</p>


<h3>References</h3>

<p>Greven, S. and Kneib T. (2010) On the behaviour of marginal and
conditional AIC in linear mixed models. Biometrika 97(4), 773-789.
</p>


<h3>See Also</h3>

<p><code><a href="lme4.html#topic+lme4-package">lme4-package</a></code>, <code><a href="lme4.html#topic+lmer">lmer</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Orthodont, package = "nlme")
models &lt;- list(
    model1 &lt;- lmer(formula = distance ~ age + Sex + (1 | Subject) + age:Sex,
               data = Orthodont),
    model2 &lt;- lmer(formula = distance ~ age + Sex + (1 | Subject),
               data = Orthodont),
    model3 &lt;- lmer(formula = distance ~ age + (1 | Subject),
                 data = Orthodont),
    model4 &lt;- lmer(formula = distance ~ Sex + (1 | Subject),
                data = Orthodont))
foo &lt;- modelAvg(models = models)
predictMA(foo, new.data = Orthodont)


</code></pre>

<hr>
<h2 id='print.cAIC'>Print method for cAIC</h2><span id='topic+print.cAIC'></span>

<h3>Description</h3>

<p>Print method for cAIC
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'cAIC'
print(x, ..., digits = 2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.cAIC_+3A_x">x</code></td>
<td>
<p>a cAIC object</p>
</td></tr>
<tr><td><code id="print.cAIC_+3A_...">...</code></td>
<td>
<p>further arguments passed to 
generic print function (not in use).</p>
</td></tr>
<tr><td><code id="print.cAIC_+3A_digits">digits</code></td>
<td>
<p>number of digits to print</p>
</td></tr>
</table>

<hr>
<h2 id='stepcAIC'>Function to stepwise select the (generalized) linear mixed model
fitted via (g)lmer() or (generalized) additive (mixed) model
fitted via gamm4() with the smallest cAIC.</h2><span id='topic+stepcAIC'></span>

<h3>Description</h3>

<p>The step function searches the space of possible models in a greedy manner,
where the direction of the search is specified by the argument
direction. If direction = &quot;forward&quot; / = &quot;backward&quot;, 
the function adds / exludes random effects until the cAIC can't be improved further.
In the case of forward-selection, either a new grouping structure, new
slopes for the random effects or new covariates modeled nonparameterically 
must be supplied to the function call.
If direction = &quot;both&quot;, the greedy search is alternating between forward
and backward steps, where the direction is changed after each step
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stepcAIC(
  object,
  numberOfSavedModels = 1,
  groupCandidates = NULL,
  slopeCandidates = NULL,
  fixEfCandidates = NULL,
  numberOfPermissibleSlopes = 2,
  allowUseAcross = FALSE,
  allowCorrelationSel = FALSE,
  allowNoIntercept = FALSE,
  direction = "backward",
  trace = FALSE,
  steps = 50,
  keep = NULL,
  numCores = 1,
  data = NULL,
  returnResult = TRUE,
  calcNonOptimMod = TRUE,
  bsType = "tp",
  digits = 2,
  printValues = "caic",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="stepcAIC_+3A_object">object</code></td>
<td>
<p>object returned by <code>[lme4]{lmer}</code>, <code>[lme4]{glmer}</code> or 
<code>[gamm4]{gamm4}</code></p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_numberofsavedmodels">numberOfSavedModels</code></td>
<td>
<p>integer defining how many additional models to be saved
during the step procedure. If <code>1</code> (DEFAULT), only the best model is returned. 
Any number <code>k</code> greater <code>1</code> will return the <code>k</code> best models. 
If <code>0</code>, all models will be returned (not recommended for larger applications).</p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_groupcandidates">groupCandidates</code></td>
<td>
<p>character vector containing names of possible grouping variables for 
new random effects. Group nesting must be specified manually, i.e. by 
listing up the string of the groups in the manner of lme4. For example 
<code>groupCandidates = c("a", "b", "a/b")</code>.</p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_slopecandidates">slopeCandidates</code></td>
<td>
<p>character vector containing names of possible new random effects</p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_fixefcandidates">fixEfCandidates</code></td>
<td>
<p>character vector containing names of possible (non-)linear fixed effects 
in the GAMM; NULL for the (g)lmer-use case</p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_numberofpermissibleslopes">numberOfPermissibleSlopes</code></td>
<td>
<p>how much slopes are permissible for one grouping variable</p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_allowuseacross">allowUseAcross</code></td>
<td>
<p>allow slopes to be used in other grouping variables</p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_allowcorrelationsel">allowCorrelationSel</code></td>
<td>
<p>logical; FALSE does not allow correlations of random effects 
to be (de-)selected (default)</p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_allownointercept">allowNoIntercept</code></td>
<td>
<p>logical; FALSE does not allow random effects without random intercept</p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_direction">direction</code></td>
<td>
<p>character vector indicating the direction (&quot;both&quot;,&quot;backward&quot;,&quot;forward&quot;)</p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_trace">trace</code></td>
<td>
<p>logical; should information be printed during the execution of stepcAIC?</p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_steps">steps</code></td>
<td>
<p>maximum number of steps to be considered</p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_keep">keep</code></td>
<td>
<p>list($fixed,$random) of formulae; which splines / fixed (fixed) or 
random effects (random) to be kept during selection; specified terms must be 
included in the original model</p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_numcores">numCores</code></td>
<td>
<p>the number of cores to be used in calculations; 
parallelization is done by using <code>parallel::mclapply</code></p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_data">data</code></td>
<td>
<p>data.frame supplying the data used in <code>object</code>. <code>data</code> must also include 
variables, which are considered for forward updates.</p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_returnresult">returnResult</code></td>
<td>
<p>logical; whether to return the result (best model and corresponding cAIC)</p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_calcnonoptimmod">calcNonOptimMod</code></td>
<td>
<p>logical; if FALSE, models which failed to converge are not considered 
for cAIC calculation</p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_bstype">bsType</code></td>
<td>
<p>type of splines to be used in forward gamm4 steps</p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_digits">digits</code></td>
<td>
<p>number of digits used in printing the results</p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_printvalues">printValues</code></td>
<td>
<p>what values of <code>c("cll", "df", "caic", "refit")</code> 
to print in the table of comparisons</p>
</td></tr>
<tr><td><code id="stepcAIC_+3A_...">...</code></td>
<td>
<p>further options for cAIC call</p>
</td></tr>
</table>


<h3>Value</h3>

<p>if <code>returnResult</code> is <code>TRUE</code>, a list with the best model <code>finalModel</code>,
<code>additionalModels</code> if <code>numberOfSavedModels</code> was specified and
the corresponding cAIC <code>bestCAIC</code> is returned. 
</p>
<p>Note that if <code>trace</code> is set to <code>FALSE</code> and <code>returnResult</code>
is also <code>FALSE</code>, the function call may not be meaningful
</p>


<h3>Details</h3>

<p>Note that the method can not handle mixed models with uncorrelated random effects and does NOT
reduce models to such, i.e., the model with <code>(1 + s | g)</code> is either reduced to
<code>(1 | g)</code> or <code>(0 + s | g)</code> but not to <code>(1 + s || g)</code>.
</p>


<h3>Author(s)</h3>

<p>David Ruegamer
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
(fm3 &lt;- lmer(strength ~ 1 + (1|sample) + (1|batch), Pastes))

fm3_step &lt;- stepcAIC(fm3, direction = "backward", trace = TRUE, data = Pastes)

fm3_min &lt;- lm(strength ~ 1, data=Pastes)

fm3_min_step &lt;- stepcAIC(fm3_min, groupCandidates = c("batch", "sample"), 
direction="forward", data=Pastes, trace=TRUE)
fm3_min_step &lt;- stepcAIC(fm3_min, groupCandidates = c("batch", "sample"), 
direction="both", data=Pastes, trace=TRUE)
# try using a nested group effect which is actually not nested -&gt; warning
fm3_min_step &lt;- stepcAIC(fm3_min, groupCandidates = c("batch", "sample", "batch/sample"), 
                         direction="both", data=Pastes, trace=TRUE)

Pastes$time &lt;- 1:dim(Pastes)[1]
fm3_slope &lt;- lmer(data=Pastes, strength ~ 1 + (1 + time | cask))

fm3_slope_step &lt;- stepcAIC(fm3_slope,direction="backward", trace=TRUE, data=Pastes)



fm3_min &lt;- lm(strength ~ 1, data=Pastes)

fm3_min_step &lt;- stepcAIC(fm3_min,groupCandidates=c("batch","sample"),
direction="forward", data=Pastes,trace=TRUE)



fm3_inta &lt;- lmer(strength ~ 1 + (1|sample:batch), data=Pastes)

fm3_inta_step &lt;- stepcAIC(fm3_inta,groupCandidates=c("batch","sample"),
direction="forward", data=Pastes,trace=TRUE)

fm3_min_step2 &lt;- stepcAIC(fm3_min,groupCandidates=c("cask","batch","sample"),
direction="forward", data=Pastes,trace=TRUE)

fm3_min_step3 &lt;- stepcAIC(fm3_min,groupCandidates=c("cask","batch","sample"),
direction="both", data=Pastes,trace=TRUE)

## Not run: 
fm3_inta_step2 &lt;- stepcAIC(fm3_inta,direction="backward", 
data=Pastes,trace=TRUE)

## End(Not run)

##### create own example


na &lt;- 20
nb &lt;- 25
n &lt;- 400
a &lt;- sample(1:na,400,replace=TRUE)
b &lt;- factor(sample(1:nb,400,replace=TRUE))
x &lt;- runif(n)
y &lt;- 2 + 3 * x + a*.02 + rnorm(n) * .4
a &lt;- factor(a)
c &lt;- interaction(a,b)
y &lt;- y + as.numeric(as.character(c))*5
df &lt;- data.frame(y=y,x=x,a=a,b=b,c=c)

smallMod &lt;- lm(y ~ x)

## Not run: 
# throw error
stepcAIC(smallMod, groupCandidates=c("a","b","c"), data=df, trace=TRUE, returnResult=FALSE)

smallMod &lt;- lm(y ~ x, data=df)

# throw error
stepcAIC(smallMod, groupCandidates=c("a","b","c"), data=df, trace=TRUE, returnResult=FALSE)

# get it all right
mod &lt;- stepcAIC(smallMod, groupCandidates=c("a","b","c"), 
                data=df, trace=TRUE, 
                direction="forward", returnResult=TRUE)

# make some more steps...
stepcAIC(smallMod, groupCandidates=c("a","b","c"), data=df, trace=TRUE, 
         direction="both", returnResult=FALSE)

mod1 &lt;- lmer(y ~ x + (1|a), data=df)

stepcAIC(mod1, groupCandidates=c("b","c"), data=df, trace=TRUE, direction="forward")
stepcAIC(mod1, groupCandidates=c("b","c"), data=df, trace=TRUE, direction="both")



mod2 &lt;- lmer(y ~ x + (1|a) + (1|c), data=df)

stepcAIC(mod2, data=df, trace=TRUE, direction="backward")

mod3 &lt;- lmer(y ~ x + (1|a) + (1|a:b), data=df)

stepcAIC(mod3, data=df, trace=TRUE, direction="backward")


## End(Not run)

</code></pre>

<hr>
<h2 id='summaryMA'>Summary of model averaged linear mixed models</h2><span id='topic+summaryMA'></span>

<h3>Description</h3>

<p>summaryMA is a function used to produce result summaries of the model 
averaging approach.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>summaryMA(object, randeff = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summaryMA_+3A_object">object</code></td>
<td>
<p>A object created by the model averaging function.</p>
</td></tr>
<tr><td><code id="summaryMA_+3A_randeff">randeff</code></td>
<td>
<p>logical. Indicator whether the model averaged random effects should also be part of the output. The default setting is FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Outputs a summary of the model averaged random and fixed effects, as well as the calculated weights of the individual candidate models.
</p>


<h3>Author(s)</h3>

<p>Benjamin Saefken &amp; Rene-Marcel Kruse
</p>


<h3>References</h3>

<p>Greven, S. and Kneib T. (2010) On the behaviour of marginal and
conditional AIC in linear mixed models. Biometrika 97(4), 773-789.
</p>


<h3>See Also</h3>

<p><code><a href="lme4.html#topic+lme4-package">lme4-package</a></code>, <code><a href="lme4.html#topic+lmer">lmer</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Orthodont, package = "nlme")
models &lt;- list(
    model1 &lt;- lmer(formula = distance ~ age + Sex + (1 | Subject) + age:Sex,
               data = Orthodont),
    model2 &lt;- lmer(formula = distance ~ age + Sex + (1 | Subject),
               data = Orthodont),
    model3 &lt;- lmer(formula = distance ~ age + (1 | Subject),
                 data = Orthodont),
    model4 &lt;- lmer(formula = distance ~ Sex + (1 | Subject),
                data = Orthodont))
foo &lt;- modelAvg(models = models)
summaryMA(foo)


</code></pre>

<hr>
<h2 id='Zambia'>Subset of the Zambia data set on childhood malnutrition</h2><span id='topic+Zambia'></span>

<h3>Description</h3>

<p>Data analyzed by Kandala et al. (2001) which is used for demonstrative purposes to 
estimate linear mixed and additive models using a stepwise procedure on the basis of the cAIC. 
The full data set is 
available at <a href="https://www.uni-goettingen.de/de/551625.html">https://www.uni-goettingen.de/de/551625.html</a>.
</p>


<h3>References</h3>

<p>Kandala, N. B., Lang, S., Klasen, S., Fahrmeir, L. (2001): 
Semiparametric Analysis of the Socio-Demographic and Spatial 
Determinants of Undernutrition in Two African Countries. 
Research in Official Statistics, 1, 81-100.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
