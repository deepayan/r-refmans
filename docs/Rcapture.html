<!DOCTYPE html><html><head><title>Help for package Rcapture</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {Rcapture}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#Rcapture-package'><p> Loglinear Models for Capture-Recapture Experiments</p></a></li>
<li><a href='#BBS2001'>
<p>Species Richness Data from the North American Breeding Bird Survey (BBS) in 2001</p></a></li>
<li><a href='#bunting'><p>  Lazuli Bunting Data</p></a></li>
<li><a href='#cbird'>
<p>Catbird Site Occupancy Data</p></a></li>
<li><a href='#closedp'><p> Loglinear Models for Closed Population Capture-Recapture Experiments</p></a></li>
<li><a href='#closedp.bc'><p> Bias Correction for Closed Population Loglinear Models</p></a></li>
<li><a href='#closedp.custom'><p> Customization of a Loglinear Model for Closed Populations Capture-Recapture Experiments</p></a></li>
<li><a href='#closedp.Mtb'><p> Closed Population Capture-Recapture Model Mtb</p></a></li>
<li><a href='#closedpCI'><p> Customization of a Loglinear Model and Confidence Interval for Abundance</p>
Estimation in Closed Population Capture-Recapture Experiments</a></li>
<li><a href='#closedpMS'><p> Hierarchical Loglinear Model Selection in Closed Population Capture-Recapture Experiments</p></a></li>
<li><a href='#descriptive'><p> Descriptive Statistics</p></a></li>
<li><a href='#duck'><p>  Eider Duck Data</p></a></li>
<li><a href='#hare'><p>  Snowshoe Hare Data</p></a></li>
<li><a href='#histpos'><p> Possible Capture Histories</p></a></li>
<li><a href='#HIV'><p> Epidemiological capture-recapture Data on HIV</p></a></li>
<li><a href='#ill'>
<p>Illegal immigrants in the Netherlands</p></a></li>
<li><a href='#lesbian'><p> Epidemiological capture-recapture Data on the lesbian population</p></a></li>
<li><a href='#mvole'><p>  Robust Design Data for Adult Male Meadow Voles</p></a></li>
<li><a href='#openp'><p> Loglinear Models for Open Population Capture-Recapture Experiments</p></a></li>
<li><a href='#periodhist'><p>  Merge capture occasions</p></a></li>
<li><a href='#profileCI'><p> Profile Likelihood Confidence Interval for Abundance Estimation in Closed Populations Capture-Recapture Experiments</p></a></li>
<li><a href='#rbvole'><p> Robust Design Data for Red-Back Voles</p></a></li>
<li><a href='#robustd'><p> Loglinear Models for Capture-Recapture Experiments Carried Out According to a Robust Design</p></a></li>
<li><a href='#uifit'><p> Closed Population Models Fit Statistics Concerning the ui</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Loglinear Models for Capture-Recapture Experiments</td>
</tr>
<tr>
<td>Version:</td>
<td>1.4-4</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-05-03</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimation of abundance and other demographic parameters for closed 
             populations, open populations and the robust design in capture-recapture  
             experiments using loglinear models.   </td>
</tr>
<tr>
<td>Imports:</td>
<td>stats, graphics, utils</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-05-03 19:08:03 UTC; Sophie</td>
</tr>
<tr>
<td>Author:</td>
<td>Louis-Paul Rivest [aut, cre],
  Sophie Baillargeon [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Louis-Paul Rivest &lt;Louis-Paul.Rivest@mat.ulaval.ca&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-05-04 13:20:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='Rcapture-package'> Loglinear Models for Capture-Recapture Experiments </h2><span id='topic+Rcapture-package'></span><span id='topic+Rcapture'></span>

<h3>Description</h3>

<p>Estimation of abundance and of other demographic parameters for closed populations, open populations and the robust design in capture-recapture experiments using loglinear models.
</p>
<p>This package focuses on closed populations. Since version 1.2-0, no new features have been added to open populations and robust design functions.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> <span class="pkg">Rcapture</span></td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.4-4</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2022-05-03</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL-2</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>SUMMARY OF <span class="pkg">Rcapture</span> CONTENTS
</p>
<p>The <span class="pkg">Rcapture</span> package contains nine capture-recapture data sets and the following functions:
</p>

<ul>
<li><p> Model fitting functions for<br />
&gt; closed populations:
</p>

<ul>
<li> <p><code><a href="#topic+closedp">closedp</a></code> functions: fit various loglinear models for abundance estimation, 
</p>
</li>
<li> <p><code><a href="#topic+closedpCI">closedpCI</a></code> functions: fit one customized loglinear model and calculate a confidance interval for the abundance estimation,
</p>
</li>
<li> <p><code><a href="#topic+closedpMS.t">closedpMS.t</a></code>: fits various hierarchical loglinear models in a perspective of model selection, 
</p>
</li>
<li> <p><code><a href="#topic+closedp.bc">closedp.bc</a></code>: performs bias corrections to the abundance estimations from customized loglinear models,
</p>
</li>
<li> <p><code><a href="#topic+closedp.Mtb">closedp.Mtb</a></code>: fits model Mtb, which cannot be fitted by any other function, for abundance estimation;
</p>
</li></ul>

<p>&gt; open populations:
</p>

<ul>
<li> <p><code><a href="#topic+openp">openp</a></code>: computes various demographic parameters using a loglinear model;
</p>
</li></ul>

<p>&gt; robust design: 
</p>

<ul>
<li> <p><code><a href="#topic+robustd">robustd</a></code> functions: compute various demographic parameters and capture probabilities per period using a loglinear model.
</p>
</li></ul>

</li>
<li><p> Descriptive statistics functions: 
</p>

<ul>
<li> <p><code><a href="#topic+descriptive">descriptive</a></code>: produces basic descriptive statistics for capture-recapture data;
</p>
</li>
<li> <p><code><a href="#topic+uifit">uifit</a></code>: produces fit statistics concerning the <code class="reqn">u_i</code>, i.e. the numbers of first captures on each capture occasion, for closed population models.
</p>
</li></ul>

</li>
<li><p> Data manipulation functions: 
</p>

<ul>
<li> <p><code><a href="#topic+histpos">histpos</a></code> functions: builds a matrix of observable capture histories;
</p>
</li>
<li> <p><code><a href="#topic+periodhist">periodhist</a></code>: merges capture occasions.<br />
</p>
</li></ul>

</li></ul>

<p>DESCRIPTION OF DATA SET FORMATS
</p>
<p>In capture-recapture experiments, the data collected consist of capture histories for captured units. A capture history is simply a serie of capture indicators for each capture event in the experiment. The capture history of one unit is expressed as a length <code class="reqn">t</code> vector <code class="reqn">w = (w_1, \ldots, w_t)</code>, where <code class="reqn">w_j = 1</code> if the unit is captured at the jth occasion and 0 if not. For closed populations, capture events are named capture occasions, whereas they are named capture periods for open populations.
</p>
<p>Capture-recapture data sets are given to <span class="pkg">Rcapture</span> functions through the <code>X</code> argument. <code>X</code> must be a numeric matrix. Arguments <code>dfreq</code> and <code>dtype</code> indicate the format of the matrix. Each have two possible values, meaning that four data set formats are possible with <span class="pkg">Rcapture</span>.<br />
</p>
<p>FORMAT 1 - CAPTURE HISTORY PER UNIT<br />
If <code>dfreq=FALSE</code> and <code>dtype="hist"</code> (the default), <code>X</code> has one row per unit captured in the experiment. Each row is an observed capture history. It must contain only zeros and ones; the number one indicates a capture. In this case, the number of columns in the table represents the number of capture occasions in the experiment (noted <code class="reqn">t</code>). Here is an example of a data set of this type for <code class="reqn">t=2</code>:<br />
1 1<br />
1 1<br />
1 0<br />
1 0<br />
1 0<br />
1 0<br />
0 1<br />
</p>
<p>FORMAT 2 - AGGREGATED CAPTURE HISTORIES<br />
If <code>dfreq=TRUE</code> and <code>dtype="hist"</code>, <code>X</code> contains one row per observed capture history followed by its frequency. In that case, <code>X</code> has <code class="reqn">t</code>+1 columns. As for format 1, the first <code class="reqn">t</code> columns of <code>X</code>, identifying the capture histories, must contain only zeros and ones. The number one indicates a capture. In this format, 
the example data set is represented by the following matrix:<br />
1 1 2<br />
1 0 4<br />
0 1 1<br />
If a possible capture history is not observed, it can appear in <code>X</code> with a frequency of zero, or it can simply be omitted.<br />
</p>
<p>FORMAT 3 - NUMBER OF CAPTURES PER UNIT<br />
If <code>dfreq=FALSE</code> and <code>dtype="nbcap"</code>, <code>X</code> is a vector with the number of captures for every captured unit. Therefore, this format does not contain complete capture histories. Instead, capture histories are summarized through the number of captures. In this format, the example data set looks like:<br />
2 2 1 1 1 1 1<br />
</p>
<p>FORMAT 4 - AGGREGATED NUMBERS OF CAPTURES<br />
If <code>dfreq=TRUE</code> and <code>dtype="nbcap"</code>, <code>X</code> is a 2 columns matrix. The first column contains the observed numbers of captures, the second columns contains their frequencies. 
In this format, the example data is:<br />
2 2<br />
1 5<br />
</p>
<p>DETAILS ABOUT FORMATS WITH NUMBERS OF CAPTURES
</p>
<p>Only few functions have the <code>dtype</code> argument. Functions without <code>dtype</code> argument accept only a data matrix <code>X</code> of the form <code>dtype="hist"</code>. So the first two formats listed above are the most common.
</p>
<p>Formats with <code>dtype="nbcap"</code> are used for captures in continuous time (see below). They are also useful to reduce the size of the data set for experiments with a large number of capture occasions <code class="reqn">t</code> (often with no units caught a large number of times). For theses formats, the number of capture occasions <code class="reqn">t</code> cannot be deduced from <code>X</code> as it can be with <code>dtype="hist"</code>. One has no garanties that the larger number of captures observed is the total number of capture occasions. Therefore, if one gives a data matrix <code>X</code> with <code>dtype="nbcap"</code>, one must also provide <code>t</code>, the number of capture occasions, as an additional argument.  
</p>
<p>For now, the data formats with <code>dtype="nbcap"</code> are not generalized to the robust design. So <code>dtype</code> is not an argument of the <code>robustd.0</code> function.<br />
</p>
<p>CAPTURES IN CONTINUOUS TIME
</p>
<p>In some capture-recapture experiments, there is no well defined capture occasions. 
Captures occur in continuous time. The data set <code><a href="#topic+ill">ill</a></code> comes from
such an experiment. Bohning and Schon (2005) call this type of capture-recapture 
data <em>repeated counting data</em>. These data sets always have the format <code>dtype="nbcap"</code>. 
</p>
<p>We can estimate abundance for data of this type using the option <code>t=Inf</code> with the
functions <code><a href="#topic+closedpCI.0">closedpCI.0</a></code> and <code><a href="#topic+closedpCI.0">closedpCI.0</a></code>. The function 
<code><a href="#topic+descriptive">descriptive</a></code> also accepts <code>t=Inf</code>. It modifies the y coordinate
of the exploratory heterogeneity graph.<br />
</p>
<p>DISTINCTION BETWEEN <code>.t</code> and <code>.0</code> FUNCTIONS
</p>
<p>Capture recapture models for closed population aim at estimating the population size by modelling the probabilities of the different capture histories. The data available to fit these models consist of observed frequencies of capture histories. These frequencies are modeled in Rcapture using loglinear models for frequency tables. For functions with a name ending with <code>.t</code> (<code><a href="#topic+closedp.t">closedp.t</a></code>, <code><a href="#topic+closedpCI.t">closedpCI.t</a></code>, <code><a href="#topic+closedpMS.t">closedpMS.t</a></code> and <code><a href="#topic+robustd.t">robustd.t</a></code>), the observed values of the response variable is the vector of frequencies for every observable capture history. It has length <code class="reqn">2^t-1</code>.
</p>
<p>However, for a model without temporal effect (assuming that the probability of capturing a unit does not vary between capture occasions), all the information needed to fit the model can be found in aggregated data. Functions with a name ending with <code>.0</code> (<code><a href="#topic+closedp.0">closedp.0</a></code>, <code><a href="#topic+closedpCI.0">closedpCI.0</a></code> and <code><a href="#topic+robustd.0">robustd.0</a></code>) fit models using as response variable the number of units captured <code class="reqn">i</code> times, for <code class="reqn">i=1,\ldots,t</code>. It is a vector of length <code class="reqn">t</code>, which is much shorter than <code class="reqn">2^t-1</code> for a large <code class="reqn">t</code>. Because of an appropriate offset added to the model, the results from a <code>.0</code> function match exaclty the results from a <code>.t</code> function for a corresponding capture-recapture model. Because <code>.0</code> functions deal with smaller design matrix, they run faster than <code>.t</code> functions, but they cannot fit models with a temporal effect. <br />
</p>
<p>FUNCTIONS USED FOR MODEL FITTING
</p>
<p>Most of the <span class="pkg">Rcapture</span> functions use the function <code><a href="stats.html#topic+glm">glm</a></code> of the <span class="pkg">stats</span> package to fit a loglinear model. However, the function <code><a href="stats.html#topic+optim">optim</a></code>, again of the <span class="pkg">stats</span>, is also used by three functions:
</p>

<ul>
<li> <p><code><a href="#topic+closedpCI.t">closedpCI.t</a></code>, <code><a href="#topic+closedpCI.0">closedpCI.0</a></code> and <code><a href="#topic+closedpMS.t">closedpMS.t</a></code>: when a normal heterogeneous models is requested,
</p>
</li>
<li> <p><code><a href="#topic+closedp.Mtb">closedp.Mtb</a></code>: because model Mtb does not have a loglinear form.<br /> 
</p>
</li></ul>

<p>ERRORS AND WARNINGS MANAGEMENT IN CLOSED POPULATION FUNCTIONS
</p>
<p>If an error occurs while executing a function fitting only one closed population model (<code><a href="#topic+closedpCI">closedpCI</a></code> functions, <code><a href="#topic+closedp.bc">closedp.bc</a></code>, <code><a href="#topic+closedp.Mtb">closedp.Mtb</a></code>), the execution is stopped and the error message is printed (usual behavior in R). However, if an error occurs while fitting a model in a call to a closedp population function fitting more than one model (<code><a href="#topic+closedp">closedp</a></code> functions, <code><a href="#topic+closedpMS.t">closedpMS.t</a></code>), the execution of the call is not stopped. Instead, the row in the results table for the problematic model is filled with <code>NA</code> and the error message is stored in an output value. This value is called <code>glm.err</code> for <code><a href="#topic+closedp">closedp</a></code> functions. It is however called <code>fit.err</code> for <code><a href="#topic+closedpMS.t">closedpMS.t</a></code> because this function do not always use <code><a href="stats.html#topic+glm">glm</a></code> to fit the model (as mentionned above, <code><a href="stats.html#topic+optim">optim</a></code> is used for normal heterogeneous models).
</p>
<p>Warning messages while fitting a closed population model, if any, are stored in an output value called 'glm.warn', 'fit.warn' or 'optim.warn' depending on the function. They are not printed in the console. To inform the user that a warning occured, the last column of the results table, named <code>infoFit</code>, contains a numerical code giving information about errors or warnings encountered. Here is a description of the meaning of the numerical code:
</p>

<dl>
<dt>   0</dt><dd><p>  no error or warning occured while fitting the model;</p>
</dd>
<dt>  -1</dt><dd><p>  an error occured while fitting the model;</p>
</dd>
<dt>   1</dt><dd><p>  a warning indicating that the model fit is questionnable occured (algorithm did not converge, non-positive sigma estimate for a normal heterogeneous model or large asymptotic bias);</p>
</dd> 
<dt>   2</dt><dd><p>  the warning 'design matrix not of full rank' occured, therefore some model's coefficients are not estimable;</p>
</dd>
<dt>   3</dt><dd><p>  a warning not of type 1 or 2 occured (the <code><a href="stats.html#topic+glm">glm</a></code> warning 'fitted rates nummerically 0 occured' is often encountered with small frequencies, it does not always mean that the model fit is questionnable).</p>
</dd>
</dl>

<p>The elements in the column <code>infoFit</code> can contain more than one number since more than one warning can occur. For exemple, if <code>infoFit</code> takes the value <code>13</code> for a model, it means that at least one warning of type 1 and one warning of type 3 have occured. If more than one warning of the same type are encountered, the number representing the type of warning is not repeated in <code>infoFit</code>. 
</p>


<h3>Author(s)</h3>

<p> Louis-Paul Rivest <a href="mailto:Louis-Paul.Rivest@mat.ulaval.ca">Louis-Paul.Rivest@mat.ulaval.ca</a> and Sophie Baillargeon </p>


<h3>References</h3>

<p>Baillargeon, S. and Rivest, L.P. (2007) Rcapture: Loglinear models for capture-recapture in R.  <em>Journal of Statistical Software</em>, <b>19</b>(5), <a href="https://doi.org/10.18637/jss.v019.i05">doi:10.18637/jss.v019.i05</a>.
</p>
<p>Bohning, D. and Schon, D. (2005) Nonparametric Maximum Likelihood Estimation of Population Size Based on the Counting Distribution. <em>Journal of the Royal Statistical Society: Series C (Applied Statistics)</em>, <b>54</b>(4), 721-737.
</p>
<p>Chao, A. (1987) Estimating the population size for capture-recapture data with unequal catchability. <em>Biometrics</em>, <b>43</b>(4), 783&ndash;791.
</p>
<p>Cormack, R. M. (1985) Example of the use of glim to analyze capture-recapture studies. In <em>Lecture Notes in Statistics 29: Statistics in Ornithology</em>, Morgan, B. et North, P. editors, New York,: Springer-Verlag, 242&ndash;274.
</p>
<p>Cormack, R. M. (1989) Loglinear models for capture-recapture. <em>Biometrics</em>, <b>45</b>, 395&ndash;413.
</p>
<p>Cormack, R. M. (1992) Interval estimation for mark-recapture studies of closed populations. <em>Biometrics</em>, <b>48</b>, 567&ndash;576.
</p>
<p>Cormack, R. M. (1993) Variances of mark-recapture estimates. <em>Biometrics</em>, <b>49</b>, 1188&ndash;1193.
</p>
<p>Cormack, R. M. and Jupp, P. E. (1991) Inference for Poisson and multinomial models for capture-recapture experiments. <em>Biometrika</em>, <b>78</b>(4), 911&ndash;916.
</p>
<p>Rivest, L.P. and Levesque, T. (2001) Improved loglinear model estimators of abundance in capture-recapture experiments. <em>Canadian Journal of Statistics</em>, <b>29</b>, 555&ndash;572.
</p>
<p>Rivest, L.P. and Daigle, G. (2004) Loglinear models for the robust design in mark-recapture experiments. <em>Biometrics</em>, <b>60</b>, 100&ndash;107.
</p>
<p>Rivest, L.P. and Baillargeon, S. (2007) Applications and extensions of Chao's moment estimator for the size of a closed population. <em>Biometrics</em>, <b>63</b>(4), 999&ndash;1006.
</p>
<p>Rivest, L.P. (2008) Why a time effect often has a limited impact on capture-recapture estimates in closed populations. <em>Canadian Journal of Statistics</em>, <b>36</b>(1), 75&ndash;84. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Here is an example on the lesbian data set.

desc &lt;- descriptive(lesbian, dfreq = TRUE)
desc
plot(desc)

# 1612 out of 2185 individuals (74%) appear on one list only.
# The exploratory heterogeneity graph are not quite linear.
# Some heterogeneity in the units capture probabilities
# seem present in the data set.

closedp(lesbian, dfreq = TRUE)

# According to the BIC, the best model is Mth Darroch.
# Let's see if adding  interactions between capture 
# histories to the model could improve the model's fit.

closedpMS.t(lesbian, dfreq = TRUE, h = "Darroch")

# According to the BIC, the best heterogeneous Darroch model
# contains the double interactions 12, 13, 14. 
# Here is the profile likelihood confidence interval for the
# abundance estimation from this model.

closedpCI.t(lesbian, dfreq = TRUE, mX = "[12,13,14]", h = "Darroch")


####################################################

# Example to illustrate warnings management in closed population functions.

# Here is a capture-recapture data set one could encounter.

crdata &lt;- cbind(histpos.t(4), c(0,0,3,0,0,0,0,0,0,0,0,1,0,0,2))

# This data set contains 4 capture occasions but only 6 captured units.
# Fitting capture-recapture models on this data set is quite useless.
# The population size should be very close to the sample size.

# Such small frequencies in a capture-recapture data set should
# lead to warnings when fitting a loglinear model on it.

ex &lt;- closedp.t(crdata, dfreq=TRUE)
ex

# Many models produce warnings of type 1 indicating that the model fit 
# is questionnable. The very large abundance estimation for some models 
# are another indicator of questionable model fits.
# Details about the warnings are found in the glm.warn element of the output.

ex$glm.warn
</code></pre>

<hr>
<h2 id='BBS2001'>
Species Richness Data from the North American Breeding Bird Survey (BBS) in 2001
</h2><span id='topic+BBS2001'></span>

<h3>Description</h3>

<p>This data set contains species richness data from the North American Breeding Bird Survey (BBS) in 2001. 
The number of capture occasions <code class="reqn">t</code> is 50.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BBS2001</code></pre>


<h3>Format</h3>

<p>36 by 2 numeric matrix, with the following columns:
</p>

<dl>
<dt><code>nbcap</code></dt><dd><p> Numbers of captures</p>
</dd>
<dt><code>freq</code></dt><dd><p> Observed frequencies for each number of captures</p>
</dd>
</dl>



<h3>Details</h3>

<p>This data set is presented in Dorazio and Royle (2003). It comes from the North American Breeding Bird Survey (BBS). 
This survey includes more than 4000 39.4 km survey routes throughout North America. Along each survey route an observer 
stops at 50 equidistant locations and records the species identity and number of all birds heard or seen within a 3-minute period. 
</p>
<p>The data in <code>BBS2001</code> was collected along Route 123, in Maryland, in 2001. In this data set a capture occasion is in 
fact a location and the frequencies represent the number of species detected at <code class="reqn">i</code> locations out of the 50 locations 
on that route. The frequencies for <code class="reqn">i=37,\ldots,50</code> are null and do not appear in the data set. 
</p>


<h3>Source</h3>

<p>Dorazio, R. M. and Royle, A. J. (2003) Mixture models for estimating the size of a closed population when capture rates vary among individuals. <em>Biometrics</em>, <b>59</b>, 351&ndash;364
</p>


<h3>Examples</h3>

<pre><code class='language-R'>desc &lt;- descriptive(BBS2001, dfreq = TRUE, dtype = "nbcap", t = 50)
plot(desc)
   # Note in this plot the convex shape typical of model Mh.

cp &lt;- closedp.0(BBS2001, dfreq = TRUE, dtype = "nbcap", t = 50, t0 = 20)
cp
plot(cp)
   # The Gamma estimator has the smallest deviance and all 
   # its residuals are small.
   
   # Let's calculate a profile confidence interval for the gamma 
   # estimator:
closedpCI.0(BBS2001, dfreq = TRUE, dtype = "nbcap", t = 50, t0 = 20,
            m = "Mh", h = "Gamma", h.control = list(theta = 3.5))		

   # One can also calculate a profile confidence interval for Chao's 
   # lower bound:
closedpCI.0(BBS2001, dfreq = TRUE, dtype = "nbcap", t = 50, t0 = 20,
            m = "Mh", h = "Chao")   
</code></pre>

<hr>
<h2 id='bunting'>  Lazuli Bunting Data </h2><span id='topic+bunting'></span>

<h3>Description</h3>

<p>This data set contains frequencies of capture histories for 8 years of observation of lazuli buntings. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bunting</code></pre>


<h3>Format</h3>

<p>255 by 9 numeric matrix, with the following columns:
</p>

<dl>
<dt><code>p1</code>, <code>p2</code>, <code>p3</code>, <code>p4</code>, <code>p5</code>, <code>p6</code>, <code>p7</code>, <code>p8</code></dt><dd><p> Capture histories from eight periods</p>
</dd>
<dt><code>freq</code></dt><dd><p> Observed frequencies for each capture history</p>
</dd>
</dl>



<h3>Details</h3>

<p>The data come from an eight-year (1973 to 1980) study by Allen W. Stokes of lazuli buntings wintering in Logan, Utah. 
This data set is analyzed in Burnham and al. (1987) and in Cormack (1993).
</p>
<p>Each row of this data set represents an observed capture history followed by its frequency. 
</p>


<h3>References</h3>

<p>Baillargeon, S. and Rivest, L.P. (2007) Rcapture: Loglinear models for capture-recapture in R.  <em>Journal of Statistical Software</em>, <b>19</b>(5), <a href="https://doi.org/10.18637/jss.v019.i05">doi:10.18637/jss.v019.i05</a>.
</p>
<p>Burnham, K.P., Anderson, D.R., White, G.C., Brownie, C. and Pollock, K.H. (1987) Design and analysis methods for fish survival experiments based on release-recapture. <em>American Fisheries Society Monographs 5</em>. Bethesda, Maryland.
</p>
<p>Cormack, R. M. (1993) The flexibility of GLIM analyses of multiple recapture or resighting data. In J.D. Lebreton and P. North editors: <em>Marked Individuals in the Study of Bird Population</em>. Basel, Switzerland: Birkhauser Verlag, 39&ndash;49. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>descriptive(bunting, dfreq = TRUE)
  # 1430 birds among the 1681 birds seen (85%) were caught only once. 
  # This suggests the presence of transient birds at each capture occasion. 

op.m1 &lt;- openp(bunting, dfreq = TRUE)
op.m1$model.fit
plot(op.m1)
  # The residuals plot shows large residuals for the birds caught twice or
  # more while the residuals are small for birds caught once. The Jolly-Seber 
  # model does not fit well and the likely presence of transients might 
  # cause that. Let's remove the birds caught only once from the analysis.

keep2 &lt;- rowSums(histpos.t(8)) &gt; 1
op.m2&lt;- openp(bunting, dfreq = TRUE, keep = keep2)
op.m2$model.fit
  # The deviance drop of 94 for 6 degrees of freedom is highly significant.
plot(op.m2)
  # The residual plot still shows Pearson residuals larger than 4. We redo
  # the analysis without the transient birds and without the large residuals.

keep3p &lt;- residuals(op.m2$glm, type = "pearson") &lt; 4
num3 &lt;- ((1:255)[keep2])[keep3p]
keep3 &lt;- rep(FALSE, 255)
keep3[num3] &lt;- TRUE
op.m3 &lt;- openp(bunting, dfreq = TRUE, keep = keep3)
cbind(op.m2$survivals, op.m3$survivals)
  # These changes have little impact on the survival estimates. 

  # We now test the equality of the survival probabilities and estimate its 
  # common value phi. Least squares estimates of phi and its standard error:
siginv &lt;- solve(op.m2$cov[8:12, 8:12])
phi &lt;- t(rep(1, 5)) %*% siginv %*% op.m2$survivals[2:6, 1] / 
      (t(rep(1, 5)) %*% siginv %*% rep(1, 5))
se &lt;- 1 / sqrt(t(rep(1, 5)) %*% siginv %*% rep(1, 5))
cbind(estimate = phi, stderr = se)
  # The chi-square goodness of fit statistic for a constant survival 
  # and its pvalue are:
chisq4 &lt;- t(op.m2$survivals[2:6, 1] - as.vector(phi)) %*% siginv %*% 
          (op.m2$survivals[2:6, 1] - as.vector(phi))
cbind(chi2stat = chisq4, pvalue = 1 - pchisq(chisq4, df = 4))
  # The hypothesis of a constant survival is accepted.
</code></pre>

<hr>
<h2 id='cbird'>
Catbird Site Occupancy Data
</h2><span id='topic+cbird'></span>

<h3>Description</h3>

<p>This data set contains site occupancy data for catbirds. The number of capture occasions <code class="reqn">t</code> is 11.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cbird</code></pre>


<h3>Format</h3>

<p>6 by 2 numeric matrix, with the following columns:
</p>

<dl>
<dt><code>nbcap</code></dt><dd><p> Numbers of captures</p>
</dd>
<dt><code>freq</code></dt><dd><p> Observed frequencies for each number of captures</p>
</dd>
</dl>



<h3>Details</h3>

<p>This data set is presented in Royle (2006). It comes from an experiment in which 50 locations have been visited 11 times. 
The presence or absence of catbirds was noted at each visit. The experiment aims at estimating the number of locations (&lt;=50) 
at which catbirds are present. 
</p>
<p>In the data set <code>cbird</code>, the frequencies represent the number of locations at which cbirdirbs have been detected <code class="reqn">i</code> times, 
out of <code class="reqn">t=11</code> visits. The frequencies for <code class="reqn">i=7,\ldots,11</code> are null and do not appear in the data set. 
</p>


<h3>Source</h3>

<p>Royle, A. J. (2006) Site occupancy models with heterogeneous detection probabilities. <em>Biometrics</em>, <b>62</b>, 97&ndash;102 </p>


<h3>Examples</h3>

<pre><code class='language-R'>desc &lt;- descriptive(cbird, dfreq = TRUE, dtype = "nbcap", t = 11)
plot(desc)
   # The heterogeneity graph is mildly convex, mostly because of 
   # 2 sites where catbirds have been seen six times.

closedp.0(cbird, dfreq = TRUE, dtype = "nbcap", t = 11)
   # The residuals are OK. The occupancy rate (N/50) estimate 
   # varies between 40.6% for M0 and 49.4% for Mh Gamma.
   # One could also try fitting M0 removing the 2 unusual sites:
closedp.0(cbird, dfreq = TRUE, dtype = "nbcap", t = 11, t0 = 5)
   # M0 fits very well and the occupancy rate estimate is 42.6%.
</code></pre>

<hr>
<h2 id='closedp'> Loglinear Models for Closed Population Capture-Recapture Experiments </h2><span id='topic+closedp'></span><span id='topic+closedp.t'></span><span id='topic+closedp.0'></span><span id='topic+print.closedp'></span><span id='topic+boxplot.closedp'></span><span id='topic+plot.closedp'></span>

<h3>Description</h3>

<p>The functions <code>closedp.t</code> and <code>closedp.0</code> fit various loglinear models for closed populations in 
capture-recapture experiments. For back compatibility, <code>closedp.t</code> is also named <code>closedp</code>.
</p>
<p><code>closedp.t</code> fits more models than <code>closedp.0</code> but for data set with more than 20 capture occasions, the function might fail. However, <code>closedp.0</code> works with fairly large data sets (see <b>Details</b>).     
</p>


<h3>Usage</h3>

<pre><code class='language-R'>closedp(X, dfreq=FALSE, neg=TRUE, ...)
closedp.t(X, dfreq=FALSE, neg=TRUE, ...)

closedp.0(X, dfreq=FALSE, dtype=c("hist","nbcap"), t=NULL, t0=NULL, 
          neg=TRUE, ...)

## S3 method for class 'closedp'
print(x, ...)

## S3 method for class 'closedp'
boxplot(x, main="Boxplots of Pearson Residuals", ...)

## S3 method for class 'closedp'
plot(x, main="Residual plots for some heterogeneity models", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="closedp_+3A_x">X</code></td>
<td>
<p> The matrix of the observed capture histories (see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> 
for a description of the accepted formats).  </p>
</td></tr>
<tr><td><code id="closedp_+3A_dfreq">dfreq</code></td>
<td>
<p> A logical. By default <code>FALSE</code>, which means that <code>X</code> has one row per unit. 
If <code>TRUE</code>, it indicates that the matrix <code>X</code> contains frequencies in its last column.</p>
</td></tr>
<tr><td><code id="closedp_+3A_dtype">dtype</code></td>
<td>
<p> A characters string, either <code>"hist"</code> or <code>"nbcap"</code>, to specify the type of data. 
<code>"hist"</code>, the default, means that <code>X</code> contains complete observed capture histories. 
<code>"nbcap"</code> means that <code>X</code> contains numbers of captures (see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> 
for details on data formats). </p>
</td></tr>
<tr><td><code id="closedp_+3A_t">t</code></td>
<td>
<p> Requested only if <code>dtype="nbcap"</code>. A numeric specifying the total number of 
capture occasions in the experiment. For <code>closedp.0</code>, the value <code>t=Inf</code>
is accepted. It indicates that captures occur in continuous time 
(see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code>).</p>
</td></tr>
<tr><td><code id="closedp_+3A_t0">t0</code></td>
<td>
<p> A numeric. Models are fitted considering only the frequencies of units captured 1 to <code>t0</code> times. 
By default, if <code>t</code> is not equal to <code>Inf</code>, <code>t0=t</code>. When <code>t=Inf</code>, the default value
of <code>t0</code> is the larger number of captures observed. </p>
</td></tr>
<tr><td><code id="closedp_+3A_neg">neg</code></td>
<td>
<p> If this option is set to TRUE, negative eta parameters in Chao's lower 
bound models are set to zero (see <b>Details</b>). </p>
</td></tr>
<tr><td><code id="closedp_+3A_...">...</code></td>
<td>
<p> Further arguments to be passed to <code><a href="stats.html#topic+glm">glm</a></code>, <code><a href="base.html#topic+print.default">print.default</a></code>,
<code><a href="graphics.html#topic+boxplot.default">boxplot.default</a></code> or <code><a href="graphics.html#topic+plot.default">plot.default</a></code>.</p>
</td></tr>
<tr><td><code id="closedp_+3A_x">x</code></td>
<td>
<p> An object, produced by a <code>closedp</code> function, to print or to plot.</p>
</td></tr>
<tr><td><code id="closedp_+3A_main">main</code></td>
<td>
<p> A main title for the plot.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>closedp.t</code> fits models M0, Mt, Mh Chao (LB), Mh Poisson2, Mh Darroch, Mh Gamma3.5, 
Mth Chao (LB), Mth Poisson2, Mth Darroch, Mth Gamma3.5, Mb and Mbh. <code>closedp.0</code> fits 
only models M0, Mh Chao (LB), Mh Poisson2, Mh Darroch and Mh Gamma3.5. However, 
<code>closedp.0</code> can be used with larger data sets than <code>closedp.t</code>. 
This is explained by the fact that <code>closedp.t</code> fits models using the frequencies of 
the observable capture histories (vector of size <code class="reqn">2^t-1</code>), whereas <code>closedp.0</code> 
uses the numbers of units captured i times, for <code class="reqn">i=1,\ldots,t</code> (vector of size <code class="reqn">t</code>). 
See <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> for more details about the distinction between <code>.t</code>
and <code>.0</code> functions.
</p>
<p>Multinomial profile confidence intervals for the abundance are constructed by <code><a href="#topic+closedpCI.t">closedpCI.t</a></code> 
and <code><a href="#topic+closedpCI.0">closedpCI.0</a></code>.
</p>
<p>To calculate bias corrected abundance estimates, use the <code><a href="#topic+closedp.bc">closedp.bc</a></code> function.<br />
</p>
<p>CHAO'S LOWER BOUND MODEL
</p>
<p>Chao's (or LB) models estimate a lower bound for the abundance, both with a time 
effect (Mth Chao) and without one (Mh Chao). The estimate obtained under Mh Chao is Chao's (1987) 
moment estimator. Rivest and Baillargeon (2007) exhibit a loglinear model underlying this 
estimator and provide a generalization to Mth. For these two models, a small deviance means 
that there is an heterogeneity in capture probabilities; it does not mean that the lower 
bound estimate is unbiased. To test whether a certain model for heterogeneity is adequate,
one can conduct a likelihood ratio test by subtracting the deviance of Chao's model
to the deviance of the heterogeneous model under study. If this heterogeneous model
includes a time effect, it must be compared to model Mth Chao. If it does not include a time
effect, it must be compared to model Mh Chao. 
Under the null hypothesis of equivalence between the two models, the difference of deviances 
follows a chi-square distribution with degrees of freedom equal to the difference between 
the models' degrees of freedom.
</p>
<p>Chao's lower bound models contain <code class="reqn">t-2</code> parameters, called
eta parameters, for the heterogeneity. These parameters should theoretically be greater 
or equal to zero (see Rivest and Baillargeon (2007)). When the argument <code>neg</code> is set 
to <code>TRUE</code> (the default), negative eta parameters are set to zero (to do so, columns are
removed from the design matrix of the model). Degrees of freedom of Chao's model increase 
when eta parameters are set to zero.<br />
</p>
<p>OTHER MODELS FOR HETEROGENEITY
</p>
<p>Other models for heterogeneity are defined as follows :
</p>

<table>
<tr>
 <td style="text-align: left;">
  Model </td><td style="text-align: left;"> Column for heterogeneity in the design matrix </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Poisson2 </td><td style="text-align: left;"> <code class="reqn">2^k-1</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Darroch  </td><td style="text-align: left;"> <code class="reqn">k^2/2</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Gamma3.5 </td><td style="text-align: left;"> <code class="reqn">-\log(3.5 + k) + \log(3.5)</code>
  </td>
</tr>

</table>

<p>where <code class="reqn">k</code> is the number of captures. Poisson and Gamma models with alternative to the 
parameter defaults values 2 and 3.5 can be fitted with the <code><a href="#topic+closedpCI.t">closedpCI.t</a></code> and 
<code><a href="#topic+closedpCI.0">closedpCI.0</a></code> functions.
</p>
<p>Darroch's models for Mh and Mth are considered by Darroch et al. (1993) and Agresti (1994). 
Poisson and Gamma models are discussed in Rivest and Baillargeon (2007). Poisson models 
typically yield smaller corrections for heterogeneity than Darroch's model since the capture 
probabilities are bounded from below under these models. On the other hand, Gamma models 
can lead to very large estimators of abundance. We suggest considering this estimator only in 
experiments where very small capture probabilities are likely.<br />
</p>
<p>PLOT METHODS AND FUNCTIONS
</p>
<p>The <code>boxplot.closedp</code> function produces boxplots of the Pearson residuals of the fitted loglinear models that converged.
</p>
<p>The <code>plot.closedp</code> function produces scatterplots of the Pearson residuals in terms of <code class="reqn">f_i</code> 
(number of units captured i times) for the heterogeneous models Mh Poisson2, Mh Darroch and Mh Gamma3.5 if they converged.  
</p>


<h3>Value</h3>

<table>
<tr><td><code>n</code></td>
<td>
<p> The number of captured units.</p>
</td></tr>
<tr><td><code>t</code></td>
<td>
<p> The total number of capture occasions in the data matrix <code>X</code>.
When captures occur in continuous time (input argument <code>t=Inf</code>),
this output value is the larger number of captures observed.</p>
</td></tr>
<tr><td><code>t0</code></td>
<td>
<p> For <code>closedp.0</code> only: the value of the argument <code>t0</code> used in the computations.</p>
</td></tr>
<tr><td><code>results</code></td>
<td>
<p> A table containing, for every fitted model:
</p>

<dl>
<dt><code>abundance</code>:</dt><dd><p>  the estimated population size,</p>
</dd>
<dt><code>stderr</code>:</dt><dd><p>  the standard error of the estimated population size,</p>
</dd>
<dt><code>deviance</code>:</dt><dd><p>  the model's deviance,</p>
</dd>
<dt><code>df</code>:</dt><dd><p>  the number of degrees of freedom,</p>
</dd>
<dt><code>AIC</code>:</dt><dd><p>  the Akaike's information criterion,</p>
</dd>
<dt><code>BIC</code>:</dt><dd><p>  the bayesian information criterion,</p>
</dd>
<dt><code>infoFit</code>:</dt><dd><p>  a numerical code giving information about error or warnings 
encountered when fitting the model (see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> for details).</p>
</dd>
</dl>
</td></tr>
<tr><td><code>bias</code></td>
<td>
<p> A vector, the asymptotic bias of the estimated population size for every fitted model.</p>
</td></tr>
<tr><td><code>glm</code></td>
<td>
<p> A list of the 'glm' objects obtained from fitting models.</p>
</td></tr> 
<tr><td><code>glm.err</code></td>
<td>
<p> A list of character string vectors. If the <code><a href="stats.html#topic+glm">glm</a></code> function generates
an error when fitting a model, a copy of the error message is
stored in <code>glm.err$mname</code> where <code>mname</code> is a short name to identify
the model. A <code>NULL</code> list element means that no error occured for the considered model.</p>
</td></tr> 
<tr><td><code>glm.warn</code></td>
<td>
<p> A list of character string vectors. If the <code><a href="stats.html#topic+glm">glm</a></code> function generates
one or more warnings when fitting a model, a copy of these warnings are
stored in <code>glm.warn$mname</code> where <code>mname</code> is a short name to identify
the model. A <code>NULL</code> list element means that <code><a href="stats.html#topic+glm">glm</a></code> did not 
produce any warnings for the considered model. </p>
</td></tr>
<tr><td><code>parameters</code></td>
<td>
<p> Capture-recapture parameters estimates. It contains N, the estimated population size, 
and p or <code class="reqn">p_1</code> to <code class="reqn">p_t</code> defined as follows for the different models :
</p>

<dl>
<dt>M0:</dt><dd><p> the capture probability at any capture occasion,</p>
</dd>
<dt>Mt:</dt><dd><p> the capture probabilities for each capture occasion,</p>
</dd>
<dt>Mh models:</dt><dd><p> the average probability of capture,</p>
</dd> 
<dt>Mth models:</dt><dd><p> the average probabilities of capture for each occasion,</p>
</dd>
<dt>Mb and Mbh:</dt><dd><p> the probability of first capture at any capture occasion.</p>
</dd> 
</dl>

<p>For models Mb and Mbh, it also contains c, the recapture probability at any capture occasion.</p>
</td></tr>
<tr><td><code>neg.eta</code></td>
<td>
<p> The position of the eta parameters set to zero in the loglinear parameter 
vector of models MhC and MthC. <code>NULL</code> if no parameters are set to zero.</p>
</td></tr>
<tr><td><code>X</code></td>
<td>
<p> A copy of the data given as input in the function call.</p>
</td></tr>
<tr><td><code>dfreq</code></td>
<td>
<p> A copy of the <code>dfreq</code> argument given in the function call.</p>
</td></tr>
</table>


<h3>Note</h3>

<p> This function uses the <code><a href="stats.html#topic+glm">glm</a></code> function of the <span class="pkg">stats</span> package. </p>


<h3>Author(s)</h3>

<p> Louis-Paul Rivest <a href="mailto:Louis-Paul.Rivest@mat.ulaval.ca">Louis-Paul.Rivest@mat.ulaval.ca</a> and Sophie Baillargeon </p>


<h3>References</h3>

 
<p>Agresti, A. (1994) Simple capture-recapture models permitting unequal catchability and variable sampling effort. <em>Biometrics</em>, <b>50</b>, 494&ndash;500.
</p>
<p>Baillargeon, S. and Rivest, L.P. (2007) Rcapture: Loglinear models for capture-recapture in R.  <em>Journal of Statistical Software</em>, <b>19</b>(5), <a href="https://doi.org/10.18637/jss.v019.i05">doi:10.18637/jss.v019.i05</a>.
</p>
<p>Chao, A. (1987) Estimating the population size for capture-recapture data with unequal catchabililty.  <em> Biometrics</em>, <b>45</b>, 427&ndash;438.
</p>
<p>Darroch, S.E.,  Fienberg, G.,  Glonek, B. and Junker, B. (1993) A three sample multiple capture-recapture approach to the census population estimation with heterogeneous catchability. <em>Journal of the American Statistical Association</em>, <b>88</b>, 1137&ndash;1148.
</p>
<p>Rivest, L.P. and Levesque, T. (2001) Improved loglinear model estimators of abundance in capture-recapture experiments. <em>Canadian Journal of Statistics</em>, 29, 555&ndash;572.
</p>
<p>Rivest, L.P. and Baillargeon, S. (2007) Applications and extensions of Chao's moment estimator for the size of a closed population. <em>Biometrics</em>, <b>63</b>(4), 999&ndash;1006.
</p>
<p>Seber, G.A.F. (1982) The Estimation of Animal Abundance and Related Parameters, 2nd edition, New York: Macmillan.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+closedpCI.t">closedpCI.t</a></code>, <code><a href="#topic+closedpCI.0">closedpCI.0</a></code>, <code><a href="#topic+closedp.bc">closedp.bc</a></code>, <code><a href="#topic+closedp.Mtb">closedp.Mtb</a></code>, <code><a href="#topic+closedpMS.t">closedpMS.t</a></code>, <code><a href="#topic+uifit">uifit</a></code>. </p>


<h3>Examples</h3>

<pre><code class='language-R'># hare data set
hare.closedp &lt;- closedp.t(hare)
hare.closedp
boxplot(hare.closedp)

# Third primary period of mvole data set
period3 &lt;- mvole[, 11:15]
closedp.t(period3)

# BBS2001 data set
BBS.closedp &lt;- closedp.0(BBS2001, dfreq = TRUE, dtype = "nbcap", t = 50, t0 = 20)
BBS.closedp
plot(BBS.closedp)

### Seber (1982) p.107
# When there is 2 capture occasions, the heterogeneity models cannot be fitted
X &lt;- matrix(c(1,1,167,1,0,781,0,1,254), byrow = TRUE, ncol = 3)
closedp.t(X, dfreq = TRUE)

### Example of captures in continuous time
# Illegal immigrants data set
closedp.0(ill, dtype = "nbcap", dfreq = TRUE, t = Inf)
</code></pre>

<hr>
<h2 id='closedp.bc'> Bias Correction for Closed Population Loglinear Models </h2><span id='topic+closedp.bc'></span><span id='topic+print.closedp.bc'></span>

<h3>Description</h3>

<p>This function applies a bias correction to the abundance estimations obtained by closed 
population models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>closedp.bc(X, dfreq=FALSE, dtype=c("hist","nbcap"), t=NULL, t0=t,
           m=c("M0","Mt","Mh","Mth","Mb","Mbh"), h=NULL, h.control=list(), ...)

## S3 method for class 'closedp.bc'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="closedp.bc_+3A_x">X</code></td>
<td>
<p> The matrix of the observed capture histories (see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> for a description of the accepted formats).  </p>
</td></tr>
<tr><td><code id="closedp.bc_+3A_dfreq">dfreq</code></td>
<td>
<p> A logical. By default <code>FALSE</code>, which means that <code>X</code> has one row per unit. If TRUE, it indicates that the 
matrix <code>X</code> contains frequencies in its last column.</p>
</td></tr>
<tr><td><code id="closedp.bc_+3A_dtype">dtype</code></td>
<td>
<p> A characters string, either &quot;hist&quot; or &quot;nbcap&quot;, to specify the type of data. &quot;hist&quot;, the default, 
means that <code>X</code> contains complete observed capture histories. &quot;nbcap&quot; means that <code>X</code> contains numbers 
of captures (see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> for details on data formats). If <code>m</code> is 
&quot;Mt&quot;, &quot;Mth&quot;, &quot;Mb&quot; or &quot;Mbh&quot;, <code>dtype</code> must be &quot;hist&quot;. </p>
</td></tr>
<tr><td><code id="closedp.bc_+3A_t">t</code></td>
<td>
<p> Requested only if <code>dtype="nbcap"</code>. A numeric specifying the total number of capture occasions in the experiment.</p>
</td></tr>
<tr><td><code id="closedp.bc_+3A_t0">t0</code></td>
<td>
<p> A numeric used for model M0 or for an Mh model other than Chao's lower bound model : 
Models are fitted considering only the frequencies of units captured 
1 to <code>t0</code> times. By default <code>t0=t</code>. </p>
</td></tr>
<tr><td><code id="closedp.bc_+3A_m">m</code></td>
<td>
<p> A character string indicating the model to fit, either &quot;M0&quot;=M0 model, &quot;Mt&quot;=Mt model, &quot;Mh&quot;=Mh model, &quot;Mth&quot;=Mth model, 
&quot;Mb&quot;=Mb model, &quot;Mbh&quot;=Mbh model.</p>
</td></tr>
<tr><td><code id="closedp.bc_+3A_h">h</code></td>
<td>
<p> A character string (&quot;LB&quot;, &quot;Chao&quot;, &quot;Poisson&quot;, &quot;Darroch&quot; or &quot;Gamma&quot;) or a 
numerical <code>R</code> function specifying the form of the column(s) for heterogeneity 
in the design matrix.<br />
&quot;LB&quot; and &quot;Chao&quot; represents Chao's lower bound model (the default),<br /> 
&quot;Poisson&quot; represents the function <code class="reqn">f(k)=theta^k-1</code>,<br /> 
&quot;Darroch&quot; represents the function <code class="reqn">f(k)=k^2/2</code>,<br /> 
and &quot;Gamma&quot; represents the function <code class="reqn">f(k)=-\log(theta + k) + \log(theta)</code><br />
where <code class="reqn">k</code> is the number of captures and <code class="reqn">theta</code> is a parameter specified with 
the argument <code>theta</code>.<br /> 
If an <code>R</code> function is given, it must be the implementation of any convex 
mathematical function <code class="reqn">f(k)</code> (it must have only one argument).</p>
</td></tr>
<tr><td><code id="closedp.bc_+3A_h.control">h.control</code></td>
<td>
<p> A list of elements to control the heterogeneous part of the model, if any.<br />
For a Poisson or Gamma heterogeneous model:
</p>

<dl>
<dt><code>theta</code></dt><dd><p>  The value of the parameter <code class="reqn">theta</code> in <code class="reqn">f(k)=theta^k-1</code> for the Poisson model
(the default value is 2) and in <code class="reqn">f(k)=-\log(theta + k) + \log(theta)</code> 
for the Gamma model (the default value is 3.5). </p>
</dd>
</dl>

<p>For the Chao's lower bound Mth model:
</p>

<dl>
<dt><code>neg</code></dt><dd><p>  If this option is set to <code>TRUE</code> (the default), negative eta parameters in 
Chao's lower bound models are set to zero. </p>
</dd>
</dl>

</td></tr>
<tr><td><code id="closedp.bc_+3A_...">...</code></td>
<td>
<p> Further arguments to be passed to <code><a href="stats.html#topic+glm">glm</a></code> or <code><a href="base.html#topic+print.default">print.default</a></code>.</p>
</td></tr>
<tr><td><code id="closedp.bc_+3A_x">x</code></td>
<td>
<p> An object, produced by the <code>closedp.bc</code> function, to print.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For the Mt model:<br /> 
When t=2, <code>closedp.bc</code> returns the Petersen estimator with Chapman's (1951) bias correction 
and the bias corrected standard error estimator of Seber (1970) and Wittes (1972).  
For t&gt;2, <code>closedp.bc</code> implements the bias correction of Rivest and Levesque (2001).  
The estimate for N and its variance are calculated by solving an estimating equation as proposed 
in Seber (1982), not by fitting a Poisson regression.  This approach works for large values of t.
</p>
<p>For other models:<br />
The bias correction is done through frequency modifications in Poisson regression as described 
in Rivest and Levesque (2001). The variances calculated with the modified frequencies are 
less biased than the standard ones, but they can overestimate the mean squared errors, 
especially when the data is sparse.
</p>
<p>This function works with fairly large data set, except if an &quot;Mth&quot; model is requested. 
In this case, only heterogeneity of the form &quot;LB&quot;, &quot;Chao&quot;, &quot;Poisson&quot; with <code>theta=2</code> or &quot;Darroch&quot; 
is accepted.
</p>


<h3>Value</h3>

<table>
<tr><td><code>n</code></td>
<td>
<p> The number of captured units</p>
</td></tr>
<tr><td><code>t</code></td>
<td>
<p> The total number of capture occasions in the data matrix <code>X</code>.</p>
</td></tr>
<tr><td><code>t0</code></td>
<td>
<p> For models M0 and Mh only: the value of the argument <code>t0</code> used in the computations.</p>
</td></tr>
<tr><td><code>results</code></td>
<td>
<p> A table containing, for the fitted model:
</p>

<dl>
<dt><code>abundance</code>:</dt><dd><p>  the estimated population size,</p>
</dd>
<dt><code>stderr</code>:</dt><dd><p>  the standard error of the estimated population size,</p>
</dd>
<dt><code>infoFit</code>:</dt><dd><p>  a numerical code giving information about error or warnings 
encountered when fitting the model (see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> for details).</p>
</dd>
</dl>
</td></tr>
<tr><td><code>glm.warn</code></td>
<td>
<p> Only if the corrected population size estimation was obtained with <code><a href="stats.html#topic+glm">glm</a></code>:
A vector of character strings. If the <code><a href="stats.html#topic+glm">glm</a></code> function generates
one or more warnings when fitting the model, a copy of these warnings are
stored in <code>glm.warn</code>. <code>NULL</code> if <code><a href="stats.html#topic+glm">glm</a></code> did not produce
any warnings. </p>
</td></tr>
<tr><td><code>neg.eta</code></td>
<td>
<p> For Chao's lower bound model Mth only: the position of the eta parameters set 
to zero in the loglinear parameter vector, if any. </p>
</td></tr> 
</table>


<h3>Note</h3>

<p> This function uses the <code><a href="stats.html#topic+glm">glm</a></code> function of the <span class="pkg">stats</span> package, except for models Mt and Mh Chao's lower bound for which exact calculation is performed. </p>


<h3>Author(s)</h3>

<p> Louis-Paul Rivest <a href="mailto:Louis-Paul.Rivest@mat.ulaval.ca">Louis-Paul.Rivest@mat.ulaval.ca</a> and Sophie Baillargeon </p>


<h3>References</h3>

 
<p>Baillargeon, S. and Rivest, L.P. (2007) Rcapture: Loglinear models for capture-recapture in R.  <em>Journal of Statistical Software</em>, <b>19</b>(5), <a href="https://doi.org/10.18637/jss.v019.i05">doi:10.18637/jss.v019.i05</a>.
</p>
<p>Chapman, D. G. (1951) Some properties of the hypergeometric distribution with applications to zoological sample censuses. <em>University of California Publications in Statistics</em>, <b>1</b>(7), 131-160.
</p>
<p>Rivest, L.P. and Levesque, T. (2001) Improved loglinear model estimators of abundance in capture-recapture experiments. <em>Canadian Journal of Statistics</em>, <b>29</b>, 555-572.
</p>
<p>Seber, G.A.F. (1970) The effects of trap response on tag recapture estimates. <em>Biometrics</em>, <b>26</b>, 13-22.
</p>
<p>Seber, G.A.F. (1982) <em>The Estimation of Animal Abundance and Related Parameters, 2nd edition</em>. New York: Macmillan.
</p>
<p>Wittes, J.T. (1972) On the bias and estimated variance of Chapman's two-sample capture-recapture population estimate. <em>Biometrics</em>, <b>28</b>, 592-597.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+closedp">closedp</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'># Third primary period of mvole data set
period3 &lt;- mvole[, 11:15]
closedp.bc(period3, m = "Mh", h = "Darroch")
closedp.bc(period3, m = "Mh", h = "Gamma", h.control = list(theta = 3.5))

# BBS2001 data set
closedp.bc(BBS2001, dfreq = TRUE, dtype = "nbcap", t = 50, t0 = 20,
           m = "Mh", h = "Gamma", h.control = list(theta = 3.5))

# Seber (1982) p.107
# When there are 2 capture occasions, only models M0 and Mt can be fitted
X &lt;- matrix(c(1,1,167,1,0,781,0,1,254), byrow = TRUE, ncol = 3)
closedp.bc(X, dfreq = TRUE, m = "M0")
closedp.bc(X, dfreq = TRUE, m = "Mt") 
</code></pre>

<hr>
<h2 id='closedp.custom'> Customization of a Loglinear Model for Closed Populations Capture-Recapture Experiments </h2><span id='topic+closedp.custom'></span><span id='topic+closedp.mX'></span><span id='topic+closedp.h'></span><span id='topic+print.closedp.custom'></span><span id='topic+boxplot.closedp.custom'></span>

<h3>Description</h3>

<p>As of version 1.2-0 of <span class="pkg">Rcapture</span>, these functions are deprecated, but kept for back compatibility. Please use <code>closedpCI.t</code> instead. 
</p>
<p>The <code>closedp.mX</code> function fits a loglinear model given a design matrix <code>mX</code>. The <code>closedp.h</code> function 
fits Mh or Mth models for which the form of the column for heterogeneity in the design matrix is determined by the user. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>closedp.mX(X, dfreq=FALSE, mX, mname="Customized model")

closedp.h(X, dfreq=FALSE, m="Mh", h="Poisson", a=2)

## S3 method for class 'closedp.custom'
print(x, ...)

## S3 method for class 'closedp.custom'
boxplot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="closedp.custom_+3A_x">X</code></td>
<td>
<p> The matrix of the observed capture histories (see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> for a description of the accepted formats).  </p>
</td></tr>
<tr><td><code id="closedp.custom_+3A_dfreq">dfreq</code></td>
<td>
<p> A logical. By default FALSE, which means that <code>X</code> has one row per unit. If TRUE, it indicates that the
matrix <code>X</code> contains frequencies in its last column.</p>
</td></tr>
<tr><td><code id="closedp.custom_+3A_mx">mX</code></td>
<td>
<p> The design matrix of the loglinear model. In this matrix, the order of the capture histories is as defined in the 
<code>histpos.t</code> function.</p>
</td></tr>
<tr><td><code id="closedp.custom_+3A_mname">mname</code></td>
<td>
<p> A character string specifying the name of the customized model.</p>
</td></tr>
<tr><td><code id="closedp.custom_+3A_m">m</code></td>
<td>
<p> A character string indicating the model to fit, either &quot;Mh&quot;=Mh model or &quot;Mth&quot;=Mth model</p>
</td></tr>
<tr><td><code id="closedp.custom_+3A_h">h</code></td>
<td>
<p> The character string &quot;Poisson&quot; (<code class="reqn">2^k-1</code>) or a numerical function taking only one argument specifying the form of 
the column for heterogeneity in the design matrix.</p>
</td></tr>
<tr><td><code id="closedp.custom_+3A_a">a</code></td>
<td>
<p> The value of the exponent's base for a Poisson model. </p>
</td></tr>
<tr><td><code id="closedp.custom_+3A_x">x</code></td>
<td>
<p> An object, produced by the <code>closedp.mX</code> or the <code>closedp.h</code> function, to print or to plot.</p>
</td></tr>
<tr><td><code id="closedp.custom_+3A_...">...</code></td>
<td>
<p> Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Details</h3>

 
<p>An intercept is added to the model. Therefore, the mX matrix must not contain a column of ones.
</p>
<p>The abundance estimation is calculated as the number of captured units plus the exponential of the intercept. Therefore, 
these functions are not suited for models with a behavioral effect.
</p>
<p>In <code>closedp.h</code>, the argument <code>h</code> cannot take the value &quot;Chao&quot; or &quot;Darroch&quot; because these models are already 
fitted by the <code>closedp</code> function.
</p>
<p>The <code>boxplot.closedp.custom</code> function produces a boxplot of the pearson residuals of the customized model.
</p>


<h3>Value</h3>

<table>
<tr><td><code>n</code></td>
<td>
<p> The number of captured units</p>
</td></tr>
<tr><td><code>results</code></td>
<td>
<p> A table containing the estimated population size and its standard error, the deviance, 
the number of degrees of freedom and the Akaike's information criterion.</p>
</td></tr>
<tr><td><code>glm</code></td>
<td>
<p> The 'glm' object obtained from fitting the model.</p>
</td></tr> 
</table>


<h3>Note</h3>

<p> These functions use the <code>glm</code> function of the <span class="pkg">stats</span> package. </p>


<h3>Author(s)</h3>

<p> Louis-Paul Rivest <a href="mailto:Louis-Paul.Rivest@mat.ulaval.ca">Louis-Paul.Rivest@mat.ulaval.ca</a> and Sophie Baillargeon </p>


<h3>References</h3>

 
<p>Rivest, L.P. and Baillargeon, S. (2007) Applications and extensions of Chao's moment estimator for the size of a closed population. <em>Biometrics</em>, <b>63</b>(4), 999&ndash;1006.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+closedp">closedp</a></code>, <code><a href="#topic+closedp.Mtb">closedp.Mtb</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'># HIV data set
mat &lt;- histpos.t(4)
mX2 &lt;- cbind(mat, mat[, 1] * mat[, 2])
closedp.mX(HIV, dfreq = TRUE, mX = mX2)

# Third primary period of mvole data set
period3 &lt;- mvole[, 11:15]
psi &lt;- function(x) { -log(3.5 + x) + log(3.5) }
closedp.h(period3, h = psi)
</code></pre>

<hr>
<h2 id='closedp.Mtb'> Closed Population Capture-Recapture Model Mtb </h2><span id='topic+closedp.Mtb'></span><span id='topic+print.closedp.Mtb'></span>

<h3>Description</h3>

<p>This function fits model Mtb for closed populations in capture-recapture experiments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>closedp.Mtb(X, dfreq=FALSE, method = "BFGS", ...)

## S3 method for class 'closedp.Mtb'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="closedp.Mtb_+3A_x">X</code></td>
<td>
<p> The matrix of the observed capture histories (see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> for a description of the accepted formats).  </p>
</td></tr>
<tr><td><code id="closedp.Mtb_+3A_dfreq">dfreq</code></td>
<td>
<p> A logical. By default <code>FALSE</code>, which means that <code>X</code> has one row per unit. If TRUE, it 
indicates that the matrix <code>X</code> contains frequencies in its last column.</p>
</td></tr>
<tr><td><code id="closedp.Mtb_+3A_method">method</code></td>
<td>
<p> The method to be used by <code><a href="stats.html#topic+optim">optim</a></code>. The default is <code>"BFGS"</code>.</p>
</td></tr>
<tr><td><code id="closedp.Mtb_+3A_...">...</code></td>
<td>
<p> Further arguments to be passed to <code><a href="stats.html#topic+optim">optim</a></code> or <code><a href="base.html#topic+print.default">print.default</a></code>.</p>
</td></tr>
<tr><td><code id="closedp.Mtb_+3A_x">x</code></td>
<td>
<p> An object, produced by the <code>closedp.Mtb</code> function, to print.</p>
</td></tr>
</table>


<h3>Details</h3>

 
<p>The Mtb model is non-linear. It is fitted with the <code><a href="stats.html#topic+optim">optim</a></code> function instead of the <code>glm</code> function. Therefore, the abundance estimate can be unstable. 
</p>
<p>For the model to be identifiable, the parameters are constrained in the following way: 
<code class="reqn">logit(c_i)=logit(p_i)+b</code> for i in <code class="reqn">2,\ldots,l</code>. 
</p>


<h3>Value</h3>

<table>
<tr><td><code>n</code></td>
<td>
<p> The number of captured units</p>
</td></tr>
<tr><td><code>t</code></td>
<td>
<p> The total number of capture occasions in the data matrix <code>X</code>.</p>
</td></tr>
<tr><td><code>results</code></td>
<td>
<p> A table containing, for the fitted model:
</p>

<dl>
<dt><code>abundance</code>:</dt><dd><p>  the estimated population size,</p>
</dd>
<dt><code>stderr</code>:</dt><dd><p>  the standard error of the estimated population size,</p>
</dd>
<dt><code>deviance</code>:</dt><dd><p>  the model's deviance,</p>
</dd>
<dt><code>df</code>:</dt><dd><p>  the number of degrees of freedom,</p>
</dd>
<dt><code>AIC</code>:</dt><dd><p>  the Akaike's information criterion,</p>
</dd>
<dt><code>BIC</code>:</dt><dd><p>  the bayesian information criterion,</p>
</dd>
<dt><code>infoFit</code>:</dt><dd><p>  a numerical code giving information about error or warnings 
encountered when fitting the model (see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> for details).</p>
</dd>
</dl>
</td></tr>
<tr><td><code>optim</code></td>
<td>
<p>The output produced by <code><a href="stats.html#topic+optim">optim</a></code> from fitting the model.</p>
</td></tr>
<tr><td><code>optim.warn</code></td>
<td>
<p> A vector of character strings. If the <code><a href="stats.html#topic+optim">optim</a></code> function generates
one or more warnings when fitting the model, a copy of these warnings are
stored in <code>optim.warn</code>. <code>NULL</code> if <code><a href="stats.html#topic+optim">optim</a></code> did not produce
any warnings. </p>
</td></tr>
<tr><td><code>parMtb</code></td>
<td>
<p> Capture-recapture parameters estimates for model Mtb : the abundance N, <code class="reqn">p_1</code> to <code class="reqn">p_t</code>,
the probabilities of first capture for each capture occasion, and <code class="reqn">c_2</code> to <code class="reqn">c_t</code>, 
the recapture probabilities for each capture occasion.</p>
</td></tr> 
</table>


<h3>Author(s)</h3>

<p> Louis-Paul Rivest <a href="mailto:Louis-Paul.Rivest@mat.ulaval.ca">Louis-Paul.Rivest@mat.ulaval.ca</a> and Sophie Baillargeon </p>


<h3>References</h3>

<p>Baillargeon, S. and Rivest, L.P. (2007) Rcapture: Loglinear models for capture-recapture in R.  <em>Journal of Statistical Software</em>, <b>19</b>(5), <a href="https://doi.org/10.18637/jss.v019.i05">doi:10.18637/jss.v019.i05</a>.
</p>


<h3>See Also</h3>

 <p><code><a href="#topic+closedp">closedp</a></code>, <code><a href="#topic+closedpCI.t">closedpCI.t</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'># hare data set
closedp.Mtb(hare)

## Example producing an unstable estimate
# Fourth primary period of mvole data set
period4 &lt;- mvole[, 16:20]
closedp.Mtb(period4)
</code></pre>

<hr>
<h2 id='closedpCI'> Customization of a Loglinear Model and Confidence Interval for Abundance 
Estimation in Closed Population Capture-Recapture Experiments </h2><span id='topic+closedpCI'></span><span id='topic+closedpCI.t'></span><span id='topic+closedpCI.0'></span><span id='topic+print.closedpCI'></span><span id='topic+plotCI'></span><span id='topic+boxplot.closedpCI'></span><span id='topic+plot.closedpCI'></span>

<h3>Description</h3>

<p>The <code>closedpCI.t</code> and <code>closedpCI.0</code> functions fit a loglinear model specified by the user 
and compute a confidence interval for the abundance estimation. For a normal heterogeneous model,
a log-transformed confidence interval (Chao 1987) is produced.
For any other model, the multinomial profile likelihood confidence interval (Cormack 1992) is produced.<br />
</p>
<p>The model is identified with the argument <code>m</code> or <code>mX</code>.
For heterogeneous models, the form of the heterogeneity is specified with the arguments 
<code>h</code> and <code>h.control</code>. If <code>h</code> is given with <code>mX</code>, heterogeneity is added in <code>mX</code>.<br />
</p>
<p>These functions extend <code><a href="#topic+closedp.t">closedp.t</a></code> and <code><a href="#topic+closedp.0">closedp.0</a></code> as 
they broaden the range of models one can fit and they compute confidence intervals. 
Unlike the <code><a href="#topic+closedp">closedp</a></code> functions, it fits only one model at a time. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>closedpCI.t(X, dfreq=FALSE, m=c("M0","Mt","Mh","Mth"), mX=NULL,
            h=NULL, h.control=list(), mname=NULL, alpha=0.05, 
            fmaxSupCL=3, ...)

closedpCI.0(X, dfreq=FALSE, dtype=c("hist","nbcap"), t=NULL, t0=NULL, 
            m=c("M0","Mh"), mX=NULL, h=NULL, h.control=list(), 
            mname=NULL, alpha=0.05, fmaxSupCL=3, ...)

plotCI(x.closedpCI, main="Profile Likelihood Confidence Interval", ...)
			
## S3 method for class 'closedpCI'
print(x, ...)

## S3 method for class 'closedpCI'
boxplot(x, main="Boxplots of Pearson Residuals", ...)

## S3 method for class 'closedpCI'
plot(x, main="Scatterplot of Pearson Residuals", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="closedpCI_+3A_x">X</code></td>
<td>
<p> The matrix of the observed capture histories (see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> for a 
description of the accepted formats).  </p>
</td></tr>
<tr><td><code id="closedpCI_+3A_dfreq">dfreq</code></td>
<td>
<p> A logical. By default <code>FALSE</code>, which means that <code>X</code> has one row per unit. 
If <code>TRUE</code>, it indicates that the matrix <code>X</code> contains frequencies in its last column.</p>
</td></tr>
<tr><td><code id="closedpCI_+3A_dtype">dtype</code></td>
<td>
<p> A characters string, either <code>"hist"</code> or <code>"nbcap"</code>, to specify the type of data. 
<code>"hist"</code>, the default, means that <code>X</code> contains complete observed capture histories. 
<code>"nbcap"</code> means that <code>X</code> contains numbers of captures (see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> 
for details on data formats). </p>
</td></tr>
<tr><td><code id="closedpCI_+3A_t">t</code></td>
<td>
<p> Requested only if <code>dtype="nbcap"</code>. A numeric specifying the total number of 
capture occasions in the experiment. For <code>closedpCI.0</code>, the value <code>t=Inf</code>
is accepted. It indicates that captures occur in continuous time 
(see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code>).</p>
</td></tr>
<tr><td><code id="closedpCI_+3A_t0">t0</code></td>
<td>
<p> A numeric. Models are fitted considering only the frequencies of units captured 1 to <code>t0</code> times. 
By default, if <code>t</code> is not equal to <code>Inf</code>, <code>t0=t</code>. When <code>t=Inf</code>, the default value
of <code>t0</code> is the larger number of captures observed. </p>
</td></tr>
<tr><td><code id="closedpCI_+3A_m">m</code></td>
<td>
<p> A character string indicating the model to fit. For <code>closedpCI.0</code> it can be either &quot;M0&quot;=M0 model 
or &quot;Mh&quot;=Mh model. For <code>closedpCI.t</code> it can also be &quot;Mt&quot;=Mt model or &quot;Mth&quot;=Mth model.</p>
</td></tr>
<tr><td><code id="closedpCI_+3A_mx">mX</code></td>
<td>
<p> The design matrix of the loglinear model. By default, the design matrix is built based
on the <code>m</code> argument. If a <code>mX</code> argument is given, it must be a matrix  (or 
an object that can be coerced to a matrix by <code>as.matrix</code>). The order of the capture 
histories in the <code>mX</code> matrix must be as defined in the <code>histpos.t</code> or 
<code>histpos.0</code> function.<br />
For the <code>closedpCI.t</code> function only, <code>mX</code> can also be an object of class &quot;<code><a href="stats.html#topic+formula">formula</a></code>&quot; or a hierarchical loglinear model name. The details of a formula specification are given under <b>Details</b> and the details of a hierarchical loglinear model name specification are given in the <code><a href="#topic+closedpMS.t">closedpMS.t</a></code> documentation.<br />
An intercept is always added to the model. Therefore, <code>mX</code> must not contain a column of ones if it is a matrix. Also, if the argument <code>h</code> is not <code>NULL</code>, one or more columns for heterogeneity are added to the design matrix.</p>
</td></tr>
<tr><td><code id="closedpCI_+3A_h">h</code></td>
<td>
<p> A character string (&quot;LB&quot;, &quot;Chao&quot;, &quot;Poisson&quot;, &quot;Darroch&quot;, &quot;Gamma&quot; or &quot;Normal&quot;) or a 
numerical <code>R</code> function specifying the form of the column(s) for heterogeneity 
in the design matrix.<br />
&quot;LB&quot; and &quot;Chao&quot; represents Chao's lower bound model (the default),<br /> 
&quot;Poisson&quot; represents the function <code class="reqn">f(k)=theta^k-1</code>,<br /> 
&quot;Darroch&quot; represents the function <code class="reqn">f(k)=k^2/2</code>,<br /> 
and &quot;Gamma&quot; represents the function <code class="reqn">f(k)=-\log(theta + k) + \log(theta)</code><br /> 
where <code class="reqn">k</code> is the number of captures and <code class="reqn">theta</code> is a parameter specified with 
the <code>h.control</code> element <code>theta</code>.<br />
&quot;Normal&quot; represents heterogeneity 
modeled with a normal mixing distribution, as presented in Rivest (2011).<br />
If an <code>R</code> function is given, it must be the implementation of any convex 
mathematical function <code class="reqn">f(k)</code> (it must have only one argument).</p>
</td></tr>
<tr><td><code id="closedpCI_+3A_h.control">h.control</code></td>
<td>
<p> A list of elements to control the heterogeneous part of the model, if any.<br />
For a Poisson or Gamma heterogeneous model:
</p>

<dl>
<dt><code>theta</code></dt><dd><p> The value of the parameter <code class="reqn">theta</code> in <code class="reqn">f(k)=theta^k-1</code> for the Poisson model
(the default value is 2) and in <code class="reqn">f(k)=-\log(theta + k) + \log(theta)</code> 
for the Gamma model (the default value is 3.5). </p>
</dd>
</dl>

<p>For a Chao's lower bound heterogeneous model:
</p>

<dl>
<dt><code>neg</code></dt><dd><p> If this option is set to <code>TRUE</code> (the default), negative eta parameters in 
Chao's lower bound models are set to zero. </p>
</dd>
</dl>

<p>For a Normal heterogeneous model:
</p>
       
<dl>
<dt><code>initcoef</code></dt><dd><p> Initial values for the loglinear coefficients given to <code><a href="stats.html#topic+optim">optim</a></code>. 
The default values are taken from Darroch's model. </p>
</dd>
<dt><code>initsig</code></dt><dd><p> Initial value for the sigma parameter of the normal mixing distribution. 
The default is <code>0.2</code>. </p>
</dd>
<dt><code>method</code></dt><dd><p> The method to be used by <code><a href="stats.html#topic+optim">optim</a></code>. The default is <code>"BFGS"</code>.<br /> </p>
</dd>
</dl>

</td></tr>
<tr><td><code id="closedpCI_+3A_mname">mname</code></td>
<td>
<p> A character string specifying the name of the customized model. By default,
it is derived from the arguments specifying the model.</p>
</td></tr>
<tr><td><code id="closedpCI_+3A_alpha">alpha</code></td>
<td>
<p> A confidence interval with confidence level 1-<code>alpha</code> is constructed. The value of alpha 
must be between 0 and 1; the default is 0.05.  </p>
</td></tr>
<tr><td><code id="closedpCI_+3A_fmaxsupcl">fmaxSupCL</code></td>
<td>
<p> A numeric (by default 3). The upper end point of the interval to be searched by
<code><a href="stats.html#topic+uniroot">uniroot</a></code> to find the upper bound of the multinomial profile likelihood 
confidence interval (Cormack 1992) is defined by 
<code>fmaxSupCL</code><code class="reqn">\times \hat{N}</code>. In 
this product, <code>fmaxSupCL</code> is a factor multiplying <code class="reqn">\hat{N}</code>, the population 
size estimated by Poisson regression. If the upper bound obtained is equal
the upper end point <code>fmaxSupCL</code><code class="reqn">\times \hat{N}</code>, the 
element <code>SupCL</code> of the output value <code>CI</code> will begin with the symbol 
<code class="reqn">&gt;</code>. In that case, one could try to increase the value of <code>fmaxSupCL</code> 
to find the upper bound of the multinomial profile likelihood confidence interval 
instead of a minimum value for this upper bound. </p>
</td></tr>
<tr><td><code id="closedpCI_+3A_...">...</code></td>
<td>
<p> Further arguments to be passed to <code><a href="stats.html#topic+glm">glm</a></code>, <code><a href="stats.html#topic+optim">optim</a></code>, 
<code><a href="base.html#topic+print.default">print.default</a></code>, <code><a href="graphics.html#topic+plot.default">plot.default</a></code> or <code><a href="graphics.html#topic+boxplot.default">boxplot.default</a></code>.</p>
</td></tr>
<tr><td><code id="closedpCI_+3A_x.closedpci">x.closedpCI</code></td>
<td>
<p> An object, produced by a <code>closedpCI</code> function, to produce a plot
of the multinomial profile likelihood for <code class="reqn">N</code>.</p>
</td></tr>
<tr><td><code id="closedpCI_+3A_main">main</code></td>
<td>
<p> A main title for the plot</p>
</td></tr>
<tr><td><code id="closedpCI_+3A_x">x</code></td>
<td>
<p> An object, produced by a <code>closedpCI</code> function, to print or to plot.</p>
</td></tr>
</table>


<h3>Details</h3>

 
<p>The <code>closedpCI.t</code> function fits models using the frequencies of the observable capture histories (vector of size <code class="reqn">2^t-1</code>), whereas <code>closedpCI.0</code> uses the number of units capture i times, for  <code class="reqn">i=1,\ldots,t</code> (vector of size <code class="reqn">t</code>). Thus, <code>closedpCI.0</code> can be used with data sets larger than those for <code>closedpCI.t</code>, but it cannot fit models with a temporal effect. See <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> for more details about the distinction between <code>.t</code> and <code>.0</code> functions.
</p>
<p>These functions do not work for closed population models featuring a behavioral effect, such as Mb and Mbh. The abundance estimation is calculated as the number of captured units plus the exponential of the Poisson regression intercept. However, models with a behavioral effect can by fitted with <code><a href="#topic+closedp.t">closedp.t</a></code> (Mb and Mbh), <code><a href="#topic+closedp.Mtb">closedp.Mtb</a></code> and <code><a href="#topic+closedp.bc">closedp.bc</a></code>.<br />
</p>
<p>CHAO'S LOWER BOUND MODELS
</p>
<p>Chao's lower bound models estimate a lower bound for the abundance. Rivest (2011) 
presents a generalized loglinear model underlying this estimator. To test whether a 
certain model for heterogeneity is adequate,
one can conduct a likelihood ratio test by subtracting the deviance of a Chao's lower 
bound model to the deviance of the heterogeneous model under study. The two models should
have the same <code>mX</code> argument.  
Under the null hypothesis of equivalence between the two models, the difference of deviances 
follows a chi-square distribution with degrees of freedom equal to the difference between 
the models' degrees of freedom.
</p>
<p>A Chao's lower bound model contains <code class="reqn">t-2</code> parameters, called
eta parameters, for the heterogeneity. These parameters should theoretically be greater 
or equal to zero (see Rivest and Baillargeon (2007)). When the element <code>neg</code> of
the argument <code>h.control</code> is set to <code>TRUE</code> (the default), negative eta parameters are
set to zero (to do so, columns are removed from the design matrix of the model). Degrees 
of freedom of Chao's lower bound model increase when eta parameters are set to zero.<br />
</p>
<p>ARGUMENT <code>mX</code> : FORMULA SPECIFICATION<br />
For the <code>closedpCI.t</code> function, <code>mX</code>
can be an object of class &quot;<code><a href="stats.html#topic+formula">formula</a></code>&quot;. The only accepted variables 
in this formula are <code>c1</code> to <code>ct</code>. The variable <code>ci</code> represents 
a capture indicator (1 for a capture, 0 otherwise) for the <code class="reqn">i</code>th capture occasions. 
Also, the formula must not contain a response variable since
it is only used to construct the design matrix of the model. 
For example, if <code>t=3</code>, the Mt model is fitted if 
<code>mX = ~ .</code> or <code>mX = ~ c1 + c2 + c3</code>. The symbol <code>.</code> in this formula
is a shortcut for <code>c1</code> +  <code>c2</code> + ... + <code>ct</code>. Formula <code>mX</code> arguments
facilitate the addition of interactions between capture occasions in the model. For
example, if <code>t=3</code>, the Mt model with an interaction between the first and
the second capture occasion is fitted if <code>mX = ~ . + c1:c2</code>. 
See <code><a href="stats.html#topic+formula">formula</a></code> for more details of allowed formulae.<br />
</p>
<p>PLOT METHODS AND FUNCTIONS
</p>
<p>The <code>boxplot.closedpCI</code> function produces a boxplot of the Pearson residuals of the customized model.
</p>
<p>The <code>plot.closedpCI</code> function traces the scatterplot of the Pearson residuals in terms of <code class="reqn">f_i</code> 
(number of units captured i times) for the customized model.  
</p>
<p>The <code>plotCI</code> function produces a plot of the multinomial profile likelihood for <code class="reqn">N</code>. 
The value of N maximizing the profile likelihood and the bounds of the confidence interval are identified.
</p>


<h3>Value</h3>

<table>
<tr><td><code>n</code></td>
<td>
<p> The number of captured units</p>
</td></tr>
<tr><td><code>t</code></td>
<td>
<p> The total number of capture occasions in the data matrix <code>X</code>.
When captures occur in continuous time (input argument <code>t=Inf</code>),
this output value is the larger number of captures observed.</p>
</td></tr>
<tr><td><code>t0</code></td>
<td>
<p> For <code>closedpCI.0</code> only: the value of the argument <code>t0</code> used in the computations.</p>
</td></tr>
<tr><td><code>results</code></td>
<td>
<p> A table containing, for the fitted model:
</p>

<dl>
<dt><code>abundance</code>:</dt><dd><p>  the estimated population size,</p>
</dd>
<dt><code>stderr</code>:</dt><dd><p>  the standard error of the estimated population size,</p>
</dd>
<dt><code>deviance</code>:</dt><dd><p>  the model's deviance,</p>
</dd>
<dt><code>df</code>:</dt><dd><p>  the number of degrees of freedom,</p>
</dd>
<dt><code>AIC</code>:</dt><dd><p>  the Akaike's information criterion,</p>
</dd>
<dt><code>BIC</code>:</dt><dd><p>  the bayesian information criterion,</p>
</dd>
<dt><code>infoFit</code>:</dt><dd><p>  a numerical code giving information about error or warnings 
encountered when fitting the model (see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> for details).</p>
</dd>
</dl>
</td></tr>
<tr><td><code>bias</code></td>
<td>
<p> Not produced for normal heterogeneous models (<code>h="Normal"</code>): The asymptotic bias of the estimated population size.</p>
</td></tr>
<tr><td><code>fit</code></td>
<td>
<p> The 'glm' object obtained from fitting the model except for
normal heterogeneous models (<code>h="Normal"</code>). These models are not fitted 
with <code>glm</code>. For them, <code>fit</code> is a list with the following elements:
</p>

<dl>
<dt><code>parameters</code>:</dt><dd><p>  the matrix of parameters (loglinear coefficients + sigma parameter) estimates with their standard errors,</p>
</dd>
<dt><code>varcov</code>:</dt><dd><p>  the estimated variance-covariance matrix of the estimated parameters,</p>
</dd>
<dt><code>y</code>:</dt><dd><p>  the y vector used to fit the model,</p>
</dd>
<dt><code>fitted.values</code>:</dt><dd><p>  the model fitted values,</p>
</dd> 
<dt><code>initparam</code>:</dt><dd><p>  the initial values for the parameters (loglinear coefficients + 
sigma parameter) used by <code><a href="stats.html#topic+optim">optim</a></code>,</p>
</dd>
<dt><code>optim</code>:</dt><dd><p>  the output produced by <code><a href="stats.html#topic+optim">optim</a></code>.</p>
</dd>
</dl>
</td></tr>            
<tr><td><code>fit.warn</code></td>
<td>
<p> A vector of character strings. If the <code><a href="stats.html#topic+glm">glm</a></code> or <code><a href="stats.html#topic+optim">optim</a></code> 
(for normal heterogeneous models) function generates
one or more warnings when fitting the model, a copy of these warnings are
stored in <code>fit.warn</code>. <code>NULL</code> if no warnings occured. </p>
</td></tr>
<tr><td><code>neg.eta</code></td>
<td>
<p> For Chao's lower bound models only: the position of the eta parameters set 
to zero in the loglinear parameter vector, if any. </p>
</td></tr> 
<tr><td><code>CI</code></td>
<td>
<p> Not produced for normal heterogeneous models (<code>h="Normal"</code>): A table containing 
the abundance estimation and its multinomial profile likelihood confidence interval.
The last column of the table, named <code>infoCI</code>, contains a numerical code giving information about error or warnings encountered when calculating the confidence interval. Here is a description of the meaning of this numerical code:
</p>

<dl>
<dt>   0</dt><dd><p>  no error or warning occured;</p>
</dd>
<dt>  -1</dt><dd><p>  an error occured while calculating the multinomial abundance estimation;</p>
</dd>
<dt>   4</dt><dd><p>  a warning occured while calculating the multinomial abundance estimation;</p>
</dd> 
<dt>   5</dt><dd><p>  a warning occured while calculating the lower bound of the multinomial profile likelihood confidence interval;</p>
</dd>
<dt>   6</dt><dd><p>  a warning occured while calculating the upper bound of the multinomial profile likelihood confidence interval.</p>
</dd>
</dl>
</td></tr>
<tr><td><code>CI.err</code></td>
<td>
<p> Not produced for normal heterogeneous models (<code>h="Normal"</code>): If
an error occured while calculating the multinomial abundance, a copy of the error message is
stored in <code>CI.err</code>. <code>NULL</code> if no error occured. </p>
</td></tr> 
<tr><td><code>CI.warn</code></td>
<td>
<p> Not produced for normal heterogeneous models (<code>h="Normal"</code>): If 
one or more warnings occur while calculating the multinomial abundance estimation or the profile likelihood confidence interval, a copy of these warnings are
stored in <code>CI.warn</code>. <code>NULL</code> if no warnings occured.</p>
</td></tr> 
<tr><td><code>alpha</code></td>
<td>
<p> 1-the confidence level of the interval.</p>
</td></tr>
<tr><td><code>N.CI</code></td>
<td>
<p> Not produced for normal heterogeneous models (<code>h="Normal"</code>): 
The x-coordinates for <code>plot.closedpCI.t</code>.</p>
</td></tr>
<tr><td><code>loglik.CI</code></td>
<td>
<p> Not produced for normal heterogeneous models (<code>h="Normal"</code>): 
The y-coordinates for <code>plot.closedpCI.t</code>.</p>
</td></tr> 
</table>


<h3>Note</h3>

<p> For normal heterogeneous models, the <code>closedpCI</code> functions use <code><a href="stats.html#topic+optim">optim</a></code>
from the <span class="pkg">stats</span> package. Otherwise, models are fitted with <code><a href="stats.html#topic+glm">glm</a></code>
and the code to compute the multinomial profile likelihood confidence interval 
calls the functions <code><a href="stats.html#topic+glm">glm</a></code>, <code><a href="stats.html#topic+optimize">optimize</a></code> and <code><a href="stats.html#topic+uniroot">uniroot</a></code>,
all from the <span class="pkg">stats</span> package. </p>


<h3>Author(s)</h3>

<p> Louis-Paul Rivest <a href="mailto:Louis-Paul.Rivest@mat.ulaval.ca">Louis-Paul.Rivest@mat.ulaval.ca</a> and Sophie Baillargeon </p>


<h3>References</h3>

 
<p>Baillargeon, S. and Rivest, L.P. (2007) Rcapture: Loglinear models for capture-recapture in R.  <em>Journal of Statistical Software</em>, <b>19</b>(5), <a href="https://doi.org/10.18637/jss.v019.i05">doi:10.18637/jss.v019.i05</a>.
</p>
<p>Chao, A. (1987) Estimating the population size for capture-recapture data with unequal catchability. <em>Biometrics</em>, <b>43</b>(4), 783&ndash;791.
</p>
<p>Cormack, R. M. (1992) Interval estimation for mark-recapture studies of closed populations. <em>Biometrics</em>, <b>48</b>, 567&ndash;576.
</p>
<p>Rivest, L.P. (2011) A lower bound model for multiple record systems estimation with heterogeneous catchability. 
<em>The International Journal of Biostatistics</em>, <b>7</b>(1), Article 23.
</p>
<p>Rivest, L.P. and Baillargeon, S. (2007) Applications and extensions of Chao's moment estimator for the size of a closed population. <em>Biometrics</em>, <b>63</b>(4), 999&ndash;1006.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+closedp">closedp</a></code>,  <code><a href="#topic+closedp.Mtb">closedp.Mtb</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'># hare data set
CI &lt;- closedpCI.t(hare, m = "Mth", h = "Poisson", h.control = list(theta = 2))
CI
plotCI(CI)

# HIV data set
mat &lt;- histpos.t(4)
mX2 &lt;- cbind(mat, mat[, 1] * mat[ ,2])
closedpCI.t(HIV, dfreq = TRUE, mX = mX2, mname = "Mt interaction 1,2")
# which can be obtained more conveniently with
closedpCI.t(HIV, dfreq = TRUE, mX = ~ . + c1:c2, mname = "Mt interaction 1,2")

# BBS2001 data set
CI0 &lt;- closedpCI.0(BBS2001, dfreq = TRUE, dtype = "nbcap", t = 50, t0 = 20,
                   m = "Mh", h = "Gamma", h.control = list(theta = 3.5))
CI0
plot(CI0)
plotCI(CI0)

### As an alternative to a gamma model, one can fit a negative Poisson model.
### It is appropriate in experiments where very small capture probabilities
### are likely. It can lead to very large estimators of abundance. 

# Third primary period of mvole data set
period3 &lt;- mvole[, 11:15]
psi &lt;- function(x) { 0.5^x - 1 }
closedpCI.t(period3, m = "Mh", h = psi)

### Example of normal heterogeneous models
### diabetes data of Bruno et al. (1994)

histpos &lt;- histpos.t(4)
diabetes &lt;- cbind(histpos, c(58,157,18,104,46,650,12,709,14,20,7,74,8,182,10))
# chosen interaction set I in Rivest (2011)
closedpCI.t(X = diabetes, dfreq = TRUE, mX = ~ . + c1:c3 + c2:c4 + c3:c4, 
            h = "Normal", mname = "Mth normal with I")

### Example of captures in continuous time
# Illegal immigrants data set
closedpCI.0(ill, dtype = "nbcap", dfreq = TRUE, t = Inf, m = "Mh", h = "LB")
</code></pre>

<hr>
<h2 id='closedpMS'> Hierarchical Loglinear Model Selection in Closed Population Capture-Recapture Experiments </h2><span id='topic+closedpMS'></span><span id='topic+closedpMS.t'></span><span id='topic+print.closedpMS'></span><span id='topic+plot.closedpMS'></span><span id='topic+getAllModels'></span>

<h3>Description</h3>

<p>The <code>closedpMS.t</code> function fits every possible hierarchical loglinear models for a given
closed population capture-recapture data set, under the constraints set by the given <code>maxorder</code> and <code>forced</code>
arguments. Parameters for heterogeneity in capture probabilites among units can be added to the models.
</p>
<p>The <code>getAllModels</code> function lists every possible hierarchical loglinear models for a certain number of capture occasions <code>t</code>, under the constraints set by the given <code>maxorder</code> and <code>forced</code> arguments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>closedpMS.t(X, dfreq = FALSE, h = NULL, h.control = list(), 
            maxorder = t - 1, forced = 1:t, stopiflong = TRUE, ...)
			
## S3 method for class 'closedpMS'
print(x, ...)

## S3 method for class 'closedpMS'
plot(x, main="Models comparison based on BIC", omitOutliers = TRUE, ...)

getAllModels(t, maxorder = t - 1, forced = 1:t, stopiflong = TRUE) 
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="closedpMS_+3A_x">X</code></td>
<td>
<p> The matrix of the observed capture histories (see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> for a 
description of the accepted formats).  </p>
</td></tr>
<tr><td><code id="closedpMS_+3A_dfreq">dfreq</code></td>
<td>
<p> A logical. By default <code>FALSE</code>, which means that <code>X</code> has one row per unit. 
If <code>TRUE</code>, it indicates that the matrix <code>X</code> contains frequencies in its last column.</p>
</td></tr>
<tr><td><code id="closedpMS_+3A_h">h</code></td>
<td>
<p> A character string (&quot;LB&quot;, &quot;Chao&quot;, &quot;Poisson&quot;, &quot;Darroch&quot;, &quot;Gamma&quot; or &quot;Normal&quot;) or a 
numerical <code>R</code> function specifying the form of the column(s) for heterogeneity 
in the design matrix.<br />
&quot;LB&quot; and &quot;Chao&quot; represents Chao's lower bound model (the default),<br /> 
&quot;Poisson&quot; represents the function <code class="reqn">f(k)=theta^k-1</code>,<br /> 
&quot;Darroch&quot; represents the function <code class="reqn">f(k)=k^2/2</code>,<br /> 
and &quot;Gamma&quot; represents the function <code class="reqn">f(k)=-\log(theta + k) + \log(theta)</code><br /> 
where <code class="reqn">k</code> is the number of captures and <code class="reqn">theta</code> is a parameter specified with 
the <code>h.control</code> element <code>theta</code>.<br />
&quot;Normal&quot; represents heterogeneity 
modeled with a normal mixing distribution, as presented in Rivest (2011).<br />
If an <code>R</code> function is given, it must be the implementation of any convex 
mathematical function <code class="reqn">f(k)</code> (it must have only one argument).</p>
</td></tr>
<tr><td><code id="closedpMS_+3A_h.control">h.control</code></td>
<td>
<p> A list of elements to control the heterogeneous part of the model, if any.<br />
For a Poisson or Gamma heterogeneous model:
</p>

<dl>
<dt><code>theta</code></dt><dd><p> The value of the parameter <code class="reqn">theta</code> in <code class="reqn">f(k)=theta^k-1</code> for the Poisson model
(the default value is 2) and in <code class="reqn">f(k)=-\log(theta + k) + \log(theta)</code> 
for the Gamma model (the default value is 3.5). </p>
</dd>
</dl>

<p>For a Chao's lower bound heterogeneous model:
</p>

<dl>
<dt><code>neg</code></dt><dd><p> If this option is set to <code>TRUE</code> (the default), negative eta parameters in 
Chao's lower bound models are set to zero. </p>
</dd>
</dl>

<p>For a Normal heterogeneous model:
</p>
       
<dl>
<dt><code>initsig</code></dt><dd><p> Initial value for the sigma parameter of the normal mixing distribution. 
The default is <code>0.2</code>. </p>
</dd>
<dt><code>method</code></dt><dd><p> The method to be used by <code><a href="stats.html#topic+optim">optim</a></code>. The default is <code>"BFGS"</code>.<br /> </p>
</dd>
</dl>

</td></tr>
<tr><td><code id="closedpMS_+3A_maxorder">maxorder</code></td>
<td>
<p> A numeric specifying the higher order accepted for the terms in the models.
It can take a value between 1 and <code>t - 1</code> (the default).</p>
</td></tr>
<tr><td><code id="closedpMS_+3A_forced">forced</code></td>
<td>
<p> A vector of the terms forced in the model (by default every 
first order terms). <code>NULL</code> if no terms are forced in the model. </p>
</td></tr>
<tr><td><code id="closedpMS_+3A_stopiflong">stopiflong</code></td>
<td>
<p> A logical indicating whether the function execution should be stopped
when the number of possibles models is larger than 10 000, that is when
the function might be long to run (defaut <code>TRUE</code>). </p>
</td></tr>
<tr><td><code id="closedpMS_+3A_...">...</code></td>
<td>
<p> Further arguments to be passed to <code><a href="stats.html#topic+glm">glm</a></code>, <code><a href="stats.html#topic+optim">optim</a></code> 
or <code><a href="base.html#topic+print.default">print.default</a></code>.</p>
</td></tr>
<tr><td><code id="closedpMS_+3A_x">x</code></td>
<td>
<p> An object, produced by the <code>closedpMS.t</code> function, to print or to plot.</p>
</td></tr>
<tr><td><code id="closedpMS_+3A_main">main</code></td>
<td>
<p> A main title for the plot.</p>
</td></tr>
<tr><td><code id="closedpMS_+3A_omitoutliers">omitOutliers</code></td>
<td>
<p> A logical. If TRUE (the default), models with an outlier abundance or BIC value are removed from the plot. A value is considered an outlier if it is smaller than the first quartile minus 1.5 times the interquartile range, or larger than the third quartile plus 1.5 times the interquartile range.</p>
</td></tr>
<tr><td><code id="closedpMS_+3A_t">t</code></td>
<td>
<p> A numeric specifying the number of capture occasions in the experiments.
It is deduced from the data set in the <code>closedpMS.t</code> function.
It must be an integer between 1 and 9 inclusively.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>HIERARCHICAL LOGLINEAR MODEL NAME SYNTAX
</p>
<p>First, a model's term is written using numbers between 1 and 9 to represent the capture occasions it includes (ex.: <code>134</code> represents the three-way interaction <code>c1:c3:c4</code>). This syntax limits the maximal number of capture occation to 9. This is not a problem since from 6 capture occasions upwards, the number of hierarchical models becomes very large and difficult to manage.
</p>
<p>A hierarchical model name is a list of the model's terms at the top of the hierarchies in the model. These terms are separated by commas, without spaces. They are surronded by brackets. For example, <code>"[123,34,5]"</code> is the name of the model<br />
<code>~ 1 + c1 + c2 + c3 + c4 + c5 + c1:c2 + c1:c3 + c2:c3 + c3:c4 + c1:c2:c3</code>.
</p>


<h3>Value</h3>

<p><code>getAllModels</code> returns a caracter vector with the models names.<br />
</p>
<p><code>closedpMS.t</code> returns a list
with the following elements:
</p>
<table>
<tr><td><code>n</code></td>
<td>
<p> The number of captured units</p>
</td></tr>
<tr><td><code>t</code></td>
<td>
<p> The total number of capture occasions in the data matrix <code>X</code>.
When captures occur in continuous time (input argument <code>t=Inf</code>),
this output value is the larger number of captures observed.</p>
</td></tr>
<tr><td><code>results</code></td>
<td>
<p> A table containing, for every fitted model:
</p>

<dl>
<dt><code>abundance</code></dt><dd><p>  the estimated population size,</p>
</dd>
<dt><code>stderr</code></dt><dd><p>  the standard error of the estimated population size,</p>
</dd>
<dt><code>deviance</code></dt><dd><p>  the model's deviance,</p>
</dd>
<dt><code>df</code></dt><dd><p>  the number of degrees of freedom,</p>
</dd>
<dt><code>AIC</code></dt><dd><p>  the Akaike's information criterion,</p>
</dd>
<dt><code>BIC</code></dt><dd><p>  the bayesian information criterion,</p>
</dd>
<dt><code>infoFit</code></dt><dd><p>  a numerical code giving information about error or warnings 
encountered when fitting the model (see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> for details).</p>
</dd>
</dl>
</td></tr>
<tr><td><code>bias</code></td>
<td>
<p> A vector, the asymptotic bias of the estimated population size for every fitted model.</p>
</td></tr>
<tr><td><code>fit.err</code></td>
<td>
<p> A list of character string vectors. If an error occurs
while fitting a model (with <code><a href="stats.html#topic+glm">glm</a></code> or <code><a href="stats.html#topic+optim">optim</a></code>), a copy of the 
error message is stored in <code>fit.err$mname</code> where <code>mname</code> is the 
name of the hierarchical loglinear model. A <code>NULL</code> list element means  
that no error occured for the considered model. </p>
</td></tr>            
<tr><td><code>fit.warn</code></td>
<td>
<p> A list of character string vectors. If warnings are generated
while fitting a model (with <code><a href="stats.html#topic+glm">glm</a></code> or <code><a href="stats.html#topic+optim">optim</a></code>), a copy of these 
warnings are stored in <code>fit.warn$mname</code> where <code>mname</code> is a the 
name of the hierarchical model. A <code>NULL</code> list element means  
that no warnings were generated for the considered model. </p>
</td></tr>
<tr><td><code>neg.eta</code></td>
<td>
<p> For Chao's lower bound models only: the position of the eta parameters set 
to zero in the loglinear parameter vector, if any. </p>
</td></tr> 
</table>


<h3>Note</h3>

<p> For normal heterogeneous models, <code>closedpMS.t</code> uses <code><a href="stats.html#topic+optim">optim</a></code>
from the <span class="pkg">stats</span> package. Otherwise, models are fitted with <code><a href="stats.html#topic+glm">glm</a></code>,
also from the <span class="pkg">stats</span> package. </p>


<h3>Author(s)</h3>

<p> Louis-Paul Rivest <a href="mailto:Louis-Paul.Rivest@mat.ulaval.ca">Louis-Paul.Rivest@mat.ulaval.ca</a> and Sophie Baillargeon </p>


<h3>References</h3>

 
<p>Baillargeon, S. and Rivest, L.P. (2007) Rcapture: Loglinear models for capture-recapture in R.  <em>Journal of Statistical Software</em>, <b>19</b>(5), <a href="https://doi.org/10.18637/jss.v019.i05">doi:10.18637/jss.v019.i05</a>.
</p>
<p>Chao, A. (1987) Estimating the population size for capture-recapture data with unequal catchability. <em>Biometrics</em>, <b>43</b>(4), 783&ndash;791.
</p>
<p>Cormack, R. M. (1992) Interval estimation for mark-recapture studies of closed populations. <em>Biometrics</em>, <b>48</b>, 567&ndash;576.
</p>
<p>Rivest, L.P. (2011) A lower bound model for multiple record systems estimation with heterogeneous catchability. 
<em>The International Journal of Biostatistics</em>, <b>7</b>(1), Article 23.
</p>
<p>Rivest, L.P. and Baillargeon, S. (2007) Applications and extensions of Chao's moment estimator for the size of a closed population. <em>Biometrics</em>, <b>63</b>(4), 999&ndash;1006.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+closedp">closedp</a></code>,  <code><a href="#topic+closedp.Mtb">closedp.Mtb</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'># The lesbian data set contains 4 capture occasions.
# By default, closedpMB.t fits the 113 following models:

getAllModels(4)

closedpMS.t(lesbian, dfreq = TRUE)

# We could reduce the number of models by omitting
# those with triple interactions.

closedpMS.t(lesbian, dfreq = TRUE, maxorder = 2)

# Models with heterogeneity fits better.

Darr &lt;- closedpMS.t(lesbian, dfreq = TRUE, h = "Darroch")
Darr

# The plot method allows the visualization of the results
# from models fitted by closedpMS.t().

plot(Darr)

# According to the BIC, the best heterogeneous Darroch model
# for this data set contains the double interactions 12, 13, 14.
# Here is the profile likelihood confidence interval for the
# abundance estimation from this model.

closedpCI.t(lesbian, dfreq = TRUE, mX = "[12,13,14]", h = "Darroch")
</code></pre>

<hr>
<h2 id='descriptive'> Descriptive Statistics </h2><span id='topic+descriptive'></span><span id='topic+print.descriptive'></span><span id='topic+plot.descriptive'></span>

<h3>Description</h3>

<p>This function produces descriptive statistics for capture-recapture data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>descriptive(X, dfreq=FALSE, dtype=c("hist","nbcap"), t=NULL)

## S3 method for class 'descriptive'
print(x, ...)

## S3 method for class 'descriptive'
plot(x, main="Exploratory Heterogeneity Graph", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="descriptive_+3A_x">X</code></td>
<td>
<p> The matrix of the observed capture histories (see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> for a description of the accepted formats).  </p>
</td></tr>
<tr><td><code id="descriptive_+3A_dfreq">dfreq</code></td>
<td>
<p> A logical. By default FALSE, which means that <code>X</code> has one row per unit. If TRUE, it indicates that 
the matrix <code>X</code> contains frequencies in its last column.</p>
</td></tr>
<tr><td><code id="descriptive_+3A_dtype">dtype</code></td>
<td>
<p> A characters string, either &quot;hist&quot; or &quot;nbcap&quot;, to specify the type of data. &quot;hist&quot;, the default, means that 
<code>X</code> contains complete observed capture histories. &quot;nbcap&quot; means that <code>X</code> contains numbers of captures 
(see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> for details on data formats). </p>
</td></tr>
<tr><td><code id="descriptive_+3A_t">t</code></td>
<td>
<p> Requested only if <code>dtype="nbcap"</code>. A numeric specifying the total number 
of capture occasions in the experiment. The value <code>t=Inf</code>
is accepted. It indicates that captures occur in continuous time.
(see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code>).</p>
</td></tr>
<tr><td><code id="descriptive_+3A_x">x</code></td>
<td>
<p> An object, produced by the <code>descriptive</code> function, to print or to plot.</p>
</td></tr>
<tr><td><code id="descriptive_+3A_main">main</code></td>
<td>
<p> A main title for the plot</p>
</td></tr>
<tr><td><code id="descriptive_+3A_...">...</code></td>
<td>
<p> Further arguments to be passed to methods (see <code>print.default</code> and <code>plot.default</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

 
<p>The <code>plot.descriptive</code> function produces an exploratory heterogeneity graph. 
In the absence of heterogeneity, the relation(s) presented in the graph should be almost linear. 
Convex functions indicate heterogeneity (Baillargeon and Rivest (2007)).      
</p>


<h3>Value</h3>

<table>
<tr><td><code>n</code></td>
<td>
<p> The total number of captured units.</p>
</td></tr>
<tr><td><code>base.freq</code></td>
<td>
<p> A table of basic descriptive statistics. For <code class="reqn">i=1,\ldots,t</code> :<br />
fi: the number of units captured <code class="reqn">i</code> times<br />
ui: the number of units captured for the first time on occasion <code class="reqn">i</code><br />
vi: the number of units captured for the last time on occasion <code class="reqn">i</code><br />
ni: the number of units captured on occasion <code class="reqn">i</code><br />
If <code>dtype="nbcap"</code>, only the the number of units captured <code class="reqn">i</code> times, fi, can be computed.
</p>
</td></tr>
<tr><td><code>m.array</code></td>
<td>
<p> Only if <code>dtype="hist"</code>: A <code class="reqn">t</code> by <code class="reqn">t</code> matrix containing recapture statistics for units 
released on occasion <code class="reqn">i</code>, for <code class="reqn">i=1,\ldots,t</code> :<br />
ni: the number of units released on occasion <code class="reqn">i</code>;<br />
c2: the number of units released on occasion <code class="reqn">i</code> and recaptured for the first time on occasion 2;<br />
...<br />
ct: the number of units released on occasion <code class="reqn">i</code> and recaptured for the first time on occasion <code class="reqn">t</code>;<br />
not recapt: the number of units released on occasion <code class="reqn">i</code> and never recaptured again.<br />
The m.array matrix is used in Mark (see White and Burnham 1999) and MSurge (see Choquet, Reboulet, Pradel, Gimenez, 
and Lebreton 2004) to fit open population models to the data.
</p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p> The function call (object of class &quot;call&quot;).</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p> Louis-Paul Rivest <a href="mailto:Louis-Paul.Rivest@mat.ulaval.ca">Louis-Paul.Rivest@mat.ulaval.ca</a> and Sophie Baillargeon </p>


<h3>References</h3>

 
<p>Baillargeon, S. and Rivest, L.P. (2007) Rcapture: Loglinear models for capture-recapture in R.  <em>Journal of Statistical Software</em>, <b>19</b>(5), <a href="https://doi.org/10.18637/jss.v019.i05">doi:10.18637/jss.v019.i05</a>.
</p>
<p>Choquet, R., Reboulet, A.M., Pradel, R., Gimenez, O. and Lebreton, J.D. (2004). M-Surge: New Software Specifically Designed for Multistate Capture-Recapture Models. <em>Animal Biodiversity and Conservation</em>, <b>27.1</b>, 207&ndash;215.
</p>
<p>Hoaglin, D. C. (1980) A Poissonness Plot, <em>The American Statistician</em>, <b>34</b>, 146&ndash;149
</p>
<p>Lindsay, B. G. (1986) Exponential family mixture models (with least-squares estimators).  <em> Annals of Statistics</em>, <b>14</b>, 124&ndash;137.
</p>
<p>Rivest, L.P. (2008) Why a time effect often has a limited impact on capture-recapture estimates in closed populations. <em>Canadian Journal of Statistics</em>, <b>36</b>(1), 75&ndash;84.
</p>
<p>White, G. and Burnham, K.P. (1999) Program Mark: Survival Estimation from Populations of Marked Animals. <em>Bird Study</em>, <b>46</b> (Supplement), 120&ndash;138. The software can be downloaded here: <a href="http://www.phidot.org/software/mark/">http://www.phidot.org/software/mark/</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># hare data set
hare.desc &lt;- descriptive(hare)
hare.desc
plot(hare.desc)

# cbird data set
cbird.desc1 &lt;- descriptive(cbird, dfreq = TRUE, dtype = "nbcap", t = 11)
plot(cbird.desc1)
# To illustrate the option t = Inf.
cbird.desc2 &lt;- descriptive(cbird, dfreq = TRUE, dtype = "nbcap", t = Inf)
plot(cbird.desc2)
# The y coordinate has changed.
</code></pre>

<hr>
<h2 id='duck'>  Eider Duck Data </h2><span id='topic+duck'></span>

<h3>Description</h3>

<p>This data set contains capture-recapture data for eider ducks. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>duck</code></pre>


<h3>Format</h3>

<p>63 by 7 numeric matrix, with the following columns:
</p>

<dl>
<dt><code>p1</code>, <code>p2</code>, <code>p3</code>, <code>p4</code>, <code>p5</code>, <code>p6</code></dt><dd><p> Capture histories from six periods</p>
</dd>
<dt><code>freq</code></dt><dd><p> Observed frequencies for each capture history</p>
</dd>
</dl>



<h3>Details</h3>

<p>The data points are extracted from a 25-year study by Coulson (1984). The capture periods are six consecutive years : years 19-24. 
This data set is analyzed in Cormack (1989).
</p>
<p>Each row of this data set represents an observed capture history followed by its frequency. 
</p>


<h3>Source</h3>

<p>Coulson, J. C. (1984) The population dynamics of the Eider Duck <em>Somateria mollissima</em> and evidence of extensive non breeding by adults ducks. <em>Ibis</em>, <b>126</b>, 525&ndash;543.
</p>


<h3>References</h3>

<p>Baillargeon, S. and Rivest, L.P. (2007) Rcapture: Loglinear models for capture-recapture in R.  <em>Journal of Statistical Software</em>, <b>19</b>(5), <a href="https://doi.org/10.18637/jss.v019.i05">doi:10.18637/jss.v019.i05</a>.
</p>
<p>Cormack, R. M. (1989) Loglinear models for capture-recapture. <em>Biometrics</em>, <b>45</b>, 395&ndash;413.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>op.m1 &lt;- openp(duck, dfreq = TRUE)
op.m1$model.fit
  # The pvalue of the goodness of fit test based on the deviance is
1 - pchisq(op.m1$model.fit[1, 1], df = 49)
plot(op.m1)
  # The residual plot shows a large residual for the 13 individuals 
  # captured all the times. We redo the analysis without them.

keep2 &lt;- rowSums(histpos.t(6)) != 6
op.m2 &lt;- openp(duck, dfreq = TRUE, keep = keep2)
op.m2$model.fit
1 - pchisq(op.m2$model.fit[1, 1],df = 48)
  # The fit is still not satisfactory.
plot(op.m2)
  # The residual plot has the convex shape characteristic of 
  # heterogeneity in the capture probabilities. We also remove the 
  # individuals caught at 5 periods out of 6.

keep3 &lt;- rowSums(histpos.t(6)) &lt; 5
op.m3 &lt;- openp(duck, dfreq = TRUE, keep = keep3)
op.m3$model.fit
1 - pchisq(op.m3$model.fit[1, 1], df = 42)
  # The fit is better but there is still heterogeneity in the data. 

  # To investigate whether the capture probabilities are homogeneous, 
  # one can fit a model with equal capture probabilities.
op.m4 &lt;- openp(duck, dfreq = TRUE, m = "ep", keep = keep3)
op.m4$model.fit
  # It gives a much larger deviance; this model is not considered anymore.

  # We now investigate models for the growth rate N[i+1]/N[i] of this 
  # population using the multivariate normal distribution for the 
  # abundance estimates. The growth rates and their standard errors are
growth &lt;- op.m3$N[3:5]/op.m3$N[2:4]
partial &lt;- matrix(c(-op.m3$N[3]/op.m3$N[2]^2, 1/op.m3$N[2], 0, 0,
                    0, -op.m3$N[4]/op.m3$N[3]^2, 1/op.m3$N[3], 0,
		                0, 0, -op.m3$N[5]/op.m3$N[4]^2, 1/op.m3$N[4]), 3, 4, byrow = TRUE)
sig &lt;- partial %*% op.m3$cov[9:12, 9:12] %*% t(partial)
cbind(estimate = growth, stderr = sqrt(diag(sig)))
  # An estimate for the common growth rate is
siginv &lt;- solve(sig)
growth.e &lt;- t(rep(1, 3)) %*% siginv %*% growth/(t(rep(1, 3)) %*% siginv %*% rep(1, 3))
se &lt;- 1/sqrt(t(rep(1, 3)) %*% siginv %*% rep(1, 3))
cbind(estimate = growth.e, stderr = se)
  # A chi-square statistic for testing the equality of the growth rates 
  # and its pvalue
chisq2 &lt;- t(growth - as.vector(growth.e)) %*% siginv %*% (growth - as.vector(growth.e))
c(chi2stat = chisq2, pvalue = 1 - pchisq(chisq2, df = 2))
  # The hypothesis of a common growth rate is rejected
</code></pre>

<hr>
<h2 id='hare'>  Snowshoe Hare Data </h2><span id='topic+hare'></span>

<h3>Description</h3>

<p>This data set contains capture-recapture data for snowshoe hares. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hare</code></pre>


<h3>Format</h3>

<p>68 by 6 numeric matrix, with the following columns:
</p>

<dl>
<dt><code>c1</code>, <code>c2</code>, <code>c3</code>, <code>c4</code>, <code>c5</code>, <code>c6</code></dt><dd><p>Capture histories from the six capture occasions</p>
</dd>
</dl>



<h3>Details</h3>

<p>This data set is analyzed in Cormack (1989) and Agresti (1994).
</p>
<p>Each row of this data set represents the capture history of one animal. 
</p>


<h3>References</h3>

<p>Agresti, A.  (1994) Simple capture-recapture models permitting unequal catchability and variable sampling effort. <em>Biometrics</em>, <b>50</b>, 494&ndash;500.
</p>
<p>Baillargeon, S. and Rivest, L.P. (2007) Rcapture: Loglinear models for capture-recapture in R.  <em>Journal of Statistical Software</em>, <b>19</b>(5), <a href="https://doi.org/10.18637/jss.v019.i05">doi:10.18637/jss.v019.i05</a>.
</p>
<p>Cormack, R. M. (1989) Loglinear models for capture-recapture. <em>Biometrics</em>, <b>45</b>, 395&ndash;413.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>desc &lt;- descriptive(hare)
plot(desc)
  # The fi plot shows that the two animals caught on all occasions create 
  # some heterogeneity in the capture probabilities.

closedp(hare)
  # The best fitting model Mth Poisson2(N = 81.1, s.e. = 5.7) has an AIC of 146. 
closedpCI.t(hare, m = "Mth", h = "Poisson", h.control = list(theta = 2))

  # One can compare the fit of this model with that obtained by removing the
  # 2 hares caught 6 times. This can be done by adding a column to the design 
  # matrix for Mt taking the value 1 for the capture history (1,1,1,1,1,1).
col &lt;- rep(0, 2^6-1)
mat &lt;- histpos.t(6)
col[rowSums(mat) == 6] &lt;- 1
closedpCI.t(hare, mX = cbind(mat, col), mname = "Mt without 111111")
  # This gives N = 76.8 (s.e. = 3.9) with an AIC of 146.
</code></pre>

<hr>
<h2 id='histpos'> Possible Capture Histories  </h2><span id='topic+histpos'></span><span id='topic+histpos.t'></span><span id='topic+histpos.0'></span>

<h3>Description</h3>

 
<p><code>histpos.t</code> builds the matrix of observable capture histories in terms of captures and misses for a capture-recapture 
experiment with <code>t</code> capture occasions.
</p>
<p><code>histpos.0</code> builds the matrix of observable capture histories in terms of number of captures for each primary period of 
a robust design with <code>vt</code> capture occasions. For closed populations, <code>vt=t</code> and <code>histpos.0</code> simply returns <code>t:1</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>histpos.t(t)
histpos.0(vt)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="histpos_+3A_t">t</code></td>
<td>
<p> The number of capture occasions. </p>
</td></tr>
<tr><td><code id="histpos_+3A_vt">vt</code></td>
<td>
<p> A vector containing the numbers of capture occasions for each primary sampling period of a robust design. 
The length of this vector equals the number of primary sampling periods (noted <code class="reqn">I</code>). </p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>histpos.t</code> gives a <code class="reqn">2^t-1</code> by <code class="reqn">t</code> matrix with rows representing capture histories. This matrix contains only 
zeros and ones.
</p>
<p><code>histpos.0</code> gives a <code class="reqn">(t_1+1)\times(t_2+1)\times \ldots \times(t_I+1)-1</code> by 
<code class="reqn">I</code> matrix with rows representing possible capture histories in terms of number of captures. This matrix elements are 
integers between 0 and <code class="reqn">t_i</code> inclusively. 
</p>


<h3>Note</h3>

 
<p>The <code>histpos.t</code> function is called by <code><a href="#topic+descriptive">descriptive</a></code>, <code><a href="#topic+closedp">closedp</a></code>, <code><a href="#topic+closedp.bc">closedp.bc</a></code>, <code><a href="#topic+closedp.Mtb">closedp.Mtb</a></code>, <code><a href="#topic+openp">openp</a></code>, <code><a href="#topic+robustd.t">robustd.t</a></code>.
</p>
<p>The <code>histpos.0</code> function is called by <code><a href="#topic+robustd.0">robustd.0</a></code>.
</p>


<h3>Author(s)</h3>

<p> Louis-Paul Rivest <a href="mailto:Louis-Paul.Rivest@mat.ulaval.ca">Louis-Paul.Rivest@mat.ulaval.ca</a> and Sophie Baillargeon </p>


<h3>References</h3>

<p>Baillargeon, S. and Rivest, L.P. (2007) Rcapture: Loglinear models for capture-recapture in R.  <em>Journal of Statistical Software</em>, <b>19</b>(5), <a href="https://doi.org/10.18637/jss.v019.i05">doi:10.18637/jss.v019.i05</a>.
</p>


<h3>See Also</h3>

 <p><code><a href="#topic+periodhist">periodhist</a></code>, <code><a href="#topic+descriptive">descriptive</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>histpos.t(5)
histpos.0(5)

histpos.0(rep(5, 3))
</code></pre>

<hr>
<h2 id='HIV'> Epidemiological capture-recapture Data on HIV</h2><span id='topic+HIV'></span>

<h3>Description</h3>

<p>Epidemiological capture-recapture data on HIV from four reporting centers in Rome, Italy.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HIV</code></pre>


<h3>Format</h3>

<p>15 by 5 numeric matrix, with the following columns:
</p>

<dl>
<dt><code>c1</code>, <code>c2</code>, <code>c3</code>, <code>c4</code></dt><dd><p> Capture histories from the four capture occasions</p>
</dd>
<dt><code>freq</code></dt><dd><p> Observed frequencies for each capture history</p>
</dd>
</dl>



<h3>Details</h3>

<p>The capture histories were obtained by linking the records of the four reporting centers. 
</p>
<p>Each row of this data set represents an observed capture history followed by its frequency. 
</p>


<h3>Source</h3>

<p>Abeni, D.A., Brancato, G. and Perucci, C. A. (1994) Capture-recapture to estimate the size of the population with human immunodeficiency virus type 1 infection.  <em>Epidemiology</em>, <b>5</b>, 410&ndash;414.
</p>


<h3>References</h3>

<p>Baillargeon, S. and Rivest, L.P. (2007) Rcapture: Loglinear models for capture-recapture in R.  <em>Journal of Statistical Software</em>, <b>19</b>(5), <a href="https://doi.org/10.18637/jss.v019.i05">doi:10.18637/jss.v019.i05</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>desc &lt;- descriptive(HIV, dfreq=TRUE)
desc
  # 1774 out of 1896 individuals (94%) appear on one list only.

plot(desc)
  # The fi plot is linear showing that heterogeneity is not a problem.  
  # Models with a time (or list) effect and possible pairwise dependencies 
  # between lists will be considered.

cp.m1 &lt;- closedpCI.t(HIV, dfreq = TRUE, mX = ~ (c1+c2+c3+c4)^2, 
                     mname = "Mt double interaction")
cp.m1
  # The model fits well. Let's find out which interactions are important.
summary(cp.m1$fit)$coefficients
  # Eliminating the non significant interactions stepwise shows that only 
  # the [1,2] interaction is important.

closedpCI.t(HIV, dfreq = TRUE, mX = ~ . + c1:c2, mname = "Mt interaction 1,2")
</code></pre>

<hr>
<h2 id='ill'>
Illegal immigrants in the Netherlands
</h2><span id='topic+ill'></span>

<h3>Description</h3>

<p>This data set contains the frequency <code class="reqn">f_i</code> that an illegal immigrant who is not
effectively expelled is apprehended exactly <code class="reqn">i</code> times.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ill</code></pre>


<h3>Format</h3>

<p>6 by 2 numeric matrix, with the following columns:
</p>

<dl>
<dt><code>nbcap</code></dt><dd><p> Numbers of captures, i.e. number of times an illegal immigrant is apprehended by the police</p>
</dd>
<dt><code>freq</code></dt><dd><p> Observed frequencies for each number of captures</p>
</dd>
</dl>



<h3>Details</h3>

<p>Bohning and Schon (2005) presented this data set as follows:<br />
The illegal immigrant data are from van der Heijden et al. (2003) and refer to count data on
illegal immigrants in four large cities in the Netherlands who could not be effectively expelled
from the country. Illegal immigrants who are apprehended by the police often cannot be effectively
expelled because either they refuse to disclose their nationality or their home country does
not cooperate in receiving them back. In such cases they will be asked by the police to leave
the country, but it is unlikely that they will abide by this request. The data were collected by the
police and date back to the year 1995.
</p>


<h3>Source</h3>

<p>van der Heijden, P.G.M., Cruyff, M. and van Houwelingen, H.C. (2003) Estimating the size of a criminal population from police records using the truncated Poisson regression model. <em>Statistica Neerlandica</em>, <b>57</b>(3), 289-304.
</p>


<h3>References</h3>

<p>Bohning, D. and Schon, D. (2005) Nonparametric Maximum Likelihood Estimation of Population Size Based on the Counting Distribution. <em>Journal of the Royal Statistical Society: Series C (Applied Statistics)</em>, <b>54</b>(4), 721-737.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sdesc &lt;- descriptive(ill, dtype = "nbcap", dfreq = TRUE, t = Inf)
plot(sdesc)
   # A mixture model looks appropriate

closedp.0(ill, dtype = "nbcap", dfreq = TRUE, t = Inf)

   # We can try to fit a normal mixture model:
closedpCI.0(ill, dtype = "nbcap", dfreq = TRUE, t = Inf, m = "Mh", h = "Normal")
   # We get an estimate similar to the Mh Gamma3.5 estimate.

   # Estimates are highly variable and it seems difficult to come up with a
   # definitive answer. The lower bound estimate is useful in this context.
closedpCI.0(ill, dtype = "nbcap", dfreq = TRUE, t = Inf, m = "Mh", h = "LB")
   # Considering the lower limit of a 95% confidence estimate for the lower bound, 
   # there should be at least 8 000 illegal immigrants in the Netherlands. 
   # Less than 25% have been caught.
</code></pre>

<hr>
<h2 id='lesbian'> Epidemiological capture-recapture Data on the lesbian population</h2><span id='topic+lesbian'></span>

<h3>Description</h3>

<p>Epidemiological capture-recapture data on the lesbian population from four four organisations
that serve the lesbian and gay population of Allegheny County, Pennsylvania, United States and maintain large mailing lists.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lesbian</code></pre>


<h3>Format</h3>

<p>15 by 5 numeric matrix, with the following columns:
</p>

<dl>
<dt><code>A</code>, <code>B</code>, <code>C</code>, <code>D</code></dt><dd><p> Capture histories from the four organisations mailling lists</p>
</dd>
<dt><code>freq</code></dt><dd><p> Observed frequencies for each capture history</p>
</dd>
</dl>



<h3>Details</h3>

<p>The capture histories were obtained by matching the names on the four mailling lists. 
</p>
<p>Each row of this data set represents an observed capture history followed by its frequency. 
</p>


<h3>Source</h3>

<p>Aaron, D.J., Chang, Y.-F., Markovic, N., LaPorte, R. E. (2003) Estimating the lesbian population: a capture-recapture approach. <em>Journal of Epidemiology and Community Health </em>, <b>57</b>(3), 207&ndash;209.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>closedp(lesbian, dfreq = TRUE)

# According to the BIC, the best model is Mth Darroch.
# Let's see if adding  interactions between capture 
# histories to the model could improve the model's fit.

closedpMS.t(lesbian, dfreq = TRUE, h = "Darroch")

# According to the BIC, the best heterogeneous Darroch model
# contains the double interactions 12, 13, 14. 
</code></pre>

<hr>
<h2 id='mvole'>  Robust Design Data for Adult Male Meadow Voles </h2><span id='topic+mvole'></span>

<h3>Description</h3>

<p>This data set contains robust design capture history data for adult male meadow voles. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mvole</code></pre>


<h3>Format</h3>

<p>171 by 30 numeric matrix, with the following columns:
</p>

<dl>
<dt><code>c11</code>, <code>c12</code>, <code>c13</code>, <code>c14</code>, <code>c15</code></dt><dd><p>Capture histories from the 5 capture occasions within primary period 1</p>
</dd>
<dt><code>c21</code>, <code>c22</code>, <code>c23</code>, <code>c24</code>, <code>c25</code></dt><dd><p>Capture histories from the 5 capture occasions within primary period 2</p>
</dd>
<dt><code>c31</code>, <code>c32</code>, <code>c33</code>, <code>c34</code>, <code>c35</code></dt><dd><p>Capture histories from the 5 capture occasions within primary period 3</p>
</dd>
<dt><code>c41</code>, <code>c42</code>, <code>c43</code>, <code>c44</code>, <code>c45</code></dt><dd><p>Capture histories from the 5 capture occasions within primary period 4</p>
</dd>
<dt><code>c51</code>, <code>c52</code>, <code>c53</code>, <code>c54</code>, <code>c55</code></dt><dd><p>Capture histories from the 5 capture occasions within primary period 5</p>
</dd>
<dt><code>c61</code>, <code>c62</code>, <code>c63</code>, <code>c64</code>, <code>c65</code></dt><dd><p>Capture histories from the 5 capture occasions within primary period 6</p>
</dd>
</dl>



<h3>Details</h3>

<p>The data set is extracted from Table 19.1 of Williams, Nichols and Conroy (2002). The capture occasions represent five 
consecutive days of trapping each month from June to December 1981 at Patuxent Wildlife Research Center, Laurel, Maryland.
</p>
<p>Each row of this data set represents the capture history of one animal. 
</p>


<h3>Note</h3>

<p>In this data set, ten animals are in fact not released after capture. These trap deaths are not identified. 
</p>


<h3>Source</h3>

<p>Williams, B.K., Nichols, J.D., and Conroy, M.J. (2002) <em>Analysis and Management of Animal Populations</em>, San Diego: Academic Press.
</p>


<h3>References</h3>

<p>Baillargeon, S. and Rivest, L.P. (2007) Rcapture: Loglinear models for capture-recapture in R.  <em>Journal of Statistical Software</em>, <b>19</b>(5), <a href="https://doi.org/10.18637/jss.v019.i05">doi:10.18637/jss.v019.i05</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # This example deals only with the first four primary periods of the data set.
mvole4 &lt;- mvole[, 1:20]

  # First, a between primary period Jolly-Seber analysis is obtained.
mvole4.pp &lt;- periodhist(mvole4, vt = rep(5,4))
op.m1 &lt;- openp(mvole4.pp, dfreq = TRUE)
plot(op.m1)
  # There is one large residual, removing the corresponding capture history 
  # from the analysis does not change the results.  The model fits well.
keep2 &lt;- residuals(op.m1$glm, type = "pearson") &lt; 4
op.m2 &lt;- openp(mvole4.pp, dfreq = TRUE, keep = keep2)
op.m2$model.fit

  # To find a suitable model within each primary period, the function closedp.t
  # can be used repeatedly. Heterogeneity is detected in all periods except
  # the second one where the data collection was perturbed (the last capture
  # occasion doesn't have any new capture and is taken out of the analysis). 

  # In a robust design, we use Mh models for all primary periods bearing in
  # mind the questionable fit in the second one. Since there is no time effect 
  # within primary periods, we use the function robustd.0 to fit the model.
  ### The following command might take a few minutes to run.
rd.m1 &lt;- robustd.0(mvole4[, -10], vt = c(5, 4, 5, 5), vm = "Mh", vh = "Chao")
rd.m1$model.fit
rd.m1$emig.fit
  # The test for temporary immigration is not significant meaning that capture 
  # probabilities estimated with the Jolly-Seber model are not different from 
  # those estimated with the individual closed population models. The 
  # differences, on the logit scale, of the Jolly-Seber minus the closed 
  # population models capture probabilities are
rd.m1$emig.param
  # Even in period 2, where the closed population model does not fit well, the 
  # difference on the logit scale is non significant (estimate=.56, s.e.=1.13). 

  # The following command allows to fit a robust design that does not specify 
  # any model for the second period.
  ### The following command might take a few minutes to run.
rd.m3 &lt;- robustd.0(mvole4[, -10], vt = c(5, 4, 5, 5), 
                   vm = c("Mh", "none", "Mh", "Mh"), vh = "Chao")

  # With Darroch's model, the closed population estimates of the capture 
  # probabilities are significantly smaller than those obtained from the 
  # Jolly-Seber model.  This cannot be interpreted as indicating temporary 
  # immigration. This suggests that Darroch's model is not appropriate within
  # primary sessions.

  # The smallest AIC is obtained with the Poisson model, with parameter a=1.5 
  # within sessions.
rd.m4 &lt;- robustd.0(mvole4[, -10], vt = c(5, 4, 5, 5), vm = "Mh", 
                   vh = "Poisson", vtheta = 1.5)
  # The estimators of the demographic parameters obtained with the robust design 
  # are similar to those obtained with the Jolly-Seber model applied to the 
  # between primary period data.
cbind(op.m1$survivals, rd.m4$survivals)
cbind(op.m1$N, rd.m4$N)
cbind(op.m1$birth, rd.m4$birth)
cbind(op.m1$Ntot, rd.m4$Ntot)
</code></pre>

<hr>
<h2 id='openp'> Loglinear Models for Open Population Capture-Recapture Experiments  </h2><span id='topic+openp'></span><span id='topic+print.openp'></span><span id='topic+plot.openp'></span>

<h3>Description</h3>

<p>This function computes various demographic parameters using a loglinear model for open populations in capture-recapture experiments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>openp(X, dfreq=FALSE, m=c("up","ep"), neg=TRUE, keep=rep(TRUE,2^I-1))

## S3 method for class 'openp'
print(x, ...)

## S3 method for class 'openp'
plot(x, main="Scatterplot of Pearson Residuals", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="openp_+3A_x">X</code></td>
<td>
<p> The matrix of the observed capture histories (see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> for a description of the accepted formats).  </p>
</td></tr>
<tr><td><code id="openp_+3A_dfreq">dfreq</code></td>
<td>
<p> A logical. By default FALSE, which means that <code>X</code> has one row per unit. If TRUE, it indicates that the 
matrix <code>X</code> contains frequencies in its last column.</p>
</td></tr>
<tr><td><code id="openp_+3A_m">m</code></td>
<td>
<p> This argument is a character string taking the value &quot;up&quot; (up = unconstrained probabilities) or &quot;ep&quot; (ep = equal 
probabilities). If <code>m</code> is set to &quot;up&quot; (the default), no constraint is set on the loglinear parameters. Therefore 
some loglinear and demographic parameters are not estimable. On the other hand, when <code>m</code> takes the value &quot;ep&quot;, 
the capture probabilities are set to a common value; this enables the estimation of all the parameters.</p>
</td></tr>
<tr><td><code id="openp_+3A_keep">keep</code></td>
<td>
<p> This option is useful to fit the model on a subset of the possible capture histories. <code>keep</code> is a logical 
vector of length <code class="reqn">2^I-1</code> taking the value TRUE for a history kept and FALSE for a history put aside. In this 
vector, the order of the capture histories is as defined in the <code>histpos.t</code> function. By default, every capture 
history is kept. </p>
</td></tr>
<tr><td><code id="openp_+3A_neg">neg</code></td>
<td>
<p> If this option is set to TRUE, relevant negative gamma parameters are set to zero. This insures that the estimated 
survival probabilities belong to [0, 1] and that the births are positive.</p>
</td></tr>
<tr><td><code id="openp_+3A_x">x</code></td>
<td>
<p> An object, produced by the <code>openp</code> function, to print or to plot.</p>
</td></tr>
<tr><td><code id="openp_+3A_main">main</code></td>
<td>
<p> A main title for the plot</p>
</td></tr>
<tr><td><code id="openp_+3A_...">...</code></td>
<td>
<p> Further arguments to be passed to methods (see <code>print.default</code> and <code>plot.default</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function <code>openp</code> generates statistics to test the presence of a trap effect.
</p>
<p>The <code>plot.openp</code> function produces a scatterplot of the Pearson residuals of the model versus the frequencies of capture.
</p>
<p>If the data matrix <code>X</code> was obtained through the <code>periodhist</code> function, the <code>dfreq</code> argument must be set to TRUE.
</p>
<p>Standard errors are calculated by linearization.
</p>


<h3>Value</h3>

<table>
<tr><td><code>n</code></td>
<td>
<p> The number of captured units</p>
</td></tr>
<tr><td><code>model.fit</code></td>
<td>
<p> A table containing the deviance, degrees of freedom and AIC of the fitted model.</p>
</td></tr>
<tr><td><code>trap.fit</code></td>
<td>
<p> A table containing, for the models with an added trap effect, the deviance, degrees of freedom and AIC.</p>
</td></tr>
<tr><td><code>trap.param</code></td>
<td>
<p> The estimated trap effect parameters and their standard errors. For m=&quot;up&quot;, the <code class="reqn">I-3</code> first rows of 
<code>trap.param</code> are estimations of the differences <code class="reqn">logit</code>(capture probability after a capture)-
<code class="reqn">logit</code>(capture probability after a miss) for periods 3 to <code class="reqn">I-1</code>. The last row gives a pooled 
estimate of these differences calculated under the assumption that they are homogeneous.</p>
</td></tr>
<tr><td><code>capture.prob</code></td>
<td>
<p> The estimated capture probabilities per period and their standard errors.</p>
</td></tr>
<tr><td><code>survivals</code></td>
<td>
<p> The estimated survival probabilities between periods and their standard errors.</p>
</td></tr>
<tr><td><code>N</code></td>
<td>
<p> The estimated population sizes per period and their standard errors. </p>
</td></tr>
<tr><td><code>birth</code></td>
<td>
<p> The estimated number of new arrivals in the population between periods and their standard errors.</p>
</td></tr>
<tr><td><code>Ntot</code></td>
<td>
<p> The estimated total number of units who ever inhabited the survey area and its standard error.</p>
</td></tr> 
<tr><td><code>glm</code></td>
<td>
<p> The 'glm' object obtained from fitting the loglinear model</p>
</td></tr>
<tr><td><code>loglin.param</code></td>
<td>
<p>The loglinear model parameters estimations and their standard errors, calculated by the <code>glm</code> function. </p>
</td></tr>
<tr><td><code>u.vector</code></td>
<td>
<p>The Ui statistics, useful for the survival probabilities calculation, and their standard errors</p>
</td></tr>
<tr><td><code>v.vector</code></td>
<td>
<p>The Vi statistics, useful for the population sizes estimation, and their standard errors</p>
</td></tr>
<tr><td><code>cov</code></td>
<td>
<p> The covariance matrix of all the demographic parameters estimates. </p>
</td></tr>
<tr><td><code>neg</code></td>
<td>
<p> The position of the gamma parameters set to zero in the loglinear parameter vector.</p>
</td></tr>
</table>


<h3>Note</h3>

 
<p>If your data contains more than one capture occasion within primary periods, use the <code><a href="#topic+periodhist">periodhist</a></code> function to create the input data matrix <code>X</code> needed by the <code>openp</code> function.
</p>
<p>This function uses the <code>glm</code> function of the <span class="pkg">stats</span> package. 
</p>


<h3>Author(s)</h3>

<p> Louis-Paul Rivest <a href="mailto:Louis-Paul.Rivest@mat.ulaval.ca">Louis-Paul.Rivest@mat.ulaval.ca</a> and Sophie Baillargeon </p>


<h3>References</h3>

 
<p>Baillargeon, S. and Rivest, L.P. (2007) Rcapture: Loglinear models for capture-recapture in R.  <em>Journal of Statistical Software</em>, <b>19</b>(5), <a href="https://doi.org/10.18637/jss.v019.i05">doi:10.18637/jss.v019.i05</a>.
</p>
<p>Rivest, L.P. and Daigle, G. (2004) Loglinear models for the robust design in mark-recapture experiments. <em>Biometrics</em>, <b>60</b>, 100&ndash;107.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+closedp">closedp</a></code>, <code><a href="#topic+periodhist">periodhist</a></code>, <code><a href="#topic+robustd">robustd</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'># duck data set
op.m1 &lt;- openp(duck, dfreq = TRUE)
plot(op.m1)

# To remove the capture history 111111.
keep2 &lt;- apply(histpos.t(6), 1, sum) != 6
op.m2 &lt;- openp(duck, dfreq = TRUE, keep = keep2)
op.m2

# To remove the capture histories with 5 captures or more
keep3 &lt;- apply(histpos.t(6), 1, sum) &lt; 5
op.m3 &lt;- openp(duck, dfreq = TRUE, keep = keep3)
op.m3


# mvole data set aggregated per primary period
mvole.op &lt;- periodhist(mvole, vt = rep(5, 6))
openp(mvole.op, dfreq = TRUE)
</code></pre>

<hr>
<h2 id='periodhist'>  Merge capture occasions </h2><span id='topic+periodhist'></span>

<h3>Description</h3>

<p>This function produces a reduced matrix of capture histories from a complete one by merging together some capture occasions.
</p>
<p>It can also be used to change the format of a capture-recapture data set with complete capture histories: it transforms a data 
set with one row per captured unit to a data set with one row per capture history followed by its frequency.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>periodhist(X, dfreq=FALSE, vt, drop=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="periodhist_+3A_x">X</code></td>
<td>
<p> The matrix of the observed capture histories (see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> 
for a description of the accepted formats).  </p>
</td></tr>
<tr><td><code id="periodhist_+3A_dfreq">dfreq</code></td>
<td>
<p> A logical. By default FALSE, which means that <code>X</code> has one row per unit. If TRUE, it 
indicates that the matrix <code>X</code> contains frequencies in its last column.</p>
</td></tr>
<tr><td><code id="periodhist_+3A_vt">vt</code></td>
<td>
<p> A vector containing the numbers of capture occasions for each pooled capture occasions. The length of 
this vector equals the number of capture occasions in the reduced matrix (noted <code class="reqn">I</code>). </p>
</td></tr>
<tr><td><code id="periodhist_+3A_drop">drop</code></td>
<td>
<p> A logical, by default TRUE, meaning that in the output matrix the unobserved 
capture histories (frequency of 0) are omitted. To keep them, 
<code>drop</code> must be set to FALSE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is useful when using an open population model to analyze a robust design data set. It can be used to 
reduce the data set to one observation per primary period. A one represents a unit caught at least once during the period 
and a zero a unit never caught.
</p>
<p>It is also useful for experiments with a large number of capture occasions but a limited number of catches,  
especially when there is no capture on some occasions. In such cases, one can pool together some capture occasions 
with the <code>periodhist</code> function.  
</p>
<p>If a data matrix produced by the <code>periodhist</code> function is given as an argument to a <span class="pkg">Rcapture</span> function, 
the <code>dfreq</code> argument must be set to <code>TRUE</code>.
</p>


<h3>Value</h3>

<p>A <code class="reqn">2^I-1</code> by <code class="reqn">I+1</code> matrix of all the pooled capture histories, 
with their observed frequencies. If <code>drop=TRUE</code> (the default), the number of rows
of this matrix is in fact <code class="reqn">2^I-1</code> minus the number of unobserved capture histories.
</p>


<h3>Author(s)</h3>

<p> Louis-Paul Rivest <a href="mailto:Louis-Paul.Rivest@mat.ulaval.ca">Louis-Paul.Rivest@mat.ulaval.ca</a> and Sophie Baillargeon </p>


<h3>References</h3>

<p>Baillargeon, S. and Rivest, L.P. (2007) Rcapture: Loglinear models for capture-recapture in R.  <em>Journal of Statistical Software</em>, <b>19</b>(5), <a href="https://doi.org/10.18637/jss.v019.i05">doi:10.18637/jss.v019.i05</a>.
</p>


<h3>See Also</h3>

 <p><code><a href="#topic+openp">openp</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'># mvole data set aggregated per primary period
mvole.op &lt;- periodhist(mvole, vt = rep(5, 6))
openp(mvole.op, dfreq = TRUE)
</code></pre>

<hr>
<h2 id='profileCI'> Profile Likelihood Confidence Interval for Abundance Estimation in Closed Populations Capture-Recapture Experiments </h2><span id='topic+profileCI'></span><span id='topic+print.profileCI'></span>

<h3>Description</h3>

<p>As of version 1.2-0 of <span class="pkg">Rcapture</span>, this function is deprecated, but kept for back compatibility. Please use <code><a href="#topic+closedpCI.t">closedpCI.t</a></code> instead.
</p>
<p>The <code>profileCI</code> function computes the multinomial profile likelihood for the abundance of some closed population 
capture-recapture models. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>profileCI(X, dfreq=FALSE, m="M0", h="Chao", a=2, mX=NULL, 
          mname="Customized model", neg=TRUE, alpha=0.05)

## S3 method for class 'profileCI'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="profileCI_+3A_x">X</code></td>
<td>
<p> The table of the observed capture histories in one of the two accepted formats. In the default format, it has one 
row per unit captured in the experiment. In this case, the number of columns in the table represents the number of 
capture occasions in the experiment (noted <code class="reqn">t</code>). In the alternative format, it contains one row per capture 
history followed by its frequency. In that case, <code>X</code> has <code class="reqn">t</code>+1 columns. The first <code class="reqn">t</code> columns of <code>X</code>, 
identifying the capture histories, must contain only zeros and ones. The number one indicates a capture. </p>
</td></tr>
<tr><td><code id="profileCI_+3A_dfreq">dfreq</code></td>
<td>
<p> This argument specifies the format of the data matrix <code>X</code>. By default, it is set to &quot;FALSE&quot;, which means that
<code>X</code> has one row per unit. If it is set to TRUE, then the matrix <code>X</code> contains frequencies in its last column.</p>
</td></tr>
<tr><td><code id="profileCI_+3A_m">m</code></td>
<td>
<p> A character string identifying the  model, either &quot;M0&quot;=M0 model, &quot;Mt&quot;=Mt model, &quot;Mh&quot;=Mh model or &quot;Mth&quot;=Mth model.</p>
</td></tr>
<tr><td><code id="profileCI_+3A_h">h</code></td>
<td>
<p> A character string (&quot;Chao&quot; = Chao model, &quot;Poisson&quot; = <code class="reqn">2^k-1</code>), &quot;Darroch&quot; = <code class="reqn">(k^2)/2</code> or a numerical function 
taking only one argument specifying the form of the column for heterogeneity in the design matrix.</p>
</td></tr>
<tr><td><code id="profileCI_+3A_a">a</code></td>
<td>
<p> The value of the exponent's base for a Poisson model. </p>
</td></tr>
<tr><td><code id="profileCI_+3A_mx">mX</code></td>
<td>
<p> The design matrix of the loglinear model. In this matrix, the order of the capture histories is as defined in the 
<code>histpos.t</code> function.</p>
</td></tr>
<tr><td><code id="profileCI_+3A_mname">mname</code></td>
<td>
<p> A character string specifying the name of the customized model.</p>
</td></tr>
<tr><td><code id="profileCI_+3A_neg">neg</code></td>
<td>
<p> If this option is set to TRUE, negative eta parameters in Chao models are set to zero. </p>
</td></tr>
<tr><td><code id="profileCI_+3A_alpha">alpha</code></td>
<td>
<p> A confidence interval with confidence level 1-alpha is constructed. The value of alpha must be between 0 and 1; 
the default is 0.05.  </p>
</td></tr>
<tr><td><code id="profileCI_+3A_x">x</code></td>
<td>
<p> An object, produced by the <code>profileCI</code> function, to print.</p>
</td></tr>
<tr><td><code id="profileCI_+3A_...">...</code></td>
<td>
<p> Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Details</h3>

 
<p>This function does not work for closed population models featuring a behavioral effect, such as Mb and Mbh.
</p>


<h3>Value</h3>

<p>This function produces a plot of the multinomial profile likelihood for N. The value of N maximizing the profile likelihood and 
the bounds of the confidence interval are identified.
It also produces the following objects :
</p>
<table>
<tr><td><code>n</code></td>
<td>
<p> The number of captured units</p>
</td></tr>
<tr><td><code>results</code></td>
<td>
<p> A table containing the abundance estimation and its confidence interval.</p>
</td></tr>
<tr><td><code>alpha</code></td>
<td>
<p> 1-the confidence level of the interval.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p> Louis-Paul Rivest <a href="mailto:Louis-Paul.Rivest@mat.ulaval.ca">Louis-Paul.Rivest@mat.ulaval.ca</a> and Sophie Baillargeon </p>


<h3>References</h3>

 
<p>Baillargeon, S. and Rivest, L.P. (2007) Rcapture: Loglinear models for capture-recapture in R.  <em>Journal of Statistical Software</em>, <b>19</b>(5), <a href="https://doi.org/10.18637/jss.v019.i05">doi:10.18637/jss.v019.i05</a>.
</p>
<p>Cormack, R. M. (1992) Interval estimation for mark-recapture studies of closed populations. <em>Biometrics</em>, <b>48</b>, 567&ndash;576.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+closedp">closedp</a></code>, <code><a href="#topic+closedp.mX">closedp.mX</a></code>, <code><a href="#topic+closedp.h">closedp.h</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'># hare data set
profileCI(hare, m = "Mth", h = "Poisson", a = 2)

# HIV data set
mat &lt;- histpos.t(4)
mX2 &lt;- cbind(mat, mat[, 1] * mat[, 2])

profileCI(hare, m = "Mh", h = "Chao") 
</code></pre>

<hr>
<h2 id='rbvole'> Robust Design Data for Red-Back Voles </h2><span id='topic+rbvole'></span>

<h3>Description</h3>

<p>This data set contains robust design capture history data for red-back voles. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rbvole</code></pre>


<h3>Format</h3>

<p>66 by 19 numeric matrix, with the following columns:
</p>

<dl>
<dt><code>c11</code>, <code>c12</code>, <code>c13</code></dt><dd><p> Capture histories from the three capture occasions within primary period 1</p>
</dd>
<dt><code>c21</code>, <code>c22</code>, <code>c23</code></dt><dd><p> Capture histories from the three capture occasions within primary period 2</p>
</dd>
<dt><code>c31</code>, <code>c32</code>, <code>c33</code></dt><dd><p> Capture histories from the three capture occasions within primary period 3</p>
</dd>
<dt><code>c41</code>, <code>c42</code>, <code>c43</code></dt><dd><p> Capture histories from the three capture occasions within primary period 4</p>
</dd>
<dt><code>c51</code>, <code>c52</code>, <code>c53</code></dt><dd><p> Capture histories from the three capture occasions within primary period 5</p>
</dd>
<dt><code>c61</code>, <code>c62</code>, <code>c63</code></dt><dd><p> Capture histories from the three capture occasions within primary period 6</p>
</dd>
<dt>freq</dt><dd><p> Observed frequencies for each capture history</p>
</dd>
</dl>



<h3>Details</h3>

<p>Data collection was carried out by Etcheverry and al.. The capture occasions represent three consecutive days of trapping in 
May 1999, July 1999, August 1999, May 2000, July 2000 and August 2000 in the Duchenier conservation area in southeastern Quebec. 
This data set is analyzed in Rivest and Daigle (2004).
</p>
<p>Each row of this data set represents an observed capture history followed by its frequency. 
</p>


<h3>References</h3>

<p>Rivest, L.P. and Daigle, G. (2004) Loglinear models for the robust design in mark-recapture experiments. <em>Biometrics</em>, <b>60</b>, 100&ndash;107.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # According to Rivest and Daigle (2004), a good robust design model
  # for this data set is formed of an Mth Chao model for each period.
  # This model can be fitted as follows.
  
### memory.limit(size = 2000)
### rd &lt;- robustd.t(rbvole, dfreq = TRUE, vt = rep(3, 6), vm = "Mth", vh = "Chao")

  # WARNING : Because the data has 18 capture occasions, fitting this
  # model uses a lot of memory. Its runtime is several minutes long.
</code></pre>

<hr>
<h2 id='robustd'> Loglinear Models for Capture-Recapture Experiments Carried Out According to a Robust Design</h2><span id='topic+robustd'></span><span id='topic+robustd.t'></span><span id='topic+robustd.0'></span><span id='topic+print.robustd'></span>

<h3>Description</h3>

<p>These functions compute various demographic parameters and capture probabilities per period using loglinear robust design 
models in capture-recapture experiments.
</p>
<p><code>robustd.t</code> and <code>robustd.0</code> fit the model using different response variable. 
<code>robustd.t</code> uses the frequencies of the observable capture histories in terms of capture success or failure for each 
capture occasions of each primary period. <code>robustd.0</code> uses the frequencies of the observable capture histories in terms 
of number of captures per primary period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>robustd.t(X, dfreq = FALSE, vt, vm = "M0", vh = list("Chao"),
          vtheta = 2, neg = TRUE)

robustd.0(X, dfreq = FALSE, vt, vm = "M0", vh = list("Chao"), 
          vtheta = 2, neg = TRUE)

## S3 method for class 'robustd'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="robustd_+3A_x">X</code></td>
<td>
<p> The matrix of the observed capture histories (see <code><a href="#topic+Rcapture-package">Rcapture-package</a></code> for a description of the accepted formats).  </p>
</td></tr>
<tr><td><code id="robustd_+3A_dfreq">dfreq</code></td>
<td>
<p> A logical. By default FALSE, which means that <code>X</code> has one row per unit. If TRUE, it indicates that the matrix 
<code>X</code> contains frequencies in its last column.</p>
</td></tr>
<tr><td><code id="robustd_+3A_vt">vt</code></td>
<td>
<p> A vector containing the numbers of capture occasions for each primary sampling period. The length of this vector 
equals the number of primary sampling periods (noted <code class="reqn">I</code>). </p>
</td></tr>
<tr><td><code id="robustd_+3A_vm">vm</code></td>
<td>
<p> A vector indicating the closed population model for each primary period. The elements of <code>vm</code> can be &quot;none&quot;=no model, 
&quot;M0&quot;=M0 model, &quot;Mt&quot;=Mt model, &quot;Mh&quot;=Mh model or &quot;Mth&quot;=Mth model for <code>robustd.t</code>. For <code>robustd.0</code>, models with 
time effect are not allowed. So <code>vm</code> can than be &quot;none&quot;=no model, &quot;M0&quot;=M0 model, or &quot;Mh&quot;=Mh model. 
The 'no model' cannot be selected for the first or the last period. If a single character string is given for 
<code>vm</code>, the corresponding model is used for all periods. The default value for <code>vm</code> is &quot;M0&quot; for all period.</p>
</td></tr>
<tr><td><code id="robustd_+3A_vh">vh</code></td>
<td>
<p> A list indicating, for each primary period with a heterogeneity model, the form of the columns for heterogeneity in the 
design matrix. The elements of <code>vh</code> can be &quot;Chao&quot;, &quot;Poisson&quot;, &quot;Darroch&quot; or any numerical <code>R</code> function created 
beforehand by the user. &quot;Chao&quot; represents Chao's model, &quot;Poisson&quot; represents the function <code class="reqn">f(k)=theta^k-1</code>, 
where <code class="reqn">k</code> is the number of captures, &quot;Darroch&quot; represents the function <code class="reqn">f(k)=k^2/2</code>, and &quot;Gamma&quot; represents 
the function <code class="reqn">f(k)=-\log(theta + k) + \log(theta)</code>. If an <code>R</code> function is 
given, it is the implementation of any convex mathematical function <code class="reqn">f(k)</code>. It has only one argument. For the Poisson 
or Gamma model, the parameter <code>theta</code> is specified in the argument <code>vtheta</code>. </p>
</td></tr>
<tr><td><code id="robustd_+3A_vtheta">vtheta</code></td>
<td>
<p> A vector indicating, for each primary period with a Poisson or Gamma heterogeneity model, the value of the parameter. 
If  <code>vtheta</code> consists of a single number, this number is used for all the periods with a Poisson or Gamma model. 
The default value for <code>vtheta</code> is 2 for all the periods with a Poisson or Gamma model. </p>
</td></tr>
<tr><td><code id="robustd_+3A_neg">neg</code></td>
<td>
<p> If this option is set to TRUE, negative gamma parameters and negative eta parameters in Chao's models are set to zero. 
This insures that the estimated survival probabilities belong to [0, 1] and that the births are positive.</p>
</td></tr>
<tr><td><code id="robustd_+3A_x">x</code></td>
<td>
<p> An object, produced by the <code>robustd.t</code> or the <code>robustd.0</code> function, to print.</p>
</td></tr>
<tr><td><code id="robustd_+3A_...">...</code></td>
<td>
<p> Further arguments to be passed to <code>print.default</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These functions also generate statistics to test the presence of temporary emigration.
</p>
<p>The Poisson regression used to fit a robust design model has one entry for each possible capture history, including those that are 
unobserved.  The size of the dependent vector is therefore <code class="reqn">2^{\mbox{sum(vt)}}-1</code> for <code>robustd.t</code>. 
Models with a large sum(vt) are hard to fit with <code>robustd.t</code>. <code>robustd.0</code> uses a more parsimonious coding for the capture 
histories and can fit larger models.
</p>
<p>Standard errors are calculated by linearization.
</p>


<h3>Value</h3>

<table>
<tr><td><code>n</code></td>
<td>
<p> The number of captured units</p>
</td></tr>
<tr><td><code>models</code></td>
<td>
<p> A vector of length <code class="reqn">I</code> identifying the closed population models chosen for each period.</p>
</td></tr>
<tr><td><code>model.fit</code></td>
<td>
<p> A table containing the deviance, degrees of freedom and AIC of the fitted model.</p>
</td></tr>
<tr><td><code>emig.fit</code></td>
<td>
<p> A table containing, for the model with an added temporary emigration effect, the deviance, the degrees of freedom 
and the Akaike's information criterion.</p>
</td></tr>
<tr><td><code>emig.param</code></td>
<td>
<p> The estimated temporary emigration parameters and their standards errors. The <code class="reqn">I-1</code> first rows are 
estimations of the differences <code class="reqn">logit(p^b)-logit(p^w)</code> for periods 2 to <code class="reqn">I-1</code> (<code class="reqn">p^b</code> represents 
a between primary period and <code class="reqn">p^w</code> a within primary period estimate of the capture probability). The last 
row gives a pooled estimate of these differences calculated under the assumption that they are homogeneous. 
Negative estimates are associated with a temporary emigration.</p>
</td></tr>
<tr><td><code>capture.prob</code></td>
<td>
<p> The estimated capture probabilities per period and their standard errors.</p>
</td></tr>
<tr><td><code>survivals</code></td>
<td>
<p> The estimated survival probabilities between periods and their standard errors.</p>
</td></tr>
<tr><td><code>N</code></td>
<td>
<p> The estimated population sizes per period and their standard errors. </p>
</td></tr>
<tr><td><code>birth</code></td>
<td>
<p> The estimated number of new arrivals in the population between periods and their standard errors.</p>
</td></tr>
<tr><td><code>Ntot</code></td>
<td>
<p> The estimated total number of units who ever inhabited the survey area and its standard error.</p>
</td></tr> 
<tr><td><code>loglin.param</code></td>
<td>
<p>The loglinear model parameters estimations and their standard errors, calculated by the <code>glm</code> function. </p>
</td></tr>
<tr><td><code>u.vector</code></td>
<td>
<p>The Ui statistics, useful for the survival probabilities calculation, and their standard errors</p>
</td></tr>
<tr><td><code>v.vector</code></td>
<td>
<p>The Vi statistics, useful for the population sizes estimation, and their standard errors</p>
</td></tr>
<tr><td><code>cov</code></td>
<td>
<p> The covariance matrix of all the demographic parameters estimates. </p>
</td></tr>
<tr><td><code>neg</code></td>
<td>
<p> The position of the gamma and eta parameters set to zero in the loglinear parameter vector.</p>
</td></tr>
</table>


<h3>Note</h3>

 
<p>This function uses the <code>glm</code> function of the <span class="pkg">stats</span> package. 
</p>


<h3>Author(s)</h3>

<p> Louis-Paul Rivest <a href="mailto:Louis-Paul.Rivest@mat.ulaval.ca">Louis-Paul.Rivest@mat.ulaval.ca</a> and Sophie Baillargeon </p>


<h3>References</h3>

 
<p>Baillargeon, S. and Rivest, L.P. (2007) Rcapture: Loglinear models for capture-recapture in R.  <em>Journal of Statistical Software</em>, <b>19</b>(5), <a href="https://doi.org/10.18637/jss.v019.i05">doi:10.18637/jss.v019.i05</a>.
</p>
<p>Rivest, L.P. and Daigle, G. (2004) Loglinear models for the robust design in mark-recapture experiments. <em>Biometrics</em>, <b>60</b>, 100&ndash;107.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+closedp">closedp</a></code>, <code><a href="#topic+openp">openp</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>  # The mvole data set contains a total of 30 capture occasions (the 
  # tenth capture occasion doesn't have any new capture and is taken
  # out of the analysis). This number being large, we can only use 
  # the robustd.0 function to fit a robust design model.

  # Not run :
# robustd.0(mvole[, -10], vt = c(5, 4, rep(5, 4)), vm = "Mh", vh = "Poisson", vtheta = 1.5)
  # Should take a few seconds to run.

  # Not run: 
# robustd.t(mvole[, -10], vt = c(5, 4, rep(5, 4)), vm = 'Mh', vh = 'Poisson', vtheta = 1.5)
  # Should fail.

  # Considering only the first 3 periods of the data set, we can use the 
  # robustd.t function to fit a model with a temporal effect.
robustd.t(mvole[, c(1:9, 11:15)], vt = c(5, 4, 5), vm = "Mth", vh = "Poisson", vtheta = 1.5)
</code></pre>

<hr>
<h2 id='uifit'> Closed Population Models Fit Statistics Concerning the ui </h2><span id='topic+uifit'></span>

<h3>Description</h3>

<p>This function produces fit statistics concerning the <code class="reqn">u_i</code>, i.e. the numbers of first captures on each capture occasion, 
for closed population models. It also forecasts, for some models, the number of additional units that would be captured if the 
experiment was continued for five more occasions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>uifit(x.closedp)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="uifit_+3A_x.closedp">x.closedp</code></td>
<td>
<p> An object produced by the <code>closedp.t</code> function. </p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>predicted</code></td>
<td>
<p> The observed and predicted values of the ui frequencies, <code class="reqn">i = 1,\ldots,t</code>, for each model in <code>closedp</code>. 
For models M0, Mh Poisson2, Mh Darroch and Mb, predicted values are also extrapolated for <code class="reqn">i = t+1,\ldots,t+5</code>.</p>
</td></tr>
<tr><td><code>fit.stat</code></td>
<td>
<p> Chi-square fit statistics for each model in <code>closedp</code> 
<code class="reqn">(\sum_{i=1}^t \frac{(\mbox{observed}_i -\mbox{predicted}_i)^2}{\mbox{predicted}_i})</code>.</p>
</td></tr>
<tr><td><code>day.first.capt</code></td>
<td>
<p> The mean and variance of the day of first capture, calculated with the observed and predicted <code class="reqn">u_i</code>, 
for each model in <code>closedp.t</code>. </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p> Louis-Paul Rivest <a href="mailto:Louis-Paul.Rivest@mat.ulaval.ca">Louis-Paul.Rivest@mat.ulaval.ca</a> and Sophie Baillargeon </p>


<h3>References</h3>

<p>Baillargeon, S. and Rivest, L.P. (2007) Rcapture: Loglinear models for capture-recapture in R.  <em>Journal of Statistical Software</em>, <b>19</b>(5), <a href="https://doi.org/10.18637/jss.v019.i05">doi:10.18637/jss.v019.i05</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+closedp">closedp</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'># Third primary period of mvole data set
period3 &lt;- mvole[, 11:15]
cp &lt;- closedp(period3)
uifit(cp)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
