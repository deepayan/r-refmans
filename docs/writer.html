<!DOCTYPE html><html lang="en"><head><title>Help for package writer</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {writer}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#string_to_id'><p>string to_id</p></a></li>
<li><a href='#validate_table_name'><p>Validate table name</p></a></li>
<li><a href='#wrap_by_I'><p>wrap by <code>I()</code></p></a></li>
<li><a href='#write_df_append'><p>write_df_create</p></a></li>
<li><a href='#write_df_create'><p>write_df_create</p></a></li>
<li><a href='#write_df_overwrite'><p>write_df_overwrite</p></a></li>
<li><a href='#write_df_overwrite_schema'><p>write_df_overwrite_schema</p></a></li>
<li><a href='#write_rows'><p>write_rows</p></a></li>
<li><a href='#write_table'><p>Write from multiple sources to a database table</p></a></li>
<li><a href='#write_tbl_create'><p>write_tbl_create</p></a></li>
<li><a href='#write_tbl_overwrite'><p>write_tbl_overwrite</p></a></li>
<li><a href='#write_tbl_overwrite_schema'><p>write_tbl_overwrite_schema</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Write from Multiple Sources to a Database Table</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides unified syntax to write data from lazy 'dplyr' 'tbl' or
    'dplyr' 'sql' query or a dataframe to a database table with modes such as
    create, append, insert, update, upsert, patch, delete, overwrite,
    overwrite_schema.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/LGPL-3">LGPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>DBI (&ge; 1.2.3), dplyr (&ge; 1.1.0), dbplyr (&ge; 2.3.1), glue (&ge;
1.5.1), cli (&ge; 3.4.0), rlang (&ge; 1.1.2)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>RSQLite, testthat (&ge; 3.0.0),</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/talegari/writer">https://github.com/talegari/writer</a></td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-31 18:22:17 UTC; srikanth-ks1</td>
</tr>
<tr>
<td>Author:</td>
<td>Komala Sheshachala Srikanth
    <a href="https://orcid.org/0000-0002-1865-5668"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Komala Sheshachala Srikanth &lt;sri.teach@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-02-03 11:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='string_to_id'>string to_id</h2><span id='topic+string_to_id'></span>

<h3>Description</h3>

<p>simple string to DBI id
</p>


<h3>Usage</h3>

<pre><code class='language-R'>string_to_id(x)
</code></pre>

<hr>
<h2 id='validate_table_name'>Validate table name</h2><span id='topic+validate_table_name'></span>

<h3>Description</h3>

<p>Handles string, <code>I()</code> or <code>Id</code> objects and returns a string
</p>


<h3>Usage</h3>

<pre><code class='language-R'>validate_table_name(name)
</code></pre>

<hr>
<h2 id='wrap_by_I'>wrap by <code>I()</code></h2><span id='topic+wrap_by_I'></span>

<h3>Description</h3>

<p>wraps using a separate function as cannot be done literally
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wrap_by_I(string)
</code></pre>

<hr>
<h2 id='write_df_append'>write_df_create</h2><span id='topic+write_df_append'></span>

<h3>Description</h3>

<p>write_df_create
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_df_append(df, dest_table_name, con, ...)
</code></pre>

<hr>
<h2 id='write_df_create'>write_df_create</h2><span id='topic+write_df_create'></span>

<h3>Description</h3>

<p>write_df_create
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_df_create(df, dest_table_name, con, ...)
</code></pre>

<hr>
<h2 id='write_df_overwrite'>write_df_overwrite</h2><span id='topic+write_df_overwrite'></span>

<h3>Description</h3>

<p>write_df_overwrite
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_df_overwrite(df, dest_table_name, con, ...)
</code></pre>

<hr>
<h2 id='write_df_overwrite_schema'>write_df_overwrite_schema</h2><span id='topic+write_df_overwrite_schema'></span>

<h3>Description</h3>

<p>write_df_overwrite_schema
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_df_overwrite_schema(df, dest_table_name, con, ...)
</code></pre>

<hr>
<h2 id='write_rows'>write_rows</h2><span id='topic+write_rows'></span>

<h3>Description</h3>

<p>write_rows
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_rows(
  source,
  dest_table_name,
  con,
  mode = c("append", "insert", "update", "upsert", "patch", "delete"),
  ...
)
</code></pre>

<hr>
<h2 id='write_table'>Write from multiple sources to a database table</h2><span id='topic+write_table'></span><span id='topic+write_table.tbl_lazy'></span><span id='topic+write_table.sql'></span><span id='topic+write_table.data.frame'></span>

<h3>Description</h3>

<p>Provides unified syntax to write data from <code><a href="dplyr.html#topic+tbl">dplyr::tbl()</a></code> (lazy
dplyr query via a DBI connection) or a <code><a href="dplyr.html#topic+sql">dplyr::sql()</a></code> or a <a href="base.html#topic+data.frame">data.frame</a> to
a database table with modes such as: <code>create</code>, <code>append</code>, <code>insert</code>,
<code>update</code>, <code>upsert</code>, <code>patch</code>, <code>delete</code>, <code>overwrite</code>, <code>overwrite_schema</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_table(x, table_name, mode, con = NULL, verbose = TRUE, ...)

## S3 method for class 'tbl_lazy'
write_table(
  x,
  table_name,
  mode = c("create", "append", "insert", "update", "upsert", "patch", "delete",
    "overwrite", "overwrite_schema"),
  con = NULL,
  verbose = TRUE,
  ...
)

## S3 method for class 'sql'
write_table(
  x,
  table_name,
  mode = c("create", "append", "insert", "update", "upsert", "patch", "delete",
    "overwrite", "overwrite_schema"),
  con = NULL,
  verbose = TRUE,
  ...
)

## S3 method for class 'data.frame'
write_table(
  x,
  table_name,
  mode = c("create", "append", "insert", "update", "upsert", "patch", "delete",
    "overwrite", "overwrite_schema"),
  con = NULL,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="write_table_+3A_x">x</code></td>
<td>
<p>( <code><a href="dplyr.html#topic+tbl">dplyr::tbl()</a></code> or <code><a href="dplyr.html#topic+sql">dplyr::sql()</a></code> or <a href="base.html#topic+data.frame">data.frame</a> ) The data to
write to the database. Input need not have any rows.</p>
</td></tr>
<tr><td><code id="write_table_+3A_table_name">table_name</code></td>
<td>
<p>( <code>string</code> or <code>AsIs</code> or <code>Id</code> ) The name of the table to
write to. This has to be one among: string (typically
<code>"catalog.schema.table"</code>), Object of class &quot;AsIs&quot; generated by wrapping
<code>I()</code> (typically, <code>I("catalog.schema.table")</code>) or Object of class <code>Id</code>
generated by <code>DBI::Id</code> (typically, <code>DBI::Id("catalog", "schema", "table")</code>).</p>
</td></tr>
<tr><td><code id="write_table_+3A_mode">mode</code></td>
<td>
<p>( <code>string</code> ) Writing mode. Possible values are one among:
<code>create</code>, <code>append</code>, <code>insert</code>, <code>update</code>, <code>upsert</code>, <code>patch</code>, <code>delete</code>,
<code>overwrite</code>, <code>overwrite_schema</code>.</p>
</td></tr>
<tr><td><code id="write_table_+3A_con">con</code></td>
<td>
<p>( default: NULL ) DBI-connection object to use to write operation.
When con is <code>NULL</code> and source is a <code>tbl_lazy</code>, then DBI connection object
from the source tbl is used. When source is a <code>data.frame</code>, then <code>con</code>
should be provided.</p>
</td></tr>
<tr><td><code id="write_table_+3A_verbose">verbose</code></td>
<td>
<p>( default: TRUE ) Whether the progress message should be shown</p>
</td></tr>
<tr><td><code id="write_table_+3A_...">...</code></td>
<td>
<p>Arguments passed to specific function based on <code>mode</code>. See
details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>DBI-dplyr-dbplyr</code> combination provides a great workflow to
handle database operations from R. When saving the output from analysis
notebooks or scripts, different functions need to be called based on the
type of the object we intend to write. <code>writer</code> package solves the problem
by exporting one generic <code>write_table</code> to handle multiple input types and
multiple modes. Further, <code>overwrite</code> and <code>overwrite_schema</code> refine the idea
of table overwrite so that schema of the table is not changed
inadvertently.
</p>


<h4>Modes</h4>


<ul>
<li> <p><code>create</code>: Creates a new table only if table with same name does not exist and writes data.
</p>
</li>
<li> <p><code>append</code>: Appends data only if table exists and schema matches. See <code><a href="dplyr.html#topic+rows">dplyr::rows_append()</a></code>.
</p>
</li>
<li> <p><code>insert</code>: Inserts data only if table exists and key values do not exist. See <code><a href="dplyr.html#topic+rows">dplyr::rows_insert()</a></code>.
</p>
</li>
<li> <p><code>update</code>: Updates data only if table exists and key values match. See <code><a href="dplyr.html#topic+rows">dplyr::rows_update()</a></code> .
</p>
</li>
<li> <p><code>upsert</code>: Inserts or Updates only if table exists and depending on whether or not the key value already exists. See <code><a href="dplyr.html#topic+rows">dplyr::rows_upsert()</a></code>.
</p>
</li>
<li> <p><code>patch</code>: Updates only missing values if table exists and key values match. See <code><a href="dplyr.html#topic+rows">dplyr::rows_patch()</a></code>.
</p>
</li>
<li> <p><code>delete</code>: Deletes rows for matching key values if table exists. See <code><a href="dplyr.html#topic+rows">dplyr::rows_delete()</a></code>
</p>
</li>
<li> <p><code>overwrite</code>: Overwrites data only if table exists and schema matches.
</p>
</li>
<li> <p><code>overwrite_schema</code>: Creates a new table with data irrespective of whether table exists or not.
</p>
</li></ul>




<h4>Failures</h4>

<p>The failures are mostly due to unavailable or wrong sql translation to the
specific backend. Please raise issues in
<a href="https://github.com/tidyverse/dbplyr/issues">dbplyr</a> repo.
</p>
<p>Errors are raised with a
<a href="https://rlang.r-lib.org/reference/abort.html">class</a> (using
<code><a href="rlang.html#topic+abort">rlang::abort()</a></code>). These are the error classes:
</p>
<div class="sourceCode"><pre> * `error_input`: Related to wrong or unexpected input.
 * `error_connection`: Raised when connection is inactive.
 * `error_table`: Related to table existence or non-existence.
 * `error_operation`: Related to core write operation.
</pre></div>



<h4>Permissions</h4>

<div class="sourceCode"><pre> * `create`: create new table
 * `append`, `insert`, `update`, `upsert`, `patch`, `delete`: modify existing table
 * `overwrite`: modify existing table
 * `overwrite_schema`: delete, create and rename table
</pre></div>



<h3>Value</h3>

<p>When successful, returns the output table name as a string. Else,
throws an error with informative messages.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
#' Create an in-memory SQLite database connection
con = DBI::dbConnect(RSQLite::SQLite(), ":memory:")

remove_new_table = function(){
  df = data.frame(id = 1:3, name = c("Alice", "Bob", "Charlie"))
  DBI::dbRemoveTable(con, "new_table", fail_if_missing = FALSE)
}

create_new_table = function(){
  df = data.frame(id = 1:3, name = c("Alice", "Bob", "Charlie"))
  DBI::dbWriteTable(con, "new_table", df, overwrite = TRUE)
}

#' Create a sample data.frame
df = data.frame(id = 1:3, name = c("Alice", "Bob", "Charlie"))
df

#' Create a new table
write_table(df, "new_table", mode = "create", con = con)
dplyr::tbl(con, "new_table")


intermediate = dplyr::tbl(con, "new_table") |&gt;
  dplyr::filter(id &gt;= 2)

write_table(intermediate, "new_filtered_table", mode = "create")
dplyr::tbl(con, "new_filtered_table")

#' Append data to an existing table
create_new_table()
append_df = data.frame(id = 4:5, name = c("Dave", "Eve"))

append_df |&gt;
  write_table("new_table", mode = "append", con = con)
dplyr::tbl(con, "new_table")

create_new_table()
write_table(append_df, "append_table", mode = "create", con)
dplyr::tbl(con, "append_table")

dplyr::tbl(con, "append_table") |&gt;
  write_table("new_table", mode = "append")
dplyr::tbl(con, "new_table")

#' Insert data into an existing table, only if key values do not exist
create_new_table()
dplyr::tbl(con, "new_table")
insert_df = data.frame(id = 3:4, name = c("Dave", "Eve"))
insert_df

insert_df |&gt;
  write_table("new_table",
              mode = "insert",
              con = con,
              by = "id",
              conflict = "ignore"
              )
dplyr::tbl(con, "new_table")

create_new_table()
insert_df |&gt;
  write_table("insert_table", mode = "create", con = con)
dplyr::tbl(con, "insert_table")

dplyr::tbl(con, "insert_table") |&gt;
  write_table("new_table",
              mode = "insert",
              by = "id",
              conflict = "ignore"
              )
dplyr::tbl(con, "new_table")

#' Update data in an existing table, only if key values match
create_new_table()
update_df = data.frame(id = c(1, 3), name = c("Alicia", "Charles"))
update_df
write_table(update_df,
            "new_table",
            mode = "update",
            con = con,
            unmatched = "ignore"
            )
dplyr::tbl(con, "new_table")

create_new_table()
write_table(update_df, "update_table", mode = "create", con = con)
dplyr::tbl(con, "update_table")
write_table(dplyr::tbl(con, "update_table"),
            "new_table",
            mode = "update",
            unmatched = "ignore"
            )
dplyr::tbl(con, "new_table")

#' upsert
create_new_table()
upsert_df = data.frame(id = c(2, 6), name = c("Bobby", "Frank"))
upsert_df
write_table(upsert_df,
            "new_table",
            mode = "upsert",
            con = con,
            by = "id"
            )
dplyr::tbl(con, "new_table")

create_new_table()
write_table(upsert_df,
            "upsert_table",
            mode = "create",
            con = con
            )
dplyr::tbl(con, "upsert_table")
write_table(dplyr::tbl(con, "upsert_table"),
            "new_table",
            mode = "upsert"
            )
dplyr::tbl(con, "new_table")


#' Patch data, updating only missing values
create_new_table()
patch_df = data.frame(id = c(1, 2), name = c("alice", NA))
patch_df
write_table(df_patch, "table_with_na", mode = "create", con)
dplyr::tbl(con, "table_with_na")
df
write_table(df,
            "table_with_na",
            mode = "patch",
            con = con,
            unmatched = "ignore"
            )
dplyr::tbl(con, "table_with_na")

DBI::dbRemoveTable(con, "table_with_na")
write_table(df_patch, "table_with_na", mode = "create", con)
dplyr::tbl(con, "new_table")
write_table(dplyr::tbl(con, "new_table"),
            "table_with_na",
            mode = "patch",
            con = con,
            unmatched = "ignore"
            )
dplyr::tbl(con, "table_with_na")

#' Delete rows for matching key values
create_new_table()
delete_df = data.frame(id = c(3, 4))
delete_df
write_table(df_delete,
            "new_table",
            mode = "delete",
            con = con,
            unmatched = "ignore"
            )
dplyr::tbl(con, "new_table")

create_new_table()
write_table(delete_df,
            "delete_table",
            mode = "create",
            con = con
            )
dplyr::tbl(con, "delete_table")
write_table(df_delete,
            "new_table",
            mode = "delete",
            con = con,
            unmatched = "ignore"
            )
dplyr::tbl(con, "new_table")

#' Overwrite data in an existing table, schema must match
create_new_table()
overwrite_df = data.frame(id = c(2, 6), name = c("Bobby", "Frank"))
overwrite_df
write_table(overwrite_df,
            "new_table",
            mode = "overwrite",
            con = con
            )
dplyr::tbl(con, "new_table")

create_new_table()
overwrite_df = data.frame(id = c(2, 6), name = c("Bobby", "Frank"))
overwrite_df
write_table(overwrite_df,
            "new_table",
            mode = "overwrite",
            con = con
            )
dplyr::tbl(con, "new_table")

#' Overwrite schema
overwrite_schema_df = data.frame(id = c(2, 6),
                                 name = c("Bobby", "Frank"),
                                 age = c(30, 40)
                                 )
write_table(overwrite_schema_df,
            "new_table",
            mode = "overwrite_schema",
            con = con
            )
dplyr::tbl(con, "new_table")

create_new_table()
write_table(overwrite_schema_df,
            "overwrite_schema_table",
            mode = "overwrite_schema",
            con = con
            )
write_table(dplyr::tbl(con, "overwrite_schema_table"),
            "new_table",
            mode = "overwrite_schema",
            con = con
            )
dplyr::tbl(con, "new_table")

#' Disconnect from the database
DBI::dbDisconnect(con)

## End(Not run)
</code></pre>

<hr>
<h2 id='write_tbl_create'>write_tbl_create</h2><span id='topic+write_tbl_create'></span>

<h3>Description</h3>

<p>write_tbl_create
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_tbl_create(source_tbl, dest_table_name, con, ...)
</code></pre>

<hr>
<h2 id='write_tbl_overwrite'>write_tbl_overwrite</h2><span id='topic+write_tbl_overwrite'></span>

<h3>Description</h3>

<p>write_tbl_overwrite
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_tbl_overwrite(source_tbl, dest_table_name, con, ...)
</code></pre>

<hr>
<h2 id='write_tbl_overwrite_schema'>write_tbl_overwrite_schema</h2><span id='topic+write_tbl_overwrite_schema'></span>

<h3>Description</h3>

<p>write_tbl_overwrite_schema
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_tbl_overwrite_schema(source_tbl, dest_table_name, con, ...)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
