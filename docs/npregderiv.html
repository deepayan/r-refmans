<!DOCTYPE html><html><head><title>Help for package npregderiv</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {npregderiv}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#npregderiv package'><p>The package &quot;Nonparametric Estimation of the Derivatives of a Regression Function&quot; implements the method of Wang and Lin (2015) of estimating the first and</p>
second derivatives of a regression function from the original data in the case of an increasing evenly spaced design. The derivative estimates are computed at the design points.
The computations are based on the difference quotients. The package also includes the experimental data set on the deflection measurements of a round substrate before and after the thin
film deposition. See more details regarding the experiment and data analysis in the article of Savchuk and Volinsky (2020).</a></li>
<li><a href='#reg_1derivWL'><p>Estimating the first derivative of a regression function by the method of Wang and Lin (2015)</p></a></li>
<li><a href='#reg_2derivWL'><p>Estimating the second derivative of a regression function by the method of Wang and Lin (2015)</p></a></li>
<li><a href='#wafer40'><p>The data set on the <code class="reqn">n</code>=7755 substrate's deflection measurements before and after the thin film deposition in two radial directions.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Nonparametric Estimation of the Derivatives of a Regression
Function</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1.0)</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimating the first and second derivatives of a regression function by the method of Wang and Lin (2015) <a href="http://www.jmlr.org/papers/v16/wang15b.html">http://www.jmlr.org/papers/v16/wang15b.html</a>.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.0</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-07-07 18:29:11 UTC; olgay</td>
</tr>
<tr>
<td>Author:</td>
<td>Olga Savchuk [aut, cre],
  Alex Volinsky [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Olga Savchuk &lt;olga.y.savchuk@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-07-08 08:30:10 UTC</td>
</tr>
</table>
<hr>
<h2 id='npregderiv+20package'>The package &quot;Nonparametric Estimation of the Derivatives of a Regression Function&quot; implements the method of Wang and Lin (2015) of estimating the first and
second derivatives of a regression function from the original data in the case of an increasing evenly spaced design. The derivative estimates are computed at the design points.
The computations are based on the difference quotients. The package also includes the experimental data set on the deflection measurements of a round substrate before and after the thin
film deposition. See more details regarding the experiment and data analysis in the article of Savchuk and Volinsky (2020).</h2><span id='topic+npregderiv+20package'></span>

<h3>Description</h3>

<p>Estimating the first and second derivatives by the method of Wang and Lin (2015) requires choosing the soothing parameter <code class="reqn">k</code> that shows how many observations from each side of
an estimation point are used. Notice that the method of Wang and Lin (2015) requires an estimation point to be one of the design points. If a single value of <code class="reqn">k</code> is used for all
estimation points, it is impossible to compute a derivative estimate for the first and the last <code class="reqn">k</code> data points that constitute the left and right boundary regions, respectively.
Generally, an adaptive value of <code class="reqn">k</code> may be used (see Wang and Lin (2015)). Even though the article of Wang and Lin (2015) contains the expressions for the asymptotically optimal <code class="reqn">k</code>,
those results are of no practical importance since they involve the higher order derivatives of the regression function. Wang and Lin (2015) implement their method for
the values for <code class="reqn">k</code> ranging from <code class="reqn">0.02n</code> to <code class="reqn">0.2n</code>, where <code class="reqn">n</code> is the sample size. The larger the value of <code class="reqn">k</code>, the smoother the resulting estimate. However, too large <code class="reqn">k</code> may lead to
smoothing away certain important features of the function's derivatives. We found that the value of <code class="reqn">k=0.1n</code> worked reasonably well for estimating the first and second derivatives
of the regression functions in many practical cases.
</p>


<h3>Details</h3>

<p>The function <code><a href="#topic+reg_1derivWL">reg_1derivWL</a></code> is developed to estimate the first derivative of the underlying regression function from the original data. The function <code><a href="#topic+reg_2derivWL">reg_2derivWL</a></code> is
intended to estimate the function's second derivative. The latter function was used for estimating the second derivatives of the deflection functions in the experiment
described and analyzed in the article of Savchuk and Volinsky (2020). The deflection's second derivative is used to estimate the substrate's curvature and, ultimately, the
residual stress of the thin film deposited on the substrate.
</p>
<p>The data set <code><a href="#topic+wafer40">wafer40</a></code> analyzed in the article of Savchuk and Volinsky (2020) is included into the package. It contains the deflection measurements for one of the
wafers (wafer 40) used in the experiment. The measurements are taken before and after the thin film deposition in two radial directions on the round substrate and are marked as
&quot;0 degrees&quot; and &quot;90 degrees&quot; depending on the scan orientation. The design points are separated by 0.000005 m. The resulting sample size in each case is <code class="reqn">n</code>=7755. All
deflection and position measurements are recorded in meters.
</p>


<h3>References</h3>

<p>Wang, W.W., Lin, L. (2015) <a href="http://www.jmlr.org/papers/v16/wang15b.html">http://www.jmlr.org/papers/v16/wang15b.html</a> &ldquo;Derivative Estimation Based on Difference Sequence via Locally Weighted Least Squares Regression&rdquo;, <em>Journal of Machine Learning Research</em>, 16, 2617-2641.
</p>
<p>Savchuk, O., Volinsky, A.A. (2020). &ldquo;Nonparametric estimation of SiC film residual stress from the wafer profile&rdquo;.
</p>

<hr>
<h2 id='reg_1derivWL'>Estimating the first derivative of a regression function by the method of Wang and Lin (2015)</h2><span id='topic+reg_1derivWL'></span>

<h3>Description</h3>

<p>The design data <code class="reqn">xdat</code> must be increasing and evenly spaced. The first derivative estimate is computed at <code class="reqn">u</code> that must be one of the design points <code class="reqn">xdat</code> from the interior region. The interior region excludes the first <code class="reqn">k</code> points with the smallest <code class="reqn">xdat</code> values (left boundary) and the last <code class="reqn">k</code> points with the largest <code class="reqn">xdat</code> values (right boundary).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>reg_1derivWL(xdat, ydat, k, u)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="reg_1derivWL_+3A_xdat">xdat</code></td>
<td>
<p>numerical vector of the increasing and evenly spaced design points</p>
</td></tr>
<tr><td><code id="reg_1derivWL_+3A_ydat">ydat</code></td>
<td>
<p>numerical vector of the corresponding data points</p>
</td></tr>
<tr><td><code id="reg_1derivWL_+3A_k">k</code></td>
<td>
<p>integer value of the smoothing parameter</p>
</td></tr>
<tr><td><code id="reg_1derivWL_+3A_u">u</code></td>
<td>
<p>an estimation point (scalar) that must be one of the <code class="reqn">xdat</code> points from the interior region</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The method's smoothing parameter <code class="reqn">k</code> shows how many data points are used from each side of an estimation point <code class="reqn">u</code> to compute the first derivative estimate at that point. Choose <code class="reqn">k&lt;n/4</code>, where <code class="reqn">n</code> is the sample size. The value of <code class="reqn">k=0.1n</code> can be taken as a starting point.
</p>


<h3>Value</h3>

<p>The computed first derivative estimate (scalar) at the point <code class="reqn">u</code>.
</p>


<h3>References</h3>

<p>Wang, W.W., Lin, L. (2015) <a href="http://www.jmlr.org/papers/v16/wang15b.html">http://www.jmlr.org/papers/v16/wang15b.html</a> &ldquo;Derivative Estimation Based on Difference Sequence via Locally Weighted Least Squares Regression&rdquo;, <em>Journal of Machine Learning Research</em>, 16, 2617-2641.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+reg_2derivWL">reg_2derivWL</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># EXAMPLE 1: Toy example
xdata=1:100
ydata=xdata^2
reg_1derivWL(xdata,ydata,10,30)

# EXAMPLE 2 (simulated data).
m=function(x)
  sin(2*pi*x)+log(6+5*x)
m1=function(x)                                           # first derivative of m
  2*pi*cos(2*pi*x)+5/(6+5*x)
N=300                       # sample size
xi=2*(1:N/N)-1              # equidistant design points
sigma=0.25                  # noise level used in the article
yi=m(xi)+rnorm(N,sd=sigma)  # generating data
K=0.1*N                     # selected value of the smoothing parameter k
x_inter=xi[(K+1):(N-K)]     # interior estimation region
N_inter=length(x_inter)     # number of points where the second derivative estimate is computed
M1=array(0,N_inter)         # Vector of estimated second derivatives at the points x_inter
for (i in 1:N_inter)
  M1[i]=reg_1derivWL(xi,yi,K,x_inter[i])
op=par(no.readonly=TRUE)
par(mfrow=c(1,2))
plot(xi,yi,pch=20,cex=1.7,main="Regression function and generated data",xlab="",ylab="",
     cex.axis=1.8,cex.main=1.5)
lines(xi,m(xi),'l',col="red",lwd=2)
title(xlab="argument",ylab="regression function",line=2.5,cex.lab=1.8)
legend(0.65,-0.4,lty="solid",col="red",lwd=2,legend="true regression function",bty="n",
       cex=1.45,seg.len=0.5)
plot(x_inter,M1,'l',lwd=2,main="Actual and estimated first derivative",xlab="",ylab="",
     cex.axis=1.8,cex.main=1.5)
lines(x_inter,m1(x_inter),'l',lwd=2,col="red")
title(xlab="argument",ylab="second derivative",line=2.5,cex.lab=1.8)
legend(0.6,-10,lty=c("solid","solid"),col=c("red","black"),lwd=c(2,2),
      legend=c("true first derivative", "estimate"),bty="n",cex=1.45,seg.len=0.5)
par(op)


# EXAMPLE 3: Estimating the first derivative of the deflection function for the data on
# deflection after film deposition scanned at 0 degrees.
# See Savchuk O., and Volinsky, A. (2020) for the experiment's description.
xdesign=wafer40$x_dat
ydata=wafer40$y_after_0
n_data=length(xdesign)                        # sample size (original)
n_new=1034                                    # reducing the number of points where the second
                                              # derivative is estimated.
K=ceiling(0.1*n_data)                         # value of the smoothing parameter
index=(K+1)+0:(n_new-1)*6                     # cutting about 10% of points from each side and
                                              # reducing the number of points where the second
                                              # derivative is estimated
x_inter=xdesign[index]                        # the values of argument where the second
                                              # derivative is to be estimated
y_inter=ydata[index]
Der1=array(0,n_new)
for (i in 1:n_new)
  Der1[i]=reg_1derivWL(xdesign,ydata,K,x_inter[i])
op=par(no.readonly=TRUE)
par(mfrow=c(1,2))
plot(xdesign*1000,ydata*10^6,pch=20,main="Deflection AFTER film deposition. Angle: 0 degrees.",
     xlab="",ylab="",cex.axis=1.8,cex.main=1.5)
title(ylab=expression(paste("deflection, ",mu,"m")),xlab="position, mm",line=2.25,cex.lab=1.8)
plot(x_inter*1000,Der1,'l',lwd=2,
     main="1-st derivative AFTER film deposition. Angle: 0 degrees.",
     xlab="",ylab="",cex.axis=1.8, cex.main=1.5)
title(ylab="first derivative of deflection", xlab="position, mm", line=2.5, cex.lab=1.8)
par(op)

</code></pre>

<hr>
<h2 id='reg_2derivWL'>Estimating the second derivative of a regression function by the method of Wang and Lin (2015)</h2><span id='topic+reg_2derivWL'></span>

<h3>Description</h3>

<p>The design data <code class="reqn">xdat</code> must be increasing and evenly spaced. The second derivative estimate is computed at <code class="reqn">u</code> that must be one of the design points <code class="reqn">xdat</code> from the interior region. The interior region excludes the first <code class="reqn">k</code> points with the smallest <code class="reqn">xdat</code> values (left boundary) and the last <code class="reqn">k</code> points with the largest <code class="reqn">xdat</code> values (right boundary).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>reg_2derivWL(xdat, ydat, k, u)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="reg_2derivWL_+3A_xdat">xdat</code></td>
<td>
<p>numerical vector of the increasing and evenly spaced design points</p>
</td></tr>
<tr><td><code id="reg_2derivWL_+3A_ydat">ydat</code></td>
<td>
<p>numerical vector of the corresponding data points</p>
</td></tr>
<tr><td><code id="reg_2derivWL_+3A_k">k</code></td>
<td>
<p>integer value of the smoothing parameter</p>
</td></tr>
<tr><td><code id="reg_2derivWL_+3A_u">u</code></td>
<td>
<p>an estimation point (scalar) that must be one of the <code class="reqn">xdat</code> points from the interior region</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The method's smoothing parameter <code class="reqn">k</code> shows how many data points are used from each side of an estimation point <code class="reqn">u</code> to compute the second derivative estimate at that point. Choose <code class="reqn">k&lt;n/4</code>, where <code class="reqn">n</code> is the sample size. The value of <code class="reqn">k=0.1n</code> can be taken as a starting point.
</p>


<h3>Value</h3>

<p>The computed second derivative estimate (scalar) at the point <code class="reqn">u</code>.
</p>


<h3>References</h3>

<p>Wang, W.W., Lin, L. (2015) <a href="http://www.jmlr.org/papers/v16/wang15b.html">http://www.jmlr.org/papers/v16/wang15b.html</a> &ldquo;Derivative Estimation Based on Difference Sequence via Locally
Weighted Least Squares Regression&rdquo;, <em>Journal of Machine Learning Research</em>, 16, 2617-2641.
</p>
<p>Savchuk, O., Volinsky, A.A. (2020). &ldquo;Nonparametric estimation of SiC film residual stress
from the wafer profile&rdquo;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+reg_1derivWL">reg_1derivWL</a></code>, <code><a href="#topic+wafer40">wafer40</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># EXAMPLE 1 (simulated data).
# The regression function is taken from p. 2631 of the article of Wang and Lin (2015).
m=function(x)               # Regression function from the article of Wang and Lin (2015)
  32*exp(-8*(1-2*x)^2)*(1-2*x)
m2=function(x)              # second derivative of m
  -2048*exp(-8*(1-2*x)^2)*(128*x^3-192*x^2+90*x-13)
N=100                       # sample size
xi=1:N/N                    # equidistant design points
sigma=0.2                   # noise level used in the article
yi=m(xi)+rnorm(N,sd=sigma)  # generating data
K=0.1*N                     # selected value of the smoothing parameter k
x_inter=xi[(K+1):(N-K)]     # interior estimation region
N_inter=length(x_inter)     # number of points where the second derivative estimate is computed
M2=array(0,N_inter)         # Vector of estimated second derivatives at the points x_inter
for (i in 1:N_inter)
  M2[i]=reg_2derivWL(xi,yi,K,x_inter[i])
op=par(no.readonly=TRUE)
par(mfrow=c(1,2))
plot(xi,yi,pch=20,cex=1.7,main="Regression function and generated data",xlab="",ylab="",
     cex.axis=1.8,cex.main=1.5)
lines(xi,m(xi),'l',col="red",lwd=2)
title(xlab="argument",ylab="regression function",line=2.5,cex.lab=1.8)
legend(0.35,5,lty="solid",col="red",lwd=2,legend="true regression function",bty="n",
       cex=1.45,seg.len=0.5)
plot(x_inter,M2,'l',lwd=2,main="Actual and estimated second derivative",xlab="",ylab="",
     cex.axis=1.8,cex.main=1.5)
lines(x_inter,m2(x_inter),'l',lwd=2,col="red")
title(xlab="argument",ylab="second derivative",line=2.5,cex.lab=1.8)
legend(0.01,800,lty=c("solid","solid"),col=c("red","black"),lwd=c(2,2),
      legend=c("true second derivative", "estimate"),bty="n",cex=1.45,seg.len=0.5)
par(op)


# EXAMPLE 2: Estimating the second derivative of the deflection function for the data on
# deflection after film deposition scanned at 90 degrees.
# See Savchuk O., and Volinsky, A. (2020) for the experiment's description.
xdesign=wafer40$x_dat
ydata=wafer40$y_after_90
n_data=length(xdesign)      # sample size (original)
n_new=1034                  # reducing the number of points where the second 
                            # derivative is estimated.
K=ceiling(0.1*n_data)       # value of the smoothing parameter
index=(K+1)+0:(n_new-1)*6   # cutting about 10% of points from each side and reducing the 
                            # number of points where the second derivative is estimated
x_inter=xdesign[index]      # the values of argument where the second derivative is to be
                            # estimated
y_inter=ydata[index]
Der2=array(0,n_new)
for (i in 1:n_new)
  Der2[i]=reg_2derivWL(xdesign,ydata,K,x_inter[i])
op=par(no.readonly=TRUE)
par(mfrow=c(1,2))
plot(xdesign*1000,ydata*10^6,pch=20,main="Deflection AFTER film deposition. Angle: 90 degrees.",
     xlab="",ylab="",cex.axis=1.8,cex.main=1.5)
title(ylab=expression(paste("deflection, ", mu, "m")), xlab="position, mm", line=2.25, 
      cex.lab=1.8)
plot(x_inter*1000,Der2,'l',lwd=2,
     main="2-nd derivative AFTER film deposition. Angle: 90 degrees.",xlab="",ylab="",
     cex.axis=1.8, cex.main=1.5)
title(ylab="second derivative of deflection, 1/m", xlab="position, mm", line=2.5,
      cex.lab=1.8)
par(op)

</code></pre>

<hr>
<h2 id='wafer40'>The data set on the <code class="reqn">n</code>=7755 substrate's deflection measurements before and after the thin film deposition in two radial directions.</h2><span id='topic+wafer40'></span>

<h3>Description</h3>

<p>The data frame on the deflection measurements is described and analyzed in the article of Savchuk and Volinsky (2020).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wafer40
</code></pre>


<h3>Format</h3>

<p>The data frame has five variables:
</p>

<dl>
<dt>x_dat</dt><dd><p>design points (separated by 0.000005 m);</p>
</dd>
<dt>y_before_0</dt><dd><p>deflections measurements (in m) before film deposition at 0 degrees;</p>
</dd>
<dt>y_after_0</dt><dd><p>deflections measurements (in m) after film deposition at 0 degrees;</p>
</dd>
<dt>y_before_90</dt><dd><p>deflections measurements (in m) before film deposition at 90 degrees;</p>
</dd>
<dt>y_after_90</dt><dd><p>deflections measurements (in m) after film deposition at 90 degrees.</p>
</dd>
</dl>



<h3>Source</h3>

<p>Savchuk, O., Volinsky, A.A. (2020). &ldquo;Nonparametric estimation of SiC film residual stress from the wafer profile&rdquo;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+reg_2derivWL">reg_2derivWL</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># EXAMPLE: Plotting scatter plot of deflection in the case of 0 degrees before the film
# deposition. Note: position is displayed in mm, whereas the deflection is displayed in
# micrometers. No smoothing is used. The original n=7755 data points are plotted.
dev.new()
plot(wafer40$x_dat*1000,wafer40$y_before_0*1000000,pch=20,
     main="Deflection BEFORE film deposition. Angle: 0 degrees.",xlab="",ylab="",
     cex.axis=2,cex.main=2)
title(ylab=expression(paste("deflection, ", mu, "m")), xlab="position, mm",
      line=2.25, cex.lab=2)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
