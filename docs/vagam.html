<!DOCTYPE html><html lang="en"><head><title>Help for package vagam</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {vagam}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#vagam-package'>
<p>Variational approximations for generalized additive models</p></a></li>
<li><a href='#gamsim'>
<p>Simulate example datasets from a generalized additive models (GAM).</p></a></li>
<li><a href='#plot.vagam'>
<p>Basic plots for a fitted generalized additive model (GAMs).</p></a></li>
<li><a href='#predict.vagam'>
<p>Predictions from a fitted generalized additive model (GAM).</p></a></li>
<li><a href='#summary.vagam'>
<p>Summary of generalized additive model (GAM) fitted using variational approximations (VA).</p></a></li>
<li><a href='#vagam'>
<p>Fitting generalized additive models (GAMs) using variational approximations (VA).</p></a></li>
<li><a href='#wage_data'>
<p>Union membership data set</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Variational Approximations for Generalized Additive Models</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2019-12-07</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.4.0), mgcv, gamm4, Matrix, mvtnorm, truncnorm</td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>LazyData:</td>
<td>yes</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Han Lin Shang &lt;hanlin.shang@anu.edu.au&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Fits generalized additive models (GAMs) using a variational approximations (VA) framework. In brief, the VA framework provides a fully or at least closed to fully tractable lower bound approximation to the marginal likelihood of a GAM when it is parameterized as a mixed model (using penalized splines, say). In doing so, the VA framework aims offers both the stability and natural inference tools available in the mixed model approach to GAMs, while achieving computation times comparable to that of using the penalized likelihood approach to GAMs. See Hui et al. (2018) &lt;<a href="https://doi.org/10.1080%2F01621459.2018.1518235">doi:10.1080/01621459.2018.1518235</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2019-12-06 19:38:31 UTC; hanlinshang</td>
</tr>
<tr>
<td>Author:</td>
<td>Han Lin Shang <a href="https://orcid.org/0000-0003-1769-6430"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre, cph],
  Francis K.C. Hui <a href="https://orcid.org/0000-0003-0765-3533"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2019-12-06 20:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='vagam-package'>
Variational approximations for generalized additive models
</h2><span id='topic+vagam-package'></span>

<h3>Description</h3>

<p>Fits generalized additive models (GAMs) using a variational approximations (VA) framework. In brief, the VA framework provides a fully or at least closed to fully tractable lower bound approximation to the marginal likelihood of a GAM when it is parameterized as a mixed model (using penalized splines, say). In doing so, the VA framework aims offers both the stability and natural inference tools available in the mixed model approach to GAMs, while achieving computation times comparable to that of using the penalized likelihood approach to GAMs. See Hui et al. (2018) &lt;doi:10.1080/01621459.2018.1518235&gt;.
</p>


<h3>Author(s)</h3>

<p>NA
Maintainer: Han Lin Shang &lt;hanlin.shang@anu.edu.au&gt;
</p>


<h3>References</h3>


<ul>
<li><p> Hui, F. K. C., You, C., Shang, H. L., and Mueller, S. (2018). Semiparametric regression using variational approximations, <em>Journal of the American Statistical Association</em>, <b>forthcoming</b>.
</p>
</li></ul>
 

<h3>Examples</h3>

<pre><code class='language-R'>## Please see examples in the help file for the vagam function.
</code></pre>

<hr>
<h2 id='gamsim'>
Simulate example datasets from a generalized additive models (GAM).
</h2><span id='topic+gamsim'></span>

<h3>Description</h3>

<p>This function is a modification from example 7 of the gamSim function available in the mgcv package (Wood, 2017), which is turn is Gu and Wahba 4 univariate example with correlated predictors. Please see the source code for exactly what is simulated. The function is primarily used as the basis for conducting the simulation studies in Hui et al., (2018). 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gamsim(n = 400, extra.X = NULL, beta = NULL, dist = "normal", scale = 1, offset = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gamsim_+3A_n">n</code></td>
<td>
<p>Sample size.</p>
</td></tr>
<tr><td><code id="gamsim_+3A_extra.x">extra.X</code></td>
<td>
<p>Extra covariates, including critically an intercept if is to be included in the linear predictor for the GAM.</p>
</td></tr>
<tr><td><code id="gamsim_+3A_beta">beta</code></td>
<td>
<p>Regression coefficient estimates.</p>
</td></tr>
<tr><td><code id="gamsim_+3A_dist">dist</code></td>
<td>
<p>Currently only the &quot;normal&quot;, &quot;poisson&quot; or &quot;binomial&quot; corresponding to the binomial distributions are available.</p>
</td></tr>
<tr><td><code id="gamsim_+3A_scale">scale</code></td>
<td>
<p>Scale parameter in the Normal distribution.</p>
</td></tr>
<tr><td><code id="gamsim_+3A_offset">offset</code></td>
<td>
<p>This can be used to specify an a-priori known component to be included in the linear predictor during fitting.  This should be <code>NULL</code> or a numeric vector of length equal to <code>n</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame containing information such as the simulated responses, covariates, each of the 4 &quot;truth&quot; smooths, and the overall linear predictor. 
</p>


<h3>Author(s)</h3>

<p>NA
</p>


<h3>References</h3>


<ul>
<li><p> Hui, F. K. C., You, C., Shang, H. L., and Mueller, S. (2018). Semiparametric regression using variational approximations, <em>Journal of the American Statistical Association</em>, <b>forthcoming</b>.
</p>
</li>
<li><p> Wood, S. N. (2017) Generalized Additive Models: An Introduction with R (2nd edition). Chapman and Hall/CRC.
</p>
</li></ul>
 

<h3>See Also</h3>

<p><code><a href="#topic+vagam">vagam</a> for the main fitting function</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>normal_dat = gamsim(n = 40, dist = "normal", 
                    extra.X = data.frame(int = rep(1,40), trt = rep(c(0,1), each = 20)),
                    beta = c(-1, 0.5))

pois_dat = gamsim(n = 40, dist = "poisson", 
                  extra.X = data.frame(int = rep(1, 40), trt = rep(c(0,1), each = 20)),
                  beta = c(-1, 0.5))

binom_dat = gamsim(n = 40, dist = "binomial",
                   extra.X = data.frame(int = rep(1, 40), trt = rep(c(0,1), each = 20)),
                   beta = c(0, 0.5))

## Please see examples in the help file for the vagam function.
</code></pre>

<hr>
<h2 id='plot.vagam'>
Basic plots for a fitted generalized additive model (GAMs). 
</h2><span id='topic+plot.vagam'></span>

<h3>Description</h3>

<p>Takes a fitted vagam object produced by the main vagam function and plots the component smooth functions that make it up, on the scale of the linear predictor.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'vagam'
plot(x, n = 100, alpha = 0.05, rug = TRUE, se = TRUE, 
xlim = NULL, ylim = NULL, xlab = NULL, ylab = NULL, main = NULL, 
select = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.vagam_+3A_x">x</code></td>
<td>
<p>An object of class &quot;vagam&quot;.</p>
</td></tr>
<tr><td><code id="plot.vagam_+3A_n">n</code></td>
<td>
<p>Number of observations used in constructing predictions for plotting.</p>
</td></tr>
<tr><td><code id="plot.vagam_+3A_alpha">alpha</code></td>
<td>
<p>Level of significance for the pointwise confidence bands for predictions.</p>
</td></tr>
<tr><td><code id="plot.vagam_+3A_rug">rug</code></td>
<td>
<p>If <code>rug = TRUE</code>, adds a rug representation (1-d plot) of the data to the plot.</p>
</td></tr>
<tr><td><code id="plot.vagam_+3A_se">se</code></td>
<td>
<p>If <code>se = TRUE</code>, adds lower and upper bounds of 95% pointwise confidence bands.</p>
</td></tr>
<tr><td><code id="plot.vagam_+3A_xlim">xlim</code></td>
<td>
<p>Range of plotting for x variable.</p>
</td></tr>
<tr><td><code id="plot.vagam_+3A_ylim">ylim</code></td>
<td>
<p>Range of plotting for y variable.</p>
</td></tr>
<tr><td><code id="plot.vagam_+3A_xlab">xlab</code></td>
<td>
<p>Label for x variable.</p>
</td></tr>
<tr><td><code id="plot.vagam_+3A_ylab">ylab</code></td>
<td>
<p>Label for y variable.</p>
</td></tr>
<tr><td><code id="plot.vagam_+3A_main">main</code></td>
<td>
<p>Title of plotting.</p>
</td></tr>
<tr><td><code id="plot.vagam_+3A_select">select</code></td>
<td>
<p>Select which observations to plot.</p>
</td></tr>
<tr><td><code id="plot.vagam_+3A_...">...</code></td>
<td>
<p>Other plotting arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Currently implements a basic plot for each of the fitted smoothers from a GAM fitted using the main vagam function. This is done by making use of the predict function to construct the fitted smooths. There is also the option of adding pointwise confidence bands based on fitted vagam object. Under the variational approximations framework, the smooths and confidence bands are constructed based on the variational approximation to the posterior distribution of the smoothing coefficients (which are treated as random effects with a normal prior under the mixed model framework). Please see Hui et al., (2018) for more information. 
</p>


<h3>Value</h3>

<p>The functions main purpose is its side effect of generating a set of plots.
</p>


<h3>Author(s)</h3>

<p>NA
</p>


<h3>References</h3>


<ul>
<li><p> Hui, F. K. C., You, C., Shang, H. L., and Mueller, S. (2018). Semiparametric regression using variational approximations, <em>Journal of the American Statistical Association</em>, <b>forthcoming</b>.
</p>
</li></ul>
 

<h3>See Also</h3>

<p><code><a href="#topic+vagam">vagam</a> for the main fitting function</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Please see examples in the help file for the vagam function.
</code></pre>

<hr>
<h2 id='predict.vagam'>
Predictions from a fitted generalized additive model (GAM). 
</h2><span id='topic+predict.vagam'></span>

<h3>Description</h3>

<p>Takes a fitted vagam object produced by the main vagam function and produces predictions given a new set of values for the model covariates or the original values used for the model fit.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'vagam'
predict(object, new.smoothX, new.paraX = NULL, terms = NULL, 
alpha = 0.05, type = "link", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.vagam_+3A_object">object</code></td>
<td>
<p>An object of class &quot;vagam&quot;.</p>
</td></tr>
<tr><td><code id="predict.vagam_+3A_new.smoothx">new.smoothX</code></td>
<td>
<p>A new matrix of covariates, each of which are were entered as additive smooth terms in the fitted GAM.</p>
</td></tr>
<tr><td><code id="predict.vagam_+3A_new.parax">new.paraX</code></td>
<td>
<p>A new matrix of covariates, each of which were be entered as parametric terms in the fitted GAM. Note the predictions will account for the intercept ONLY if new.paraX is supplied.</p>
</td></tr>
<tr><td><code id="predict.vagam_+3A_terms">terms</code></td>
<td>
<p>If <code>terms = NULL</code>, prediction is made across all smoothing covariates. Else, prediction is made to the specified smoothing covariate, with no intercept added.</p>
</td></tr>
<tr><td><code id="predict.vagam_+3A_alpha">alpha</code></td>
<td>
<p>Level of significance for the pointwise confidence bands for predictions.</p>
</td></tr>
<tr><td><code id="predict.vagam_+3A_type">type</code></td>
<td>
<p>When <code>type = "link"</code> (default) the linear predictor (with associated standard errors) is returned. When <code>type = "response"</code> predictions on the scale of the response are returned (with associated standard errors).</p>
</td></tr>
<tr><td><code id="predict.vagam_+3A_...">...</code></td>
<td>
<p>This is currently ignored.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Current implemented a basic method of constructing predictions either for a single smoothing covariate, or across all the smoothing (and parametric if supplied) covariates, based on a GAM fitted using the main vagam function. By default, standard errors and this pointwise confidence bands are also produced based on fitted vagam object. Under the variational approximations framework, the smooths and confidence bands are constructed based on the variational approximation to the posterior distribution of the smoothing coefficients (which are treated as random effects with a normal prior under the mixed model framework). Please see Hui et al., (2018) for more information. 
</p>


<h3>Value</h3>

<p>A data frame containing information such as the predicted response, standard errors, and lower and upper bounds of the pointwise confidence bands.
</p>


<h3>Author(s)</h3>

<p>NA
</p>


<h3>References</h3>


<ul>
<li><p> Hui, F. K. C., You, C., Shang, H. L., and Mueller, S. (2018). Semiparametric regression using variational approximations, <em>Journal of the American Statistical Association</em>, <b>forthcoming</b>.
</p>
</li></ul>
 

<h3>See Also</h3>

<p><code><a href="#topic+vagam">vagam</a> for the main fitting function</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Please see examples in the help file for the vagam function.
</code></pre>

<hr>
<h2 id='summary.vagam'>
Summary of generalized additive model (GAM) fitted using variational approximations (VA).
</h2><span id='topic+summary.vagam'></span><span id='topic+print.vagam'></span>

<h3>Description</h3>

<p>A summary of the results from applying <code>vagam</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'vagam'
summary(object, ...)

## S3 method for class 'vagam'
print(x,...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.vagam_+3A_object">object</code></td>
<td>
<p>An object of class &quot;vagam&quot;.</p>
</td></tr>
<tr><td><code id="summary.vagam_+3A_x">x</code></td>
<td>
<p>An object of class &quot;vagam&quot;.</p>
</td></tr>
<tr><td><code id="summary.vagam_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list (some of which is printed) containing the following elements:
</p>

<ul>
<li><p>call:The matched call.
</p>
</li>
<li><p>para.coeff:The estimated regression coefficients corresponding to the covariates in parametric component of the GAM. This includes the intercept term.
</p>
</li>
<li><p>smooth.coeff:The estimated smoothing coefficients corresponding to the (P-spline bases set up for) covariates in the nonparametric component of the GAM. This corresponds to the mean vector of the variational distribution.
</p>
</li>
<li><p>smooth.param:The estimated smoothing coefficients, or the fixed smoothing parameters if <code>lambda</code> was supplied.
</p>
</li>
<li><p>phi:The estimated residual variance when the Gaussian distribution is assumed for the response.
</p>
</li>
<li><p>logLik:The maximized value of the variational log-likelihood.
</p>
</li>
<li><p>family:The assumed distribution for the response.
</p>
</li>
<li><p>smooth.stat:A small table of summary statistics for the nonparametric component of the GAM, including an approximate Wald-type hypothesis test for the significance of each nonparametric covariate.
</p>
</li>
<li><p>para.stat:If <code>para.se=TRUE</code>, then a small table containing summary statistics for the estimated parametric component of the GAM, including an approximate Wald-type hypothesis test for the significance of each parameteric covariate.
</p>
</li></ul>
 

<h3>Author(s)</h3>

<p>NA
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vagam">vagam</a> for the main fitting function</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Please see examples in the help file for the vagam function.
</code></pre>

<hr>
<h2 id='vagam'>
Fitting generalized additive models (GAMs) using variational approximations (VA). 
</h2><span id='topic+vagam'></span>

<h3>Description</h3>

<p>Follows the variational approximation approach of Hui et al. (2018) for fitted generalized additive models. In this package, the term GAM is taken to be generalized linear mixed model, specifically, the nonparametric component is modeled using a P-splines i.e., cubic B-splines with a first order difference penalty. Because the penalty can be written as a quadratic form in terms of the smoothing coefficients, then it is treated a (degenerate) multivariate normal random effects distribution and a marginal log-likleihood for the resulting mixed model can be constructed. 
</p>
<p>The VA framework is then utilized to provide a fully or at least closed to fully tractable lower bound approximation to the marginal likelihood of a GAM. In doing so, the VA framework aims offers both the stability and natural inference tools available in the mixed model approach to GAMs, while achieving computation times comparable to that of using the penalized likelihood approach to GAMs. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vagam(y, smooth.X, para.X = NULL, lambda = NULL, int.knots, family = gaussian(), 
A.struct = c("unstructured", "block"), offset = NULL, save.data = FALSE, 
para.se = FALSE, doIC = FALSE, 
control = list(eps = 0.001, maxit = 1000, trace = TRUE, seed.number = 123, 
mc.samps = 4000, pois.step.size = 0.01))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vagam_+3A_y">y</code></td>
<td>
<p>A response vector.</p>
</td></tr>
<tr><td><code id="vagam_+3A_smooth.x">smooth.X</code></td>
<td>
<p>A matrix of covariates, each of which are to be entered as additive smooth terms in the GAM.</p>
</td></tr>
<tr><td><code id="vagam_+3A_para.x">para.X</code></td>
<td>
<p>An optional matrix of covariates, each of which are to be entered as parametric terms in the GAM. Please note that NO intercept term needs to be included as it is included by default.</p>
</td></tr>
<tr><td><code id="vagam_+3A_lambda">lambda</code></td>
<td>
<p>An optional vector of length <code>ncol(smooth.X)</code>, where each element corresponds to the smoothing parameter to be applied to the respective covariate in <code>smooth.X</code>. If supplied, then the GAM is fitted with the smoothing parameters held fixed at this values. If <code>lambda=NULL</code>, then smoothing parameters for all covariates to be smoothed are updated automatically as part of the VA algorithm.</p>
</td></tr>
<tr><td><code id="vagam_+3A_int.knots">int.knots</code></td>
<td>
<p>Either a single number of a vector of length <code>ncol(smooth.X)</code>, corresponding to the number of interior knots to be use for the respective covariate iin <code>smooth.X</code>. This argument is passed to the function <code>smooth.construct</code> from the mgcv package (Wood, 2017) in order to construct the P-splines bases. Equally spaced knots based on quantiles are used.</p>
</td></tr>
<tr><td><code id="vagam_+3A_family">family</code></td>
<td>
<p>Currently only the <code>gaussian(link = "identity"), poisson(link = "log")</code>, and <code>binomial(link = "logit")</code> corresponding to Bernoulli distributions are available.</p>
</td></tr>
<tr><td><code id="vagam_+3A_a.struct">A.struct</code></td>
<td>
<p>The assumed structure of the covariance matrix in the variational distribution of the smoothing coefficients. Currently, the two options are <code>A.struc = "unstructured"</code> corresponding to assuming an fully unstructured covariance matrix, and <code>A.struc = "block"</code> which assumes a block diagonal structure where the all covariances between different smoothing covariates are assumed to be zero (but the covariance submatrix remains unstructured within the spline basis functions for a selected smoothing covariate). The latter is sub-optimal in the sense that the most appropriate variational distribution should use a completely unstructured covariance matrix , but MAY (but is not guaranteed) save computation time especially when the number of smoothing covariates and/or the number of interior knots is very large.</p>
</td></tr>
<tr><td><code id="vagam_+3A_offset">offset</code></td>
<td>
<p>This can be used to specify an a-priori known component to be included in the linear predictor during fitting.  This should be <code>NULL</code> or a numeric vector of length equal to <code>length(y)</code>.</p>
</td></tr>  
<tr><td><code id="vagam_+3A_save.data">save.data</code></td>
<td>
<p>If <code>save.date=TRUE</code>, then the returned vagam object will also include <code>y, smooth.X, para.X</code>, and the full matrix of P-spline basis functions.</p>
</td></tr>
<tr><td><code id="vagam_+3A_para.se">para.se</code></td>
<td>
<p>If <code>para.se=TRUE</code>, the standard errors based on the VA approach are returned for any covariates in <code>para.X</code> that are included as parametric terms. Note that if <code>para.se=FALSE</code> then a standard error for the intercept term will not be returned even though an intercept term is included by default.</p>
</td></tr>
<tr><td><code id="vagam_+3A_doic">doIC</code></td>
<td>
<p>If <code>doIC=TRUE</code>, then the AIC and BIC are returned, where the AIC is calculated as <code class="reqn">AIC = -2\times</code> variation log-likelihood <code class="reqn">+ 2\times trace(H)</code> with <code class="reqn">trace(H)</code> bring a measure of the degrees of freedom of the model as based on the hat-matrix arising from iterative reweighted least squares, and the BIC replaces the 2 with <code>log(length(y))</code> for the model complexity penalty; please see Wood (2017) for more details. Note however that this out is largely mute as the VA approach provides an automatic method of selecting the smoothing parameters, meaning an external approach such as information criteria is not required.</p>
</td></tr>
<tr><td><code id="vagam_+3A_control">control</code></td>
<td>
<p>A list controlling the finer details of the VA approach for fitting GAMs. These include:
</p>

<ul>
<li><p>mc.samps:This controls Monte Carlo samples for calculating variational observed information matrix using Louis' method
</p>
</li>
<li><p>seed:This controls seed for starting values of the fitting algorithm in general
</p>
</li>
<li><p>pois.step.size:This controls step size for penalized iterative reweighted least squares (P-IRLS) portion of the VA approach when <code>family=poisson()</code>. This may be tweaked to use smaller step sizes as the approach here can be a tad unstable especially if there is possible overdispersion.
</p>
</li></ul>

</td></tr>
</table>


<h3>Details</h3>

<p>Please note that the package is still in its early days, and only a very basic form of GAMs with purely additive
terms and P-splines is fitted. The function borrows heavily from the excellent software available in the mgcv
package (Wood, 2017), in the sense that it uses the <code>smooth.construct</code> function with <code>bs = "ps"</code> to
set up the matrix of P-splines bases (so cubic B-splines with a first order difference penalty matrix) along with
imposing the necessary centering constraints. With these ingredients, it then maximizes the variational 
log-likelihood by iteratively updating the model and variational parameters. The variational log-likelihood
is obtained by proposing a variational distribution for the smoothing coefficients (in this case, a multivariate
normal distribution between unknown mean vector and covariance matrix), and then minimizing the Kullback-Leibler
distance between this variational distribution and the true posterior distribution of the smoothing coefficients.
In turn, this is designed to be (closed to) fully tractable lower bound approximation to the true marginal
log-likelihood for the GAM, which for non-normal responses does not possess a tractable form. Note that in
contrast to the marginal log-likelihood or many approximations such the Laplace approximation and adaptive
quadrature, the variational approximation typically presents a tractable form that is relatively straightforward
to maximize. At the same time, because it takes views the GAM as a mixed model, then it also possesses nice
inference tools such as an approximate posterior distribution of the smoothing coefficients available immediately
from maximizing the VA log-likelihood, and automatic choice of the smoothing parameters. We refer to readers to
Wood (2017) and Ruppert et al. (2003) for detailed introductions to GAMs and how many of them can be set up as
mixed models; Eilers and Marx (1996) for the seminal text on P-splines, and Hui et al. (2018) for the text on 
which this package is based.
</p>


<h3>Value</h3>

<p>An object of vagam class containing one or more of the following elements:
</p>

<ul>
<li><p>call:The matched call.
</p>
</li>
<li><p>kappa:The estimated regression coefficients corresponding to the covariates in <code>para.X</code>. This includes the intercept term.
</p>
</li>
<li><p>a:The estimated smoothing coefficients corresponding to the (P-spline bases set up for) covariates in <code>smooth.X</code>. This corresponds to the mean vector of the variational distribution.
</p>
</li>
<li><p>A:The estimated posterior covariance of the smoothing coefficients corresponding to the (P-spline bases set up for) covariates in <code>smooth.X</code>. This corresponds to the covariance matrix of the variational distribution.
</p>
</li>
<li><p>lambda:The estimated smoothing parameters, or the fixed smoothing parameters if <code>lambda</code> was supplied.
</p>
</li>
<li><p>IC:A vector containing the calculated values of and AIC and BIC if <code>doIC=TRUE</code>. Note this is largely a mute output.
</p>
</li>
<li><p>phi:The estimated residual variance when <code>family=gaussian()</code>.
</p>
</li>
<li><p>linear.predictors:The estimated linear predictor i.e., the parametric plus nonparametric component.
</p>
</li>
<li><p>logL:The maximized value of the variational log-likelihood.
</p>
</li>
<li><p>no.knots:The number of interior knots used, as per <code>int.knots</code>.
</p>
</li>
<li><p>index.cov:A vector indexing which covariate each column in the final full matrix P-spline bases belongs to.
</p>
</li>
<li><p>basis.info:A list with length equal to <code>ncol(smooth.X)</code>, with each element being the output from an application of <code>smooth.construct</code> to construct the P-spline for a selected covariate in <code>smooth.X</code>.
</p>
</li>
<li><p>y, para.X, smooth.X, Z:Returned in <code>save.data=TRUE</code>. Note critically that <code>Z</code> final full matrix P-spline basis functions. 
</p>
</li>
<li><p>smooth.stat:A small table of summary statistics for the nonparametric component of the GAM, including an approximate Wald-type hypothesis test for the significance of each nonparametric covariate.
</p>
</li>
<li><p>para.stat:If <code>para.se=TRUE</code>, then a small table containing summary statistics for the estimated parametric component of the GAM, including an approximate Wald-type hypothesis test for the significance of each parameteric covariate.
</p>
</li>
<li><p>obs.info:If <code>para.se=TRUE</code>, then the estimated variational observed information matrix for the parameteric component of the GAM; please see Hui et al. (2018) for more information.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>NA
</p>


<h3>References</h3>


<ul>
<li><p> Eilers, P. H. C., and Marx, B. D. (1996) Flexible Smoothing with B-splines and Penalties.  Statistical Science, 11: 89-121
</p>
</li>
<li><p> Hui, F. K. C., You, C., Shang, H. L., and Mueller, S. (2018). Semiparametric regression using variational approximations, <em>Journal of the American Statistical Association</em>, <b>forthcoming</b>.
</p>
</li>
<li><p> Ruppert, D., Wand M. P., and Carroll, R. J. (2003) Semiparametric Regression. Cambridge University Press.
</p>
</li>
<li><p> Wood, S. N. (2017) Generalized Additive Models: An Introduction with R (2nd edition). Chapman and Hall/CRC.
</p>
</li></ul>
 

<h3>See Also</h3>

<p><code><a href="#topic+summary.vagam">summary.vagam</a></code> for a basic summary of the fitted model; <code><a href="#topic+plot.vagam">plot.vagam</a></code> for basic plotting the component smooths; <code><a href="#topic+predict.vagam">predict.vagam</a> for basic prediction</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Example 1: Application to wage data
data(wage_data)

south_code &lt;- gender_code &lt;- race_code &lt;- union_code &lt;- vector("numeric", nrow(wage_data))
union_code[wage_data$union == "member"] &lt;- 1
south_code[wage_data$south == "yes"] &lt;- 1
gender_code[wage_data$gender == "female"] &lt;- 1
race_code[wage_data$race == "White"] &lt;- 1
para.X &lt;- data.frame(south = south_code, gender = gender_code, race = race_code)

fit_va &lt;- vagam(y = union_code, smooth.X = wage_data[,c("education", "wage", "age")],
                       para.X = para.X,
                       int.knots = 8, save.data = TRUE, 
                       family = binomial(), 
                       para.se = TRUE)
summary(fit_va)

a &lt;- 1
par(mfrow = c(1, 3), las = 1, cex = a, cex.lab = a+0.2, cex.main = a+0.5, mar = c(5,5,3,2))
plot(fit_va, ylim = c(-2.7, 2.7), select = 1, 
                        xlab = "Education", ylab = "Smooth of Education", lwd = 3)
plot(fit_va, ylim = c(-2.7, 2.7), select = 2, 
                        xlab = "Wage", ylab = "Smooth of Wage", main = "Plots from VA-GAM", lwd = 3)
plot(fit_va, ylim = c(-2.7, 2.7), select = 3, 
                        xlab = "Age", ylab = "Smooth of Age", lwd = 3)

                      
## Not run: 
## Example 2: Simulated data with size = 50 and compare how GAMs can be fitted 
## in VA and mgcv (which uses penalized quasi-likelihood)
choose_k &lt;- 5 * ceiling(50^0.2)
true_beta &lt;- c(-1, 0.5)

poisson_dat &lt;- gamsim(n = 50, dist = "poisson", extra.X = data.frame(intercept = rep(1,50), 
                        treatment = rep(c(0,1), each = 50/2)), beta = true_beta)

## GAM using VA
fit_va &lt;- vagam(y = poisson_dat$y, smooth.X = poisson_dat[,2:5], 
		         para.X = data.frame(treatment = poisson_dat$treatment), 
                          int.knots = choose_k, save.data = TRUE, family = poisson(), 
                          para.se = TRUE)
summary(fit_va)
                       
## GAM using mgcv with default options
fit_mgcv1 &lt;- gam(y ~ treatment + s(x0) + s(x1) + s(x2) + s(x3), 
                             data = poisson_dat, family = poisson())


## GAM using mgcv with P-splines and preset knots; 
## this is equivalent to VA in terms of the splines bases functions 
fit_mgcv2 &lt;- gam(y ~ treatment + s(x0, bs = "ps", k = round(choose_k/2) + 2, m  = c(2,1)) + 
                             s(x1, bs = "ps", k = round(choose_k/2) + 2, m  = c(2,1)) + 
                             s(x2, bs = "ps", k = round(choose_k/2) + 2, m  = c(2,1)) + 
                             s(x3, bs = "ps", k = round(choose_k/2) + 2, m  = c(2,1)), 
                             data = poisson_dat, family = poisson())                     

## End(Not run)
</code></pre>

<hr>
<h2 id='wage_data'>
Union membership data set
</h2><span id='topic+wage_data'></span>

<h3>Description</h3>

<p>1985 North American population survey containing information on union membership and various worker's attributes. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("wage_data")</code></pre>


<h3>Format</h3>

<p>A data frame with 534 observations on the following 11 variables.
</p>

<dl>
<dt><code>education</code></dt><dd><p>a numeric vector.</p>
</dd>
<dt><code>south</code></dt><dd><p>a factor with levels <code>no</code> <code>yes</code>.</p>
</dd>
<dt><code>gender</code></dt><dd><p>a factor with levels <code>female</code> <code>male</code>.</p>
</dd>
<dt><code>experience</code></dt><dd><p>a numeric vector.</p>
</dd>
<dt><code>union</code></dt><dd><p>a factor with levels <code>member</code> <code>not_member</code>.</p>
</dd>
<dt><code>wage</code></dt><dd><p>a numeric vector.</p>
</dd>
<dt><code>age</code></dt><dd><p>a numeric vector.</p>
</dd>
<dt><code>race</code></dt><dd><p>a factor with levels <code>Hispanic</code> <code>Other</code> <code>White</code>.</p>
</dd>
<dt><code>occupation</code></dt><dd><p>a factor with levels <code>Clerical</code> <code>Management</code> <code>Other</code> <code>Professional</code> <code>Sales</code> <code>Service</code>.</p>
</dd>
<dt><code>section</code></dt><dd><p>a factor with levels <code>Construction</code> <code>Manufacturing</code> <code>Other</code>.</p>
</dd>
<dt><code>marital</code></dt><dd><p>a factor with levels <code>Married</code> <code>Unmarried</code>.</p>
</dd>
</dl>



<h3>Details</h3>

<p>The data consist of <code class="reqn">n=534</code> observations, with the response being a Bernoulli variable of whether they were a member of union (1 = yes; 0 = no), and six covariates: gender (1 = female, 0 = male), race (1 = white; 0 = other), an indicator variable for whether the worker lives in the south (1 = yes; 0 = no), age in years, hourly wage, and number of years in education. 
</p>
<p>One of the aims of the survey is to uncover associations between workers' characteristics and their probability of union membership. The dataset is used in Ruppert et al., (2003) and Hui et al. (2018), among others, to illustrate the application of Semiparametric regression, as it is believed that union membership may vary non-linearly with the three continuous variables (age, wage, education). 
</p>


<h3>Source</h3>

<p>http://mldata.org/repository/data/viewslug/statlib-20050214-cps_85_wages/
</p>


<h3>References</h3>


<ul>
<li><p> Berndt, E. (1991). The Practice of Econometrics: Classic and Contemporary. Addison-Wesley Publishing Company, Reading, Massachusetts.
</p>
</li>
<li><p> Hui, F. K. C., You, C., Shang, H. L., and Mueller, S. (2018). Semiparametric regression using variational approximations, <em>Journal of the American Statistical Association</em>, <b>forthcoming</b>.
</p>
</li>
<li><p> Ruppert, D., Wand, M. P., and Carroll, R. (2003). Semiparametric Regression. Cambridge University Press, New York.
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'>data(wage_data)

## Please see examples in the help file for the vagam function.
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
