<!DOCTYPE html><html><head><title>Help for package stmCorrViz</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {stmCorrViz}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#findThreshold'>
<p>Find appropriate threshold range</p></a></li>
<li><a href='#immigration_perceptions'>
<p>Sample STM Model</p></a></li>
<li><a href='#stmCorrViz'>
<p>Generate STM Correlation Tree</p></a></li>
<li><a href='#stmCorrViz-package'>
<p>Hierarchical Correlation View of STM Models</p></a></li>
<li><a href='#stmJSON'>
<p>Generate JSON Representation of STM Model</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>A Tool for Structural Topic Model Visualizations</td>
</tr>
<tr>
<td>Version:</td>
<td>1.3</td>
</tr>
<tr>
<td>Date:</td>
<td>2016-07-03</td>
</tr>
<tr>
<td>Imports:</td>
<td>jsonlite, stm, tm, SnowballC, stats, methods, utils</td>
</tr>
<tr>
<td>Depends:</td>
<td>R(&ge; 2.10.0)</td>
</tr>
<tr>
<td>Author:</td>
<td>Antonio Coppola, Margaret Roberts, Brandon Stewart, Dustin Tingley</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Antonio Coppola &lt;acoppola@alumni.harvard.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Generates an interactive visualization of topic correlations/
    hierarchy in a Structural Topic Model (STM) of Roberts, Stewart, and Tingley.
    The package performs a hierarchical clustering of topics which are then exported
    to a JSON object and visualized using D3.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>5.0.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2016-07-23 20:21:13 UTC; acoppola</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2016-07-24 09:28:14</td>
</tr>
</table>
<hr>
<h2 id='findThreshold'>
Find appropriate threshold range
</h2><span id='topic+findThreshold'></span>

<h3>Description</h3>

<p>This function performs a grid search over potential clustering thresholds to identify a valid range, and inspect the varying levels of aggregation within it.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>findThreshold(mod, documents_raw=NULL, documents_matrix=NULL, 
              range_min=.05, range_max=5, step=.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="findThreshold_+3A_mod">mod</code></td>
<td>

<p>A fitted <code>STM</code> object from <span class="pkg">stm</span>.  
</p>
</td></tr>
<tr><td><code id="findThreshold_+3A_documents_raw">documents_raw</code></td>
<td>

<p>The raw documents used to generate the STM model. A character vector where each entry is the full text of a document.
</p>
</td></tr>
<tr><td><code id="findThreshold_+3A_documents_matrix">documents_matrix</code></td>
<td>

<p>Document-term matrix representation of the raw documents, as generated by the <code><a href="stm.html#topic+prepDocuments">prepDocuments</a></code> function.
</p>
</td></tr>
<tr><td><code id="findThreshold_+3A_range_min">range_min</code></td>
<td>

<p>Lower bound of the range to be searched.
</p>
</td></tr>
<tr><td><code id="findThreshold_+3A_range_max">range_max</code></td>
<td>

<p>Upper bound of the range to be searched.
</p>
</td></tr>
<tr><td><code id="findThreshold_+3A_step">step</code></td>
<td>

<p>Step size for the grid search.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame containing the following columns:
</p>

<ol>
<li> <p><em>threshold</em>: Threshold value.
</p>
</li>
<li> <p><em>valid</em>: Binary value; 1 if clustering is successful using given threshold; 0 if not.
</p>
</li>
<li> <p><em>juncture_points</em>: Number of juncture points in the resulting clustering tree; -1 if run is unsuccessful. Lower threshold values yield a higher number of juncture points, corresponding to more binary splits and deeper trees. Higher threshold values produce fewer juncture points, corresponding to trees that have significant breadth rather than depth.
</p>
</li></ol>



<h3>See Also</h3>

<p><code><a href="#topic+stmCorrViz">stmCorrViz</a></code>
</p>

<hr>
<h2 id='immigration_perceptions'>
Sample STM Model
</h2><span id='topic+immigration_perceptions'></span>

<h3>Description</h3>

<p>This is an example of a fitted STM object, alongside the raw document data used to fit the model. The model has 20 topics, 341 documents and a 455 word dictionary. For background about the underlying dataset, see <code><a href="stm.html#topic+gadarian">gadarian</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(immigration_perceptions)</code></pre>


<h3>Format</h3>

<p>A list with the following elements:
</p>

<dl>
<dt><code>model</code></dt><dd><p>The STM model object.</p>
</dd>
<dt><code>raw_documents</code></dt><dd><p>A character vector containing the raw documents.</p>
</dd>
<dt><code>documents_matrix</code></dt><dd><p>Processed documents in bag-of-words matrix representation.</p>
</dd>
</dl>



<h3>See Also</h3>

<p><code><a href="stm.html#topic+gadarian">gadarian</a></code>
</p>

<hr>
<h2 id='stmCorrViz'>
Generate STM Correlation Tree
</h2><span id='topic+stmCorrViz'></span>

<h3>Description</h3>

<p>This function generates an interactive, full-model HTML visualization of topic hierachies for a fitted <a href="http://structuraltopicmodel.com/">STM</a> model. The visualization highlights the correlations among topics, and can be used to view the model at differing levels of complexity. The function makes use of the <a href="http://d3js.org/">D3.js</a> visualization library. The visualization needs to be viewed in a compatible web browser.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stmCorrViz(mod, file_out, documents_raw=NULL, documents_matrix=NULL,
           title="STM Model", clustering_threshold=FALSE,
           search_options = list(range_min=.05, range_max=5, step=.05), 
           labels_number=7, display=TRUE, verbose=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stmCorrViz_+3A_mod">mod</code></td>
<td>

<p>A fitted <code>STM</code> object from <span class="pkg">stm</span>.  
</p>
</td></tr>
<tr><td><code id="stmCorrViz_+3A_file_out">file_out</code></td>
<td>

<p>Name of the output file that will be generated by the function. This should end with an HTML extension.</p>
</td></tr>
<tr><td><code id="stmCorrViz_+3A_documents_raw">documents_raw</code></td>
<td>

<p>The raw documents used to generate the STM model. A character vector where each entry is the full text of a document.
</p>
</td></tr>
<tr><td><code id="stmCorrViz_+3A_documents_matrix">documents_matrix</code></td>
<td>

<p>Document-term matrix representation of the raw documents, as generated by the <code><a href="stm.html#topic+prepDocuments">prepDocuments</a></code> function.
</p>
</td></tr>
<tr><td><code id="stmCorrViz_+3A_title">title</code></td>
<td>

<p>Root node label. This defaults to &quot;STM Model&quot;.
</p>
</td></tr>
<tr><td><code id="stmCorrViz_+3A_clustering_threshold">clustering_threshold</code></td>
<td>

<p>A parameter specifying the level of aggregation in the hierarchical clustering routine for topics. Lower threshold values produce more binary splits and deeper trees, while higher threshold values produce more aggregation and trees that have significant breadth rather than depth. See below for more details.
</p>
<p>If <code>FALSE</code>, a grid search is performed to find valid thresholds is performed using <code><a href="#topic+findThreshold">findThreshold</a></code>. The valid clustering threshold resulting in a median level of tree complexity is chosen.
</p>
</td></tr>
<tr><td><code id="stmCorrViz_+3A_search_options">search_options</code></td>
<td>

<p>List specifying the grid search parameters to be used by <a href="#topic+findThreshold">findThreshold</a>. Only necessary if <code>clustering_threshold</code> is <code>FALSE</code>. 
</p>
</td></tr>
<tr><td><code id="stmCorrViz_+3A_labels_number">labels_number</code></td>
<td>

<p>The number of top words used to label each node (topic or topical cluster) in the visualization.
</p>
</td></tr>
<tr><td><code id="stmCorrViz_+3A_display">display</code></td>
<td>

<p>Boolean. If set to TRUE, the visualization is launched in the system's default web browser upon function execution.
</p>
</td></tr>
<tr><td><code id="stmCorrViz_+3A_verbose">verbose</code></td>
<td>

<p>Boolean. If set to TRUE, displays function progress in the console during execution.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function generates a full-model, interactive, general-purpose hierarchical representation of an STM model.
First a hierarchy of topics is created using hierarchical clustering as implemented in <code>hclust</code>.
Then the hierarchy is written out to a JSON object using <code><a href="#topic+stmJSON">stmJSON</a></code>.  Finally <a href="http://d3js.org/">D3.js</a> is used to create
an interactive visualization.
</p>
<p>The visualization is built as a HTML page, and as such requires a web browser for inspection. 
The function does not return and object, but writes HTML output to disk.
</p>
<p>The visualization takes the form of an indented tree. The leaves of the tree correspond to topics. 
The leaf nodes are grouped in topic clusters. This allows the model to be visualized at differing levels of aggregation.
The function uses the D3.js library for visualization purpose. 
The visualization is largely built on top of Mike Bostock's <a href="http://bl.ocks.org/mbostock/1093025">Collapsible Indented Tree</a> block. A nested JSON structure representing the hierarchical model is produced using the <code><a href="#topic+stmJSON">stmJSON</a></code> function.
</p>


<h3>References</h3>

<p>Bostock M, Vadim O, Jeffrey H. D3: Data-Driven Documents. Visualization and Computer Graphics, IEEE Transactions on 17.12 (2011): 2301-2309.
</p>
<p>Margaret E. Roberts, Brandon M. Stewart and Dustin Tingley (2014). <a href="http://structuraltopicmodel.com/">stm: R Package for Structural Topic Models</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+stmJSON">stmJSON</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(immigration_perceptions)

stmCorrViz(immigration_perceptions$model, "corrviz.html", 
  documents_raw=immigration_perceptions$raw_documents, 
  documents_matrix=immigration_perceptions$documents_matrix)
</code></pre>

<hr>
<h2 id='stmCorrViz-package'>
Hierarchical Correlation View of STM Models
</h2><span id='topic+stmCorrViz-package'></span>

<h3>Description</h3>

<p>Generates an interactive visualization of topic correlations/hierarchy in a Structural Topic Model (STM) of Roberts, Stewart, and Tingley.  The package performs a hierarchical clustering of topics which are then exported to a JSON object and visualized using D3.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> stmCorrViz</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.3</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2016-07-03</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL (&gt;= 2) </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Antonio Coppola, Margaret E. Roberts, Brandon M. Stewart, and Dustin Tingley
</p>
<p>Maintainer: Antonio Coppola &lt;acoppola@alumni.harvard.edu&gt;
</p>


<h3>References</h3>

<p>Margaret E. Roberts, Brandon M. Stewart and Dustin Tingley (2014). <a href="http://structuraltopicmodel.com/">stm: R Package for Structural Topic Models</a>.
</p>

<hr>
<h2 id='stmJSON'>
Generate JSON Representation of STM Model
</h2><span id='topic+stmJSON'></span>

<h3>Description</h3>

<p>This function generates a nested JSON structure representing a fitted Structual Topic Model (<a href="http://structuraltopicmodel.com/">STM</a>).
Used internally by <code><a href="#topic+stmCorrViz">stmCorrViz</a></code>.  Most users will not need to call this directly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stmJSON(mod, documents_raw=NULL, documents_matrix=NULL,
         title="STM Model", clustering_threshold=1.5,
         labels_number=7, verbose)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stmJSON_+3A_mod">mod</code></td>
<td>

<p>An <code>STM</code> fitted model from the <span class="pkg">stm</span> package.  
</p>
</td></tr>
<tr><td><code id="stmJSON_+3A_documents_raw">documents_raw</code></td>
<td>

<p>The raw documents used to generate the STM model. A character vector where each entry is the full text of a document.
</p>
</td></tr>
<tr><td><code id="stmJSON_+3A_documents_matrix">documents_matrix</code></td>
<td>

<p>Document-term matrix representation of the raw documents, as generated by the <code><a href="stm.html#topic+prepDocuments">prepDocuments</a></code> function.
</p>
</td></tr>
<tr><td><code id="stmJSON_+3A_title">title</code></td>
<td>

<p>Root node label. This defaults to &quot;STM Model&quot;.
</p>
</td></tr>
<tr><td><code id="stmJSON_+3A_clustering_threshold">clustering_threshold</code></td>
<td>

<p>A parameter specifying the level of aggregation in the hierarchical clustering routine for topics. Lower threshold values produce more binary splits and deeper trees, while higher threshold values produce more aggregation and trees that have significant breadth rather than depth. See below for more details.
</p>
</td></tr>
<tr><td><code id="stmJSON_+3A_labels_number">labels_number</code></td>
<td>

<p>The number of top words used to label each node (topic or topical cluster) in the visualization.
</p>
</td></tr>
<tr><td><code id="stmJSON_+3A_verbose">verbose</code></td>
<td>

<p>Logical. If set to TRUE, displays function progress in the console during execution.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A nested JSON structure representing the hierarchical model is produced as follows. The function first retrieves the theta matrix from the STM object; accordingly computes correlations among topics; and then uses the correlation metrics to compute distances. The function finally performs hierarchical clustering on the topics by calling the <code><a href="stats.html#topic+hclust">hclust</a></code> function.
</p>
<p>The function finds all binary splits in the middle of the clustering tree whose clustering height measure is below the threshold specified in the <code>clustering_threshold</code> argument. All these splits are marked as aggregation points. The routine retrieves the merge matrix from the output of <code>hclust</code>, and produces a new merge list by deleting all the splits performed at aggregation points along the tree. While the <code>hclust</code> merge matrix only contains binary splits, the new merge list can contain non-binary cluster splits.
</p>
<p>The merge list is transformed into a structure of nested lists with a recursive function call. Each level of this nested structure corresponds to a node in the hierarchical representation of the STM model. The data structure is eventually transformed into a JSON object by using the <a href="https://cran.r-project.org/package=jsonlite"><span class="pkg">jsonlite</span></a> package.
</p>
<p>New beta matrices and top words are computed for each of the topic clusters according to their membership, by marginalizing over content covariates. The clusters are labeled accordingly.
</p>


<h3>Value</h3>

<p>A JSON string representing the full STM model.
</p>


<h3>References</h3>

<p>Margaret E. Roberts, Brandon M. Stewart and Dustin Tingley (2014). <a href="http://structuraltopicmodel.com/">stm: R Package for Structural Topic Models</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+stmCorrViz">stmCorrViz</a></code>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
