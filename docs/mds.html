<!DOCTYPE html><html><head><title>Help for package mds</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {mds}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#char_to_df'><p>Character Vector to Header of Empty Data Frame</p></a></li>
<li><a href='#convert_date'><p>Convert to Acceptable Date</p></a></li>
<li><a href='#define_analyses'><p>Assess Analyses Definitions</p></a></li>
<li><a href='#define_analyses_dataframe'><p>Create Data Frame from Analyses Definitions</p></a></li>
<li><a href='#deviceevent'><p>MD-PMS Device Event Data Frame</p></a></li>
<li><a href='#exposure'><p>MD-PMS Exposure Data Frame</p></a></li>
<li><a href='#fNA'><p>Min/Max With All NA's Allowed</p>
Min and Max functions that allows the vector <code>x</code> to be <code>NA</code>, where
<code>f</code> is <code>min</code> or <code>max</code></a></li>
<li><a href='#ifelse_cp'><p>Class-Preserving If-Else</p>
If-Else function preserving <code>T</code> &amp; <code>F</code> classes</a></li>
<li><a href='#input_param_checker'><p>Check Input Parameters</p></a></li>
<li><a href='#maude'><p>Bone Cement MAUDE Events in 2017</p></a></li>
<li><a href='#mds_ts'><p>Example List of mds_ts Time Series Objects</p></a></li>
<li><a href='#next_dev'><p>Return next level up device</p></a></li>
<li><a href='#next_ev'><p>Return next level up event</p></a></li>
<li><a href='#plot.mds_ts'><p>Plot MD-PMS Time Series</p></a></li>
<li><a href='#sales'><p>Simulated Device Sales Data</p></a></li>
<li><a href='#summary.mds_das'><p>Summarize a Collection of MD-PMS Defined Analyses</p>
Prints basic counts and date ranges by various analysis factors as defined in
the original <code>define_analyses()</code> call.</a></li>
<li><a href='#time_series'><p>Generate Time Series from Defined Analysis or Analyses</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Medical Devices Surveillance</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.2</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Gary Chung &lt;gchung05@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>A set of core functions for handling medical device event data in
    the context of post-market surveillance, pharmacovigilance, signal detection
    and trending, and regulatory reporting. Primary inputs are data on events by
    device and data on exposures by device. Outputs include: standardized
    device-event and exposure datasets, defined analyses, and time series.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.0</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats, parsedate, lubridate</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, knitr, rmarkdown</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-06-15 01:46:04 UTC; gchun</td>
</tr>
<tr>
<td>Author:</td>
<td>Gary Chung [aut, cre]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-06-15 13:30:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='char_to_df'>Character Vector to Header of Empty Data Frame</h2><span id='topic+char_to_df'></span>

<h3>Description</h3>

<p>Converts a character vector into the column names of an empty data frame.
Used in conjunction with <code>check_names</code> parameter of
<code>input_param_checker()</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>char_to_df(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="char_to_df_+3A_x">x</code></td>
<td>
<p>Input character vector.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Empty data frame where columns are named <code>x</code>.
</p>

<hr>
<h2 id='convert_date'>Convert to Acceptable Date</h2><span id='topic+convert_date'></span>

<h3>Description</h3>

<p>Converts a <code>Date</code> vector into its equivalent daily, monthly, yearly,
etc... <code>Date</code> vector.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>convert_date(x, convert_type = "months", convert_to_n = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="convert_date_+3A_x">x</code></td>
<td>
<p>Input vector of class <code>Date</code>.</p>
</td></tr>
<tr><td><code id="convert_date_+3A_convert_type">convert_type</code></td>
<td>
<p>Default: <code>"months"</code>. String value indicating the
date type. Possible values are <code>"days"</code>, <code>"months"</code>.</p>
</td></tr>
<tr><td><code id="convert_date_+3A_convert_to_n">convert_to_n</code></td>
<td>
<p>Default: <code>1</code>. Numeric value indicating the number of
<code>convert_type</code>s to convert to.
</p>
<p>Example: <code>convert_type="months"</code> and <code>convert_to_n=3</code> indicates a
quarterly conversion.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Converted <code>Date</code> vector of class <code>mdpms.Date</code> with
attributes <code>adder</code> (function that adds units),
<code>convert_to_n</code>, and <code>convert_type</code>.
</p>

<hr>
<h2 id='define_analyses'>Assess Analyses Definitions</h2><span id='topic+define_analyses'></span>

<h3>Description</h3>

<p>Define analyses based on an MD-PMS device-event data frame and, optionally,
an MD-PMS exposure data frame. See Details for how to use.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>define_analyses(
  deviceevents,
  device_level,
  event_level = NULL,
  exposure = NULL,
  date_level = "months",
  date_level_n = 1,
  covariates = "_none_",
  times_to_calc = NULL,
  invivo = FALSE,
  prior = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="define_analyses_+3A_deviceevents">deviceevents</code></td>
<td>
<p>A device-events object of class <code>mds_de</code>, created by
a call to <code>deviceevent()</code>.</p>
</td></tr>
<tr><td><code id="define_analyses_+3A_device_level">device_level</code></td>
<td>
<p>String value indicating the source device variable name
to analyze by. If <code>exposure</code> is specified, <code>exposure</code> data will be
matched by <code>device_level</code>. If a hierarchy of 2 or more are present,
see Details for important information.
</p>
<p>Example: If the <code>deviceevents</code> variable column is <code>device_1</code> where
the source variable name for <code>device_1</code> is <code>'Device Code'</code>, specify
<code>device_level='Device Code'</code>.</p>
</td></tr>
<tr><td><code id="define_analyses_+3A_event_level">event_level</code></td>
<td>
<p>String value indicating the source event variable name to
analyze by. Note that <code>event_level</code> is not matched to <code>exposure</code>.
If a hierarchy of 2 or more are present, see Details for important
information.
</p>
<p>Example: If the <code>deviceevents</code> variable column is <code>event_1</code> where
the source variable name for <code>event_1</code> is <code>'Event Code'</code>, specify
<code>event_level='Event Code'</code>.
</p>
<p>Default: <code>NULL</code> will not analyze by event.</p>
</td></tr>
<tr><td><code id="define_analyses_+3A_exposure">exposure</code></td>
<td>
<p>Optional exposure object of class <code>mds_e</code>. See details
for how exposure analyses definitions are handled.
</p>
<p>Default: <code>NULL</code> will not consider inclusion of exposure.</p>
</td></tr>
<tr><td><code id="define_analyses_+3A_date_level">date_level</code></td>
<td>
<p>String value for the primary date unit to analyze by. Can
be either <code>'months'</code> or <code>'days'</code>.
</p>
<p>Default: <code>'months'</code></p>
</td></tr>
<tr><td><code id="define_analyses_+3A_date_level_n">date_level_n</code></td>
<td>
<p>Numeric value indicating the number of <code>date_level</code>s
to analyze by.
</p>
<p>Example: <code>date_level='months'</code> and <code>date_level_n=3</code> indicates
analysis on a quarterly level.
</p>
<p>Default: <code>1</code></p>
</td></tr>
<tr><td><code id="define_analyses_+3A_covariates">covariates</code></td>
<td>
<p>Character vector specifying names of covariates to also
define analyses for. Acceptable names are covariate variables specified
in <code>deviceevents</code>. If the covariate is a factor, additional subgroup
analyses will be defined at each level of the factor. <code>"_none_"</code>
specifies no covariates, while <code>"_all_"</code> are all covariates specified in
<code>deviceevents</code>. See details for more.
</p>
<p>Example: <code>c("Country", "Region")</code>
</p>
<p>Default: <code>"_none_"</code> specifies no covariates.</p>
</td></tr>
<tr><td><code id="define_analyses_+3A_times_to_calc">times_to_calc</code></td>
<td>
<p>Integer value indicating the number of date units
counting backwards from the latest date to define analyses for. If
<code>prior</code> is specified, <code>times_to_calc</code> will be ignored.
</p>
<p>Example 1: <code>times_to_calc=12</code> with <code>date_level="months"</code> and
<code>date_level_n=1</code> defines analyses for the last year by month.
</p>
<p>Example 2: <code>times_to_calc=8</code> with <code>date_level="months"</code> and
<code>date_level_n=3</code> defines analyses for the 2 years by quarter.
</p>
<p>Default: <code>NULL</code> will define analyses across all available time.</p>
</td></tr>
<tr><td><code id="define_analyses_+3A_invivo">invivo</code></td>
<td>
<p>Logical value indicating whether to include <code>time_invivo</code>
from <code>deviceevents</code> in the analysis definition. See details for more.
</p>
<p>Default: <code>FALSE</code> will not include <code>time_invivo</code> in the analysis
definition.</p>
</td></tr>
<tr><td><code id="define_analyses_+3A_prior">prior</code></td>
<td>
<p>Future placeholder, currently not used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>define_analyses()</code> is a prerequisite to calling
<code>time_series()</code>. This function enumerates all possible analyses based
on input device-event (<code>deviceevent()</code>) and, optionally,
exposure (<code>exposure()</code>) data frames. An analysis is defined as a set of
instructions specifying at minimum the device level, event level, the date
range of analysis, and the date unit. Additional instructions include the
covariate level, time in-vivo status, and exposure levels.
</p>
<p>By separating the analysis enumeration (<code>define_analyses()</code>) from the
generation of the time series (<code>time_series()</code>), the user may rerun
the analyses on different datasets and/or filter the analyses to only those
of interest.
</p>
<p>The analyses definitions will always include rollup levels for each
of <code>device_level</code>, <code>event_level</code> (if specified), and
<code>covariates</code>. Rollups are analyses at all device, event, and/or
covariate levels. These rollup analyses will be indicated by the keyword
'All' in the analysis definition.
</p>
<p>When a hierarchy of 2 or more variables for either <code>device_level</code> or
<code>event_level</code> are present in <code>deviceevents</code>,
<code>define_analyses()</code> will enforce the 1-level-up parent level ONLY.
Additional higher parent levels are not currently enforced, thus the user is
advised to uniquely name the 1-level-up parent level. The parent level
DOES NOT ROLLUP currently because the parent level is intended to separate
disparate data and devices. This may change in the future.
</p>
<p>If <code>exposure</code> is specified, any available <code>match_levels</code> will be
used to calculate the appropriate timeframe for analyses. The exception are
the special rollup analyses (see prior paragraph).
</p>
<p>When <code>covariates</code> are specified, a special rollup analysis definition
will always be defined that does not consider the covariates at all. This
analysis can be identified by <code>covariate='Data'</code> and
<code>covariate_level='All'</code> in the output <code>mds_da</code> object.
</p>
<p>When <code>covariates</code> are specified and there is no variation in the
distribution of covariate values (e.g. all males, all 10, all missing) in the
device- and event-specific dataset, these specific analyses will be dropped.
</p>
<p>When factor <code>covariates</code> are specified, covariate-level analyses may be
defined two ways: 1) detect an overall covariate level effect,
also known as a 3-dimensional analysis, and 2) subset the data by each
level of the covariate, also known as a subgroup analysis. 1) will be
denoted as <code>covariate_level='All'</code> in the output <code>mds_da</code> object,
while 2) will specify the factor level in <code>covariate_level</code>.
</p>
<p>If <code>invivo=TRUE</code>, <code>define_analyses()</code> will first verify if data
exists in the <code>time_invivo</code> variable for the given <code>device_level</code>,
<code>event_level</code>, and, if applicable, <code>covariates</code> level. If no data
exists, <code>invivo</code> will be implicitly assigned to <code>FALSE</code>.
</p>


<h3>Value</h3>

<p>A list of defined analyses of class <code>mds_das</code>.
Each list item, indexed by a numeric key, defines a set of analyses for a
unique combination of device, event, and covariate level. Each list item is
of the class <code>mds_da</code>.
Attributes of class <code>mds_das</code> are as follows:
</p>

<dl>
<dt>date_level</dt><dd><p>Defined value for <code>date_level</code></p>
</dd>
<dt>date_level_n</dt><dd><p>Defined value for <code>date_level_n</code></p>
</dd>
<dt>device_level</dt><dd><p>Defined value for <code>device_level</code></p>
</dd>
<dt>event_level</dt><dd><p>Defined value for <code>event_level</code></p>
</dd>
<dt>times_to_calc</dt><dd><p>Defined value for <code>times_to_calc</code></p>
</dd>
<dt>prior_used</dt><dd><p>Boolean for whether <code>prior</code> was specified.</p>
</dd>
<dt>timestamp</dt><dd><p>System time when the analyses were defined.</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'># Device-Events
de &lt;- deviceevent(
  data_frame=maude,
  time="date_received",
  device_hierarchy=c("device_name", "device_class"),
  event_hierarchy=c("event_type", "medical_specialty_description"),
  key="report_number",
  covariates=c("region"),
  descriptors="_all_")
# Exposures
ex &lt;- exposure(
  data_frame=sales,
  time="sales_month",
  device_hierarchy="device_name",
  match_levels="region",
  count="sales_volume")
# Defined Analyses - Simple example
da &lt;- define_analyses(de, "device_name")
# Defined Analyses - Simple example with a quarterly analysis
da &lt;- define_analyses(de, "device_name", date_level_n=3)
# Defined Analyses - Example with event type, exposures, and covariates
da &lt;- define_analyses(de, "device_name", "event_type", ex, covariates="region")

</code></pre>

<hr>
<h2 id='define_analyses_dataframe'>Create Data Frame from Analyses Definitions</h2><span id='topic+define_analyses_dataframe'></span>

<h3>Description</h3>

<p>Returns a data frame summarizing all defined analyses from the
<code>mds_das</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>define_analyses_dataframe(inlist)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="define_analyses_dataframe_+3A_inlist">inlist</code></td>
<td>
<p>Object of class <code>mds_das</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with each row representing an analysis.
</p>

<hr>
<h2 id='deviceevent'>MD-PMS Device Event Data Frame</h2><span id='topic+deviceevent'></span>

<h3>Description</h3>

<p>Converts a data frame into a MD-PMS Device Event data frame.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>deviceevent(
  data_frame,
  time,
  device_hierarchy,
  event_hierarchy,
  key = NULL,
  covariates = NULL,
  descriptors = NULL,
  time_invivo = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="deviceevent_+3A_data_frame">data_frame</code></td>
<td>
<p>The input data frame requiring components specified in the
remaining arguments.</p>
</td></tr>
<tr><td><code id="deviceevent_+3A_time">time</code></td>
<td>
<p>Character name of date variable in <code>data_frame</code>
corresponding to the event. Class must be Date, POSIXt, or character.
</p>
<p>Example: <code>"event_date"</code></p>
</td></tr>
<tr><td><code id="deviceevent_+3A_device_hierarchy">device_hierarchy</code></td>
<td>
<p>Vector of character variable names representing the
device hierarchy in <code>data_frame</code>. Vector ordering is lowest level first,
most general level last. If more than 2 variables, see important note in
Details.
</p>
<p>Example: <code>c("Version", "Device", "ProductLine")</code></p>
</td></tr>
<tr><td><code id="deviceevent_+3A_event_hierarchy">event_hierarchy</code></td>
<td>
<p>Vector of character variable names representing the
event hierarchy in <code>data_frame</code>. Vector ordering is most specific event
category first, most broad event category last. If more than 2 variables,
see important note in Details.
</p>
<p>Example: <code>c("Event Code", "Event Group")</code></p>
</td></tr>
<tr><td><code id="deviceevent_+3A_key">key</code></td>
<td>
<p>Character name of (uniquely identifying) primary key variable in
<code>data_frame</code>. Class must be character or numeric.
</p>
<p>Example: <code>"key_ID"</code>
</p>
<p>Default: <code>NULL</code> will create a key variable.</p>
</td></tr>
<tr><td><code id="deviceevent_+3A_covariates">covariates</code></td>
<td>
<p>Vector of character variable names representing the
desired covariates to retain, all of which must be of class <code>numeric</code>
or <code>factor</code>.  <code>"_all_"</code> includes all covariates, assumed
to be remaining variables in <code>data_frame</code> not already specified in
<code>key</code>, <code>time</code>, <code>device_hierarchy</code>, or <code>event_hierarchy</code>.
Covariates must be numeric, categorical, or binary in nature.
</p>
<p>Example: <code>c("Reporter", "Operation Time", "Country")</code>
</p>
<p>Default: <code>NULL</code> includes no covariates.</p>
</td></tr>
<tr><td><code id="deviceevent_+3A_descriptors">descriptors</code></td>
<td>
<p>Vector of character variable names representing additional
descriptive variables that will not be used in any analyses but may be
recalled or displayed later during individual device-event review.
<code>"_all_"</code> includes all remaining variables in <code>data_frame</code> not
already specified in <code>key</code>, <code>time</code>, <code>device_hierarchy</code>,
<code>event_hierarchy</code>, or <code>covariates</code>. Typical descriptors are
free text or high-dimensional categoricals.
</p>
<p>Example: <code>c("Description", "Unique Device Identifier")</code>
</p>
<p>Default: <code>NULL</code> includes no descriptors.</p>
</td></tr>
<tr><td><code id="deviceevent_+3A_time_invivo">time_invivo</code></td>
<td>
<p>Character name of numeric variable in <code>data_frame</code>
representing the time in vivo of the device at the time of the event
<code>time</code>. See details for more.
</p>
<p>IMPORTANT: If a call to <code>define_analyses()</code> is planned,
<code>time_invivo</code> must be in the time units specified collectively by its
parameters <code>date_level</code> and <code>date_level_n</code>.
</p>
<p>Example: <code>"Implanted Months"</code>. A value of <code>45</code> in the
variable <code>data_frame$'Implanted Months'</code> would indicate 45 units of time
elapsed since the device was first in vivo. If <code>date_level="months"</code> and
<code>date_level_n=1</code>, this will be interpreted by <code>define_analyses()</code>
as 45 months.
</p>
<p>Default: <code>NULL</code> indicates this variable will not be used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When more than 2 variables are specified in either <code>device_hierarchy</code>
or <code>event_hierarchy</code>, it is important to note that a subsequent call to
<code>define_analyses()</code> currently only utilizes a maximum of 2 variables:
the lowest level and the 1-level-up parent. The user may enforce full
hierarchy in &gt;2 variable cases by ensuring that the parent values are
uniquely named.
</p>
<p><code>time_invivo</code> can be thought of more generally as the time of
exposure of the device to the subject at the time of the event. The common
usage is duration of the implant in the patient at time of event, for an
implantable medical device.
</p>


<h3>Value</h3>

<p>A standardized MD-PMS data frame of class <code>mds_de</code>.
Rows are deduplicated. Attributes are as follows:
</p>

<dl>
<dt>key</dt><dd><p>Original variable name for <code>key</code></p>
</dd>
<dt>time</dt><dd><p>Original variable name for <code>time</code></p>
</dd>
<dt>device_hierarchy</dt><dd><p>Vector of original variable names for
<code>device_hierarchy</code> with converted variable names correspondingly
named.</p>
</dd>
<dt>event_hierarchy</dt><dd><p>Vector of original variable names for
<code>event_hierarchy</code> with converted variable names correspondingly
named.</p>
</dd>
<dt>covariates</dt><dd><p>Vector of original variable names for
<code>covariates</code> with converted variable names correspondingly
named.</p>
</dd>
<dt>descriptors</dt><dd><p>Vector of original variable names for
<code>descriptors</code> with converted variable names correspondingly
named.</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'># A barebones dataset
de &lt;- deviceevent(maude, "date_received", "device_name", "event_type")
# With more variables and variable types
de &lt;- deviceevent(
  data_frame=maude,
  time="date_received",
  device_hierarchy=c("device_name", "device_class"),
  event_hierarchy=c("event_type", "medical_specialty_description"),
  key="report_number",
  covariates=c("region"),
  descriptors="_all_")

</code></pre>

<hr>
<h2 id='exposure'>MD-PMS Exposure Data Frame</h2><span id='topic+exposure'></span>

<h3>Description</h3>

<p>Converts a data frame into a MD-PMS Exposure data frame.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>exposure(
  data_frame,
  time,
  device_hierarchy,
  event_hierarchy = NULL,
  key = NULL,
  match_levels = NULL,
  count = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="exposure_+3A_data_frame">data_frame</code></td>
<td>
<p>The input data frame requiring components specified in the
remaining arguments.</p>
</td></tr>
<tr><td><code id="exposure_+3A_time">time</code></td>
<td>
<p>Character name of date variable in <code>data_frame</code>. Class must
be Date, POSIXt, or character.
</p>
<p>Example: <code>"event_date"</code></p>
</td></tr>
<tr><td><code id="exposure_+3A_device_hierarchy">device_hierarchy</code></td>
<td>
<p>Vector of character variable names representing the
device hierarchy in <code>data_frame</code>. Vector ordering is lowest level first,
most general level last.
</p>
<p>Example: <code>c("Version", "Device", "ProductLine")</code></p>
</td></tr>
<tr><td><code id="exposure_+3A_event_hierarchy">event_hierarchy</code></td>
<td>
<p>Vector of character variable names representing the
event hierarchy in <code>data_frame</code>. Vector ordering is most specific event
category first, most broad event category last.
</p>
<p>Example: <code>c("Family", "Device", "ProductCode")</code>
</p>
<p>Default: <code>NULL</code> will not include any event hierarchy.</p>
</td></tr>
<tr><td><code id="exposure_+3A_key">key</code></td>
<td>
<p>Character name of (uniquely identifying) primary key variable in
<code>data_frame</code>. Class must be character or numeric.
</p>
<p>Example: <code>"key_ID"</code>
</p>
<p>Default: <code>NULL</code> will create a key variable.</p>
</td></tr>
<tr><td><code id="exposure_+3A_match_levels">match_levels</code></td>
<td>
<p>Vector of character variable names in <code>data_frame</code>
representing additional grouping factors for exposure. Specified variables
will be implicitly matched to equivalently named variables contained in the
<code>mds_de</code> object class.
</p>
<p>Example: <code>c("Country", "Region")</code>
</p>
<p>Default: <code>NULL</code> will not include any additional grouping factors.</p>
</td></tr>
<tr><td><code id="exposure_+3A_count">count</code></td>
<td>
<p>Character name of exposure count variable in <code>data_frame</code>.
Class must be numeric.
</p>
<p>Example: <code>"Units Sold"</code>
</p>
<p>Default: <code>NULL</code> will assume each row represents one exposure.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A standardized MD-PMS data frame of class <code>mds_e</code>.
Rows are deduplicated. Attributes are as follows:
</p>

<dl>
<dt>key</dt><dd><p>Original variable name for <code>key</code></p>
</dd>
<dt>time</dt><dd><p>Original variable name for <code>time</code></p>
</dd>
<dt>device_hierarchy</dt><dd><p>Vector of original variable names for
<code>device_hierarchy</code> with converted variable names correspondingly
named.</p>
</dd>
<dt>event_hierarchy</dt><dd><p>Vector of original variable names for
<code>event_hierarchy</code> with converted variable names correspondingly
named.</p>
</dd>
<dt>match_levels</dt><dd><p>Vector of variable names for grouping factors</p>
</dd>
<dt>count</dt><dd><p>Original variable name for <code>count</code></p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'># A barebones dataset
ex &lt;- exposure(sales, "sales_month", "device_name")
# With more variables and variable types
ex &lt;- exposure(
  data_frame=sales,
  time="sales_month",
  device_hierarchy="device_name",
  match_levels="region",
  count="sales_volume")

</code></pre>

<hr>
<h2 id='fNA'>Min/Max With All NA's Allowed
Min and Max functions that allows the vector <code>x</code> to be <code>NA</code>, where
<code>f</code> is <code>min</code> or <code>max</code></h2><span id='topic+fNA'></span>

<h3>Description</h3>

<p>Min/Max With All NA's Allowed
Min and Max functions that allows the vector <code>x</code> to be <code>NA</code>, where
<code>f</code> is <code>min</code> or <code>max</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fNA(x, f)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fNA_+3A_x">x</code></td>
<td>
<p>Numeric input vector</p>
</td></tr>
<tr><td><code id="fNA_+3A_f">f</code></td>
<td>
<p>Either <code>min</code> or <code>max</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric value corresponding to <code>min</code> or <code>max</code>, or <code>NA</code>
</p>

<hr>
<h2 id='ifelse_cp'>Class-Preserving If-Else
If-Else function preserving <code>T</code> &amp; <code>F</code> classes</h2><span id='topic+ifelse_cp'></span>

<h3>Description</h3>

<p>Class-Preserving If-Else
If-Else function preserving <code>T</code> &amp; <code>F</code> classes
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ifelse_cp(test, yes, no)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ifelse_cp_+3A_test">test</code></td>
<td>
<p>an object which can be coerced to logical mode</p>
</td></tr>
<tr><td><code id="ifelse_cp_+3A_yes">yes</code></td>
<td>
<p>return values for true elements of <code>test</code>.</p>
</td></tr>
<tr><td><code id="ifelse_cp_+3A_no">no</code></td>
<td>
<p>return values for false elements of <code>test</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of the same length and attributes as <code>test</code>.
</p>

<hr>
<h2 id='input_param_checker'>Check Input Parameters</h2><span id='topic+input_param_checker'></span>

<h3>Description</h3>

<p>Verifies correct class and, optionally, verifies existence in a data frame
</p>


<h3>Usage</h3>

<pre><code class='language-R'>input_param_checker(
  x,
  check_class = NULL,
  check_names = NULL,
  null_ok = T,
  exclusions = NULL,
  max_length = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="input_param_checker_+3A_x">x</code></td>
<td>
<p>Single object name, character, or vector of characters</p>
</td></tr>
<tr><td><code id="input_param_checker_+3A_check_class">check_class</code></td>
<td>
<p>Vector of correct classes in character format</p>
</td></tr>
<tr><td><code id="input_param_checker_+3A_check_names">check_names</code></td>
<td>
<p>Default: <code>NULL</code>. Optional data frame to check if
<code>x</code> exists in the data frame.</p>
</td></tr>
<tr><td><code id="input_param_checker_+3A_null_ok">null_ok</code></td>
<td>
<p>Default: <code>T</code>. Allow <code>x</code> to be <code>NULL</code>. If
<code>x</code> is <code>NULL</code>, bypass checking.</p>
</td></tr>
<tr><td><code id="input_param_checker_+3A_exclusions">exclusions</code></td>
<td>
<p>Default: <code>NULL</code>. Optional values that are excluded
from checking in <code>check_names</code> (if it is not <code>NULL</code>).</p>
</td></tr>
<tr><td><code id="input_param_checker_+3A_max_length">max_length</code></td>
<td>
<p>Default: <code>NULL</code>. Optional maximum length of <code>x</code>.
If <code>NULL</code>, no max length check will occur.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Stop error, if an error is found. Else nothing.
</p>

<hr>
<h2 id='maude'>Bone Cement MAUDE Events in 2017</h2><span id='topic+maude'></span>

<h3>Description</h3>

<p>A dataset containing 535 events reported into the FDA MAUDE database on bone
cement in 2017. Data were obtained via the openFDA API
(<a href="https://open.fda.gov">https://open.fda.gov</a>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>maude
</code></pre>


<h3>Format</h3>

<p>A data frame with 535 rows and 15 variables. Full variable
descriptions may be found on the FDA Device Reference Guide
(<a href="https://open.fda.gov">https://open.fda.gov</a>). Note that <code>region</code>
is a simulated variable not present in MAUDE. Descriptions as follows:
</p>

<dl>
<dt>report_number</dt><dd><p>Identifying number for the adverse event report.</p>
</dd>
<dt>event_type</dt><dd><p>Outcomes associated with the adverse event.</p>
</dd>
<dt>date_received</dt><dd><p>Date the report was received by the FDA.</p>
</dd>
<dt>product_problem_flag</dt><dd><p>Indicates whether or not a report was about the
quality, performance or safety of a device.</p>
</dd>
<dt>adverse_event_flag</dt><dd><p>Whether the report is about an incident where the
use of the device is suspected to have resulted in an adverse outcome in a
patient.</p>
</dd>
<dt>report_source_code</dt><dd><p>Source of the adverse event report.</p>
</dd>
<dt>lot_number</dt><dd><p>The lot number found on the label or packaging material.</p>
</dd>
<dt>model_number</dt><dd><p>The exact model number found on the device label or
accompanying packaging.</p>
</dd>
<dt>manufacturer_d_name</dt><dd><p>Device manufacturer name.</p>
</dd>
<dt>manufacturer_d_country</dt><dd><p>Device manufacturer country.</p>
</dd>
<dt>brand_name</dt><dd><p>The trade or proprietary name of the suspect medical
device as used in product labeling or in the catalog.</p>
</dd>
<dt>device_name</dt><dd><p>This is the proprietary name, or trade name, of the
cleared device.</p>
</dd>
<dt>medical_specialty_description</dt><dd><p>Regulation Medical Specialty is
assigned based on the regulation (e.g. 21 CFR Part 888 is Orthopedic
Devices).</p>
</dd>
<dt>device_class</dt><dd><p>A risk based classification system for all medical
devices ((Federal Food, Drug, and Cosmetic Act, section 513)</p>
</dd>
<dt>region</dt><dd><p>A simulated, randomly assigned geographical region for
package example purposes.</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://open.fda.gov/data/maude/">https://open.fda.gov/data/maude/</a>
</p>

<hr>
<h2 id='mds_ts'>Example List of mds_ts Time Series Objects</h2><span id='topic+mds_ts'></span>

<h3>Description</h3>

<p>An example list of time series objects (class <code>mds_ts</code>) generated using
the <code>mds</code> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mds_ts
</code></pre>


<h3>Format</h3>

<p>A list of 3 elements each of class <code>mds_ts</code>
</p>


<h3>Source</h3>

<p>See <code>?maude</code> and <code>?sales</code> for source device-event and
exposure data. See <code>?mds::time_series</code> for how to generate <code>mds_ts</code>
time series.
</p>

<hr>
<h2 id='next_dev'>Return next level up device</h2><span id='topic+next_dev'></span>

<h3>Description</h3>

<p>Returns the variable name of the next level in the device hierarchy
</p>


<h3>Usage</h3>

<pre><code class='language-R'>next_dev(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="next_dev_+3A_x">x</code></td>
<td>
<p>String input of device name, such as <code>"device_1"</code>,
<code>"device_2"</code>, etc.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>String representation of the next device level variable
</p>

<hr>
<h2 id='next_ev'>Return next level up event</h2><span id='topic+next_ev'></span>

<h3>Description</h3>

<p>Returns the variable name of the next level in the event hierarchy
</p>


<h3>Usage</h3>

<pre><code class='language-R'>next_ev(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="next_ev_+3A_x">x</code></td>
<td>
<p>String input of event name, such as <code>"event_1"</code>,
<code>"event_2"</code>, etc.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>String representation of the next event level variable
</p>

<hr>
<h2 id='plot.mds_ts'>Plot MD-PMS Time Series</h2><span id='topic+plot.mds_ts'></span>

<h3>Description</h3>

<p>Quickly visualizes an MD-PMS times series of class <code>mds_ts</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mds_ts'
plot(x, mode = "nA", xlab = "Time", ylab = "Count", main = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.mds_ts_+3A_x">x</code></td>
<td>
<p>An object of class <code>mds_ts</code>.</p>
</td></tr>
<tr><td><code id="plot.mds_ts_+3A_mode">mode</code></td>
<td>
<p>Series to plot. Valid values are: <code>'nA'</code>, <code>'nB'</code>,
<code>'nC'</code>, <code>'nD'</code>, <code>'exposure'</code>, <code>'rate'</code>. <code>'rate'</code> is
simply <code>'nA' / 'exposure'</code>. See details for more.
</p>
<p>Default: <code>'nA'</code></p>
</td></tr>
<tr><td><code id="plot.mds_ts_+3A_xlab">xlab</code></td>
<td>
<p>x-axis label
</p>
<p>#' Default: <code>'Time'</code></p>
</td></tr>
<tr><td><code id="plot.mds_ts_+3A_ylab">ylab</code></td>
<td>
<p>y-axis label
</p>
<p>Default: <code>'Count'</code></p>
</td></tr>
<tr><td><code id="plot.mds_ts_+3A_main">main</code></td>
<td>
<p>Plot title
</p>
<p>Default: <code>NULL</code> infers the title from <code>x</code> and <code>mode</code>.</p>
</td></tr>
<tr><td><code id="plot.mds_ts_+3A_...">...</code></td>
<td>
<p>Further arguments to pass onto <code>plot()</code> generic.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>mode</code> values defined as follows. Note: The following
definitions use a device-event pair as a working example, however it may also
be a covariate-device pair.
</p>

<dl>
<dt>'nA'</dt><dd><p>Counts of the device-event pair.</p>
</dd>
<dt>'nB'</dt><dd><p>Counts of the device for all other events.</p>
</dd>
<dt>'nC'</dt><dd><p>Counts of all other devices for the event.</p>
</dd>
<dt>'nD'</dt><dd><p>Counts of all other devices for all other events.</p>
</dd>
<dt>'exposure'</dt><dd><p>Counts of exposure for the device-event pair.</p>
</dd>
<dt>'rate'</dt><dd><p>A crude rate, calculated as the device-event counts pair
divided by the exposure counts.</p>
</dd>
</dl>


<hr>
<h2 id='sales'>Simulated Device Sales Data</h2><span id='topic+sales'></span>

<h3>Description</h3>

<p>A dataset containing simulated monthly sales by device and country for
devices reported in the <code>maude</code> dataset. For package usage examples,
this data serves as a proxy for exposures. Data were generated using a
random normal distribution weighted by the number of reported events by
device and country.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sales
</code></pre>


<h3>Format</h3>

<p>A data frame with 360 rows and 4 variables:
</p>

<dl>
<dt>device_name</dt><dd><p>Name of the device mapped from the <code>maude</code> dataset.</p>
</dd>
<dt>region</dt><dd><p>Geographical region mapped from the <code>maude</code> dataset.</p>
</dd>
<dt>sales_month</dt><dd><p>The month of sales.</p>
</dd>
<dt>sales_volume</dt><dd><p>The volume of sales.</p>
</dd>
</dl>



<h3>Source</h3>

<p>Random normal distribution using <code>rnorm()</code>.
</p>

<hr>
<h2 id='summary.mds_das'>Summarize a Collection of MD-PMS Defined Analyses
Prints basic counts and date ranges by various analysis factors as defined in
the original <code>define_analyses()</code> call.</h2><span id='topic+summary.mds_das'></span>

<h3>Description</h3>

<p>Summarize a Collection of MD-PMS Defined Analyses
Prints basic counts and date ranges by various analysis factors as defined in
the original <code>define_analyses()</code> call.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mds_das'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.mds_das_+3A_object">object</code></td>
<td>
<p>A MD-PMS Defined Analyses object of class <code>mds_das</code></p>
</td></tr>
<tr><td><code id="summary.mds_das_+3A_...">...</code></td>
<td>
<p>Additional arguments affecting the summary produced</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of analyses counts and date ranges.
</p>

<hr>
<h2 id='time_series'>Generate Time Series from Defined Analysis or Analyses</h2><span id='topic+time_series'></span><span id='topic+time_series.list'></span><span id='topic+time_series.mds_das'></span><span id='topic+time_series.mds_da'></span>

<h3>Description</h3>

<p>Creates time series data frame(s) from defined analysis/analyses
(<code>define_analyses()</code>), device-event data frame
(<code>deviceevent()</code>), and optionally, exposure data frame
(<code>exposure()</code>). If analysis includes covariates or time in-vivo, creates
the relevant supporting data frame.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>time_series(analysis, ...)

## S3 method for class 'list'
time_series(analysis, ...)

## S3 method for class 'mds_das'
time_series(analysis, ...)

## S3 method for class 'mds_da'
time_series(analysis, deviceevents, exposure = NULL, use_hierarchy = T, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="time_series_+3A_analysis">analysis</code></td>
<td>
<p>A defined analysis object of class <code>mds_da</code>, list of
class <code>mds_das</code>, or a list of objects each of class <code>mds_da</code>,
usually created by <code>define_analyses()</code>.</p>
</td></tr>
<tr><td><code id="time_series_+3A_...">...</code></td>
<td>
<p>Further arguments for future work.</p>
</td></tr>
<tr><td><code id="time_series_+3A_deviceevents">deviceevents</code></td>
<td>
<p>A device-event data frame of class <code>mds_de</code>, usually
created by <code>deviceevent()</code>. This should be the same data frame used to
generate <code>analysis</code>.</p>
</td></tr>
<tr><td><code id="time_series_+3A_exposure">exposure</code></td>
<td>
<p>Optional exposure data frame of class <code>mds_e</code>, usually
created by <code>exposure()</code>. This should be the same data frame used to
generate <code>analysis</code>, if exposure data was used.
</p>
<p>Default: <code>NULL</code> will not consider exposure data.</p>
</td></tr>
<tr><td><code id="time_series_+3A_use_hierarchy">use_hierarchy</code></td>
<td>
<p>Deprecated - do not use. Logical value indicating
whether device and event hierarchies should be used in counting contingency
tables for disproportionality analysis.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A standardized MD-PMS time series data frame of class <code>mds_ts</code>.
</p>
<p>The data frame contains, by defined date levels, the following columns:
</p>

<dl>
<dt>nA</dt><dd><p>Count of the device &amp; event level of interest. If covariate
analysis is indicated, this will be at the covariate &amp; device level of
interest.</p>
</dd>
<dt>nB</dt><dd><p>Optional. Count of the device &amp; non-event, or if covariate analysis,
covariate &amp; non-device. <code>nB</code> will be missing if this is an
<code>'All'</code> level analysis.</p>
</dd>
<dt>nC</dt><dd><p>Optional. Count of the non-device &amp; event, or if covariate analysis,
non-covariate &amp; device. <code>nC</code> will be missing if this is an
<code>'All'</code> level analysis.</p>
</dd>
<dt>nD</dt><dd><p>Optional. Count of the non-device &amp; non-event, or if covariate analysis,
non-covariate &amp; non-device. <code>nD</code> will be missing if this is an
<code>'All'</code> level analysis.</p>
</dd>
<dt>ids</dt><dd><p>List of all <code>key</code>s from <code>deviceevents</code> constituting
<code>nA</code>.</p>
</dd>
<dt>exposure</dt><dd><p>Optional. Count of exposures applicable to <code>nA</code>. This counts at
the device and covariate levels but not at the event level. If a matching
device and/or covariate level is not found, then <code>exposure</code> will be
<code>NA</code>. The exception is an <code>'All'</code> level analysis, which counts
exposures across all levels.</p>
</dd>
<dt>ids_exposure</dt><dd><p>Optional. List of all exposure keys from <code>exposure</code>
applicable to <code>nA</code>.</p>
</dd>
</dl>

<p>The <code>mds_ts</code> class attributes are as follows:
</p>

<dl>
<dt>title</dt><dd><p>Short description of the analysis.</p>
</dd>
<dt>analysis</dt><dd><p>The analysis definition of class <code>mds_da</code>.</p>
</dd>
<dt>exposure</dt><dd><p>Boolean of whether exposure counts are present.</p>
</dd>
<dt>dpa</dt><dd><p>Boolean of whether 2x2 contingency table counts are present
(presumably for disproportionality analysis or 'DPA').</p>
</dd>
<dt>dpa_detail</dt><dd><p>Optional. If <code>dpa</code> is <code>TRUE</code>, <code>list</code>
object containing labels for the DPA contingency table.</p>
</dd>
<dt>covar_data</dt><dd><p>Optional. If analysis definition includes covariate level
or time in-vivo, <code>data.frame</code> object containing the relevant data.</p>
</dd>
</dl>



<h3>Methods (by class)</h3>


<ul>
<li> <p><code>list</code>: Generate time series from a list
</p>
</li>
<li> <p><code>mds_das</code>: Generate time series from a list of defined analyses
</p>
</li>
<li> <p><code>mds_da</code>: Generate time series using defined analysis
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'>de &lt;- deviceevent(maude, "date_received", "device_name", "event_type")
ex &lt;- exposure(sales, "sales_month", "device_name", count="sales_volume")
da &lt;- define_analyses(de, "device_name", exposure=ex)
# Time series on one analysis
time_series(da, de, ex)
# Time series on multiple analyses
time_series(da[1:3], de, ex)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
