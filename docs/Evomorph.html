<!DOCTYPE html><html lang="en"><head><title>Help for package Evomorph</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {Evomorph}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#aegla_consensus'>
<p>Landmark coordinates data from consensus configuration of freshwater crabs</p></a></li>
<li><a href='#aegla_landmarks'>
<p>Landmark coordinates data from freshwater crabs</p></a></li>
<li><a href='#DistancesPlot'>
<p>Plot the Procrustes distances between a set of shapes and a reference</p></a></li>
<li><a href='#GpaResiduals'><p>Generalized Procrustes residuals calculation</p></a></li>
<li><a href='#PlotVariations'>
<p>Plot shapes</p></a></li>
<li><a href='#ReadLandmarkData'><p>Extract landmark data</p></a></li>
<li><a href='#ShapeDist'>
<p>Calculate Procrustes distance between shapes</p></a></li>
<li><a href='#SimEvo'><p>Simulation of Shape Variation</p></a></li>
<li><a href='#simulated_shape_distances'><p>Procrustes distances data</p></a></li>
<li><a href='#simulated_shapes'>
<p>Simulated shapes</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Date:</td>
<td>2016-02-24</td>
</tr>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Evolutionary Morphometric Simulation</td>
</tr>
<tr>
<td>Version:</td>
<td>0.9</td>
</tr>
<tr>
<td>Author:</td>
<td>Juan Manuel Cabrera, Federico Giri</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Juan Manuel Cabrera &lt;juanmanuelcabrera1@gmail.com&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.2.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2, reshape2, geomorph, stringr</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Description:</td>
<td>Evolutionary process simulation using geometric morphometric data. Manipulation of landmark data files (TPS), shape plotting and distances plotting functions.</td>
</tr>
<tr>
<td>LazyData:</td>
<td>yes</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2016-02-25 19:05:40 UTC; Juanma</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2016-02-25 21:12:57</td>
</tr>
</table>
<hr>
<h2 id='aegla_consensus'>
Landmark coordinates data from consensus configuration of freshwater crabs
</h2><span id='topic+aegla_consensus'></span>

<h3>Description</h3>

<p><em>Aegla uruguayana</em> consensus shape coordinates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("aegla_consensus")</code></pre>


<h3>References</h3>

<p>Diawol, V. P., Giri, F., &amp; Collins, P. A. (2015). Shape and size variations of <em>Aegla uruguayana</em> (Anomura-Aeglidae) under laboratory conditions. A geometric morphometric approach to the growth. Iheringia Série Zoologia, 105(1), 76-83.</p>

<hr>
<h2 id='aegla_landmarks'>
Landmark coordinates data from freshwater crabs
</h2><span id='topic+aegla_landmarks'></span>

<h3>Description</h3>

<p>Geometric morphometric data of <em>Aegla uruguayana</em> cephalothorax (21 landmarks).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("aegla_landmarks")</code></pre>


<h3>References</h3>

<p>Diawol, V. P., Giri, F., &amp; Collins, P. A. (2015). Shape and size variations of <em>Aegla uruguayana</em> (Anomura-Aeglidae) under laboratory conditions. A geometric morphometric approach to the growth. Iheringia Série Zoologia, 105(1), 76-83.</p>

<hr>
<h2 id='DistancesPlot'>
Plot the Procrustes distances between a set of shapes and a reference
</h2><span id='topic+DistancesPlot'></span>

<h3>Description</h3>

<p><code>DistancesPlot</code> creates a distances plot using <span class="pkg">ggplot2</span> (Wickman 2009).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DistancesPlot(dist)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="DistancesPlot_+3A_dist">dist</code></td>
<td>
<p>Distances matrix</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Use <code>ggplot2</code> to create a plot where each point represent distance between a particular shape and a reference shape.
</p>


<h3>Value</h3>

<p>Return an <span class="pkg">ggplot2</span> object
</p>


<h3>Author(s)</h3>

<p>Juan Manuel Cabrera</p>


<h3>References</h3>

<p>H. Wickham. ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York, 2009.</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("simulated_shape_distances")

#Plot distances between a set of simulated shapes a reference.

DistancesPlot(simulated_shape_distances)
</code></pre>

<hr>
<h2 id='GpaResiduals'>Generalized Procrustes residuals calculation</h2><span id='topic+GpaResiduals'></span>

<h3>Description</h3>

<p>Calculates Procrustes residuals of landmark configurations</p>


<h3>Usage</h3>

<pre><code class='language-R'>GpaResiduals(lands,gpa_coords)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="GpaResiduals_+3A_lands">lands</code></td>
<td>
<p>Landmark configuration</p>
</td></tr>
<tr><td><code id="GpaResiduals_+3A_gpa_coords">gpa_coords</code></td>
<td>
<p>GPA coordinates matrix</p>
</td></tr></table>


<h3>Details</h3>

<p>Partial least squares analysis is a common tool to examine complex patterns of covariations between multiple sets of variables (Rohlf and Corti 2000; Bookstein et al. 2003). When one set of these variables consists of shape coordinates it is called singular warps analysis. Singular warp analysis is based on a singular decomposition of the cross-covariance matrix of two sets of variables measured from the same sample objects. Bookstein et al. (2013) gave this equation (1):
</p>
<p style="text-align: center;"><code class="reqn"> \sum = \left ( 1/N \right )X^{t}Y\ </code>
</p>

<p>Where N is the sample size and X and Y are matrices for two sets of variables with N rows, corresponding to the same sample specimens, and columns according to the number of variables of each set. If each variable in both matrices is first mean-centered (by variable), then Equation (1) yields the cross-covariance matrix between variables in X and those in Y.
</p>
<p>Most of the landmark-based morphometric studies use aligned shape coordinates (GPA) as variable for analyzing complex patterns of covariations between sets of landmarks coordinates data. However, whereas GPA mean-centers all specimen configurations – it superimposes the centroids of each specimen - GPA does not mean center each coordinate within the specimens, and therefore does not in itself provide suitable variables for use in Equation (1). 
</p>
<p>To avoid this problem <code>GpaResiduals</code> mean center the aligned coordinates to get Procrustes residuals which are more appropriate for calculating covariance (McNulty 2009).
</p>
<p>If generalized procrustes coordinates are not provided, the function will calculate them using <span class="pkg">geomorph</span> package (Adams &amp; Otárola Castillo 2013)</p>


<h3>Value</h3>

<p>It returns a list containing:
</p>
<table role = "presentation">
<tr><td><code>consens</code></td>
<td>
<p>Consensus shape</p>
</td></tr>
<tr><td><code>cvectorized</code></td>
<td>
<p>Consensus shape (1 dim vector)</p>
</td></tr>
<tr><td><code>resid</code></td>
<td>
<p>GPA residuals matrix</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Cabrera Juan Manuel</p>


<h3>References</h3>

<p>Adams, D. C., &amp; Otárola-Castillo, E. (2013). geomorph: an R package for the collection and analysis of geometric morphometric shape data. Methods in Ecology and Evolution, 4(4), 393-399.
</p>
<p>Bookstein, F. L., Gunz, P., Mitterœcker, P., Prossinger, H., Schæfer, K., &amp; Seidler, H. (2003). Cranial integration in Homo: singular warps analysis of the midsagittal plane in ontogeny and evolution. Journal of Human Evolution, 44(2), 167-187.
</p>
<p>McNulty, K. P. (2009). Computing singular warps from Procrustes aligned coordinates. Journal of human evolution, 57(2), 191-194.
</p>
<p>Rohlf, F. J., &amp; Corti, M. (2000). Use of two-block partial least-squares to study covariation in shape. Systematic Biology, 49(4), 740-753.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("aegla_landmarks")
result&lt;-GpaResiduals(lands = aegla_landmarks)

#GPA consensus (matrix)
result$consens

#GPA consensus (vector)
result$cvectorized

#GPA residual matrix
result$resid
</code></pre>

<hr>
<h2 id='PlotVariations'>
Plot shapes
</h2><span id='topic+PlotVariations'></span>

<h3>Description</h3>

<p>Plot the differences between a set of morphometric shapes and a reference 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PlotVariations(shapes, reference, path, save = F, w = 6, h = 6, d = 100, c_ref = "red", 
 c_target = "black", s_ref = 3, s_target = 2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PlotVariations_+3A_shapes">shapes</code></td>
<td>
<p>Landmark data of shapes (list of matrices)</p>
</td></tr>
<tr><td><code id="PlotVariations_+3A_reference">reference</code></td>
<td>
<p>Landmark data of reference shape (matrix type)</p>
</td></tr>
<tr><td><code id="PlotVariations_+3A_path">path</code></td>
<td>
<p>Path where results will be saved (Default: working directory)</p>
</td></tr>
<tr><td><code id="PlotVariations_+3A_c_ref">c_ref</code></td>
<td>
<p>Color of the points representing the reference shape (Default <code>c_ref="red"</code>)</p>
</td></tr>
<tr><td><code id="PlotVariations_+3A_c_target">c_target</code></td>
<td>
<p>Color of the points representing the target shape (Default <code>c_target="black"</code>)</p>
</td></tr>
<tr><td><code id="PlotVariations_+3A_s_ref">s_ref</code></td>
<td>
<p>Size of the points representing the reference shape (Default <code>s_ref=3</code>)</p>
</td></tr>
<tr><td><code id="PlotVariations_+3A_s_target">s_target</code></td>
<td>
<p>Size of the points representing the target shape (Default <code>s_target=2</code>)</p>
</td></tr>
<tr><td><code id="PlotVariations_+3A_save">save</code></td>
<td>
<p>A logical value. If TRUE, the function will save the plot as jpeg images in the indicated in <code>path</code></p>
</td></tr>
</table>
<p>This parameters are used to modify stored graph (<code>save = TRUE</code>):
</p>
<table role = "presentation">
<tr><td><code id="PlotVariations_+3A_w">w</code></td>
<td>
<p>Units of width of the graph in inches (Default <code>w = 6</code>)</p>
</td></tr>
<tr><td><code id="PlotVariations_+3A_h">h</code></td>
<td>
<p>Units of height of the graph in inches(Default <code>h = 6</code>)</p>
</td></tr>
<tr><td><code id="PlotVariations_+3A_d">d</code></td>
<td>
<p>Number of dpi (resolution) of the graph. (Default <code>d = 6</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function uses package <span class="pkg">ggplot2</span> (Wickman 2009) to create multiple plots representing the variations between a list of target shapes and a reference (consensus shape or another specimen data). If <code>save=TRUE</code> it creates a folder (named <em>day_hh_mm</em>) and stores the plots as images (.jpeg) at the provided path (if not provided it will store them in the working directory).
There are several parameters for modify the graph for a suitable representation. This function could be used for example to analyze morphological variations of species over generations.</p>


<h3>Author(s)</h3>

<p>Cabrera Juan Manuel</p>


<h3>References</h3>

<p>H. Wickham. ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York, 2009.</p>


<h3>See Also</h3>

 <p><code><a href="#topic+SimEvo">SimEvo</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'> 
data("aegla_consensus")
data("simulated_shapes")

#Sample one individual from simulated_shapes dataset

simu&lt;-simulated_shapes[100]

#Create a shape variation graphic

graph&lt;-PlotVariations(simu,aegla_consensus)

#Red dots represent the landmark coordinates of the reference shape and black
# dots represent the target shape. The length of the segments represent 
# distances between pairs of homologous landmarks
  
graph[[1]]
</code></pre>

<hr>
<h2 id='ReadLandmarkData'>Extract landmark data</h2><span id='topic+ReadLandmarkData'></span>

<h3>Description</h3>

<p>Read landmark coordinates and scales from a TPS file</p>


<h3>Usage</h3>

<pre><code class='language-R'>ReadLandmarkData(datafile, m_byscale = T)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ReadLandmarkData_+3A_datafile">datafile</code></td>
<td>
<p>TPS file containing two dimensional landmark data</p>
</td></tr>
<tr><td><code id="ReadLandmarkData_+3A_m_byscale">m_byscale</code></td>
<td>
<p>Logical value (Default m_byscale=TRUE). If TRUE, landmark coordinates are multiply by scale</p>
</td></tr>
</table>


<h3>Details</h3>

 
<p>The function returns landmark coordinates (array and data.frame format) and the scale of each specimen. If <code>m_byscale</code> = T the coordinates are multiple by the corresponding scale.
<code>ReadLandmarkData</code> only works with TPS files that has only landmark coordinates (presence of CURVES and OUTLINES may cause malfunction).</p>


<h3>Value</h3>

<p>It returns a 3 element list:
</p>
<table role = "presentation">
<tr><td><code>df</code></td>
<td>
<p>Landmark coordinates as a data.frame. Sp factor correspond to species number.</p>
</td></tr>
<tr><td><code>array</code></td>
<td>
<p>Landmark coordinates as a three dimensional array.</p>
</td></tr>
<tr><td><code>scale</code></td>
<td>
<p>Vector of scales value for each specimen.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Cabrera Juan Manuel</p>

<hr>
<h2 id='ShapeDist'>
Calculate Procrustes distance between shapes
</h2><span id='topic+ShapeDist'></span>

<h3>Description</h3>

<p>Use the Procrustes method to calculate distances between a set of shapes 
and a reference.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ShapeDist(shapes, reference)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ShapeDist_+3A_shapes">shapes</code></td>
<td>
<p>Landmark data of shapes (list of matrices)</p>
</td></tr>
<tr><td><code id="ShapeDist_+3A_reference">reference</code></td>
<td>
<p>Lanmark data of reference shape (matrix type)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Procrustes distance provides a measure of coincidence of two point sets xi and yi, i=1..N. For this purpose the variance of point deviations is calculated at the optimal superposition of the sets. It allows to characterize the shape proximity of a given simplex to shape of a reference one.
</p>


<h3>Value</h3>

<p>A matrix containing procrustes distance between shapes. Procrustes distance is the square root of the sum of squared differences in the posititions of the landmarks in two shapes (Dryden and Mardia 1998).
This can be used to describe the difference between many landmark configurations (Rohlf and Slive 1990). 
</p>


<h3>Author(s)</h3>

<p>Cabrera Juan Manuel</p>


<h3>References</h3>

<p>Dryden, I. L., &amp; Mardia, K. V. (1998). Statistical shape analysis (Vol. 4). Chichester: Wiley.
</p>
<p>Rohlf, F. J., &amp; Slice, D. (1990). Extensions of the Procrustes method for the optimal superimposition of landmarks. Systematic Biology, 39(1), 40-59.</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("aegla_landmarks")
data("aegla_consensus")

#Calculate distances between set of shapes and a reference
ShapeDist(shapes = aegla_landmarks, reference = aegla_consensus)</code></pre>

<hr>
<h2 id='SimEvo'>Simulation of Shape Variation</h2><span id='topic+SimEvo'></span>

<h3>Description</h3>

<p><code>SimEvo</code> performs a simulation of shape variation using a modification of Lande's evolutionary model Polly 2004</p>


<h3>Usage</h3>

<pre><code class='language-R'>SimEvo(vari, consensusvec, resids, ngen, fsamp)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="SimEvo_+3A_vari">vari</code></td>
<td>
<p>Variation coefficient</p>
</td></tr>
<tr><td><code id="SimEvo_+3A_consensusvec">consensusvec</code></td>
<td>
<p>Consensus shape (vectorized form)</p>
</td></tr>
<tr><td><code id="SimEvo_+3A_resids">resids</code></td>
<td>
<p>GPA residuals matrix</p>
</td></tr>
<tr><td><code id="SimEvo_+3A_ngen">ngen</code></td>
<td>
<p>Number of generations of simulations (Default: 1000000 steps).</p>
</td></tr>
<tr><td><code id="SimEvo_+3A_fsamp">fsamp</code></td>
<td>
<p>Frequency of samples (Default: 1000000 steps).</p>
</td></tr>
</table>


<h3>Details</h3>

 
<p>Lande's evolutionary model defines mean morphological variation over generations <code class="reqn"> \Delta Z </code> as:
</p>
<p style="text-align: center;"><code class="reqn"> \Delta Z = \beta G </code>
</p>

<p>where <code class="reqn"> G </code> is the additive genetic covariance matrix, and <code class="reqn"> \beta </code> are selection coefficients applied to the morphological structure.
Polly 2004 proposes a modification of this equation in order to use it with morphological data instead of genetic data:
</p>
<p style="text-align: center;"><code class="reqn"> \Delta Z = \beta P H </code>
</p>

<p>where <code class="reqn"> P </code> is the phenotypic covariance matrix, and <code class="reqn"> H </code> is an heritability matrix (See Polly 2004 for more information).
<code> resids </code> will be used as the phenotypic covariance matrix, and <code> vari </code> will be used to simulate <code class="reqn"> \beta H </code> term. After <code> ngen </code> simulations steps the new shape will be
reconstructed from the starting shape <code> consensusvec </code>.
The number of plots representing the new shapes can be modify using <code> fsamp </code>.
</p>


<h3>Value</h3>

<p>It returns a list of ngen/fsamp shapes (landmarks coordinates)
</p>


<h3>Author(s)</h3>

<p>Cabrera Juan Manuel</p>


<h3>References</h3>

<p>Polly, P. D. (2004). On the simulation of the evolution of morphological shape: multivariate shape under selection and drift. Palaeontologia Electronica, 7(2), 1-28.</p>


<h3>Examples</h3>

<pre><code class='language-R'> 
data("aegla_landmarks")

#Use GpaResiduals function to obtain GPA residual matrix and consensus
# coordinates from landmark configuration

a_data=GpaResiduals(aegla_landmarks)

#Simulate morphological evolution with a variation rate "vari"
# trough "ngen" generations and retrieve the last generation shape coordinates

simshape = SimEvo(vari = 2, consensusvec = a_data$cvectorized, 
resids = a_data$resid, ngen = 10000, fsamp = 10000)

#Plot consensus shape and the simulated shape

par(mfrow=c(1, 2))
plot(a_data$consens,type = "p",main = "Reference", xlab = "", ylab = "")
plot(simshape[[1]],type = "p",col = "red",main = "Target", xlab = "", ylab = "")

#Or you can use PlotVariations to see the difference more clearly

PlotVariations(simshape,a_data$consens)

</code></pre>

<hr>
<h2 id='simulated_shape_distances'>Procrustes distances data</h2><span id='topic+simulated_shape_distances'></span>

<h3>Description</h3>

<p>Procrustes distance between a set of simulated shapes and their ancestry over generations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("simulated_shape_distances")</code></pre>

<hr>
<h2 id='simulated_shapes'>
Simulated shapes
</h2><span id='topic+simulated_shapes'></span>

<h3>Description</h3>

<p>Simulated landmark data using evomorph <code>SimEvo</code> function on <em>Aegla uruguayana</em> data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("simulated_shapes")</code></pre>


<h3>References</h3>

<p>Diawol, V. P., Giri, F., &amp; Collins, P. A. (2015). Shape and size variations of <em>Aegla uruguayana</em> (Anomura-Aeglidae) under laboratory conditions. A geometric morphometric approach to the growth. Iheringia Série Zoologia, 105(1), 76-83.</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
