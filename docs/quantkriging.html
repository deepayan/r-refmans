<!DOCTYPE html><html lang="en"><head><title>Help for package quantkriging</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {quantkriging}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#quantkriging'><p>quantkriging</p></a></li>
<li><a href='#LOOquants'><p>Revaluate Quantiles</p></a></li>
<li><a href='#new_QKResults'><p>QKResult Constructor</p></a></li>
<li><a href='#newQuants'><p>Revaluate Quantiles</p></a></li>
<li><a href='#predict.QKResults'><p>Revaluate Quantiles</p></a></li>
<li><a href='#quantKrig'><p>Quantile Kriging</p></a></li>
<li><a href='#QuantPlot'><p>Plot Univariate Quantile Data</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Quantile Kriging for Stochastic Simulations with Replication</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Author:</td>
<td>Kevin R. Quinlan [aut, cre],
  Jim R. Leek [aut],
  Lawrence Livermore National Security [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Kevin R. Quinlan &lt;quinlan5@llnl.gov&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>A re-implementation of quantile kriging. Quantile kriging was described by Plumlee and Tuo (2014) &lt;<a href="https://doi.org/10.1080%2F00401706.2013.860919">doi:10.1080/00401706.2013.860919</a>&gt;.  With computational savings when dealing with replication from the recent paper by Binois, Gramacy, and Ludovski (2018) &lt;<a href="https://doi.org/10.1080%2F10618600.2018.1458625">doi:10.1080/10618600.2018.1458625</a>&gt; it is now possible to apply quantile kriging to a wider class of problems.  In addition to fitting the model, other useful tools are provided such as the ability to automatically perform leave-one-out cross validation.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>hetGP (&ge; 1.1.1), Matrix (&ge; 1.2.17), ggplot2 (&ge; 3.2.1),
reshape2 (&ge; 1.4.3), stats</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.1.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 2.1.0)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-02-28 17:50:06 UTC; leek2</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-03-06 13:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='quantkriging'>quantkriging</h2><span id='topic+quantkriging'></span><span id='topic+quantkriging-package'></span>

<h3>Description</h3>

<p>Quantile Kriging is a method to model the uncertainty of a stochastic simulation by modelling both the overall simulation response and the output distribution at each sample point.  The output distribution is characterized by dividing it into quantiles, where the division of each quantile is determined by kriging.
</p>


<h3>Details</h3>

<p>This library is our re-implementation of Quantile Kriging as described by Matthew Plumlee &amp; Rui Tuo in their 2014 paper &quot;Building Accurate Emulators for Stochastic Simulations via Quantile Kriging.&quot;  With computational savings when dealing with replication from the recent paper &quot;Practical heteroskedastic Gaussian process modeling for large simulation experiments &quot; by Binois, M., Gramacy, R., and Ludovski, M. it is now possible to apply Quantile Kriging to a wider class of problems.  In addition to fitting the model, other useful tools are provided such as the ability to automatically perform leave-one-out cross validation.
</p>


<h3>quantkriging functions</h3>


<ul>
<li><p> quantKrig : Implements Quantile Kriging
</p>
</li>
<li><p> quantPlot : Plots the Quantile output from quantKrig if there is only one input.
</p>
</li>
<li><p> newQuants : Generates new quantiles from a quantile object
</p>
</li>
<li><p> LOOquants : Generates Leave-One-Out predictions for each location and quantile.
</p>
</li></ul>


<hr>
<h2 id='LOOquants'>Revaluate Quantiles</h2><span id='topic+LOOquants'></span>

<h3>Description</h3>

<p>Generates Leave-One-Out predictions for each location and quantile.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LOOquants(QKResults)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="LOOquants_+3A_qkresults">QKResults</code></td>
<td>
<p>Output from the quantKrig function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Returns the estimated quantiles and a plot of the leave-one-out predictions against the observed values.
</p>


<h3>Value</h3>

<p>Leave-one-out predictions at the input locations
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
X &lt;- seq(0,1,length.out = 20)
Y &lt;- cos(5*X) + cos(X)
Xstar &lt;- rep(X,each = 100)
Ystar &lt;- rep(Y,each = 100)
e &lt;- rchisq(length(Ystar),5)/5 - 1
Ystar &lt;- Ystar + e
lb &lt;- c(0.0001,0.0001)
ub &lt;- c(10,10)
Qout &lt;- quantKrig(Xstar,Ystar, seq(0.05,0.95, length.out = 7), lower = lb, upper = ub)

LOOquants(Qout)

</code></pre>

<hr>
<h2 id='new_QKResults'>QKResult Constructor</h2><span id='topic+new_QKResults'></span>

<h3>Description</h3>

<p>Create Quantile Kriging Results class from list
</p>


<h3>Usage</h3>

<pre><code class='language-R'>new_QKResults(qkList)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="new_QKResults_+3A_qklist">qkList</code></td>
<td>
<p>list(quants, yquants, g, l, ll &lt;- -optparb$value, beta0, nu, xstar, ystar, Ki, quantv, mult, ylisto, type)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>New class QKResults
</p>

<hr>
<h2 id='newQuants'>Revaluate Quantiles</h2><span id='topic+newQuants'></span>

<h3>Description</h3>

<p>Generates new quantiles from a quantile object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>newQuants(QKResults, quantv)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="newQuants_+3A_qkresults">QKResults</code></td>
<td>
<p>Output from the quantKrig function.</p>
</td></tr>
<tr><td><code id="newQuants_+3A_quantv">quantv</code></td>
<td>
<p>Vector of quantile values alpha between 0 and 1,</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The same quantile object with new estimated quantiles.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>X &lt;- seq(0,1,length.out = 20)
Y &lt;- cos(5*X) + cos(X)
Xstar &lt;- rep(X,each = 100)
Ystar &lt;- rep(Y,each = 100)
e &lt;- rchisq(length(Ystar),5)/5 - 1
Ystar &lt;- Ystar + e
lb &lt;- c(0.0001,0.0001)
ub &lt;- c(10,10)
Qout &lt;- quantKrig(Xstar,Ystar, seq(0.05,0.95, length.out = 7), lower = lb, upper = ub)

Qout2 &lt;- newQuants(Qout, c(0.025, 0.5, 0.975))
QuantPlot(Qout2)
</code></pre>

<hr>
<h2 id='predict.QKResults'>Revaluate Quantiles</h2><span id='topic+predict.QKResults'></span>

<h3>Description</h3>

<p>Quantile Predictions using Quantile Kriging model (class QKResults)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'QKResults'
predict(object, xnew, quantnew = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.QKResults_+3A_object">object</code></td>
<td>
<p>Output from the quantKrig function.</p>
</td></tr>
<tr><td><code id="predict.QKResults_+3A_xnew">xnew</code></td>
<td>
<p>Locations for prediction</p>
</td></tr>
<tr><td><code id="predict.QKResults_+3A_quantnew">quantnew</code></td>
<td>
<p>Quantiles for prediction, default is to keep the same as the quantile object</p>
</td></tr>
<tr><td><code id="predict.QKResults_+3A_...">...</code></td>
<td>
<p>Ignore. No other arguments for this method</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Quantile predictions at the specified input locations
</p>


<h3>Author(s)</h3>

<p>Kevin Quinlan quinlan5@llnl.gov
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
X &lt;- seq(0,1,length.out = 20)
Y &lt;- cos(5*X) + cos(X)
Xstar &lt;- rep(X,each = 100)
Ystar &lt;- rep(Y,each = 100)
e &lt;- rchisq(length(Ystar),5)/5 - 1
Ystar &lt;- Ystar + e
lb &lt;- c(0.0001,0.0001)
ub &lt;- c(10,10)
Qout &lt;- quantKrig(Xstar,Ystar, seq(0.05,0.95, length.out = 7), lower = lb, upper = ub)

predict(Qout, xnew = c(0.4, 0.5, 0.6))

quantpreds &lt;- predict(Qout, xnew = seq(0,1,length.out = 100), quantnew = seq(0.01,0.99,by = 0.01))
matplot(seq(0,1,length.out = 100), quantpreds, type = 'l')
</code></pre>

<hr>
<h2 id='quantKrig'>Quantile Kriging</h2><span id='topic+quantKrig'></span>

<h3>Description</h3>

<p>Implements Quantile Kriging from Plumlee and Tuo (2014).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>quantKrig(x, y, quantv, lower, upper, method = "loo",
  type = "Gaussian", rs = TRUE, nm = TRUE, known = NULL,
  optstart = NULL, control = list())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="quantKrig_+3A_x">x</code></td>
<td>
<p>Inputs</p>
</td></tr>
<tr><td><code id="quantKrig_+3A_y">y</code></td>
<td>
<p>Univariate Response</p>
</td></tr>
<tr><td><code id="quantKrig_+3A_quantv">quantv</code></td>
<td>
<p>Vector of Quantile values to estimate (ex: c(0.025, 0.975))</p>
</td></tr>
<tr><td><code id="quantKrig_+3A_lower">lower</code></td>
<td>
<p>Lower bound of hyperparameters, if isotropic set lengthscale then nugget, if anisotropic set k lengthscales and then nugget</p>
</td></tr>
<tr><td><code id="quantKrig_+3A_upper">upper</code></td>
<td>
<p>Upper bound of hyperparameters, if isotropic set lengthscale then nugget, if anisotropic set k lengthscales and then nugget</p>
</td></tr>
<tr><td><code id="quantKrig_+3A_method">method</code></td>
<td>
<p>Either maximum likelihood ('mle') or leave-one-out cross validation ('loo') optimization of hyperparameters</p>
</td></tr>
<tr><td><code id="quantKrig_+3A_type">type</code></td>
<td>
<p>Covariance type, either 'Gaussian', 'Matern3_2', or 'Matern5_2'</p>
</td></tr>
<tr><td><code id="quantKrig_+3A_rs">rs</code></td>
<td>
<p>If TRUE, rescales inputs to [0,1]</p>
</td></tr>
<tr><td><code id="quantKrig_+3A_nm">nm</code></td>
<td>
<p>If TRUE, normalizes output to mean 0, variance 1</p>
</td></tr>
<tr><td><code id="quantKrig_+3A_known">known</code></td>
<td>
<p>Fixes all hyperparamters to a known value</p>
</td></tr>
<tr><td><code id="quantKrig_+3A_optstart">optstart</code></td>
<td>
<p>Sets the starting value for the optimization</p>
</td></tr>
<tr><td><code id="quantKrig_+3A_control">control</code></td>
<td>
<p>Control from optim function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Fits quantile kriging using a double exponential or Matern covariance function. This emulator is for a stochastic simulation and models the distribution of the results (through the quantiles), not just the mean.  The hyperparameters can be trained using maximum likelihood estimation or leave-one-out cross validation as recommended in Plumlee and Tuo (2014).  The GP is trained using the Woodbury formula to improve computation speed with replication as shown in Binois et al. (2018).  To get meaningful results, there should be sufficient replication at each input. The quantiles at a location <code class="reqn">x0</code> are found using: </p>
<p style="text-align: center;"><code class="reqn">\mu(x0) + kn(x0)Kn^{-1}(y(i) - \mu(x)</code>
</p>
<p>) where <code class="reqn">Kn</code> is the kernel of the design matrix (with nugget effect), <code class="reqn">y(i)</code> the ordered sample closest to that quantile at each input, and <code class="reqn">\mu(x)</code> the mean at each input.
</p>


<h3>Value</h3>


<dl>
<dt>quants</dt><dd><p>The estimated quantile values in matrix form</p>
</dd>
<dt>yquants</dt><dd><p>The actual quantile values from the data in matrix form</p>
</dd>
<dt>g</dt><dd><p>The scaling parameter for the kernel</p>
</dd>
<dt>l</dt><dd><p>The lengthscale parameter(s)</p>
</dd>
<dt>ll</dt><dd><p>The log likelihood</p>
</dd>
<dt>beta0</dt><dd><p>Estimated linear trend</p>
</dd>
<dt>nu</dt><dd><p>Estimator of the variance</p>
</dd>
<dt>xstar</dt><dd><p>Matrix of unique input values</p>
</dd>
<dt>ystar</dt><dd><p>Average value at each unique input value</p>
</dd>
<dt>Ki </dt><dd><p>Inverted covariance matrix</p>
</dd>
<dt>quantv</dt><dd><p>Vector of alpha values between 0 and 1 for estimated quantiles, it is recommended that only a small number of quantiles are used for fitting and more quantiles can be found later using newQuants</p>
</dd>
<dt>mult</dt><dd><p>Number of replicates at each input</p>
</dd>
</dl>



<h3>References</h3>


<ul>
<li><p> Matthew Plumlee &amp; Rui Tuo (2014) Building Accurate Emulators for Stochastic Simulations via Quantile Kriging, Technometrics, 56:4, 466-473, DOI: 10.1080/00401706.2013.860919
</p>
</li>
<li><p> Mickael Binois, Robert B. Gramacy &amp; Mike Ludkovski (2018) Practical Heteroscedastic Gaussian Process Modeling for Large Simulation Experiments, Journal of Computational and Graphical Statistics, 27:4, 808-821, DOI: 10.1080/10618600.2018.1458625
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Simple example
X &lt;- seq(0,1,length.out = 20)
Y &lt;- cos(5*X) + cos(X)
Xstar &lt;- rep(X,each = 100)
Ystar &lt;- rep(Y,each = 100)
Ystar &lt;- rnorm(length(Ystar),Ystar,1)
lb &lt;- c(0.0001,0.0001)
ub &lt;- c(10,10)
Qout &lt;- quantKrig(Xstar,Ystar, quantv = seq(0.05,0.95, length.out = 7), lower = lb, upper = ub)
QuantPlot(Qout, Xstar, Ystar)

#fit for non-normal errors

Ystar &lt;- rep(Y,each = 100)
e &lt;- rchisq(length(Ystar),5)/5 - 1
Ystar &lt;- Ystar + e
Qout &lt;- quantKrig(Xstar,Ystar, quantv = seq(0.05,0.95, length.out = 7), lower = lb, upper = ub)
QuantPlot(Qout, Xstar, Ystar)
</code></pre>

<hr>
<h2 id='QuantPlot'>Plot Univariate Quantile Data</h2><span id='topic+QuantPlot'></span>

<h3>Description</h3>

<p>Plots the Quantile output from quantKrig if there is only one input.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>QuantPlot(QKResults, X1 = NULL, Y1 = NULL, main = NULL,
  xlab = NULL, ylab = NULL, colors = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="QuantPlot_+3A_qkresults">QKResults</code></td>
<td>
<p>Output from the quantKrig function.</p>
</td></tr>
<tr><td><code id="QuantPlot_+3A_x1">X1</code></td>
<td>
<p>X values if ploting the original data in the background</p>
</td></tr>
<tr><td><code id="QuantPlot_+3A_y1">Y1</code></td>
<td>
<p>Y values if ploting the original data in the background</p>
</td></tr>
<tr><td><code id="QuantPlot_+3A_main">main</code></td>
<td>
<p>Plot Title defaults to Fitted Quantiles</p>
</td></tr>
<tr><td><code id="QuantPlot_+3A_xlab">xlab</code></td>
<td>
<p>Label for x-axis defaults to X</p>
</td></tr>
<tr><td><code id="QuantPlot_+3A_ylab">ylab</code></td>
<td>
<p>Label for y-axis defaults to Y</p>
</td></tr>
<tr><td><code id="QuantPlot_+3A_colors">colors</code></td>
<td>
<p>Customize colors associated with the quantiles</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>X &lt;- seq(0,1,length.out = 20)
Y &lt;- cos(5*X) + cos(X)
Xstar &lt;- rep(X,each = 100)
Ystar &lt;- rep(Y,each = 100)
Ystar &lt;- rnorm(length(Ystar),Ystar,1)
Ystar &lt;- (Ystar - mean(Ystar)) / sd(Ystar)
Xstar &lt;- (Xstar - min(Xstar)/ max(Xstar) - min(Xstar))
lb &lt;- c(0.0001,0.0001)
ub &lt;- c(10,10)
Qout &lt;- quantKrig(Xstar,Ystar, seq(0.05,0.95, length.out = 7), lower = lb, upper = ub)
QuantPlot(Qout, Xstar, Ystar)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
