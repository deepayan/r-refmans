<!DOCTYPE html><html><head><title>Help for package deforestable</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {deforestable}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#Class_ForestTrain'><p>S3 class ForestTrain</p></a></li>
<li><a href='#classify'><p>Classify parts of images as forest / non-forest</p></a></li>
<li><a href='#createDataPartition'><p>Data Partitioning</p></a></li>
<li><a href='#Koutparams'><p>Koutrouvelis parameter estimation of image data</p></a></li>
<li><a href='#read_data'><p>Import a jpeg image</p></a></li>
<li><a href='#train'><p>Train models for forest detection</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Classify RGB Images into Forest or Non-Forest</td>
</tr>
<tr>
<td>Version:</td>
<td>3.1.1</td>
</tr>
<tr>
<td>Author:</td>
<td>Jesper Muren <a href="https://orcid.org/0000-0002-9208-5325"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Dmitry Otryakhin <a href="https://orcid.org/0000-0002-4700-7221"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Dmitry Otryakhin &lt;d.otryakhin.acad@protonmail.ch&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Implements two out-of box classifiers presented in &lt;<a href="https://doi.org/10.48550%2FarXiv.2112.01063">doi:10.48550/arXiv.2112.01063</a>&gt; for 
    distinguishing forest and non-forest terrain images. Under these algorithms, there are 
    frequentist approaches: one parametric, using stable distributions, and another one- 
    non-parametric, using the squared Mahalanobis distance. The package also contains functions for 
    data handling and building of new classifiers as well as some test data set.  </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>terra, jpeg, plyr, StableEstim, Rcpp (&ge; 1.0.9)</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>C++11, GDAL (&gt;= 2.2.3), GEOS (&gt;= 3.4.0), PROJ (&gt;=
4.9.3), sqlite3</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-10-13 12:43:52 UTC; d</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-10-15 23:22:33 UTC</td>
</tr>
</table>
<hr>
<h2 id='Class_ForestTrain'>S3 class ForestTrain</h2><span id='topic+Class_ForestTrain'></span>

<h3>Description</h3>

<p>Class ForestTrain is the main class to contain models for binary classification forest/non-forest.
It includes the following elements:
</p>


<h3>Details</h3>

<p>In most cases objects of this class are generated by function <code><a href="#topic+train">train</a></code>.
Then, classification of terrain images is made by <code><a href="#topic+classify">classify</a></code>.
</p>


<h3>Slots</h3>


<table>
<tr>
 <td style="text-align: left;">
   Element </td><td style="text-align: left;"> Description </td>
</tr>
<tr>
 <td style="text-align: left;">
   call </td><td style="text-align: left;"> the function call with which it was created </td>
</tr>
<tr>
 <td style="text-align: left;">
   tp </td><td style="text-align: left;"> the number of true positives obtained during training </td>
</tr>
<tr>
 <td style="text-align: left;">
   fp </td><td style="text-align: left;"> the number of false positives obtained during training </td>
</tr>
<tr>
 <td style="text-align: left;">
   tn </td><td style="text-align: left;"> the number of true negatives obtained during training </td>
</tr>
<tr>
 <td style="text-align: left;">
   fn </td><td style="text-align: left;"> the number of false negatives obtained during training </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>


<hr>
<h2 id='classify'>Classify parts of images as forest / non-forest</h2><span id='topic+classify'></span><span id='topic+classify.ForestTrainParam'></span><span id='topic+classify.ForestTrainNonParam'></span>

<h3>Description</h3>

<p>Generic function classify dispatches methods according to the class of object Model.
A chosen method takes raster object data and classifies parts of it as 1- forest or 0- non-forest.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>classify(Model, ...)

## S3 method for class 'ForestTrainParam'
classify(Model, data, n_pts, parallel = FALSE, progress = "text", ...)

## S3 method for class 'ForestTrainNonParam'
classify(Model, data, n_pts, parallel = FALSE, progress = "text", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="classify_+3A_model">Model</code></td>
<td>
<p>trained model, e.g. by <code><a href="#topic+train">train</a></code></p>
</td></tr>
<tr><td><code id="classify_+3A_...">...</code></td>
<td>
<p>additional parameters passed to methods</p>
</td></tr>
<tr><td><code id="classify_+3A_data">data</code></td>
<td>
<p>raster object. <code><a href="#topic+read_data_raster">read_data_raster</a></code></p>
</td></tr>
<tr><td><code id="classify_+3A_n_pts">n_pts</code></td>
<td>
<p>size of sub-frames into which data is split</p>
</td></tr>
<tr><td><code id="classify_+3A_parallel">parallel</code></td>
<td>
<p>Boolean. Whether to use parallel setup</p>
</td></tr>
<tr><td><code id="classify_+3A_progress">progress</code></td>
<td>
<p>progress bar. Works only when parallel=FALSE. Could be set to 'text' or 'none'</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Both classify.ForestTrainParam and classify.ForestTrainNonParam use parameter n_pts to split images
into square sub-frames of the size n_pts. Those sub-frames are classified independently and all pixels
from a sub-frame are tagged according to its classification result. When the image contained by data
is of dimensions that are not divisible by n_pts, it is truncated from the right and the bottom to
to make the largest divisible one. Thus, the result of classification can be of a different size than
the original image.
</p>


<h3>Value</h3>

<p>a black-and-white image of the terrain data where white represents forest and black is for non-forest.
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>classify(ForestTrainParam)</code>: Method for the class ForestTrainParam
</p>
</li>
<li> <p><code>classify(ForestTrainNonParam)</code>: Method for the class ForestTrainNonParam
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'>library(deforestable)
n_pts &lt;- 20

# Choosing folders with training data
Forestdir &lt;- system.file('extdata/Forest/', package = "deforestable")
Nonforestdir &lt;- system.file('extdata/Non-forest/', package = "deforestable")

#### Read the target image ####
tg_dir &lt;- system.file('extdata/', package = "deforestable")
test_image &lt;- read_data_raster('smpl_1.jpeg', dir = tg_dir)


# Simple training of the non-parametric model
Model_nonP_tr &lt;- train(model='fr_Non-Param', Forestdir=Forestdir, Nonforestdir=Nonforestdir,
                       train_method='train', parallel=FALSE)

res &lt;- classify(data=test_image, Model=Model_nonP_tr,
                n_pts=n_pts, parallel=FALSE, progress = 'text')

tmp_d &lt;- tempdir(); tmp_d
jpeg::writeJPEG(image=res, target=paste(tmp_d,'Model_nonP_tr.jpeg', sep='/'))

</code></pre>

<hr>
<h2 id='createDataPartition'>Data Partitioning</h2><span id='topic+createDataPartition'></span><span id='topic+createFolds'></span>

<h3>Description</h3>

<p>As input data, the functions need two folders- Nonforestdir with images of non-forest and forestdir with ones of forest.
createDataPartition() splits data into training and testing partitions while keeping the relative sample size of the classes
the same as in the original data. createFolds() splits the data into k folds for cross-validation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>createDataPartition(forestdir, Nonforestdir, times = 1, p = 0.5)

createFolds(forestdir, Nonforestdir, k = 5)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="createDataPartition_+3A_forestdir">forestdir</code></td>
<td>
<p>path to the directory with (only) forest images</p>
</td></tr>
<tr><td><code id="createDataPartition_+3A_nonforestdir">Nonforestdir</code></td>
<td>
<p>path to the directory with (only) non-forest images</p>
</td></tr>
<tr><td><code id="createDataPartition_+3A_times">times</code></td>
<td>
<p>the number of data partitions to make</p>
</td></tr>
<tr><td><code id="createDataPartition_+3A_p">p</code></td>
<td>
<p>the percentage of data to set aside for training</p>
</td></tr>
<tr><td><code id="createDataPartition_+3A_k">k</code></td>
<td>
<p>the number of folds to split the data into</p>
</td></tr>
</table>


<h3>Value</h3>

<p>createDataPartition returns a list of data partitions. Each partition consists of 4 sets- forest training,
non-forest training, forest test and non-forest test set. createFolds returns lists $forest and $nonforest with k folds in 
each of them.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>createFolds()</code>: Split data into folds
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'>
library(deforestable)
forestdir &lt;- system.file('extdata/Forest/', package = "deforestable")
Nonforestdir &lt;- system.file('extdata/Non-forest/', package = "deforestable")

trainPart &lt;- createDataPartition(forestdir=forestdir, Nonforestdir=Nonforestdir, p = .7, times = 1)

folds &lt;- createFolds(forestdir, Nonforestdir, k = 10)

</code></pre>

<hr>
<h2 id='Koutparams'>Koutrouvelis parameter estimation of image data</h2><span id='topic+Koutparams'></span>

<h3>Description</h3>

<p>In data, there are three columns and each column corresponds to the color
intensity of one channel: red, green and blue correspondingly. The four
parameters: alpha, beta, gamma and delta, of the stable distribution is
estimated for each of these channels using the Koutrouvelis regressions-type
technique.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Koutparams(data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Koutparams_+3A_data">data</code></td>
<td>
<p>matrix or data frame with color intensities of red, green and
blue for an image.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data frame with columns alpha, beta, gamma, delta and rows red,
green and blue.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(deforestable)

Forestdir &lt;- system.file('extdata/Forest/', package = "deforestable")
test_image &lt;- read_data('_6_33_.jpeg', dir = Forestdir)

pars &lt;- Koutparams(test_image)

pars

</code></pre>

<hr>
<h2 id='read_data'>Import a jpeg image</h2><span id='topic+read_data'></span><span id='topic+read_data_matrix'></span><span id='topic+read_data_raster'></span>

<h3>Description</h3>

<p>All these functions are made to read jpeg images, the difference is in the class of objects they return
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_data(filename, dir)

read_data_matrix(filename, dir)

read_data_raster(filename, dir)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="read_data_+3A_filename">filename</code></td>
<td>
<p>name of the jpeg file to import</p>
</td></tr>
<tr><td><code id="read_data_+3A_dir">dir</code></td>
<td>
<p>the directory where the image is located</p>
</td></tr>
</table>


<h3>Value</h3>

<p>read_data returns a 3-column data.frame with pixels in rows and
red, green, blue intensities in columns. read_data_matrix reads jpeg images and returns 3 matrices for
each of red, green and blue colors. read_data_raster imports jpeg as a raster object
<code><a href="terra.html#topic+rast">rast</a></code>.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>read_data_matrix()</code>: returns three matrices
</p>
</li>
<li> <p><code>read_data_raster()</code>: returns a SpatRaster object
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'>
dir &lt;- system.file('extdata/Forest/', package = "deforestable")

dd &lt;- read_data(filename='_6_33_.jpeg', dir=dir)
hist(dd[,1])


dir &lt;- system.file('extdata/Forest/', package = "deforestable")

dd &lt;- read_data_matrix(filename='_6_33_.jpeg', dir=dir)


dir &lt;- system.file('extdata/Forest/', package = "deforestable")

dd&lt;-read_data_raster(filename='_8_46_.jpeg', dir=dir)

</code></pre>

<hr>
<h2 id='train'>Train models for forest detection</h2><span id='topic+train'></span>

<h3>Description</h3>

<p>As input data, the function needs two folders- Nonforestdir with images of non-forest and Forestdir with ones of forest.
train() uses all images in both folders to train a model. Putting an image into an incorrect folder is equivalent to
tagging the image incorrectly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>train(
  n_pts,
  model = c("fr_Non-Param", "fr_Param"),
  Forestdir,
  Nonforestdir,
  train_method = c("cv", "train"),
  k_folds,
  parallel = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="train_+3A_n_pts">n_pts</code></td>
<td>
<p>matters only when train_method='cv'. Defines the size of the square sub-frames into which images would be split during cross-validation.</p>
</td></tr>
<tr><td><code id="train_+3A_model">model</code></td>
<td>
<p>which model to train</p>
</td></tr>
<tr><td><code id="train_+3A_forestdir">Forestdir</code></td>
<td>
<p>path to the directory with (only) forest images</p>
</td></tr>
<tr><td><code id="train_+3A_nonforestdir">Nonforestdir</code></td>
<td>
<p>path to the directory with (only) non-forest images</p>
</td></tr>
<tr><td><code id="train_+3A_train_method">train_method</code></td>
<td>
<p>how to train the model: simple training, cross-validation.</p>
</td></tr>
<tr><td><code id="train_+3A_k_folds">k_folds</code></td>
<td>
<p>matters only when train_method='cv'. The number of folds in the k-fold cross-validation setup.</p>
</td></tr>
<tr><td><code id="train_+3A_parallel">parallel</code></td>
<td>
<p>matters only when train_method='cv'. Boolean. whether or not use a parallel setting during cross-validation</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Currently, both fr_Non-Param and fr_Param use parameter n_pts only in the testing part of cross-validation, not during training.
Training is always done on whole original images in the training folders.
</p>


<h3>Value</h3>

<p>object of class ForestTrain potentially with a sub-class. See <code><a href="#topic+Class_ForestTrain">Class_ForestTrain</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(deforestable)
n_pts &lt;- 20

# Choosing folders with training data
Forestdir &lt;- system.file('extdata/Forest/', package = "deforestable")
Nonforestdir &lt;- system.file('extdata/Non-forest/', package = "deforestable")

k_folds=3;

#### Read the target image ####
tg_dir &lt;- system.file('extdata/', package = "deforestable")
test_image &lt;- read_data_raster('smpl_1.jpeg', dir = tg_dir)


#### Models ####


# Simple training of the non-parametric model
Model_nonP_tr &lt;- train(model='fr_Non-Param', Forestdir=Forestdir, Nonforestdir=Nonforestdir,
                       train_method='train', parallel=FALSE)

res &lt;- classify(data=test_image, Model=Model_nonP_tr,
                n_pts=n_pts, parallel=FALSE, progress = 'text')

tmp_d &lt;- tempdir(); tmp_d
jpeg::writeJPEG(image=res, target=paste(tmp_d,'Model_nonP_tr.jpeg', sep='/'))


# Cross-validation of the non-parametric model
Model_nonP_cv &lt;- train(n_pts=n_pts, model='fr_Non-Param', Forestdir=Forestdir,
                       Nonforestdir=Nonforestdir, train_method='cv',
                       k_folds=k_folds, parallel=FALSE)

res &lt;- classify(data=test_image, Model=Model_nonP_cv,
                n_pts=n_pts, parallel=FALSE, progress = 'text')

tmp_d &lt;- tempdir(); tmp_d
jpeg::writeJPEG(image=res, target=paste(tmp_d,'Model_nonP_cv.jpeg', sep='/'))




# Cross-validation of the parametric model
Model_P_cv &lt;- train(n_pts=n_pts, model='fr_Param', Forestdir=Forestdir,
                    Nonforestdir=Nonforestdir, train_method='cv',
                    k_folds=k_folds, parallel=FALSE)

res &lt;- classify(data=test_image, Model=Model_P_cv,
                n_pts=n_pts, parallel=FALSE, progress = 'text')

tmp_d &lt;- tempdir(); tmp_d
jpeg::writeJPEG(image=res, target=paste(tmp_d,'Model_P_cv.jpeg', sep='/'))


# Simple training of the parametric model
Model_P_tr &lt;- train(model='fr_Param', Forestdir=Forestdir, Nonforestdir=Nonforestdir,
                    train_method='train', parallel=FALSE)
res &lt;- classify(data=test_image, Model=Model_P_tr,
                n_pts=n_pts, parallel=FALSE, progress = 'text')

tmp_d &lt;- tempdir(); tmp_d
jpeg::writeJPEG(image=res, target=paste(tmp_d,'Model_P_tr.jpeg', sep='/'))


</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
