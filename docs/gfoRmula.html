<!DOCTYPE html><html><head><title>Help for package gfoRmula</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {gfoRmula}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#basicdata'><p>Example Dataset for a Survival Outcome with Censoring</p></a></li>
<li><a href='#basicdata_nocomp'><p>Example Dataset for a Survival Outcome without Censoring</p></a></li>
<li><a href='#binary_eofdata'><p>Example Dataset for a Binary Outcome at End of Follow-Up</p></a></li>
<li><a href='#bootstrap_helper'><p>Bootstrap Observed Data and Simulate Under All Interventions</p></a></li>
<li><a href='#carry_forward'><p>Carry Forward</p></a></li>
<li><a href='#censor_data'><p>Example Dataset for a Survival Outcome with an Indicator of Censoring Variable</p></a></li>
<li><a href='#coef.gformula'><p>Coefficient method for objects of class &quot;gformula&quot;</p></a></li>
<li><a href='#continuous_eofdata'><p>Example Dataset for a Continuous Outcome at End of Follow-Up</p></a></li>
<li><a href='#continuous_eofdata_pb'><p>Example Dataset for a Continuous Outcome at End of Follow-Up with Pre-Baseline Times</p></a></li>
<li><a href='#error_catch'><p>General Error Catching</p></a></li>
<li><a href='#fit_bounded_continuous'><p>Fit Bounded Normal Model on Covariate</p></a></li>
<li><a href='#fit_glm'><p>Fit GLM on Covariate</p></a></li>
<li><a href='#fit_multinomial'><p>Fit Multinomial Model on Covariate</p></a></li>
<li><a href='#fit_trunc_normal'><p>Fit Truncated Normal Model on Covariate</p></a></li>
<li><a href='#fit_zeroinfl_normal'><p>Fit Zero-Inflated Normal Model on Covariate</p></a></li>
<li><a href='#get_cvgrphs'><p>Get Covariate Plots</p></a></li>
<li><a href='#get_outgrphs'><p>Get Risk and Survival Plots</p></a></li>
<li><a href='#get_plot_info'><p>Get Plotting Information</p></a></li>
<li><a href='#gformula'><p>Estimation of Survival Outcome, Continuous End-of-Follow-Up Outcome, or Binary End-of-Follow-Up Outcome Under the Parametric G-Formula</p></a></li>
<li><a href='#gformula_binary_eof'><p>Estimation of Binary End-of-Follow-Up Outcome Under the Parametric G-Formula</p></a></li>
<li><a href='#gformula_continuous_eof'><p>Estimation of Continuous End-of-Follow-Up Outcome Under the Parametric G-Formula</p></a></li>
<li><a href='#gformula_survival'><p>Estimation of Survival Outcome Under the Parametric G-Formula</p></a></li>
<li><a href='#hr_helper'><p>Format Simulated Dataset for Hazard Ratio Calculation</p></a></li>
<li><a href='#intfunc'><p>Execute Intervention</p></a></li>
<li><a href='#lagged'><p>History functions</p></a></li>
<li><a href='#make_histories'><p>Generates Functions of History of Existing Covariates</p></a></li>
<li><a href='#natural'><p>Natural Course Intervention</p></a></li>
<li><a href='#obs_calculate'><p>Calculate Observed Covariate Means and Risk</p></a></li>
<li><a href='#plot.gformula_binary_eof'><p>Plot method for objects of class &quot;gformula_binary_eof&quot;</p></a></li>
<li><a href='#plot.gformula_continuous_eof'><p>Plot method for objects of class &quot;gformula_continuous_eof&quot;</p></a></li>
<li><a href='#plot.gformula_survival'><p>Plot method for objects of class &quot;gformula_survival&quot;</p></a></li>
<li><a href='#pred_fun_cov'><p>Fit Covariate Models</p></a></li>
<li><a href='#pred_fun_D'><p>Fit Competing Event Model</p></a></li>
<li><a href='#pred_fun_Y'><p>Fit Outcome Model</p></a></li>
<li><a href='#predict_binomial'><p>Simulate Binary Values</p></a></li>
<li><a href='#predict_normal'><p>Simulate Normal Values</p></a></li>
<li><a href='#predict_trunc_normal'><p>Simulate Truncated Normal Values</p></a></li>
<li><a href='#print.gformula_survival'><p>Print and summary methods for &quot;gformula&quot; objects</p></a></li>
<li><a href='#rmse_calculate'><p>Calculate RMSE for Covariate, Outcome, and Competing Risk Models</p></a></li>
<li><a href='#simple_restriction'><p>Simple Restriction</p></a></li>
<li><a href='#simulate'><p>Simulate Counterfactual Outcomes Under Intervention</p></a></li>
<li><a href='#static'><p>Static Intervention</p></a></li>
<li><a href='#threshold'><p>Threshold Intervention</p></a></li>
<li><a href='#vcov.gformula'><p>Variance-covariance method for objects of class &quot;gformula&quot;</p></a></li>
<li><a href='#visit_sum'><p>Create Visit Sum Covariate</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Parametric G-Formula</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.4</td>
</tr>
<tr>
<td>Description:</td>
<td>Implements the parametric g-formula algorithm of Robins (1986) 
    &lt;<a href="https://doi.org/10.1016%2F0270-0255%2886%2990088-6">doi:10.1016/0270-0255(86)90088-6</a>&gt;. The g-formula can be used to estimate 
    the causal effects of hypothetical time-varying treatment interventions on 
    the mean or risk of an outcome from longitudinal data with time-varying 
    confounding. This package allows: 1) binary or continuous/multi-level 
    time-varying treatments; 2) different types of outcomes (survival or 
    continuous/binary end of follow-up); 3) data with competing events or 
    truncation by death and loss to follow-up and other types of censoring 
    events; 4) different options for handling competing events in the case of 
    survival outcomes; 5) a random measurement/visit process; 6) joint 
    interventions on multiple treatments; and 7) general incorporation of a 
    priori knowledge of the data structure.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Imports:</td>
<td>data.table, ggplot2, ggpubr, grDevices, nnet, parallel,
progress, stats, stringr, survival, truncnorm, truncreg, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>Hmisc</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/CausalInference/gfoRmula">https://github.com/CausalInference/gfoRmula</a>,
<a href="https://doi.org/10.1016/j.patter.2020.100008">https://doi.org/10.1016/j.patter.2020.100008</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/CausalInference/gfoRmula/issues">https://github.com/CausalInference/gfoRmula/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-30 19:36:44 UTC; Sean</td>
</tr>
<tr>
<td>Author:</td>
<td>Victoria Lin [aut] (V. Lin and S. McGrath made equal contributions),
  Sean McGrath <a href="https://orcid.org/0000-0002-7281-3516"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre] (V. Lin and S. McGrath made equal contributions),
  Zilu Zhang [aut],
  Roger W. Logan [aut],
  Lucia C. Petito [aut],
  Jing Li [aut],
  Jessica G. Young <a href="https://orcid.org/0000-0002-2758-6932"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut] (M.A. Hernán and J.G. Young made equal contributions),
  Miguel A. Hernán [aut] (M.A. Hernán and J.G. Young made equal
    contributions),
  2019 The President and Fellows of Harvard College [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Sean McGrath &lt;sean_mcgrath@g.harvard.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-30 19:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='basicdata'>Example Dataset for a Survival Outcome with Censoring</h2><span id='topic+basicdata'></span>

<h3>Description</h3>

<p>A dataset consisting of 11,332 observations on 2,500 individuals over 7 time points. Each row in the dataset corresponds to the record of one individual at one time point. Individuals who are censored at time <code class="reqn">k+1</code> only have a total of <code class="reqn">k+1</code> records, which correspond to time indices <code class="reqn">0,..., k</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>basicdata
</code></pre>


<h3>Format</h3>

<p>A data table with 11,332 rows and 8 variables:
</p>

<dl>
<dt>t0</dt><dd><p>Time index.</p>
</dd>
<dt>id</dt><dd><p>Unique identifier for each individual.</p>
</dd>
<dt>L1</dt><dd><p>Binary time-varying covariate.</p>
</dd>
<dt>L2</dt><dd><p>Continuous time-varying covariate.</p>
</dd>
<dt>L3</dt><dd><p>Continuous baseline covariate. For each individual, the baseline values are repeated at each time point.</p>
</dd>
<dt>A</dt><dd><p>Binary treatment variable.</p>
</dd>
<dt>D</dt><dd><p>Competing event; time-varying indicator of failure.</p>
</dd>
<dt>Y</dt><dd><p>Outcome of interest; time-varying indicator of failure.</p>
</dd>
</dl>


<hr>
<h2 id='basicdata_nocomp'>Example Dataset for a Survival Outcome without Censoring</h2><span id='topic+basicdata_nocomp'></span>

<h3>Description</h3>

<p>A dataset consisting of 13,170 observations on 2,500 individuals over 7 time points. Each row in the dataset corresponds to the record of one individual at one time point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>basicdata_nocomp
</code></pre>


<h3>Format</h3>

<p>A data table with 13,170 rows and 7 variables:
</p>

<dl>
<dt>t0</dt><dd><p>Time index.</p>
</dd>
<dt>id</dt><dd><p>Unique identifier for each individual.</p>
</dd>
<dt>L1</dt><dd><p>Binary covariate.</p>
</dd>
<dt>L2</dt><dd><p>Continuous covariate.</p>
</dd>
<dt>L3</dt><dd><p>Continuous baseline covariate. For each individual, the baseline values are repeated at each time point.</p>
</dd>
<dt>A</dt><dd><p>Binary treatment variable.</p>
</dd>
<dt>Y</dt><dd><p>Outcome of interest; time-varying indicator of failure.</p>
</dd>
</dl>


<hr>
<h2 id='binary_eofdata'>Example Dataset for a Binary Outcome at End of Follow-Up</h2><span id='topic+binary_eofdata'></span>

<h3>Description</h3>

<p>A dataset consisting of 17,500 observations on 2,500 individuals over 7 time points. Each row in the dataset corresponds to the record of one individual at one time point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>binary_eofdata
</code></pre>


<h3>Format</h3>

<p>A data table with 17,500 rows and 7 variables:
</p>

<dl>
<dt>time</dt><dd><p>Time index.</p>
</dd>
<dt>id_num</dt><dd><p>Unique identifier for each individual.</p>
</dd>
<dt>cov1</dt><dd><p>Binary time-varying covariate.</p>
</dd>
<dt>cov2</dt><dd><p>Continuous time-varying covariate.</p>
</dd>
<dt>cov3</dt><dd><p>Continuous baseline covariate. For each individual, the baseline values are repeated at each time point.</p>
</dd>
<dt>treat</dt><dd><p>Binary treatment variable.</p>
</dd>
<dt>outcome</dt><dd><p>Binary outcome of interest. Because this outcome is only defined at the end of follow-up, values of <code>NA</code> are given in all other time points.</p>
</dd>
</dl>


<hr>
<h2 id='bootstrap_helper'>Bootstrap Observed Data and Simulate Under All Interventions</h2><span id='topic+bootstrap_helper'></span>

<h3>Description</h3>

<p>This internal function bootstraps the observed data (i.e., resamples the observed data set with replacement to
construct bootstrap confidence intervals and standard errors). Then, the function simulates data
using the resampled dataset to estimate the survival outcome, binary end-of-follow-up outcome, or
continuous end-of-follow-up outcome.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bootstrap_helper(
  r,
  time_points,
  obs_data,
  bootseeds,
  outcome_type,
  intvars,
  interventions,
  int_times,
  ref_int,
  covparams,
  covnames,
  covtypes,
  covfits_custom,
  covpredict_custom,
  basecovs,
  histvars,
  histvals,
  histories,
  ymodel,
  yrestrictions,
  compevent_restrictions,
  restrictions,
  comprisk,
  compevent_model,
  time_name,
  outcome_name,
  compevent_name,
  ranges,
  parallel,
  ncores,
  max_visits,
  hazardratio,
  intcomp,
  boot_diag,
  nsimul,
  baselags,
  below_zero_indicator,
  min_time,
  show_progress,
  pb,
  int_visit_type,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bootstrap_helper_+3A_r">r</code></td>
<td>
<p>Integer specifying the index of the current iteration of the bootstrap.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_time_points">time_points</code></td>
<td>
<p>Number of time points to simulate.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_obs_data">obs_data</code></td>
<td>
<p>Data table containing the observed data.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_bootseeds">bootseeds</code></td>
<td>
<p>Vector of integers specifying the seeds. One seed is used to initialize each bootstrap iteration.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_outcome_type">outcome_type</code></td>
<td>
<p>Character string specifying the &quot;type&quot; of the outcome. The possible &quot;types&quot; are: <code>"survival"</code>, <code>"continuous_eof"</code>, and <code>"binary_eof"</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_intvars">intvars</code></td>
<td>
<p>List, whose elements are vectors of character strings. The kth vector in <code>intvars</code> specifies the name(s) of the variable(s) to be intervened
on in each round of the simulation under the kth intervention in <code>interventions</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_interventions">interventions</code></td>
<td>
<p>List, whose elements are lists of vectors. Each list in <code>interventions</code> specifies a unique intervention on the relevant variable(s) in <code>intvars</code>. Each vector contains a function
implementing a particular intervention on a single variable, optionally
followed by one or more &quot;intervention values&quot; (i.e.,
integers used to specify the treatment regime).</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_int_times">int_times</code></td>
<td>
<p>List, whose elements are lists of vectors. The kth list in <code>int_times</code> corresponds to the kth intervention in <code>interventions</code>. Each vector specifies the time points in which the relevant intervention is applied on the corresponding variable in <code>intvars</code>.
When an intervention is not applied, the simulated natural course value is used. By default, this argument is set so that all interventions are applied in all time points.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_ref_int">ref_int</code></td>
<td>
<p>Integer denoting the intervention to be used as the
reference for calculating the risk ratio and risk difference. 0 denotes the
natural course, while subsequent integers denote user-specified
interventions in the order that they are
named in <code>interventions</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_covparams">covparams</code></td>
<td>
<p>List of vectors, where each vector contains information for
one parameter used in the modeling of the time-varying covariates (e.g.,
model statement, family, link function, etc.). Each vector
must be the same length as <code>covnames</code> and in the same order.
If a parameter is not required for a certain covariate, it
should be set to <code>NA</code> at that index.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_covnames">covnames</code></td>
<td>
<p>Vector of character strings specifying the names of the time-varying covariates in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_covtypes">covtypes</code></td>
<td>
<p>Vector of character strings specifying the &quot;type&quot; of each time-varying covariate included in <code>covnames</code>. The possible &quot;types&quot; are: <code>"binary"</code>, <code>"normal"</code>, <code>"categorical"</code>, <code>"bounded normal"</code>, <code>"zero-inflated normal"</code>, <code>"truncated normal"</code>, <code>"absorbing"</code>, <code>"categorical time"</code>, and <code>"custom"</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_covfits_custom">covfits_custom</code></td>
<td>
<p>Vector containing custom fit functions for time-varying covariates that
do not fall within the pre-defined covariate types. It should be in
the same order <code>covnames</code>. If a custom fit function is not
required for a particular covariate (e.g., if the first
covariate is of type <code>"binary"</code> but the second is of type <code>"custom"</code>), then that
index should be set to <code>NA</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_covpredict_custom">covpredict_custom</code></td>
<td>
<p>Vector containing custom prediction functions for time-varying
covariates that do not fall within the pre-defined covariate types.
It should be in the same order as <code>covnames</code>. If a custom
prediction function is not required for a particular
covariate, then that index should be set to <code>NA</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_basecovs">basecovs</code></td>
<td>
<p>Vector of character strings specifying the names of baseline covariates in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_histvars">histvars</code></td>
<td>
<p>List of vectors. The kth vector specifies the names of the variables for which the kth history function
in <code>histories</code> is to be applied.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_histvals">histvals</code></td>
<td>
<p>List of length two. The first element is a numeric vector specifying the lags used in the model statements (e.g., if <code>lag1_varname</code> and <code>lag2_varname</code> were included in the model statements, this vector would be <code>c(1,2)</code>). The second element is a numeric vector specifying the lag averages used in the model statements.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_histories">histories</code></td>
<td>
<p>Vector of history functions to apply to the variables specified in <code>histvars</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_ymodel">ymodel</code></td>
<td>
<p>Model statement for the outcome variable.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_yrestrictions">yrestrictions</code></td>
<td>
<p>List of vectors. Each vector containins as its first entry
a condition and its second entry an integer. When the
condition is <code>TRUE</code>, the outcome variable is simulated
according to the fitted model; when the condition is <code>FALSE</code>,
the outcome variable takes on the value in the second entry.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_compevent_restrictions">compevent_restrictions</code></td>
<td>
<p>List of vectors. Each vector containins as its first entry
a condition and its second entry an integer. When the
condition is <code>TRUE</code>, the competing event variable is simulated
according to the fitted model; when the condition is <code>FALSE</code>,
the competing event variable takes on the value in the
second entry.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_restrictions">restrictions</code></td>
<td>
<p>List of vectors. Each vector contains as its first entry a covariate for which
<em>a priori</em> knowledge of its distribution is available; its second entry a condition
under which no knowledge of its distribution is available and that must be <code>TRUE</code>
for the distribution of that covariate given that condition to be estimated via a parametric
model or other fitting procedure; its third entry a function for estimating the distribution
of that covariate given the condition in the second entry is false such that <em>a priori</em> knowledge
of the covariate distribution is available; and its fourth entry a value used by the function in the
third entry. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_comprisk">comprisk</code></td>
<td>
<p>Logical scalar indicating the presence of a competing event.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_compevent_model">compevent_model</code></td>
<td>
<p>Model statement for the competing event variable.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_outcome_name">outcome_name</code></td>
<td>
<p>Character string specifying the name of the outcome variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_compevent_name">compevent_name</code></td>
<td>
<p>Character string specifying the name of the competing event variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_ranges">ranges</code></td>
<td>
<p>List of vectors. Each vector contains the minimum and
maximum values of one of the covariates in <code>covnames</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_parallel">parallel</code></td>
<td>
<p>Logical scalar indicating whether to parallelize simulations of
different interventions to multiple cores.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_ncores">ncores</code></td>
<td>
<p>Integer specifying the number of cores to use in parallel
simulation.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_max_visits">max_visits</code></td>
<td>
<p>A vector of one or more values denoting the maximum number of times
a binary covariate representing a visit process may be missed before
the individual is censored from the data (in the observed data) or
a visit is forced (in the simulated data). Multiple values exist in the
vector when the modeling of more than covariate is attached to a visit
process. A value of <code>NA</code> should be provided when there is no visit process.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_hazardratio">hazardratio</code></td>
<td>
<p>Logical scalar indicating whether the hazard ratio should be computed between two interventions.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_intcomp">intcomp</code></td>
<td>
<p>List of two numbers indicating a pair of interventions to be compared by a hazard ratio.
The default is <code>NA</code>, resulting in no hazard ratio calculation.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_boot_diag">boot_diag</code></td>
<td>
<p>Logical scalar indicating whether to return the coefficients, standard errors, and variance-covariance matrices of the parameters of the fitted models in the bootstrap samples. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_nsimul">nsimul</code></td>
<td>
<p>Number of subjects for whom to simulate data. By default, this argument is set
equal to the number of subjects in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_baselags">baselags</code></td>
<td>
<p>Logical scalar for specifying the convention used for lagi and lag_cumavgi terms in the model statements when pre-baseline times are not
included in <code>obs_data</code> and when the current time index, <code class="reqn">t</code>, is such that <code class="reqn">t &lt; i</code>. If this argument is set to <code>FALSE</code>, the value
of all lagi and lag_cumavgi terms in this context are set to 0 (for non-categorical covariates) or the reference
level (for categorical covariates). If this argument is set to <code>TRUE</code>, the value of lagi and lag_cumavgi terms
are set to their values at time 0. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_below_zero_indicator">below_zero_indicator</code></td>
<td>
<p>Logical scalar indicating whether the observed data set contains rows for time <code class="reqn">t &lt; 0</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_min_time">min_time</code></td>
<td>
<p>Numeric scalar specifying lowest value of time <code class="reqn">t</code> in the observed data set.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_show_progress">show_progress</code></td>
<td>
<p>Logical scalar indicating whether to print a progress bar for the number of bootstrap samples completed in the R console. This argument is only applicable when <code>parallel</code> is set to <code>FALSE</code> and bootstrap samples are used (i.e., <code>nsamples</code> is set to a value greater than 0). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_pb">pb</code></td>
<td>
<p>Progress bar R6 object. See <code><a href="progress.html#topic+progress_bar">progress_bar</a></code> for further details.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_int_visit_type">int_visit_type</code></td>
<td>
<p>Vector of logicals. The kth element is a logical specifying whether to carry forward the intervened value (rather than the natural value) of the treatment variables(s) when performing a carry forward restriction type for the kth intervention in <code>interventions</code>.
When the kth element is set to <code>FALSE</code>, the natural value of the treatment variable(s) in the kth intervention in <code>interventions</code> will be carried forward.
By default, this argument is set so that the intervened value of the treatment variable(s) is carried forward for all interventions.</p>
</td></tr>
<tr><td><code id="bootstrap_helper_+3A_...">...</code></td>
<td>
<p>Other arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the following components:
</p>
<table>
<tr><td><code>Result</code></td>
<td>
<p>Matrix containing risks over time under the natural course and under each user-specific intervention.</p>
</td></tr>
<tr><td><code>ResultRatio</code></td>
<td>
<p>Matrix containing risk ratios over time under the natural course and under each user-specific intervention.</p>
</td></tr>
<tr><td><code>ResultDiff</code></td>
<td>
<p>Matrix containing risk differences over time under the natural course and under each user-specific intervention.</p>
</td></tr>
<tr><td><code>bootcoeffs</code></td>
<td>
<p>List of the coefficients of the fitted models. If the argument <code>boot_diag</code> is set to <code>FALSE</code>, a value of <code>NA</code> is given.</p>
</td></tr>
<tr><td><code>bootstderrs</code></td>
<td>
<p>List of the standard errors of the coefficients of the fitted models. If the argument <code>boot_diag</code> is set to <code>FALSE</code>, a value of <code>NA</code> is given.</p>
</td></tr>
</table>

<hr>
<h2 id='carry_forward'>Carry Forward</h2><span id='topic+carry_forward'></span>

<h3>Description</h3>

<p>This function assists the implemention of a restriction on a covariate in the date
table <code>newdf</code>. A particular covariate is simulated only when some condition
(usually a covariate representing whether a doctor's visit occurred or not) is <code>TRUE</code>.
If the condition is <code>FALSE</code>, the covariate value is not simulated for that time point
and the value is instead carried over from the previous time point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>carry_forward(newdf, pool, restriction, time_name, t, int_visit_type, intvar)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="carry_forward_+3A_newdf">newdf</code></td>
<td>
<p>Data table containing the simulated data at time <code class="reqn">t</code>.</p>
</td></tr>
<tr><td><code id="carry_forward_+3A_pool">pool</code></td>
<td>
<p>Data table containing the simulated data at times before <code class="reqn">t</code>.</p>
</td></tr>
<tr><td><code id="carry_forward_+3A_restriction">restriction</code></td>
<td>
<p>List of vectors. Each vector contains as its first entry
the covariate affected by the restriction; its second entry
the condition that must be <code>TRUE</code> for the covariate to be
modeled; its third entry a function that executes other specific actions
based on the condition (in this case, this function); and its fourth
entry some value used by the function (in this case, this entry is not used).</p>
</td></tr>
<tr><td><code id="carry_forward_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>pool</code> and <code>newdf</code>.</p>
</td></tr>
<tr><td><code id="carry_forward_+3A_t">t</code></td>
<td>
<p>Integer specifying the current time index.</p>
</td></tr>
<tr><td><code id="carry_forward_+3A_int_visit_type">int_visit_type</code></td>
<td>
<p>Logical scalar specifying whether to carry forward the intervened value (rather than the natural value) of the treatment variables(s) when performing a carry forward restriction type</p>
</td></tr>
<tr><td><code id="carry_forward_+3A_intvar">intvar</code></td>
<td>
<p>A vector specifying the name(s) of the variable(s) to be intervened on.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No value is returned. The data table <code>newdf</code> is modified in place.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Estimating the effect of static treatment strategies on risk of a
## failure event

id &lt;- 'id'
time_points &lt;- 7
time_name &lt;- 't0'
covnames &lt;- c('L1', 'L2', 'A')
outcome_name &lt;- 'Y'
covtypes &lt;- c('binary', 'bounded normal', 'binary')
histories &lt;- c(lagged, lagavg)
histvars &lt;- list(c('A', 'L1', 'L2'), c('L1', 'L2'))
covparams &lt;- list(covmodels = c(L1 ~ lag1_A + lag_cumavg1_L1 + lag_cumavg1_L2 +
                                  L3 + t0,
                                L2 ~ lag1_A + L1 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0,
                                A ~ lag1_A + L1 + L2 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0))
ymodel &lt;- Y ~ A + L1 + L2 + L3 + lag1_A + lag1_L1 + lag1_L2 + t0
intvars &lt;- list('A', 'A')
interventions &lt;- list(list(c(static, rep(0, time_points))),
                      list(c(static, rep(1, time_points))))
int_descript &lt;- c('Never treat', 'Always treat')
nsimul &lt;- 10000

# At t0 == 5, assign L1 its value at the previous time point
restrictions &lt;- list(c('L2', 't0 != 5', carry_forward))

gform_basic &lt;- gformula_survival(obs_data = basicdata_nocomp, id = id,
                                 time_points = time_points,
                                 time_name = time_name, covnames = covnames,
                                 outcome_name = outcome_name,
                                 covtypes = covtypes,
                                 covparams = covparams, ymodel = ymodel,
                                 intvars = intvars,
                                 interventions = interventions,
                                 int_descript = int_descript,
                                 restrictions = restrictions,
                                 histories = histories, histvars = histvars,
                                 basecovs = c('L3'), nsimul = nsimul,
                                 seed = 1234)
gform_basic


</code></pre>

<hr>
<h2 id='censor_data'>Example Dataset for a Survival Outcome with an Indicator of Censoring Variable</h2><span id='topic+censor_data'></span>

<h3>Description</h3>

<p>A dataset consisting of 118,725 observations on 20,000 individuals over 10 time points. Each row in the dataset corresponds to the record of one individual at one time point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>censor_data
</code></pre>


<h3>Format</h3>

<p>A data table with 22,500 rows and 7 variables:
</p>

<dl>
<dt>t0</dt><dd><p>Time index.</p>
</dd>
<dt>id</dt><dd><p>Unique identifier for each individual.</p>
</dd>
<dt>L</dt><dd><p>Binary time-varying covariate.</p>
</dd>
<dt>A</dt><dd><p>Continuous treatment variable.</p>
</dd>
<dt>C</dt><dd><p>Censoring indicator.</p>
</dd>
<dt>Y</dt><dd><p>Outcome of interest; time-varying indicator of failure.</p>
</dd>
</dl>


<hr>
<h2 id='coef.gformula'>Coefficient method for objects of class &quot;gformula&quot;</h2><span id='topic+coef.gformula'></span>

<h3>Description</h3>

<p>This function extracts the coefficients of the fitted models for the
time-varying covariates, outcome, and compevent event (if applicable).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'gformula'
coef(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coef.gformula_+3A_object">object</code></td>
<td>
<p>Object of class &quot;gformula&quot;.</p>
</td></tr>
<tr><td><code id="coef.gformula_+3A_...">...</code></td>
<td>
<p>Other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>bootdiag</code> was set to <code>FALSE</code> in <code><a href="#topic+gformula">gformula</a></code>,
this function returns a list of the coefficients of the fitted models to the
observed data set. If bootstrapping was used and <code>bootdiag</code> was set to <code>TRUE</code> in
<code><a href="#topic+gformula">gformula</a></code>, this function returns a list described as follows.
The first element (named 'Original sample') is a list of the coefficients of
the fitted models to the observed data set. The kth element (named 'Bootstrap
sample k-1') is a list of the coefficients of the fitted models corresponding
to the k-1th bootstrap sample.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gformula">gformula</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Estimating the effect of static treatment strategies on risk of a
## failure event

id &lt;- 'id'
time_points &lt;- 7
time_name &lt;- 't0'
covnames &lt;- c('L1', 'L2', 'A')
outcome_name &lt;- 'Y'
outcome_type &lt;- 'survival'
covtypes &lt;- c('binary', 'bounded normal', 'binary')
histories &lt;- c(lagged, lagavg)
histvars &lt;- list(c('A', 'L1', 'L2'), c('L1', 'L2'))
covparams &lt;- list(covmodels = c(L1 ~ lag1_A + lag_cumavg1_L1 + lag_cumavg1_L2 +
                                  L3 + t0,
                                L2 ~ lag1_A + L1 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0,
                                A ~ lag1_A + L1 + L2 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0))
ymodel &lt;- Y ~ A + L1 + L2 + L3 + lag1_A + lag1_L1 + lag1_L2 + t0
intvars &lt;- list('A', 'A')
interventions &lt;- list(list(c(static, rep(0, time_points))),
                      list(c(static, rep(1, time_points))))
int_descript &lt;- c('Never treat', 'Always treat')
nsimul &lt;- 10000

gform_basic &lt;- gformula(obs_data = basicdata_nocomp, id = id,
                        time_points = time_points,
                        time_name = time_name, covnames = covnames,
                        outcome_name = outcome_name,
                        outcome_type = outcome_type, covtypes = covtypes,
                        covparams = covparams, ymodel = ymodel,
                        intvars = intvars,
                        interventions = interventions,
                        int_descript = int_descript,
                        histories = histories, histvars = histvars,
                        basecovs = c('L3'), nsimul = nsimul,
                        seed = 1234)
coef(gform_basic)


</code></pre>

<hr>
<h2 id='continuous_eofdata'>Example Dataset for a Continuous Outcome at End of Follow-Up</h2><span id='topic+continuous_eofdata'></span>

<h3>Description</h3>

<p>A dataset consisting of 17,500 observations on 2,500 individuals over 7 time points. Each row in the dataset corresponds to the record of one individual at one time point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>continuous_eofdata
</code></pre>


<h3>Format</h3>

<p>A data table with 17,500 rows and 7 variables:
</p>

<dl>
<dt>t0</dt><dd><p>Time index.</p>
</dd>
<dt>id</dt><dd><p>Unique identifier for each individual.</p>
</dd>
<dt>L1</dt><dd><p>Categorical time-varying covariate.</p>
</dd>
<dt>L2</dt><dd><p>Continuous time-varying covariate.</p>
</dd>
<dt>L3</dt><dd><p>Continuous baseline covariate. For each individual, the baseline values are repeated at each time point.</p>
</dd>
<dt>A</dt><dd><p>Binary treatment variable.</p>
</dd>
<dt>Y</dt><dd><p>Continuous outcome of interest. Because this outcome is only defined at the end of follow-up, values of <code>NA</code> are given in all other time points.</p>
</dd>
</dl>


<hr>
<h2 id='continuous_eofdata_pb'>Example Dataset for a Continuous Outcome at End of Follow-Up with Pre-Baseline Times</h2><span id='topic+continuous_eofdata_pb'></span>

<h3>Description</h3>

<p>A dataset consisting of 22,500 observations on 2,500 individuals over 2 pre-baseline time points and follow-up 7 time points. Each row in the dataset corresponds to the record of one individual at one time point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>continuous_eofdata_pb
</code></pre>


<h3>Format</h3>

<p>A data table with 22,500 rows and 7 variables:
</p>

<dl>
<dt>t0</dt><dd><p>Time index.</p>
</dd>
<dt>id</dt><dd><p>Unique identifier for each individual.</p>
</dd>
<dt>L1</dt><dd><p>Categorical time-varying covariate.</p>
</dd>
<dt>L2</dt><dd><p>Continuous time-varying covariate.</p>
</dd>
<dt>L3</dt><dd><p>Continuous baseline covariate. For each individual, the baseline values are repeated at each time point.</p>
</dd>
<dt>A</dt><dd><p>Binary treatment variable.</p>
</dd>
<dt>Y</dt><dd><p>Continuous outcome of interest. Because this outcome is only defined at the end of follow-up, values of <code>NA</code> are given in all other time points.</p>
</dd>
</dl>


<hr>
<h2 id='error_catch'>General Error Catching</h2><span id='topic+error_catch'></span>

<h3>Description</h3>

<p>This internal function catches various potential errors in the user input in <code><a href="#topic+gformula_survival">gformula_survival</a></code>, <code><a href="#topic+gformula_continuous_eof">gformula_continuous_eof</a></code>, and <code><a href="#topic+gformula_binary_eof">gformula_binary_eof</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>error_catch(
  id,
  nsimul,
  intvars,
  interventions,
  int_times,
  int_descript,
  covnames,
  covtypes,
  basecovs,
  histvars,
  histories,
  compevent_model,
  hazardratio,
  intcomp,
  time_points,
  outcome_type,
  time_name,
  obs_data,
  parallel,
  ncores,
  nsamples,
  sim_data_b,
  outcome_name,
  compevent_name,
  comprisk,
  censor,
  censor_name,
  covmodels,
  histvals,
  ipw_cutoff_quantile,
  ipw_cutoff_value
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="error_catch_+3A_id">id</code></td>
<td>
<p>Character string specifying the name of the ID variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_nsimul">nsimul</code></td>
<td>
<p>Number of subjects for whom to simulate data.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_intvars">intvars</code></td>
<td>
<p>List, whose elements are vectors of character strings. The kth vector in <code>intvars</code> specifies the name(s) of the variable(s) to be intervened
on in each round of the simulation under the kth intervention in <code>interventions</code>.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_interventions">interventions</code></td>
<td>
<p>List, whose elements are lists of vectors. Each list in <code>interventions</code> specifies a unique intervention on the relevant variable(s) in <code>intvars</code>. Each vector contains a function
implementing a particular intervention on a single variable, optionally
followed by one or more &quot;intervention values&quot; (i.e.,
integers used to specify the treatment regime).</p>
</td></tr>
<tr><td><code id="error_catch_+3A_int_times">int_times</code></td>
<td>
<p>List, whose elements are lists of vectors. The kth list in <code>int_times</code> corresponds to the kth intervention in <code>interventions</code>. Each vector specifies the time points in which the relevant intervention is applied on the corresponding variable in <code>intvars</code>.
When an intervention is not applied, the simulated natural course value is used. By default, this argument is set so that all interventions are applied in all time points.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_int_descript">int_descript</code></td>
<td>
<p>Vector of character strings, each describing an intervention.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_covnames">covnames</code></td>
<td>
<p>Vector of character strings specifying the names of the time-varying covariates in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_covtypes">covtypes</code></td>
<td>
<p>Vector of character strings specifying the &quot;type&quot; of each time-varying covariate included in <code>covnames</code>. The possible &quot;types&quot; are: <code>"binary"</code>, <code>"normal"</code>, <code>"categorical"</code>, <code>"bounded normal"</code>, <code>"zero-inflated normal"</code>, <code>"truncated normal"</code>, <code>"absorbing"</code>, <code>"categorical time"</code>, and <code>"custom"</code>.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_basecovs">basecovs</code></td>
<td>
<p>Vector of character strings specifying the names of baseline covariates in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_histvars">histvars</code></td>
<td>
<p>List of vectors. The kth vector specifies the names of the variables for which the kth history function
in <code>histories</code> is to be applied.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_histories">histories</code></td>
<td>
<p>Vector of history functions to apply to the variables specified in <code>histvars</code>.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_compevent_model">compevent_model</code></td>
<td>
<p>Model statement for the competing event variable.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_hazardratio">hazardratio</code></td>
<td>
<p>Logical scalar indicating whether the hazard ratio should be calculated
between two interventions.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_intcomp">intcomp</code></td>
<td>
<p>List of two numbers indicating a pair of interventions to be compared by a hazard ratio.
The default is <code>NA</code>, resulting in no hazard ratio calculation.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_time_points">time_points</code></td>
<td>
<p>Number of time points to simulate.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_outcome_type">outcome_type</code></td>
<td>
<p>Character string specifying the &quot;type&quot; of the outcome. The possible &quot;types&quot; are: <code>"survival"</code>, <code>"continuous_eof"</code>, and <code>"binary_eof"</code>.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_obs_data">obs_data</code></td>
<td>
<p>Data table containing the observed data.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_parallel">parallel</code></td>
<td>
<p>Logical scalar indicating whether to parallelize simulations of
different interventions to multiple cores.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_ncores">ncores</code></td>
<td>
<p>Integer specifying the number of cores to use in parallel
simulation.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_nsamples">nsamples</code></td>
<td>
<p>Integer specifying the number of bootstrap samples to generate.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_sim_data_b">sim_data_b</code></td>
<td>
<p>Logical scalar indicating whether to return the simulated data set. If bootstrap samples are used (i.e., <code>nsamples</code> is set to a value greater than 0), this argument must be set to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_outcome_name">outcome_name</code></td>
<td>
<p>Character string specifying the name of the outcome variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_compevent_name">compevent_name</code></td>
<td>
<p>Character string specifying the name of the competing event variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_comprisk">comprisk</code></td>
<td>
<p>Logical scalar indicating the presence of a competing event.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_censor">censor</code></td>
<td>
<p>Logical scalar indicating the presence of a censoring variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_censor_name">censor_name</code></td>
<td>
<p>Character string specifying the name of the censoring variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_covmodels">covmodels</code></td>
<td>
<p>Vector of model statements for the time-varying covariates.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_histvals">histvals</code></td>
<td>
<p>List of length 3. First element contains a vector of integers specifying the number of lags back for the lagged function. Second element contains
a vector of integers indicating the number of lags back for the lagavg function. The last element is an indicator whether a cumavg term
appears in any of the model statements.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_ipw_cutoff_quantile">ipw_cutoff_quantile</code></td>
<td>
<p>Percentile by which to truncate inverse probability weights.</p>
</td></tr>
<tr><td><code id="error_catch_+3A_ipw_cutoff_value">ipw_cutoff_value</code></td>
<td>
<p>Cutoff value by which to truncate inverse probability weights.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No value is returned.
</p>

<hr>
<h2 id='fit_bounded_continuous'>Fit Bounded Normal Model on Covariate</h2><span id='topic+fit_bounded_continuous'></span>

<h3>Description</h3>

<p>This internal function models a covariate using a &quot;bounded normal&quot; distribution
by first standardizing the covariate values to the range [0, 1], noninclusive,
then fitting a generalized linear model (GLM) under the Gaussian family function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_bounded_continuous(
  covparams,
  covlink = NA,
  covname,
  obs_data,
  j,
  model_fits
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit_bounded_continuous_+3A_covparams">covparams</code></td>
<td>
<p>List of vectors, where each vector contains information for
one parameter used in the modeling of the time-varying covariates (e.g.,
model statement, family, link function, etc.).</p>
</td></tr>
<tr><td><code id="fit_bounded_continuous_+3A_covlink">covlink</code></td>
<td>
<p>Vector of link functions.</p>
</td></tr>
<tr><td><code id="fit_bounded_continuous_+3A_covname">covname</code></td>
<td>
<p>Name of the covariate at index <code class="reqn">j</code>.</p>
</td></tr>
<tr><td><code id="fit_bounded_continuous_+3A_obs_data">obs_data</code></td>
<td>
<p>Data on which the model is fit.</p>
</td></tr>
<tr><td><code id="fit_bounded_continuous_+3A_j">j</code></td>
<td>
<p>Integer specifying the index of the covariate.</p>
</td></tr>
<tr><td><code id="fit_bounded_continuous_+3A_model_fits">model_fits</code></td>
<td>
<p>Logical scalar indicating whether to return the fitted models. The default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Fitted model for the covariate at index <code class="reqn">j</code>.
</p>

<hr>
<h2 id='fit_glm'>Fit GLM on Covariate</h2><span id='topic+fit_glm'></span>

<h3>Description</h3>

<p>This internal function fits a generalized linear model (GLM) for a single covariate using the observed data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_glm(covparams, covlink = NA, covfam, obs_data, j, model_fits)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit_glm_+3A_covparams">covparams</code></td>
<td>
<p>List of vectors, where each vector contains information for
one parameter used in the modeling of the time-varying covariates (e.g.,
model statement, family, link function, etc.).</p>
</td></tr>
<tr><td><code id="fit_glm_+3A_covlink">covlink</code></td>
<td>
<p>Vector of link functions.</p>
</td></tr>
<tr><td><code id="fit_glm_+3A_covfam">covfam</code></td>
<td>
<p>Vector of character strings specifying the names of the family functions to be
used for fitting the GLM.</p>
</td></tr>
<tr><td><code id="fit_glm_+3A_obs_data">obs_data</code></td>
<td>
<p>Data on which the model is fit.</p>
</td></tr>
<tr><td><code id="fit_glm_+3A_j">j</code></td>
<td>
<p>Integer specifying the index of the covariate.</p>
</td></tr>
<tr><td><code id="fit_glm_+3A_model_fits">model_fits</code></td>
<td>
<p>Logical scalar indicating whether to return the fitted models. The default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Fitted model for the covariate at index <code class="reqn">j</code>.
</p>

<hr>
<h2 id='fit_multinomial'>Fit Multinomial Model on Covariate</h2><span id='topic+fit_multinomial'></span>

<h3>Description</h3>

<p>This internal function fits a multinomial regression model for a categorical covariate using the observed data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_multinomial(covparams, obs_data, j, model_fits)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit_multinomial_+3A_covparams">covparams</code></td>
<td>
<p>List of vectors, where each vector contains information for
one parameter used in the modeling of the time-varying covariates (e.g.,
model statement, family, link function, etc.).</p>
</td></tr>
<tr><td><code id="fit_multinomial_+3A_obs_data">obs_data</code></td>
<td>
<p>Data on which the model is fit.</p>
</td></tr>
<tr><td><code id="fit_multinomial_+3A_j">j</code></td>
<td>
<p>Integer specifying the index of the covariate.</p>
</td></tr>
<tr><td><code id="fit_multinomial_+3A_model_fits">model_fits</code></td>
<td>
<p>Logical scalar indicating whether to return the fitted models. The default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Fitted model for the covariate at index <code class="reqn">j</code>.
</p>

<hr>
<h2 id='fit_trunc_normal'>Fit Truncated Normal Model on Covariate</h2><span id='topic+fit_trunc_normal'></span>

<h3>Description</h3>

<p>This internal function models a covariate using a normal distribution truncated on one
side at a user-specified cutoff.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_trunc_normal(covparams, obs_data, j, model_fits)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit_trunc_normal_+3A_covparams">covparams</code></td>
<td>
<p>List of vectors, where each vector contains information for
one parameter used in the modeling of the time-varying covariates (e.g.,
model statement, family, link function, etc.).</p>
</td></tr>
<tr><td><code id="fit_trunc_normal_+3A_obs_data">obs_data</code></td>
<td>
<p>Data on which the model is fit.</p>
</td></tr>
<tr><td><code id="fit_trunc_normal_+3A_j">j</code></td>
<td>
<p>Integer specifying the index of the covariate.</p>
</td></tr>
<tr><td><code id="fit_trunc_normal_+3A_model_fits">model_fits</code></td>
<td>
<p>Logical scalar indicating whether to return the fitted models. The default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Fitted model for the covariate at index <code class="reqn">j</code>.
</p>

<hr>
<h2 id='fit_zeroinfl_normal'>Fit Zero-Inflated Normal Model on Covariate</h2><span id='topic+fit_zeroinfl_normal'></span>

<h3>Description</h3>

<p>This internal function models a zero-inflated normal distribution through the combined
use of a generalized linear model (GLM) fit on a zero vs. non-zero indicator
and a GLM fit on all non-zero values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_zeroinfl_normal(covparams, covlink = NA, covname, obs_data, j, model_fits)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit_zeroinfl_normal_+3A_covparams">covparams</code></td>
<td>
<p>List of vectors, where each vector contains information for
one parameter used in the modeling of the time-varying covariates (e.g.,
model statement, family, link function, etc.).</p>
</td></tr>
<tr><td><code id="fit_zeroinfl_normal_+3A_covlink">covlink</code></td>
<td>
<p>Vector of link functions.</p>
</td></tr>
<tr><td><code id="fit_zeroinfl_normal_+3A_covname">covname</code></td>
<td>
<p>Name of the covariate at index <code class="reqn">j</code>.</p>
</td></tr>
<tr><td><code id="fit_zeroinfl_normal_+3A_obs_data">obs_data</code></td>
<td>
<p>Data on which the model is fit.</p>
</td></tr>
<tr><td><code id="fit_zeroinfl_normal_+3A_j">j</code></td>
<td>
<p>Integer specifying the index of the covariate.</p>
</td></tr>
<tr><td><code id="fit_zeroinfl_normal_+3A_model_fits">model_fits</code></td>
<td>
<p>Logical scalar indicating whether to return the fitted models. The default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Fitted model for the covariate at index <code class="reqn">j</code>.
</p>

<hr>
<h2 id='get_cvgrphs'>Get Covariate Plots</h2><span id='topic+get_cvgrphs'></span>

<h3>Description</h3>

<p>This internal function obtains the covariate plots for <code><a href="#topic+gformula_survival">gformula_survival</a></code>, <code><a href="#topic+gformula_continuous_eof">gformula_continuous_eof</a></code>, and <code><a href="#topic+gformula_binary_eof">gformula_binary_eof</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_cvgrphs(x, covnames, covtypes, xlab, ylab_cov)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_cvgrphs_+3A_x">x</code></td>
<td>
<p>Object of class &quot;gformula_survival&quot;, &quot;gformula_continuous_eof&quot;, or &quot;gformula_binary_eof&quot;.</p>
</td></tr>
<tr><td><code id="get_cvgrphs_+3A_covnames">covnames</code></td>
<td>
<p>Vector of character strings specifying the names of the time-varying covariates to be plotted. The ordering of covariates given here is used in the plot grid.</p>
</td></tr>
<tr><td><code id="get_cvgrphs_+3A_covtypes">covtypes</code></td>
<td>
<p>Vector of character strings specifying the &quot;type&quot; of each time-varying covariate included in <code>covnames</code>. The possible &quot;types&quot; are: <code>"binary"</code>, <code>"normal"</code>, <code>"categorical"</code>, <code>"bounded normal"</code>, <code>"zero-inflated normal"</code>, <code>"truncated normal"</code>, <code>"absorbing"</code>, <code>"categorical time"</code>, and <code>"custom"</code>.</p>
</td></tr>
<tr><td><code id="get_cvgrphs_+3A_xlab">xlab</code></td>
<td>
<p>Character string for the x axes of all plots.</p>
</td></tr>
<tr><td><code id="get_cvgrphs_+3A_ylab_cov">ylab_cov</code></td>
<td>
<p>Vector of character strings for the y axes of the plots for the covariates. This argument must be the same length as <code>covnames</code>. The i-th element of this argument corresponds to the plot for the i-th element of <code>covnames</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of covariate plots.
</p>

<hr>
<h2 id='get_outgrphs'>Get Risk and Survival Plots</h2><span id='topic+get_outgrphs'></span>

<h3>Description</h3>

<p>This internal function obtains the risk and survival plots for <code><a href="#topic+gformula_survival">gformula_survival</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_outgrphs(x, risk, survival, xlab, ylab_risk, ylab_surv, ci_risk)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_outgrphs_+3A_x">x</code></td>
<td>
<p>Object of class &quot;gformula_survival&quot;.</p>
</td></tr>
<tr><td><code id="get_outgrphs_+3A_risk">risk</code></td>
<td>
<p>Logical scalar indicating whether to include a plot for the risk.</p>
</td></tr>
<tr><td><code id="get_outgrphs_+3A_survival">survival</code></td>
<td>
<p>Logical scalar indicating whether to include a plot for the survival.</p>
</td></tr>
<tr><td><code id="get_outgrphs_+3A_xlab">xlab</code></td>
<td>
<p>Character string for the x axes of all plots.</p>
</td></tr>
<tr><td><code id="get_outgrphs_+3A_ylab_risk">ylab_risk</code></td>
<td>
<p>Character string for the y axis of the plot for the risk (if applicable).</p>
</td></tr>
<tr><td><code id="get_outgrphs_+3A_ylab_surv">ylab_surv</code></td>
<td>
<p>Character string for the y axis of the plot for the survival (if applicable).</p>
</td></tr>
<tr><td><code id="get_outgrphs_+3A_ci_risk">ci_risk</code></td>
<td>
<p>Logical scalar specifying whether to include error bars for the 95% confidence intervals of the estimated risk under the natural course. This argument is only effective if the argument <code>nsamples</code> was set to a positive value in <code><a href="#topic+gformula_survival">gformula_survival</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of plots for the risk and survival.
</p>

<hr>
<h2 id='get_plot_info'>Get Plotting Information</h2><span id='topic+get_plot_info'></span>

<h3>Description</h3>

<p>This internal function obtains the data tables necessary for plotting. For continuous and binary covariates, the mean observed and simulated values are obtained for each time point. For categorical covariates, the observed and simulated means of the levels of the factors are obtained for each time point.  When the outcome is of type <code>"survival"</code>, the observed and simulated risk and survival are obtained for each time point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_plot_info(
  outcome_name,
  compevent_name,
  compevent2_name,
  censor_name,
  time_name,
  id,
  time_points,
  covnames,
  covtypes,
  nat_pool,
  nat_result,
  comprisk,
  comprisk2,
  censor,
  fitD2,
  fitC,
  outcome_type,
  obs_data,
  ipw_cutoff_quantile,
  ipw_cutoff_value
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_plot_info_+3A_outcome_name">outcome_name</code></td>
<td>
<p>Character string specifying the name of the outcome variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_compevent_name">compevent_name</code></td>
<td>
<p>Character string specifying the name of the competing event variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_compevent2_name">compevent2_name</code></td>
<td>
<p>Character string specifying the name of the competing event variable in <code>obs_data</code> if competing events are treated as censoring events.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_censor_name">censor_name</code></td>
<td>
<p>Character string specifying the name of the censoring variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_id">id</code></td>
<td>
<p>Character string specifying the name of the ID variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_time_points">time_points</code></td>
<td>
<p>Number of time points to simulate.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_covnames">covnames</code></td>
<td>
<p>Vector of character strings specifying the names of the time-varying covariates in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_covtypes">covtypes</code></td>
<td>
<p>Vector of character strings specifying the &quot;type&quot; of each time-varying covariate included in <code>covnames</code>. The possible &quot;types&quot; are: <code>"binary"</code>, <code>"normal"</code>, <code>"categorical"</code>, <code>"bounded normal"</code>, <code>"zero-inflated normal"</code>, <code>"truncated normal"</code>, <code>"absorbing"</code>, <code>"categorical time"</code>, and <code>"custom"</code>.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_nat_pool">nat_pool</code></td>
<td>
<p>Pooled-over-time data table containing simulated data under the natural course.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_nat_result">nat_result</code></td>
<td>
<p>Vector containing the mean outcome over all subjects at each time for natural course.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_comprisk">comprisk</code></td>
<td>
<p>Logical scalar indicating the presence of a competing event.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_comprisk2">comprisk2</code></td>
<td>
<p>Logical scalar indicating whether competing events are treated as censoring events.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_censor">censor</code></td>
<td>
<p>Logical scalar indicating the presence of a censoring variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_fitd2">fitD2</code></td>
<td>
<p>Model fit for the competing event variable if competing events are treated as censoring events.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_fitc">fitC</code></td>
<td>
<p>Model fit for the censoring variable.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_outcome_type">outcome_type</code></td>
<td>
<p>Character string specifying the &quot;type&quot; of the outcome. The possible &quot;types&quot; are: <code>"survival"</code>, <code>"continuous_eof"</code>, and <code>"binary_eof"</code>.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_obs_data">obs_data</code></td>
<td>
<p>Data table containing observed data.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_ipw_cutoff_quantile">ipw_cutoff_quantile</code></td>
<td>
<p>Percentile by which to truncate inverse probability weights.</p>
</td></tr>
<tr><td><code id="get_plot_info_+3A_ipw_cutoff_value">ipw_cutoff_value</code></td>
<td>
<p>Cutoff value by which to truncate inverse probability weights.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the following components:
</p>
<table>
<tr><td><code>obs_results</code></td>
<td>
<p>A list of the mean observed values at each time point for covariates and - if the outcome is of type <code>"survival"</code> - the risk and survival.</p>
</td></tr>
<tr><td><code>dt_cov_plot</code></td>
<td>
<p>A list of data tables The data tables contain the observed and simulated mean values of the covariates under each time point.</p>
</td></tr>
<tr><td><code>dt_obs_plot</code></td>
<td>
<p>For outcomes of type <code>"survival"</code>, a list of data tables. The data tables contain the observed and simulated risks and survival under each time point. For other outcomes, a value of <code>NA</code> is given.</p>
</td></tr>
</table>

<hr>
<h2 id='gformula'>Estimation of Survival Outcome, Continuous End-of-Follow-Up Outcome, or Binary End-of-Follow-Up Outcome Under the Parametric G-Formula</h2><span id='topic+gformula'></span>

<h3>Description</h3>

<p>Based on an observed data set, this function estimates the risk over time (for survival outcomes),
outcome mean at end-of-follow-up (for continuous end-of-follow-up outcomes), or outcome probability at
end-of-follow-up (for binary end-of-follow-up outcomes) under multiple user-specified interventions using
the parametric g-formula. See McGrath et al. (2020) for further details concerning the application and
implementation of the parametric g-formula.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gformula(
  obs_data,
  id,
  time_points = NULL,
  time_name,
  covnames,
  covtypes,
  covparams,
  covfits_custom = NA,
  covpredict_custom = NA,
  histvars = NULL,
  histories = NA,
  basecovs = NA,
  outcome_name,
  outcome_type,
  ymodel,
  compevent_name = NULL,
  compevent_model = NA,
  compevent_cens = FALSE,
  censor_name = NULL,
  censor_model = NA,
  intvars = NULL,
  interventions = NULL,
  int_times = NULL,
  int_descript = NULL,
  ref_int = 0,
  intcomp = NA,
  visitprocess = NA,
  restrictions = NA,
  yrestrictions = NA,
  compevent_restrictions = NA,
  baselags = FALSE,
  nsimul = NA,
  sim_data_b = FALSE,
  seed,
  nsamples = 0,
  parallel = FALSE,
  ncores = NA,
  ci_method = "percentile",
  threads,
  model_fits = FALSE,
  boot_diag = FALSE,
  show_progress = TRUE,
  ipw_cutoff_quantile = NULL,
  ipw_cutoff_value = NULL,
  int_visit_type = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gformula_+3A_obs_data">obs_data</code></td>
<td>
<p>Data table containing the observed data.</p>
</td></tr>
<tr><td><code id="gformula_+3A_id">id</code></td>
<td>
<p>Character string specifying the name of the ID variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_time_points">time_points</code></td>
<td>
<p>Number of time points to simulate. By default, this argument is set equal to the maximum
number of records that <code>obs_data</code> contains for any individual plus 1.</p>
</td></tr>
<tr><td><code id="gformula_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_covnames">covnames</code></td>
<td>
<p>Vector of character strings specifying the names of the time-varying covariates in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_covtypes">covtypes</code></td>
<td>
<p>Vector of character strings specifying the &quot;type&quot; of each time-varying covariate included in <code>covnames</code>. The possible &quot;types&quot; are: <code>"binary"</code>, <code>"normal"</code>, <code>"categorical"</code>, <code>"bounded normal"</code>, <code>"zero-inflated normal"</code>, <code>"truncated normal"</code>, <code>"absorbing"</code>, <code>"categorical time"</code>, and <code>"custom"</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_covparams">covparams</code></td>
<td>
<p>List of vectors, where each vector contains information for
one parameter used in the modeling of the time-varying covariates (e.g.,
model statement, family, link function, etc.). Each vector
must be the same length as <code>covnames</code> and in the same order.
If a parameter is not required for a certain covariate, it
should be set to <code>NA</code> at that index.</p>
</td></tr>
<tr><td><code id="gformula_+3A_covfits_custom">covfits_custom</code></td>
<td>
<p>Vector containing custom fit functions for time-varying covariates that
do not fall within the pre-defined covariate types. It should be in
the same order <code>covnames</code>. If a custom fit function is not
required for a particular covariate (e.g., if the first
covariate is of type <code>"binary"</code> but the second is of type <code>"custom"</code>), then that
index should be set to <code>NA</code>. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_covpredict_custom">covpredict_custom</code></td>
<td>
<p>Vector containing custom prediction functions for time-varying
covariates that do not fall within the pre-defined covariate types.
It should be in the same order as <code>covnames</code>. If a custom
prediction function is not required for a particular
covariate, then that index should be set to <code>NA</code>. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_histvars">histvars</code></td>
<td>
<p>List of vectors. The kth vector specifies the names of the variables for which the kth history function
in <code>histories</code> is to be applied.</p>
</td></tr>
<tr><td><code id="gformula_+3A_histories">histories</code></td>
<td>
<p>Vector of history functions to apply to the variables specified in <code>histvars</code>. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_basecovs">basecovs</code></td>
<td>
<p>Vector of character strings specifying the names of baseline covariates in <code>obs_data</code>. These covariates are not simulated using a model but rather carry their value over all time points from the first time point of <code>obs_data</code>. These covariates should not be included in <code>covnames</code>. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_outcome_name">outcome_name</code></td>
<td>
<p>Character string specifying the name of the outcome variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_outcome_type">outcome_type</code></td>
<td>
<p>Character string specifying the &quot;type&quot; of outcome. The possible &quot;types&quot; are: <code>"survival"</code>, <code>"continuous_eof"</code>, and <code>"binary_eof"</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_ymodel">ymodel</code></td>
<td>
<p>Model statement for the outcome variable.</p>
</td></tr>
<tr><td><code id="gformula_+3A_compevent_name">compevent_name</code></td>
<td>
<p>Character string specifying the name of the competing event variable in <code>obs_data</code>. Only applicable for survival outcomes.</p>
</td></tr>
<tr><td><code id="gformula_+3A_compevent_model">compevent_model</code></td>
<td>
<p>Model statement for the competing event variable. The default is <code>NA</code>. Only applicable for survival outcomes.</p>
</td></tr>
<tr><td><code id="gformula_+3A_compevent_cens">compevent_cens</code></td>
<td>
<p>Logical scalar indicating whether to treat competing events as censoring events.
This argument is only applicable for survival outcomes and when a competing even model is supplied (i.e., <code>compevent_name</code> and <code>compevent_model</code> are specified).
If this argument is set to <code>TRUE</code>, the competing event model will only be used to construct inverse probability weights to estimate the natural course means / risk from the observed data.
If this argument is set to <code>FALSE</code>, the competing event model will be used in the parametric g-formula estimates of the risk and will not be used to construct inverse probability weights.
See &quot;Details&quot;. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_censor_name">censor_name</code></td>
<td>
<p>Character string specifying the name of the censoring variable in <code>obs_data</code>. Only applicable when using inverse probability weights to estimate the natural course means / risk from the observed data. See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code id="gformula_+3A_censor_model">censor_model</code></td>
<td>
<p>Model statement for the censoring variable. Only applicable when using inverse probability weights to estimate the natural course means / risk from the observed data. See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code id="gformula_+3A_intvars">intvars</code></td>
<td>
<p>List, whose elements are vectors of character strings. The kth vector in <code>intvars</code> specifies the name(s) of the variable(s) to be intervened
on in each round of the simulation under the kth intervention in <code>interventions</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_interventions">interventions</code></td>
<td>
<p>List, whose elements are lists of vectors. Each list in <code>interventions</code> specifies a unique intervention on the relevant variable(s) in <code>intvars</code>. Each vector contains a function
implementing a particular intervention on a single variable, optionally
followed by one or more &quot;intervention values&quot; (i.e.,
integers used to specify the treatment regime).</p>
</td></tr>
<tr><td><code id="gformula_+3A_int_times">int_times</code></td>
<td>
<p>List, whose elements are lists of vectors. The kth list in <code>int_times</code> corresponds to the kth intervention in <code>interventions</code>. Each vector specifies the time points in which the relevant intervention is applied on the corresponding variable in <code>intvars</code>.
When an intervention is not applied, the simulated natural course value is used. By default, this argument is set so that all interventions are applied in all time points.</p>
</td></tr>
<tr><td><code id="gformula_+3A_int_descript">int_descript</code></td>
<td>
<p>Vector of character strings, each describing an intervention. It must
be in same order as the entries in <code>interventions</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_ref_int">ref_int</code></td>
<td>
<p>Integer denoting the intervention to be used as the
reference for calculating the risk ratio and risk difference. 0 denotes the
natural course, while subsequent integers denote user-specified
interventions in the order that they are
named in <code>interventions</code>. The default is 0.</p>
</td></tr>
<tr><td><code id="gformula_+3A_intcomp">intcomp</code></td>
<td>
<p>List of two numbers indicating a pair of interventions to be compared by a hazard ratio.
The default is <code>NA</code>, resulting in no hazard ratio calculation.</p>
</td></tr>
<tr><td><code id="gformula_+3A_visitprocess">visitprocess</code></td>
<td>
<p>List of vectors. Each vector contains as its first entry
the covariate name of a visit process; its second entry
the name of a covariate whose modeling depends on the
visit process; and its third entry the maximum number
of consecutive visits that can be missed before an
individual is censored. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_restrictions">restrictions</code></td>
<td>
<p>List of vectors. Each vector contains as its first entry a covariate for which
<em>a priori</em> knowledge of its distribution is available; its second entry a condition
under which no knowledge of its distribution is available and that must be <code>TRUE</code>
for the distribution of that covariate given that condition to be estimated via a parametric
model or other fitting procedure; its third entry a function for estimating the distribution
of that covariate given the condition in the second entry is false such that <em>a priori</em> knowledge
of the covariate distribution is available; and its fourth entry a value used by the function in the
third entry. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_yrestrictions">yrestrictions</code></td>
<td>
<p>List of vectors. Each vector containins as its first entry
a condition and its second entry an integer. When the
condition is <code>TRUE</code>, the outcome variable is simulated
according to the fitted model; when the condition is <code>FALSE</code>,
the outcome variable takes on the value in the second entry.
The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_compevent_restrictions">compevent_restrictions</code></td>
<td>
<p>List of vectors. Each vector containins as its first entry
a condition and its second entry an integer. When the
condition is <code>TRUE</code>, the competing event variable is simulated
according to the fitted model; when the condition is <code>FALSE</code>,
the competing event variable takes on the value in the
second entry. The default is <code>NA</code>. Only applicable for survival outcomes.</p>
</td></tr>
<tr><td><code id="gformula_+3A_baselags">baselags</code></td>
<td>
<p>Logical scalar for specifying the convention used for lagi and lag_cumavgi terms in the model statements when pre-baseline times are not
included in <code>obs_data</code> and when the current time index, <code class="reqn">t</code>, is such that <code class="reqn">t &lt; i</code>. If this argument is set to <code>FALSE</code>, the value
of all lagi and lag_cumavgi terms in this context are set to 0 (for non-categorical covariates) or the reference
level (for categorical covariates). If this argument is set to <code>TRUE</code>, the value of lagi and lag_cumavgi terms
are set to their values at time 0. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_nsimul">nsimul</code></td>
<td>
<p>Number of subjects for whom to simulate data. By default, this argument is set
equal to the number of subjects in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_sim_data_b">sim_data_b</code></td>
<td>
<p>Logical scalar indicating whether to return the simulated data set. If bootstrap samples are used (i.e., <code>nsamples</code> is set to a value greater than 0), this argument must be set to <code>FALSE</code>. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_seed">seed</code></td>
<td>
<p>Starting seed for simulations and bootstrapping.</p>
</td></tr>
<tr><td><code id="gformula_+3A_nsamples">nsamples</code></td>
<td>
<p>Integer specifying the number of bootstrap samples to generate.
The default is 0.</p>
</td></tr>
<tr><td><code id="gformula_+3A_parallel">parallel</code></td>
<td>
<p>Logical scalar indicating whether to parallelize simulations of
different interventions to multiple cores.</p>
</td></tr>
<tr><td><code id="gformula_+3A_ncores">ncores</code></td>
<td>
<p>Integer specifying the number of CPU cores to use in parallel
simulation. This argument is required when parallel is set to <code>TRUE</code>.
In many applications, users may wish to set this argument equal to <code>parallel::detectCores() - 1</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_ci_method">ci_method</code></td>
<td>
<p>Character string specifying the method for calculating the bootstrap 95% confidence intervals, if applicable. The options are <code>"percentile"</code> and <code>"normal"</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_threads">threads</code></td>
<td>
<p>Integer specifying the number of threads to be used in <code>data.table</code>. See <code><a href="data.table.html#topic+setDTthreads">setDTthreads</a></code> for further details.</p>
</td></tr>
<tr><td><code id="gformula_+3A_model_fits">model_fits</code></td>
<td>
<p>Logical scalar indicating whether to return the fitted models. Note that if this argument is set to <code>TRUE</code>, the output of this function may use a lot of memory. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_boot_diag">boot_diag</code></td>
<td>
<p>Logical scalar indicating whether to return the parametric g-formula estimates as well as the coefficients, standard errors, and variance-covariance matrices of the parameters of the fitted models in the bootstrap samples. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_show_progress">show_progress</code></td>
<td>
<p>Logical scalar indicating whether to print a progress bar for the number of bootstrap samples completed in the R console. This argument is only applicable when <code>parallel</code> is set to <code>FALSE</code> and bootstrap samples are used (i.e., <code>nsamples</code> is set to a value greater than 0). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="gformula_+3A_ipw_cutoff_quantile">ipw_cutoff_quantile</code></td>
<td>
<p>Percentile by which to truncate inverse probability weights. The default is <code>NULL</code> (i.e., no truncation). See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code id="gformula_+3A_ipw_cutoff_value">ipw_cutoff_value</code></td>
<td>
<p>Cutoff value by which to truncate inverse probability weights. The default is <code>NULL</code> (i.e., no truncation). See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code id="gformula_+3A_int_visit_type">int_visit_type</code></td>
<td>
<p>Vector of logicals. The kth element is a logical specifying whether to carry forward the intervened value (rather than the natural value) of the treatment variables(s) when performing a carry forward restriction type for the kth intervention in <code>interventions</code>.
When the kth element is set to <code>FALSE</code>, the natural value of the treatment variable(s) in the kth intervention in <code>interventions</code> will be carried forward.
By default, this argument is set so that the intervened value of the treatment variable(s) is carried forward for all interventions.</p>
</td></tr>
<tr><td><code id="gformula_+3A_...">...</code></td>
<td>
<p>Other arguments, which are passed to the functions in <code>covpredict_custom</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To assess model misspecification in the parametric g-formula, users can obtain inverse probability (IP) weighted estimates of the natural course risk and/or means of the time-varying covariates from the observed data.
See Chiu et al. (2023) for details.
In addition to the general requirements described in McGrath et al. (2020), the requirements for the input data set and the call to the gformula function for such analyses are described below.
</p>
<p>Users need to include a column in <code>obs_data</code> with a time-varying censoring variable.
Users need to indicate the name of the censoring variable and a model statement for the censoring variable with parameters <code>censor_name</code> and <code>censor_model</code>, respectively.
When competing events are present, users need to include a column in <code>obs_data</code> with a time-varying indicator of the competing event variable and need to indicate the name of the competing event variable and the corresponding model statement with parameters <code>compevent_name</code> and <code>compevent_model</code>, respectively.
Users need to indicate whether to treat competing events as censoring events with the <code>compevent_cens</code> parameter.
Finally, users can specify how to truncate IP weights with the <code>ipw_cutoff_quantile</code> or <code>ipw_cutoff_value</code> parameters.
</p>
<p>In addition to the package output described in McGrath et al. (2020), the output will display estimates of the &quot;cumulative percent intervened on&quot; and the &quot;average percent intervened on&quot;. When using a custom intervention function, users need to specify whether each individual at that time point is eligible to contribute person-time to the percent intervened on calculations. Specifically, this must be specified in the <code>eligible_pt</code> column of <code>newdf</code>. By default, <code>eligible_pt</code> is set to <code>TRUE</code> for each individual at each time point in custom interventions.
</p>


<h3>Value</h3>

<p>An object of class <code>gformula_survival</code>. The object is a list with the following components:
</p>
<table>
<tr><td><code>result</code></td>
<td>
<p>Results table. For survival outcomes, this contains the estimated risk, risk difference, and risk ratio for all interventions (inculding the natural course) at each time point. For continuous end-of-follow-up outcomes, this contains estimated mean outcome, mean difference, and mean ratio for all interventions (inculding natural course) at the last time point. For binary end-of-follow-up outcomes, this contains the estimated outcome probability, probability difference, and probability ratio for all interventions (inculding natural course) at the last time point. For all outcome types, this also contains the &quot;cumulative percent intervened on&quot; and the &quot;average percent intervened on&quot;. If bootstrapping was used, the results table includes the bootstrap risk / mean / probability difference, ratio, standard error, and 95% confidence interval.</p>
</td></tr>
<tr><td><code>coeffs</code></td>
<td>
<p>A list of the coefficients of the fitted models.</p>
</td></tr>
<tr><td><code>stderrs</code></td>
<td>
<p>A list of the standard errors of the coefficients of the fitted models.</p>
</td></tr>
<tr><td><code>vcovs</code></td>
<td>
<p>A list of the variance-covariance matrices of the parameters of the fitted models.</p>
</td></tr>
<tr><td><code>rmses</code></td>
<td>
<p>A list of root mean square error (RMSE) values of the fitted models.</p>
</td></tr>
<tr><td><code>hazardratio_val</code></td>
<td>
<p>Hazard ratio between two interventions (if applicable).</p>
</td></tr>
<tr><td><code>fits</code></td>
<td>
<p>A list of the fitted models for the time-varying covariates, outcome, and competing event (if applicable). If <code>model_fits</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>sim_data</code></td>
<td>
<p>A list of data tables of the simulated data. Each element in the list corresponds to one of the interventions. If the argument <code>sim_data_b</code> is set to <code>FALSE</code>, a value of <code>NA</code> is given.</p>
</td></tr>
<tr><td><code>IP_weights</code></td>
<td>
<p>A numeric vector specifying the inverse probability weights. See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code>bootests</code></td>
<td>
<p>A data.table containing the bootstrap replicates of the parametric g-formula estimates. If <code>boot_diag</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>bootcoeffs</code></td>
<td>
<p>A list, where the kth element is a list containing the coefficients of the fitted models corresponding to the kth bootstrap sample. If <code>boot_diag</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>bootstderrs</code></td>
<td>
<p>A list, where the kth element is a list containing the standard errors of the coefficients of the fitted models corresponding to the kth bootstrap sample. If <code>boot_diag</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>bootvcovs</code></td>
<td>
<p>A list, where the kth element is a list containing the variance-covariance matrices of the parameters of the fitted models corresponding to the kth bootstrap sample. If <code>boot_diag</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>...</code></td>
<td>
<p>Some additional elements.</p>
</td></tr>
</table>
<p>The results for the g-formula simulation are printed with the <code><a href="#topic+print.gformula_survival">print.gformula_survival</a></code>, <code><a href="#topic+print.gformula_continuous_eof">print.gformula_continuous_eof</a></code>, and <code><a href="#topic+print.gformula_binary_eof">print.gformula_binary_eof</a></code> functions. To generate graphs comparing the mean estimated covariate values and risks over time and mean observed covariate values and risks over time, use the <code><a href="#topic+plot.gformula_survival">plot.gformula_survival</a></code>, <code><a href="#topic+plot.gformula_continuous_eof">plot.gformula_continuous_eof</a></code>, and <code><a href="#topic+plot.gformula_binary_eof">plot.gformula_binary_eof</a></code> functions.
</p>


<h3>References</h3>

<p>Chiu YH, Wen L, McGrath S, Logan R, Dahabreh IJ, Hernán MA. Evaluating model specification when using the parametric g-formula in the presence of censoring. American Journal of Epidemiology. 2023;192:1887–1895.
</p>
<p>McGrath S, Lin V, Zhang Z, Petito LC, Logan RW, Hernán MA, and JG Young. gfoRmula: An R package for estimating the effects of sustained treatment strategies via the parametric g-formula. Patterns. 2020;1:100008.
</p>
<p>Robins JM. A new approach to causal inference in mortality studies with a sustained exposure period: application to the healthy worker survivor effect. Mathematical Modelling. 1986;7:1393–1512. [Errata (1987) in Computers and Mathematics with Applications 14, 917.-921. Addendum (1987) in Computers and Mathematics with Applications 14, 923-.945. Errata (1987) to addendum in Computers and Mathematics with Applications 18, 477.].
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Estimating the effect of static treatment strategies on risk of a
## failure event

id &lt;- 'id'
time_points &lt;- 7
time_name &lt;- 't0'
covnames &lt;- c('L1', 'L2', 'A')
outcome_name &lt;- 'Y'
outcome_type &lt;- 'survival'
covtypes &lt;- c('binary', 'bounded normal', 'binary')
histories &lt;- c(lagged, lagavg)
histvars &lt;- list(c('A', 'L1', 'L2'), c('L1', 'L2'))
covparams &lt;- list(covmodels = c(L1 ~ lag1_A + lag_cumavg1_L1 + lag_cumavg1_L2 +
                                  L3 + t0,
                                L2 ~ lag1_A + L1 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0,
                                A ~ lag1_A + L1 + L2 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0))
ymodel &lt;- Y ~ A + L1 + L2 + L3 + lag1_A + lag1_L1 + lag1_L2 + t0
intvars &lt;- list('A', 'A')
interventions &lt;- list(list(c(static, rep(0, time_points))),
                      list(c(static, rep(1, time_points))))
int_descript &lt;- c('Never treat', 'Always treat')
nsimul &lt;- 10000

gform_basic &lt;- gformula(obs_data = basicdata_nocomp, id = id,
                        time_points = time_points,
                        time_name = time_name, covnames = covnames,
                        outcome_name = outcome_name,
                        outcome_type = outcome_type, covtypes = covtypes,
                        covparams = covparams, ymodel = ymodel,
                        intvars = intvars,
                        interventions = interventions,
                        int_descript = int_descript,
                        histories = histories, histvars = histvars,
                        basecovs = c('L3'), nsimul = nsimul,
                        seed = 1234)
gform_basic



## Estimating the effect of treatment strategies on risk of a failure event
## when competing events exist

id &lt;- 'id'
time_points &lt;- 7
time_name &lt;- 't0'
covnames &lt;- c('L1', 'L2', 'A')
outcome_name &lt;- 'Y'
compevent_name &lt;- 'D'
outcome_type &lt;- 'survival'
covtypes &lt;- c('binary', 'bounded normal', 'binary')
histories &lt;- c(lagged, lagavg)
histvars &lt;- list(c('A', 'L1', 'L2'), c('L1', 'L2'))
covparams &lt;- list(covlink = c('logit', 'identity', 'logit'),
                  covmodels = c(L1 ~ lag1_A + lag_cumavg1_L1 + lag_cumavg1_L2 +
                                  L3 + as.factor(t0),
                                L2 ~ lag1_A + L1 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + as.factor(t0),
                                A ~ lag1_A + L1 + L2 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + as.factor(t0)))
ymodel &lt;- Y ~ A + L1 + L2 + lag1_A + lag1_L1 + lag1_L2 + L3 + as.factor(t0)
compevent_model &lt;- D ~ A + L1 + L2 + lag1_A + lag1_L1 + lag1_L2 + L3 + as.factor(t0)
intvars &lt;- list('A', 'A')
interventions &lt;- list(list(c(static, rep(0, time_points))),
                      list(c(static, rep(1, time_points))))
int_descript &lt;- c('Never treat', 'Always treat')
nsimul &lt;- 10000

gform_basic &lt;- gformula(obs_data = basicdata, id = id,
                        time_points = time_points,
                        time_name = time_name, covnames = covnames,
                        outcome_name = outcome_name,
                        outcome_type = outcome_type,
                        compevent_name = compevent_name,
                        covtypes = covtypes,
                        covparams = covparams, ymodel = ymodel,
                        compevent_model = compevent_model,
                        intvars = intvars, interventions = interventions,
                        int_descript = int_descript,
                        histories = histories, histvars = histvars,
                        basecovs = c('L3'), nsimul = nsimul,
                        seed = 1234)
gform_basic



## Estimating the effect of treatment strategies on the mean of a continuous
## end of follow-up outcome

library('Hmisc')
id &lt;- 'id'
time_name &lt;- 't0'
covnames &lt;- c('L1', 'L2', 'A')
outcome_name &lt;- 'Y'
outcome_type &lt;- 'continuous_eof'
covtypes &lt;- c('categorical', 'normal', 'binary')
histories &lt;- c(lagged)
histvars &lt;- list(c('A', 'L1', 'L2'))
covparams &lt;- list(covmodels = c(L1 ~ lag1_A + lag1_L1 + L3 + t0 +
                                  rcspline.eval(lag1_L2, knots = c(-1, 0, 1)),
                                L2 ~ lag1_A + L1 + lag1_L1 + lag1_L2 + L3 + t0,
                                A ~ lag1_A + L1 + L2 + lag1_L1 + lag1_L2 + L3 + t0))
ymodel &lt;- Y ~ A + L1 + L2 + lag1_A + lag1_L1 + lag1_L2 + L3
intvars &lt;- list('A', 'A')
interventions &lt;- list(list(c(static, rep(0, 7))),
                      list(c(static, rep(1, 7))))
int_descript &lt;- c('Never treat', 'Always treat')
nsimul &lt;- 10000

gform_cont_eof &lt;- gformula(obs_data = continuous_eofdata,
                           id = id, time_name = time_name,
                           covnames = covnames, outcome_name = outcome_name,
                           outcome_type = outcome_type, covtypes = covtypes,
                           covparams = covparams, ymodel = ymodel,
                           intvars = intvars, interventions = interventions,
                           int_descript = int_descript,
                           histories = histories, histvars = histvars,
                           basecovs = c("L3"), nsimul = nsimul, seed = 1234)
gform_cont_eof



## Estimating the effect of threshold interventions on the mean of a binary
## end of follow-up outcome

outcome_type &lt;- 'binary_eof'
id &lt;- 'id_num'
time_name &lt;- 'time'
covnames &lt;- c('cov1', 'cov2', 'treat')
outcome_name &lt;- 'outcome'
histories &lt;- c(lagged, cumavg)
histvars &lt;- list(c('treat', 'cov1', 'cov2'), c('cov1', 'cov2'))
covtypes &lt;- c('binary', 'zero-inflated normal', 'normal')
covparams &lt;- list(covmodels = c(cov1 ~ lag1_treat + lag1_cov1 + lag1_cov2 +
                                  cov3 + time,
                                cov2 ~ lag1_treat + cov1 + lag1_cov1 +
                                  lag1_cov2 + cov3 + time,
                                treat ~ lag1_treat + cumavg_cov1 +
                                  cumavg_cov2 + cov3 + time))
ymodel &lt;- outcome ~  treat + cov1 + cov2 + lag1_cov1 + lag1_cov2 + cov3
intvars &lt;- list('treat', 'treat')
interventions &lt;- list(list(c(static, rep(0, 7))),
                      list(c(threshold, 1, Inf)))
int_descript &lt;- c('Never treat', 'Threshold - lower bound 1')
nsimul &lt;- 10000
ncores &lt;- 2

gform_bin_eof &lt;- gformula(obs_data = binary_eofdata,
                          outcome_type = outcome_type, id = id,
                          time_name = time_name, covnames = covnames,
                          outcome_name = outcome_name, covtypes = covtypes,
                          covparams = covparams, ymodel = ymodel,
                          intvars = intvars, interventions = interventions,
                          int_descript = int_descript, histories = histories,
                          histvars = histvars, basecovs = c("cov3"),
                          seed = 1234, parallel = TRUE, nsamples = 5,
                          nsimul = nsimul, ncores = ncores)
gform_bin_eof


## Using IP weighting to estimate natural course risk
## Only the natural course intervention is included for simplicity

covnames &lt;- c('L', 'A')
histories &lt;- c(lagged)
histvars &lt;- list(c('A', 'L'))
ymodel &lt;- Y ~ L + A
covtypes &lt;- c('binary', 'normal')
covparams &lt;- list(covmodels = c(L ~ lag1_L + lag1_A,
                                A ~ lag1_L + L + lag1_A))
censor_name &lt;- 'C'
censor_model &lt;- C ~ L
res_censor &lt;- gformula(obs_data = censor_data, id = 'id',
                       time_name = 't0', covnames = covnames,
                       outcome_name = 'Y', outcome_type = 'survival',
                       censor_name = censor_name, censor_model = censor_model,
                       covtypes = covtypes,
                       covparams = covparams, ymodel = ymodel,
                       intvars = NULL, interventions = NULL, int_descript = NULL,
                       histories = histories, histvars = histvars,
                       seed = 1234)
plot(res_censor)


</code></pre>

<hr>
<h2 id='gformula_binary_eof'>Estimation of Binary End-of-Follow-Up Outcome Under the Parametric G-Formula</h2><span id='topic+gformula_binary_eof'></span>

<h3>Description</h3>

<p>Based on an observed data set, this internal function estimates the outcome probability at
end-of-follow-up under multiple user-specified interventions using the parametric g-formula. See McGrath et al. (2020) for
further details concerning the application and implementation of the parametric g-formula.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gformula_binary_eof(
  obs_data,
  id,
  time_name,
  covnames,
  covtypes,
  covparams,
  covfits_custom = NA,
  covpredict_custom = NA,
  histvars = NULL,
  histories = NA,
  basecovs = NA,
  censor_name = NULL,
  censor_model = NA,
  outcome_name,
  ymodel,
  intvars = NULL,
  interventions = NULL,
  int_times = NULL,
  int_descript = NULL,
  ref_int = 0,
  visitprocess = NA,
  restrictions = NA,
  yrestrictions = NA,
  baselags = FALSE,
  nsimul = NA,
  sim_data_b = FALSE,
  seed,
  nsamples = 0,
  parallel = FALSE,
  ncores = NA,
  ci_method = "percentile",
  threads,
  model_fits = FALSE,
  boot_diag = FALSE,
  show_progress = TRUE,
  ipw_cutoff_quantile = NULL,
  ipw_cutoff_value = NULL,
  int_visit_type = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gformula_binary_eof_+3A_obs_data">obs_data</code></td>
<td>
<p>Data table containing the observed data.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_id">id</code></td>
<td>
<p>Character string specifying the name of the ID variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_covnames">covnames</code></td>
<td>
<p>Vector of character strings specifying the names of the time-varying covariates in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_covtypes">covtypes</code></td>
<td>
<p>Vector of character strings specifying the &quot;type&quot; of each time-varying covariate included in <code>covnames</code>. The possible &quot;types&quot; are: <code>"binary"</code>, <code>"normal"</code>, <code>"categorical"</code>, <code>"bounded normal"</code>, <code>"zero-inflated normal"</code>, <code>"truncated normal"</code>, <code>"absorbing"</code>, <code>"categorical time"</code>, and <code>"custom"</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_covparams">covparams</code></td>
<td>
<p>List of vectors, where each vector contains information for
one parameter used in the modeling of the time-varying covariates (e.g.,
model statement, family, link function, etc.). Each vector
must be the same length as <code>covnames</code> and in the same order.
If a parameter is not required for a certain covariate, it
should be set to <code>NA</code> at that index.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_covfits_custom">covfits_custom</code></td>
<td>
<p>Vector containing custom fit functions for time-varying covariates that
do not fall within the pre-defined covariate types. It should be in
the same order <code>covnames</code>. If a custom fit function is not
required for a particular covariate (e.g., if the first
covariate is of type <code>"binary"</code> but the second is of type <code>"custom"</code>), then that
index should be set to <code>NA</code>. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_covpredict_custom">covpredict_custom</code></td>
<td>
<p>Vector containing custom prediction functions for time-varying
covariates that do not fall within the pre-defined covariate types.
It should be in the same order as <code>covnames</code>. If a custom
prediction function is not required for a particular
covariate, then that index should be set to <code>NA</code>. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_histvars">histvars</code></td>
<td>
<p>List of vectors. The kth vector specifies the names of the variables for which the kth history function
in <code>histories</code> is to be applied.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_histories">histories</code></td>
<td>
<p>Vector of history functions to apply to the variables specified in <code>histvars</code>. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_basecovs">basecovs</code></td>
<td>
<p>Vector of character strings specifying the names of baseline covariates in <code>obs_data</code>. These covariates are not simulated using a model but rather carry their value over all time points from the first time point of <code>obs_data</code>. These covariates should not be included in <code>covnames</code>. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_censor_name">censor_name</code></td>
<td>
<p>Character string specifying the name of the censoring variable in <code>obs_data</code>. Only applicable when using inverse probability weights to estimate the natural course means / risk from the observed data. See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_censor_model">censor_model</code></td>
<td>
<p>Model statement for the censoring variable. Only applicable when using inverse probability weights to estimate the natural course means / risk from the observed data. See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_outcome_name">outcome_name</code></td>
<td>
<p>Character string specifying the name of the outcome variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_ymodel">ymodel</code></td>
<td>
<p>Model statement for the outcome variable.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_intvars">intvars</code></td>
<td>
<p>List, whose elements are vectors of character strings. The kth vector in <code>intvars</code> specifies the name(s) of the variable(s) to be intervened
on in each round of the simulation under the kth intervention in <code>interventions</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_interventions">interventions</code></td>
<td>
<p>List, whose elements are lists of vectors. Each list in <code>interventions</code> specifies a unique intervention on the relevant variable(s) in <code>intvars</code>. Each vector contains a function
implementing a particular intervention on a single variable, optionally
followed by one or more &quot;intervention values&quot; (i.e.,
integers used to specify the treatment regime).</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_int_times">int_times</code></td>
<td>
<p>List, whose elements are lists of vectors. The kth list in <code>int_times</code> corresponds to the kth intervention in <code>interventions</code>. Each vector specifies the time points in which the relevant intervention is applied on the corresponding variable in <code>intvars</code>.
When an intervention is not applied, the simulated natural course value is used. By default, this argument is set so that all interventions are applied in all time points.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_int_descript">int_descript</code></td>
<td>
<p>Vector of character strings, each describing an intervention. It must
be in same order as the entries in <code>interventions</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_ref_int">ref_int</code></td>
<td>
<p>Integer denoting the intervention to be used as the
reference for calculating the end-of-follow-up mean ratio and mean difference. 0 denotes the
natural course, while subsequent integers denote user-specified
interventions in the order that they are
named in <code>interventions</code>. The default is 0.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_visitprocess">visitprocess</code></td>
<td>
<p>List of vectors. Each vector contains as its first entry
the covariate name of a visit process; its second entry
the name of a covariate whose modeling depends on the
visit process; and its third entry the maximum number
of consecutive visits that can be missed before an
individual is censored. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_restrictions">restrictions</code></td>
<td>
<p>List of vectors. Each vector contains as its first entry a covariate for which
<em>a priori</em> knowledge of its distribution is available; its second entry a condition
under which no knowledge of its distribution is available and that must be <code>TRUE</code>
for the distribution of that covariate given that condition to be estimated via a parametric
model or other fitting procedure; its third entry a function for estimating the distribution
of that covariate given the condition in the second entry is false such that <em>a priori</em> knowledge
of the covariate distribution is available; and its fourth entry a value used by the function in the
third entry. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_yrestrictions">yrestrictions</code></td>
<td>
<p>List of vectors. Each vector containins as its first entry
a condition and its second entry an integer. When the
condition is <code>TRUE</code>, the outcome variable is simulated
according to the fitted model; when the condition is <code>FALSE</code>,
the outcome variable takes on the value in the second entry.
The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_baselags">baselags</code></td>
<td>
<p>Logical scalar for specifying the convention used for lagi and lag_cumavgi terms in the model statements when pre-baseline times are not
included in <code>obs_data</code> and when the current time index, <code class="reqn">t</code>, is such that <code class="reqn">t &lt; i</code>. If this argument is set to <code>FALSE</code>, the value
of all lagi and lag_cumavgi terms in this context are set to 0 (for non-categorical covariates) or the reference
level (for categorical covariates). If this argument is set to <code>TRUE</code>, the value of lagi and lag_cumavgi terms
are set to their values at time 0. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_nsimul">nsimul</code></td>
<td>
<p>Number of subjects for whom to simulate data. By default, this argument is set
equal to the number of subjects in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_sim_data_b">sim_data_b</code></td>
<td>
<p>Logical scalar indicating whether to return the simulated data set. If bootstrap samples are used (i.e., <code>nsamples</code> is set to a value greater than 0), this argument must be set to <code>FALSE</code>. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_seed">seed</code></td>
<td>
<p>Starting seed for simulations and bootstrapping.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_nsamples">nsamples</code></td>
<td>
<p>Integer specifying the number of bootstrap samples to generate.
The default is 0.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_parallel">parallel</code></td>
<td>
<p>Logical scalar indicating whether to parallelize simulations of
different interventions to multiple cores.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_ncores">ncores</code></td>
<td>
<p>Integer specifying the number of CPU cores to use in parallel
simulation. This argument is required when parallel is set to <code>TRUE</code>.
In many applications, users may wish to set this argument equal to <code>parallel::detectCores() - 1</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_ci_method">ci_method</code></td>
<td>
<p>Character string specifying the method for calculating the bootstrap 95% confidence intervals, if applicable. The options are <code>"percentile"</code> and <code>"normal"</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_threads">threads</code></td>
<td>
<p>Integer specifying the number of threads to be used in <code>data.table</code>. See <code><a href="data.table.html#topic+setDTthreads">setDTthreads</a></code> for further details.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_model_fits">model_fits</code></td>
<td>
<p>Logical scalar indicating whether to return the fitted models. Note that if this argument is set to <code>TRUE</code>, the output of this function may use a lot of memory. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_boot_diag">boot_diag</code></td>
<td>
<p>Logical scalar indicating whether to return the parametric g-formula estimates as well as the coefficients, standard errors, and variance-covariance matrices of the parameters of the fitted models in the bootstrap samples. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_show_progress">show_progress</code></td>
<td>
<p>Logical scalar indicating whether to print a progress bar for the number of bootstrap samples completed in the R console. This argument is only applicable when <code>parallel</code> is set to <code>FALSE</code> and bootstrap samples are used (i.e., <code>nsamples</code> is set to a value greater than 0). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_ipw_cutoff_quantile">ipw_cutoff_quantile</code></td>
<td>
<p>Percentile by which to truncate inverse probability weights. The default is <code>NULL</code> (i.e., no truncation). See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_ipw_cutoff_value">ipw_cutoff_value</code></td>
<td>
<p>Cutoff value by which to truncate inverse probability weights. The default is <code>NULL</code> (i.e., no truncation). See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_int_visit_type">int_visit_type</code></td>
<td>
<p>Vector of logicals. The kth element is a logical specifying whether to carry forward the intervened value (rather than the natural value) of the treatment variables(s) when performing a carry forward restriction type for the kth intervention in <code>interventions</code>.
When the kth element is set to <code>FALSE</code>, the natural value of the treatment variable(s) in the kth intervention in <code>interventions</code> will be carried forward.
By default, this argument is set so that the intervened value of the treatment variable(s) is carried forward for all interventions.</p>
</td></tr>
<tr><td><code id="gformula_binary_eof_+3A_...">...</code></td>
<td>
<p>Other arguments, which are passed to the functions in <code>covpredict_custom</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To assess model misspecification in the parametric g-formula, users can obtain inverse probability (IP) weighted estimates of the natural course means of the time-varying covariates from the observed data.
See Chiu et al. (2023) for details.
In addition to the general requirements described in McGrath et al. (2020), the requirements for the input data set and the call to the gformula function for such analyses are described below.
</p>
<p>Users need to include a column in <code>obs_data</code> with a time-varying censoring variable.
Users need to indicate the name of the censoring variable and a model statement for the censoring variable with parameters <code>censor_name</code> and <code>censor_model</code>, respectively.
Finally, users can specify how to truncate IP weights with the <code>ipw_cutoff_quantile</code> or <code>ipw_cutoff_value</code> parameters.
</p>
<p>In addition to the package output described in McGrath et al. (2020), the output will display estimates of the &quot;cumulative percent intervened on&quot; and the &quot;average percent intervened on&quot;. When using a custom intervention function, users need to specify whether each individual at that time point is eligible to contribute person-time to the percent intervened on calculations. Specifically, this must be specified in the <code>eligible_pt</code> column of <code>newdf</code>. By default, <code>eligible_pt</code> is set to <code>TRUE</code> for each individual at each time point in custom interventions.
</p>


<h3>Value</h3>

<p>An object of class <code>gformula_binary_eof</code>. The object is a list with the following components:
</p>
<table>
<tr><td><code>result</code></td>
<td>
<p>Results table containing the estimated outcome probability for all interventions (inculding natural course) at the last time point as well as the &quot;cumulative percent intervened on&quot; and the &quot;average percent intervened on&quot;. If bootstrapping was used, the results table includes the bootstrap end-of-follow-up mean ratio, standard error, and 95% confidence interval.</p>
</td></tr>
<tr><td><code>coeffs</code></td>
<td>
<p>A list of the coefficients of the fitted models.</p>
</td></tr>
<tr><td><code>stderrs</code></td>
<td>
<p>A list of the standard errors of the coefficients of the fitted models.</p>
</td></tr>
<tr><td><code>vcovs</code></td>
<td>
<p>A list of the variance-covariance matrices of the parameters of the fitted models.</p>
</td></tr>
<tr><td><code>rmses</code></td>
<td>
<p>A list of root mean square error (RMSE) values of the fitted models.</p>
</td></tr>
<tr><td><code>fits</code></td>
<td>
<p>A list of the fitted models for the time-varying covariates and outcome. If <code>model_fits</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>sim_data</code></td>
<td>
<p>A list of data tables of the simulated data. Each element in the list corresponds to one of the interventions. If the argument <code>sim_data_b</code> is set to <code>FALSE</code>, a value of <code>NA</code> is given.</p>
</td></tr>
<tr><td><code>IP_weights</code></td>
<td>
<p>A numeric vector specifying the inverse probability weights. See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code>bootests</code></td>
<td>
<p>A data.table containing the bootstrap replicates of the parametric g-formula estimates. If <code>boot_diag</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>bootcoeffs</code></td>
<td>
<p>A list, where the kth element is a list containing the coefficients of the fitted models corresponding to the kth bootstrap sample. If <code>boot_diag</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>bootstderrs</code></td>
<td>
<p>A list, where the kth element is a list containing the standard errors of the coefficients of the fitted models corresponding to the kth bootstrap sample. If <code>boot_diag</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>bootvcovs</code></td>
<td>
<p>A list, where the kth element is a list containing the variance-covariance matrices of the parameters of the fitted models corresponding to the kth bootstrap sample. If <code>boot_diag</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>...</code></td>
<td>
<p>Some additional elements.</p>
</td></tr>
</table>
<p>The results for the g-formula simulation under various interventions for the last time point are printed with the <code><a href="#topic+print.gformula_binary_eof">print.gformula_binary_eof</a></code> function. To generate graphs comparing the mean estimated and observed covariate values over time, use the <code><a href="#topic+plot.gformula_binary_eof">plot.gformula_binary_eof</a></code> function.
</p>


<h3>References</h3>

<p>Chiu YH, Wen L, McGrath S, Logan R, Dahabreh IJ, Hernán MA. Evaluating model specification when using the parametric g-formula in the presence of censoring. American Journal of Epidemiology. 2023;192:1887–1895.
</p>
<p>McGrath S, Lin V, Zhang Z, Petito LC, Logan RW, Hernán MA, and JG Young. gfoRmula: An R package for estimating the effects of sustained treatment strategies via the parametric g-formula. Patterns. 2020;1:100008.
</p>
<p>Robins JM. A new approach to causal inference in mortality studies with a sustained exposure period: application to the healthy worker survivor effect. Mathematical Modelling. 1986;7:1393–1512. [Errata (1987) in Computers and Mathematics with Applications 14, 917.-921. Addendum (1987) in Computers and Mathematics with Applications 14, 923-.945. Errata (1987) to addendum in Computers and Mathematics with Applications 18, 477.].
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gformula">gformula</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Estimating the effect of threshold interventions on the mean of a binary
## end of follow-up outcome

id &lt;- 'id_num'
time_name &lt;- 'time'
covnames &lt;- c('cov1', 'cov2', 'treat')
outcome_name &lt;- 'outcome'
histories &lt;- c(lagged, cumavg)
histvars &lt;- list(c('treat', 'cov1', 'cov2'), c('cov1', 'cov2'))
covtypes &lt;- c('binary', 'zero-inflated normal', 'normal')
covparams &lt;- list(covmodels = c(cov1 ~ lag1_treat + lag1_cov1 + lag1_cov2 + cov3 +
                                  time,
                                cov2 ~ lag1_treat + cov1 + lag1_cov1 + lag1_cov2 +
                                  cov3 + time,
                                treat ~ lag1_treat + cumavg_cov1 +
                                  cumavg_cov2 + cov3 + time))
ymodel &lt;- outcome ~  treat + cov1 + cov2 + lag1_cov1 + lag1_cov2 + cov3
intvars &lt;- list('treat', 'treat')
interventions &lt;- list(list(c(static, rep(0, 7))),
                      list(c(threshold, 1, Inf)))
int_descript &lt;- c('Never treat', 'Threshold - lower bound 1')
nsimul &lt;- 10000
ncores &lt;- 2

gform_bin_eof &lt;- gformula_binary_eof(obs_data = binary_eofdata, id = id,
                                     time_name = time_name,
                                     covnames = covnames,
                                     outcome_name = outcome_name,
                                     covtypes = covtypes,
                                     covparams = covparams,
                                     ymodel = ymodel,
                                     intvars = intvars,
                                     interventions = interventions,
                                     int_descript = int_descript,
                                     histories = histories, histvars = histvars,
                                     basecovs = c("cov3"), seed = 1234,
                                     parallel = TRUE, nsamples = 5,
                                     nsimul = nsimul, ncores = ncores)
gform_bin_eof


</code></pre>

<hr>
<h2 id='gformula_continuous_eof'>Estimation of Continuous End-of-Follow-Up Outcome Under the Parametric G-Formula</h2><span id='topic+gformula_continuous_eof'></span>

<h3>Description</h3>

<p>Based on an observed data set, this internal function estimates the outcome mean at end-of-follow-up under
multiple user-specified interventions using the parametric g-formula. See McGrath et al. (2020) for
further details concerning the application and implementation of the parametric g-formula.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gformula_continuous_eof(
  obs_data,
  id,
  time_name,
  covnames,
  covtypes,
  covparams,
  covfits_custom = NA,
  covpredict_custom = NA,
  histvars = NULL,
  histories = NA,
  basecovs = NA,
  outcome_name,
  ymodel,
  censor_name = NULL,
  censor_model = NA,
  intvars = NULL,
  interventions = NULL,
  int_times = NULL,
  int_descript = NULL,
  ref_int = 0,
  visitprocess = NA,
  restrictions = NA,
  yrestrictions = NA,
  baselags = FALSE,
  nsimul = NA,
  sim_data_b = FALSE,
  seed,
  nsamples = 0,
  parallel = FALSE,
  ncores = NA,
  ci_method = "percentile",
  threads,
  model_fits = FALSE,
  boot_diag = FALSE,
  show_progress = TRUE,
  ipw_cutoff_quantile = NULL,
  ipw_cutoff_value = NULL,
  int_visit_type = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gformula_continuous_eof_+3A_obs_data">obs_data</code></td>
<td>
<p>Data table containing the observed data.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_id">id</code></td>
<td>
<p>Character string specifying the name of the ID variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_covnames">covnames</code></td>
<td>
<p>Vector of character strings specifying the names of the time-varying covariates in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_covtypes">covtypes</code></td>
<td>
<p>Vector of character strings specifying the &quot;type&quot; of each time-varying covariate included in <code>covnames</code>. The possible &quot;types&quot; are: <code>"binary"</code>, <code>"normal"</code>, <code>"categorical"</code>, <code>"bounded normal"</code>, <code>"zero-inflated normal"</code>, <code>"truncated normal"</code>, <code>"absorbing"</code>, <code>"categorical time"</code>, and <code>"custom"</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_covparams">covparams</code></td>
<td>
<p>List of vectors, where each vector contains information for
one parameter used in the modeling of the time-varying covariates (e.g.,
model statement, family, link function, etc.). Each vector
must be the same length as <code>covnames</code> and in the same order.
If a parameter is not required for a certain covariate, it
should be set to <code>NA</code> at that index.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_covfits_custom">covfits_custom</code></td>
<td>
<p>Vector containing custom fit functions for time-varying covariates that
do not fall within the pre-defined covariate types. It should be in
the same order <code>covnames</code>. If a custom fit function is not
required for a particular covariate (e.g., if the first
covariate is of type <code>"binary"</code> but the second is of type <code>"custom"</code>), then that
index should be set to <code>NA</code>. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_covpredict_custom">covpredict_custom</code></td>
<td>
<p>Vector containing custom prediction functions for time-varying
covariates that do not fall within the pre-defined covariate types.
It should be in the same order as <code>covnames</code>. If a custom
prediction function is not required for a particular
covariate, then that index should be set to <code>NA</code>. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_histvars">histvars</code></td>
<td>
<p>List of vectors. The kth vector specifies the names of the variables for which the kth history function
in <code>histories</code> is to be applied.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_histories">histories</code></td>
<td>
<p>Vector of history functions to apply to the variables specified in <code>histvars</code>. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_basecovs">basecovs</code></td>
<td>
<p>Vector of character strings specifying the names of baseline covariates in <code>obs_data</code>. These covariates are not simulated using a model but rather carry their value over all time points from the first time point of <code>obs_data</code>. These covariates should not be included in <code>covnames</code>. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_outcome_name">outcome_name</code></td>
<td>
<p>Character string specifying the name of the outcome variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_ymodel">ymodel</code></td>
<td>
<p>Model statement for the outcome variable.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_censor_name">censor_name</code></td>
<td>
<p>Character string specifying the name of the censoring variable in <code>obs_data</code>. Only applicable when using inverse probability weights to estimate the natural course means / risk from the observed data. See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_censor_model">censor_model</code></td>
<td>
<p>Model statement for the censoring variable. Only applicable when using inverse probability weights to estimate the natural course means / risk from the observed data. See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_intvars">intvars</code></td>
<td>
<p>List, whose elements are vectors of character strings. The kth vector in <code>intvars</code> specifies the name(s) of the variable(s) to be intervened
on in each round of the simulation under the kth intervention in <code>interventions</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_interventions">interventions</code></td>
<td>
<p>List, whose elements are lists of vectors. Each list in <code>interventions</code> specifies a unique intervention on the relevant variable(s) in <code>intvars</code>. Each vector contains a function
implementing a particular intervention on a single variable, optionally
followed by one or more &quot;intervention values&quot; (i.e.,
integers used to specify the treatment regime).</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_int_times">int_times</code></td>
<td>
<p>List, whose elements are lists of vectors. The kth list in <code>int_times</code> corresponds to the kth intervention in <code>interventions</code>. Each vector specifies the time points in which the relevant intervention is applied on the corresponding variable in <code>intvars</code>.
When an intervention is not applied, the simulated natural course value is used. By default, this argument is set so that all interventions are applied in all time points.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_int_descript">int_descript</code></td>
<td>
<p>Vector of character strings, each describing an intervention. It must
be in same order as the entries in <code>interventions</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_ref_int">ref_int</code></td>
<td>
<p>Integer denoting the intervention to be used as the
reference for calculating the end-of-follow-up mean ratio and mean difference. 0 denotes the
natural course, while subsequent integers denote user-specified
interventions in the order that they are
named in <code>interventions</code>. The default is 0.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_visitprocess">visitprocess</code></td>
<td>
<p>List of vectors. Each vector contains as its first entry
the covariate name of a visit process; its second entry
the name of a covariate whose modeling depends on the
visit process; and its third entry the maximum number
of consecutive visits that can be missed before an
individual is censored. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_restrictions">restrictions</code></td>
<td>
<p>List of vectors. Each vector contains as its first entry a covariate for which
<em>a priori</em> knowledge of its distribution is available; its second entry a condition
under which no knowledge of its distribution is available and that must be <code>TRUE</code>
for the distribution of that covariate given that condition to be estimated via a parametric
model or other fitting procedure; its third entry a function for estimating the distribution
of that covariate given the condition in the second entry is false such that <em>a priori</em> knowledge
of the covariate distribution is available; and its fourth entry a value used by the function in the
third entry. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_yrestrictions">yrestrictions</code></td>
<td>
<p>List of vectors. Each vector containins as its first entry
a condition and its second entry an integer. When the
condition is <code>TRUE</code>, the outcome variable is simulated
according to the fitted model; when the condition is <code>FALSE</code>,
the outcome variable takes on the value in the second entry.
The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_baselags">baselags</code></td>
<td>
<p>Logical scalar for specifying the convention used for lagi and lag_cumavgi terms in the model statements when pre-baseline times are not
included in <code>obs_data</code> and when the current time index, <code class="reqn">t</code>, is such that <code class="reqn">t &lt; i</code>. If this argument is set to <code>FALSE</code>, the value
of all lagi and lag_cumavgi terms in this context are set to 0 (for non-categorical covariates) or the reference
level (for categorical covariates). If this argument is set to <code>TRUE</code>, the value of lagi and lag_cumavgi terms
are set to their values at time 0. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_nsimul">nsimul</code></td>
<td>
<p>Number of subjects for whom to simulate data. By default, this argument is set
equal to the number of subjects in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_sim_data_b">sim_data_b</code></td>
<td>
<p>Logical scalar indicating whether to return the simulated data set. If bootstrap samples are used (i.e., <code>nsamples</code> is set to a value greater than 0), this argument must be set to <code>FALSE</code>. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_seed">seed</code></td>
<td>
<p>Starting seed for simulations and bootstrapping.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_nsamples">nsamples</code></td>
<td>
<p>Integer specifying the number of bootstrap samples to generate.
The default is 0.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_parallel">parallel</code></td>
<td>
<p>Logical scalar indicating whether to parallelize simulations of
different interventions to multiple cores.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_ncores">ncores</code></td>
<td>
<p>Integer specifying the number of CPU cores to use in parallel
simulation. This argument is required when parallel is set to <code>TRUE</code>.
In many applications, users may wish to set this argument equal to <code>parallel::detectCores() - 1</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_ci_method">ci_method</code></td>
<td>
<p>Character string specifying the method for calculating the bootstrap 95% confidence intervals, if applicable. The options are <code>"percentile"</code> and <code>"normal"</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_threads">threads</code></td>
<td>
<p>Integer specifying the number of threads to be used in <code>data.table</code>. See <code><a href="data.table.html#topic+setDTthreads">setDTthreads</a></code> for further details.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_model_fits">model_fits</code></td>
<td>
<p>Logical scalar indicating whether to return the fitted models. Note that if this argument is set to <code>TRUE</code>, the output of this function may use a lot of memory. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_boot_diag">boot_diag</code></td>
<td>
<p>Logical scalar indicating whether to return the parametric g-formula estimates as well as the coefficients, standard errors, and variance-covariance matrices of the parameters of the fitted models in the bootstrap samples. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_show_progress">show_progress</code></td>
<td>
<p>Logical scalar indicating whether to print a progress bar for the number of bootstrap samples completed in the R console. This argument is only applicable when <code>parallel</code> is set to <code>FALSE</code> and bootstrap samples are used (i.e., <code>nsamples</code> is set to a value greater than 0). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_ipw_cutoff_quantile">ipw_cutoff_quantile</code></td>
<td>
<p>Percentile by which to truncate inverse probability weights. The default is <code>NULL</code> (i.e., no truncation). See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_ipw_cutoff_value">ipw_cutoff_value</code></td>
<td>
<p>Cutoff value by which to truncate inverse probability weights. The default is <code>NULL</code> (i.e., no truncation). See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_int_visit_type">int_visit_type</code></td>
<td>
<p>Vector of logicals. The kth element is a logical specifying whether to carry forward the intervened value (rather than the natural value) of the treatment variables(s) when performing a carry forward restriction type for the kth intervention in <code>interventions</code>.
When the kth element is set to <code>FALSE</code>, the natural value of the treatment variable(s) in the kth intervention in <code>interventions</code> will be carried forward.
By default, this argument is set so that the intervened value of the treatment variable(s) is carried forward for all interventions.</p>
</td></tr>
<tr><td><code id="gformula_continuous_eof_+3A_...">...</code></td>
<td>
<p>Other arguments, which are passed to the functions in <code>covpredict_custom</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To assess model misspecification in the parametric g-formula, users can obtain inverse probability (IP) weighted estimates of the natural course means of the time-varying covariates from the observed data.
See Chiu et al. (2023) for details.
In addition to the general requirements described in McGrath et al. (2020), the requirements for the input data set and the call to the gformula function for such analyses are described below.
</p>
<p>Users need to include a column in <code>obs_data</code> with a time-varying censoring variable.
Users need to indicate the name of the censoring variable and a model statement for the censoring variable with parameters <code>censor_name</code> and <code>censor_model</code>, respectively.
Finally, users can specify how to truncate IP weights with the <code>ipw_cutoff_quantile</code> or <code>ipw_cutoff_value</code> parameters.
</p>
<p>In addition to the package output described in McGrath et al. (2020), the output will display estimates of the &quot;cumulative percent intervened on&quot; and the &quot;average percent intervened on&quot;. When using a custom intervention function, users need to specify whether each individual at that time point is eligible to contribute person-time to the percent intervened on calculations. Specifically, this must be specified in the <code>eligible_pt</code> column of <code>newdf</code>. By default, <code>eligible_pt</code> is set to <code>TRUE</code> for each individual at each time point in custom interventions.
</p>


<h3>Value</h3>

<p>An object of class <code>gformula_continuous_eof</code>. The object is a list with the following components:
</p>
<table>
<tr><td><code>result</code></td>
<td>
<p>Results table containing the estimated mean outcome for all interventions (inculding natural course) at the last time point as well as the &quot;cumulative percent intervened on&quot; and the &quot;average percent intervened on&quot;. If bootstrapping was used, the results table includes the bootstrap end-of-follow-up mean ratio, standard error, and 95% confidence interval.</p>
</td></tr>
<tr><td><code>coeffs</code></td>
<td>
<p>A list of the coefficients of the fitted models.</p>
</td></tr>
<tr><td><code>stderrs</code></td>
<td>
<p>A list of the standard errors of the coefficients of the fitted models.</p>
</td></tr>
<tr><td><code>vcovs</code></td>
<td>
<p>A list of the variance-covariance matrices of the parameters of the fitted models.</p>
</td></tr>
<tr><td><code>rmses</code></td>
<td>
<p>A list of root mean square error (RMSE) values of the fitted models.</p>
</td></tr>
<tr><td><code>fits</code></td>
<td>
<p>A list of the fitted models for the time-varying covariates and outcome. If <code>model_fits</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>sim_data</code></td>
<td>
<p>A list of data tables of the simulated data. Each element in the list corresponds to one of the interventions. If the argument <code>sim_data_b</code> is set to <code>FALSE</code>, a value of <code>NA</code> is given.</p>
</td></tr>
<tr><td><code>IP_weights</code></td>
<td>
<p>A numeric vector specifying the inverse probability weights. See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code>bootests</code></td>
<td>
<p>A data.table containing the bootstrap replicates of the parametric g-formula estimates. If <code>boot_diag</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>bootcoeffs</code></td>
<td>
<p>A list, where the kth element is a list containing the coefficients of the fitted models corresponding to the kth bootstrap sample. If <code>boot_diag</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>bootstderrs</code></td>
<td>
<p>A list, where the kth element is a list containing the standard errors of the coefficients of the fitted models corresponding to the kth bootstrap sample. If <code>boot_diag</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>bootvcovs</code></td>
<td>
<p>A list, where the kth element is a list containing the variance-covariance matrices of the parameters of the fitted models corresponding to the kth bootstrap sample. If <code>boot_diag</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>...</code></td>
<td>
<p>Some additional elements.</p>
</td></tr>
</table>
<p>The results for the g-formula simulation under various interventions for the last time point are printed with the <code><a href="#topic+print.gformula_continuous_eof">print.gformula_continuous_eof</a></code> function. To generate graphs comparing the mean estimated and observed covariate values over time, use the <code><a href="#topic+print.gformula_continuous_eof">print.gformula_continuous_eof</a></code> function.
</p>


<h3>References</h3>

<p>Chiu YH, Wen L, McGrath S, Logan R, Dahabreh IJ, Hernán MA. Evaluating model specification when using the parametric g-formula in the presence of censoring. American Journal of Epidemiology. 2023;192:1887–1895.
</p>
<p>McGrath S, Lin V, Zhang Z, Petito LC, Logan RW, Hernán MA, and JG Young. gfoRmula: An R package for estimating the effects of sustained treatment strategies via the parametric g-formula. Patterns. 2020;1:100008.
</p>
<p>Robins JM. A new approach to causal inference in mortality studies with a sustained exposure period: application to the healthy worker survivor effect. Mathematical Modelling. 1986;7:1393–1512. [Errata (1987) in Computers and Mathematics with Applications 14, 917.-921. Addendum (1987) in Computers and Mathematics with Applications 14, 923-.945. Errata (1987) to addendum in Computers and Mathematics with Applications 18, 477.].
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gformula">gformula</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Estimating the effect of treatment strategies on the mean of a continuous
## end of follow-up outcome

library('Hmisc')
id &lt;- 'id'
time_name &lt;- 't0'
covnames &lt;- c('L1', 'L2', 'A')
outcome_name &lt;- 'Y'
covtypes &lt;- c('categorical', 'normal', 'binary')
histories &lt;- c(lagged)
histvars &lt;- list(c('A', 'L1', 'L2'))
covparams &lt;- list(covmodels = c(L1 ~ lag1_A + lag1_L1 + L3 + t0 +
                                  rcspline.eval(lag1_L2, knots = c(-1, 0, 1)),
                                L2 ~ lag1_A + L1 + lag1_L1 + lag1_L2 + L3 + t0,
                                A ~ lag1_A + L1 + L2 + lag1_L1 + lag1_L2 + L3 + t0))
ymodel &lt;- Y ~ A + L1 + L2 + lag1_A + lag1_L1 + lag1_L2 + L3
intvars &lt;- list('A', 'A')
interventions &lt;- list(list(c(static, rep(0, 7))),
                      list(c(static, rep(1, 7))))
int_descript &lt;- c('Never treat', 'Always treat')
nsimul &lt;- 10000

gform_cont_eof &lt;- gformula_continuous_eof(obs_data = continuous_eofdata,
                                          id = id,
                                          time_name = time_name,
                                          covnames = covnames,
                                          outcome_name = outcome_name,
                                          covtypes = covtypes,
                                          covparams = covparams, ymodel = ymodel,
                                          intvars = intvars,
                                          interventions = interventions,
                                          int_descript = int_descript,
                                          histories = histories, histvars = histvars,
                                          basecovs = c("L3"),
                                          nsimul = nsimul, seed = 1234)
gform_cont_eof


</code></pre>

<hr>
<h2 id='gformula_survival'>Estimation of Survival Outcome Under the Parametric G-Formula</h2><span id='topic+gformula_survival'></span>

<h3>Description</h3>

<p>Based on an observed data set, this internal function estimates the risk over time under multiple
user-specified interventions using the parametric g-formula. See McGrath et al. (2020) for
further details concerning the application and implementation of the parametric g-formula.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gformula_survival(
  obs_data,
  id,
  time_points = NULL,
  time_name,
  covnames,
  covtypes,
  covparams,
  covfits_custom = NA,
  covpredict_custom = NA,
  histvars = NULL,
  histories = NA,
  basecovs = NA,
  outcome_name,
  ymodel,
  compevent_name = NULL,
  compevent_model = NA,
  compevent_cens = FALSE,
  censor_name = NULL,
  censor_model = NA,
  intvars = NULL,
  interventions = NULL,
  int_times = NULL,
  int_descript = NULL,
  ref_int = 0,
  intcomp = NA,
  visitprocess = NA,
  restrictions = NA,
  yrestrictions = NA,
  compevent_restrictions = NA,
  baselags = FALSE,
  nsimul = NA,
  sim_data_b = FALSE,
  seed,
  nsamples = 0,
  parallel = FALSE,
  ncores = NA,
  ci_method = "percentile",
  threads,
  model_fits = FALSE,
  boot_diag = FALSE,
  show_progress = TRUE,
  ipw_cutoff_quantile = NULL,
  ipw_cutoff_value = NULL,
  int_visit_type = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gformula_survival_+3A_obs_data">obs_data</code></td>
<td>
<p>Data table containing the observed data.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_id">id</code></td>
<td>
<p>Character string specifying the name of the ID variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_time_points">time_points</code></td>
<td>
<p>Number of time points to simulate. By default, this argument is set equal to the maximum
number of records that <code>obs_data</code> contains for any individual.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_covnames">covnames</code></td>
<td>
<p>Vector of character strings specifying the names of the time-varying covariates in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_covtypes">covtypes</code></td>
<td>
<p>Vector of character strings specifying the &quot;type&quot; of each time-varying covariate included in <code>covnames</code>. The possible &quot;types&quot; are: <code>"binary"</code>, <code>"normal"</code>, <code>"categorical"</code>, <code>"bounded normal"</code>, <code>"zero-inflated normal"</code>, <code>"truncated normal"</code>, <code>"absorbing"</code>, <code>"categorical time"</code>, and <code>"custom"</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_covparams">covparams</code></td>
<td>
<p>List of vectors, where each vector contains information for
one parameter used in the modeling of the time-varying covariates (e.g.,
model statement, family, link function, etc.). Each vector
must be the same length as <code>covnames</code> and in the same order.
If a parameter is not required for a certain covariate, it
should be set to <code>NA</code> at that index.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_covfits_custom">covfits_custom</code></td>
<td>
<p>Vector containing custom fit functions for time-varying covariates that
do not fall within the pre-defined covariate types. It should be in
the same order <code>covnames</code>. If a custom fit function is not
required for a particular covariate (e.g., if the first
covariate is of type <code>"binary"</code> but the second is of type <code>"custom"</code>), then that
index should be set to <code>NA</code>. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_covpredict_custom">covpredict_custom</code></td>
<td>
<p>Vector containing custom prediction functions for time-varying
covariates that do not fall within the pre-defined covariate types.
It should be in the same order as <code>covnames</code>. If a custom
prediction function is not required for a particular
covariate, then that index should be set to <code>NA</code>. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_histvars">histvars</code></td>
<td>
<p>List of vectors. The kth vector specifies the names of the variables for which the kth history function
in <code>histories</code> is to be applied.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_histories">histories</code></td>
<td>
<p>Vector of history functions to apply to the variables specified in <code>histvars</code>. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_basecovs">basecovs</code></td>
<td>
<p>Vector of character strings specifying the names of baseline covariates in <code>obs_data</code>. These covariates are not simulated using a model but rather carry their value over all time points from the first time point of <code>obs_data</code>. These covariates should not be included in <code>covnames</code>. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_outcome_name">outcome_name</code></td>
<td>
<p>Character string specifying the name of the outcome variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_ymodel">ymodel</code></td>
<td>
<p>Model statement for the outcome variable.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_compevent_name">compevent_name</code></td>
<td>
<p>Character string specifying the name of the competing event variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_compevent_model">compevent_model</code></td>
<td>
<p>Model statement for the competing event variable. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_compevent_cens">compevent_cens</code></td>
<td>
<p>Logical scalar indicating whether to treat competing events as censoring events.
This argument is only applicable for survival outcomes and when a competing even model is supplied (i.e., <code>compevent_name</code> and <code>compevent_model</code> are specified).
If this argument is set to <code>TRUE</code>, the competing event model will only be used to construct inverse probability weights to estimate the natural course means / risk from the observed data.
If this argument is set to <code>FALSE</code>, the competing event model will be used in the parametric g-formula estimates of the risk and will not be used to construct inverse probability weights.
See &quot;Details&quot;. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_censor_name">censor_name</code></td>
<td>
<p>Character string specifying the name of the censoring variable in <code>obs_data</code>. Only applicable when using inverse probability weights to estimate the natural course means / risk from the observed data. See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_censor_model">censor_model</code></td>
<td>
<p>Model statement for the censoring variable. Only applicable when using inverse probability weights to estimate the natural course means / risk from the observed data. See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_intvars">intvars</code></td>
<td>
<p>List, whose elements are vectors of character strings. The kth vector in <code>intvars</code> specifies the name(s) of the variable(s) to be intervened
on in each round of the simulation under the kth intervention in <code>interventions</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_interventions">interventions</code></td>
<td>
<p>List, whose elements are lists of vectors. Each list in <code>interventions</code> specifies a unique intervention on the relevant variable(s) in <code>intvars</code>. Each vector contains a function
implementing a particular intervention on a single variable, optionally
followed by one or more &quot;intervention values&quot; (i.e.,
integers used to specify the treatment regime).</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_int_times">int_times</code></td>
<td>
<p>List, whose elements are lists of vectors. The kth list in <code>int_times</code> corresponds to the kth intervention in <code>interventions</code>. Each vector specifies the time points in which the relevant intervention is applied on the corresponding variable in <code>intvars</code>.
When an intervention is not applied, the simulated natural course value is used. By default, this argument is set so that all interventions are applied in all time points.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_int_descript">int_descript</code></td>
<td>
<p>Vector of character strings, each describing an intervention. It must
be in same order as the entries in <code>interventions</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_ref_int">ref_int</code></td>
<td>
<p>Integer denoting the intervention to be used as the
reference for calculating the risk ratio and risk difference. 0 denotes the
natural course, while subsequent integers denote user-specified
interventions in the order that they are
named in <code>interventions</code>. The default is 0.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_intcomp">intcomp</code></td>
<td>
<p>List of two numbers indicating a pair of interventions to be compared by a hazard ratio.
The default is <code>NA</code>, resulting in no hazard ratio calculation.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_visitprocess">visitprocess</code></td>
<td>
<p>List of vectors. Each vector contains as its first entry
the covariate name of a visit process; its second entry
the name of a covariate whose modeling depends on the
visit process; and its third entry the maximum number
of consecutive visits that can be missed before an
individual is censored. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_restrictions">restrictions</code></td>
<td>
<p>List of vectors. Each vector contains as its first entry a covariate for which
<em>a priori</em> knowledge of its distribution is available; its second entry a condition
under which no knowledge of its distribution is available and that must be <code>TRUE</code>
for the distribution of that covariate given that condition to be estimated via a parametric
model or other fitting procedure; its third entry a function for estimating the distribution
of that covariate given the condition in the second entry is false such that <em>a priori</em> knowledge
of the covariate distribution is available; and its fourth entry a value used by the function in the
third entry. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_yrestrictions">yrestrictions</code></td>
<td>
<p>List of vectors. Each vector containins as its first entry
a condition and its second entry an integer. When the
condition is <code>TRUE</code>, the outcome variable is simulated
according to the fitted model; when the condition is <code>FALSE</code>,
the outcome variable takes on the value in the second entry.
The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_compevent_restrictions">compevent_restrictions</code></td>
<td>
<p>List of vectors. Each vector containins as its first entry
a condition and its second entry an integer. When the
condition is <code>TRUE</code>, the competing event variable is simulated
according to the fitted model; when the condition is <code>FALSE</code>,
the competing event variable takes on the value in the
second entry. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_baselags">baselags</code></td>
<td>
<p>Logical scalar for specifying the convention used for lagi and lag_cumavgi terms in the model statements when pre-baseline times are not
included in <code>obs_data</code> and when the current time index, <code class="reqn">t</code>, is such that <code class="reqn">t &lt; i</code>. If this argument is set to <code>FALSE</code>, the value
of all lagi and lag_cumavgi terms in this context are set to 0 (for non-categorical covariates) or the reference
level (for categorical covariates). If this argument is set to <code>TRUE</code>, the value of lagi and lag_cumavgi terms
are set to their values at time 0. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_nsimul">nsimul</code></td>
<td>
<p>Number of subjects for whom to simulate data. By default, this argument is set
equal to the number of subjects in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_sim_data_b">sim_data_b</code></td>
<td>
<p>Logical scalar indicating whether to return the simulated data set. If bootstrap samples are used (i.e., <code>nsamples</code> is set to a value greater than 0), this argument must be set to <code>FALSE</code>. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_seed">seed</code></td>
<td>
<p>Starting seed for simulations and bootstrapping.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_nsamples">nsamples</code></td>
<td>
<p>Integer specifying the number of bootstrap samples to generate.
The default is 0.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_parallel">parallel</code></td>
<td>
<p>Logical scalar indicating whether to parallelize simulations of
different interventions to multiple cores.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_ncores">ncores</code></td>
<td>
<p>Integer specifying the number of CPU cores to use in parallel
simulation. This argument is required when parallel is set to <code>TRUE</code>.
In many applications, users may wish to set this argument equal to <code>parallel::detectCores() - 1</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_ci_method">ci_method</code></td>
<td>
<p>Character string specifying the method for calculating the bootstrap 95% confidence intervals, if applicable. The options are <code>"percentile"</code> and <code>"normal"</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_threads">threads</code></td>
<td>
<p>Integer specifying the number of threads to be used in <code>data.table</code>. See <code><a href="data.table.html#topic+setDTthreads">setDTthreads</a></code> for further details.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_model_fits">model_fits</code></td>
<td>
<p>Logical scalar indicating whether to return the fitted models. Note that if this argument is set to <code>TRUE</code>, the output of this function may use a lot of memory. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_boot_diag">boot_diag</code></td>
<td>
<p>Logical scalar indicating whether to return the parametric g-formula estimates as well as the coefficients, standard errors, and variance-covariance matrices of the parameters of the fitted models in the bootstrap samples. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_show_progress">show_progress</code></td>
<td>
<p>Logical scalar indicating whether to print a progress bar for the number of bootstrap samples completed in the R console. This argument is only applicable when <code>parallel</code> is set to <code>FALSE</code> and bootstrap samples are used (i.e., <code>nsamples</code> is set to a value greater than 0). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_ipw_cutoff_quantile">ipw_cutoff_quantile</code></td>
<td>
<p>Percentile by which to truncate inverse probability weights. The default is <code>NULL</code> (i.e., no truncation). See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_ipw_cutoff_value">ipw_cutoff_value</code></td>
<td>
<p>Cutoff value by which to truncate inverse probability weights. The default is <code>NULL</code> (i.e., no truncation). See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_int_visit_type">int_visit_type</code></td>
<td>
<p>Vector of logicals. The kth element is a logical specifying whether to carry forward the intervened value (rather than the natural value) of the treatment variables(s) when performing a carry forward restriction type for the kth intervention in <code>interventions</code>.
When the kth element is set to <code>FALSE</code>, the natural value of the treatment variable(s) in the kth intervention in <code>interventions</code> will be carried forward.
By default, this argument is set so that the intervened value of the treatment variable(s) is carried forward for all interventions.</p>
</td></tr>
<tr><td><code id="gformula_survival_+3A_...">...</code></td>
<td>
<p>Other arguments, which are passed to the functions in <code>covpredict_custom</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To assess model misspecification in the parametric g-formula, users can obtain inverse probability (IP) weighted estimates of the natural course risk and/or means of the time-varying covariates from the observed data.
See Chiu et al. (2023) for details.
In addition to the general requirements described in McGrath et al. (2020), the requirements for the input data set and the call to the gformula function for such analyses are described below.
</p>
<p>Users need to include a column in <code>obs_data</code> with a time-varying censoring variable.
Users need to indicate the name of the censoring variable and a model statement for the censoring variable with parameters <code>censor_name</code> and <code>censor_model</code>, respectively.
When competing events are present, users need to include a column in <code>obs_data</code> with a time-varying indicator of the competing event variable and need to indicate the name of the competing event variable and the corresponding model statement with parameters <code>compevent_name</code> and <code>compevent_model</code>, respectively.
Users need to indicate whether to treat competing events as censoring events with the <code>compevent_cens</code> parameter.
Finally, users can specify how to truncate IP weights with the <code>ipw_cutoff_quantile</code> or <code>ipw_cutoff_value</code> parameters.
</p>
<p>In addition to the package output described in McGrath et al. (2020), the output will display estimates of the &quot;cumulative percent intervened on&quot; and the &quot;average percent intervened on&quot;. When using a custom intervention function, users need to specify whether each individual at that time point is eligible to contribute person-time to the percent intervened on calculations. Specifically, this must be specified in the <code>eligible_pt</code> column of <code>newdf</code>. By default, <code>eligible_pt</code> is set to <code>TRUE</code> for each individual at each time point in custom interventions.
</p>


<h3>Value</h3>

<p>An object of class <code>gformula_survival</code>. The object is a list with the following components:
</p>
<table>
<tr><td><code>result</code></td>
<td>
<p>Results table containing the estimated risk and risk ratio for all interventions (inculding the natural course) at each time point as well as the &quot;cumulative percent intervened on&quot; and the &quot;average percent intervened on&quot;. If bootstrapping was used, the results table includes the bootstrap mean risk ratio, standard error, and 95% confidence interval.</p>
</td></tr>
<tr><td><code>coeffs</code></td>
<td>
<p>A list of the coefficients of the fitted models.</p>
</td></tr>
<tr><td><code>stderrs</code></td>
<td>
<p>A list of the standard errors of the coefficients of the fitted models.</p>
</td></tr>
<tr><td><code>vcovs</code></td>
<td>
<p>A list of the variance-covariance matrices of the parameters of the fitted models.</p>
</td></tr>
<tr><td><code>rmses</code></td>
<td>
<p>A list of root mean square error (RMSE) values of the fitted models.</p>
</td></tr>
<tr><td><code>hazardratio_val</code></td>
<td>
<p>Hazard ratio between two interventions (if applicable).</p>
</td></tr>
<tr><td><code>fits</code></td>
<td>
<p>A list of the fitted models for the time-varying covariates, outcome, and competing event (if applicable). If <code>model_fits</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>sim_data</code></td>
<td>
<p>A list of data tables of the simulated data. Each element in the list corresponds to one of the interventions. If the argument <code>sim_data_b</code> is set to <code>FALSE</code>, a value of <code>NA</code> is given.</p>
</td></tr>
<tr><td><code>IP_weights</code></td>
<td>
<p>A numeric vector specifying the inverse probability weights. See &quot;Details&quot;.</p>
</td></tr>
<tr><td><code>bootests</code></td>
<td>
<p>A data.table containing the bootstrap replicates of the parametric g-formula estimates. If <code>boot_diag</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>bootcoeffs</code></td>
<td>
<p>A list, where the kth element is a list containing the coefficients of the fitted models corresponding to the kth bootstrap sample. If <code>boot_diag</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>bootstderrs</code></td>
<td>
<p>A list, where the kth element is a list containing the standard errors of the coefficients of the fitted models corresponding to the kth bootstrap sample. If <code>boot_diag</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>bootvcovs</code></td>
<td>
<p>A list, where the kth element is a list containing the variance-covariance matrices of the parameters of the fitted models corresponding to the kth bootstrap sample. If <code>boot_diag</code> is set to <code>FALSE</code>, a value of <code>NULL</code> is given.</p>
</td></tr>
<tr><td><code>...</code></td>
<td>
<p>Some additional elements.</p>
</td></tr>
</table>
<p>The results for the g-formula simulation under various interventions only for the first and last time points are printed with the <code><a href="#topic+print.gformula_survival">print.gformula_survival</a></code> function. To generate graphs comparing the mean estimated covariate values and risks over time and mean observed covariate values and risks over time, use the <code><a href="#topic+plot.gformula_survival">plot.gformula_survival</a></code> function.
</p>


<h3>References</h3>

<p>Chiu YH, Wen L, McGrath S, Logan R, Dahabreh IJ, Hernán MA. Evaluating model specification when using the parametric g-formula in the presence of censoring. American Journal of Epidemiology. 2023;192:1887–1895.
</p>
<p>McGrath S, Lin V, Zhang Z, Petito LC, Logan RW, Hernán MA, and JG Young. gfoRmula: An R package for estimating the effects of sustained treatment strategies via the parametric g-formula. Patterns. 2020;1:100008.
</p>
<p>Robins JM. A new approach to causal inference in mortality studies with a sustained exposure period: application to the healthy worker survivor effect. Mathematical Modelling. 1986;7:1393–1512. [Errata (1987) in Computers and Mathematics with Applications 14, 917.-921. Addendum (1987) in Computers and Mathematics with Applications 14, 923-.945. Errata (1987) to addendum in Computers and Mathematics with Applications 18, 477.].
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gformula">gformula</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Estimating the effect of static treatment strategies on risk of a
## failure event

id &lt;- 'id'
time_points &lt;- 7
time_name &lt;- 't0'
covnames &lt;- c('L1', 'L2', 'A')
outcome_name &lt;- 'Y'
covtypes &lt;- c('binary', 'bounded normal', 'binary')
histories &lt;- c(lagged, lagavg)
histvars &lt;- list(c('A', 'L1', 'L2'), c('L1', 'L2'))
covparams &lt;- list(covmodels = c(L1 ~ lag1_A + lag_cumavg1_L1 + lag_cumavg1_L2 +
                                  L3 + t0,
                                L2 ~ lag1_A + L1 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0,
                                A ~ lag1_A + L1 + L2 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0))
ymodel &lt;- Y ~ A + L1 + L2 + L3 + lag1_A + lag1_L1 + lag1_L2 + t0
intvars &lt;- list('A', 'A')
interventions &lt;- list(list(c(static, rep(0, time_points))),
                      list(c(static, rep(1, time_points))))
int_descript &lt;- c('Never treat', 'Always treat')
nsimul &lt;- 10000

gform_basic &lt;- gformula_survival(obs_data = basicdata_nocomp, id = id,
                                 time_points = time_points,
                                 time_name = time_name, covnames = covnames,
                                 outcome_name = outcome_name,
                                 covtypes = covtypes,
                                 covparams = covparams, ymodel = ymodel,
                                 intvars = intvars,
                                 interventions = interventions,
                                 int_descript = int_descript,
                                 histories = histories, histvars = histvars,
                                 basecovs = c('L3'), nsimul = nsimul,
                                 seed = 1234)
gform_basic



## Estimating the effect of treatment strategies on risk of a failure event
## when competing events exist

id &lt;- 'id'
time_points &lt;- 7
time_name &lt;- 't0'
covnames &lt;- c('L1', 'L2', 'A')
outcome_name &lt;- 'Y'
compevent_name &lt;- 'D'
covtypes &lt;- c('binary', 'bounded normal', 'binary')
histories &lt;- c(lagged, lagavg)
histvars &lt;- list(c('A', 'L1', 'L2'), c('L1', 'L2'))
covparams &lt;- list(covlink = c('logit', 'identity', 'logit'),
                  covmodels = c(L1 ~ lag1_A + lag_cumavg1_L1 + lag_cumavg1_L2 +
                                  L3 + as.factor(t0),
                                L2 ~ lag1_A + L1 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + as.factor(t0),
                                A ~ lag1_A + L1 + L2 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + as.factor(t0)))
ymodel &lt;- Y ~ A + L1 + L2 + lag1_A + lag1_L1 + lag1_L2 + L3 + as.factor(t0)
compevent_model &lt;- D ~ A + L1 + L2 + lag1_A + lag1_L1 + lag1_L2 + L3 + as.factor(t0)
intvars &lt;- list('A', 'A')
interventions &lt;- list(list(c(static, rep(0, time_points))),
                      list(c(static, rep(1, time_points))))
int_descript &lt;- c('Never treat', 'Always treat')
nsimul &lt;- 10000

gform_basic &lt;- gformula_survival(obs_data = basicdata, id = id,
                                 time_points = time_points,
                                 time_name = time_name, covnames = covnames,
                                 outcome_name = outcome_name,
                                 compevent_name = compevent_name,
                                 covtypes = covtypes,
                                 covparams = covparams, ymodel = ymodel,
                                 compevent_model = compevent_model,
                                 intvars = intvars, interventions = interventions,
                                 int_descript = int_descript,
                                 histories = histories, histvars = histvars,
                                 basecovs = c('L3'), nsimul = nsimul,
                                 seed = 1234)
gform_basic


## Using IP weighting to estimate natural course risk
## Only the natural course intervention is included for simplicity

covnames &lt;- c('L', 'A')
histories &lt;- c(lagged)
histvars &lt;- list(c('A', 'L'))
ymodel &lt;- Y ~ L + A
covtypes &lt;- c('binary', 'normal')
covparams &lt;- list(covmodels = c(L ~ lag1_L + lag1_A,
                                A ~ lag1_L + L + lag1_A))
censor_name &lt;- 'C'
censor_model &lt;- C ~ L
res_censor &lt;- gformula(obs_data = censor_data, id = 'id',
                       time_name = 't0', covnames = covnames,
                       outcome_name = 'Y', outcome_type = 'survival',
                       censor_name = censor_name, censor_model = censor_model,
                       covtypes = covtypes,
                       covparams = covparams, ymodel = ymodel,
                       intvars = NULL, interventions = NULL, int_descript = NULL,
                       histories = histories, histvars = histvars,
                       seed = 1234)
plot(res_censor)


</code></pre>

<hr>
<h2 id='hr_helper'>Format Simulated Dataset for Hazard Ratio Calculation</h2><span id='topic+hr_helper'></span>

<h3>Description</h3>

<p>This internal function modifies the pooled-over-time dataset generated by the <code><a href="#topic+simulate">simulate</a></code> function
to a format suitable for hazard ratio calculation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hr_helper(i, intcomp, time_name, pools)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hr_helper_+3A_i">i</code></td>
<td>
<p>Integer specifying the index <code>intcomp</code>.</p>
</td></tr>
<tr><td><code id="hr_helper_+3A_intcomp">intcomp</code></td>
<td>
<p>List of two numbers indicating a pair of interventions to be compared by a hazard ratio.</p>
</td></tr>
<tr><td><code id="hr_helper_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>pools</code>.</p>
</td></tr>
<tr><td><code id="hr_helper_+3A_pools">pools</code></td>
<td>
<p>Data table containing the simulated values for the covariates, outcome
probabilities, competing event probabilities, outcomes, and competing
events.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Data table consisting of failure time information for each individual or the last time
point information (for individuals who do not experience an event).
</p>

<hr>
<h2 id='intfunc'>Execute Intervention</h2><span id='topic+intfunc'></span>

<h3>Description</h3>

<p>This internal function executes the intervention of interest on the specified intervention variable
in the data table <code>newdf</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>intfunc(newdf, pool, intervention, intvar, int_time, time_name, t)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="intfunc_+3A_newdf">newdf</code></td>
<td>
<p>Data table containing the simulated data at time <code class="reqn">t</code>.</p>
</td></tr>
<tr><td><code id="intfunc_+3A_pool">pool</code></td>
<td>
<p>Data table containing the simulated data at times before <code class="reqn">t</code>.</p>
</td></tr>
<tr><td><code id="intfunc_+3A_intervention">intervention</code></td>
<td>
<p>List, whose elements are lists of vectors. Each vector contains a function
implementing a particular intervention on a single variable, optionally
followed by one or more &quot;intervention values&quot; (i.e.,
integers used to specify the treatment regime).</p>
</td></tr>
<tr><td><code id="intfunc_+3A_intvar">intvar</code></td>
<td>
<p>Character string specifying the name of the variable to be intervened on in each round of the simulation.</p>
</td></tr>
<tr><td><code id="intfunc_+3A_int_time">int_time</code></td>
<td>
<p>Vector specifying the time points in which the intervention is applied.</p>
</td></tr>
<tr><td><code id="intfunc_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>pool</code> and <code>newdf</code>.</p>
</td></tr>
<tr><td><code id="intfunc_+3A_t">t</code></td>
<td>
<p>Integer specifying the current time index.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No value is returned. The data table <code>newdf</code> is modified in place.
</p>

<hr>
<h2 id='lagged'>History functions</h2><span id='topic+lagged'></span><span id='topic+cumavg'></span><span id='topic+lagavg'></span>

<h3>Description</h3>

<p>These functions create new columns in an input data table for covariate histories. Users must specify which covariates are to be used in the history functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lagged(
  pool,
  histvars,
  histvals,
  time_name,
  t,
  id_name,
  baselags,
  below_zero_indicator
)

cumavg(pool, histvars, time_name, t, id_name, below_zero_indicator)

lagavg(
  pool,
  histvars,
  histvals,
  time_name,
  t,
  id_name,
  baselags,
  below_zero_indicator
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lagged_+3A_pool">pool</code></td>
<td>
<p>Data table containing all information prior to time <code class="reqn">t</code> (<code class="reqn">t</code> noninclusive).</p>
</td></tr>
<tr><td><code id="lagged_+3A_histvars">histvars</code></td>
<td>
<p>Vector of character strings specifying the names of the variables for which history functions are to be applied.</p>
</td></tr>
<tr><td><code id="lagged_+3A_histvals">histvals</code></td>
<td>
<p>For <code>lagged</code>, this argument is a vector specifying the lags used in the model statements (e.g., if <code>lag1_varname</code> and <code>lag2_varname</code> were included in the model statements, this vector would be <code>c(1,2)</code>). For <code>lagavg</code>, this argument is a numeric vector specifying the lag averages used in the model statements.</p>
</td></tr>
<tr><td><code id="lagged_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>pool</code>.</p>
</td></tr>
<tr><td><code id="lagged_+3A_t">t</code></td>
<td>
<p>Integer specifying the current time index.</p>
</td></tr>
<tr><td><code id="lagged_+3A_id_name">id_name</code></td>
<td>
<p>Character string specifying the name of the ID variable in <code>pool</code>.</p>
</td></tr>
<tr><td><code id="lagged_+3A_baselags">baselags</code></td>
<td>
<p>Logical scalar for specifying the convention used for lagi and lag_cumavgi terms in the model statements when pre-baseline times are not
included in <code>obs_data</code> and when the current time index, <code class="reqn">t</code>, is such that <code class="reqn">t &lt; i</code>. If this argument is set to <code>FALSE</code>, the value
of all lagi and lag_cumavgi terms in this context are set to 0 (for non-categorical covariates) or the reference
level (for categorical covariates). If this argument is set to <code>TRUE</code>, the value of lagi and lag_cumavgi terms
are set to their values at time 0. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="lagged_+3A_below_zero_indicator">below_zero_indicator</code></td>
<td>
<p>Logical scalar indicating whether the observed data set contains rows for time <code class="reqn">t &lt; 0</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>lagged</code> creates new columns for lagged versions of existing
variables in the dataset. The user must specify which variables are to be lagged.
</p>
<p><code>cumavg</code> creates new columns for the cumulative average up until
time <code class="reqn">t</code> of existing variables in the dataset.
</p>
<p><code>lagavg</code> creates new columns for the &quot;lagged cumulative average&quot;
(cumulative average up until time t, then lagged by one time unit) up until time <code class="reqn">t</code> of existing
variables in the dataset.
</p>


<h3>Value</h3>

<p>No value is returned. The data table <code>pool</code> is modified in place.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Estimating the effect of static treatment strategies on risk of a
## failure event

id &lt;- 'id'
time_points &lt;- 7
time_name &lt;- 't0'
covnames &lt;- c('L1', 'L2', 'A')
outcome_name &lt;- 'Y'
covtypes &lt;- c('binary', 'bounded normal', 'binary')
histories &lt;- c(lagged, lagavg)
histvars &lt;- list(c('A', 'L1', 'L2'), c('L1', 'L2'))
covparams &lt;- list(covmodels = c(L1 ~ lag1_A + lag_cumavg1_L1 + lag_cumavg1_L2 +
                                  L3 + t0,
                                L2 ~ lag1_A + L1 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0,
                                A ~ lag1_A + L1 + L2 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0))
ymodel &lt;- Y ~ A + L1 + L2 + L3 + lag1_A + lag1_L1 + lag1_L2 + t0
intvars &lt;- list('A', 'A')
interventions &lt;- list(list(c(static, rep(0, time_points))),
                      list(c(static, rep(1, time_points))))
int_descript &lt;- c('Never treat', 'Always treat')
nsimul &lt;- 10000

gform_basic &lt;- gformula_survival(obs_data = basicdata_nocomp, id = id,
                                 time_points = time_points,
                                 time_name = time_name, covnames = covnames,
                                 outcome_name = outcome_name,
                                 covtypes = covtypes,
                                 covparams = covparams, ymodel = ymodel,
                                 intvars = intvars,
                                 interventions = interventions,
                                 int_descript = int_descript,
                                 histories = histories, histvars = histvars,
                                 basecovs = c('L3'), nsimul = nsimul,
                                 seed = 1234)
gform_basic


</code></pre>

<hr>
<h2 id='make_histories'>Generates Functions of History of Existing Covariates</h2><span id='topic+make_histories'></span>

<h3>Description</h3>

<p>This internal function applies the history functions to create new columns in an input data table containing new variables that are functions
of the histories of existing variables in the dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_histories(
  pool,
  histvars,
  histvals,
  histories,
  time_name,
  t,
  id,
  max_visits,
  baselags,
  below_zero_indicator
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="make_histories_+3A_pool">pool</code></td>
<td>
<p>Data table containing all information prior to time <code class="reqn">t</code> (<code class="reqn">t</code> noninclusive).</p>
</td></tr>
<tr><td><code id="make_histories_+3A_histvars">histvars</code></td>
<td>
<p>List of vectors. The kth vector specifies the names of the variables for which the kth history function
in <code>histories</code> is to be applied.</p>
</td></tr>
<tr><td><code id="make_histories_+3A_histvals">histvals</code></td>
<td>
<p>List of length two. The first element is a numeric vector specifying the lags used in the model statements (e.g., if <code>lag1_varname</code> and <code>lag2_varname</code> were included in the model statements, this vector would be <code>c(1,2)</code>). The second element is a numeric vector specifying the lag averages used in the model statements.</p>
</td></tr>
<tr><td><code id="make_histories_+3A_histories">histories</code></td>
<td>
<p>Vector of history functions to apply to the variables specified in <code>histvars</code>.</p>
</td></tr>
<tr><td><code id="make_histories_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>pool</code>.</p>
</td></tr>
<tr><td><code id="make_histories_+3A_t">t</code></td>
<td>
<p>Integer specifying the current time index.</p>
</td></tr>
<tr><td><code id="make_histories_+3A_id">id</code></td>
<td>
<p>Character string specifying the name of the ID variable in <code>pool</code>.</p>
</td></tr>
<tr><td><code id="make_histories_+3A_max_visits">max_visits</code></td>
<td>
<p>A vector of one or more values denoting the maximum number of times
a binary covariate representing a visit process may be missed before
the individual is censored from the data (in the observed data) or
a visit is forced (in the simulated data). Multiple values exist in the
vector when the modeling of more than covariate is attached to a visit
process. A value of <code>NA</code> should be provided when there is no visit process.</p>
</td></tr>
<tr><td><code id="make_histories_+3A_baselags">baselags</code></td>
<td>
<p>Logical scalar for specifying the convention used for lagi and lag_cumavgi terms in the model statements when pre-baseline times are not
included in <code>obs_data</code> and when the current time index, <code class="reqn">t</code>, is such that <code class="reqn">t &lt; i</code>. If this argument is set to <code>FALSE</code>, the value
of all lagi and lag_cumavgi terms in this context are set to 0 (for non-categorical covariates) or the reference
level (for categorical covariates). If this argument is set to <code>TRUE</code>, the value of lagi and lag_cumavgi terms
are set to their values at time 0. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="make_histories_+3A_below_zero_indicator">below_zero_indicator</code></td>
<td>
<p>Logical scalar indicating whether the observed data set contains rows for time <code class="reqn">t &lt; 0</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No value is returned. The data table <code>pool</code> is modified in place.
</p>

<hr>
<h2 id='natural'>Natural Course Intervention</h2><span id='topic+natural'></span>

<h3>Description</h3>

<p>This function implements the natural course (i.e., model-based simulation) for the specified
intervention variable in the data table newdf. Because <code>newdf</code> is initiated with the
natural course, this function does nothing.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>natural(newdf, pool, intvar, intvals, time_name, t)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="natural_+3A_newdf">newdf</code></td>
<td>
<p>Data table containing the simulated data at time <code class="reqn">t</code>.</p>
</td></tr>
<tr><td><code id="natural_+3A_pool">pool</code></td>
<td>
<p>Data table containing the simulated data at times before <code class="reqn">t</code>.</p>
</td></tr>
<tr><td><code id="natural_+3A_intvar">intvar</code></td>
<td>
<p>Character string specifying the name of the variable to be intervened on in each round of the simulation.</p>
</td></tr>
<tr><td><code id="natural_+3A_intvals">intvals</code></td>
<td>
<p>A list of user-specified values for the intervention.</p>
</td></tr>
<tr><td><code id="natural_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>pool</code> and <code>newdf</code>.</p>
</td></tr>
<tr><td><code id="natural_+3A_t">t</code></td>
<td>
<p>Integer specifying the current time index.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No value is returned.
</p>

<hr>
<h2 id='obs_calculate'>Calculate Observed Covariate Means and Risk</h2><span id='topic+obs_calculate'></span>

<h3>Description</h3>

<p>This internal function calculates the mean observed values of covariates at each time point, as well as mean
observed risk.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>obs_calculate(
  outcome_name,
  compevent_name,
  compevent2_name,
  censor_name,
  time_name,
  id,
  covnames,
  covtypes,
  comprisk,
  comprisk2,
  censor,
  fitD2,
  fitC,
  outcome_type,
  obs_data,
  ipw_cutoff_quantile,
  ipw_cutoff_value
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="obs_calculate_+3A_outcome_name">outcome_name</code></td>
<td>
<p>Character string specifying the name of the outcome variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="obs_calculate_+3A_compevent_name">compevent_name</code></td>
<td>
<p>Character string specifying the name of the competing event variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="obs_calculate_+3A_compevent2_name">compevent2_name</code></td>
<td>
<p>Character string specifying the name of the competing event variable in <code>obs_data</code> if competing events are treated as censoring events.</p>
</td></tr>
<tr><td><code id="obs_calculate_+3A_censor_name">censor_name</code></td>
<td>
<p>Character string specifying the name of the censoring variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="obs_calculate_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="obs_calculate_+3A_id">id</code></td>
<td>
<p>Character string specifying the name of the ID variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="obs_calculate_+3A_covnames">covnames</code></td>
<td>
<p>Vector of character strings specifying the names of the time-varying covariates in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="obs_calculate_+3A_covtypes">covtypes</code></td>
<td>
<p>Vector of character strings specifying the &quot;type&quot; of each time-varying covariate included in <code>covnames</code>. The possible &quot;types&quot; are: <code>"binary"</code>, <code>"normal"</code>, <code>"categorical"</code>, <code>"bounded normal"</code>, <code>"zero-inflated normal"</code>, <code>"truncated normal"</code>, <code>"absorbing"</code>, <code>"categorical time"</code>, and <code>"custom"</code>.</p>
</td></tr>
<tr><td><code id="obs_calculate_+3A_comprisk">comprisk</code></td>
<td>
<p>Logical scalar indicating the presence of a competing event.</p>
</td></tr>
<tr><td><code id="obs_calculate_+3A_comprisk2">comprisk2</code></td>
<td>
<p>Logical scalar indicating whether competing events are treated as censoring events.</p>
</td></tr>
<tr><td><code id="obs_calculate_+3A_censor">censor</code></td>
<td>
<p>Logical scalar indicating the presence of a censoring variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="obs_calculate_+3A_fitd2">fitD2</code></td>
<td>
<p>Model fit for the competing event variable if competing events are treated as censoring events.</p>
</td></tr>
<tr><td><code id="obs_calculate_+3A_fitc">fitC</code></td>
<td>
<p>Model fit for the censoring variable.</p>
</td></tr>
<tr><td><code id="obs_calculate_+3A_outcome_type">outcome_type</code></td>
<td>
<p>Character string specifying the &quot;type&quot; of the outcome. The possible &quot;types&quot; are: <code>"survival"</code>, <code>"continuous_eof"</code>, and <code>"binary_eof"</code>.</p>
</td></tr>
<tr><td><code id="obs_calculate_+3A_obs_data">obs_data</code></td>
<td>
<p>Data table containing the observed data.</p>
</td></tr>
<tr><td><code id="obs_calculate_+3A_ipw_cutoff_quantile">ipw_cutoff_quantile</code></td>
<td>
<p>Percentile by which to truncate inverse probability weights.</p>
</td></tr>
<tr><td><code id="obs_calculate_+3A_ipw_cutoff_value">ipw_cutoff_value</code></td>
<td>
<p>Cutoff value by which to truncate inverse probability weights.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list. Its first entry is a list of mean covariate values at each time point;
its second entry is a vector of the mean observed risk (for <code>"survival"</code>
outcome types) or the mean observed outcome (for <code>"continuous_eof"</code> and
<code>"binary_eof"</code> outcome types); for <code>"survival"</code> outcome types, its
third entry is a vector of mean observed survival.
</p>

<hr>
<h2 id='plot.gformula_binary_eof'>Plot method for objects of class &quot;gformula_binary_eof&quot;</h2><span id='topic+plot.gformula_binary_eof'></span>

<h3>Description</h3>

<p>This function generates graphs of the mean simulated vs. observed values at each time point of the
time-varying covariates under the natural course. For categorical covariates,
the observed and simulated probability of each level are plotted at each time point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'gformula_binary_eof'
plot(
  x,
  covnames = NULL,
  ncol = NULL,
  nrow = NULL,
  common.legend = TRUE,
  legend = "bottom",
  xlab = NULL,
  ylab_cov = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.gformula_binary_eof_+3A_x">x</code></td>
<td>
<p>Object of class &quot;gformula_binary_eof&quot;.</p>
</td></tr>
<tr><td><code id="plot.gformula_binary_eof_+3A_covnames">covnames</code></td>
<td>
<p>Vector of character strings specifying the names of the time-varying covariates to be plotted. The ordering of covariates given here is used in the plot grid. Time-varying covariates of type <code>"categorical time"</code> cannot be included. By default, this argument is set equal to the <code>covnames</code> argument used in <code><a href="#topic+gformula_binary_eof">gformula_binary_eof</a></code>, where covariates of type <code>"categorical time"</code> are removed.</p>
</td></tr>
<tr><td><code id="plot.gformula_binary_eof_+3A_ncol">ncol</code></td>
<td>
<p>Number of columns in the plot grid. By default, two columns are used when there is at least two plots.</p>
</td></tr>
<tr><td><code id="plot.gformula_binary_eof_+3A_nrow">nrow</code></td>
<td>
<p>Number of rows in the plot grid. By default, a maximum of six rows is used and additional plots are included in subsequent pages.</p>
</td></tr>
<tr><td><code id="plot.gformula_binary_eof_+3A_common.legend">common.legend</code></td>
<td>
<p>Logical scalar indicating whether to include a legend. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.gformula_binary_eof_+3A_legend">legend</code></td>
<td>
<p>Character string specifying the legend position. Valid values are <code>"top"</code>, <code>"bottom"</code>, <code>"left"</code>, <code>"right"</code>, and <code>"none"</code>. The default is <code>"bottom"</code>.</p>
</td></tr>
<tr><td><code id="plot.gformula_binary_eof_+3A_xlab">xlab</code></td>
<td>
<p>Character string for the x axes of all plots. By default, this argument is set to the <code>time_name</code> argument specified in <code><a href="#topic+gformula_binary_eof">gformula_binary_eof</a></code>.</p>
</td></tr>
<tr><td><code id="plot.gformula_binary_eof_+3A_ylab_cov">ylab_cov</code></td>
<td>
<p>Vector of character strings for the y axes of the plots for the covariates. This argument must be the same length as <code>covnames</code>. The i-th element of this argument corresponds to the plot for the i-th element of <code>covnames</code>.</p>
</td></tr>
<tr><td><code id="plot.gformula_binary_eof_+3A_...">...</code></td>
<td>
<p>Other arguments, which are passed to <code><a href="ggpubr.html#topic+ggarrange">ggarrange</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class &quot;ggarrange&quot;. See documentation of <code><a href="ggpubr.html#topic+ggarrange">ggarrange</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gformula_binary_eof">gformula_binary_eof</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Estimating the effect of threshold interventions on the mean of a binary
## end of follow-up outcome

id &lt;- 'id_num'
time_name &lt;- 'time'
covnames &lt;- c('cov1', 'cov2', 'treat')
outcome_name &lt;- 'outcome'
histories &lt;- c(lagged, cumavg)
histvars &lt;- list(c('treat', 'cov1', 'cov2'), c('cov1', 'cov2'))
covtypes &lt;- c('binary', 'zero-inflated normal', 'normal')
covparams &lt;- list(covmodels = c(cov1 ~ lag1_treat + lag1_cov1 + lag1_cov2 + cov3 +
                                  time,
                                cov2 ~ lag1_treat + cov1 + lag1_cov1 + lag1_cov2 +
                                  cov3 + time,
                                treat ~ lag1_treat + cumavg_cov1 +
                                  cumavg_cov2 + cov3 + time))
ymodel &lt;- outcome ~  treat + cov1 + cov2 + lag1_cov1 + lag1_cov2 + cov3
intvars &lt;- list('treat', 'treat')
interventions &lt;- list(list(c(static, rep(0, 7))),
                      list(c(threshold, 1, Inf)))
int_descript &lt;- c('Never treat', 'Threshold - lower bound 1')
nsimul &lt;- 10000
ncores &lt;- 2

gform_bin_eof &lt;- gformula_binary_eof(obs_data = binary_eofdata, id = id,
                                     time_name = time_name,
                                     covnames = covnames,
                                     outcome_name = outcome_name,
                                     covtypes = covtypes,
                                     covparams = covparams,
                                     ymodel = ymodel,
                                     intvars = intvars,
                                     interventions = interventions,
                                     int_descript = int_descript,
                                     histories = histories, histvars = histvars,
                                     basecovs = c("cov3"), seed = 1234,
                                     parallel = TRUE, nsamples = 5,
                                     nsimul = nsimul, ncores = ncores)
plot(gform_bin_eof)


</code></pre>

<hr>
<h2 id='plot.gformula_continuous_eof'>Plot method for objects of class &quot;gformula_continuous_eof&quot;</h2><span id='topic+plot.gformula_continuous_eof'></span>

<h3>Description</h3>

<p>This function generates graphs of the mean simulated vs. observed values at each time point of the
time-varying covariates under the natural course. For categorical covariates,
the observed and simulated probability of each level are plotted at each time point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'gformula_continuous_eof'
plot(
  x,
  covnames = NULL,
  ncol = NULL,
  nrow = NULL,
  common.legend = TRUE,
  legend = "bottom",
  xlab = NULL,
  ylab_cov = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.gformula_continuous_eof_+3A_x">x</code></td>
<td>
<p>Object of class &quot;gformula_continuous_eof&quot;.</p>
</td></tr>
<tr><td><code id="plot.gformula_continuous_eof_+3A_covnames">covnames</code></td>
<td>
<p>Vector of character strings specifying the names of the time-varying covariates to be plotted. The ordering of covariates given here is used in the plot grid. Time-varying covariates of type <code>"categorical time"</code> cannot be included. By default, this argument is set equal to the <code>covnames</code> argument used in <code><a href="#topic+gformula_continuous_eof">gformula_continuous_eof</a></code>, where covariates of type <code>"categorical time"</code> are removed.</p>
</td></tr>
<tr><td><code id="plot.gformula_continuous_eof_+3A_ncol">ncol</code></td>
<td>
<p>Number of columns in the plot grid. By default, two columns are used when there is at least two plots.</p>
</td></tr>
<tr><td><code id="plot.gformula_continuous_eof_+3A_nrow">nrow</code></td>
<td>
<p>Number of rows in the plot grid. By default, a maximum of six rows is used and additional plots are included in subsequent pages.</p>
</td></tr>
<tr><td><code id="plot.gformula_continuous_eof_+3A_common.legend">common.legend</code></td>
<td>
<p>Logical scalar indicating whether to include a legend. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.gformula_continuous_eof_+3A_legend">legend</code></td>
<td>
<p>Character string specifying the legend position. Valid values are <code>"top"</code>, <code>"bottom"</code>, <code>"left"</code>, <code>"right"</code>, and <code>"none"</code>. The default is <code>"bottom"</code>.</p>
</td></tr>
<tr><td><code id="plot.gformula_continuous_eof_+3A_xlab">xlab</code></td>
<td>
<p>Character string for the x axes of all plots. By default, this argument is set to the <code>time_name</code> argument specified in <code><a href="#topic+gformula_continuous_eof">gformula_continuous_eof</a></code>.</p>
</td></tr>
<tr><td><code id="plot.gformula_continuous_eof_+3A_ylab_cov">ylab_cov</code></td>
<td>
<p>Vector of character strings for the y axes of the plots for the covariates. This argument must be the same length as <code>covnames</code>. The i-th element of this argument corresponds to the plot for the i-th element of <code>covnames</code>.</p>
</td></tr>
<tr><td><code id="plot.gformula_continuous_eof_+3A_...">...</code></td>
<td>
<p>Other arguments, which are passed to <code><a href="ggpubr.html#topic+ggarrange">ggarrange</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class &quot;ggarrange&quot;. See documentation of <code><a href="ggpubr.html#topic+ggarrange">ggarrange</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gformula_continuous_eof">gformula_continuous_eof</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Estimating the effect of treatment strategies on the mean of a continuous
## end of follow-up outcome

library('Hmisc')
id &lt;- 'id'
time_name &lt;- 't0'
covnames &lt;- c('L1', 'L2', 'A')
outcome_name &lt;- 'Y'
covtypes &lt;- c('categorical', 'normal', 'binary')
histories &lt;- c(lagged)
histvars &lt;- list(c('A', 'L1', 'L2'))
covparams &lt;- list(covmodels = c(L1 ~ lag1_A + lag1_L1 + L3 + t0 +
                                  rcspline.eval(lag1_L2, knots = c(-1, 0, 1)),
                                L2 ~ lag1_A + L1 + lag1_L1 + lag1_L2 + L3 + t0,
                                A ~ lag1_A + L1 + L2 + lag1_L1 + lag1_L2 + L3 + t0))
ymodel &lt;- Y ~ A + L1 + L2 + lag1_A + lag1_L1 + lag1_L2 + L3
intvars &lt;- list('A', 'A')
interventions &lt;- list(list(c(static, rep(0, 7))),
                      list(c(static, rep(1, 7))))
int_descript &lt;- c('Never treat', 'Always treat')
nsimul &lt;- 10000

gform_cont_eof &lt;- gformula_continuous_eof(obs_data = continuous_eofdata,
                                          id = id,
                                          time_name = time_name,
                                          covnames = covnames,
                                          outcome_name = outcome_name,
                                          covtypes = covtypes,
                                          covparams = covparams, ymodel = ymodel,
                                          intvars = intvars,
                                          interventions = interventions,
                                          int_descript = int_descript,
                                          histories = histories, histvars = histvars,
                                          basecovs = c("L3"),
                                          nsimul = nsimul, seed = 1234)
plot(gform_cont_eof)


</code></pre>

<hr>
<h2 id='plot.gformula_survival'>Plot method for objects of class &quot;gformula_survival&quot;</h2><span id='topic+plot.gformula_survival'></span>

<h3>Description</h3>

<p>This function generates graphs of the mean simulated vs. observed values at each time point of the
time-varying covariates, risk, and survival under the natural course. For categorical covariates,
the observed and simulated probability of each level are plotted at each time point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'gformula_survival'
plot(
  x,
  covnames = NULL,
  risk = TRUE,
  survival = FALSE,
  ncol = NULL,
  nrow = NULL,
  common.legend = TRUE,
  legend = "bottom",
  xlab = NULL,
  ylab_cov = NULL,
  ylab_risk = "risk",
  ylab_surv = "survival",
  pos_risk = NULL,
  pos_surv = NULL,
  ci_risk = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.gformula_survival_+3A_x">x</code></td>
<td>
<p>Object of class &quot;gformula_survival&quot;.</p>
</td></tr>
<tr><td><code id="plot.gformula_survival_+3A_covnames">covnames</code></td>
<td>
<p>Vector of character strings specifying the names of the time-varying covariates to be plotted. The ordering of covariates given here is used in the plot grid. Time-varying covariates of type <code>"categorical time"</code> cannot be included. To plot none of the time-varying covariates, set this argument to <code>NA</code>. By default, this argument is set equal to the <code>covnames</code> argument used in <code><a href="#topic+gformula_survival">gformula_survival</a></code>, where covariates of type 'categorical time' are removed.</p>
</td></tr>
<tr><td><code id="plot.gformula_survival_+3A_risk">risk</code></td>
<td>
<p>Logical scalar indicating whether to include a plot for the risk. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.gformula_survival_+3A_survival">survival</code></td>
<td>
<p>Logical scalar indicating whether to include a plot for the survival. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="plot.gformula_survival_+3A_ncol">ncol</code></td>
<td>
<p>Number of columns in the plot grid. By default, two columns are used when there is at least two plots.</p>
</td></tr>
<tr><td><code id="plot.gformula_survival_+3A_nrow">nrow</code></td>
<td>
<p>Number of rows in the plot grid. By default, a maximum of six rows is used and additional plots are included in subsequent pages.</p>
</td></tr>
<tr><td><code id="plot.gformula_survival_+3A_common.legend">common.legend</code></td>
<td>
<p>Logical scalar indicating whether to include a legend. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.gformula_survival_+3A_legend">legend</code></td>
<td>
<p>Character string specifying the legend position. Valid values are <code>"top"</code>, <code>"bottom"</code>, <code>"left"</code>, <code>"right"</code>, and <code>"none"</code>. The default is <code>"bottom"</code>.</p>
</td></tr>
<tr><td><code id="plot.gformula_survival_+3A_xlab">xlab</code></td>
<td>
<p>Character string for the x axes of all plots. By default, this argument is set to the <code>time_name</code> argument specified in <code><a href="#topic+gformula_survival">gformula_survival</a></code>.</p>
</td></tr>
<tr><td><code id="plot.gformula_survival_+3A_ylab_cov">ylab_cov</code></td>
<td>
<p>Vector of character strings for the y axes of the plots for the covariates. This argument must be the same length as <code>covnames</code>. The i-th element of this argument corresponds to the plot for the i-th element of <code>covnames</code>.</p>
</td></tr>
<tr><td><code id="plot.gformula_survival_+3A_ylab_risk">ylab_risk</code></td>
<td>
<p>Character string for the y axis of the plot for the risk (if applicable). The default is <code>"risk"</code>.</p>
</td></tr>
<tr><td><code id="plot.gformula_survival_+3A_ylab_surv">ylab_surv</code></td>
<td>
<p>Character string for the y axis of the plot for the survival (if applicable). The default is <code>"survival"</code>.</p>
</td></tr>
<tr><td><code id="plot.gformula_survival_+3A_pos_risk">pos_risk</code></td>
<td>
<p>Integer specifying the position at which to order the risk plot (if applicable). By default, this argument is set to the number of plots in the grid minus one (i.e., orders the risk plot second last).</p>
</td></tr>
<tr><td><code id="plot.gformula_survival_+3A_pos_surv">pos_surv</code></td>
<td>
<p>Integer specifying the position at which to order the survival plot (if applicable). By default, this argument is set to the number of plots in the grid (i.e., orders the survival plot last).</p>
</td></tr>
<tr><td><code id="plot.gformula_survival_+3A_ci_risk">ci_risk</code></td>
<td>
<p>Logical scalar specifying whether to include error bars for the 95% confidence intervals of the estimated risk under the natural course. This argument is only effective if the argument <code>nsamples</code> was set to a positive value in <code><a href="#topic+gformula_survival">gformula_survival</a></code>. The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.gformula_survival_+3A_...">...</code></td>
<td>
<p>Other arguments, which are passed to <code><a href="ggpubr.html#topic+ggarrange">ggarrange</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class &quot;ggarrange&quot;. See documentation of <code><a href="ggpubr.html#topic+ggarrange">ggarrange</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gformula_survival">gformula_survival</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Estimating the effect of static treatment strategies on risk of a
## failure event

id &lt;- 'id'
time_points &lt;- 7
time_name &lt;- 't0'
covnames &lt;- c('L1', 'L2', 'A')
outcome_name &lt;- 'Y'
covtypes &lt;- c('binary', 'bounded normal', 'binary')
histories &lt;- c(lagged, lagavg)
histvars &lt;- list(c('A', 'L1', 'L2'), c('L1', 'L2'))
covparams &lt;- list(covmodels = c(L1 ~ lag1_A + lag_cumavg1_L1 + lag_cumavg1_L2 +
                                  L3 + t0,
                                L2 ~ lag1_A + L1 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0,
                                A ~ lag1_A + L1 + L2 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0))
ymodel &lt;- Y ~ A + L1 + L2 + L3 + lag1_A + lag1_L1 + lag1_L2 + t0
intvars &lt;- list('A', 'A')
interventions &lt;- list(list(c(static, rep(0, time_points))),
                      list(c(static, rep(1, time_points))))
int_descript &lt;- c('Never treat', 'Always treat')
nsimul &lt;- 10000

gform_basic &lt;- gformula_survival(obs_data = basicdata_nocomp, id = id,
                                 time_points = time_points,
                                 time_name = time_name, covnames = covnames,
                                 outcome_name = outcome_name,
                                 covtypes = covtypes,
                                 covparams = covparams, ymodel = ymodel,
                                 intvars = intvars,
                                 interventions = interventions,
                                 int_descript = int_descript,
                                 histories = histories, histvars = histvars,
                                 basecovs = c('L3'), nsimul = nsimul,
                                 seed = 1234)
plot(gform_basic)



</code></pre>

<hr>
<h2 id='pred_fun_cov'>Fit Covariate Models</h2><span id='topic+pred_fun_cov'></span>

<h3>Description</h3>

<p>This internal function fits a model for each covariate using the observed data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pred_fun_cov(
  covparams,
  covnames,
  covtypes,
  covfits_custom,
  restrictions,
  time_name,
  obs_data,
  model_fits
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pred_fun_cov_+3A_covparams">covparams</code></td>
<td>
<p>List of vectors, where each vector contains information for
one parameter used in the modeling of the time-varying covariates (e.g.,
model statement, family, link function, etc.). Each vector
must be the same length as <code>covnames</code> and in the same order.</p>
</td></tr>
<tr><td><code id="pred_fun_cov_+3A_covnames">covnames</code></td>
<td>
<p>Vector of character strings specifying the names of the time-varying covariates in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="pred_fun_cov_+3A_covtypes">covtypes</code></td>
<td>
<p>Vector of character strings specifying the &quot;type&quot; of each time-varying covariate included in <code>covnames</code>. The possible &quot;types&quot; are: <code>"binary"</code>, <code>"normal"</code>, <code>"categorical"</code>, <code>"bounded normal"</code>, <code>"zero-inflated normal"</code>, <code>"truncated normal"</code>, <code>"absorbing"</code>, <code>"categorical time"</code>, and <code>"custom"</code>.</p>
</td></tr>
<tr><td><code id="pred_fun_cov_+3A_covfits_custom">covfits_custom</code></td>
<td>
<p>Vector containing custom fit functions for time-varying covariates that
do not fall within the pre-defined covariate types. It should be in
the same order <code>covnames</code>. If a custom fit function is not
required for a particular covariate (e.g., if the first
covariate is of type <code>"binary"</code> but the second is of type <code>"custom"</code>), then that
index should be set to <code>NA</code>.</p>
</td></tr>
<tr><td><code id="pred_fun_cov_+3A_restrictions">restrictions</code></td>
<td>
<p>List of vectors. Each vector contains as its first entry a covariate for which
<em>a priori</em> knowledge of its distribution is available; its second entry a condition
under which no knowledge of its distribution is available and that must be <code>TRUE</code>
for the distribution of that covariate given that condition to be estimated via a parametric
model or other fitting procedure; its third entry a function for estimating the distribution
of that covariate given the condition in the second entry is false such that <em>a priori</em> knowledge
of the covariate distribution is available; and its fourth entry a value used by the function in the
third entry. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="pred_fun_cov_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="pred_fun_cov_+3A_obs_data">obs_data</code></td>
<td>
<p>Data on which the models are fit.</p>
</td></tr>
<tr><td><code id="pred_fun_cov_+3A_model_fits">model_fits</code></td>
<td>
<p>Logical scalar indicating whether to return the fitted models. The default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of fitted models, one for each covariate in <code>covnames</code>.
</p>

<hr>
<h2 id='pred_fun_D'>Fit Competing Event Model</h2><span id='topic+pred_fun_D'></span>

<h3>Description</h3>

<p>This internal function fits a generalized linear model (GLM) for the competing event variable using the observed data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pred_fun_D(model, compevent_restrictions, obs_data, model_fits)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pred_fun_D_+3A_model">model</code></td>
<td>
<p>Model statement for competing event variable.</p>
</td></tr>
<tr><td><code id="pred_fun_D_+3A_compevent_restrictions">compevent_restrictions</code></td>
<td>
<p>List of vectors. Each vector containins as its first entry
a condition and its second entry an integer. When the
condition is <code>TRUE</code>, the competing event variable is simulated
according to the fitted model; when the condition is <code>FALSE</code>,
the competing event variable takes on the value in the
second entry.</p>
</td></tr>
<tr><td><code id="pred_fun_D_+3A_obs_data">obs_data</code></td>
<td>
<p>Data on which the model is fit.</p>
</td></tr>
<tr><td><code id="pred_fun_D_+3A_model_fits">model_fits</code></td>
<td>
<p>Logical scalar indicating whether to return the fitted models. The default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Fitted model for the competing event variable.
</p>

<hr>
<h2 id='pred_fun_Y'>Fit Outcome Model</h2><span id='topic+pred_fun_Y'></span>

<h3>Description</h3>

<p>This internal function fits a generalized linear model (GLM) for the outcome variable using the observed data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pred_fun_Y(
  model,
  yrestrictions,
  outcome_type,
  outcome_name,
  time_name,
  obs_data,
  model_fits
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pred_fun_Y_+3A_model">model</code></td>
<td>
<p>Model statement for the outcome variable.</p>
</td></tr>
<tr><td><code id="pred_fun_Y_+3A_yrestrictions">yrestrictions</code></td>
<td>
<p>List of vectors. Each vector containins as its first entry
a condition and its second entry an integer. When the
condition is <code>TRUE</code>, the outcome variable is simulated
according to the fitted model; when the condition is <code>FALSE</code>,
the outcome variable takes on the value in the second entry.</p>
</td></tr>
<tr><td><code id="pred_fun_Y_+3A_outcome_type">outcome_type</code></td>
<td>
<p>Character string specifying the &quot;type&quot; of the outcome. The possible &quot;types&quot; are: <code>"survival"</code>, <code>"continuous_eof"</code>, and <code>"binary_eof"</code>.</p>
</td></tr>
<tr><td><code id="pred_fun_Y_+3A_outcome_name">outcome_name</code></td>
<td>
<p>Character string specifying the name of the outcome variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="pred_fun_Y_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="pred_fun_Y_+3A_obs_data">obs_data</code></td>
<td>
<p>Data on which the model is fit.</p>
</td></tr>
<tr><td><code id="pred_fun_Y_+3A_model_fits">model_fits</code></td>
<td>
<p>Logical scalar indicating whether to return the fitted models. The default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Fitted model for the outcome variable.
</p>

<hr>
<h2 id='predict_binomial'>Simulate Binary Values</h2><span id='topic+predict_binomial'></span>

<h3>Description</h3>

<p>This internal function simulates covariate values from a binomial distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predict_binomial(x, size, prob)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict_binomial_+3A_x">x</code></td>
<td>
<p>Integer specifying the number of observations to be simulated.</p>
</td></tr>
<tr><td><code id="predict_binomial_+3A_size">size</code></td>
<td>
<p>Integer specifying the number of trials.</p>
</td></tr>
<tr><td><code id="predict_binomial_+3A_prob">prob</code></td>
<td>
<p>Numeric vector specifying the probabilities.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric vector of simulated covariate values under the binomial distribution.
</p>

<hr>
<h2 id='predict_normal'>Simulate Normal Values</h2><span id='topic+predict_normal'></span>

<h3>Description</h3>

<p>This internal function simulates covariate values from a normal distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predict_normal(x, mean, est_sd = NA)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict_normal_+3A_x">x</code></td>
<td>
<p>Integer specifying the number of observations to be simulated.</p>
</td></tr>
<tr><td><code id="predict_normal_+3A_mean">mean</code></td>
<td>
<p>Numeric scalar specifying the mean of the distribution.</p>
</td></tr>
<tr><td><code id="predict_normal_+3A_est_sd">est_sd</code></td>
<td>
<p>Numeric scalar specifying the standard deviation of the distribution.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric vector of simulated covariate values under the normal distribution.
</p>

<hr>
<h2 id='predict_trunc_normal'>Simulate Truncated Normal Values</h2><span id='topic+predict_trunc_normal'></span>

<h3>Description</h3>

<p>This internal function simulates covariate values from a normal distribution truncated
on one side.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predict_trunc_normal(x, mean, est_sd, a, b)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict_trunc_normal_+3A_x">x</code></td>
<td>
<p>Integer specifying the number of observations to be simulated.</p>
</td></tr>
<tr><td><code id="predict_trunc_normal_+3A_mean">mean</code></td>
<td>
<p>Numeric scalar specifying the mean of the distribution.</p>
</td></tr>
<tr><td><code id="predict_trunc_normal_+3A_est_sd">est_sd</code></td>
<td>
<p>Numeric scalar specifying the standard deviation of the distribution.</p>
</td></tr>
<tr><td><code id="predict_trunc_normal_+3A_a">a</code></td>
<td>
<p>Numeric scalar specifying the lower bound of truncation.</p>
</td></tr>
<tr><td><code id="predict_trunc_normal_+3A_b">b</code></td>
<td>
<p>Numeric scalar specifying the upper bound of truncation.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric vector of simulated covariate values under the truncated normal
distribution.
</p>

<hr>
<h2 id='print.gformula_survival'>Print and summary methods for &quot;gformula&quot; objects</h2><span id='topic+print.gformula_survival'></span><span id='topic+print.gformula_continuous_eof'></span><span id='topic+print.gformula_binary_eof'></span><span id='topic+summary.gformula'></span><span id='topic+print.summary.gformula'></span>

<h3>Description</h3>

<p>Print and summary method for objects of class &quot;gformula_survival&quot;, &quot;gformula_continuous_eof&quot;, or &quot;gformula_binary_eof&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'gformula_survival'
print(
  x,
  all_times = FALSE,
  coefficients = FALSE,
  stderrs = FALSE,
  rmses = FALSE,
  hazardratio = FALSE,
  fits = FALSE,
  ...
)

## S3 method for class 'gformula_continuous_eof'
print(
  x,
  coefficients = FALSE,
  stderrs = FALSE,
  rmses = FALSE,
  fits = FALSE,
  ...
)

## S3 method for class 'gformula_binary_eof'
print(
  x,
  coefficients = FALSE,
  stderrs = FALSE,
  rmses = FALSE,
  fits = FALSE,
  ...
)

## S3 method for class 'gformula'
summary(object, ...)

## S3 method for class 'summary.gformula'
print(
  x,
  all_times = TRUE,
  coefficients = FALSE,
  stderrs = FALSE,
  rmses = FALSE,
  hazardratio = FALSE,
  fits = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.gformula_survival_+3A_x">x</code></td>
<td>
<p>Object of class &quot;gformula_survival&quot;, &quot;gformula_continuous_eof&quot;, &quot;gformula_binary_eof&quot;, or &quot;summary.gformula&quot; (for <code>print</code>).</p>
</td></tr>
<tr><td><code id="print.gformula_survival_+3A_all_times">all_times</code></td>
<td>
<p>Logical scalar indicating whether to print the results for all time points. This argument is only applicable to objects of class &quot;gformula_survival&quot;. If this argument is set to <code>FALSE</code>, the results are only shown for the final time point. The default is <code>FALSE</code> for <code>print</code> and <code>TRUE</code> for <code>summary</code>.</p>
</td></tr>
<tr><td><code id="print.gformula_survival_+3A_coefficients">coefficients</code></td>
<td>
<p>Logical scalar indicating whether to print the model coefficients. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="print.gformula_survival_+3A_stderrs">stderrs</code></td>
<td>
<p>Logical scalar indicating whether to print the standard error of the model coefficients. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="print.gformula_survival_+3A_rmses">rmses</code></td>
<td>
<p>Logical scalar indicating whether to print the model root mean square errors (RMSEs). The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="print.gformula_survival_+3A_hazardratio">hazardratio</code></td>
<td>
<p>Logical scalar indicating whether to print the hazard ratio between two interventions (if computed). If bootstrapping was used, 95% confidence intervals will be given. This argument is only applicable to objects of class &quot;gformula_survival&quot;. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="print.gformula_survival_+3A_fits">fits</code></td>
<td>
<p>Logical scalar indicating whether to print summaries of the fitted models for the time-varying covariates, outcome, and competing event (if applicable). This argument is only effective if the argument <code>model_fits</code> was set to <code>TRUE</code> in <code>gformula</code>. The default is <code>FALSE</code> for <code>print</code> and <code>TRUE</code> for <code>summary</code>.</p>
</td></tr>
<tr><td><code id="print.gformula_survival_+3A_...">...</code></td>
<td>
<p>Other arguments.</p>
</td></tr>
<tr><td><code id="print.gformula_survival_+3A_object">object</code></td>
<td>
<p>Object of class &quot;gformula&quot; (for <code>summary</code>).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No value is returned for the <code>print</code> functions. The <code>summary</code> function returns the object passed to it and adds the class &quot;summary.gformula&quot; to it.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gformula">gformula</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Estimating the effect of static treatment strategies on risk of a
## failure event

id &lt;- 'id'
time_points &lt;- 7
time_name &lt;- 't0'
covnames &lt;- c('L1', 'L2', 'A')
outcome_name &lt;- 'Y'
outcome_type &lt;- 'survival'
covtypes &lt;- c('binary', 'bounded normal', 'binary')
histories &lt;- c(lagged, lagavg)
histvars &lt;- list(c('A', 'L1', 'L2'), c('L1', 'L2'))
covparams &lt;- list(covmodels = c(L1 ~ lag1_A + lag_cumavg1_L1 + lag_cumavg1_L2 +
                                  L3 + t0,
                                L2 ~ lag1_A + L1 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0,
                                A ~ lag1_A + L1 + L2 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0))
ymodel &lt;- Y ~ A + L1 + L2 + L3 + lag1_A + lag1_L1 + lag1_L2 + t0
intvars &lt;- list('A', 'A')
interventions &lt;- list(list(c(static, rep(0, time_points))),
                      list(c(static, rep(1, time_points))))
int_descript &lt;- c('Never treat', 'Always treat')
nsimul &lt;- 10000

gform_basic &lt;- gformula(obs_data = basicdata_nocomp, id = id,
                        time_points = time_points,
                        time_name = time_name, covnames = covnames,
                        outcome_name = outcome_name,
                        outcome_type = outcome_type, covtypes = covtypes,
                        covparams = covparams, ymodel = ymodel,
                        intvars = intvars,
                        interventions = interventions,
                        int_descript = int_descript,
                        histories = histories, histvars = histvars,
                        basecovs = c('L3'), nsimul = nsimul,
                        seed = 1234)
summary(gform_basic)


</code></pre>

<hr>
<h2 id='rmse_calculate'>Calculate RMSE for Covariate, Outcome, and Competing Risk Models</h2><span id='topic+rmse_calculate'></span>

<h3>Description</h3>

<p>This internal function calculates root mean square error (RMSE) for the covariate (and the outcome and competing event, if applicable) models fit on
the observed data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmse_calculate(i, fits, covnames, covtypes)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rmse_calculate_+3A_i">i</code></td>
<td>
<p>Integer specifying the index of <code>fits</code>.</p>
</td></tr>
<tr><td><code id="rmse_calculate_+3A_fits">fits</code></td>
<td>
<p>List of fitted models.</p>
</td></tr>
<tr><td><code id="rmse_calculate_+3A_covnames">covnames</code></td>
<td>
<p>Vector of character strings specifying the names of the time-varying covariates in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="rmse_calculate_+3A_covtypes">covtypes</code></td>
<td>
<p>Vector of character strings specifying the &quot;type&quot; of each time-varying covariate included in <code>covnames</code>. The possible &quot;types&quot; are: <code>"binary"</code>, <code>"normal"</code>, <code>"categorical"</code>, <code>"bounded normal"</code>, <code>"zero-inflated normal"</code>, <code>"truncated normal"</code>, <code>"absorbing"</code>, <code>"categorical time"</code>, and <code>"custom"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The RMSE for the model.
</p>

<hr>
<h2 id='simple_restriction'>Simple Restriction</h2><span id='topic+simple_restriction'></span>

<h3>Description</h3>

<p>This function assists the implementation of a restriction on a covariate in the data
table <code>newdf</code> by setting lines where the covariate is restricted to a user-specified value.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simple_restriction(newdf, pool, restriction, time_name, t, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simple_restriction_+3A_newdf">newdf</code></td>
<td>
<p>Data table containing the simulated data at time <code class="reqn">t</code>.</p>
</td></tr>
<tr><td><code id="simple_restriction_+3A_pool">pool</code></td>
<td>
<p>Data table containing the simulated data at times before <code class="reqn">t</code>.</p>
</td></tr>
<tr><td><code id="simple_restriction_+3A_restriction">restriction</code></td>
<td>
<p>List of vectors. Each vector contains as its first entry
the covariate affected by the restriction; its second entry
the condition that must be <code>TRUE</code> for the covariate to be
modeled; its third entry a function that executes other specific actions
based on the condition (in this case, this function); and its fourth
entry some value used by the function (in this case, the value
the user desires to assign to the covariate when it is not modeled).</p>
</td></tr>
<tr><td><code id="simple_restriction_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>pool</code> and <code>newdf</code>.</p>
</td></tr>
<tr><td><code id="simple_restriction_+3A_t">t</code></td>
<td>
<p>Integer specifying the current time index.</p>
</td></tr>
<tr><td><code id="simple_restriction_+3A_...">...</code></td>
<td>
<p>This argument is not used in this function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No value is returned. The data table <code>newdf</code> is modified in place.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Estimating the effect of static treatment strategies on risk of a
## failure event with a simple restriction

id &lt;- 'id'
time_points &lt;- 7
time_name &lt;- 't0'
covnames &lt;- c('L1', 'L2', 'A')
outcome_name &lt;- 'Y'
covtypes &lt;- c('binary', 'bounded normal', 'binary')
histories &lt;- c(lagged, lagavg)
histvars &lt;- list(c('A', 'L1', 'L2'), c('L1', 'L2'))
covparams &lt;- list(covmodels = c(L1 ~ lag1_A + lag_cumavg1_L1 + lag_cumavg1_L2 +
                                  L3 + t0,
                                L2 ~ lag1_A + L1 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0,
                                A ~ lag1_A + L1 + L2 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0))
ymodel &lt;- Y ~ A + L1 + L2 + L3 + lag1_A + lag1_L1 + lag1_L2 + t0
intvars &lt;- list('A', 'A')
interventions &lt;- list(list(c(static, rep(0, time_points))),
                      list(c(static, rep(1, time_points))))
int_descript &lt;- c('Never treat', 'Always treat')
nsimul &lt;- 10000

# At t0 == 5, assume we have deterministic knowledge that L1 equals 0
restrictions &lt;- list(c('L1', 't0 != 5', simple_restriction, 0))

gform_basic &lt;- gformula_survival(obs_data = basicdata_nocomp, id = id,
                                 time_points = time_points,
                                 time_name = time_name, covnames = covnames,
                                 outcome_name = outcome_name,
                                 covtypes = covtypes,
                                 covparams = covparams, ymodel = ymodel,
                                 intvars = intvars,
                                 interventions = interventions,
                                 restrictions = restrictions,
                                 int_descript = int_descript,
                                 histories = histories, histvars = histvars,
                                 basecovs = c('L3'), nsimul = nsimul,
                                 seed = 1234)
gform_basic


</code></pre>

<hr>
<h2 id='simulate'>Simulate Counterfactual Outcomes Under Intervention</h2><span id='topic+simulate'></span>

<h3>Description</h3>

<p>This internal function simulates a new dataset containing covariates, outcome probabilities, competing event
probabilities (if any), outcomes, and competing events (if any) based on an observed
dataset and a user-specified intervention.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate(
  o,
  fitcov,
  fitY,
  fitD,
  yrestrictions,
  compevent_restrictions,
  restrictions,
  outcome_name,
  compevent_name,
  time_name,
  intvars,
  interventions,
  int_times,
  histvars,
  histvals,
  histories,
  comprisk,
  ranges,
  outcome_type,
  subseed,
  obs_data,
  time_points,
  parallel,
  covnames,
  covtypes,
  covparams,
  covpredict_custom,
  basecovs,
  max_visits,
  baselags,
  below_zero_indicator,
  min_time,
  show_progress,
  pb,
  int_visit_type,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simulate_+3A_o">o</code></td>
<td>
<p>Integer specifying the index of the current intervention.</p>
</td></tr>
<tr><td><code id="simulate_+3A_fitcov">fitcov</code></td>
<td>
<p>List of model fits for the time-varying covariates.</p>
</td></tr>
<tr><td><code id="simulate_+3A_fity">fitY</code></td>
<td>
<p>Model fit for the outcome variable.</p>
</td></tr>
<tr><td><code id="simulate_+3A_fitd">fitD</code></td>
<td>
<p>Model fit for the competing event variable, if any.</p>
</td></tr>
<tr><td><code id="simulate_+3A_yrestrictions">yrestrictions</code></td>
<td>
<p>List of vectors. Each vector containins as its first entry
a condition and its second entry an integer. When the
condition is <code>TRUE</code>, the outcome variable is simulated
according to the fitted model; when the condition is <code>FALSE</code>,
the outcome variable takes on the value in the second entry.</p>
</td></tr>
<tr><td><code id="simulate_+3A_compevent_restrictions">compevent_restrictions</code></td>
<td>
<p>List of vectors. Each vector containins as its first entry
a condition and its second entry an integer. When the
condition is <code>TRUE</code>, the competing event variable is simulated
according to the fitted model; when the condition is <code>FALSE</code>,
the competing event variable takes on the value in the
second entry.</p>
</td></tr>
<tr><td><code id="simulate_+3A_restrictions">restrictions</code></td>
<td>
<p>List of vectors. Each vector contains as its first entry a covariate for which
<em>a priori</em> knowledge of its distribution is available; its second entry a condition
under which no knowledge of its distribution is available and that must be <code>TRUE</code>
for the distribution of that covariate given that condition to be estimated via a parametric
model or other fitting procedure; its third entry a function for estimating the distribution
of that covariate given the condition in the second entry is false such that <em>a priori</em> knowledge
of the covariate distribution is available; and its fourth entry a value used by the function in the
third entry. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="simulate_+3A_outcome_name">outcome_name</code></td>
<td>
<p>Character string specifying the name of the outcome variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="simulate_+3A_compevent_name">compevent_name</code></td>
<td>
<p>Character string specifying the name of the competing event variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="simulate_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="simulate_+3A_intvars">intvars</code></td>
<td>
<p>List, whose elements are vectors of character strings. The kth vector in <code>intvars</code> specifies the name(s) of the variable(s) to be intervened
on in each round of the simulation under the kth intervention in <code>interventions</code>.</p>
</td></tr>
<tr><td><code id="simulate_+3A_interventions">interventions</code></td>
<td>
<p>List, whose elements are lists of vectors. Each list in <code>interventions</code> specifies a unique intervention on the relevant variable(s) in <code>intvars</code>. Each vector contains a function
implementing a particular intervention on a single variable, optionally
followed by one or more &quot;intervention values&quot; (i.e.,
integers used to specify the treatment regime).</p>
</td></tr>
<tr><td><code id="simulate_+3A_int_times">int_times</code></td>
<td>
<p>List, whose elements are lists of vectors. The kth list in <code>int_times</code> corresponds to the kth intervention in <code>interventions</code>. Each vector specifies the time points in which the relevant intervention is applied on the corresponding variable in <code>intvars</code>.
When an intervention is not applied, the simulated natural course value is used. By default, this argument is set so that all interventions are applied in all time points.</p>
</td></tr>
<tr><td><code id="simulate_+3A_histvars">histvars</code></td>
<td>
<p>List of vectors. The kth vector specifies the names of the variables for which the kth history function
in <code>histories</code> is to be applied.</p>
</td></tr>
<tr><td><code id="simulate_+3A_histvals">histvals</code></td>
<td>
<p>List of length two. The first element is a numeric vector specifying the lags used in the model statements (e.g., if <code>lag1_varname</code> and <code>lag2_varname</code> were included in the model statements, this vector would be <code>c(1,2)</code>). The second element is a numeric vector specifying the lag averages used in the model statements.</p>
</td></tr>
<tr><td><code id="simulate_+3A_histories">histories</code></td>
<td>
<p>Vector of history functions to apply to the variables specified in <code>histvars</code>.</p>
</td></tr>
<tr><td><code id="simulate_+3A_comprisk">comprisk</code></td>
<td>
<p>Logical scalar indicating the presence of a competing event.</p>
</td></tr>
<tr><td><code id="simulate_+3A_ranges">ranges</code></td>
<td>
<p>List of vectors. Each vector contains the minimum and
maximum values of one of the covariates in <code>covnames</code>.</p>
</td></tr>
<tr><td><code id="simulate_+3A_outcome_type">outcome_type</code></td>
<td>
<p>Character string specifying the &quot;type&quot; of the outcome. The possible &quot;types&quot; are: <code>"survival"</code>, <code>"continuous_eof"</code>, and <code>"binary_eof"</code>.</p>
</td></tr>
<tr><td><code id="simulate_+3A_subseed">subseed</code></td>
<td>
<p>Integer specifying the seed for this simulation.</p>
</td></tr>
<tr><td><code id="simulate_+3A_obs_data">obs_data</code></td>
<td>
<p>Data table containing the observed data.</p>
</td></tr>
<tr><td><code id="simulate_+3A_time_points">time_points</code></td>
<td>
<p>Number of time points to simulate.</p>
</td></tr>
<tr><td><code id="simulate_+3A_parallel">parallel</code></td>
<td>
<p>Logical scalar indicating whether to parallelize simulations of
different interventions to multiple cores.</p>
</td></tr>
<tr><td><code id="simulate_+3A_covnames">covnames</code></td>
<td>
<p>Character string specifying the name of the competing event variable in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="simulate_+3A_covtypes">covtypes</code></td>
<td>
<p>Vector of character strings specifying the &quot;type&quot; of each time-varying covariate included in <code>covnames</code>. The possible &quot;types&quot; are: <code>"binary"</code>, <code>"normal"</code>, <code>"categorical"</code>, <code>"bounded normal"</code>, <code>"zero-inflated normal"</code>, <code>"truncated normal"</code>, <code>"absorbing"</code>, <code>"categorical time"</code>, and <code>"custom"</code>.</p>
</td></tr>
<tr><td><code id="simulate_+3A_covparams">covparams</code></td>
<td>
<p>List of vectors, where each vector contains information for
one parameter used in the modeling of the time-varying covariates (e.g.,
model statement, family, link function, etc.). Each vector
must be the same length as <code>covnames</code> and in the same order.
If a parameter is not required for a certain covariate, it
should be set to <code>NA</code> at that index.</p>
</td></tr>
<tr><td><code id="simulate_+3A_covpredict_custom">covpredict_custom</code></td>
<td>
<p>Vector containing custom prediction functions for time-varying
covariates that do not fall within the pre-defined covariate types.
It should be in the same order as <code>covnames</code>. If a custom
prediction function is not required for a particular
covariate, then that index should be set to <code>NA</code>.</p>
</td></tr>
<tr><td><code id="simulate_+3A_basecovs">basecovs</code></td>
<td>
<p>Vector of character strings specifying the names of baseline covariates in <code>obs_data</code>.</p>
</td></tr>
<tr><td><code id="simulate_+3A_max_visits">max_visits</code></td>
<td>
<p>A vector of one or more values denoting the maximum number of times
a binary covariate representing a visit process may be missed before
the individual is censored from the data (in the observed data) or
a visit is forced (in the simulated data). Multiple values exist in the
vector when the modeling of more than covariate is attached to a visit
process.</p>
</td></tr>
<tr><td><code id="simulate_+3A_baselags">baselags</code></td>
<td>
<p>Logical scalar for specifying the convention used for lagi and lag_cumavgi terms in the model statements when pre-baseline times are not
included in <code>obs_data</code> and when the current time index, <code class="reqn">t</code>, is such that <code class="reqn">t &lt; i</code>. If this argument is set to <code>FALSE</code>, the value
of all lagi and lag_cumavgi terms in this context are set to 0 (for non-categorical covariates) or the reference
level (for categorical covariates). If this argument is set to <code>TRUE</code>, the value of lagi and lag_cumavgi terms
are set to their values at time 0. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="simulate_+3A_below_zero_indicator">below_zero_indicator</code></td>
<td>
<p>Logical scalar indicating whether the observed data set contains rows for time <code class="reqn">t &lt; 0</code>.</p>
</td></tr>
<tr><td><code id="simulate_+3A_min_time">min_time</code></td>
<td>
<p>Numeric scalar specifying lowest value of time <code class="reqn">t</code> in the observed data set.</p>
</td></tr>
<tr><td><code id="simulate_+3A_show_progress">show_progress</code></td>
<td>
<p>Logical scalar indicating whether to print a progress bar for the number of bootstrap samples completed in the R console. This argument is only applicable when <code>parallel</code> is set to <code>FALSE</code> and bootstrap samples are used (i.e., <code>nsamples</code> is set to a value greater than 0). The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="simulate_+3A_pb">pb</code></td>
<td>
<p>Progress bar R6 object. See <code><a href="progress.html#topic+progress_bar">progress_bar</a></code> for further details.</p>
</td></tr>
<tr><td><code id="simulate_+3A_int_visit_type">int_visit_type</code></td>
<td>
<p>Vector of logicals. The kth element is a logical specifying whether to carry forward the intervened value (rather than the natural value) of the treatment variables(s) when performing a carry forward restriction type for the kth intervention in <code>interventions</code>.
When the kth element is set to <code>FALSE</code>, the natural value of the treatment variable(s) in the kth intervention in <code>interventions</code> will be carried forward.
By default, this argument is set so that the intervened value of the treatment variable(s) is carried forward for all interventions.</p>
</td></tr>
<tr><td><code id="simulate_+3A_...">...</code></td>
<td>
<p>Other arguments, which are passed to the functions in <code>covpredict_custom</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data table containing simulated data under the specified intervention.
</p>

<hr>
<h2 id='static'>Static Intervention</h2><span id='topic+static'></span>

<h3>Description</h3>

<p>This function implements a static intervention (i.e., either constant treatment or no treatment over
all time points) for the specified intervention variable in the data table <code>newdf</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>static(newdf, pool, intvar, intvals, time_name, t)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="static_+3A_newdf">newdf</code></td>
<td>
<p>Data table containing the simulated data at time <code class="reqn">t</code>.</p>
</td></tr>
<tr><td><code id="static_+3A_pool">pool</code></td>
<td>
<p>Data table containing the simulated data at times before <code class="reqn">t</code>.</p>
</td></tr>
<tr><td><code id="static_+3A_intvar">intvar</code></td>
<td>
<p>Character string specifying the name of the variable to be intervened on in each round of the simulation.</p>
</td></tr>
<tr><td><code id="static_+3A_intvals">intvals</code></td>
<td>
<p>A list of length 1. The entry is the value of static treatment to be assigned to <code>intvar</code>.</p>
</td></tr>
<tr><td><code id="static_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>pool</code> and <code>newdf</code>.</p>
</td></tr>
<tr><td><code id="static_+3A_t">t</code></td>
<td>
<p>Integer specifying the current time index.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No value is returned. The data table <code>newdf</code> is modified in place.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Estimating the effect of static treatment strategies on risk of a
## failure event

id &lt;- 'id'
time_points &lt;- 7
time_name &lt;- 't0'
covnames &lt;- c('L1', 'L2', 'A')
outcome_name &lt;- 'Y'
covtypes &lt;- c('binary', 'bounded normal', 'binary')
histories &lt;- c(lagged, lagavg)
histvars &lt;- list(c('A', 'L1', 'L2'), c('L1', 'L2'))
covparams &lt;- list(covmodels = c(L1 ~ lag1_A + lag_cumavg1_L1 + lag_cumavg1_L2 +
                                  L3 + t0,
                                L2 ~ lag1_A + L1 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0,
                                A ~ lag1_A + L1 + L2 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0))
ymodel &lt;- Y ~ A + L1 + L2 + L3 + lag1_A + lag1_L1 + lag1_L2 + t0
intvars &lt;- list('A', 'A')
interventions &lt;- list(list(c(static, rep(0, time_points))),
                      list(c(static, rep(1, time_points))))
int_descript &lt;- c('Never treat', 'Always treat')
nsimul &lt;- 10000

gform_basic &lt;- gformula_survival(obs_data = basicdata_nocomp, id = id,
                                 time_points = time_points,
                                 time_name = time_name, covnames = covnames,
                                 outcome_name = outcome_name,
                                 covtypes = covtypes,
                                 covparams = covparams, ymodel = ymodel,
                                 intvars = intvars,
                                 interventions = interventions,
                                 int_descript = int_descript,
                                 histories = histories, histvars = histvars,
                                 basecovs = c('L3'), nsimul = nsimul,
                                 seed = 1234)
gform_basic


</code></pre>

<hr>
<h2 id='threshold'>Threshold Intervention</h2><span id='topic+threshold'></span>

<h3>Description</h3>

<p>This function implements a threshold intervention (i.e., once treatment bypasses a certain
threshold, it remains at that threshold until end of follow-up) for the specified
intervention variable in the data table <code>newdf</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>threshold(newdf, pool, intvar, intvals, time_name, t)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="threshold_+3A_newdf">newdf</code></td>
<td>
<p>Data table containing the simulated data at time <code class="reqn">t</code>.</p>
</td></tr>
<tr><td><code id="threshold_+3A_pool">pool</code></td>
<td>
<p>Data table containing the simulated data at times before <code class="reqn">t</code>.</p>
</td></tr>
<tr><td><code id="threshold_+3A_intvar">intvar</code></td>
<td>
<p>Character string specifying the name of the variable to be intervened on in each round of the simulation.</p>
</td></tr>
<tr><td><code id="threshold_+3A_intvals">intvals</code></td>
<td>
<p>A list of length 2. The first entry is lower bound of the threshold, and the second entry is the upper bound.</p>
</td></tr>
<tr><td><code id="threshold_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>pool</code> and <code>newdf</code>.</p>
</td></tr>
<tr><td><code id="threshold_+3A_t">t</code></td>
<td>
<p>Integer specifying the current time index.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No value is returned. The data table <code>newdf</code> is modified in place.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Estimating the effect of threshold interventions on the mean of a binary
## end of follow-up outcome

id &lt;- 'id_num'
time_name &lt;- 'time'
covnames &lt;- c('cov1', 'cov2', 'treat')
outcome_name &lt;- 'outcome'
histories &lt;- c(lagged, cumavg)
histvars &lt;- list(c('treat', 'cov1', 'cov2'), c('cov1', 'cov2'))
covtypes &lt;- c('binary', 'zero-inflated normal', 'normal')
covparams &lt;- list(covmodels = c(cov1 ~ lag1_treat + lag1_cov1 + lag1_cov2 + cov3 +
                                  time,
                                cov2 ~ lag1_treat + cov1 + lag1_cov1 + lag1_cov2 +
                                  cov3 + time,
                                treat ~ lag1_treat + cumavg_cov1 +
                                  cumavg_cov2 + cov3 + time))
ymodel &lt;- outcome ~  treat + cov1 + cov2 + lag1_cov1 + lag1_cov2 + cov3
intvars &lt;- list('treat', 'treat')
interventions &lt;- list(list(c(static, rep(0, 7))),
                      list(c(threshold, 1, Inf)))
int_descript &lt;- c('Never treat', 'Threshold - lower bound 1')
nsimul &lt;- 10000
ncores &lt;- 2

gform_bin_eof &lt;- gformula_binary_eof(obs_data = binary_eofdata, id = id,
                                     time_name = time_name,
                                     covnames = covnames,
                                     outcome_name = outcome_name,
                                     covtypes = covtypes,
                                     covparams = covparams,
                                     ymodel = ymodel,
                                     intvars = intvars,
                                     interventions = interventions,
                                     int_descript = int_descript,
                                     histories = histories, histvars = histvars,
                                     basecovs = c("cov3"), seed = 1234,
                                     parallel = TRUE, nsamples = 5,
                                     nsimul = nsimul, ncores = ncores)
gform_bin_eof


</code></pre>

<hr>
<h2 id='vcov.gformula'>Variance-covariance method for objects of class &quot;gformula&quot;</h2><span id='topic+vcov.gformula'></span>

<h3>Description</h3>

<p>This function extracts the variance-covariance matrices of the parameters of
the fitted models for the time-varying covariates, outcome, and competing
event (if applicable).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'gformula'
vcov(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vcov.gformula_+3A_object">object</code></td>
<td>
<p>Object of class &quot;gformula&quot;.</p>
</td></tr>
<tr><td><code id="vcov.gformula_+3A_...">...</code></td>
<td>
<p>Other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>bootdiag</code> was set to <code>FALSE</code> in <code><a href="#topic+gformula">gformula</a></code>,
this function returns a list of the variance-covariance matrices of the
parameters of the fitted models to the observed data set. If bootstrapping
was used and <code>bootdiag</code> was set to <code>TRUE</code> in
<code><a href="#topic+gformula">gformula</a></code>, this function returns a list described as follows.
The first element (named 'Original sample') is a list of the
variance-covariance matrices of the parameters of the fitted models to the
observed data set. The kth element (named 'Bootstrap sample k-1') is a list
of the variance-covariance matrices of the parameters of the fitted models
corresponding to the k-1th bootstrap sample.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gformula">gformula</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Estimating the effect of static treatment strategies on risk of a
## failure event

id &lt;- 'id'
time_points &lt;- 7
time_name &lt;- 't0'
covnames &lt;- c('L1', 'L2', 'A')
outcome_name &lt;- 'Y'
outcome_type &lt;- 'survival'
covtypes &lt;- c('binary', 'bounded normal', 'binary')
histories &lt;- c(lagged, lagavg)
histvars &lt;- list(c('A', 'L1', 'L2'), c('L1', 'L2'))
covparams &lt;- list(covmodels = c(L1 ~ lag1_A + lag_cumavg1_L1 + lag_cumavg1_L2 +
                                  L3 + t0,
                                L2 ~ lag1_A + L1 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0,
                                A ~ lag1_A + L1 + L2 + lag_cumavg1_L1 +
                                  lag_cumavg1_L2 + L3 + t0))
ymodel &lt;- Y ~ A + L1 + L2 + L3 + lag1_A + lag1_L1 + lag1_L2 + t0
intvars &lt;- list('A', 'A')
interventions &lt;- list(list(c(static, rep(0, time_points))),
                      list(c(static, rep(1, time_points))))
int_descript &lt;- c('Never treat', 'Always treat')
nsimul &lt;- 10000

gform_basic &lt;- gformula(obs_data = basicdata_nocomp, id = id,
                        time_points = time_points,
                        time_name = time_name, covnames = covnames,
                        outcome_name = outcome_name,
                        outcome_type = outcome_type, covtypes = covtypes,
                        covparams = covparams, ymodel = ymodel,
                        intvars = intvars,
                        interventions = interventions,
                        int_descript = int_descript,
                        histories = histories, histvars = histvars,
                        basecovs = c('L3'), nsimul = nsimul,
                        seed = 1234)
vcov(gform_basic)


</code></pre>

<hr>
<h2 id='visit_sum'>Create Visit Sum Covariate</h2><span id='topic+visit_sum'></span>

<h3>Description</h3>

<p>This internal function assists in the implementation of a visit process by creating a covariate,
<code>ts_visit</code>, that counts the number of visits in the past <code>max_visits</code> time points. If this
number is greater than 0, then the individual has not missed more than the maximum number
of visits.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>visit_sum(pool, histvars, time_name, t, id_name, max_visits)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="visit_sum_+3A_pool">pool</code></td>
<td>
<p>Data table containing all information prior to time <code class="reqn">t</code> (<code class="reqn">t</code> noninclusive).</p>
</td></tr>
<tr><td><code id="visit_sum_+3A_histvars">histvars</code></td>
<td>
<p>Vector of character strings specifying the names of the variables for which lagged cumulative averages are to
be created.</p>
</td></tr>
<tr><td><code id="visit_sum_+3A_time_name">time_name</code></td>
<td>
<p>Character string specifying the name of the time variable in <code>pool</code>.</p>
</td></tr>
<tr><td><code id="visit_sum_+3A_t">t</code></td>
<td>
<p>Integer specifying the current time index.</p>
</td></tr>
<tr><td><code id="visit_sum_+3A_id_name">id_name</code></td>
<td>
<p>Character string specifying the name of the ID variable in <code>pool</code>.</p>
</td></tr>
<tr><td><code id="visit_sum_+3A_max_visits">max_visits</code></td>
<td>
<p>A vector of one or more values denoting the maximum number of times
a binary covariate representing a visit process may be missed before
the individual is censored from the data (in the observed data) or
a visit is forced (in the simulated data). Multiple values exist in the
vector when the modeling of more than covariate is attached to a visit
process.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No value is returned. The data table <code>pool</code> is modified in place.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
