<!DOCTYPE html><html lang="en-US"><head><title>Help for package baRulho</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {baRulho}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#baRulho-package'><p>baRulho: quantifying acoustic signal degradation</p></a></li>
<li><a href='#add_noise'><p>Add synthetic noise</p></a></li>
<li><a href='#align_test_files'><p>Align test sound files</p></a></li>
<li><a href='#attenuation'><p>Estimate attenuation of sound pressure level</p></a></li>
<li><a href='#auto_realign'><p>Fix small misalignments in the time position test sounds</p></a></li>
<li><a href='#blur_ratio'><p>Measure blur ratio in the time domain</p></a></li>
<li><a href='#detection_distance'><p>Measure detection distance of sound</p></a></li>
<li><a href='#envelope_correlation'><p>Measure amplitude envelope correlation</p></a></li>
<li><a href='#excess_attenuation'><p>Measure excess attenuation</p></a></li>
<li><a href='#find_markers'><p>Find acoustic markers on test sound files</p></a></li>
<li><a href='#manual_realign'><p>Plot spectrograms to check test sound files alignment</p></a></li>
<li><a href='#master_est'><p>Extended selection table of master acoustic data</p></a></li>
<li><a href='#master_sound_file'><p>Create a master sound file</p></a></li>
<li><a href='#noise_profile'><p>Measure full spectrum sound noise profiles</p></a></li>
<li><a href='#plot_aligned_sounds'><p>Plot spectrograms to check test sound files alignment</p></a></li>
<li><a href='#plot_blur_ratio'><p>Plot blur ratio</p></a></li>
<li><a href='#plot_degradation'><p>Save multipanel plots with reference and test sounds</p></a></li>
<li><a href='#set_reference_sounds'><p>Set reference for test sounds</p></a></li>
<li><a href='#signal_to_noise_ratio'><p>Measure attenuation as signal-to-noise ratio</p></a></li>
<li><a href='#spcc'><p>Measure spectrographic cross-correlation as a measure of sound distortion</p></a></li>
<li><a href='#spectrum_blur_ratio'><p>Measure blur ratio in the frequency domain</p></a></li>
<li><a href='#spectrum_correlation'><p>Measure frequency spectrum correlation</p></a></li>
<li><a href='#synth_sounds'><p>Create synthetic sounds</p></a></li>
<li><a href='#tail_to_signal_ratio'><p>Measure reverberations as tail-to-signal ratio</p></a></li>
<li><a href='#test_sounds_est'><p>Extended selection table with re-recorded playbacks</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Quantifying (Animal) Sound Degradation</td>
</tr>
<tr>
<td>Version:</td>
<td>2.1.3</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Marcelo Araya-Salas &lt;marcelo.araya@ucr.ac.cr&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Intended to facilitate acoustic analysis of (animal) sound transmission experiments, which typically aim to quantify changes in signal structure when transmitted in a given habitat by broadcasting and re-recording animal sounds at increasing distances. The package offers a workflow with functions to prepare the data set for analysis as well as to calculate and visualize several degradation metrics, including blur ratio, signal-to-noise ratio, excess attenuation and envelope correlation among others (Dabelsteen et al 1993 &lt;<a href="https://doi.org/10.1121%2F1.406682">doi:10.1121/1.406682</a>&gt;).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Imports:</td>
<td>utils, stats, seewave, tuneR, fftw, methods, viridis,
Sim.DiffProc, png, checkmate, cli, rlang</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.2.1), warbleR (&ge; 1.1.32), ohun (&ge; 1.0.2)</td>
</tr>
<tr>
<td>LazyData:</td>
<td>TRUE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/ropensci/baRulho">https://github.com/ropensci/baRulho</a>,
<a href="https://docs.ropensci.org/baRulho/">https://docs.ropensci.org/baRulho/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ropensci/baRulho/issues">https://github.com/ropensci/baRulho/issues</a></td>
</tr>
<tr>
<td>Suggests:</td>
<td>rmarkdown, ggplot2, knitr, kableExtra, testthat (&ge; 3.0.0),
covr, formatR, Rraven, monitoR</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-24 18:02:25 UTC; marce</td>
</tr>
<tr>
<td>Author:</td>
<td>Marcelo Araya-Salas
    <a href="https://orcid.org/0000-0003-3594-619X"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre],
  Michael Mahoney <a href="https://orcid.org/0000-0003-2402-304X"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [rev],
  Dena Clink <a href="https://orcid.org/0000-0003-0363-5581"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [rev]</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-25 00:20:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='baRulho-package'>baRulho: quantifying acoustic signal degradation</h2><span id='topic+baRulho'></span><span id='topic+baRulho-package'></span>

<h3>Description</h3>

<p>'baRulho' is a package intended to quantify habitat-induced degradation of (animal) acoustic signals.
</p>


<h3>Details</h3>

<p>The main features of the package are:
</p>

<ul>
<li><p> Loops to apply tasks through sounds referenced in an extended selection table
</p>
</li>
<li><p> The comparison of playback sounds re-recorded at different distances
</p>
</li></ul>

<p>Most functions allow the parallelization of tasks, which distributes the tasks among several processors to improve computational efficiency.
</p>
<p>License: GPL (&gt;= 2)
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas
</p>
<p>Maintainer: Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/ropensci/baRulho">https://github.com/ropensci/baRulho</a>
</p>
</li>
<li> <p><a href="https://docs.ropensci.org/baRulho/">https://docs.ropensci.org/baRulho/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/ropensci/baRulho/issues">https://github.com/ropensci/baRulho/issues</a>
</p>
</li></ul>


<hr>
<h2 id='add_noise'>Add synthetic noise</h2><span id='topic+add_noise'></span>

<h3>Description</h3>

<p><code>add_noise</code> adds synthetic noise to annotations in extended selection tables
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_noise(
  X,
  mar = NULL,
  target.snr = 2,
  precision = 0.1,
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  max.iterations = 1000,
  kind = c("pink", "white", "brown", "red", "power"),
  alpha = 1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_noise_+3A_x">X</code></td>
<td>
<p>Object of class 'extended_selection_table' (created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package), generated 'by element', with the reference to the test sounds (typically the output of <code><a href="#topic+align_test_files">align_test_files</a></code>). Must contain the following columns: 1) &quot;sound.files&quot;: name of the .wav files, 2) &quot;selec&quot;: unique selection identifier (within a sound file), 3) &quot;start&quot;: start time and 4) &quot;end&quot;: end time of selections, 5) &quot;bottom.freq&quot;: low frequency for bandpass, 6) &quot;top.freq&quot;: high frequency for bandpass and 7) &quot;sound.id&quot;: ID of sounds (needed to calculate signal to noise ratio internally using <code><a href="#topic+signal_to_noise_ratio">signal_to_noise_ratio</a></code>).</p>
</td></tr>
<tr><td><code id="add_noise_+3A_mar">mar</code></td>
<td>
<p>numeric vector of length 1. Specifies the margins adjacent to
the start point of the annotation over which to measure ambient noise.</p>
</td></tr>
<tr><td><code id="add_noise_+3A_target.snr">target.snr</code></td>
<td>
<p>numeric vector of length 1. Specifies the desired signal-to-noise ratio. Must be lower that the current signal-to-noise ratio. Annotations showing a signal-to-noise ratio higher than 'target.snr' will remain unchanged. Must be supplied.</p>
</td></tr>
<tr><td><code id="add_noise_+3A_precision">precision</code></td>
<td>
<p>numeric vector of length 1. Specifies the precision of the adjusted signal-to-noise ratio (in dB).</p>
</td></tr>
<tr><td><code id="add_noise_+3A_cores">cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the &quot;mc.cores&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="add_noise_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="add_noise_+3A_max.iterations">max.iterations</code></td>
<td>
<p>Numeric vector of length 1. Specifies the maximum number of iterations that the internal signal-to-noise adjusting routine will run before stopping. Note that in most cases the default maximum number of iterations (1000) is not reached.</p>
</td></tr>
<tr><td><code id="add_noise_+3A_kind">kind</code></td>
<td>
<p>Character vector of length 1 indicating the kind of noise, “white”, “pink”, “power”, &quot;brown&quot;, or “red”. Noise is synthesized with a modified version of the function <code><a href="tuneR.html#topic+noise">noise</a></code>. Default is &quot;pink&quot; which is similar to background noise in natural environments.</p>
</td></tr>
<tr><td><code id="add_noise_+3A_alpha">alpha</code></td>
<td>
<p>Numeric vector of length 1. The power for the power law noise (defaults are 1 for pink and 1.5 for red noise). Only used when <code>kind = "power"</code>.</p>
</td></tr>
<tr><td><code id="add_noise_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed internally to <code><a href="#topic+signal_to_noise_ratio">signal_to_noise_ratio</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function adds synthetic noise to sounds referenced in an extended selection table (class created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) to decrease the signal-to-noise ratio. This can be useful, for instance, for evaluating the effect of background noise on signal structure. Note that the implementation is slow.
</p>


<h3>Value</h3>

<p>Object 'X' in which the wave objects have been modified to match the target signal-to-noise ratio. It also includes an additional column, 'adjusted.snr', with the new signal-to-noise ratio values.
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.
Timmer. J and M. König (1995): On generating power law noise. Astron. Astrophys. 300, 707-710.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+signal_to_noise_ratio">signal_to_noise_ratio</a></code>
</p>
<p>Other miscellaneous: 
<code><a href="#topic+attenuation">attenuation</a>()</code>,
<code><a href="#topic+noise_profile">noise_profile</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# load example data
data("test_sounds_est")

# make it a 'by element' extended selection table
X &lt;- warbleR::by_element_est(X = test_sounds_est)

# add noise to the first five rows
X_noise &lt;- add_noise(X = X[1:5, ], mar = 0.2, target.snr = 3)

## End(Not run)
</code></pre>

<hr>
<h2 id='align_test_files'>Align test sound files</h2><span id='topic+align_test_files'></span>

<h3>Description</h3>

<p><code>align_test_files</code> aligns test (re-recorded) sound files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>align_test_files(
  X,
  Y,
  path = getOption("sound.files.path", "."),
  by.song = TRUE,
  marker = NULL,
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="align_test_files_+3A_x">X</code></td>
<td>
<p>object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package). This should be the same data than that was used for finding the position of markers in <code><a href="#topic+find_markers">find_markers</a></code>. It should also contain a 'sound.id' column that will be used to label re-recorded sounds according to their counterpart in the master sound file.</p>
</td></tr>
<tr><td><code id="align_test_files_+3A_y">Y</code></td>
<td>
<p>object of class 'data.frame' with the output of <code><a href="#topic+find_markers">find_markers</a></code>. This object contains the position of markers in the re-recorded sound files. If more than one marker is supplied for a sound file only the one with the highest correlation score ('scores' column in 'X') is used.</p>
</td></tr>
<tr><td><code id="align_test_files_+3A_path">path</code></td>
<td>
<p>Character string containing the directory path where test (re-recorded) sound files are found.</p>
</td></tr>
<tr><td><code id="align_test_files_+3A_by.song">by.song</code></td>
<td>
<p>Logical argument to indicate if the extended selection table should be created by song (see 'by.song' <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> argument). Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="align_test_files_+3A_marker">marker</code></td>
<td>
<p>Character string to define whether a &quot;start&quot; or &quot;end&quot; marker would be used for aligning re-recorded sound files. Default is <code>NULL</code>. DEPRECATED.</p>
</td></tr>
<tr><td><code id="align_test_files_+3A_cores">cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the &quot;mc.cores&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="align_test_files_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="align_test_files_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed to <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> for customizing extended selection table.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function aligns sounds found in re-recorded sound files (referenced in 'Y') according to a master sound file (referenced in 'X'). If more than one marker is supplied for a sound file only the one with the highest correlation score ('scores' column in 'X') is used. The function outputs an 'extended selection table' by default.
</p>


<h3>Value</h3>

<p>An object of the same class than 'X' with the aligned sounds from test (re-recorded) sound files.
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+manual_realign">manual_realign</a></code>; <code><a href="#topic+find_markers">find_markers</a></code>; <code><a href="#topic+plot_aligned_sounds">plot_aligned_sounds</a></code>
</p>
<p>Other test sound alignment: 
<code><a href="#topic+auto_realign">auto_realign</a>()</code>,
<code><a href="#topic+find_markers">find_markers</a>()</code>,
<code><a href="#topic+manual_realign">manual_realign</a>()</code>,
<code><a href="#topic+plot_aligned_sounds">plot_aligned_sounds</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
  # load example data
  data(list = c("master_est", "test_sounds_est"))

  # save example files in working director to recreate a case in which working
  # with sound files instead of extended selection tables.
  # This doesn't have to be done with your own data as you will
  # have them as sound files already.
  for (i in unique(test_sounds_est$sound.files)[1:2]) {
    writeWave(object = attr(test_sounds_est, "wave.objects")[[i]], 
              file.path(tempdir(), i))
  }

  # save master file
  writeWave(object = attr(master_est, "wave.objects")[[1]], 
        file.path(tempdir(), "master.wav"))

  # get marker position for the first test file
    markers &lt;- find_markers(X = master_est,
    test.files = unique(test_sounds_est$sound.files)[1],
    path = tempdir())

  # align all test sounds
  alg.tests &lt;- align_test_files(X = master_est, Y = markers, 
  path = tempdir())
}
</code></pre>

<hr>
<h2 id='attenuation'>Estimate attenuation of sound pressure level</h2><span id='topic+attenuation'></span>

<h3>Description</h3>

<p><code>attenuation</code> estimates atmospheric attenuation and atmospheric absorption.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>attenuation(
  frequency,
  dist0,
  dist,
  temp = 20,
  rh = 60,
  pa = 101325,
  hab.att.coef = 0.02
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="attenuation_+3A_frequency">frequency</code></td>
<td>
<p>Numeric vector of length 1 with frequency (in Hertz).</p>
</td></tr>
<tr><td><code id="attenuation_+3A_dist0">dist0</code></td>
<td>
<p>Numeric vector of length 1 with distance (m) for the reference SPL.</p>
</td></tr>
<tr><td><code id="attenuation_+3A_dist">dist</code></td>
<td>
<p>Numeric vector of length 1 with distance (m) over which a sound propagates.</p>
</td></tr>
<tr><td><code id="attenuation_+3A_temp">temp</code></td>
<td>
<p>Numeric vector of length 1 with frequency (in Celsius). Default is 20.</p>
</td></tr>
<tr><td><code id="attenuation_+3A_rh">rh</code></td>
<td>
<p>Numeric vector of length 1 with relative humidity (in percentage). Default is 60.</p>
</td></tr>
<tr><td><code id="attenuation_+3A_pa">pa</code></td>
<td>
<p>Numeric vector of length 1 with atmospheric (barometric) pressure in Pa (standard: 101325, default). Used for atmospheric attenuation.</p>
</td></tr>
<tr><td><code id="attenuation_+3A_hab.att.coef">hab.att.coef</code></td>
<td>
<p>Attenuation coefficient of the habitat (in dB/kHz/m).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Calculate the geometric, atmospheric and habitat attenuation and the overall expected attenuation (the sum of the other three) based on temperature, relative humidity, atmospheric pressure and sound frequency. Attenuation values are given in dB. The function is modified from http://www.sengpielaudio.com
</p>


<h3>Value</h3>

<p>Returns the geometric, atmospheric and habitat attenuation (in dB) as well as the combined attenuation.
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.

</p>


<h3>See Also</h3>

<p>Other miscellaneous: 
<code><a href="#topic+add_noise">add_noise</a>()</code>,
<code><a href="#topic+noise_profile">noise_profile</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
  # measure attenuation
  attenuation(frequency = 2000, dist = 50, dist0 = 1)
}
</code></pre>

<hr>
<h2 id='auto_realign'>Fix small misalignments in the time position test sounds</h2><span id='topic+auto_realign'></span>

<h3>Description</h3>

<p><code>auto_realign</code> fixes small misalignments in the time position of test sounds in an extended selection table using spectrographic cross-correlation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>auto_realign(
  X,
  Y,
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  hop.size = getOption("hop.size", 11.6),
  wl = getOption("wl", NULL),
  ovlp = getOption("ovlp", 90),
  wn = c("hanning", "hamming", "bartlett", "blackman", "flattop", "rectangle")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="auto_realign_+3A_x">X</code></td>
<td>
<p>object of class 'extended_selection_table' created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package. The object must include the following additional columns: 'sound.id', 'bottom.freq' and 'top.freq'.</p>
</td></tr>
<tr><td><code id="auto_realign_+3A_y">Y</code></td>
<td>
<p>object of class 'extended_selection_table' (a class created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the master sound file annotations. This should be the same data than that was used for finding the position of markers in <code><a href="#topic+find_markers">find_markers</a></code>. It should also contain a 'sound.id' column.</p>
</td></tr>
<tr><td><code id="auto_realign_+3A_cores">cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the &quot;mc.cores&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="auto_realign_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="auto_realign_+3A_hop.size">hop.size</code></td>
<td>
<p>A numeric vector of length 1 specifying the time window duration (in ms). Default is 11.6 ms, which is equivalent to 512 wl for a 44.1 kHz sampling rate. Ignored if 'wl' is supplied. Can be set globally for the current R session via the &quot;hop.size&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="auto_realign_+3A_wl">wl</code></td>
<td>
<p>a vector with a single even integer number specifying the window length of the spectrogram, default is <code>NULL</code>. If supplied, 'hop.size' is ignored. Odd integers will be rounded up to the nearest even number. Can be set globally for the current R session via the &quot;wl&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="auto_realign_+3A_ovlp">ovlp</code></td>
<td>
<p>Numeric vector of length 1 specifying the percentage of overlap between two
consecutive windows, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is 90. High values slow down the function but produce more accurate results. Can be set globally for the current R session via the &quot;ovlp&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="auto_realign_+3A_wn">wn</code></td>
<td>
<p>A character vector of length 1 specifying the window name as in <code><a href="seewave.html#topic+ftwindow">ftwindow</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Precise alignment is crucial for downstream measures of sound degradation. This function uses spectrographic cross-correlation to align the position in time of test sounds. The master sound file is used as reference. The function calls warbleR's <code><a href="warbleR.html#topic+cross_correlation">cross_correlation</a></code> internally to align sounds using cross-correlation. The output extended selection table contains the new start and end values after alignment. Note that this function only works to further improve alignments if the estimated position of the test sound is already close to the actual position. Note that both 'X' and 'Y' must be extended selection tables sensu <code><a href="warbleR.html#topic+selection_table">selection_table</a></code>.
</p>


<h3>Value</h3>

<p>Object 'X' in which time parameters (columns 'start' and 'end') have been tailored to more closely match the start and end of the reference sound.
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.
</p>
<p>Clark, C.W., Marler, P. &amp; Beeman K. (1987). Quantitative analysis of animal vocal phonology: an application to Swamp Sparrow song. Ethology. 76:101-115.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+blur_ratio">blur_ratio</a></code>, <code><a href="warbleR.html#topic+cross_correlation">cross_correlation</a></code>
</p>
<p>Other test sound alignment: 
<code><a href="#topic+align_test_files">align_test_files</a>()</code>,
<code><a href="#topic+find_markers">find_markers</a>()</code>,
<code><a href="#topic+manual_realign">manual_realign</a>()</code>,
<code><a href="#topic+plot_aligned_sounds">plot_aligned_sounds</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
  # load example data
  data("test_sounds_est")
  data("master_est")
  
  # create "unaligned_test_sounds_est" by
  # adding error to "test_sounds_est" start and end
  unaligned_test_sounds_est &lt;- test_sounds_est
  set.seed(123)
  noise_time &lt;- sample(c(0.009, -0.01, 0.03, -0.03, 0, 0.07, -0.007),
  nrow(unaligned_test_sounds_est),
  replace = TRUE)
  
  attr(unaligned_test_sounds_est, "check.res")$start &lt;- 
  unaligned_test_sounds_est$start &lt;- 
  unaligned_test_sounds_est$start + noise_time
  attr(unaligned_test_sounds_est, "check.res")$end &lt;- 
  unaligned_test_sounds_est$end  &lt;- 
  unaligned_test_sounds_est$end + noise_time

# re align
realigned_est &lt;- auto_realign(X = unaligned_test_sounds_est, Y = master_est)
}

</code></pre>

<hr>
<h2 id='blur_ratio'>Measure blur ratio in the time domain</h2><span id='topic+blur_ratio'></span>

<h3>Description</h3>

<p><code>blur_ratio</code> measures blur ratio in sounds referenced in an extended selection table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>blur_ratio(
  X,
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  env.smooth = getOption("env.smooth", 200),
  envelopes = FALSE,
  hop.size = getOption("hop.size", 11.6),
  wl = getOption("wl", NULL),
  ovlp = getOption("ovlp", 70),
  n.samples = 100,
  path = getOption("sound.files.path", ".")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="blur_ratio_+3A_x">X</code></td>
<td>
<p>The output of <code><a href="#topic+set_reference_sounds">set_reference_sounds</a></code> which is an object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the reference to the test sounds . Must contain the following columns: 1) &quot;sound.files&quot;: name of the .wav files, 2) &quot;selec&quot;: unique selection identifier (within a sound file), 3) &quot;start&quot;: start time and 4) &quot;end&quot;: end time of selections, 5) &quot;bottom.freq&quot;: low frequency for bandpass, 6) &quot;top.freq&quot;: high frequency for bandpass, 7) &quot;sound.id&quot;: ID of sounds used to identify counterparts across distances and 8) &quot;reference&quot;: identity of sounds to be used as reference for each test sound (row). See <code><a href="#topic+set_reference_sounds">set_reference_sounds</a></code> for more details on the structure of 'X'.</p>
</td></tr>
<tr><td><code id="blur_ratio_+3A_cores">cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the &quot;mc.cores&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="blur_ratio_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="blur_ratio_+3A_env.smooth">env.smooth</code></td>
<td>
<p>Numeric vector of length 1 determining the length of the sliding window (in amplitude samples) used for a sum smooth for amplitude envelope calculation (used internally by <code><a href="seewave.html#topic+env">env</a></code>). Default is 200. Can be set globally for the current R session via the &quot;env.smooth&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="blur_ratio_+3A_envelopes">envelopes</code></td>
<td>
<p>Logical to control if envelopes are returned (as attributes, 'attributes(X)$envelopes'). Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="blur_ratio_+3A_hop.size">hop.size</code></td>
<td>
<p>A numeric vector of length 1 specifying the time window duration (in ms). Default is 11.6 ms, which is equivalent to 512 wl for a 44.1 kHz sampling rate. Ignored if 'wl' is supplied. Can be set globally for the current R session via the &quot;hop.size&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="blur_ratio_+3A_wl">wl</code></td>
<td>
<p>a vector with a single even integer number specifying the window length of the spectrogram, default is <code>NULL</code>. If supplied, 'hop.size' is ignored. Odd integers will be rounded up to the nearest even number. Can be set globally for the current R session via the &quot;wl&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="blur_ratio_+3A_ovlp">ovlp</code></td>
<td>
<p>Numeric vector of length 1 specifying the percentage of overlap between two
consecutive windows, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is 70. Used for applying bandpass filtering. Can be set globally for the current R session via the &quot;ovlp&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="blur_ratio_+3A_n.samples">n.samples</code></td>
<td>
<p>Numeric vector of length 1 specifying the number of amplitude samples to use for representing amplitude envelopes. Default is 100. If null the raw amplitude envelope is used (note that this can result in high RAM memory usage for large data sets). Amplitude envelope values are interpolated using <code><a href="stats.html#topic+approx">approx</a></code>.</p>
</td></tr>
<tr><td><code id="blur_ratio_+3A_path">path</code></td>
<td>
<p>Character string containing the directory path where the sound files are found. Only needed when 'X' is not an extended selection table. If not supplied the current working directory is used. Can be set globally for the current R session via the &quot;sound.files.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Blur ratio measures the degradation of sound as a change in sound power in the time domain as described by Dabelsteen et al (1993). Low values indicate low degradation of sounds. The function measures the blur ratio on sounds in which a reference playback has been re-recorded at different distances. Blur ratio is measured as the mismatch between amplitude envelopes (expressed as probability mass functions) of the reference sound and the re-recorded sound. By converting envelopes to probability mass functions the effect of energy attenuation is removed, focusing the analysis on the modification of the envelope shape. The function compares each sound to the corresponding reference sound within the supplied frequency range (e.g. bandpass) of the reference sound ('bottom.freq' and 'top.freq' columns in 'X'). The 'sound.id' column must be used to tell the function to only compare sounds belonging to the same category (e.g. song-types). Two methods for setting the experimental design are provided. All wave objects in the extended selection table must have the same sampling rate so the length of envelopes is comparable.
</p>


<h3>Value</h3>

<p>Object 'X' with an additional column,  'blur.ratio', containing the computed blur ratio values. If <code>envelopes = TRUE</code> the output would include amplitude envelopes for all sounds as attributes ('attributes(X)$envelopes').
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Dabelsteen, T., Larsen, O. N., &amp; Pedersen, S. B. (1993). Habitat-induced degradation of sound signals: Quantifying the effects of communication sounds and bird location on blur ratio, excess attenuation, and signal-to-noise ratio in blackbird song. The Journal of the Acoustical Society of America, 93(4), 2206.
</p>
<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+envelope_correlation">envelope_correlation</a></code>, <code><a href="#topic+spectrum_blur_ratio">spectrum_blur_ratio</a></code>
</p>
<p>Other quantify degradation: 
<code><a href="#topic+detection_distance">detection_distance</a>()</code>,
<code><a href="#topic+envelope_correlation">envelope_correlation</a>()</code>,
<code><a href="#topic+plot_blur_ratio">plot_blur_ratio</a>()</code>,
<code><a href="#topic+plot_degradation">plot_degradation</a>()</code>,
<code><a href="#topic+set_reference_sounds">set_reference_sounds</a>()</code>,
<code><a href="#topic+signal_to_noise_ratio">signal_to_noise_ratio</a>()</code>,
<code><a href="#topic+spcc">spcc</a>()</code>,
<code><a href="#topic+spectrum_blur_ratio">spectrum_blur_ratio</a>()</code>,
<code><a href="#topic+spectrum_correlation">spectrum_correlation</a>()</code>,
<code><a href="#topic+tail_to_signal_ratio">tail_to_signal_ratio</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
  # load example data
  data("test_sounds_est")

 # add reference to X
  X &lt;- set_reference_sounds(X = test_sounds_est)
  blur_ratio(X = X)

  # using method 2
X &lt;- set_reference_sounds(X = test_sounds_est, method = 2)
  blur_ratio(X = X)

  # get envelopes
  br &lt;- blur_ratio(X = X, envelopes = TRUE)
  envs &lt;- attributes(br)$envelopes

  # make distance a factor for plotting
  envs$distance &lt;- as.factor(envs$distance)

  
  # plot
  rlang::check_installed("ggplot2")
  library(ggplot2)
  
  ggplot(envs, aes(x= time, y = amp, col = distance)) +
  geom_line() + facet_wrap(~ sound.id) +
  scale_color_viridis_d() +
  labs(x = "Time (s)", y = "Amplitude (PMF)") +
  theme_classic()
  
}

</code></pre>

<hr>
<h2 id='detection_distance'>Measure detection distance of sound</h2><span id='topic+detection_distance'></span>

<h3>Description</h3>

<p><code>detection_distance</code> detection distance of sounds.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>detection_distance(
  X,
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  hop.size = getOption("hop.size", 11.6),
  wl = getOption("wl", NULL),
  path = getOption("sound.files.path", "."),
  spl = NULL,
  spl.cutoff = NULL,
  temp = 20,
  rh = 60,
  pa = 101325,
  hab.att.coef = 0.02,
  max.distance = 1000,
  resolution = 0.1,
  subtract.bgn = TRUE,
  envelope = c("abs", "hil"),
  mar = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="detection_distance_+3A_x">X</code></td>
<td>
<p>The output of <code><a href="#topic+set_reference_sounds">set_reference_sounds</a></code> which is an object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the reference to the test sounds . Must contain the following columns: 1) &quot;sound.files&quot;: name of the .wav files, 2) &quot;selec&quot;: unique selection identifier (within a sound file), 3) &quot;start&quot;: start time and 4) &quot;end&quot;: end time of selections, 5) &quot;bottom.freq&quot;: low frequency for bandpass, 6) &quot;top.freq&quot;: high frequency for bandpass, 7) &quot;sound.id&quot;: ID of sounds used to identify counterparts across distances and 8) &quot;reference&quot;: identity of sounds to be used as reference for each test sound (row). See <code><a href="#topic+set_reference_sounds">set_reference_sounds</a></code> for more details on the structure of 'X'.</p>
</td></tr>
<tr><td><code id="detection_distance_+3A_cores">cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the &quot;mc.cores&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="detection_distance_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="detection_distance_+3A_hop.size">hop.size</code></td>
<td>
<p>A numeric vector of length 1 specifying the time window duration (in ms). Default is 11.6 ms, which is equivalent to 512 wl for a 44.1 kHz sampling rate. Ignored if 'wl' is supplied. Can be set globally for the current R session via the &quot;hop.size&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="detection_distance_+3A_wl">wl</code></td>
<td>
<p>a vector with a single even integer number specifying the window length of the spectrogram, default is <code>NULL</code>. If supplied, 'hop.size' is ignored. Odd integers will be rounded up to the nearest even number. Can be set globally for the current R session via the &quot;wl&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="detection_distance_+3A_path">path</code></td>
<td>
<p>Character string containing the directory path where the sound files are found. Only needed when 'X' is not an extended selection table. If not supplied the current working directory is used. Can be set globally for the current R session via the &quot;sound.files.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="detection_distance_+3A_spl">spl</code></td>
<td>
<p>A numeric vector of length 1 specifying the sound pressure level of sounds. If not supplied then it will be measured from the sounds  themselves.</p>
</td></tr>
<tr><td><code id="detection_distance_+3A_spl.cutoff">spl.cutoff</code></td>
<td>
<p>A numeric vector of length 1 specifying the sound pressure level cutoff to define if the sound is no longer detected. Ideally it should be estimated based on the sound detection threshold of the species.</p>
</td></tr>
<tr><td><code id="detection_distance_+3A_temp">temp</code></td>
<td>
<p>Numeric vector of length 1 with frequency (in Celsius). Default is 20.</p>
</td></tr>
<tr><td><code id="detection_distance_+3A_rh">rh</code></td>
<td>
<p>Numeric vector of length 1 with relative humidity (in percentage). Default is 60.</p>
</td></tr>
<tr><td><code id="detection_distance_+3A_pa">pa</code></td>
<td>
<p>Numeric vector of length 1 with ambient pressure in Pa (standard: 101325, default). Used for Atmospheric attenuation.</p>
</td></tr>
<tr><td><code id="detection_distance_+3A_hab.att.coef">hab.att.coef</code></td>
<td>
<p>Attenuation coefficient of the habitat (in dB/kHz/m).</p>
</td></tr>
<tr><td><code id="detection_distance_+3A_max.distance">max.distance</code></td>
<td>
<p>Numeric vector of length 1 with the maximum distance (in m) at which detection would be evaluated. Note that the function calculates the expected sound pressure level values along a vector of distances to find the distance at which the expected sound pressure level equates 'spl.cutoff'. Default is 1000 m.</p>
</td></tr>
<tr><td><code id="detection_distance_+3A_resolution">resolution</code></td>
<td>
<p>Numeric vector of length 1 with the distance resolution (in m) for estimated detection distance. Higher resolutions take longer to estimate. Default is 0.1 m.</p>
</td></tr>
<tr><td><code id="detection_distance_+3A_subtract.bgn">subtract.bgn</code></td>
<td>
<p>Logical argument to control if SPL from background noise is excluded from the measured signal SPL. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="detection_distance_+3A_envelope">envelope</code></td>
<td>
<p>Character string vector with the method to calculate amplitude envelopes (in which SPL is measured, used required if 'spl' is not supplied), as in <code><a href="seewave.html#topic+env">env</a></code>. Must be either 'abs' (absolute envelope, default) or 'hil' (Hilbert transformation).</p>
</td></tr>
<tr><td><code id="detection_distance_+3A_mar">mar</code></td>
<td>
<p>numeric vector of length 1. Specifies the margins adjacent to
the start and end points of selection over which to measure background noise. This is required to subtract background noise sound pressure level (so only needed when 'subtract.bgn = TRUE').</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function computes the maximum distance at which a sound would be detected, which is calculated as the distance in which the sound pressure level (SPL) goes below the specified SPL cutoff ('spl.cutoff')). This is returned as an additional column 'detection.distance' (in m). The function uses internally <code><a href="#topic+attenuation">attenuation</a></code> to estimate SPL at increasing values until it reaches the defined cutoff. The peak frequency (calculated on the power spectrum of the reference sound) of the reference sound for each sound ID is used as the carrier frequency for distance estimation. The sound recorded at the lowest distance is used as reference. <strong>This function assumes that all recordings have been made at the same recording volume</strong>.
</p>


<h3>Value</h3>

<p>Object 'X' with an additional column, 'detection.distance',
containing the computed detection distances (in m).
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.
</p>
<p>Clark, C.W., Marler, P. &amp; Beeman K. (1987). Quantitative analysis of animal vocal phonology: an application to Swamp Sparrow song. Ethology. 76:101-115.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+attenuation">attenuation</a></code>
</p>
<p>Other quantify degradation: 
<code><a href="#topic+blur_ratio">blur_ratio</a>()</code>,
<code><a href="#topic+envelope_correlation">envelope_correlation</a>()</code>,
<code><a href="#topic+plot_blur_ratio">plot_blur_ratio</a>()</code>,
<code><a href="#topic+plot_degradation">plot_degradation</a>()</code>,
<code><a href="#topic+set_reference_sounds">set_reference_sounds</a>()</code>,
<code><a href="#topic+signal_to_noise_ratio">signal_to_noise_ratio</a>()</code>,
<code><a href="#topic+spcc">spcc</a>()</code>,
<code><a href="#topic+spectrum_blur_ratio">spectrum_blur_ratio</a>()</code>,
<code><a href="#topic+spectrum_correlation">spectrum_correlation</a>()</code>,
<code><a href="#topic+tail_to_signal_ratio">tail_to_signal_ratio</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# load example data
data("test_sounds_est")

# add reference to X
X &lt;- set_reference_sounds(X = test_sounds_est)

detection_distance(X = X[X$distance %in% c(1, 10), ], spl.cutoff = 5, mar = 0.05)

## End(Not run)

</code></pre>

<hr>
<h2 id='envelope_correlation'>Measure amplitude envelope correlation</h2><span id='topic+envelope_correlation'></span>

<h3>Description</h3>

<p><code>envelope_correlation</code> measures amplitude envelope correlation of sounds referenced in an extended selection table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>envelope_correlation(
  X,
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  cor.method = c("pearson", "spearman", "kendall"),
  env.smooth = getOption("env.smooth", 200),
  hop.size = getOption("hop.size", 11.6),
  wl = getOption("wl", NULL),
  ovlp = getOption("ovlp", 70),
  path = getOption("sound.files.path", ".")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="envelope_correlation_+3A_x">X</code></td>
<td>
<p>The output of <code><a href="#topic+set_reference_sounds">set_reference_sounds</a></code> which is an object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the reference to the test sounds . Must contain the following columns: 1) &quot;sound.files&quot;: name of the .wav files, 2) &quot;selec&quot;: unique selection identifier (within a sound file), 3) &quot;start&quot;: start time and 4) &quot;end&quot;: end time of selections, 5) &quot;bottom.freq&quot;: low frequency for bandpass, 6) &quot;top.freq&quot;: high frequency for bandpass, 7) &quot;sound.id&quot;: ID of sounds used to identify counterparts across distances and 8) &quot;reference&quot;: identity of sounds to be used as reference for each test sound (row). See <code><a href="#topic+set_reference_sounds">set_reference_sounds</a></code> for more details on the structure of 'X'.</p>
</td></tr>
<tr><td><code id="envelope_correlation_+3A_cores">cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the &quot;mc.cores&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="envelope_correlation_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="envelope_correlation_+3A_cor.method">cor.method</code></td>
<td>
<p>Character string indicating the correlation coefficient to be applied (&quot;pearson&quot;, &quot;spearman&quot;, or &quot;kendall&quot;, see <code><a href="stats.html#topic+cor">cor</a></code>).</p>
</td></tr>
<tr><td><code id="envelope_correlation_+3A_env.smooth">env.smooth</code></td>
<td>
<p>Numeric vector of length 1 to determine the length of the sliding window used for a sum smooth for amplitude envelope calculation (used internally by <code><a href="seewave.html#topic+env">env</a></code>). Can be set globally for the current R session via the &quot;env.smooth&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="envelope_correlation_+3A_hop.size">hop.size</code></td>
<td>
<p>A numeric vector of length 1 specifying the time window duration (in ms). Default is 11.6 ms, which is equivalent to 512 wl for a 44.1 kHz sampling rate. Ignored if 'wl' is supplied. Can be set globally for the current R session via the &quot;hop.size&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="envelope_correlation_+3A_wl">wl</code></td>
<td>
<p>a vector with a single even integer number specifying the window length of the spectrogram, default is <code>NULL</code>. If supplied, 'hop.size' is ignored. Odd integers will be rounded up to the nearest even number. Can be set globally for the current R session via the &quot;wl&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="envelope_correlation_+3A_ovlp">ovlp</code></td>
<td>
<p>Numeric vector of length 1 specifying the percentage of overlap between two
consecutive windows, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is 70. Can be set globally for the current R session via the &quot;ovlp&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="envelope_correlation_+3A_path">path</code></td>
<td>
<p>Character string containing the directory path where the sound files are found. Only needed when 'X' is not an extended selection table. If not supplied the current working directory is used. Can be set globally for the current R session via the &quot;sound.files.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Amplitude envelope correlation measures the similarity of two sounds in the time domain. The function measures the envelope correlation coefficients of sounds in which a reference playback has been re-recorded at increasing distances. Values close to 1 means very similar amplitude envelopes (i.e. little degradation has occurred). If envelopes have different lengths (which means sounds have different lengths) cross-correlation is used and the maximum correlation coefficient is returned. Cross-correlation is achieved by sliding the shortest sound along the largest one and computing the correlation at each step. The 'sound.id' column must be used to indicate the function to only compare sounds belonging to the same category (e.g. song-types). The function compares each sound to the corresponding reference sound within the supplied frequency range (e.g. bandpass) of the reference sound ('bottom.freq' and 'top.freq' columns in 'X'). Two methods for computing envelope correlation are provided (see 'method' argument). Use <code><a href="#topic+blur_ratio">blur_ratio</a></code> to create envelopes graphs.
</p>


<h3>Value</h3>

<p>Object 'X' with an additional column, 'envelope.correlation', containing the computed envelope correlation coefficients.
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.
</p>
<p>Apol, C.A., Sturdy, C.B. &amp; Proppe, D.S. (2017). Seasonal variability in habitat structure may have shaped acoustic signals and repertoires in the black-capped and boreal chickadees. Evol Ecol. 32:57-74.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+blur_ratio">blur_ratio</a></code>, <code><a href="#topic+spectrum_blur_ratio">spectrum_blur_ratio</a></code>
</p>
<p>Other quantify degradation: 
<code><a href="#topic+blur_ratio">blur_ratio</a>()</code>,
<code><a href="#topic+detection_distance">detection_distance</a>()</code>,
<code><a href="#topic+plot_blur_ratio">plot_blur_ratio</a>()</code>,
<code><a href="#topic+plot_degradation">plot_degradation</a>()</code>,
<code><a href="#topic+set_reference_sounds">set_reference_sounds</a>()</code>,
<code><a href="#topic+signal_to_noise_ratio">signal_to_noise_ratio</a>()</code>,
<code><a href="#topic+spcc">spcc</a>()</code>,
<code><a href="#topic+spectrum_blur_ratio">spectrum_blur_ratio</a>()</code>,
<code><a href="#topic+spectrum_correlation">spectrum_correlation</a>()</code>,
<code><a href="#topic+tail_to_signal_ratio">tail_to_signal_ratio</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
  # load example data
  data("test_sounds_est")

  # add reference to X
  X &lt;- set_reference_sounds(X = test_sounds_est)

  envelope_correlation(X = X)

  # method 2
  # add reference to X
  X &lt;- set_reference_sounds(X = test_sounds_est, method = 2)
  envelope_correlation(X = X)
}

</code></pre>

<hr>
<h2 id='excess_attenuation'>Measure excess attenuation</h2><span id='topic+excess_attenuation'></span>

<h3>Description</h3>

<p><code>excess_attenuation</code> measures excess attenuation in sounds referenced in an extended selection table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>excess_attenuation(
  X,
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  hop.size = getOption("hop.size", 1),
  wl = getOption("wl", NULL),
  ovlp = getOption("ovlp", 50),
  bp = "freq.range",
  path = getOption("sound.files.path", ".")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="excess_attenuation_+3A_x">X</code></td>
<td>
<p>The output of <code><a href="#topic+set_reference_sounds">set_reference_sounds</a></code> which is an object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the reference to the test sounds . Must contain the following columns: 1) &quot;sound.files&quot;: name of the .wav files, 2) &quot;selec&quot;: unique selection identifier (within a sound file), 3) &quot;start&quot;: start time and 4) &quot;end&quot;: end time of selections, 5) &quot;bottom.freq&quot;: low frequency for bandpass, 6) &quot;top.freq&quot;: high frequency for bandpass, 7) &quot;sound.id&quot;: ID of sounds used to identify counterparts across distances and 8) &quot;reference&quot;: identity of sounds to be used as reference for each test sound (row). See <code><a href="#topic+set_reference_sounds">set_reference_sounds</a></code> for more details on the structure of 'X'.</p>
</td></tr>
<tr><td><code id="excess_attenuation_+3A_cores">cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the &quot;mc.cores&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="excess_attenuation_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="excess_attenuation_+3A_hop.size">hop.size</code></td>
<td>
<p>A numeric vector of length 1 specifying the time window duration (in ms). Default is 1 ms, which is equivalent to ~45 wl for a 44.1 kHz sampling rate. Ignored if 'wl' is supplied. Can be set globally for the current R session via the &quot;hop.size&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="excess_attenuation_+3A_wl">wl</code></td>
<td>
<p>A numeric vector of length 1 specifying the window length of the spectrogram, default
is <code>NULL</code>. If supplied, 'hop.size' is ignored.
Note that lower values will increase time resolution, which is more important for amplitude calculations.</p>
</td></tr>
<tr><td><code id="excess_attenuation_+3A_ovlp">ovlp</code></td>
<td>
<p>Numeric vector of length 1 specifying the percentage of overlap between two
consecutive windows, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is 50. Only used for bandpass filtering. Can be set globally for the current R session via the &quot;ovlp&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="excess_attenuation_+3A_bp">bp</code></td>
<td>
<p>Numeric vector of length 2 giving the lower and upper limits of a frequency bandpass filter (in kHz). Alternatively, when set to 'freq.range' (default), the function will use the 'bottom.freq' and 'top.freq' for each sound as the bandpass range.</p>
</td></tr>
<tr><td><code id="excess_attenuation_+3A_path">path</code></td>
<td>
<p>Character string containing the directory path where the sound files are found. Only needed when 'X' is not an extended selection table. If not supplied the current working directory is used. Can be set globally for the current R session via the &quot;sound.files.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Excess attenuation is the amplitude loss of a sound in excess due to spherical spreading (observed attenuation - expected attenuation). With every doubling of distance, sounds attenuate with a 6 dB loss of amplitude (Morton, 1975; Marten &amp; Marler, 1977). Any additional loss of amplitude results in energy loss in excess of that expected to occur with distance via spherical spreading. So it represents power loss due to additional factors like vegetation or atmospheric conditions (Wiley &amp; Richards, 1978). 
It accounts for attenuation from additional factors such as:
</p>

<ul>
<li> <p><code>Ground absorption</code>: sound energy can be absorbed by the ground, especially in environments like forests with soft or uneven terrain.
</p>
</li>
<li> <p><code>Vegetation and obstacles</code>: trees, shrubs, and other obstacles can absorb or scatter sound energy, reducing the sound level more than geometric spreading alone would predict.
</p>
</li>
<li> <p><code>Air absorption</code>: as sound travels through air, it loses energy due to air molecules absorbing the sound waves, and this effect becomes more pronounced over longer distances.
</p>
</li>
<li> <p><code>Wind and temperature gradients</code>: These environmental factors can cause sound waves to bend or refract.
</p>
</li></ul>

<p>Excess attenuation is computed as <code>-20 * log10(rms("test signal") / rms("reference signal"))) - (20 * log10(1 / "distance")</code> in which 'rms(..)' represents the root mean square of an amplitude envelope. Low values indicate little additional attenuation. The goal of the function is to measure the excess attenuation on sounds in which a reference playback has been re-recorded at increasing distances. The 'sound.id' column must be used to indicate which sounds belonging to the same category (e.g. song-types). The function will then compare each sound type to the corresponding reference sound. Two approaches for computing excess attenuation are provided (see 'type' argument). NAs will be returned if one of the envelopes is completely flat (e.g. no variation in amplitude).
</p>


<h3>Value</h3>

<p>Object 'X' with an additional column,  'excess.attenuation', containing the computed excess attenuation values (in dB).
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.
</p>
<p>Dabelsteen, T., Larsen, O. N., &amp; Pedersen, S. B. (1993). Habitat-induced degradation of sound signals: Quantifying the effects of communication sounds and bird location on blur ratio, excess attenuation, and signal-to-noise ratio in blackbird song. The Journal of the Acoustical Society of America, 93(4), 2206.
</p>
<p>Dabelsteen, T., &amp; Mathevon, N. (2002). Why do songbirds sing intensively at dawn?. Acta ethologica, 4(2), 65-72.
</p>
<p>Darden, SK, Pedersen SB, Larsen ON, &amp; Dabelsteen T. (2008). Sound transmission at ground level in a short-grass prairie habitat and its implications for long-range communication in the swift fox *Vulpes velox*. The Journal of the Acoustical Society of America, 124(2), 758-766.
</p>
<p>Marten K, &amp; Marler P. (1977). Sound transmission and its significance for animal vocalization. Behavioral Ecology and Sociobiology, 2(3), 271-290.
</p>
<p>Morton ES. (1975). Ecological sources of selection on avian sounds. The American Naturalist, 109(965), 17-34.
</p>
<p>Wiley, R., &amp; Richards, D. G. (1978). Physical constraints on acoustic communication in the atmosphere: implications for the evolution of animal vocalizations. Behavioral Ecology and Sociobiology, 3(1), 69-94.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+spcc">spcc</a></code>; <code><a href="#topic+envelope_correlation">envelope_correlation</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
  # load example data
  data("test_sounds_est")

  # using method 1
  # add reference to X
  X &lt;- set_reference_sounds(X = test_sounds_est)
  excess_attenuation(X = X)

  # using method 2
  X &lt;- set_reference_sounds(X = test_sounds_est, method = 2)
  # excess_attenuation(X = X)
}

</code></pre>

<hr>
<h2 id='find_markers'>Find acoustic markers on test sound files</h2><span id='topic+find_markers'></span>

<h3>Description</h3>

<p><code>find_markers</code> find acoustic markers on test (re-recorded) sound files using spectrographic cross-correlation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>find_markers(
  X,
  markers = c("start_marker", "end_marker"),
  test.files = NULL,
  path = getOption("sound.files.path", "."),
  pb = getOption("pb", TRUE),
  cores = getOption("mc.cores", 1),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="find_markers_+3A_x">X</code></td>
<td>
<p>Object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the reference to the sounds in the master sound file. Must contain the following columns: 1) &quot;sound.files&quot;: name of the .wav files, 2) &quot;selec&quot;: unique selection identifier (within a sound file), 3) &quot;start&quot;: start time, 4) &quot;end&quot;: end time of selections and 5) &quot;sound.id&quot;: unique identifier for each of the annotated sounds in 'X'. Columns for 'top.freq', 'bottom.freq' and 'channel' are optional. The acoustic start and end markers (added by <code><a href="#topic+master_sound_file">master_sound_file</a></code>) should be labeled as &quot;start_marker&quot; and &quot;end_marker&quot; respectively. Required.</p>
</td></tr>
<tr><td><code id="find_markers_+3A_markers">markers</code></td>
<td>
<p>Character vector with the name of the annotations (as in the column 'sound.id') to be used as templates for cross-correlation. Default is <code>c("start_marker", "end_marker")</code>. Using more than one marker is recommended as the time difference between their position can be used to evaluate the precision of the detection (see 'Value' section).</p>
</td></tr>
<tr><td><code id="find_markers_+3A_test.files">test.files</code></td>
<td>
<p>Character vector of length 1 with the name(s) of the test (re-recorded) file(s) in which to search for the marker(s). If not supplied all sound files in 'path' are used instead.</p>
</td></tr>
<tr><td><code id="find_markers_+3A_path">path</code></td>
<td>
<p>Character string containing the directory path where test (re-recorded) sound files are found.</p>
</td></tr>
<tr><td><code id="find_markers_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="find_markers_+3A_cores">cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the &quot;mc.cores&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="find_markers_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed to <code><a href="ohun.html#topic+template_correlator">template_correlator</a></code> for setting cross-correlation parameters (e.g. 'wl', 'ovlp', etc).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function takes a master sound file's reference data ('X') and finds the position of acoustics markers ('markers' argument, included as selections in 'X') in the re-recorded sound files. This is used to align signals found in re-recorded sound files according to a master sound file referenced in 'X'. The position of the markers is determined as the highest spectrogram cross-correlation value for each marker using the functions <code><a href="ohun.html#topic+template_correlator">template_correlator</a></code> and <code><a href="ohun.html#topic+template_detector">template_detector</a></code>. <strong>Make sure the master sound file (that referred to in 'X') is found in the same folder than the re-recorded sound files</strong>. Take a look at the package vignette for information on how to incorporate this function into a sound degradation analysis workflow. In cases in which markers are not correctly detected editing test sound files to remove audio segments with no target sounds (before the start marker and after the end marker) can improve performance. Using a low 'hop.size' or window length 'wl' (used internally by <code><a href="ohun.html#topic+template_correlator">template_correlator</a></code>) can help to improve precision Other spectrogram types (argument 'type' in <code><a href="ohun.html#topic+template_correlator">template_correlator</a></code>) can sometimes show better performance when markers are highly degraded.
</p>


<h3>Value</h3>

<p>A data frame with test file names, marker id, maximum cross-correlation score for each marker and the start and end where it was detected. If two or more markers are used the function computes an additional column, 'time.mismatch', that compares the time difference between the two markers in the test-files against that in the master sound file. In a perfect detection the value must be 0.
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+manual_realign">manual_realign</a></code>; <code><a href="#topic+auto_realign">auto_realign</a></code>; <code><a href="#topic+align_test_files">align_test_files</a></code>; <code><a href="#topic+master_sound_file">master_sound_file</a></code>
</p>
<p>Other test sound alignment: 
<code><a href="#topic+align_test_files">align_test_files</a>()</code>,
<code><a href="#topic+auto_realign">auto_realign</a>()</code>,
<code><a href="#topic+manual_realign">manual_realign</a>()</code>,
<code><a href="#topic+plot_aligned_sounds">plot_aligned_sounds</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
  # set temporary directory
  td &lt;- tempdir()

  # load example data
  data("master_est")

  # save example files in working director to recreate a case in which working
  # with sound files instead of extended selection tables.
  # This doesn't have to be done with your own data as you will
  # have them as sound files already.
  for (i in unique(test_sounds_est$sound.files)[1:2]) {
    writeWave(object = attr(test_sounds_est, "wave.objects")[[i]], file.path(td, i))
  }

  # save master file
  writeWave(object = attr(master_est, "wave.objects")[[1]], file.path(td, "master.wav"))

  # set path and no progress bar in global options
  options(sound.files.path = td, pb = FALSE)

  # get marker position
  markers &lt;- find_markers(X = master_est, test.files = unique(test_sounds_est$sound.files)[2])
}
</code></pre>

<hr>
<h2 id='manual_realign'>Plot spectrograms to check test sound files alignment</h2><span id='topic+manual_realign'></span>

<h3>Description</h3>

<p><code>manual_realign</code> plots spectrograms to visually inspect alignment precision on test sound files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>manual_realign(
  X,
  Y,
  hop.size = getOption("hop.size", 11.6),
  wl = getOption("wl", NULL),
  ovlp = getOption("ovlp", 0),
  path = getOption("sound.files.path", "."),
  collevels = seq(-120, 0, 5),
  palette = viridis::viridis,
  duration = 2,
  mar = 0.2,
  step.lengths = c(5, 30),
  flim = NULL,
  label.col = "white",
  ext.window = TRUE,
  width = 10,
  height = 5,
  srt = 0,
  cex = 1,
  fast.spec = TRUE,
  marker = "start_marker",
  grid = 0.2,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="manual_realign_+3A_x">X</code></td>
<td>
<p>Object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the reference to the test sounds (typically the output of <code><a href="#topic+align_test_files">align_test_files</a></code>). Must contain the following columns: 1) &quot;sound.files&quot;: name of the .wav files, 2) &quot;selec&quot;: unique selection identifier (within a sound file), 3) &quot;start&quot;: start time and 4) &quot;end&quot;: end time of selections, 5)  &quot;bottom.freq&quot;: low frequency for bandpass, 6) &quot;top.freq&quot;: high frequency for bandpass and 7) &quot;sound.id&quot;: ID of sounds used to identify counterparts across distances. Each sound must have a unique ID within a distance.</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_y">Y</code></td>
<td>
<p>object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the master sound file annotations. This should be the same data than that was used for finding the position of markers in <code><a href="#topic+find_markers">find_markers</a></code>. It should also contain a 'sound.id' column.</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_hop.size">hop.size</code></td>
<td>
<p>A numeric vector of length 1 specifying the time window duration (in ms). Default is 11.6 ms, which is equivalent to 512 wl for a 44.1 kHz sampling rate. Ignored if 'wl' is supplied. Can be set globally for the current R session via the &quot;hop.size&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_wl">wl</code></td>
<td>
<p>a vector with a single even integer number specifying the window length of the spectrogram, default is <code>NULL</code>. If supplied, 'hop.size' is ignored. Odd integers will be rounded up to the nearest even number. Can be set globally for the current R session via the &quot;wl&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_ovlp">ovlp</code></td>
<td>
<p>Numeric vector of length 1 specifying the percentage of overlap between two consecutive windows, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is 0. Can be set globally for the current R session via the &quot;ovlp&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_path">path</code></td>
<td>
<p>Character string containing the directory path where the sound files are found. Only needed when 'X' is not an extended selection table. If not supplied the current working directory is used. Can be set globally for the current R session via the &quot;sound.files.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_collevels">collevels</code></td>
<td>
<p>A numeric vector of length 3. Specifies levels to partition the amplitude range of the spectrogram (in dB). The more levels the higher the resolution of the spectrogram. Default is seq(-120, 0, 1).</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_palette">palette</code></td>
<td>
<p>Color palette function for spectrogram. Default is  <code><a href="viridis.html#topic+viridis">viridis</a></code>. See <code><a href="seewave.html#topic+spectro">spectro</a></code> for more palettes. Palettes as <code><a href="monitoR.html#topic+specCols">gray.2</a></code> may work better when <code>fast.spec = TRUE</code> (an argument that can be passed to the internal spectrogram function using &quot;...&quot;).</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_duration">duration</code></td>
<td>
<p>A numeric vector of length 1. Specifies the overall duration of the clip that will be plotted. Notice that only the initial part of the test files are plotted as this is enough to tell the precision of the alignment.</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_mar">mar</code></td>
<td>
<p>numeric vector of length 1. Specifies the minimum margins adjacent (before and after) to the start of the marker used for checking alignments (see 'marker' argument). Default is 0.2.</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_step.lengths">step.lengths</code></td>
<td>
<p>Numeric vector of length 2 indicating the time length (in ms) of short (min(step.lengths)) and long steps (max(step.lengths)) for manually aligning spectrograms. Default is <code>c(5, 30)</code>.</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_flim">flim</code></td>
<td>
<p>A numeric vector of length 2 indicating the highest and lowest frequency limits (kHz) of the spectrogram, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is <code>NULL</code> which will plot spectrograms in the full frequency range (0 - nyquist frequency).</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_label.col">label.col</code></td>
<td>
<p>Character string controlling the color of lines and sound ID labels.</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_ext.window">ext.window</code></td>
<td>
<p>Logical. If <code>TRUE</code> then and external graphic window is used.Dimensions can be set using the 'width' and 'height' arguments. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_width">width</code></td>
<td>
<p>Numeric vector of length 1. Single value (in inches) indicating the width of the output image files. Default is 10.</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_height">height</code></td>
<td>
<p>Numeric vector of length 1. Single value (in inches) indicating the height of the output image files. Default is 5.</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_srt">srt</code></td>
<td>
<p>Numeric argument of length 1. The rotation (in degrees) of the sound id labels. Default is 0.</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_cex">cex</code></td>
<td>
<p>Numeric argument of length 1controlling the size of sound id text labels. Default is 1.</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_fast.spec">fast.spec</code></td>
<td>
<p>Logical. If <code>TRUE</code> then image function is used internally to create spectrograms, which substantially increases performance (much faster), although some options become unavailable, as collevels (amplitude scale). Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_marker">marker</code></td>
<td>
<p>Character string with the name of the marker to be used as the main reference for checking/adjusting time alignments. Default is 'start_marker'. Note that this can take any of the sound IDs in 'Y$sound.id'.</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_grid">grid</code></td>
<td>
<p>Numeric vector of length 1 controlling the spacing between vertical lines on the spectrogram. Default is 0.2 s. Use 0 to remove grid.</p>
</td></tr>
<tr><td><code id="manual_realign_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed to the internal spectrogram
creating function for customizing graphical output. The function is a modified
version of <code><a href="seewave.html#topic+spectro">spectro</a></code>, so it takes the same arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function allows the interactive adjustment of the alignment of test sound files produced by <code><a href="#topic+align_test_files">align_test_files</a></code>. The function generates a multipanel graph with the spectrogram of the master sound file in top of that from test sound files, highlighting the position of correspondent test sounds on both in order to simplify assessing and adjusting their alignment. Spectrograms include the first few seconds of the sound files (controlled by 'duration') which is usually enough to tell the precision of the alignment. The lower spectrogram shows a series of 'buttons' that users can click on to control if the test sound file spectrogram (low panel) needs to be moved to the left (&quot;&lt;&quot;) or right (&quot;&gt;&quot;). Users can also reset the spectrogram to its original position ('reset'), move on to the next sound file in 'X' (test sound file annotations) or stop the process (stop button). The function returns an object similar to the input object 'X' in which the start and end of the sounds have been adjusted.
</p>


<h3>Value</h3>

<p>Creates a multipanel graph with spectrograms of master and test sound files in which users can interactively adjust their alignment in time. Return an object similar to the input object 'X' in which the start and end of the sounds have been adjusted.
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+auto_realign">auto_realign</a></code>; <code><a href="#topic+find_markers">find_markers</a></code>; <code><a href="#topic+align_test_files">align_test_files</a></code>
</p>
<p>Other test sound alignment: 
<code><a href="#topic+align_test_files">align_test_files</a>()</code>,
<code><a href="#topic+auto_realign">auto_realign</a>()</code>,
<code><a href="#topic+find_markers">find_markers</a>()</code>,
<code><a href="#topic+plot_aligned_sounds">plot_aligned_sounds</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
  # load example data
  data("master_est")

  # save example files in working director to recreate a case in which working
  # with sound files instead of extended selection tables.
  # This doesn't have to be done with your own data as you will
  # have them as sound files already.
  for (i in unique(test_sounds_est$sound.files)[1:2]) {
  writeWave(object = attr(test_sounds_est, "wave.objects")[[i]], file.path(tempdir(), i))
  }

  # save master file
  writeWave(object = attr(master_est, "wave.objects")[[1]], file.path(tempdir(), "master.wav"))

  # get marker position
  markers &lt;- find_markers(X = master_est, test.files = unique(test_sounds_est$sound.files)[2], 
  path = tempdir())

  # align all test sounds
  alg.tests &lt;- align_test_files(X = master_est, Y = markers)

  # add error to alignment
  lag &lt;- (as.numeric(as.factor(alg.tests$sound.files)) - 2) / 30
  alg.tests$start &lt;- alg.tests$start + lag
  alg.tests$end &lt;- alg.tests$end + lag

  if(interactive()){
  realigned_est &lt;- manual_realign(X = alg.tests, Y = master_est, duration = 2,
  ovlp = 50, hop.size = 14, collevels = seq(-140, 0, 5), palette = viridis::mako,
  ext.window = FALSE)
 }
}
</code></pre>

<hr>
<h2 id='master_est'>Extended selection table of master acoustic data</h2><span id='topic+master_est'></span>

<h3>Description</h3>

<p>Extended selection table (est) with the acoustic data and annotations of the master sound file of synthetic sounds. The synthetic sounds are 2 s long, frequency modulated and amplitude modulated. The data was created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package. The re-recorded data generated with these sounds is found in the example object <code><a href="#topic+test_sounds_est">test_sounds_est</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(master_est)
</code></pre>


<h3>Format</h3>

<p>Extended selection table object in the <a href="https://cran.r-project.org/package=warbleR">warbleR</a> format, which contains annotations and acoustic data.
</p>


<h3>Source</h3>

<p>Marcelo Araya-Salas
</p>


<h3>See Also</h3>

<p>Other data sets: 
<code><a href="#topic+test_sounds_est">test_sounds_est</a></code>
</p>

<hr>
<h2 id='master_sound_file'>Create a master sound file</h2><span id='topic+master_sound_file'></span>

<h3>Description</h3>

<p><code>master_sound_file</code> creates a master sound file to be used in playback experiments related to sound degradation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>master_sound_file(
  X,
  file.name,
  dest.path = getOption("dest.path", "."),
  overwrite = FALSE,
  delay = 1,
  gap.duration = 1,
  amp.marker = 2,
  flim = c(0, 4),
  cex = 14,
  path = getOption("sound.files.path", ".")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="master_sound_file_+3A_x">X</code></td>
<td>
<p>Object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the reference to the model sounds. Must contain the following columns: 1) &quot;sound.files&quot;: name of the .wav files, 2) &quot;selec&quot;: unique selection identifier (within a sound file), 3) &quot;start&quot;: start time and 4) &quot;end&quot;: end time of selections, 5)  &quot;bottom.freq&quot;: low frequency for bandpass and 6) &quot;top.freq&quot;: high frequency for bandpass. An optional 'sound.id' column can be included to use a custom label for each sound in the output. This column must contain a unique id for each sound (labels cannot repeated). If not supplied the function will make it by combining the sound file and selection columns.</p>
</td></tr>
<tr><td><code id="master_sound_file_+3A_file.name">file.name</code></td>
<td>
<p>Character string indicating the name of the sound file.</p>
</td></tr>
<tr><td><code id="master_sound_file_+3A_dest.path">dest.path</code></td>
<td>
<p>Character string containing the directory path where the sound file will be saved.
If <code>NULL</code> (default) then the current working directory will be used instead.</p>
</td></tr>
<tr><td><code id="master_sound_file_+3A_overwrite">overwrite</code></td>
<td>
<p>Logical argument to determine if the function will overwrite any existing sound file with the same file name. Default is the current working directory.</p>
</td></tr>
<tr><td><code id="master_sound_file_+3A_delay">delay</code></td>
<td>
<p>Numeric vector of length 1 to control the duration (in s) of a silence gap at the beginning (and at the end) of the sound file. This can be useful to allow some time at the start of the playback experiment. Default is 1.</p>
</td></tr>
<tr><td><code id="master_sound_file_+3A_gap.duration">gap.duration</code></td>
<td>
<p>Numeric vector of length 1 to control the duration (in s) of silence gaps to be placed in between sounds. Default is 1 s.</p>
</td></tr>
<tr><td><code id="master_sound_file_+3A_amp.marker">amp.marker</code></td>
<td>
<p>Numeric vector of length 1 to use as a constant to amplify markers amplitude. This is useful to increase the amplitude of markers in relation to those of sounds, so it is picked up at further distances. Default is 2.</p>
</td></tr>
<tr><td><code id="master_sound_file_+3A_flim">flim</code></td>
<td>
<p>Numeric vector of length 2 to control the (approximate) frequency range in which the markers would be found. If <code>NULL</code> markers would span across the entire frequency range. Default is c(0, 4).</p>
</td></tr>
<tr><td><code id="master_sound_file_+3A_cex">cex</code></td>
<td>
<p>Numeric vector of length 1 indicating the font size for the start and end markers. Default is 14.</p>
</td></tr>
<tr><td><code id="master_sound_file_+3A_path">path</code></td>
<td>
<p>Character string containing the directory path where the sound files are found. Only needed when 'X' is not an extended selection table. If not supplied the current working directory is used. Can be set globally for the current R session via the &quot;sound.files.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function is intended to simplify the creation of master sound files for playback experiments in sound degradation studies. The function clips sounds from sound files (or wave objects from extended selection tables) and concatenates them in a single sound file. The function also adds acoustic markers at the start and end of the playback that can be used to time-sync test (re-recorded) sounds to facilitate the streamlining of degradation quantification. There is no predefined limit to the duration of the output master sound file, although long this be constrained by computer memory. As a reference, master sound files of up to 10 min have been created in a 16GB RAM laptop computer.
</p>


<h3>Value</h3>

<p>A .wav file in 'path' as well as a data frame in the R environment with the annotations (i.e. time position) of sounds in the master sound file and an additional column 'sound.id' that provides a unique id for each sound in the sound file. This is useful for identifying/labeling sounds in test (re-recorded) sound files for downstream analyses.
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.

</p>


<h3>See Also</h3>

<p><code><a href="Rraven.html#topic+exp_raven">exp_raven</a></code>
</p>
<p>Other prepare acoustic data: 
<code><a href="#topic+synth_sounds">synth_sounds</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
  # load example data from warbleR
  data(list = c(
    "Phae.long1", "Phae.long2", "Phae.long3", "Phae.long4",
    "lbh_selec_table"
  ))

  # save sound files to temporary folder
  writeWave(Phae.long1, file.path(tempdir(), "Phae.long1.wav"))
  writeWave(Phae.long2, file.path(tempdir(), "Phae.long2.wav"))
  writeWave(Phae.long3, file.path(tempdir(), "Phae.long3.wav"))
  writeWave(Phae.long4, file.path(tempdir(), "Phae.long4.wav"))

  # make an extended selection table
  est &lt;- selection_table(
    X = lbh_selec_table, extended = TRUE,
    path = tempdir()
  )

  # create master sound file
  master.sel.tab &lt;- master_sound_file(
    X = est, file.name = "example_master",
    dest.path = tempdir(), gap.duration = 0.3
  )

## Not run: 
  # the following code exports the selection table to Raven
  # using the Rraven package
  Rraven::exp_raven(master.sel.tab, path = tempdir(),
  file.name = "example_master_selection_table")
  
## End(Not run)
}

</code></pre>

<hr>
<h2 id='noise_profile'>Measure full spectrum sound noise profiles</h2><span id='topic+noise_profile'></span>

<h3>Description</h3>

<p><code>noise_profile</code> Measure full spectrum sound pressure levels (i.e. noise profiles) in sound files or extended selection tables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>noise_profile(
  X = NULL,
  files = NULL,
  mar = NULL,
  noise.ref = c("adjacent", "custom"),
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  path = getOption("sound.files.path", "."),
  bp = NULL,
  hop.size = getOption("hop.size", 1),
  wl = getOption("wl", NULL),
  PSD = FALSE,
  norm = TRUE,
  dB = c("A", "B", "C", "D", "ITU", "max0"),
  averaged = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="noise_profile_+3A_x">X</code></td>
<td>
<p>Object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the reference to the test sounds . Must contain the following columns: 1) &quot;sound.files&quot;: name of the .wav files, 2) &quot;selec&quot;: unique selection identifier (within a sound file), 3) &quot;start&quot;: start time and 4) &quot;end&quot;: end time of selections, 5)  &quot;bottom.freq&quot;: low frequency for bandpass, 6) &quot;top.freq&quot;: high frequency for bandpass and 7) &quot;sound.id&quot;: ID of sounds used to identify counterparts across distances (needed for &quot;custom&quot; noise reference, see &quot;noise.ref&quot; argument). Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="noise_profile_+3A_files">files</code></td>
<td>
<p>Character vector with names of wave files to be analyzed. Files must be found in 'path' supplied (or in the working directory if 'path' is not supplied). Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="noise_profile_+3A_mar">mar</code></td>
<td>
<p>numeric vector of length 1. Specifies the margins adjacent to
the start and end points of selection over which to measure ambient noise. Required if 'X' is supplied and ignored if not supplied. Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="noise_profile_+3A_noise.ref">noise.ref</code></td>
<td>
<p>Character vector of length 1 to determined which noise segment must be used for measuring ambient noise. Ignored if 'X' is not supplied. Two options are available:
</p>

<ul>
<li> <p><code>adjacent</code>: measure ambient noise right before the sound (using argument 'mar' to define duration of ambient noise segments).
</p>
</li>
<li> <p><code>custom</code>: measure ambient noise segments referenced in the selection table (labeled as 'ambient' in the 'sound.id' column).
</p>
</li></ul>
</td></tr>
<tr><td><code id="noise_profile_+3A_cores">cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the &quot;mc.cores&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="noise_profile_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="noise_profile_+3A_path">path</code></td>
<td>
<p>Character string containing the directory path where the sound files are found. Only needed when 'X' is not an extended selection table. If not supplied the current working directory is used. Can be set globally for the current R session via the &quot;sound.files.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="noise_profile_+3A_bp">bp</code></td>
<td>
<p>Numeric vector of length 2 giving the lower and upper limits of a frequency bandpass filter (in kHz). Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="noise_profile_+3A_hop.size">hop.size</code></td>
<td>
<p>A numeric vector of length 1 specifying the time window duration (in ms). Default is 1 ms, which is equivalent to ~45 wl for a 44.1 kHz sampling rate. Ignored if 'wl' is supplied. Can be set globally for the current R session via the &quot;hop.size&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="noise_profile_+3A_wl">wl</code></td>
<td>
<p>A numeric vector of length 1 specifying the window length of the spectrogram, default
is NULL. Ignored if <code>bp = NULL</code>. If supplied, 'hop.size' is ignored.
Note that lower values will increase time resolution, which is more important for amplitude ratio calculations.</p>
</td></tr>
<tr><td><code id="noise_profile_+3A_psd">PSD</code></td>
<td>
<p>Logical to control whether the Probability Mass Function (the probability distribution of frequencies). See <code><a href="seewave.html#topic+meanspec">meanspec</a></code>. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="noise_profile_+3A_norm">norm</code></td>
<td>
<p>Logical to control whether amplitude values are normalized (divided by the maximum) so the highest value is 1. See <code><a href="seewave.html#topic+meanspec">meanspec</a></code>. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="noise_profile_+3A_db">dB</code></td>
<td>
<p>A character string of length 1 specifying the type dB to return: &quot;max0&quot; for a maximum dB value at 0, &quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, and &quot;ITU&quot; for common dB weights. See <code><a href="seewave.html#topic+meanspec">meanspec</a></code>. Default is <code>"A"</code>.</p>
</td></tr>
<tr><td><code id="noise_profile_+3A_averaged">averaged</code></td>
<td>
<p>Logical to control if frequency spectra are averaged within a sound file. Default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function estimates full spectrum sound pressure levels (i.e. noise profiles) of ambient noise. This can be done on data frames/(extended) selection tables (using the segments containing no target sound or the 'ambient' sound id) or over complete sound files in the working directory (or path supplied). The function uses <code><a href="seewave.html#topic+meanspec">meanspec</a></code> internally to calculate frequency spectra.
</p>


<h3>Value</h3>

<p>A data frame containing the frequency spectra for each sound file or wave object (if 'X' is supplied and is of class 'extended.selection.table').
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305..
</p>



<h3>See Also</h3>

<p><code><a href="#topic+excess_attenuation">excess_attenuation</a></code>
</p>
<p>Other miscellaneous: 
<code><a href="#topic+add_noise">add_noise</a>()</code>,
<code><a href="#topic+attenuation">attenuation</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
  # load example data
  data("test_sounds_est")

  # measure on custom noise reference
  noise_profile(X = test_sounds_est, mar = 0.01, pb = FALSE, noise.ref = "custom")

  # remove noise selections so noise is measured right before the signals
  pe &lt;- test_sounds_est[test_sounds_est$sound.id != "ambient", ]

  noise_profile(X = pe, mar = 0.01, pb = FALSE, noise.ref = "adjacent")
}
</code></pre>

<hr>
<h2 id='plot_aligned_sounds'>Plot spectrograms to check test sound files alignment</h2><span id='topic+plot_aligned_sounds'></span>

<h3>Description</h3>

<p><code>plot_aligned_sounds</code> plots spectrograms to visually inspect alignment precision on test sound files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_aligned_sounds(
  X,
  hop.size = getOption("hop.size", 11.6),
  wl = getOption("wl", NULL),
  ovlp = getOption("ovlp", 50),
  path = getOption("sound.files.path", "."),
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  collevels = seq(-120, 0, 5),
  palette = viridis::viridis,
  duration = 2,
  mar = 0.2,
  dest.path = getOption("dest.path", "."),
  flim = NULL,
  col = "white",
  width = 7,
  height = 4,
  res = 100,
  label = TRUE,
  fast.spec = FALSE,
  srt = 0,
  cex = 1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_aligned_sounds_+3A_x">X</code></td>
<td>
<p>Object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the reference to the test sounds . Must contain the following columns: 1) &quot;sound.files&quot;: name of the .wav files, 2) &quot;selec&quot;: unique selection identifier (within a sound file), 3) &quot;start&quot;: start time and 4) &quot;end&quot;: end time of selections, 5)  &quot;bottom.freq&quot;: low frequency for bandpass, 6) &quot;top.freq&quot;: high frequency for bandpass and 7) &quot;sound.id&quot;: ID of sounds used to identify counterparts across distances. Each sound must have a unique ID within a distance.</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_hop.size">hop.size</code></td>
<td>
<p>A numeric vector of length 1 specifying the time window duration (in ms). Default is 11.6 ms, which is equivalent to 512 wl for a 44.1 kHz sampling rate. Ignored if 'wl' is supplied. Can be set globally for the current R session via the &quot;hop.size&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_wl">wl</code></td>
<td>
<p>A numeric vector of length 1 specifying the window length of the spectrogram, default
is NULL. Ignored if <code>bp = NULL</code>. If supplied, 'hop.size' is ignored.</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_ovlp">ovlp</code></td>
<td>
<p>Numeric vector of length 1 specifying the percentage of overlap between two
consecutive windows, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is 0. Can be set globally for the current R session via the &quot;ovlp&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_path">path</code></td>
<td>
<p>Character string containing the directory path where the sound files are found. Only needed when 'X' is not an extended selection table. If not supplied the current working directory is used. Can be set globally for the current R session via the &quot;sound.files.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_cores">cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the &quot;mc.cores&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_collevels">collevels</code></td>
<td>
<p>A numeric vector of length 3. Specifies levels to partition the
amplitude range of the spectrogram (in dB). The more levels the higher the
resolution of the spectrogram. Default is seq(-40, 0, 1). seq(-115, 0, 1) will produces spectrograms
similar to other acoustic analysis software packages.</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_palette">palette</code></td>
<td>
<p>Color palette function for spectrogram. Default is  <code><a href="viridis.html#topic+viridis">viridis</a></code>. See
<code><a href="seewave.html#topic+spectro">spectro</a></code> for more palettes. Palettes as <code><a href="monitoR.html#topic+specCols">gray.2</a></code> may work better when <code>fast.spec = TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_duration">duration</code></td>
<td>
<p>A numeric vector of length 1. Specifies the overall duration of the clip that will be plotted. Notice that only the initial part of the test files are plotted as this is enough to tell the precision of the alignment.</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_mar">mar</code></td>
<td>
<p>numeric vector of length 1. Specifies the margins adjacent to the start of the first annotation to be included in the plot.</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_dest.path">dest.path</code></td>
<td>
<p>Character string containing the directory path where the image files will be saved. If not supplied the current working directory will be used instead. Can be set globally for the current R session via the &quot;dest.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_flim">flim</code></td>
<td>
<p>A numeric vector of length 2 indicating the highest and lowest frequency limits (kHz) of the spectrogram, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is <code>NULL</code> which will plot spectrograms in the full frequency range (0 - nyquist frequency).</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_col">col</code></td>
<td>
<p>Character string controlling the color of lines and sound ID labels.</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_width">width</code></td>
<td>
<p>Numeric vector of length 1. Single value (in inches) indicating the width of the output image files. Default is 7.</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_height">height</code></td>
<td>
<p>Numeric vector of length 1. Single value (in inches) indicating the height of the output image files. Default is 4.</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_res">res</code></td>
<td>
<p>Numeric argument of length 1. Controls image resolution. Default is 100 (faster) although 300 - 400 is recommended for publication/presentation quality.</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_label">label</code></td>
<td>
<p>Logical to control if labels (from 'sound.id' column in 'X') are plotted. Default is  <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_fast.spec">fast.spec</code></td>
<td>
<p>Logical. If <code>TRUE</code> then image function is used internally to create spectrograms, which substantially
increases performance (much faster), although some options become unavailable, as collevels (amplitude scale). Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_srt">srt</code></td>
<td>
<p>Numeric argument of length 1. The rotation (in degrees) of the sound id labels. Default is 0.</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_cex">cex</code></td>
<td>
<p>Numeric argument of length 1controlling the size of sound id text labels. Default is 1.</p>
</td></tr>
<tr><td><code id="plot_aligned_sounds_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed to the internal spectrogram
creating function for customizing graphical output. The function is a modified
version of <code><a href="seewave.html#topic+spectro">spectro</a></code>, so it takes the same arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This functions aims to simplify the evaluation of the alignment of test sound files from  <code><a href="#topic+align_test_files">align_test_files</a></code>. The function creates a single spectrogram for each sound file (saved at 'dest.path'). Spectrograms include the first few seconds of the sound files (controlled by 'duration') which is usually enough to tell the precision of the alignment. The plots include vertical lines denoting the start and end of each sound as well as the sound ID ('sound.id' column in 'X'). Note that no plot is created in the R graphic device.
</p>


<h3>Value</h3>

<p>Image files in jpeg format with spectrograms in the working directory, one for each sound file in 'X'. It also returns the file path of the images invisibly.
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+manual_realign">manual_realign</a></code>;  <code><a href="#topic+auto_realign">auto_realign</a></code>; <code><a href="#topic+find_markers">find_markers</a></code>; <code><a href="#topic+align_test_files">align_test_files</a></code>
</p>
<p>Other test sound alignment: 
<code><a href="#topic+align_test_files">align_test_files</a>()</code>,
<code><a href="#topic+auto_realign">auto_realign</a>()</code>,
<code><a href="#topic+find_markers">find_markers</a>()</code>,
<code><a href="#topic+manual_realign">manual_realign</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
  # load example data
  data("test_sounds_est")

  # plot (look into temporary working directory `tempdir()`)
  plot_aligned_sounds(X = test_sounds_est, dest.path = tempdir(), duration = 3, ovlp = 0)
}

</code></pre>

<hr>
<h2 id='plot_blur_ratio'>Plot blur ratio</h2><span id='topic+plot_blur_ratio'></span>

<h3>Description</h3>

<p><code>plot_blur_ratio</code> plots time and frequency blur ratio in sounds referenced in an extended selection table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_blur_ratio(
  X,
  type = c("envelope", "spectrum"),
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  env.smooth = getOption("env.smooth", 200),
  spec.smooth = getOption("spec.smooth", 5),
  res = 150,
  flim = c("-1", "+1"),
  hop.size = getOption("hop.size", 11.6),
  wl = getOption("wl", NULL),
  ovlp = getOption("ovlp", 70),
  palette = viridis::viridis,
  collevels = seq(-120, 0, 5),
  dest.path = getOption("dest.path", "."),
  path = getOption("sound.files.path", "."),
  colors = viridis::viridis(3),
  n.samples = if (type == "envelope") 100 else 500
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_blur_ratio_+3A_x">X</code></td>
<td>
<p>The output of <code><a href="#topic+set_reference_sounds">set_reference_sounds</a></code> which is an object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the reference to the test sounds . Must contain the following columns: 1) &quot;sound.files&quot;: name of the .wav files, 2) &quot;selec&quot;: unique selection identifier (within a sound file), 3) &quot;start&quot;: start time and 4) &quot;end&quot;: end time of selections, 5) &quot;bottom.freq&quot;: low frequency for bandpass, 6) &quot;top.freq&quot;: high frequency for bandpass, 7) &quot;sound.id&quot;: ID of sounds used to identify counterparts across distances and 8) &quot;reference&quot;: identity of sounds to be used as reference for each test sound (row). See <code><a href="#topic+set_reference_sounds">set_reference_sounds</a></code> for more details on the structure of 'X'.</p>
</td></tr>
<tr><td><code id="plot_blur_ratio_+3A_type">type</code></td>
<td>
<p>Character vector of length 1 indicating the type of blur ratio to plot. The two options are 'envelope' (for regular blur ratio as in <code><a href="#topic+blur_ratio">blur_ratio</a></code>, default) and 'spectrum' (for spectrum blur ratio as in <code><a href="#topic+spectrum_blur_ratio">spectrum_blur_ratio</a></code>).</p>
</td></tr>
<tr><td><code id="plot_blur_ratio_+3A_cores">cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the &quot;mc.cores&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_blur_ratio_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_blur_ratio_+3A_env.smooth">env.smooth</code></td>
<td>
<p>Numeric vector of length 1 determining the length of the sliding window (in amplitude samples) used for a sum smooth for amplitude envelope calculation (used internally by <code><a href="seewave.html#topic+env">env</a></code>). Default is 200.</p>
</td></tr>
<tr><td><code id="plot_blur_ratio_+3A_spec.smooth">spec.smooth</code></td>
<td>
<p>Numeric vector of length 1 determining the length of the sliding window used for a sum smooth for power spectrum calculation (in kHz). Default is 5. Can be set globally for the current R session via the &quot;spec.smooth&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_blur_ratio_+3A_res">res</code></td>
<td>
<p>Numeric argument of length 1. Controls image resolution. Default is 150 (faster) although 300 - 400 is recommended for publication/presentation quality.</p>
</td></tr>
<tr><td><code id="plot_blur_ratio_+3A_flim">flim</code></td>
<td>
<p>A numeric vector of length 2 indicating the highest and lowest frequency limits (kHz) of the spectrograms, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is <code>NULL</code>. Alternatively, a character vector similar to <code>c("-1", "1")</code> in which the first number is the value to be added to the minimum bottom frequency in 'X' and the second the value to be added to the maximum top frequency in 'X'. This is computed independently for each sound id so the frequency limit better fits the frequency range of the annotated signals. This is useful when test sounds show marked differences in their frequency ranges.</p>
</td></tr>
<tr><td><code id="plot_blur_ratio_+3A_hop.size">hop.size</code></td>
<td>
<p>A numeric vector of length 1 specifying the time window duration (in ms). Default is 11.6 ms, which is equivalent to 512 wl for a 44.1 kHz sampling rate. Ignored if 'wl' is supplied. Can be set globally for the current R session via the &quot;hop.size&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_blur_ratio_+3A_wl">wl</code></td>
<td>
<p>a vector with a single even integer number specifying the window length of the spectrogram, default is <code>NULL</code>. If supplied, 'hop.size' is ignored. Odd integers will be rounded up to the nearest even number. Can be set globally for the current R session via the &quot;wl&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_blur_ratio_+3A_ovlp">ovlp</code></td>
<td>
<p>Numeric vector of length 1 specifying the percentage of overlap between two
consecutive windows, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Only used when plotting. Default is 70. Applied to both spectra and spectrograms on image files. Can be set globally for the current R session via the &quot;ovlp&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_blur_ratio_+3A_palette">palette</code></td>
<td>
<p>A color palette function to be used to assign colors in the
plot, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is <code><a href="viridis.html#topic+viridis">viridis</a></code>.</p>
</td></tr>
<tr><td><code id="plot_blur_ratio_+3A_collevels">collevels</code></td>
<td>
<p>Numeric vector indicating a set of levels which are used to partition the amplitude range of the spectrogram (in dB) as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is <code>seq(-120, 0, 5)</code>.</p>
</td></tr>
<tr><td><code id="plot_blur_ratio_+3A_dest.path">dest.path</code></td>
<td>
<p>Character string containing the directory path where the image files will be saved. If not supplied the current working directory will be used instead. Can be set globally for the current R session via the &quot;dest.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_blur_ratio_+3A_path">path</code></td>
<td>
<p>Character string containing the directory path where the sound files are found. Only needed when 'X' is not an extended selection table. If not supplied the current working directory is used. Can be set globally for the current R session via the &quot;sound.files.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_blur_ratio_+3A_colors">colors</code></td>
<td>
<p>Character vector of length 4 containing the colors to be used for the color to identify the reference sound  (element 1),  the color to identify the test sound (element 2) and the color of blurred region (element 3).</p>
</td></tr>
<tr><td><code id="plot_blur_ratio_+3A_n.samples">n.samples</code></td>
<td>
<p>Numeric vector of length 1 specifying the number of amplitude samples (or frequency bins if <code>spectrum = TRUE</code>) to use for representing power distributions. Default is 100 for <code>type = "envelope"</code> and 500 for <code>type = "spectrum"</code>. If null the raw power distribution is used (note that this can result in high RAM memory usage for large data sets).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function generates image files (in 'jpeg' format) for each possible blur ratio estimation in 'X'. The image files show the spectrograms of both sounds and the overlaid power distribution (either amplitude envelopes or power spectrum, see argument 'type') as probability mass functions (PMF). The output graphs highlight the mismatch between the compared distribution which represent the estimated blur ratio returned by either <code><a href="#topic+blur_ratio">blur_ratio</a></code> or <code><a href="#topic+spectrum_blur_ratio">spectrum_blur_ratio</a></code>. Spectrograms are shown within the frequency range of the reference sound and also show dotted lines with the time (type = &quot;envelope&quot;) or frequency range (type = &quot;spectrum&quot;) in which energy distributions where computed.
</p>


<h3>Value</h3>

<p>It returns 1 image file (in 'jpeg' format) for each blur ratio estimation, showing spectrograms of both sounds and the overlaid amplitude envelopes (or power spectra if <code>spectrum = TRUE</code>) as probability mass functions (PMF). Spectrograms are shown within the frequency range of the reference sound. It also returns the file path of the images invisibly.
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Dabelsteen, T., Larsen, O. N., &amp; Pedersen, S. B. (1993). Habitat-induced degradation of sound signals: Quantifying the effects of communication sounds and bird location on blur ratio, excess attenuation, and signal-to-noise ratio in blackbird song. The Journal of the Acoustical Society of America, 93(4), 2206.
</p>
<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+envelope_correlation">envelope_correlation</a></code>, <code><a href="#topic+spectrum_blur_ratio">spectrum_blur_ratio</a></code>, <code><a href="#topic+blur_ratio">blur_ratio</a></code>
</p>
<p>Other quantify degradation: 
<code><a href="#topic+blur_ratio">blur_ratio</a>()</code>,
<code><a href="#topic+detection_distance">detection_distance</a>()</code>,
<code><a href="#topic+envelope_correlation">envelope_correlation</a>()</code>,
<code><a href="#topic+plot_degradation">plot_degradation</a>()</code>,
<code><a href="#topic+set_reference_sounds">set_reference_sounds</a>()</code>,
<code><a href="#topic+signal_to_noise_ratio">signal_to_noise_ratio</a>()</code>,
<code><a href="#topic+spcc">spcc</a>()</code>,
<code><a href="#topic+spectrum_blur_ratio">spectrum_blur_ratio</a>()</code>,
<code><a href="#topic+spectrum_correlation">spectrum_correlation</a>()</code>,
<code><a href="#topic+tail_to_signal_ratio">tail_to_signal_ratio</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
  # load example data
  data("test_sounds_est")

  # add reference to X
  X &lt;- set_reference_sounds(X = test_sounds_est)

  # create plots
  plot_blur_ratio(X = X, dest.path = tempdir())
}

</code></pre>

<hr>
<h2 id='plot_degradation'>Save multipanel plots with reference and test sounds</h2><span id='topic+plot_degradation'></span>

<h3>Description</h3>

<p><code>plot_degradation</code> creates multipanel plots (as image files) with reference and test sounds by distance and transect.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_degradation(
  X,
  nrow = 4,
  env.smooth = getOption("env.smooth", 200),
  hop.size = getOption("hop.size", 11.6),
  wl = getOption("wl", NULL),
  ovlp = getOption("ovlp", 70),
  path = getOption("sound.files.path", "."),
  dest.path = getOption("dest.path", "."),
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  collevels = seq(-120, 0, 5),
  palette = viridis::viridis,
  flim = c("-1", "+1"),
  envelope = TRUE,
  spectrum = TRUE,
  heights = c(4, 1),
  widths = c(5, 1),
  margins = c(2, 1),
  row.height = 2,
  col.width = 2,
  cols = viridis::mako(4, alpha = 0.3),
  res = 120,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_degradation_+3A_x">X</code></td>
<td>
<p>The output of <code><a href="#topic+set_reference_sounds">set_reference_sounds</a></code> which is an object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the reference to the test sounds . Must contain the following columns: 1) &quot;sound.files&quot;: name of the .wav files, 2) &quot;selec&quot;: unique selection identifier (within a sound file), 3) &quot;start&quot;: start time and 4) &quot;end&quot;: end time of selections, 5) &quot;bottom.freq&quot;: low frequency for bandpass, 6) &quot;top.freq&quot;: high frequency for bandpass, 7) &quot;sound.id&quot;: ID of sounds used to identify counterparts across distances and 8) &quot;reference&quot;: identity of sounds to be used as reference for each test sound (row). See <code><a href="#topic+set_reference_sounds">set_reference_sounds</a></code> for more details on the structure of 'X'.</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_nrow">nrow</code></td>
<td>
<p>Numeric vector of length 1 with the number of rows per image file. Default is 4. This would be dynamically adjusted if more rows than needed are set.</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_env.smooth">env.smooth</code></td>
<td>
<p>Numeric vector of length 1 determining the length of the sliding window (in amplitude samples) used for a sum smooth for amplitude envelope and power spectrum calculations (used internally by <code><a href="seewave.html#topic+env">env</a></code>). Default is 200.</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_hop.size">hop.size</code></td>
<td>
<p>A numeric vector of length 1 specifying the time window duration (in ms). Default is 11.6 ms, which is equivalent to 512 wl for a 44.1 kHz sampling rate. Ignored if 'wl' is supplied. Can be set globally for the current R session via the &quot;hop.size&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_wl">wl</code></td>
<td>
<p>a vector with a single even integer number specifying the window length of the spectrogram, default is <code>NULL</code>. If supplied, 'hop.size' is ignored. Odd integers will be rounded up to the nearest even number. Can be set globally for the current R session via the &quot;wl&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_ovlp">ovlp</code></td>
<td>
<p>Numeric vector of length 1 specifying the percentage of overlap between two
consecutive windows, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Only used when plotting. Default is 70. Applied to both spectra and spectrograms on image files. Can be set globally for the current R session via the &quot;ovlp&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_path">path</code></td>
<td>
<p>Character string containing the directory path where the sound files are found. Only needed when 'X' is not an extended selection table. If not supplied the current working directory is used. Can be set globally for the current R session via the &quot;sound.files.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_dest.path">dest.path</code></td>
<td>
<p>Character string containing the directory path where the image files will be saved. If not supplied the current working directory will be used instead. Can be set globally for the current R session via the &quot;dest.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_cores">cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the &quot;mc.cores&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_collevels">collevels</code></td>
<td>
<p>Numeric vector indicating a set of levels which are used to partition the amplitude range of the spectrogram (in dB) as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is <code>seq(-120, 0, 5)</code>.</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_palette">palette</code></td>
<td>
<p>A color palette function to be used to assign colors in the
plot, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is <code><a href="viridis.html#topic+viridis">viridis</a></code>.</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_flim">flim</code></td>
<td>
<p>A numeric vector of length 2 indicating the highest and lowest frequency limits (kHz) of the spectrogram, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is <code>NULL</code>. Alternatively, a character vector similar to <code>c("-1", "1")</code> in which the first number is the value to be added to the minimum bottom frequency in 'X' and the second the value to be added to the maximum top frequency in 'X'. This is computed independently for each sound id so the frequency limit better fits the frequency range of the annotated signals. This is useful when test sounds show marked differences in their frequency ranges.</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_envelope">envelope</code></td>
<td>
<p>Logical to control if envelopes are plotted. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_spectrum">spectrum</code></td>
<td>
<p>Logical to control if power spectra are plotted. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_heights">heights</code></td>
<td>
<p>Numeric vector of length 2 to control the relative heights of spectrogram (first number) and amplitude envelope (second number) when <code>envelope = TRUE</code>. Default is c(4, 1).</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_widths">widths</code></td>
<td>
<p>Numeric vector of length 2 to control the relative widths of spectrogram (first number) and power spectrum (second number) when <code>spectrum = TRUE</code>. Default is c(5, 1).</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_margins">margins</code></td>
<td>
<p>Numeric vector of length 2 to control the relative time of the test sound (first number) and adjacent margins (i.e. adjacent background noise, second number) to be included in the spectrogram <code>spectrum = TRUE</code>. Default is c(2, 1) which means that each margin next to the sound is half the duration of the sound. Note that all spectrograms will have the same time length so margins will be calculated to ensure all spectrograms match the duration of the spectrogram in the longest sound. As such, this argument controls the margin on the longest sound.</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_row.height">row.height</code></td>
<td>
<p>Numeric vector of length 1 controlling the height (in inches) of sound panels in the output image file. Default is 2.</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_col.width">col.width</code></td>
<td>
<p>Numeric vector of length 1 controlling the width (in inches) of sound panels in the output image file. Default is 2.</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_cols">cols</code></td>
<td>
<p>Character vector of length 4 containing the colors to be used for the background of column and row title panels (element 1), the color of amplitude envelopes (element 2), the color of power spectra (element 3), and the background color of envelopes and spectra (element 4).</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_res">res</code></td>
<td>
<p>Numeric argument of length 1. Controls image resolution. Default is 120 (faster) although 300 - 400 is recommended for publication/presentation quality.</p>
</td></tr>
<tr><td><code id="plot_degradation_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed to the internal spectrogram
creating function for customizing graphical output. The function is a modified
version of <code><a href="seewave.html#topic+spectro">spectro</a></code>, so it takes the same arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function aims to simplify the visual inspection of sound degradation by producing multipanel figures (saved in 'dest.path') containing visualizations of each test sound and its reference. Sounds are sorted by distance (columns) and transect (if more than 1). Visualizations include spectrograms, amplitude envelopes and power spectra (the last 2 are optional). Each row includes all the copies of a sound id for a given transect (the row label includes the sound id in the first line and transect in the second line), also including its reference if it comes from another transect. Ambient noise annotations (sound.id 'ambient') are excluded. Amplitude envelopes and power spectra are computed using the functions  <code><a href="warbleR.html#topic+envelope">envelope</a></code> (warbleR package) and <code><a href="seewave.html#topic+spec">spec</a></code> (seewave package) respectively. This two visualizations show the power distribution in time and frequency between the minimum and maximum power values for each sound. Therefore scales are not necessarily comparable across panels.
</p>


<h3>Value</h3>

<p>One ore more image files with a multipanel figure of spectrograms of test sound by distance, sound id and transect. It also returns the file path of the images invisibly.
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+blur_ratio">blur_ratio</a></code>, <code><a href="#topic+plot_aligned_sounds">plot_aligned_sounds</a></code>, <code><a href="#topic+plot_degradation">plot_degradation</a></code>
</p>
<p>Other quantify degradation: 
<code><a href="#topic+blur_ratio">blur_ratio</a>()</code>,
<code><a href="#topic+detection_distance">detection_distance</a>()</code>,
<code><a href="#topic+envelope_correlation">envelope_correlation</a>()</code>,
<code><a href="#topic+plot_blur_ratio">plot_blur_ratio</a>()</code>,
<code><a href="#topic+set_reference_sounds">set_reference_sounds</a>()</code>,
<code><a href="#topic+signal_to_noise_ratio">signal_to_noise_ratio</a>()</code>,
<code><a href="#topic+spcc">spcc</a>()</code>,
<code><a href="#topic+spectrum_blur_ratio">spectrum_blur_ratio</a>()</code>,
<code><a href="#topic+spectrum_correlation">spectrum_correlation</a>()</code>,
<code><a href="#topic+tail_to_signal_ratio">tail_to_signal_ratio</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  # load example data
  data("test_sounds_est")

  # order so spectrograms from same sound id as close in the graph
  test_sounds_est &lt;- test_sounds_est[order(test_sounds_est$sound.id), ]

  # set directory to save image files
  options(dest.path = tempdir())

  # method 1
  Y &lt;- set_reference_sounds(X = test_sounds_est)

  # plot degradation spectrograms
  plot_degradation(
    X = Y, nrow = 3, ovlp = 95
  )

  # using other color palettes
  plot_degradation(
    X = Y, nrow = 3, ovlp = 95,
    cols = viridis::magma(4, alpha = 0.3),
    palette = viridis::magma
  )

  # missing some data, 2 rows
  plot_degradation(
    X = Y[-3, ], nrow = 2, ovlp = 95,
    cols = viridis::mako(4, alpha = 0.4), palette = viridis::mako, wl = 200
  )

  # changing marging and high overlap
  plot_degradation(X = Y, margins = c(5, 1), nrow = 6, ovlp = 95)

  # more rows than needed (will adjust it automatically)
  plot_degradation(X = Y, nrow = 10, ovlp = 90)


</code></pre>

<hr>
<h2 id='set_reference_sounds'>Set reference for test sounds</h2><span id='topic+set_reference_sounds'></span>

<h3>Description</h3>

<p><code>set_reference_sounds</code> set rows to be used as reference for each test sound.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_reference_sounds(
  X,
  method = getOption("method", 1),
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  path = getOption("sound.files.path", ".")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_reference_sounds_+3A_x">X</code></td>
<td>
<p>Object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the reference to the test sounds . Must contain the following columns: 1) &quot;sound.files&quot;: name of the .wav files, 2) &quot;selec&quot;: unique selection identifier (within a sound file), 3) &quot;start&quot;: start time and 4) &quot;end&quot;: end time of selections, 5)  &quot;bottom.freq&quot;: low frequency for bandpass, 6) &quot;top.freq&quot;: high frequency for bandpass, 7) &quot;sound.id&quot;: ID of sounds used to identify counterparts across distances (and transects if more than 1) and 8) &quot;distance&quot;: distance (numeric) at which each test sound was re-recorded. A 'transect' column labeling those sounds recorded in the same transect is required if 'method = 2'. 'X' can only have 1 copy for any given sound id in a distance or a transect-distance combination (if column 'transect' is supplied). In addition, 'selec' column values in 'X' cannot be duplicated within a sound file ('sound.files' column) as this combination is used to refer to specific rows in the output 'reference' column.</p>
</td></tr>
<tr><td><code id="set_reference_sounds_+3A_method">method</code></td>
<td>
<p>Integer vector of length 1 to indicate the 'experimental design' for measuring degradation. Two methods are available:
</p>

<ul>
<li> <p><code>1</code>: compare sounds (by 'sound.id') with their counterpart that was recorded at the closest distance to source (e.g. compare sounds recorded at 5m, 10m and 15m with its counterpart recorded at 1m). This is the default method. The function will try to use references from the same transect. However, if there is another test sound from the same 'sound.id' at a shorter distance in other transects, it will be used as reference instead. This behavior aims to account for the fact that in this type of experiments reference sounds are typically recorded at 1 m and at single transect.
</p>
</li>
<li> <p><code>2</code>: compare all sounds with their counterpart recorded at the distance immediately before within a transect (e.g. a sound recorded at 10m compared with the same sound recorded at 5m, then sound recorded at 15m compared with same sound recorded at 10m and so on). 'transect' column in 'X' is required.
</p>
</li></ul>

<p>Can be set globally for the current R session via the &quot;method&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="set_reference_sounds_+3A_cores">cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the &quot;mc.cores&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="set_reference_sounds_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="set_reference_sounds_+3A_path">path</code></td>
<td>
<p>Character string containing the directory path where the sound files are found. Only needed when 'X' is not an extended selection table. If not supplied the current working directory is used. Can be set globally for the current R session via the &quot;sound.files.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function adds a 'reference' column defining which sounds will be used by other functions as reference. Two methods are available (see 'methods' argument description). For method 1 the function will attempt to use re-recorded sounds from the shortest distance in the same transect as reference. However, if there is another re-recorded sound from the same 'sound.id' at a shorter distance in other transects, it will be used as reference instead. This behavior aims to account for the fact that in this type of experiments reference sounds are typically recorded at 1 m and at single transect. Note that if users want to define their own reference sound this can be set manually. If so, NAs must be used to indicate rows to be ignored. References must be indicated as a the combination of the 'sound.files' and 'selec' column. For instance, '10m.wav-1' indicates that the row in which the 'selec' column is '1' and the sound file is '10m.wav' should be used as reference. The function also checks that the information 'X' is in the right format so it wont produce errors in downstream analysis (see 'X' argument description for details on format). The function will ignore rows in which the column 'sound.id' is equals to 'ambient', 'start_marker' or 'end_marker'.
</p>


<h3>Value</h3>

<p>An object similar to 'X' with one additional column, 'reference', with the ID of the sounds to be used as reference by degradation-quantifying functions in downstream analyses. The ID is created as <code>paste(X$sound.files, X$selec, sep = "-")</code>.
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>

<p>Araya-Salas, M., &amp; Smith-Vidaurre, G. (2017). warbleR: An R package to streamline analysis of animal acoustic signals. Methods in Ecology and Evolution, 8(2), 184-191.
</p>


<h3>See Also</h3>

<p><code><a href="warbleR.html#topic+check_sound_files">check_sound_files</a></code>, <code><a href="warbleR.html#topic+check_sels">check_sels</a></code>
</p>
<p>Other quantify degradation: 
<code><a href="#topic+blur_ratio">blur_ratio</a>()</code>,
<code><a href="#topic+detection_distance">detection_distance</a>()</code>,
<code><a href="#topic+envelope_correlation">envelope_correlation</a>()</code>,
<code><a href="#topic+plot_blur_ratio">plot_blur_ratio</a>()</code>,
<code><a href="#topic+plot_degradation">plot_degradation</a>()</code>,
<code><a href="#topic+signal_to_noise_ratio">signal_to_noise_ratio</a>()</code>,
<code><a href="#topic+spcc">spcc</a>()</code>,
<code><a href="#topic+spectrum_blur_ratio">spectrum_blur_ratio</a>()</code>,
<code><a href="#topic+spectrum_correlation">spectrum_correlation</a>()</code>,
<code><a href="#topic+tail_to_signal_ratio">tail_to_signal_ratio</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
  # load example data
  data("test_sounds_est")

# save wav file examples
X &lt;- test_sounds_est[test_sounds_est$sound.files != "master.wav", ]

# method 1
Y &lt;- set_reference_sounds(X = X)

# method 2
Y &lt;- set_reference_sounds(X = X, method = 2)
}
</code></pre>

<hr>
<h2 id='signal_to_noise_ratio'>Measure attenuation as signal-to-noise ratio</h2><span id='topic+signal_to_noise_ratio'></span>

<h3>Description</h3>

<p><code>signal_to_noise_ratio</code> measures attenuation as signal-to-noise ratio of sounds referenced in an extended selection table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>signal_to_noise_ratio(
  X,
  mar = NULL,
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  eq.dur = FALSE,
  noise.ref = c("adjacent", "custom"),
  snr.formula = 1,
  bp = "freq.range",
  hop.size = getOption("hop.size", 1),
  wl = getOption("wl", NULL),
  ovlp = getOption("ovlp", 0),
  path = getOption("sound.files.path", ".")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="signal_to_noise_ratio_+3A_x">X</code></td>
<td>
<p>Object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the reference to the test sounds (typically the output of <code><a href="#topic+align_test_files">align_test_files</a></code>). Must contain the following columns: 1) &quot;sound.files&quot;: name of the .wav files, 2) &quot;selec&quot;: unique selection identifier (within a sound file), 3) &quot;start&quot;: start time and 4) &quot;end&quot;: end time of selections, 5)  &quot;bottom.freq&quot;: low frequency for bandpass, 6) &quot;top.freq&quot;: high frequency for bandpass and 7) &quot;sound.id&quot;: ID of sounds used to identify counterparts across distances (only needed for &quot;custom&quot; noise reference, see &quot;noise.ref&quot; argument).</p>
</td></tr>
<tr><td><code id="signal_to_noise_ratio_+3A_mar">mar</code></td>
<td>
<p>numeric vector of length 1. Specifies the margins adjacent to
the start point of the annotation over which to measure ambient noise.</p>
</td></tr>
<tr><td><code id="signal_to_noise_ratio_+3A_cores">cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the &quot;mc.cores&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="signal_to_noise_ratio_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="signal_to_noise_ratio_+3A_eq.dur">eq.dur</code></td>
<td>
<p>Logical. Controls whether the ambient noise segment that is measured has the same duration
to that of the sound (if <code>TRUE</code>. Default is <code>FALSE</code>). If <code>TRUE</code> then 'mar' and 'noise.ref' arguments are ignored.</p>
</td></tr>
<tr><td><code id="signal_to_noise_ratio_+3A_noise.ref">noise.ref</code></td>
<td>
<p>Character vector of length 1 to determined which noise segment must be used for measuring ambient noise. Two options are available:
</p>

<ul>
<li> <p><code>adjacent</code>: measure ambient noise right before test sounds (using argument 'mar' to define duration of ambient noise segments).
</p>
</li>
<li> <p><code>custom</code>: measure ambient noise segments referenced in the selection table (labeled as 'ambient' in the 'sound.id' column). Those segments will be used to apply the same ambient noise reference to all sounds in a sound file. Therefore, at least one 'ambient' selection for each sound file must be provided. If several 'ambient' selections by sound file are supplied, then the root mean square of the amplitude envelope will be averaged across those selections.
</p>
</li></ul>
</td></tr>
<tr><td><code id="signal_to_noise_ratio_+3A_snr.formula">snr.formula</code></td>
<td>
<p>Integer vector of length 1. Selects the formula to be used to calculate the signal-to-noise ratio (S = signal
, N = background noise):
</p>

<ul>
<li> <p><code>1</code>: ratio of S amplitude envelope root mean square to N amplitude envelope root mean square
(<code>20 * log10(rms(env(S))/rms(env(N)))</code>) as described by Darden (2008).
</p>
</li>
<li> <p><code>2</code>: ratio of the difference between S amplitude envelope root mean square and N amplitude envelope root mean square to N amplitude envelope root mean square (<code>20 * log10((rms(env(S)) - rms(env(N)))/rms(env(N)))</code>, as described by Dabelsteen et al (1993).
</p>
</li></ul>
</td></tr>
<tr><td><code id="signal_to_noise_ratio_+3A_bp">bp</code></td>
<td>
<p>Numeric vector of length 2 giving the lower and upper limits of a frequency bandpass filter (in kHz). Alternatively, when set to 'freq.range' (default), the function will use the 'bottom.freq' and 'top.freq' for each sound as the bandpass range.</p>
</td></tr>
<tr><td><code id="signal_to_noise_ratio_+3A_hop.size">hop.size</code></td>
<td>
<p>A numeric vector of length 1 specifying the time window duration (in ms). Default is 1 ms, which is equivalent to ~45 wl for a 44.1 kHz sampling rate. Ignored if 'wl' is supplied. Can be set globally for the current R session via the &quot;hop.size&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="signal_to_noise_ratio_+3A_wl">wl</code></td>
<td>
<p>A numeric vector of length 1 specifying the window length of the spectrogram, default
is NULL. Ignored if <code>bp = NULL</code>. If supplied, 'hop.size' is ignored. Note that lower values will increase time resolution, which is more important for amplitude ratios calculations.</p>
</td></tr>
<tr><td><code id="signal_to_noise_ratio_+3A_ovlp">ovlp</code></td>
<td>
<p>Numeric vector of length 1 specifying the percentage of overlap between two
consecutive windows, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is 0. Only used for bandpass filtering. Can be set globally for the current R session via the &quot;ovlp&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="signal_to_noise_ratio_+3A_path">path</code></td>
<td>
<p>Character string containing the directory path where the sound files are found. Only needed when 'X' is not an extended selection table. If not supplied the current working directory is used. Can be set globally for the current R session via the &quot;sound.files.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Signal-to-noise ratio (SNR) measures sound amplitude level in relation to ambient noise. Noise is measured on the background noise immediately before the test sound. A general margin in which ambient noise will be measured must be specified. Alternatively, a selection of ambient noise can be used as reference (see 'noise.ref' argument). When margins overlap with another sound nearby, SNR will be inaccurate, so margin length should be carefully considered. Any SNR less than or equal to one suggests background noise is equal to or overpowering the sound. The function will measure signal-to-noise ratio within the supplied frequency range (e.g. bandpass) of the reference signal ('bottom.freq' and 'top.freq' columns in 'X') by default (that is, when <code>bp = 'freq.range'</code>. SNR can be ~0 when both tail and signal have very low amplitude.
</p>


<h3>Value</h3>

<p>Object 'X' with an additional column, 'signal.to.noise.ratio',
with the signal-to-noise ratio values (in dB).
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.
</p>
<p>Holland J, Dabelsteen T, Pedersen SB, Paris AL (2001) Potential ranging cues contained within the energetic pauses of transmitted wren song. Bioacoustics 12(1):3-20.
</p>
<p>Darden, SK, Pedersen SB, Larsen ON, &amp; Dabelsteen T. (2008). Sound transmission at ground level in a short-grass prairie habitat and its implications for long-range communication in the swift fox *Vulpes velox*. The Journal of the Acoustical Society of America, 124(2), 758-766.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+excess_attenuation">excess_attenuation</a></code>
</p>
<p>Other quantify degradation: 
<code><a href="#topic+blur_ratio">blur_ratio</a>()</code>,
<code><a href="#topic+detection_distance">detection_distance</a>()</code>,
<code><a href="#topic+envelope_correlation">envelope_correlation</a>()</code>,
<code><a href="#topic+plot_blur_ratio">plot_blur_ratio</a>()</code>,
<code><a href="#topic+plot_degradation">plot_degradation</a>()</code>,
<code><a href="#topic+set_reference_sounds">set_reference_sounds</a>()</code>,
<code><a href="#topic+spcc">spcc</a>()</code>,
<code><a href="#topic+spectrum_blur_ratio">spectrum_blur_ratio</a>()</code>,
<code><a href="#topic+spectrum_correlation">spectrum_correlation</a>()</code>,
<code><a href="#topic+tail_to_signal_ratio">tail_to_signal_ratio</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
  # load example data
  data("test_sounds_est")

  # using measure ambient noise reference selections
  signal_to_noise_ratio(X = test_sounds_est, mar = 0.05, noise.ref = "custom")

  # using margin for ambient noise of 0.05 and adjacent measure ambient noise reference
  signal_to_noise_ratio(X = test_sounds_est, mar = 0.05, noise.ref = "adjacent")
}

</code></pre>

<hr>
<h2 id='spcc'>Measure spectrographic cross-correlation as a measure of sound distortion</h2><span id='topic+spcc'></span>

<h3>Description</h3>

<p><code>spcc</code> measures spectrographic cross-correlation as a measure of sound distortion in sounds referenced in an extended selection table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spcc(
  X,
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  cor.method = c("pearson", "spearman", "kendall"),
  hop.size = getOption("hop.size", 11.6),
  wl = getOption("wl", NULL),
  ovlp = getOption("ovlp", 90),
  wn = "hanning",
  path = getOption("sound.files.path", ".")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="spcc_+3A_x">X</code></td>
<td>
<p>The output of <code><a href="#topic+set_reference_sounds">set_reference_sounds</a></code> which is an object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the reference to the test sounds . Must contain the following columns: 1) &quot;sound.files&quot;: name of the .wav files, 2) &quot;selec&quot;: unique selection identifier (within a sound file), 3) &quot;start&quot;: start time and 4) &quot;end&quot;: end time of selections, 5) &quot;bottom.freq&quot;: low frequency for bandpass, 6) &quot;top.freq&quot;: high frequency for bandpass, 7) &quot;sound.id&quot;: ID of sounds used to identify counterparts across distances and 8) &quot;reference&quot;: identity of sounds to be used as reference for each test sound (row). See <code><a href="#topic+set_reference_sounds">set_reference_sounds</a></code> for more details on the structure of 'X'.</p>
</td></tr>
<tr><td><code id="spcc_+3A_cores">cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the &quot;mc.cores&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="spcc_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="spcc_+3A_cor.method">cor.method</code></td>
<td>
<p>Character string indicating the correlation coefficient to be applied (&quot;pearson&quot;, &quot;spearman&quot;, or &quot;kendall&quot;, see <code><a href="stats.html#topic+cor">cor</a></code>).</p>
</td></tr>
<tr><td><code id="spcc_+3A_hop.size">hop.size</code></td>
<td>
<p>A numeric vector of length 1 specifying the time window duration (in ms). Default is 11.6 ms, which is equivalent to 512 wl for a 44.1 kHz sampling rate. Ignored if 'wl' is supplied. Can be set globally for the current R session via the &quot;hop.size&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="spcc_+3A_wl">wl</code></td>
<td>
<p>a vector with a single even integer number specifying the window length of the spectrogram, default is <code>NULL</code>. If supplied, 'hop.size' is ignored. Odd integers will be rounded up to the nearest even number. Can be set globally for the current R session via the &quot;wl&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="spcc_+3A_ovlp">ovlp</code></td>
<td>
<p>Numeric vector of length 1 specifying % of overlap between two
consecutive windows, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is 90. High values of ovlp
slow down the function but produce more accurate results. Can be set globally for the current R session via the &quot;ovlp&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="spcc_+3A_wn">wn</code></td>
<td>
<p>A character vector of length 1 specifying the window name as in <code><a href="seewave.html#topic+ftwindow">ftwindow</a></code>.</p>
</td></tr>
<tr><td><code id="spcc_+3A_path">path</code></td>
<td>
<p>Character string containing the directory path where the sound files are found. Only needed when 'X' is not an extended selection table. If not supplied the current working directory is used. Can be set globally for the current R session via the &quot;sound.files.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Spectrographic cross-correlation measures frequency distortion of sounds as a similarity metric. Values close to 1 means very similar spectrograms (i.e. little sound distortion has occurred). Cross-correlation is measured of sounds in which a reference playback has been re-recorded at increasing distances. The 'sound.id' column must be used to indicate the function to only compare sounds belonging to the same category (e.g. song-types). The function compares each sound to the corresponding reference sound within the supplied frequency range (e.g. bandpass) of the reference sound ('bottom.freq' and 'top.freq' columns in 'X'). Two methods for computing cross-correlation are provided (see 'method' argument). The function is a wrapper on warbleR's <code><a href="warbleR.html#topic+cross_correlation">cross_correlation</a></code> function.
</p>


<h3>Value</h3>

<p>Object 'X' with an additional column, 'cross.correlation', containing the computed spectrogram cross-correlation coefficients.
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.
</p>
<p>Clark, C.W., Marler, P. &amp; Beeman K. (1987). Quantitative analysis of animal vocal phonology: an application to Swamp Sparrow song. Ethology. 76:101-115.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+blur_ratio">blur_ratio</a></code>, <code><a href="#topic+manual_realign">manual_realign</a></code>, <code><a href="warbleR.html#topic+cross_correlation">cross_correlation</a></code>
</p>
<p>Other quantify degradation: 
<code><a href="#topic+blur_ratio">blur_ratio</a>()</code>,
<code><a href="#topic+detection_distance">detection_distance</a>()</code>,
<code><a href="#topic+envelope_correlation">envelope_correlation</a>()</code>,
<code><a href="#topic+plot_blur_ratio">plot_blur_ratio</a>()</code>,
<code><a href="#topic+plot_degradation">plot_degradation</a>()</code>,
<code><a href="#topic+set_reference_sounds">set_reference_sounds</a>()</code>,
<code><a href="#topic+signal_to_noise_ratio">signal_to_noise_ratio</a>()</code>,
<code><a href="#topic+spectrum_blur_ratio">spectrum_blur_ratio</a>()</code>,
<code><a href="#topic+spectrum_correlation">spectrum_correlation</a>()</code>,
<code><a href="#topic+tail_to_signal_ratio">tail_to_signal_ratio</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
  # load example data
  data("test_sounds_est")

  # add reference to X
  X &lt;- set_reference_sounds(X = test_sounds_est)

  # get spcc
  spcc(X = X)
}

</code></pre>

<hr>
<h2 id='spectrum_blur_ratio'>Measure blur ratio in the frequency domain</h2><span id='topic+spectrum_blur_ratio'></span>

<h3>Description</h3>

<p><code>spectrum_blur_ratio</code> measures blur ratio of frequency spectra from sounds referenced in an extended selection table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spectrum_blur_ratio(
  X,
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  spec.smooth = getOption("spec.smooth", 5),
  spectra = FALSE,
  res = 150,
  hop.size = getOption("hop.size", 11.6),
  wl = getOption("wl", NULL),
  ovlp = getOption("ovlp", 70),
  path = getOption("sound.files.path", "."),
  n.bins = 100
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="spectrum_blur_ratio_+3A_x">X</code></td>
<td>
<p>The output of <code><a href="#topic+set_reference_sounds">set_reference_sounds</a></code> which is an object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the reference to the test sounds . Must contain the following columns: 1) &quot;sound.files&quot;: name of the .wav files, 2) &quot;selec&quot;: unique selection identifier (within a sound file), 3) &quot;start&quot;: start time and 4) &quot;end&quot;: end time of selections, 5) &quot;bottom.freq&quot;: low frequency for bandpass, 6) &quot;top.freq&quot;: high frequency for bandpass, 7) &quot;sound.id&quot;: ID of sounds used to identify counterparts across distances and 8) &quot;reference&quot;: identity of sounds to be used as reference for each test sound (row). See <code><a href="#topic+set_reference_sounds">set_reference_sounds</a></code> for more details on the structure of 'X'.</p>
</td></tr>
<tr><td><code id="spectrum_blur_ratio_+3A_cores">cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the &quot;mc.cores&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="spectrum_blur_ratio_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="spectrum_blur_ratio_+3A_spec.smooth">spec.smooth</code></td>
<td>
<p>Numeric vector of length 1 determining the length of the sliding window used for a sum smooth for power spectrum calculation (in kHz). Default is 5.</p>
</td></tr>
<tr><td><code id="spectrum_blur_ratio_+3A_spectra">spectra</code></td>
<td>
<p>Logical to control if power spectra are returned (as attributes). Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="spectrum_blur_ratio_+3A_res">res</code></td>
<td>
<p>Numeric argument of length 1. Controls image resolution. Default is 150 (faster) although 300 - 400 is recommended for publication/presentation quality.</p>
</td></tr>
<tr><td><code id="spectrum_blur_ratio_+3A_hop.size">hop.size</code></td>
<td>
<p>A numeric vector of length 1 specifying the time window duration (in ms). Default is 11.6 ms, which is equivalent to 512 wl for a 44.1 kHz sampling rate. Ignored if 'wl' is supplied. Can be set globally for the current R session via the &quot;hop.size&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="spectrum_blur_ratio_+3A_wl">wl</code></td>
<td>
<p>A numeric vector of length 1 specifying the window length of the spectrogram, default
is NULL. If supplied, 'hop.size' is ignored. Applied to both spectra and spectrograms on image files.</p>
</td></tr>
<tr><td><code id="spectrum_blur_ratio_+3A_ovlp">ovlp</code></td>
<td>
<p>Numeric vector of length 1 specifying the percentage of overlap between two
consecutive windows, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is 70. Applied to both spectra and spectrograms on image files. Can be set globally for the current R session via the &quot;ovlp&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="spectrum_blur_ratio_+3A_path">path</code></td>
<td>
<p>Character string containing the directory path where the sound files are found. Only needed when 'X' is not an extended selection table. If not supplied the current working directory is used. Can be set globally for the current R session via the &quot;sound.files.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="spectrum_blur_ratio_+3A_n.bins">n.bins</code></td>
<td>
<p>Numeric vector of length 1 specifying the number of frequency bins to use for representing power spectra. Default is 100. If null the raw power spectrum is used (note that this can result in high RAM memory usage for large data sets). Power spectrum values are interpolated using <code><a href="stats.html#topic+approx">approx</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Spectral blur ratio measures the degradation of sound as a function of the change in sound power in the frequency domain, analogous to the blur ratio proposed by Dabelsteen et al (1993) for the time domain (and implemented in <code><a href="#topic+blur_ratio">blur_ratio</a></code>). Low values indicate low degradation of sounds. The function measures the blur ratio of spectra from sounds in which a reference playback has been re-recorded at different distances. Spectral blur ratio is measured as the mismatch between power spectra (expressed as probability density functions) of the reference sound and the re-recorded sound. The function compares each sound type to the corresponding reference sound. The 'sound.id' column must be used to tell the function to only compare sounds belonging to the same category (e.g. song-types). Two methods for setting the experimental design are provided. All wave objects in the extended selection table must have the same sampling rate so the length of spectra is comparable. The function uses <code><a href="seewave.html#topic+spec">spec</a></code> internally to compute power spectra. NA is returned if at least one the power spectra cannot be computed.
</p>


<h3>Value</h3>

<p>Object 'X' with an additional column, 'spectrum.blur.ratio', containing the computed spectrum blur ratio values. If <code>spectra = TRUE</code> the output would include power spectra for all sounds as attributes ('attributes(X)$spectra').
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Dabelsteen, T., Larsen, O. N., &amp; Pedersen, S. B. (1993). Habitat-induced degradation of sound signals: Quantifying the effects of communication sounds and bird location on blur ratio, excess attenuation, and signal-to-noise ratio in blackbird song. The Journal of the Acoustical Society of America, 93(4), 2206.
</p>
<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+blur_ratio">blur_ratio</a></code>
</p>
<p>Other quantify degradation: 
<code><a href="#topic+blur_ratio">blur_ratio</a>()</code>,
<code><a href="#topic+detection_distance">detection_distance</a>()</code>,
<code><a href="#topic+envelope_correlation">envelope_correlation</a>()</code>,
<code><a href="#topic+plot_blur_ratio">plot_blur_ratio</a>()</code>,
<code><a href="#topic+plot_degradation">plot_degradation</a>()</code>,
<code><a href="#topic+set_reference_sounds">set_reference_sounds</a>()</code>,
<code><a href="#topic+signal_to_noise_ratio">signal_to_noise_ratio</a>()</code>,
<code><a href="#topic+spcc">spcc</a>()</code>,
<code><a href="#topic+spectrum_correlation">spectrum_correlation</a>()</code>,
<code><a href="#topic+tail_to_signal_ratio">tail_to_signal_ratio</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
  # load example data
  data("test_sounds_est")

# add reference to X
X &lt;- set_reference_sounds(X = test_sounds_est)

  # get spetrum blur ratio
  spectrum_blur_ratio(X = X)

  # using method 2
   X &lt;- set_reference_sounds(X = test_sounds_est, method = 2)
  spectrum_blur_ratio(X = X)

  # get power spectra
  sbr &lt;- spectrum_blur_ratio(X = X, spectra = TRUE)
  spctr &lt;- attributes(sbr)$spectra

  # make distance a factor for plotting
  spctr$distance &lt;- as.factor(spctr$distance)

  
  # plot
  rlang::check_installed("ggplot2")
  library(ggplot2)
  
  ggplot(spctr[spctr$freq &gt; 0.3, ], aes(y = amp, x = freq,
  col = distance)) +
  geom_line() +
  facet_wrap(~sound.id) +
  scale_color_viridis_d(alpha = 0.7) +
  labs(x = "Frequency (kHz)", y = "Amplitude (PMF)") +
  coord_flip() +
  theme_classic()
}

</code></pre>

<hr>
<h2 id='spectrum_correlation'>Measure frequency spectrum correlation</h2><span id='topic+spectrum_correlation'></span>

<h3>Description</h3>

<p><code>spectrum_correlation</code> measures frequency spectrum correlation of sounds referenced in an extended selection table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spectrum_correlation(
  X,
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  cor.method = c("pearson", "spearman", "kendall"),
  spec.smooth = getOption("spec.smooth", 5),
  hop.size = getOption("hop.size", 11.6),
  wl = getOption("wl", NULL),
  ovlp = getOption("ovlp", 70),
  path = getOption("sound.files.path", "."),
  n.bins = 100
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="spectrum_correlation_+3A_x">X</code></td>
<td>
<p>The output of <code><a href="#topic+set_reference_sounds">set_reference_sounds</a></code> which is an object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the reference to the test sounds . Must contain the following columns: 1) &quot;sound.files&quot;: name of the .wav files, 2) &quot;selec&quot;: unique selection identifier (within a sound file), 3) &quot;start&quot;: start time and 4) &quot;end&quot;: end time of selections, 5) &quot;bottom.freq&quot;: low frequency for bandpass, 6) &quot;top.freq&quot;: high frequency for bandpass, 7) &quot;sound.id&quot;: ID of sounds used to identify counterparts across distances and 8) &quot;reference&quot;: identity of sounds to be used as reference for each test sound (row). See <code><a href="#topic+set_reference_sounds">set_reference_sounds</a></code> for more details on the structure of 'X'.</p>
</td></tr>
<tr><td><code id="spectrum_correlation_+3A_cores">cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the &quot;mc.cores&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="spectrum_correlation_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="spectrum_correlation_+3A_cor.method">cor.method</code></td>
<td>
<p>Character string indicating the correlation coefficient to be applied (&quot;pearson&quot;, &quot;spearman&quot;, or &quot;kendall&quot;, see <code><a href="stats.html#topic+cor">cor</a></code>).</p>
</td></tr>
<tr><td><code id="spectrum_correlation_+3A_spec.smooth">spec.smooth</code></td>
<td>
<p>Numeric vector of length 1 determining the length of the sliding window used for a sum smooth for power spectrum calculation (in kHz). Default is 5.</p>
</td></tr>
<tr><td><code id="spectrum_correlation_+3A_hop.size">hop.size</code></td>
<td>
<p>A numeric vector of length 1 specifying the time window duration (in ms). Default is 11.6 ms, which is equivalent to 512 wl for a 44.1 kHz sampling rate. Ignored if 'wl' is supplied. Can be set globally for the current R session via the &quot;hop.size&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="spectrum_correlation_+3A_wl">wl</code></td>
<td>
<p>a vector with a single even integer number specifying the window length of the spectrogram, default is <code>NULL</code>. If supplied, 'hop.size' is ignored. Odd integers will be rounded up to the nearest even number. Can be set globally for the current R session via the &quot;wl&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="spectrum_correlation_+3A_ovlp">ovlp</code></td>
<td>
<p>Numeric vector of length 1 specifying the percentage of overlap between two
consecutive windows, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is 70. Can be set globally for the current R session via the &quot;ovlp&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="spectrum_correlation_+3A_path">path</code></td>
<td>
<p>Character string containing the directory path where the sound files are found. Only needed when 'X' is not an extended selection table. If not supplied the current working directory is used. Can be set globally for the current R session via the &quot;sound.files.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="spectrum_correlation_+3A_n.bins">n.bins</code></td>
<td>
<p>Numeric vector of length 1 specifying the number of frequency bins to use for representing power spectra. Default is 100. If null the raw power spectrum is used (note that this can result in high RAM memory usage for large data sets). Power spectrum values are interpolated using <code><a href="stats.html#topic+approx">approx</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>spectral correlation measures the similarity of two sounds in the frequency domain. The function measures the spectral correlation coefficients of sounds in which a reference playback has been re-recorded at increasing distances. Values range from 1 (identical frequency spectrum, i.e. no degradation) to 0. The 'sound.id' column must be used to indicate the function to only compare sounds belonging to the same category (e.g. song-types). The function will then compare each sound to the corresponding reference sound. Two methods for computing spectral correlation are provided (see 'method' argument). The function uses <code><a href="seewave.html#topic+meanspec">meanspec</a></code> internally to compute power spectra. Use <code><a href="#topic+spectrum_blur_ratio">spectrum_blur_ratio</a></code> to extract raw spectra values. NA is returned if at least one the power spectra cannot be computed.
</p>


<h3>Value</h3>

<p>Object 'X' with an additional column,  'spectrum.correlation', containing the computed frequency spectrum correlation coefficients.
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.
</p>
<p>Apol, C.A., Sturdy, C.B. &amp; Proppe, D.S. (2017). Seasonal variability in habitat structure may have shaped acoustic signals and repertoires in the black-capped and boreal chickadees. Evol Ecol. 32:57-74.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+envelope_correlation">envelope_correlation</a></code>, <code><a href="#topic+spectrum_blur_ratio">spectrum_blur_ratio</a></code>
</p>
<p>Other quantify degradation: 
<code><a href="#topic+blur_ratio">blur_ratio</a>()</code>,
<code><a href="#topic+detection_distance">detection_distance</a>()</code>,
<code><a href="#topic+envelope_correlation">envelope_correlation</a>()</code>,
<code><a href="#topic+plot_blur_ratio">plot_blur_ratio</a>()</code>,
<code><a href="#topic+plot_degradation">plot_degradation</a>()</code>,
<code><a href="#topic+set_reference_sounds">set_reference_sounds</a>()</code>,
<code><a href="#topic+signal_to_noise_ratio">signal_to_noise_ratio</a>()</code>,
<code><a href="#topic+spcc">spcc</a>()</code>,
<code><a href="#topic+spectrum_blur_ratio">spectrum_blur_ratio</a>()</code>,
<code><a href="#topic+tail_to_signal_ratio">tail_to_signal_ratio</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
  # load example data
  data("test_sounds_est")

  # method 1
  # add reference column
  Y &lt;- set_reference_sounds(X = test_sounds_est)

  # run spectrum correlation
  spectrum_correlation(X = Y)

  # method 2
  Y &lt;- set_reference_sounds(X = test_sounds_est, method = 2)
  # spectrum_correlation(X = Y)
}

</code></pre>

<hr>
<h2 id='synth_sounds'>Create synthetic sounds</h2><span id='topic+synth_sounds'></span>

<h3>Description</h3>

<p><code>synth_sounds</code> create synthetic sounds
</p>


<h3>Usage</h3>

<pre><code class='language-R'>synth_sounds(
  replicates = 1,
  frequencies,
  durations,
  nharmonics = 1,
  fm = FALSE,
  am = FALSE,
  am.amps = rep(c(1:4, 3:2), length.out = 11),
  mar = 0.05,
  seed = NULL,
  sig2 = 0.3,
  shuffle = FALSE,
  hrm.freqs = c(1/2, 1/3, 2/3, 1/4, 3/4, 1/5, 1/6, 1/7, 1/8, 1/9, 1/10),
  sampling.rate = 44.1,
  pb = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="synth_sounds_+3A_replicates">replicates</code></td>
<td>
<p>Numeric vector of length 1 indicating the number of replicates for each treatment combination. Default is 1. Useful for measuring variation in transmission parameters.</p>
</td></tr>
<tr><td><code id="synth_sounds_+3A_frequencies">frequencies</code></td>
<td>
<p>Numeric vector with the different frequencies (in seconds) to synthesize. A Brownian bridge motion stochastic process (<code>diff.fun == "BB"</code>) is used to simulate frequency modulation (see <code><a href="warbleR.html#topic+simulate_songs">simulate_songs</a></code>).</p>
</td></tr>
<tr><td><code id="synth_sounds_+3A_durations">durations</code></td>
<td>
<p>Numeric vector with the different durations (in seconds) to synthesize.</p>
</td></tr>
<tr><td><code id="synth_sounds_+3A_nharmonics">nharmonics</code></td>
<td>
<p>Numeric vector of length 1 specifying the number of harmonics to simulate. 1 indicates that only the fundamental
frequency harmonic will be simulated.</p>
</td></tr>
<tr><td><code id="synth_sounds_+3A_fm">fm</code></td>
<td>
<p>Logical to control if both frequency modulated sounds and pure tones (i.e. non-modulated sounds) are synthesize. If <code>FALSE</code> (default) only pure tones are synthesized.</p>
</td></tr>
<tr><td><code id="synth_sounds_+3A_am">am</code></td>
<td>
<p>Logical to control if both amplitude modulated sounds and non-modulated sounds are synthesize. If <code>FALSE</code> (default) only non-modulated sounds are synthesized.</p>
</td></tr>
<tr><td><code id="synth_sounds_+3A_am.amps">am.amps</code></td>
<td>
<p>Numeric vector with the relative amplitude for each time step to simulate amplitude modulation (only applied to the fundamental frequency). The default value (<code>rep(c(1:4, 3:2), length.out = 11)</code>) has 2 amplitude peaks (although only applied if 'am = TRUE')</p>
</td></tr>
<tr><td><code id="synth_sounds_+3A_mar">mar</code></td>
<td>
<p>Numeric vector with the duration of margins of silence around sounds in seconds. Default is <code>0.05</code>.</p>
</td></tr>
<tr><td><code id="synth_sounds_+3A_seed">seed</code></td>
<td>
<p>Numeric vector of length 1. This allows users to get the same results in different runs (using <code><a href="base.html#topic+Random">se.seed</a></code> internally). Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="synth_sounds_+3A_sig2">sig2</code></td>
<td>
<p>Numeric vector of length 1 defining the sigma value of the brownian motion model (used for simulating frequency modulation). Default is 0.3.</p>
</td></tr>
<tr><td><code id="synth_sounds_+3A_shuffle">shuffle</code></td>
<td>
<p>Logical to control if the position of sounds is randomized. Having all sounds from the same treatment in a sequence can be problematic if an environmental noise masks them. Hence 'shuffle' is useful to avoid having sounds from the same treatment next to each other. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="synth_sounds_+3A_hrm.freqs">hrm.freqs</code></td>
<td>
<p>Numeric vector with the frequencies of the harmonics relative to the fundamental frequency. The default values are c(1/2, 1/3, 2/3, 1/4, 3/4, 1/5, 1/6, 1/7, 1/8, 1/9, 1/10).</p>
</td></tr>
<tr><td><code id="synth_sounds_+3A_sampling.rate">sampling.rate</code></td>
<td>
<p>Numeric vector of length 1. Sets the sampling frequency of the wave object (in kHz). Default is 44.1.</p>
</td></tr>
<tr><td><code id="synth_sounds_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function creates synthetic sounds that can be used for playback experiments to understand the link between signal structure and its transmission properties. The function can add variation in signal structure in 5 features:
</p>

<ul>
<li> <p><code>frequency</code>: continuous, argument 'frequencies'.
</p>
</li>
<li> <p><code>duration</code>: continuous, argument 'durations'.
</p>
</li>
<li> <p><code>harmonic structure</code>: binary (harmonics vs no-harmonics), arguments 'nharmonics' and 'hrm.freqs'.
</p>
</li>
<li> <p><code>frequency modulation</code>: variation in fundamental frequency across time. Binary (modulated vs non-modulated), arguments 'fm' and 'sig2'.
</p>
</li>
<li> <p><code>amplitude modulation</code>: variation in amplitude across time. Binary (modulated vs non-modulated), arguments 'am' and 'am.amps'.
</p>
</li></ul>

<p>Sound for all possible combinations of the selected structure dimensions will be synthesized. The output is an extended selection table, which can be input into <code><a href="#topic+master_sound_file">master_sound_file</a></code> to create the .wav file. The functions uses <code><a href="warbleR.html#topic+simulate_songs">simulate_songs</a></code> internally for synthesizing individual sounds. A Brownian bridge motion stochastic process (<code>diff.fun == "BB"</code>) is used to simulate frequency modulation. The output table contains columns for each of the varying features and a 'treatment' column (useful to tell sound from the same combination of features when using replicates).
</p>


<h3>Value</h3>

<p>An extended selection table, which can be input into <code><a href="#topic+master_sound_file">master_sound_file</a></code> to create the .wav file. The table contains columns for each of the varying features a 'treatment' column (useful to tell the acoustic features of each sound) and a 'replicate' column indicating the replicates for each 'treatment'.
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas, M., &amp; Smith-Vidaurre, G. (2017). warbleR: An R package to streamline analysis of animal acoustic signals. Methods in Ecology and Evolution, 8(2), 184-191.

</p>


<h3>See Also</h3>

<p><code><a href="warbleR.html#topic+simulate_songs">simulate_songs</a></code> from the package warbleR.
</p>
<p>Other prepare acoustic data: 
<code><a href="#topic+master_sound_file">master_sound_file</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

synthetic_est &lt;- synth_sounds(
  mar = 0.01,
  frequencies = c(1, 2, 3, 5),
  durations = 0.1,
  fm = TRUE,
  am = TRUE,
  nharmonics = 4,
  shuffle = TRUE,
  replicates = 3
)

## End(Not run)

</code></pre>

<hr>
<h2 id='tail_to_signal_ratio'>Measure reverberations as tail-to-signal ratio</h2><span id='topic+tail_to_signal_ratio'></span>

<h3>Description</h3>

<p><code>tail_to_signal_ratio</code> measures reverberations as tail-to-signal ratio of sounds referenced in an extended selection table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tail_to_signal_ratio(
  X,
  mar,
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  tsr.formula = 1,
  bp = "freq.range",
  hop.size = getOption("hop.size", 1),
  wl = getOption("wl", NULL),
  ovlp = getOption("ovlp", 0),
  path = getOption("sound.files.path", ".")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tail_to_signal_ratio_+3A_x">X</code></td>
<td>
<p>Object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package) with the reference to the test sounds . Must contain the following columns: 1) &quot;sound.files&quot;: name of the .wav files, 2) &quot;selec&quot;: unique selection identifier (within a sound file), 3) &quot;start&quot;: start time and 4) &quot;end&quot;: end time of selections, 5)  &quot;bottom.freq&quot;: low frequency for bandpass and 6) &quot;top.freq&quot;: high frequency for bandpass.</p>
</td></tr>
<tr><td><code id="tail_to_signal_ratio_+3A_mar">mar</code></td>
<td>
<p>numeric vector of length 1. Specifies the margins adjacent to
end of the sound over which to measure tail power.</p>
</td></tr>
<tr><td><code id="tail_to_signal_ratio_+3A_cores">cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the &quot;mc.cores&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="tail_to_signal_ratio_+3A_pb">pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the &quot;pb&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="tail_to_signal_ratio_+3A_tsr.formula">tsr.formula</code></td>
<td>
<p>Integer vector of length 1. Determine the formula to be used to calculate the tail-to-signal ratio (S = signal, T = tail, N = background noise):
</p>

<ul>
<li> <p><code>1</code>: ratio of T amplitude envelope quadratic mean to S amplitude envelope quadratic mean
(<code>rms(env(T))/rms(env(S))</code>) as described by Dabelsteen et al. (1993).
</p>
</li>
<li> <p><code>2</code>: ratio of T amplitude envelope quadratic mean to N amplitude envelope quadratic mean (<code>rms(env(T))/rms(env(N))</code>). N is measure in the margin right before the sound. So tsr.formula 2 actually measures tail-to-noise ratio.
</p>
</li></ul>
</td></tr>
<tr><td><code id="tail_to_signal_ratio_+3A_bp">bp</code></td>
<td>
<p>Numeric vector of length 2 giving the lower and upper limits of a frequency bandpass filter (in kHz). Alternatively, when set to 'freq.range' (default), the function will use the 'bottom.freq' and 'top.freq' for each sound as the bandpass range.</p>
</td></tr>
<tr><td><code id="tail_to_signal_ratio_+3A_hop.size">hop.size</code></td>
<td>
<p>A numeric vector of length 1 specifying the time window duration (in ms). Default is 1 ms, which is equivalent to ~45 wl for a 44.1 kHz sampling rate. Ignored if 'wl' is supplied. Can be set globally for the current R session via the &quot;hop.size&quot; option (see <code><a href="base.html#topic+options">options</a></code>). Note that this might be internally adjusted if the number of samples in the tail is lower than the hop.size.</p>
</td></tr>
<tr><td><code id="tail_to_signal_ratio_+3A_wl">wl</code></td>
<td>
<p>A numeric vector of length 1 specifying the window length of the spectrogram, default
is NULL. Ignored if <code>bp = NULL</code>. If supplied, 'hop.size' is ignored.
Note that lower values will increase time resolution, which is more important for amplitude calculations.</p>
</td></tr>
<tr><td><code id="tail_to_signal_ratio_+3A_ovlp">ovlp</code></td>
<td>
<p>Numeric vector of length 1 specifying the percentage of overlap between two
consecutive windows, as in <code><a href="seewave.html#topic+spectro">spectro</a></code>. Default is 0. Only used for bandpass filtering. Can be set globally for the current R session via the &quot;ovlp&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
<tr><td><code id="tail_to_signal_ratio_+3A_path">path</code></td>
<td>
<p>Character string containing the directory path where the sound files are found. Only needed when 'X' is not an extended selection table. If not supplied the current working directory is used. Can be set globally for the current R session via the &quot;sound.files.path&quot; option (see <code><a href="base.html#topic+options">options</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Tail-to-signal ratio (TSR) measures the ratio of power in the tail of reverberations to that in the test sound. A general margin in which reverberation tail will be measured must be specified. The function will measure TSR within the supplied frequency range (e.g. bandpass) of the reference sound ('bottom.freq' and 'top.freq' columns in 'X'). Two methods for computing reverberations are provided (see 'tsr.formula' argument). Note that 'tsr.formula' 2 is not equivalent to the original description of TSR in Dabelsteen et al. (1993) and  is better referred to as tail-to-noise ratio. Tail-to-signal ratio values are typically negative as signals tend to have higher power than that in the reverberating tail. TSR can be ~0 when both tail and signal have very low amplitude.
</p>


<h3>Value</h3>

<p>Object 'X' with an additional column, 'tail.to.signal.ratio',
with the tail-to-signal ratio values (in dB).
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.
</p>
<p>Darden, SK, Pedersen SB, Larsen ON, &amp; Dabelsteen T. (2008). Sound transmission at ground level in a short-grass prairie habitat and its implications for long-range communication in the swift fox *Vulpes velox*. The Journal of the Acoustical Society of America, 124(2), 758-766.
</p>
<p>Mathevon, N., Dabelsteen, T., &amp; Blumenrath, S. H. (2005). Are high perches in the blackcap Sylvia atricapilla song or listening posts? A sound transmission study. The Journal of the Acoustical Society of America, 117(1), 442-449.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+excess_attenuation">excess_attenuation</a></code>
</p>
<p>Other quantify degradation: 
<code><a href="#topic+blur_ratio">blur_ratio</a>()</code>,
<code><a href="#topic+detection_distance">detection_distance</a>()</code>,
<code><a href="#topic+envelope_correlation">envelope_correlation</a>()</code>,
<code><a href="#topic+plot_blur_ratio">plot_blur_ratio</a>()</code>,
<code><a href="#topic+plot_degradation">plot_degradation</a>()</code>,
<code><a href="#topic+set_reference_sounds">set_reference_sounds</a>()</code>,
<code><a href="#topic+signal_to_noise_ratio">signal_to_noise_ratio</a>()</code>,
<code><a href="#topic+spcc">spcc</a>()</code>,
<code><a href="#topic+spectrum_blur_ratio">spectrum_blur_ratio</a>()</code>,
<code><a href="#topic+spectrum_correlation">spectrum_correlation</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
  # load example data

  data("test_sounds_est")

  # set global options
  options(pb = FALSE)

  # using margin for noise of 0.01
  tsr &lt;- tail_to_signal_ratio(X = test_sounds_est, mar = 0.01)

  # use tsr.formula 2 which is equivalent to tail-to-noise ratio
  tsr &lt;- tail_to_signal_ratio(X = test_sounds_est, mar = 0.01, tsr.formula = 2)
}

</code></pre>

<hr>
<h2 id='test_sounds_est'>Extended selection table with re-recorded playbacks</h2><span id='topic+test_sounds_est'></span>

<h3>Description</h3>

<p>Extended selection table (est) of 7 re-recorded synthetic sounds. The synthetic sounds are 2 s long, frequency modulated, amplitude modulated, and were broadcast and re-recorded at 3 distances (1, 10 and 30m, column 'distance'). The data was created by the function <code><a href="warbleR.html#topic+selection_table">selection_table</a></code> from the warbleR package. The master sound file data used to create this test sounds is found in the example object <code><a href="#topic+master_est">master_est</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(test_sounds_est)
</code></pre>


<h3>Format</h3>

<p>Extended selection table object in the <a href="https://cran.r-project.org/package=warbleR">warbleR</a> format, which contains annotations and acoustic data.
</p>


<h3>Source</h3>

<p>Marcelo Araya-Salas
</p>


<h3>See Also</h3>

<p>Other data sets: 
<code><a href="#topic+master_est">master_est</a></code>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
