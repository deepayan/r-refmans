<!DOCTYPE html><html><head><title>Help for package seqICP</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {seqICP}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#seqICP-package'><p>Sequential Invariant Causal Prediction</p></a></li>
<li><a href='#seqICP'><p>Sequential Invariant Causal Prediction</p></a></li>
<li><a href='#seqICP.s'><p>Sequential Invariant Causal Prediction for an individual</p>
set S</a></li>
<li><a href='#seqICPnl'><p>Non-linear Invariant Causal Prediction</p></a></li>
<li><a href='#seqICPnl.s'><p>Non-linear Invariant Causal Prediction for an individual</p>
set S</a></li>
<li><a href='#summary.seqICP'><p>summary function</p></a></li>
<li><a href='#summary.seqICPnl'><p>summary function</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Sequential Invariant Causal Prediction</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1</td>
</tr>
<tr>
<td>Author:</td>
<td>Niklas Pfister and Jonas Peters</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Niklas Pfister &lt;pfister@stat.math.ethz.ch&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Contains an implementation of invariant causal prediction for sequential data. The main function in the package is 'seqICP', which performs linear sequential invariant causal prediction and has guaranteed type I error control. For non-linear dependencies the package also contains a non-linear method 'seqICPnl', which allows to input any regression procedure and performs tests based on a permutation approach that is only approximately correct. In order to test whether an individual set S is invariant the package contains the subroutines 'seqICP.s' and 'seqICPnl.s' corresponding to the respective main methods.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.2.3)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>dHSIC, mgcv, stats</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.0.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2017-07-25 11:32:46 UTC; pfisteni</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2017-07-25 14:54:20 UTC</td>
</tr>
</table>
<hr>
<h2 id='seqICP-package'>Sequential Invariant Causal Prediction</h2><span id='topic+seqICP-package'></span><span id='topic+seqICP_package'></span>

<h3>Description</h3>

<p>Contains an implementation of invariant causal prediction for sequential data. The main function in the package is 'seqICP', which performs linear sequential invariant causal prediction and has guaranteed type I error control. For non-linear dependencies the package also contains a non-linear method 'seqICPnl', which allows to input any regression procedure and performs tests based on a permutation approach that is only approximately correct. In order to test whether an individual set S is invariant the package contains the subroutines 'seqICP.s' and 'seqICPnl.s' corresponding to the respective main methods.</p>


<h3>Details</h3>

<p>The DESCRIPTION file:
</p>

<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> seqICP</td>
</tr>
<tr>
 <td style="text-align: left;">
Title: </td><td style="text-align: left;"> Sequential Invariant Causal Prediction</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.1</td>
</tr>
<tr>
 <td style="text-align: left;">
Author: </td><td style="text-align: left;"> Niklas Pfister and Jonas Peters</td>
</tr>
<tr>
 <td style="text-align: left;">
Maintainer: </td><td style="text-align: left;"> Niklas Pfister &lt;pfister@stat.math.ethz.ch&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
Description: </td><td style="text-align: left;"> Contains an implementation of invariant causal prediction for sequential data. The main function in the package is 'seqICP', which performs linear sequential invariant causal prediction and has guaranteed type I error control. For non-linear dependencies the package also contains a non-linear method 'seqICPnl', which allows to input any regression procedure and performs tests based on a permutation approach that is only approximately correct. In order to test whether an individual set S is invariant the package contains the subroutines 'seqICP.s' and 'seqICPnl.s' corresponding to the respective main methods.</td>
</tr>
<tr>
 <td style="text-align: left;">
Depends: </td><td style="text-align: left;"> R (&gt;= 3.2.3)</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL-3</td>
</tr>
<tr>
 <td style="text-align: left;">
Encoding: </td><td style="text-align: left;"> UTF-8</td>
</tr>
<tr>
 <td style="text-align: left;">
LazyData: </td><td style="text-align: left;"> true</td>
</tr>
<tr>
 <td style="text-align: left;">
Imports: </td><td style="text-align: left;"> dHSIC, mgcv, stats</td>
</tr>
<tr>
 <td style="text-align: left;">
RoxygenNote: </td><td style="text-align: left;"> 6.0.1</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>Index of help topics:
</p>
<pre>
seqICP                  Sequential Invariant Causal Prediction
seqICP-package          Sequential Invariant Causal Prediction
seqICP.s                Sequential Invariant Causal Prediction for an
                        individual set S
seqICPnl                Non-linear Invariant Causal Prediction
seqICPnl.s              Non-linear Invariant Causal Prediction for an
                        individual set S
summary.seqICP          summary function
summary.seqICPnl        summary function
</pre>


<h3>Author(s)</h3>

<p>Niklas Pfister and Jonas Peters
</p>
<p>Maintainer: Niklas Pfister &lt;pfister@stat.math.ethz.ch&gt;
</p>


<h3>References</h3>

<p>Pfister, N., P. Bühlmann and J. Peters (2017).
Invariant Causal Prediction for Sequential Data. ArXiv e-prints (1706.08058).
</p>
<p>Peters, J., P. Bühlmann, and N. Meinshausen (2016).
Causal inference using invariant prediction: identification and confidence intervals.
Journal of the Royal Statistical Society, Series B (with discussion) 78 (5), 947–1012.
</p>

<hr>
<h2 id='seqICP'>Sequential Invariant Causal Prediction</h2><span id='topic+seqICP'></span>

<h3>Description</h3>

<p>Estimates the causal parents S of the target variable Y using invariant causal prediction and fits a linear model of the form <br /> Y = a X^S + N.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>seqICP(X, Y, test = "decoupled", par.test = list(grid = c(0,
  round(nrow(X)/2), nrow(X)), complements = FALSE, link = sum, alpha = 0.05, B =
  100, permutation = FALSE), model = "iid", par.model = list(pknown = FALSE,
  p = 0, max.p = 10), max.parents = ncol(X), stopIfEmpty = TRUE,
  silent = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="seqICP_+3A_x">X</code></td>
<td>
<p>matrix of predictor variables. Each column corresponds to
one predictor variable.</p>
</td></tr>
<tr><td><code id="seqICP_+3A_y">Y</code></td>
<td>
<p>vector of target variable, with length(Y)=nrow(X).</p>
</td></tr>
<tr><td><code id="seqICP_+3A_test">test</code></td>
<td>
<p>string specifying the hypothesis test used to test for
invariance of a parent set S (i.e. the null hypothesis
H0_S). The following tests are available: &quot;decoupled&quot;,
&quot;combined&quot;, &quot;trend&quot;, &quot;variance&quot;, &quot;block.mean&quot;, &quot;block.variance&quot;,
&quot;block.decoupled&quot;, &quot;smooth.mean&quot;, &quot;smooth.variance&quot;,
&quot;smooth.decoupled&quot; and &quot;hsic&quot;.</p>
</td></tr>
<tr><td><code id="seqICP_+3A_par.test">par.test</code></td>
<td>
<p>parameters specifying hypothesis test. The
following parameters are available: <code>grid</code>,
<code>complements</code>, <code>link</code>, <code>alpha</code>, <code>B</code> and
<code>permutation</code>. The parameter <code>grid</code> is an increasing
vector of gridpoints used to construct enviornments for change
point based tests. If the parameter <code>complements</code> is 'TRUE'
each environment is compared against its complement if it is
'FALSE' all environments are compared pairwise. The parameter
<code>link</code> specifies how to compare the pairwise test
statistics, generally this is either max or sum. The parameter
<code>alpha</code> is a numeric value in (0,1) indicting the
significance level of the hypothesis test. The parameter
<code>B</code> is an integer and specifies the number of Monte-Carlo
samples (or permutations) used in the approximation of the null
distribution. If the parameter <code>permutation</code> is 'TRUE' a
permuatation based approach is used to approximate the null
distribution, if it is 'FALSE' the scaled residuals approach is
used.</p>
</td></tr>
<tr><td><code id="seqICP_+3A_model">model</code></td>
<td>
<p>string specifying the underlying model class. Either
&quot;iid&quot; if Y consists of independent observations or &quot;ar&quot; if Y has
a linear time dependence structure.</p>
</td></tr>
<tr><td><code id="seqICP_+3A_par.model">par.model</code></td>
<td>
<p>parameters specifying model. The following
parameters are available: <code>pknown</code>, <code>p</code> and
<code>max.p</code>. If <code>pknown</code> is 'FALSE' the number of lags will be
determined by comparing all fits up to <code>max.p</code> lags using
the AIC criterion. If <code>pknown</code> is 'TRUE' the procedure will fit
<code>p</code> lags.</p>
</td></tr>
<tr><td><code id="seqICP_+3A_max.parents">max.parents</code></td>
<td>
<p>integer specifying the maximum size for
admissible parents. Reducing this below the number of predictor
variables saves computational time but means that the confidence
intervals lose their coverage property.</p>
</td></tr>
<tr><td><code id="seqICP_+3A_stopifempty">stopIfEmpty</code></td>
<td>
<p>if ‘TRUE’, the procedure will stop computing
confidence intervals if the empty set has been accepted (and
hence no variable can have a signicificant causal
effect). Setting to ‘TRUE’ will save computational time in these
cases, but means that the confidence intervals lose their
coverage properties for values different to 0.</p>
</td></tr>
<tr><td><code id="seqICP_+3A_silent">silent</code></td>
<td>
<p>If 'FALSE', the procedure will output progress
notifications consisting of the currently computed set S
together with the p-value resulting from the null hypothesis
H0_S</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function can be applied to two types of models<br />
(1) a linear model (model=&quot;iid&quot;)<br /> Y_i = a X_i^S + N_i<br /> with iid noise N_i and <br />
(2) a linear autoregressive model (model=&quot;ar&quot;)<br /> Y_t = a_0 X_t^S + ... + a_p (Y_(t-p),X_(t-p)) + N_t<br /> with iid noise N_t.
</p>
<p>For both models the invariant prediction procedure is applied
using the hypothesis test specified by the <code>test</code> parameter
to determine whether a candidate model is invariant. For further
details see the references.
</p>


<h3>Value</h3>

<p>object of class 'seqICP' consisting of the following
elements
</p>
<table>
<tr><td><code>parent.set</code></td>
<td>
<p>vector of the estimated causal parents.</p>
</td></tr>
<tr><td><code>test.results</code></td>
<td>
<p>matrix containing the result from each
individual test as rows.</p>
</td></tr>
<tr><td><code>S</code></td>
<td>
<p>list of all the sets that were
tested. The position within the list corresponds to the index in
the first column of the test.results matrix.</p>
</td></tr>
<tr><td><code>p.values</code></td>
<td>
<p>p-value for being not included in the set of true
causal parents. (If a p-value is smaller than alpha, the
corresponding variable is a member of parent.set.)</p>
</td></tr>
<tr><td><code>coefficients</code></td>
<td>
<p>vector of coefficients resulting from a
regression based on the estimated parent set.</p>
</td></tr>
<tr><td><code>stopIfEmpty</code></td>
<td>
<p>a boolean value indicating whether computations
stop as soon as intersection of accepted sets is empty.</p>
</td></tr>
<tr><td><code>modelReject</code></td>
<td>
<p>a boolean value indicating if the whole model was
rejected (the p-value of the best fitting model is too low).</p>
</td></tr>
<tr><td><code>pknown</code></td>
<td>
<p>a boolean value indicating whether the number of
lags in the model was known. Only relevant if model was set to
&quot;ar&quot;.</p>
</td></tr>
<tr><td><code>alpha</code></td>
<td>
<p>significance level at which the hypothesis tests were performed.</p>
</td></tr>
<tr><td><code>n.var</code></td>
<td>
<p>number of predictor variables.</p>
</td></tr>
<tr><td><code>model</code></td>
<td>
<p>either &quot;iid&quot; or &quot;ar&quot; depending on which model was selected.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Niklas Pfister and Jonas Peters
</p>


<h3>References</h3>

<p>Pfister, N., P. Bühlmann and J. Peters (2017).
Invariant Causal Prediction for Sequential Data. ArXiv e-prints (1706.08058).
</p>
<p>Peters, J., P. Bühlmann, and N. Meinshausen (2016).
Causal inference using invariant prediction: identification and confidence intervals.
Journal of the Royal Statistical Society, Series B (with discussion) 78 (5), 947–1012.
</p>


<h3>See Also</h3>

<p>The function <code><a href="#topic+seqICP.s">seqICP.s</a></code> allows to perform
hypothesis test for individual sets S. For non-linear
models the functions <code><a href="#topic+seqICPnl">seqICPnl</a></code> and
<code><a href="#topic+seqICPnl.s">seqICPnl.s</a></code> can be used.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(1)

# environment 1
na &lt;- 140
X1a &lt;- 0.3*rnorm(na)
X3a &lt;- X1a + 0.2*rnorm(na)
Ya &lt;- -.7*X1a + .6*X3a + 0.1*rnorm(na)
X2a &lt;- -0.5*Ya + 0.5*X3a + 0.1*rnorm(na)

# environment 2
nb &lt;- 80
X1b &lt;- 0.3*rnorm(nb)
X3b &lt;- 0.5*rnorm(nb)
Yb &lt;- -.7*X1b + .6*X3b + 0.1*rnorm(nb)
X2b &lt;- -0.5*Yb + 0.5*X3b + 0.1*rnorm(nb)

# combine environments
X1 &lt;- c(X1a,X1b)
X2 &lt;- c(X2a,X2b)
X3 &lt;- c(X3a,X3b)
Y &lt;- c(Ya,Yb)
Xmatrix &lt;- cbind(X1, X2, X3)

# Y follows the same structural assignment in both environments
# a and b (cf. the lines Ya &lt;- ... and Yb &lt;- ...).
# The direct causes of Y are X1 and X3.
# A linear model considers X1, X2 and X3 as significant.
# All these variables are helpful for the prediction of Y.
summary(lm(Y~Xmatrix))

# apply seqICP to the same setting
seqICP.result &lt;- seqICP(X = Xmatrix, Y,
par.test = list(grid = seq(0, na + nb, (na + nb)/10), complements = FALSE, link = sum,
alpha = 0.05, B =100), max.parents = 4, stopIfEmpty=FALSE, silent=FALSE)
summary(seqICP.result)
# seqICP is able to infer that X1 and X3 are causes of Y
</code></pre>

<hr>
<h2 id='seqICP.s'>Sequential Invariant Causal Prediction for an individual
set S</h2><span id='topic+seqICP.s'></span>

<h3>Description</h3>

<p>Tests whether the conditional distribution of Y given X^S is
invariant across time, by assuming a linear dependence model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>seqICP.s(X, Y, S, test = "decoupled", par.test = list(grid = c(0,
  round(nrow(X)/2), nrow(X)), complements = FALSE, link = sum, alpha = 0.05, B =
  100, permutation = FALSE), model = "iid", par.model = list(pknown = FALSE,
  p = 0, max.p = 10))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="seqICP.s_+3A_x">X</code></td>
<td>
<p>matrix of predictor variables. Each column corresponds to
one predictor variable.</p>
</td></tr>
<tr><td><code id="seqICP.s_+3A_y">Y</code></td>
<td>
<p>vector of target variable, with length(Y)=nrow(X).</p>
</td></tr>
<tr><td><code id="seqICP.s_+3A_s">S</code></td>
<td>
<p>vector containing the indicies of predictors to be tested</p>
</td></tr>
<tr><td><code id="seqICP.s_+3A_test">test</code></td>
<td>
<p>string specifying the hypothesis test used to test for
invariance of a parent set S (i.e. the null hypothesis
H0_S). The following tests are available: &quot;decoupled&quot;,
&quot;combined&quot;, &quot;trend&quot;, &quot;variance&quot;, &quot;block.mean&quot;, &quot;block.variance&quot;,
&quot;block.decoupled&quot;, &quot;smooth.mean&quot;, &quot;smooth.variance&quot;,
&quot;smooth.decoupled&quot; and &quot;hsic&quot;.</p>
</td></tr>
<tr><td><code id="seqICP.s_+3A_par.test">par.test</code></td>
<td>
<p>parameters specifying hypothesis test. The
following parameters are available: <code>grid</code>,
<code>complements</code>, <code>link</code>, <code>alpha</code>, <code>B</code> and
<code>permutation</code>. The parameter <code>grid</code> is an increasing
vector of gridpoints used to construct enviornments for change
point based tests. If the parameter <code>complements</code> is 'TRUE'
each environment is compared against its complement if it is
'FALSE' all environments are compared pairwise. The parameter
<code>link</code> specifies how to compare the pairwise test
statistics, generally this is either max or sum. The parameter
<code>alpha</code> is a numeric value in (0,1) indicting the
significance level of the hypothesis test. The parameter
<code>B</code> is an integer and specifies the number of Monte-Carlo
samples (or permutations) used in the approximation of the null
distribution. If the parameter <code>permutation</code> is 'TRUE' a
permuatation based approach is used to approximate the null
distribution, if it is 'FALSE' the scaled residuals approach is
used.</p>
</td></tr>
<tr><td><code id="seqICP.s_+3A_model">model</code></td>
<td>
<p>string specifying the underlying model class. Either
&quot;iid&quot; if Y consists of independent observations or &quot;ar&quot; if Y has
a linear time dependence structure.</p>
</td></tr>
<tr><td><code id="seqICP.s_+3A_par.model">par.model</code></td>
<td>
<p>parameters specifying model. The following
parameters are available: <code>pknown</code>, <code>p</code> and
<code>max.p</code>. If <code>pknown</code> is 'FALSE' the number of lags will be
determined by comparing all fits up to <code>max.p</code> lags using
the AIC criterion. If <code>pknown</code> is 'TRUE' the procedure will fit
<code>p</code> lags.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function can be applied to two types of models<br />
(1) a linear model (model=&quot;iid&quot;)<br /> Y_i = a X_i^S + N_i<br /> with iid noise N_i and <br />
(2) a linear autoregressive model (model=&quot;ar&quot;)<br /> Y_t = a_0 X_t^S + ... + a_p (Y_(t-p),X_(t-p)) + N_t<br /> with iid noise N_t.
</p>
<p>For both models the hypothesis test specified by the <code>test</code>
parameter is used to test whether the set S leads to an invariant
model. For futher details see the references.
</p>


<h3>Value</h3>

<p>list containing the following elements
</p>
<table>
<tr><td><code>test.stat</code></td>
<td>
<p>value of the test statistic.</p>
</td></tr>
<tr><td><code>crit.value</code></td>
<td>
<p>critical value computed using a Monte-Carlo
simulation of the null distribution.</p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>p-value.</p>
</td></tr>
<tr><td><code>p</code></td>
<td>
<p>number of lags that were used.</p>
</td></tr>
<tr><td><code>model.fit</code></td>
<td>
<p>'lm' object of linear model fit.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Niklas Pfister and Jonas Peters
</p>


<h3>References</h3>

<p>Pfister, N., P. Bühlmann and J. Peters (2017).
Invariant Causal Prediction for Sequential Data. ArXiv e-prints (1706.08058).
</p>
<p>Peters, J., P. Bühlmann, and N. Meinshausen (2016).
Causal inference using invariant prediction: identification and confidence intervals.
Journal of the Royal Statistical Society, Series B (with discussion) 78 (5), 947–1012.
</p>


<h3>See Also</h3>

<p>To estimate the set of causal parents use the function
<code><a href="#topic+seqICP">seqICP</a></code>. For non-linear models use the
corresponding functions <code><a href="#topic+seqICPnl">seqICPnl</a></code> and
<code><a href="#topic+seqICPnl.s">seqICPnl.s</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(1)

# environment 1
na &lt;- 130
X1a &lt;- rnorm(na,0,0.1)
Ya &lt;- 5*X1a+rnorm(na,0,0.5)
X2a &lt;- Ya+rnorm(na,0,0.1)

# environment 2
nb &lt;- 70
X1b &lt;- rnorm(nb,-1,1)
Yb &lt;- 5*X1b+rnorm(nb,0,0.5)
X2b &lt;- rnorm(nb,0,0.1)

# combine environments
X1 &lt;- c(X1a,X1b)
X2 &lt;- c(X2a,X2b)
Y &lt;- c(Ya,Yb)
Xmatrix &lt;- cbind(X1, X2)

# apply seqICP.s to all possible sets - only the true parent set S=1
# is invariant in this example
seqICP.s(Xmatrix, Y, S=numeric(), par.test=list(grid=c(0,50,100,150,200)))
seqICP.s(Xmatrix, Y, S=1, par.test=list(grid=c(0,50,100,150,200)))
seqICP.s(Xmatrix, Y, S=2, par.test=list(grid=c(0,50,100,150,200)))
seqICP.s(Xmatrix, Y, S=c(1,2), par.test=list(grid=c(0,50,100,150,200)))
</code></pre>

<hr>
<h2 id='seqICPnl'>Non-linear Invariant Causal Prediction</h2><span id='topic+seqICPnl'></span>

<h3>Description</h3>

<p>Estimates the causal parents S of the target variable Y using
invariant causal prediction and fits a general model of the form
<br /> Y = f(X^S) + N.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>seqICPnl(X, Y, test = "block.variance", par.test = list(grid = c(0,
  round(nrow(X)/2), nrow(X)), complements = FALSE, link = sum, alpha = 0.05, B =
  100), regression.fun = function(X, Y) fitted.values(lm.fit(X, Y)),
  max.parents = ncol(X), stopIfEmpty = TRUE, silent = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="seqICPnl_+3A_x">X</code></td>
<td>
<p>matrix of predictor variables. Each column corresponds to
one predictor variable.</p>
</td></tr>
<tr><td><code id="seqICPnl_+3A_y">Y</code></td>
<td>
<p>vector of target variable, with length(Y)=nrow(X).</p>
</td></tr>
<tr><td><code id="seqICPnl_+3A_test">test</code></td>
<td>
<p>string specifying the hypothesis test used to test for
invariance of a parent set S (i.e. the null hypothesis
H0_S). The following tests are available: &quot;block.mean&quot;,
&quot;block.variance&quot;, &quot;block.decoupled&quot;, &quot;smooth.mean&quot;,
&quot;smooth.variance&quot;, &quot;smooth.decoupled&quot; and &quot;hsic&quot;.</p>
</td></tr>
<tr><td><code id="seqICPnl_+3A_par.test">par.test</code></td>
<td>
<p>parameters specifying hypothesis test. The
following parameters are available: <code>grid</code>, <code>complements</code>,
<code>link</code>, <code>alpha</code> and <code>B</code>. The parameter <code>grid</code> is an increasing
vector of gridpoints used to construct enviornments for change
point based tests. If the parameter <code>complements</code> is 'TRUE' each
environment is compared against its complement if it is 'FALSE'
all environments are compared pairwise. The parameter <code>link</code>
specifies how to compare the pairwise test statistics, generally
this is either max or sum. The parameter <code>alpha</code> is a numeric
value in (0,1) indicting the significance level of the
hypothesis test. The parameter <code>B</code> is an integer and specifies
the number of Monte-Carlo samples used in the approximation of
the null distribution.</p>
</td></tr>
<tr><td><code id="seqICPnl_+3A_regression.fun">regression.fun</code></td>
<td>
<p>regression function used to fit the function
f. This should be a function which takes the argument (X,Y) and
outputs the predicted values f(Y).</p>
</td></tr>
<tr><td><code id="seqICPnl_+3A_max.parents">max.parents</code></td>
<td>
<p>integer specifying the maximum size for
admissible parents. Reducing this below the number of predictor
variables saves computational time but means that the confidence
intervals lose their coverage property.</p>
</td></tr>
<tr><td><code id="seqICPnl_+3A_stopifempty">stopIfEmpty</code></td>
<td>
<p>if ‘TRUE’, the procedure will stop computing
confidence intervals if the empty set has been accepted (and
hence no variable can have a signicificant causal
effect). Setting to‘TRUE’ will save computational time in these
cases, but means that the confidence intervals lose their
coverage properties for values different to 0.</p>
</td></tr>
<tr><td><code id="seqICPnl_+3A_silent">silent</code></td>
<td>
<p>If 'FALSE', the procedure will output progress
notifications consisting of the currently computed set S
together with the p-value resulting from the null hypothesis
H0_S</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function can be applied to models of the form<br /> Y_i =
f(X_i^S) + N_i<br /> with iid noise N_i and f is from a specific
function class, which the regression procedure given by the
parameter <code>regression.fun</code> should be able to approximate.<br />
</p>
<p>The invariant prediction procedure is applied using the hypothesis
test specified by the <code>test</code> parameter to determine whether a
candidate model is invariant. For further details see the
references.
</p>


<h3>Value</h3>

<p>object of class 'seqICPnl' consisting of the following
elements
</p>
<table>
<tr><td><code>parent.set</code></td>
<td>
<p>vector of the estimated causal parents.</p>
</td></tr>
<tr><td><code>test.results</code></td>
<td>
<p>matrix containing results from each individual
hypothesis test H0_S as rows. The first column ind links the rows in the
<code>test.results</code> matrix to the position in the list of the variable
<code>S</code>.</p>
</td></tr>
<tr><td><code>S</code></td>
<td>
<p>list of all the sets that were
tested. The position within the list corresponds to the index in
the first column of the test.results matrix.</p>
</td></tr>
<tr><td><code>p.values</code></td>
<td>
<p>p-value for being not included in the set of true
causal parents. (If a p-value is smaller than alpha, the
corresponding variable is a member of parent.set.)</p>
</td></tr>
<tr><td><code>stopIfEmpty</code></td>
<td>
<p>a boolean value indicating whether computations
stop as soon as intersection of accepted sets is empty.</p>
</td></tr>
<tr><td><code>modelReject</code></td>
<td>
<p>a boolean value indicating if the whole model was
rejected (the p-value of the best fitting model is too low).</p>
</td></tr>
<tr><td><code>alpha</code></td>
<td>
<p>significance level at which the hypothesis tests were performed.</p>
</td></tr>
<tr><td><code>n.var</code></td>
<td>
<p>number of predictor variables.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Niklas Pfister and Jonas Peters
</p>


<h3>References</h3>

<p>Pfister, N., P. Bühlmann and J. Peters (2017).
Invariant Causal Prediction for Sequential Data. ArXiv e-prints (1706.08058).
</p>
<p>Peters, J., P. Bühlmann, and N. Meinshausen (2016).
Causal inference using invariant prediction: identification and confidence intervals.
Journal of the Royal Statistical Society, Series B (with discussion) 78 (5), 947–1012.
</p>


<h3>See Also</h3>

<p>The function <code><a href="#topic+seqICPnl.s">seqICPnl.s</a></code> can be used to
perform the individual hypothesis tests
H0_S. <code><a href="#topic+seqICP">seqICP</a></code> and <code><a href="#topic+seqICP.s">seqICP.s</a></code> are the
corresponding functions for classical sequential invariant
causal prediction.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(2)

# environment 1
na &lt;- 120
X1a &lt;- 0.3*rnorm(na)
X3a &lt;- X1a + 0.2*rnorm(na)
Ya &lt;- 2*X1a^2 + 0.6*sin(X3a) + 0.1*rnorm(na)
X2a &lt;- -0.5*Ya + 0.5*X3a + 0.1*rnorm(na)

# environment 2
nb &lt;- 80
X1b &lt;- 2*rnorm(nb)
X3b &lt;- rnorm(nb)
Yb &lt;- 2*X1b^2 + 0.6*sin(X3b) + 0.1*rnorm(nb)
X2b &lt;- -0.5*Yb + 0.8*rnorm(nb)

# combine environments
X1 &lt;- c(X1a,X1b)
X2 &lt;- c(X2a,X2b)
X3 &lt;- c(X3a,X3b)
Y &lt;- c(Ya,Yb)
Xmatrix &lt;- cbind(X1, X2, X3)

# use GAM as regression function
GAM &lt;- function(X,Y){
  d &lt;- ncol(X)
  if(d&gt;1){
    formula &lt;- "Y~1"
    names &lt;- c("Y")
    for(i in 1:(d-1)){
      formula &lt;- paste(formula,"+s(X",toString(i),")",sep="")
      names &lt;- c(names,paste("X",toString(i),sep=""))
    }
    data &lt;- data.frame(cbind(Y,X[,-1,drop=FALSE]))
      colnames(data) &lt;- names
    fit &lt;- fitted.values(mgcv::gam(as.formula(formula),data=data))
  } else{
    fit &lt;- rep(mean(Y),nrow(X))
  }
  return(fit)
}

# Y follows the same structural assignment in both environments
# a and b (cf. the lines Ya &lt;- ... and Yb &lt;- ...).
# The direct causes of Y are X1 and X3.
# A GAM model fit considers X1, X2 and X3 as significant.
# All these variables are helpful for the prediction of Y.
summary(mgcv::gam(Y~s(X1)+s(X2)+s(X3)))

# apply seqICP to the same setting
seqICPnl.result &lt;- seqICPnl(X = Xmatrix, Y, test="block.variance",
par.test = list(grid = seq(0, na + nb, (na + nb)/10), complements = FALSE, link = sum,
alpha = 0.05, B =100), regression.fun = GAM,  max.parents = 4, stopIfEmpty=FALSE, silent=FALSE)
summary(seqICPnl.result)
# seqICPnl is able to infer that X1 and X3 are causes of Y
</code></pre>

<hr>
<h2 id='seqICPnl.s'>Non-linear Invariant Causal Prediction for an individual
set S</h2><span id='topic+seqICPnl.s'></span>

<h3>Description</h3>

<p>Tests whether the conditional distribution of Y given X^S is
invariant across time, by allowing for arbitrary non-linear
additive dependence models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>seqICPnl.s(X, Y, S, test = "block.variance", par.test = list(grid = c(0,
  round(nrow(X)/2), nrow(X)), complements = FALSE, link = sum, alpha = 0.05, B =
  100), regression.fun = function(X, Y) fitted.values(lm.fit(X, Y)))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="seqICPnl.s_+3A_x">X</code></td>
<td>
<p>matrix of predictor variables. Each column corresponds to
one predictor variable.</p>
</td></tr>
<tr><td><code id="seqICPnl.s_+3A_y">Y</code></td>
<td>
<p>vector of target variable, with length(Y)=nrow(X).</p>
</td></tr>
<tr><td><code id="seqICPnl.s_+3A_s">S</code></td>
<td>
<p>vector containing the indicies of predictors to be tested</p>
</td></tr>
<tr><td><code id="seqICPnl.s_+3A_test">test</code></td>
<td>
<p>string specifying the hypothesis test used to test for
invariance of a parent set S (i.e. the null hypothesis
H0_S). The following tests are available: &quot;block.mean&quot;,
&quot;block.variance&quot;, &quot;block.decoupled&quot;, &quot;smooth.mean&quot;,
&quot;smooth.variance&quot;, &quot;smooth.decoupled&quot; and &quot;hsic&quot;.</p>
</td></tr>
<tr><td><code id="seqICPnl.s_+3A_par.test">par.test</code></td>
<td>
<p>parameters specifying hypothesis test. The
following parameters are available: <code>grid</code>,
<code>complements</code>, <code>link</code>, <code>alpha</code> and <code>B</code>. The
parameter <code>grid</code> is an increasing vector of gridpoints used
to construct enviornments for change point based tests. If the
parameter <code>complements</code> is 'TRUE' each environment is
compared against its complement if it is 'FALSE' all
environments are compared pairwise. The parameter <code>link</code>
specifies how to compare the pairwise test statistics, generally
this is either max or sum. The parameter <code>alpha</code> is a
numeric value in (0,1) indicting the significance level of the
hypothesis test. The parameter <code>B</code> is an integer and
specifies the number of Monte-Carlo samples used in the
approximation of the null distribution.</p>
</td></tr>
<tr><td><code id="seqICPnl.s_+3A_regression.fun">regression.fun</code></td>
<td>
<p>regression function used to fit the function
f. This should be a function which takes the argument (X,Y) and
outputs the predicted values f(Y).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function can be applied to models of the form<br /> Y_i =
f(X_i^S) + N_i<br /> with iid noise N_i and f is from a specific
function class, which the regression procedure given by the
parameter <code>regression.fun</code> should be able to approximate.<br />
</p>
<p>For both models the hypothesis test specified by the <code>test</code>
parameter specifies the hypothesis test used to test whether the
set S leads to an invariant model. For futher details see the
references.
</p>


<h3>Value</h3>

<p>list containing the following elements
</p>
<table>
<tr><td><code>test.stat</code></td>
<td>
<p>value of the test statistic.</p>
</td></tr>
<tr><td><code>crit.value</code></td>
<td>
<p>critical value computed using a Monte-Carlo
simulation of the null distribution.</p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>p-value.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Niklas Pfister and Jonas Peters
</p>


<h3>References</h3>

<p>Pfister, N., P. Bühlmann and J. Peters (2017).
Invariant Causal Prediction for Sequential Data. ArXiv e-prints (1706.08058).
</p>
<p>Peters, J., P. Bühlmann, and N. Meinshausen (2016).
Causal inference using invariant prediction: identification and confidence intervals.
Journal of the Royal Statistical Society, Series B (with discussion) 78 (5), 947–1012.
</p>


<h3>See Also</h3>

<p>To estimate the set of causal parents use the function
<code><a href="#topic+seqICPnl">seqICPnl</a></code>. For linear models use the corresponding
functions <code><a href="#topic+seqICP">seqICP</a></code> and <code><a href="#topic+seqICP.s">seqICP.s</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(1)

# environment 1
na &lt;- 130
X1a &lt;- rnorm(na,0,0.1)
Ya &lt;- 5*X1a+rnorm(na,0,0.5)
X2a &lt;- Ya+rnorm(na,0,0.1)

# environment 2
nb &lt;- 70
X1b &lt;- rnorm(nb,-1,1)
Yb &lt;- X1b^2+rnorm(nb,0,0.5)
X2b &lt;- rnorm(nb,0,0.1)

# combine environments
X1 &lt;- c(X1a,X1b)
X2 &lt;- c(X2a,X2b)
Y &lt;- c(Ya,Yb)
Xmatrix &lt;- cbind(X1, X2)

# use GAM as regression function
GAM &lt;- function(X,Y){
  d &lt;- ncol(X)
  if(d&gt;1){
    formula &lt;- "Y~1"
    names &lt;- c("Y")
    for(i in 1:(d-1)){
      formula &lt;- paste(formula,"+s(X",toString(i),")",sep="")
      names &lt;- c(names,paste("X",toString(i),sep=""))
    }
    data &lt;- data.frame(cbind(Y,X[,-1,drop=FALSE]))
      colnames(data) &lt;- names
    fit &lt;- fitted.values(mgcv::gam(as.formula(formula),data=data))
  } else{
    fit &lt;- rep(mean(Y),nrow(X))
  }
  return(fit)
}

# apply seqICPnl.s to all possible sets using the regression
# function GAM - only the true parent set S=1 is
# invariant in this example
seqICPnl.s(Xmatrix, Y, S=numeric(), par.test=list(grid=c(0,50,100,150,200)), regression.fun=GAM)
seqICPnl.s(Xmatrix, Y, S=1, par.test=list(grid=c(0,50,100,150,200)), regression.fun=GAM)
seqICPnl.s(Xmatrix, Y, S=2, par.test=list(grid=c(0,50,100,150,200)), regression.fun=GAM)
seqICPnl.s(Xmatrix, Y, S=c(1,2), par.test=list(grid=c(0,50,100,150,200)), regression.fun=GAM)
</code></pre>

<hr>
<h2 id='summary.seqICP'>summary function</h2><span id='topic+summary.seqICP'></span>

<h3>Description</h3>

<p>Summary functions for 'seqICP' objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'seqICP'
summary(object, show.past = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.seqICP_+3A_object">object</code></td>
<td>
<p>object of class 'seqICP'.</p>
</td></tr>
<tr><td><code id="summary.seqICP_+3A_show.past">show.past</code></td>
<td>
<p>'TRUE' if lagged variables should also be shown.</p>
</td></tr>
<tr><td><code id="summary.seqICP_+3A_...">...</code></td>
<td>
<p>additional arguments affecting the summary produced.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Niklas Pfister and Jonas Peters
</p>

<hr>
<h2 id='summary.seqICPnl'>summary function</h2><span id='topic+summary.seqICPnl'></span>

<h3>Description</h3>

<p>Summary functions for 'seqICPnl' objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'seqICPnl'
summary(object, show.past = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.seqICPnl_+3A_object">object</code></td>
<td>
<p>object of class 'seqICPnl'.</p>
</td></tr>
<tr><td><code id="summary.seqICPnl_+3A_show.past">show.past</code></td>
<td>
<p>'TRUE' if lagged variables should also be shown.</p>
</td></tr>
<tr><td><code id="summary.seqICPnl_+3A_...">...</code></td>
<td>
<p>additional arguments affecting the summary produced.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Niklas Pfister and Jonas Peters
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
