<!DOCTYPE html><html><head><title>Help for package ipumsr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ipumsr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ipumsr-package'><p>ipumsr: An R Interface for Downloading, Reading, and Handling IPUMS Data</p></a></li>
<li><a href='#add_to_extract'><p>Add values to an existing IPUMS extract definition</p></a></li>
<li><a href='#add_to_extract_micro'><p>Add values to an existing extract definition for an IPUMS microdata</p>
collection</a></li>
<li><a href='#add_to_extract.nhgis_extract'><p>Add values to an existing IPUMS NHGIS extract definition</p></a></li>
<li><a href='#define_extract'><p>Define an IPUMS extract object</p></a></li>
<li><a href='#define_extract_nhgis'><p>Define an IPUMS NHGIS extract request</p></a></li>
<li><a href='#define_extract-micro'><p>Define an extract request for an IPUMS microdata collection</p></a></li>
<li><a href='#download_extract'><p>Download a completed IPUMS data extract</p></a></li>
<li><a href='#ds_spec'><p>Create dataset and time series table specifications for IPUMS NHGIS extract</p>
requests</a></li>
<li><a href='#extract_tbl_to_list'><p>Convert recent extract definitions from tibble to list format</p></a></li>
<li><a href='#get_extract_history'><p>Browse definitions of previously submitted extract requests</p></a></li>
<li><a href='#get_extract_info'><p>Retrieve the definition and latest status of an extract request</p></a></li>
<li><a href='#get_metadata_nhgis'><p>List available data sources from IPUMS NHGIS</p></a></li>
<li><a href='#get_recent_extracts_info_list'><p>Get information on recent extracts</p></a></li>
<li><a href='#get_sample_info'><p>List available samples for IPUMS microdata collections</p></a></li>
<li><a href='#ipums_bind_rows'><p>Bind multiple data frames by row, preserving labelled attributes</p></a></li>
<li><a href='#ipums_callback'><p>Callback classes</p></a></li>
<li><a href='#ipums_collect'><p>Collect data into R session with IPUMS attributes</p></a></li>
<li><a href='#ipums_data_collections'><p>List IPUMS data collections</p></a></li>
<li><a href='#ipums_ddi-class'><p><code>ipums_ddi</code> class</p></a></li>
<li><a href='#ipums_example'><p>Get path to IPUMS example datasets</p></a></li>
<li><a href='#ipums_extract-class'><p><code>ipums_extract</code> class</p></a></li>
<li><a href='#ipums_file_info'><p>Get file information for an IPUMS extract</p></a></li>
<li><a href='#ipums_list_files'><p>List files contained within a zipped IPUMS extract</p></a></li>
<li><a href='#ipums_shape_join'><p>Join tabular data to geographic boundaries</p></a></li>
<li><a href='#ipums_var_info'><p>Get contextual information about variables in an IPUMS data source</p></a></li>
<li><a href='#ipums_view'><p>View a static webpage with variable metadata from an IPUMS extract</p></a></li>
<li><a href='#ipums_website'><p>Launch a browser window to an IPUMS metadata page</p></a></li>
<li><a href='#join_failures'><p>Report on observations dropped during a join</p></a></li>
<li><a href='#lbl'><p>Make a label placeholder object</p></a></li>
<li><a href='#lbl_add'><p>Add labels for unlabelled values</p></a></li>
<li><a href='#lbl_clean'><p>Clean unused labels</p></a></li>
<li><a href='#lbl_define'><p>Define labels for an unlabelled vector</p></a></li>
<li><a href='#lbl_na_if'><p>Convert labelled data values to NA</p></a></li>
<li><a href='#lbl_relabel'><p>Modify value labels for a labelled vector</p></a></li>
<li><a href='#read_ipums_ddi'><p>Read metadata about an IPUMS microdata extract from a DDI codebook (.xml)</p>
file</a></li>
<li><a href='#read_ipums_micro'><p>Read data from an IPUMS microdata extract</p></a></li>
<li><a href='#read_ipums_micro_chunked'><p>Read data from an IPUMS microdata extract by chunk</p></a></li>
<li><a href='#read_ipums_micro_yield'><p>Read data from an IPUMS microdata extract in yields</p></a></li>
<li><a href='#read_ipums_sf'><p>Read spatial data from an IPUMS extract</p></a></li>
<li><a href='#read_nhgis'><p>Read tabular data from an NHGIS extract</p></a></li>
<li><a href='#read_nhgis_codebook'><p>Read metadata from an NHGIS codebook (.txt) file</p></a></li>
<li><a href='#reexports'><p>Objects exported from other packages</p></a></li>
<li><a href='#remove_from_extract'><p>Remove values from an existing IPUMS extract definition</p></a></li>
<li><a href='#remove_from_extract.micro_extract'><p>Remove values from an existing extract definition for an IPUMS microdata</p>
project</a></li>
<li><a href='#remove_from_extract.nhgis_extract'><p>Remove values from an existing NHGIS extract definition</p></a></li>
<li><a href='#save_extract_as_json'><p>Store an extract definition in JSON format</p></a></li>
<li><a href='#selection_language'><p>tidyselect selection language in ipumsr</p></a></li>
<li><a href='#set_ipums_api_key'><p>Set your IPUMS API key</p></a></li>
<li><a href='#set_ipums_default_collection'><p>Set your default IPUMS collection</p></a></li>
<li><a href='#set_ipums_var_attributes'><p>Add IPUMS variable attributes to a data frame</p></a></li>
<li><a href='#submit_extract'><p>Submit an extract request via the IPUMS API</p></a></li>
<li><a href='#var_spec'><p>Create variable and sample specifications for IPUMS microdata extract</p>
requests</a></li>
<li><a href='#wait_for_extract'><p>Wait for an extract request to finish processing</p></a></li>
<li><a href='#zap_ipums_attributes'><p>Remove label attributes from a data frame or labelled vector</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>An R Interface for Downloading, Reading, and Handling IPUMS Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.7.2</td>
</tr>
<tr>
<td>Description:</td>
<td>An easy way to work with census, survey, and geographic data
    provided by IPUMS in R. Generate and download data through the IPUMS
    API and load IPUMS files into R with their associated metadata to
    make analysis easier. IPUMS data describing 1.4 billion individuals
    drawn from over 750 censuses and surveys is available free of charge
    from the IPUMS website <a href="https://www.ipums.org">https://www.ipums.org</a>.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License 2.0</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://tech.popdata.org/ipumsr/">https://tech.popdata.org/ipumsr/</a>, <a href="https://github.com/ipums/ipumsr">https://github.com/ipums/ipumsr</a>,
<a href="https://www.ipums.org">https://www.ipums.org</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ipums/ipumsr/issues">https://github.com/ipums/ipumsr/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr (&ge; 0.7.0), haven (&ge; 2.2.0), hipread (&ge; 0.2.0), httr,
jsonlite, lifecycle, purrr, R6, readr, rlang, tibble,
tidyselect, xml2, zeallot</td>
</tr>
<tr>
<td>Suggests:</td>
<td>biglm, covr, crayon, DBI, dbplyr, DT, ggplot2, htmltools,
knitr, rmapshaper, rmarkdown, RSQLite (&ge; 2.3.3), rstudioapi,
scales, sf, shiny, testthat (&ge; 3.2.0), tidyr, vcr (&ge; 0.6.0),
withr</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Contact:</td>
<td>ipums@umn.edu</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-03-12 12:50:51 UTC; robe2037</td>
</tr>
<tr>
<td>Author:</td>
<td>Greg Freedman Ellis [aut],
  Derek Burk [aut, cre],
  Finn Roberts [aut],
  Joe Grover [ctb],
  Dan Ehrlich [ctb],
  Renae Rodgers [ctb],
  Institute for Social Research and Data Innovation [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Derek Burk &lt;ipums+cran@umn.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-03-12 14:10:14 UTC</td>
</tr>
</table>
<hr>
<h2 id='ipumsr-package'>ipumsr: An R Interface for Downloading, Reading, and Handling IPUMS Data</h2><span id='topic+ipumsr'></span><span id='topic+ipumsr-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>An easy way to work with census, survey, and geographic data provided by IPUMS in R. Generate and download data through the IPUMS API and load IPUMS files into R with their associated metadata to make analysis easier. IPUMS data describing 1.4 billion individuals drawn from over 750 censuses and surveys is available free of charge from the IPUMS website <a href="https://www.ipums.org">https://www.ipums.org</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Derek Burk <a href="mailto:ipums+cran@umn.edu">ipums+cran@umn.edu</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Greg Freedman Ellis
</p>
</li>
<li><p> Finn Roberts
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Joe Grover [contributor]
</p>
</li>
<li><p> Dan Ehrlich [contributor]
</p>
</li>
<li><p> Renae Rodgers [contributor]
</p>
</li>
<li><p> Institute for Social Research and Data Innovation <a href="mailto:ipums@umn.edu">ipums@umn.edu</a> [copyright holder]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://tech.popdata.org/ipumsr/">https://tech.popdata.org/ipumsr/</a>
</p>
</li>
<li> <p><a href="https://github.com/ipums/ipumsr">https://github.com/ipums/ipumsr</a>
</p>
</li>
<li> <p><a href="https://www.ipums.org">https://www.ipums.org</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/ipums/ipumsr/issues">https://github.com/ipums/ipumsr/issues</a>
</p>
</li></ul>


<hr>
<h2 id='add_to_extract'>Add values to an existing IPUMS extract definition</h2><span id='topic+add_to_extract'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>
<p>Add or replace values in an existing <code>ipums_extract</code> object.
This function is an S3 generic whose behavior will depend on the
subclass (i.e. collection) of the extract being modified.
</p>

<ul>
<li><p> To add to an <strong>IPUMS Microdata</strong> extract definition, click
<a href="#topic+add_to_extract.micro_extract">here</a>. This includes:
</p>

<ul>
<li><p> IPUMS USA
</p>
</li>
<li><p> IPUMS CPS
</p>
</li>
<li><p> IPUMS International
</p>
</li></ul>

</li>
<li><p> To add to an <strong>IPUMS NHGIS</strong> extract definition, click
<a href="#topic+add_to_extract.nhgis_extract">here</a>
</p>
</li></ul>

<p>This function is marked as experimental because it is typically not the best
option for maintaining reproducible extract definitions and may be retired
in the future. For reproducibility, users should strive to build extract
definitions with <code><a href="#topic+define_extract">define_extract_*()</a></code> functions.
</p>
<p>If you have a complicated extract definition to revise, but do not have
the original extract definition code that created it, we suggest that you
save the revised extract as a JSON file with <code><a href="#topic+save_extract_as_json">save_extract_as_json()</a></code>. This
will create a stable version of the extract definition that
can be used in the future as needed.
</p>
<p>To remove existing values from an extract definition, use
<code><a href="#topic+remove_from_extract">remove_from_extract()</a></code>.
</p>
<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_to_extract(extract, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="add_to_extract_+3A_extract">extract</code></td>
<td>
<p>An <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> object.</p>
</td></tr>
<tr><td><code id="add_to_extract_+3A_...">...</code></td>
<td>
<p>Additional arguments specifying the extract fields and values to
add to the extract definition.
</p>
<p>All arguments available in a collection's
<code><a href="#topic+define_extract">define_extract_*()</a></code> function can be
passed to <code>add_to_extract()</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of the same class as <code>extract</code> containing the modified
extract definition
</p>


<h3>See Also</h3>

<p><code><a href="#topic+remove_from_extract">remove_from_extract()</a></code> to remove values from an extract definition.
</p>
<p><code><a href="#topic+define_extract">define_extract_*()</a></code> to create a new extract request from
scratch.
</p>
<p><code><a href="#topic+submit_extract">submit_extract()</a></code> to submit an extract request for processing.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Microdata extracts
usa_extract &lt;- define_extract_usa(
  description = "2013 ACS Data",
  samples = "us2013a",
  variables = c("SEX", "AGE", "YEAR")
)

# Add new samples and variables
add_to_extract(
  usa_extract,
  samples = c("us2014a", "us2015a"),
  variables = var_spec("MARST", data_quality_flags = TRUE)
)

# Update existing variables
add_to_extract(
  usa_extract,
  variables = var_spec("SEX", case_selections = "1")
)

# Modify/add multiple variables
add_to_extract(
  usa_extract,
  variables = list(
    var_spec("SEX", case_selections = "1"),
    var_spec("RELATE")
  )
)

# NHGIS extracts
nhgis_extract &lt;- define_extract_nhgis(
  datasets = ds_spec(
    "1990_STF1",
    data_tables = c("NP1", "NP2"),
    geog_levels = "county"
  )
)

# Add a new dataset or time series table
add_to_extract(
  nhgis_extract,
  datasets = ds_spec(
    "1980_STF1",
    data_tables = "NT1A",
    geog_levels = c("county", "state")
  )
)

# Update existing datasets/time series tables
add_to_extract(
  nhgis_extract,
  datasets = ds_spec("1990_STF1", c("NP1", "NP2"), "state")
)

# Modify/add multiple datasets or time series tables
add_to_extract(
  nhgis_extract,
  time_series_tables = list(
    tst_spec("CW3", geog_levels = "state"),
    tst_spec("CW4", geog_levels = "state")
  )
)

# Values that can only take a single value are replaced
add_to_extract(nhgis_extract, data_format = "fixed_width")$data_format
</code></pre>

<hr>
<h2 id='add_to_extract_micro'>Add values to an existing extract definition for an IPUMS microdata
collection</h2><span id='topic+add_to_extract_micro'></span><span id='topic+add_to_extract.micro_extract'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>
<p>Add new values or replace existing values in an IPUMS microdata extract
definition. All fields are optional, and if omitted, will be unchanged.
Supplying a value
for fields that take a single value, such as <code>description</code> and <code>data_format</code>,
will replace the existing value with the supplied value.
</p>
<p>This function is marked as experimental because it is typically not the best
option for maintaining reproducible extract definitions and may be retired
in the future. For reproducibility, users should strive to build extract
definitions with <code><a href="#topic+define_extract-micro">define_extract_*()</a></code> functions.
</p>
<p>If you have a complicated extract definition to revise, but do not have
the original extract definition code that created it, we suggest that you
save the revised extract as a JSON file with <code><a href="#topic+save_extract_as_json">save_extract_as_json()</a></code>. This
will create a stable version of the extract definition that
can be used in the future as needed.
</p>
<p>To remove existing values from an IPUMS microdata extract definition, use
<code><a href="#topic+remove_from_extract.micro_extract">remove_from_extract()</a></code>.
</p>
<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'micro_extract'
add_to_extract(
  extract,
  description = NULL,
  samples = NULL,
  variables = NULL,
  data_format = NULL,
  data_structure = NULL,
  rectangular_on = NULL,
  case_select_who = NULL,
  data_quality_flags = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="add_to_extract_micro_+3A_extract">extract</code></td>
<td>
<p>An <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> object.</p>
</td></tr>
<tr><td><code id="add_to_extract_micro_+3A_description">description</code></td>
<td>
<p>Description of the extract.</p>
</td></tr>
<tr><td><code id="add_to_extract_micro_+3A_samples">samples</code></td>
<td>
<p>Vector of samples to include in the extract
request. Use <code><a href="#topic+get_sample_info">get_sample_info()</a></code> to identify
sample IDs for a given collection.</p>
</td></tr>
<tr><td><code id="add_to_extract_micro_+3A_variables">variables</code></td>
<td>
<p>Character vector of variable names or a list of
<code>var_spec</code> objects created by <code><a href="#topic+var_spec">var_spec()</a></code>
containing specifications for all variables to include in the extract.
</p>
<p>If a variable already exists in the extract, its specifications
will be added to those that already exist for that variable.</p>
</td></tr>
<tr><td><code id="add_to_extract_micro_+3A_data_format">data_format</code></td>
<td>
<p>Format for the output extract data file. Either
<code>"fixed_width"</code> or <code>"csv"</code>.
</p>
<p>Note that while <code>"stata"</code>, <code>"spss"</code>, or <code>"sas9"</code> are also accepted, these
file formats are not supported by ipumsr data-reading functions.</p>
</td></tr>
<tr><td><code id="add_to_extract_micro_+3A_data_structure">data_structure</code></td>
<td>
<p>Data structure for the output extract data.
</p>

<ul>
<li> <p><code>"rectangular"</code> provides person records with all requested household
information attached to respective household members.
</p>
</li>
<li> <p><code>"hierarchical"</code> provides household records followed by person records.
</p>
</li></ul>

<p>Defaults to <code>"rectangular"</code>.</p>
</td></tr>
<tr><td><code id="add_to_extract_micro_+3A_rectangular_on">rectangular_on</code></td>
<td>
<p>If <code>data_structure</code> is <code>"rectangular"</code>,
records on which to rectangularize. Currently only <code>"P"</code> (person records)
is supported.
</p>
<p>Defaults to <code>"P"</code> if <code>data_structure</code> is <code>"rectangular"</code> and <code>NULL</code>
otherwise.</p>
</td></tr>
<tr><td><code id="add_to_extract_micro_+3A_case_select_who">case_select_who</code></td>
<td>
<p>Indication of how to interpret any case selections
included for variables in the extract definition.
</p>

<ul>
<li> <p><code>"individuals"</code> includes records for all individuals who match the
specified case selections.
</p>
</li>
<li> <p><code>"households"</code> includes records for all members of each household that
contains an individual who matches the specified case selections.
</p>
</li></ul>

<p>Defaults to <code>"individuals"</code>. Use <code><a href="#topic+var_spec">var_spec()</a></code> to add case selections for
specific variables.</p>
</td></tr>
<tr><td><code id="add_to_extract_micro_+3A_data_quality_flags">data_quality_flags</code></td>
<td>
<p>Set to <code>TRUE</code> to include data quality
flags for all applicable variables in the extract definition. This will
override the <code>data_quality_flags</code> specification for individual variables
in the definition.
</p>
<p>Use <code><a href="#topic+var_spec">var_spec()</a></code> to add data quality flags for specific variables.</p>
</td></tr>
<tr><td><code id="add_to_extract_micro_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the supplied extract definition comes from
a previously submitted extract request, this function will reset the
definition to an unsubmitted state.
</p>
<p>To modify variable-specific parameters for variables that already exist
in the extract, create a new variable specification with <code><a href="#topic+var_spec">var_spec()</a></code>.
</p>


<h3>Value</h3>

<p>A modified <code>micro_extract</code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+remove_from_extract.micro_extract">remove_from_extract()</a></code> to remove
values from an extract definition.
</p>
<p><code><a href="#topic+submit_extract">submit_extract()</a></code> and <code><a href="#topic+download_extract">download_extract()</a></code> to submit and process an
extract request.
</p>
<p><code><a href="#topic+define_extract-micro">define_extract_*()</a></code> to create a new extract
definition from scratch
</p>


<h3>Examples</h3>

<pre><code class='language-R'>extract &lt;- define_extract_usa(
  description = "2013 ACS Data",
  samples = "us2013a",
  variables = c("SEX", "AGE", "YEAR")
)

# Add a single sample
add_to_extract(extract, samples = "us2014a")

# Add samples and variables
extract2 &lt;- add_to_extract(
  extract,
  samples = "us2014a",
  variables = c("MARST", "BIRTHYR")
)

# Modify specifications for variables in the extract by using `var_spec()`
# with the existing variable name:
add_to_extract(
  extract,
  samples = "us2014a",
  variables = var_spec("SEX", case_selections = "2")
)

# You can make multiple modifications or additions by providing a list
# of `var_spec()` objects:
add_to_extract(
  extract,
  samples = "us2014a",
  variables = list(
    var_spec("RACE", attached_characteristics = "mother"),
    var_spec("SEX", case_selections = "2"),
    var_spec("RELATE")
  )
)

# Values that only take a single value are replaced
add_to_extract(extract, description = "New description")$description
</code></pre>

<hr>
<h2 id='add_to_extract.nhgis_extract'>Add values to an existing IPUMS NHGIS extract definition</h2><span id='topic+add_to_extract.nhgis_extract'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>
<p>Add new values to an IPUMS NHGIS extract definition.
All fields are optional, and if omitted, will be unchanged.
Supplying a value for fields that take a single value, such as
<code>description</code> and <code>data_format</code>, will replace the existing value with
the supplied value.
</p>
<p>This function is marked as experimental because it is typically not the best
option for maintaining reproducible extract definitions and may be retired
in the future. For reproducibility, users should strive to build extract
definitions with <code><a href="#topic+define_extract_nhgis">define_extract_nhgis()</a></code>.
</p>
<p>If you have a complicated extract definition to revise, but do not have
the original extract definition code that created it, we suggest that you
save the revised extract as a JSON file with <code><a href="#topic+save_extract_as_json">save_extract_as_json()</a></code>. This
will create a stable version of the extract definition that
can be used in the future as needed.
</p>
<p>To remove existing values from an IPUMS NHGIS extract definition, use
<code><a href="#topic+remove_from_extract.nhgis_extract">remove_from_extract()</a></code>.
</p>
<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'nhgis_extract'
add_to_extract(
  extract,
  description = NULL,
  datasets = NULL,
  time_series_tables = NULL,
  geographic_extents = NULL,
  shapefiles = NULL,
  breakdown_and_data_type_layout = NULL,
  tst_layout = NULL,
  data_format = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="add_to_extract.nhgis_extract_+3A_extract">extract</code></td>
<td>
<p>An <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> object.</p>
</td></tr>
<tr><td><code id="add_to_extract.nhgis_extract_+3A_description">description</code></td>
<td>
<p>Description of the extract.</p>
</td></tr>
<tr><td><code id="add_to_extract.nhgis_extract_+3A_datasets">datasets</code></td>
<td>
<p>List of <code>ds_spec</code> objects created by <code><a href="#topic+ds_spec">ds_spec()</a></code>
containing the specifications
for the <a href="https://www.nhgis.org/overview-nhgis-datasets">datasets</a>
to include in the extract request. See examples.
</p>
<p>If a dataset already exists in the extract, its new specifications
will be added to those that already exist for that dataset.</p>
</td></tr>
<tr><td><code id="add_to_extract.nhgis_extract_+3A_time_series_tables">time_series_tables</code></td>
<td>
<p>List of <code>tst_spec</code> objects created by <code><a href="#topic+tst_spec">tst_spec()</a></code>
containing the specifications for the
<a href="https://www.nhgis.org/time-series-tables">time series tables</a>
to include in the extract request.
</p>
<p>If a time series table already exists in the extract, its new
specifications will be added to those that already exist for that time
series table.</p>
</td></tr>
<tr><td><code id="add_to_extract.nhgis_extract_+3A_geographic_extents">geographic_extents</code></td>
<td>
<p>Vector of geographic extents to use for
all of the <code>datasets</code> in the extract definition (for instance, to obtain
data within a particular state). Use <code>"*"</code> to select all available extents.
</p>
<p>Required when any of the <code>datasets</code> included in the extract definition
include <code>geog_levels</code> that require extent selection. See
<code><a href="#topic+get_metadata_nhgis">get_metadata_nhgis()</a></code> to determine if a geographic level requires extent
selection. At the time of writing, NHGIS supports extent selection only
for blocks and block groups.</p>
</td></tr>
<tr><td><code id="add_to_extract.nhgis_extract_+3A_shapefiles">shapefiles</code></td>
<td>
<p>Names of any <a href="https://www.nhgis.org/gis-files">shapefiles</a>
to include in the extract request.</p>
</td></tr>
<tr><td><code id="add_to_extract.nhgis_extract_+3A_breakdown_and_data_type_layout">breakdown_and_data_type_layout</code></td>
<td>
<p>The desired layout
of any <code>datasets</code> that have multiple data types or breakdown values.
</p>

<ul>
<li> <p><code>"single_file"</code> (default) keeps all data types and breakdown values in
one file
</p>
</li>
<li> <p><code>"separate_files"</code> splits each data type or breakdown value into its
own file
</p>
</li></ul>

<p>Required if any <code>datasets</code> included in the extract definition consist of
multiple data types (for instance, estimates and margins of error) or have
multiple breakdown values specified. See <code><a href="#topic+get_metadata_nhgis">get_metadata_nhgis()</a></code> to
determine whether a requested dataset has multiple data types.</p>
</td></tr>
<tr><td><code id="add_to_extract.nhgis_extract_+3A_tst_layout">tst_layout</code></td>
<td>
<p>The desired layout of all <code>time_series_tables</code> included in
the extract definition.
</p>

<ul>
<li> <p><code>"time_by_column_layout"</code> (wide format, default): rows correspond to
geographic units, columns correspond to different times in the time
series
</p>
</li>
<li> <p><code>"time_by_row_layout"</code> (long format): rows correspond to a single
geographic unit at a single point in time
</p>
</li>
<li> <p><code>"time_by_file_layout"</code>: data for different times are provided in
separate files
</p>
</li></ul>

<p>Required when an extract definition includes any <code>time_series_tables</code>.</p>
</td></tr>
<tr><td><code id="add_to_extract.nhgis_extract_+3A_data_format">data_format</code></td>
<td>
<p>The desired format of the extract data file.
</p>

<ul>
<li> <p><code>"csv_no_header"</code> (default) includes only a minimal header in the first
row
</p>
</li>
<li> <p><code>"csv_header"</code> includes a second, more descriptive header row.
</p>
</li>
<li> <p><code>"fixed_width"</code> provides data in a fixed width format
</p>
</li></ul>

<p>Note that by default, <code><a href="#topic+read_nhgis">read_nhgis()</a></code> removes the additional header row in
<code>"csv_header"</code> files.
</p>
<p>Required when an extract definition includes any <code>datasets</code> or
<code>time_series_tables</code>.</p>
</td></tr>
<tr><td><code id="add_to_extract.nhgis_extract_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For extract fields that take a single value, <code>add_to_extract()</code> will
replace the existing value with the new value provided for that field.
It is not necessary to first remove this value using
<code>remove_from_extract()</code>.
</p>
<p>If the supplied extract definition comes from
a previously submitted extract request, this function will reset the
definition to an unsubmitted state.
</p>


<h3>Value</h3>

<p>A modified <code>nhgis_extract</code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+remove_from_extract.nhgis_extract">remove_from_extract()</a></code> to remove
values from an extract definition.
</p>
<p><code><a href="#topic+define_extract_nhgis">define_extract_nhgis()</a></code> to create a new extract definition.
</p>
<p><code><a href="#topic+submit_extract">submit_extract()</a></code> and <code><a href="#topic+download_extract">download_extract()</a></code> to submit and process an
extract request.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>extract &lt;- define_extract_nhgis(
  datasets = ds_spec("1990_STF1", c("NP1", "NP2"), "county")
)

# Add a new dataset or time series table to the extract
add_to_extract(
  extract,
  datasets = ds_spec("1990_STF2a", "NPA1", "county")
)

add_to_extract(
  extract,
  time_series_tables = tst_spec("A00", "state")
)

# If a dataset/time series table name already exists in the definition
# its specification will be modified by adding the new specifications to
# the existing ones
add_to_extract(
  extract,
  datasets = ds_spec("1990_STF1", "NP4", "nation")
)

# You can add new datasets and modify existing ones simultaneously by
# providing a list of `ds_spec` objects
add_to_extract(
  extract,
  datasets = list(
    ds_spec("1990_STF1", "NP4", "nation"),
    ds_spec("1990_STF2a", "NPA1", "county")
  )
)

# Values that can only take a single value are replaced
add_to_extract(extract, data_format = "fixed_width")$data_format
</code></pre>

<hr>
<h2 id='define_extract'>Define an IPUMS extract object</h2><span id='topic+define_extract'></span>

<h3>Description</h3>

<p>Specify the parameters for a new IPUMS extract request object to be
submitted via the IPUMS API. An extract request contains the specifications
required to obtain a particular set of data from an IPUMS collection.
</p>
<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code>.
</p>


<h3>Supported collections</h3>

<p>Currently, ipumsr supports extract definitions for the following
collections:
</p>

<ul>
<li> <p><strong>IPUMS USA</strong>: <code><a href="#topic+define_extract_usa">define_extract_usa()</a></code>
</p>
</li>
<li> <p><strong>IPUMS CPS</strong>: <code><a href="#topic+define_extract_cps">define_extract_cps()</a></code>
</p>
</li>
<li> <p><strong>IPUMS International</strong>: <code><a href="#topic+define_extract_ipumsi">define_extract_ipumsi()</a></code>
</p>
</li>
<li> <p><strong>IPUMS NHGIS</strong>: <code><a href="#topic+define_extract_nhgis">define_extract_nhgis()</a></code>
</p>
</li></ul>



<h3>Value</h3>

<p>These functions produce an <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> object
with a subclass based on the collection corresponding to the extract request.
The core ipumsr API client tools are designed to handle these objects.
</p>

<hr>
<h2 id='define_extract_nhgis'>Define an IPUMS NHGIS extract request</h2><span id='topic+define_extract_nhgis'></span>

<h3>Description</h3>

<p>Define the parameters of an IPUMS NHGIS extract request to be submitted via
the IPUMS API.
</p>
<p>Use <code><a href="#topic+get_metadata_nhgis">get_metadata_nhgis()</a></code> to browse and identify data sources for use
in NHGIS extract definitions. For general information, see the NHGIS
<a href="https://www.nhgis.org/data-availability">data source overview</a> and the
<a href="https://www.nhgis.org/frequently-asked-questions-faq">FAQ</a>.
</p>
<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code> and
NHGIS extract definitions in <code>vignette("ipums-api-nhgis")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>define_extract_nhgis(
  description = "",
  datasets = NULL,
  time_series_tables = NULL,
  shapefiles = NULL,
  geographic_extents = NULL,
  breakdown_and_data_type_layout = NULL,
  tst_layout = NULL,
  data_format = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="define_extract_nhgis_+3A_description">description</code></td>
<td>
<p>Description of the extract.</p>
</td></tr>
<tr><td><code id="define_extract_nhgis_+3A_datasets">datasets</code></td>
<td>
<p>List of dataset specifications for any
<a href="https://www.nhgis.org/overview-nhgis-datasets">datasets</a>
to include in the extract request. Use <code><a href="#topic+ds_spec">ds_spec()</a></code> to create a
<code>ds_spec</code> object containing a dataset specification. See examples.</p>
</td></tr>
<tr><td><code id="define_extract_nhgis_+3A_time_series_tables">time_series_tables</code></td>
<td>
<p>List of time series table specifications for any
<a href="https://www.nhgis.org/time-series-tables">time series tables</a>
to include in the extract request. Use <code><a href="#topic+tst_spec">tst_spec()</a></code> to create a
<code>tst_spec</code> object containing a time series table specification. See
examples.</p>
</td></tr>
<tr><td><code id="define_extract_nhgis_+3A_shapefiles">shapefiles</code></td>
<td>
<p>Names of any <a href="https://www.nhgis.org/gis-files">shapefiles</a>
to include in the extract request.</p>
</td></tr>
<tr><td><code id="define_extract_nhgis_+3A_geographic_extents">geographic_extents</code></td>
<td>
<p>Vector of geographic extents to use for
all of the <code>datasets</code> in the extract definition (for instance, to obtain
data within a particular state). Use <code>"*"</code> to select all available extents.
</p>
<p>Required when any of the <code>datasets</code> included in the extract definition
include <code>geog_levels</code> that require extent selection. See
<code><a href="#topic+get_metadata_nhgis">get_metadata_nhgis()</a></code> to determine if a geographic level requires extent
selection. At the time of writing, NHGIS supports extent selection only
for blocks and block groups.</p>
</td></tr>
<tr><td><code id="define_extract_nhgis_+3A_breakdown_and_data_type_layout">breakdown_and_data_type_layout</code></td>
<td>
<p>The desired layout
of any <code>datasets</code> that have multiple data types or breakdown values.
</p>

<ul>
<li> <p><code>"single_file"</code> (default) keeps all data types and breakdown values in
one file
</p>
</li>
<li> <p><code>"separate_files"</code> splits each data type or breakdown value into its
own file
</p>
</li></ul>

<p>Required if any <code>datasets</code> included in the extract definition consist of
multiple data types (for instance, estimates and margins of error) or have
multiple breakdown values specified. See <code><a href="#topic+get_metadata_nhgis">get_metadata_nhgis()</a></code> to
determine whether a requested dataset has multiple data types.</p>
</td></tr>
<tr><td><code id="define_extract_nhgis_+3A_tst_layout">tst_layout</code></td>
<td>
<p>The desired layout of all <code>time_series_tables</code> included in
the extract definition.
</p>

<ul>
<li> <p><code>"time_by_column_layout"</code> (wide format, default): rows correspond to
geographic units, columns correspond to different times in the time
series
</p>
</li>
<li> <p><code>"time_by_row_layout"</code> (long format): rows correspond to a single
geographic unit at a single point in time
</p>
</li>
<li> <p><code>"time_by_file_layout"</code>: data for different times are provided in
separate files
</p>
</li></ul>

<p>Required when an extract definition includes any <code>time_series_tables</code>.</p>
</td></tr>
<tr><td><code id="define_extract_nhgis_+3A_data_format">data_format</code></td>
<td>
<p>The desired format of the extract data file.
</p>

<ul>
<li> <p><code>"csv_no_header"</code> (default) includes only a minimal header in the first
row
</p>
</li>
<li> <p><code>"csv_header"</code> includes a second, more descriptive header row.
</p>
</li>
<li> <p><code>"fixed_width"</code> provides data in a fixed width format
</p>
</li></ul>

<p>Note that by default, <code><a href="#topic+read_nhgis">read_nhgis()</a></code> removes the additional header row in
<code>"csv_header"</code> files.
</p>
<p>Required when an extract definition includes any <code>datasets</code> or
<code>time_series_tables</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>An NHGIS extract definition must include at least one dataset, time series
table, or shapefile specification.
</p>
<p>Create an NHGIS dataset specification with <code><a href="#topic+ds_spec">ds_spec()</a></code>. Each dataset
must be associated with a selection of <code>data_tables</code> and <code>geog_levels</code>. Some
datasets also support the selection of <code>years</code> and <code>breakdown_values</code>.
</p>
<p>Create an NHGIS time series table specification with <code><a href="#topic+tst_spec">tst_spec()</a></code>. Each time
series table must be associated with a selection of <code>geog_levels</code> and
may optionally be associated with a selection of <code>years</code>.
</p>
<p>See examples or <code>vignette("ipums-api-nhgis")</code> for more details about
specifying datasets and time series tables in an NHGIS extract definition.
</p>


<h3>Value</h3>

<p>An object of class <code><a href="#topic+ipums_extract-class">nhgis_extract</a></code> containing
the extract definition.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_metadata_nhgis">get_metadata_nhgis()</a></code> to find data to include in an extract definition.
</p>
<p><code><a href="#topic+submit_extract">submit_extract()</a></code> to submit an extract request for processing.
</p>
<p><code><a href="#topic+save_extract_as_json">save_extract_as_json()</a></code> and <code><a href="#topic+define_extract_from_json">define_extract_from_json()</a></code> to share an
extract definition.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Extract definition for tables from an NHGIS dataset
# Use `ds_spec()` to create an NHGIS dataset specification
nhgis_extract &lt;- define_extract_nhgis(
  description = "Example NHGIS extract",
  datasets = ds_spec(
    "1990_STF3",
    data_tables = "NP57",
    geog_levels = c("county", "tract")
  )
)

nhgis_extract

# Use `tst_spec()` to create an NHGIS time series table specification
define_extract_nhgis(
  description = "Example NHGIS extract",
  time_series_tables = tst_spec("CL8", geog_levels = "county"),
  tst_layout = "time_by_row_layout"
)

# To request multiple datasets, provide a list of `ds_spec` objects
define_extract_nhgis(
  description = "Extract definition with multiple datasets",
  datasets = list(
    ds_spec("2014_2018_ACS5a", "B01001", c("state", "county")),
    ds_spec("2015_2019_ACS5a", "B01001", c("state", "county"))
  )
)

# If you need to specify the same table or geographic level for
# many datasets, you may want to make a set of datasets before defining
# your extract request:
dataset_names &lt;- c("2014_2018_ACS5a", "2015_2019_ACS5a")

dataset_spec &lt;- purrr::map(
  dataset_names,
  ~ ds_spec(
    .x,
    data_tables = "B01001",
    geog_levels = c("state", "county")
  )
)

define_extract_nhgis(
  description = "Extract definition with multiple datasets",
  datasets = dataset_spec
)

# You can request datasets, time series tables, and shapefiles in the same
# definition:
define_extract_nhgis(
  description = "Extract with datasets and time series tables",
  datasets = ds_spec("1990_STF1", c("NP1", "NP2"), "county"),
  time_series_tables = tst_spec("CL6", "state"),
  shapefiles = "us_county_1990_tl2008"
)

# Extract specifications can be indexed by name
names(nhgis_extract$datasets)

nhgis_extract$datasets[["1990_STF3"]]

## Not run: 
# Use the extract definition to submit an extract request to the API
submit_extract(nhgis_extract)

## End(Not run)
</code></pre>

<hr>
<h2 id='define_extract-micro'>Define an extract request for an IPUMS microdata collection</h2><span id='topic+define_extract-micro'></span><span id='topic+define_extract_usa'></span><span id='topic+define_extract_cps'></span><span id='topic+define_extract_ipumsi'></span>

<h3>Description</h3>

<p>Define the parameters of an IPUMS microdata extract request to be submitted
via the IPUMS API.
</p>
<p>Currently supported microdata collections include:
</p>

<ul>
<li> <p><strong>IPUMS USA</strong>: <code>define_extract_usa()</code>
</p>
</li>
<li> <p><strong>IPUMS CPS</strong>: <code>define_extract_cps()</code>
</p>
</li>
<li> <p><strong>IPUMS International</strong>: <code>define_extract_ipumsi()</code>
</p>
</li></ul>

<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code> and
microdata extract definitions in <code>vignette("ipums-api-micro")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>define_extract_usa(
  description,
  samples,
  variables,
  data_format = "fixed_width",
  data_structure = "rectangular",
  rectangular_on = NULL,
  case_select_who = "individuals",
  data_quality_flags = NULL
)

define_extract_cps(
  description,
  samples,
  variables,
  data_format = "fixed_width",
  data_structure = "rectangular",
  rectangular_on = NULL,
  case_select_who = "individuals",
  data_quality_flags = NULL
)

define_extract_ipumsi(
  description,
  samples,
  variables,
  data_format = "fixed_width",
  data_structure = "rectangular",
  rectangular_on = NULL,
  case_select_who = "individuals",
  data_quality_flags = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="define_extract-micro_+3A_description">description</code></td>
<td>
<p>Description of the extract.</p>
</td></tr>
<tr><td><code id="define_extract-micro_+3A_samples">samples</code></td>
<td>
<p>Vector of samples to include in the extract
request. Use <code><a href="#topic+get_sample_info">get_sample_info()</a></code> to identify
sample IDs for a given collection.</p>
</td></tr>
<tr><td><code id="define_extract-micro_+3A_variables">variables</code></td>
<td>
<p>Vector of variable names or a list of detailed
variable specifications to include in the extract
request. Use <code><a href="#topic+var_spec">var_spec()</a></code> to create a <code>var_spec</code> object containing a
detailed variable specification. See examples.</p>
</td></tr>
<tr><td><code id="define_extract-micro_+3A_data_format">data_format</code></td>
<td>
<p>Format for the output extract data file. Either
<code>"fixed_width"</code> or <code>"csv"</code>.
</p>
<p>Note that while <code>"stata"</code>, <code>"spss"</code>, or <code>"sas9"</code> are also accepted, these
file formats are not supported by ipumsr data-reading functions.
</p>
<p>Defaults to <code>"fixed_width"</code>.</p>
</td></tr>
<tr><td><code id="define_extract-micro_+3A_data_structure">data_structure</code></td>
<td>
<p>Data structure for the output extract data.
</p>

<ul>
<li> <p><code>"rectangular"</code> provides person records with all requested household
information attached to respective household members.
</p>
</li>
<li> <p><code>"hierarchical"</code> provides household records followed by person records.
</p>
</li></ul>

<p>Defaults to <code>"rectangular"</code>.</p>
</td></tr>
<tr><td><code id="define_extract-micro_+3A_rectangular_on">rectangular_on</code></td>
<td>
<p>If <code>data_structure</code> is <code>"rectangular"</code>,
records on which to rectangularize. Currently only <code>"P"</code> (person records)
is supported.
</p>
<p>Defaults to <code>"P"</code> if <code>data_structure</code> is <code>"rectangular"</code> and <code>NULL</code>
otherwise.</p>
</td></tr>
<tr><td><code id="define_extract-micro_+3A_case_select_who">case_select_who</code></td>
<td>
<p>Indication of how to interpret any case selections
included for variables in the extract definition.
</p>

<ul>
<li> <p><code>"individuals"</code> includes records for all individuals who match the
specified case selections.
</p>
</li>
<li> <p><code>"households"</code> includes records for all members of each household that
contains an individual who matches the specified case selections.
</p>
</li></ul>

<p>Defaults to <code>"individuals"</code>. Use <code><a href="#topic+var_spec">var_spec()</a></code> to add case selections for
specific variables.</p>
</td></tr>
<tr><td><code id="define_extract-micro_+3A_data_quality_flags">data_quality_flags</code></td>
<td>
<p>Set to <code>TRUE</code> to include data quality
flags for all applicable variables in the extract definition. This will
override the <code>data_quality_flags</code> specification for individual variables
in the definition.
</p>
<p>Use <code><a href="#topic+var_spec">var_spec()</a></code> to add data quality flags for specific variables.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code><a href="#topic+ipums_extract-class">micro_extract</a></code> containing
the extract definition.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+submit_extract">submit_extract()</a></code> to submit an extract request for processing.
</p>
<p><code><a href="#topic+save_extract_as_json">save_extract_as_json()</a></code> and <code><a href="#topic+define_extract_from_json">define_extract_from_json()</a></code> to share an
extract definition.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>usa_extract &lt;- define_extract_usa(
  description = "2013-2014 ACS Data",
  samples = c("us2013a", "us2014a"),
  variables = c("SEX", "AGE", "YEAR")
)

usa_extract

# Use `var_spec()` to created detailed variable specifications:
usa_extract &lt;- define_extract_usa(
  description = "Example USA extract definition",
  samples = c("us2013a", "us2014a"),
  variables = var_spec(
    "SEX",
    case_selections = "2",
    attached_characteristics = c("mother", "father")
  )
)

# For multiple variables, provide a list of `var_spec` objects and/or
# variable names.
cps_extract &lt;- define_extract_cps(
  description = "Example CPS extract definition",
  samples = c("cps2020_02s", "cps2020_03s"),
  variables = list(
    var_spec("AGE", data_quality_flags = TRUE),
    var_spec("SEX", case_selections = "2"),
    "RACE"
  )
)

cps_extract

# To recycle specifications to many variables, it may be useful to
# create variables prior to defining the extract:
var_names &lt;- c("AGE", "SEX")

my_vars &lt;- purrr::map(
  var_names,
  ~ var_spec(.x, attached_characteristics = "mother")
)

ipumsi_extract &lt;- define_extract_ipumsi(
  description = "Extract definition with predefined variables",
  samples = c("br2010a", "cl2017a"),
  variables = my_vars
)

# Extract specifications can be indexed by name
names(ipumsi_extract$samples)

names(ipumsi_extract$variables)

ipumsi_extract$variables$AGE

## Not run: 
# Use the extract definition to submit an extract request to the API
submit_extract(usa_extract)

## End(Not run)
</code></pre>

<hr>
<h2 id='download_extract'>Download a completed IPUMS data extract</h2><span id='topic+download_extract'></span>

<h3>Description</h3>

<p>Download an IPUMS data extract via the IPUMS API and write to disk.
</p>
<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>download_extract(
  extract,
  download_dir = getwd(),
  overwrite = FALSE,
  progress = TRUE,
  api_key = Sys.getenv("IPUMS_API_KEY")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="download_extract_+3A_extract">extract</code></td>
<td>
<p>One of:
</p>

<ul>
<li><p> An <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> object
</p>
</li>
<li><p> The data collection and extract number formatted as a string of the
form <code>"collection:number"</code> or as a vector of the form
<code>c("collection", number)</code>
</p>
</li>
<li><p> An extract number to be associated with your default IPUMS
collection. See <code><a href="#topic+set_ipums_default_collection">set_ipums_default_collection()</a></code>
</p>
</li></ul>

<p>For a list of codes used to refer to each collection, see
<code><a href="#topic+ipums_data_collections">ipums_data_collections()</a></code>.</p>
</td></tr>
<tr><td><code id="download_extract_+3A_download_dir">download_dir</code></td>
<td>
<p>Path to the directory where the files should be written.
Defaults to current working directory.</p>
</td></tr>
<tr><td><code id="download_extract_+3A_overwrite">overwrite</code></td>
<td>
<p>If <code>TRUE</code>, overwrite any conflicting files that
already exist in <code>download_dir</code>. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="download_extract_+3A_progress">progress</code></td>
<td>
<p>If <code>TRUE</code>, output progress bar showing the status of the
download request. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="download_extract_+3A_api_key">api_key</code></td>
<td>
<p>API key associated with your user account. Defaults to the
value of the <code>IPUMS_API_KEY</code> environment variable. See
<code><a href="#topic+set_ipums_api_key">set_ipums_api_key()</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For NHGIS extracts, data files and GIS files (shapefiles) will be saved in
separate .zip archives. <code>download_extract()</code> will return a character vector
including the file paths to all downloaded files.
</p>
<p>For microdata extracts, only the file path to the downloaded .xml DDI file
will be returned, as it is sufficient for reading the data provided in the
associated .gz data file.
</p>


<h3>Value</h3>

<p>The path(s) to the files required to read the data
requested in the extract, invisibly.
</p>
<p>For NHGIS, paths will be named with either <code>"data"</code> (for tabular data
files) or <code>"shape"</code> (for spatial data files) to
indicate the type of data the file contains.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+read_ipums_micro">read_ipums_micro()</a></code> or <code><a href="#topic+read_nhgis">read_nhgis()</a></code> to read tabular
data from an IPUMS extract.
</p>
<p><code><a href="#topic+read_ipums_sf">read_ipums_sf()</a></code> to read spatial data from an IPUMS extract.
</p>
<p><code><a href="#topic+ipums_list_files">ipums_list_files()</a></code> to list files in an IPUMS extract.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>usa_extract &lt;- define_extract_usa(
  description = "2013-2014 ACS Data",
  samples = c("us2013a", "us2014a"),
  variables = c("SEX", "AGE", "YEAR")
)

## Not run: 
submitted_extract &lt;- submit_extract(usa_extract)

downloadable_extract &lt;- wait_for_extract(submitted_extract)

# For microdata, the path to the DDI .xml codebook file is provided.
usa_xml_file &lt;- download_extract(downloadable_extract)

# Load with a `read_ipums_micro_*()` function
usa_data &lt;- read_ipums_micro(usa_xml_file)

# You can also download previous extracts with their collection and number:
nhgis_files &lt;- download_extract("nhgis:1")

# NHGIS extracts return a path to both the tabular and spatial data files,
# as applicable.
nhgis_data &lt;- read_nhgis(data = nhgis_files["data"])

# Load NHGIS spatial data
nhgis_geog &lt;- read_ipums_sf(data = nhgis_files["shape"])

## End(Not run)
</code></pre>

<hr>
<h2 id='ds_spec'>Create dataset and time series table specifications for IPUMS NHGIS extract
requests</h2><span id='topic+ds_spec'></span><span id='topic+tst_spec'></span>

<h3>Description</h3>

<p>Provide specifications for individual datasets and time series
tables when defining an IPUMS NHGIS extract request.
</p>
<p>Use <code><a href="#topic+get_metadata_nhgis">get_metadata_nhgis()</a></code> to identify available values for dataset and
time series table specification parameters.
</p>
<p>Learn more about NHGIS extract definitions in
<code>vignette("ipums-api-nhgis")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ds_spec(
  name,
  data_tables = NULL,
  geog_levels = NULL,
  years = NULL,
  breakdown_values = NULL
)

tst_spec(name, geog_levels = NULL, years = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ds_spec_+3A_name">name</code></td>
<td>
<p>Name of the dataset or time series table.</p>
</td></tr>
<tr><td><code id="ds_spec_+3A_data_tables">data_tables</code></td>
<td>
<p>Vector of summary tables to retrieve for the given
dataset.</p>
</td></tr>
<tr><td><code id="ds_spec_+3A_geog_levels">geog_levels</code></td>
<td>
<p>Geographic levels (e.g. <code>"county"</code> or <code>"state"</code>)
at which to obtain data for the given dataset or time series table.</p>
</td></tr>
<tr><td><code id="ds_spec_+3A_years">years</code></td>
<td>
<p>Years for which to obtain the data for the given dataset or time
series table.
</p>
<p>For time series tables, all years are selected by default. For datasets,
use <code>"*"</code> to select all available years. Use
<code><a href="#topic+get_metadata_nhgis">get_metadata_nhgis()</a></code> to determine if a dataset allows year selection.</p>
</td></tr>
<tr><td><code id="ds_spec_+3A_breakdown_values">breakdown_values</code></td>
<td>
<p><a href="https://www.nhgis.org/frequently-asked-questions-faq#breakdowns">Breakdown values</a>
to apply to the given dataset.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In general, <code>data_tables</code> and <code>geog_levels</code> are required for all
dataset specifications, and <code>geog_levels</code> are required for all
time series table specifications.
</p>
<p>However, it is possible to make a temporary specification for an incomplete
dataset or time series table by omitting these values. This supports the
syntax used when modifying an existing extract (see
<code><a href="#topic+add_to_extract.nhgis_extract">add_to_extract()</a></code> or
<code><a href="#topic+remove_from_extract.nhgis_extract">remove_from_extract()</a></code>).
</p>


<h3>Value</h3>

<p>A <code>ds_spec</code> or <code>tst_spec</code> object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dataset &lt;- ds_spec(
  "2013_2017_ACS5a",
  data_tables = c("B00001", "B01002"),
  geog_levels = "state"
)

tst &lt;- tst_spec(
  "CW5",
  geog_levels = c("county", "tract"),
  years = "1990"
)

# Use variable specifications in an extract definition:
define_extract_nhgis(
  description = "Example extract",
  datasets = dataset,
  time_series_tables = tst
)
</code></pre>

<hr>
<h2 id='extract_tbl_to_list'>Convert recent extract definitions from tibble to list format</h2><span id='topic+extract_tbl_to_list'></span><span id='topic+extract_list_to_tbl'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>
<p>Convert a <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> of extract definition
specifications to a list of <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> objects
or vice versa.
</p>
<p>Support for tabular extract history has been deprecated. Instead, use
<code><a href="#topic+get_extract_history">get_extract_history()</a></code> to obtain definitions of recently-submitted
extracts as a list. To identify past extracts that meet certain criteria,
iterate through this list.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_tbl_to_list(extract_tbl, validate = TRUE)

extract_list_to_tbl(extract_list)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_tbl_to_list_+3A_extract_tbl">extract_tbl</code></td>
<td>
<p>A <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> (or
<code><a href="base.html#topic+data.frame">data.frame</a></code>) containing the specifications for one
or more <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> objects.</p>
</td></tr>
<tr><td><code id="extract_tbl_to_list_+3A_validate">validate</code></td>
<td>
<p>Logical value indicating whether to
check that each of the output <code>ipums_extract</code>
objects contains a valid and complete extract
definition. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="extract_tbl_to_list_+3A_extract_list">extract_list</code></td>
<td>
<p>A list of <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> objects
or a single <code>ipums_extract</code> object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>For <code><a href="#topic+extract_tbl_to_list">extract_tbl_to_list()</a></code>, a list of length equal to the number of
extracts represented in <code>extract_tbl</code>.
</p>
<p>For <code><a href="#topic+extract_list_to_tbl">extract_list_to_tbl()</a></code>, a <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code>
representing the specifications for each of the extract requests
represented in <code>extract_list</code>.
</p>

<hr>
<h2 id='get_extract_history'>Browse definitions of previously submitted extract requests</h2><span id='topic+get_extract_history'></span>

<h3>Description</h3>

<p>Retrieve definitions of an arbitrary number of previously submitted extract
requests for a given IPUMS collection, starting from the most recent
extract request.
</p>
<p>To check the status of a particular extract request, use
<code><a href="#topic+get_extract_info">get_extract_info()</a></code>.
</p>
<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_extract_history(
  collection = NULL,
  how_many = 10,
  delay = 0,
  api_key = Sys.getenv("IPUMS_API_KEY")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_extract_history_+3A_collection">collection</code></td>
<td>
<p>Character string of the IPUMS collection for which to
retrieve extract history. Defaults to the current default
collection, if it exists. See <code><a href="#topic+set_ipums_default_collection">set_ipums_default_collection()</a></code>.
</p>
<p>For a list of codes used to refer to each collection, see
<code><a href="#topic+ipums_data_collections">ipums_data_collections()</a></code>.</p>
</td></tr>
<tr><td><code id="get_extract_history_+3A_how_many">how_many</code></td>
<td>
<p>The number of extract requests for which to retrieve
information. Defaults to the 10 most recent extracts.</p>
</td></tr>
<tr><td><code id="get_extract_history_+3A_delay">delay</code></td>
<td>
<p>Number of seconds to delay between
successive API requests, if multiple requests are needed to retrieve all
records.
</p>
<p>A delay is highly unlikely to be necessary and is
intended only as a fallback in the event that you cannot retrieve your
extract history without exceeding the API rate limit.</p>
</td></tr>
<tr><td><code id="get_extract_history_+3A_api_key">api_key</code></td>
<td>
<p>API key associated with your user account. Defaults to the
value of the <code>IPUMS_API_KEY</code> environment variable. See
<code><a href="#topic+set_ipums_api_key">set_ipums_api_key()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> objects
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_extract_info">get_extract_info()</a></code> to get the current status of a specific extract request.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Get information for most recent extract requests.
# By default gets the most recent 10 extracts
get_extract_history("usa")

# Return only the most recent 3 extract definitions
get_extract_history("cps", how_many = 3)

# To get the most recent extract (for instance, if you have forgotten its
# extract number), use `get_last_extract_info()`
get_last_extract_info("nhgis")

## End(Not run)

# To browse your extract history by particular criteria, you can
# loop through the extract objects. We'll create a sample list of 2 extracts:
extract1 &lt;- define_extract_usa(
  description = "2013 ACS",
  samples = "us2013a",
  variables = var_spec(
    "SEX",
    case_selections = "2",
    data_quality_flags = TRUE
  )
)

extract2 &lt;- define_extract_usa(
  description = "2014 ACS",
  samples = "us2014a",
  variables = list(
    var_spec("RACE"),
    var_spec(
      "SEX",
      case_selections = "1",
      data_quality_flags = FALSE
    )
  )
)

extracts &lt;- list(extract1, extract2)

# `purrr::keep()`` is particularly useful for filtering:
purrr::keep(extracts, ~ "RACE" %in% names(.x$variables))

purrr::keep(extracts, ~ grepl("2014 ACS", .x$description))

# You can also filter on variable-specific criteria
purrr::keep(extracts, ~ isTRUE(.x$variables[["SEX"]]$data_quality_flags))

# To filter based on all variables in an extract, you'll need to
# create a nested loop. For instance, to find all extracts that have
# any variables with data_quality_flags:
purrr::keep(
  extracts,
  function(extract) {
    any(purrr::map_lgl(
      names(extract$variables),
      function(var) isTRUE(extract$variables[[var]]$data_quality_flags)
    ))
  }
)

# To peruse your extract history without filtering, `purrr::map()` is more
# useful
purrr::map(extracts, ~ names(.x$variables))

purrr::map(extracts, ~ names(.x$samples))

purrr::map(extracts, ~ .x$variables[["RACE"]]$case_selections)

# Once you have identified a past extract, you can easily download or
# resubmit it
## Not run: 
extracts &lt;- get_extract_history("nhgis")

extract &lt;- purrr::keep(
  extracts,
  ~ "CW3" %in% names(.x$time_series_tables)
)

download_extract(extract[[1]])

## End(Not run)
</code></pre>

<hr>
<h2 id='get_extract_info'>Retrieve the definition and latest status of an extract request</h2><span id='topic+get_extract_info'></span><span id='topic+get_last_extract_info'></span>

<h3>Description</h3>

<p>Retrieve the latest status of an extract request.
</p>
<p><code>get_last_extract_info()</code> is a convenience function to retrieve the most
recent extract for a given collection.
</p>
<p>To browse definitions of your previously submitted extract requests, see
<code><a href="#topic+get_extract_history">get_extract_history()</a></code>.
</p>
<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_extract_info(extract, api_key = Sys.getenv("IPUMS_API_KEY"))

get_last_extract_info(collection = NULL, api_key = Sys.getenv("IPUMS_API_KEY"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_extract_info_+3A_extract">extract</code></td>
<td>
<p>One of:
</p>

<ul>
<li><p> An <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> object
</p>
</li>
<li><p> The data collection and extract number formatted as a string of the
form <code>"collection:number"</code> or as a vector of the form
<code>c("collection", number)</code>
</p>
</li>
<li><p> An extract number to be associated with your default IPUMS
collection. See <code><a href="#topic+set_ipums_default_collection">set_ipums_default_collection()</a></code>
</p>
</li></ul>

<p>For a list of codes used to refer to each collection, see
<code><a href="#topic+ipums_data_collections">ipums_data_collections()</a></code>.</p>
</td></tr>
<tr><td><code id="get_extract_info_+3A_api_key">api_key</code></td>
<td>
<p>API key associated with your user account. Defaults to the
value of the <code>IPUMS_API_KEY</code> environment variable. See
<code><a href="#topic+set_ipums_api_key">set_ipums_api_key()</a></code>.</p>
</td></tr>
<tr><td><code id="get_extract_info_+3A_collection">collection</code></td>
<td>
<p>Character string of the IPUMS collection for which to
retrieve extract history. Defaults to the current default
collection, if it exists. See <code><a href="#topic+set_ipums_default_collection">set_ipums_default_collection()</a></code>.
</p>
<p>For a list of codes used to refer to each collection, see
<code><a href="#topic+ipums_data_collections">ipums_data_collections()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> object.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_extract_history">get_extract_history()</a></code> to browse past extract definitions
</p>
<p><code><a href="#topic+wait_for_extract">wait_for_extract()</a></code> to wait for an extract to finish processing.
</p>
<p><code><a href="#topic+download_extract">download_extract()</a></code> to download an extract's data files.
</p>
<p><code><a href="#topic+save_extract_as_json">save_extract_as_json()</a></code> and <code><a href="#topic+define_extract_from_json">define_extract_from_json()</a></code> to share an
extract definition.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>my_extract &lt;- define_extract_usa(
  description = "2013-2014 ACS Data",
  samples = c("us2013a", "us2014a"),
  variables = c("SEX", "AGE", "YEAR")
)

## Not run: 
submitted_extract &lt;- submit_extract(my_extract)

# Get latest info for the request associated with a given `ipums_extract`
# object:
updated_extract &lt;- get_extract_info(submitted_extract)

updated_extract$status

# Or specify the extract collection and number:
get_extract_info("usa:1")
get_extract_info(c("usa", 1))

# If you have a default collection, you can use the extract number alone:
set_ipums_default_collection("nhgis")
get_extract_info(1)

# To get the most recent extract (for instance, if you have forgotten its
# extract number), use `get_last_extract_info()`
get_last_extract_info("nhgis")

## End(Not run)
</code></pre>

<hr>
<h2 id='get_metadata_nhgis'>List available data sources from IPUMS NHGIS</h2><span id='topic+get_metadata_nhgis'></span>

<h3>Description</h3>

<p>Retrieve information about available NHGIS data sources, including
<a href="https://www.nhgis.org/overview-nhgis-datasets">datasets</a>,
data tables (summary tables),
<a href="https://www.nhgis.org/time-series-tables">time series tables</a>,
and <a href="https://www.nhgis.org/gis-files">shapefiles</a> (GIS files).
</p>
<p>To retrieve summary metadata for all available data sources of a particular
type, use the <code>type</code> argument. To retrieve detailed metadata for a
single data source, use the <code>dataset</code>, <code>data_table</code>, or <code>time_series_table</code>
argument. See the <em>metadata availability</em> section below for information on
the metadata provided for each data type.
</p>
<p>For general information, see the NHGIS
<a href="https://www.nhgis.org/data-availability">data source overview</a> and the
<a href="https://www.nhgis.org/frequently-asked-questions-faq">FAQ</a>.
</p>
<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code> and
NHGIS extract definitions in <code>vignette("ipums-api-nhgis")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_metadata_nhgis(
  type = NULL,
  dataset = NULL,
  data_table = NULL,
  time_series_table = NULL,
  delay = 0,
  api_key = Sys.getenv("IPUMS_API_KEY")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_metadata_nhgis_+3A_type">type</code></td>
<td>
<p>One of <code>"datasets"</code>, <code>"data_tables"</code>, <code>"time_series_tables"</code>,
or <code>"shapefiles"</code> indicating the type of summary metadata to retrieve.
Leave <code>NULL</code> if requesting metadata for a single <code>dataset</code>, <code>data_table</code>,
or <code>time_series_table</code>.</p>
</td></tr>
<tr><td><code id="get_metadata_nhgis_+3A_dataset">dataset</code></td>
<td>
<p>Name of an individual dataset for which to retrieve metadata.</p>
</td></tr>
<tr><td><code id="get_metadata_nhgis_+3A_data_table">data_table</code></td>
<td>
<p>Name of an individual data table for which to retrieve
metadata. If provided, an associated <code>dataset</code> must also be specified.</p>
</td></tr>
<tr><td><code id="get_metadata_nhgis_+3A_time_series_table">time_series_table</code></td>
<td>
<p>Name of an individual time series table for which
to retrieve metadata.</p>
</td></tr>
<tr><td><code id="get_metadata_nhgis_+3A_delay">delay</code></td>
<td>
<p>Number of seconds to delay between
successive API requests, if multiple requests are needed to retrieve all
records.
</p>
<p>A delay is highly unlikely to be necessary and is intended only as a
fallback in the event that you cannot retrieve all metadata records without
exceeding the API rate limit.
</p>
<p>Only used if <code>type</code> is provided.</p>
</td></tr>
<tr><td><code id="get_metadata_nhgis_+3A_api_key">api_key</code></td>
<td>
<p>API key associated with your user account. Defaults to the
value of the <code>IPUMS_API_KEY</code> environment variable. See
<code><a href="#topic+set_ipums_api_key">set_ipums_api_key()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>type</code> is provided, a <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> of
summary metadata for all data sources of the provided <code>type</code>.
Otherwise, a named list of metadata for the specified <code>dataset</code>,
<code>data_table</code>, or <code>time_series_table</code>.
</p>


<h3>Metadata availability</h3>

<p>The following sections summarize the metadata fields provided for each data
type. Summary metadata include a subset of the fields provided for individual
data sources.
</p>


<h4>Datasets:</h4>


<ul>
<li> <p><strong><code>name</code>:</strong> The unique identifier for the dataset. This is the value that
is used to refer to the dataset when interacting with the IPUMS API.
</p>
</li>
<li> <p><strong><code>group</code>:</strong> The group of datasets to which the dataset belongs.
For instance, 5 separate datasets are part of the
<code>"2015 American Community Survey"</code> group.
</p>
</li>
<li> <p><strong><code>description</code>:</strong> A short description of the dataset.
</p>
</li>
<li> <p><strong><code>sequence</code>:</strong> Order in which the dataset will appear in the metadata API
and extracts.
</p>
</li>
<li> <p><strong><code>has_multiple_data_types</code>:</strong> Logical value indicating whether multiple
data types exist for this dataset. For example, ACS
datasets include both estimates and margins of error.
</p>
</li>
<li> <p><strong><code>data_tables</code>:</strong> A <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> containing names,
codes, and descriptions for all data tables available for the dataset.
</p>
</li>
<li> <p><strong><code>geog_levels</code>:</strong> A <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> containing names,
descriptions, and extent information for the geographic levels available
for the dataset. The <code>has_geog_extent_selection</code> field contains logical
values indicating whether extent selection is allowed (and required) for
the associated geographic level. See <code>geographic_instances</code> below.
</p>
</li>
<li> <p><strong><code>breakdowns</code>:</strong> A <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> containing names,
types, descriptions, and breakdown values for all breakdowns available
for the dataset.
</p>
</li>
<li> <p><strong><code>years</code>:</strong> A vector of years for which the dataset is available. This
field is only present if a dataset is available for multiple years. Note
that ACS datasets are not considered to be available for multiple years.
</p>
</li>
<li> <p><strong><code>geographic_instances</code>:</strong> A <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> containing
names and descriptions for all valid geographic extents for the
dataset. This field is only present if at least one of the dataset's
<code>geog_levels</code> allows geographic extent selection.
</p>
</li></ul>




<h4>Data tables:</h4>


<ul>
<li> <p><strong><code>name</code>:</strong> The unique identifier for the data table within its dataset.
This is the value that is used to refer to the data table when interacting
with the IPUMS API.
</p>
</li>
<li> <p><strong><code>description</code>:</strong> A short description of the data table.
</p>
</li>
<li> <p><strong><code>universe</code>:</strong> The statistical population measured by this data table
(e.g. persons, families, occupied housing units, etc.)
</p>
</li>
<li> <p><strong><code>nhgis_code</code>:</strong> The code identifying the data table in the extract.
Variables in the extract data will include column names prefixed with this
code.
</p>
</li>
<li> <p><strong><code>sequence</code>:</strong> Order in which the data table will appear in the metadata
API and extracts.
</p>
</li>
<li> <p><strong><code>dataset_name</code>:</strong> Name of the dataset to which this data table belongs.
</p>
</li>
<li> <p><strong><code>n_variables</code>:</strong> Number of variables included in this data table.
</p>
</li>
<li> <p><strong><code>variables</code>:</strong> A <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> containing variable
descriptions and codes for the variables included in the data table
</p>
</li></ul>




<h4>Time series tables:</h4>


<ul>
<li> <p><strong><code>name</code>:</strong> The unique identifier for the time series table. This is the
value that is used to refer to the time series table when interacting with
the IPUMS API.
</p>
</li>
<li> <p><strong><code>description</code>:</strong> A short description of the time series table.
</p>
</li>
<li> <p><strong><code>geographic_integration</code>:</strong> The method by which the time series table
aligns geographic units across time. <code>"Nominal"</code> integration indicates
that geographic units are aligned by name (disregarding changes in unit
boundaries). <code>"Standardized"</code> integration indicates that data from multiple
time points are standardized to the indicated year's census units. For
more information, click
<a href="https://www.nhgis.org/time-series-tables#geographic-integration">here</a>.
</p>
</li>
<li> <p><strong><code>sequence</code>:</strong> Order in which the time series table will appear in the
metadata API and extracts.
</p>
</li>
<li> <p><strong><code>time_series</code>:</strong> A <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> containing names
and descriptions for the individual time series available for the
time series table.
</p>
</li>
<li> <p><strong><code>years</code>:</strong> A <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> containing
information on the available data years for the
time series table.
</p>
</li>
<li> <p><strong><code>geog_levels</code>:</strong> A <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> containing names
and descriptions for the geographic levels available
for the time series table.
</p>
</li></ul>




<h4>Shapefiles:</h4>


<ul>
<li> <p><strong><code>name</code>:</strong> The unique identifier for the shapefile. This is the
value that is used to refer to the shapefile when interacting with
the IPUMS API.
</p>
</li>
<li> <p><strong><code>year</code>:</strong> The survey year in which the shapefile's represented areas
were used for tabulations, which may be different than the vintage of the
represented areas. For more information, click
<a href="https://www.nhgis.org/gis-files#years">here</a>.
</p>
</li>
<li> <p><strong><code>geographic_level</code>:</strong> The geographic level of the shapefile.
</p>
</li>
<li> <p><strong><code>extent</code>:</strong> The geographic extent covered by the shapefile.
</p>
</li>
<li> <p><strong><code>basis</code>:</strong> The derivation source of the shapefile.
</p>
</li>
<li> <p><strong><code>sequence</code>:</strong> Order in which the shapefile will appear in the
metadata API and extracts.
</p>
</li></ul>




<h3>See Also</h3>

<p><code><a href="#topic+define_extract_nhgis">define_extract_nhgis()</a></code> to create an IPUMS NHGIS extract definition.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(dplyr)

# Get summary metadata for all available sources of a given data type
get_metadata_nhgis("datasets")

# Filter to identify data sources of interest by their metadata values
all_tsts &lt;- get_metadata_nhgis("time_series_tables")

tsts &lt;- all_tsts %&gt;%
  filter(
    grepl("Children", description),
    grepl("Families", description),
    geographic_integration == "Standardized to 2010"
  )

tsts$name

# Get detailed metadata for a single source with its associated argument:
cs5_meta &lt;- get_metadata_nhgis(time_series_table = "CS5")
cs5_meta$geog_levels

# Use the available values when defining an NHGIS extract request
define_extract_nhgis(
  time_series_tables = tst_spec("CS5", geog_levels = "state")
)

# Detailed metadata is also provided for datasets and data tables
get_metadata_nhgis(dataset = "1990_STF1")
get_metadata_nhgis(data_table = "NP1", dataset = "1990_STF1")

# Iterate over data sources to retrieve detailed metadata for several
# records. For instance, to get variable metadata for a set of data tables:
tables &lt;- c("NP1", "NP2", "NP10")

var_meta &lt;- purrr::map(
  tables,
  function(dt) {
    dt_meta &lt;- get_metadata_nhgis(dataset = "1990_STF1", data_table = dt)

    # This ensures you avoid hitting rate limit for large numbers of tables
    Sys.sleep(1)

    dt_meta$variables
  }
)

## End(Not run)
</code></pre>

<hr>
<h2 id='get_recent_extracts_info_list'>Get information on recent extracts</h2><span id='topic+get_recent_extracts_info_list'></span><span id='topic+get_recent_extracts_info_tbl'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>
<p>Functionality for accessing recent extract information has been moved to
<code><a href="#topic+get_extract_history">get_extract_history()</a></code>. Please use that function instead.
</p>
<p>Additionally, support for tabular extract history has been deprecated.
To identify past extracts that meet certain criteria, iterate through the
list provided by <code>get_extract_history()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_recent_extracts_info_list(
  collection = NULL,
  how_many = 10,
  api_key = Sys.getenv("IPUMS_API_KEY")
)

get_recent_extracts_info_tbl(
  collection = NULL,
  how_many = 10,
  api_key = Sys.getenv("IPUMS_API_KEY")
)
</code></pre>

<hr>
<h2 id='get_sample_info'>List available samples for IPUMS microdata collections</h2><span id='topic+get_sample_info'></span>

<h3>Description</h3>

<p>Retrieve sample IDs and descriptions for IPUMS microdata collections.
</p>
<p>Currently supported microdata collections are:
</p>

<ul>
<li><p> IPUMS USA (<code>"usa"</code>)
</p>
</li>
<li><p> IPUMS CPS (<code>"cps"</code>)
</p>
</li>
<li><p> IPUMS International (<code>"ipumsi"</code>)
</p>
</li></ul>

<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_sample_info(
  collection = NULL,
  delay = 0,
  api_key = Sys.getenv("IPUMS_API_KEY")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_sample_info_+3A_collection">collection</code></td>
<td>
<p>Character string of the IPUMS collection for which to
retrieve sample IDs. Defaults to the current default collection,
if it exists. See <code><a href="#topic+set_ipums_default_collection">set_ipums_default_collection()</a></code>.
</p>
<p>For a list of codes used to refer to each collection, see
<code><a href="#topic+ipums_data_collections">ipums_data_collections()</a></code>.</p>
</td></tr>
<tr><td><code id="get_sample_info_+3A_delay">delay</code></td>
<td>
<p>Number of seconds to delay between
successive API requests, if multiple requests are needed to retrieve all
records.
</p>
<p>A delay is highly unlikely to be necessary and is intended only as a
fallback in the event that you cannot retrieve all sample IDs without
exceeding the API rate limit.</p>
</td></tr>
<tr><td><code id="get_sample_info_+3A_api_key">api_key</code></td>
<td>
<p>API key associated with your user account. Defaults to the
value of the <code>IPUMS_API_KEY</code> environment variable. See
<code><a href="#topic+set_ipums_api_key">set_ipums_api_key()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> containing sample IDs and
descriptions for the indicated collection.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+define_extract-micro">define_extract_*()</a></code> to create an IPUMS microdata
extract definition.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
get_sample_info("usa")
get_sample_info("cps")
get_sample_info("ipumsi")

## End(Not run)
</code></pre>

<hr>
<h2 id='ipums_bind_rows'>Bind multiple data frames by row, preserving labelled attributes</h2><span id='topic+ipums_bind_rows'></span>

<h3>Description</h3>

<p>Analogous to <code><a href="dplyr.html#topic+bind_rows">dplyr::bind_rows()</a></code>, but preserves the
labelled attributes provided with IPUMS data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ipums_bind_rows(..., .id = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ipums_bind_rows_+3A_...">...</code></td>
<td>
<p>Data frames or <code><a href="tibble.html#topic+tbl_df-class">tibbles</a></code> to combine.
Each argument can be a data frame or a
list of data frames. When binding, columns are matched by name. Missing
columns will be filled with <code>NA</code>.</p>
</td></tr>
<tr><td><code id="ipums_bind_rows_+3A_.id">.id</code></td>
<td>
<p>The name of an optional identifier column. Provide a string to
create an output column that identifies each input. The column will use
names if available, otherwise it will use positions.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the same type as the first input. Either a <code>data.frame</code>,
<code>tbl_df</code>, or <code>grouped_df</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>file &lt;- ipums_example("nhgis0712_csv.zip")

d1 &lt;- read_nhgis(
  file,
  file_select = 1,
  verbose = FALSE
)

d2 &lt;- read_nhgis(
  file,
  file_select = 2,
  verbose = FALSE
)

# Variables have associated label attributes:
ipums_var_label(d1$PMSAA)

# Preserve labels when binding data sources:
d &lt;- ipums_bind_rows(d1, d2)
ipums_var_label(d$PMSAA)

# dplyr `bind_rows()` drops labels:
d &lt;- dplyr::bind_rows(d1, d2)
ipums_var_label(d$PMSAA)
</code></pre>

<hr>
<h2 id='ipums_callback'>Callback classes</h2><span id='topic+ipums_callback'></span><span id='topic+IpumsChunkCallback'></span><span id='topic+IpumsSideEffectCallback'></span><span id='topic+IpumsDataFrameCallback'></span><span id='topic+IpumsListCallback'></span><span id='topic+IpumsBiglmCallback'></span>

<h3>Description</h3>

<p>These classes are used to define callback behaviors for use with
<code><a href="#topic+read_ipums_micro_chunked">read_ipums_micro_chunked()</a></code>. They are based on the
<code><a href="readr.html#topic+callback">callback</a></code> classes from readr, but
have been adapted to include handling of implicit decimal values and
variable/value labeling for use with IPUMS microdata extracts.
</p>


<h3>Details</h3>


<dl>
<dt>IpumsSideEffectCallback</dt><dd>
<p>Callback function that is used only for side effects, no results are
returned.
</p>
<p>Initialize with a function that takes 2 arguments. The first argument
(<code>x</code>) should correspond to the data chunk and the second (<code>pos</code>)
should correspond to the position of the first observation in the chunk.
</p>
<p>If the function returns <code>FALSE</code>, no more chunks will be read.
</p>
</dd>
<dt>IpumsDataFrameCallback</dt><dd>
<p>Callback function that combines the results from each chunk into a
single output <code>data.frame</code> (or similar) object.
</p>
<p>Initialize the same way as you would <code>IpumsSideEffectCallback</code>. The
provided function should return an object that inherits from <code>data.frame</code>.
</p>
<p>The results from each application of the callback function will be
added to the output <code>data.frame</code>.
</p>
</dd>
<dt>IpumsListCallback</dt><dd>
<p>Callback function that returns a list, where each element contains the
result from a single chunk.
</p>
<p>Initialize the same was as you would <code>IpumsSideEffectCallback</code>.
</p>
</dd>
<dt>IpumsBiglmCallback</dt><dd>
<p>Callback function that performs a linear regression on a dataset by chunks
using the biglm package.
</p>
<p>Initialize with a function that takes 2 arguments: The first argument
should correspond to a <a href="stats.html#topic+formula">formula</a> specifying the regression
model. The second should correspond to a function that prepares the data
before running the regression analysis. This function follows the
conventions of the functions used in other callbacks. Any additional
arguments passed to this function are passed to biglm.
</p>
</dd>
<dt>IpumsChunkCallback</dt><dd>
<p>(Advanced) Callback interface definition. All
callback functions for IPUMS data should inherit from this class, and
should use private method <code>ipumsify</code> on the data to handle implicit
decimals and value labels.
</p>
</dd>
</dl>


<hr>
<h2 id='ipums_collect'>Collect data into R session with IPUMS attributes</h2><span id='topic+ipums_collect'></span>

<h3>Description</h3>

<p>Convenience wrapper around dplyr's <code><a href="dplyr.html#topic+compute">collect()</a></code> and
<code><a href="#topic+set_ipums_var_attributes">set_ipums_var_attributes()</a></code>. Use this to attach variable labels when
collecting data from a database.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ipums_collect(data, ddi, var_attrs = c("val_labels", "var_label", "var_desc"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ipums_collect_+3A_data">data</code></td>
<td>
<p>A dplyr <code>tbl</code> object (generally a <code>tbl_lazy</code>
object stored in a database).</p>
</td></tr>
<tr><td><code id="ipums_collect_+3A_ddi">ddi</code></td>
<td>
<p>An <a href="#topic+ipums_ddi">ipums_ddi</a> object created with <code><a href="#topic+read_ipums_ddi">read_ipums_ddi()</a></code>.</p>
</td></tr>
<tr><td><code id="ipums_collect_+3A_var_attrs">var_attrs</code></td>
<td>
<p>Variable attributes to add to the output. Defaults to
all available attributes.
See <code><a href="#topic+set_ipums_var_attributes">set_ipums_var_attributes()</a></code> for more details.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A local <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> with the requested
attributes attached.
</p>

<hr>
<h2 id='ipums_data_collections'>List IPUMS data collections</h2><span id='topic+ipums_data_collections'></span>

<h3>Description</h3>

<p>List IPUMS data collections with their corresponding codes used by the
IPUMS API. Note that some data collections do not yet have API support.
</p>
<p>Currently, ipumsr supports extract definitions for the following collections:
</p>

<ul>
<li><p> IPUMS USA (<code>"usa"</code>)
</p>
</li>
<li><p> IPUMS CPS (<code>"cps"</code>)
</p>
</li>
<li><p> IPUMS International (<code>"ipumsi"</code>)
</p>
</li>
<li><p> IPUMS NHGIS (<code>"nhgis"</code>)
</p>
</li></ul>

<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ipums_data_collections()
</code></pre>


<h3>Value</h3>

<p>A <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> with four columns containing the
full collection name, the type of data the collection provides,
the collection code used by the IPUMS API, and the
status of API support for the collection.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ipums_data_collections()
</code></pre>

<hr>
<h2 id='ipums_ddi-class'><code>ipums_ddi</code> class</h2><span id='topic+ipums_ddi-class'></span><span id='topic+ipums_ddi'></span>

<h3>Description</h3>

<p>The <code>ipums_ddi</code> class provides a data structure for storing the metadata
information contained in IPUMS codebook files. These objects are primarily
used when loading IPUMS data, but can also be
used to explore metadata for an IPUMS extract.
</p>

<ul>
<li><p> For microdata projects, this information is provided in
<a href="https://ddialliance.org/learn/what-is-ddi">DDI codebook</a>
(.xml) files.
</p>
</li>
<li><p> For NHGIS, this information is provided in .txt codebook files.
</p>
</li></ul>

<p>The codebook file contains metadata about the extract files themselves,
including file name, file path, and extract date as well as information about
variables present in the data, including variable names, descriptions, data
types, implied decimals, and positions in the fixed-width files.
</p>
<p>This information is used to correctly parse IPUMS
fixed-width files and attach additional variable metadata to data upon load.
</p>
<p>Note that codebook metadata for NHGIS extracts can also be stored in
an <code>ipums_ddi</code> object, even though these codebooks are distributed as .txt
files, not .xml files. These files do not adhere to the same standards as
the DDI codebook files, so some <code>ipums_ddi</code> fields will be left blank when
reading NHGIS codebooks.
</p>


<h4>Creating an <code>ipums_ddi</code> object</h4>


<ul>
<li><p> To create an <code>ipums_ddi</code> object from an IPUMS microdata extract, use
<code><a href="#topic+read_ipums_ddi">read_ipums_ddi()</a></code>.
</p>
</li>
<li><p> To create an <code>ipums_ddi</code> object from an IPUMS NHGIS extract, use
<code><a href="#topic+read_nhgis_codebook">read_nhgis_codebook()</a></code>
</p>
</li></ul>




<h4>Loading data</h4>


<ul>
<li><p> To load the data associated with an <code>ipums_ddi</code> object, use
<code><a href="#topic+read_ipums_micro">read_ipums_micro()</a></code>, <code><a href="#topic+read_ipums_micro_chunked">read_ipums_micro_chunked()</a></code>, or
<code><a href="#topic+read_ipums_micro_yield">read_ipums_micro_yield()</a></code>
</p>
</li></ul>




<h4>View metadata</h4>


<ul>
<li><p> Use <code><a href="#topic+ipums_var_info">ipums_var_info()</a></code> to explore variable-level metadata for the variables
included in a dataset.
</p>
</li>
<li><p> Use <code><a href="#topic+ipums_file_info">ipums_file_info()</a></code> to explore file-level metadata for an extract.
</p>
</li></ul>



<hr>
<h2 id='ipums_example'>Get path to IPUMS example datasets</h2><span id='topic+ipums_example'></span>

<h3>Description</h3>

<p>Construct file path to example extracts included with ipumsr. These data
are used in package examples and can be used to experiment with ipumsr
functionality.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ipums_example(path = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ipums_example_+3A_path">path</code></td>
<td>
<p>Name of file. If <code>NULL</code>, all available example files will be
listed.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The path to a specific example file or a vector of all
available files.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># List all available example files
ipums_example()

# Get path to a specific example file
file &lt;- ipums_example("cps_00157.xml")

read_ipums_micro(file)
</code></pre>

<hr>
<h2 id='ipums_extract-class'><code>ipums_extract</code> class</h2><span id='topic+ipums_extract-class'></span><span id='topic+ipums_extract'></span>

<h3>Description</h3>

<p>The <code>ipums_extract</code> class provides a data structure for storing the
extract definition and status of an IPUMS data extract request. Both
submitted and unsubmitted extract requests are stored in <code>ipums_extract</code>
objects.
</p>
<p><code>ipums_extract</code> objects are further divided into microdata
and aggregate data classes, and will also include
a collection-specific extract subclass to accommodate differences in
extract options and content across collections.
</p>
<p>Currently supported collections are:
</p>

<ul>
<li><p> IPUMS microdata (<code>"micro_extract"</code>)
</p>

<ul>
<li><p> IPUMS USA (<code>"usa_extract"</code>)
</p>
</li>
<li><p> IPUMS CPS (<code>"cps_extract"</code>)
</p>
</li>
<li><p> IPUMS International (<code>"ipumsi_extract"</code>)
</p>
</li></ul>

</li>
<li><p> IPUMS aggregate data (<code>"agg_extract"</code>)
</p>

<ul>
<li><p> IPUMS NHGIS (<code>"nhgis_extract"</code>)
</p>
</li></ul>

</li></ul>

<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code>.
</p>


<h3>Properties</h3>

<p>Objects of class <code>ipums_extract</code> have:
</p>

<ul>
<li><p> A <code>class</code> attribute of the form
<code>c("{collection}_extract", "{collection_type}_extract", "ipums_extract")</code>.
For instance, <code>c("cps_extract", "micro_extract", "ipums_extract")</code>.
</p>
</li>
<li><p> A base type of <code>"list"</code>.
</p>
</li>
<li><p> A <code>names</code> attribute that is a character vector the same length as the
underlying list.
</p>
</li></ul>

<p>All <code>ipums_extract</code> objects will include several core fields identifying
the extract and its status:
</p>

<ul>
<li> <p><code>collection</code>: the collection for the extract request.
</p>
</li>
<li> <p><code>description</code>: the description of the extract request.
</p>
</li>
<li> <p><code>submitted</code>: logical indicating whether the extract request has been
submitted to the IPUMS API for processing.
</p>
</li>
<li> <p><code>download_links</code>: links to the downloadable data, if the extract request
was completed at the time it was last checked.
</p>
</li>
<li> <p><code>number</code>: the number of the extract request. With <code>collection</code>, this
uniquely identifies an extract request for a given user.
</p>
</li>
<li> <p><code>status</code>: status of the extract request at the time it was last checked.
One of <code>"unsubmitted"</code>, <code>"queued"</code>, <code>"started"</code>, <code>"produced"</code>,
<code>"canceled"</code>, <code>"failed"</code>, or <code>"completed"</code>.
</p>
</li></ul>



<h3>Creating an extract</h3>


<ul>
<li><p> Create an <code>ipums_extract</code> object from scratch with the appropriate
<code><a href="#topic+define_extract">define_extract_*()</a></code> function. These functions take the
form <code style="white-space: pre;">&#8288;define_extract_{collection}&#8288;</code>.
</p>
</li>
<li><p> Use <code><a href="#topic+get_extract_info">get_extract_info()</a></code> to get the latest status of a submitted extract
request.
</p>
</li>
<li><p> Use <code><a href="#topic+get_extract_history">get_extract_history()</a></code> to obtain the extract definitions of
previously-submitted extract requests.
</p>
</li></ul>



<h3>Submitting an extract</h3>


<ul>
<li><p> Use <code><a href="#topic+submit_extract">submit_extract()</a></code> to submit an extract request for processing through
the IPUMS API.
</p>
</li>
<li><p> Use <code><a href="#topic+wait_for_extract">wait_for_extract()</a></code> to periodically check the status of a submitted
extract request until it is ready to download.
</p>
</li>
<li><p> Use <code><a href="#topic+is_extract_ready">is_extract_ready()</a></code> to manually check whether a submitted extract
request is ready to download.
</p>
</li></ul>



<h3>Downloading an extract</h3>


<ul>
<li><p> Download the data contained in a completed extract with
<code><a href="#topic+download_extract">download_extract()</a></code>.
</p>
</li></ul>



<h3>Saving an extract</h3>


<ul>
<li><p> Save an extract to a JSON-formatted file with <code><a href="#topic+save_extract_as_json">save_extract_as_json()</a></code>.
</p>
</li>
<li><p> Create an <code>ipums_extract</code> object from a saved JSON-formatted definition
with <code><a href="#topic+define_extract_from_json">define_extract_from_json()</a></code>.
</p>
</li></ul>


<hr>
<h2 id='ipums_file_info'>Get file information for an IPUMS extract</h2><span id='topic+ipums_file_info'></span><span id='topic+ipums_conditions'></span>

<h3>Description</h3>

<p>Get information about the IPUMS project, date, notes,
conditions, and citation requirements for an extract based on an
<a href="#topic+ipums_ddi">ipums_ddi</a> object.
</p>
<p><code>ipums_conditions()</code> is a convenience function that provides conditions and
citation information for a recently loaded dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ipums_file_info(object, type = NULL)

ipums_conditions(object = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ipums_file_info_+3A_object">object</code></td>
<td>
<p>An <code>ipums_ddi</code> object.
</p>
<p>For <code>ipums_conditions()</code>, leave <code>NULL</code> to display conditions for most
recently loaded dataset.</p>
</td></tr>
<tr><td><code id="ipums_file_info_+3A_type">type</code></td>
<td>
<p>Type of file information to display. If <code>NULL</code>, loads all types.
Otherwise, one of <code>"ipums_project"</code>, <code>"extract_date"</code>,
<code>"extract_notes"</code>, <code>"conditions"</code> or <code>"citation"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>For <code>ipums_file_info()</code>, if <code>type = NULL</code>, a named list of metadata
information. Otherwise, a string containing the requested information.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ddi &lt;- read_ipums_ddi(ipums_example("cps_00157.xml"))

ipums_file_info(ddi)
</code></pre>

<hr>
<h2 id='ipums_list_files'>List files contained within a zipped IPUMS extract</h2><span id='topic+ipums_list_files'></span>

<h3>Description</h3>

<p>Identify the files that can be read from an IPUMS extract.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ipums_list_files(
  file,
  file_select = NULL,
  types = NULL,
  data_layer = deprecated(),
  shape_layer = deprecated(),
  raster_layer = deprecated()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ipums_list_files_+3A_file">file</code></td>
<td>
<p>Path to a .zip archive containing the IPUMS extract to be
examined.</p>
</td></tr>
<tr><td><code id="ipums_list_files_+3A_file_select">file_select</code></td>
<td>
<p>If the path in <code>file</code> contains multiple files, a
<a href="#topic+selection_language">tidyselect selection</a> identifying the files to be
included in the output. Only files that match the provided expression
will be included.
</p>
<p>While less useful, this can also be provided as a string specifying an
exact file name or an integer to match files by index position.</p>
</td></tr>
<tr><td><code id="ipums_list_files_+3A_types">types</code></td>
<td>
<p>One or more of <code>"data"</code> or <code>"shape"</code> indicating
the type of files to include in the output. <code>"data"</code> refers to
tabular data sources, while <code>"shape"</code> refers to spatial data sources.
</p>
<p>The use of <code>"raster"</code> has been deprecated and will be removed in a
future release.</p>
</td></tr>
<tr><td><code id="ipums_list_files_+3A_data_layer">data_layer</code>, <code id="ipums_list_files_+3A_shape_layer">shape_layer</code>, <code id="ipums_list_files_+3A_raster_layer">raster_layer</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
Please use <code>file_select</code> instead.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> containing the types and names of
the available files.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+read_ipums_micro">read_ipums_micro()</a></code> or <code><a href="#topic+read_nhgis">read_nhgis()</a></code> to read tabular data
from an IPUMS extract.
</p>
<p><code><a href="#topic+read_ipums_sf">read_ipums_sf()</a></code> to read spatial data from an IPUMS extract.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>nhgis_file &lt;- ipums_example("nhgis0712_csv.zip")

# 2 available files in this extract
ipums_list_files(nhgis_file)

# Look for files that match a particular pattern:
ipums_list_files(nhgis_file, file_select = matches("ds136"))
</code></pre>

<hr>
<h2 id='ipums_shape_join'>Join tabular data to geographic boundaries</h2><span id='topic+ipums_shape_join'></span><span id='topic+ipums_shape_left_join'></span><span id='topic+ipums_shape_right_join'></span><span id='topic+ipums_shape_inner_join'></span><span id='topic+ipums_shape_full_join'></span>

<h3>Description</h3>

<p>These functions are analogous to dplyr's <a href="dplyr.html#topic+mutate-joins">joins</a>, except
that:
</p>

<ul>
<li><p> They operate on a data frame and an <code><a href="sf.html#topic+sf">sf</a></code> object
</p>
</li>
<li><p> They retain the variable attributes provided in IPUMS files and loaded
by ipumsr data-reading functions
</p>
</li>
<li><p> They handle minor incompatibilities between attributes in spatial and
tabular data that emerge in some IPUMS files
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>ipums_shape_left_join(
  data,
  shape_data,
  by,
  suffix = c("", "SHAPE"),
  verbose = TRUE
)

ipums_shape_right_join(
  data,
  shape_data,
  by,
  suffix = c("", "SHAPE"),
  verbose = TRUE
)

ipums_shape_inner_join(
  data,
  shape_data,
  by,
  suffix = c("", "SHAPE"),
  verbose = TRUE
)

ipums_shape_full_join(
  data,
  shape_data,
  by,
  suffix = c("", "SHAPE"),
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ipums_shape_join_+3A_data">data</code></td>
<td>
<p>A tibble or data frame. Typically, this will contain data that
has been aggregated to a specific geographic level.</p>
</td></tr>
<tr><td><code id="ipums_shape_join_+3A_shape_data">shape_data</code></td>
<td>
<p>An <code><a href="sf.html#topic+sf">sf</a></code> object loaded with <code><a href="#topic+read_ipums_sf">read_ipums_sf()</a></code>.</p>
</td></tr>
<tr><td><code id="ipums_shape_join_+3A_by">by</code></td>
<td>
<p>Character vector of variables to join by. See <code><a href="dplyr.html#topic+mutate-joins">dplyr::left_join()</a></code>
for syntax.</p>
</td></tr>
<tr><td><code id="ipums_shape_join_+3A_suffix">suffix</code></td>
<td>
<p>If there are non-joined duplicate variables in the two
data sources, these suffixes will be added to the output to disambiguate
them. Should be a character vector of length 2.
</p>
<p>Defaults to adding the <code>"SHAPE"</code> suffix to duplicated variables in
<code>shape_file</code>.</p>
</td></tr>
<tr><td><code id="ipums_shape_join_+3A_verbose">verbose</code></td>
<td>
<p>If <code>TRUE</code>, display information about any geometries that were
unmatched during the join.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An <code>sf</code> object containing the joined data
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data &lt;- read_nhgis(
  ipums_example("nhgis0972_csv.zip"),
  verbose = FALSE
)

sf_data &lt;- read_ipums_sf(ipums_example("nhgis0972_shape_small.zip"))
joined_data &lt;- ipums_shape_inner_join(data, sf_data, by = "GISJOIN")

colnames(joined_data)

</code></pre>

<hr>
<h2 id='ipums_var_info'>Get contextual information about variables in an IPUMS data source</h2><span id='topic+ipums_var_info'></span><span id='topic+ipums_var_label'></span><span id='topic+ipums_var_desc'></span><span id='topic+ipums_val_labels'></span>

<h3>Description</h3>

<p>Summarize the variable metadata for the variables found in an <a href="#topic+ipums_ddi">ipums_ddi</a>
object or data frame. Provides descriptions of variable
content (<code>var_label</code> and <code>var_desc</code>) as well as labels of particular
values for each variable (<code>val_labels</code>).
</p>
<p><code>ipums_var_info()</code> produces a <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> summary
of multiple variables at once.
</p>
<p><code>ipums_var_label()</code>, <code>ipums_var_desc()</code>, and <code>ipums_val_labels()</code> provide
specific metadata for a single variable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ipums_var_info(object, vars = NULL)

ipums_var_label(object, var = NULL)

ipums_var_desc(object, var = NULL)

ipums_val_labels(object, var = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ipums_var_info_+3A_object">object</code></td>
<td>
<p>An <a href="#topic+ipums_ddi">ipums_ddi</a> object, a data frame containing variable
metadata (as produced by most ipumsr data-reading functions), or
a <code><a href="haven.html#topic+labelled">haven::labelled()</a></code> vector from a
single column in such a data frame.</p>
</td></tr>
<tr><td><code id="ipums_var_info_+3A_vars">vars</code>, <code id="ipums_var_info_+3A_var">var</code></td>
<td>
<p>A <a href="#topic+selection_language">tidyselect selection</a> identifying
the variable(s) to include in the output. Only <code>ipums_var_info()</code> allows
for the selection of multiple variables.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For <code>ipums_var_info()</code>, if the provided <code>object</code> is a
<code><a href="haven.html#topic+labelled">haven::labelled()</a></code>
vector (i.e. a single column from a data frame), the summary output will
include the variable label, variable description, and value labels, if
applicable.
</p>
<p>If it is a data frame, the same information will be
provided for all variables present in the data or to those indicated in
<code>vars</code>.
</p>
<p>If it is an <a href="#topic+ipums_ddi">ipums_ddi</a> object, the summary will also
include information used when reading the data from disk, including
start/end positions for columns in the fixed-width file, implied decimals,
and variable types.
</p>
<p>Providing an <code>ipums_ddi</code> object is the most robust way to access
variable metadata, as many data processing operations will remove these
attributes from data frame-like objects.
</p>


<h3>Value</h3>

<p>For <code>ipums_var_info()</code>, a <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> containing
variable information.
</p>
<p>Otherwise, a length-1 character vector with the requested variable
information.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+read_ipums_ddi">read_ipums_ddi()</a></code> or <code><a href="#topic+read_nhgis_codebook">read_nhgis_codebook()</a></code> to read IPUMS metadata files.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ddi &lt;- read_ipums_ddi(ipums_example("cps_00157.xml"))

# Info for all variables in a data source
ipums_var_info(ddi)

# Metadata for individual variables
ipums_var_desc(ddi, MONTH)

ipums_var_label(ddi, MONTH)

ipums_val_labels(ddi, MONTH)

# NHGIS also supports variable-level metadata, though many fields
# are not relevant and remain blank:
cb &lt;- read_nhgis_codebook(ipums_example("nhgis0972_csv.zip"))

ipums_var_info(cb)
</code></pre>

<hr>
<h2 id='ipums_view'>View a static webpage with variable metadata from an IPUMS extract</h2><span id='topic+ipums_view'></span>

<h3>Description</h3>

<p>For a given <code><a href="#topic+ipums_ddi">ipums_ddi</a></code> object or data frame, display metadata about
its contents in the RStudio viewer pane. This includes extract-level
information as well as metadata for the variables included in the
input object.
</p>
<p>It is also possible to save the output to an external HTML file without
launching the RStudio viewer.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ipums_view(x, out_file = NULL, launch = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ipums_view_+3A_x">x</code></td>
<td>
<p>An <code>ipums_ddi</code> object or a data frame with IPUMS attributes
attached.
</p>
<p>Note that file-level information (e.g. extract notes) is only
available when <code>x</code> is an <code>ipums_ddi</code> object.</p>
</td></tr>
<tr><td><code id="ipums_view_+3A_out_file">out_file</code></td>
<td>
<p>Optional location to save the output HTML file. If <code>NULL</code>,
makes a temporary file.</p>
</td></tr>
<tr><td><code id="ipums_view_+3A_launch">launch</code></td>
<td>
<p>Logical indicating whether to launch the HTML file in the
RStudio viewer pane. If <code>TRUE</code>, RStudio and rstudioapi must be available.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>ipums_view()</code> requires that the htmltools, shiny, and DT packages are
installed. If <code>launch = TRUE</code>, RStudio and the rstudioapi package must
also be available.
</p>
<p>Note that if <code>launch = FALSE</code> and <code>out_file</code> is unspecified, the output
file will be written to a temporary directory. Some operating systems
may be unable to open the HTML file from the temporary directory; we
suggest that you manually specify the <code>out_file</code> location in this case.
</p>


<h3>Value</h3>

<p>The file path to the output HTML file (invisibly, if <code>launch = TRUE</code>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ddi &lt;- read_ipums_ddi(ipums_example("cps_00157.xml"))

## Not run: 
ipums_view(ddi)
ipums_view(ddi, "codebook.html", launch = FALSE)

## End(Not run)
</code></pre>

<hr>
<h2 id='ipums_website'>Launch a browser window to an IPUMS metadata page</h2><span id='topic+ipums_website'></span>

<h3>Description</h3>

<p>Launch the documentation webpage for a given
IPUMS project and variable. The project can be provided in the form
of an <code><a href="#topic+ipums_ddi">ipums_ddi</a></code> object or can be manually specified.
</p>
<p>This provides access to more extensive variable metadata than may be
contained within an <code>ipums_ddi</code> object itself.
</p>
<p>Note that some IPUMS projects (e.g. IPUMS NHGIS) do not have
variable-specific pages. In these cases, <code>ipums_website()</code> will launch the
project's main data selection page.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ipums_website(
  x,
  var = NULL,
  launch = TRUE,
  verbose = TRUE,
  homepage_if_missing = FALSE,
  project = deprecated(),
  var_label = deprecated()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ipums_website_+3A_x">x</code></td>
<td>
<p>An <code><a href="#topic+ipums_ddi">ipums_ddi</a></code> object or the name of an IPUMS project.
See <code><a href="#topic+ipums_data_collections">ipums_data_collections()</a></code> for supported projects.</p>
</td></tr>
<tr><td><code id="ipums_website_+3A_var">var</code></td>
<td>
<p>Name of the variable to load. If <code>NULL</code>, provides the URL to the
project's main data selection site.</p>
</td></tr>
<tr><td><code id="ipums_website_+3A_launch">launch</code></td>
<td>
<p>If <code>TRUE</code>, launch a browser window to the metadata webpage.
Otherwise, return the URL for the webpage.</p>
</td></tr>
<tr><td><code id="ipums_website_+3A_verbose">verbose</code></td>
<td>
<p>If <code>TRUE</code>, produce warnings when invalid URL specifications
are detected.</p>
</td></tr>
<tr><td><code id="ipums_website_+3A_homepage_if_missing">homepage_if_missing</code></td>
<td>
<p>If <code>TRUE</code>, return the IPUMS homepage if the
IPUMS project in <code>x</code> is not recognized.</p>
</td></tr>
<tr><td><code id="ipums_website_+3A_project">project</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a> Please use <code>x</code> instead.</p>
</td></tr>
<tr><td><code id="ipums_website_+3A_var_label">var_label</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a> Variable label for the
provided <code>var</code>. This is typically obtained from the input <code>ipums_ddi</code>
object and is unlikely to be needed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>launch = TRUE</code>, you will need a valid registration for the specified
project to successfully launch the webpage.
</p>
<p>Not all IPUMS variables are found at webpages that exactly match the variable
names that are included in completed extract files (and <code>ipums_ddi</code> objects).
Therefore, there may be some projects and variables for which
<code>ipums_website()</code> will launch the page for a different variable or an
invalid page.
</p>


<h3>Value</h3>

<p>The URL to the IPUMS webpage for the indicated project and variable
(invisibly if <code>launch = TRUE</code>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ddi &lt;- read_ipums_ddi(ipums_example("cps_00157.xml"))

## Not run: 
# Launch webpage for particular variable
ipums_website(ddi, "MONTH")

## End(Not run)

# Can also specify an IPUMS project instead of an `ipums_ddi` object
ipums_website("IPUMS CPS", var = "RECTYPE", launch = FALSE)

# Shorthand project names from `ipums_data_collections()` are also accepted:
ipums_website("ipumsi", var = "YEAR", launch = FALSE)
</code></pre>

<hr>
<h2 id='join_failures'>Report on observations dropped during a join</h2><span id='topic+join_failures'></span>

<h3>Description</h3>

<p>Helper to display observations that were not matched when joining tabular
and spatial data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>join_failures(join_results)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="join_failures_+3A_join_results">join_results</code></td>
<td>
<p>A data frame that has just been created by an
<a href="#topic+ipums_shape_left_join">ipums shape join</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of data frames, where the first element (<code>shape</code>) includes
the observations dropped from the shapefile and the second (<code>data</code>)
includes the
observations dropped from the data file.
</p>

<hr>
<h2 id='lbl'>Make a label placeholder object</h2><span id='topic+lbl'></span>

<h3>Description</h3>

<p>Define a new label/value pair. For use in functions like <code><a href="#topic+lbl_relabel">lbl_relabel()</a></code>
and <code><a href="#topic+lbl_add">lbl_add()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lbl(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lbl_+3A_...">...</code></td>
<td>
<p>Either one or two arguments specifying the label (<code>.lbl</code>) and
value (<code>.val</code>) to use in the new label pair.
</p>
<p>If arguments are named, they must be named <code>.val</code> and/or <code>.lbl</code>.
</p>
<p>If a single unnamed value is passed, it is used as the <code>.lbl</code> for the new
label. If two unnamed values are passed, they are used as the <code>.val</code> and
<code>.lbl</code>, respectively.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Several <code style="white-space: pre;">&#8288;lbl_*()&#8288;</code> functions include arguments that can be passed a function
of <code>.val</code> and/or <code>.lbl</code>. These refer to the existing values and
labels in the input vector, respectively.
</p>
<p>Use <code>.val</code> to refer to the <em>values</em> in the vector's value labels.
Use <code>.lbl</code> to refer to the <em>label names</em> in the vector's value labels.
</p>
<p>Note that not all <code style="white-space: pre;">&#8288;lbl_*()&#8288;</code> functions support both of these arguments.
</p>


<h3>Value</h3>

<p>A <code>label_placeholder</code> object
</p>


<h3>See Also</h3>

<p>Other lbl_helpers: 
<code><a href="#topic+lbl_add">lbl_add</a>()</code>,
<code><a href="#topic+lbl_clean">lbl_clean</a>()</code>,
<code><a href="#topic+lbl_define">lbl_define</a>()</code>,
<code><a href="#topic+lbl_na_if">lbl_na_if</a>()</code>,
<code><a href="#topic+lbl_relabel">lbl_relabel</a>()</code>,
<code><a href="#topic+zap_ipums_attributes">zap_ipums_attributes</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Label placeholder with no associated value
lbl("New label")

# Label placeholder with a value/label pair
lbl(10, "New label")

# Use placeholders as inputs to other label handlers
x &lt;- haven::labelled(
  c(100, 200, 105, 990, 999, 230),
  c(`Unknown` = 990, NIU = 999)
)

x &lt;- lbl_add(
  x,
  lbl(100, "$100"),
  lbl(105, "$105"),
  lbl(200, "$200"),
  lbl(230, "$230")
)

lbl_relabel(x, lbl(9999, "Missing") ~ .val &gt; 900)
</code></pre>

<hr>
<h2 id='lbl_add'>Add labels for unlabelled values</h2><span id='topic+lbl_add'></span><span id='topic+lbl_add_vals'></span>

<h3>Description</h3>

<p>Add labels for values that don't already have them in a
<code><a href="haven.html#topic+labelled">labelled</a></code> vector.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lbl_add(x, ...)

lbl_add_vals(x, labeller = as.character, vals = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lbl_add_+3A_x">x</code></td>
<td>
<p>A <code><a href="haven.html#topic+labelled">labelled</a></code> vector</p>
</td></tr>
<tr><td><code id="lbl_add_+3A_...">...</code></td>
<td>
<p>Arbitrary number of label placeholders created with <code><a href="#topic+lbl">lbl()</a></code>
indicating the value/label pairs to add.</p>
</td></tr>
<tr><td><code id="lbl_add_+3A_labeller">labeller</code></td>
<td>
<p>A function that takes values being added as an argument and
returns the labels to associate with those values. By default, uses the
values themselves after converting to character.</p>
</td></tr>
<tr><td><code id="lbl_add_+3A_vals">vals</code></td>
<td>
<p>Vector of values to be labelled. If <code>NULL</code>, labels all unlabelled
values that exist in the data.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code><a href="haven.html#topic+labelled">labelled</a></code> vector
</p>


<h3>See Also</h3>

<p>Other lbl_helpers: 
<code><a href="#topic+lbl_clean">lbl_clean</a>()</code>,
<code><a href="#topic+lbl_define">lbl_define</a>()</code>,
<code><a href="#topic+lbl_na_if">lbl_na_if</a>()</code>,
<code><a href="#topic+lbl_relabel">lbl_relabel</a>()</code>,
<code><a href="#topic+lbl">lbl</a>()</code>,
<code><a href="#topic+zap_ipums_attributes">zap_ipums_attributes</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- haven::labelled(
  c(100, 200, 105, 990, 999, 230),
  c(`Unknown` = 990, NIU = 999)
)

# Add new labels manually
lbl_add(
  x,
  lbl(100, "$100"),
  lbl(105, "$105"),
  lbl(200, "$200"),
  lbl(230, "$230")
)

# Add labels for all unlabelled values
lbl_add_vals(x)

# Update label names while adding
lbl_add_vals(x, labeller = ~ paste0("$", .))

# Add labels for select values
lbl_add_vals(x, vals = c(100, 200))
</code></pre>

<hr>
<h2 id='lbl_clean'>Clean unused labels</h2><span id='topic+lbl_clean'></span>

<h3>Description</h3>

<p>Remove labels that do not appear in the data. When converting labelled
values to a factor, this avoids the creation of additional factor levels.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lbl_clean(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lbl_clean_+3A_x">x</code></td>
<td>
<p>A <code><a href="haven.html#topic+labelled">labelled</a></code> vector</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code><a href="haven.html#topic+labelled">labelled</a></code> vector
</p>


<h3>See Also</h3>

<p>Other lbl_helpers: 
<code><a href="#topic+lbl_add">lbl_add</a>()</code>,
<code><a href="#topic+lbl_define">lbl_define</a>()</code>,
<code><a href="#topic+lbl_na_if">lbl_na_if</a>()</code>,
<code><a href="#topic+lbl_relabel">lbl_relabel</a>()</code>,
<code><a href="#topic+lbl">lbl</a>()</code>,
<code><a href="#topic+zap_ipums_attributes">zap_ipums_attributes</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- haven::labelled(
  c(1, 2, 3, 1, 2, 3, 1, 2, 3),
  c(Q1 = 1, Q2 = 2, Q3 = 3, Q4 = 4)
)

lbl_clean(x)

# Compare the factor levels of the normal and cleaned labels after coercion
as_factor(lbl_clean(x))

as_factor(x)
</code></pre>

<hr>
<h2 id='lbl_define'>Define labels for an unlabelled vector</h2><span id='topic+lbl_define'></span>

<h3>Description</h3>

<p>Create a <code><a href="haven.html#topic+labelled">labelled</a></code> vector from an unlabelled
vector using <code><a href="#topic+lbl_relabel">lbl_relabel()</a></code> syntax, allowing for the grouping of multiple
values into a single label. Values not assigned a label remain unlabelled.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lbl_define(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lbl_define_+3A_x">x</code></td>
<td>
<p>An unlabelled vector</p>
</td></tr>
<tr><td><code id="lbl_define_+3A_...">...</code></td>
<td>
<p>Arbitrary number of two-sided formulas.
</p>
<p>The left hand side should be a label placeholder created with <code><a href="#topic+lbl">lbl()</a></code>.
</p>
<p>The right hand side should be a function taking <code>.val</code> that
evaluates to <code>TRUE</code> for all cases that should receive the label specified
on the left hand side.
</p>
<p>Can be provided as an anonymous function or formula. See Details section.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Several <code style="white-space: pre;">&#8288;lbl_*()&#8288;</code> functions include arguments that can be passed a function
of <code>.val</code> and/or <code>.lbl</code>. These refer to the existing values and
labels in the input vector, respectively.
</p>
<p>Use <code>.val</code> to refer to the <em>values</em> in the vector's value labels.
Use <code>.lbl</code> to refer to the <em>label names</em> in the vector's value labels.
</p>
<p>Note that not all <code style="white-space: pre;">&#8288;lbl_*()&#8288;</code> functions support both of these arguments.
</p>


<h3>Value</h3>

<p>A <code><a href="haven.html#topic+labelled">labelled</a></code> vector
</p>


<h3>See Also</h3>

<p>Other lbl_helpers: 
<code><a href="#topic+lbl_add">lbl_add</a>()</code>,
<code><a href="#topic+lbl_clean">lbl_clean</a>()</code>,
<code><a href="#topic+lbl_na_if">lbl_na_if</a>()</code>,
<code><a href="#topic+lbl_relabel">lbl_relabel</a>()</code>,
<code><a href="#topic+lbl">lbl</a>()</code>,
<code><a href="#topic+zap_ipums_attributes">zap_ipums_attributes</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>age &lt;- c(10, 12, 16, 18, 20, 22, 25, 27)

# Group age values into two label groups.
# Values not captured by the right hand side functions remain unlabelled
lbl_define(
  age,
  lbl(1, "Pre-college age") ~ .val &lt; 18,
  lbl(2, "College age") ~ .val &gt;= 18 &amp; .val &lt;= 22
)
</code></pre>

<hr>
<h2 id='lbl_na_if'>Convert labelled data values to NA</h2><span id='topic+lbl_na_if'></span>

<h3>Description</h3>

<p>Convert data values in a <code><a href="haven.html#topic+labelled">labelled</a></code> vector
to <code>NA</code> based on the value labels associated with that vector. Ignores
values that do not have a label.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lbl_na_if(x, .predicate)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lbl_na_if_+3A_x">x</code></td>
<td>
<p>A <code><a href="haven.html#topic+labelled">labelled</a></code> vector</p>
</td></tr>
<tr><td><code id="lbl_na_if_+3A_.predicate">.predicate</code></td>
<td>
<p>A function taking <code>.val</code> and <code>.lbl</code> arguments that
returns <code>TRUE</code> for all values that should be converted to <code>NA</code>.
</p>
<p>Can be provided as an anonymous function or formula. See Details section.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Several <code style="white-space: pre;">&#8288;lbl_*()&#8288;</code> functions include arguments that can be passed a function
of <code>.val</code> and/or <code>.lbl</code>. These refer to the existing values and
labels in the input vector, respectively.
</p>
<p>Use <code>.val</code> to refer to the <em>values</em> in the vector's value labels.
Use <code>.lbl</code> to refer to the <em>label names</em> in the vector's value labels.
</p>
<p>Note that not all <code style="white-space: pre;">&#8288;lbl_*()&#8288;</code> functions support both of these arguments.
</p>


<h3>Value</h3>

<p>A <code><a href="haven.html#topic+labelled">labelled</a></code> vector
</p>


<h3>See Also</h3>

<p>Other lbl_helpers: 
<code><a href="#topic+lbl_add">lbl_add</a>()</code>,
<code><a href="#topic+lbl_clean">lbl_clean</a>()</code>,
<code><a href="#topic+lbl_define">lbl_define</a>()</code>,
<code><a href="#topic+lbl_relabel">lbl_relabel</a>()</code>,
<code><a href="#topic+lbl">lbl</a>()</code>,
<code><a href="#topic+zap_ipums_attributes">zap_ipums_attributes</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- haven::labelled(
  c(10, 10, 11, 20, 30, 99, 30, 10),
  c(Yes = 10, `Yes - Logically Assigned` = 11, No = 20, Maybe = 30, NIU = 99)
)

# Convert labelled values greater than 90 to `NA`
lbl_na_if(x, function(.val, .lbl) .val &gt;= 90)

# Can use purrr-style notation
lbl_na_if(x, ~ .lbl %in% c("Maybe"))

# Or refer to named function
na_function &lt;- function(.val, .lbl) .val &gt;= 90
lbl_na_if(x, na_function)
</code></pre>

<hr>
<h2 id='lbl_relabel'>Modify value labels for a labelled vector</h2><span id='topic+lbl_relabel'></span><span id='topic+lbl_collapse'></span>

<h3>Description</h3>

<p>Update the mapping between values and labels in a
<code><a href="haven.html#topic+labelled">labelled</a></code> vector. These functions allow you to
simultaneously update data values and the existing value labels.
Modifying data values directly does not result in updated value labels.
</p>
<p>Use <code>lbl_relabel()</code> to manually specify new value/label mappings. This
allows for the addition of new labels.
</p>
<p>Use <code>lbl_collapse()</code> to collapse detailed labels into more general
categories. Values can be grouped together and associated with individual
labels that already exist in the <code>labelled</code> vector.
</p>
<p>Unlabelled values will be converted to <code>NA</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lbl_relabel(x, ...)

lbl_collapse(x, .fun)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lbl_relabel_+3A_x">x</code></td>
<td>
<p>A <code><a href="haven.html#topic+labelled">labelled</a></code> vector</p>
</td></tr>
<tr><td><code id="lbl_relabel_+3A_...">...</code></td>
<td>
<p>Arbitrary number of two-sided formulas.
</p>
<p>The left hand side should be a label placeholder created with <code><a href="#topic+lbl">lbl()</a></code> or a
value that already exists in the data.
</p>
<p>The right hand side should be a function taking <code>.val</code> and <code>.lbl</code>
arguments that evaluates to <code>TRUE</code> for all
cases that should receive the label specified on the left hand side.
</p>
<p>Can be provided as an anonymous function or formula. See Details section.</p>
</td></tr>
<tr><td><code id="lbl_relabel_+3A_.fun">.fun</code></td>
<td>
<p>A function taking <code>.val</code> and <code>.lbl</code> arguments that returns
the value associated with an existing label in the vector. Input values to
this function will be relabeled with the label of the function's output
value.
</p>
<p>Can be provided as an anonymous function or formula. See Details section.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Several <code style="white-space: pre;">&#8288;lbl_*()&#8288;</code> functions include arguments that can be passed a function
of <code>.val</code> and/or <code>.lbl</code>. These refer to the existing values and
labels in the input vector, respectively.
</p>
<p>Use <code>.val</code> to refer to the <em>values</em> in the vector's value labels.
Use <code>.lbl</code> to refer to the <em>label names</em> in the vector's value labels.
</p>
<p>Note that not all <code style="white-space: pre;">&#8288;lbl_*()&#8288;</code> functions support both of these arguments.
</p>


<h3>Value</h3>

<p>A <code><a href="haven.html#topic+labelled">labelled</a></code> vector
</p>


<h3>See Also</h3>

<p>Other lbl_helpers: 
<code><a href="#topic+lbl_add">lbl_add</a>()</code>,
<code><a href="#topic+lbl_clean">lbl_clean</a>()</code>,
<code><a href="#topic+lbl_define">lbl_define</a>()</code>,
<code><a href="#topic+lbl_na_if">lbl_na_if</a>()</code>,
<code><a href="#topic+lbl">lbl</a>()</code>,
<code><a href="#topic+zap_ipums_attributes">zap_ipums_attributes</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- haven::labelled(
  c(10, 10, 11, 20, 21, 30, 99, 30, 10),
  c(
    Yes = 10, `Yes - Logically Assigned` = 11,
    No = 20, Unlikely = 21, Maybe = 30, NIU = 99
  )
)

# Convert cases with value 11 to value 10 and associate with 10's label
lbl_relabel(x, 10 ~ .val == 11)
lbl_relabel(x, lbl("Yes") ~ .val == 11)

# To relabel using new value/label pairs, use `lbl()` to define a new pair
lbl_relabel(
  x,
  lbl(10, "Yes/Yes-ish") ~ .val %in% c(10, 11),
  lbl(90, "???") ~ .val == 99 | .lbl == "Maybe"
)

# Collapse labels to create new label groups
lbl_collapse(x, ~ (.val %/% 10) * 10)

# These are equivalent
lbl_collapse(x, ~ ifelse(.val == 10, 11, .val))
lbl_relabel(x, 11 ~ .val == 10)
</code></pre>

<hr>
<h2 id='read_ipums_ddi'>Read metadata about an IPUMS microdata extract from a DDI codebook (.xml)
file</h2><span id='topic+read_ipums_ddi'></span>

<h3>Description</h3>

<p>Reads the metadata about an IPUMS extract from a
<a href="https://ddialliance.org/learn/what-is-ddi">DDI codebook</a> into an
<a href="#topic+ipums_ddi">ipums_ddi</a> object.
</p>
<p>These metadata contains parsing instructions for the associated fixed-width
data file, contextual labels for variables and values in the data, and
general extract information.
</p>
<p>See <em>Downloading IPUMS files</em> below for information about downloading
IPUMS DDI codebook files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_ipums_ddi(
  ddi_file,
  lower_vars = FALSE,
  file_select = deprecated(),
  data_layer = deprecated()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="read_ipums_ddi_+3A_ddi_file">ddi_file</code></td>
<td>
<p>Path to a DDI .xml file downloaded from
<a href="https://www.ipums.org/">IPUMS</a>. See <em>Downloading IPUMS files</em> below.</p>
</td></tr>
<tr><td><code id="read_ipums_ddi_+3A_lower_vars">lower_vars</code></td>
<td>
<p>Logical indicating whether to convert variable names to
lowercase. Defaults to <code>FALSE</code> for consistency with IPUMS conventions.</p>
</td></tr>
<tr><td><code id="read_ipums_ddi_+3A_data_layer">data_layer</code>, <code id="read_ipums_ddi_+3A_file_select">file_select</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a> Reading
DDI files contained in a .zip archive has been deprecated. Please provide
the full path to the .xml file to be loaded in <code>ddi_file</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An <a href="#topic+ipums_ddi">ipums_ddi</a> object with metadata information.
</p>


<h3>Downloading IPUMS files</h3>

<p>The DDI codebook (.xml) file provided with IPUMS microdata extracts can be
downloaded through the IPUMS extract interface or (for some collections)
within R using the IPUMS API.
</p>
<p>If using the IPUMS extract interface:
</p>

<ul>
<li><p> Download the DDI codebook by right clicking on the <strong>DDI</strong> link in the
<strong>Codebook</strong> column of the extract interface and selecting <strong>Save as...</strong>
(on Safari, you may have to select <strong>Download Linked File As...</strong>).
Be sure that the codebook is downloaded in .xml format.
</p>
</li></ul>

<p>If using the IPUMS API:
</p>

<ul>
<li><p> For supported collections, use <code><a href="#topic+download_extract">download_extract()</a></code> to download a completed
extract via the IPUMS API. This automatically downloads both the DDI
codebook and the data file from the extract and
returns the path to the codebook file.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+read_ipums_micro">read_ipums_micro()</a></code>, <code><a href="#topic+read_ipums_micro_chunked">read_ipums_micro_chunked()</a></code> and
<code><a href="#topic+read_ipums_micro_yield">read_ipums_micro_yield()</a></code> to read data from IPUMS microdata extracts.
</p>
<p><code><a href="#topic+ipums_var_info">ipums_var_info()</a></code> and <code><a href="#topic+ipums_file_info">ipums_file_info()</a></code> to view metadata about an
<a href="#topic+ipums_ddi">ipums_ddi</a> object.
</p>
<p><code><a href="#topic+ipums_list_files">ipums_list_files()</a></code> to list files in an IPUMS extract.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example codebook file
ddi_file &lt;- ipums_example("cps_00157.xml")

# Load data into an `ipums_ddi` obj
ddi &lt;- read_ipums_ddi(ddi_file)

# Use the object to load its associated data
cps &lt;- read_ipums_micro(ddi)

head(cps)

# Or get metadata information directly
ipums_var_info(ddi)

ipums_file_info(ddi)[1:2]

# If variable metadata have been lost from a data source, reattach from
# its corresponding `ipums_ddi` object:
cps &lt;- zap_ipums_attributes(cps)

ipums_var_label(cps$STATEFIP)

cps &lt;- set_ipums_var_attributes(cps, ddi$var_info)

ipums_var_label(cps$STATEFIP)
</code></pre>

<hr>
<h2 id='read_ipums_micro'>Read data from an IPUMS microdata extract</h2><span id='topic+read_ipums_micro'></span><span id='topic+read_ipums_micro_list'></span>

<h3>Description</h3>

<p>Read a microdata dataset downloaded from the IPUMS extract system.
</p>
<p>Two files are required to load IPUMS microdata extracts:
</p>

<ul>
<li><p> A <a href="https://ddialliance.org/learn/what-is-ddi">DDI codebook</a> file
(.xml) used to parse the extract's data file
</p>
</li>
<li><p> A data file (either .dat.gz or .csv.gz)
</p>
</li></ul>

<p>See <em>Downloading IPUMS files</em> below for more information about
downloading these files.
</p>
<p><code>read_ipums_micro()</code> and <code>read_ipums_micro_list()</code> differ in their handling
of extracts that contain multiple record types. See <em>Data structures</em>
below.
</p>
<p>Note that Stata, SAS, and SPSS file formats are not supported by
ipumsr readers. Convert your extract to fixed-width or CSV format, or see
<a href="https://haven.tidyverse.org/index.html">haven</a> for help
loading these files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_ipums_micro(
  ddi,
  vars = NULL,
  n_max = Inf,
  data_file = NULL,
  verbose = TRUE,
  var_attrs = c("val_labels", "var_label", "var_desc"),
  lower_vars = FALSE
)

read_ipums_micro_list(
  ddi,
  vars = NULL,
  n_max = Inf,
  data_file = NULL,
  verbose = TRUE,
  var_attrs = c("val_labels", "var_label", "var_desc"),
  lower_vars = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="read_ipums_micro_+3A_ddi">ddi</code></td>
<td>
<p>Either a path to a DDI .xml file downloaded from
<a href="https://www.ipums.org/">IPUMS</a>, or an
<a href="#topic+ipums_ddi">ipums_ddi</a> object parsed by <code><a href="#topic+read_ipums_ddi">read_ipums_ddi()</a></code>. See
<em>Downloading IPUMS files</em> below.</p>
</td></tr>
<tr><td><code id="read_ipums_micro_+3A_vars">vars</code></td>
<td>
<p>Names of variables to include in the output. Accepts a
vector of names or a <a href="#topic+selection_language">tidyselect selection</a>.
If <code>NULL</code>, includes all variables in the file.
</p>
<p>For hierarchical data, the <code>RECTYPE</code> variable is always included even if
unspecified.</p>
</td></tr>
<tr><td><code id="read_ipums_micro_+3A_n_max">n_max</code></td>
<td>
<p>The maximum number of lines to read. For
<code>read_ipums_micro_list()</code>, this applies before splitting records into
list components.</p>
</td></tr>
<tr><td><code id="read_ipums_micro_+3A_data_file">data_file</code></td>
<td>
<p>Path to the data (.gz) file associated with
the provided <code>ddi</code> file. By default, looks for the data file in the same
directory as the DDI file. If the data file has been moved, specify
its location here.</p>
</td></tr>
<tr><td><code id="read_ipums_micro_+3A_verbose">verbose</code></td>
<td>
<p>Logical indicating whether to display IPUMS conditions and
progress information.</p>
</td></tr>
<tr><td><code id="read_ipums_micro_+3A_var_attrs">var_attrs</code></td>
<td>
<p>Variable attributes from the DDI to add to the columns of
the output data. Defaults to all available attributes.
See <code><a href="#topic+set_ipums_var_attributes">set_ipums_var_attributes()</a></code> for more details.</p>
</td></tr>
<tr><td><code id="read_ipums_micro_+3A_lower_vars">lower_vars</code></td>
<td>
<p>If reading a DDI from a file,
a logical indicating whether to convert variable names to lowercase.
Defaults to <code>FALSE</code> for consistency with IPUMS conventions.
</p>
<p>This argument will be ignored if argument <code>ddi</code> is
an <a href="#topic+ipums_ddi">ipums_ddi</a> object. Use <code><a href="#topic+read_ipums_ddi">read_ipums_ddi()</a></code> to convert variable
names to lowercase when reading a DDI file.
</p>
<p>If <code>lower_vars = TRUE</code> and <code>vars</code> is specified, <code>vars</code> should reference the
lowercase column names.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>read_ipums_micro()</code> returns a single
<code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> object.
</p>
<p><code>read_ipums_micro_list()</code> returns a list of <code>tibble</code> objects with one
entry for each record type.
</p>


<h3>Data structures</h3>

<p>Files from IPUMS projects that contain data for multiple types of records
(e.g. household records and person records) may be either rectangular
or hierarchical.
</p>
<p>Rectangular data are transformed such that each row of data
represents only one type of record. For instance, each row will represent
a person record, and all household-level information for that person will
be included in the same row.
</p>
<p>Hierarchical data have records of
different types interspersed in a single file. For instance, a household
record will be included in its own row followed by the person records
associated with that household.
</p>
<p>Hierarchical data can be read in two different formats:
</p>

<ul>
<li> <p><code>read_ipums_micro()</code> reads data into a <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code>
where each row represents a single record, regardless of record type.
Variables that do not apply to a particular record type will be filled with
<code>NA</code> in rows of that record type. For instance, a person-specific variable
will be missing in all rows associated with household records.
</p>
</li>
<li> <p><code>read_ipums_micro_list()</code> reads data into a list of
<code>tibble</code> objects, where each list element contains
only one record type. Each list element is named with its corresponding
record type.
</p>
</li></ul>



<h3>Downloading IPUMS files</h3>

<p>You must download both the DDI codebook and the data file from the IPUMS
extract system to load the data into R. <code style="white-space: pre;">&#8288;read_ipums_micro_*()&#8288;</code> functions
assume that the data file and codebook share a common base file name and
are present in the same directory. If this is not the case, provide a
separate path to the data file with the <code>data_file</code> argument.
</p>
<p>If using the IPUMS extract interface:
</p>

<ul>
<li><p> Download the data file by clicking <strong>Download .dat</strong> under
<strong>Download Data</strong>.
</p>
</li>
<li><p> Download the DDI codebook by right clicking on the <strong>DDI</strong> link in the
<strong>Codebook</strong> column of the extract interface and selecting <strong>Save as...</strong>
(on Safari, you may have to select <strong>Download Linked File as...</strong>).
Be sure that the codebook is downloaded in .xml format.
</p>
</li></ul>

<p>If using the IPUMS API:
</p>

<ul>
<li><p> For supported collections, use <code><a href="#topic+download_extract">download_extract()</a></code> to download a completed
extract via the IPUMS API. This automatically downloads both the DDI
codebook and the data file from the extract and
returns the path to the codebook file.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+read_ipums_micro_chunked">read_ipums_micro_chunked()</a></code> and
<code><a href="#topic+read_ipums_micro_yield">read_ipums_micro_yield()</a></code> to read data from large IPUMS
microdata extracts in chunks.
</p>
<p><code><a href="#topic+read_ipums_ddi">read_ipums_ddi()</a></code> to read metadata associated with an IPUMS microdata
extract.
</p>
<p><code><a href="#topic+read_ipums_sf">read_ipums_sf()</a></code> to read spatial data from an IPUMS extract.
</p>
<p><code><a href="#topic+ipums_list_files">ipums_list_files()</a></code> to list files in an IPUMS extract.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Codebook for rectangular example file
cps_rect_ddi_file &lt;- ipums_example("cps_00157.xml")

# Load data based on codebook file info
cps &lt;- read_ipums_micro(cps_rect_ddi_file)

head(cps)

# Can also load data from a pre-existing `ipums_ddi` object
# (This may be useful to retain codebook metadata even if lost from data
# during processing)
ddi &lt;- read_ipums_ddi(cps_rect_ddi_file)
cps &lt;- read_ipums_micro(ddi, verbose = FALSE)

# Codebook for hierarchical example file
cps_hier_ddi_file &lt;- ipums_example("cps_00159.xml")

# Read in "long" format to get a single data frame
read_ipums_micro(cps_hier_ddi_file, verbose = FALSE)

# Read in "list" format and you get a list of multiple data frames
cps_list &lt;- read_ipums_micro_list(cps_hier_ddi_file)

head(cps_list$PERSON)

head(cps_list$HOUSEHOLD)

# Use the `%&lt;-%` operator from zeallot to unpack into separate objects
c(household, person) %&lt;-% read_ipums_micro_list(cps_hier_ddi_file)

head(person)

head(household)
</code></pre>

<hr>
<h2 id='read_ipums_micro_chunked'>Read data from an IPUMS microdata extract by chunk</h2><span id='topic+read_ipums_micro_chunked'></span><span id='topic+read_ipums_micro_list_chunked'></span>

<h3>Description</h3>

<p>Read a microdata dataset downloaded from the IPUMS extract system in chunks.
</p>
<p>Use these functions to read a file that is too large to store in memory
at a single time. The file is processed in chunks of a given size, with a
provided callback function applied to each chunk.
</p>
<p>Two files are required to load IPUMS microdata extracts:
</p>

<ul>
<li><p> A <a href="https://ddialliance.org/learn/what-is-ddi">DDI codebook</a> file
(.xml) used to parse the extract's data file
</p>
</li>
<li><p> A data file (either .dat.gz or .csv.gz)
</p>
</li></ul>

<p>See <em>Downloading IPUMS files</em> below for more information about downloading
these files.
</p>
<p><code>read_ipums_micro_chunked()</code> and <code>read_ipums_micro_list_chunked()</code> differ
in their handling of extracts that contain multiple record types.
See <em>Data structures</em> below.
</p>
<p>Note that Stata, SAS, and SPSS file formats are not supported by
ipumsr readers. Convert your extract to fixed-width or CSV format, or see
<a href="https://haven.tidyverse.org/index.html">haven</a> for help
loading these files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_ipums_micro_chunked(
  ddi,
  callback,
  chunk_size = 10000,
  vars = NULL,
  data_file = NULL,
  verbose = TRUE,
  var_attrs = c("val_labels", "var_label", "var_desc"),
  lower_vars = FALSE
)

read_ipums_micro_list_chunked(
  ddi,
  callback,
  chunk_size = 10000,
  vars = NULL,
  data_file = NULL,
  verbose = TRUE,
  var_attrs = c("val_labels", "var_label", "var_desc"),
  lower_vars = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="read_ipums_micro_chunked_+3A_ddi">ddi</code></td>
<td>
<p>Either a path to a DDI .xml file downloaded from
<a href="https://www.ipums.org/">IPUMS</a>, or an
<a href="#topic+ipums_ddi">ipums_ddi</a> object parsed by <code><a href="#topic+read_ipums_ddi">read_ipums_ddi()</a></code>. See
<em>Downloading IPUMS files</em> below.</p>
</td></tr>
<tr><td><code id="read_ipums_micro_chunked_+3A_callback">callback</code></td>
<td>
<p>An <a href="#topic+ipums_callback">ipums_callback</a> object, or a function
that will be converted to an <code>IpumsSideEffectCallback</code> object. Callback
functions should include both data (<code>x</code>) and position (<code>pos</code>) arguments.
See examples.</p>
</td></tr>
<tr><td><code id="read_ipums_micro_chunked_+3A_chunk_size">chunk_size</code></td>
<td>
<p>Integer number of observations to
read per chunk. Higher values use more RAM, but
typically result in faster processing. Defaults to 10,000.</p>
</td></tr>
<tr><td><code id="read_ipums_micro_chunked_+3A_vars">vars</code></td>
<td>
<p>Names of variables to include in the output. Accepts a
vector of names or a <a href="#topic+selection_language">tidyselect selection</a>.
If <code>NULL</code>, includes all variables in the file.
</p>
<p>For hierarchical data, the <code>RECTYPE</code> variable is always included even if
unspecified.</p>
</td></tr>
<tr><td><code id="read_ipums_micro_chunked_+3A_data_file">data_file</code></td>
<td>
<p>Path to the data (.gz) file associated with
the provided <code>ddi</code> file. By default, looks for the data file in the same
directory as the DDI file. If the data file has been moved, specify
its location here.</p>
</td></tr>
<tr><td><code id="read_ipums_micro_chunked_+3A_verbose">verbose</code></td>
<td>
<p>Logical indicating whether to display IPUMS conditions and
progress information.</p>
</td></tr>
<tr><td><code id="read_ipums_micro_chunked_+3A_var_attrs">var_attrs</code></td>
<td>
<p>Variable attributes from the DDI to add to the columns of
the output data. Defaults to all available attributes.
See <code><a href="#topic+set_ipums_var_attributes">set_ipums_var_attributes()</a></code> for more details.</p>
</td></tr>
<tr><td><code id="read_ipums_micro_chunked_+3A_lower_vars">lower_vars</code></td>
<td>
<p>If reading a DDI from a file,
a logical indicating whether to convert variable names to lowercase.
Defaults to <code>FALSE</code> for consistency with IPUMS conventions.
</p>
<p>This argument will be ignored if argument <code>ddi</code> is
an <a href="#topic+ipums_ddi">ipums_ddi</a> object. Use <code><a href="#topic+read_ipums_ddi">read_ipums_ddi()</a></code> to convert variable
names to lowercase when reading a DDI file.
</p>
<p>Note that if reading in chunks from a .csv or
.csv.gz file, the callback function will be called <em>before</em> variable names
are converted to lowercase, and thus should reference uppercase variable
names.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Depends on the provided callback object. See <a href="#topic+ipums_callback">ipums_callback</a>.
</p>


<h3>Data structures</h3>

<p>Files from IPUMS projects that contain data for multiple types of records
(e.g. household records and person records) may be either rectangular
or hierarchical.
</p>
<p>Rectangular data are transformed such that each row of data
represents only one type of record. For instance, each row will represent
a person record, and all household-level information for that person will
be included in the same row.
</p>
<p>Hierarchical data have records of
different types interspersed in a single file. For instance, a household
record will be included in its own row followed by the person records
associated with that household.
</p>
<p>Hierarchical data can be read in two different formats:
</p>

<ul>
<li> <p><code>read_ipums_micro_chunked()</code> reads each chunk of data into a
<code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> where each row represents a single record,
regardless of record type. Variables that do not apply to a particular
record type will be filled with <code>NA</code> in rows of that record type. For
instance, a person-specific variable will be missing in all rows
associated with household records. The provided <code>callback</code> function should
therefore operate on a <code>tibble</code> object.
</p>
</li>
<li> <p><code>read_ipums_micro_list_chunked()</code> reads each chunk of data into a list of
<code>tibble</code> objects, where each list element contains
only one record type. Each list element is named with its corresponding
record type. The provided <code>callback</code> function should therefore operate
on a list object. In this case, the chunk size references the total
number of rows <em>across</em> record types, rather than in each
record type.
</p>
</li></ul>



<h3>Downloading IPUMS files</h3>

<p>You must download both the DDI codebook and the data file from the IPUMS
extract system to load the data into R. <code style="white-space: pre;">&#8288;read_ipums_micro_*()&#8288;</code> functions
assume that the data file and codebook share a common base file name and
are present in the same directory. If this is not the case, provide a
separate path to the data file with the <code>data_file</code> argument.
</p>
<p>If using the IPUMS extract interface:
</p>

<ul>
<li><p> Download the data file by clicking <strong>Download .dat</strong> under
<strong>Download Data</strong>.
</p>
</li>
<li><p> Download the DDI codebook by right clicking on the <strong>DDI</strong> link in the
<strong>Codebook</strong> column of the extract interface and selecting <strong>Save as...</strong>
(on Safari, you may have to select <strong>Download Linked File as...</strong>).
Be sure that the codebook is downloaded in .xml format.
</p>
</li></ul>

<p>If using the IPUMS API:
</p>

<ul>
<li><p> For supported collections, use <code><a href="#topic+download_extract">download_extract()</a></code> to download a completed
extract via the IPUMS API. This automatically downloads both the DDI
codebook and the data file from the extract and
returns the path to the codebook file.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+read_ipums_micro_yield">read_ipums_micro_yield()</a></code> for more flexible handling of large
IPUMS microdata files.
</p>
<p><code><a href="#topic+read_ipums_micro">read_ipums_micro()</a></code> to read data from an IPUMS microdata extract.
</p>
<p><code><a href="#topic+read_ipums_ddi">read_ipums_ddi()</a></code> to read metadata associated with an IPUMS microdata
extract.
</p>
<p><code><a href="#topic+read_ipums_sf">read_ipums_sf()</a></code> to read spatial data from an IPUMS extract.
</p>
<p><code><a href="#topic+ipums_list_files">ipums_list_files()</a></code> to list files in an IPUMS extract.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>suppressMessages(library(dplyr))

# Example codebook file
cps_rect_ddi_file &lt;- ipums_example("cps_00157.xml")

# Function to extract Minnesota cases from CPS example
# (This can also be accomplished by including case selections
# in an extract definition)
#
# Function must take `x` and `pos` to refer to data and row position,
# respectively.
filter_mn &lt;- function(x, pos) {
  x[x$STATEFIP == 27, ]
}

# Initialize callback
filter_mn_callback &lt;- IpumsDataFrameCallback$new(filter_mn)

# Process data in chunks, filtering to MN cases in each chunk
read_ipums_micro_chunked(
  cps_rect_ddi_file,
  callback = filter_mn_callback,
  chunk_size = 1000,
  verbose = FALSE
)

# Tabulate INCTOT average by state without storing full dataset in memory
read_ipums_micro_chunked(
  cps_rect_ddi_file,
  callback = IpumsDataFrameCallback$new(
    function(x, pos) {
      x %&gt;%
        mutate(
          INCTOT = lbl_na_if(
            INCTOT,
            ~ grepl("Missing|N.I.U.", .lbl)
          )
        ) %&gt;%
        filter(!is.na(INCTOT)) %&gt;%
        group_by(STATEFIP = as_factor(STATEFIP)) %&gt;%
        summarize(INCTOT_SUM = sum(INCTOT), n = n(), .groups = "drop")
    }
  ),
  chunk_size = 1000,
  verbose = FALSE
) %&gt;%
  group_by(STATEFIP) %&gt;%
  summarize(avg_inc = sum(INCTOT_SUM) / sum(n))

# `x` will be a list when using `read_ipums_micro_list_chunked()`
read_ipums_micro_list_chunked(
  ipums_example("cps_00159.xml"),
  callback = IpumsSideEffectCallback$new(function(x, pos) {
    print(
      paste0(
        nrow(x$PERSON), " persons and ",
        nrow(x$HOUSEHOLD), " households in this chunk."
      )
    )
  }),
  chunk_size = 1000,
  verbose = FALSE
)

# Using the biglm package, you can even run a regression without storing
# the full dataset in memory
if (requireNamespace("biglm")) {
  lm_results &lt;- read_ipums_micro_chunked(
    ipums_example("cps_00160.xml"),
    IpumsBiglmCallback$new(
      INCTOT ~ AGE + HEALTH, # Model formula
      function(x, pos) {
        x %&gt;%
          mutate(
            INCTOT = lbl_na_if(
              INCTOT,
              ~ grepl("Missing|N.I.U.", .lbl)
            ),
            HEALTH = as_factor(HEALTH)
          )
      }
    ),
    chunk_size = 1000,
    verbose = FALSE
  )

  summary(lm_results)
}
</code></pre>

<hr>
<h2 id='read_ipums_micro_yield'>Read data from an IPUMS microdata extract in yields</h2><span id='topic+read_ipums_micro_yield'></span><span id='topic+read_ipums_micro_list_yield'></span><span id='topic+IpumsLongYield'></span><span id='topic+IpumsListYield'></span>

<h3>Description</h3>

<p>Read a microdata dataset downloaded from the IPUMS extract system into an
object that can read and operate on a group (&quot;yield&quot;) of lines at a time.
Use these functions to read a file that is too large to store in memory at
a single time. They represent a more flexible implementation of
<code><a href="#topic+read_ipums_micro_chunked">read_ipums_micro_chunked()</a></code> using R6.
</p>
<p>Two files are required to load IPUMS microdata extracts:
</p>

<ul>
<li><p> A <a href="https://ddialliance.org/learn/what-is-ddi">DDI codebook</a> file
(.xml) used to parse the extract's data file
</p>
</li>
<li><p> A data file (either .dat.gz or .csv.gz)
</p>
</li></ul>

<p>See <em>Downloading IPUMS files</em> below for more information about downloading
these files.
</p>
<p><code>read_ipums_micro_yield()</code> and <code>read_ipums_micro_list_yield()</code> differ
in their handling of extracts that contain multiple record types.
See <em>Data structures</em> below.
</p>
<p>Note that these functions only support fixed-width (.dat) data files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_ipums_micro_yield(
  ddi,
  vars = NULL,
  data_file = NULL,
  verbose = TRUE,
  var_attrs = c("val_labels", "var_label", "var_desc"),
  lower_vars = FALSE
)

read_ipums_micro_list_yield(
  ddi,
  vars = NULL,
  data_file = NULL,
  verbose = TRUE,
  var_attrs = c("val_labels", "var_label", "var_desc"),
  lower_vars = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="read_ipums_micro_yield_+3A_ddi">ddi</code></td>
<td>
<p>Either a path to a DDI .xml file downloaded from
<a href="https://www.ipums.org/">IPUMS</a>, or an
<a href="#topic+ipums_ddi">ipums_ddi</a> object parsed by <code><a href="#topic+read_ipums_ddi">read_ipums_ddi()</a></code>. See
<em>Downloading IPUMS files</em> below.</p>
</td></tr>
<tr><td><code id="read_ipums_micro_yield_+3A_vars">vars</code></td>
<td>
<p>Names of variables to include in the output. Accepts a
vector of names or a <a href="#topic+selection_language">tidyselect selection</a>.
If <code>NULL</code>, includes all variables in the file.
</p>
<p>For hierarchical data, the <code>RECTYPE</code> variable is always included even if
unspecified.</p>
</td></tr>
<tr><td><code id="read_ipums_micro_yield_+3A_data_file">data_file</code></td>
<td>
<p>Path to the data (.gz) file associated with
the provided <code>ddi</code> file. By default, looks for the data file in the same
directory as the DDI file. If the data file has been moved, specify
its location here.</p>
</td></tr>
<tr><td><code id="read_ipums_micro_yield_+3A_verbose">verbose</code></td>
<td>
<p>Logical indicating whether to display IPUMS conditions and
progress information.</p>
</td></tr>
<tr><td><code id="read_ipums_micro_yield_+3A_var_attrs">var_attrs</code></td>
<td>
<p>Variable attributes from the DDI to add to the columns of
the output data. Defaults to all available attributes.
See <code><a href="#topic+set_ipums_var_attributes">set_ipums_var_attributes()</a></code> for more details.</p>
</td></tr>
<tr><td><code id="read_ipums_micro_yield_+3A_lower_vars">lower_vars</code></td>
<td>
<p>If reading a DDI from a file,
a logical indicating whether to convert variable names to lowercase.
Defaults to <code>FALSE</code> for consistency with IPUMS conventions.
</p>
<p>This argument will be ignored if argument <code>ddi</code> is
an <a href="#topic+ipums_ddi">ipums_ddi</a> object. Use <code><a href="#topic+read_ipums_ddi">read_ipums_ddi()</a></code> to convert variable
names to lowercase when reading a DDI file.
</p>
<p>If <code>lower_vars = TRUE</code> and <code>vars</code> is specified, <code>vars</code> should reference the
lowercase column names.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A HipYield R6 object (see Details section)
</p>


<h3>Methods summary:</h3>

<p>These functions return a HipYield R6 object with the following methods:
</p>

<ul>
<li> <p><code>yield(n = 10000)</code> reads the next &quot;yield&quot; from the
data.
</p>
<p>For <code>read_ipums_micro_yield()</code>, returns a <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code>
with up to <code>n</code> rows.
</p>
<p>For <code>read_ipums_micro_list_yield()</code>, returns a list of tibbles with a
total of up to <code>n</code> rows across list elements.
</p>
<p>If fewer than <code>n</code> rows are left in the data, returns all remaining rows.
If no rows are left in the data, returns <code>NULL</code>.
</p>
</li>
<li> <p><code>reset()</code> resets the data so that the next yield will read data from the
start.
</p>
</li>
<li> <p><code>is_done()</code> returns a logical indicating whether all rows in the file
have been read.
</p>
</li>
<li> <p><code>cur_pos</code> contains the next row number that will be read (1-indexed).
</p>
</li></ul>



<h3>Data structures</h3>

<p>Files from IPUMS projects that contain data for multiple types of records
(e.g. household records and person records) may be either rectangular
or hierarchical.
</p>
<p>Rectangular data are transformed such that each row of data
represents only one type of record. For instance, each row will represent
a person record, and all household-level information for that person will
be included in the same row.
</p>
<p>Hierarchical data have records of
different types interspersed in a single file. For instance, a household
record will be included in its own row followed by the person records
associated with that household.
</p>
<p>Hierarchical data can be read in two different formats:
</p>

<ul>
<li> <p><code>read_ipums_micro_yield()</code> produces an object that yields data as a
<code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> whose rows
represent single records, regardless of record type. Variables that do
not apply to a particular record type will be filled with <code>NA</code> in rows of
that record type. For instance, a person-specific variable will be missing
in all rows associated with household records.
</p>
</li>
<li> <p><code>read_ipums_micro_list_yield()</code> produces an object that yields data as a
list of <code>tibble</code> objects, where each list element contains
only one record type. Each list element is named with its corresponding
record type. In this case, when using <code>yield()</code>, <code>n</code> refers to
the total number of rows <em>across</em> record types, rather than in each
record type.
</p>
</li></ul>



<h3>Downloading IPUMS files</h3>

<p>You must download both the DDI codebook and the data file from the IPUMS
extract system to load the data into R. <code style="white-space: pre;">&#8288;read_ipums_micro_*()&#8288;</code> functions
assume that the data file and codebook share a common base file name and
are present in the same directory. If this is not the case, provide a
separate path to the data file with the <code>data_file</code> argument.
</p>
<p>If using the IPUMS extract interface:
</p>

<ul>
<li><p> Download the data file by clicking <strong>Download .dat</strong> under
<strong>Download Data</strong>.
</p>
</li>
<li><p> Download the DDI codebook by right clicking on the <strong>DDI</strong> link in the
<strong>Codebook</strong> column of the extract interface and selecting <strong>Save as...</strong>
(on Safari, you may have to select <strong>Download Linked File as...</strong>).
Be sure that the codebook is downloaded in .xml format.
</p>
</li></ul>

<p>If using the IPUMS API:
</p>

<ul>
<li><p> For supported collections, use <code><a href="#topic+download_extract">download_extract()</a></code> to download a completed
extract via the IPUMS API. This automatically downloads both the DDI
codebook and the data file from the extract and
returns the path to the codebook file.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+read_ipums_micro_chunked">read_ipums_micro_chunked()</a></code> to read data from large IPUMS
microdata extracts in chunks.
</p>
<p><code><a href="#topic+read_ipums_micro">read_ipums_micro()</a></code> to read data from an IPUMS microdata extract.
</p>
<p><code><a href="#topic+read_ipums_ddi">read_ipums_ddi()</a></code> to read metadata associated with an IPUMS microdata
extract.
</p>
<p><code><a href="#topic+read_ipums_sf">read_ipums_sf()</a></code> to read spatial data from an IPUMS extract.
</p>
<p><code><a href="#topic+ipums_list_files">ipums_list_files()</a></code> to list files in an IPUMS extract.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Create an IpumsLongYield object
long_yield &lt;- read_ipums_micro_yield(ipums_example("cps_00157.xml"))

# Yield the first 10 rows of the data
long_yield$yield(10)

# Yield the next 20 rows of the data
long_yield$yield(20)

# Check the current position after yielding 30 rows
long_yield$cur_pos

# Reset to the beginning of the file
long_yield$reset()

# Use a loop to flexibly process the data in pieces. Count all Minnesotans:
total_mn &lt;- 0

while (!long_yield$is_done()) {
  cur_data &lt;- long_yield$yield(1000)
  total_mn &lt;- total_mn + sum(as_factor(cur_data$STATEFIP) == "Minnesota")
}

total_mn

# Can also read hierarchical data as list:
list_yield &lt;- read_ipums_micro_list_yield(ipums_example("cps_00159.xml"))

# Yield size is based on total rows for all list elements
list_yield$yield(10)
</code></pre>

<hr>
<h2 id='read_ipums_sf'>Read spatial data from an IPUMS extract</h2><span id='topic+read_ipums_sf'></span>

<h3>Description</h3>

<p>Read a spatial data file (also referred to as a GIS file or shapefile) from
an IPUMS extract into an <code>sf</code> object from the
<a href="https://r-spatial.github.io/sf/">sf</a> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_ipums_sf(
  shape_file,
  file_select = NULL,
  vars = NULL,
  encoding = NULL,
  bind_multiple = FALSE,
  add_layer_var = NULL,
  verbose = FALSE,
  shape_layer = deprecated()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="read_ipums_sf_+3A_shape_file">shape_file</code></td>
<td>
<p>Path to a single .shp file or a .zip archive
containing at least one .shp file. See Details section.</p>
</td></tr>
<tr><td><code id="read_ipums_sf_+3A_file_select">file_select</code></td>
<td>
<p>If <code>shape_file</code> is a .zip archive that
contains multiple files, an expression identifying the files to load.
Accepts a character string specifying the
file name, a <a href="#topic+selection_language">tidyselect selection</a>, or index
position. If multiple files are selected, <code>bind_multiple</code> must be
equal to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="read_ipums_sf_+3A_vars">vars</code></td>
<td>
<p>Names of variables to include in the output. Accepts a
character vector of names or a <a href="#topic+selection_language">tidyselect selection</a>.
If <code>NULL</code>, includes all variables in the file.</p>
</td></tr>
<tr><td><code id="read_ipums_sf_+3A_encoding">encoding</code></td>
<td>
<p>Encoding to use when reading the shape file. If <code>NULL</code>,
defaults to <code>"latin1"</code> unless the file includes a .cpg metadata file
with encoding information. The default value should generally be
appropriate.</p>
</td></tr>
<tr><td><code id="read_ipums_sf_+3A_bind_multiple">bind_multiple</code></td>
<td>
<p>If <code>TRUE</code> and <code>shape_file</code> contains multiple .shp files,
row-bind the files into a single <code>sf</code> object. Useful when <code>shape_file</code>
contains multiple files that represent the same geographic units for
different extents (e.g. block-level data for multiple states).</p>
</td></tr>
<tr><td><code id="read_ipums_sf_+3A_add_layer_var">add_layer_var</code></td>
<td>
<p>If <code>TRUE</code>, add a variable to the output data indicating
the file that each row originates from. Defaults to <code>FALSE</code> unless
<code>bind_multiple = TRUE</code> and multiple files exist in <code>shape_file</code>.
</p>
<p>The column name will always be prefixed with <code>"layer"</code>, but will be
adjusted to avoid name conflicts if another column named <code>"layer"</code> already
exists in the data.</p>
</td></tr>
<tr><td><code id="read_ipums_sf_+3A_verbose">verbose</code></td>
<td>
<p>If <code>TRUE</code> report additional progress information on load.</p>
</td></tr>
<tr><td><code id="read_ipums_sf_+3A_shape_layer">shape_layer</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a> Please use
<code>file_select</code> instead.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Some IPUMS products provide shapefiles in a &quot;nested&quot; .zip archive. That is,
each shapefile (including a .shp as well as accompanying files) is
compressed in its own archive, and the collection of all
shapefiles provided in an extract is also compressed into a single .zip
archive.
</p>
<p><code>read_ipums_sf()</code> is designed to handle this structure. However, if any files
are altered such that an internal .zip archive contains <em>multiple</em>
shapefiles, this function will throw an error. If this is the case, you may
need to manually unzip the downloaded file before loading it into R.
</p>


<h3>Value</h3>

<p>An <a href="sf.html#topic+sf">sf</a> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+read_ipums_micro">read_ipums_micro()</a></code> or <code><a href="#topic+read_nhgis">read_nhgis()</a></code> to read tabular data from
an IPUMS extract.
</p>
<p><code><a href="#topic+ipums_list_files">ipums_list_files()</a></code> to list files in an IPUMS extract.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Example shapefile from NHGIS
shape_ex1 &lt;- ipums_example("nhgis0972_shape_small.zip")
data_ex1 &lt;- read_nhgis(ipums_example("nhgis0972_csv.zip"), verbose = FALSE)

sf_data &lt;- read_ipums_sf(shape_ex1)

sf_data

# To combine spatial data with tabular data without losing the attributes
# included in the tabular data, use an ipums shape join:
ipums_shape_full_join(data_ex1, sf_data, by = "GISJOIN")

shape_ex2 &lt;- ipums_example("nhgis0712_shape_small.zip")

# Shapefiles are provided in .zip archives that may contain multiple
# files. Select a single file with `file_select`:
read_ipums_sf(shape_ex2, file_select = matches("us_pmsa_1990"))

# Or row-bind files with `bind_multiple`. This may be useful for files of
# the same geographic level that cover different extents)
read_ipums_sf(
  shape_ex2,
  file_select = matches("us_pmsa"),
  bind_multiple = TRUE
)

</code></pre>

<hr>
<h2 id='read_nhgis'>Read tabular data from an NHGIS extract</h2><span id='topic+read_nhgis'></span>

<h3>Description</h3>

<p>Read a csv or fixed-width (.dat) file downloaded from the NHGIS extract
system.
</p>
<p>To read spatial data from an NHGIS extract, use <code><a href="#topic+read_ipums_sf">read_ipums_sf()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_nhgis(
  data_file,
  file_select = NULL,
  vars = NULL,
  col_types = NULL,
  n_max = Inf,
  guess_max = min(n_max, 1000),
  do_file = NULL,
  var_attrs = c("val_labels", "var_label", "var_desc"),
  remove_extra_header = TRUE,
  verbose = TRUE,
  data_layer = deprecated()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="read_nhgis_+3A_data_file">data_file</code></td>
<td>
<p>Path to a .zip archive containing an NHGIS extract or
a single file from an NHGIS extract.</p>
</td></tr>
<tr><td><code id="read_nhgis_+3A_file_select">file_select</code></td>
<td>
<p>If <code>data_file</code> is a .zip archive that
contains multiple files, an expression identifying the file to load.
Accepts a character vector specifying the
file name, a <a href="#topic+selection_language">tidyselect selection</a>, or an index
position. This must uniquely identify a file.</p>
</td></tr>
<tr><td><code id="read_nhgis_+3A_vars">vars</code></td>
<td>
<p>Names of variables to include in the output. Accepts a
vector of names or a <a href="#topic+selection_language">tidyselect selection</a>.
If <code>NULL</code>, includes all variables in the file.</p>
</td></tr>
<tr><td><code id="read_nhgis_+3A_col_types">col_types</code></td>
<td>
<p>One of <code>NULL</code>, a <code><a href="readr.html#topic+cols">cols()</a></code>
specification or a string. If <code>NULL</code>, all column types will be inferred
from the values in the first <code>guess_max</code> rows of each column.
Alternatively, you can use a compact string representation to specify
column types:
</p>

<ul>
<li><p> c = character
</p>
</li>
<li><p> i = integer
</p>
</li>
<li><p> n = number
</p>
</li>
<li><p> d = double
</p>
</li>
<li><p> l = logical
</p>
</li>
<li><p> f = factor
</p>
</li>
<li><p> D = date
</p>
</li>
<li><p> T = date time
</p>
</li>
<li><p> t = time
</p>
</li>
<li><p> ? = guess
</p>
</li>
<li><p> _ or - = skip
</p>
</li></ul>

<p>See <code><a href="readr.html#topic+read_delim">read_delim()</a></code> for more details.</p>
</td></tr>
<tr><td><code id="read_nhgis_+3A_n_max">n_max</code></td>
<td>
<p>Maximum number of lines to read.</p>
</td></tr>
<tr><td><code id="read_nhgis_+3A_guess_max">guess_max</code></td>
<td>
<p>For .csv files, maximum number of lines to use for guessing
column types. Will never use more than the number of lines read.</p>
</td></tr>
<tr><td><code id="read_nhgis_+3A_do_file">do_file</code></td>
<td>
<p>For fixed-width files, path to the .do file associated with
the provided <code>data_file</code>. The .do file contains the parsing instructions
for the data file.
</p>
<p>By default, looks in the same path as <code>data_file</code> for
a .do file with the same name. See Details section below.</p>
</td></tr>
<tr><td><code id="read_nhgis_+3A_var_attrs">var_attrs</code></td>
<td>
<p>Variable attributes to add from the codebook (.txt) file
included in the extract. Defaults to all available attributes.
</p>
<p>See <code><a href="#topic+set_ipums_var_attributes">set_ipums_var_attributes()</a></code> for more details.</p>
</td></tr>
<tr><td><code id="read_nhgis_+3A_remove_extra_header">remove_extra_header</code></td>
<td>
<p>If <code>TRUE</code>, remove the additional descriptive
header row included in some NHGIS .csv files.
</p>
<p>This header row is not
usually needed as it contains similar information to that
included in the <code>"label"</code> attribute of each data column (if <code>var_attrs</code>
includes <code>"var_label"</code>).</p>
</td></tr>
<tr><td><code id="read_nhgis_+3A_verbose">verbose</code></td>
<td>
<p>Logical controlling whether to display output when loading
data. If <code>TRUE</code>, displays IPUMS conditions, a progress bar, and
column types. Otherwise, all are suppressed.
</p>
<p>Will be overridden by <code>readr.show_progress</code> and <code>readr.show_col_types</code>
options, if they are set.</p>
</td></tr>
<tr><td><code id="read_nhgis_+3A_data_layer">data_layer</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a> Please
use <code>file_select</code> instead.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The .do file that is included when downloading an NHGIS fixed-width
extract contains the necessary metadata (e.g. column positions and implicit
decimals) to correctly parse the data file. <code>read_nhgis()</code> uses this
information to parse and recode the fixed-width data appropriately.
</p>
<p>If you no longer have access to the .do file, consider resubmitting the
extract that produced the data. You can also change the desired data
format to produce a .csv file, which does not require additional metadata
files to be loaded.
</p>
<p>For more about resubmitting an existing extract via the IPUMS API, see
<code>vignette("ipums-api", package = "ipumsr")</code>.
</p>


<h3>Value</h3>

<p>A <code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> containing the data found in
<code>data_file</code>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+read_ipums_sf">read_ipums_sf()</a></code> to read spatial data from an IPUMS extract.
</p>
<p><code><a href="#topic+read_nhgis_codebook">read_nhgis_codebook()</a></code> to read metadata about an IPUMS NHGIS extract.
</p>
<p><code><a href="#topic+ipums_list_files">ipums_list_files()</a></code> to list files in an IPUMS extract.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example files
csv_file &lt;- ipums_example("nhgis0972_csv.zip")
fw_file &lt;- ipums_example("nhgis0730_fixed.zip")

# Provide the .zip archive directly to load the data inside:
read_nhgis(csv_file)

# For extracts that contain multiple files, use `file_select` to specify
# a single file to load. This accepts a tidyselect expression:
read_nhgis(fw_file, file_select = matches("ds239"), verbose = FALSE)

# Or an index position:
read_nhgis(fw_file, file_select = 2, verbose = FALSE)

# For CSV files, column types are inferred from the data. You can
# manually specify column types with `col_types`. This may be useful for
# geographic codes, which should typically be interpreted as character values
read_nhgis(csv_file, col_types = list(MSA_CMSAA = "c"), verbose = FALSE)

# Fixed-width files are parsed with the correct column positions
# and column types automatically:
read_nhgis(fw_file, file_select = contains("ts"), verbose = FALSE)

# You can also read in a subset of the data file:
read_nhgis(
  csv_file,
  n_max = 15,
  vars = c(GISJOIN, YEAR, D6Z002),
  verbose = FALSE
)
</code></pre>

<hr>
<h2 id='read_nhgis_codebook'>Read metadata from an NHGIS codebook (.txt) file</h2><span id='topic+read_nhgis_codebook'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>
<p>Read the variable metadata contained in the .txt codebook file included with
NHGIS extracts into an <a href="#topic+ipums_ddi">ipums_ddi</a> object.
</p>
<p>Because NHGIS variable metadata do not
adhere to all the standards of microdata DDI files, some of the <code>ipums_ddi</code>
fields will not be populated.
</p>
<p>This function is marked as experimental while we determine whether
there may be a more robust way to standardize codebook and DDI reading across
IPUMS collections.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_nhgis_codebook(cb_file, file_select = NULL, raw = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="read_nhgis_codebook_+3A_cb_file">cb_file</code></td>
<td>
<p>Path to a .zip archive containing an NHGIS extract or to an
NHGIS codebook (.txt) file.</p>
</td></tr>
<tr><td><code id="read_nhgis_codebook_+3A_file_select">file_select</code></td>
<td>
<p>If <code>cb_file</code> is a .zip archive or directory that contains
multiple codebook files, an expression identifying the file to read.
Accepts a character string specifying the file name, a
<a href="#topic+selection_language">tidyselect selection</a>, or an index position of the
file. Ignored if <code>cb_file</code> is the path to a single codebook file.</p>
</td></tr>
<tr><td><code id="read_nhgis_codebook_+3A_raw">raw</code></td>
<td>
<p>If <code>TRUE</code>, return a character vector containing the lines
of <code>cb_file</code> rather than an <code>ipums_ddi</code> object. Defaults to
<code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>raw = FALSE</code>, an <code>ipums_ddi</code> object with information on the
variables contained in the data for the extract associated with the given
<code>cb_file</code>.
</p>
<p>If <code>raw = TRUE</code>, a character vector with one element for each
line of the given <code>cb_file</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+read_nhgis">read_nhgis()</a></code> to read tabular data from an IPUMS NHGIS extract.
</p>
<p><code><a href="#topic+read_ipums_sf">read_ipums_sf()</a></code> to read spatial data from an IPUMS extract.
</p>
<p><code><a href="#topic+ipums_list_files">ipums_list_files()</a></code> to list files in an IPUMS extract.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example file
nhgis_file &lt;- ipums_example("nhgis0972_csv.zip")

# Read codebook as an `ipums_ddi` object:
codebook &lt;- read_nhgis_codebook(nhgis_file)

# Variable-level metadata about the contents of the data file:
ipums_var_info(codebook)

ipums_var_label(codebook, "PMSA")

# If variable metadata have been lost from a data source, reattach from
# the corresponding `ipums_ddi` object:
nhgis_data &lt;- read_nhgis(nhgis_file, verbose = FALSE)

nhgis_data &lt;- zap_ipums_attributes(nhgis_data)
ipums_var_label(nhgis_data$PMSA)

nhgis_data &lt;- set_ipums_var_attributes(nhgis_data, codebook$var_info)
ipums_var_label(nhgis_data$PMSA)

# You can also load the codebook in raw format to display in the console
codebook_raw &lt;- read_nhgis_codebook(nhgis_file, raw = TRUE)

# Use `cat` for human-readable output
cat(codebook_raw[1:20], sep = "\n")
</code></pre>

<hr>
<h2 id='reexports'>Objects exported from other packages</h2><span id='topic+reexports'></span><span id='topic+as_factor'></span><span id='topic+zap_labels'></span><span id='topic+is.labelled'></span><span id='topic++25+3C-+25'></span><span id='topic+problems'></span><span id='topic+spec'></span><span id='topic+starts_with'></span><span id='topic+ends_with'></span><span id='topic+contains'></span><span id='topic+matches'></span><span id='topic+num_range'></span><span id='topic+one_of'></span><span id='topic+all_of'></span><span id='topic+any_of'></span><span id='topic+everything'></span><span id='topic+last_col'></span><span id='topic+deprecated'></span>

<h3>Description</h3>

<p>These objects are imported from other packages. Follow the links
below to see their documentation.
</p>

<dl>
<dt>haven</dt><dd><p><code><a href="haven.html#topic+as_factor">as_factor</a></code>, <code><a href="haven.html#topic+labelled">is.labelled</a></code>, <code><a href="haven.html#topic+zap_labels">zap_labels</a></code></p>
</dd>
<dt>lifecycle</dt><dd><p><code><a href="lifecycle.html#topic+deprecated">deprecated</a></code></p>
</dd>
<dt>readr</dt><dd><p><code><a href="readr.html#topic+problems">problems</a></code>, <code><a href="readr.html#topic+spec">spec</a></code></p>
</dd>
<dt>tidyselect</dt><dd><p><code><a href="tidyselect.html#topic+all_of">all_of</a></code>, <code><a href="tidyselect.html#topic+all_of">any_of</a></code>, <code><a href="tidyselect.html#topic+starts_with">contains</a></code>, <code><a href="tidyselect.html#topic+starts_with">ends_with</a></code>, <code><a href="tidyselect.html#topic+everything">everything</a></code>, <code><a href="tidyselect.html#topic+everything">last_col</a></code>, <code><a href="tidyselect.html#topic+starts_with">matches</a></code>, <code><a href="tidyselect.html#topic+starts_with">num_range</a></code>, <code><a href="tidyselect.html#topic+one_of">one_of</a></code>, <code><a href="tidyselect.html#topic+starts_with">starts_with</a></code></p>
</dd>
<dt>zeallot</dt><dd><p><code><a href="zeallot.html#topic+operator">%&lt;-%</a></code></p>
</dd>
</dl>

<hr>
<h2 id='remove_from_extract'>Remove values from an existing IPUMS extract definition</h2><span id='topic+remove_from_extract'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>
<p>Remove values for specific fields in an existing <code>ipums_extract</code>
object. This function is an S3 generic whose behavior will depend on the
subclass (i.e. collection) of the extract being modified.
</p>

<ul>
<li><p> To remove from an <strong>IPUMS Microdata</strong> extract definition, click
<a href="#topic+remove_from_extract.micro_extract">here</a>. This includes:
</p>

<ul>
<li><p> IPUMS USA
</p>
</li>
<li><p> IPUMS CPS
</p>
</li>
<li><p> IPUMS International
</p>
</li></ul>

</li>
<li><p> To remove from an <strong>IPUMS NHGIS</strong> extract definition, click
<a href="#topic+remove_from_extract.nhgis_extract">here</a>
</p>
</li></ul>

<p>This function is marked as experimental because it is typically not the best
option for maintaining reproducible extract definitions and may be retired
in the future. For reproducibility, users should strive to build extract
definitions with <code><a href="#topic+define_extract">define_extract_*()</a></code> functions.
</p>
<p>If you have a complicated extract definition to revise, but do not have
the original extract definition code that created it, we suggest that you
save the revised extract as a JSON file with <code><a href="#topic+save_extract_as_json">save_extract_as_json()</a></code>. This
will create a stable version of the extract definition that
can be used in the future as needed.
</p>
<p>To add new values to an extract, see <code><a href="#topic+add_to_extract">add_to_extract()</a></code>.
</p>
<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>remove_from_extract(extract, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="remove_from_extract_+3A_extract">extract</code></td>
<td>
<p>An <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> object.</p>
</td></tr>
<tr><td><code id="remove_from_extract_+3A_...">...</code></td>
<td>
<p>Additional arguments specifying the extract fields and values to
remove from the extract definition.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of the same class as <code>extract</code> containing the modified
extract definition
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_to_extract">add_to_extract()</a></code> to add values to an extract definition.
</p>
<p><code><a href="#topic+define_extract">define_extract_*()</a></code> to create a new extract definition
from scratch.
</p>
<p><code><a href="#topic+submit_extract">submit_extract()</a></code> to submit an extract request for processing.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Microdata extracts
usa_extract &lt;- define_extract_usa(
  description = "USA example",
  samples = c("us2013a", "us2014a"),
  variables = list(
    var_spec("AGE"),
    var_spec("SEX", case_selections = "2"),
    var_spec("YEAR")
  )
)

# Remove variables from an extract definition
remove_from_extract(
  usa_extract,
  samples = "us2014a",
  variables = c("AGE", "SEX")
)

# Remove detailed specifications for an existing variable
remove_from_extract(
  usa_extract,
  variables = var_spec("SEX", case_selections = "2")
)

# NHGIS extracts
nhgis_extract &lt;- define_extract_nhgis(
  datasets = ds_spec(
    "1990_STF1",
    data_tables = c("NP1", "NP2", "NP3"),
    geog_levels = "county"
  ),
  time_series_tables = tst_spec("A00", geog_levels = "county")
)

# Remove an existing dataset or time series table
remove_from_extract(nhgis_extract, datasets = "1990_STF1")

# Remove detailed specifications from an existing dataset or
# time series table
remove_from_extract(
  nhgis_extract,
  datasets = ds_spec("1990_STF1", data_tables = "NP1")
)
</code></pre>

<hr>
<h2 id='remove_from_extract.micro_extract'>Remove values from an existing extract definition for an IPUMS microdata
project</h2><span id='topic+remove_from_extract.micro_extract'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>
<p>Remove existing values from an IPUMS microdata extract definition. All
fields are optional, and if omitted, will be unchanged.
</p>
<p>This function is marked as experimental because it is typically not the best
option for maintaining reproducible extract definitions and may be retired
in the future. For reproducibility, users should strive to build extract
definitions with <code><a href="#topic+define_extract-micro">define_extract_*()</a></code> functions.
</p>
<p>If you have a complicated extract definition to revise, but do not have
the original extract definition code that created it, we suggest that you
save the revised extract as a JSON file with <code><a href="#topic+save_extract_as_json">save_extract_as_json()</a></code>. This
will create a stable version of the extract definition that
can be used in the future as needed.
</p>
<p>To add new values to an IPUMS microdata extract definition, see
<code><a href="#topic+add_to_extract.micro_extract">add_to_extract()</a></code>.
</p>
<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'micro_extract'
remove_from_extract(extract, samples = NULL, variables = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="remove_from_extract.micro_extract_+3A_extract">extract</code></td>
<td>
<p>An <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> object.</p>
</td></tr>
<tr><td><code id="remove_from_extract.micro_extract_+3A_samples">samples</code></td>
<td>
<p>Character vector of sample names to remove from the extract
definition.</p>
</td></tr>
<tr><td><code id="remove_from_extract.micro_extract_+3A_variables">variables</code></td>
<td>
<p>Names of the variables to remove from the extract
definition. All variable-specific fields for the indicated variables
will also be removed.</p>
</td></tr>
<tr><td><code id="remove_from_extract.micro_extract_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the supplied extract definition comes from
a previously submitted extract request, this function will reset the
definition to an unsubmitted state.
</p>
<p>To retain a variable while modifying its particular specifications, first
remove that variable, then add a new specification using <code>add_to_extract()</code>.
</p>


<h3>Value</h3>

<p>A modified <code>micro_extract</code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_to_extract.micro_extract">add_to_extract()</a></code> to add values
to an extract definition.
</p>
<p><code><a href="#topic+submit_extract">submit_extract()</a></code> and <code><a href="#topic+download_extract">download_extract()</a></code> to submit and process an
extract request.
</p>
<p><code><a href="#topic+define_extract-micro">define_extract_*()</a></code> to create a new extract
definition from scratch.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>usa_extract &lt;- define_extract_usa(
  description = "USA example",
  samples = c("us2013a", "us2014a"),
  variables = list(
    var_spec("AGE", data_quality_flags = TRUE),
    var_spec("SEX", case_selections = "1"),
    "RACE"
  )
)

# Providing names of samples or variables will remove them and
# all of their associated specifications from the extract:
remove_from_extract(
  usa_extract,
  samples = "us2014a",
  variables = c("AGE", "RACE")
)

# To remove detailed specifications from a variable, indicate the
# specifications to remove within `var_spec()`. The
# named variable will be retained in the extract, but modified by
# removing the indicated specifications.
remove_from_extract(
  usa_extract,
  variables = var_spec("SEX", case_selections = "1")
)

# To make multiple modifications, use a list of `var_spec()` objects.
remove_from_extract(
  usa_extract,
  variables = list(
    var_spec("SEX", case_selections = "1"),
    var_spec("AGE")
  )
)
</code></pre>

<hr>
<h2 id='remove_from_extract.nhgis_extract'>Remove values from an existing NHGIS extract definition</h2><span id='topic+remove_from_extract.nhgis_extract'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>
<p>Remove existing values from an IPUMS NHGIS extract definition. All
fields are optional, and if omitted, will be unchanged.
</p>
<p>This function is marked as experimental because it is typically not the best
option for maintaining reproducible extract definitions and may be retired
in the future. For reproducibility, users should strive to build extract
definitions with <code><a href="#topic+define_extract_nhgis">define_extract_nhgis()</a></code>.
</p>
<p>If you have a complicated extract definition to revise, but do not have
the original extract definition code that created it, we suggest that you
save the revised extract as a JSON file with <code><a href="#topic+save_extract_as_json">save_extract_as_json()</a></code>. This
will create a stable version of the extract definition that
can be used in the future as needed.
</p>
<p>To add new values to an IPUMS NHGIS extract definition, use
<code><a href="#topic+add_to_extract.nhgis_extract">add_to_extract()</a></code>.
</p>
<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'nhgis_extract'
remove_from_extract(
  extract,
  datasets = NULL,
  time_series_tables = NULL,
  geographic_extents = NULL,
  shapefiles = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="remove_from_extract.nhgis_extract_+3A_extract">extract</code></td>
<td>
<p>An <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> object.</p>
</td></tr>
<tr><td><code id="remove_from_extract.nhgis_extract_+3A_datasets">datasets</code></td>
<td>
<p>Dataset specifications to remove from the extract definition.
All <code>data_tables</code>, <code>geog_levels</code>,
<code>years</code>, and <code>breakdown_values</code> associated with the specified
<code>datasets</code> will also be removed.</p>
</td></tr>
<tr><td><code id="remove_from_extract.nhgis_extract_+3A_time_series_tables">time_series_tables</code></td>
<td>
<p>Names of the time series tables
to remove from the extract definition. All <code>geog_levels</code> and <code>years</code>
associated  with the specified <code>time_series_tables</code> will also be removed.</p>
</td></tr>
<tr><td><code id="remove_from_extract.nhgis_extract_+3A_geographic_extents">geographic_extents</code></td>
<td>
<p>Geographic extents to remove from the extract
definition.</p>
</td></tr>
<tr><td><code id="remove_from_extract.nhgis_extract_+3A_shapefiles">shapefiles</code></td>
<td>
<p>Shapefiles to remove from the extract definition.</p>
</td></tr>
<tr><td><code id="remove_from_extract.nhgis_extract_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Any extract fields that are rendered irrelevant after modifying the extract
will be automatically removed. (For instance, if all <code>time_series_tables</code>
are removed from an extract, <code>tst_layout</code> will also be
removed.) Thus, it is not necessary to explicitly remove these values.
</p>
<p>If the supplied extract definition comes from
a previously submitted extract request, this function will reset the
definition to an unsubmitted state.
</p>


<h3>Value</h3>

<p>A modified <code>nhgis_extract</code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_to_extract.nhgis_extract">add_to_extract()</a></code> to add values
to an extract definition.
</p>
<p><code><a href="#topic+submit_extract">submit_extract()</a></code> and <code><a href="#topic+download_extract">download_extract()</a></code> to submit and process an
extract request.
</p>
<p><code><a href="#topic+define_extract_nhgis">define_extract_nhgis()</a></code> to create a new extract definition.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>extract &lt;- define_extract_nhgis(
  datasets = ds_spec(
    "1990_STF1",
    data_tables = c("NP1", "NP2", "NP3"),
    geog_levels = "county"
  ),
  time_series_tables = list(
    tst_spec("CW3", c("state", "county")),
    tst_spec("CW5", c("state", "county"))
  )
)

# Providing names of datasets or time series tables will remove them and
# all of their associated specifications from the extract:
remove_from_extract(
  extract,
  time_series_tables = c("CW3", "CW5")
)

# To remove detailed specifications from a dataset or time series table,
# use `ds_spec()` or `tst_spec()`. The named dataset or time series table
# will be retained in the extract, but modified by removing the indicated
# specifications:
remove_from_extract(
  extract,
  datasets = ds_spec("1990_STF1", data_tables = c("NP2", "NP3"))
)

# To make multiple modifications, use a list of `ds_spec()` or `tst_spec()`
# objects:
remove_from_extract(
  extract,
  time_series_tables = list(
    tst_spec("CW3", geog_levels = "county"),
    tst_spec("CW5", geog_levels = "state")
  )
)
</code></pre>

<hr>
<h2 id='save_extract_as_json'>Store an extract definition in JSON format</h2><span id='topic+save_extract_as_json'></span><span id='topic+define_extract_from_json'></span>

<h3>Description</h3>

<p>Read and write an <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> object to a JSON
file that contains the extract definition specifications.
</p>
<p>Use these functions to store a copy of an extract definition outside of your
R environment and/or share an extract definition with another registered
IPUMS user.
</p>
<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>save_extract_as_json(extract, file, overwrite = FALSE)

define_extract_from_json(extract_json)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="save_extract_as_json_+3A_extract">extract</code></td>
<td>
<p>An <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> object.</p>
</td></tr>
<tr><td><code id="save_extract_as_json_+3A_file">file</code></td>
<td>
<p>File path to which to write the JSON-formatted extract
definition.</p>
</td></tr>
<tr><td><code id="save_extract_as_json_+3A_overwrite">overwrite</code></td>
<td>
<p>If <code>TRUE</code>, overwrite <code>file</code> if it already exists.
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="save_extract_as_json_+3A_extract_json">extract_json</code></td>
<td>
<p>Path to a file containing a JSON-formatted
extract definition.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> object.
</p>


<h3>API Version Compatibility</h3>

<p>As of v0.6.0, ipumsr only supports IPUMS API version 2. If you have stored
an extract definition made using version beta or version 1 of the IPUMS
API, you will not be able to load it using <code>define_extract_from_json()</code>. The
API version for the request should be stored in the saved JSON file. (If
there is no <code>"api_version"</code> or <code>"version"</code> field in the JSON file, the
request was likely made under version beta or version 1.)
</p>
<p>If the extract definition was originally made under your user account and
you know its corresponding extract number, use <code><a href="#topic+get_extract_info">get_extract_info()</a></code> to obtain
a definition compliant with IPUMS API version 2. You can then save this
definition to JSON with <code>save_extract_as_json()</code>.
</p>
<p>Otherwise, you will need to update the JSON file to be compliant with
IPUMS API version 2. In general, this should only require renaming
all JSON fields written in <code>snake_case</code> to <code>camelCase</code>. For instance,
<code>"data_tables"</code> would become <code>"dataTables"</code>, <code>"data_format"</code> would become
<code>"dataFormat"</code>, and so on. You will also need to change the <code>"api_version"</code>
field to <code>"version"</code> and set it equal to <code>2</code>. If you are unable to create
a valid extract by modifying the file, you may have to recreate the
definition manually using the appropriate
<code><a href="#topic+define_extract">define_extract_*()</a></code> function.
</p>
<p>See the IPUMS developer documentation for more details on
<a href="https://developer.ipums.org/docs/apiprogram/versioning/">API versioning</a> and
<a href="https://developer.ipums.org/docs/apiprogram/changelog/">breaking changes</a>
introduced in version 2.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+define_extract">define_extract_*()</a></code> to define an extract request manually.
</p>
<p><code><a href="#topic+get_extract_info">get_extract_info()</a></code> to obtain a past extract to save.
</p>
<p><code><a href="#topic+submit_extract">submit_extract()</a></code> to submit an extract request for processing.
</p>
<p><code><a href="#topic+add_to_extract">add_to_extract()</a></code> and <code><a href="#topic+remove_from_extract">remove_from_extract()</a></code> to
revise an extract definition.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>my_extract &lt;- define_extract_usa(
  description = "2013-2014 ACS Data",
  samples = c("us2013a", "us2014a"),
  variables = c("SEX", "AGE", "YEAR")
)

extract_json_path &lt;- file.path(tempdir(), "usa_extract.json")
save_extract_as_json(my_extract, file = extract_json_path)

copy_of_my_extract &lt;- define_extract_from_json(extract_json_path)

identical(my_extract, copy_of_my_extract)

file.remove(extract_json_path)
</code></pre>

<hr>
<h2 id='selection_language'>tidyselect selection language in ipumsr</h2><span id='topic+selection_language'></span>

<h3>Description</h3>

<p>Slightly modified implementation of tidyselect
<a href="tidyselect.html#topic+language">selection language</a> in ipumsr.
</p>


<h4>Syntax</h4>

<p>In general, the selection language in ipumsr operates the same as in
tidyselect.
</p>
<p>Where applicable, variables can be selected with:
</p>

<ul>
<li><p> A character vector of variable names (<code>c("var1", "var2")</code>)
</p>
</li>
<li><p> A bare vector of variable names (<code>c(var1, var2)</code>)
</p>
</li>
<li><p> A selection helper from tidyselect (<code>starts_with("var")</code>). See below for
a list of helpers.
</p>
</li></ul>




<h4>Primary differences</h4>


<ul>
<li><p> tidyselect selection is generally intended for use with column variables
in data.frame-like objects. In contrast, ipumsr allows selection language
syntax in other cases as well (for instance, when selecting files
from within a .zip archive). ipumsr functions will indicate whether they
support the selection language.
</p>
</li>
<li><p> Selection with <code><a href="tidyselect.html#topic+where">where()</a></code> is not consistently
supported.
</p>
</li></ul>




<h4>Selection helpers (from tidyselect)</h4>


<ul>
<li> <p><code>var1</code>:<code>var10</code>: variables lying between <code>var1</code> on the left and <code>var10</code>
on the right.
</p>
</li>
<li> <p><code>starts_with("a")</code>: names that start with <code>"a"</code>
</p>
</li>
<li> <p><code>ends_with("z")</code>: names that end with <code>"z"</code>
</p>
</li>
<li> <p><code>contains("b")</code>: names that contain <code>"b"</code>
</p>
</li>
<li> <p><code>matches("x.y")</code>: names that match regular expression <code>x.y</code>
</p>
</li>
<li> <p><code>num_range(x, 1:4)</code>: names following the pattern <code style="white-space: pre;">&#8288;x1, x2, ..., x4&#8288;</code>
</p>
</li>
<li> <p><code>all_of(vars)</code>/<code>any_of(vars)</code>: matches names stored in the character vector
<code>vars</code>. <code>all_of(vars)</code> will error if the variables aren't present;
<code>any_of(vars)</code> will match just the variables that exist.
</p>
</li>
<li> <p><code>everything()</code>: all variables
</p>
</li>
<li> <p><code>last_col()</code>: furthest column to the right
</p>
</li></ul>

<p>Operators for combining those selections:
</p>

<ul>
<li> <p><code>!selection</code>: only variables that don't match <code>selection</code>
</p>
</li>
<li> <p><code>selection1 &amp; selection2</code>: only variables included in both <code>selection1</code>
and <code>selection2</code>
</p>
</li>
<li> <p><code>selection1 | selection2</code>: all variables that match either <code>selection1</code> or
<code>selection2</code>
</p>
</li></ul>




<h3>Examples</h3>

<pre><code class='language-R'>cps_file &lt;- ipums_example("cps_00157.xml")

# Load 3 variables by name
read_ipums_micro(
  cps_file,
  vars = c("YEAR", "MONTH", "PERNUM"),
  verbose = FALSE
)

# "Bare" variables are supported
read_ipums_micro(
  cps_file,
  vars = c(YEAR, MONTH, PERNUM),
  verbose = FALSE
)

# Standard tidyselect selectors are also supported
read_ipums_micro(cps_file, vars = starts_with("ASEC"), verbose = FALSE)

# Selection methods can be combined
read_ipums_micro(
  cps_file,
  vars = c(YEAR, MONTH, contains("INC")),
  verbose = FALSE
)

read_ipums_micro(
  cps_file,
  vars = starts_with("S") &amp; ends_with("P"),
  verbose = FALSE
)

# Other selection arguments also support this syntax.
# For instance, load a particular file based on a tidyselect match:
read_nhgis(
  ipums_example("nhgis0731_csv.zip"),
  file_select = contains("nominal_state"),
  verbose = FALSE
)
</code></pre>

<hr>
<h2 id='set_ipums_api_key'>Set your IPUMS API key</h2><span id='topic+set_ipums_api_key'></span>

<h3>Description</h3>

<p>Set your IPUMS API key as the value associated with the <code>IPUMS_API_KEY</code>
environment variable.
</p>
<p>The key can be stored for the duration of your session or for future
sessions. If saved for future sessions, it is added to the <code>.Renviron</code>
file in your home directory. If you choose to save your key to <code>.Renviron</code>,
this function will create a backup copy of the file before modifying.
</p>
<p>This function is modeled after the <code>census_api_key()</code> function
from <a href="https://walker-data.com/tidycensus/">tidycensus</a>.
</p>
<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_ipums_api_key(api_key, save = overwrite, overwrite = FALSE, unset = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_ipums_api_key_+3A_api_key">api_key</code></td>
<td>
<p>API key associated with your user account.</p>
</td></tr>
<tr><td><code id="set_ipums_api_key_+3A_save">save</code></td>
<td>
<p>If <code>TRUE</code>, save the key for use in future
sessions by adding it to the <code>.Renviron</code> file in your home directory.
Defaults to <code>FALSE</code>, unless <code>overwrite = TRUE</code>.</p>
</td></tr>
<tr><td><code id="set_ipums_api_key_+3A_overwrite">overwrite</code></td>
<td>
<p>If <code>TRUE</code>, overwrite any existing value of
<code>IPUMS_API_KEY</code> in the <code>.Renviron</code> file with the provided <code>api_key</code>.
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="set_ipums_api_key_+3A_unset">unset</code></td>
<td>
<p>If <code>TRUE</code>, remove the existing value of <code>IPUMS_API_KEY</code>
from the environment and the <code>.Renviron</code> file in your home directory.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The value of <code>api_key</code>, invisibly.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+set_ipums_default_collection">set_ipums_default_collection()</a></code> to set a default collection.
</p>

<hr>
<h2 id='set_ipums_default_collection'>Set your default IPUMS collection</h2><span id='topic+set_ipums_default_collection'></span>

<h3>Description</h3>

<p>Set the default IPUMS collection as the value associated with the
<code>IPUMS_DEFAULT_COLLECTION</code> environment variable. If this environment variable
exists, IPUMS API functions that require a collection specification will use
the value of <code>IPUMS_DEFAULT_COLLECTION</code>, unless another collection is
indicated.
</p>
<p>The default collection can be stored for the duration of your session or
for future sessions. If saved for future sessions, it is added to the
<code>.Renviron</code> file in your home directory. If you choose to save your key
to <code>.Renviron</code>, this function will create a backup copy of the file before
modifying.
</p>
<p>This function is modeled after the <code>census_api_key()</code> function
from <a href="https://walker-data.com/tidycensus/">tidycensus</a>.
</p>
<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_ipums_default_collection(
  collection = NULL,
  save = overwrite,
  overwrite = FALSE,
  unset = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_ipums_default_collection_+3A_collection">collection</code></td>
<td>
<p>Character string of the collection to set as your
default collection. The collection must currently be supported
by the IPUMS API.
</p>
<p>For a list of codes used to refer to each collection, see
<code><a href="#topic+ipums_data_collections">ipums_data_collections()</a></code>.</p>
</td></tr>
<tr><td><code id="set_ipums_default_collection_+3A_save">save</code></td>
<td>
<p>If <code>TRUE</code>, save the default collection for use in future
sessions by adding it to the <code>.Renviron</code> file in your home directory.
Defaults to <code>FALSE</code>, unless <code>overwrite = TRUE</code>.</p>
</td></tr>
<tr><td><code id="set_ipums_default_collection_+3A_overwrite">overwrite</code></td>
<td>
<p>If <code>TRUE</code>, overwrite any existing value of
<code>IPUMS_DEFAULT_COLLECTION</code> in the <code>.Renviron</code> file with the provided
<code>collection</code>. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="set_ipums_default_collection_+3A_unset">unset</code></td>
<td>
<p>if <code>TRUE</code>, remove the existing value of
<code>IPUMS_DEFAULT_COLLECTION</code> from the environment and the <code>.Renviron</code> file in
your home directory.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The value of <code>collection</code>, invisibly.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+set_ipums_api_key">set_ipums_api_key()</a></code> to set an API key.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set_ipums_default_collection("nhgis")

## Not run: 
# Extract info will now be retrieved for the default collection:
get_last_extract_info()
get_extract_history()

is_extract_ready(1)
get_extract_info(1)

# Equivalent to:
get_extract_info("nhgis:1")
get_extract_info(c("nhgis", 1))

# Other collections can be specified explicitly
# Doing so does not alter the default collection
is_extract_ready("usa:2")

## End(Not run)

# Remove the variable from the environment and .Renviron, if saved
set_ipums_default_collection(unset = TRUE)
</code></pre>

<hr>
<h2 id='set_ipums_var_attributes'>Add IPUMS variable attributes to a data frame</h2><span id='topic+set_ipums_var_attributes'></span>

<h3>Description</h3>

<p>Add variable attributes from an <a href="#topic+ipums_ddi">ipums_ddi</a> object to a data frame.
These provide contextual information about the variables
and values contained in the data columns.
</p>
<p>Most ipumsr data-reading functions automatically add these attributes.
However, some data processing operations may remove attributes, or you
may wish to store data in an external database that does not support
these attributes. In these cases, use this function to manually attach
this information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_ipums_var_attributes(
  data,
  var_info,
  var_attrs = c("val_labels", "var_label", "var_desc")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_ipums_var_attributes_+3A_data">data</code></td>
<td>
<p><code><a href="tibble.html#topic+tbl_df-class">tibble</a></code> or data frame</p>
</td></tr>
<tr><td><code id="set_ipums_var_attributes_+3A_var_info">var_info</code></td>
<td>
<p>An <a href="#topic+ipums_ddi">ipums_ddi</a> object or a data frame containing
variable information. Variable information can be obtained by calling
<code>ipums_var_info()</code> on an <code>ipums_ddi</code> object.</p>
</td></tr>
<tr><td><code id="set_ipums_var_attributes_+3A_var_attrs">var_attrs</code></td>
<td>
<p>Variable attributes from the DDI to add to the columns of
the output data. Defaults to all available attributes.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Attribute <code>val_labels</code> adds the <code><a href="haven.html#topic+labelled">haven_labelled</a></code> class
and the corresponding value labels for applicable variables. For more
about the <code>haven_labelled</code> class, see
<code>vignette("semantics", package = "haven")</code>.
</p>
<p>Attribute <code>var_label</code> adds a short summary of the variable's
contents to the <code>"label"</code> attribute. This label is viewable in the
RStudio Viewer.
</p>
<p>Attribute <code>var_desc</code> adds a longer description of the variable's
contents to the <code>"var_desc"</code> attribute, when available.
</p>
<p>Variable information is attached to the data by column name. If column
names in <code>data</code> do not match those found in <code>var_info</code>, attributes
will not be added.
</p>


<h3>Value</h3>

<p><code>data</code>, with variable attributes attached
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ddi_file &lt;- ipums_example("cps_00157.xml")

# Load metadata into `ipums_ddi` object
ddi &lt;- read_ipums_ddi(ddi_file)

# Load data
cps &lt;- read_ipums_micro(ddi)

# Data includes variable metadata:
ipums_var_desc(cps$INCTOT)

# Some operations remove attributes, even if they do not alter the data:
cps$INCTOT &lt;- ifelse(TRUE, cps$INCTOT, NA)
ipums_var_desc(cps$INCTOT)

# We can reattach metadata from the separate `ipums_ddi` object:
cps &lt;- set_ipums_var_attributes(cps, ddi)
ipums_var_desc(cps$INCTOT)
</code></pre>

<hr>
<h2 id='submit_extract'>Submit an extract request via the IPUMS API</h2><span id='topic+submit_extract'></span>

<h3>Description</h3>

<p>Submit an extract request via the IPUMS API and return an <a href="#topic+ipums_extract">ipums_extract</a>
object containing the extract definition with a newly-assigned extract
request number.
</p>
<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>submit_extract(extract, api_key = Sys.getenv("IPUMS_API_KEY"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="submit_extract_+3A_extract">extract</code></td>
<td>
<p>An <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> object.</p>
</td></tr>
<tr><td><code id="submit_extract_+3A_api_key">api_key</code></td>
<td>
<p>API key associated with your user account. Defaults to the
value of the <code>IPUMS_API_KEY</code> environment variable. See
<code><a href="#topic+set_ipums_api_key">set_ipums_api_key()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> object containing the
extract definition and newly-assigned extract number of the submitted
extract.
</p>
<p>Note that some unspecified extract fields may be populated with default
values and therefore change slightly upon submission.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+wait_for_extract">wait_for_extract()</a></code> to wait for an extract to finish processing.
</p>
<p><code><a href="#topic+get_extract_info">get_extract_info()</a></code> and <code><a href="#topic+is_extract_ready">is_extract_ready()</a></code> to check the status of an
extract request.
</p>
<p><code><a href="#topic+download_extract">download_extract()</a></code> to download an extract's data files.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>my_extract &lt;- define_extract_cps(
  description = "2018-2019 CPS Data",
  samples = c("cps2018_05s", "cps2019_05s"),
  variables = c("SEX", "AGE", "YEAR")
)

## Not run: 
# Store your submitted extract request to obtain the extract number
submitted_extract &lt;- submit_extract(my_extract)

submitted_extract$number

# This is useful for checking the extract request status
get_extract_info(submitted_extract)

# You can always get the latest status, even if you forget to store the
# submitted extract request object
submitted_extract &lt;- get_last_extract_info("cps")

# You can also check if submitted extract is ready
is_extract_ready(submitted_extract)

# Or have R check periodically and download when ready
downloadable_extract &lt;- wait_for_extract(submitted_extract)

## End(Not run)
</code></pre>

<hr>
<h2 id='var_spec'>Create variable and sample specifications for IPUMS microdata extract
requests</h2><span id='topic+var_spec'></span><span id='topic+samp_spec'></span>

<h3>Description</h3>

<p>Provide specifications for individual variables when defining an
IPUMS microdata extract request.
</p>
<p>Currently, no additional specifications are available for IPUMS samples.
</p>
<p>Learn more about microdata extract definitions in
<code>vignette("ipums-api-micro")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>var_spec(
  name,
  case_selections = NULL,
  case_selection_type = NULL,
  attached_characteristics = NULL,
  data_quality_flags = NULL,
  preselected = NULL
)

samp_spec(name)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="var_spec_+3A_name">name</code></td>
<td>
<p>Name of the sample or variable.</p>
</td></tr>
<tr><td><code id="var_spec_+3A_case_selections">case_selections</code></td>
<td>
<p>A character vector of values of the given variable
that should be used to select cases. Values should be specified exactly as
they appear in the &quot;CODES&quot; tab for the given variable in the web-based
extract builder, including zero-padding (e.g. see the &quot;CODES&quot; tab for IPUMS
CPS variable
<a href="https://cps.ipums.org/cps-action/variables/EDUC#codes_section">EDUC</a>).</p>
</td></tr>
<tr><td><code id="var_spec_+3A_case_selection_type">case_selection_type</code></td>
<td>
<p>One of <code>"general"</code> or <code>"detailed"</code> indicating
whether the values in <code>case_selections</code> should be matched against the
general or detailed codes for the given variable. Only some variables have
detailed codes. See IPUMS USA variable
<a href="https://usa.ipums.org/usa-action/variables/RACE#codes_section">RACE</a> for
an example of a variable with general and detailed codes.
</p>
<p>Defaults to <code>"general"</code> if any <code>case_selections</code> are specified.</p>
</td></tr>
<tr><td><code id="var_spec_+3A_attached_characteristics">attached_characteristics</code></td>
<td>
<p>Whose characteristics should be attached, if
any? Accepted values are <code>"mother"</code>, <code>"father"</code>, <code>"spouse"</code>, <code>"head"</code>,
or a combination. Specifying attached characteristics will add variables to
your extract that contain the values for the given variable for the
specified household members (e.g. variable &quot;AGE_MOM&quot; will be added if
<code>"mother"</code> is specified for the variable <code>"AGE"</code>).</p>
</td></tr>
<tr><td><code id="var_spec_+3A_data_quality_flags">data_quality_flags</code></td>
<td>
<p>Logical indicating whether to include data quality
flags for the given variable. By default, data quality flags are not
included.</p>
</td></tr>
<tr><td><code id="var_spec_+3A_preselected">preselected</code></td>
<td>
<p>Logical indicating whether the variable is preselected.
This is not needed for external use.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>var_spec</code> or <code>samp_spec</code> object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>var1 &lt;- var_spec(
  "SCHOOL",
  case_selections = c("1", "2"),
  data_quality_flags = TRUE
)

var2 &lt;- var_spec(
  "RACE",
  case_selections = c("140", "150"),
  case_selection_type = "detailed",
  attached_characteristics = c("mother", "spouse")
)

# Use variable specifications in a microdata extract definition:
extract &lt;- define_extract_usa(
  description = "Example extract",
  samples = "us2017b",
  variables = list(var1, var2)
)

extract$variables$SCHOOL

extract$variables$RACE
</code></pre>

<hr>
<h2 id='wait_for_extract'>Wait for an extract request to finish processing</h2><span id='topic+wait_for_extract'></span><span id='topic+is_extract_ready'></span>

<h3>Description</h3>

<p>Wait for an extract request to finish by periodically checking its status
via the IPUMS API until it is complete.
</p>
<p><code>is_extract_ready()</code> is a convenience function to check if an extract
is ready to download without committing your R session to waiting for
extract completion.
</p>
<p>Learn more about the IPUMS API in <code>vignette("ipums-api")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wait_for_extract(
  extract,
  initial_delay_seconds = 0,
  max_delay_seconds = 300,
  timeout_seconds = 10800,
  verbose = TRUE,
  api_key = Sys.getenv("IPUMS_API_KEY")
)

is_extract_ready(extract, api_key = Sys.getenv("IPUMS_API_KEY"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="wait_for_extract_+3A_extract">extract</code></td>
<td>
<p>One of:
</p>

<ul>
<li><p> An <code><a href="#topic+ipums_extract-class">ipums_extract</a></code> object
</p>
</li>
<li><p> The data collection and extract number formatted as a string of the
form <code>"collection:number"</code> or as a vector of the form
<code>c("collection", number)</code>
</p>
</li>
<li><p> An extract number to be associated with your default IPUMS
collection. See <code><a href="#topic+set_ipums_default_collection">set_ipums_default_collection()</a></code>
</p>
</li></ul>

<p>For a list of codes used to refer to each collection, see
<code><a href="#topic+ipums_data_collections">ipums_data_collections()</a></code>.</p>
</td></tr>
<tr><td><code id="wait_for_extract_+3A_initial_delay_seconds">initial_delay_seconds</code></td>
<td>
<p>Seconds to wait before first status check. The
wait time will automatically increase by 10 seconds between each
successive check.</p>
</td></tr>
<tr><td><code id="wait_for_extract_+3A_max_delay_seconds">max_delay_seconds</code></td>
<td>
<p>Maximum interval to wait between status checks.
When the wait interval reaches this value, checks will continue to
occur at <code>max_delay_seconds</code> intervals until the extract is complete or
<code>timeout_seconds</code> is reached. Defaults to 300 seconds (5 minutes).</p>
</td></tr>
<tr><td><code id="wait_for_extract_+3A_timeout_seconds">timeout_seconds</code></td>
<td>
<p>Maximum total number of seconds to continue waiting
for the extract before throwing an error. Defaults to 10,800 seconds (3
hours).</p>
</td></tr>
<tr><td><code id="wait_for_extract_+3A_verbose">verbose</code></td>
<td>
<p>If <code>TRUE</code>, print status updates to the R console at the
beginning of each wait interval and upon extract completion.
Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="wait_for_extract_+3A_api_key">api_key</code></td>
<td>
<p>API key associated with your user account. Defaults to the
value of the <code>IPUMS_API_KEY</code> environment variable. See
<code><a href="#topic+set_ipums_api_key">set_ipums_api_key()</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>status</code> of a submitted extract will be one of <code>"queued"</code>, <code>"started"</code>,
<code>"produced"</code>, <code>"canceled"</code>, <code>"failed"</code>, or <code>"completed"</code>.
</p>
<p>To be ready to download, an extract must have a <code>"completed"</code> status.
However, some requests that are <code>"completed"</code> may still be unavailable for
download, as extracts expire and are removed from IPUMS servers after a set
period of time (72 hours for microdata collections, 2 weeks for IPUMS NHGIS).
</p>
<p>Therefore, these functions also check the <code>download_links</code> field of the
extract request to determine if data are available for download. If an
extract has expired (that is, it has completed but its download links are
no longer available), these functions will warn that the extract request
must be resubmitted.
</p>


<h3>Value</h3>

<p>For <code>wait_for_extract()</code>, an
<code><a href="#topic+ipums_extract-class">ipums_extract</a></code> object containing the extract
definition and the URLs from which to download extract files.
</p>
<p>For <code>is_extract_ready()</code>, a logical value indicating
whether the extract is ready to download.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+download_extract">download_extract()</a></code> to download an extract's data files.
</p>
<p><code><a href="#topic+get_extract_info">get_extract_info()</a></code> to obtain the definition of a submitted extract request.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>my_extract &lt;- define_extract_ipumsi(
  description = "Botswana data",
  samples = c("bw2001a", "bw2011a"),
  variables = c("SEX", "AGE", "YEAR")
)

## Not run: 
submitted_extract &lt;- submit_extract(my_extract)

# Wait for a particular extract request to complete by providing its
# associated `ipums_extract` object:
downloadable_extract &lt;- wait_for_extract(submitted_extract)

# Or by specifying the collection and number for the extract request:
downloadable_extract &lt;- wait_for_extract("ipumsi:1")

# If you have a default collection, you can use the extract number alone:
set_ipums_default_collection("ipumsi")

downloadable_extract &lt;- wait_for_extract(1)

# Use `download_extract()` to download the completed extract:
files &lt;- download_extract(downloadable_extract)

# Use `is_extract_ready()` if you don't want to tie up your R session by
# waiting for completion
is_extract_ready("usa:1")

## End(Not run)
</code></pre>

<hr>
<h2 id='zap_ipums_attributes'>Remove label attributes from a data frame or labelled vector</h2><span id='topic+zap_ipums_attributes'></span>

<h3>Description</h3>

<p>Remove all label attributes (value labels, variable labels, and variable
descriptions) from a data frame or vector.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>zap_ipums_attributes(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="zap_ipums_attributes_+3A_x">x</code></td>
<td>
<p>A data frame or <a href="haven.html#topic+labelled">labelled</a> vector
(for instance, from a data frame column)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of the same type as <code>x</code> without <code>"val_labels"</code>,
<code style="white-space: pre;">&#8288;"var_label&#8288;</code>&quot;, and <code>"var_desc"</code> attributes.
</p>


<h3>See Also</h3>

<p>Other lbl_helpers: 
<code><a href="#topic+lbl_add">lbl_add</a>()</code>,
<code><a href="#topic+lbl_clean">lbl_clean</a>()</code>,
<code><a href="#topic+lbl_define">lbl_define</a>()</code>,
<code><a href="#topic+lbl_na_if">lbl_na_if</a>()</code>,
<code><a href="#topic+lbl_relabel">lbl_relabel</a>()</code>,
<code><a href="#topic+lbl">lbl</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cps &lt;- read_ipums_micro(ipums_example("cps_00157.xml"))

attributes(cps$YEAR)
attributes(zap_ipums_attributes(cps$YEAR))

cps &lt;- zap_ipums_attributes(cps)
attributes(cps$YEAR)
attributes(cps$INCTOT)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
