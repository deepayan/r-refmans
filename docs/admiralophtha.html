<!DOCTYPE html><html><head><title>Help for package admiralophtha</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {admiralophtha}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#admiralophtha-package'><p>admiralophtha: ADaM in R Asset Library - Ophthalmology</p></a></li>
<li><a href='#admiralophtha_adbcva'><p>Best Corrected Visual Acuity Analysis Dataset</p></a></li>
<li><a href='#admiralophtha_adoe'><p>Ophthalmology Exam Analysis Dataset</p></a></li>
<li><a href='#admiralophtha_advfq'><p>Visual Function Questionnaire Analysis Dataset</p></a></li>
<li><a href='#convert_etdrs_to_logmar'><p>ETDRS &ndash;&gt; LogMAR conversion</p></a></li>
<li><a href='#convert_logmar_to_etdrs'><p>LogMAR &ndash;&gt; ETDRS conversion</p></a></li>
<li><a href='#derive_var_afeye'><p>Derive Affected Eye</p></a></li>
<li><a href='#derive_var_bcvacritxfl'><p>Adds <code>CRITx</code>/<code>CRITxFL</code> pairs to BCVA dataset</p></a></li>
<li><a href='#derive_var_bcvacritxfl_util'><p>Add <code>CRITx</code>/<code>CRITxFL</code> pair to BCVA dataset</p></a></li>
<li><a href='#derive_var_studyeye'><p>Derive Study Eye</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>ADaM in R Asset Library - Ophthalmology</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Aids the programming of Clinical Data Standards Interchange
    Consortium (CDISC) compliant Ophthalmology Analysis Data Model (ADaM)
    datasets in R. ADaM datasets are a mandatory part of any New Drug or
    Biologics License Application submitted to the United States Food and
    Drug Administration (FDA). Analysis derivations are implemented in
    accordance with the "Analysis Data Model Implementation Guide" (CDISC
    Analysis Data Model Team, 2021,
    <a href="https://www.cdisc.org/standards/foundational/adam/adamig-v1-3-release-package">https://www.cdisc.org/standards/foundational/adam/adamig-v1-3-release-package</a>).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License (&ge; 2)</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://pharmaverse.github.io/admiralophtha/">https://pharmaverse.github.io/admiralophtha/</a>,
<a href="https://github.com/pharmaverse/admiralophtha/">https://github.com/pharmaverse/admiralophtha/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/pharmaverse/admiralophtha/issues/">https://github.com/pharmaverse/admiralophtha/issues/</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>admiral (&ge; 1.1.1), admiraldev (&ge; 1.1.0), dplyr (&ge; 1.0.5),
lubridate (&ge; 1.7.4), magrittr (&ge; 1.5), purrr (&ge; 0.3.3),
rlang (&ge; 0.4.4), stringr (&ge; 1.4.0), hms (&ge; 0.5.3), tidyr (&ge;
1.0.2), tidyselect (&ge; 1.1.0), lifecycle (&ge; 0.1.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>pharmaversesdtm (&ge; 1.0.0), devtools, diffdf, lintr, pkgdown,
testthat (&ge; 3.0.0), knitr, lintr, methods, miniUI,
pharmaversesdtm, pkgdown, rmarkdown, roxygen2, spelling,
testthat, tibble, usethis</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-06-18 15:17:56 UTC; mancinie</td>
</tr>
<tr>
<td>Author:</td>
<td>Edoardo Mancini [aut, cre],
  Ritika Aggarwal [aut],
  Jane Gao [aut],
  William Holmes [aut],
  Josie Jackson [aut],
  Sonali Jain [aut],
  Yuki Matsunaga [aut],
  Gordon Miller [aut],
  Rachel Linacre [aut],
  Lucy Palmen [aut],
  Nandini R Thampi [aut],
  Aldrich Salva [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Edoardo Mancini &lt;edoardo.mancini@roche.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-06-19 09:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='admiralophtha-package'>admiralophtha: ADaM in R Asset Library - Ophthalmology</h2><span id='topic+admiralophtha'></span><span id='topic+admiralophtha-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Aids the programming of Clinical Data Standards Interchange Consortium (CDISC) compliant Ophthalmology Analysis Data Model (ADaM) datasets in R. ADaM datasets are a mandatory part of any New Drug or Biologics License Application submitted to the United States Food and Drug Administration (FDA). Analysis derivations are implemented in accordance with the &quot;Analysis Data Model Implementation Guide&quot; (CDISC Analysis Data Model Team, 2021, <a href="https://www.cdisc.org/standards/foundational/adam/adamig-v1-3-release-package">https://www.cdisc.org/standards/foundational/adam/adamig-v1-3-release-package</a>).
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Edoardo Mancini <a href="mailto:edoardo.mancini@roche.com">edoardo.mancini@roche.com</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Ritika Aggarwal <a href="mailto:ritika.aggarwal@novartis.com">ritika.aggarwal@novartis.com</a>
</p>
</li>
<li><p> Jane Gao <a href="mailto:jane.gao@roche.com">jane.gao@roche.com</a>
</p>
</li>
<li><p> William Holmes <a href="mailto:william.holmes@roche.com">william.holmes@roche.com</a>
</p>
</li>
<li><p> Josie Jackson <a href="mailto:josie.jackson@roche.com">josie.jackson@roche.com</a>
</p>
</li>
<li><p> Sonali Jain <a href="mailto:sonali.jain@novartis.com">sonali.jain@novartis.com</a>
</p>
</li>
<li><p> Yuki Matsunaga <a href="mailto:yuki.matsunaga@novartis.com">yuki.matsunaga@novartis.com</a>
</p>
</li>
<li><p> Gordon Miller <a href="mailto:gordon.miller@roche.com">gordon.miller@roche.com</a>
</p>
</li>
<li><p> Rachel Linacre <a href="mailto:rachel.linacre@roche.com">rachel.linacre@roche.com</a>
</p>
</li>
<li><p> Lucy Palmen <a href="mailto:lucy.palmen@roche.com">lucy.palmen@roche.com</a>
</p>
</li>
<li><p> Nandini R Thampi <a href="mailto:nandini.rajendhiran@novartis.com">nandini.rajendhiran@novartis.com</a>
</p>
</li>
<li><p> Aldrich Salva <a href="mailto:salva.aldrich@gene.com">salva.aldrich@gene.com</a>
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://pharmaverse.github.io/admiralophtha/">https://pharmaverse.github.io/admiralophtha/</a>
</p>
</li>
<li> <p><a href="https://github.com/pharmaverse/admiralophtha/">https://github.com/pharmaverse/admiralophtha/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/pharmaverse/admiralophtha/issues/">https://github.com/pharmaverse/admiralophtha/issues/</a>
</p>
</li></ul>


<hr>
<h2 id='admiralophtha_adbcva'>Best Corrected Visual Acuity Analysis Dataset</h2><span id='topic+admiralophtha_adbcva'></span>

<h3>Description</h3>

<p>An example Best Corrected Visual Acuity (BCVA) analysis dataset
</p>


<h3>Usage</h3>

<pre><code class='language-R'>admiralophtha_adbcva
</code></pre>


<h3>Format</h3>

<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 7672 rows and 116 columns.
</p>


<h3>Source</h3>

<p>Derived from the OE and ADSL datasets using <code>{admiral}</code>, <code>{admiralophtha}</code> and
(<a href="https://github.com/pharmaverse/admiralophtha/blob/main/inst/templates/ad_adbcva.R">https://github.com/pharmaverse/admiralophtha/blob/main/inst/templates/ad_adbcva.R</a>)
</p>


<h3>See Also</h3>

<p>Other datasets: 
<code><a href="#topic+admiralophtha_adoe">admiralophtha_adoe</a></code>,
<code><a href="#topic+admiralophtha_advfq">admiralophtha_advfq</a></code>
</p>

<hr>
<h2 id='admiralophtha_adoe'>Ophthalmology Exam Analysis Dataset</h2><span id='topic+admiralophtha_adoe'></span>

<h3>Description</h3>

<p>An example Ophthalmology Exam Analysis dataset
</p>


<h3>Usage</h3>

<pre><code class='language-R'>admiralophtha_adoe
</code></pre>


<h3>Format</h3>

<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 7672 rows and 98 columns.
</p>


<h3>Source</h3>

<p>Derived from the OE and ADSL datasets using <code>{admiral}</code>, <code>{admiralophtha}</code> and
(<a href="https://github.com/pharmaverse/admiralophtha/blob/main/inst/templates/ad_adoe.R">https://github.com/pharmaverse/admiralophtha/blob/main/inst/templates/ad_adoe.R</a>)
</p>


<h3>See Also</h3>

<p>Other datasets: 
<code><a href="#topic+admiralophtha_adbcva">admiralophtha_adbcva</a></code>,
<code><a href="#topic+admiralophtha_advfq">admiralophtha_advfq</a></code>
</p>

<hr>
<h2 id='admiralophtha_advfq'>Visual Function Questionnaire Analysis Dataset</h2><span id='topic+admiralophtha_advfq'></span>

<h3>Description</h3>

<p>An example Visual Function Questionnaire (VFQ) analysis dataset
</p>


<h3>Usage</h3>

<pre><code class='language-R'>admiralophtha_advfq
</code></pre>


<h3>Format</h3>

<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 28798 rows and 41 columns.
</p>


<h3>Source</h3>

<p>Derived from the ADSL and QS datasets using <code>{admiral}</code>, <code>{admiralophtha}</code> and
(<a href="https://github.com/pharmaverse/admiralophtha/blob/main/inst/templates/ad_advfq.R">https://github.com/pharmaverse/admiralophtha/blob/main/inst/templates/ad_advfq.R</a>)
</p>


<h3>See Also</h3>

<p>Other datasets: 
<code><a href="#topic+admiralophtha_adbcva">admiralophtha_adbcva</a></code>,
<code><a href="#topic+admiralophtha_adoe">admiralophtha_adoe</a></code>
</p>

<hr>
<h2 id='convert_etdrs_to_logmar'>ETDRS &ndash;&gt; LogMAR conversion</h2><span id='topic+convert_etdrs_to_logmar'></span>

<h3>Description</h3>

<p>Convert ETDRS score to LogMAR units
</p>


<h3>Usage</h3>

<pre><code class='language-R'>convert_etdrs_to_logmar(value)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="convert_etdrs_to_logmar_+3A_value">value</code></td>
<td>
<p>object containing ETDRS score to convert to logMAR</p>
</td></tr>
</table>


<h3>Details</h3>

<p>ETDRS value converted to logMAR as logMAR = -0.02 * ETDRS + 1.7
</p>
<p>Source for conversion formula:
Beck, R.W., et al. A computerized method of visual acuity testing.
American Journal of Ophthalmology, 135(2), pp.194-205.
doi:https://doi.org/10.1016/s0002-9394(02)01825-1.
</p>


<h3>Value</h3>

<p>The input value converted converted to logMAR units
</p>


<h3>Author(s)</h3>

<p>Rachel Linacre
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(tibble)
library(dplyr)
library(admiral)
library(admiraldev)

adbcva &lt;- tribble(
  ~STUDYID, ~USUBJID, ~AVAL,
  "XXX001", "P01", 5,
  "XXX001", "P02", 10,
  "XXX001", "P03", 15,
  "XXX001", "P04", 20,
  "XXX001", "P05", 25
)

adbcva &lt;- adbcva %&gt;% mutate(AVAL = convert_etdrs_to_logmar(AVAL))
</code></pre>

<hr>
<h2 id='convert_logmar_to_etdrs'>LogMAR &ndash;&gt; ETDRS conversion</h2><span id='topic+convert_logmar_to_etdrs'></span>

<h3>Description</h3>

<p>Convert LogMAR score to ETDRS units
</p>


<h3>Usage</h3>

<pre><code class='language-R'>convert_logmar_to_etdrs(value)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="convert_logmar_to_etdrs_+3A_value">value</code></td>
<td>
<p>object containing logMAR score to convert to ETDRS</p>
</td></tr>
</table>


<h3>Details</h3>

<p>logMAR value converted to ETDRS as ETDRS = -(logMAR - 1.7) / 0.02
</p>
<p>Source for conversion formula:
Beck, R.W., et al. A computerized method of visual acuity testing.
American Journal of Ophthalmology, 135(2), pp.194-205.
doi:https://doi.org/10.1016/s0002-9394(02)01825-1.
</p>


<h3>Value</h3>

<p>The input value converted to ETDRS units
</p>


<h3>Author(s)</h3>

<p>Nandini R Thampi
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(tibble)
library(dplyr)
library(admiral)

oe &lt;- tribble(
  ~STUDYID, ~USUBJID, ~OETESTCD, ~OEMETHOD, ~OESTRESN,
  "XXX001", "P01", "VACSCORE", "logMAR EYE CHART", 1.08,
  "XXX001", "P02", "VACSCORE", "logMAR EYE CHART", 1.66,
  "XXX001", "P03", "VACSCORE", "logMAR EYE CHART", 1.60,
  "XXX001", "P04", "VACSCORE", "ETDRS EYE CHART", 57,
  "XXX001", "P05", "VACSCORE", "ETDRS EYE CHART", 1
)

adbcva &lt;- oe %&gt;%
  filter(OETESTCD == "VACSCORE" &amp; toupper(OEMETHOD) == "LOGMAR EYE CHART") %&gt;%
  mutate(OESTRESN = convert_logmar_to_etdrs(OESTRESN))
</code></pre>

<hr>
<h2 id='derive_var_afeye'>Derive Affected Eye</h2><span id='topic+derive_var_afeye'></span>

<h3>Description</h3>

<p>Derive Affected Eye (<code>AFEYE</code>) in occurrence datasets
</p>


<h3>Usage</h3>

<pre><code class='language-R'>derive_var_afeye(
  dataset,
  dataset_occ,
  loc_var,
  lat_var,
  lat_vals,
  loc_vals = "EYE"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="derive_var_afeye_+3A_dataset">dataset</code></td>
<td>
<p>Input dataset</p>
</td></tr>
<tr><td><code id="derive_var_afeye_+3A_dataset_occ">dataset_occ</code></td>
<td>
<p>Input dataset
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a> Please use <code>dataset</code> instead.</p>
</td></tr>
<tr><td><code id="derive_var_afeye_+3A_loc_var">loc_var</code></td>
<td>
<p>Location variable</p>
</td></tr>
<tr><td><code id="derive_var_afeye_+3A_lat_var">lat_var</code></td>
<td>
<p>Laterality variable</p>
</td></tr>
<tr><td><code id="derive_var_afeye_+3A_lat_vals">lat_vals</code></td>
<td>
<p><code>xxLAT</code>values for which <code>AFEYE</code> is derived
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a> Please simply ensure <code>xxLAT</code> values are
contained in <code>c("LEFT", "RIGHT", "BILATERAL")</code>.</p>
</td></tr>
<tr><td><code id="derive_var_afeye_+3A_loc_vals">loc_vals</code></td>
<td>
<p><code>xxLOC</code> values for which <code>AFEYE</code> is derived</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Affected Eye is derived in the occurrence dataset using laterality and Study
Eye. This assumes Study Eye has already been added from ADSL.
</p>


<h3>Value</h3>

<p>The input occurrence dataset with Affected Eye (<code>AFEYE</code>) added.
</p>


<h3>Author(s)</h3>

<p>Lucy Palmen
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(tibble)
library(admiral)

adae1 &lt;- tribble(
  ~STUDYID, ~USUBJID, ~STUDYEYE, ~AELOC, ~AELAT,
  "XXX001", "P01", "RIGHT", "EYE", "RIGHT",
  "XXX001", "P01", "RIGHT", "EYE", "LEFT",
  "XXX001", "P01", "RIGHT", "EYE", "",
  "XXX001", "P01", "RIGHT", "", "RIGHT",
  "XXX001", "P02", "LEFT", "", "",
  "XXX001", "P02", "LEFT", "EYE", "LEFT",
  "XXX001", "P04", "BILATERAL", "EYE", "RIGHT",
  "XXX001", "P05", "RIGHT", "EYE", "RIGHT",
  "XXX001", "P05", "RIGHT", "EYE", "BILATERAL",
  "XXX001", "P06", "BILATERAL", "", "",
  "XXX001", "P06", "BILATERAL", "", "RIGHT",
  "XXX001", "P07", "BILATERAL", "EYE", "BILATERAL",
  "XXX001", "P08", "", "EYE", "BILATERAL",
  "XXX001", "P09", "NONSENSE", "EYE", "BILATERAL",
  "XXX001", "P09", "BILATERAL", "EYE", "NONSENSE",
  "XXX001", "P09", "BILATERAL", "NONSENSE", "BILATERAL",
  "XXX001", "P10", "RIGHT", "EYE", "BOTH"
)

derive_var_afeye(adae1, loc_var = AELOC, lat_var = AELAT)

adae2 &lt;- tribble(
  ~STUDYID, ~USUBJID, ~STUDYEYE, ~AELOC, ~AELAT,
  "XXX001", "P01", "RIGHT", "EYES", "RIGHT",
  "XXX001", "P02", "RIGHT", "RETINA", "LEFT",
  "XXX001", "P03", "LEFT", "", ""
)

derive_var_afeye(adae2, loc_var = AELOC, lat_var = AELAT, loc_vals = c("EYES", "RETINA"))
</code></pre>

<hr>
<h2 id='derive_var_bcvacritxfl'>Adds <code>CRITx</code>/<code>CRITxFL</code> pairs to BCVA dataset</h2><span id='topic+derive_var_bcvacritxfl'></span>

<h3>Description</h3>

<p>Adds a criterion variables <code>CRITx</code> and their corresponding flags <code>CRITxFL</code> to a
dataset containing BCVA records
</p>


<h3>Usage</h3>

<pre><code class='language-R'>derive_var_bcvacritxfl(
  dataset,
  crit_var,
  bcva_ranges = NULL,
  bcva_uplims = NULL,
  bcva_lowlims = NULL,
  additional_text = "",
  critxfl_index = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="derive_var_bcvacritxfl_+3A_dataset">dataset</code></td>
<td>
<p>Input dataset containing BCVA data (usually ADBCVA).</p>
</td></tr>
<tr><td><code id="derive_var_bcvacritxfl_+3A_crit_var">crit_var</code></td>
<td>
<p>Variable with respect to which <code>CRITx</code>/<code>CRITxFL</code> are derived
(usually <code>CHG</code> or <code>AVAL</code>).</p>
</td></tr>
<tr><td><code id="derive_var_bcvacritxfl_+3A_bcva_ranges">bcva_ranges</code></td>
<td>
<p>List containing one or more numeric vectors of length 2. For each
vector <code>c(a,b)</code> in <code>bcva_ranges</code>, a pair of variables <code>CRITx</code>, <code>CRITxFL</code> is created
with the condition: <code style="white-space: pre;">&#8288;a &lt;=  crit_var &lt;= b&#8288;</code>. If criterion flags of that type are not
required, then leave as NULL.</p>
</td></tr>
<tr><td><code id="derive_var_bcvacritxfl_+3A_bcva_uplims">bcva_uplims</code></td>
<td>
<p>List containing one or more numeric elements. For each
element a in <code>bcva_uplims</code>, a pair of variables <code>CRITx</code>, <code>CRITxFL</code> is created
with the condition: <code>crit_var &lt;= a</code>. If criterion flags of that type are not
required, then leave as NULL.</p>
</td></tr>
<tr><td><code id="derive_var_bcvacritxfl_+3A_bcva_lowlims">bcva_lowlims</code></td>
<td>
<p>List containing one or more numeric elements. For each
element b in <code>bcva_lowlims</code>, a pair of variables <code>CRITx</code>, <code>CRITxFL</code> is created
with the condition: <code>crit_var &gt;= b</code>. If criterion flags of that type are not required,
then leave as NULL.</p>
</td></tr>
<tr><td><code id="derive_var_bcvacritxfl_+3A_additional_text">additional_text</code></td>
<td>
<p>string containing additional text to append to <code>CRITx</code></p>
</td></tr>
<tr><td><code id="derive_var_bcvacritxfl_+3A_critxfl_index">critxfl_index</code></td>
<td>
<p>positive integer detailing the first value of x to use
in <code>CRITxFL</code>. If not supplied, the function takes the first available value of
x, counting up from x = 1.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function works by calling <code>derive_var_bcvacritxfl()</code> once for each of the
elements in <code>bcva_ranges</code>, <code>bcva_uplims</code> and <code>bcva_lowlims</code>.
NOTE: if <code>crit_var</code> is equal to <code>NA</code>, then the resulting criterion flag is also marked
as <code>NA</code>.
</p>


<h3>Value</h3>

<p>The input BCVA dataset with additional column pairs<code>CRITx</code>, <code>CRITxFL</code>.
</p>


<h3>Author(s)</h3>

<p>Edoardo Mancini
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(tibble)
library(admiral)
library(admiraldev)

adbcva1 &lt;- tribble(
  ~STUDYID, ~USUBJID, ~AVISIT, ~BASETYPE, ~PARAMCD, ~CHG,
  "XXX001", "P01", "BASELINE", "LAST", "SBCVA", 0,
  "XXX001", "P01", "WEEK 2", "LAST", "FBCVA", 2,
  "XXX001", "P02", "BASELINE", "LAST", "SBCVA", -13,
  "XXX001", "P02", "WEEK 2", "LAST", "FBCVA", 5,
  "XXX001", "P03", "BASELINE", "LAST", "SBCVA", NA,
  "XXX001", "P03", "WEEK 2", "LAST", "FBCVA", 17
)

derive_var_bcvacritxfl(
  dataset = adbcva1,
  crit_var = exprs(CHG),
  bcva_ranges = list(c(0, 5), c(-5, -1), c(10, 15)),
  bcva_uplims = list(5, 10),
  bcva_lowlims = list(8),
  additional_text = ""
)

adbcva2 &lt;- tribble(
  ~STUDYID, ~USUBJID, ~AVISIT, ~BASETYPE, ~PARAMCD, ~AVAL, ~CHG,
  "XXX001", "P01", "BASELINE", "LAST", "SBCVA", 4, NA,
  "XXX001", "P01", "BASELINE", "LAST", "SBCVA", 6, NA,
  "XXX001", "P01", "AVERAGE BASELINE", "AVERAGE", "SBCVA", 5, NA,
  "XXX001", "P01", "WEEK 2", "LAST", "SBCVA", -3, NA,
  "XXX001", "P01", "WEEK 4", "LAST", "SBCVA", -10, NA,
  "XXX001", "P01", "WEEK 6", "LAST", "SBCVA", 12, NA,
  "XXX001", "P01", "WEEK 2", "AVERAGE", "SBCVA", -2, -7,
  "XXX001", "P01", "WEEK 4", "AVERAGE", "SBCVA", 6, 1,
  "XXX001", "P01", "WEEK 6", "AVERAGE", "SBCVA", 3, -2
)

restrict_derivation(
  adbcva2,
  derivation = derive_var_bcvacritxfl,
  args = params(
    crit_var = exprs(CHG),
    bcva_ranges = list(c(0, 5), c(-10, 0)),
    bcva_lowlims = list(5),
    additional_text = " (AVERAGE)"
  ),
  filter = PARAMCD %in% c("SBCVA", "FBCVA") &amp; BASETYPE == "AVERAGE"
)

</code></pre>

<hr>
<h2 id='derive_var_bcvacritxfl_util'>Add <code>CRITx</code>/<code>CRITxFL</code> pair to BCVA dataset</h2><span id='topic+derive_var_bcvacritxfl_util'></span>

<h3>Description</h3>

<p>Helper function for <code>derive_var_bcvacritxfl()</code> that adds a criterion variable <code>CRITx</code> and
its corresponding flag <code>CRITxFL</code> to a dataset containing BCVA records
</p>


<h3>Usage</h3>

<pre><code class='language-R'>derive_var_bcvacritxfl_util(
  dataset,
  crit_var,
  critx_text,
  critxfl_cond,
  counter,
  bcva_range = NULL,
  bcva_uplim = NULL,
  bcva_lowlim = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="derive_var_bcvacritxfl_util_+3A_dataset">dataset</code></td>
<td>
<p>Input dataset (usually ADBCVA).</p>
</td></tr>
<tr><td><code id="derive_var_bcvacritxfl_util_+3A_crit_var">crit_var</code></td>
<td>
<p>Variable with respect to which <code>CRITx</code>/<code>CRITxFL</code> are derived
(usually <code>CHG</code> or <code>AVAL</code>).</p>
</td></tr>
<tr><td><code id="derive_var_bcvacritxfl_util_+3A_critx_text">critx_text</code></td>
<td>
<p>String containing the text for <code>CRITx</code> variable.</p>
</td></tr>
<tr><td><code id="derive_var_bcvacritxfl_util_+3A_critxfl_cond">critxfl_cond</code></td>
<td>
<p>String containing R code detailing the criterion to be satisfied
for <code>CRITxFL</code> variable to be equal to &quot;Y&quot;.</p>
</td></tr>
<tr><td><code id="derive_var_bcvacritxfl_util_+3A_counter">counter</code></td>
<td>
<p>Integer detailing the value of x to use in <code>CRITxFL</code>.</p>
</td></tr>
<tr><td><code id="derive_var_bcvacritxfl_util_+3A_bcva_range">bcva_range</code></td>
<td>
<p>Numeric vector of length two detailing lower and upper change in
BCVA limits (<code>bcva_range</code> will be called in <code>critxfl_cond</code> if the criterion
stipulates that change in BCVA lie inside some range).</p>
</td></tr>
<tr><td><code id="derive_var_bcvacritxfl_util_+3A_bcva_uplim">bcva_uplim</code></td>
<td>
<p>Numeric value detailing highest change in BCVA limit (<code>bcva_uplim</code>
will be called in <code>critxfl_cond</code> if the criterion stipulates that change in BCVA
lie below some upper limit).</p>
</td></tr>
<tr><td><code id="derive_var_bcvacritxfl_util_+3A_bcva_lowlim">bcva_lowlim</code></td>
<td>
<p>Numeric value detailing lowest change in BCVA limit (<code>bcva_lowlim</code>
will be called in <code>critxfl_cond</code> if the criterion stipulates that change in BCVA
lie above some lower limit).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The criterion for change in BCVA in <code>CRITxFL</code> can be of three types: (1) value lies
within some range; <code style="white-space: pre;">&#8288;a &lt;= crit_var &lt;= b&#8288;</code>; (2) value is below some upper limit; <code>crit_var &lt;= a</code>;
(3) value is above some lower limit; <code>b &lt;= crit_var</code>. For (1), <code>bcva_range</code> must
be specified to this function; for (2), <code>bcva_uplim</code>; for (3) <code>bcva_lowlim</code>. It is
necessary to supply at least one of these three arguments.
NOTE: if <code>crit_var</code> is equal to NA, then the resulting criterion flag is also marked
as <code>NA</code>.
</p>


<h3>Value</h3>

<p>The input BCVA dataset with additional columns <code>CRITx</code>, <code>CRITxFL</code>.
</p>


<h3>Author(s)</h3>

<p>Edoardo Mancini
</p>

<hr>
<h2 id='derive_var_studyeye'>Derive Study Eye</h2><span id='topic+derive_var_studyeye'></span>

<h3>Description</h3>

<p>Derive Study Eye (<code>STUDYEYE</code>) in the ADSL dataset
</p>


<h3>Usage</h3>

<pre><code class='language-R'>derive_var_studyeye(dataset_adsl, dataset_sc, sctestcd_value = "FOCID")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="derive_var_studyeye_+3A_dataset_adsl">dataset_adsl</code></td>
<td>
<p>ADSL input dataset</p>
</td></tr>
<tr><td><code id="derive_var_studyeye_+3A_dataset_sc">dataset_sc</code></td>
<td>
<p>SC input dataset</p>
</td></tr>
<tr><td><code id="derive_var_studyeye_+3A_sctestcd_value">sctestcd_value</code></td>
<td>
<p><code>SCTESTCD</code> value flagging Study Eye selection records. Default: &quot;FOCID&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Study Eye is derived in ADSL using the &quot;Study Eye selection&quot; records
in the SC SDTM dataset.
</p>


<h3>Value</h3>

<p>The input ADSL dataset with an additional column named <code>STUDYEYE</code>
</p>


<h3>Author(s)</h3>

<p>Edoardo Mancini
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(tibble)
library(admiral)

adsl &lt;- tribble(
  ~STUDYID, ~USUBJID,
  "XXX001", "P01",
  "XXX001", "P02",
  "XXX001", "P03",
  "XXX001", "P04",
  "XXX001", "P05"
)

sc &lt;- tribble(
  ~STUDYID, ~USUBJID, ~SCTESTCD, ~SCSTRESC,
  "XXX001", "P01", "FOCID", "OS",
  "XXX001", "P01", "ACOHORT", "COHORT1",
  "XXX001", "P02", "FOCID", "OD",
  "XXX001", "P02", "ACOHORT", "COHORT3",
  "XXX001", "P04", "FOCID", "OU",
  "XXX001", "P05", "FOCID", "OD",
  "XXX001", "P06", "FOCID", "OS"
)

derive_var_studyeye(adsl, sc)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
