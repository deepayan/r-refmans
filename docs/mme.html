<!DOCTYPE html><html lang="en"><head><title>Help for package mme</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {mme}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#mme-package'><p>Multinomial Mixed Effects Models</p></a></li>
<li><a href='#addtolist'><p>Add items from a list</p></a></li>
<li><a href='#addtomatrix'><p>Add rows from a matrix</p></a></li>
<li><a href='#ci'><p>Standard deviation and p-values of the estimated model parameters</p></a></li>
<li><a href='#data.mme'><p>Function to generate matrices and the initial values</p></a></li>
<li><a href='#Fbetaf'><p>Inverse of the Fisher information matrix of the fixed and random effects in Model 1</p></a></li>
<li><a href='#Fbetaf.ct'><p>Inverse of the Fisher information matrix of fixed and random effects in Model 3</p></a></li>
<li><a href='#Fbetaf.it'><p>The inverse of the Fisher information matrix of the fixed and random effects for Model 2</p></a></li>
<li><a href='#initial.values'><p>Initial values for fitting algorithm to estimate the fixed and random effects and the variance components</p></a></li>
<li><a href='#mmedata'><p>Create objects of class mmedata</p></a></li>
<li><a href='#model'><p>Choose between the three models</p></a></li>
<li><a href='#modelfit1'><p>Function used to fit Model 1</p></a></li>
<li><a href='#modelfit2'><p>Function to fit Model 2</p></a></li>
<li><a href='#modelfit3'><p>Function used to fit Model 3</p></a></li>
<li><a href='#mseb'><p>Bias and MSE using parametric bootstrap</p></a></li>
<li><a href='#msef'><p>Analytic MSE for Model 1</p></a></li>
<li><a href='#msef.ct'><p>Analytic MSE for Model 3</p></a></li>
<li><a href='#msef.it'><p>Analytic MSE for Model 2</p></a></li>
<li><a href='#omega'><p>Model correlation matrix for Model 3</p></a></li>
<li><a href='#phi.direct'><p>Variance components for Model 1</p></a></li>
<li><a href='#phi.direct.ct'><p>Variance components for Model 3</p></a></li>
<li><a href='#phi.direct.it'><p>Variance components for Model 2</p></a></li>
<li><a href='#phi.mult'><p>Initial values for the variance components for Model 1</p></a></li>
<li><a href='#phi.mult.ct'><p>Initial values for the variance components in Model 3</p></a></li>
<li><a href='#phi.mult.it'><p>Initial values for the variance components in Model 2</p></a></li>
<li><a href='#print.mme'><p>Print objects of class mme</p></a></li>
<li><a href='#prmu'><p>Estimated mean and probabilities for Model 1</p></a></li>
<li><a href='#prmu.time'><p>Estimated mean and probabilities for Model 2 and 3</p></a></li>
<li><a href='#simdata'><p>Dataset for Model 1</p></a></li>
<li><a href='#simdata2'><p>Dataset for Model 2</p></a></li>
<li><a href='#simdata3'><p>Dataset for Model 3</p></a></li>
<li><a href='#sPhikf'><p>Fisher information matrix and score vectors of the variance components for Model 1</p></a></li>
<li><a href='#sPhikf.ct'><p>Fisher information matrix and score vectors of the variance components for Model 3</p></a></li>
<li><a href='#sPhikf.it'><p>Fisher information matrix and score vectors of the variance components for Model 2</p></a></li>
<li><a href='#wmatrix'><p>Model variance-covariance matrix of the multinomial mixed models</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Multinomial Mixed Effects Models</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1-6</td>
</tr>
<tr>
<td>Date:</td>
<td>2019-01-27</td>
</tr>
<tr>
<td>Author:</td>
<td>E. Lopez-Vizcaino, M.J. Lombardia and D. Morales</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>E. Lopez-Vizcaino &lt;esther.lopez@ige.eu&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 1.8.0), MASS</td>
</tr>
<tr>
<td>Imports:</td>
<td>Matrix, methods</td>
</tr>
<tr>
<td>Description:</td>
<td>Fit Gaussian Multinomial mixed-effects models for small area estimation: Model 1, with one
    random effect in each category of the response variable (Lopez-Vizcaino,E. et al., 2013) &lt;<a href="https://doi.org/10.1177%2F1471082X13478873">doi:10.1177/1471082X13478873</a>&gt;; Model 2, introducing
    independent time effect; Model 3, introducing correlated time effect.
    mme calculates direct and parametric bootstrap MSE estimators (Lopez-Vizcaino,E et al., 2014) &lt;<a href="https://doi.org/10.1111%2Frssa.12085">doi:10.1111/rssa.12085</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>LazyData:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2019-01-27 12:43:14 UTC; Oscar Iglesias</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2019-01-27 15:40:13 UTC</td>
</tr>
</table>
<hr>
<h2 id='mme-package'>Multinomial Mixed Effects Models</h2><span id='topic+mme'></span><span id='topic+mme-package'></span>

<h3>Description</h3>

<p>The mme package implements three multinomial area level mixed effects models for
small area estimation. The first model (Model 1) is based on the area level multinomial
mixed model with independent random effects for each category of the response
variable (Lopez-Vizcaino et al, 2013). The second model (Model 2) takes advantage
from the availability of survey data from different time periods and uses
a multinomial mixed model with independent random effects for each category of the
response variable and with independent time and domain random effects. The
third model (Model 3) is similar to the second one, but with correlated time random effects. To fit the models, we combine the penalized
quasi-likelihood (PQL) method, introduced by Breslow and Clayton (1993) for estimating and predicting th fixed
and random effects, with the residual maximum likelihood (REML) method for estimating the variance components.
In all models the package use two approaches to estimate the mean square
error (MSE), first through an analytical expression and second by bootstrap techniques.
</p>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Multinomial-based small area estimation of labour force indicators.
Statistical Modelling, 13 ,153-178.
</p>
<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Small area estimation of labour force indicator under a multinomial mixed model
with correlated time and area effects. Submitted for review.
</p>
<p>Breslow, N, Clayton, D (1993).
Aproximate inference in generalized linear mixed models.
Journal of the American Statistical Association, 88, 9-25.
</p>

<hr>
<h2 id='addtolist'>Add items from a list</h2><span id='topic+addtolist'></span>

<h3>Description</h3>

<p>This function adds items from a list of dimension d*t, where d is the number of areas
and t is the number of times periods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>addtolist(B_d, t, d)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="addtolist_+3A_b_d">B_d</code></td>
<td>
<p>a list in each area.</p>
</td></tr>
<tr><td><code id="addtolist_+3A_t">t</code></td>
<td>
<p>number of time periods.</p>
</td></tr>
<tr><td><code id="addtolist_+3A_d">d</code></td>
<td>
<p>number of areas.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>B_d a list of dimension d.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Fbetaf.it">Fbetaf.it</a></code>, <code><a href="#topic+Fbetaf.ct">Fbetaf.ct</a></code>,
<code><a href="#topic+modelfit2">modelfit2</a></code>, <code><a href="#topic+modelfit3">modelfit3</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3  #number of categories for the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
data(simdata2) # data
mod=2
datar=data.mme(simdata2,k,pp,mod)

##Add the time periods
l=addtolist(datar$X,datar$t,datar$d)
</code></pre>

<hr>
<h2 id='addtomatrix'>Add rows from a matrix</h2><span id='topic+addtomatrix'></span>

<h3>Description</h3>

<p>This function adds rows from a matrix of dimension d*t*(k-1) times d*(k-1).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>addtomatrix(C2, d, t, k)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="addtomatrix_+3A_c2">C2</code></td>
<td>
<p>a matrix of dimension d*t*(k-1) times d*(k-1).</p>
</td></tr>
<tr><td><code id="addtomatrix_+3A_d">d</code></td>
<td>
<p>number of areas.</p>
</td></tr>
<tr><td><code id="addtomatrix_+3A_t">t</code></td>
<td>
<p>number of time periods.</p>
</td></tr>
<tr><td><code id="addtomatrix_+3A_k">k</code></td>
<td>
<p>number of categories of the response variable.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>C22 a matrix of dimension d*(k-1) times d*(k-1).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Fbetaf.it">Fbetaf.it</a></code>, <code><a href="#topic+Fbetaf.ct">Fbetaf.ct</a></code>,
<code><a href="#topic+modelfit2">modelfit2</a></code>,<code><a href="#topic+modelfit3">modelfit3</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
d=15 # number of areas
t=2  # number of time periods
mat=matrix(1,d*t*(k-1),d*(k-1)) # a matrix

##Add items in the matrix
mat2=addtomatrix(mat,d,t,k)
</code></pre>

<hr>
<h2 id='ci'>Standard deviation and p-values of the estimated model parameters</h2><span id='topic+ci'></span>

<h3>Description</h3>

<p>This function calculates the standard deviations and the p-values
of the estimated model parameters. The standard deviations are obtained from the asymptotic Fisher information matrix in the fitting
algorithms <code><a href="#topic+modelfit1">modelfit1</a></code>, <code><a href="#topic+modelfit2">modelfit2</a></code>, <code><a href="#topic+modelfit3">modelfit3</a></code>,
depending of the current multinomial mixed model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ci(a, F)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ci_+3A_a">a</code></td>
<td>
<p>vector with the estimated parameters obtained from <code><a href="#topic+modelfit1">modelfit1</a></code>, <code><a href="#topic+modelfit2">modelfit2</a></code> or <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
<tr><td><code id="ci_+3A_f">F</code></td>
<td>
<p>inverse of the Fisher Information Matrix obtained from <code><a href="#topic+modelfit1">modelfit1</a></code>, <code><a href="#topic+modelfit2">modelfit2</a></code> or <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components.
</p>
<table role = "presentation">
<tr><td><code>Std.dev</code></td>
<td>
<p>vector with the standard deviations of the parameters. The parameters are sorted per category. </p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>vector with the p-values of the parameters for testing H0:a=0.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Multinomial-based small area estimation of labour force indicators.
Statistical Modelling, 13, 153-178.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+modelfit1">modelfit1</a></code>, <code><a href="#topic+modelfit2">modelfit2</a></code>,
<code><a href="#topic+modelfit3">modelfit3</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
data(simdata) #data
mod=1  #Type of model
datar=data.mme(simdata,k,pp,mod)

#Model fit
result=modelfit1(pp,datar$Xk,datar$X,datar$Z,datar$initial,datar$y[,1:(k-1)],
       datar$n,datar$N)
beta=result[[8]][,1] #fixed effects
Fisher=result[[3]] #Fisher information matrix

##Standard deviation and p-values
res=ci(beta,Fisher)
</code></pre>

<hr>
<h2 id='data.mme'>Function to generate matrices and the initial values</h2><span id='topic+data.mme'></span>

<h3>Description</h3>

<p>Based on the input data, this function generates some matrices that are
required in subsequent calculations and the initial values obtained from the function <code><a href="#topic+initial.values">initial.values</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data.mme(fi, k, pp, mod)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="data.mme_+3A_fi">fi</code></td>
<td>
<p>input data set with (d x t) rows and 4+k+sum(pp) columns. The first four columns of the data set are, in this order: the area indicator (integer), the time indicator (integer), the sample size of each domain and the population size of each domain. The following k columns are the categories of the response variable. Then, the auxiliary variables: first, the auxiliary variables of the first category, second, the auxiliary variables of the second category, and so on. Examples of input data sets are in <code><a href="#topic+simdata">simdata</a></code>, <code><a href="#topic+simdata2">simdata2</a></code> and <code><a href="#topic+simdata3">simdata3</a></code>.</p>
</td></tr>
<tr><td><code id="data.mme_+3A_k">k</code></td>
<td>
<p>number of categories of the response variable.</p>
</td></tr>
<tr><td><code id="data.mme_+3A_pp">pp</code></td>
<td>
<p>vector with the number of auxiliary variables per category.</p>
</td></tr>
<tr><td><code id="data.mme_+3A_mod">mod</code></td>
<td>
<p>a number specifying the type of models: 1=multinomial mixed model with one independent
random effect in each category of the response variable
(Model 1), 2=multinomial mixed model with two independent random effects in each category of the
response variable: one domain random effect and another independent time and domain random effect (Model 2) and
3= multinomial model with two independent random effects in each category of the response variable:
one domain random effect and another correlated time and domain random effect (Model 3).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components.
</p>
<table role = "presentation">
<tr><td><code>n</code></td>
<td>
<p>vector with the area sample sizes.</p>
</td></tr>
<tr><td><code>N</code></td>
<td>
<p>vector with the area population sizes.</p>
</td></tr>
<tr><td><code>Z</code></td>
<td>
<p>design matrix  of random effects.</p>
</td></tr>
<tr><td><code>Xk</code></td>
<td>
<p>list of matrices with the auxiliary variables per category. The dimension of the list is the number of domains</p>
</td></tr>
<tr><td><code>X</code></td>
<td>
<p>list of matrices with the auxiliary variables. The dimension of the list is the number of categories of the response variable minus one.</p>
</td></tr>
<tr><td><code>y</code></td>
<td>
<p>matrix with the response variable. The rows are the domains and the columns are the categories of the response variable.</p>
</td></tr>
<tr><td><code>initial</code></td>
<td>
<p>a list with the initial values for the fixed and the random effects obtained from <code><a href="#topic+initial.values">initial.values</a></code> .</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Multinomial-based small area estimation of labour force indicators.
Statistical Modelling, 13, 153-178.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+initial.values">initial.values</a></code>, <code><a href="#topic+wmatrix">wmatrix</a></code>,
<code><a href="#topic+phi.mult">phi.mult</a></code>, <code><a href="#topic+prmu">prmu</a></code>,
<code><a href="#topic+Fbetaf">Fbetaf</a></code>, <code><a href="#topic+phi.direct">phi.direct</a></code>,
<code><a href="#topic+sPhikf">sPhikf</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+modelfit1">modelfit1</a></code>, <code><a href="#topic+msef">msef</a></code>,
<code><a href="#topic+mseb">mseb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
data(simdata2) #Data
mod=2

##Needed matrix and initial values
datar=data.mme(simdata2,k,pp,mod)
</code></pre>

<hr>
<h2 id='Fbetaf'>Inverse of the Fisher information matrix of the fixed and random effects in Model 1</h2><span id='topic+Fbetaf'></span>

<h3>Description</h3>

<p>This function calculates the inverse of the Fisher information
matrix of the fixed effects (beta) and the random effects (u) and the score vectors S.beta and S.u, for the model with
one independent random effect in each category
of the response variable (Model 1). <code><a href="#topic+modelfit1">modelfit1</a></code> uses the output of this function
to estimate the fixed and random effects by the PQL method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Fbetaf(sigmap, X, Z, phi, y, mu, u)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Fbetaf_+3A_sigmap">sigmap</code></td>
<td>
<p>a list with the model variance-covariance matrices for each domain.</p>
</td></tr>
<tr><td><code id="Fbetaf_+3A_x">X</code></td>
<td>
<p>list of matrices with the auxiliary variables obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of categories of the response variable.</p>
</td></tr>
<tr><td><code id="Fbetaf_+3A_z">Z</code></td>
<td>
<p>design matrix  of random effects.</p>
</td></tr>
<tr><td><code id="Fbetaf_+3A_phi">phi</code></td>
<td>
<p>vector with the values of the variance components obtained from <code><a href="#topic+modelfit1">modelfit1</a></code>.</p>
</td></tr>
<tr><td><code id="Fbetaf_+3A_y">y</code></td>
<td>
<p>matrix with the response variable except the reference category. The rows are the domains and the columns are the categories of the
response variable minus one.</p>
</td></tr>
<tr><td><code id="Fbetaf_+3A_mu">mu</code></td>
<td>
<p>matrix with the estimated mean of the response variable obtained from <code><a href="#topic+prmu">prmu</a></code>.</p>
</td></tr>
<tr><td><code id="Fbetaf_+3A_u">u</code></td>
<td>
<p>matrix with the values of random effects obtained from <code><a href="#topic+modelfit1">modelfit1</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components.
</p>
<table role = "presentation">
<tr><td><code>F.beta.beta</code></td>
<td>
<p>the first diagonal element of the inverse of the
Fisher information matrix.</p>
</td></tr>
<tr><td><code>F.beta.u</code></td>
<td>
<p>the element out of the diagonal of the inverse of the
Fisher information matrix.</p>
</td></tr>
<tr><td><code>F.u.u</code></td>
<td>
<p>the second diagonal element of the inverse of the Fisher
information matrix.</p>
</td></tr>
<tr><td><code>S.beta</code></td>
<td>
<p>beta scores.</p>
</td></tr>
<tr><td><code>S.u</code></td>
<td>
<p>u scores.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Multinomial-based small area estimation of labour force indicators.
Statistical Modelling, 13 ,153-178.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+phi.mult">phi.mult</a></code>,
<code><a href="#topic+prmu">prmu</a></code>, <code><a href="#topic+phi.direct">phi.direct</a></code>,
<code><a href="#topic+sPhikf">sPhikf</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+modelfit1">modelfit1</a></code>, <code><a href="#topic+msef">msef</a></code>,
<code><a href="#topic+mseb">mseb</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
data(simdata) #data
mod=1 #type of model
datar=data.mme(simdata,k,pp,mod)
initial=datar$initial
mean=prmu(datar$n,datar$Xk,initial$beta.0,initial$u.0)
sigmap=wmatrix(datar$n,mean$estimated.probabilities)

#Inverse of the Fisher information matrix
Fisher=Fbetaf(sigmap,datar$X,datar$Z,initial$phi.0,datar$y[,1:(k-1)],
       mean$mean,initial$u.0)
</code></pre>

<hr>
<h2 id='Fbetaf.ct'>Inverse of the Fisher information matrix of fixed and random effects in Model 3</h2><span id='topic+Fbetaf.ct'></span>

<h3>Description</h3>

<p>This function calculates the score vector S and the inverse of the Fisher information
matrix for the fixed (beta) and the random effects (u1, u2) in Model 3. This model has two independet sets of random effects.
The first one contains independent random effects u1dk associated to each category and domain. The second set contains random effects
u2dkt associated to each category, domain and time period. Model 3 assumes that the u2dk are AR(1) correlated across time.
<code><a href="#topic+modelfit3">modelfit3</a></code> uses the output of this function to estimate the fixed and random effect by the PQL method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Fbetaf.ct(sigmap, X, Z, phi1, phi2, y, mu, u1, u2, rho)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Fbetaf.ct_+3A_sigmap">sigmap</code></td>
<td>
<p>a list with the model variance-covariance matrices for each domain obtained from <code><a href="#topic+wmatrix">wmatrix</a></code>.</p>
</td></tr>
<tr><td><code id="Fbetaf.ct_+3A_x">X</code></td>
<td>
<p>list of matrices with the auxiliary variables obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="Fbetaf.ct_+3A_z">Z</code></td>
<td>
<p>design matrix  of random effects.</p>
</td></tr>
<tr><td><code id="Fbetaf.ct_+3A_phi1">phi1</code></td>
<td>
<p>vector with the values of the variance components for the first random effects obtained from <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
<tr><td><code id="Fbetaf.ct_+3A_phi2">phi2</code></td>
<td>
<p>vector with the values of the variance components for the second random effects obtained from <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
<tr><td><code id="Fbetaf.ct_+3A_y">y</code></td>
<td>
<p>matrix with the response variable, except the reference category. The rows are the domains and the columns are the categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="Fbetaf.ct_+3A_mu">mu</code></td>
<td>
<p>matrix with the estimated mean of the response variable.</p>
</td></tr>
<tr><td><code id="Fbetaf.ct_+3A_u1">u1</code></td>
<td>
<p>matrix with the values of the first random effect obtained from <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
<tr><td><code id="Fbetaf.ct_+3A_u2">u2</code></td>
<td>
<p>matrix with the values of the second random effect obtained from <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
<tr><td><code id="Fbetaf.ct_+3A_rho">rho</code></td>
<td>
<p>vector with the values of the correlation parameter obtained from <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components.
</p>
<table role = "presentation">
<tr><td><code>F</code></td>
<td>
<p>the inverse of the Fisher information matrix of (beta, u1, u2).</p>
</td></tr>
<tr><td><code>S</code></td>
<td>
<p>(beta, u1, u2) score vectors</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Small area estimation of labour force indicators under a multinomial mixed model
with correlated time and area effects. Submitted for review.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+phi.mult.ct">phi.mult.ct</a></code>,
<code><a href="#topic+prmu.time">prmu.time</a></code>, <code><a href="#topic+phi.direct.ct">phi.direct.ct</a></code>,
<code><a href="#topic+sPhikf.ct">sPhikf.ct</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+modelfit3">modelfit3</a></code>, <code><a href="#topic+msef.ct">msef.ct</a></code>, <code><a href="#topic+omega">omega</a></code>,
<code><a href="#topic+mseb">mseb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
mod=3 #type of model
data(simdata3)
datar=data.mme(simdata3,k,pp,mod)
initial=datar$initial
mean=prmu.time(datar$n,datar$Xk,initial$beta.0,initial$u1.0,initial$u2.0)
sigmap=wmatrix(datar$n,mean$estimated.probabilities) #variance-covariance

##The inverse of the Fisher information matrix and the score matrix
Fisher.beta=Fbetaf.ct(sigmap,datar$X,datar$Z,initial$phi1.0,initial$phi2.0,
         datar$y[,1:(k-1)],mean$mean,initial$u1.0,initial$u2.0,initial$rho.0)
</code></pre>

<hr>
<h2 id='Fbetaf.it'>The inverse of the Fisher information matrix of the fixed and random effects for Model 2</h2><span id='topic+Fbetaf.it'></span>

<h3>Description</h3>

<p>This function calculates the score vector S and the inverse of the Fisher information
matrix for the fixed (beta) and the random effects (u1, u2) in Model 2. This model has two independet sets of random effects.
The first one contains independent random effects u1dk associated to each category and domain. The second set contains random effects
u2dkt associated to each category, domain and time period. Model 2 assumes that the u2dk are independent across time.
<code><a href="#topic+modelfit2">modelfit2</a></code> uses the output of this function to estimate the fixed and random effect by the PQL method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Fbetaf.it(sigmap, X, Z, phi1, phi2, y, mu, u1, u2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Fbetaf.it_+3A_sigmap">sigmap</code></td>
<td>
<p>a list with the model variance-covariance matrices for each domain.</p>
</td></tr>
<tr><td><code id="Fbetaf.it_+3A_x">X</code></td>
<td>
<p>list of matrices with the auxiliary variables obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="Fbetaf.it_+3A_z">Z</code></td>
<td>
<p>design matrix  of random effects obtained from <code><a href="#topic+data.mme">data.mme</a></code>.</p>
</td></tr>
<tr><td><code id="Fbetaf.it_+3A_phi1">phi1</code></td>
<td>
<p>vector with the first variance component obtained from <code><a href="#topic+modelfit2">modelfit2</a></code>.</p>
</td></tr>
<tr><td><code id="Fbetaf.it_+3A_phi2">phi2</code></td>
<td>
<p>vector with the second variance component obtained from <code><a href="#topic+modelfit2">modelfit2</a></code>.</p>
</td></tr>
<tr><td><code id="Fbetaf.it_+3A_y">y</code></td>
<td>
<p>matrix with the response variable, except the reference category obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The rows are the domains and the columns are the categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="Fbetaf.it_+3A_mu">mu</code></td>
<td>
<p>matrix with the estimated mean of the response variable obtained from <code><a href="#topic+prmu.time">prmu.time</a></code>.</p>
</td></tr>
<tr><td><code id="Fbetaf.it_+3A_u1">u1</code></td>
<td>
<p>matrix with the values of the first random effect obtained from <code><a href="#topic+modelfit2">modelfit2</a></code>.</p>
</td></tr>
<tr><td><code id="Fbetaf.it_+3A_u2">u2</code></td>
<td>
<p>matrix with the values of the second random effect obtained from <code><a href="#topic+modelfit2">modelfit2</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components.
</p>
<table role = "presentation">
<tr><td><code>F</code></td>
<td>
<p>the inverse of the Fisher information matrix.</p>
</td></tr>
<tr><td><code>S</code></td>
<td>
<p>(beta, u1, u2) scores</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Small area estimation of labour force indicator under a multinomial mixed model
with correlated time and area effects. Submitted for review.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+phi.mult.it">phi.mult.it</a></code>,
<code><a href="#topic+prmu.time">prmu.time</a></code>, <code><a href="#topic+phi.direct.it">phi.direct.it</a></code>,
<code><a href="#topic+sPhikf.it">sPhikf.it</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+modelfit2">modelfit2</a></code>, <code><a href="#topic+msef.it">msef.it</a></code>,
<code><a href="#topic+mseb">mseb</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
mod=2  #Type of model
data(simdata2) #data
datar=data.mme(simdata2,k,pp,mod)
initial=datar$initial
mean=prmu.time(datar$n,datar$Xk,initial$beta.0,initial$u1.0,initial$u2.0)
sigmap=wmatrix(datar$n,mean$estimated.probabilities)

##The inverse of the Fisher information matrix of the fixed effects
Fisher=Fbetaf.it(sigmap,datar$X,datar$Z,initial$phi1.0,initial$phi2.0,
       datar$y[,1:(k-1)],mean$mean,initial$u1.0,initial$u2.0)
</code></pre>

<hr>
<h2 id='initial.values'>Initial values for fitting algorithm to estimate the fixed and random effects and the variance components</h2><span id='topic+initial.values'></span>

<h3>Description</h3>

<p>This function sets the initial values. An iterative algorithm fits the multinomial mixed models
that requires initial values for the fixed effects, the random
effects and the variance components. This initial values are used in <code><a href="#topic+modelfit1">modelfit1</a></code>,
<code><a href="#topic+modelfit2">modelfit2</a></code> and <code><a href="#topic+modelfit3">modelfit3</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>initial.values(d, pp, datar, mod)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="initial.values_+3A_d">d</code></td>
<td>
<p>number of areas.</p>
</td></tr>
<tr><td><code id="initial.values_+3A_pp">pp</code></td>
<td>
<p>vector with the number of auxiliary variables per category.</p>
</td></tr>
<tr><td><code id="initial.values_+3A_datar">datar</code></td>
<td>
<p>output of function <code><a href="#topic+data.mme">data.mme</a></code>.</p>
</td></tr>
<tr><td><code id="initial.values_+3A_mod">mod</code></td>
<td>
<p>a number specifying the type of model: 1=multinomial mixed model with one independent random effect for each category of the response variable
(Model 1), 2=multinomial mixed model with two independent random effects for each category of the response variable: one domain random effect and another independent time and domain random effect (Model 2) and
3= multinomial mixed model with two independent random effects for each category of the response variable: one domain random effect and another correlated time and domain random effect (Model 3).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components, depending on the chosen model.
</p>
<table role = "presentation">
<tr><td><code>beta.0</code></td>
<td>
<p>a list with the initial values for the fixed effects beta per category.</p>
</td></tr>
<tr><td><code>phi.0</code></td>
<td>
<p>vector with the initial values for the variance components phi of Model 1.</p>
</td></tr>
<tr><td><code>phi1.0</code></td>
<td>
<p>vector with the initial values for the variance components phi1 of Model 2 or 3.</p>
</td></tr>
<tr><td><code>phi2.0</code></td>
<td>
<p>vector with the initial values for the variance components phi2 of Model 2 or 3.</p>
</td></tr>
<tr><td><code>u</code></td>
<td>
<p>matrix with the initial values for the random effect for Model 1.</p>
</td></tr>
<tr><td><code>u1.0</code></td>
<td>
<p>matrix with the initial values for the first random effect for Model 2 or 3.</p>
</td></tr>
<tr><td><code>u2.0</code></td>
<td>
<p>matrix with the initial values for the second random effect for Model 2 or 3.</p>
</td></tr>
<tr><td><code>rho.0</code></td>
<td>
<p>vector with the initial values for the correlation parameter for Model 3.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Multinomial-based small area estimation of labour force indicators.
Statistical Modelling, 13, 153-178.
</p>
<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013). Small area estimation of labour force indicators under a multinomial mixed model
with correlated time and area effects. Submitted for review.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+wmatrix">wmatrix</a></code>,
<code><a href="#topic+phi.mult.it">phi.mult.it</a></code>, <code><a href="#topic+prmu.time">prmu.time</a></code>,
<code><a href="#topic+Fbetaf.it">Fbetaf.it</a></code>, <code><a href="#topic+phi.direct.it">phi.direct.it</a></code>,
<code><a href="#topic+sPhikf.it">sPhikf.it</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+modelfit2">modelfit2</a></code>, <code><a href="#topic+msef.it">msef.it</a></code>,
<code><a href="#topic+mseb">mseb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
data(simdata)
D=nrow(simdata)
mod=1 #Type of model
datar=data.mme(simdata,k,pp,mod)

## Initial values for fixed, random effects and variance components
initial=datar$initial
</code></pre>

<hr>
<h2 id='mmedata'>Create objects of class mmedata</h2><span id='topic+mmedata'></span>

<h3>Description</h3>

<p>This function creates objects of class mmedata.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mmedata(fi, k, pp)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mmedata_+3A_fi">fi</code></td>
<td>
<p>input data set with (d X t) rows and 4+k+sum(pp) columns. The first four columns of the data set are, in this order: the area indicator (integer), the time indicator (integer), the sample size of each domain and the population size of each domain. The following k columns are the categories of the response variable. Then, the auxiliary variables: first, the auxiliary variables of the first category, second, the auxiliary variables of the second category, and so on. Examples of input data set are in <code><a href="#topic+simdata">simdata</a></code>, <code><a href="#topic+simdata2">simdata2</a></code> and <code><a href="#topic+simdata3">simdata3</a></code>.</p>
</td></tr>
<tr><td><code id="mmedata_+3A_k">k</code></td>
<td>
<p>number of categories of the response variable.</p>
</td></tr>
<tr><td><code id="mmedata_+3A_pp">pp</code></td>
<td>
<p>vector with the number of auxiliary variables per category.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+modelfit1">modelfit1</a></code>, <code><a href="#topic+modelfit2">modelfit2</a></code>,
<code><a href="#topic+modelfit3">modelfit3</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
data(simdata)
r=mmedata(simdata,k,pp)
</code></pre>

<hr>
<h2 id='model'>Choose between the three models</h2><span id='topic+model'></span>

<h3>Description</h3>

<p>This function chooses one of the three models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>model(d, t, pp, Xk, X, Z, initial, y, M, MM, mod)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="model_+3A_d">d</code></td>
<td>
<p>number of areas.</p>
</td></tr>
<tr><td><code id="model_+3A_t">t</code></td>
<td>
<p>number of time periods.</p>
</td></tr>
<tr><td><code id="model_+3A_pp">pp</code></td>
<td>
<p>vector with the number of the auxiliary variables per category.</p>
</td></tr>
<tr><td><code id="model_+3A_xk">Xk</code></td>
<td>
<p>list of matrices with the auxiliary variables per category obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of domains.</p>
</td></tr>
<tr><td><code id="model_+3A_x">X</code></td>
<td>
<p>list of matrices with the auxiliary variables obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="model_+3A_z">Z</code></td>
<td>
<p>design matrix of random effects obtained from <code><a href="#topic+data.mme">data.mme</a></code>.</p>
</td></tr>
<tr><td><code id="model_+3A_initial">initial</code></td>
<td>
<p>output of the function <code><a href="#topic+initial.values">initial.values</a></code>.</p>
</td></tr>
<tr><td><code id="model_+3A_y">y</code></td>
<td>
<p>matrix with the response variable obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The rows are the domains and the columns are the categories of the response variable.</p>
</td></tr>
<tr><td><code id="model_+3A_m">M</code></td>
<td>
<p>vector with the area sample sizes.</p>
</td></tr>
<tr><td><code id="model_+3A_mm">MM</code></td>
<td>
<p>vector with the population sample sizes.</p>
</td></tr>
<tr><td><code id="model_+3A_mod">mod</code></td>
<td>
<p>a number specifying the type of models: 1=multinomial mixed model with one independent random effect in each category of the response variable
(Model 1), 2=multinomial mixed model with two independent random effects in each category of the response variable: one domain random effect and another independent time and domain random effect (Model 2) and
3= multinomial model with two independent random effects in each category of the response variable: one domain random effect and another correlated time and domain random effect (Model 3).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the output of the function <code><a href="#topic+modelfit1">modelfit1</a></code>, <code><a href="#topic+modelfit2">modelfit2</a></code> or <code><a href="#topic+modelfit3">modelfit3</a></code>.
</p>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Multinomial-based small area estimation of labour force indicators.
Statistical Modelling, 13 ,153-178.
</p>
<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Small area estimation of labour force indicator under a multinomial mixed model
with correlated time and area effects. Submitted for review.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
data(simdata)  #data
mod=1 #Model 1
datar=data.mme(simdata,k,pp,mod)
result=model(datar$d,datar$t,pp,datar$Xk,datar$X,datar$Z,datar$initial,datar$y[,1:(k-1)],
datar$n,datar$N, mod)
</code></pre>

<hr>
<h2 id='modelfit1'>Function used to fit Model 1</h2><span id='topic+modelfit1'></span>

<h3>Description</h3>

<p>This function fits the multinomial mixed model with one independent random effect per category
of the response variable (Model 1), like in the formulation described in Lopez-Vizcaino et al. (2013).
The fitting algorithm combines the penalized quasi-likelihood method (PQL) for estimating
and predicting the fixed and random effects with the residual maximum likelihood method (REML)
for estimating the variance components. This function uses as initial values the output of the function
<code><a href="#topic+initial.values">initial.values</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>modelfit1(pp, Xk, X, Z, initial, y, M, MM)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="modelfit1_+3A_pp">pp</code></td>
<td>
<p>vector with the number of the auxiliary variables per category.</p>
</td></tr>
<tr><td><code id="modelfit1_+3A_xk">Xk</code></td>
<td>
<p>list of matrices with the auxiliary variables per category obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of domains.</p>
</td></tr>
<tr><td><code id="modelfit1_+3A_x">X</code></td>
<td>
<p>list of matrices with the auxiliary variables obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="modelfit1_+3A_z">Z</code></td>
<td>
<p>design matrix of random effects obtained from <code><a href="#topic+data.mme">data.mme</a></code>.</p>
</td></tr>
<tr><td><code id="modelfit1_+3A_initial">initial</code></td>
<td>
<p>output of the function <code><a href="#topic+initial.values">initial.values</a></code>.</p>
</td></tr>
<tr><td><code id="modelfit1_+3A_y">y</code></td>
<td>
<p>matrix with the response variable except the reference category obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The rows are the domains and the columns are the categories of the
response variable minus 1.</p>
</td></tr>
<tr><td><code id="modelfit1_+3A_m">M</code></td>
<td>
<p>vector with the area sample sizes.</p>
</td></tr>
<tr><td><code id="modelfit1_+3A_mm">MM</code></td>
<td>
<p>vector with the population sample sizes.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components.
</p>
<table role = "presentation">
<tr><td><code>Estimated.probabilities</code></td>
<td>
<p>matrix with the estimated probabilities
for the categories of response variable.</p>
</td></tr>
<tr><td><code>Fisher.information.matrix.phi</code></td>
<td>
<p>Fisher information matrix of the random effect.</p>
</td></tr>
<tr><td><code>Fisher.information.matrix.beta</code></td>
<td>
<p>Fisher information matrix of the fixed effect.</p>
</td></tr>
<tr><td><code>u</code></td>
<td>
<p>matrix with the estimated random effects.</p>
</td></tr>
<tr><td><code>mean</code></td>
<td>
<p>matrix with the estimated mean of the response variable.</p>
</td></tr>
<tr><td><code>warning1</code></td>
<td>
<p>0=OK,1=The model could not be fitted.</p>
</td></tr>
<tr><td><code>warning2</code></td>
<td>
<p>0=OK,1=The value of the variance component is negative: the initial value
is taken.</p>
</td></tr>
<tr><td><code>beta.Stddev.p.value</code></td>
<td>
<p>matrix with the estimated fixed effects, its standard
deviations and its p-values.</p>
</td></tr>
<tr><td><code>phi.Stddev.p.value</code></td>
<td>
<p>matrix with the estimated variance components, its
standard deviations and its p-values.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Multinomial-based small area estimation of labour force indicators.
Statistical Modelling, 13, 153-178.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+phi.mult">phi.mult</a></code>,
<code><a href="#topic+prmu">prmu</a></code>, <code><a href="#topic+phi.direct">phi.direct</a></code>,
<code><a href="#topic+sPhikf">sPhikf</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+Fbetaf">Fbetaf</a></code>, <code><a href="#topic+msef">msef</a></code>,
<code><a href="#topic+mseb">mseb</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
data(simdata)  #data
mod=1 #type of model
datar=data.mme(simdata,k,pp,mod)

#Model fit
result=modelfit1(pp,datar$Xk,datar$X,datar$Z,datar$initial,datar$y[,1:(k-1)],
      datar$n,datar$N)
</code></pre>

<hr>
<h2 id='modelfit2'>Function to fit Model 2</h2><span id='topic+modelfit2'></span>

<h3>Description</h3>

<p>This function fits the multinomial mixed model with two independent random effects
for each category of the response variable: one domain random effect and another independent time and domain random effect (Model 2). The formulation is described in Lopez-Vizcaino et al. (2013).
The fitting algorithm combines the penalized quasi-likelihood method (PQL) for estimating
and predicting the fixed and random effects, respectively, with the residual maximum likelihood method (REML)
for estimating the variance components. This function uses as initial values the output of the function
<code><a href="#topic+initial.values">initial.values</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>modelfit2(d, t, pp, Xk, X, Z, initial, y, M, MM)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="modelfit2_+3A_d">d</code></td>
<td>
<p>number of areas.</p>
</td></tr>
<tr><td><code id="modelfit2_+3A_t">t</code></td>
<td>
<p>number of time periods.</p>
</td></tr>
<tr><td><code id="modelfit2_+3A_pp">pp</code></td>
<td>
<p>vector with the number of the auxiliary variables per category.</p>
</td></tr>
<tr><td><code id="modelfit2_+3A_xk">Xk</code></td>
<td>
<p>list of matrices with the auxiliary variables per category obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of domains.</p>
</td></tr>
<tr><td><code id="modelfit2_+3A_x">X</code></td>
<td>
<p>list of matrices with the auxiliary variables obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="modelfit2_+3A_z">Z</code></td>
<td>
<p>design matrix  of random effects <code><a href="#topic+data.mme">data.mme</a></code>.</p>
</td></tr>
<tr><td><code id="modelfit2_+3A_initial">initial</code></td>
<td>
<p>output of the function <code><a href="#topic+initial.values">initial.values</a></code>.</p>
</td></tr>
<tr><td><code id="modelfit2_+3A_y">y</code></td>
<td>
<p>matrix with the response variable obtained from <code><a href="#topic+data.mme">data.mme</a></code>, except the reference category. The rows are the domains and the columns are the categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="modelfit2_+3A_m">M</code></td>
<td>
<p>vector with the area sample sizes.</p>
</td></tr>
<tr><td><code id="modelfit2_+3A_mm">MM</code></td>
<td>
<p>vector with the population sample sizes.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components.
</p>
<table role = "presentation">
<tr><td><code>Estimated.probabilities</code></td>
<td>
<p>matrix with the estimated probabilities
for the categories of response variable.</p>
</td></tr>
<tr><td><code>Fisher.information.matrix.phi</code></td>
<td>
<p>Fisher information matrix of the variance components.</p>
</td></tr>
<tr><td><code>Fisher.information.matrix.beta</code></td>
<td>
<p>Fisher information matrix of the fixed effects. </p>
</td></tr>
<tr><td><code>u1</code></td>
<td>
<p>matrix with the estimated first random effect.</p>
</td></tr>
<tr><td><code>u2</code></td>
<td>
<p>matrix with the estimated second random effect.</p>
</td></tr>
<tr><td><code>mean</code></td>
<td>
<p>matrix with the estimated mean of response variable.</p>
</td></tr>
<tr><td><code>warning1</code></td>
<td>
<p>0=OK,1=The model could not be fitted.</p>
</td></tr>
<tr><td><code>warning2</code></td>
<td>
<p>0=OK,1=The value of the variance component is negative: the initial value
is taken.</p>
</td></tr>
<tr><td><code>beta.Stddev.p.value</code></td>
<td>
<p>matrix with the estimated fixed effects, its standard
deviations and its p-values.</p>
</td></tr>
<tr><td><code>phi.Stddev.p.value</code></td>
<td>
<p>matrix with the estimated variance components, its
standard deviations and its p-values.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Small area estimation of labour force indicators under a multinomial mixed model
with correlated time and area effects. Submitted for review.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+phi.mult.it">phi.mult.it</a></code>,
<code><a href="#topic+prmu.time">prmu.time</a></code>, <code><a href="#topic+phi.direct.it">phi.direct.it</a></code>,
<code><a href="#topic+sPhikf.it">sPhikf.it</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+Fbetaf.it">Fbetaf.it</a></code>, <code><a href="#topic+msef.it">msef.it</a></code>,
<code><a href="#topic+mseb">mseb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
mod=2 #type of model
data(simdata2)  #data
datar=data.mme(simdata2,k,pp,mod)

##Model fit
result=modelfit2(datar$d,datar$t,pp,datar$Xk,datar$X,datar$Z,datar$initial,datar$y[,1:(k-1)],
       datar$n,datar$N)
</code></pre>

<hr>
<h2 id='modelfit3'>Function used to fit Model 3</h2><span id='topic+modelfit3'></span>

<h3>Description</h3>

<p>This function fits the multinomial mixed model with two independent random effects
for each category of the response variable: one domain random effect and another correlated time and domain random effect (Model 3). The formulation is described in Lopez-Vizcaino et al. (2013).
The fitting algorithm combine the penalized quasi-likelihood method (PQL) for estimating
and predicting the fixed and random effects, respectively, with the residual maximun likelihood method (REML)
for estimating the variance components. This function uses as initial values the output of the function
<code><a href="#topic+initial.values">initial.values</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>modelfit3(d, t, pp, Xk, X, Z, initial, y, M, MM, b)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="modelfit3_+3A_d">d</code></td>
<td>
<p>number of areas.</p>
</td></tr>
<tr><td><code id="modelfit3_+3A_t">t</code></td>
<td>
<p>number of time periods.</p>
</td></tr>
<tr><td><code id="modelfit3_+3A_pp">pp</code></td>
<td>
<p>vector with the number of the auxiliary variables per category.</p>
</td></tr>
<tr><td><code id="modelfit3_+3A_xk">Xk</code></td>
<td>
<p>list of matrices with the auxiliary variables per category obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of domains.</p>
</td></tr>
<tr><td><code id="modelfit3_+3A_x">X</code></td>
<td>
<p>list of matrices with the auxiliary variables obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="modelfit3_+3A_z">Z</code></td>
<td>
<p>design matrix  of random effects obtained from <code><a href="#topic+data.mme">data.mme</a></code>.</p>
</td></tr>
<tr><td><code id="modelfit3_+3A_initial">initial</code></td>
<td>
<p>output of the function <code><a href="#topic+initial.values">initial.values</a></code>.</p>
</td></tr>
<tr><td><code id="modelfit3_+3A_y">y</code></td>
<td>
<p>matrix with the response variable obtained from <code><a href="#topic+data.mme">data.mme</a></code>, except the reference category. The rows are the domains and the columns are the categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="modelfit3_+3A_m">M</code></td>
<td>
<p>vector with the area sample sizes.</p>
</td></tr>
<tr><td><code id="modelfit3_+3A_mm">MM</code></td>
<td>
<p>vector with the population sample sizes.</p>
</td></tr>
<tr><td><code id="modelfit3_+3A_b">b</code></td>
<td>
<p>parameter that indicates the bootstrap.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components.
</p>
<table role = "presentation">
<tr><td><code>Estimated.probabilities</code></td>
<td>
<p>matrix with the estimated probabilities
for the categories of response variable.</p>
</td></tr>
<tr><td><code>Fisher.information.matrix.phi</code></td>
<td>
<p>Fisher information matrix of phi.</p>
</td></tr>
<tr><td><code>Fisher.information.matrix.beta</code></td>
<td>
<p>Fisher information matrix of beta.</p>
</td></tr>
<tr><td><code>u1</code></td>
<td>
<p>matrix with the estimated first random effect.</p>
</td></tr>
<tr><td><code>u2</code></td>
<td>
<p>matrix with the estimated second random effect.</p>
</td></tr>
<tr><td><code>mean</code></td>
<td>
<p>matrix with the estimated mean of the response variable.</p>
</td></tr>
<tr><td><code>warning1</code></td>
<td>
<p>0=OK,1=The model could not be fitted.</p>
</td></tr>
<tr><td><code>warning2</code></td>
<td>
<p>0=OK,1=The value of the variance component is negative: the initial value
is taken.</p>
</td></tr>
<tr><td><code>beta.Stddev.p.value</code></td>
<td>
<p>matrix with the estimated fixed effects, its standard
deviations and its p-values.</p>
</td></tr>
<tr><td><code>phi.Stddev.p.value</code></td>
<td>
<p>matrix with the estimated variance components, its
standard deviations and its p-values.</p>
</td></tr>
<tr><td><code>rho</code></td>
<td>
<p>estimated correlation parameter.</p>
</td></tr>
<tr><td><code>rho.Stddev.p.value</code></td>
<td>
<p>matrix with the estimated correlation parameter, its
standard deviations and its p-values.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Small area estimation of labour force indicators under a multinomial mixed model
with correlated time and area effects. Submitted for review.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+phi.mult.ct">phi.mult.ct</a></code>,
<code><a href="#topic+prmu.time">prmu.time</a></code>, <code><a href="#topic+phi.direct.ct">phi.direct.ct</a></code>,
<code><a href="#topic+sPhikf.ct">sPhikf.ct</a></code>, <code><a href="#topic+omega">omega</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+Fbetaf.ct">Fbetaf.ct</a></code>, <code><a href="#topic+msef.ct">msef.ct</a></code>,
<code><a href="#topic+mseb">mseb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
mod=3 #type of model
data(simdata3)   #data
datar=data.mme(simdata3,k,pp,mod)

##Model fit
result=modelfit3(datar$d,datar$t,pp,datar$Xk,datar$X,datar$Z,datar$initial,datar$y[,1:(k-1)],
       datar$n,datar$N,0)
## End(Not run)
</code></pre>

<hr>
<h2 id='mseb'>Bias and MSE using parametric bootstrap</h2><span id='topic+mseb'></span>

<h3>Description</h3>

<p>This function calculates the bias and the mse for the multinomial mixed effects models
using parametric bootstrap. Three types of multinomial mixed models are considered, with one independent domain random effect in each category of the response variable  (Model 1),
with two random effects: the first, with a domain random effect and with independent time and domain random effect (Model 2) and the second, with a domain random effect and with correlated time and domain random effect (Model 3).
See details of the parametric bootstrap procedure in Gonzalez-Manteiga et al. (2008) and in Lopez-Vizcaino et al. (2013)
for the adaptation to these three models. This function uses the output of <code><a href="#topic+modelfit1">modelfit1</a></code>, <code><a href="#topic+modelfit2">modelfit2</a></code> or <code><a href="#topic+modelfit3">modelfit3</a></code>,
depending of the current multinomial mixed model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mseb(pp, Xk, X, Z, M, MM, resul, B, mod)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mseb_+3A_pp">pp</code></td>
<td>
<p>vector with the number of the auxiliary variables per category.</p>
</td></tr>
<tr><td><code id="mseb_+3A_xk">Xk</code></td>
<td>
<p>list of matrices with the auxiliary variables per category obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of domains.</p>
</td></tr>
<tr><td><code id="mseb_+3A_x">X</code></td>
<td>
<p>list of matrices with the auxiliary variables obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="mseb_+3A_z">Z</code></td>
<td>
<p>design matrix of random effects obtained from <code><a href="#topic+data.mme">data.mme</a></code>.</p>
</td></tr>
<tr><td><code id="mseb_+3A_m">M</code></td>
<td>
<p>vector with the area sample sizes.</p>
</td></tr>
<tr><td><code id="mseb_+3A_mm">MM</code></td>
<td>
<p>vector with the population sample sizes.</p>
</td></tr>
<tr><td><code id="mseb_+3A_resul">resul</code></td>
<td>
<p>output of the function <code><a href="#topic+modelfit1">modelfit1</a></code>, <code><a href="#topic+modelfit2">modelfit2</a></code> or <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
<tr><td><code id="mseb_+3A_b">B</code></td>
<td>
<p>number of bootstrap replications.</p>
</td></tr>
<tr><td><code id="mseb_+3A_mod">mod</code></td>
<td>
<p>a number specifying the type of models: 1=multinomial mixed model with one independent random effect in each category of the response variable
(Model 1), 2=multinomial mixed model with two independent random effects in each category of the response variable: one domain random effect and another independent time and domain random effect (Model 2) and
3= multinomial model with two independent random effects in each category of the response variable: one domain random effect and another correlated time and domain random effect (Model 3).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list containing the following components.
</p>
<table role = "presentation">
<tr><td><code>bias.pboot</code></td>
<td>
<p>BIAS of the parametric bootstrap estimator of the mean of the response variable</p>
</td></tr>
<tr><td><code>mse.pboot</code></td>
<td>
<p>MSE of the parametric bootstrap estimator of the mean of the response variable</p>
</td></tr>
<tr><td><code>rmse.pboot</code></td>
<td>
<p>RMSE of the parametric bootstrap estimator of the mean of the response variable</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Multinomial-based small area estimation of labour force indicators.
Statistical Modelling, 13 ,153-178.
</p>
<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Small area estimation of labour force indicator under a multinomial mixed model
with correlated time and area effects. Submitted for review.
</p>
<p>Gonzalez-Manteiga, W, Lombardia, MJ, Molina, I, Morales, D, Santamaria, L (2008). Estimation of the mean
squared error of predictors of small area linear parameters under a logistic mixed model, Computational Statistics
and Data Analysis, 51, 2720-2733.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+phi.mult">phi.mult</a></code>, <code><a href="#topic+phi.mult.it">phi.mult.it</a></code>,
<code><a href="#topic+phi.mult.ct">phi.mult.ct</a></code>, <code><a href="#topic+prmu">prmu</a></code>, <code><a href="#topic+prmu.time">prmu.time</a></code>, <code><a href="#topic+phi.direct">phi.direct</a></code>,
<code><a href="#topic+phi.direct.it">phi.direct.it</a></code>, <code><a href="#topic+phi.direct.ct">phi.direct.ct</a></code>, <code><a href="#topic+sPhikf">sPhikf</a></code>, <code><a href="#topic+sPhikf.it">sPhikf.it</a></code>,
<code><a href="#topic+sPhikf.ct">sPhikf.ct</a></code>, <code><a href="#topic+modelfit1">modelfit1</a></code>, <code><a href="#topic+modelfit2">modelfit2</a></code>,
<code><a href="#topic+modelfit3">modelfit3</a></code>, <code><a href="#topic+omega">omega</a></code>,
<code><a href="#topic+Fbetaf">Fbetaf</a></code>, <code><a href="#topic+Fbetaf.it">Fbetaf.it</a></code>, <code><a href="#topic+Fbetaf.ct">Fbetaf.ct</a></code>,
<code><a href="#topic+ci">ci</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
data(simdata)
mod=1  # Type of model
datar=data.mme(simdata,k,pp,mod)
##Model fit
result=modelfit1(pp,datar$Xk,datar$X,datar$Z,datar$initial,datar$y[,1:(k-1)],datar$n,datar$N)

B=1    #Bootstrap iterations
ss=12345 #SEED
set.seed(ss)

##Bootstrap parametric BIAS and MSE
mse.pboot=mseb(pp,datar$Xk,datar$X,datar$Z,datar$n,datar$N,result,B,mod)
</code></pre>

<hr>
<h2 id='msef'>Analytic MSE for Model 1</h2><span id='topic+msef'></span>

<h3>Description</h3>

<p>This function calculates the analytic MSE for the multinomial mixed model with one independent random effect per category
of the response variable (Model 1). See Lopez-Vizcaino et al. (2013), section 4, for details. The formulas
of Prasad and Rao (1990) are adapted to Model 1. This function uses the output of <code><a href="#topic+modelfit1">modelfit1</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>msef(pp, X, Z, resul, MM, M)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="msef_+3A_resul">resul</code></td>
<td>
<p>the output of the function <code><a href="#topic+modelfit1">modelfit1</a></code>.</p>
</td></tr>
<tr><td><code id="msef_+3A_x">X</code></td>
<td>
<p>list of matrices with the auxiliary variables obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="msef_+3A_z">Z</code></td>
<td>
<p>design matrix of random effects obtained from <code><a href="#topic+data.mme">data.mme</a></code>.</p>
</td></tr>
<tr><td><code id="msef_+3A_pp">pp</code></td>
<td>
<p>vector with the number of the auxiliary variables per category.</p>
</td></tr>
<tr><td><code id="msef_+3A_m">M</code></td>
<td>
<p>vector with the area sample sizes.</p>
</td></tr>
<tr><td><code id="msef_+3A_mm">MM</code></td>
<td>
<p>vector with the population sample sizes.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>mse is a matrix with the MSE estimator calculated by adapting the explicit
formulas of Prasad and  Rao (1990).
</p>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Multinomial-based small area estimation of labour force indicators.
Statistical Modelling, 13, 153-178.
</p>
<p>Prasad, NGN, Rao, JNK (1990).The estimation of the mean squared error of small
area estimators. Journal of the American Statistical Association, 85, 163-171.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+phi.mult">phi.mult</a></code>,
<code><a href="#topic+prmu">prmu</a></code>, <code><a href="#topic+phi.direct">phi.direct</a></code>,
<code><a href="#topic+sPhikf">sPhikf</a></code>, <code><a href="#topic+modelfit1">modelfit1</a></code>,
<code><a href="#topic+Fbetaf">Fbetaf</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+mseb">mseb</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require(Matrix)

k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
data(simdata)  #data
mod=1 # type of model
datar=data.mme(simdata,k,pp,mod)
# Model fit
result=modelfit1(pp,datar$Xk,datar$X,datar$Z,datar$initial,datar$y[,1:(k-1)],
       datar$n,datar$N)

#Analytic MSE
mse=msef(pp,datar$X,datar$Z,result,datar$N,datar$n)
</code></pre>

<hr>
<h2 id='msef.ct'>Analytic MSE for Model 3</h2><span id='topic+msef.ct'></span>

<h3>Description</h3>

<p>This function calculates the analytic MSE for the multinomial mixed model with two independent random effects
for each category of the response variable: one  random effect associated with the domain and another correlated random effect associated with time and domain (Model 3). See details of the model and the expresion of mse in Lopez-Vizcaino et al. (2013). The formulas
of Prasad and Rao (1990) are adapted to Model 3. This function uses the output of <code><a href="#topic+modelfit3">modelfit3</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>msef.ct(p, X, result, M, MM)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="msef.ct_+3A_p">p</code></td>
<td>
<p>vector with the number of the auxiliary variables per category.</p>
</td></tr>
<tr><td><code id="msef.ct_+3A_x">X</code></td>
<td>
<p>list of matrices with the auxiliary variables obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="msef.ct_+3A_result">result</code></td>
<td>
<p>the output of the function <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
<tr><td><code id="msef.ct_+3A_m">M</code></td>
<td>
<p>vector with the area sample sizes.</p>
</td></tr>
<tr><td><code id="msef.ct_+3A_mm">MM</code></td>
<td>
<p>vector with the population sample sizes.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>mse.analitic is a matrix with the MSE estimator calculated by adapting the explicit
formulas of Prasad and  Rao (1990).
</p>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Small area estimation of labour force indicators under a multinomial mixed model
with correlated time and area effects. Submitted for review.
</p>
<p>Prasad, NGN, Rao, JNK (1990).The estimation of the mean squared error of small
area estimators. Journal of the American Statistical Association, 85, 163-171.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+phi.mult.ct">phi.mult.ct</a></code>,
<code><a href="#topic+prmu.time">prmu.time</a></code>, <code><a href="#topic+phi.direct.ct">phi.direct.ct</a></code>,
<code><a href="#topic+sPhikf.ct">sPhikf.ct</a></code>, <code><a href="#topic+modelfit3">modelfit3</a></code>,
<code><a href="#topic+Fbetaf.ct">Fbetaf.ct</a></code>, <code><a href="#topic+ci">ci</a></code>, <code><a href="#topic+omega">omega</a></code>,
<code><a href="#topic+mseb">mseb</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
mod=3 #type of model
data(simdata3) #data
datar=data.mme(simdata3,k,pp,mod)
##Model fit
result=modelfit3(d,t,pp,datar$Xk,datar$X,datar$Z,datar$initial,datar$y[,1:(k-1)],
       datar$n,datar$N,0)

##Analytic MSE
msef=msef.ct(pp,datar$X,result,datar$n,datar$N)
## End(Not run)
</code></pre>

<hr>
<h2 id='msef.it'>Analytic MSE for Model 2</h2><span id='topic+msef.it'></span>

<h3>Description</h3>

<p>This function calculates the analytic MSE for the multinomial mixed model with two independent random effects
for each category of the response variable: one  random effect associated with the domain and another independent random effect associated with time and domain (Model 2).
See details of the model and the expresion of mse in Lopez-Vizcaino et al. (2013). The formulas
of Prasad and Rao (1990) are adapted to Model 2. This function uses the output of <code><a href="#topic+modelfit2">modelfit2</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>msef.it(p, X, result, M, MM)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="msef.it_+3A_p">p</code></td>
<td>
<p>vector with the number of the auxiliary variables per category.</p>
</td></tr>
<tr><td><code id="msef.it_+3A_x">X</code></td>
<td>
<p>list of matrices with the auxiliary variables obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="msef.it_+3A_result">result</code></td>
<td>
<p>the output of the function <code><a href="#topic+modelfit2">modelfit2</a></code>.</p>
</td></tr>
<tr><td><code id="msef.it_+3A_m">M</code></td>
<td>
<p>vector with the area sample sizes.</p>
</td></tr>
<tr><td><code id="msef.it_+3A_mm">MM</code></td>
<td>
<p>vector with the population sample sizes.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>mse.analitic is a matrix with the MSE estimator calculated by adapting the explicit
formulas of Prasad and  Rao (1990). The matrix dimension is the number of domains multiplied by the number of categories minus 1.
</p>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Small area estimation of labour force indicator under a multinomial mixed model
with correlated time and area effects. Submitted for review.
</p>
<p>Prasad, NGN, Rao, JNK (1990).The estimation of the mean squared error of small
area estimators. Journal of the American Statistical Association, 85, 163-171.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+phi.mult.it">phi.mult.it</a></code>,
<code><a href="#topic+prmu.time">prmu.time</a></code>, <code><a href="#topic+phi.direct.it">phi.direct.it</a></code>,
<code><a href="#topic+sPhikf.it">sPhikf.it</a></code>, <code><a href="#topic+modelfit2">modelfit2</a></code>,
<code><a href="#topic+Fbetaf.it">Fbetaf.it</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+mseb">mseb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
mod=2 #type of model
data(simdata2)
datar=data.mme(simdata2,k,pp,mod)
##Model fit
result=modelfit2(datar$d,datar$t,pp,datar$Xk,datar$X,datar$Z,datar$initial,datar$y[,1:(k-1)],
       datar$n,datar$N)

##Analytic MSE
msef=msef.it(pp,datar$X,result,datar$n,datar$N)
</code></pre>

<hr>
<h2 id='omega'>Model correlation matrix for Model 3</h2><span id='topic+omega'></span>

<h3>Description</h3>

<p>This function calculates the model correlation matrix and the first derivative of the model correlation matrix for Model 3. Model 3 is the multinomial mixed model with two independent random effects
for each category of the response variable: one domain random effect and another correlated time and domain random effect.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>omega(t, k, rho, phi2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="omega_+3A_t">t</code></td>
<td>
<p>number of time periods.</p>
</td></tr>
<tr><td><code id="omega_+3A_k">k</code></td>
<td>
<p>number of categories of the response variable.</p>
</td></tr>
<tr><td><code id="omega_+3A_rho">rho</code></td>
<td>
<p>vector with the correlation parameter obtained from <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
<tr><td><code id="omega_+3A_phi2">phi2</code></td>
<td>
<p>vector with the values of the second variance component obtained from <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components.
</p>
<table role = "presentation">
<tr><td><code>Omega.d</code></td>
<td>
<p>correlation matrix.</p>
</td></tr>
<tr><td><code>First.derivative.Omegad</code></td>
<td>
<p>Fisher derivative of the model correlation matrix.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Small area estimation of labour force indicator under a multinomial mixed model
with correlated time and area effects. Submitted for review.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code> ,<code><a href="#topic+phi.mult.ct">phi.mult.ct</a></code>,
<code><a href="#topic+prmu.time">prmu.time</a></code>, <code><a href="#topic+phi.direct.ct">phi.direct.ct</a></code>,
<code><a href="#topic+Fbetaf.ct">Fbetaf.ct</a></code>, <code><a href="#topic+sPhikf.ct">sPhikf.ct</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+modelfit3">modelfit3</a></code>, <code><a href="#topic+msef.ct">msef.ct</a></code>,
<code><a href="#topic+mseb">mseb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
mod=3 #type of model
data(simdata3)   #data
datar=data.mme(simdata3,k,pp,mod)
initial=datar$initial
mean=prmu.time(datar$n,datar$Xk,initial$beta.0,initial$u1.0,initial$u2.0)

##The model correlation matrix
matrix.corr=omega(datar$t,k,initial$rho.0,initial$phi2.0)
</code></pre>

<hr>
<h2 id='phi.direct'>Variance components for Model 1</h2><span id='topic+phi.direct'></span>

<h3>Description</h3>

<p>This function calculates the variance components for the multinomial mixed model with
one independent random effect in each category
of the response variable (Model 1). These values are used in the second part of the fitting algorithm
implemented in <code><a href="#topic+modelfit1">modelfit1</a></code>. The algorithm adapts the ideas of Schall (1991) to a
multivariate model and the variance components are estimated by the REML method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phi.direct(sigmap, phi, X, u)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phi.direct_+3A_sigmap">sigmap</code></td>
<td>
<p>a list with the model variance-covariance matrices for each domain obtained from <code><a href="#topic+wmatrix">wmatrix</a></code>.</p>
</td></tr>
<tr><td><code id="phi.direct_+3A_x">X</code></td>
<td>
<p>list of matrices with the auxiliary variables obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="phi.direct_+3A_phi">phi</code></td>
<td>
<p>vector with the initial values of the variance components obtained from <code><a href="#topic+modelfit1">modelfit1</a></code>.</p>
</td></tr>
<tr><td><code id="phi.direct_+3A_u">u</code></td>
<td>
<p>matrix with the values of the random effects obtained from <code><a href="#topic+modelfit1">modelfit1</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list containing the following components.
</p>
<table role = "presentation">
<tr><td><code>phi.new</code></td>
<td>
<p>vector with the variance components.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Multinomial-based small area estimation of labour force indicators.
Statistical Modelling, 13 ,153-178.
</p>
<p>Schall, R (1991). Estimation in generalized linear models with
random effects. Biometrika,
78,719-727.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+phi.mult">phi.mult</a></code>,
<code><a href="#topic+prmu">prmu</a></code>, <code><a href="#topic+Fbetaf">Fbetaf</a></code>,
<code><a href="#topic+sPhikf">sPhikf</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+modelfit1">modelfit1</a></code>, <code><a href="#topic+msef">msef</a></code>,
<code><a href="#topic+mseb">mseb</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
data(simdata)   #data
mod=1 #type of model
datar=data.mme(simdata,k,pp,mod)
initial=datar$initial
mean=prmu(datar$n,datar$Xk,initial$beta.0,initial$u.0)
#model variance-covariance matrix
sigmap=wmatrix(datar$n,mean$estimated.probabilities)

##Variance components
phi=phi.direct(sigmap,initial$phi.0,datar$X,initial$u.0)
</code></pre>

<hr>
<h2 id='phi.direct.ct'>Variance components for Model 3</h2><span id='topic+phi.direct.ct'></span>

<h3>Description</h3>

<p>This function calculates the variance components for the multinomial mixed model with two independent random effects
for each category of the response variable: one domain random effect and another correlated time and domain random effect (Model 3). This variance components
are used in the second part of the fitting algorithm
implemented in <code><a href="#topic+modelfit3">modelfit3</a></code>. The algorithm adapts the ideas of Schall (1991) to a multivariate model. The variance components are
estimated by the REML method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phi.direct.ct(p, sigmap, X, theta, phi1, phi2, u1, u2, rho)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phi.direct.ct_+3A_p">p</code></td>
<td>
<p>vector with the number of auxiliary variables per category.</p>
</td></tr>
<tr><td><code id="phi.direct.ct_+3A_sigmap">sigmap</code></td>
<td>
<p>a list with the model variance-covariance matrices for each domain obtained from <code><a href="#topic+wmatrix">wmatrix</a></code>.</p>
</td></tr>
<tr><td><code id="phi.direct.ct_+3A_x">X</code></td>
<td>
<p>list of matrices with the auxiliary variables obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="phi.direct.ct_+3A_theta">theta</code></td>
<td>
<p>matrix with the estimated log-probabilites of each category in front of the reference category obtained from <code><a href="#topic+prmu.time">prmu.time</a></code>.</p>
</td></tr>
<tr><td><code id="phi.direct.ct_+3A_phi1">phi1</code></td>
<td>
<p>vector with the initial values of the first variance component obtained from <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
<tr><td><code id="phi.direct.ct_+3A_phi2">phi2</code></td>
<td>
<p>vector with the initial values of the second variance component obtained from <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
<tr><td><code id="phi.direct.ct_+3A_u1">u1</code></td>
<td>
<p>matrix with the values of the first random effect obtained from <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
<tr><td><code id="phi.direct.ct_+3A_u2">u2</code></td>
<td>
<p>matrix with the values of the second random effect obtained from <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
<tr><td><code id="phi.direct.ct_+3A_rho">rho</code></td>
<td>
<p>vector with the initial values of the correlation parameter obtained from <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list containing the following components.
</p>
<table role = "presentation">
<tr><td><code>phi1.new</code></td>
<td>
<p>vector with the values of the variance component for the first random effect.</p>
</td></tr>
<tr><td><code>phi2.new</code></td>
<td>
<p>vector with the values of the variance component for the second random effect.</p>
</td></tr>
<tr><td><code>rho.new</code></td>
<td>
<p>vector with the correlation parameter.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Small area estimation of labour force indicator under a multinomial mixed model
with correlated time and area effects. Submitted for review.
</p>
<p>Schall, R (1991). Estimation in generalized linear models with
random effects. Biometrika,
78,719-727.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+phi.mult.ct">phi.mult.ct</a></code>,
<code><a href="#topic+prmu.time">prmu.time</a></code>, <code><a href="#topic+Fbetaf.ct">Fbetaf.ct</a></code>
<code><a href="#topic+sPhikf.ct">sPhikf.ct</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+modelfit3">modelfit3</a></code>, <code><a href="#topic+msef.ct">msef.ct</a></code>,
<code><a href="#topic+mseb">mseb</a></code>, <code><a href="#topic+omega">omega</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
mod=3 #type of model
data(simdata3) #data
datar=data.mme(simdata3,k,pp,mod)
initial=datar$initial
mean=prmu.time(datar$n,datar$Xk,initial$beta.0,initial$u1.0,initial$u2.0)
sigmap=wmatrix(datar$n,mean$estimated.probabilities)

##The variance components
phi.ct=phi.direct.ct(pp,sigmap,datar$X,mean$eta,initial$phi1.0,
       initial$phi2.0,initial$u1.0,initial$u2.0,initial$rho.0)
</code></pre>

<hr>
<h2 id='phi.direct.it'>Variance components for Model 2</h2><span id='topic+phi.direct.it'></span>

<h3>Description</h3>

<p>This function calculates the variance components for the multinomial mixed model with two independent random effects
for each category of the response variable: one domain random effect and another independent time and domain random effect (Model 2). This variance components
are used in the second part of the fitting algorithm
implemented in <code><a href="#topic+modelfit2">modelfit2</a></code>. The algorithm adapts the ideas of Schall (1991) to a multivariate model. The variance components are
estimated by the REML method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phi.direct.it(pp, sigmap, X, phi1, phi2, u1, u2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phi.direct.it_+3A_pp">pp</code></td>
<td>
<p>vector with the number of auxiliary variables per category.</p>
</td></tr>
<tr><td><code id="phi.direct.it_+3A_sigmap">sigmap</code></td>
<td>
<p>a list with the model variance-covariance matrices for each domain obtained from <code><a href="#topic+wmatrix">wmatrix</a></code>.</p>
</td></tr>
<tr><td><code id="phi.direct.it_+3A_x">X</code></td>
<td>
<p>list of matrices with the auxiliary variables obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of categories of the response variable.</p>
</td></tr>
<tr><td><code id="phi.direct.it_+3A_phi1">phi1</code></td>
<td>
<p>vector with the initial values of the first variance component obtained from <code><a href="#topic+modelfit2">modelfit2</a></code>.</p>
</td></tr>
<tr><td><code id="phi.direct.it_+3A_phi2">phi2</code></td>
<td>
<p>vector with the initial values of the second variance component obtained from <code><a href="#topic+modelfit2">modelfit2</a></code>.</p>
</td></tr>
<tr><td><code id="phi.direct.it_+3A_u1">u1</code></td>
<td>
<p>matrix with the values of the first random effect obtained from <code><a href="#topic+modelfit2">modelfit2</a></code>.</p>
</td></tr>
<tr><td><code id="phi.direct.it_+3A_u2">u2</code></td>
<td>
<p>matrix with the values of the second random effect obtained from <code><a href="#topic+modelfit2">modelfit2</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list containing the following components.
</p>
<table role = "presentation">
<tr><td><code>phi1.new</code></td>
<td>
<p>vector with the values of the variance component for the first random effect.</p>
</td></tr>
<tr><td><code>phi2.new</code></td>
<td>
<p>vector with the values of the variance component for the second random effect.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Small area estimation of labour force indicators under a multinomial mixed model
with correlated time and area effects. Submitted for review.
</p>
<p>Schall, R (1991). Estimation in generalized linear models with
random effects. Biometrika,
78,719-727.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+phi.mult.it">phi.mult.it</a></code>,
<code><a href="#topic+prmu.time">prmu.time</a></code>, <code><a href="#topic+Fbetaf.it">Fbetaf.it</a></code>
<code><a href="#topic+sPhikf.it">sPhikf.it</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+modelfit2">modelfit2</a></code>, <code><a href="#topic+msef.it">msef.it</a></code>,
<code><a href="#topic+mseb">mseb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
d=10 #number of areas
mod=2  #Type of model
data(simdata2)   #data
datar=data.mme(simdata2,k,pp,mod)
initial=datar$initial
mean=prmu.time(datar$n,datar$Xk,initial$beta.0,initial$u1.0,initial$u2.0)
sigmap=wmatrix(datar$n,mean$estimated.probabilities) #variance-covariance

## The variance components
phi.it=phi.direct.it(pp,sigmap,datar$X,initial$phi1.0,initial$phi2.0,
       initial$u1.0,initial$u2.0)
</code></pre>

<hr>
<h2 id='phi.mult'>Initial values for the variance components for Model 1</h2><span id='topic+phi.mult'></span>

<h3>Description</h3>

<p>This function is used in <code><a href="#topic+initial.values">initial.values</a></code> to calculate the initial values for the variance
components in the multinomial mixed model with one independent random effect in each category
of the response variable (Model 1).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phi.mult(beta.0, y, Xk, M)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phi.mult_+3A_beta.0">beta.0</code></td>
<td>
<p>initial values for the fixed effects obtained in <code><a href="#topic+initial.values">initial.values</a></code>.</p>
</td></tr>
<tr><td><code id="phi.mult_+3A_y">y</code></td>
<td>
<p>matrix with the response variable obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The rows are the domains and the columns are the categories of the response variable.</p>
</td></tr>
<tr><td><code id="phi.mult_+3A_xk">Xk</code></td>
<td>
<p>list of matrices with the auxiliary variables per category obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of domains.</p>
</td></tr>
<tr><td><code id="phi.mult_+3A_m">M</code></td>
<td>
<p>vector with the sample size of the areas.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>phi.0 vector of inicial values for the variance components
</p>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Multinomial-based small area estimation of labour force indicators.
Statistical Modelling, 13, 153-178.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+prmu">prmu</a></code>,
<code><a href="#topic+Fbetaf">Fbetaf</a></code>, <code><a href="#topic+phi.direct">phi.direct</a></code>,
<code><a href="#topic+sPhikf">sPhikf</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+modelfit1">modelfit1</a></code>, <code><a href="#topic+msef">msef</a></code>,
<code><a href="#topic+mseb">mseb</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
data(simdata) #data
mod=1 #type of model
datar=data.mme(simdata,k,pp,mod)
###beta values
beta.new=list()
beta.new[[1]]=matrix(c( 1.3,-1),2,1)
beta.new[[2]]=matrix(c( -1.6,1),2,1)

##Initial variance components
phi=phi.mult(beta.new,datar$y,datar$Xk,datar$n)
</code></pre>

<hr>
<h2 id='phi.mult.ct'>Initial values for the variance components in Model 3</h2><span id='topic+phi.mult.ct'></span>

<h3>Description</h3>

<p>This function is used in <code><a href="#topic+initial.values">initial.values</a></code> to calculate the initial values for the variance
components in the multinomial mixed model with two independent random effects
for each category of the response variable: one domain random effect and another correlated time and domain random effect (Model 3).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phi.mult.ct(beta.0, y, Xk, M, u1, u2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phi.mult.ct_+3A_beta.0">beta.0</code></td>
<td>
<p>a list with the initial values for the fixed effects per category obtained from <code><a href="#topic+initial.values">initial.values</a></code>.</p>
</td></tr>
<tr><td><code id="phi.mult.ct_+3A_y">y</code></td>
<td>
<p>matrix with the response variable obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The rows are the domains and the columns are the categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="phi.mult.ct_+3A_xk">Xk</code></td>
<td>
<p>list of matrices with the auxiliary variables per category obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of domains.</p>
</td></tr>
<tr><td><code id="phi.mult.ct_+3A_m">M</code></td>
<td>
<p>vector with the sample size of the areas.</p>
</td></tr>
<tr><td><code id="phi.mult.ct_+3A_u1">u1</code></td>
<td>
<p>matrix with the values for the first random effect obtained from <code><a href="#topic+initial.values">initial.values</a></code>.</p>
</td></tr>
<tr><td><code id="phi.mult.ct_+3A_u2">u2</code></td>
<td>
<p>matrix with the values for the second random effect obtained from <code><a href="#topic+initial.values">initial.values</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components.
</p>
<table role = "presentation">
<tr><td><code>phi.0</code></td>
<td>
<p>vector of the initial values for the variance components.</p>
</td></tr>
<tr><td><code>rho.0</code></td>
<td>
<p>vector of the initial values for the correlation parameter.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Small area estimation of labour force indicators under a multinomial mixed model
with correlated time and area effects. Submitted for review.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+prmu.time">prmu.time</a></code>,
<code><a href="#topic+Fbetaf.ct">Fbetaf.ct</a></code>, <code><a href="#topic+phi.direct.ct">phi.direct.ct</a></code>,
<code><a href="#topic+sPhikf.ct">sPhikf.ct</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+modelfit3">modelfit3</a></code>, <code><a href="#topic+msef.ct">msef.ct</a></code>,<code><a href="#topic+omega">omega</a></code>,
<code><a href="#topic+mseb">mseb</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
mod=3  #type of model
data(simdata3) #data
D=nrow(simdata3)
datar=data.mme(simdata3,k,pp,mod)
###Fixed effects values
beta.new=list()
beta.new[[1]]=matrix(c( 1.3,-1),2,1)
beta.new[[2]]=matrix(c( -1.6,1),2,1)
## Random effects values
u1.new=rep(0.01,((k-1)*datar$d))
dim(u1.new)=c(datar$d,k-1)
u2.new=rep(0.01,((k-1)*D))
dim(u2.new)=c(D,k-1)

## Initial variance components
phi=phi.mult.ct(beta.new,datar$y,datar$Xk,datar$n,u1.new,u2.new)
</code></pre>

<hr>
<h2 id='phi.mult.it'>Initial values for the variance components in Model 2</h2><span id='topic+phi.mult.it'></span>

<h3>Description</h3>

<p>This function is used in <code><a href="#topic+initial.values">initial.values</a></code> to calculate the initial values for the variance
components in the multinomial mixed model with two independent random effects
for each category of the response variable: one domain random effect (u1) and another independent time and domain random effect (u2) (Model 2).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phi.mult.it(beta.0, y, Xk, M, u1, u2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phi.mult.it_+3A_beta.0">beta.0</code></td>
<td>
<p>initial values for the fixed effects obtained from <code><a href="#topic+initial.values">initial.values</a></code>.</p>
</td></tr>
<tr><td><code id="phi.mult.it_+3A_y">y</code></td>
<td>
<p>matrix with the response variable obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The rows are the domains and the columns are the categories of the response variable.</p>
</td></tr>
<tr><td><code id="phi.mult.it_+3A_xk">Xk</code></td>
<td>
<p>list of matrices with the auxiliary variables per category obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of domains.</p>
</td></tr>
<tr><td><code id="phi.mult.it_+3A_m">M</code></td>
<td>
<p>vector with the sample size of the areas.</p>
</td></tr>
<tr><td><code id="phi.mult.it_+3A_u1">u1</code></td>
<td>
<p>vector with the initial values for the first random effect obtained from <code><a href="#topic+initial.values">initial.values</a></code>.</p>
</td></tr>
<tr><td><code id="phi.mult.it_+3A_u2">u2</code></td>
<td>
<p>vector with the initial values for the second random effect obtained from <code><a href="#topic+initial.values">initial.values</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>phi.0 vector of the initial values for the variance components.
</p>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Multinomial-based small area estimation of labour force indicators.
Statistical Modelling, 13, 153-178.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+prmu.time">prmu.time</a></code>,
<code><a href="#topic+Fbetaf.it">Fbetaf.it</a></code>, <code><a href="#topic+phi.direct.it">phi.direct.it</a></code>,
<code><a href="#topic+sPhikf.it">sPhikf.it</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+modelfit2">modelfit2</a></code>, <code><a href="#topic+msef.it">msef.it</a></code>,
<code><a href="#topic+mseb">mseb</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
data(simdata2)  #data
mod=2 #Type of model
datar=data.mme(simdata2,k,pp,mod)
D=nrow(simdata2)
###fixed effects values
beta.new=list()
beta.new[[1]]=matrix(c( 1.3,-1),2,1)
beta.new[[2]]=matrix(c( -1.6,1),2,1)
## random effects values
u1.new=rep(0.01,((k-1)*datar$d))
dim(u1.new)=c(datar$d,k-1)
u2.new=rep(0.01,((k-1)*D))
dim(u2.new)=c(D,k-1)

##Initial variance components
phi=phi.mult.it(beta.new,datar$y,datar$Xk,datar$n,u1.new,u2.new)
</code></pre>

<hr>
<h2 id='print.mme'>Print objects of class mme</h2><span id='topic+print.mme'></span>

<h3>Description</h3>

<p>This function prints objects of class mme.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mme'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.mme_+3A_x">x</code></td>
<td>
<p>a list with the output of <code><a href="#topic+modelfit1">modelfit1</a></code>, <code><a href="#topic+modelfit2">modelfit2</a></code> or <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
<tr><td><code id="print.mme_+3A_...">...</code></td>
<td>
<p>further information.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+modelfit1">modelfit1</a></code>, <code><a href="#topic+modelfit2">modelfit2</a></code>,
<code><a href="#topic+modelfit3">modelfit3</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
mod=1  # Type of model
data(simdata)
datar=data.mme(simdata,k,pp,mod)
##Model fit
result=modelfit1(pp,datar$Xk,datar$X,datar$Z,datar$initial,datar$y[,1:(k-1)],datar$n,datar$N)
result
</code></pre>

<hr>
<h2 id='prmu'>Estimated mean and probabilities for Model 1</h2><span id='topic+prmu'></span>

<h3>Description</h3>

<p>This function calculates the estimated probabilities and the estimated mean
of the response variable, in the multinomial mixed model with one independent random effect in each category
of the response variable (Model 1).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prmu(M, Xk, beta, u)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="prmu_+3A_m">M</code></td>
<td>
<p>vector with the area sample sizes.</p>
</td></tr>
<tr><td><code id="prmu_+3A_xk">Xk</code></td>
<td>
<p>list of matrices with the auxiliary variables per category obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of domains.</p>
</td></tr>
<tr><td><code id="prmu_+3A_beta">beta</code></td>
<td>
<p>fixed effects obtained from <code><a href="#topic+modelfit1">modelfit1</a></code>.</p>
</td></tr>
<tr><td><code id="prmu_+3A_u">u</code></td>
<td>
<p>values of random effects obtained from <code><a href="#topic+modelfit1">modelfit1</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components:
</p>
<table role = "presentation">
<tr><td><code>Estimated.probabilities</code></td>
<td>
<p>matrix with the estimated probabilities
for the categories of response variable.</p>
</td></tr>
<tr><td><code>mean</code></td>
<td>
<p> matrix with the estimated mean of the response variable.</p>
</td></tr>
<tr><td><code>eta</code></td>
<td>
<p>matrix with the estimated log-rates of the probabilities of each category over the reference category.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Multinomial-based small area estimation of labour force indicators.
Statistical Modelling, 13, 153-178.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+phi.mult">phi.mult</a></code>,
<code><a href="#topic+Fbetaf">Fbetaf</a></code>, <code><a href="#topic+phi.direct">phi.direct</a></code>,
<code><a href="#topic+sPhikf">sPhikf</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+modelfit1">modelfit1</a></code>, <code><a href="#topic+msef">msef</a></code>,
<code><a href="#topic+mseb">mseb</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
data(simdata) #data
mod=1 #type of model
D=nrow(simdata)
datar=data.mme(simdata,k,pp,mod)
initial=datar$initial

##Estimated mean and probabilities
mean=prmu(datar$n,datar$Xk,initial$beta.0,initial$u.0)
</code></pre>

<hr>
<h2 id='prmu.time'>Estimated mean and probabilities for Model 2 and 3</h2><span id='topic+prmu.time'></span>

<h3>Description</h3>

<p>This function calculates the estimated probabilities and the estimated mean
of the response variable, in the multinomial mixed models with two independent random effects, one random effect
associated with the area and the other associated with the time,
for each category of the response variable. The first model assumes independent time and domain random effect (Model 2)
and the second model assumes correlated time and domain random effect (Model 3).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prmu.time(M, Xk, beta, u1, u2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="prmu.time_+3A_m">M</code></td>
<td>
<p>vector with the area sample sizes.</p>
</td></tr>
<tr><td><code id="prmu.time_+3A_xk">Xk</code></td>
<td>
<p>list of matrices with the auxiliary variables per category obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of domains.</p>
</td></tr>
<tr><td><code id="prmu.time_+3A_beta">beta</code></td>
<td>
<p>a list with the values for the fixed effects beta per category obtained from <code><a href="#topic+modelfit2">modelfit2</a></code>.</p>
</td></tr>
<tr><td><code id="prmu.time_+3A_u1">u1</code></td>
<td>
<p>a vector with the values of the first random effect obtained from <code><a href="#topic+modelfit2">modelfit2</a></code> or <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
<tr><td><code id="prmu.time_+3A_u2">u2</code></td>
<td>
<p>a vector with the values of the second random effect obtained from <code><a href="#topic+modelfit2">modelfit2</a></code> or <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components:
</p>
<table role = "presentation">
<tr><td><code>Estimated.probabilities</code></td>
<td>
<p>matrix with the estimated probabilities
for the categories of response variable.</p>
</td></tr>
<tr><td><code>mean</code></td>
<td>
<p>matrix with the estimated mean of the response variable.</p>
</td></tr>
<tr><td><code>eta</code></td>
<td>
<p>matrix with the estimated log-rates of the probabilities of each category over the reference category.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Small area estimation of labour force indicator under a multinomial mixed model
with correlated time and area effects. Submited for review.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+phi.mult.it">phi.mult.it</a></code>,
<code><a href="#topic+Fbetaf.it">Fbetaf.it</a></code>, <code><a href="#topic+phi.direct.it">phi.direct.it</a></code>,
<code><a href="#topic+sPhikf.it">sPhikf.it</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+modelfit2">modelfit2</a></code>, <code><a href="#topic+msef.it">msef.it</a></code>,
<code><a href="#topic+mseb">mseb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
mod=2 #Type of model
data(simdata2) # data
datar=data.mme(simdata2,k,pp,mod)
initial=datar$initial

## Estimated mean and estimated probabilities
mean=prmu.time(datar$n,datar$Xk,initial$beta.0,initial$u1.0,initial$u2.0)
</code></pre>

<hr>
<h2 id='simdata'>Dataset for Model 1</h2><span id='topic+simdata'></span>

<h3>Description</h3>

<p>Dataset used by the multinomial mixed effects model with one independent random effect in
each category of the response variable (Model 1).  This dataset contains
15 small areas. The response variable has three categories. The last
is the reference category.
The variables are as follows:
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simdata
</code></pre>


<h3>Format</h3>

<p>A data frame with 15 rows and 9 variables in columns</p>


<h3>Details</h3>


<ul>
<li><p> area: area indicator.
</p>
</li>
<li><p> Time: time indicator.
</p>
</li>
<li><p> sample: the sample size of each domain.
</p>
</li>
<li><p> Population: the population size of each domain.
</p>
</li>
<li><p> Y1: the first category of the response variable.
</p>
</li>
<li><p> Y2: the second category of the response variable.
</p>
</li>
<li><p> Y3: the third category of the response variable.
</p>
</li>
<li><p> X1: the covariate for the first category of the response variable.
</p>
</li>
<li><p> X2: the covariate for the second category of the response variable.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
data(simdata)  #data
mod=1 # type of model
datar=data.mme(simdata,k,pp,mod)
# Model fit
result=model(datar$d,datar$t,pp,datar$Xk,datar$X,datar$Z,datar$initial,datar$y[,1:(k-1)],
       datar$n,datar$N,mod)

#Analytic MSE
mse=msef(pp,datar$X,datar$Z,result,datar$N,datar$n)

B=1    #Bootstrap iterations
ss=12345 #SEED
set.seed(ss)

##Bootstrap parametric BIAS and MSE
mse.pboot=mseb(pp,datar$Xk,datar$X,datar$Z,datar$n,datar$N,result,B,mod)
</code></pre>

<hr>
<h2 id='simdata2'>Dataset for Model 2</h2><span id='topic+simdata2'></span>

<h3>Description</h3>

<p>Dataset used by the multonomial mixed effects model with two independent random effects
in each category of the response variable: one domain random effect and another independent time and domain random effect (Model 2).
This dataset contains 10 small areas and two periods. The response variable has three categories. The last
is the reference category.
The variables are as follows:
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simdata2
</code></pre>


<h3>Format</h3>

<p>A data frame with 30 rows and 9 variables in columns</p>


<h3>Details</h3>


<ul>
<li><p> area: area indicator.
</p>
</li>
<li><p> Time: time indicator.
</p>
</li>
<li><p> sample: the sample size of each domain.
</p>
</li>
<li><p> Population: the population size of each domain.
</p>
</li>
<li><p> Y1: the first category of the response variable.
</p>
</li>
<li><p> Y2: the second category of the response variable.
</p>
</li>
<li><p> Y3: the third category of the response variable.
</p>
</li>
<li><p> X1: the covariate for the first category of the response variable.
</p>
</li>
<li><p> X2: the covariate for the second category of the response variable.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
data(simdata2)
mod=2 #type of model
datar=data.mme(simdata2,k,pp,mod)

##Model fit
result=model(datar$d,datar$t,pp,datar$Xk,datar$X,datar$Z,datar$initial,datar$y[,1:(k-1)],
       datar$n,datar$N,mod)

##Analytic MSE
msef=msef.it(pp,datar$X,result,datar$n,datar$N)

B=1    #Bootstrap iterations
ss=12345 #SEED
set.seed(ss)

##Bootstrap parametric BIAS and MSE
mse.pboot=mseb(pp,datar$Xk,datar$X,datar$Z,datar$n,datar$N,result,B,mod)
</code></pre>

<hr>
<h2 id='simdata3'>Dataset for Model 3</h2><span id='topic+simdata3'></span>

<h3>Description</h3>

<p>Dataset used by the multonomial mixed effects model with two independent random effects
in each category of the response variable: one domain random effect and another correlated time and domain random effect (Model 3).
This dataset contains ten small areas and four periods. The response variable has three categories. The last
is the reference category.
The variables are as follows:
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simdata3
</code></pre>


<h3>Format</h3>

<p>A data frame with 40 rows and 9 variables in columns</p>


<h3>Details</h3>


<ul>
<li><p> area: area indicator.
</p>
</li>
<li><p> Time: time indicator.
</p>
</li>
<li><p> sample: the sample size of each domain.
</p>
</li>
<li><p> Population: the population size of each domain.
</p>
</li>
<li><p> Y1: the first category of the response variable.
</p>
</li>
<li><p> Y2: the second category of the response variable.
</p>
</li>
<li><p> Y3: the third category of the response variable.
</p>
</li>
<li><p> X1: the covariate for the first category of the response variable.
</p>
</li>
<li><p> X2: the covariate for the second category of the response variable.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
mod=3 #type of model
data(simdata3) #data
datar=data.mme(simdata3,k,pp,mod)
##Model fit
result=model(datar$d,datar$t,pp,datar$Xk,datar$X,datar$Z,datar$initial,datar$y[,1:(k-1)],
       datar$n,datar$N,mod)

##Analytic MSE
msef=msef.ct(pp,datar$X,result,datar$n,datar$N)

B=1    #Bootstrap iterations
ss=12345 #SEED
set.seed(ss)

##Bootstrap parametric BIAS and MSE
mse.pboot=mseb(pp,datar$Xk,datar$X,datar$Z,datar$n,datar$N,result,B,mod)
## End(Not run)
</code></pre>

<hr>
<h2 id='sPhikf'>Fisher information matrix and score vectors of the variance components for Model 1</h2><span id='topic+sPhikf'></span>

<h3>Description</h3>

<p>This function computes the Fisher information matrix and the score vectors
of the variance components, for the multinomial mixed model with
one independent random effect in each category
of the response variable (Model 1). These values are used in the fitting algorithm
implemented in <code><a href="#topic+modelfit1">modelfit1</a></code> to estimate the random effects. The algorithm adatps the ideas of Schall (1991) to a multivariate
model. The variance components are estimated by the REML method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sPhikf(pp, sigmap, X, eta, phi)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sPhikf_+3A_pp">pp</code></td>
<td>
<p>vector with the number of the auxiliary variables per category.</p>
</td></tr>
<tr><td><code id="sPhikf_+3A_sigmap">sigmap</code></td>
<td>
<p>a list with the model variance-covariance matrices for each domain obtained from <code><a href="#topic+wmatrix">wmatrix</a></code>.</p>
</td></tr>
<tr><td><code id="sPhikf_+3A_x">X</code></td>
<td>
<p>list of matrices with the auxiliary variables obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="sPhikf_+3A_eta">eta</code></td>
<td>
<p>matrix with the estimated log-rates of probabilities of each category over the reference category obtained from
<code><a href="#topic+prmu">prmu</a></code>.</p>
</td></tr>
<tr><td><code id="sPhikf_+3A_phi">phi</code></td>
<td>
<p>vector with the values of the variance components obtained from <code><a href="#topic+modelfit1">modelfit1</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components.
</p>
<table role = "presentation">
<tr><td><code>S.k</code></td>
<td>
<p>phi score vector.</p>
</td></tr>
<tr><td><code>F</code></td>
<td>
<p>Fisher information matrix of the variance component phi.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Multinomial-based small area estimation of labour force indicators.
Statistical Modelling, 13 ,153-178.
</p>
<p>Schall, R (1991). Estimation in generalized linear models with
random effects. Biometrika,
78,719-727.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+phi.mult">phi.mult</a></code>,
<code><a href="#topic+prmu">prmu</a></code>, <code><a href="#topic+phi.direct">phi.direct</a></code>,
<code><a href="#topic+Fbetaf">Fbetaf</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+modelfit1">modelfit1</a></code>, <code><a href="#topic+msef">msef</a></code>,
<code><a href="#topic+mseb">mseb</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
data(simdata) #data
mod=1 #type of model
datar=data.mme(simdata,k,pp, mod)
initial=datar$initial
mean=prmu(datar$n,datar$Xk,initial$beta.0,initial$u.0)
sigmap=wmatrix(datar$n,mean$estimated.probabilities)

##Fisher information matrix and score vectors
Fisher.phi=sPhikf(pp,sigmap,datar$X,mean$eta,initial$phi.0)
</code></pre>

<hr>
<h2 id='sPhikf.ct'>Fisher information matrix and score vectors of the variance components for Model 3</h2><span id='topic+sPhikf.ct'></span>

<h3>Description</h3>

<p>This function computes the Fisher information matrix and the score vectors
of the variance components, for the multinomial mixed model with two independent random effects
for each category of the response variable: one domain random effect and another correlated time and domain random effect (Model 3).
These values are used in the fitting algorithm implemented in <code><a href="#topic+modelfit3">modelfit3</a></code> to estimate the random effects. The algorithm adatps the
ideas of Schall (1991) to a multivariate
model. The variance components are estimated by the REML method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sPhikf.ct(d, t, pp, sigmap, X, eta, phi1, phi2, rho, pr, M)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sPhikf.ct_+3A_d">d</code></td>
<td>
<p>number of areas.</p>
</td></tr>
<tr><td><code id="sPhikf.ct_+3A_t">t</code></td>
<td>
<p>number of time periods.</p>
</td></tr>
<tr><td><code id="sPhikf.ct_+3A_pp">pp</code></td>
<td>
<p>vector with the number of the auxiliary variables per category.</p>
</td></tr>
<tr><td><code id="sPhikf.ct_+3A_sigmap">sigmap</code></td>
<td>
<p>a list with the model variance-covariance matrices for each domain obtained from <code><a href="#topic+wmatrix">wmatrix</a></code>.</p>
</td></tr>
<tr><td><code id="sPhikf.ct_+3A_x">X</code></td>
<td>
<p>list of matrices with the auxiliary variables obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="sPhikf.ct_+3A_eta">eta</code></td>
<td>
<p>matrix with the estimated log-rates of probabilites of each category over the reference category obtained from <code><a href="#topic+prmu.time">prmu.time</a></code>.</p>
</td></tr>
<tr><td><code id="sPhikf.ct_+3A_phi1">phi1</code></td>
<td>
<p>vector with the values of the first variance component obtained from <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
<tr><td><code id="sPhikf.ct_+3A_phi2">phi2</code></td>
<td>
<p>vector with the values of the second variance component obtained from <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
<tr><td><code id="sPhikf.ct_+3A_rho">rho</code></td>
<td>
<p>vector with the correlation parameter obtained from <code><a href="#topic+modelfit3">modelfit3</a></code>.</p>
</td></tr>
<tr><td><code id="sPhikf.ct_+3A_pr">pr</code></td>
<td>
<p>matrix with the estimated probabilities of the response variable obtained from <code><a href="#topic+prmu.time">prmu.time</a></code>.</p>
</td></tr>
<tr><td><code id="sPhikf.ct_+3A_m">M</code></td>
<td>
<p>vector with the area sample sizes.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components.
</p>
<table role = "presentation">
<tr><td><code>S</code></td>
<td>
<p>(phi1, phi2, rho) score vector.</p>
</td></tr>
<tr><td><code>F</code></td>
<td>
<p>Fisher information matrix of the variance components (phi1, phi2, rho).</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Small area estimation of labour force indicators under a multinomial mixed model
with correlated time and area effects. Submitted for review.
</p>
<p>Schall, R (1991). Estimation in generalized linear models with
random effects. Biometrika,
78,719-727.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+phi.mult.ct">phi.mult.ct</a></code>,
<code><a href="#topic+prmu.time">prmu.time</a></code>, <code><a href="#topic+phi.direct.ct">phi.direct.ct</a></code>,
<code><a href="#topic+Fbetaf.ct">Fbetaf.ct</a></code>, <code><a href="#topic+omega">omega</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+modelfit3">modelfit3</a></code>, <code><a href="#topic+msef.ct">msef.ct</a></code>,
<code><a href="#topic+mseb">mseb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
mod=3 #type of model
data(simdata3) #data
datar=data.mme(simdata3,k,pp, mod)
initial=datar$initial
mean=prmu.time(datar$n,datar$Xk,initial$beta.0,initial$u1.0,initial$u2.0)
sigmap=wmatrix(datar$n,mean$estimated.probabilities)

## Fisher information matrix and the score vectors
Fisher.phi.ct=sPhikf.ct(datar$d,datar$t,pp,sigmap,datar$X,mean$eta,initial$phi1.0,
           initial$phi2.0,initial$rho.0,mean$estimated.probabilities,datar$n)
</code></pre>

<hr>
<h2 id='sPhikf.it'>Fisher information matrix and score vectors of the variance components for Model 2</h2><span id='topic+sPhikf.it'></span>

<h3>Description</h3>

<p>This function computes the Fisher information matrix and the score vectors
of the variance components, for the multinomial mixed model with two independent random effects
for each category of the response variable: one domain random effect and another independent time and domain random effect (Model 2).
These values are used in the fitting algorithm implemented in <code><a href="#topic+modelfit2">modelfit2</a></code> to estimate the random effects. The algorithm adatps the ideas of Schall (1991) to a multivariate
model. The variance components are estimated by the REML method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sPhikf.it(d, t, pp, sigmap, X, eta, phi1, phi2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sPhikf.it_+3A_d">d</code></td>
<td>
<p>number of areas.</p>
</td></tr>
<tr><td><code id="sPhikf.it_+3A_t">t</code></td>
<td>
<p>number of time periods.</p>
</td></tr>
<tr><td><code id="sPhikf.it_+3A_pp">pp</code></td>
<td>
<p>vector with the number of the auxiliary variables per category.</p>
</td></tr>
<tr><td><code id="sPhikf.it_+3A_sigmap">sigmap</code></td>
<td>
<p>a list with the model variance-covariance matrices for each domain obtained from <code><a href="#topic+wmatrix">wmatrix</a></code>.</p>
</td></tr>
<tr><td><code id="sPhikf.it_+3A_x">X</code></td>
<td>
<p>list of matrices with the auxiliary variables obtained from <code><a href="#topic+data.mme">data.mme</a></code>. The dimension of the list is the number of categories of the response variable minus one.</p>
</td></tr>
<tr><td><code id="sPhikf.it_+3A_eta">eta</code></td>
<td>
<p>matrix with the estimated log-rates of probabilities of each category over the reference category obtained from <code><a href="#topic+prmu.time">prmu.time</a></code>.</p>
</td></tr>
<tr><td><code id="sPhikf.it_+3A_phi1">phi1</code></td>
<td>
<p>vector with the values of the first variance component obtained from <code><a href="#topic+modelfit2">modelfit2</a></code>.</p>
</td></tr>
<tr><td><code id="sPhikf.it_+3A_phi2">phi2</code></td>
<td>
<p>vector with the values of the second variance component obtained from <code><a href="#topic+modelfit2">modelfit2</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components.
</p>
<table role = "presentation">
<tr><td><code>S</code></td>
<td>
<p>phi score vector.</p>
</td></tr>
<tr><td><code>F</code></td>
<td>
<p>Fisher information matrix of the variance components phi1 and phi2.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Small area estimation of labour force indicators under a multinomial mixed model
with correlated time and area effects. Submitted for review.
</p>
<p>Schall, R (1991). Estimation in generalized linear models with
random effects. Biometrika,
78,719-727.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+wmatrix">wmatrix</a></code>, <code><a href="#topic+phi.mult.it">phi.mult.it</a></code>,
<code><a href="#topic+prmu.time">prmu.time</a></code>, <code><a href="#topic+phi.direct.it">phi.direct.it</a></code>,
<code><a href="#topic+Fbetaf.it">Fbetaf.it</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+modelfit2">modelfit2</a></code>, <code><a href="#topic+msef.it">msef.it</a></code>,
<code><a href="#topic+mseb">mseb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
mod=2 #Type of model
data(simdata2) #data
datar=data.mme(simdata2,k,pp,mod)
initial=datar$initial
mean=prmu.time(datar$n,datar$Xk,initial$beta.0,initial$u1.0,initial$u2.0)
sigmap=wmatrix(datar$n,mean$estimated.probabilities)

##Fisher information matrix and score vectors
Fisher.phi=sPhikf.it(datar$d,datar$t,pp,sigmap,datar$X,mean$eta,initial$phi1.0,
           initial$phi2.0)
</code></pre>

<hr>
<h2 id='wmatrix'>Model variance-covariance matrix of the multinomial mixed models</h2><span id='topic+wmatrix'></span>

<h3>Description</h3>

<p>This function calculates the variance-covariance matrix of the multinomial mixed models.
Three types of multinomial mixed model are considered. The first model (Model 1), with one
random effect in each category of the response variable; Model 2, introducing
independent time effect; Model 3, introducing correlated time effect.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wmatrix(M, pr)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wmatrix_+3A_m">M</code></td>
<td>
<p>vector with area sample sizes.</p>
</td></tr>
<tr><td><code id="wmatrix_+3A_pr">pr</code></td>
<td>
<p>matrix with the estimated probabilities for the categories of the
response variable obtained from <code><a href="#topic+prmu">prmu</a></code> or <code><a href="#topic+prmu.time">prmu.time</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>W a list with the model variance-covariance matrices for each domain.
</p>


<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Multinomial-based small area estimation of labour force indicators.
Statistical Modelling,13,153-178.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data.mme">data.mme</a></code>, <code><a href="#topic+initial.values">initial.values</a></code>,
<code><a href="#topic+phi.mult">phi.mult</a></code>, <code><a href="#topic+prmu">prmu</a></code>, <code><a href="#topic+prmu.time">prmu.time</a></code>
<code><a href="#topic+Fbetaf">Fbetaf</a></code>, <code><a href="#topic+phi.direct">phi.direct</a></code>,
<code><a href="#topic+sPhikf">sPhikf</a></code>, <code><a href="#topic+ci">ci</a></code>,
<code><a href="#topic+modelfit1">modelfit1</a></code>, <code><a href="#topic+msef">msef</a></code>,
<code><a href="#topic+mseb">mseb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
mod=2 #type of model
data(simdata2)
datar=data.mme(simdata2,k,pp,mod)
initial=datar$initial
mean=prmu.time(datar$n,datar$Xk,initial$beta.0,initial$u1.0,initial$u2.0)
##The model variance-covariance matrix
varcov=wmatrix(datar$n,mean$estimated.probabilities)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
