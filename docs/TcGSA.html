<!DOCTYPE html><html lang="en"><head><title>Help for package TcGSA</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {TcGSA}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#TcGSA-package'><p>Time-course Gene Set Analysis</p></a></li>
<li><a href='#clustTrend'><p>Cluster the genes dynamics into different dominant trends.</p></a></li>
<li><a href='#data_simu_TcGSA'>
<p>Simulated Data for TcGSA</p></a></li>
<li><a href='#multtest.TcGSA'><p>Computing the P-value of the Likelihood Ratios Applying a Multiple Testing</p>
Correction</a></li>
<li><a href='#plot.TcGSA'><p>Plot a Gene Set Trends Heatmap.</p></a></li>
<li><a href='#plot1GS'><p>Plotting a Specific Gene Set</p></a></li>
<li><a href='#plotFit.GS'><p>Plotting function for exploring the fitness of the mixed modeling used in TcGSA</p></a></li>
<li><a href='#plotMultipleGS'><p>Plotting Multiple Gene Sets in a single plot</p></a></li>
<li><a href='#plotPat.1GS'><p>Plotting a Specific Gene Set Stratifying on Patients</p></a></li>
<li><a href='#plotPat.TcGSA'><p>Plot a Gene Set Trends Heatmap for each Patient.</p></a></li>
<li><a href='#plotSelect.GS'><p>Plotting (several) Selected Gene Set(s) in some Subjects</p></a></li>
<li><a href='#pval_simu'><p>Computing P-values with a Simulated Sample from the Null Distribution</p></a></li>
<li><a href='#rchisqmix'><p>Chi-Squared Mixtures Distribution</p></a></li>
<li><a href='#signifLRT.TcGSA'><p>Identifying the Significant Gene Sets</p></a></li>
<li><a href='#summary.TcGSA'><p>Summarizing TcGSA</p></a></li>
<li><a href='#TcGSA-internal'><p>Internal TcGSA Functions</p></a></li>
<li><a href='#TcGSA.LR'><p>Computing the Likelihood Ratios for the Gene Sets under Scrutiny</p></a></li>
<li><a href='#TcGSA.LR.parallel'><p>Parallel computing the Likelihood Ratios for the Gene Sets under Scrutiny</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Time-Course Gene Set Analysis</td>
</tr>
<tr>
<td>Version:</td>
<td>0.12.10</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-02-27</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.0.2), ggplot2 (&ge; 2.0.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>lme4 (&ge; 1.0-4), reshape2, GSA, multtest, cluster, cowplot,
graphics, grDevices, gtools, stringr, splines, stats, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>BiocManager, foreach, parallel, doParallel, dearseq, knitr,
GEOquery, rmarkdown</td>
</tr>
<tr>
<td>Description:</td>
<td>Implementation of Time-course Gene Set Analysis (TcGSA), a method for 
	analyzing longitudinal gene-expression data at the gene set level. Method is
	detailed in: Hejblum, Skinner &amp; Thiebaut (2015) &lt;<a href="https://doi.org/10.1371%2Fjournal.pcbi.1004310">doi:10.1371/journal.pcbi.1004310</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/sistm/TcGSA/issues">https://github.com/sistm/TcGSA/issues</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="http://sistm.github.io/TcGSA/">http://sistm.github.io/TcGSA/</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-02-28 21:11:58 UTC; boris</td>
</tr>
<tr>
<td>Author:</td>
<td>Boris P Hejblum [aut, cre],
  Damien Chimits [aut],
  Anthony Devaux [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Boris P Hejblum &lt;boris.hejblum@u-bordeaux.fr&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-02-28 21:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='TcGSA-package'>Time-course Gene Set Analysis</h2><span id='topic+TcGSA-package'></span><span id='topic+TcGSA'></span>

<h3>Description</h3>

<p>This package implements TcGSA, an algorithm to analyze longitudinal gene-expression data at the gene set level.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> TcGSA</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 0.12.10</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2022-02-27</td>
</tr>
<tr>
 <td style="text-align: left;">
License:</td><td style="text-align: left;"> <a href="http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt">GPL-2</a></td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>The main function in this package is <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code> which performs Time-course Gene Set Analysis, and provide nice representations of its results (see <code><a href="#topic+plot.TcGSA">plot.TcGSA</a></code> and <code><a href="#topic+plot1GS">plot1GS</a></code>).
</p>


<h3>Author(s)</h3>

<p>Boris P. Hejblum, Damien Chimits
&mdash; Maintainer: Boris P. Hejblum
</p>


<h3>References</h3>

<p>Hejblum BP, Skinner J, Thiebaut R, (2015)
Time-Course Gene Set Analysis for Longitudinal Gene Expression Data.
<em>PLOS Comput. Biol.</em> 11(6):e1004310.
doi: 10.1371/journal.pcbi.1004310
</p>


<h3>See Also</h3>

<p><code><a href="GSA.html#topic+GSA">GSA</a></code> <code><a href="dearseq.html#topic+dgsa_seq">dgsa_seq</a></code>
</p>

<hr>
<h2 id='clustTrend'>Cluster the genes dynamics into different dominant trends.</h2><span id='topic+clustTrend'></span><span id='topic+ClusteredTrends'></span><span id='topic+print.ClusteredTrends'></span><span id='topic+plot.ClusteredTrends'></span>

<h3>Description</h3>

<p>This function clusters the genes dynamics of one gene sets into different
dominant trends.  The optimal number of clusters is computed thanks to the gap
statistics.  See <code><a href="cluster.html#topic+clusGap">clusGap</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>clustTrend(
  tcgs,
  expr,
  Subject_ID,
  TimePoint,
  threshold = 0.05,
  myproc = "BY",
  nbsimu_pval = 1e+06,
  baseline = NULL,
  only.signif = TRUE,
  group.var = NULL,
  Group_ID_paired = NULL,
  ref = NULL,
  group_of_interest = NULL,
  FUNcluster = NULL,
  clustering_metric = "euclidian",
  clustering_method = "ward",
  B = 100,
  max_trends = 4,
  aggreg.fun = "median",
  na.rm.aggreg = TRUE,
  trend.fun = "median",
  methodOptiClust = "firstSEmax",
  indiv = "genes",
  verbose = TRUE
)

## S3 method for class 'ClusteredTrends'
print(x, ...)

## S3 method for class 'ClusteredTrends'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="clustTrend_+3A_tcgs">tcgs</code></td>
<td>
<p>a <b>tcgsa</b> object for <code>clustTrend</code>, or a
<b><a href="#topic+ClusteredTrends">ClusteredTrends</a></b> object for <code>print.ClusteredTrends</code> and
<code>plot.ClusteredTrends</code>.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_expr">expr</code></td>
<td>
<p>either a matrix or dataframe of gene expression upon which
dynamics are to be calculated, or a list of gene sets estimation of gene
expression.  In the case of a matrix or dataframe, its dimension are <code class="reqn">n</code>
x <code class="reqn">p</code>, with the <code class="reqn">p</code> sample in column and the <code class="reqn">n</code> genes in row.
In the case of a list, its length should correspond to the number of gene
sets under scrutiny and each element should be an 3 dimension array of
estimated gene expression, such as for the list returned in the
<code>'Estimations'</code> element of <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>.  See details.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_subject_id">Subject_ID</code></td>
<td>
<p>a factor of length <code class="reqn">p</code> that is in the same order as the
columns of <code>expr</code> (when it is a dataframe) and that contains the patient
identifier of each sample.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_timepoint">TimePoint</code></td>
<td>
<p>a numeric vector or a factor of length <code class="reqn">p</code> that is in
the same order as <code>Subject_ID</code> and the columns of <code>expr</code> (when it
is a dataframe), and that contains the time points at which gene expression
was measured.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_threshold">threshold</code></td>
<td>
<p>the threshold at which the FDR or the FWER should be
controlled.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_myproc">myproc</code></td>
<td>
<p>a vector of character strings containing the names of the
multiple testing procedures for which adjusted p-values are to be computed.
This vector should include any of the following: &quot;<code>Bonferroni</code>&quot;,
&quot;<code>Holm</code>&quot;, &quot;<code>Hochberg</code>&quot;, &quot;<code>SidakSS</code>&quot;, &quot;<code>SidakSD</code>&quot;,
&quot;<code>BH</code>&quot;, &quot;<code>BY</code>&quot;, &quot;<code>ABH</code>&quot;, &quot;<code>TSBH</code>&quot;. See
<code><a href="multtest.html#topic+mt.rawp2adjp">mt.rawp2adjp</a></code> for details.  Default is
&quot;<code>BY</code>&quot;, the Benjamini &amp; Yekutieli (2001) step-up FDR-controlling
procedure (general dependency structures).  In order to control the FWER(in
case of an analysis that is more a hypothesis confirmation than an
exploration of the expression data), we recommend to use &quot;<code>Holm</code>&quot;, the
Holm (1979) step-down adjusted p-values for strong control of the FWER.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_nbsimu_pval">nbsimu_pval</code></td>
<td>
<p>the number of observations under the null distribution to
be generated in order to compute the p-values.  Default is <code>1e+06</code>.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_baseline">baseline</code></td>
<td>
<p>a character string which is the value of <code>TimePoint</code>
that can be used as a baseline.  Default is <code>NULL</code>, in which case no
time point is used as a baseline value for gene expression.  Has to be
<code>NULL</code> when comparing several treatment groups.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_only.signif">only.signif</code></td>
<td>
<p>logical flag for analyzing the trends in only the
significant gene sets.  If <code>FALSE</code>, all the gene sets from the
<b>gmt</b> object contained in <code>x</code> are clustered.  Default is
<code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_group.var">group.var</code></td>
<td>
<p>in the case of several treatment groups, this is a factor of
length <code class="reqn">p</code> that is in the same order as <code>Timepoint</code>,
<code>Subject_ID</code> and the columns of <code>expr</code>.  It indicates to which
treatment group each sample belongs to.  Default is <code>NULL</code>, which means
that there is only one treatment group.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_group_id_paired">Group_ID_paired</code></td>
<td>
<p>a character vector of length <code class="reqn">p</code> that is in the
same order as <code>Timepoint</code>,  <code>Subject_ID</code>, <code>group.var</code> and the
columns of <code>expr</code>.  This argument must not be <code>NULL</code> in the case of
a paired analysis, and must be <code>NULL</code> otherwise.  Default is
<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_ref">ref</code></td>
<td>
<p>the group which is used as reference in the case of several
treatment groups.  Default is <code>NULL</code>, which means that reference is the
first group in alphabetical order of the labels of <code>group.var</code>.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_group_of_interest">group_of_interest</code></td>
<td>
<p>the group of interest, for which dynamics are to be
computed in the case of several treatment groups.  Default is <code>NULL</code>,
which means that group of interest is the second group in alphabetical order
of the labels of <code>group.var</code>.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_funcluster">FUNcluster</code></td>
<td>
<p>the clustering function used to agglomerate genes in
trends.  Default is <code>NULL</code>, in which a hierarchical clustering is
performed via the function <code><a href="cluster.html#topic+agnes">agnes</a></code>, using the
metric <code>clustering_metric</code> and the method <code>clustering_method</code>.  See
<code><a href="cluster.html#topic+clusGap">clusGap</a></code></p>
</td></tr>
<tr><td><code id="clustTrend_+3A_clustering_metric">clustering_metric</code></td>
<td>
<p>character string specifying the metric to be used
for calculating dissimilarities between observations in the hierarchical
clustering when <code>FUNcluster</code> is <code>NULL</code>.  The currently available
options are <code>"euclidean"</code> and <code>"manhattan"</code>.  Default is
<code>"euclidean"</code>.  See <code><a href="cluster.html#topic+agnes">agnes</a></code>.  Also, a <code>"sts"</code> option 
is available in TcGSA.  It implements the 'Short Time Series' distance 
[Moller-Levet et al., Fuzzy Clustering of short time series and unevenly distributed 
sampling points, <em>Advances in Intelligent Data Analysis V</em>:330-340 Springer, 2003]
designed specifically for clustering time series.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_clustering_method">clustering_method</code></td>
<td>
<p>character string defining the agglomerative method
to be used in the hierarchical clustering when <code>FUNcluster</code> is
<code>NULL</code>.  The six methods implemented are <code>"average"</code> ([unweighted
pair-]group average method, UPGMA), <code>"single"</code> (single linkage),
<code>"complete"</code> (complete linkage), <code>"ward"</code> (Ward's method),
<code>"weighted"</code> (weighted average linkage).  Default is <code>"ward"</code>.  See
<code><a href="cluster.html#topic+agnes">agnes</a></code>.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_b">B</code></td>
<td>
<p>integer specifying the number of Monte Carlo (&quot;bootstrap&quot;) samples
used to compute the gap statistics.  Default is <code>500</code>.  See
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_max_trends">max_trends</code></td>
<td>
<p>integer specifying the maximum number of different clusters
to be tested.  Default is <code>4</code>.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_aggreg.fun">aggreg.fun</code></td>
<td>
<p>a character string such as <code>"mean"</code>, <code>"median"</code>
or the name of any other defined statistics function that returns a single
numeric value.  It specifies the function used to aggregate the observations
before the clustering.  Default is to <code>median</code>.  Default is
<code>"median"</code>.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_na.rm.aggreg">na.rm.aggreg</code></td>
<td>
<p>a logical flag indicating whether <code>NA</code> should be remove to prevent 
propagation through <code>aggreg.fun</code>. Can be useful to set to TRUE with 
unbalanced design as those will generate structural <code>NA</code>s in 
<code>$Estimations</code>. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_trend.fun">trend.fun</code></td>
<td>
<p>a character string such as <code>"mean"</code>, <code>"median"</code> or
the name of any other function that returns a single numeric value.  It
specifies the function used to calculate the trends of the identified
clustered.  Default is to <code>median</code>.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_methodopticlust">methodOptiClust</code></td>
<td>
<p>character string indicating how the &quot;optimal&quot; number
of clusters is computed from the gap statistics and their standard
deviations. Possible values are <code>"globalmax"</code>, <code>"firstmax"</code>,
<code>"Tibs2001SEmax"</code>, <code>"firstSEmax"</code> and <code>"globalSEmax"</code>.
Default is <code>"firstSEmax"</code>.  See <code>'method'</code> in
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>, Details and <em>Tibshirani et al.,
2001</em> in References.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_indiv">indiv</code></td>
<td>
<p>a character string indicating by which unit observations are
aggregated (through <code>aggreg.fun</code>) before the clustering.  Possible
values are <code>"genes"</code> or <code>"patients"</code>.  Default is <code>"genes"</code>.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_verbose">verbose</code></td>
<td>
<p>logical flag enabling verbose messages to track the computing
status of the function.  Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_x">x</code></td>
<td>
<p>an object of class '<code>ClusteredTrends</code>'.</p>
</td></tr>
<tr><td><code id="clustTrend_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>expr</code> is a matrix or a dataframe, then the genes dynamics are
clustered on the &quot;original&quot; data.  On the other hand, if <code>expr</code> is a
list returned in the <code>'Estimations'</code> element of <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>,
then the dynamics are computed on the estimations made by the
<code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code> function.
</p>
<p>This function uses the Gap statistics to determine the optimal number of
clusters in the plotted gene set.  See
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>.
</p>


<h3>Value</h3>

<p>An object of class <b><a href="#topic+ClusteredTrends">ClusteredTrends</a></b> which is a list with
the 4 following components: </p>

<ul>
<li> <p><code>NbClust</code> a vector that contains the optimal number of clusters for
each analyzed gene sets.
</p>
</li>
<li> <p><code>ClustsMeds</code> a list of the same length as <code>NsClust</code> (the
number of analyzed gene sets). Each element of the list is a data frame, in
which there is as many column as the optimal number of clusters for the
corresponding gene sets for each cluster.  Each column of the data frame
contains the median trend values for the corresponding cluster.
</p>
</li>
<li> <p><code>GenesPartition</code> a list of the same length as <code>NsClust</code> (the
number of analyzed gene sets).  Each element of the list is a vector which
gives the partition of the genes inside the corresponding gene set.
</p>
</li>
<li> <p><code>MaxNbClust</code> an integer storing the maximum number of different
clusters tested, as given by the argument <code>'max_trends'</code>.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Boris P. Hejblum
</p>


<h3>References</h3>

<p>Tibshirani, R., Walther, G. and Hastie, T., 2001, Estimating the
number of data clusters via the Gap statistic, <em>Journal of the Royal
Statistical Society, Series B (Statistical Methodology)</em>, <b>63</b>, 2:
41&ndash;423.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot1GS">plot1GS</a></code>, <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>,
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(interactive()){
data(data_simu_TcGSA)

tcgsa_sim_1grp &lt;- TcGSA.LR(expr=expr_1grp, gmt=gmt_sim, design=design, 
                          subject_name="Patient_ID", time_name="TimePoint",
                          time_func="linear", crossedRandom=FALSE)
 
CT &lt;- clustTrend(tcgsa_sim_1grp,
    expr=expr_1grp, Subject_ID=design$Subject_ID, TimePoint=design$TimePoint)
CT
plot(CT)

CT$NbClust
CT$NbClust["Gene set 5"]
CT$ClustMeds[["Gene set 4"]]
CT$ClustMeds[["Gene set 5"]]
}

</code></pre>

<hr>
<h2 id='data_simu_TcGSA'>
Simulated Data for TcGSA
</h2><span id='topic+data_simu_TcGSA'></span><span id='topic+expr_1grp'></span><span id='topic+expr_2grp'></span><span id='topic+design'></span><span id='topic+gmt_sim'></span>

<h3>Description</h3>

<p>Simulated data for 5 gene sets of 50 genes each.  Gene expression is simulated at 5 time points for 10 patients.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(data_simu_TcGSA)
</code></pre>


<h3>Details</h3>

<p>In <code>expr_1grp</code> all patients belong to the same unique treatment group.  The first 2 gene sets are simulated under the null hypothesis.  The gene sets 3 and 4 are simulated under the alternative hypothesis that there is a significant homogeneous time trend within the gene set.  The gene set 5 is simulated under the alternative hypothesis that there are significant heterogeneous time trends within the gene set.
<br />
</p>
<p>In <code>expr_2grp</code> all patients belong to 2 treatment groups.  The 5 first patients belong to the treatment group '<code>T</code>', The 5 other patients belong to the treatment group '<code>C</code>'.  The first 2 gene sets are simulated under the null hypothesis that there is no difference in the time trend between the 2 treatment groups.  The gene sets 3 and 4 are simulated under the alternative hypothesis that there are significantly different homogeneous time trends within the gene set between the 2 treatment groups.  The gene set 5 is simulated under the alternative hypothesis that there are significantly different heterogeneous time trends between the 2 treatment groups within the gene set.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>expr_1grp</code></td>
<td>

<p>See Details.
</p>
</td></tr>
<tr><td><code>expr_2grp</code></td>
<td>

<p>See Details.
</p>
</td></tr>
<tr><td><code>design</code></td>
<td>

<p>a data frame with 5 variables:</p>

<ul>
<li> <p><code>Patient_ID</code>: a factor that contains the patient ID.
</p>
</li>
<li> <p><code>TimePoint</code>: a numeric vector or a factor that contains the time points at which gene expression was measured.
</p>
</li>
<li> <p><code>sample_name</code>: a character vector with the names of the sample (corresponding to the names of the columns of <code>expr_1grp</code> and of <code>expr_2grp</code>).
</p>
</li>
<li> <p><code>group.var</code>: a factor that indicates to which of the 2 treatment groups each sample belongs to.
</p>
</li>
<li> <p><code>Group_paired_ID</code>
a random paired identifier for paired couples (one in each of the 2 treatment groups) of patients.
</p>
</li></ul>

</td></tr>
<tr><td><code>gmt_sim</code></td>
<td>

<p>a <b>gmt</b> object containing the gene sets definition.  See <code><a href="GSA.html#topic+GSA.read.gmt">GSA.read.gmt</a></code> and <a href="https://software.broadinstitute.org/cancer/software/gsea/wiki/index.php/Data_formats">GMT definition on www.broadinstitute.org</a>.
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Boris P. Hejblum
</p>


<h3>Source</h3>

<p>This is simulated data.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(data_simu_TcGSA)
summary(expr_1grp)
summary(design)
gmt_sim

</code></pre>

<hr>
<h2 id='multtest.TcGSA'>Computing the P-value of the Likelihood Ratios Applying a Multiple Testing
Correction</h2><span id='topic+multtest.TcGSA'></span>

<h3>Description</h3>

<p>This function computes the p-value of the likelihood ratios and apply a
multiple testing correction.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>multtest.TcGSA(
  tcgsa,
  threshold = 0.05,
  myproc = "BY",
  exact = TRUE,
  nbsimu_pval = 1e+06
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="multtest.TcGSA_+3A_tcgsa">tcgsa</code></td>
<td>
<p>a TcGSA object.</p>
</td></tr>
<tr><td><code id="multtest.TcGSA_+3A_threshold">threshold</code></td>
<td>
<p>the threshold at which the FDR or the FWER should be
controlled.</p>
</td></tr>
<tr><td><code id="multtest.TcGSA_+3A_myproc">myproc</code></td>
<td>
<p>a vector of character strings containing the names of the
multiple testing procedures for which adjusted p-values are to be computed.
This vector should include any of the following: &quot;<code>Bonferroni</code>&quot;,
&quot;<code>Holm</code>&quot;, &quot;<code>Hochberg</code>&quot;, &quot;<code>SidakSS</code>&quot;, &quot;<code>SidakSD</code>&quot;,
&quot;<code>BH</code>&quot;, &quot;<code>BY</code>&quot;, &quot;<code>ABH</code>&quot;, &quot;<code>TSBH</code>&quot; or &quot;<code>none</code>&quot;.  
&quot;<code>none</code>&quot; indicates no adjustment for multiple testing.  See
<code><a href="multtest.html#topic+mt.rawp2adjp">mt.rawp2adjp</a></code> for details.  Default is
&quot;<code>BY</code>&quot;, the Benjamini &amp; Yekutieli (2001) step-up FDR-controlling
procedure (general dependency structures).  In order to control the FWER (in
case of an analysis that is more a hypothesis confirmation than an
exploration of the expression data), we recommend to use &quot;<code>Holm</code>&quot;, the
Holm (1979) step-down adjusted p-values for strong control of the FWER.</p>
</td></tr>
<tr><td><code id="multtest.TcGSA_+3A_exact">exact</code></td>
<td>
<p>logical flag indicating whether the raw p-values should be computed from the 
exact asymptotic mixture of chi-square, or simulated (longer and not better).
Default is <code>TRUE</code> and should be preferred.</p>
</td></tr>
<tr><td><code id="multtest.TcGSA_+3A_nbsimu_pval">nbsimu_pval</code></td>
<td>
<p>the number of observations under the null distribution to
be generated in order to compute the p-values. Default is <code>1e+06</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>multtest.TcGSA</code> returns an dataframe with 5 variables.  The
rows correspond to the gene sets under scrutiny.  The 1st column is the
likelihood ratios <code>LR</code>, the 2nd column is the convergence status of the
model under the null hypothesis <code>CVG_H0</code>, the 3rd column is the
convergence status of the model under the alternative hypothesis
<code>CVG_H1</code>, the 4th column is the raw p-value of the mixed likelihood
ratio test <code>raw_pval</code>, the 5th column is the adjusted p-value of the
mixed likelihood ratio test <code>adj_pval</code>.
</p>


<h3>Author(s)</h3>

<p>Boris P. Hejblum
</p>


<h3>See Also</h3>

<p><code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>, 
<code><a href="multtest.html#topic+mt.rawp2adjp">mt.rawp2adjp</a></code>,
<code><a href="#topic+signifLRT.TcGSA">signifLRT.TcGSA</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(interactive()){
data(data_simu_TcGSA)

tcgsa_sim_1grp &lt;- TcGSA.LR(expr=expr_1grp, gmt=gmt_sim, design=design, 
                          subject_name="Patient_ID", time_name="TimePoint",
                          time_func="linear", crossedRandom=FALSE)
                          
mtt &lt;- multtest.TcGSA(tcgsa_sim_1grp, threshold = 0.05, 
                     myproc = "BY", nbsimu_pval = 1000)
mtt
}

</code></pre>

<hr>
<h2 id='plot.TcGSA'>Plot a Gene Set Trends Heatmap.</h2><span id='topic+plot.TcGSA'></span>

<h3>Description</h3>

<p>This function plots a gene sets dynamic trends heatmap.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'TcGSA'
plot(
  x,
  threshold = 0.05,
  myproc = "BY",
  nbsimu_pval = 1e+06,
  expr,
  Subject_ID,
  TimePoint,
  baseline = NULL,
  only.signif = TRUE,
  group.var = NULL,
  Group_ID_paired = NULL,
  ref = NULL,
  group_of_interest = NULL,
  ranking = FALSE,
  FUNcluster = NULL,
  clustering_metric = "euclidian",
  clustering_method = "ward",
  B = 500,
  max_trends = 4,
  aggreg.fun = "median",
  na.rm.aggreg = TRUE,
  methodOptiClust = "firstSEmax",
  indiv = "genes",
  verbose = TRUE,
  clust_trends = NULL,
  N_clusters = NULL,
  myclusters = NULL,
  label.clusters = NULL,
  prev_rowCL = NULL,
  descript = TRUE,
  plot = TRUE,
  color.vec = c("darkred", "#D73027", "#FC8D59", "snow", "#91BFDB", "#4575B4",
    "darkblue"),
  legend.breaks = NULL,
  label.column = NULL,
  time_unit = "",
  cex.label.row = 1,
  cex.label.column = 1,
  margins = c(5, 25),
  heatKey.size = 1,
  dendrogram.size = 1,
  heatmap.height = 1,
  heatmap.width = 1,
  cex.clusterKey = 1,
  cex.main = 1,
  horiz.clusterKey = TRUE,
  main = NULL,
  subtitle = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.TcGSA_+3A_x">x</code></td>
<td>
<p>an object of class'<code>TcGSA</code>'.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_threshold">threshold</code></td>
<td>
<p>the threshold at which the FDR or the FWER should be
controlled.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_myproc">myproc</code></td>
<td>
<p>a vector of character strings containing the names of the
multiple testing procedures for which adjusted p-values are to be computed.
This vector should include any of the following: &quot;<code>Bonferroni</code>&quot;,
&quot;<code>Holm</code>&quot;, &quot;<code>Hochberg</code>&quot;, &quot;<code>SidakSS</code>&quot;, &quot;<code>SidakSD</code>&quot;,
&quot;<code>BH</code>&quot;, &quot;<code>BY</code>&quot;, &quot;<code>ABH</code>&quot;, &quot;<code>TSBH</code>&quot; or &quot;<code>none</code>&quot;.  
&quot;<code>none</code>&quot; indicates no adjustment for multiple testing. See
<code><a href="multtest.html#topic+mt.rawp2adjp">mt.rawp2adjp</a></code> for details.  Default is
&quot;<code>BY</code>&quot;, the Benjamini &amp; Yekutieli (2001) step-up FDR-controlling
procedure (general dependency structures).  In order to control the FWER(in
case of an analysis that is more a hypothesis confirmation than an
exploration of the expression data), we recommend to use &quot;<code>Holm</code>&quot;, the
Holm (1979) step-down adjusted p-values for strong control of the FWER.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_nbsimu_pval">nbsimu_pval</code></td>
<td>
<p>the number of observations under the null distribution to
be generated in order to compute the p-values. Default is <code>1e+06</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_expr">expr</code></td>
<td>
<p>either a matrix or dataframe of gene expression upon which
dynamics are to be calculated, or a list of gene sets estimation of gene
expression.  In the case of a matrix or dataframe, its dimension are <code class="reqn">n</code>
x <code class="reqn">p</code>, with the <code class="reqn">p</code> sample in column and the <code class="reqn">n</code> genes in row.
In the case of a list, its length should correspond to the number of gene
sets under scrutiny and each element should be an 3 dimension array of
estimated gene expression, such as for the list returned in the
<code>'Estimations'</code> element of <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>.  See details.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_subject_id">Subject_ID</code></td>
<td>
<p>a factor of length <code class="reqn">p</code> that is in the same order as the
columns of <code>expr</code> (when it is a dataframe) and that contains the patient
identifier of each sample. Ignored if <code>expr</code> is a list of estimations.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_timepoint">TimePoint</code></td>
<td>
<p>a numeric vector or a factor of length <code class="reqn">p</code> that is in
the same order as <code>Subject_ID</code> and the columns of <code>expr</code> (when it
is a dataframe), and that contains the time points at which gene expression
was measured. Ignored if <code>expr</code> is a list of estimations.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_baseline">baseline</code></td>
<td>
<p>the value of <code>TimePoint</code> to be used as baseline. Default is <code>NULL</code> 
in which case expression is centered and no baseline is used.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_only.signif">only.signif</code></td>
<td>
<p>logical flag for plotting only the significant gene sets.
If <code>FALSE</code>, all the gene sets from the <b>gmt</b> object contained in
<code>x</code> are plotted.  Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_group.var">group.var</code></td>
<td>
<p>in the case of several treatment' groups, this is a factor of
length <code class="reqn">p</code> that is in the same order as <code>Timepoint</code>,
<code>Subject_ID</code>, <code>sample_name</code> and the columns of <code>expr</code>.  It
indicates to which treatment group each sample belongs to.  Default is
<code>NULL</code>, which means that there is only one treatment group.  See
Details.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_group_id_paired">Group_ID_paired</code></td>
<td>
<p>a character vector of length <code class="reqn">p</code> that is in the
same order as <code>Timepoint</code>, <code>Subject_ID</code>, <code>sample_name</code>,
<code>group.var</code> and the columns of <code>expr</code>.  This argument must not be
<code>NULL</code> in the case of a paired analysis, and must be <code>NULL</code>
otherwise.  Default is <code>NULL</code>.  See Details.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_ref">ref</code></td>
<td>
<p>the group which is used as reference in the case of several
treatment groups.  Default is <code>NULL</code>, which means that reference is the
first group in alphabetical order of the labels of <code>group.var</code>.  See
Details.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_group_of_interest">group_of_interest</code></td>
<td>
<p>the group of interest, for which dynamics are to be
computed in the case of several treatment groups.  Default is <code>NULL</code>,
which means that group of interest is the second group in alphabetical order
of the labels of <code>group.var</code>.  See Details.
<code>group_of_interest</code> here~~</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_ranking">ranking</code></td>
<td>
<p>a logical flag. If <code>TRUE</code>, the gene set trends are not hierarchically classified, but
ordered by decreasing Likelihood ratios. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_funcluster">FUNcluster</code></td>
<td>
<p>the clustering function used to agglomerate genes in
trends.  Default is <code>NULL</code>, in which a hierarchical clustering is
performed via the function <code><a href="cluster.html#topic+agnes">agnes</a></code>, using the
metric <code>clustering_metric</code> and the method <code>clustering_method</code>.  See
<code><a href="cluster.html#topic+clusGap">clusGap</a></code></p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_clustering_metric">clustering_metric</code></td>
<td>
<p>character string specifying the metric to be used
for calculating dissimilarities between observations in the hierarchical
clustering when <code>FUNcluster</code> is <code>NULL</code>.  The currently available
options are <code>"euclidean"</code> and <code>"manhattan"</code>.  Default is
<code>"euclidean"</code>.  See <code><a href="cluster.html#topic+agnes">agnes</a></code>.  Also, a <code>"sts"</code> option 
is available in TcGSA.  It implements the 'Short Time Series' distance 
[Moller-Levet et al., Fuzzy Clustering of short time series and unevenly distributed 
sampling points, <em>Advances in Intelligent Data Analysis V</em>:330-340 Springer, 2003]
designed specifically for clustering time series.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_clustering_method">clustering_method</code></td>
<td>
<p>character string defining the agglomerative method
to be used in the hierarchical clustering when <code>FUNcluster</code> is
<code>NULL</code>.  The six methods implemented are <code>"average"</code> ([unweighted
pair-]group average method, UPGMA), <code>"single"</code> (single linkage),
<code>"complete"</code> (complete linkage), <code>"ward"</code> (Ward's method),
<code>"weighted"</code> (weighted average linkage).  Default is <code>"ward"</code>.  See
<code><a href="cluster.html#topic+agnes">agnes</a></code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_b">B</code></td>
<td>
<p>integer specifying the number of Monte Carlo (&quot;bootstrap&quot;) samples
used to compute the gap statistics.  Default is <code>500</code>.  See
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_max_trends">max_trends</code></td>
<td>
<p>integer specifying the maximum number of different clusters
to be tested.  Default is <code>4</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_aggreg.fun">aggreg.fun</code></td>
<td>
<p>a character string such as <code>"mean"</code>, <code>"median"</code>
or the name of any other statistics function defined that returns a single
numeric value.  It specifies the function used to aggregate the observations
before the clustering.  Default is to <code>median</code>.  Default is
<code>"median"</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_na.rm.aggreg">na.rm.aggreg</code></td>
<td>
<p>a logical flag indicating whether <code>NA</code> should be remove to prevent 
propagation through <code>aggreg.fun</code>. Can be useful to set to TRUE with 
unbalanced design as those will generate structural <code>NA</code>s in 
<code>$Estimations</code>. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_methodopticlust">methodOptiClust</code></td>
<td>
<p>character string indicating how the &quot;optimal&quot;&quot; number
of clusters is computed from the gap statistics and their standard
deviations. Possible values are <code>"globalmax"</code>, <code>"firstmax"</code>,
<code>"Tibs2001SEmax"</code>, <code>"firstSEmax"</code> and <code>"globalSEmax"</code>.
Default is <code>"firstSEmax"</code>.  See <code>'method'</code> in
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>, Details and <em>Tibshirani et al.,
2001</em> in References.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_indiv">indiv</code></td>
<td>
<p>a character string indicating by which unit observations are
aggregated (through <code>aggreg.fun</code>) before the clustering.  Possible
values are <code>"genes"</code> or <code>"patients"</code>.  Default is <code>"genes"</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_verbose">verbose</code></td>
<td>
<p>logical flag enabling verbose messages to track the computing
status of the function.  Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_clust_trends">clust_trends</code></td>
<td>
<p>object of class <b><a href="#topic+ClusteredTrends">ClusteredTrends</a></b> containing
already computed trends for the plotted gene sets.  Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_n_clusters">N_clusters</code></td>
<td>
<p>an integer that is the number of clusters in which the
dynamics should be regrouped. The cutoff of the clustering tree is
automatically calculated accordingly.  Default is <code>NULL</code>, in which case
the dendrogram is not cut and no clusters are identified.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_myclusters">myclusters</code></td>
<td>
<p>a character vector of colors for predefined clusters of the
represented gene sets, with as many levels as the value of <code>N_clusters</code>.
Default is <code>NULL</code>, in which case the clusters are automatically
identified and colored via the <code><a href="stats.html#topic+cutree">cutree</a></code> function and the
<code>N_clusters</code> argument only.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_label.clusters">label.clusters</code></td>
<td>
<p>if <code>N_clusters</code> is not <code>NULL</code>, a character
vector of length <code>N_clusterss</code>.  Default is <code>NULL</code>, in which case
if <code>N_clusters</code> is not <code>NULL</code>, clusters are simply labeled with
numbers.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_prev_rowcl">prev_rowCL</code></td>
<td>
<p>a <b><a href="stats.html#topic+hclust">hclust</a></b> object, such as the one return by the
present plotting function (see Value) for instance.  If not <code>NULL</code>, no
clustering is calculated by the present plotting function and this tree is
used to represent the gene sets dynamics.  Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_descript">descript</code></td>
<td>
<p>logical flag indicating that the description of the gene sets
should appear after their name on the right side of the plot if <code>TRUE</code>.
Default is <code>TRUE</code>.  See Details.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_plot">plot</code></td>
<td>
<p>logical flag indicating whether the heatmap should be plotted or
not.  Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_color.vec">color.vec</code></td>
<td>
<p>a character strings vector used to define the color
<a href="grDevices.html#topic+palette">palette</a> used in the plot.  Default is
<code>c("#D73027", "#FC8D59","lightyellow", "#91BFDB", "#4575B4")</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_legend.breaks">legend.breaks</code></td>
<td>
<p>a numeric vector indicating the splitting points for
coloring.  Default is <code>NULL</code>, in which case the break points will be
spaced equally and symmetrically about 0.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_label.column">label.column</code></td>
<td>
<p>a vector of character strings with the labels to be
displayed for the columns (i.e. the time points).  Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_time_unit">time_unit</code></td>
<td>
<p>the time unit to be displayed (such as <code>"Y"</code>,
<code>"M"</code>, <code>"W"</code>, <code>"D"</code>, <code>"H"</code>, etc) next to the values of
<code>TimePoint</code> in the columns labels when <code>label.column</code> is
<code>NULL</code>.  Default is <code>""</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_cex.label.row">cex.label.row</code></td>
<td>
<p>a numerical value giving the amount by which row labels
text should be magnified relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_cex.label.column">cex.label.column</code></td>
<td>
<p>a numerical value giving the amount by which column
labels text should be magnified relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_margins">margins</code></td>
<td>
<p>numeric vector of length 2 containing the margins (see
<code><a href="graphics.html#topic+par">par</a>(mar= *))</code> for column and row names, respectively.  Default
is <code>c(15, 100)</code>.  See Details.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_heatkey.size">heatKey.size</code></td>
<td>
<p>the size of the color key for the heatmap fill.  Default
is <code>1</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_dendrogram.size">dendrogram.size</code></td>
<td>
<p>the horizontal size of the dendrogram.  Default is <code>1</code></p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_heatmap.height">heatmap.height</code></td>
<td>
<p>the height of the heatmap.  Default is <code>1</code></p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_heatmap.width">heatmap.width</code></td>
<td>
<p>the width of the heatmap.  Default is <code>1</code></p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_cex.clusterkey">cex.clusterKey</code></td>
<td>
<p>a numerical value giving the amount by which the
clusters legend text should be magnified relative to the default <code>1</code>,
when <code>N_clusters</code> is not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_cex.main">cex.main</code></td>
<td>
<p>a numerical value giving the amount by which title text
should be magnified relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_horiz.clusterkey">horiz.clusterKey</code></td>
<td>
<p>a logical flag; if <code>TRUE</code>, set the legend for
clusters horizontally rather than vertically.  Only used if the
<code>N_clusters</code> argument is not <code>NULL</code>.  Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_main">main</code></td>
<td>
<p>a character string for an optional title.  Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_subtitle">subtitle</code></td>
<td>
<p>a character string for an optional subtitle.  Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plot.TcGSA_+3A_...">...</code></td>
<td>
<p>other parameters to be passed through to plotting functions.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>On the heatmap, each line corresponds to a gene set, and each column to a
time point.
</p>
<p>If <code>expr</code> is a matrix or a dataframe, then the &quot;original&quot; data are
plotted.  On the other hand, if <code>expr</code> is a list returned in the
<code>'Estimations'</code> element of <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>, then it is those
&quot;estimations&quot; made by the <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code> function that are plotted.
</p>
<p>If <code>descript</code> is <code>FALSE</code>, the second element of <code>margins</code> can
be reduced (for instance use <code>margins = c(5, 10)</code>), as there is not so
much need for space in order to display only the gene set names, without
their description.
</p>
<p>If there is a large number of significant gene sets, the hierarchical clustering
step repeated for each of them can take a few minutes. To speed things up 
(especially) when playing with the plotting parameters for having a nice plot,
one can run the <code>clustTrend</code> function beforehand, and plug its results 
in the <code>plot.TcGSA</code> function via the <code>clust_trends</code> argument.
</p>


<h3>Value</h3>

<p>An object of class <b><a href="stats.html#topic+hclust">hclust</a></b> which describes the tree
produced by the clustering process.  The object is a list with components:
</p>

<ul>
<li> <p><code>merge</code> an <code class="reqn">n-1</code> by <code class="reqn">2</code> matrix.  Row <code class="reqn">i</code> of
<code>merge</code> describes the merging of clusters at step i of the clustering.
If an element <code class="reqn">j</code> in the row is negative, then observation -<code class="reqn">j</code> was
merged at this stage.  If <code class="reqn">j</code> is positive then the merge was with the
cluster formed at the (earlier) stage <code class="reqn">j</code> of the algorithm.  Thus
negative entries in merge indicate agglomerations of singletons, and positive
entries indicate agglomerations of non-singletons.
</p>
</li>
<li> <p><code>height</code> a set of <code class="reqn">n-1</code> real values (non-decreasing for
ultrametric trees).  The clustering height: that is, the value of the
criterion associated with the Ward clustering method.
</p>
</li>
<li> <p><code>order</code> a vector giving the permutation of the original
observations suitable for plotting, in the sense that a cluster plot using
this ordering and matrix merge will not have crossings of the branches.
</p>
</li>
<li> <p><code>labels</code> the gene set trends name.
</p>
</li>
<li> <p><code>call</code> the call which produced the result clustering:
<br /><code>hclust(d = dist(map2heat, method = "euclidean"), method = "ward.D2")</code>
</p>
</li>
<li> <p><code>method</code> &quot;ward.D2&quot;, as it is the clustering method that has been used
for clustering the gene set trends.
</p>
</li>
<li> <p><code>dist.method</code> &quot;euclidean&quot;, as it is the distance that has been used
for clustering the gene set trends.
</p>
</li>
<li> <p><code>legend.breaks</code> a numeric vector giving the splitting points used
for coloring the heatmap.  If <code>plot</code> is <code>FALSE</code>, then it is
<code>NULL</code>.
</p>
</li>
<li> <p><code>myclusters</code> a character vector of colors for the dynamic clusters
of the represented gene set trends, with as many levels as the value of
<code>N_clusters</code>.  If no dynamic clusters were represented, than this is
<code>NULL</code>.
</p>
</li>
<li> <p><code>ddr</code> a <b>dendrogram</b> object with the reordering used for the
heatmap.  See <code>heatmap.2</code> function from package 
<code>gplots</code>.
</p>
</li>
<li><p> gene set.names character vector with the names of the gene sets
used in the heatmap.
</p>
</li>
<li> <p><code>clust.trends</code> a <b><a href="#topic+ClusteredTrends">ClusteredTrends</a></b> object.
</p>
</li>
<li> <p><code>clustersExport</code> a data frame with 2 variables containing the two
following variables : </p>
 <ul>
<li> <p><code>GeneSet</code>: the gene set trends
clustered.  </p>
</li>
<li> <p><code>Cluster</code>: the dynamic cluster they belong to.  </p>
</li></ul>
<p> The
data frame is order by the variable <code>Cluster</code>.
</p>
</li>
<li> <p><code>data_plotted</code>: the data matrix represented by the heatmap
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Boris P. Hejblum
</p>


<h3>References</h3>

<p>Hejblum BP, Skinner J, Thiebaut R, (2015) 
Time-Course Gene Set Analysis for Longitudinal Gene Expression Data. 
<em>PLOS Comput. Biol.</em> 11(6): e1004310.
doi: 10.1371/journal.pcbi.1004310
</p>


<h3>See Also</h3>

<p><code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>,
<code><a href="stats.html#topic+hclust">hclust</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(interactive()){
data(data_simu_TcGSA)

tcgsa_sim_1grp &lt;- TcGSA.LR(expr=expr_1grp, gmt=gmt_sim, design=design, 
                          subject_name="Patient_ID", time_name="TimePoint",
                          time_func="linear", crossedRandom=FALSE)
summary(tcgsa_sim_1grp)

plot(x=tcgsa_sim_1grp, expr=tcgsa_sim_1grp$Estimations, 
    Subject_ID=design$Patient_ID, TimePoint=design$TimePoint,
    baseline=1, 
    B=100,
    time_unit="H",
    dendrogram.size=0.4, heatmap.width=0.8, heatmap.height=2, cex.main=0.7
    )
           
tcgsa_sim_2grp &lt;- TcGSA.LR(expr=expr_2grp, gmt=gmt_sim, design=design, 
                          subject_name="Patient_ID", time_name="TimePoint",
                          time_func="linear", crossedRandom=FALSE, 
                          group_name="group.var")
summary(tcgsa_sim_2grp)                             
plot(x=tcgsa_sim_2grp, expr=expr_2grp, 
    Subject_ID=design$Patient_ID, TimePoint=design$TimePoint,
    B=100,
    time_unit="H",
    )
}


</code></pre>

<hr>
<h2 id='plot1GS'>Plotting a Specific Gene Set</h2><span id='topic+plot1GS'></span>

<h3>Description</h3>

<p>This function can plot different representations of the gene expression in a
specific gene set.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot1GS(
  expr,
  gmt,
  Subject_ID,
  TimePoint,
  geneset.name,
  baseline = NULL,
  group.var = NULL,
  Group_ID_paired = NULL,
  ref = NULL,
  group_of_interest = NULL,
  FUNcluster = NULL,
  clustering_metric = "euclidian",
  clustering_method = "ward",
  B = 500,
  max_trends = 4,
  aggreg.fun = "median",
  na.rm.aggreg = TRUE,
  trend.fun = "median",
  methodOptiClust = "firstSEmax",
  indiv = "genes",
  verbose = TRUE,
  clustering = TRUE,
  showTrend = TRUE,
  smooth = TRUE,
  precluster = NULL,
  time_unit = "",
  title = NULL,
  y.lab = NULL,
  desc = TRUE,
  lab.cex = 1,
  axis.cex = 1,
  main.cex = 1,
  y.lab.angle = 90,
  x.axis.angle = 45,
  margins = 1,
  line.size = 1,
  y.lim = NULL,
  x.lim = NULL,
  gg.add = list(theme()),
  plot = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot1GS_+3A_expr">expr</code></td>
<td>
<p>either a matrix or dataframe of gene expression upon which
dynamics are to be calculated, or a list of gene sets estimation of gene
expression.  In the case of a matrix or dataframe, its dimension are <code class="reqn">n</code>
x <code class="reqn">p</code>, with the <code class="reqn">p</code> sample in column and the <code class="reqn">n</code> genes in row.
In the case of a list, its length should correspond to the number of gene
sets under scrutiny and each element should be an 3 dimension array of
estimated gene expression, such as for the list returned in the
<code>'Estimations'</code> element of <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>.  See details.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_gmt">gmt</code></td>
<td>
<p>a <b>gmt</b> object containing the gene sets definition.  See
<code><a href="GSA.html#topic+GSA.read.gmt">GSA.read.gmt</a></code> and
definition on <a href="https://software.broadinstitute.org/cancer/software/gsea/wiki/index.php/Data_formats">www.software.broadinstitute.org</a>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_subject_id">Subject_ID</code></td>
<td>
<p>a factor of length <code class="reqn">p</code> that is in the same order as the
columns of <code>expr</code> (when it is a dataframe) and that contains the patient
identifier of each sample.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_timepoint">TimePoint</code></td>
<td>
<p>a numeric vector or a factor of length <code class="reqn">p</code> that is in
the same order as <code>Subject_ID</code> and the columns of <code>expr</code> (when it is
a dataframe), and that contains the time points at which gene expression was
measured.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_geneset.name">geneset.name</code></td>
<td>
<p>a character string containing the name of the gene set to
be plotted, that must appear in the <code>"geneset.names"</code> element of
<code>gmt</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_baseline">baseline</code></td>
<td>
<p>a character string which is the value of <code>TimePoint</code>
that can be used as a baseline.  Default is <code>NULL</code>, in which case no
time point is used as a baseline value for gene expression.  Has to be
<code>NULL</code> when comparing two treatment groups.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_group.var">group.var</code></td>
<td>
<p>in the case of several treatment groups, this is a factor of
length <code class="reqn">p</code> that is in the same order as <code>Timepoint</code>,
<code>Subject_ID</code> and the columns of <code>expr</code>.  It indicates to which
treatment group each sample belongs to.  Default is <code>NULL</code>, which means
that there is only one treatment group.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_group_id_paired">Group_ID_paired</code></td>
<td>
<p>a character vector of length <code class="reqn">p</code> that is in the
same order as <code>Timepoint</code>, <code>Subject_ID</code>, <code>group.var</code> and the
columns of <code>expr</code>.  This argument must not be <code>NULL</code> in the case of
a paired analysis, and must be <code>NULL</code> otherwise.  Default is
<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_ref">ref</code></td>
<td>
<p>the group which is used as reference in the case of several
treatment groups.  Default is <code>NULL</code>, which means that reference is the
first group in alphabetical order of the labels of <code>group.var</code>.  See
Details.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_group_of_interest">group_of_interest</code></td>
<td>
<p>the group of interest, for which dynamics are to be
computed in the case of several treatment groups.  Default is <code>NULL</code>,
which means that group of interest is the second group in alphabetical order
of the labels of <code>group.var</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_funcluster">FUNcluster</code></td>
<td>
<p>a function which accepts as first argument a matrix
<code>x</code> and as second argument the number of clusters desired <code>k</code>, and
which returns a list with a component named <code>'cluster'</code> which is a
vector of length <code>n = nrow(x)</code> of integers in 1:k, determining the clustering
or grouping of the n observations.  Default is <code>NULL</code>, in which case a
hierarchical clustering is performed via the function
<code><a href="cluster.html#topic+agnes">agnes</a></code>, using the metric <code>clustering_metric</code>
and the method <code>clustering_method</code>.  See <code>'FUNcluster'</code> in
<code><a href="cluster.html#topic+clusGap">clusGap</a></code> and Details.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_clustering_metric">clustering_metric</code></td>
<td>
<p>character string specifying the metric to be used
for calculating dissimilarities between observations in the hierarchical
clustering when <code>FUNcluster</code> is <code>NULL</code>.  The currently available
options are <code>"euclidean"</code> and <code>"manhattan"</code>.  Default is
<code>"euclidean"</code>.  See <code><a href="cluster.html#topic+agnes">agnes</a></code>.  Also, a <code>"sts"</code> option 
is available in TcGSA.  It implements the 'Short Time Series' distance 
[Moller-Levet et al., Fuzzy Clustering of short time series and unevenly distributed 
sampling points, <em>Advances in Intelligent Data Analysis V</em>:330-340 Springer, 2003]
designed specifically for clustering time series.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_clustering_method">clustering_method</code></td>
<td>
<p>character string defining the agglomerative method
to be used in the hierarchical clustering when <code>FUNcluster</code> is
<code>NULL</code>.  The six methods implemented are <code>"average"</code> ([unweighted
pair-]group average method, UPGMA), <code>"single"</code> (single linkage),
<code>"complete"</code> (complete linkage), <code>"ward"</code> (Ward's method),
<code>"weighted"</code> (weighted average linkage).  Default is <code>"ward"</code>.  See
<code><a href="cluster.html#topic+agnes">agnes</a></code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_b">B</code></td>
<td>
<p>integer specifying the number of Monte Carlo (&quot;bootstrap&quot;) samples
used to compute the gap statistics.  Default is <code>500</code>.  See
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_max_trends">max_trends</code></td>
<td>
<p>integer specifying the maximum number of different clusters
to be tested.  Default is <code>4</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_aggreg.fun">aggreg.fun</code></td>
<td>
<p>a character string such as  <code>"median"</code> or <code>"mean"</code>
or the name of any other defined statistics function that returns a single
numeric value.  It specifies the function used to aggregate the observations
before the clustering.  Default is to <code>"mean"</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_na.rm.aggreg">na.rm.aggreg</code></td>
<td>
<p>a logical flag indicating whether <code>NA</code> should be remove to prevent 
propagation through <code>aggreg.fun</code>. Can be useful to set to TRUE with 
unbalanced design as those will generate structural <code>NA</code>s in 
<code>$Estimations</code>. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_trend.fun">trend.fun</code></td>
<td>
<p>a character string such as <code>"mean"</code> or
the name of any other function that returns a single numeric value.  It
specifies the function used to calculate the trends of the identified
clustered.  Default is to <code>"mean"</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_methodopticlust">methodOptiClust</code></td>
<td>
<p>character string indicating how the &quot;optimal&quot; number
of clusters is computed from the gap statistics and their standard
deviations. Possible values are <code>"globalmax"</code>, <code>"firstmax"</code>,
<code>"Tibs2001SEmax"</code>, <code>"firstSEmax"</code> and <code>"globalSEmax"</code>.
Default is <code>"firstSEmax"</code>.  See <code>'method'</code> in
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>, Details and <em>Tibshirani et al.,
2001</em> in References.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_indiv">indiv</code></td>
<td>
<p>a character string indicating by which unit observations are
aggregated (through <code>aggreg.fun</code>) before the clustering.  Possible
values are <code>"genes"</code> or <code>"patients"</code>.  Default is <code>"genes"</code>.
See Details.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_verbose">verbose</code></td>
<td>
<p>logical flag enabling verbose messages to track the computing
status of the function.  Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_clustering">clustering</code></td>
<td>
<p>logical flag.  If <code>FALSE</code>, there is no clustering
representation; if <code>TRUE</code>, the lines are colored according to which
cluster they belong to.  Default is <code>TRUE</code>.  See Details.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_showtrend">showTrend</code></td>
<td>
<p>logical flag.  If <code>TRUE</code>, a black line is added for
each cluster, representing the corresponding <code>trend.fun</code>.  Default is
<code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_smooth">smooth</code></td>
<td>
<p>logical flag.  If <code>TRUE</code> and <code>showTrend</code> is also
<code>TRUE</code>, the representation of each cluster <code>trend.fun</code> is smoothed
using cubic polynomials (see <code><a href="ggplot2.html#topic+geom_smooth">geom_smooth</a></code>.
Default is <code>TRUE</code>. 
At the moment, must accept parameter <code>"na.rm"</code> (which is automatically set to <code>TRUE</code>). 
This might change in future versions</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_precluster">precluster</code></td>
<td>
<p>a vector of length <code class="reqn">p</code> that is in
the same order as <code>Subject_ID</code>, <code>TimePoint</code> and the columns of <code>expr</code> (when it is
a dataframe), and that contains a prior clustering of the subjects. Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_time_unit">time_unit</code></td>
<td>
<p>the time unit to be displayed (such as <code>"Y"</code>,
<code>"M"</code>, <code>"W"</code>, <code>"D"</code>, <code>"H"</code>, etc) next to the values of
<code>TimePoint</code> on the x-axis.  Default is <code>""</code>, in which case the time 
scale on the x-axis is proportional to the time values.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_title">title</code></td>
<td>
<p>character specifying the title of the plot.  If <code>NULL</code>, a
title is automatically generated, if <code>""</code>, no title appears.  Default is
<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_y.lab">y.lab</code></td>
<td>
<p>character specifying the annotation of the y axis.  If <code>NULL</code>, an
annotation is automatically generated, if <code>""</code>, no annotation appears.  Default is
<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_desc">desc</code></td>
<td>
<p>a logical flag. If <code>TRUE</code>, a line is added to the title of
the plot with the description of the gene set plotted (from the gmt file).
Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_lab.cex">lab.cex</code></td>
<td>
<p>a numerical value giving the amount by which lab labels text
should be magnified relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_axis.cex">axis.cex</code></td>
<td>
<p>a numerical value giving the amount by which axis annotation
text should be magnified relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_main.cex">main.cex</code></td>
<td>
<p>a numerical value giving the amount by which title text
should be magnified relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_y.lab.angle">y.lab.angle</code></td>
<td>
<p>a numerical value (in [0, 360]) giving the orientation by
which y-label text should be turned (anti-clockwise).  Default is <code>90</code>.
See <code><a href="ggplot2.html#topic+element_text">element_text</a></code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_x.axis.angle">x.axis.angle</code></td>
<td>
<p>a numerical value (in [0, 360]) giving the orientation by
which x-axis annotation text should be turned (anti-clockwise).  Default is
<code>45</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_margins">margins</code></td>
<td>
<p>a numerical value giving the amount by which the margins
should be reduced or increased relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_line.size">line.size</code></td>
<td>
<p>a numerical value giving the amount by which the line sizes
should be reduced or increased relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_y.lim">y.lim</code></td>
<td>
<p>a numeric vector of length 2 giving the range of the y-axis.
See <code><a href="graphics.html#topic+plot.default">plot.default</a></code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_x.lim">x.lim</code></td>
<td>
<p>if numeric, will create a continuous scale, if factor or
character, will create a discrete scale.  Observations not in this range will
be dropped.  See <code><a href="graphics.html#topic+xlim">xlim</a></code>.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_gg.add">gg.add</code></td>
<td>
<p>A list of instructions to add to the <code>ggplot2</code> instructions.
See <code><a href="ggplot2.html#topic++2B.gg">+.gg</a></code>.  Default is <code>list(theme())</code>, which adds nothing
to the plot.</p>
</td></tr>
<tr><td><code id="plot1GS_+3A_plot">plot</code></td>
<td>
<p>logical flag.  If <code>FALSE</code>, no plot is drawn.  Default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>expr</code> is a matrix or a dataframe, then the &quot;original&quot; data are
plotted.  On the other hand, if <code>expr</code> is a list returned in the
<code>'Estimations'</code> element of <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>, then it is those
&quot;estimations&quot; made by the <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code> function that are plotted.
</p>
<p>If <code>indiv</code> is 'genes', then each line of the plot is the median of a
gene expression over the patients. On the other hand, if <code>indiv</code> is
'patients', then each line of the plot is the median of a patient genes
expression in this gene set.
</p>
<p>This function uses the Gap statistics to determine the optimal number of
clusters in the plotted gene set.  See
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>.
</p>


<h3>Value</h3>

<p>A list with 2 elements:</p>

<ul>
<li> <p><code>classif</code>: a <code>data.frame</code> with  the 2 following variables: <code>ProbeID</code> which 
contains the IDs of the probes of the plotted gene set, and <code>Cluster</code> containing $
which cluster the probe belongs to. If <code>clustering</code> is <code>FALSE</code>, then <code>Cluster</code> is <code>NA</code> for all the probes.
</p>
</li>
<li> <p><code>p</code>: a <code>ggplot</code> object containing the plot
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Boris P. Hejblum
</p>


<h3>References</h3>

<p>Tibshirani, R., Walther, G. and Hastie, T., 2001, Estimating the
number of data clusters via the Gap statistic, <em>Journal of the Royal
Statistical Society, Series B (Statistical Methodology)</em>, <b>63</b>, 2:
411&ndash;423.
</p>


<h3>See Also</h3>

<p><code><a href="ggplot2.html#topic+ggplot">ggplot</a></code>, <code><a href="cluster.html#topic+clusGap">clusGap</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(interactive()){
data(data_simu_TcGSA)
tcgsa_sim_1grp &lt;- TcGSA.LR(expr=expr_1grp, gmt=gmt_sim, design=design, 
                          subject_name="Patient_ID", time_name="TimePoint",
                          time_func="linear", crossedRandom=FALSE)

plot1GS(expr=expr_1grp, TimePoint=design$TimePoint, 
       Subject_ID=design$Patient_ID, gmt=gmt_sim,
       geneset.name="Gene set 4",
       indiv="genes", clustering=FALSE,
       time_unit="H",
       lab.cex=0.7)

plot1GS(expr=expr_1grp, TimePoint=design$TimePoint, 
       Subject_ID=design$Patient_ID, gmt=gmt_sim,
       geneset.name="Gene set 5",
       indiv="patients", clustering=FALSE, baseline=1,
       time_unit="H",
       lab.cex=0.7)
}
if(interactive()){      
geneclusters &lt;- plot1GS(expr=tcgsa_sim_1grp$Estimations, TimePoint=design$TimePoint, 
                       Subject_ID=design$Patient_ID, gmt=gmt_sim,
                       geneset.name="Gene set 5",
                       indiv="genes",
                       time_unit="H",
                       lab.cex=0.7
)
geneclusters
}

if(interactive()){
library(grDevices)
library(graphics)
colval &lt;- c(hsv(0.56, 0.9, 1),
           hsv(0, 0.27, 1),
           hsv(0.52, 1, 0.5),
           hsv(0, 0.55, 0.97),
           hsv(0.66, 0.15, 1),
           hsv(0, 0.81, 0.55),
           hsv(0.7, 1, 0.7),
           hsv(0.42, 0.33, 1)
)
n &lt;- length(colval);  y &lt;- 1:n
op &lt;- par(mar=rep(1.5,4))
plot(y, axes = FALSE, frame.plot = TRUE,
	 xlab = "", ylab = "", pch = 21, cex = 8,
	 bg = colval, ylim=c(-1,n+1), xlim=c(-1,n+1),
	 main = "Color scale"
)
par(op)

plot1GS(expr=expr_1grp, TimePoint=design$TimePoint, 
       Subject_ID=design$Patient_ID, gmt=gmt_sim,
       geneset.name="Gene set 5",
       indiv="genes",
       time_unit="H",
       title="",
       gg.add=list(scale_color_manual(values=colval), 
                   guides(colour = guide_legend(reverse=TRUE))),
       lab.cex=0.7
)

plot1GS(expr=expr_2grp, TimePoint=design$TimePoint, 
       Subject_ID=design$Patient_ID, gmt=gmt_sim,
       geneset.name="Gene set 3",
       indiv="genes",
       group.var = design$group.var,
       time_unit="H",
       gg.add=list(scale_color_manual(values=colval), 
                   guides(colour = guide_legend(reverse=TRUE))),
       lab.cex=0.7
)

}

</code></pre>

<hr>
<h2 id='plotFit.GS'>Plotting function for exploring the fitness of the mixed modeling used in TcGSA</h2><span id='topic+plotFit.GS'></span>

<h3>Description</h3>

<p>This function plots graphs informing on the fit of the mixed modeling
of the gene expression performed in TcGSA, for 1 or several gene sets.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotFit.GS(
  x,
  expr,
  design,
  subject_name = "Patient_ID",
  time_name = "TimePoint",
  colnames_ID,
  plot_type = c("Fit", "Residuals Obs", "Residuals Est", "Histogram Obs"),
  GeneSetsList,
  color = c("genes", "time", "subjects"),
  marginal_hist = TRUE,
  gg.add = list(theme())
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plotFit.GS_+3A_x">x</code></td>
<td>
<p>a <b>tcgsa</b> object for <code>clustTrend</code>, or a
<b><a href="#topic+ClusteredTrends">ClusteredTrends</a></b> object for <code>print.ClusteredTrends</code> and
<code>plot.ClusteredTrends</code>.</p>
</td></tr>
<tr><td><code id="plotFit.GS_+3A_expr">expr</code></td>
<td>
<p>a matrix or dataframe of gene expression.  Its dimension are
<code class="reqn">n</code>x<code class="reqn">p</code>, with the <code class="reqn">p</code> samples in column and the <code class="reqn">n</code> genes in
row.</p>
</td></tr>
<tr><td><code id="plotFit.GS_+3A_design">design</code></td>
<td>
<p>a matrix or dataframe containing the experimental variables that used in the model,
namely <code>subject_name</code>, <code>time_name</code>, and <code>covariates_fixed</code> 
and <code>time_covariates</code> if applicable.  Its dimension are <code class="reqn">p</code>x<code class="reqn">m</code> 
and its row are is in the same order as the columns of <code>expr</code>.</p>
</td></tr>
<tr><td><code id="plotFit.GS_+3A_subject_name">subject_name</code></td>
<td>
<p>the name of the factor variable from <code>design</code> that contains the information on 
the repetition units used in the mixed model, such as the patient identifiers for instance.  
Default is <code>'Patient_ID'</code>.  See Details.</p>
</td></tr>
<tr><td><code id="plotFit.GS_+3A_time_name">time_name</code></td>
<td>
<p>the name of a numeric variable from <code>design</code> that contains 
the information on the time replicates (the time points at which gene 
expression was measured).  Default is <code>'TimePoint'</code>.  See Details.</p>
</td></tr>
<tr><td><code id="plotFit.GS_+3A_colnames_id">colnames_ID</code></td>
<td>
<p>the name of the variable from <code>design</code> that contains the column names of the <code>expr</code>
expression data matrix.  See Details.</p>
</td></tr>
<tr><td><code id="plotFit.GS_+3A_plot_type">plot_type</code></td>
<td>
<p>a character string indicating the type of plot to be drawn.  The options are 
<code>'Fit'</code>, <code>'Residuals Obs'</code>, <code>'Residuals Est'</code> or <code>'Histogram Obs'</code>.</p>
</td></tr>
<tr><td><code id="plotFit.GS_+3A_genesetslist">GeneSetsList</code></td>
<td>
<p>a character string containing the names of the gene set whose fit is being checked. 
If several gene sets are being checked, can be a character list or vector of the 
names of those gene sets.</p>
</td></tr>
<tr><td><code id="plotFit.GS_+3A_color">color</code></td>
<td>
<p>a character string indicating which color scale should be used. One of the 3 : 
<code>'genes'</code>, <code>'time'</code>, <code>'subjects'</code>, otherwise, no coloring is used.</p>
</td></tr>
<tr><td><code id="plotFit.GS_+3A_marginal_hist">marginal_hist</code></td>
<td>
<p>a logical flag indicating whether marginal histograms should be drawn. 
Only used for <code>'Fit'</code> plot type. Default is <code>'TRUE'</code></p>
</td></tr>
<tr><td><code id="plotFit.GS_+3A_gg.add">gg.add</code></td>
<td>
<p>A list of instructions to add to the <code>ggplot2</code> instructions.
See <code><a href="ggplot2.html#topic++2B.gg">+.gg</a></code>.  Default is <code>list(theme())</code>, which adds nothing
to the plot.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Boris P. Hejblum
</p>


<h3>References</h3>

<p>Hejblum BP, Skinner J, Thiebaut R, (2015) 
Time-Course Gene Set Analysis for Longitudinal Gene Expression Data. 
<em>PLOS Comput. Biol.</em> 11(6):e1004310.
doi: 10.1371/journal.pcbi.1004310
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot1GS">plot1GS</a></code>, <code><a href="#topic+plotSelect.GS">plotSelect.GS</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(interactive()){

data(data_simu_TcGSA)

tcgsa_sim_1grp &lt;- TcGSA.LR(expr=expr_1grp, gmt=gmt_sim, design=design, 
                          subject_name="Patient_ID", time_name="TimePoint",
                          time_func="linear", crossedRandom=FALSE)
plotFit.GS(x=tcgsa_sim_1grp, expr=expr_1grp, design=design,
				 subject_name="Patient_ID", time_name="TimePoint",
				 colnames_ID="Sample_name", 
				 plot_type="Residuals Obs", 
				 GeneSetsList=c("Gene set 1", "Gene set 2", "Gene set 3",
				                "Gene set 4", "Gene set 5"),
				 color="genes", gg.add=list(guides(color=FALSE))
)

plotFit.GS(x=tcgsa_sim_1grp, expr=expr_1grp, design=design,
          subject_name="Patient_ID", time_name="TimePoint",
          colnames_ID="Sample_name", 
          plot_type="Histogram Obs", 
          GeneSetsList=c("Gene set 1", "Gene set 5"),
          color="genes", gg.add=list(guides(fill=FALSE))
          )
          
plotFit.GS(x=tcgsa_sim_1grp, expr=expr_1grp, design=design,
          subject_name="Patient_ID", time_name="TimePoint",
          colnames_ID="Sample_name", 
          plot_type="Histogram Obs", 
          GeneSetsList=c("Gene set 1", "Gene set 2", "Gene set 3",
		                "Gene set 4", "Gene set 5"),
          color="genes")
}

</code></pre>

<hr>
<h2 id='plotMultipleGS'>Plotting Multiple Gene Sets in a single plot</h2><span id='topic+plotMultipleGS'></span>

<h3>Description</h3>

<p>This function can plot different representations of the gene expression 
in a list of gene sets.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotMultipleGS(
  genesets_list,
  ncolumns = 1,
  labels = NULL,
  expr,
  gmt,
  Subject_ID,
  TimePoint,
  baseline = NULL,
  group.var = NULL,
  Group_ID_paired = NULL,
  ref = NULL,
  group_of_interest = NULL,
  FUNcluster = NULL,
  clustering_metric = "euclidian",
  clustering_method = "ward",
  B = 500,
  max_trends = 4,
  aggreg.fun = "median",
  na.rm.aggreg = TRUE,
  trend.fun = "median",
  methodOptiClust = "firstSEmax",
  indiv = "genes",
  verbose = TRUE,
  clustering = TRUE,
  showTrend = TRUE,
  smooth = TRUE,
  time_unit = "",
  y.lab = NULL,
  desc = TRUE,
  lab.cex = 1,
  axis.cex = 1,
  main.cex = 1,
  y.lab.angle = 90,
  x.axis.angle = 45,
  margins = 1,
  line.size = 1,
  y.lim = NULL,
  x.lim = NULL,
  gg.add = list(),
  show_plot = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plotMultipleGS_+3A_genesets_list">genesets_list</code></td>
<td>
<p>a list of the character strings giving the names of the 
gene sets to be plotted as they appear in <code>gmt</code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_ncolumns">ncolumns</code></td>
<td>
<p>the number of columns used to display the multiple plots. 
Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_labels">labels</code></td>
<td>
<p>List of labels to be added to the plots. 
You can also set <code>labels="AUTO"</code> to auto-generate upper-case labels (such as <code>A</code>, <code>B</code>, ...) 
or <code>labels="auto"</code> to auto-generate lower-case labels.
Default is <code>NULL</code></p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_expr">expr</code></td>
<td>
<p>either a matrix or dataframe of gene expression upon which
dynamics are to be calculated, or a list of gene sets estimation of gene
expression.  In the case of a matrix or dataframe, its dimension are <code class="reqn">n</code>
x <code class="reqn">p</code>, with the <code class="reqn">p</code> sample in column and the <code class="reqn">n</code> genes in row.
In the case of a list, its length should correspond to the number of gene
sets under scrutiny and each element should be an 3 dimension array of
estimated gene expression, such as for the list returned in the
<code>'Estimations'</code> element of <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>.  See details.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_gmt">gmt</code></td>
<td>
<p>a <b>gmt</b> object containing the gene sets definition.  See
<code><a href="GSA.html#topic+GSA.read.gmt">GSA.read.gmt</a></code> and
definition on <a href="https://software.broadinstitute.org/cancer/software/gsea/wiki/index.php/Data_formats">www.software.broadinstitute.org</a>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_subject_id">Subject_ID</code></td>
<td>
<p>a factor of length <code class="reqn">p</code> that is in the same order as the
columns of <code>expr</code> (when it is a dataframe) and that contains the patient
identifier of each sample.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_timepoint">TimePoint</code></td>
<td>
<p>a numeric vector or a factor of length <code class="reqn">p</code> that is in
the same order as <code>Subject_ID</code> and the columns of <code>expr</code> (when it is
a dataframe), and that contains the time points at which gene expression was
measured.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_baseline">baseline</code></td>
<td>
<p>a character string which is the value of <code>TimePoint</code>
that can be used as a baseline.  Default is <code>NULL</code>, in which case no
time point is used as a baseline value for gene expression.  Has to be
<code>NULL</code> when comparing two treatment groups.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_group.var">group.var</code></td>
<td>
<p>in the case of several treatment groups, this is a factor of
length <code class="reqn">p</code> that is in the same order as <code>Timepoint</code>,
<code>Subject_ID</code> and the columns of <code>expr</code>.  It indicates to which
treatment group each sample belongs to.  Default is <code>NULL</code>, which means
that there is only one treatment group.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_group_id_paired">Group_ID_paired</code></td>
<td>
<p>a character vector of length <code class="reqn">p</code> that is in the
same order as <code>Timepoint</code>, <code>Subject_ID</code>, <code>group.var</code> and the
columns of <code>expr</code>.  This argument must not be <code>NULL</code> in the case of
a paired analysis, and must be <code>NULL</code> otherwise.  Default is
<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_ref">ref</code></td>
<td>
<p>the group which is used as reference in the case of several
treatment groups.  Default is <code>NULL</code>, which means that reference is the
first group in alphabetical order of the labels of <code>group.var</code>.  See
Details.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_group_of_interest">group_of_interest</code></td>
<td>
<p>the group of interest, for which dynamics are to be
computed in the case of several treatment groups.  Default is <code>NULL</code>,
which means that group of interest is the second group in alphabetical order
of the labels of <code>group.var</code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_funcluster">FUNcluster</code></td>
<td>
<p>a function which accepts as first argument a matrix
<code>x</code> and as second argument the number of clusters desired <code>k</code>, and
which returns a list with a component named <code>'cluster'</code> which is a
vector of length <code>n = nrow(x)</code> of integers in 1:k, determining the clustering
or grouping of the n observations.  Default is <code>NULL</code>, in which case a
hierarchical clustering is performed via the function
<code><a href="cluster.html#topic+agnes">agnes</a></code>, using the metric <code>clustering_metric</code>
and the method <code>clustering_method</code>.  See <code>'FUNcluster'</code> in
<code><a href="cluster.html#topic+clusGap">clusGap</a></code> and Details.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_clustering_metric">clustering_metric</code></td>
<td>
<p>character string specifying the metric to be used
for calculating dissimilarities between observations in the hierarchical
clustering when <code>FUNcluster</code> is <code>NULL</code>.  The currently available
options are <code>"euclidean"</code> and <code>"manhattan"</code>.  Default is
<code>"euclidean"</code>.  See <code><a href="cluster.html#topic+agnes">agnes</a></code>.  Also, a <code>"sts"</code> option 
is available in TcGSA.  It implements the 'Short Time Series' distance 
[Moller-Levet et al., Fuzzy Clustering of short time series and unevenly distributed 
sampling points, <em>Advances in Intelligent Data Analysis V</em>:330-340 Springer, 2003]
designed specifically for clustering time series.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_clustering_method">clustering_method</code></td>
<td>
<p>character string defining the agglomerative method
to be used in the hierarchical clustering when <code>FUNcluster</code> is
<code>NULL</code>.  The six methods implemented are <code>"average"</code> ([unweighted
pair-]group average method, UPGMA), <code>"single"</code> (single linkage),
<code>"complete"</code> (complete linkage), <code>"ward"</code> (Ward's method),
<code>"weighted"</code> (weighted average linkage).  Default is <code>"ward"</code>.  See
<code><a href="cluster.html#topic+agnes">agnes</a></code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_b">B</code></td>
<td>
<p>integer specifying the number of Monte Carlo (&quot;bootstrap&quot;) samples
used to compute the gap statistics.  Default is <code>500</code>.  See
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_max_trends">max_trends</code></td>
<td>
<p>integer specifying the maximum number of different clusters
to be tested.  Default is <code>4</code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_aggreg.fun">aggreg.fun</code></td>
<td>
<p>a character string such as <code>"median"</code> or <code>"mean"</code>
or the name of any other defined statistics function that returns a single
numeric value.  It specifies the function used to aggregate the observations
before the clustering. Default is to <code>"median"</code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_na.rm.aggreg">na.rm.aggreg</code></td>
<td>
<p>a logical flag indicating whether <code>NA</code> should be remove to prevent 
propagation through <code>aggreg.fun</code>. Can be useful to set to TRUE with 
unbalanced design as those will generate structural <code>NA</code>s in 
<code>$Estimations</code>. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_trend.fun">trend.fun</code></td>
<td>
<p>a character string such as <code>"mean"</code> or
the name of any other function that returns a single numeric value.  It
specifies the function used to calculate the trends of the identified
clustered.  Default is to <code>"mean"</code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_methodopticlust">methodOptiClust</code></td>
<td>
<p>character string indicating how the &quot;optimal&quot; number
of clusters is computed from the gap statistics and their standard
deviations. Possible values are <code>"globalmax"</code>, <code>"firstmax"</code>,
<code>"Tibs2001SEmax"</code>, <code>"firstSEmax"</code> and <code>"globalSEmax"</code>.
Default is <code>"firstSEmax"</code>.  See <code>'method'</code> in
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>, Details and <em>Tibshirani et al.,
2001</em> in References.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_indiv">indiv</code></td>
<td>
<p>a character string indicating by which unit observations are
aggregated (through <code>aggreg.fun</code>) before the clustering.  Possible
values are <code>"genes"</code> or <code>"patients"</code>.  Default is <code>"genes"</code>.
See Details.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_verbose">verbose</code></td>
<td>
<p>logical flag enabling verbose messages to track the computing
status of the function.  Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_clustering">clustering</code></td>
<td>
<p>logical flag.  If <code>FALSE</code>, there is no clustering
representation; if <code>TRUE</code>, the lines are colored according to which
cluster they belong to.  Default is <code>TRUE</code>.  See Details.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_showtrend">showTrend</code></td>
<td>
<p>logical flag.  If <code>TRUE</code>, a black line is added for
each cluster, representing the corresponding <code>trend.fun</code>.  Default is
<code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_smooth">smooth</code></td>
<td>
<p>logical flag.  If <code>TRUE</code> and <code>showTrend</code> is also
<code>TRUE</code>, the representation of each cluster <code>trend.fun</code> is smoothed
using cubic polynomials (see <code><a href="ggplot2.html#topic+geom_smooth">geom_smooth</a></code>.
Default is <code>TRUE</code>. 
At the moment, must accept parameter <code>"na.rm"</code> (which is automatically set to <code>TRUE</code>). 
This might change in future versions</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_time_unit">time_unit</code></td>
<td>
<p>the time unit to be displayed (such as <code>"Y"</code>,
<code>"M"</code>, <code>"W"</code>, <code>"D"</code>, <code>"H"</code>, etc) next to the values of
<code>TimePoint</code> on the x-axis.  Default is <code>""</code>, in which case the time 
scale on the x-axis is proportional to the time values.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_y.lab">y.lab</code></td>
<td>
<p>character specifying the annotation of the y axis.  If <code>NULL</code>, an
annotation is automatically generated, if <code>""</code>, no annotation appears.  Default is
<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_desc">desc</code></td>
<td>
<p>a logical flag. If <code>TRUE</code>, a line is added to the title of
the plot with the description of the gene set plotted (from the gmt file).
Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_lab.cex">lab.cex</code></td>
<td>
<p>a numerical value giving the amount by which lab labels text
should be magnified relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_axis.cex">axis.cex</code></td>
<td>
<p>a numerical value giving the amount by which axis annotation
text should be magnified relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_main.cex">main.cex</code></td>
<td>
<p>a numerical value giving the amount by which title text
should be magnified relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_y.lab.angle">y.lab.angle</code></td>
<td>
<p>a numerical value (in [0, 360]) giving the orientation by
which y-label text should be turned (anti-clockwise).  Default is <code>90</code>.
See <code><a href="ggplot2.html#topic+element_text">element_text</a></code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_x.axis.angle">x.axis.angle</code></td>
<td>
<p>a numerical value (in [0, 360]) giving the orientation by
which x-axis annotation text should be turned (anti-clockwise).  Default is
<code>45</code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_margins">margins</code></td>
<td>
<p>a numerical value giving the amount by which the margins
should be reduced or increased relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_line.size">line.size</code></td>
<td>
<p>a numerical value giving the amount by which the line sizes
should be reduced or increased relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_y.lim">y.lim</code></td>
<td>
<p>a numeric vector of length 2 giving the range of the y-axis.
See <code><a href="graphics.html#topic+plot.default">plot.default</a></code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_x.lim">x.lim</code></td>
<td>
<p>if numeric, will create a continuous scale, if factor or
character, will create a discrete scale.  Observations not in this range will
be dropped.  See <code><a href="graphics.html#topic+xlim">xlim</a></code>.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_gg.add">gg.add</code></td>
<td>
<p>A list of instructions to add to the <code>ggplot2</code> instructions.
See <code><a href="ggplot2.html#topic++2B.gg">+.gg</a></code>.  Default is <code>list(theme())</code>, which adds nothing
to the plot.</p>
</td></tr>
<tr><td><code id="plotMultipleGS_+3A_show_plot">show_plot</code></td>
<td>
<p>logical flag. If <code>FALSE</code>, no plot is drawn. Default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>expr</code> is a matrix or a dataframe, then the &quot;original&quot; data are
plotted.  On the other hand, if <code>expr</code> is a list returned in the
<code>'Estimations'</code> element of <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>, then it is those
&quot;estimations&quot; made by the <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code> function that are plotted.
</p>
<p>If <code>indiv</code> is 'genes', then each line of the plot is the median of a
gene expression over the patients. On the other hand, if <code>indiv</code> is
'patients', then each line of the plot is the median of a patient genes
expression in this gene set.
</p>
<p>This function uses the Gap statistics to determine the optimal number of
clusters in the plotted gene set.  See
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>.
</p>


<h3>Value</h3>

<p>A list with 2 elements:</p>

<ul>
<li> <p><code>classif</code>: a <code>data.frame</code> with  the 2 following variables: <code>ProbeID</code> which 
contains the IDs of the probes of the plotted gene set, and <code>Cluster</code> containing $
which cluster the probe belongs to. If <code>clustering</code> is <code>FALSE</code>, then <code>Cluster</code> is <code>NA</code> for all the probes.
</p>
</li>
<li> <p><code>p</code>: a <code>ggplot</code> object containing the plot
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Boris P. Hejblum
</p>


<h3>See Also</h3>

<p><code><a href="ggplot2.html#topic+ggplot">ggplot</a></code>, <code><a href="cluster.html#topic+clusGap">clusGap</a></code>
</p>

<hr>
<h2 id='plotPat.1GS'>Plotting a Specific Gene Set Stratifying on Patients</h2><span id='topic+plotPat.1GS'></span>

<h3>Description</h3>

<p>This function can plot different representations of the gene expression in a
specific gene set, stratified on all subjects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotPat.1GS(
  expr,
  gmt,
  Subject_ID,
  TimePoint,
  geneset.name,
  baseline = NULL,
  group.var = NULL,
  Group_ID_paired = NULL,
  ref = NULL,
  group_of_interest = NULL,
  FUNcluster = NULL,
  clustering_metric = "euclidian",
  clustering_method = "ward",
  B = 500,
  max_trends = 4,
  aggreg.fun = "median",
  na.rm.aggreg = TRUE,
  trend.fun = "median",
  methodOptiClust = "firstSEmax",
  verbose = TRUE,
  clustering = TRUE,
  time_unit = "",
  title = NULL,
  y.lab = NULL,
  desc = TRUE,
  lab.cex = 1,
  axis.cex = 1,
  main.cex = 1,
  y.lab.angle = 90,
  x.axis.angle = 45,
  y.lim = NULL,
  x.lim = NULL,
  gg.add = list(theme())
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plotPat.1GS_+3A_expr">expr</code></td>
<td>
<p>either a matrix or dataframe of gene expression upon which
dynamics are to be calculated, or a list of gene sets estimation of gene
expression.  In the case of a matrix or dataframe, its dimension are <code class="reqn">n</code>
x <code class="reqn">p</code>, with the <code class="reqn">p</code> sample in column and the <code class="reqn">n</code> genes in row.
In the case of a list, its length should correspond to the number of gene
sets under scrutiny and each element should be an 3 dimension array of
estimated gene expression, such as for the list returned in the
<code>'Estimations'</code> element of <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>.  See details.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_gmt">gmt</code></td>
<td>
<p>a <b>gmt</b> object containing the gene sets definition.  See
<code><a href="GSA.html#topic+GSA.read.gmt">GSA.read.gmt</a></code> and
definition on <a href="https://software.broadinstitute.org/cancer/software/gsea/wiki/index.php/Data_formats">www.software.broadinstitute.org</a>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_subject_id">Subject_ID</code></td>
<td>
<p>a factor of length <code class="reqn">p</code> that is in the same order as the
columns of <code>expr</code> (when it is a dataframe) and that contains the patient
identifier of each sample.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_timepoint">TimePoint</code></td>
<td>
<p>a numeric vector or a factor of length <code class="reqn">p</code> that is in
the same order as <code>TimePoint</code> and the columns of <code>expr</code> (when it is
a dataframe), and that contains the time points at which gene expression was
measured.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_geneset.name">geneset.name</code></td>
<td>
<p>a character string containing the name of the gene set to
be plotted, that must appear in the <code>"geneset.names"</code> element of
<code>gmt</code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_baseline">baseline</code></td>
<td>
<p>a character string which is the value of <code>TimePoint</code>
that can be used as a baseline.  Default is <code>NULL</code>, in which case no
time point is used as a baseline value for gene expression.  Has to be
<code>NULL</code> when comparing two treatment groups.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_group.var">group.var</code></td>
<td>
<p>in the case of several treatment groups, this is a factor of
length <code class="reqn">p</code> that is in the same order as <code>Timepoint</code>,
<code>Subject_ID</code> and the columns of <code>expr</code>.  It indicates to which
treatment group each sample belongs to.  Default is <code>NULL</code>, which means
that there is only one treatment group.  See Details.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_group_id_paired">Group_ID_paired</code></td>
<td>
<p>a character vector of length <code class="reqn">p</code> that is in the
same order as <code>Timepoint</code>, <code>Subject_ID</code>, <code>group.var</code> and the
columns of <code>expr</code>.  This argument must not be <code>NULL</code> in the case of
a paired analysis, and must be <code>NULL</code> otherwise.  Default is
<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_ref">ref</code></td>
<td>
<p>the group which is used as reference in the case of several
treatment groups.  Default is <code>NULL</code>, which means that reference is the
first group in alphabetical order of the labels of <code>group.var</code>.  See
Details.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_group_of_interest">group_of_interest</code></td>
<td>
<p>the group of interest, for which dynamics are to be
computed in the case of several treatment groups.  Default is <code>NULL</code>,
which means that group of interest is the second group in alphabetical order
of the labels of <code>group.var</code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_funcluster">FUNcluster</code></td>
<td>
<p>a function which accepts as first argument a matrix
<code>x</code> and as second argument the number of clusters desired <code>k</code>, and
which returns a list with a component named <code>'cluster'</code> which is a
vector of length <code>n = nrow(x)</code> of integers in 1:k, determining the clustering
or grouping of the n observations.  Default is <code>NULL</code>, in which case a
hierarchical clustering is performed via the function
<code><a href="cluster.html#topic+agnes">agnes</a></code>, using the metric <code>clustering_metric</code>
and the method <code>clustering_method</code>.  See <code>'FUNcluster'</code> in
<code><a href="cluster.html#topic+clusGap">clusGap</a></code> and Details.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_clustering_metric">clustering_metric</code></td>
<td>
<p>character string specifying the metric to be used
for calculating dissimilarities between observations in the hierarchical
clustering when <code>FUNcluster</code> is <code>NULL</code>.  The currently available
options are <code>"euclidean"</code> and <code>"manhattan"</code>.  Default is
<code>"euclidean"</code>.  See <code><a href="cluster.html#topic+agnes">agnes</a></code>.  Also, a <code>"sts"</code> option 
is available in TcGSA.  It implements the 'Short Time Series' distance 
[Moller-Levet et al., Fuzzy Clustering of short time series and unevenly distributed 
sampling points, <em>Advances in Intelligent Data Analysis V</em>:330-340 Springer, 2003]
designed specifically for clustering time series.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_clustering_method">clustering_method</code></td>
<td>
<p>character string defining the agglomerative method
to be used in the hierarchical clustering when <code>FUNcluster</code> is
<code>NULL</code>.  The six methods implemented are <code>"average"</code> ([unweighted
pair-]group average method, UPGMA), <code>"single"</code> (single linkage),
<code>"complete"</code> (complete linkage), <code>"ward"</code> (Ward's method),
<code>"weighted"</code> (weighted average linkage).  Default is <code>"ward"</code>.  See
<code><a href="cluster.html#topic+agnes">agnes</a></code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_b">B</code></td>
<td>
<p>integer specifying the number of Monte Carlo (&quot;bootstrap&quot;) samples
used to compute the gap statistics.  Default is <code>500</code>.  See
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_max_trends">max_trends</code></td>
<td>
<p>integer specifying the maximum number of different clusters
to be tested.  Default is <code>4</code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_aggreg.fun">aggreg.fun</code></td>
<td>
<p>a character string such as <code>"mean"</code>, <code>"median"</code>
or the name of any other defined statistics function that returns a single
numeric value.  It specifies the function used to aggregate the observations
before the clustering.  Default is to <code>median</code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_na.rm.aggreg">na.rm.aggreg</code></td>
<td>
<p>a logical flag indicating whether <code>NA</code> should be remove to prevent 
propagation through <code>aggreg.fun</code>. Can be useful to set to TRUE with 
unbalanced design as those will generate structural <code>NA</code>s in 
<code>$Estimations</code>. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_trend.fun">trend.fun</code></td>
<td>
<p>a character string such as <code>"mean"</code>, <code>"median"</code> or
the name of any other function that returns a single numeric value.  It
specifies the function used to calculate the trends of the identified
clustered.  Default is to <code>median</code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_methodopticlust">methodOptiClust</code></td>
<td>
<p>character string indicating how the &quot;optimal&quot; number
of clusters is computed from the gap statistics and their standard
deviations. Possible values are <code>"globalmax"</code>, <code>"firstmax"</code>,
<code>"Tibs2001SEmax"</code>, <code>"firstSEmax"</code> and <code>"globalSEmax"</code>.
Default is <code>"firstSEmax"</code>.  See <code>'method'</code> in
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>, Details and <em>Tibshirani et al.,
2001</em> in References.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_verbose">verbose</code></td>
<td>
<p>logical flag enabling verbose messages to track the computing
status of the function.  Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_clustering">clustering</code></td>
<td>
<p>logical flag.  If <code>FALSE</code>, there is no clustering
representation; if <code>TRUE</code>, the lines are colored according to which
cluster they belong to.  Default is <code>TRUE</code>.  See Details.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_time_unit">time_unit</code></td>
<td>
<p>the time unit to be displayed (such as <code>"Y"</code>,
<code>"M"</code>, <code>"W"</code>, <code>"D"</code>, <code>"H"</code>, etc) next to the values of
<code>TimePoint</code> on the x-axis.  Default is <code>""</code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_title">title</code></td>
<td>
<p>character specifying the title of the plot.  If <code>NULL</code>, a
title is automatically generated, if <code>""</code>, no title appears.  Default is
<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_y.lab">y.lab</code></td>
<td>
<p>character specifying the annotation of the y axis.  If <code>NULL</code>, an
annotation is automatically generated, if <code>""</code>, no annotation appears.  Default is
<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_desc">desc</code></td>
<td>
<p>a logical flag. If <code>TRUE</code>, a line is added to the title of
the plot with the description of the gene set plotted (from the gmt file).
Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_lab.cex">lab.cex</code></td>
<td>
<p>a numerical value giving the amount by which lab labels text
should be magnified relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_axis.cex">axis.cex</code></td>
<td>
<p>a numerical value giving the amount by which axis annotation
text should be magnified relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_main.cex">main.cex</code></td>
<td>
<p>a numerical value giving the amount by which title text
should be magnified relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_y.lab.angle">y.lab.angle</code></td>
<td>
<p>a numerical value (in [0, 360]) giving the orientation by
which y-label text should be turned (anti-clockwise).  Default is <code>90</code>.
See <code><a href="ggplot2.html#topic+element_text">element_text</a></code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_x.axis.angle">x.axis.angle</code></td>
<td>
<p>a numerical value (in [0, 360]) giving the orientation by
which x-axis annotation text should be turned (anti-clockwise).  Default is
<code>45</code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_y.lim">y.lim</code></td>
<td>
<p>a numeric vector of length 2 giving the range of the y-axis.
See <code><a href="graphics.html#topic+plot.default">plot.default</a></code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_x.lim">x.lim</code></td>
<td>
<p>if numeric, will create a continuous scale, if factor or
character, will create a discrete scale.  Observations not in this range will
be dropped.  See <code><a href="graphics.html#topic+xlim">xlim</a></code>.</p>
</td></tr>
<tr><td><code id="plotPat.1GS_+3A_gg.add">gg.add</code></td>
<td>
<p>A list of instructions to add to the <code>ggplot2</code> instructions.
See <code><a href="ggplot2.html#topic++2B.gg">+.gg</a></code>.  Default is <code>list(theme())</code>, which adds nothing
to the plot.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>expr</code> is a matrix or a dataframe, then the &quot;original&quot; data are
plotted.  On the other hand, if <code>expr</code> is a list returned in the
<code>'Estimations'</code> element of <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>, then it is those
&quot;estimations&quot; made by the <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code> function that are plotted.
</p>
<p>If <code>indiv</code> is 'genes', then each line of the plot is the median of a
gene expression over the patients. On the other hand, if <code>indiv</code> is
'patients', then each line of the plot is the median of a patient genes
expression in this gene set.
</p>
<p>This function uses the Gap statistics to determine the optimal number of
clusters in the plotted gene set.  See
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>.
</p>


<h3>Value</h3>

<p>A dataframe the 2 following variables: </p>

<ul>
<li> <p><code>ProbeID</code> which contains the IDs of the probes of the plotted gene set.
</p>
</li>
<li> <p><code>Cluster</code> which to which cluster the probe belongs to.
</p>
</li></ul>
<p> If <code>clustering</code> is <code>FALSE</code>, then <code>Cluster</code> is <code>NA</code> for all the probes.
</p>


<h3>Author(s)</h3>

<p>Boris P. Hejblum
</p>


<h3>References</h3>

<p>Tibshirani, R., Walther, G. and Hastie, T., 2001, Estimating the
number of data clusters via the Gap statistic, <em>Journal of the Royal
Statistical Society, Series B (Statistical Methodology)</em>, <b>63</b>, 2:
411&ndash;423.
</p>


<h3>See Also</h3>

<p><code><a href="ggplot2.html#topic+ggplot">ggplot</a></code>, <code><a href="cluster.html#topic+clusGap">clusGap</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(interactive()){
data(data_simu_TcGSA)
tcgsa_sim_1grp &lt;- TcGSA.LR(expr=expr_1grp, gmt=gmt_sim, design=design, 
                          subject_name="Patient_ID", time_name="TimePoint",
                          time_func="linear", crossedRandom=FALSE)

plotPat.1GS(expr=expr_1grp, TimePoint=design$TimePoint, 
       Subject_ID=design$Patient_ID, gmt=gmt_sim,
       geneset.name="Gene set 4",
       clustering=FALSE,
       time_unit="H",
       lab.cex=0.7)

plotPat.1GS(expr=expr_1grp, TimePoint=design$TimePoint, 
       Subject_ID=design$Patient_ID, gmt=gmt_sim,
       geneset.name="Gene set 4",
       clustering=FALSE, baseline=1,
       time_unit="H",
       lab.cex=0.7)
       
colval &lt;- c(hsv(0.56, 0.9, 1),
           hsv(0, 0.27, 1),
           hsv(0.52, 1, 0.5),
           hsv(0, 0.55, 0.97),
           hsv(0.66, 0.15, 1),
           hsv(0, 0.81, 0.55),
           hsv(0.7, 1, 0.7),
           hsv(0.42, 0.33, 1)
)
n &lt;- length(colval);  y &lt;- 1:n
op &lt;- par(mar=rep(1.5,4))
plot(y, axes = FALSE, frame.plot = TRUE,
	 xlab = "", ylab = "", pch = 21, cex = 8,
	 bg = colval, ylim=c(-1,n+1), xlim=c(-1,n+1),
	 main = "Color scale"
)
par(op)

plotPat.1GS(expr=expr_1grp, TimePoint=design$TimePoint, 
       Subject_ID=design$Patient_ID, gmt=gmt_sim,
       geneset.name="Gene set 5",
       time_unit="H",
       title="",
       gg.add=list(scale_color_manual(values=colval)),
       lab.cex=0.7
)

plotPat.1GS(expr=tcgsa_sim_1grp$Estimations, TimePoint=design$TimePoint, 
       Subject_ID=design$Patient_ID, gmt=gmt_sim,
       geneset.name="Gene set 3",
       time_unit="H",
       lab.cex=0.7
)
}

</code></pre>

<hr>
<h2 id='plotPat.TcGSA'>Plot a Gene Set Trends Heatmap for each Patient.</h2><span id='topic+plotPat.TcGSA'></span>

<h3>Description</h3>

<p>This function plots a series of gene sets dynamic trends heatmaps.  One
heatmap is drawn for each patient. NOT IMPLEMENTED YET (TODO)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotPat.TcGSA(
  x,
  threshold = 0.05,
  myproc = "BY",
  nbsimu_pval = 1e+06,
  expr,
  Subject_ID,
  TimePoint,
  baseline = NULL,
  only.signif = TRUE,
  group.var = NULL,
  Group_ID_paired = NULL,
  ref = NULL,
  group_of_interest = NULL,
  FUNcluster = NULL,
  clustering_metric = "euclidian",
  clustering_method = "ward",
  B = 500,
  max_trends = 4,
  aggreg.fun = "median",
  na.rm.aggreg = TRUE,
  methodOptiClust = "firstSEmax",
  verbose = TRUE,
  clust_trends = NULL,
  N_clusters = NULL,
  myclusters = NULL,
  label.clusters = NULL,
  prev_rowCL = NULL,
  descript = TRUE,
  plotAll = TRUE,
  color.vec = c("darkred", "#D73027", "#FC8D59", "snow", "#91BFDB", "#4575B4",
    "darkblue"),
  legend.breaks = NULL,
  label.column = NULL,
  time_unit = "",
  cex.label.row = 1,
  cex.label.column = 1,
  margins = c(5, 25),
  heatKey.size = 1,
  dendrogram.size = 1,
  heatmap.height = 1,
  heatmap.width = 1,
  cex.clusterKey = 1,
  cex.main = 1,
  horiz.clusterKey = TRUE,
  main = NULL,
  subtitle = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plotPat.TcGSA_+3A_x">x</code></td>
<td>
<p>a <b>tcgsa</b> object.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_threshold">threshold</code></td>
<td>
<p>the threshold at which the FDR or the FWER should be controlled.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_myproc">myproc</code></td>
<td>
<p>a vector of character strings containing the names of the
multiple testing procedures for which adjusted p-values are to be computed.
This vector should include any of the following: &quot;<code>Bonferroni</code>&quot;,
&quot;<code>Holm</code>&quot;, &quot;<code>Hochberg</code>&quot;, &quot;<code>SidakSS</code>&quot;, &quot;<code>SidakSD</code>&quot;,
&quot;<code>BH</code>&quot;, &quot;<code>BY</code>&quot;, &quot;<code>ABH</code>&quot;, &quot;<code>TSBH</code>&quot; or &quot;<code>none</code>&quot;.  
&quot;<code>none</code>&quot; indicates no adjustment for multiple testing. See
<code><a href="multtest.html#topic+mt.rawp2adjp">mt.rawp2adjp</a></code> for details.  Default is
&quot;<code>BY</code>&quot;, the Benjamini &amp; Yekutieli (2001) step-up FDR-controlling
procedure (general dependency structures).  In order to control the FWER(in
case of an analysis that is more a hypothesis confirmation than an
exploration of the expression data), we recommend to use &quot;<code>Holm</code>&quot;, the
Holm (1979) step-down adjusted p-values for strong control of the FWER.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_nbsimu_pval">nbsimu_pval</code></td>
<td>
<p>the number of observations under the null distribution to
be generated in order to compute the p-values. Default is <code>1e+06</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_expr">expr</code></td>
<td>
<p>either a matrix or dataframe of gene expression upon which
dynamics are to be calculated, or a list of gene sets estimation of gene
expression.  In the case of a matrix or dataframe, its dimension are <code class="reqn">n</code>
x <code class="reqn">p</code>, with the <code class="reqn">p</code> sample in column and the <code class="reqn">n</code> genes in row.
In the case of a list, its length should correspond to the number of gene
sets under scrutiny and each element should be an 3 dimension array of
estimated gene expression, such as for the list returned in the
<code>'Estimations'</code> element of <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>.  See Details.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_subject_id">Subject_ID</code></td>
<td>
<p>a factor of length <code class="reqn">p</code> that is in the same order as the
columns of <code>expr</code> (when it is a dataframe) and that contains the patient
identifier of each sample.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_timepoint">TimePoint</code></td>
<td>
<p>a numeric vector or a factor of length <code class="reqn">p</code> that is in
the same order as <code>Subject_ID</code> and the columns of <code>expr</code> (when it
is a dataframe), and that contains the time points at which gene expression
was measured.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_baseline">baseline</code></td>
<td>
<p>a character string which is the value of <code>TimePoint</code>
used as baseline.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_only.signif">only.signif</code></td>
<td>
<p>logical flag for plotting only the significant gene sets.
If <code>FALSE</code>, all the gene sets from the <b>gmt</b> object contained in
<code>x</code> are plotted.  Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_group.var">group.var</code></td>
<td>
<p>in the case of several treatment groups, this is a factor of
length <code class="reqn">p</code> that is in the same order as <code>Timepoint</code>,
<code>Subject_ID</code>, <code>sample_name</code> and the columns of <code>expr</code>.  It
indicates to which treatment group each sample belongs to.  Default is
<code>NULL</code>, which means that there is only one treatment group.  See
Details.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_group_id_paired">Group_ID_paired</code></td>
<td>
<p>a character vector of length <code class="reqn">p</code> that is in the
same order as <code>Timepoint</code>, <code>Subject_ID</code>, <code>sample_name</code>,
<code>group.var</code> and the columns of <code>expr</code>.  This argument must not be
<code>NULL</code> in the case of a paired analysis, and must be <code>NULL</code>
otherwise.  Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_ref">ref</code></td>
<td>
<p>the group which is used as reference in the case of several
treatment groups.  Default is <code>NULL</code>, which means that reference is the
first group in alphabetical order of the labels of <code>group.var</code>.  See
Details.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_group_of_interest">group_of_interest</code></td>
<td>
<p>the group of interest, for which dynamics are to be
computed in the case of several treatment groups.  Default is <code>NULL</code>,
which means that group of interest is the second group in alphabetical order
of the labels of <code>group.var</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_funcluster">FUNcluster</code></td>
<td>
<p>the clustering function used to agglomerate genes in
trends.  Default is <code>NULL</code>, in which a hierarchical clustering is
performed via the function <code><a href="cluster.html#topic+agnes">agnes</a></code>, using the
metric <code>clustering_metric</code> and the method <code>clustering_method</code>.  See
<code><a href="cluster.html#topic+clusGap">clusGap</a></code></p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_clustering_metric">clustering_metric</code></td>
<td>
<p>character string specifying the metric to be used
for calculating dissimilarities between observations in the hierarchical
clustering when <code>FUNcluster</code> is <code>NULL</code>.  The currently available
options are <code>"euclidean"</code> and <code>"manhattan"</code>.  Default is
<code>"euclidean"</code>.  See <code><a href="cluster.html#topic+agnes">agnes</a></code>.  Also, a <code>"sts"</code> option 
is available in TcGSA.  It implements the 'Short Time Series' distance 
[Moller-Levet et al., Fuzzy Clustering of short time series and unevenly distributed 
sampling points, <em>Advances in Intelligent Data Analysis V</em>:330-340 Springer, 2003]
designed specifically for clustering time series.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_clustering_method">clustering_method</code></td>
<td>
<p>character string defining the agglomerative method
to be used in the hierarchical clustering when <code>FUNcluster</code> is
<code>NULL</code>.  The six methods implemented are <code>"average"</code> ([unweighted
pair-]group average method, UPGMA), <code>"single"</code> (single linkage),
<code>"complete"</code> (complete linkage), <code>"ward"</code> (Ward's method),
<code>"weighted"</code> (weighted average linkage).  Default is <code>"ward"</code>.  See
<code><a href="cluster.html#topic+agnes">agnes</a></code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_b">B</code></td>
<td>
<p>integer specifying the number of Monte Carlo (&quot;bootstrap&quot;) samples
used to compute the gap statistics.  Default is <code>500</code>.  See
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_max_trends">max_trends</code></td>
<td>
<p>integer specifying the maximum number of different clusters
to be tested.  Default is <code>4</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_aggreg.fun">aggreg.fun</code></td>
<td>
<p>a character string such as <code>"mean"</code>, <code>"median"</code>
or the name of any other statistics function defined that returns a single
numeric value.  It specifies the function used to aggregate the observations
before the clustering.  Default is to <code>median</code>.  Default is
<code>"median"</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_na.rm.aggreg">na.rm.aggreg</code></td>
<td>
<p>a logical flag indicating whether <code>NA</code> should be remove to prevent 
propagation through <code>aggreg.fun</code>. Can be useful to set to TRUE with 
unbalanced design as those will generate structural <code>NA</code>s in 
<code>$Estimations</code>. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_methodopticlust">methodOptiClust</code></td>
<td>
<p>character string indicating how the &quot;optimal&quot;&quot; number
of clusters is computed from the gap statistics and their standard
deviations. Possible values are <code>"globalmax"</code>, <code>"firstmax"</code>,
<code>"Tibs2001SEmax"</code>, <code>"firstSEmax"</code> and <code>"globalSEmax"</code>.
Default is <code>"firstSEmax"</code>.  See <code>'method'</code> in
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>, Details and <em>Tibshirani et al.,
2001</em> in References.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_verbose">verbose</code></td>
<td>
<p>logical flag enabling verbose messages to track the computing
status of the function.  Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_clust_trends">clust_trends</code></td>
<td>
<p>object of class <b><a href="#topic+ClusteredTrends">ClusteredTrends</a></b> containing
already computed trends for the plotted gene sets.  Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_n_clusters">N_clusters</code></td>
<td>
<p>an integer that is the number of clusters in which the
dynamics should be regrouped. The cutoff of the clustering tree is
automatically calculated accordingly.  Default is <code>NULL</code>, in which case
the dendrogram is not cut and no clusters are identified.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_myclusters">myclusters</code></td>
<td>
<p>a character vector of colors for predefined clusters of the
represented gene sets, with as many levels as the value of <code>N_clusters</code>.
Default is <code>NULL</code>, in which case the clusters are automatically
identified and colored via the <code><a href="stats.html#topic+cutree">cutree</a></code> function and the
<code>N_clusters</code> argument only.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_label.clusters">label.clusters</code></td>
<td>
<p>if <code>N_clusters</code> is not <code>NULL</code>, a character
vector of length <code>N_clusterss</code>.  Default is <code>NULL</code>, in which case
if <code>N_clusters</code> is not <code>NULL</code>, clusters are simply labeled with
numbers.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_prev_rowcl">prev_rowCL</code></td>
<td>
<p>a <b><a href="stats.html#topic+hclust">hclust</a></b> object, such as the one return by the
present plotting function (see Value) for instance.  If not <code>NULL</code>, no
clustering is calculated by the present plotting function and this tree is
used to represent the gene sets dynamics.  Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_descript">descript</code></td>
<td>
<p>logical flag indicating that the description of the gene sets
should appear after their name on the right side of the plot if <code>TRUE</code>.
Default is <code>TRUE</code>.  See Details.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_plotall">plotAll</code></td>
<td>
<p>logical flag indicating whether a first heatmap with the median
over all the patients should be plotted, or not.  Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_color.vec">color.vec</code></td>
<td>
<p>a character strings vector used to define the color
<a href="grDevices.html#topic+palette">palette</a> used in the plot.  Default is
<code>c("#D73027", "#FC8D59","lightyellow", "#91BFDB", "#4575B4")</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_legend.breaks">legend.breaks</code></td>
<td>
<p>a numeric vector indicating the splitting points for
coloring.  Default is <code>NULL</code>, in which case the break points will be
spaced equally and symmetrically about 0.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_label.column">label.column</code></td>
<td>
<p>a vector of character strings with the labels to be
displayed for the columns (i.e. the time points).  Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_time_unit">time_unit</code></td>
<td>
<p>the time unit to be displayed (such as <code>"Y"</code>,
<code>"M"</code>, <code>"W"</code>, <code>"D"</code>, <code>"H"</code>, etc) next to the values of
<code>TimePoint</code> in the columns labels when <code>label.column</code> is
<code>NULL</code>.  Default is <code>""</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_cex.label.row">cex.label.row</code></td>
<td>
<p>a numerical value giving the amount by which row labels
text should be magnified relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_cex.label.column">cex.label.column</code></td>
<td>
<p>a numerical value giving the amount by which column
labels text should be magnified relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_margins">margins</code></td>
<td>
<p>numeric vector of length 2 containing the margins (see
<code><a href="graphics.html#topic+par">par</a>(mar= *))</code> for column and row names, respectively.  Default
is <code>c(15, 100)</code>.  See Details.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_heatkey.size">heatKey.size</code></td>
<td>
<p>the size of the color key for the heatmap fill.  Default
is <code>1</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_dendrogram.size">dendrogram.size</code></td>
<td>
<p>the horizontal size of the dendrogram.  Default is
<code>1</code></p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_heatmap.height">heatmap.height</code></td>
<td>
<p>the height of the heatmap.  Default is <code>1</code></p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_heatmap.width">heatmap.width</code></td>
<td>
<p>the width of the heatmap.  Default is <code>1</code></p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_cex.clusterkey">cex.clusterKey</code></td>
<td>
<p>a numerical value giving the amount by which the
clusters legend text should be magnified relative to the default <code>1</code>,
when <code>N_clusters</code> is not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_cex.main">cex.main</code></td>
<td>
<p>a numerical value giving the amount by which title text
should be magnified relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_horiz.clusterkey">horiz.clusterKey</code></td>
<td>
<p>a logical flag; if <code>TRUE</code>, set the legend for
clusters horizontally rather than vertically.  Only used if the
<code>N_clusters</code> argument is not <code>NULL</code>.  Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_main">main</code></td>
<td>
<p>a character string for an optional title.  Default is
<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_subtitle">subtitle</code></td>
<td>
<p>a character string for an optional subtitle.  Default is
<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plotPat.TcGSA_+3A_...">...</code></td>
<td>
<p>other parameters to be passed through to plotting functions.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>On the heatmap, each line corresponds to a gene set, and each column to a
time point.
</p>
<p>First a heatmap is computed on all the patients (see <code><a href="#topic+plot.TcGSA">plot.TcGSA</a></code>
and <code><a href="#topic+clustTrend">clustTrend</a></code>) to define the clustering. Then, the clustering
and coloring thus defined on all the patients are consistently used in the
separate heatmaps that are plotted by patient.
</p>
<p>If <code>expr</code> is a matrix or a dataframe, then the &quot;original&quot; data are
plotted.  On the other hand, if <code>expr</code> is a list returned in the
<code>'Estimations'</code> element of <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>, then it is those
&quot;estimations&quot; made by the <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code> function that are plotted.
</p>
<p>If <code>descript</code> is <code>FALSE</code>, the second element of <code>margins</code> can
be reduced (for instance use <code>margins = c(5, 10)</code>), as there is not so
much need for space in order to display only the gene set names, without
their description.
</p>
<p>The median shown in the heatmap uses the respectively standardized (reduced
and centered) expression of the genes over the patients.
</p>


<h3>Value</h3>

<p>An object of class <b><a href="stats.html#topic+hclust">hclust</a></b> which describes the tree
produced by the clustering process.  The object is a list with components:
</p>

<ul>
<li> <p><code>merge</code> an <code class="reqn">n-1</code> by <code class="reqn">2</code> matrix.  Row <code class="reqn">i</code> of
<code>merge</code> describes the merging of clusters at step i of the clustering.
If an element <code class="reqn">j</code> in the row is negative, then observation -<code class="reqn">j</code> was
merged at this stage.  If <code class="reqn">j</code> is positive then the merge was with the
cluster formed at the (earlier) stage <code class="reqn">j</code> of the algorithm.  Thus
negative entries in merge indicate agglomerations of singletons, and positive
entries indicate agglomerations of non-singletons.
</p>
</li>
<li> <p><code>height</code> a set of <code class="reqn">n-1</code> real values (non-decreasing for
ultrametric trees).  The clustering height: that is, the value of the
criterion associated with the Ward clustering method.
</p>
</li>
<li> <p><code>order</code> a vector giving the permutation of the original
observations suitable for plotting, in the sense that a cluster plot using
this ordering and matrix merge will not have crossings of the branches.
</p>
</li>
<li> <p><code>labels</code> the gene sets name.
</p>
</li>
<li> <p><code>call</code> the call which produced the result clustering:
<br /><code>hclust(d = dist(map2heat, method = "euclidean"), method = "ward.D2")</code>
</p>
</li>
<li><p> method &quot;ward.D2&quot;, as it is the clustering method that has been used
for clustering the gene set trends.
</p>
</li>
<li> <p><code>dist.method</code> &quot;euclidean&quot;, as it is the distance that has been used
for clustering the gene set trends.
</p>
</li>
<li> <p><code>legend.breaks</code> a numeric vector giving the splitting points used
for coloring the heatmap.  If <code>plot</code> is <code>FALSE</code>, then it is
<code>NULL</code>.
</p>
</li>
<li> <p><code>myclusters</code> a character vector of colors for clusters of the
represented gene sets, with as many levels as the value of <code>N_clusters</code>.
If no clusters were represented, than this is <code>NULL</code>.
</p>
</li>
<li> <p><code>ddr</code> a <b>dendrogram</b> object with the reordering used for the
heatmap.  See <code>heatmap.2</code> function from package 
<code>gplots</code>.
</p>
</li>
<li> <p><code>clustersExport</code> a data frame with 2 variables containing the two
following variables : </p>
 <ul>
<li> <p><code>GeneSet</code>: the gene sets
clustered.  </p>
</li>
<li> <p><code>Cluster</code>: the cluster they belong to.  </p>
</li></ul>
<p> The data
frame is order by the variable <code>Cluster</code>.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Boris P. Hejblum
</p>


<h3>References</h3>

<p>Hejblum BP, Skinner J, Thiebaut R, (2015) 
Time-Course Gene Set Analysis for Longitudinal Gene Expression Data. 
<em>PLOS Comput. Biol.</em> 11(6):e1004310.
doi: 10.1371/journal.pcbi.1004310
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.TcGSA">plot.TcGSA</a></code>,
<code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>, <code><a href="stats.html#topic+hclust">hclust</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(interactive()){
data(data_simu_TcGSA)

tcgsa_sim_1grp &lt;- TcGSA.LR(expr=expr_1grp, gmt=gmt_sim, design=design, 
                          subject_name="Patient_ID", time_name="TimePoint",
                          time_func="linear", crossedRandom=FALSE)

plotPat.TcGSA(x=tcgsa_sim_1grp, expr=expr_1grp, 
    Subject_ID=design$Patient_ID, TimePoint=design$TimePoint,
    B=100,
    time_unit="H"
    )

plotPat.TcGSA(x=tcgsa_sim_1grp, expr=tcgsa_sim_1grp$Estimations, 
    Subject_ID=design$Patient_ID, TimePoint=design$TimePoint,
    baseline=1, 
    B=100,
    time_unit="H"
    )
}

</code></pre>

<hr>
<h2 id='plotSelect.GS'>Plotting (several) Selected Gene Set(s) in some Subjects</h2><span id='topic+plotSelect.GS'></span>

<h3>Description</h3>

<p>This function can plot different representations of the gene expression in selected
gene sets, among a subset of selected subjects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotSelect.GS(
  expr,
  gmt,
  Subject_ID,
  TimePoint,
  geneset.names.select,
  Subject_ID.select,
  display = "one subject per page",
  baseline = NULL,
  group.var = NULL,
  Group_ID_paired = NULL,
  ref = NULL,
  group_of_interest = NULL,
  FUNcluster = NULL,
  clustering_metric = "euclidian",
  clustering_method = "ward",
  B = 500,
  max_trends = 4,
  aggreg.fun = "median",
  na.rm.aggreg = TRUE,
  trend.fun = "median",
  methodOptiClust = "firstSEmax",
  verbose = TRUE,
  clustering = TRUE,
  time_unit = "",
  title = NULL,
  y.lab = NULL,
  desc = TRUE,
  lab.cex = 1,
  axis.cex = 1,
  main.cex = 1,
  y.lab.angle = 90,
  x.axis.angle = 45,
  y.lim = NULL,
  x.lim = NULL,
  gg.add = list(theme())
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plotSelect.GS_+3A_expr">expr</code></td>
<td>
<p>either a matrix or dataframe of gene expression upon which
dynamics are to be calculated, or a list of gene sets estimation of gene
expression.  In the case of a matrix or dataframe, its dimension are <code class="reqn">n</code>
x <code class="reqn">p</code>, with the <code class="reqn">p</code> sample in column and the <code class="reqn">n</code> genes in row.
In the case of a list, its length should correspond to the number of gene
sets under scrutiny and each element should be an 3 dimension array of
estimated gene expression, such as for the list returned in the
<code>'Estimations'</code> element of <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>.  See Details.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_gmt">gmt</code></td>
<td>
<p>a <b>gmt</b> object containing the gene sets definition.  See
<code><a href="GSA.html#topic+GSA.read.gmt">GSA.read.gmt</a></code> and
definition on <a href="https://software.broadinstitute.org/cancer/software/gsea/wiki/index.php/Data_formats">www.software.broadinstitute.org</a>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_subject_id">Subject_ID</code></td>
<td>
<p>a factor of length <code class="reqn">p</code> that is in the same order as the
columns of <code>expr</code> (when it is a dataframe) and that contains the patient
identifier of each sample.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_timepoint">TimePoint</code></td>
<td>
<p>a numeric vector or a factor of length <code class="reqn">p</code> that is in
the same order as <code>TimePoint</code> and the columns of <code>expr</code> (when it is
a dataframe), and that contains the time points at which gene expression was
measured.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_geneset.names.select">geneset.names.select</code></td>
<td>
<p>a character vector containing the names of the gene sets to
be plotted, that must appear in the <code>"geneset.names"</code> element of
<code>gmt</code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_subject_id.select">Subject_ID.select</code></td>
<td>
<p>a character vector containing the names of the subjects to
be plotted, that must appear in the <code>Subject_ID</code> vector.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_display">display</code></td>
<td>
<p>How to display the resulting graphs.  One of the following : 
<code>"one GS per page"</code>, <code>"one subject per page"</code>, <code>"median over selected patients"</code>.  
Default is <code>"one subject per page"</code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_baseline">baseline</code></td>
<td>
<p>a character string which is the value of <code>TimePoint</code>
that can be used as a baseline.  Default is <code>NULL</code>, in which case no
time point is used as a baseline value for gene expression.  Has to be
<code>NULL</code> when comparing two treatment groups.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_group.var">group.var</code></td>
<td>
<p>in the case of several treatment groups, this is a factor of
length <code class="reqn">p</code> that is in the same order as <code>Timepoint</code>,
<code>Subject_ID</code> and the columns of <code>expr</code>.  It indicates to which
treatment group each sample belongs to.  Default is <code>NULL</code>, which means
that there is only one treatment group.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_group_id_paired">Group_ID_paired</code></td>
<td>
<p>a character vector of length <code class="reqn">p</code> that is in the
same order as <code>Timepoint</code>, <code>Subject_ID</code>, <code>group.var</code> and the
columns of <code>expr</code>.  This argument must not be <code>NULL</code> in the case of
a paired analysis, and must be <code>NULL</code> otherwise.  Default is
<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_ref">ref</code></td>
<td>
<p>the group which is used as reference in the case of several
treatment groups.  Default is <code>NULL</code>, which means that reference is the
first group in alphabetical order of the labels of <code>group.var</code>.  See
Details.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_group_of_interest">group_of_interest</code></td>
<td>
<p>the group of interest, for which dynamics are to be
computed in the case of several treatment groups.  Default is <code>NULL</code>,
which means that group of interest is the second group in alphabetical order
of the labels of <code>group.var</code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_funcluster">FUNcluster</code></td>
<td>
<p>a function which accepts as first argument a matrix
<code>x</code> and as second argument the number of clusters desired <code>k</code>, and
which returns a list with a component named <code>'cluster'</code> which is a
vector of length <code>n = nrow(x)</code> of integers in 1:k, determining the clustering
or grouping of the n observations.  Default is <code>NULL</code>, in which case a
hierarchical clustering is performed via the function
<code><a href="cluster.html#topic+agnes">agnes</a></code>, using the metric <code>clustering_metric</code>
and the method <code>clustering_method</code>.  See <code>'FUNcluster'</code> in
<code><a href="cluster.html#topic+clusGap">clusGap</a></code> and Details.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_clustering_metric">clustering_metric</code></td>
<td>
<p>character string specifying the metric to be used
for calculating dissimilarities between observations in the hierarchical
clustering when <code>FUNcluster</code> is <code>NULL</code>.  The currently available
options are <code>"euclidean"</code> and <code>"manhattan"</code>.  Default is
<code>"euclidean"</code>.  See <code><a href="cluster.html#topic+agnes">agnes</a></code>.  Also, a <code>"sts"</code> option 
is available in TcGSA.  It implements the 'Short Time Series' distance 
[Moller-Levet et al., Fuzzy Clustering of short time series and unevenly distributed 
sampling points, <em>Advances in Intelligent Data Analysis V</em>:330-340 Springer, 2003]
designed specifically for clustering time series.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_clustering_method">clustering_method</code></td>
<td>
<p>character string defining the agglomerative method
to be used in the hierarchical clustering when <code>FUNcluster</code> is
<code>NULL</code>.  The six methods implemented are <code>"average"</code> ([unweighted
pair-]group average method, UPGMA), <code>"single"</code> (single linkage),
<code>"complete"</code> (complete linkage), <code>"ward"</code> (Ward's method),
<code>"weighted"</code> (weighted average linkage).  Default is <code>"ward"</code>.  See
<code><a href="cluster.html#topic+agnes">agnes</a></code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_b">B</code></td>
<td>
<p>integer specifying the number of Monte Carlo (&quot;bootstrap&quot;) samples
used to compute the gap statistics.  Default is <code>500</code>.  See
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_max_trends">max_trends</code></td>
<td>
<p>integer specifying the maximum number of different clusters
to be tested.  Default is <code>4</code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_aggreg.fun">aggreg.fun</code></td>
<td>
<p>a character string such as <code>"mean"</code>, <code>"median"</code>
or the name of any other defined statistics function that returns a single
numeric value.  It specifies the function used to aggregate the observations
before the clustering.  Default is to <code>median</code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_na.rm.aggreg">na.rm.aggreg</code></td>
<td>
<p>a logical flag indicating whether <code>NA</code> should be remove to prevent 
propagation through <code>aggreg.fun</code>. Can be useful to set to TRUE with 
unbalanced design as those will generate structural <code>NA</code>s in 
<code>$Estimations</code>. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_trend.fun">trend.fun</code></td>
<td>
<p>a character string such as <code>"mean"</code>, <code>"median"</code> or
the name of any other function that returns a single numeric value.  It
specifies the function used to calculate the trends of the identified
clustered.  Default is to <code>median</code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_methodopticlust">methodOptiClust</code></td>
<td>
<p>character string indicating how the &quot;optimal&quot; number
of clusters is computed from the gap statistics and their standard
deviations. Possible values are <code>"globalmax"</code>, <code>"firstmax"</code>,
<code>"Tibs2001SEmax"</code>, <code>"firstSEmax"</code> and <code>"globalSEmax"</code>.
Default is <code>"firstSEmax"</code>.  See <code>'method'</code> in
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>, Details and <em>Tibshirani et al.,
2001</em> in References.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_verbose">verbose</code></td>
<td>
<p>logical flag enabling verbose messages to track the computing
status of the function.  Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_clustering">clustering</code></td>
<td>
<p>logical flag.  If <code>FALSE</code>, there is no clustering
representation; if <code>TRUE</code>, the lines are colored according to which
cluster they belong to.  Default is <code>TRUE</code>.  See Details.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_time_unit">time_unit</code></td>
<td>
<p>the time unit to be displayed (such as <code>"Y"</code>,
<code>"M"</code>, <code>"W"</code>, <code>"D"</code>, <code>"H"</code>, etc) next to the values of
<code>TimePoint</code> on the x-axis.  Default is <code>""</code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_title">title</code></td>
<td>
<p>character specifying the title of the plot.  If <code>NULL</code>, a
title is automatically generated, if <code>""</code>, no title appears.  Default is
<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_y.lab">y.lab</code></td>
<td>
<p>character specifying the annotation of the y axis.  If <code>NULL</code>, an
annotation is automatically generated, if <code>""</code>, no annotation appears.  Default is
<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_desc">desc</code></td>
<td>
<p>a logical flag. If <code>TRUE</code>, a line is added to the title of
the plot with the description of the gene set plotted (from the gmt file).
Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_lab.cex">lab.cex</code></td>
<td>
<p>a numerical value giving the amount by which lab labels text
should be magnified relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_axis.cex">axis.cex</code></td>
<td>
<p>a numerical value giving the amount by which axis annotation
text should be magnified relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_main.cex">main.cex</code></td>
<td>
<p>a numerical value giving the amount by which title text
should be magnified relative to the default <code>1</code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_y.lab.angle">y.lab.angle</code></td>
<td>
<p>a numerical value (in [0, 360]) giving the orientation by
which y-label text should be turned (anti-clockwise).  Default is <code>90</code>.
See <code><a href="ggplot2.html#topic+element_text">element_text</a></code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_x.axis.angle">x.axis.angle</code></td>
<td>
<p>a numerical value (in [0, 360]) giving the orientation by
which x-axis annotation text should be turned (anti-clockwise).  Default is
<code>45</code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_y.lim">y.lim</code></td>
<td>
<p>a numeric vector of length 2 giving the range of the y-axis.
See <code><a href="graphics.html#topic+plot.default">plot.default</a></code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_x.lim">x.lim</code></td>
<td>
<p>if numeric, will create a continuous scale, if factor or
character, will create a discrete scale.  Observations not in this range will
be dropped.  See <code><a href="graphics.html#topic+xlim">xlim</a></code>.</p>
</td></tr>
<tr><td><code id="plotSelect.GS_+3A_gg.add">gg.add</code></td>
<td>
<p>A list of instructions to add to the <code>ggplot2</code> instructions.  See <code><a href="ggplot2.html#topic++2B.gg">+.gg</a></code>.
Default is <code>list(theme())</code>, which adds nothing to the plot.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>expr</code> is a matrix or a dataframe, then the &quot;original&quot; data are
plotted.  On the other hand, if <code>expr</code> is a list returned in the
<code>'Estimations'</code> element of <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>, then it is those
&quot;estimations&quot; made by the <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code> function that are plotted.
</p>
<p>If <code>indiv</code> is 'genes', then each line of the plot is the median of a
gene expression over the patients. On the other hand, if <code>indiv</code> is
'patients', then each line of the plot is the median of a patient genes
expression in this gene set.
</p>
<p>This function uses the Gap statistics to determine the optimal number of
clusters in the plotted gene set.  See
<code><a href="cluster.html#topic+clusGap">clusGap</a></code>.
</p>


<h3>Value</h3>

<p>A dataframe the 2 following variables: </p>

<ul>
<li> <p><code>ProbeID</code> which contains the IDs of the probes of the plotted gene set.
</p>
</li>
<li> <p><code>Cluster</code> which to which cluster the probe belongs to.
</p>
</li></ul>
<p> If <code>clustering</code> is <code>FALSE</code>, then <code>Cluster</code> is <code>NA</code> for all the probes.
</p>


<h3>Author(s)</h3>

<p>Boris P. Hejblum
</p>


<h3>References</h3>

<p>Tibshirani, R., Walther, G. and Hastie, T., 2001, Estimating the
number of data clusters via the Gap statistic, <em>Journal of the Royal
Statistical Society, Series B (Statistical Methodology)</em>, <b>63</b>, 2:
411&ndash;423.
</p>


<h3>See Also</h3>

<p><code><a href="ggplot2.html#topic+ggplot">ggplot</a></code>, <code><a href="cluster.html#topic+clusGap">clusGap</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(interactive()){
data(data_simu_TcGSA)
tcgsa_sim_1grp &lt;- TcGSA.LR(expr=expr_1grp, gmt=gmt_sim, design=design, 
                          subject_name="Patient_ID", time_name="TimePoint",
                          time_func="linear", crossedRandom=TRUE)
}

if(interactive()){
plotSelect.GS(expr=expr_1grp, TimePoint=design$TimePoint, 
       Subject_ID=design$Patient_ID, gmt=gmt_sim,
       geneset.names.select=c("Gene set 4", "Gene set 5"),
       Subject_ID.select=c("P1", "P2"),
       display="one GS per page", 
       time_unit="H",
       lab.cex=0.7
)
}

if(interactive()){
plotSelect.GS(expr=tcgsa_sim_1grp$Estimations, TimePoint=design$TimePoint, 
       Subject_ID=design$Patient_ID, gmt=gmt_sim,
       geneset.names.select=c("Gene set 4", "Gene set 5"),
       Subject_ID.select=c("P1", "P2"),
       display="one subject per page", 
       time_unit="H",
       lab.cex=0.7
)
}


if(interactive()){
tcgsa_sim_1grp &lt;- TcGSA.LR(expr=expr_1grp, gmt=gmt_sim, design=design, 
                          subject_name="Patient_ID", time_name="TimePoint",
                          time_func="linear", crossedRandom=FALSE)
                          
plotSelect.GS(expr=tcgsa_sim_1grp$Estimations, TimePoint=design$TimePoint, 
       Subject_ID=design$Patient_ID, gmt=gmt_sim,
       geneset.names.select=c("Gene set 4", "Gene set 5"),
       Subject_ID.select=c("P1", "P2"),
       display="one subject per page", 
       time_unit="H",
       lab.cex=0.7
)
}

</code></pre>

<hr>
<h2 id='pval_simu'>Computing P-values with a Simulated Sample from the Null Distribution</h2><span id='topic+pval_simu'></span>

<h3>Description</h3>

<p>This function computes the p-value of a statistic using a simulated sample
from its theoretical null distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pval_simu(s, theo_dist)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pval_simu_+3A_s">s</code></td>
<td>
<p>the observation whose p-value is computed.  For instance a
Likelihood Ratio.</p>
</td></tr>
<tr><td><code id="pval_simu_+3A_theo_dist">theo_dist</code></td>
<td>
<p>the sample of the distribution under the null hypothesis.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The p-value associated to the observation <code>s</code>.
</p>


<h3>Author(s)</h3>

<p>Boris P. Hejblum
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rchisqmix">rchisqmix</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(interactive()){
theo_dist &lt;- rnorm(n=10000, mean=0, sd=1)
TcGSA:::pval_simu(s=1.96, theo_dist)
1-pnorm(q=1.96, mean = 0, sd = 1, lower.tail = TRUE, log.p = FALSE)
}

</code></pre>

<hr>
<h2 id='rchisqmix'>Chi-Squared Mixtures Distribution</h2><span id='topic+rchisqmix'></span><span id='topic+chisqmix'></span><span id='topic+dchisqmix'></span><span id='topic+qchisqmix'></span><span id='topic+pchisqmix'></span>

<h3>Description</h3>

<p>Density, distribution function, quantile function and random generation
for mixtures of chi-squared distributions that corresponds to the null 
distribution of the Likelihood Ratio between 2 nested mixed models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rchisqmix(n, s, q)

dchisqmix(x, s, q)

qchisqmix(p, s, q)

pchisqmix(quant, s, q, lower.tail = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rchisqmix_+3A_n">n</code></td>
<td>
<p>number of observations.</p>
</td></tr>
<tr><td><code id="rchisqmix_+3A_s">s</code></td>
<td>
<p>number of fixed effects to be tested.</p>
</td></tr>
<tr><td><code id="rchisqmix_+3A_q">q</code></td>
<td>
<p>number of random effects to be tested.</p>
</td></tr>
<tr><td><code id="rchisqmix_+3A_x">x</code>, <code id="rchisqmix_+3A_quant">quant</code></td>
<td>
<p>a quantile.</p>
</td></tr>
<tr><td><code id="rchisqmix_+3A_p">p</code></td>
<td>
<p>a probability.</p>
</td></tr>
<tr><td><code id="rchisqmix_+3A_lower.tail">lower.tail</code></td>
<td>
<p>logical; if <code>TRUE</code> (default), probabilities are <code class="reqn">P[X \le x]</code>; otherwise, <code class="reqn">P[X &gt; x]</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The approximate null distribution of a likelihood ratio for 2 nested mixed
models, where both fixed and random effects are tested simultaneously, is a
very specific mixture of <code class="reqn">\chi^2</code> distributions [<cite>Self &amp; Liang
(1987), Stram &amp; Lee (1994) and Stram &amp; Lee (1995)</cite>].  It depends on both the
number of random effects and the number of fixed effects to be tested
simultaneously: 
</p>
<p style="text-align: center;"><code class="reqn">LRT_{H_0}\sim\sum_{k=q}^{q+r}{{r}\choose{k-q}}2^{-r}\chi^2_{(k)}</code>
</p>



<h3>Value</h3>

<p>A vector of random independent observations of the <code class="reqn">\chi^2</code> mixture
identified by the values of <code>s</code> and <code>q</code>.
</p>


<h3>Author(s)</h3>

<p>Boris P. Hejblum
</p>


<h3>References</h3>

<p>Self, S. G. and Liang, K., 1987, Asymptotic properties of maximum
likelihood estimators and likelihood ratio tests under nonstandard
conditions, <em>Journal of the American Statistical Association</em> 82:
605&ndash;610.
</p>
<p>Stram, D. O. and Lee, J. W., 1994, Variance components testing in the
longitudinal mixed effects model, <em>Biometrics</em> 50: 1171&ndash;1177.
</p>
<p>Stram, D. O. and Lee, J. W., 1995, Corrections to &quot;Variance components
testing in the longitudinal mixed effects model&quot; by Stram, D. O. and Lee, J.
W.; 50: 1171&ndash;1177 (1994), <em>Biometrics</em> 51: 1196.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pval_simu">pval_simu</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(graphics)
library(stats)

sample_mixt &lt;- rchisqmix(n=1000, s=3, q=3)
plot(density(sample_mixt))


</code></pre>

<hr>
<h2 id='signifLRT.TcGSA'>Identifying the Significant Gene Sets</h2><span id='topic+signifLRT.TcGSA'></span>

<h3>Description</h3>

<p>A function that identifies the significant gene sets in an object of class
'<code>TcGSA</code>'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>signifLRT.TcGSA(
  tcgsa,
  threshold = 0.05,
  myproc = "BY",
  nbsimu_pval = 1e+06,
  write = F,
  txtfilename = NULL,
  directory = NULL,
  exact = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="signifLRT.TcGSA_+3A_tcgsa">tcgsa</code></td>
<td>
<p>a <code>tcgsa</code> object.</p>
</td></tr>
<tr><td><code id="signifLRT.TcGSA_+3A_threshold">threshold</code></td>
<td>
<p>the threshold at which the FDR or the FWER should be
controlled.</p>
</td></tr>
<tr><td><code id="signifLRT.TcGSA_+3A_myproc">myproc</code></td>
<td>
<p>a vector of character strings containing the names of the
multiple testing procedures for which adjusted p-values are to be computed.
This vector should include any of the following: &quot;<code>Bonferroni</code>&quot;,
&quot;<code>Holm</code>&quot;, &quot;<code>Hochberg</code>&quot;, &quot;<code>SidakSS</code>&quot;, &quot;<code>SidakSD</code>&quot;,
&quot;<code>BH</code>&quot;, &quot;<code>BY</code>&quot;, &quot;<code>ABH</code>&quot;, &quot;<code>TSBH</code>&quot; or &quot;<code>none</code>&quot;.  
&quot;<code>none</code>&quot; indicates no adjustment for multiple testing. See
<code><a href="multtest.html#topic+mt.rawp2adjp">mt.rawp2adjp</a></code> for details.  Default is
&quot;<code>BY</code>&quot;, the Benjamini &amp; Yekutieli (2001) step-up FDR-controlling
procedure (general dependency structures).  In order to control the FWER(in
case of an analysis that is more a hypothesis confirmation than an
exploration of the expression data), we recommend to use &quot;<code>Holm</code>&quot;, the
Holm (1979) step-down adjusted p-values for strong control of the FWER.</p>
</td></tr>
<tr><td><code id="signifLRT.TcGSA_+3A_nbsimu_pval">nbsimu_pval</code></td>
<td>
<p>the number of observations under the null distribution to
be generated in order to compute the p-values.  Default is <code>1e+06</code>.</p>
</td></tr>
<tr><td><code id="signifLRT.TcGSA_+3A_write">write</code></td>
<td>
<p>logical flag enabling the export of the results as a table in a
.txt file.  Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="signifLRT.TcGSA_+3A_txtfilename">txtfilename</code></td>
<td>
<p>a character string with the name of the .txt file in which
the results table is to be written, if <code>write</code> is <code>TRUE</code>. Default
is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="signifLRT.TcGSA_+3A_directory">directory</code></td>
<td>
<p>if <code>write</code> is <code>TRUE</code>, a character string with the
directory of the .txt file in which the results table is to be written, if
<code>write</code> is <code>TRUE</code>. Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="signifLRT.TcGSA_+3A_exact">exact</code></td>
<td>
<p>logical flag indicating whether the raw p-values should be computed from the 
exact asymptotic mixture of chi-square, or simulated (longer and not better).
Default is <code>TRUE</code> and should be preferred.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>signifLRT.TcGSA</code> returns a list. 
</p>
<p>The first element <code>mixedLRTadjRes</code> is data frame with <code class="reqn">p</code> rows (one
row for each significant gene set) and the 3 following variables:
</p>

<ul>
<li> <p><code>GeneSet</code> the significant gene set name from the gmt object.
</p>
</li>
<li> <p><code>AdjPval</code> the adjusted p-value corresponding to the significant gene
set.
</p>
</li>
<li> <p><code>desc</code> the significant gene set description from the gmt object.
</p>
</li></ul>

<p>The second element <code>multCorProc</code> passes along the multiple testing 
procedure used (from the argument <code>myproc</code>).
</p>
<p>The third element <code>threshold</code> passes along the significance threshold
used (from the argument <code>threshold</code>).
</p>


<h3>Author(s)</h3>

<p>Boris P. Hejblum
</p>


<h3>References</h3>

<p>Hejblum BP, Skinner J, Thiebaut R, (2015) 
Time-Course Gene Set Analysis for Longitudinal Gene Expression Data. 
<em>PLOS Comput. Biol.</em> 11(6):e1004310.
doi: 10.1371/journal.pcbi.1004310
</p>


<h3>See Also</h3>

<p><code><a href="#topic+multtest.TcGSA">multtest.TcGSA</a></code>, <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(interactive()){
data(data_simu_TcGSA)

tcgsa_sim_1grp &lt;- TcGSA.LR(expr=expr_1grp, gmt=gmt_sim, design=design, 
                          subject_name="Patient_ID", time_name="TimePoint",
                          time_func="linear", crossedRandom=FALSE)
                          
sgnifs &lt;- signifLRT.TcGSA(tcgsa_sim_1grp, threshold = 0.05, myproc = "BY",
                         nbsimu_pval = 1000, write=FALSE)
sgnifs
}

</code></pre>

<hr>
<h2 id='summary.TcGSA'>Summarizing TcGSA</h2><span id='topic+summary.TcGSA'></span><span id='topic+print.summary.TcGSA'></span>

<h3>Description</h3>

<p><code>summary</code> method for class '<code>TcGSA</code>'
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'TcGSA'
summary(object, ...)

## S3 method for class 'summary.TcGSA'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.TcGSA_+3A_object">object</code></td>
<td>
<p>an object of class '<code>TcGSA</code>'.</p>
</td></tr>
<tr><td><code id="summary.TcGSA_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="summary.TcGSA_+3A_x">x</code></td>
<td>
<p>an object of class '<code>summary.TcGSA</code>'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The function summary.TcGSA returns a list with the following
components (list elements):</p>

<ul>
<li> <p><code>time_func</code> the chosen form for the time trend.
</p>
</li>
<li> <p><code>separateSubjects</code> a logical flag indicating whether gene sets
tested for discriminating among patients, or for time trends over time.
</p>
</li>
<li> <p><code>ntg</code> the number of treatment groups.
</p>
</li>
<li> <p><code>ngs</code> the number of tested gene sets.
</p>
</li>
<li> <p><code>nsignif</code> the number of significant gene sets at a 5% FDR (using
the default Benjamini &amp; Yekutieli step-up procedure).
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Boris P. Hejblum
</p>


<h3>See Also</h3>

<p><code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(interactive()){
data(data_simu_TcGSA)

tcgsa_sim_1grp &lt;- TcGSA.LR(expr=expr_1grp, gmt=gmt_sim, design=design, 
                          subject_name="Patient_ID", time_name="TimePoint",
                          time_func="linear", crossedRandom=FALSE)
summary(tcgsa_sim_1grp)

tcgsa_sim_2grp &lt;- TcGSA.LR(expr=expr_2grp, gmt=gmt_sim, design=design, 
                          subject_name="Patient_ID", time_name="TimePoint",
                          time_func="linear", crossedRandom=FALSE, 
                          group_name="group.var")
summary(tcgsa_sim_2grp)
}

</code></pre>

<hr>
<h2 id='TcGSA-internal'>Internal TcGSA Functions</h2><span id='topic+TcGSA-internal'></span><span id='topic+MYheatmap.2'></span><span id='topic+TcGSA.formula'></span><span id='topic+TcGSA.dataLME'></span><span id='topic+STSdist'></span>

<h3>Description</h3>

<p>Internal TcGSA functions
</p>


<h3>Details</h3>

<p>These are not to be called by the user.
</p>
<p><code>MYheatmap.2</code> was adapted from the function <code>heatmap.2</code> 
included in the package <code>gplots</code>, authored by: 
Andy Liaw, original; 
R. Gentleman, M. Maechler, W. Huber, G. Warnes, revisions;
under the GPL-2 license.
</p>

<hr>
<h2 id='TcGSA.LR'>Computing the Likelihood Ratios for the Gene Sets under Scrutiny</h2><span id='topic+TcGSA.LR'></span><span id='topic+print.TcGSA.LR'></span><span id='topic+print.TcGSA'></span>

<h3>Description</h3>

<p>This function computes the Likelihood Ratios for the gene sets under
scrutiny, as well as estimations of genes dynamics inside those gene sets
through mixed models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TcGSA.LR(
  expr,
  gmt,
  design,
  subject_name = "Patient_ID",
  time_name = "TimePoint",
  crossedRandom = FALSE,
  covariates_fixed = "",
  time_covariates = "",
  time_func = "linear",
  group_name = "",
  separateSubjects = FALSE,
  minGSsize = 10,
  maxGSsize = 500
)

## S3 method for class 'TcGSA'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="TcGSA.LR_+3A_expr">expr</code></td>
<td>
<p>a matrix or dataframe of gene expression.  Its dimension are
<code class="reqn">n</code>x<code class="reqn">p</code>, with the <code class="reqn">p</code> samples in column and the <code class="reqn">n</code> genes in
row.</p>
</td></tr>
<tr><td><code id="TcGSA.LR_+3A_gmt">gmt</code></td>
<td>
<p>a <b>gmt</b> object containing the gene sets definition.  See
<code><a href="GSA.html#topic+GSA.read.gmt">GSA.read.gmt</a></code> and definition on 
<a href="https://software.broadinstitute.org/cancer/software/gsea/wiki/index.php/Data_formats">www.software.broadinstitute.org</a>.</p>
</td></tr>
<tr><td><code id="TcGSA.LR_+3A_design">design</code></td>
<td>
<p>a matrix or dataframe containing the experimental variables that used in the model,
namely <code>subject_name</code>, <code>time_name</code>, and <code>covariates_fixed</code> 
and <code>time_covariates</code> if applicable.  Its dimension are <code class="reqn">p</code>x<code class="reqn">m</code> 
and its row are is in the same order as the columns of <code>expr</code>.</p>
</td></tr>
<tr><td><code id="TcGSA.LR_+3A_subject_name">subject_name</code></td>
<td>
<p>the name of the factor variable from <code>design</code> that contains the information on 
the repetition units used in the mixed model, such as the patient identifiers for instance.  
Default is <code>'Patient_ID'</code>.  See Details.</p>
</td></tr>
<tr><td><code id="TcGSA.LR_+3A_time_name">time_name</code></td>
<td>
<p>the name of a numeric variable from <code>design</code> that contains 
the information on the time replicates (the time points at which gene 
expression was measured).  Default is <code>'TimePoint'</code>.  See Details.</p>
</td></tr>
<tr><td><code id="TcGSA.LR_+3A_crossedrandom">crossedRandom</code></td>
<td>
<p>logical flag indicating whether the random effects of the subjects and of the time points
should be modeled as one crossed random effect or as two separated random effects.  
Default is <code>FALSE</code>. See details.</p>
</td></tr>
<tr><td><code id="TcGSA.LR_+3A_covariates_fixed">covariates_fixed</code></td>
<td>
<p>a character vector with the names of numeric or factor variables from the <code>design</code> 
matrix that should appear as fixed effects in the model.  See details.
Default is <code>""</code>, which corresponds to no covariates in the model.</p>
</td></tr>
<tr><td><code id="TcGSA.LR_+3A_time_covariates">time_covariates</code></td>
<td>
<p>a character vector with the names of numeric or factor variables from the <code>design</code> 
matrix that should appear as fixed effects interaction with the <code>time_name</code> 
variable in the model.  See details.  Default is <code>""</code>, which corresponds 
to no covariates in the model.</p>
</td></tr>
<tr><td><code id="TcGSA.LR_+3A_time_func">time_func</code></td>
<td>
<p>the form of the time trend. Can be either one of <code>"linear"</code>,
<code>"cubic"</code>, <code>"splines"</code> or specified by the user, or the column name of 
a factor variable from <code>design</code>. If specified by the user, 
it must be as an expression using only names of variables from the <code>design</code> matrix 
with only the three following operators: <code>+</code>, <code>*</code>, <code>/</code> . 
The <code>"splines"</code> form corresponds to the natural cubic B-splines 
(see also <code><a href="splines.html#topic+ns">ns</a></code>).  If there are only a few timepoints, 
a <code>"linear"</code> form should be sufficient. Otherwise, the <code>"cubic"</code> form is 
more parsimonious than the <code>"splines"</code> form, and should be sufficiently flexible.
If the column name of a factor variable from <code>design</code> is supplied, 
then time is considered as discrete in the analysis.
If the user specify a formula using column names from design, both factor and numeric
variables can be used.</p>
</td></tr>
<tr><td><code id="TcGSA.LR_+3A_group_name">group_name</code></td>
<td>
<p>in the case of several treatment groups, the name of a factor variable 
from the <code>design</code> matrix.  It indicates to which treatment group each sample
belongs to.  Default is <code>""</code>, which means that there is only one 
treatment group.  See Details.</p>
</td></tr>
<tr><td><code id="TcGSA.LR_+3A_separatesubjects">separateSubjects</code></td>
<td>
<p>logical flag indicating that the analysis identifies
gene sets that discriminates patients rather than gene sets than have a
significant trend over time.  Default is <code>FALSE</code>.  See Details.</p>
</td></tr>
<tr><td><code id="TcGSA.LR_+3A_mingssize">minGSsize</code></td>
<td>
<p>the minimum number of genes in a gene set.  If there are
less genes than this number in one of the gene sets under scrutiny, the
Likelihood Ratio of this gene set is not computed (the mixed model are not
fitted). Default is <code>10</code> genes as the minimum.</p>
</td></tr>
<tr><td><code id="TcGSA.LR_+3A_maxgssize">maxGSsize</code></td>
<td>
<p>the maximum number of genes in a gene set.  If there are
more genes than this number in one of the gene sets under scrutiny, the
Likelihood Ratio of this gene set is not computed (the mixed model are not
fitted).  This is to avoid very long computation times.  Default is
<code>500</code> genes as the maximum.</p>
</td></tr>
<tr><td><code id="TcGSA.LR_+3A_x">x</code></td>
<td>
<p>an object of class '<code>TcGSA</code>'.</p>
</td></tr>
<tr><td><code id="TcGSA.LR_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This Time-course Gene Set Analysis aims at identifying gene sets that are not
stable over time, either homogeneously or heterogeneously (see <em>Hejblum
et al, 2012</em>)in terms of their probes.  And when the argument
<code>separateSubjects</code> is <code>TRUE</code>, instead of identifying gene sets that
have a significant trend over time, <em>TcGSA</em> identifies gene sets that
have significantly different trends over time depending on <code>Subjects</code>.
</p>


<h3>Value</h3>

<p><code>TcGSA.LR</code> returns a <code>tcgsa</code> object, which is a list with
the 5 following elements:
</p>

<ul>
<li><p> fit a data frame that contains the 3 following variables:
</p>
 
<ul>
<li> <p><code>LR</code>: the likelihood ratio between the model under the
null hypothesis and the model under the alternative hypothesis.  
</p>
</li>
<li>
<p><code>CVG_H0</code>: convergence status of the model under the null hypothesis.
</p>
</li>
<li> <p><code>CVG_H1</code>: convergence status of the model under the alternative
hypothesis.
</p>
</li></ul>

</li>
<li> <p><code>time_func</code>: a character string passing along the value of the
<code>time_func</code> argument used in the call.
</p>
</li>
<li> <p><code>GeneSets_gmt</code>: a <code>gmt</code> object passing along the value of the
<code>gmt</code> argument used in the call.
</p>
</li>
<li> <p><code>group.var</code>: a factor passing along the <code>group_name</code> variable
from the <code>design</code> matrix.
</p>
</li>
<li> <p><code>separateSubjects</code>: a logical flag passing along the value of the
<code>separateSubjects</code> argument used in the call.
</p>
</li>
<li> <p><code>Estimations</code>: a list of 3 dimensions arrays.  Each element of the
list (i.e. each array) corresponds to the estimations of gene expression
dynamics for each of the gene sets under scrutiny (obtained from mixed
models).  The first dimension of those arrays is the genes included in the
concerned gene set, the second dimension is the <code>Patient_ID</code>, and the
third dimension is the <code>TimePoint</code>.  The values inside those arrays are
estimated gene expressions.
</p>
</li>
<li> <p><code>time_DF</code>: the degree of freedom of the natural splines functions
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Boris P. Hejblum
</p>


<h3>References</h3>

<p>Hejblum BP, Skinner J, Thiebaut R, (2015) 
Time-Course Gene Set Analysis for Longitudinal Gene Expression Data. 
<em>PLOS Comput. Biol.</em> 11(6):e1004310.
doi: 10.1371/journal.pcbi.1004310
</p>


<h3>See Also</h3>

<p><code><a href="#topic+summary.TcGSA">summary.TcGSA</a></code>, <code><a href="#topic+plot.TcGSA">plot.TcGSA</a></code>, 
and <code><a href="#topic+TcGSA.LR.parallel">TcGSA.LR.parallel</a></code> for an implementation using 
parallel computing
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(interactive()){
data(data_simu_TcGSA)

tcgsa_sim_1grp &lt;- TcGSA.LR(expr=expr_1grp, gmt=gmt_sim, design=design, 
                          subject_name="Patient_ID", time_name="TimePoint",
                          time_func="linear", crossedRandom=FALSE)
tcgsa_sim_1grp
summary(tcgsa_sim_1grp)

plot(x=tcgsa_sim_1grp, expr=expr_1grp, 
    Subject_ID=design$Patient_ID, TimePoint=design$TimePoint,
    baseline=1, 
    B=100,
    time_unit="H"
    )
       
tcgsa_sim_2grp &lt;- TcGSA.LR(expr=expr_2grp, gmt=gmt_sim, design=design,
                          subject_name="Patient_ID", time_name="TimePoint",
                          time_func="linear", crossedRandom=FALSE, 
                          group_name="group.var")
tcgsa_sim_2grp

}
</code></pre>

<hr>
<h2 id='TcGSA.LR.parallel'>Parallel computing the Likelihood Ratios for the Gene Sets under Scrutiny</h2><span id='topic+TcGSA.LR.parallel'></span>

<h3>Description</h3>

<p>A parallel version of the function <code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code> to be used on a
cluster of computing processors.  This function computes the Likelihood
Ratios for the gene sets under scrutiny, as well as estimations of genes
dynamics inside those gene sets through mixed models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TcGSA.LR.parallel(
  Ncpus,
  type_connec,
  expr,
  gmt,
  design,
  subject_name = "Patient_ID",
  time_name = "TimePoint",
  crossedRandom = FALSE,
  covariates_fixed = "",
  time_covariates = "",
  time_func = "linear",
  group_name = "",
  separateSubjects = FALSE,
  minGSsize = 10,
  maxGSsize = 500,
  monitorfile = ""
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="TcGSA.LR.parallel_+3A_ncpus">Ncpus</code></td>
<td>
<p>The number of processors available.</p>
</td></tr>
<tr><td><code id="TcGSA.LR.parallel_+3A_type_connec">type_connec</code></td>
<td>
<p>The type of connection between the processors. Supported
cluster types are <code>"SOCK"</code>, <code>"PVM"</code>, <code>"MPI"</code>, and
<code>"NWS"</code>. See also <code><a href="parallel.html#topic+makeCluster">makeCluster</a></code>.</p>
</td></tr>
<tr><td><code id="TcGSA.LR.parallel_+3A_expr">expr</code></td>
<td>
<p>a matrix or dataframe of gene expression.  Its dimension are
<code class="reqn">n</code>x<code class="reqn">p</code>, with the <code class="reqn">p</code> samples in column and the <code class="reqn">n</code> genes in
row.</p>
</td></tr>
<tr><td><code id="TcGSA.LR.parallel_+3A_gmt">gmt</code></td>
<td>
<p>a <b>gmt</b> object containing the gene sets definition.  See
<code><a href="GSA.html#topic+GSA.read.gmt">GSA.read.gmt</a></code> and definition on 
<a href="https://software.broadinstitute.org/cancer/software/gsea/wiki/index.php/Data_formats">www.software.broadinstitute.org</a>.</p>
</td></tr>
<tr><td><code id="TcGSA.LR.parallel_+3A_design">design</code></td>
<td>
<p>a matrix or dataframe containing the experimental variables that used in the model,
namely <code>subject_name</code>, <code>time_name</code>, and <code>covariates_fixed</code> 
and <code>time_covariates</code> if applicable.  Its dimension are <code class="reqn">p</code>x<code class="reqn">m</code> 
and its row are is in the same order as the columns of <code>expr</code>.</p>
</td></tr>
<tr><td><code id="TcGSA.LR.parallel_+3A_subject_name">subject_name</code></td>
<td>
<p>the name of the factor variable from <code>design</code> that contains the information on 
the repetition units used in the mixed model, such as the patient identifiers for instance.  
Default is <code>'Patient_ID'</code>.  See Details.</p>
</td></tr>
<tr><td><code id="TcGSA.LR.parallel_+3A_time_name">time_name</code></td>
<td>
<p>the name of the numeric or factor variable from <code>design</code> contains 
the information on the time replicates (the time points at which gene 
expression was measured).  Default is <code>'TimePoint'</code>.  See Details.</p>
</td></tr>
<tr><td><code id="TcGSA.LR.parallel_+3A_crossedrandom">crossedRandom</code></td>
<td>
<p>logical flag indicating whether the random effects of the subjects and of the time points
should be modeled as one crossed random effect or as two separated random effects.  
Default is <code>FALSE</code>. See details.</p>
</td></tr>
<tr><td><code id="TcGSA.LR.parallel_+3A_covariates_fixed">covariates_fixed</code></td>
<td>
<p>a character vector with the names of numeric or factor variables from the <code>design</code> 
matrix that should appear as fixed effects in the model.  See details.
Default is <code>""</code>, which corresponds to no covariates in the model.</p>
</td></tr>
<tr><td><code id="TcGSA.LR.parallel_+3A_time_covariates">time_covariates</code></td>
<td>
<p>the name of a numeric variable from <code>design</code> that contains 
the information on the time replicates (the time points at which gene 
expression was measured).  Default is <code>'TimePoint'</code>.  See Details.</p>
</td></tr>
<tr><td><code id="TcGSA.LR.parallel_+3A_time_func">time_func</code></td>
<td>
<p>the form of the time trend. Can be either one of <code>"linear"</code>,
<code>"cubic"</code>, <code>"splines"</code> or specified by the user, or the column name of 
a factor variable from <code>design</code>. If specified by the user, 
it must be as an expression using only names of variables from the <code>design</code> matrix 
with only the three following operators: <code>+</code>, <code>*</code>, <code>/</code> . 
The <code>"splines"</code> form corresponds to the natural cubic B-splines 
(see also <code><a href="splines.html#topic+ns">ns</a></code>).  If there are only a few timepoints, 
a <code>"linear"</code> form should be sufficient. Otherwise, the <code>"cubic"</code> form is 
more parsimonious than the <code>"splines"</code> form, and should be sufficiently flexible.
If the column name of a factor variable from <code>design</code> is supplied, 
then time is considered as discrete in the analysis.
If the user specify a formula using column names from design, both factor and numeric
variables can be used.</p>
</td></tr>
<tr><td><code id="TcGSA.LR.parallel_+3A_group_name">group_name</code></td>
<td>
<p>in the case of several treatment groups, the name of a factor variable 
from the <code>design</code> matrix.  It indicates to which treatment group each sample
belongs to.  Default is <code>""</code>, which means that there is only one 
treatment group.  See Details.</p>
</td></tr>
<tr><td><code id="TcGSA.LR.parallel_+3A_separatesubjects">separateSubjects</code></td>
<td>
<p>logical flag indicating that the analysis identifies
gene sets that discriminates patients rather than gene sets than have a
significant trend over time.  Default is <code>FALSE</code>.  See Details.</p>
</td></tr>
<tr><td><code id="TcGSA.LR.parallel_+3A_mingssize">minGSsize</code></td>
<td>
<p>the minimum number of genes in a gene set.  If there are
less genes than this number in one of the gene sets under scrutiny, the
Likelihood Ratio of this gene set is not computed (the mixed model are not
fitted). Default is <code>10</code> genes as the minimum.</p>
</td></tr>
<tr><td><code id="TcGSA.LR.parallel_+3A_maxgssize">maxGSsize</code></td>
<td>
<p>the maximum number of genes in a gene set.  If there are
more genes than this number in one of the gene sets under scrutiny, the
Likelihood Ratio of this gene set is not computed (the mixed model are not
fitted).  This is to avoid very long computation times.  Default is
<code>500</code> genes as the maximum.</p>
</td></tr>
<tr><td><code id="TcGSA.LR.parallel_+3A_monitorfile">monitorfile</code></td>
<td>
<p>a writable <a href="base.html#topic+connections">connections</a> or a character string naming a file to write into, 
to monitor the progress of the analysis.  
Default is <code>""</code> which is no monitoring.  See Details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This Time-course Gene Set Analysis aims at identifying gene sets that are not
stable over time, either homogeneously or heterogeneously (see <em>Hejblum
et al, 2012</em>) in terms of their probes.  And when the argument
<code>separatePatients</code> is <code>TRUE</code>, instead of identifying gene sets that
have a significant trend over time (possibly with probes heterogeneity of
this trend), <em>TcGSA</em> identifies gene sets that have significantly
different trends over time depending on the patient.
</p>
<p>If the <code>monitorfile</code> argument is a character string naming a file to
write into, in the case of a new file that does not exist yet, such a new
file will be created. A line is written each time one of the gene sets under
scrutiny has been analyzed (i.e. the two mixed models have been fitted, see
<code><a href="#topic+TcGSA.LR">TcGSA.LR</a></code>) by one of the parallelized processors.
</p>


<h3>Value</h3>

<p><code>TcGSA.LR</code> returns a <code>tcgsa</code> object, which is a list with
the 5 following elements:
</p>

<ul>
<li><p> fit a data frame that contains the 3 following variables:
</p>
 
<ul>
<li> <p><code>LR</code>: the likelihood ratio between the model under the
null hypothesis and the model under the alternative hypothesis.  
</p>
</li>
<li>
<p><code>CVG_H0</code>: convergence status of the model under the null hypothesis.
</p>
</li>
<li> <p><code>CVG_H1</code>: convergence status of the model under the alternative
hypothesis.
</p>
</li></ul>

</li>
<li> <p><code>time_func</code>: a character string passing along the value of the
<code>time_func</code> argument used in the call.
</p>
</li>
<li> <p><code>GeneSets_gmt</code>: a <code>gmt</code> object passing along the value of the
<code>gmt</code> argument used in the call.
</p>
</li>
<li> <p><code>group.var</code>: a factor passing along the <code>group_name</code> variable
from the <code>design</code> matrix.
</p>
</li>
<li> <p><code>separateSubjects</code>: a logical flag passing along the value of the
<code>separateSubjects</code> argument used in the call.
</p>
</li>
<li> <p><code>Estimations</code>: a list of 3 dimensions arrays.  Each element of the
list (i.e. each array) corresponds to the estimations of gene expression
dynamics for each of the gene sets under scrutiny (obtained from mixed
models).  The first dimension of those arrays is the genes included in the
concerned gene set, the second dimension is the <code>Patient_ID</code>, and the
third dimension is the <code>TimePoint</code>.  The values inside those arrays are
estimated gene expressions.
</p>
</li>
<li> <p><code>time_DF</code>: the degree of freedom of the natural splines functions
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Boris P. Hejblum
</p>


<h3>References</h3>

<p>Hejblum BP, Skinner J, Thiebaut R, (2015) 
Time-Course Gene Set Analysis for Longitudinal Gene Expression Data. 
<em>PLOS Comput. Biol.</em> 11(6):e1004310.
doi: 10.1371/journal.pcbi.1004310
</p>


<h3>See Also</h3>

<p><code><a href="#topic+summary.TcGSA">summary.TcGSA</a></code>, <code><a href="#topic+plot.TcGSA">plot.TcGSA</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>               
if(interactive()){
data(data_simu_TcGSA)

tcgsa_sim_1grp &lt;- TcGSA.LR(expr=expr_1grp, gmt=gmt_sim, design=design, 
                          subject_name="Patient_ID", time_name="TimePoint",
                          time_func="linear", crossedRandom=FALSE)
          
library(doParallel)
tcgsa_sim_1grp_par &lt;- TcGSA.LR.parallel(Ncpus = 2, type_connec = 'SOCK',
                            expr=expr_1grp, gmt=gmt_sim, design=design, 
                            subject_name="Patient_ID", time_name="TimePoint",
                            time_func="linear", crossedRandom=FALSE, 
                            separateSubjects=TRUE)

summary(tcgsa_sim_1grp)
summary(tcgsa_sim_1grp_par)
}     


</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
