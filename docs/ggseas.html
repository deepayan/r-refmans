<!DOCTYPE html><html><head><title>Help for package ggseas</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ggseas}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ggsdc'><p>Visualise seasonal decomposition</p></a></li>
<li><a href='#ggseas-package'><p>Seasonal decomposition on the fly</p></a></li>
<li><a href='#ldeaths_df'><p>Monthly Deaths from Lung Diseases in the UK</p></a></li>
<li><a href='#nzbop'><p>New Zealand Balance of Payments major components 1971Q2 to 2015Q2</p></a></li>
<li><a href='#stat_decomp'><p>Classical seasonal adjustment Stat</p></a></li>
<li><a href='#stat_index'><p>Index Stat</p></a></li>
<li><a href='#stat_rollapplyr'><p>Rolling summary Stat</p></a></li>
<li><a href='#stat_seas'><p>X13 seasonal adjustment Stat</p></a></li>
<li><a href='#stat_stl'><p>LOESS seasonal adjustment Stat</p></a></li>
<li><a href='#tsdf'><p>Time series to data frame</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>'stats' for Seasonal Adjustment on the Fly with 'ggplot2'</td>
</tr>
<tr>
<td>Version:</td>
<td>0.5.4</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Peter Ellis &lt;peter.ellis2013nz@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides 'ggplot2' 'stats' that estimate seasonally adjusted series 
    and rolling summaries such as rolling average on the fly for time series.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1.2), ggplot2 (&ge; 2.0.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>seasonal, rlang, stats, zoo</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.0.1</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ellisp/ggseas/issues">https://github.com/ellisp/ggseas/issues</a></td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, knitr, rmarkdown</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2018-06-11 20:04:30 UTC; Peter</td>
</tr>
<tr>
<td>Author:</td>
<td>Peter Ellis [aut, cre],
  Christophe Sax [ctb]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2018-06-12 13:33:33 UTC</td>
</tr>
</table>
<hr>
<h2 id='ggsdc'>Visualise seasonal decomposition</h2><span id='topic+ggsdc'></span>

<h3>Description</h3>

<p>Creates a four-facet plot of seasonal decomposition showing observed, trend, seasonal and random components
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ggsdc(data, mapping, frequency = NULL, method = c("stl", "decompose",
  "seas"), start = NULL, s.window, type = c("additive", "multiplicative"),
  index.ref = NULL, index.basis = 100, facet.titles = c("observed",
  "trend", "seasonal", "irregular"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ggsdc_+3A_data">data</code></td>
<td>
<p>dataset to use for plot.</p>
</td></tr>
<tr><td><code id="ggsdc_+3A_mapping">mapping</code></td>
<td>
<p>List of aesthetic mappings.  Must include x and y, and optionally
can include colour/color</p>
</td></tr>
<tr><td><code id="ggsdc_+3A_frequency">frequency</code></td>
<td>
<p>frequency of the period of the time series eg 12 = monthly</p>
</td></tr>
<tr><td><code id="ggsdc_+3A_method">method</code></td>
<td>
<p>function to use for performing the seasonal decomposition. stl
and decompose are functions in the <code>stats</code> package; <code>seas</code> is access
to the <code>seats</code> program from X-13-SEATS-ARIMA via the <code>seasonal</code> package</p>
</td></tr>
<tr><td><code id="ggsdc_+3A_start">start</code></td>
<td>
<p>starting time for the data; only needed if <code>method = 'seas'</code>.</p>
</td></tr>
<tr><td><code id="ggsdc_+3A_s.window">s.window</code></td>
<td>
<p>parameter to pass to <code>stl()</code></p>
</td></tr>
<tr><td><code id="ggsdc_+3A_type">type</code></td>
<td>
<p>parameter to pass to <code>decompose()</code></p>
</td></tr>
<tr><td><code id="ggsdc_+3A_index.ref">index.ref</code></td>
<td>
<p>if not NULL, a vector of integers indicating which elements of
the beginning of each series to use as a reference point for converting to an index.  
If NULL, no conversion takes place and the data are presented on the original scale.</p>
</td></tr>
<tr><td><code id="ggsdc_+3A_index.basis">index.basis</code></td>
<td>
<p>if index.ref is not NULL, the basis point for converting
to an index, most commonly 100 or 1000.  See examples.</p>
</td></tr>
<tr><td><code id="ggsdc_+3A_facet.titles">facet.titles</code></td>
<td>
<p>a vector in the order of <code>observed</code>, <code>trend</code>, <code>seasonal</code> and <code>irregular</code> 
for the titles of the four facets of the decomposition.  Make sure you get the order right...</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function takes a data frame and performs seasonal decomposition
on the variable mapped to the y aesthetic, grouped by the variable (if any)
mapped to the colour or color aesthetic.  This allows the user to perform
the equivalent of plot(stats::decompose(x)) but in the ggplot2 environment for themes,
polishing etc; and to overlay decompositions on the same graphic; and with the 
X13-SEATS-ARIMA seasonal decomposition (so far only with default settings).
</p>
<p>The &quot;seasonal&quot; component can be either multiplicative (in which case it will
in a small range of values around one) or additive (in which case it will be
on the scale of the original data), depending on the settings.
</p>


<h3>Value</h3>

<p>an object of class ggplot with four facets
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+decompose">decompose</a></code>, <code><a href="stats.html#topic+stl">stl</a></code>, <code>seas</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># sample time series data in data frame
ap_df &lt;- tsdf(AirPassengers)

ggsdc(ap_df, aes(x = x, y = y), method = "decompose") +
   geom_line()
   
ggsdc(ap_df, aes(x = x, y = y), method = "decompose", 
      type = "multiplicative") +
   geom_line(colour = "blue", size = 2) +
   theme_light(8)

ggsdc(ap_df, aes(x = x, y = y), method = "stl", s.window = 7) +
   labs(x = "", y = "Air passenger numbers") +
   geom_point()
   
## Not run:       
ggsdc(ldeaths_df, aes(x = YearMon, y = deaths, colour = sex), method = "seas") +
      geom_line()
      
serv &lt;- subset(nzbop, Account == "Current account" &amp; 
            Category %in% c("Services; Exports total", "Services; Imports total"))
ggsdc(serv, aes(x = TimePeriod, y = Value, colour = Category),
      method = "seas", start = c(1971, 2), frequency = 4) +
   geom_line()

## End(Not run)

ggsdc(ldeaths_df, aes(x = YearMon, y = deaths, colour = sex), s.window = 7, 
   index.ref = 1:12, index.basis = 1000) +
   geom_line() +
   ylab("Lung deaths index (average month in 1974 = 1000)")
      
bop &lt;- subset(nzbop, Account == "Current account" &amp; !Balance)
ggsdc(bop, aes(x = TimePeriod, y = Value, colour = Category), frequency = 4, 
   method = "decomp", type = "multiplicative") +
      geom_line() 
      
ggsdc(bop, aes(x = TimePeriod, y = Value, colour = Category), frequency = 4, s.window = 7) +
      geom_line() 
</code></pre>

<hr>
<h2 id='ggseas-package'>Seasonal decomposition on the fly</h2><span id='topic+ggseas'></span><span id='topic+ggseas-package'></span>

<h3>Description</h3>

<p>ggseas allows you to perform seasonal decomposition on the fly as part of a 'ggplot2' pipeline.
</p>


<h3>Details</h3>

<p>Two main sets of functions are provided:
</p>

<ul>
<li><p><code>stat_seas()</code>, <code>stat_stl()</code> and friends do seasonal adjustment, indexing, rolling averages and by default render a line geom.
You can consider these as taking the place of <code>geom_line()</code> in the ggplot2 pipeline
</p>
</li>
<li><p><code>ggsdc()</code> goes where <code>ggplot()</code> normally does (ie at the beginning of the graphics part of the pipeline) and creates a graphic with four facets for the original data, trend, seasonal and random components
</p>
</li></ul>



<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Peter Ellis <a href="mailto:peter.ellis2013nz@gmail.com">peter.ellis2013nz@gmail.com</a>
</p>
<p>Other contributors:
</p>

<ul>
<li><p> Christophe Sax [contributor]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li><p> Report bugs at <a href="https://github.com/ellisp/ggseas/issues">https://github.com/ellisp/ggseas/issues</a>
</p>
</li></ul>


<hr>
<h2 id='ldeaths_df'>Monthly Deaths from Lung Diseases in the UK</h2><span id='topic+ldeaths_df'></span>

<h3>Description</h3>

<p>A long form combination of <code>fdeaths</code> and <code>mdeaths</code> from the <code>datasets</code> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ldeaths_df
</code></pre>


<h3>Format</h3>

<p>A data frame with 141 rows and 3 variables.</p>


<h3>Details</h3>


<ul>
<li><p> YearMon. Approximate, regular decimal representation of the beginning 
of the period of measurement.  January 1974 is 1974.000
</p>
</li>
<li><p> sex.
</p>
</li>
<li><p> deaths. Monthly deaths from bronchitis, emphysema and asthma.
...
</p>
</li></ul>



<h3>Source</h3>

<p>P. J. Diggle (1990) <em>Time Series: A Biostatistical Introduction</em>. Oxford, table A.3
</p>


<h3>See Also</h3>

<p><code><a href="datasets.html#topic+ldeaths">ldeaths</a></code>
</p>

<hr>
<h2 id='nzbop'>New Zealand Balance of Payments major components 1971Q2 to 2015Q2</h2><span id='topic+nzbop'></span>

<h3>Description</h3>

<p>New Zealand's &quot;BPM6 Quarterly, Balance of payments major components (Qrtly-Mar/Jun/Sep/Dec)&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nzbop
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 3676 rows and 5 columns.</p>


<h3>Details</h3>

<p>&quot;BPM6&quot; refers to the sixth edition of the IMF's Balance of Payments and
International Investment Position Manual, which is the method used by Statistics
New Zealand to prepare these data.
</p>
<p>Note:
</p>

<ul>
<li><p> 'Value' is in millions of New Zealand dollars and is not adjusted for inflation.
</p>
</li>
<li><p> 'fob' means 'free on board'.
</p>
</li>
<li><p> 'inv.' stands for investment
</p>
</li>
<li><p> TimePeriod is the last day of the quarterly reference period ie <code>1971-06-30</code>
means the fourth, fifth and six months of 1971.
</p>
</li></ul>

<p>This dataset was downloaded from <a href="http://www.stats.govt.nz/infoshare/">http://www.stats.govt.nz/infoshare/</a> and 
transformed in the following way:
</p>

<ul>
<li><p> missing values were filtered out (ie of series that started later 
than the longest series)
</p>
</li>
<li><p> a 'Balance' indicator variable was added for easier manipulation and filtering
</p>
</li>
<li><p> the single variable categorisation was split into two (Account
and Category) to make it tidier.
</p>
</li></ul>



<h3>Source</h3>

<p>Statistics New Zealand <a href="http://www.stats.govt.nz/browse_for_stats/economic_indicators/balance_of_payments/info-releases.aspx">http://www.stats.govt.nz/browse_for_stats/economic_indicators/balance_of_payments/info-releases.aspx</a>
</p>

<hr>
<h2 id='stat_decomp'>Classical seasonal adjustment Stat</h2><span id='topic+stat_decomp'></span>

<h3>Description</h3>

<p>Conducts seasonal adjustment on the fly for ggplot2, from classical seasonal decomposition by moving averages
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stat_decomp(mapping = NULL, data = NULL, geom = "line",
  position = "identity", show.legend = NA, inherit.aes = TRUE,
  frequency = NULL, type = c("additive", "multiplicative"),
  index.ref = NULL, index.basis = 100, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stat_decomp_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code> or
<code><a href="ggplot2.html#topic+aes_">aes_()</a></code>. If specified and <code>inherit.aes = TRUE</code> (the
default), it is combined with the default mapping at the top level of the
plot. You must supply <code>mapping</code> if there is no plot mapping.</p>
</td></tr>
<tr><td><code id="stat_decomp_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame.</code>, and
will be used as the layer data.</p>
</td></tr>
<tr><td><code id="stat_decomp_+3A_geom">geom</code></td>
<td>
<p>The geometric object to use display the data</p>
</td></tr>
<tr><td><code id="stat_decomp_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string, or the result of
a call to a position adjustment function.</p>
</td></tr>
<tr><td><code id="stat_decomp_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="stat_decomp_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</td></tr>
<tr><td><code id="stat_decomp_+3A_frequency">frequency</code></td>
<td>
<p>The frequency for the time series</p>
</td></tr>
<tr><td><code id="stat_decomp_+3A_type">type</code></td>
<td>
<p>The type of seasonal component</p>
</td></tr>
<tr><td><code id="stat_decomp_+3A_index.ref">index.ref</code></td>
<td>
<p>if not NULL, a vector of integers indicating which elements of
the beginning of each series to use as a reference point for converting to an index.  
If NULL, no conversion takes place and the data are presented on the original scale.</p>
</td></tr>
<tr><td><code id="stat_decomp_+3A_index.basis">index.basis</code></td>
<td>
<p>if index.ref is not NULL, the basis point for converting
to an index, most commonly 100 or 1000.  See examples.</p>
</td></tr>
<tr><td><code id="stat_decomp_+3A_...">...</code></td>
<td>
<p>other arguments for the geom</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Classical decomposition is a very basic way of performing seasonal
adjustment and is not recommended if you have access to X13-SEATS-ARIMA 
(<code>stat_seas</code>).  <code>stat_decomp</code> cannot allow the seasonality to vary
over time, or take outliers into account in calculating seasonality.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+decompose">decompose</a></code>
</p>
<p>Other time series stats for ggplot2: <code><a href="#topic+stat_index">stat_index</a></code>,
<code><a href="#topic+stat_rollapplyr">stat_rollapplyr</a></code>, <code><a href="#topic+stat_seas">stat_seas</a></code>,
<code><a href="#topic+stat_stl">stat_stl</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ap_df &lt;- tsdf(AirPassengers)

# Default additive decomposition (doesn't work well in this case!):
ggplot(ap_df, aes(x = x, y = y)) +
   stat_decomp()

# Multiplicative decomposition, more appropriate:
ggplot(ap_df, aes(x = x, y = y)) +
   stat_decomp(type = "multiplicative")

# Multiple time series example:
ggplot(ldeaths_df, aes(x = YearMon, y = deaths, colour = sex)) +
  geom_point() +
  facet_wrap(~sex) +
  stat_decomp() +
  ggtitle("Seasonally adjusted lung deaths")

# Example using index:
ggplot(ldeaths_df, aes(x = YearMon, y = deaths, colour = sex)) +
  facet_wrap(~sex) +
  stat_decomp(index.ref = 1:12, index.basis = 1000) +
  ggtitle("Rolling annual median lung deaths, indexed (average month in 1974 = 1000)")

</code></pre>

<hr>
<h2 id='stat_index'>Index Stat</h2><span id='topic+stat_index'></span>

<h3>Description</h3>

<p>Convert a time series from the original scale to an index for ggplot2
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stat_index(mapping = NULL, data = NULL, geom = "line",
  position = "identity", show.legend = NA, inherit.aes = TRUE,
  index.ref = NULL, index.basis = 100, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stat_index_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code> or
<code><a href="ggplot2.html#topic+aes_">aes_()</a></code>. If specified and <code>inherit.aes = TRUE</code> (the
default), it is combined with the default mapping at the top level of the
plot. You must supply <code>mapping</code> if there is no plot mapping.</p>
</td></tr>
<tr><td><code id="stat_index_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame.</code>, and
will be used as the layer data.</p>
</td></tr>
<tr><td><code id="stat_index_+3A_geom">geom</code></td>
<td>
<p>The geometric object to use display the data</p>
</td></tr>
<tr><td><code id="stat_index_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string, or the result of
a call to a position adjustment function.</p>
</td></tr>
<tr><td><code id="stat_index_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="stat_index_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</td></tr>
<tr><td><code id="stat_index_+3A_index.ref">index.ref</code></td>
<td>
<p>if not NULL, a vector of integers indicating which elements of
the beginning of each series to use as a reference point for converting to an index.  
If NULL, no conversion takes place and the data are presented on the original scale.</p>
</td></tr>
<tr><td><code id="stat_index_+3A_index.basis">index.basis</code></td>
<td>
<p>if index.ref is not NULL, the basis point for converting
to an index, most commonly 100 or 1000.  See examples.</p>
</td></tr>
<tr><td><code id="stat_index_+3A_...">...</code></td>
<td>
<p>other arguments for the geom</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other time series stats for ggplot2: <code><a href="#topic+stat_decomp">stat_decomp</a></code>,
<code><a href="#topic+stat_rollapplyr">stat_rollapplyr</a></code>, <code><a href="#topic+stat_seas">stat_seas</a></code>,
<code><a href="#topic+stat_stl">stat_stl</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ap_df &lt;- tsdf(AirPassengers)

ggplot(ldeaths_df, aes(x = YearMon, y = deaths, color = sex)) +
   stat_index(index.ref = 1:12, index.basis = 1000) +
   ylab("Deaths index\n(average of first 12 months = 1000")
   
</code></pre>

<hr>
<h2 id='stat_rollapplyr'>Rolling summary Stat</h2><span id='topic+stat_rollapplyr'></span>

<h3>Description</h3>

<p>Calculates a rolling summary, usually rolling average, on the fly for ggplot2
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stat_rollapplyr(mapping = NULL, data = NULL, geom = "line",
  position = "identity", show.legend = NA, inherit.aes = TRUE, width,
  align = "right", FUN = mean, index.ref = NULL, index.basis = 100, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stat_rollapplyr_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code> or
<code><a href="ggplot2.html#topic+aes_">aes_()</a></code>. If specified and <code>inherit.aes = TRUE</code> (the
default), it is combined with the default mapping at the top level of the
plot. You must supply <code>mapping</code> if there is no plot mapping.</p>
</td></tr>
<tr><td><code id="stat_rollapplyr_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame.</code>, and
will be used as the layer data.</p>
</td></tr>
<tr><td><code id="stat_rollapplyr_+3A_geom">geom</code></td>
<td>
<p>The geometric object to use display the data</p>
</td></tr>
<tr><td><code id="stat_rollapplyr_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string, or the result of
a call to a position adjustment function.</p>
</td></tr>
<tr><td><code id="stat_rollapplyr_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="stat_rollapplyr_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</td></tr>
<tr><td><code id="stat_rollapplyr_+3A_width">width</code></td>
<td>
<p>The width to which the rolling version of FUN is applied</p>
</td></tr>
<tr><td><code id="stat_rollapplyr_+3A_align">align</code></td>
<td>
<p>specifies whether the transformed series should be left or 
right-aligned or centered compared to the rolling window of observations</p>
</td></tr>
<tr><td><code id="stat_rollapplyr_+3A_fun">FUN</code></td>
<td>
<p>summary function, usually some kind of average, to apply on a rolling basis</p>
</td></tr>
<tr><td><code id="stat_rollapplyr_+3A_index.ref">index.ref</code></td>
<td>
<p>if not NULL, a vector of integers indicating which elements of
the beginning of each series to use as a reference point for converting to an index.  
If NULL, no conversion takes place and the data are presented on the original scale.</p>
</td></tr>
<tr><td><code id="stat_rollapplyr_+3A_index.basis">index.basis</code></td>
<td>
<p>if index.ref is not NULL, the basis point for converting
to an index, most commonly 100 or 1000.  See examples.</p>
</td></tr>
<tr><td><code id="stat_rollapplyr_+3A_...">...</code></td>
<td>
<p>other arguments for the geom</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Calculates a rolling summary (usually rolling average) on the fly
for purposes of plotting with ggplot2.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+decompose">decompose</a></code>
</p>
<p>Other time series stats for ggplot2: <code><a href="#topic+stat_decomp">stat_decomp</a></code>,
<code><a href="#topic+stat_index">stat_index</a></code>, <code><a href="#topic+stat_seas">stat_seas</a></code>,
<code><a href="#topic+stat_stl">stat_stl</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ap_df &lt;- tsdf(AirPassengers)

ggplot(ap_df, aes(x = x, y = y)) +
   stat_rollapplyr(width = 12)
   
# rolling average after converting to an index, 1000 = average value
# in the first 12 months.
ggplot(ap_df, aes(x = x, y = y)) +
   stat_rollapplyr(width = 12, index.ref = 1:12, index.basis = 1000)

ggplot(ldeaths_df, aes(x = YearMon, y = deaths, colour = sex)) +
  geom_point() +
  facet_wrap(~sex) +
  stat_rollapplyr(width = 12, FUN = median) +
  ggtitle("Seasonally adjusted lung deaths")

</code></pre>

<hr>
<h2 id='stat_seas'>X13 seasonal adjustment Stat</h2><span id='topic+stat_seas'></span>

<h3>Description</h3>

<p>Conducts X13-SEATS-ARIMA seasonal adjustment on the fly for ggplot2
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stat_seas(mapping = NULL, data = NULL, geom = "line",
  position = "identity", show.legend = NA, inherit.aes = TRUE,
  x13_params = NULL, index.ref = NULL, index.basis = 100,
  frequency = NULL, start = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stat_seas_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code> or
<code><a href="ggplot2.html#topic+aes_">aes_()</a></code>. If specified and <code>inherit.aes = TRUE</code> (the
default), it is combined with the default mapping at the top level of the
plot. You must supply <code>mapping</code> if there is no plot mapping.</p>
</td></tr>
<tr><td><code id="stat_seas_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame.</code>, and
will be used as the layer data.</p>
</td></tr>
<tr><td><code id="stat_seas_+3A_geom">geom</code></td>
<td>
<p>The geometric object to use display the data</p>
</td></tr>
<tr><td><code id="stat_seas_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string, or the result of
a call to a position adjustment function.</p>
</td></tr>
<tr><td><code id="stat_seas_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="stat_seas_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</td></tr>
<tr><td><code id="stat_seas_+3A_x13_params">x13_params</code></td>
<td>
<p>a list of other parameters for <code>seas</code></p>
</td></tr>
<tr><td><code id="stat_seas_+3A_index.ref">index.ref</code></td>
<td>
<p>if not NULL, a vector of integers indicating which elements of
the beginning of each series to use as a reference point for converting to an index.  
If NULL, no conversion takes place and the data are presented on the original scale.</p>
</td></tr>
<tr><td><code id="stat_seas_+3A_index.basis">index.basis</code></td>
<td>
<p>if index.ref is not NULL, the basis point for converting
to an index, most commonly 100 or 1000.  See examples.</p>
</td></tr>
<tr><td><code id="stat_seas_+3A_frequency">frequency</code></td>
<td>
<p>The frequency for the time series</p>
</td></tr>
<tr><td><code id="stat_seas_+3A_start">start</code></td>
<td>
<p>The starting point for the time series, in a format suitable for <code>ts()</code></p>
</td></tr>
<tr><td><code id="stat_seas_+3A_...">...</code></td>
<td>
<p>other arguments for the geom</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code>seas</code>
</p>
<p>Other time series stats for ggplot2: <code><a href="#topic+stat_decomp">stat_decomp</a></code>,
<code><a href="#topic+stat_index">stat_index</a></code>, <code><a href="#topic+stat_rollapplyr">stat_rollapplyr</a></code>,
<code><a href="#topic+stat_stl">stat_stl</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
ap_df &lt;- tsdf(AirPassengers)

# SEATS with defaults:
ggplot(ap_df, aes(x = x, y = y)) +
   stat_seas()
   
# X11 with no outlier treatment:
ggplot(ap_df, aes(x = x, y = y)) +
  stat_seas(x13_params = list(x11 = "", outlier = NULL))

# Multiple time series example:    
ggplot(ldeaths_df, aes(x = YearMon, y = deaths, colour = sex)) +
  geom_point() +
  facet_wrap(~sex) +
  stat_seas() +
  ggtitle("Seasonally adjusted lung deaths")
  
# example use of index:  
ggplot(ap_df, aes(x = x, y = y)) +
  stat_seas(x13_params = list(x11 = "", outlier = NULL),
  index.ref = 1, index.basis = 1000) +
  labs(y = "Seasonally adjusted index\n(first observation = 1000)")
  
# if the x value is not a decimal eg not created with time(your_ts_object),
# you need to specify start and frequency by hand:
ggplot(subset(nzbop, Account == "Current account"), 
      aes(x = TimePeriod, y = Value)) +
   stat_seas(start = c(1971, 2), frequency = 12) +
   facet_wrap(~Category, scales = "free_y")
  
  
## End(Not run)
</code></pre>

<hr>
<h2 id='stat_stl'>LOESS seasonal adjustment Stat</h2><span id='topic+stat_stl'></span>

<h3>Description</h3>

<p>Conducts seasonal adjustment on the fly for ggplot2, from LOESS seasonal decomposition
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stat_stl(mapping = NULL, data = NULL, geom = "line",
  position = "identity", show.legend = NA, inherit.aes = TRUE,
  frequency = NULL, s.window, index.ref = NULL, index.basis = 100, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stat_stl_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code> or
<code><a href="ggplot2.html#topic+aes_">aes_()</a></code>. If specified and <code>inherit.aes = TRUE</code> (the
default), it is combined with the default mapping at the top level of the
plot. You must supply <code>mapping</code> if there is no plot mapping.</p>
</td></tr>
<tr><td><code id="stat_stl_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame.</code>, and
will be used as the layer data.</p>
</td></tr>
<tr><td><code id="stat_stl_+3A_geom">geom</code></td>
<td>
<p>The geometric object to use display the data</p>
</td></tr>
<tr><td><code id="stat_stl_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string, or the result of
a call to a position adjustment function.</p>
</td></tr>
<tr><td><code id="stat_stl_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="stat_stl_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</td></tr>
<tr><td><code id="stat_stl_+3A_frequency">frequency</code></td>
<td>
<p>The frequency for the time series</p>
</td></tr>
<tr><td><code id="stat_stl_+3A_s.window">s.window</code></td>
<td>
<p>either the character string <code>"periodic"</code> or the span (in lags) of the 
loess window for seasonal extraction, which should be odd and at least 7, according to
Cleveland et al.  This has no default and must be chosen.</p>
</td></tr>
<tr><td><code id="stat_stl_+3A_index.ref">index.ref</code></td>
<td>
<p>if not NULL, a vector of integers indicating which elements of
the beginning of each series to use as a reference point for converting to an index.  
If NULL, no conversion takes place and the data are presented on the original scale.</p>
</td></tr>
<tr><td><code id="stat_stl_+3A_index.basis">index.basis</code></td>
<td>
<p>if index.ref is not NULL, the basis point for converting
to an index, most commonly 100 or 1000.  See examples.</p>
</td></tr>
<tr><td><code id="stat_stl_+3A_...">...</code></td>
<td>
<p>other arguments for the geom</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other time series stats for ggplot2: <code><a href="#topic+stat_decomp">stat_decomp</a></code>,
<code><a href="#topic+stat_index">stat_index</a></code>, <code><a href="#topic+stat_rollapplyr">stat_rollapplyr</a></code>,
<code><a href="#topic+stat_seas">stat_seas</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ap_df &lt;- tsdf(AirPassengers)

# periodic if fixed seasonality; doesn't work well:
ggplot(ap_df, aes(x = x, y = y)) +
   stat_stl(s.window = "periodic")

# seasonality varies a bit over time, works better:
ggplot(ap_df, aes(x = x, y = y)) +
   stat_stl(s.window = 7)

# Multiple time series example:
ggplot(ldeaths_df, aes(x = YearMon, y = deaths, colour = sex)) +
   geom_point() +
   facet_wrap(~sex) +
   stat_stl(s.window = 7) +
   ggtitle("Seasonally adjusted lung deaths")

# Index so first value is 100:
ggplot(ap_df, aes(x = x, y = y)) +
   stat_stl(s.window = 7, index.ref = 1)
</code></pre>

<hr>
<h2 id='tsdf'>Time series to data frame</h2><span id='topic+tsdf'></span>

<h3>Description</h3>

<p>Convert a ts object to data.frame with columns for time period and the original data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tsdf(timeseries, colname = "x")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tsdf_+3A_timeseries">timeseries</code></td>
<td>
<p>an object of class ts or mts</p>
</td></tr>
<tr><td><code id="tsdf_+3A_colname">colname</code></td>
<td>
<p>Column name to give to the time period column</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A convenience function to create a data frame from a time series or
multiple time series object.  The motivation is to make it easy to pass time
series data to functions that need data frames such as ggplot2.
</p>


<h3>Value</h3>

<p>a data.frame with the same number of rows as the original time series
</p>


<h3>Examples</h3>

<pre><code class='language-R'>head(tsdf(AirPassengers))

ld &lt;- cbind(fdeaths, mdeaths)
head(tsdf(ld))
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
