<!DOCTYPE html><html><head><title>Help for package ctrdata</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ctrdata}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ctrdata'><p>ctrdata: get started, database connection, function overview</p></a></li>
<li><a href='#ctrdata-registers'><p>ctrdata: information on clinical trial registers</p></a></li>
<li><a href='#ctrDb'><p>Check and prepare nodbi connection object for ctrdata</p></a></li>
<li><a href='#ctrFindActiveSubstanceSynonyms'><p>Find synonyms of an active substance</p></a></li>
<li><a href='#ctrGetQueryUrl'><p>Get query details</p></a></li>
<li><a href='#ctrLoadQueryIntoDb'><p>Load and store register trial information</p></a></li>
<li><a href='#ctrOpenSearchPagesInBrowser'><p>Open reigster to show query results or search page</p></a></li>
<li><a href='#dbFindFields'><p>Find names of fields in the database collection</p></a></li>
<li><a href='#dbFindIdsUniqueTrials'><p>Get identifiers of deduplicated trial records</p></a></li>
<li><a href='#dbGetFieldsIntoDf'><p>Create data frame of specified fields from database collection</p></a></li>
<li><a href='#dbQueryHistory'><p>Show history of queries loaded into a database collection</p></a></li>
<li><a href='#dfMergeVariablesRelevel'><p>Merge variables, keeping type, and optionally relevel factors</p></a></li>
<li><a href='#dfName2Value'><p>Get value for variable of interest</p></a></li>
<li><a href='#dfTrials2Long'><p>Convert data frame with trial records into long format</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Retrieve and Analyze Clinical Trials in Public Registers</td>
</tr>
<tr>
<td>Version:</td>
<td>1.17.2</td>
</tr>
<tr>
<td>Imports:</td>
<td>jsonlite, httr, curl (&ge; 5.1.0), clipr, xml2, nodbi (&ge;
0.10.0), stringi, tibble, lubridate, jqr, dplyr, zip, V8,
readr, digest</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://cran.r-project.org/package=ctrdata">https://cran.r-project.org/package=ctrdata</a>,
<a href="https://rfhb.github.io/ctrdata/">https://rfhb.github.io/ctrdata/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/rfhb/ctrdata/issues">https://github.com/rfhb/ctrdata/issues</a></td>
</tr>
<tr>
<td>Description:</td>
<td>A system for querying, retrieving and analyzing
        protocol- and results-related information on clinical trials from
        four public registers, the 'European Union Clinical Trials Register'
        ('EUCTR', <a href="https://www.clinicaltrialsregister.eu/">https://www.clinicaltrialsregister.eu/</a>), 
        'ClinicalTrials.gov' ('CTGOV', using the classic interface at 
        <a href="https://classic.clinicaltrials.gov/">https://classic.clinicaltrials.gov/</a>, and 'CTGOV2', using the 
        current interface at <a href="https://www.clinicaltrials.gov/">https://www.clinicaltrials.gov/</a>), the 
        'ISRCTN' (<a href="http://www.isrctn.com/">http://www.isrctn.com/</a>) and the
        'European Union Clinical Trials Information System'
        ('CTIS', <a href="https://euclinicaltrials.eu/">https://euclinicaltrials.eu/</a>). 
        Trial information is downloaded, converted and stored in a database 
        ('PostgreSQL', 'SQLite', 'DuckDB' or 'MongoDB'; via package 'nodbi'). 
        Documents in registers associated with trials can also be downloaded. 
        Other functions identify deduplicated records, 
        easily find and extract variables (fields) of interest even 
        from complex nested data as used by the registers, 
        merge variables and update queries. 
        The package can be used for meta-analysis and trend-analysis of
        the design and conduct as well as of the results of clinical trials.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>devtools, knitr, rmarkdown, RSQLite (&ge; 2.3.5), mongolite,
tinytest (&ge; 1.2.1), R.rsp, RPostgres, duckdb</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>R.rsp</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Language:</td>
<td>en-GB</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-25 11:59:08 UTC; ralfherold</td>
</tr>
<tr>
<td>Author:</td>
<td>Ralf Herold <a href="https://orcid.org/0000-0002-8148-6748"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Ralf Herold &lt;ralf.herold@mailbox.org&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-02-25 12:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='ctrdata'>ctrdata: get started, database connection, function overview</h2><span id='topic+ctrdata-package'></span><span id='topic+ctrdata'></span>

<h3>Description</h3>

<p>A package for aggregating and analysing information on clinical
studies, and for obtaining documents, from public registers
</p>


<h3>1 - Database connection</h3>

<p>Package <code>ctrdata</code> retrieves trial information and stores it in a
database collection, which has to be given as a connection object
to parameter <code>con</code> for several ctrdata functions; this
connection object is created in almost identical ways for
these supported backends:</p>

<table>
<tr>
 <td style="text-align: left;">
   <em>Database</em> </td><td style="text-align: left;"> <em>Connection object</em> </td>
</tr>
<tr>
 <td style="text-align: left;">
   MongoDB </td><td style="text-align: left;"> <code>dbc &lt;- <a href="nodbi.html#topic+src_mongo">nodbi::src_mongo</a>(db = "my_db", collection = "my_coll")</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
   SQLite </td><td style="text-align: left;"> <code>dbc &lt;- <a href="nodbi.html#topic+src_sqlite">nodbi::src_sqlite</a>(dbname = "my_db", collection = "my_coll")</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
   PostgreSQL </td><td style="text-align: left;"> <code>dbc &lt;- <a href="nodbi.html#topic+src_postgres">nodbi::src_postgres</a>(dbname = "my_db"); dbc[["collection"]] &lt;- "my_coll"</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
   DuckDB </td><td style="text-align: left;"> <code>dbc &lt;- <a href="nodbi.html#topic+src_duckdb">nodbi::src_duckdb</a>(dbname = "my_db", collection = "my_coll")</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>Use a connection object with a <code>ctrdata</code> function, for example
<a href="#topic+dbQueryHistory">dbQueryHistory</a>, or other packages, for example
<a href="mongolite.html#topic+mongo">mongolite::mongo</a> or <a href="nodbi.html#topic+docdb_query">nodbi::docdb_query</a>.
Use a demo database:
<code>dbc &lt;- nodbi::src_sqlite(dbname = system.file("extdata", "demo.sqlite", package = "ctrdata"), collection = "my_trials")</code>
</p>


<h3>2 - Operate on a clinical trial register</h3>

<p><a href="#topic+ctrOpenSearchPagesInBrowser">ctrOpenSearchPagesInBrowser</a>,
<a href="#topic+ctrLoadQueryIntoDb">ctrLoadQueryIntoDb</a> (load trial records into database collection);
see
<a href="#topic+ctrdata-registers">ctrdata-registers</a> for details on registers and how to search.
</p>


<h3>3 - Get a data frame from the database collection</h3>

<p><a href="#topic+dbFindFields">dbFindFields</a> (find names of fields of interest in trial records in a collection),
<a href="#topic+dbGetFieldsIntoDf">dbGetFieldsIntoDf</a> (create a data frame with fields of interest from collection),
<a href="#topic+dbFindIdsUniqueTrials">dbFindIdsUniqueTrials</a> (get de-duplicated identifiers of
clinical trials' records that can be used to subset a data frame).
</p>


<h3>4 - Operate on a data frame with trial information</h3>

<p><a href="#topic+dfTrials2Long">dfTrials2Long</a> (convert fields with nested elements into long format),
<a href="#topic+dfName2Value">dfName2Value</a> (get values for variable(s) of interest).
</p>


<h3>Author(s)</h3>

<p>Ralf Herold <a href="mailto:ralf.herold@mailbox.org">ralf.herold@mailbox.org</a>
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://cran.r-project.org/package=ctrdata">https://cran.r-project.org/package=ctrdata</a>
</p>
</li>
<li> <p><a href="https://rfhb.github.io/ctrdata/">https://rfhb.github.io/ctrdata/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/rfhb/ctrdata/issues">https://github.com/rfhb/ctrdata/issues</a>
</p>
</li></ul>


<hr>
<h2 id='ctrdata-registers'>ctrdata: information on clinical trial registers</h2><span id='topic+ctrdata-registers'></span>

<h3>Description</h3>

<p>Registers of clinical trials that can be accessed with
package <a href="#topic+ctrdata">ctrdata</a> as of September 2023.
</p>


<h3>Details</h3>


<ul>
<li> <p><strong>EUCTR</strong>: The European Union Clinical Trials Register contains
more than 43,500 clinical trials (using one or more medicines as
investigational medicinal product, IMP; in the European Union and beyond)
</p>
</li>
<li> <p><strong>CTGOV</strong> and <strong>CTGOV2</strong>: ClinicalTrials.gov includes more than 465,000
interventional and observational studies (both the current and
the classic website are supported)
</p>
</li>
<li> <p><strong>ISRCTN</strong>: The ISRCTN Registry includes almost 24,000
interventional or observational health studies
</p>
</li>
<li> <p><strong>CTIS</strong>: The EU Clinical Trials Information System was
started in January 2023, including more than 500 publicly
accessible trials on 2024-02-10. How to automatically
get a query URL: <a href="https://github.com/rfhb/ctrdata#3-script-to-automatically-copy-users-query-from-web-browser">here</a>
</p>
</li></ul>

<table>
<tr>
 <td style="text-align: left;">
   <strong>Material</strong> </td><td style="text-align: center;"> <strong>EUCTR</strong> </td><td style="text-align: center;"> <strong>CTGOV</strong> </td><td style="text-align: center;"> <strong>CTGOV2</strong> </td><td style="text-align: center;"> <strong>ISRCTN</strong> </td><td style="text-align: center;"> <strong>CTIS</strong> </td>
</tr>
<tr>
 <td style="text-align: left;">
   Home page </td><td style="text-align: center;"> <a href="https://www.clinicaltrialsregister.eu/">link</a> </td><td style="text-align: center;"> <a href="https://classic.clinicaltrials.gov/">link</a> </td><td style="text-align: center;"> <a href="https://www.isrctn.com/">link</a> </td><td style="text-align: center;"> <a href="https://euclinicaltrials.eu/">link</a> </td><td style="text-align: center;">  </td>
</tr>
<tr>
 <td style="text-align: left;">
   About </td><td style="text-align: center;"> <a href="https://www.clinicaltrialsregister.eu/about.html">link</a> </td><td style="text-align: center;"> <a href="https://classic.clinicaltrials.gov/ct2/about-site/background">link</a> </td><td style="text-align: center;"> <a href="https://www.clinicaltrials.gov/">link</a> </td><td style="text-align: center;"> <a href="https://www.isrctn.com/page/about">link</a> </td><td style="text-align: center;"> <a href="https://euclinicaltrials.eu/about-this-website/">link</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
   Terms and conditions, disclaimer </td><td style="text-align: center;"> <a href="https://www.clinicaltrialsregister.eu/disclaimer.html">link</a> </td><td style="text-align: center;"> <a href="https://clinicaltrials.gov/ct2/about-site/terms-conditions#Use">link</a> </td><td style="text-align: center;"> <a href="https://www.clinicaltrials.gov/about-site/terms-conditions">link</a> </td><td style="text-align: center;"> <a href="https://www.isrctn.com/page/faqs#usingISRCTN">link</a> </td><td style="text-align: center;"> <a href="https://euclinicaltrials.eu/guidance-and-q-as/">link</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
   How to search </td><td style="text-align: center;"> <a href="https://www.clinicaltrialsregister.eu/doc/How_to_Search_EU_CTR.pdf">link</a> </td><td style="text-align: center;"> <a href="https://classic.clinicaltrials.gov/ct2/help/how-find/advanced">link</a> </td><td style="text-align: center;"> <a href="https://www.clinicaltrials.gov/find-studies/how-to-search">link</a> </td><td style="text-align: center;"> <a href="https://www.isrctn.com/page/search-tips">link</a> </td><td style="text-align: center;"> <a href="https://euclinicaltrials.eu/search-tips-and-guidance/">link</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
   Search interface </td><td style="text-align: center;"> <a href="https://www.clinicaltrialsregister.eu/ctr-search/search">link</a> </td><td style="text-align: center;"> <a href="https://classic.clinicaltrials.gov/ct2/search/advanced">link</a> </td><td style="text-align: center;"> <a href="https://www.clinicaltrials.gov/">link</a> </td><td style="text-align: center;"> <a href="https://www.isrctn.com/">link</a> </td><td style="text-align: center;"> <a href="https://euclinicaltrials.eu/search-for-clinical-trials/">link</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
   Glossary </td><td style="text-align: center;"> <a href="https://www.clinicaltrialsregister.eu/doc/EU_Clinical_Trials_Register_Glossary.pdf">link</a> </td><td style="text-align: center;"> <a href="https://classic.clinicaltrials.gov/ct2/about-studies/glossary">link</a> </td><td style="text-align: center;"> <a href="https://www.clinicaltrials.gov/study-basics/glossary">link</a> </td><td style="text-align: center;"> <a href="https://www.who.int/clinical-trials-registry-platform/network/who-data-set">link</a> </td><td style="text-align: center;">  </td>
</tr>
<tr>
 <td style="text-align: left;">
   FAQ </td><td style="text-align: center;"> <a href="https://www.clinicaltrialsregister.eu/doc/EU_CTR_FAQ.pdf">link</a> </td><td style="text-align: center;"> <a href="https://www.clinicaltrials.gov/about-site/selected-publications">link</a> </td><td style="text-align: center;"> <a href="https://www.clinicaltrials.gov/about-site/about-ctg">link</a> </td><td style="text-align: center;"> <a href="https://www.isrctn.com/page/faqs">link</a> </td><td style="text-align: center;">  </td>
</tr>
<tr>
 <td style="text-align: left;">
   Expert / advanced search </td><td style="text-align: center;"> <a href="https://www.clinicaltrialsregister.eu/ctr-search/search">link</a> </td><td style="text-align: center;"> <a href="https://classic.clinicaltrials.gov/ct2/results/refine?show_xprt=Y">link</a> </td><td style="text-align: center;">  </td><td style="text-align: center;"> <a href="https://www.isrctn.com/editAdvancedSearch">link</a> </td><td style="text-align: center;"> <a href="https://euclinicaltrials.eu/app/#/search">link</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
   Example* </td><td style="text-align: center;"> <a href="https://www.clinicaltrialsregister.eu/ctr-search/search?query=Infections&amp;age=newborn&amp;age=preterm-new-born-infants">link</a> </td><td style="text-align: center;"> <a href="https://classic.clinicaltrials.gov/ct2/results/refine?term=AREA%5BMaximumAge%5D+RANGE%5B0+days,1+months%5D&amp;type=Intr&amp;cond=Infections&amp;intr=Investigational+Agent&amp;show_xprt=Y">link</a> </td><td style="text-align: center;"> <a href="https://www.clinicaltrials.gov/search?ageRange=0M_1M&amp;cond=Infections&amp;aggFilters=studyType:int&amp;distance=50&amp;intr=Investigational+Agent">link</a> </td><td style="text-align: center;"> <a href="https://www.isrctn.com/search?q=&amp;filters=ageRange:Neonate,conditionCategory:Infections+and+Infestations&amp;searchType=advanced-search">link</a> </td><td style="text-align: center;"> <a href="https://euclinicaltrials.eu/app/#/search?basicSearchInputAND=infections&amp;ageGroupCode=2">link</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
   Definitions </td><td style="text-align: center;"> <a href="https://eudract.ema.europa.eu/result.html">link</a> </td><td style="text-align: center;"> <a href="https://prsinfo.clinicaltrials.gov/prs-xml-schemas.html">link</a> </td><td style="text-align: center;"> <a href="https://www.clinicaltrials.gov/data-about-studies/study-data-structure">link</a> </td><td style="text-align: center;"> <a href="https://www.isrctn.com/page/definitions">link</a> </td><td style="text-align: center;"> <a href="https://www.ema.europa.eu/en/human-regulatory-overview/research-and-development/clinical-trials-human-medicines/clinical-trials-information-system-training-support">link</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>*The example is an expert search that retrieves interventional
trials with neonates, investigating infectious conditions:
The CTGOV expert search retrieves trials conducted exclusively with neonates.
It is not yet clear why different sets of trials are shown in CTGOV (65) and
CTGOV2 (14) for the same query parameters.
EUCTR retrieves trials with neonates, but not only those exclusively in neonates.
ISRCTN retrieves studies with interventions other than medicines.
Thus, after loading trials with <a href="#topic+ctrLoadQueryIntoDb">ctrLoadQueryIntoDb</a>
into a database collection, trials of interest have to be selected
in a second step, based on values of fields of interest
(e.g., using <code>f115_children_211years</code> from EUCTR for age criteria,
<code>interventions.intervention.interventionType</code> from ISRCTN for type of study),
which can be obtained from the collection using <a href="#topic+dbGetFieldsIntoDf">dbGetFieldsIntoDf</a>.
</p>


<h3>Author(s)</h3>

<p>Ralf Herold <a href="mailto:ralf.herold@mailbox.org">ralf.herold@mailbox.org</a>
</p>

<hr>
<h2 id='ctrDb'>Check and prepare nodbi connection object for ctrdata</h2><span id='topic+ctrDb'></span>

<h3>Description</h3>

<p>Check and prepare nodbi connection object for ctrdata
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ctrDb(con)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ctrDb_+3A_con">con</code></td>
<td>
<p>A connection object, see section
'Databases' in <a href="#topic+ctrdata">ctrdata</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Connection object as list, with collection
element under root
</p>

<hr>
<h2 id='ctrFindActiveSubstanceSynonyms'>Find synonyms of an active substance</h2><span id='topic+ctrFindActiveSubstanceSynonyms'></span>

<h3>Description</h3>

<p>An active substance can be identified by a recommended international
nonproprietary name (INN), a trade or product name, or a company code(s).
Retrieves the names of substance which are searched for by &quot;CTGOV&quot;
when querying for a given active substance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ctrFindActiveSubstanceSynonyms(activesubstance = "")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ctrFindActiveSubstanceSynonyms_+3A_activesubstance">activesubstance</code></td>
<td>
<p>An active substance, in an atomic character vector</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character vector of the active substance (input parameter) and
synonyms, or NULL if active substance was not found and may be invalid
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

ctrFindActiveSubstanceSynonyms(activesubstance = "imatinib")
# [1] "imatinib" "gleevec" "sti 571" "glivec" "CGP 57148" "st1571"

## End(Not run)
</code></pre>

<hr>
<h2 id='ctrGetQueryUrl'>Get query details</h2><span id='topic+ctrGetQueryUrl'></span>

<h3>Description</h3>

<p>Extracts query parameters and register name from parameter 'url' or
from the clipboard, into which the URL of a register search was copied.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ctrGetQueryUrl(url = "", register = "")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ctrGetQueryUrl_+3A_url">url</code></td>
<td>
<p>URL such as from the browser address bar.
If not specified, clipboard contents will be checked for
a suitable URL.
For automatically copying the user's query of a register
in a web browser to the clipboard, see
<a href="https://github.com/rfhb/ctrdata#3-script-to-automatically-copy-users-query-from-web-browser">here</a>.
Can also contain a query term such as from
<a href="#topic+dbQueryHistory">dbQueryHistory</a>()[&quot;query-term&quot;].</p>
</td></tr>
<tr><td><code id="ctrGetQueryUrl_+3A_register">register</code></td>
<td>
<p>Optional name of register (one of &quot;EUCTR&quot;, &quot;CTGOV&quot;,
&quot;ISRCTN&quot; or &quot;CTIS&quot;) in case 'url' is a query term</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame (or tibble, if <code>tibble</code> is loaded)
with column names 'query-term' and 'query-register'.
The data frame (or tibble) can be passed as such as parameter
'query-term' to <a href="#topic+ctrLoadQueryIntoDb">ctrLoadQueryIntoDb</a> and as parameter
'url' to <a href="#topic+ctrOpenSearchPagesInBrowser">ctrOpenSearchPagesInBrowser</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# user copied into the clipboard the URL from
# the address bar of the browser that shows results
# from a query in one of the trial registers
try(ctrGetQueryUrl(), silent = TRUE)

# extract query parameters from search result URL
# (URL was cut for the purpose of formatting only)
ctrGetQueryUrl(
    url = paste0(
        "https://classic.clinicaltrials.gov/ct2/results?",
        "cond=&amp;term=AREA%5BMaximumAge%5D+RANGE%5B0+days%2C+28+days%5D",
        "&amp;type=Intr&amp;rslt=&amp;age_v=&amp;gndr=&amp;intr=Drugs%2C+Investigational",
        "&amp;titles=&amp;outc=&amp;spons=&amp;lead=&amp;id=&amp;cntry=&amp;state=&amp;city=&amp;dist=",
        "&amp;locn=&amp;phase=2&amp;rsub=&amp;strd_s=01%2F01%2F2015&amp;strd_e=01%2F01%2F2016",
        "&amp;prcd_s=&amp;prcd_e=&amp;sfpd_s=&amp;sfpd_e=&amp;rfpd_s=&amp;rfpd_e=&amp;lupd_s=&amp;lupd_e=&amp;sort="
    )
)

ctrGetQueryUrl("https://www.clinicaltrialsregister.eu/ctr-search/trial/2007-000371-42/results")
ctrGetQueryUrl("https://euclinicaltrials.eu/app/#/view/2022-500041-24-00")
ctrGetQueryUrl("https://euclinicaltrials.eu/app/#/search?sponsorTypeCode=1")
ctrGetQueryUrl("https://classic.clinicaltrials.gov/ct2/show/NCT01492673?cond=neuroblastoma")
ctrGetQueryUrl("https://clinicaltrials.gov/ct2/show/NCT01492673?cond=neuroblastoma")
ctrGetQueryUrl("https://www.clinicaltrials.gov/study/NCT01467986?aggFilters=ages:child")
ctrGetQueryUrl("https://www.isrctn.com/ISRCTN70039829")

</code></pre>

<hr>
<h2 id='ctrLoadQueryIntoDb'>Load and store register trial information</h2><span id='topic+ctrLoadQueryIntoDb'></span>

<h3>Description</h3>

<p>Retrieves information on clinical trials from registers
and stores it in a collection in a database. Main function
of <a href="#topic+ctrdata">ctrdata</a> for accessing registers.
A collection can store trial information from different queries
or different registers. Query details are stored in the
collection and can be accessed using <a href="#topic+dbQueryHistory">dbQueryHistory</a>.
A previous query can be re-run, which replaces or adds trial
records while keeping any user annotations of trial records.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ctrLoadQueryIntoDb(
  queryterm = NULL,
  register = "",
  querytoupdate = NULL,
  forcetoupdate = FALSE,
  euctrresults = FALSE,
  euctrresultshistory = FALSE,
  documents.path = NULL,
  documents.regexp = "prot|sample|statist|sap_|p1ar|p2ars|ctalett|lay|^[0-9]+ ",
  annotation.text = "",
  annotation.mode = "append",
  only.count = FALSE,
  con = NULL,
  verbose = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ctrLoadQueryIntoDb_+3A_queryterm">queryterm</code></td>
<td>
<p>Either a string with the full URL of a search
query in a register, or the data frame returned by the
<a href="#topic+ctrGetQueryUrl">ctrGetQueryUrl</a> or the
<a href="#topic+dbQueryHistory">dbQueryHistory</a> functions, or, together with parameter
<code>register</code>, a string with query elements of a search URL.
The query details are recorded in the <code>collection</code> for
later use to update records.
For &quot;CTIS&quot;, <code>queryterm</code> can be an empty string to obtain
all trial records. For automatically copying the user's
query of a register in a web browser to the clipboard, see
<a href="https://github.com/rfhb/ctrdata#3-script-to-automatically-copy-users-query-from-web-browser">here</a></p>
</td></tr>
<tr><td><code id="ctrLoadQueryIntoDb_+3A_register">register</code></td>
<td>
<p>String with abbreviation of register to query,
either &quot;EUCTR&quot;, &quot;CTGOV&quot;, &quot;ISRCTN&quot; or &quot;CTIS&quot;. Not needed
if <code>queryterm</code> provides a full URL to query results.</p>
</td></tr>
<tr><td><code id="ctrLoadQueryIntoDb_+3A_querytoupdate">querytoupdate</code></td>
<td>
<p>Either the word &quot;last&quot;, or the row number of
a query in the data frame returned by <a href="#topic+dbQueryHistory">dbQueryHistory</a> that
should be run to retrieve any new or update trial records since
this query was run the last time.
This parameter takes precedence over <code>queryterm</code>.
For &quot;EUCTR&quot;, updates are available only for the last seven days;
the query is run again if more time has passed since it was
run last.
Does not work with &quot;CTIS&quot; at this time.</p>
</td></tr>
<tr><td><code id="ctrLoadQueryIntoDb_+3A_forcetoupdate">forcetoupdate</code></td>
<td>
<p>If <code>TRUE</code>, run again the query
given in <code>querytoupdate</code>, irrespective of when it was
run last. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="ctrLoadQueryIntoDb_+3A_euctrresults">euctrresults</code></td>
<td>
<p>If <code>TRUE</code>, also download available
results when retrieving and loading trials from EUCTR. This
slows down this function. (For &quot;CTGOV&quot;, &quot;CTGOV2&quot; and &quot;CTIS&quot;,
all available results are always retrieved and loaded into the
collection.)</p>
</td></tr>
<tr><td><code id="ctrLoadQueryIntoDb_+3A_euctrresultshistory">euctrresultshistory</code></td>
<td>
<p>If <code>TRUE</code>, also download
available history of results publication in &quot;EUCTR.&quot;
This is quite time-consuming. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="ctrLoadQueryIntoDb_+3A_documents.path">documents.path</code></td>
<td>
<p>If this is a relative or absolute
path to a directory that exists or can be created,
save any documents into it that are directly available from
the register (&quot;EUCTR&quot;, &quot;CTGOV&quot;, &quot;CTGOV2&quot;, &quot;ISRCTN&quot;, &quot;CTIS&quot;)
such as PDFs on results, analysis plans, spreadsheets,
patient information sheets, assessments or product information.
Default is <code>NULL</code>, which disables saving documents.</p>
</td></tr>
<tr><td><code id="ctrLoadQueryIntoDb_+3A_documents.regexp">documents.regexp</code></td>
<td>
<p>Regular expression, case insensitive,
to select documents, if saving documents is requested
(see <code>documents.path</code>).
If set to <code>NULL</code>, empty placeholder files are saved for
every document that could be saved. Default is
<code>"prot|sample|statist|sap_|p1ar|p2ars|ctalett|lay|^[0-9]+ "</code>.
Used with &quot;CTGOV&quot;, &quot;CTGOV2&quot;, &quot;ISRCTN&quot; and &quot;CTIS&quot; (but not &quot;EUCTR&quot;,
for which all available documents are saved in any case).</p>
</td></tr>
<tr><td><code id="ctrLoadQueryIntoDb_+3A_annotation.text">annotation.text</code></td>
<td>
<p>Text to be including into the field
&quot;annotation&quot; in the records retrieved with the query
that is to be loaded into the collection.
The contents of the field &quot;annotation&quot; for a trial record
are preserved e.g. when running this function again and
loading a record of a with an annotation, see parameter
<code>annotation.mode</code>.</p>
</td></tr>
<tr><td><code id="ctrLoadQueryIntoDb_+3A_annotation.mode">annotation.mode</code></td>
<td>
<p>One of &quot;append&quot; (default), &quot;prepend&quot;
or &quot;replace&quot; for new annotation.text with respect to any
existing annotation for the records retrieved with the query
that is to be loaded into the collection.</p>
</td></tr>
<tr><td><code id="ctrLoadQueryIntoDb_+3A_only.count">only.count</code></td>
<td>
<p>Set to <code>TRUE</code> to return only the
number of trial records found in the register for the query.
Does not load trial information into the database.
Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="ctrLoadQueryIntoDb_+3A_con">con</code></td>
<td>
<p>A connection object, see section
'Databases' in <a href="#topic+ctrdata">ctrdata</a>.</p>
</td></tr>
<tr><td><code id="ctrLoadQueryIntoDb_+3A_verbose">verbose</code></td>
<td>
<p>Printing additional information if set to
<code>TRUE</code>; default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="ctrLoadQueryIntoDb_+3A_...">...</code></td>
<td>
<p>Do not use (capture deprecated parameters).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with elements
'n' (number of trial records newly imported or updated),
&lsquo;success' (a vector of _id&rsquo;s of successfully loaded records),
'failed' (a vector of identifiers of records that failed to load)
and 'queryterm' (the query term used).
The returned list has several attributes (including database and
collection name, as well as the query history of this database
collection) to facilitate documentation.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

dbc &lt;- nodbi::src_sqlite(collection = "my_collection")

# Retrieve protocol- and results-related information
# on two specific trials identified by their EU number
ctrLoadQueryIntoDb(
  queryterm = "2005-001267-63+OR+2008-003606-33",
  register = "EUCTR",
  euctrresults = TRUE,
  con = dbc
)

# Retrieve all information on about 2,000 ongoing
# interventional cancer trials involving children
# into the same collection as used before
ctrLoadQueryIntoDb(
  queryterm = "cancer&amp;recr=Open&amp;type=Intr&amp;age=0",
  register = "CTGOV",
  con = dbc
)

# Retrieve all information on more than 40 trials
# that are labelled as phase 3 and that mention
# either neuroblastoma or lymphoma from ISRCTN,
# into the same collection as used before
ctrLoadQueryIntoDb(
  queryterm = paste0(
    "https://www.isrctn.com/search?",
    "q=neuroblastoma+OR+lymphoma&amp;filters=phase%3APhase+III"),
  con = dbc
)

# Retrieve all information on completed trials in CTIS
ctrLoadQueryIntoDb(
  queryterm = "https://euclinicaltrials.eu/app/#/search?status=Ended",
  con = dbc
)

## End(Not run)

</code></pre>

<hr>
<h2 id='ctrOpenSearchPagesInBrowser'>Open reigster to show query results or search page</h2><span id='topic+ctrOpenSearchPagesInBrowser'></span>

<h3>Description</h3>

<p>Open advanced search pages of register(s), or execute search in browser
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ctrOpenSearchPagesInBrowser(url = "", register = "", copyright = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ctrOpenSearchPagesInBrowser_+3A_url">url</code></td>
<td>
<p>of search results page to show in the browser. To open the
browser with a previous search, the output of <a href="#topic+ctrGetQueryUrl">ctrGetQueryUrl</a>
or <a href="#topic+dbQueryHistory">dbQueryHistory</a> can be used. Can be left as empty string
(default) to open the advanced search page of <code>register</code>.</p>
</td></tr>
<tr><td><code id="ctrOpenSearchPagesInBrowser_+3A_register">register</code></td>
<td>
<p>Register(s) to open, &quot;EUCTR&quot;, &quot;CTGOV&quot;, &quot;CTGOV2&quot;,
&quot;ISRCTN&quot; or &quot;CTIS&quot;. Default is empty string, and this open the
advanced search page of the register(s).</p>
</td></tr>
<tr><td><code id="ctrOpenSearchPagesInBrowser_+3A_copyright">copyright</code></td>
<td>
<p>(Optional) If set to <code>TRUE</code>, opens only the
copyright pages of all registers.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>(String) Full URL corresponding to the shortened <code>url</code>
in conjunction with <code>register</code> if any, or invisibly
<code>TRUE</code> if no <code>url</code> is specified.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Open all and check copyrights before using registers
ctrOpenSearchPagesInBrowser(copyright = TRUE)

# Open specific register advanced search page
ctrOpenSearchPagesInBrowser(register = "CTGOV")
ctrOpenSearchPagesInBrowser(register = "CTGOV2")
ctrOpenSearchPagesInBrowser(register = "CTIS")
ctrOpenSearchPagesInBrowser(register = "EUCTR")
ctrOpenSearchPagesInBrowser(register = "ISRCTN")
ctrOpenSearchPagesInBrowser(url = "status=Ended", register = "CTIS")

# Open all queries that were loaded into demo collection
dbc &lt;- nodbi::src_sqlite(
    dbname = system.file("extdata", "demo.sqlite", package = "ctrdata"),
    collection = "my_trials"
)

dbh &lt;- dbQueryHistory(
    con = dbc
)

for (r in seq_len(nrow(dbh))) {
    ctrOpenSearchPagesInBrowser(dbh[r, ])
}

</code></pre>

<hr>
<h2 id='dbFindFields'>Find names of fields in the database collection</h2><span id='topic+dbFindFields'></span>

<h3>Description</h3>

<p>Given part of the name of a field of interest to the user, this
function returns the full field names used in records that were
previously loaded into a collection
(using <a href="#topic+ctrLoadQueryIntoDb">ctrLoadQueryIntoDb</a>). Only names of fields that have
a value in the collection can be returned.
Set <code>sample = FALSE</code> to force screening all records in the
collection for field names, see below.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dbFindFields(namepart = ".*", con, sample = TRUE, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dbFindFields_+3A_namepart">namepart</code></td>
<td>
<p>A character string (can be a regular expression,
including Perl-style) to be searched among all field names (keys)
in the collection, case-insensitive. The default '&quot;.*&quot;' lists all fields.</p>
</td></tr>
<tr><td><code id="dbFindFields_+3A_con">con</code></td>
<td>
<p>A connection object, see section
'Databases' in <a href="#topic+ctrdata">ctrdata</a>.</p>
</td></tr>
<tr><td><code id="dbFindFields_+3A_sample">sample</code></td>
<td>
<p>If <code>TRUE</code> (default), uses a sample of only 5 trial
records per register to identify fields, to rapidly return a possibly
incomplete set of field names.
If <code>FALSE</code>, uses all trial records in the collection, which will
take more time with more trials but ensures to returns all names of
all fields in the collection.</p>
</td></tr>
<tr><td><code id="dbFindFields_+3A_verbose">verbose</code></td>
<td>
<p>If <code>TRUE</code>, prints additional information
(default <code>FALSE</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The full names of child fields are returned in dot notation (e.g.,
<code>clinical_results.outcome_list.outcome.measure.class_list.class.title</code>)
In addition, names of parent fields (e.g.,
<code>clinical_results</code>) are returned.
Data in parent fields is typically complex (nested), see
<a href="#topic+dfTrials2Long">dfTrials2Long</a> for easily handling it.
For field definitions of the registers, see
&quot;Definition&quot; in <a href="#topic+ctrdata-registers">ctrdata-registers</a>.
Note: When <code>dbFindFields</code> is first called after
<a href="#topic+ctrLoadQueryIntoDb">ctrLoadQueryIntoDb</a>, it will take a moment.
</p>


<h3>Value</h3>

<p>Vector of strings with full names of field(s) found,
ordered by register and alphabet, see examples. Names of the vector
are the names of the register holding the respective fields. The field
names can be fed into <a href="#topic+dbGetFieldsIntoDf">dbGetFieldsIntoDf</a> to extract the
data for the field(s) from the collection into a data frame.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
dbc &lt;- nodbi::src_sqlite(
    dbname = system.file("extdata", "demo.sqlite", package = "ctrdata"),
    collection = "my_trials"
)

dbFindFields(namepart = "date", con = dbc)[1:5]

# view all 3350+ fields from all registers:

allFields &lt;- dbFindFields(con = dbc, sample = FALSE)

if (interactive()) View(data.frame(
  register = names(allFields),
  field = allFields))

</code></pre>

<hr>
<h2 id='dbFindIdsUniqueTrials'>Get identifiers of deduplicated trial records</h2><span id='topic+dbFindIdsUniqueTrials'></span>

<h3>Description</h3>

<p>Records for a clinical trial can be loaded from more than one
register into a collection. This function returns deduplicated
identifiers for all trials in the collection, respecting the
register(s) preferred by the user. All registers are recording
identifiers also from other registers, which are used by this
function to provide a vector of identifiers of deduplicated trials.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dbFindIdsUniqueTrials(
  preferregister = c("EUCTR", "CTGOV", "CTGOV2", "ISRCTN", "CTIS"),
  prefermemberstate = "DE",
  include3rdcountrytrials = TRUE,
  con,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dbFindIdsUniqueTrials_+3A_preferregister">preferregister</code></td>
<td>
<p>A vector of the order of preference for
registers from which to generate unique _id's, default
<code>c("EUCTR", "CTGOV", "CTGOV2", "ISRCTN", "CTIS")</code></p>
</td></tr>
<tr><td><code id="dbFindIdsUniqueTrials_+3A_prefermemberstate">prefermemberstate</code></td>
<td>
<p>Code of single EU Member State for which records
should returned. If not available, a record for DE or lacking this, any
random Member State's record for the trial will be returned.
For a list of codes of EU  Member States, please see vector
<code>countriesEUCTR</code>. Specifying &quot;3RD&quot; will return the Third Country
record of trials, where available.</p>
</td></tr>
<tr><td><code id="dbFindIdsUniqueTrials_+3A_include3rdcountrytrials">include3rdcountrytrials</code></td>
<td>
<p>A logical value if trials should be retained
that are conducted exclusively in third countries, that is, outside
the European Union. Ignored if <code>prefermemberstate</code> is set to &quot;3RD&quot;.</p>
</td></tr>
<tr><td><code id="dbFindIdsUniqueTrials_+3A_con">con</code></td>
<td>
<p>A connection object, see section
'Databases' in <a href="#topic+ctrdata">ctrdata</a>.</p>
</td></tr>
<tr><td><code id="dbFindIdsUniqueTrials_+3A_verbose">verbose</code></td>
<td>
<p>If <code>TRUE</code>, prints out the fields of registers used to
find corresponding trial records</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that the content of records may differ between registers
(and, for &quot;EUCTR&quot;, between records for different Member States).
Such differences are not considered by this function.
</p>


<h3>Value</h3>

<p>A named vector with strings of keys (field &quot;_id&quot;) of
records in the collection that represent unique trials, where
names correspond to the register of the record.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
dbc &lt;- nodbi::src_sqlite(
    dbname = system.file("extdata", "demo.sqlite", package = "ctrdata"),
    collection = "my_trials"
)

dbFindIdsUniqueTrials(con = dbc)

</code></pre>

<hr>
<h2 id='dbGetFieldsIntoDf'>Create data frame of specified fields from database collection</h2><span id='topic+dbGetFieldsIntoDf'></span>

<h3>Description</h3>

<p>Fields in the collection are retrieved from all records into a data
frame (or tibble). Within a given trial record, a fields can be
hierarchical and structured, that is, nested.
Th function uses the field names to appropriately type the values
that it returns, harmonising original values (e.g. &quot;Information not present
in EudraCT&quot; to 'NA', &quot;Yes&quot; to 'TRUE', &quot;false&quot; to 'FALSE',
date strings to dates or time differences, number strings to numbers).
The function simplifies the structure of nested data and
may concatenate multiple strings in a field using &quot; / &quot; (see example)
and may have widened the returned data frame with additional columns that
were recursively expanded from simply nested data (e.g., &quot;externalRefs&quot;
to columns &quot;externalRefs.doi&quot;, &quot;externalRefs.eudraCTNumber&quot; etc.).
For an alternative way for handling the complex nested data, see
<a href="#topic+dfTrials2Long">dfTrials2Long</a> followed by <a href="#topic+dfName2Value">dfName2Value</a> for extracting
the sought variable(s).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dbGetFieldsIntoDf(fields = "", con, verbose = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dbGetFieldsIntoDf_+3A_fields">fields</code></td>
<td>
<p>Vector of one or more strings, with names of sought fields.
See function <a href="#topic+dbFindFields">dbFindFields</a> for how to find names of fields.
Dot path notation (&quot;field.subfield&quot;) without indices is supported.
If compatibility with 'nodbi::src_postgres()' is needed, specify fewer
than 50 fields, consider also using parent fields e.g., '&quot;a.b&quot;' instead
of 'c(&quot;a.b.c.d&quot;, &quot;a.b.c.e&quot;)', accessing sought fields with
<a href="#topic+dfTrials2Long">dfTrials2Long</a> followed by <a href="#topic+dfName2Value">dfName2Value</a> or other R functions.</p>
</td></tr>
<tr><td><code id="dbGetFieldsIntoDf_+3A_con">con</code></td>
<td>
<p>A connection object, see section
'Databases' in <a href="#topic+ctrdata">ctrdata</a>.</p>
</td></tr>
<tr><td><code id="dbGetFieldsIntoDf_+3A_verbose">verbose</code></td>
<td>
<p>Printing additional information if set to <code>TRUE</code>;
(default <code>FALSE</code>).</p>
</td></tr>
<tr><td><code id="dbGetFieldsIntoDf_+3A_...">...</code></td>
<td>
<p>Do not use (captures deprecated parameter <code>stopifnodata</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame (or tibble, if <code>tibble</code> is loaded)
with columns corresponding to the sought fields.
A column for the records' '_id' will always be included.
The maximum number of rows of the returned data frame is equal to,
or less than the number of trial records in the database collection.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
dbc &lt;- nodbi::src_sqlite(
   dbname = system.file("extdata", "demo.sqlite", package = "ctrdata"),
   collection = "my_trials")

# get fields that are nested within another field
# and can have multiple values with the nested field
dbGetFieldsIntoDf(
  fields = "b1_sponsor.b31_and_b32_status_of_the_sponsor",
  con = dbc)

# fields that are lists of string values are
# returned by concatenating values with a slash
dbGetFieldsIntoDf(
  fields = "keyword",
  con = dbc)

</code></pre>

<hr>
<h2 id='dbQueryHistory'>Show history of queries loaded into a database collection</h2><span id='topic+dbQueryHistory'></span>

<h3>Description</h3>

<p>Show history of queries loaded into a database collection
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dbQueryHistory(con, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dbQueryHistory_+3A_con">con</code></td>
<td>
<p>A connection object, see section
'Databases' in <a href="#topic+ctrdata">ctrdata</a>.</p>
</td></tr>
<tr><td><code id="dbQueryHistory_+3A_verbose">verbose</code></td>
<td>
<p>If <code>TRUE</code>, prints additional information
(default <code>FALSE</code>).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame (or tibble, if <code>tibble</code> is loaded)
with columns: 'query-timestamp', 'query-register',
'query-records' (note: this is the number of records loaded when last
executing <a href="#topic+ctrLoadQueryIntoDb">ctrLoadQueryIntoDb</a>, not the total record number) and
'query-term', with one row for each time that
<a href="#topic+ctrLoadQueryIntoDb">ctrLoadQueryIntoDb</a> loaded trial records into this collection.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
dbc &lt;- nodbi::src_sqlite(
    dbname = system.file("extdata", "demo.sqlite", package = "ctrdata"),
    collection = "my_trials"
)

dbQueryHistory(con = dbc)

</code></pre>

<hr>
<h2 id='dfMergeVariablesRelevel'>Merge variables, keeping type, and optionally relevel factors</h2><span id='topic+dfMergeVariablesRelevel'></span>

<h3>Description</h3>

<p>Merge variables in a data frame such as returned by <a href="#topic+dbGetFieldsIntoDf">dbGetFieldsIntoDf</a>
into a new variable, and optionally also map its values to new levels.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dfMergeVariablesRelevel(df = NULL, colnames = "", levelslist = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dfMergeVariablesRelevel_+3A_df">df</code></td>
<td>
<p>A <a href="base.html#topic+data.frame">data.frame</a> with the variables (columns) to be merged into
one vector.</p>
</td></tr>
<tr><td><code id="dfMergeVariablesRelevel_+3A_colnames">colnames</code></td>
<td>
<p>A vector of names of columns in 'df' that hold the variables
to be merged, or a selection of columns as per <code><a href="dplyr.html#topic+select">select</a></code>.</p>
</td></tr>
<tr><td><code id="dfMergeVariablesRelevel_+3A_levelslist">levelslist</code></td>
<td>
<p>A names list with one slice each for a new value to be
used for a vector of old values (optional).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector, with the type of the columns to be merged
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
dbc &lt;- nodbi::src_sqlite(
    dbname = system.file("extdata", "demo.sqlite", package = "ctrdata"),
    collection = "my_trials"
)

df &lt;- dbGetFieldsIntoDf(
    fields = c("overall_status", "x5_trial_status"),
    con = dbc
)

statusvalues &lt;- list(
    "ongoing" = c("Recruiting", "Active", "Ongoing"),
    "completed" = c("Completed", "Prematurely Ended", "Terminated"),
    "other" = c("Withdrawn", "Suspended", "No longer available")
)

dfMergeVariablesRelevel(
    df = df,
    colnames = 'contains("status")',
    levelslist = statusvalues
)

</code></pre>

<hr>
<h2 id='dfName2Value'>Get value for variable of interest</h2><span id='topic+dfName2Value'></span>

<h3>Description</h3>

<p>Get information for variable of interest  (e.g., clinical endpoints)
from long data frame of protocol- or result-related trial information
as returned by <a href="#topic+dfTrials2Long">dfTrials2Long</a>.
Parameters 'valuename', 'wherename' and 'wherevalue' are
matched using Perl regular expressions and ignoring case.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dfName2Value(df, valuename = "", wherename = "", wherevalue = "")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dfName2Value_+3A_df">df</code></td>
<td>
<p>A data frame (or tibble) with four columns ('_id',
'identifier', 'name', 'value') as returned by
<a href="#topic+dfTrials2Long">dfTrials2Long</a></p>
</td></tr>
<tr><td><code id="dfName2Value_+3A_valuename">valuename</code></td>
<td>
<p>A character string for the name of the field
that holds the value of the variable of interest
(e.g., a summary measure such as &quot;endPoints.*tendencyValue.value&quot;)</p>
</td></tr>
<tr><td><code id="dfName2Value_+3A_wherename">wherename</code></td>
<td>
<p>(optional) A character string to identify the
variable of interest among those that repeatedly occur in a
trial record (e.g., &quot;endPoints.endPoint.title&quot;)</p>
</td></tr>
<tr><td><code id="dfName2Value_+3A_wherevalue">wherevalue</code></td>
<td>
<p>(optional) A character string with the value of
the variable identified by 'wherename' (e.g., &quot;response&quot;)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame (or tibble, if <code>tibble</code> is loaded)
that includes the values of interest, with columns
'_id', 'identifier', 'name', 'value' (and 'where', with the
contents of 'wherevalue' found at 'wherename').
Contents of 'value' are strings unless all its elements
are numbers. The 'identifier' is generated by function
<a href="#topic+dfTrials2Long">dfTrials2Long</a> to identify matching elements, e.g.
endpoint descriptions and measurements.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
dbc &lt;- nodbi::src_sqlite(
    dbname = system.file("extdata", "demo.sqlite", package = "ctrdata"),
    collection = "my_trials"
)

dfwide &lt;- dbGetFieldsIntoDf(
    fields = c(
        ## ctgov - typical results fields
        # "clinical_results.baseline.analyzed_list.analyzed.count_list.count",
        # "clinical_results.baseline.group_list.group",
        # "clinical_results.baseline.analyzed_list.analyzed.units",
        "clinical_results.outcome_list.outcome",
        "study_design_info.allocation",
        ## euctr - typical results fields
        # "trialInformation.fullTitle",
        # "baselineCharacteristics.baselineReportingGroups.baselineReportingGroup",
        # "trialChanges.hasGlobalInterruptions",
        # "subjectAnalysisSets",
        # "adverseEvents.seriousAdverseEvents.seriousAdverseEvent",
        "endPoints.endPoint",
        "subjectDisposition.recruitmentDetails"
    ), con = dbc
)

dflong &lt;- dfTrials2Long(df = dfwide)

## get values for the endpoint 'response'
dfName2Value(
    df = dflong,
    valuename = paste0(
        "clinical_results.*measurement.value|",
        "clinical_results.*outcome.measure.units|",
        "endPoints.endPoint.*tendencyValue.value|",
        "endPoints.endPoint.unit"
    ),
    wherename = paste0(
        "clinical_results.*outcome.measure.title|",
        "endPoints.endPoint.title"
    ),
    wherevalue = "response"
)

</code></pre>

<hr>
<h2 id='dfTrials2Long'>Convert data frame with trial records into long format</h2><span id='topic+dfTrials2Long'></span>

<h3>Description</h3>

<p>The function works with procotol- and results- related information.
It converts lists and other values that are in a data frame returned
by <a href="#topic+dbGetFieldsIntoDf">dbGetFieldsIntoDf</a> into individual rows of a long data frame.
From the resulting long data frame, values of interest can be selected
using <a href="#topic+dfName2Value">dfName2Value</a>.
The function is particularly useful for fields with complex content,
such as node field &quot;<code>clinical_results</code>&quot; from EUCTR, for which
<a href="#topic+dbGetFieldsIntoDf">dbGetFieldsIntoDf</a> returns as a multiply nested list and for
which this function then converts every observation of every (leaf)
field into a row of its own.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dfTrials2Long(df)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dfTrials2Long_+3A_df">df</code></td>
<td>
<p>Data frame (or tibble) with columns including
the trial identifier (<code>_id</code>) and
one or more variables as obtained from
<a href="#topic+dbGetFieldsIntoDf">dbGetFieldsIntoDf</a></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame  (or tibble, if <code>tibble</code> is loaded)
with the four columns: '_id', 'identifier', 'name', 'value'
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
dbc &lt;- nodbi::src_sqlite(
   dbname = system.file("extdata", "demo.sqlite", package = "ctrdata"),
   collection = "my_trials")

dfwide &lt;- dbGetFieldsIntoDf(
  fields = "clinical_results.participant_flow",
  con = dbc)

dfTrials2Long(df = dfwide)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
