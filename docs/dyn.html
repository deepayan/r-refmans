<!DOCTYPE html><html><head><title>Help for package dyn</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {dyn}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#dyn-package'>
<p>Time Series Regression</p></a></li>
<li><a href='#baltimore'><p>Baltimore energy data</p></a></li>
<li><a href='#dyn'><p> dynamic regression class</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>0.2-9.6</td>
</tr>
<tr>
<td>Date:</td>
<td>2018-03-18</td>
</tr>
<tr>
<td>Title:</td>
<td>Time Series Regression</td>
</tr>
<tr>
<td>Author:</td>
<td>G. Grothendieck</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>M. Leeds &lt;markleeds2@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Time series regression.  The dyn class interfaces ts,
        irts(), zoo() and zooreg() time series classes to lm(), glm(),
        loess(), quantreg::rq(), MASS::rlm(), MCMCpack::MCMCregress(),
        quantreg::rq(), randomForest::randomForest() and other regression
        functions allowing those functions to be used with time series
        including specifications that may contain lags, diffs and
        missing values.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.6.0), zoo (&ge; 1.0-0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>lattice, MASS, MCMCpack, quantreg (&ge; 3.82), randomForest,
sandwich, tseries</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL]</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2018-03-19 05:44:27 UTC; home</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2018-03-19 06:14:06 UTC</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
</table>
<hr>
<h2 id='dyn-package'>
Time Series Regression
</h2><span id='topic+dyn-package'></span>

<h3>Description</h3>

<p>Time series regression.  The dyn class interfaces ts,
irts, its, zoo and zooreg time series classes to lm, glm,
loess, quantreg::rq, MASS::rlm, quantreg::rq,
randomForest::randomForest and other regression functions
allowing those functions to be used with time series including
specifications that may contain lags, diffs and missing
values.  
</p>


<h3>Details</h3>

<p><code>"dyn"</code> allows one to use time series with regression functions
that were not originally written to support time series by simply
prefacing the call to the regression function with <code>"dyn$"</code>.  The 
following are sources of information on <code>"dyn"</code>:
</p>

<table>
<tr>
 <td style="text-align: left;">
Overview</td><td style="text-align: left;"> file.show(system.file("README", package = "dyn"))</td>
</tr>
<tr>
 <td style="text-align: left;">
News</td><td style="text-align: left;"> RShowDoc("NEWS", package = "dyn")</td>
</tr>
<tr>
 <td style="text-align: left;">
Acknowledgements</td><td style="text-align: left;"> RShowDoc("THANKS", package = "dyn")</td>
</tr>
<tr>
 <td style="text-align: left;">
Wish List</td><td style="text-align: left;"> RShowDoc("WISHLIST", package = "dyn")</td>
</tr>
<tr>
 <td style="text-align: left;">
License</td><td style="text-align: left;"> RShowDoc("COPYING", package = "dyn")</td>
</tr>
<tr>
 <td style="text-align: left;">
Citation</td><td style="text-align: left;"> citation(package = "dyn")</td>
</tr>
<tr>
 <td style="text-align: left;">
List of all demo files</td><td style="text-align: left;"> demo(package = "dyn"))</td>
</tr>
<tr>
 <td style="text-align: left;">
Invoking a demo file</td><td style="text-align: left;"> demo("dyn-rq")</td>
</tr>
<tr>
 <td style="text-align: left;">
Source of demo file</td><td style="text-align: left;"> file.show(system.file("dyn-rq.R", package = "dyn"))</td>
</tr>
<tr>
 <td style="text-align: left;">
This File</td><td style="text-align: left;"> package?dyn</td>
</tr>
<tr>
 <td style="text-align: left;">
Help file</td><td style="text-align: left;"> ?dyn</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- ts(seq(10)^2)
dyn$lm(x ~ lag(x,-1))
dyn$glm(x ~ lag(x,-1))
dyn$loess(x ~ lag(x,-1))
</code></pre>

<hr>
<h2 id='baltimore'>Baltimore energy data</h2><span id='topic+baltimore'></span>

<h3>Description</h3>

<p>Heating costs for a home in Baltimore.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(baltimore)</code></pre>


<h3>Format</h3>

<p>The data set is a zoo series with a &quot;Date&quot; class time index
and 6 numeric numeric columns.
</p>

<table>
<tr>
 <td style="text-align: left;">
start</td><td style="text-align: left;"> date of start of billing period</td>
</tr>
<tr>
 <td style="text-align: left;">
therms</td><td style="text-align: left;"> integer number of therms used in this billing period</td>
</tr>
<tr>
 <td style="text-align: left;">
gas</td><td style="text-align: left;"> Total cost of gas (including delivery and commodity charges) for
natural gas</td>
</tr>
<tr>
 <td style="text-align: left;">
KWHs</td><td style="text-align: left;"> integer number of KWH used in this billing period</td>
</tr>
<tr>
 <td style="text-align: left;">
elect</td><td style="text-align: left;"> Total cost of electricity (including delivery and commodity
charges)</td>
</tr>
<tr>
 <td style="text-align: left;">
temp</td><td style="text-align: left;"> average daily outdoor temperature in degrees Fahrenheit, as
printed on the bill</td>
</tr>
<tr>
 <td style="text-align: left;">
days</td><td style="text-align: left;"> number of days in billing period.
</td>
</tr>

</table>



<h3>Details</h3>

<p>Heating system is a 10-15 year old natural gas steam boiler supplying
iron radiators. Hot water heater, clothes dryer and stove and oven are
also natural gas. Air conditioning is by various numbers of window
units. If surface area of house is desired, I can add this at a later
time.
</p>
<p>Some interesting points in time:
</p>

<table>
<tr>
 <td style="text-align: left;">
22-Apr-04</td><td style="text-align: left;"> Date when house was upgraded 2 failed, older storm windows to more
modern ones.</td>
</tr>
<tr>
 <td style="text-align: left;">
1-Sep-04</td><td style="text-align: left;"> Date when house was upgraded 4 failed, older storm windows to more
modern ones. Interesting question: Did upgrading the windows
significantly change the heat loss?</td>
</tr>
<tr>
 <td style="text-align: left;">
last week of July 1999</td><td style="text-align: left;"> Spouse moved in; both adults absent during the
work day, setback thermostat used. Interesting question: Is there a
discernable difference in the energy costs for heating between a single
person and a couple? What's the heating "cost" of adding a spouse or
roommate?</td>
</tr>
<tr>
 <td style="text-align: left;">
18-Dec-2005</td><td style="text-align: left;"> Brought home son; spouse and son home during the day,
setback thermostat no longer used. Interesting question: What's the
"cost" of adding a child?</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Examples</h3>

<pre><code class='language-R'>library(lattice)
data(baltimore)
xyplot(baltimore)
cor(baltimore)
xyplot(elect + gas ~ temp, 
	data = as.data.frame(baltimore), pch = 20, auto.key = TRUE)
</code></pre>

<hr>
<h2 id='dyn'> dynamic regression class </h2><span id='topic+dyn'></span><span id='topic++24.dyn'></span><span id='topic+model.frame.dyn'></span><span id='topic+model.frame.irts'></span><span id='topic+model.frame.its'></span><span id='topic+model.frame.ts'></span><span id='topic+model.frame.zoo'></span><span id='topic+model.frame.zooreg'></span><span id='topic+model.matrix.dyn'></span><span id='topic+predict.dyn'></span><span id='topic+predict.ts'></span><span id='topic+predict.zoo'></span><span id='topic+fitted.dyn'></span><span id='topic+fitted.ts'></span><span id='topic+fitted.zoo'></span><span id='topic+residuals.dyn'></span><span id='topic+residuals.ts'></span><span id='topic+residuals.zoo'></span><span id='topic+update.dyn'></span><span id='topic+anova.dyn'></span><span id='topic+fitted.irts'></span><span id='topic+fitted.its'></span><span id='topic+fitted.zooreg'></span><span id='topic+predict.irts'></span><span id='topic+predict.its'></span><span id='topic+predict.zooreg'></span><span id='topic+residuals.irts'></span><span id='topic+residuals.its'></span><span id='topic+residuals.zooreg'></span>

<h3>Description</h3>

<p>dyn is used to construct objects of class <code>"dyn"</code> 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dyn(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dyn_+3A_x">x</code></td>
<td>
<p> an object, typically a <code>"formula"</code> object or
an object produced by <code>"lm"</code>, <code>"glm"</code> or other
regression function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>"dyn"</code> enables regression functions that were not written to handle
time series to handle them.  Both the dependent and independent variables
may be time series and they may have different time indexes (in which 
case they are automatically aligned). The time series may also have
missing values including internal missing values. 
</p>
<p><code>"dyn"</code> currently works with any regression function that makes
use of <code>"model.frame"</code> and is written in the style of <code>"lm"</code>.
This includes <code>"lm"</code>, <code>"glm"</code>, <code>"loess"</code>, <code>"rlm"</code>
(from <span class="pkg">&quot;MASS&quot;</span>), <code>"lqs"</code> (from <span class="pkg">&quot;MASS&quot;</span>), <code>"MCMCregress"</code>
(from <span class="pkg">&quot;MCMCpack&quot;</span>), <code>"randomForest"</code>
(from <span class="pkg">&quot;randomForest&quot;</span>), <code>"rq"</code> (from <span class="pkg">&quot;quantreg&quot;</span>) and
others.  The time series objects can
be one of the following classes: <code>"ts"</code>, <code>"irts"</code>,
<code>"its"</code>, <code>"zoo"</code> or <code>"zooreg"</code>.   
</p>
<p>Typically <code>"dyn"</code> is used like this <code>"dyn$lm(y ~ lag(y, -1))"</code>.  
That is, one prepends the usual <code>"lm"</code> or other regression function
with <code>"dyn$"</code> and then uses time series including <code>"lag"</code>
and <code>"diff"</code> operators in the formula.   
The returned object has a class vector beginning with
<code>"dyn"</code> and includes all classes that it would have had
without <code>"dyn"</code>.  <code>"dyn"</code> methods include
<code>"model.frame"</code>, <code>"fitted"</code>,
<code>"residuals"</code>, <code>"predict"</code>, <code>"update"</code>, <code>"anova"</code>
and <code>"$"</code> methods. 
These methods preprocess their arguments, 
call the real method which does the actual work
and then post process the returned object.  In the case of <code>"fitted"</code>,
<code>"residuals"</code> and <code>"predict"</code> they ensure that the result is
a time series.  In the case of <code>anova</code> the times of the objects are
intersected so that they all have the same time indexes
to ensure that a comparable input is provided to <code>"anova"</code>.
</p>


<h3>Value</h3>

<p><code>"dyn"</code> returns its argument with the class name <code>"dyn"</code>
prepended to its class vector.  The <code>"fitted"</code>, <code>"residuals"</code>
and <code>"predict"</code> <code>"dyn"</code> methods return time series of the
appropriate class.  <code>"model.frame"</code> creates a model frame with
an attribute of <code>"series"</code> that contains a data frame of 
the time series and factor variables as columns. <code>"model.matrix"</code>
returns a model matrix of class <code>"matrix"</code>.
</p>


<h3>Note</h3>

<p><code>"dyn"</code> relies on the underlying time series classes
and regression routines for all substantive functionality.
In particular note these limitations: <code>"irts"</code> has no
<code>"lag"</code> or <code>"diff"</code> methods.  The lag function of
<code>"its"</code> is called <code>"lagIts"</code>.  <code>"ts"</code> and
<code>"zooreg"</code> series can be lagged outside of the data
range (both forward and backward) but other time series
classes cannot represent such data and therefore will drop them.
If the regression function in question does not have an
associated <code>"fitted"</code>, <code>"residuals"</code>, etc. method
then such method will not be available with <code>"dyn"</code> either.  
</p>
<p>Internally the system uses <code>"zoo"</code>.  Additional time series 
classes not already defined to work with <code>"dyn"</code>
can be added by simply defining <code>"as"</code> methods between
the new class and <code>"zoo"</code> and then creating new methods (for 
<code>"model.frame"</code>, <code>"predict"</code>, <code>"fitted"</code>, etc.)
In most cases these method names can be set equal to the
corresponding <code>"zoo"</code> method name (e.g. 
<code>"model.frame.newclass &lt;- model.frame.zoo"</code> so that
no new function bodies need be written).
</p>
<p>The main requirements for new regression routines to work with
<code>"dyn"</code> are that they use <code>"model.frame"</code>, that their
<code>"fitted"</code>, <code>"residuals"</code> and <code>"predict"</code> methods
return named vectors whose names are the corresponding indexes
in the original data and that they follow the same style of
processing as <code>"lm"</code>.  There is no <code>"dyn"</code> code
specific to any particular regression routine.
</p>
<p><code>"dyn$lm(formula, ...)"</code> is equivalent to 
<code>"dyn(lm(dyn(formula), ...))"</code> (where <code>"formula"</code> is assumed
to be the first argument)
but is easier to write.  When <code>"dyn"</code> is used with an argument,
as just shown, then its effect is simply to return its argument with
the <code>"dyn"</code> class prepended to the class vector so that further
processing of the result is intercepted by other <code>"dyn"</code> methods.
</p>


<h3>See Also</h3>

<p> See Also
<code><a href="stats.html#topic+model.frame">model.frame</a></code>, 
<code><a href="stats.html#topic+predict">predict</a></code>, 
<code><a href="stats.html#topic+fitted">fitted</a></code>, 
<code><a href="stats.html#topic+residuals">residuals</a></code>, 
<code><a href="stats.html#topic+anova">anova</a></code>, 
<code><a href="stats.html#topic+update">update</a></code>, 
<code><a href="stats.html#topic+lm">lm</a></code>, 
<code><a href="stats.html#topic+glm">glm</a></code>, 
<code><a href="stats.html#topic+loess">loess</a></code> 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>y &lt;- ts(1:12, start = c(2000,2), freq = 4)^3
x &lt;- ts(1:9, start = c(2000,3), freq = 4)^2

# can be used with numerous different regression functions
y.lm &lt;- dyn$lm( window(y, start = c(2000,4)) ~ diff(x) )
y.lm &lt;- dyn$lm( y ~ diff(x) )
y.glm &lt;- dyn$glm( y ~ diff(x) )
y.loess &lt;- dyn$loess( y ~ diff(x) )

y.lm &lt;- dyn(lm(dyn(y ~ diff(x))))  # same
y.lm
summary(y.lm)
residuals(y.lm)
fitted(y.lm)
y2.lm &lt;- update(y.lm, . ~ . + lag(x,-1))
y2.lm
anova(y.lm, y2.lm)

# examples of using data
dyn$lm(y ~ diff(x), list(y = y, x = x))
dyn$lm(y ~ diffx, list(y = y, diffx = diff(x)))

# invoke model.frame on formula as a dyn object
dyn$model.frame( y ~ diff(x) )

# superimpose a loess fit on Nile time series data
plot(Nile)
lines(fitted(dyn$loess(Nile ~ time(Nile))), col = "red")

# lag.zoo can take vector lags
set.seed(1)
yz &lt;- zoo(rnorm(100)); xz &lt;- zoo(rnorm(100))
yz.lm &lt;- dyn$lm(yz ~ lag(xz, 0:-3))


###
# simulate series and then NA out 7:10 and predict them
###

library(dyn)
set.seed(123)
tz &lt;- zoo(cbind(Y = 0, x = rnorm(10), z = rnorm(10)))

# simulate values
for(i in 2:10) {
 tz$Y[i] &lt;- with(as.data.frame(tz), 
	2*Y[i-1] + 3*z[i] +4* x[i] + 5*x[i-1] + rnorm(1))
}

# keep copy of tz to compare later to simulated Y's
tz.orig &lt;- tz

# NA out Y's that are to be predicted
tz[7:10, "Y"] &lt;- NA

L &lt;- function(x, k = 1) lag(x, -k)

# predict 1 ahead each iteration
for(i in 7:10) {
   # fit based on first i-1 values
   fit &lt;- dyn$lm(Y ~ L(Y) + z + L(x, 0:1), tz, subset = seq_len(i-1))
   # get prediction for ith value
   tz[i, "Y"] &lt;- tail(predict(fit, tz[1:i,]), 1)
}
cbind(pred = tz[7:10, "Y"], act = tz.orig[7:10, "Y"])


</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
