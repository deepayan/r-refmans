<!DOCTYPE html><html><head><title>Help for package stratamatch</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {stratamatch}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#%&gt;%'><p>Pipe operator</p></a></li>
<li><a href='#auto_stratify'><p>Auto Stratify</p></a></li>
<li><a href='#build_autostrata'><p>Build Autostrata object</p></a></li>
<li><a href='#check_base_inputs_auto_stratify'><p>Check inputs from auto_stratify</p></a></li>
<li><a href='#check_inputs_manual_stratify'><p>Check inputs to manual_stratify</p></a></li>
<li><a href='#check_inputs_matcher'><p>Check inputs to any matching function</p></a></li>
<li><a href='#check_outcome'><p>Check Outcome</p></a></li>
<li><a href='#check_pilot_set_options'><p>Check Pilot set options</p></a></li>
<li><a href='#check_prognostic_formula'><p>Check Prognostic Formula</p></a></li>
<li><a href='#check_prop_formula'><p>Check Propensity Formula</p></a></li>
<li><a href='#check_scores'><p>Check Scores</p></a></li>
<li><a href='#estimate_scores'><p>Estimate Prognostic Scores</p></a></li>
<li><a href='#extract_cut_points'><p>Extract cutoffs between strata</p></a></li>
<li><a href='#extract_cut_points.auto_strata'><p>Extract cutoffs between strata</p></a></li>
<li><a href='#fit_prognostic_model'><p>Fit Prognostic Model</p></a></li>
<li><a href='#get_issues'><p>Get Issues</p></a></li>
<li><a href='#get_prop_scores'><p>Parse <code>propensity</code> input to obtain propensity scores</p></a></li>
<li><a href='#ICU_data'><p>Demographics and comorbidities of 10,157 ICU patients</p></a></li>
<li><a href='#is_binary'><p>Check if a vector is binary</p></a></li>
<li><a href='#is.auto_strata'><p>Checks <code>auto_strata</code> class</p></a></li>
<li><a href='#is.manual_strata'><p>Checks <code>manual_strata</code> class</p></a></li>
<li><a href='#is.strata'><p>Checks <code>strata</code> class</p></a></li>
<li><a href='#make_ac_plot'><p>Make Assignment-Control plot</p></a></li>
<li><a href='#make_autostrata_table'><p>Make strata table</p></a></li>
<li><a href='#make_hist_plot'><p>Make histogram plot</p></a></li>
<li><a href='#make_issue_table'><p>Make Issue Table</p></a></li>
<li><a href='#make_match_distances'><p>Make match distances within strata</p></a></li>
<li><a href='#make_resid_plot'><p>Make Residual Plot</p></a></li>
<li><a href='#make_sample_data'><p>Make sample data</p></a></li>
<li><a href='#make_SR_plot'><p>Make Size-Ratio plot</p></a></li>
<li><a href='#manual_stratify'><p>Manual Stratify</p></a></li>
<li><a href='#new_auto_strata'><p>New Autostrata</p></a></li>
<li><a href='#new_manual_strata'><p>New Manual Strata</p></a></li>
<li><a href='#plot.auto_strata'><p>Plot method for <code>auto_strata</code> object</p></a></li>
<li><a href='#plot.manual_strata'><p>Plot method for <code>manual_strata</code> object</p></a></li>
<li><a href='#print.auto_strata'><p>Print Auto Strata</p></a></li>
<li><a href='#print.manual_strata'><p>Print Manual Strata</p></a></li>
<li><a href='#split_pilot_set'><p>Split data into pilot and analysis sets</p></a></li>
<li><a href='#strata'><p>Strata function from package Survival</p></a></li>
<li><a href='#strata_match'><p>Strata Match</p></a></li>
<li><a href='#strata_match_nstrat'><p>Match without Stratification</p></a></li>
<li><a href='#stratamatch'><p>stratamatch: stratify and match large data sets</p></a></li>
<li><a href='#summary.strata'><p>Summary for strata object</p></a></li>
<li><a href='#warn_if_continuous'><p>Warn if continuous</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-03-30</td>
</tr>
<tr>
<td>Title:</td>
<td>Stratification and Matching for Large Observational Data Sets</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.9</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Rachael C. Aikens &lt;rockyaikens@gmail.com&gt;</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/raikens1/stratamatch/issues">https://github.com/raikens1/stratamatch/issues</a></td>
</tr>
<tr>
<td>Description:</td>
<td>A pilot matching design to automatically 
    stratify and match large datasets.  The manual_stratify() function allows
    users to manually stratify a dataset based on categorical variables of 
    interest, while the auto_stratify() function does automatically by
    allocating a held-aside (pilot) data set, fitting a prognostic score  
    (see Hansen (2008) &lt;<a href="https://doi.org/10.1093%2Fbiomet%2Fasn004">doi:10.1093/biomet/asn004</a>&gt;) on the pilot set, and stratifying the data set based
    on prognostic score quantiles.  The strata_match() function then does optimal
    matching of the data set in parallel within strata.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr (&ge; 0.8.3), Hmisc (&ge; 4.2-0), magrittr (&ge; 1.5), rlang
(&ge; 0.4.0), survival(&ge; 2.44.1.1)</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.4.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, optmatch (&ge; 0.9-11), rmarkdown, testthat (&ge; 2.1.0),
glmnet (&ge; 4.0), randomForest (&ge; 4.6-14)</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/raikens1/stratamatch">https://github.com/raikens1/stratamatch</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-03-31 00:19:08 UTC; rocky</td>
</tr>
<tr>
<td>Author:</td>
<td>Rachael C. Aikens [aut, cre],
  Joseph Rigdon [aut],
  Justin Lee [aut],
  Michael Baiocchi [aut],
  Jonathan Chen [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-03-31 06:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='+25+26gt+3B+25'>Pipe operator</h2><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>Pipe operator
</p>

<hr>
<h2 id='auto_stratify'>Auto Stratify</h2><span id='topic+auto_stratify'></span>

<h3>Description</h3>

<p>Automatically creates strata for matching based on a prognostic score formula
or a vector of prognostic scores already estimated by the user. Creates a
<code>auto_strata</code> object, which can be passed to <code><a href="#topic+strata_match">strata_match</a></code>
for stratified matching or unpacked by the user to be matched by some other
means.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>auto_stratify(
  data,
  treat,
  prognosis,
  outcome = NULL,
  size = 2500,
  pilot_fraction = 0.1,
  pilot_size = NULL,
  pilot_sample = NULL,
  group_by_covariates = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="auto_stratify_+3A_data">data</code></td>
<td>
<p><code>data.frame</code> with observations as rows, features as columns</p>
</td></tr>
<tr><td><code id="auto_stratify_+3A_treat">treat</code></td>
<td>
<p>string giving the name of column designating treatment
assignment</p>
</td></tr>
<tr><td><code id="auto_stratify_+3A_prognosis">prognosis</code></td>
<td>
<p>information on how to build prognostic scores.  Three
different input types are allowed: </p>
 <ol>
<li><p> vector of prognostic
scores for all individuals in the data set. Should be in the same order as
the rows of <code>data</code>. </p>
</li>
<li><p> a <code>formula</code> for fitting a prognostic
model </p>
</li>
<li><p> an already-fit prognostic score model</p>
</li></ol>
</td></tr>
<tr><td><code id="auto_stratify_+3A_outcome">outcome</code></td>
<td>
<p>string giving the name of column with outcome information.
Required if prognostic_scores is specified.  Otherwise it will be inferred
from prog_formula</p>
</td></tr>
<tr><td><code id="auto_stratify_+3A_size">size</code></td>
<td>
<p>numeric, desired size of strata (default = 2500)</p>
</td></tr>
<tr><td><code id="auto_stratify_+3A_pilot_fraction">pilot_fraction</code></td>
<td>
<p>numeric between 0 and 1 giving the proportion of
controls to be allotted for building the prognostic score (default = 0.1)</p>
</td></tr>
<tr><td><code id="auto_stratify_+3A_pilot_size">pilot_size</code></td>
<td>
<p>alternative to pilot_fraction. Approximate number of
observations to be used in pilot set. Note that the actual pilot set size
returned may not be exactly <code>pilot_size</code> if <code>group_by_covariates</code>
is specified because balancing by covariates may result in deviations from
desired size. If <code>pilot_size</code> is specified, <code>pilot_fraction</code> is
ignored.</p>
</td></tr>
<tr><td><code id="auto_stratify_+3A_pilot_sample">pilot_sample</code></td>
<td>
<p>a data.frame of held aside samples for building
prognostic score model. If <code>pilot_sample</code> is specified,
<code>pilot_size</code> and <code>pilot_fraction</code> are both ignored.</p>
</td></tr>
<tr><td><code id="auto_stratify_+3A_group_by_covariates">group_by_covariates</code></td>
<td>
<p>character vector giving the names of covariates to
be grouped by (optional). If specified, the pilot set will be sampled in a
stratified manner, so that the composition of the pilot set reflects the
composition of the whole data set in terms of these covariates.  The
specified covariates must be categorical.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Stratifying by prognostic score quantiles can be more effective than manually
stratifying a data set because the prognostic score is continuous, thus the
strata produced tend to be of equal size with similar prognosis.
</p>
<p>Automatic stratification requires information on how the prognostic scores
should be derived.  This is primarily determined by the specifciation of the
<code>prognosis</code> argument.  Three main forms of input for <code>prognosis</code>
are allowed: </p>
 <ol>
<li><p> A vector of prognostic scores. This vector
should be the same length and order of the rows in the data set.  If this
method is used, the <code>outcome</code> argument must also be specified; this is
simply a string giving the name of the column which contains outcome
information. </p>
</li>
<li><p> A formula for prognosis (e.g. <code>outcome ~ X1 + X2</code>).
If this method is used, <code>auto_stratify</code> will automatically split the
data set into a <code>pilot_set</code> and an <code>analysis_set</code>.  The pilot set
will be used to fit a logistic regression model for outcome in the absence of
treatment, and this model will be used to estimate prognostic scores on the
analysis set.  The analysis set will then be stratified based on the
estimated prognostic scores.  In this case the <code>outcome</code> argument need
not be specified since it can be inferred from the input formula. </p>
</li>
<li><p> A
model for prognosis (e.g. a <code>glm</code> object).  If this method is used, the
<code>outcome</code> argument must also be specified</p>
</li></ol>



<h3>Value</h3>

<p>Returns an <code>auto_strata</code> object.  This contains: </p>

<ul>
<li> <p><code>outcome</code> - a string giving the name of the column where outcome
information is stored
</p>
</li>
<li> <p><code>treat</code> - a string giving the name of the column encoding
treatment assignment
</p>
</li>
<li> <p><code>analysis_set</code> - the data set with strata assignments
</p>
</li>
<li> <p><code>call</code> - the call to <code>auto_stratify</code> used to generate this
object
</p>
</li>
<li> <p><code>issue_table</code> - a table of each stratum and potential issues of
size and treat:control balance. In small or imbalanced strata, it may be
difficult or infeasible to find high-quality matches, while very large
strata may be computationally intensive to match.
</p>
</li>
<li> <p><code>strata_table</code> - a table of each stratum and the prognostic
score quantile bin to which it corresponds
</p>
</li>
<li> <p><code>prognostic_scores</code> - a vector of prognostic scores.
</p>
</li>
<li> <p><code>prognostic_model</code> - a model for prognosis fit on a pilot data
set.  Will be <code>NULL</code> if a vector of prognostic scores was provided as
the <code>prognosis</code> argument to <code>auto_stratify</code> rather than a model
or formula.
</p>
</li>
<li> <p><code>pilot_set</code> - the set of controls used to fit the prognostic
model. These are excluded from subsequent analysis so that the prognostic
score is not overfit to the data used to estimate the treatment effect.
Will be <code>NULL</code> if a pre-fit model or a vector of prognostic scores was
provided as the <code>prognosis</code> argument to <code>auto_stratify</code> rather
than formula.
</p>
</li></ul>



<h3>Troubleshooting</h3>

<p>This section suggests fixes for common errors that appear while fitting the
prognostic score or using it to estimate prognostic scores on the analysis
set.
</p>

<ul>
<li> <p><code>Encountered an error while fitting the prognostic model...
  numeric probabilities 0 or 1 produced</code>. This error means that the
prognostic model can perfectly separate positive from negative outcomes.
Estimating a treatment effect in this case is unwise since an individual's
baseline characteristics perfectly determine their outcome, regardless of
whether they recieve the treatment.  This error may also appear on rare
occaisions when your pilot set is very small (number of observations
approximately &lt;= number of covariates in the prognostic model), so that
perfect separation happens by chance.
</p>
</li>
<li> <p><code>Encountered an error while estimating prognostic scores ...
  factor X has new levels ... </code> This may indicate that some value(s) of one
or more categorical variables appear in the analysis set which were not
seen in the pilot set. This means that when we try to obtain prognostic
scores for our analysis set, we run into some new value that our prognostic
model was not prepared to handle.  There are a few options we have to
troubleshoot this problem: </p>

<ul>
<li> <p><strong>Rejection sampling.</strong>  Run <code>auto_stratify</code> again with the
same arguments until this error does not occur (i.e. until some
observations with the missing value are randomly selected into the pilot
set)
</p>
</li>
<li> <p><strong>Eliminate this covariate from the prognostic formula.</strong>
</p>
</li>
<li> <p><strong>Remove observations with the rare covariate value from the
entire data set.</strong> Consider carefully how this exclusion might affect your
results.
</p>
</li></ul>
 </li></ul>

<p>Other errors or warnings can occur if the pilot set is too small and the
prognostic formula is too complicated.  Always make sure that the number of
observations in the pilot set is large enough that you can confidently fit
a prognostic model with the number of covariates you want.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+manual_stratify">manual_stratify</a></code>, <code><a href="#topic+new_auto_strata">new_auto_strata</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># make sample data set
set.seed(111)
dat &lt;- make_sample_data(n = 75)

# construct a pilot set, build a prognostic score for `outcome` based on X2
# and stratify the data set based on the scores into sets of about 25
# observations
a.strat_formula &lt;- auto_stratify(dat, "treat", outcome ~ X2, size = 25)

# stratify the data set based on a model for prognosis
pilot_data &lt;- make_sample_data(n = 30)
prognostic_model &lt;- glm(outcome ~ X2, pilot_data, family = "binomial")
a.strat_model &lt;- auto_stratify(dat, "treat", prognostic_model,
  outcome = "outcome", size = 25
)

# stratify the data set based on a vector of prognostic scores
prognostic_scores &lt;- predict(prognostic_model,
  newdata = dat,
  type = "response"
)
a.strat_scores &lt;- auto_stratify(dat, "treat", prognostic_scores,
  outcome = "outcome", size = 25
)

# diagnostic plots
plot(a.strat_formula)
plot(a.strat_formula, type = "AC", propensity = treat ~ X1, stratum = 1)
plot(a.strat_formula, type = "hist", propensity = treat ~ X1, stratum = 1)
plot(a.strat_formula, type = "residual")
</code></pre>

<hr>
<h2 id='build_autostrata'>Build Autostrata object</h2><span id='topic+build_autostrata'></span>

<h3>Description</h3>

<p>Not meant to be called externally. Given the arguments to auto_stratify,
build the prognostic scores and return the analysis set, the prognostic
scores, the pilot set, the prognostic model, and the outcome string.  The
primary function of this code is to determine the type of <code>prognosis</code>
and handle it appropriately.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>build_autostrata(
  data,
  treat,
  prognosis,
  outcome,
  pilot_fraction,
  pilot_size,
  pilot_sample,
  group_by_covariates
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="build_autostrata_+3A_data">data</code></td>
<td>
<p><code>data.frame</code> with observations as rows, features as columns</p>
</td></tr>
<tr><td><code id="build_autostrata_+3A_treat">treat</code></td>
<td>
<p>string giving the name of column designating treatment
assignment</p>
</td></tr>
<tr><td><code id="build_autostrata_+3A_prognosis">prognosis</code></td>
<td>
<p>information on how to build prognostic scores.  Three
different input types are allowed: </p>
 <ol>
<li><p> vector of prognostic
scores for all individuals in the data set. Should be in the same order as
the rows of <code>data</code>. </p>
</li>
<li><p> a <code>formula</code> for fitting a prognostic
model </p>
</li>
<li><p> an already-fit prognostic score model</p>
</li></ol>
</td></tr>
<tr><td><code id="build_autostrata_+3A_outcome">outcome</code></td>
<td>
<p>string giving the name of column with outcome information.
Required if prognostic_scores is specified.  Otherwise it will be inferred
from prog_formula</p>
</td></tr>
<tr><td><code id="build_autostrata_+3A_pilot_fraction">pilot_fraction</code></td>
<td>
<p>numeric between 0 and 1 giving the proportion of
controls to be allotted for building the prognostic score (default = 0.1)</p>
</td></tr>
<tr><td><code id="build_autostrata_+3A_pilot_size">pilot_size</code></td>
<td>
<p>alternative to pilot_fraction. Approximate number of
observations to be used in pilot set. Note that the actual pilot set size
returned may not be exactly <code>pilot_size</code> if <code>group_by_covariates</code>
is specified because balancing by covariates may result in deviations from
desired size. If <code>pilot_size</code> is specified, <code>pilot_fraction</code> is
ignored.</p>
</td></tr>
<tr><td><code id="build_autostrata_+3A_pilot_sample">pilot_sample</code></td>
<td>
<p>a data.frame of held aside samples for building
prognostic score model. If <code>pilot_sample</code> is specified,
<code>pilot_size</code> and <code>pilot_fraction</code> are both ignored.</p>
</td></tr>
<tr><td><code id="build_autostrata_+3A_group_by_covariates">group_by_covariates</code></td>
<td>
<p>character vector giving the names of covariates to
be grouped by (optional). If specified, the pilot set will be sampled in a
stratified manner, so that the composition of the pilot set reflects the
composition of the whole data set in terms of these covariates.  The
specified covariates must be categorical.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of: analysis set, prognostic scores, pilot set, prognostic
model, and outcome string
</p>


<h3>See Also</h3>

<p><code><a href="#topic+auto_stratify">auto_stratify</a></code>
</p>

<hr>
<h2 id='check_base_inputs_auto_stratify'>Check inputs from auto_stratify</h2><span id='topic+check_base_inputs_auto_stratify'></span>

<h3>Description</h3>

<p>Not meant to be called externally.  Throws errors if basic auto_stratify
inputs are incorrect.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_base_inputs_auto_stratify(data, treat, outcome)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_base_inputs_auto_stratify_+3A_data">data</code></td>
<td>
<p><code>data.frame</code> with observations as rows, features as columns</p>
</td></tr>
<tr><td><code id="check_base_inputs_auto_stratify_+3A_treat">treat</code></td>
<td>
<p>string giving the name of column designating treatment
assignment</p>
</td></tr>
<tr><td><code id="check_base_inputs_auto_stratify_+3A_outcome">outcome</code></td>
<td>
<p>string giving the name of column with outcome information.
Required if prognostic_scores is specified.  Otherwise it will be inferred
from prog_formula</p>
</td></tr>
</table>


<h3>Value</h3>

<p>nothing; produces errors and warnings if anything is wrong
</p>

<hr>
<h2 id='check_inputs_manual_stratify'>Check inputs to manual_stratify</h2><span id='topic+check_inputs_manual_stratify'></span>

<h3>Description</h3>

<p>Not meant to be called externally.  Checks validity of formula, types of all inputs to manual stratify, and warns if covariates are continuous.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_inputs_manual_stratify(data, strata_formula, force)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_inputs_manual_stratify_+3A_data">data</code></td>
<td>
<p>data.frame with observations as rows, features as columns</p>
</td></tr>
<tr><td><code id="check_inputs_manual_stratify_+3A_strata_formula">strata_formula</code></td>
<td>
<p>the formula to be used for stratification.  (e.g. <code>treat
~ X1</code>) the variable on the left is taken to be the name of the treatment
assignment column, and the variables on the left are taken to be the
variables by which the data should be stratified</p>
</td></tr>
<tr><td><code id="check_inputs_manual_stratify_+3A_force">force</code></td>
<td>
<p>a boolean. If true, run even if a variable appears continuous.
(default = FALSE)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>nothing; produces errors and warnings if anything is wrong
</p>

<hr>
<h2 id='check_inputs_matcher'>Check inputs to any matching function</h2><span id='topic+check_inputs_matcher'></span>

<h3>Description</h3>

<p>Check inputs to any matching function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_inputs_matcher(object, model, k)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_inputs_matcher_+3A_object">object</code></td>
<td>
<p>a strata object</p>
</td></tr>
<tr><td><code id="check_inputs_matcher_+3A_model">model</code></td>
<td>
<p>(optional) formula for matching.  If left blank, <em>all</em>
columns of the analysis set in <code>object</code> will be used as covariates in
the propensity model or mahalanobis match (except outcome, treatment and
stratum)</p>
</td></tr>
<tr><td><code id="check_inputs_matcher_+3A_k">k</code></td>
<td>
<p>the number of control individuals to be matched to each treated
individual.  If <code>"k = full"</code> is used, fullmatching is done instead of
pairmatching</p>
</td></tr>
</table>


<h3>Value</h3>

<p>nothing
</p>

<hr>
<h2 id='check_outcome'>Check Outcome</h2><span id='topic+check_outcome'></span>

<h3>Description</h3>

<p>Checks that outcome is a string which is a column in the data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_outcome(outcome, data, treat)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_outcome_+3A_outcome">outcome</code></td>
<td>
<p>string giving the name of column with outcome information.
Required if prognostic_scores is specified.  Otherwise it will be inferred
from prog_formula</p>
</td></tr>
<tr><td><code id="check_outcome_+3A_data">data</code></td>
<td>
<p><code>data.frame</code> with observations as rows, features as columns</p>
</td></tr>
<tr><td><code id="check_outcome_+3A_treat">treat</code></td>
<td>
<p>string giving the name of column designating treatment
assignment</p>
</td></tr>
</table>


<h3>Value</h3>

<p>nothing
</p>

<hr>
<h2 id='check_pilot_set_options'>Check Pilot set options</h2><span id='topic+check_pilot_set_options'></span>

<h3>Description</h3>

<p>Check Pilot set options
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_pilot_set_options(
  pilot_fraction,
  pilot_size,
  group_by_covariates,
  data,
  n_c
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_pilot_set_options_+3A_pilot_fraction">pilot_fraction</code></td>
<td>
<p>numeric between 0 and 1 giving the proportion of
controls to be allotted for building the prognostic score (default = 0.1)</p>
</td></tr>
<tr><td><code id="check_pilot_set_options_+3A_pilot_size">pilot_size</code></td>
<td>
<p>alternative to pilot_fraction. Approximate number of
observations to be used in pilot set. Note that the actual pilot set size
returned may not be exactly <code>pilot_size</code> if <code>group_by_covariates</code>
is specified because balancing by covariates may result in deviations from
desired size. If <code>pilot_size</code> is specified, <code>pilot_fraction</code> is
ignored.</p>
</td></tr>
<tr><td><code id="check_pilot_set_options_+3A_group_by_covariates">group_by_covariates</code></td>
<td>
<p>character vector giving the names of covariates to
be grouped by (optional). If specified, the pilot set will be sampled in a
stratified manner, so that the composition of the pilot set reflects the
composition of the whole data set in terms of these covariates.  The
specified covariates must be categorical.</p>
</td></tr>
<tr><td><code id="check_pilot_set_options_+3A_data">data</code></td>
<td>
<p><code>data.frame</code> with observations as rows, features as columns</p>
</td></tr>
<tr><td><code id="check_pilot_set_options_+3A_n_c">n_c</code></td>
<td>
<p>number of control observations in <code>data</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>nothing
</p>

<hr>
<h2 id='check_prognostic_formula'>Check Prognostic Formula</h2><span id='topic+check_prognostic_formula'></span>

<h3>Description</h3>

<p>Check Prognostic Formula
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_prognostic_formula(prog_formula, data, outcome, treat)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_prognostic_formula_+3A_prog_formula">prog_formula</code></td>
<td>
<p>a formula for prognostic score</p>
</td></tr>
<tr><td><code id="check_prognostic_formula_+3A_data">data</code></td>
<td>
<p><code>data.frame</code> with observations as rows, features as columns</p>
</td></tr>
<tr><td><code id="check_prognostic_formula_+3A_outcome">outcome</code></td>
<td>
<p>string giving the name of column with outcome information.
Required if prognostic_scores is specified.  Otherwise it will be inferred
from prog_formula</p>
</td></tr>
<tr><td><code id="check_prognostic_formula_+3A_treat">treat</code></td>
<td>
<p>string giving the name of column designating treatment
assignment</p>
</td></tr>
</table>


<h3>Value</h3>

<p>nothing
</p>

<hr>
<h2 id='check_prop_formula'>Check Propensity Formula</h2><span id='topic+check_prop_formula'></span>

<h3>Description</h3>

<p>Check Propensity Formula
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_prop_formula(prop_formula, data, treat)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_prop_formula_+3A_prop_formula">prop_formula</code></td>
<td>
<p>a formula</p>
</td></tr>
<tr><td><code id="check_prop_formula_+3A_data">data</code></td>
<td>
<p>the analysis set data within a stratum</p>
</td></tr>
<tr><td><code id="check_prop_formula_+3A_treat">treat</code></td>
<td>
<p>the name of the treatment assignment column</p>
</td></tr>
</table>


<h3>Value</h3>

<p>nothing
</p>

<hr>
<h2 id='check_scores'>Check Scores</h2><span id='topic+check_scores'></span>

<h3>Description</h3>

<p>Checks that prognostic scores are the same length as data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_scores(prognostic_scores, data, outcome)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_scores_+3A_prognostic_scores">prognostic_scores</code></td>
<td>
<p>a numeric vector</p>
</td></tr>
<tr><td><code id="check_scores_+3A_data">data</code></td>
<td>
<p><code>data.frame</code> with observations as rows, features as columns</p>
</td></tr>
<tr><td><code id="check_scores_+3A_outcome">outcome</code></td>
<td>
<p>string giving the name of column with outcome information.
Required if prognostic_scores is specified.  Otherwise it will be inferred
from prog_formula</p>
</td></tr>
</table>


<h3>Value</h3>

<p>nothing
</p>

<hr>
<h2 id='estimate_scores'>Estimate Prognostic Scores</h2><span id='topic+estimate_scores'></span>

<h3>Description</h3>

<p>Tries to make prognostic scores.  If successfull, returns them, otherwise
throws an error message.  Common failure mode is that the prognostic score is
built on some categorical variable that takes on some values in the analysis
set that are never seen in the pilot set.  Outputs are on the response scale,
(rather than the linear predictor), so the score is the expected value of the
outcome under the control assignement based on the observed covariates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_scores(prognostic_model, analysis_set)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimate_scores_+3A_prognostic_model">prognostic_model</code></td>
<td>
<p>Model of prognosis</p>
</td></tr>
<tr><td><code id="estimate_scores_+3A_analysis_set">analysis_set</code></td>
<td>
<p>data set on which prognostic scores should be estimated</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of prognostic scores
</p>

<hr>
<h2 id='extract_cut_points'>Extract cutoffs between strata</h2><span id='topic+extract_cut_points'></span>

<h3>Description</h3>

<p>By default, returns only the internal cut points.  Cutoffs at 0 and 1 are
implied.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_cut_points(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_cut_points_+3A_x">x</code></td>
<td>
<p>an autostrata object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector of the score values delineating cutoffs between strata
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dat &lt;- make_sample_data()
a.strat &lt;- auto_stratify(dat, "treat", outcome ~ X1 + X2)
cutoffs &lt;- extract_cut_points(a.strat)
</code></pre>

<hr>
<h2 id='extract_cut_points.auto_strata'>Extract cutoffs between strata</h2><span id='topic+extract_cut_points.auto_strata'></span>

<h3>Description</h3>

<p>Extract cutoffs between strata
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'auto_strata'
extract_cut_points(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_cut_points.auto_strata_+3A_x">x</code></td>
<td>
<p>an autostrata object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector of the score values delineating cutoffs between strata
</p>

<hr>
<h2 id='fit_prognostic_model'>Fit Prognostic Model</h2><span id='topic+fit_prognostic_model'></span>

<h3>Description</h3>

<p>Given a pilot set and a prognostic formula, return the fitted formula.  If
the outcome is binary, fit a logistic regression.  Otherwise, fit a linear
model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_prognostic_model(dat, prognostic_formula, outcome)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit_prognostic_model_+3A_dat">dat</code></td>
<td>
<p>data.frame on which model should be fit</p>
</td></tr>
<tr><td><code id="fit_prognostic_model_+3A_prognostic_formula">prognostic_formula</code></td>
<td>
<p>formula for prognostic model</p>
</td></tr>
<tr><td><code id="fit_prognostic_model_+3A_outcome">outcome</code></td>
<td>
<p>string giving name of column of data where outcomes are
recorded</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a glm or lm object fit from <code>prognostic_formula</code> on <code>data</code>
</p>

<hr>
<h2 id='get_issues'>Get Issues</h2><span id='topic+get_issues'></span>

<h3>Description</h3>

<p>Helper for make_issue_table to return issues string.  Given a row which
summarizes the Treat, Control, Total, and Control_Proportion of a stratum,
return a string of potential issues with the stratum.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_issues(row)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_issues_+3A_row">row</code></td>
<td>
<p>a row of the data.frame produced in make_issue_table</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a string of potential issues
</p>

<hr>
<h2 id='get_prop_scores'>Parse <code>propensity</code> input to obtain propensity scores</h2><span id='topic+get_prop_scores'></span>

<h3>Description</h3>

<p>the <code>propensity</code> input to <code>plot.auto_strata</code> or
<code>plot.manual_strata</code> can be propensity scores, a propensity model, or a
formula for propensity score.  This function figures out which type
<code>propensity</code> is and returns the propensity scores. Returns the
propensity score on the response scale (rather than the linear predictor), so
the scores are the predited probabilities of treatment.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_prop_scores(propensity, data, treat)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_prop_scores_+3A_propensity">propensity</code></td>
<td>
<p>either a vector of propensity scores, a model for
propensity, or a formula for propensity scores</p>
</td></tr>
<tr><td><code id="get_prop_scores_+3A_data">data</code></td>
<td>
<p>the analysis set data within a stratum</p>
</td></tr>
<tr><td><code id="get_prop_scores_+3A_treat">treat</code></td>
<td>
<p>the name of the treatment assignment column</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of propensity scores
</p>

<hr>
<h2 id='ICU_data'>Demographics and comorbidities of 10,157 ICU patients</h2><span id='topic+ICU_data'></span>

<h3>Description</h3>

<p>An deidentified data set containing the demographics, comorbidities, DNR code
status, and surgical team assignment of 10,157 patients in the Stanford
University Hospital Intensive Care Unit (ICU).  This data was extracted from
the electronic record system, deidentified, and made publically available by
Chavez et al (2018) &lt;doi:10.1371/journal.pone.0190569&gt;.  It was reprocessed
for use in the <code>stratamatch</code> package as a sample data set. For more
details on the data extraction and inclusion criteria, see Chavez et al.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ICU_data
</code></pre>


<h3>Format</h3>

<p>A data frame with 10157 rows and 29 variables: </p>

<dl>
<dt>patid</dt><dd><p>patient id, numeric</p>
</dd> <dt>Birth.preTimeDays</dt><dd><p>age of patient
at time of admission to the ICU in days, numeric</p>
</dd> <dt>Female.pre</dt><dd><p>whether
the patient was documented to be female prior to ICU visit, binary</p>
</dd>
<dt>RaceAsian.pre</dt><dd><p>whether the patient's race/ethnicity was documented as
Asian prior to ICU visit, binary</p>
</dd> <dt>RaceUnknown.pre</dt><dd><p>whether the
patient's race/ethnicity was unknown prior to ICU visit, binary</p>
</dd>
<dt>RaceOther.pre</dt><dd><p>whether the patient's race/ethnicity was documented as
Other&quot; prior to ICU visit, binary</p>
</dd> <dt>RaceBlack.pre</dt><dd><p>whether the
patient's race/ethnicity was documented as Black/African American prior to
ICU visit, binary</p>
</dd> <dt>RacePacificIslander.pre</dt><dd><p>whether the patient's
race/ethnicity was documented as PacificIslander prior to ICU visit,
binary</p>
</dd> <dt>RaceNativeAmerican.pre</dt><dd><p>whether the patient's race/ethnicity
was documented as Native American prior to ICU visit, binary</p>
</dd>
<dt>self_pay</dt><dd><p>whether the patient was &quot;self pay&quot; (i.e. uninsured),
binary</p>
</dd> <dt>all_latinos</dt><dd><p>whether the patient was documented to be latino
prior to ICU visit, binary</p>
</dd> <dt>DNR</dt><dd><p>whether the patient had code status
set to any DNR &quot;Do not resuscitate&quot; order at any point during their ICU
stay, binary</p>
</dd> <dt>surgicalTeam</dt><dd><p>whether the patient was assigned to a
surgical team at any point during their ICU stay, binary</p>
</dd> </dl>



<h3>Details</h3>

<p>License information for this data is as follows:
</p>
<p>Copyright (c) 2016, Stanford University
</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &quot;Software&quot;), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:
</p>
<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.
</p>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
</p>


<h3>Source</h3>

<p><a href="https://simtk.org/frs/download_confirm.php/latestzip/1969/ICUDNR-latest.zip?group_id=892">https://simtk.org/frs/download_confirm.php/latestzip/1969/ICUDNR-latest.zip?group_id=892</a>
</p>

<hr>
<h2 id='is_binary'>Check if a vector is binary</h2><span id='topic+is_binary'></span>

<h3>Description</h3>

<p>return TRUE if the input is logical or if it contains only 0's and 1's
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_binary(col)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is_binary_+3A_col">col</code></td>
<td>
<p>a column from a data frame</p>
</td></tr>
</table>


<h3>Value</h3>

<p>logical
</p>

<hr>
<h2 id='is.auto_strata'>Checks <code>auto_strata</code> class</h2><span id='topic+is.auto_strata'></span>

<h3>Description</h3>

<p>Checks if the target object is an <code>auto_strata</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.auto_strata(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is.auto_strata_+3A_object">object</code></td>
<td>
<p>any R object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns <code>TRUE</code> if its argument has <code>auto_strata</code> among its
classes and <code>FALSE</code> otherwise.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dat &lt;- make_sample_data()
a.strat &lt;- auto_stratify(dat, "treat", outcome ~ X1 + X2)
is.auto_strata(a.strat) # returns TRUE
</code></pre>

<hr>
<h2 id='is.manual_strata'>Checks <code>manual_strata</code> class</h2><span id='topic+is.manual_strata'></span>

<h3>Description</h3>

<p>Checks if the target object is a <code>manual_strata</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.manual_strata(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is.manual_strata_+3A_object">object</code></td>
<td>
<p>any R object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns <code>TRUE</code> if its argument has <code>manual_strata</code> among
its classes and <code>FALSE</code> otherwise.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dat &lt;- make_sample_data()
m.strat &lt;- manual_stratify(dat, treat ~ C1)
is.manual_strata(m.strat) # returns TRUE
</code></pre>

<hr>
<h2 id='is.strata'>Checks <code>strata</code> class</h2><span id='topic+is.strata'></span>

<h3>Description</h3>

<p>Checks if the target object is a <code>strata</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.strata(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is.strata_+3A_object">object</code></td>
<td>
<p>any R object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns <code>TRUE</code> if its argument has <code>strata</code> among its
classes and <code>FALSE</code> otherwise.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dat &lt;- make_sample_data()
m.strat &lt;- manual_stratify(dat, treat ~ C1)
is.strata(m.strat) # returns TRUE
</code></pre>

<hr>
<h2 id='make_ac_plot'>Make Assignment-Control plot</h2><span id='topic+make_ac_plot'></span>

<h3>Description</h3>

<p>Not meant to be called externally.  Helper plot function for <code>strata</code>
object with <code>type = "AC"</code>. Produces a Assignment-Control plot of stratum
<code>s</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_ac_plot(
  x,
  propensity,
  strat,
  strata_lines,
  jitter_prognosis,
  jitter_propensity
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="make_ac_plot_+3A_x">x</code></td>
<td>
<p>an <code>auto_strata</code> object returned by <code><a href="#topic+auto_stratify">auto_stratify</a></code></p>
</td></tr>
<tr><td><code id="make_ac_plot_+3A_propensity">propensity</code></td>
<td>
<p>ignored unless <code>type = "hist"</code> or <code>type = "AC"</code>.
Specifies propensity score information for plots where this is required.
Accepts either a vector of propensity scores, a <code>glm</code> model for
propensity scores, or a formula for fitting a propensity score model.</p>
</td></tr>
<tr><td><code id="make_ac_plot_+3A_strat">strat</code></td>
<td>
<p>the number code of the stratum to be plotted. If &quot;all&quot;, plots
all strata.</p>
</td></tr>
<tr><td><code id="make_ac_plot_+3A_strata_lines">strata_lines</code></td>
<td>
<p>default = <code>TRUE</code>. Ignored unless <code>type = "AC"</code>.
If TRUE, lines on the plot indicate strata cut points.</p>
</td></tr>
<tr><td><code id="make_ac_plot_+3A_jitter_prognosis">jitter_prognosis</code></td>
<td>
<p>ignored unless <code>type = "AC"</code>.  Amount of uniform
random noise to add to prognostic scores in plot.</p>
</td></tr>
<tr><td><code id="make_ac_plot_+3A_jitter_propensity">jitter_propensity</code></td>
<td>
<p>ignored unless <code>type = "AC"</code>.  Amount of
uniform random noise to add to propensity scores in plot.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Aikens et al. (preprint) <a href="https://arxiv.org/abs/1908.09077">https://arxiv.org/abs/1908.09077</a> .
Section 3.2 for an explaination of Assignment-Control plots
</p>

<hr>
<h2 id='make_autostrata_table'>Make strata table</h2><span id='topic+make_autostrata_table'></span>

<h3>Description</h3>

<p>Make strata table
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_autostrata_table(qcut)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="make_autostrata_table_+3A_qcut">qcut</code></td>
<td>
<p>the prognostic score quantile cuts</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame of strata definitions
</p>

<hr>
<h2 id='make_hist_plot'>Make histogram plot</h2><span id='topic+make_hist_plot'></span>

<h3>Description</h3>

<p>Not meant to be called externally.  Helper plot function for <code>strata</code>
object with <code>type = "hist"</code>. Produces a histogram of propensity scores
within a stratum
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_hist_plot(x, propensity, strat)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="make_hist_plot_+3A_x">x</code></td>
<td>
<p>a <code>strata</code> object returned by <code><a href="#topic+auto_stratify">auto_stratify</a></code> or
<code><a href="#topic+manual_stratify">manual_stratify</a></code></p>
</td></tr>
<tr><td><code id="make_hist_plot_+3A_propensity">propensity</code></td>
<td>
<p>ignored unless <code>type = "hist"</code> or <code>type = "AC"</code>.
Specifies propensity score information for plots where this is required.
Accepts either a vector of propensity scores, a <code>glm</code> model for
propensity scores, or a formula for fitting a propensity score model.</p>
</td></tr>
<tr><td><code id="make_hist_plot_+3A_strat">strat</code></td>
<td>
<p>the number code of the strata to be plotted.  If &quot;all&quot;, plots
all strata</p>
</td></tr>
</table>

<hr>
<h2 id='make_issue_table'>Make Issue Table</h2><span id='topic+make_issue_table'></span>

<h3>Description</h3>

<p>Not meant to be called externally. Produce table of the number of treated and
control individuals in each stratum. Also checks for potential problems with
treat/control ratio or stratum size which might result in slow or poor
quality matching.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_issue_table(a_set, treat)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="make_issue_table_+3A_a_set">a_set</code></td>
<td>
<p><code>data.frame</code> with observations as rows, features as
columns.  This should be the analysis set from the recently stratified
data.</p>
</td></tr>
<tr><td><code id="make_issue_table_+3A_treat">treat</code></td>
<td>
<p>string name of treatment column</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a 3 by [number of strata] dataframe with Treat, Control,
Total, Control Proportion, and Potential Issues
</p>

<hr>
<h2 id='make_match_distances'>Make match distances within strata</h2><span id='topic+make_match_distances'></span>

<h3>Description</h3>

<p>Makes the match distance with strata specifications for <code>strata_match</code>.
This function is largely unecessary to call outside of stratamatch, but it is
exported for the benefit of the user to aid in debugging.  Note that this 
function requires that the R package <code>optmatch</code> is installed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_match_distances(object, model, method)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="make_match_distances_+3A_object">object</code></td>
<td>
<p>a strata object</p>
</td></tr>
<tr><td><code id="make_match_distances_+3A_model">model</code></td>
<td>
<p>(optional) formula for matching.  If left blank, <em>all</em>
columns of the analysis set in <code>object</code> will be used as covariates in
the propensity model or mahalanobis match (except outcome, treatment and
stratum)</p>
</td></tr>
<tr><td><code id="make_match_distances_+3A_method">method</code></td>
<td>
<p>either &quot;prop&quot; for propensity score matching based on a glm fit
with model <code>model</code>, or &quot;mahal&quot; for mahalanobis distance matching by
the covariates in <code>model</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a match distance matrix for optmatch
</p>


<h3>See Also</h3>

<p><a href="https://cran.r-project.org/package=optmatch">https://cran.r-project.org/package=optmatch</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
dat &lt;- make_sample_data(n = 75)

# stratify with auto_stratify
a.strat &lt;- auto_stratify(dat, "treat", outcome ~ X2, size = 25)

# make match distances.  Requires optmatch package to be installed.

md &lt;- make_match_distances(a.strat, treat ~ X1 + X2, method = "mahal")

</code></pre>

<hr>
<h2 id='make_resid_plot'>Make Residual Plot</h2><span id='topic+make_resid_plot'></span>

<h3>Description</h3>

<p>Not yet implemented.  Not meant to be called externally. Helper plot function
for <code>strata</code> object with <code>type = "residual"</code>. Produces the
diagnostic plots for the prognostic score model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_resid_plot(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="make_resid_plot_+3A_x">x</code></td>
<td>
<p>an <code>auto_strata</code> object returned by <code><a href="#topic+auto_stratify">auto_stratify</a></code></p>
</td></tr>
</table>

<hr>
<h2 id='make_sample_data'>Make sample data</h2><span id='topic+make_sample_data'></span>

<h3>Description</h3>

<p>Makes a simple data frame with treat (binary), outcome (binary), and five
covariates: X1 (continuous), X2 (continuous), B1 (binary), B2 (binary), and
C1 (categorical). Probability outcome = 1 is sigmoid(treat + X1). Probability
treatment = 1 is sigmoid(- 0.2 * X1 + X2 - B1 + 2 * B2)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_sample_data(n = 100)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="make_sample_data_+3A_n">n</code></td>
<td>
<p>the size of the desired data set</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'># make sample data set of 30 observations
dat &lt;- make_sample_data(n = 30)
</code></pre>

<hr>
<h2 id='make_SR_plot'>Make Size-Ratio plot</h2><span id='topic+make_SR_plot'></span>

<h3>Description</h3>

<p>Not meant to be called externally.  Helper plot function for <code>strata</code>.
Produces a scatter plot of strata by size and control proportion.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_SR_plot(x, label)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="make_SR_plot_+3A_x">x</code></td>
<td>
<p>a <code>strata</code> object returned by <code><a href="#topic+auto_stratify">auto_stratify</a></code> or <code><a href="#topic+manual_stratify">manual_stratify</a></code></p>
</td></tr>
<tr><td><code id="make_SR_plot_+3A_label">label</code></td>
<td>
<p>ignored unless <code>type = "SR"</code>. If <code>TRUE</code>, a clickable
plot is produced. The user may click on any number of strata and press
finish to have those strata labeled.  Note: uses <code><a href="graphics.html#topic+identify">identify</a></code>,
which may not be supported on some devices</p>
</td></tr>
</table>

<hr>
<h2 id='manual_stratify'>Manual Stratify</h2><span id='topic+manual_stratify'></span>

<h3>Description</h3>

<p>Stratifies a data set based on a set of blocking covariates specified by the
user. Creates a <code>manual_strata</code> object, which can be passed to
<code><a href="#topic+strata_match">strata_match</a></code> for stratified matching or unpacked by the user to be
matched by some other means.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>manual_stratify(data, strata_formula, force = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="manual_stratify_+3A_data">data</code></td>
<td>
<p>data.frame with observations as rows, features as columns</p>
</td></tr>
<tr><td><code id="manual_stratify_+3A_strata_formula">strata_formula</code></td>
<td>
<p>the formula to be used for stratification.  (e.g. <code>treat
~ X1</code>) the variable on the left is taken to be the name of the treatment
assignment column, and the variables on the left are taken to be the
variables by which the data should be stratified</p>
</td></tr>
<tr><td><code id="manual_stratify_+3A_force">force</code></td>
<td>
<p>a boolean. If true, run even if a variable appears continuous.
(default = FALSE)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a <code>manual_strata</code> object.  This contains: </p>

<ul>
<li> <p><code>treat</code> - a string giving the name of the column encoding
treatment assignment
</p>
</li>
<li> <p><code>covariates</code> - a character vector with the names of the
categorical columns on which the data were stratified
</p>
</li>
<li> <p><code>analysis_set</code> - the data set with strata assignments
</p>
</li>
<li> <p><code>call</code> - the call to <code>manual_stratify</code> used to generate this
object
</p>
</li>
<li> <p><code>issue_table</code> - a table of each stratum and potential issues of
size and treat:control balance. In small or imbalanced strata, it may be
difficult or infeasible to find high-quality matches, while very large
strata may be computationally intensive to match.
</p>
</li>
<li> <p><code>strata_table</code> - a table of each stratum and the covariate bin
to which it corresponds
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+auto_stratify">auto_stratify</a></code>, <code><a href="#topic+new_manual_strata">new_manual_strata</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># make sample data set
dat &lt;- make_sample_data(n = 75)

# stratify based on B1 and B2
m.strat &lt;- manual_stratify(dat, treat ~ B1 + B2)

# diagnostic plot
plot(m.strat)
</code></pre>

<hr>
<h2 id='new_auto_strata'>New Autostrata</h2><span id='topic+new_auto_strata'></span>

<h3>Description</h3>

<p>Basic constructor for an <code>auto_strata</code> object. These objects hold all
the information associated with a dataset that has been stratified via
<code><a href="#topic+auto_stratify">auto_stratify</a></code>.  This object may be passed to
<code><a href="#topic+strata_match">strata_match</a></code> to be matched or it may be unpacked by the user to be
matched by other means.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>new_auto_strata(
  outcome,
  treat,
  analysis_set = NULL,
  call = NULL,
  issue_table = NULL,
  strata_table = NULL,
  prognostic_scores = NULL,
  prognostic_model = NULL,
  pilot_set = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="new_auto_strata_+3A_outcome">outcome</code></td>
<td>
<p>a string giving the name of the column where outcome
information is stored</p>
</td></tr>
<tr><td><code id="new_auto_strata_+3A_treat">treat</code></td>
<td>
<p>a string giving the name of the column where treatment
information is stored</p>
</td></tr>
<tr><td><code id="new_auto_strata_+3A_analysis_set">analysis_set</code></td>
<td>
<p>the data set which will be stratified</p>
</td></tr>
<tr><td><code id="new_auto_strata_+3A_call">call</code></td>
<td>
<p>the call to <code>auto_stratify</code> used to generate this object</p>
</td></tr>
<tr><td><code id="new_auto_strata_+3A_issue_table">issue_table</code></td>
<td>
<p>a table of each stratum and potential issues of size and
treat:control balance</p>
</td></tr>
<tr><td><code id="new_auto_strata_+3A_strata_table">strata_table</code></td>
<td>
<p>a table of each stratum and the prognostic score quantile
bin this corresponds to</p>
</td></tr>
<tr><td><code id="new_auto_strata_+3A_prognostic_scores">prognostic_scores</code></td>
<td>
<p>a vector of prognostic scores.</p>
</td></tr>
<tr><td><code id="new_auto_strata_+3A_prognostic_model">prognostic_model</code></td>
<td>
<p>a model for prognosis fit on a separate data set.</p>
</td></tr>
<tr><td><code id="new_auto_strata_+3A_pilot_set">pilot_set</code></td>
<td>
<p>the set of controls used to fit the prognostic model.
These are excluded from subsequent analysis so that the prognostic score is
not overfit to the data used to estimate the treatment effect.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a basic <code>auto_strata</code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+auto_stratify">auto_stratify</a></code>, a function which calls this constructor
to produce an <code>auto_strata</code> object.
</p>

<hr>
<h2 id='new_manual_strata'>New Manual Strata</h2><span id='topic+new_manual_strata'></span>

<h3>Description</h3>

<p>Basic constructor for an <code>manual_strata</code> object. These objects hold all
the information associated with a dataset that has been stratified via
<code><a href="#topic+manual_stratify">manual_stratify</a></code>.  This object may be passed to
<code><a href="#topic+strata_match">strata_match</a></code> to be matched or it may be unpacked by the user to be
matched by other means.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>new_manual_strata(
  treat = character(),
  covariates = character(),
  analysis_set = data.frame(),
  call = call(),
  issue_table = data.frame(),
  strata_table = data.frame()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="new_manual_strata_+3A_treat">treat</code></td>
<td>
<p>a string giving the name of the column where treatment
information is stored</p>
</td></tr>
<tr><td><code id="new_manual_strata_+3A_covariates">covariates</code></td>
<td>
<p>a character vector with the names of the categorical
columns on which to stratify</p>
</td></tr>
<tr><td><code id="new_manual_strata_+3A_analysis_set">analysis_set</code></td>
<td>
<p>the data set which will be stratified</p>
</td></tr>
<tr><td><code id="new_manual_strata_+3A_call">call</code></td>
<td>
<p>the call to <code>manual_stratify</code> used to generate this object</p>
</td></tr>
<tr><td><code id="new_manual_strata_+3A_issue_table">issue_table</code></td>
<td>
<p>a table of each stratum and potential issues of size and
treat:control balance</p>
</td></tr>
<tr><td><code id="new_manual_strata_+3A_strata_table">strata_table</code></td>
<td>
<p>a table of each stratum and the covariate bin this
corresponds to</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a basic <code>manual_strata</code> object
</p>

<hr>
<h2 id='plot.auto_strata'>Plot method for <code>auto_strata</code> object</h2><span id='topic+plot.auto_strata'></span>

<h3>Description</h3>

<p>Generates diagnostic plots for the product of a stratification by
<code><a href="#topic+auto_stratify">auto_stratify</a></code>.  There are four plot types: </p>
 <ol>
<li>
<p><code>"SR"</code> (default) - produces a scatter plot of strata by size and
treat:control ratio </p>
</li>
<li> <p><code>"hist"</code> - produces a histogram of propensity
scores within a stratum </p>
</li>
<li> <p><code>"AC"</code> - produces a Assignment-Control
plot of individuals within a stratum </p>
</li>
<li> <p><code>"residual"</code> - produces a
residual plot for the prognostic model</p>
</li></ol>



<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'auto_strata'
plot(
  x,
  type = "SR",
  label = FALSE,
  stratum = "all",
  strata_lines = TRUE,
  jitter_prognosis,
  jitter_propensity,
  propensity,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.auto_strata_+3A_x">x</code></td>
<td>
<p>an <code>auto_strata</code> object returned by <code><a href="#topic+auto_stratify">auto_stratify</a></code></p>
</td></tr>
<tr><td><code id="plot.auto_strata_+3A_type">type</code></td>
<td>
<p>string giving the plot type (default = <code>"SR"</code>).  Other
options are <code>"hist"</code>, <code>"AC"</code> and <code>"residual"</code></p>
</td></tr>
<tr><td><code id="plot.auto_strata_+3A_label">label</code></td>
<td>
<p>ignored unless <code>type = "SR"</code>. If <code>TRUE</code>, a clickable
plot is produced. The user may click on any number of strata and press
finish to have those strata labeled.  Note: uses <code><a href="graphics.html#topic+identify">identify</a></code>,
which may not be supported on some devices</p>
</td></tr>
<tr><td><code id="plot.auto_strata_+3A_stratum">stratum</code></td>
<td>
<p>ignored unless <code>type = "hist"</code> or <code>type = "AC"</code>. A
number specifying which stratum to plot.</p>
</td></tr>
<tr><td><code id="plot.auto_strata_+3A_strata_lines">strata_lines</code></td>
<td>
<p>default = <code>TRUE</code>. Ignored unless <code>type = "AC"</code>.
If TRUE, lines on the plot indicate strata cut points.</p>
</td></tr>
<tr><td><code id="plot.auto_strata_+3A_jitter_prognosis">jitter_prognosis</code></td>
<td>
<p>ignored unless <code>type = "AC"</code>.  Amount of uniform
random noise to add to prognostic scores in plot.</p>
</td></tr>
<tr><td><code id="plot.auto_strata_+3A_jitter_propensity">jitter_propensity</code></td>
<td>
<p>ignored unless <code>type = "AC"</code>.  Amount of
uniform random noise to add to propensity scores in plot.</p>
</td></tr>
<tr><td><code id="plot.auto_strata_+3A_propensity">propensity</code></td>
<td>
<p>ignored unless <code>type = "hist"</code> or <code>type = "AC"</code>.
Specifies propensity score information for plots where this is required.
Accepts either a vector of propensity scores, a <code>glm</code> model for
propensity scores, or a formula for fitting a propensity score model.</p>
</td></tr>
<tr><td><code id="plot.auto_strata_+3A_...">...</code></td>
<td>
<p>other arguments</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Aikens, Greaves, and Baiocchi (2020) in Statistics in Medicine,
Section 3.2 for an explaination of Assignment-Control plots (formerly
&quot;Fisher-Mill&quot; plots).
</p>
<p><code><a href="#topic+plot.manual_strata">plot.manual_strata</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dat &lt;- make_sample_data()
a.strat &lt;- auto_stratify(dat, "treat", outcome ~ X1 + X2)
plot(a.strat) # makes size-ratio scatter plot
plot(a.strat, type = "hist", propensity = treat ~ X1, stratum = 1)
plot(a.strat, type = "AC", propensity = treat ~ X1, stratum = 1)
plot(a.strat, type = "residual")
</code></pre>

<hr>
<h2 id='plot.manual_strata'>Plot method for <code>manual_strata</code> object</h2><span id='topic+plot.manual_strata'></span>

<h3>Description</h3>

<p>Generates diagnostic plots for the product of a stratification by
<code><a href="#topic+manual_stratify">manual_stratify</a></code>.  There are two plot types: </p>
 <ol>
<li>
<p><code>"SR"</code> (default) - produces a scatter plot of strata by size and
treat:control ratio </p>
</li>
<li> <p><code>"hist"</code> - produces a histogram of propensity
scores within a stratum.</p>
</li></ol>
<p> Note that residual plots and AC plots are not
supported for <code>manual_strata</code> objects because no prognostic model is
fit.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'manual_strata'
plot(x, type = "SR", label = FALSE, stratum = "all", propensity, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.manual_strata_+3A_x">x</code></td>
<td>
<p>a <code>manual_strata</code> object returned by
<code><a href="#topic+manual_stratify">manual_stratify</a></code></p>
</td></tr>
<tr><td><code id="plot.manual_strata_+3A_type">type</code></td>
<td>
<p>string giving the plot type (default = <code>"SR"</code>).  Other
option is <code>"hist"</code></p>
</td></tr>
<tr><td><code id="plot.manual_strata_+3A_label">label</code></td>
<td>
<p>ignored unless <code>type = "SR"</code>. If <code>TRUE</code>, a clickable
plot is produced. The user may click on any number of strata and press
finish to have those strata labeled.  Note: uses <code><a href="graphics.html#topic+identify">identify</a></code>,
which may not be supported on some devices</p>
</td></tr>
<tr><td><code id="plot.manual_strata_+3A_stratum">stratum</code></td>
<td>
<p>ignored unless <code>type = "hist"</code>. A number specifying which
stratum to plot.</p>
</td></tr>
<tr><td><code id="plot.manual_strata_+3A_propensity">propensity</code></td>
<td>
<p>ignored unless <code>type = "hist"</code>. Specifies propensity
score information for plots where this is required. Accepts either a vector
of propensity scores, a <code>glm</code> model for propensity scores, or a
formula for fitting a propensity score model.</p>
</td></tr>
<tr><td><code id="plot.manual_strata_+3A_...">...</code></td>
<td>
<p>other arguments</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>dat &lt;- make_sample_data()
m.strat &lt;- manual_stratify(dat, treat ~ C1)
plot(m.strat) # makes size-ratio scatter plot
plot(m.strat, type = "hist", propensity = treat ~ X1, stratum = 1)
</code></pre>

<hr>
<h2 id='print.auto_strata'>Print Auto Strata</h2><span id='topic+print.auto_strata'></span>

<h3>Description</h3>

<p>Print method for <code>auto_strata</code> object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'auto_strata'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.auto_strata_+3A_x">x</code></td>
<td>
<p>an <code>auto_strata</code> object</p>
</td></tr>
<tr><td><code id="print.auto_strata_+3A_...">...</code></td>
<td>
<p>other arguments</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>dat &lt;- make_sample_data()
a.strat &lt;- auto_stratify(dat, "treat", outcome ~ X1 + X2)
print(a.strat) # prints information about a.strat
</code></pre>

<hr>
<h2 id='print.manual_strata'>Print Manual Strata</h2><span id='topic+print.manual_strata'></span>

<h3>Description</h3>

<p>Print method for <code>manual_strata</code> object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'manual_strata'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.manual_strata_+3A_x">x</code></td>
<td>
<p>a <code>manual_strata</code> object</p>
</td></tr>
<tr><td><code id="print.manual_strata_+3A_...">...</code></td>
<td>
<p>other arguments</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>dat &lt;- make_sample_data()
m.strat &lt;- manual_stratify(dat, treat ~ C1)
print(m.strat) # prints information about m.strat
</code></pre>

<hr>
<h2 id='split_pilot_set'>Split data into pilot and analysis sets</h2><span id='topic+split_pilot_set'></span>

<h3>Description</h3>

<p>Given a data set and some parameters about how to split the data, this
function partitions the data accordingly and returns the partitioned data as
a list containing the <code>analysis_set</code> and <code>pilot_set</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>split_pilot_set(
  data,
  treat,
  pilot_fraction = 0.1,
  pilot_size = NULL,
  group_by_covariates = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="split_pilot_set_+3A_data">data</code></td>
<td>
<p><code>data.frame</code> with observations as rows, features as columns</p>
</td></tr>
<tr><td><code id="split_pilot_set_+3A_treat">treat</code></td>
<td>
<p>string giving the name of column designating treatment
assignment</p>
</td></tr>
<tr><td><code id="split_pilot_set_+3A_pilot_fraction">pilot_fraction</code></td>
<td>
<p>numeric between 0 and 1 giving the proportion of
controls to be allotted for building the prognostic score (default = 0.1)</p>
</td></tr>
<tr><td><code id="split_pilot_set_+3A_pilot_size">pilot_size</code></td>
<td>
<p>alternative to pilot_fraction. Approximate number of
observations to be used in pilot set. Note that the actual pilot set size
returned may not be exactly <code>pilot_size</code> if <code>group_by_covariates</code>
is specified because balancing by covariates may result in deviations from
desired size. If <code>pilot_size</code> is specified, <code>pilot_fraction</code> is
ignored.</p>
</td></tr>
<tr><td><code id="split_pilot_set_+3A_group_by_covariates">group_by_covariates</code></td>
<td>
<p>character vector giving the names of covariates to
be grouped by (optional). If specified, the pilot set will be sampled in a
stratified manner, so that the composition of the pilot set reflects the
composition of the whole data set in terms of these covariates.  The
specified covariates must be categorical.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list with analaysis_set and pilot_set
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dat &lt;- make_sample_data()
splt &lt;- split_pilot_set(dat, "treat", 0.2)
# can be passed into auto_stratify if desired
a.strat &lt;- auto_stratify(splt$analysis_set, "treat", outcome ~ X1,
  pilot_sample = splt$pilot_set
)
</code></pre>

<hr>
<h2 id='strata'>Strata function from package Survival</h2><span id='topic+strata'></span>

<h3>Description</h3>

<p>Strata function from package Survival
</p>

<hr>
<h2 id='strata_match'>Strata Match</h2><span id='topic+strata_match'></span>

<h3>Description</h3>

<p>Match within strata in series using optmatch. Note that this function 
requires that the R package <code>optmatch</code> is installed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>strata_match(object, model = NULL, method = "prop", k = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="strata_match_+3A_object">object</code></td>
<td>
<p>a strata object</p>
</td></tr>
<tr><td><code id="strata_match_+3A_model">model</code></td>
<td>
<p>(optional) formula for matching.  If left blank, <em>all</em>
columns of the analysis set in <code>object</code> will be used as covariates in
the propensity model or mahalanobis match (except outcome, treatment and
stratum)</p>
</td></tr>
<tr><td><code id="strata_match_+3A_method">method</code></td>
<td>
<p>either &quot;prop&quot; for propensity score matching based on a glm fit
with model <code>model</code>, or &quot;mahal&quot; for mahalanobis distance matching by
the covariates in <code>model</code>.</p>
</td></tr>
<tr><td><code id="strata_match_+3A_k">k</code></td>
<td>
<p>the number of control individuals to be matched to each treated
individual.  If <code>"k = full"</code> is used, fullmatching is done instead of
pairmatching</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a named factor with matching assignments
</p>


<h3>See Also</h3>

<p><a href="https://cran.r-project.org/package=optmatch">https://cran.r-project.org/package=optmatch</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># make a sample data set
set.seed(1)
dat &lt;- make_sample_data(n = 75)

# stratify with auto_stratify
a.strat &lt;- auto_stratify(dat, "treat", outcome ~ X2, size = 25)

# 1:1 match based on propensity formula: treat ~ X1 + X2
# Requires optmatch package to be installed.

strata_match(a.strat, model = treat ~ X1 + X2, k = 1)


# full match within strata based on mahalanobis distance.
# Requires optmatch package to be installed.

strata_match(a.strat, model = treat ~ X1 + X2, method = "mahal", k = 1)

</code></pre>

<hr>
<h2 id='strata_match_nstrat'>Match without Stratification</h2><span id='topic+strata_match_nstrat'></span>

<h3>Description</h3>

<p>Not meant to be called externally.  Match a data set without stratifying.
Used to compare performance with and without stratification. Note that this 
function requires that the R package <code>optmatch</code> is installed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>strata_match_nstrat(object, model = NULL, k = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="strata_match_nstrat_+3A_object">object</code></td>
<td>
<p>a strata object</p>
</td></tr>
<tr><td><code id="strata_match_nstrat_+3A_model">model</code></td>
<td>
<p>(optional) formula for matching.  If left blank, <em>all</em>
columns of the analysis set in <code>object</code> will be used as covariates in
the propensity model or mahalanobis match (except outcome, treatment and
stratum)</p>
</td></tr>
<tr><td><code id="strata_match_nstrat_+3A_k">k</code></td>
<td>
<p>the number of control individuals to be matched to each treated
individual.  If <code>"k = full"</code> is used, fullmatching is done instead of
pairmatching</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a named factor with matching assignments
</p>


<h3>See Also</h3>

<p><a href="https://cran.r-project.org/package=optmatch">https://cran.r-project.org/package=optmatch</a>
</p>

<hr>
<h2 id='stratamatch'>stratamatch: stratify and match large data sets</h2><span id='topic+stratamatch'></span>

<h3>Description</h3>

<p>This package employs a pilot matching design to automatically stratify and
match large datasets.  The <code><a href="#topic+manual_stratify">manual_stratify</a></code> function allows
users to manually stratify a dataset based on categorical variables of
interest, while the <code><a href="#topic+auto_stratify">auto_stratify</a></code> function does automatically
by allocating a held-aside (pilot) data set, fitting a prognostic score (see
Hansen (2008) &lt;doi:10.1093/biomet/asn004&gt;) on the pilot set, and stratifying
the data set based on prognostic score quantiles.  The
<code><a href="#topic+strata_match">strata_match</a></code> function then does optimal matching of the data
set within strata.
</p>


<h3>See Also</h3>

 <ol>
<li> <p><a href="https://github.com/raikens1/stratamatch">https://github.com/raikens1/stratamatch</a> </p>
</li></ol>


<hr>
<h2 id='summary.strata'>Summary for strata object</h2><span id='topic+summary.strata'></span>

<h3>Description</h3>

<p>Summarize number and sizes of strata in a <code>strata</code> object.  Also prints
number of strata with potential issues.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'strata'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.strata_+3A_object">object</code></td>
<td>
<p>a <code>strata</code> object</p>
</td></tr>
<tr><td><code id="summary.strata_+3A_...">...</code></td>
<td>
<p>other arguments</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For more information, access the issue table for your strata object with
<code>mystrata$issue_table</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dat &lt;- make_sample_data()
m.strat &lt;- manual_stratify(dat, treat ~ C1)
summary(m.strat) # Summarizes strata in m.strat
</code></pre>

<hr>
<h2 id='warn_if_continuous'>Warn if continuous</h2><span id='topic+warn_if_continuous'></span>

<h3>Description</h3>

<p>Throws an error if a column is continuous
</p>


<h3>Usage</h3>

<pre><code class='language-R'>warn_if_continuous(column, name, force, n)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="warn_if_continuous_+3A_column">column</code></td>
<td>
<p>vector or factor column from a <code>data.frame</code></p>
</td></tr>
<tr><td><code id="warn_if_continuous_+3A_name">name</code></td>
<td>
<p>name of the input column</p>
</td></tr>
<tr><td><code id="warn_if_continuous_+3A_force">force</code></td>
<td>
<p>a boolean. If true, warn but do not stop</p>
</td></tr>
<tr><td><code id="warn_if_continuous_+3A_n">n</code></td>
<td>
<p>the number of rows in the data set</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Not meant to be called externally. Only categorical or binary covariates
should be used to manually stratify a data set.  However, it's hard to tell
for sure if something is continuous or just discrete with real-numbered
values. Returns without throwing an error if the column is a factor, but
throws an error or warning if the column has many distinct values.
</p>


<h3>Value</h3>

<p>Does not return anything
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
