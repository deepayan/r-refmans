<!DOCTYPE html><html lang="en-US"><head><title>Help for package gateR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {gateR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#gateR-package'><p>The gateR Package: Flow/Mass Cytometry Gating via Spatial Kernel Density Estimation</p></a></li>
<li><a href='#gating'><p>Gating strategy for mass cytometry data using spatial relative risk functions</p></a></li>
<li><a href='#lotrrs'><p>A single gate for two conditions</p></a></li>
<li><a href='#lrr_plot'><p>Prepare log relative risk values for plotting with a diverging color palette</p></a></li>
<li><a href='#pval_correct'><p>Calculate p-value corrections for multiple testing</p></a></li>
<li><a href='#pval_plot'><p>Prepare significant p-values for plotting</p></a></li>
<li><a href='#randCyto'><p>Subset of the 'extdata' data in the 'flowWorkspaceData' package</p></a></li>
<li><a href='#rrs'><p>A single gate for a single condition</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Flow/Mass Cytometry Gating via Spatial Kernel Density Estimation</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.15</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-01-23</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Ian D. Buller &lt;ian.buller@alumni.emory.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimates statistically significant marker combination values within
        which one immunologically distinctive group (i.e., disease case) is more associated than
        another group (i.e., healthy control), successively, using various combinations (i.e.,
        "gates") of markers to examine features of cells that may be different between
        groups. For a two-group comparison, the 'gateR' package uses the spatial relative risk
        function estimated using the 'sparr' package. Details about the 'sparr' package
        methods can be found in the tutorial: Davies et al. (2018) &lt;<a href="https://doi.org/10.1002%2Fsim.7577">doi:10.1002/sim.7577</a>&gt;. Details
        about kernel density estimation can be found in J. F. Bithell (1990) &lt;<a href="https://doi.org/10.1002%2Fsim.4780090616">doi:10.1002/sim.4780090616</a>&gt;.
        More information about relative risk functions using kernel density estimation can be
        found in J. F. Bithell (1991) &lt;<a href="https://doi.org/10.1002%2Fsim.4780101112">doi:10.1002/sim.4780101112</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License (&ge; 2.0)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>fields, graphics, grDevices, lifecycle, rlang, sparr,
SpatialPack, spatstat.geom, stats, terra, tibble</td>
</tr>
<tr>
<td>Suggests:</td>
<td>dplyr, R.rsp, spelling, testthat, usethis, utils</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>R.rsp</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/lance-waller-lab/gateR">https://github.com/lance-waller-lab/gateR</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/lance-waller-lab/gateR/issues">https://github.com/lance-waller-lab/gateR/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-23 14:13:48 UTC; ian.buller</td>
</tr>
<tr>
<td>Author:</td>
<td>Ian D. Buller <a href="https://orcid.org/0000-0001-9477-8582"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre, cph],
  Elena Hsieh <a href="https://orcid.org/0000-0003-3969-6597"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [ctb],
  Debashis Ghosh <a href="https://orcid.org/0000-0001-6618-1316"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Lance A. Waller <a href="https://orcid.org/0000-0001-5002-8886"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  NCI [cph]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-23 14:30:04 UTC</td>
</tr>
</table>
<hr>
<h2 id='gateR-package'>The gateR Package: Flow/Mass Cytometry Gating via Spatial Kernel Density Estimation</h2><span id='topic+gateR-package'></span><span id='topic+gateR'></span>

<h3>Description</h3>

<p>Estimates statistically significant fluorescent marker combination values within which one immunologically distinctive group (i.e., disease case) is more associated than another group (i.e., healthy control), successively, using various combinations (i.e., &quot;gates&quot;) of fluorescent markers to examine features of cells that may be different between groups.
</p>


<h3>Details</h3>

<p>For a two-group comparison, the 'gateR' package uses the spatial relative risk function estimated using the <code>sparr</code> package. Details about the <code>sparr</code> package methods can be found in the tutorial: Davies et al. (2018) <a href="https://doi.org/10.1002/sim.7577">doi:10.1002/sim.7577</a>. Details about kernel density estimation can be found in J. F. Bithell (1990) <a href="https://doi.org/10.1002/sim.4780090616">doi:10.1002/sim.4780090616</a>. More information about relative risk functions using kernel density estimation can be found in J. F. Bithell (1991) <a href="https://doi.org/10.1002/sim.4780101112">doi:10.1002/sim.4780101112</a>.
</p>
<p>This package provides a function to perform a gating strategy for flow cytometry data. The 'gateR' package also provides basic visualization for each gate.
</p>
<p>Key content of the 'gateR' package include:<br />
</p>
<p><b>Gating Strategy</b>
</p>
<p><code><a href="#topic+gating">gating</a></code> Extracts cells within statistically significant combinations of fluorescent markers, successively, for a set of markers. Statistically significant combinations are identified using two-tailed p-values of a relative risk surface assuming asymptotic normality. This function is currently available for two-level comparisons of a single condition (e.g., case/control) or two conditions (e.g., case/control at time 1 and time 2). Provides functionality for basic visualization and multiple testing correction.
</p>
<p><code><a href="#topic+rrs">rrs</a></code> Estimates a relative risk surface and computes the asymptotic p-value surface for a single gate with a single condition, including features for basic visualization. This function is used internally within the <code><a href="#topic+gating">gating</a></code> function to extract the points within the significant areas. This function can also be used as a standalone function.
</p>
<p><code><a href="#topic+lotrrs">lotrrs</a></code> Estimates a ratio of relative risk surfaces and computes the asymptotic p-value surface for a single gate with two conditions, including features for basic visualization. This function is used internally within the <code><a href="#topic+gating">gating</a></code> function to extract the points within the significant areas. This function can also be used as a standalone function.
</p>
<p><b>Flow Cytometry Data</b>
</p>
<p><code><a href="#topic+randCyto">randCyto</a></code> A sample dataset containing information about flow cytometry data with two binary categorical variables. The data are a random subset of the 'extdata' data in the 'flowWorkspaceData' package found on Bioconductor <a href="https://bioconductor.org/packages/release/data/experiment/html/flowWorkspaceData.html">https://bioconductor.org/packages/release/data/experiment/html/flowWorkspaceData.html</a> and formatted for 'gateR' input.
</p>


<h3>Dependencies</h3>

<p>The 'gateR' package relies heavily upon <code>sparr</code>, <code>spatstat.geom</code>, and <code>terra</code>. For a two-level comparison, the spatial relative risk function uses the <code><a href="sparr.html#topic+risk">risk</a></code> function. The calculation of a Bonferroni correction for multiple testing accounting for the spatial correlation of the estimated surface uses the <code><a href="SpatialPack.html#topic+modified.ttest">modified.ttest</a></code> function. Basic visualizations rely on the <code><a href="fields.html#topic+image.plot">image.plot</a></code> function.
</p>


<h3>Author(s)</h3>

<p>Ian D. Buller<br /> <em>Social &amp; Scientific Systems, Inc., a division of DLH Corporation, Silver Spring, Maryland, USA (current); Occupational and Environmental Epidemiology Branch, Division of Cancer Epidemiology and Genetics, National Cancer Institute, National Institutes of Health, Rockville, Maryland, USA (former); Environmental Health Sciences, James T. Laney School of Graduate Studies, Emory University, Atlanta, Georgia, USA. (original)</em><br />
</p>
<p>Maintainer: I.D.B. <a href="mailto:ian.buller@alumni.emory.edu">ian.buller@alumni.emory.edu</a>
</p>

<hr>
<h2 id='gating'>Gating strategy for mass cytometry data using spatial relative risk functions</h2><span id='topic+gating'></span>

<h3>Description</h3>

<p>Extracts cells within statistically significant combinations of fluorescent markers, successively, for a set of markers. Statistically significant combinations are identified using two-tailed p-values of a relative risk surface assuming asymptotic normality. This function is currently available for two-level comparisons of a single condition (e.g., case/control) or two conditions (e.g., case/control at time 1 and time 2). Provides functionality for basic visualization and multiple testing correction.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gating(
  dat,
  vars,
  n_condition = c(1, 2),
  numerator = TRUE,
  bandw = NULL,
  alpha = 0.05,
  p_correct = "none",
  nbc = NULL,
  plot_gate = FALSE,
  save_gate = FALSE,
  name_gate = NULL,
  path_gate = NULL,
  rcols = c("#FF0000", "#CCCCCC", "#0000FF"),
  lower_lrr = NULL,
  upper_lrr = NULL,
  c1n = NULL,
  c2n = NULL,
  win = NULL,
  ...,
  doplot = lifecycle::deprecated(),
  verbose = lifecycle::deprecated()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gating_+3A_dat">dat</code></td>
<td>
<p>Input data frame flow cytometry data with the following features (columns): 1) ID, 2) Condition A ID, 3) Condition B ID (optional), and a set of markers.</p>
</td></tr>
<tr><td><code id="gating_+3A_vars">vars</code></td>
<td>
<p>A vector of characters with the name of features (columns) within <code>dat</code> to use as markers for each gate. See details below.</p>
</td></tr>
<tr><td><code id="gating_+3A_n_condition">n_condition</code></td>
<td>
<p>A numeric value of either 1 or 2 designating if the gating is performed with one condition or two conditions.</p>
</td></tr>
<tr><td><code id="gating_+3A_numerator">numerator</code></td>
<td>
<p>Logical. If <code>TRUE</code> (the default), cells will be extracted within all statistically significant numerator (i.e., case) clusters. If <code>FALSE</code>, cells will be extracted within all statistically significant denominator (i.e., control) clusters.</p>
</td></tr>
<tr><td><code id="gating_+3A_bandw">bandw</code></td>
<td>
<p>Optional, numeric. Fixed bandwidth for the kernel density estimation. Default is based on the internal <code>[sparr]{OS}</code> function.</p>
</td></tr>
<tr><td><code id="gating_+3A_alpha">alpha</code></td>
<td>
<p>Numeric. The two-tailed alpha level for significance threshold (default is 0.05).</p>
</td></tr>
<tr><td><code id="gating_+3A_p_correct">p_correct</code></td>
<td>
<p>Optional. Character string specifying whether to apply a correction for multiple comparisons including a False Discovery Rate <code>p_correct = "FDR"</code>, a spatially dependent Sidak correction <code>p_correct = "correlated Sidak"</code>, a spatially dependent Bonferroni correction <code>p_correct = "correlated Bonferroni"</code>, an independent Sidak correction <code>p_correct = "uncorrelated Sidak"</code>, an independent Bonferroni correction <code>p_correct = "uncorrelated Bonferroni"</code>, and a correction based on Random Field Theory using an equation by Adler and Hasofer <code>p_correct = "Adler and Hasofer"</code> or an equation by Friston et al. <code>p_correct = "Friston"</code>. If <code>p_correct = "none"</code> (the default), then no correction is applied.</p>
</td></tr>
<tr><td><code id="gating_+3A_nbc">nbc</code></td>
<td>
<p>Optional. An integer for the number of bins when <code>p_correct = "correlated"</code>. Similar to <code>nbclass</code> argument in <code><a href="SpatialPack.html#topic+modified.ttest">modified.ttest</a></code>. The default is 30.</p>
</td></tr>
<tr><td><code id="gating_+3A_plot_gate">plot_gate</code></td>
<td>
<p>Logical. If <code>TRUE</code>, the output includes basic data visualizations.</p>
</td></tr>
<tr><td><code id="gating_+3A_save_gate">save_gate</code></td>
<td>
<p>Logical. If <code>TRUE</code>, the output saves each visualization as a separate PNG file.</p>
</td></tr>
<tr><td><code id="gating_+3A_name_gate">name_gate</code></td>
<td>
<p>Optional, character. The filename of the visualization(s). The default is &quot;gate_k&quot; where &quot;k&quot; is the gate number.</p>
</td></tr>
<tr><td><code id="gating_+3A_path_gate">path_gate</code></td>
<td>
<p>Optional, character. The path of the visualization(s). The default is the current working directory.</p>
</td></tr>
<tr><td><code id="gating_+3A_rcols">rcols</code></td>
<td>
<p>Character string of length three (3) specifying the colors for: 1) group A (numerator), 2) neither, and 3) group B (denominator) designations. The defaults are <code>c("#FF0000", "#cccccc", "#0000FF")</code> or <code>c("red", "grey80", "blue")</code>.</p>
</td></tr>
<tr><td><code id="gating_+3A_lower_lrr">lower_lrr</code></td>
<td>
<p>Optional, numeric. Lower cut-off value for the log relative risk value in the color key (typically a negative value). The default is no limit, and the color key will include the minimum value of the log relative risk surface.</p>
</td></tr>
<tr><td><code id="gating_+3A_upper_lrr">upper_lrr</code></td>
<td>
<p>Optional, numeric. Upper cut-off value for the log relative risk value in the color key (typically a positive value). The default is no limit, and the color key will include the maximum value of the log relative risk surface.</p>
</td></tr>
<tr><td><code id="gating_+3A_c1n">c1n</code></td>
<td>
<p>Optional, character. The name of the level for the numerator of condition A. The default is NULL, and the first level is treated as the numerator.</p>
</td></tr>
<tr><td><code id="gating_+3A_c2n">c2n</code></td>
<td>
<p>Optional, character. The name of the level for the numerator of condition B. The default is NULL, and the first level is treated as the numerator.</p>
</td></tr>
<tr><td><code id="gating_+3A_win">win</code></td>
<td>
<p>Optional. Object of class <code>owin</code> for a custom two-dimensional window within which to estimate the surfaces. The default is NULL and calculates a convex hull around the data.</p>
</td></tr>
<tr><td><code id="gating_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="sparr.html#topic+risk">risk</a></code> to select resolution.</p>
</td></tr>
<tr><td><code id="gating_+3A_doplot">doplot</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a> <code>doplot</code> is no longer supported and has been renamed <code>plot_gate</code>.</p>
</td></tr>
<tr><td><code id="gating_+3A_verbose">verbose</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a> <code>verbose</code> is no longer supported; this function will not display verbose output from internal <code><a href="sparr.html#topic+risk">risk</a></code> function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function performs a sequential gating strategy for mass cytometry data comparing two levels with one or two conditions. Gates are typically two-dimensional space comprised of two fluorescent markers. The two-level comparison allows for the estimation of a spatial relative risk function and the computation of p-value based on an assumption of asymptotic normality. Cells within statistically significant areas are extracted and used in the next gate. This function relies heavily upon the <code><a href="sparr.html#topic+risk">risk</a></code> function. Basic visualization is available if <code>plot_gate = TRUE</code>.
</p>
<p>The <code>vars</code> argument must be a vector with an even-numbered length where the odd-numbered elements are the markers used on the x-axis of a gate, and the even-numbered elements are the markers used on the y-axis of a gate. For example, if <code>vars = c("V1", "V2", "V3", and "V4")</code> then the first gate is &quot;V1&quot; on the x-axis and &quot;V2&quot; on the y-axis and then the second gate is V3&quot; on the x-axis and &quot;V4&quot; on the y-axis. Makers can be repeated in successive gates.
</p>
<p>The <code>n_condition</code> argument specifies if the gating strategy is performed for one condition or two conditions. If <code>n_condition = 1</code>, then the function performs a one condition gating strategy using the internal <code>rrs</code> function, which computes the statistically significant areas (clusters) of a relative risk surface at each gate and selects the cells within the clusters specified by the <code>numerator</code> argument. If <code>n_condition = 2</code>, then the function performs a two conditions gating strategy using the internal <code>lotrrs</code> function, which computes the statistically significant areas (clusters) of a ratio of relative risk surfaces at each gate and selects the cells within the clusters specified by the <code>numerator</code> argument. The condition variable(s) within <code>dat</code> must be of class 'factor' with two levels. The first level is considered the numerator (i.e., &quot;case&quot;) value, and the second level is considered the denominator (i.e., &quot;control&quot;) value. The levels can also be specified using the <code>c1n</code> and <code>c2n</code> parameters. See the documentation for the internal <code>rrs</code> and <code>lotrrs</code> functions for more details.
</p>
<p>The p-value surface of the ratio of relative risk surfaces is estimated assuming asymptotic normality of the ratio value at each gridded knot. The bandwidth is fixed across all layers.
</p>
<p>Provides functionality for a correction for multiple testing. If <code>p_correct = "FDR"</code>, calculates a False Discovery Rate by Benjamini and Hochberg. If <code>p_correct = "uncorrelated Sidak"</code>, calculates an independent Sidak correction. If <code>p_correct = "uncorrelated Bonferroni"</code>, calculates an independent Bonferroni correction. If <code>p_correct = "correlated Sidak"</code> or if <code>p_correct = "correlated Bonferroni"</code>, then the corrections take into account the into account the spatial correlation of the surface. (NOTE: If <code>p_correct = "correlated Sidak"</code> or if <code>p_correct = "correlated Bonferroni"</code>, it may take a considerable amount of computation resources and time to calculate). If <code>p_correct = "Adler and Hasofer"</code> or if <code>p_correct = "Friston"</code>, then calculates a correction based on Random Field Theory. If <code>p_correct = "none"</code> (the default), then the function does not account for multiple testing and uses the uncorrected <code>alpha</code> level. See the internal <code>pval_correct</code> function documentation for more details.
</p>


<h3>Value</h3>

<p>An object of class <code>list</code>. This is a named list with the following components:
</p>

<dl>
<dt><code>obs</code></dt><dd><p>An object of class 'tibble' of the same features as <code>dat</code> that includes the information for the cells extracted with significant clusters in the final gate.</p>
</dd>
<dt><code>n</code></dt><dd><p>An object of class 'list' of the sample size of cells at each gate. The length is equal to the number of successful gates plus the final result.</p>
</dd>
<dt><code>gate</code></dt><dd><p>An object of class 'list' of 'rrs' objects from each gate. The length is equal to the number of successful gates.</p>
</dd>
<dt><code>note</code></dt><dd><p>An object of class 'character' of the gating diagnostic message.</p>
</dd>
</dl>

<p>The objects of class 'rrs' is similar to the output of the <code><a href="sparr.html#topic+risk">risk</a></code> function with two additional components:
</p>

<dl>
<dt><code>rr</code></dt><dd><p>An object of class 'im' with the relative risk surface.</p>
</dd>
<dt><code>f</code></dt><dd><p>An object of class 'im' with the spatial density of the numerator.</p>
</dd>
<dt><code>g</code></dt><dd><p>An object of class 'im' with the spatial density of the denominator.</p>
</dd>
<dt><code>P</code></dt><dd><p>An object of class 'im' with the asymptotic p-value surface.</p>
</dd>
<dt><code>lrr</code></dt><dd><p>An object of class 'im' with the log relative risk surface.</p>
</dd>
<dt><code>alpha</code></dt><dd><p>A numeric value for the alpha level used within the gate.</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>if (interactive()) {
## Single condition, no multiple testing correction
  test_gate &lt;- gating(dat = randCyto,
                      vars = c("arcsinh_CD4", "arcsinh_CD38",
                               "arcsinh_CD8", "arcsinh_CD3"),
                      n_condition = 1)
}

</code></pre>

<hr>
<h2 id='lotrrs'>A single gate for two conditions</h2><span id='topic+lotrrs'></span>

<h3>Description</h3>

<p>Estimates a ratio of relative risk surfaces and computes the asymptotic p-value surface for a single gate with two conditions. Includes features for basic visualization. This function is used internally within the <code><a href="#topic+gating">gating</a></code> function to extract the points within the significant areas. This function can also be used as a standalone function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lotrrs(
  dat,
  bandw = NULL,
  alpha = 0.05,
  p_correct = "none",
  nbc = NULL,
  plot_gate = FALSE,
  save_gate = FALSE,
  name_gate = NULL,
  path_gate = NULL,
  rcols = c("#FF0000", "#CCCCCC", "#0000FF"),
  lower_lrr = NULL,
  upper_lrr = NULL,
  c1n = NULL,
  c2n = NULL,
  win = NULL,
  ...,
  doplot = lifecycle::deprecated(),
  verbose = lifecycle::deprecated()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lotrrs_+3A_dat">dat</code></td>
<td>
<p>Input data frame flow cytometry data with five (5) features (columns): 1) ID, 2) Condition A ID, 3) Condition B ID, 4) Marker A as x-coordinate, 5) Marker B as y-coordinate.</p>
</td></tr>
<tr><td><code id="lotrrs_+3A_bandw">bandw</code></td>
<td>
<p>Optional, numeric. Fixed bandwidth for the kernel density estimation. Default is based on the internal <code>[sparr]{OS}</code> function.</p>
</td></tr>
<tr><td><code id="lotrrs_+3A_alpha">alpha</code></td>
<td>
<p>Numeric. The two-tailed alpha level for significance threshold (default is 0.05).</p>
</td></tr>
<tr><td><code id="lotrrs_+3A_p_correct">p_correct</code></td>
<td>
<p>Optional. Character string specifying whether to apply a correction for multiple comparisons including a False Discovery Rate <code>p_correct = "FDR"</code>, a spatially dependent Sidak correction <code>p_correct = "correlated Sidak"</code>, a spatially dependent Bonferroni correction <code>p_correct = "correlated Bonferroni"</code>, an independent Sidak correction <code>p_correct = "uncorrelated Sidak"</code>, an independent Bonferroni correction <code>p_correct = "uncorrelated Bonferroni"</code>, and a correction based on Random Field Theory using an equation by Adler and Hasofer <code>p_correct = "Adler and Hasofer"</code> or an equation by Friston et al. <code>p_correct = "Friston"</code>. If <code>p_correct = "none"</code> (the default), then no correction is applied.</p>
</td></tr>
<tr><td><code id="lotrrs_+3A_nbc">nbc</code></td>
<td>
<p>Optional. An integer for the number of bins when <code>p_correct = "correlated"</code>. Similar to <code>nbclass</code> argument in <code><a href="SpatialPack.html#topic+modified.ttest">modified.ttest</a></code>. The default is 30.</p>
</td></tr>
<tr><td><code id="lotrrs_+3A_plot_gate">plot_gate</code></td>
<td>
<p>Logical. If <code>TRUE</code>, the output includes basic data visualization.</p>
</td></tr>
<tr><td><code id="lotrrs_+3A_save_gate">save_gate</code></td>
<td>
<p>Logical. If <code>TRUE</code>, the output saves the visualization as a separate PNG file.</p>
</td></tr>
<tr><td><code id="lotrrs_+3A_name_gate">name_gate</code></td>
<td>
<p>Optional, character. The filename of the visualization. The default is &quot;gate&quot;.</p>
</td></tr>
<tr><td><code id="lotrrs_+3A_path_gate">path_gate</code></td>
<td>
<p>Optional, character. The path of the visualization. The default is the current working directory.</p>
</td></tr>
<tr><td><code id="lotrrs_+3A_rcols">rcols</code></td>
<td>
<p>Character string of length three (3) specifying the colors for: 1) group A (numerator), 2) neither, and 3) group B (denominator) designations. The defaults are <code>c("#FF0000", "#cccccc", "#0000FF")</code> or <code>c("red", "grey80", "blue")</code>.</p>
</td></tr>
<tr><td><code id="lotrrs_+3A_lower_lrr">lower_lrr</code></td>
<td>
<p>Optional, numeric. Lower cut-off value for the log relative risk value in the color key (typically a negative value). The default is no limit, and the color key will include the minimum value of the log relative risk surface.</p>
</td></tr>
<tr><td><code id="lotrrs_+3A_upper_lrr">upper_lrr</code></td>
<td>
<p>Optional, numeric. Upper cut-off value for the log relative risk value in the color key (typically a positive value). The default is no limit, and the color key will include the maximum value of the log relative risk surface.</p>
</td></tr>
<tr><td><code id="lotrrs_+3A_c1n">c1n</code></td>
<td>
<p>Optional, character. The name of the level for the numerator of condition A. The default is NULL, and the first level is treated as the numerator.</p>
</td></tr>
<tr><td><code id="lotrrs_+3A_c2n">c2n</code></td>
<td>
<p>Optional, character. The name of the level for the numerator of condition B. The default is NULL, and the first level is treated as the numerator.</p>
</td></tr>
<tr><td><code id="lotrrs_+3A_win">win</code></td>
<td>
<p>Optional. Object of class <code>owin</code> for a custom two-dimensional window within which to estimate the surfaces. The default is NULL and calculates a convex hull around the data.</p>
</td></tr>
<tr><td><code id="lotrrs_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="sparr.html#topic+risk">risk</a></code> to select resolution.</p>
</td></tr>
<tr><td><code id="lotrrs_+3A_doplot">doplot</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a> <code>doplot</code> is no longer supported and has been renamed <code>plot_gate</code>.</p>
</td></tr>
<tr><td><code id="lotrrs_+3A_verbose">verbose</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a> <code>verbose</code> is no longer supported; this function will not display verbose output from internal <code><a href="sparr.html#topic+risk">risk</a></code> function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function estimates a ratio of relative risk surfaces and computes the asymptotic p-value surface for a single gate with two conditions using three successive <code><a href="sparr.html#topic+risk">risk</a></code> functions. A relative risk surface is estimated for Condition A at each level of Condition B, and then a ratio of the two relative risk surfaces is computed.
</p>
<p style="text-align: center;"><code class="reqn">RR_{Condition B1} = \frac{Condition A2 of B1}{Condition A1 of B1}</code>
</p>

<p style="text-align: center;"><code class="reqn">RR_{Condition B2} = \frac{Condition A2 of B2}{Condition A1 of B2}</code>
</p>

<p style="text-align: center;"><code class="reqn">ln(rRR) = ln\left (\frac{RR_{Condition B2}}{CRR_{Condition B2}}\right )</code>
</p>

<p>The p-value surface of the ratio of relative risk surfaces is estimated assuming asymptotic normality of the ratio value at each gridded knot. The bandwidth is fixed across all layers. Basic visualization is available if <code>plot_gate = TRUE</code>.
</p>
<p>Provides functionality for a correction for multiple testing. If <code>p_correct = "FDR"</code>, calculates a False Discovery Rate by Benjamini and Hochberg. If <code>p_correct = "uncorrelated Sidak"</code>, calculates an independent Sidak correction. If <code>p_correct = "uncorrelated Bonferroni"</code>, calculates an independent Bonferroni correction. If <code>p_correct = "correlated Sidak"</code> or if <code>p_correct = "correlated Bonferroni"</code>, then the corrections take into account the into account the spatial correlation of the surface. (NOTE: If <code>p_correct = "correlated Sidak"</code> or if <code>p_correct = "correlated Bonferroni"</code>, it may take a considerable amount of computation resources and time to calculate). If <code>p_correct = "Adler and Hasofer"</code> or if <code>p_correct = "Friston"</code>, then calculates a correction based on Random Field Theory. If <code>p_correct = "none"</code> (the default), then the function does not account for multiple testing and uses the uncorrected <code>alpha</code> level. See the internal <code>pval_correct</code> function documentation for more details.
</p>
<p>The two condition variables (Condition A and Condition B) within <code>dat</code> must be of class 'factor' with two levels. The first level in each variable is considered the numerator (i.e., &quot;case&quot;) value, and the second level is considered the denominator (i.e., &quot;control&quot;) value. The levels can also be specified using the <code>c1n</code> and <code>c2n</code> parameters.
</p>


<h3>Value</h3>

<p>An object of class 'list' where each element is a object of class 'rrs' created by the <code><a href="sparr.html#topic+risk">risk</a></code> function with two additional components:
</p>

<dl>
<dt><code>rr</code></dt><dd><p>An object of class 'im' with the relative risk surface.</p>
</dd>
<dt><code>f</code></dt><dd><p>An object of class 'im' with the spatial density of the numerator.</p>
</dd>
<dt><code>g</code></dt><dd><p>An object of class 'im' with the spatial density of the denominator.</p>
</dd>
<dt><code>P</code></dt><dd><p>An object of class 'im' with the asymptotic p-value surface.</p>
</dd>
<dt><code>lrr</code></dt><dd><p>An object of class 'im' with the log relative risk surface.</p>
</dd>
<dt><code>alpha</code></dt><dd><p>A numeric value for the alpha level used within the gate.</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>test_lotrrs &lt;- lotrrs(dat = randCyto)

</code></pre>

<hr>
<h2 id='lrr_plot'>Prepare log relative risk values for plotting with a diverging color palette</h2><span id='topic+lrr_plot'></span>

<h3>Description</h3>

<p>Internal function to convert an object of class 'im' to values readable by <code><a href="fields.html#topic+image.plot">image.plot</a></code> function within the <code><a href="#topic+rrs">rrs</a></code> and <code><a href="#topic+lotrrs">lotrrs</a></code> functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lrr_plot(
  input,
  cols,
  midpoint = 0,
  lower_lrr = NULL,
  upper_lrr = NULL,
  digits = 1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lrr_plot_+3A_input">input</code></td>
<td>
<p>An object of class 'rrs' from the <code><a href="#topic+rrs">rrs</a></code> or <code><a href="#topic+lotrrs">lotrrs</a></code> function.</p>
</td></tr>
<tr><td><code id="lrr_plot_+3A_cols">cols</code></td>
<td>
<p>Character string of length three (3) specifying the colors for plotting: 1) numerator, 2) insignificant, and 3) denominator from the <code><a href="#topic+rrs">rrs</a></code> or <code><a href="#topic+lotrrs">lotrrs</a></code>  function.</p>
</td></tr>
<tr><td><code id="lrr_plot_+3A_midpoint">midpoint</code></td>
<td>
<p>Numeric. The value to center the diverging color palette.</p>
</td></tr>
<tr><td><code id="lrr_plot_+3A_lower_lrr">lower_lrr</code></td>
<td>
<p>Numeric. The lower value to concatenate the color key. The default (NULL) uses the minimum value from <code>input</code>.</p>
</td></tr>
<tr><td><code id="lrr_plot_+3A_upper_lrr">upper_lrr</code></td>
<td>
<p>Numeric. The upper value to concatenate the color key. The default (NULL) uses the maximum value from <code>input</code>.</p>
</td></tr>
<tr><td><code id="lrr_plot_+3A_digits">digits</code></td>
<td>
<p>Integer. The number of significant digits for the labels using the <code>round</code> function (default is 1).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class 'list'. This is a named list with the following components:
</p>

<dl>
<dt><code>v</code></dt><dd><p>An object of class 'SpatRaster' for the estimated gating surface.</p>
</dd>
<dt><code>cols</code></dt><dd><p>An object of class 'vector', returns diverging color palette values.</p>
</dd>
<dt><code>breaks</code></dt><dd><p>An object of class 'vector', returns diverging color palette breaks.</p>
</dd>
<dt><code>at</code></dt><dd><p>An object of class 'vector', returns legend breaks.</p>
</dd>
<dt><code>labels</code></dt><dd><p>An object of class 'vector', returns legend labels.</p>
</dd>
</dl>


<hr>
<h2 id='pval_correct'>Calculate p-value corrections for multiple testing</h2><span id='topic+pval_correct'></span>

<h3>Description</h3>

<p>Internal function to calculate various p-value corrections for use within the <code><a href="#topic+rrs">rrs</a></code> and <code><a href="#topic+lotrrs">lotrrs</a></code> functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pval_correct(
  input,
  type = c("FDR", "correlated Sidak", "correlated Bonferroni", "uncorrelated Sidak",
    "uncorrelated Bonferroni", "Adler and Hasofer", "Friston"),
  alpha = 0.05,
  nbc = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pval_correct_+3A_input">input</code></td>
<td>
<p>An object of class 'rrs' from the <code><a href="#topic+rrs">rrs</a></code> or <code><a href="#topic+lotrrs">lotrrs</a></code> function.</p>
</td></tr>
<tr><td><code id="pval_correct_+3A_type">type</code></td>
<td>
<p>Character string specifying which correction for multiple comparisons. Options include a False Discovery Rate <code>p_correct = "FDR"</code>, a spatially dependent Sidak correction <code>p_correct = "correlated Sidak"</code>, a spatially dependent Bonferroni correction <code>p_correct = "correlated Bonferroni"</code>, an independent Sidak correction <code>p_correct = "uncorrelated Sidak"</code>, an independent Bonferroni correction <code>p_correct = "uncorrelated Bonferroni"</code>, a Adler and Hasofer equation for the maximum of a Gaussian random field <code>p_correct = "Adler and Hasofer"</code>, and a Friston et al. equation for the maximum of a Gaussian random field <code>p_correct = "Friston"</code>.</p>
</td></tr>
<tr><td><code id="pval_correct_+3A_alpha">alpha</code></td>
<td>
<p>Numeric. The two-tailed alpha level for significance threshold (default in <code><a href="#topic+rrs">rrs</a></code> and <code><a href="#topic+lotrrs">lotrrs</a></code> functions is 0.05).</p>
</td></tr>
<tr><td><code id="pval_correct_+3A_nbc">nbc</code></td>
<td>
<p>Integer. The number of bins. Similar to <code>nbclass</code> argument in <code><a href="SpatialPack.html#topic+modified.ttest">modified.ttest</a></code> function. The default is 30.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function provides functionality for multiple testing correction in five ways:
</p>

<ol>
<li><p> Computes a False Discovery Rate by Benjamini and Hochberg <a href="https://doi.org/10.1111/j.2517-6161.1995.tb02031.x">doi:10.1111/j.2517-6161.1995.tb02031.x</a> (<code>p_correct = "FDR"</code>) by: 1) sorting the p-values (p_i) of each knot in ascending order (p_1 &lt;= p_2 &lt;= ... &lt;= p_m), 2) starting from p_m find the first p_i for which p_i &lt;= (i/m) * alpha.
</p>
</li>
<li><p> Computes an independent Sidak correction <a href="https://doi.org/10.2307/2283989">doi:10.2307/2283989</a> (<code>p_correct = "uncorrelated Sidak"</code>) by 1 - (1 - <code>alpha</code>) ^ (1 / total number of gridded knots across the estimated surface). The default in the <code><a href="sparr.html#topic+risk">risk</a></code> function is a resolution of 128 x 128 or n = 16,384 knots and a custom resolution can be specified using the <code>resolution</code> argument within the <code><a href="sparr.html#topic+risk">risk</a></code> function.
</p>
</li>
<li><p> Computes an independent Bonferroni correction (<code>p_correct = "uncorrelated Bonferroni"</code>) by <code>alpha</code> / total number of gridded knots across the estimated surface. The default in the <code><a href="sparr.html#topic+risk">risk</a></code> function is a resolution of 128 x 128 or n = 16,384 knots and a custom resolution can be specified using the <code>resolution</code> argument within the <code><a href="sparr.html#topic+risk">risk</a></code> function.
</p>
</li>
<li><p> Computes a spatially dependent Sidak correction (<code>p_correct = "correlated Sidak"</code>) by taking into account the spatial correlation of the relative risk surface values (if using the <code>rrs</code> function for a single condition gate) or the ratio of relative risk surfaces values (if using the <code>lotrrs</code> function for a two condition gate). The correction uses the minimum number of knots that are not spatially correlated instead of the total number of knots. The minimum number of knots that are not spatially correlated is computed by counting the knots that are a distance apart that exceeds the minimum distance of non-significant spatial correlation based on a correlogram using the <code><a href="SpatialPack.html#topic+modified.ttest">modified.ttest</a></code> function.
</p>
</li>
<li><p> Computes a spatially dependent Bonferroni correction (<code>p_correct = "correlated Bonferroni"</code>) by taking into account the spatial correlation of the relative risk surface values (if using the <code>rrs</code> function for a single condition gate) or the ratio of relative risk surfaces values (if using the <code>lotrrs</code> function for a two condition gate). The correction uses the minimum number of knots that are not spatially correlated instead of the total number of knots. The minimum number of knots that are not spatially correlated is computed by counting the knots that are a distance apart that exceeds the minimum distance of non-significant spatial correlation based on a correlogram using the <code><a href="SpatialPack.html#topic+modified.ttest">modified.ttest</a></code> function.
</p>
</li>
<li><p> Computes a critical p-value based on Random Field Theory and the Adler and Hasofer equation (<code>p_correct = "Euler A&amp;H"</code>) <a href="https://doi.org/10.1214/aop/1176996176">doi:10.1214/aop/1176996176</a> and p.111 of <a href="https://doi.org/10.1137/1.9780898718980">doi:10.1137/1.9780898718980</a>. The correction uses the number of knots that are independent based on the bandwidth used in the kernel density estimation of the spatial relative risk function.
</p>
</li>
<li><p> Computes a critical p-value based on Random Field Theory and the Friston et al. equation (<code>p_correct = "Euler Friston"</code>) <a href="https://doi.org/10.1038/jcbfm.1991.122">doi:10.1038/jcbfm.1991.122</a> which differs from Adler and Hasofer's equation by a factor of 0.79. The correction uses the number of knots that are independent based on the bandwidth used in the kernel density estimation of the spatial relative risk function.
</p>
</li></ol>



<h3>Value</h3>

<p>An object of class 'numeric' with the corrected alpha level.
</p>

<hr>
<h2 id='pval_plot'>Prepare significant p-values for plotting</h2><span id='topic+pval_plot'></span>

<h3>Description</h3>

<p>Internal function to convert an object of class 'im' to values readable by <code><a href="fields.html#topic+image.plot">image.plot</a></code> function within the <code><a href="#topic+rrs">rrs</a></code>, <code><a href="#topic+lotrrs">lotrrs</a></code>, and <code><a href="#topic+gating">gating</a></code> functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pval_plot(input, alpha)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pval_plot_+3A_input">input</code></td>
<td>
<p>An object of class 'rrs' from the <code><a href="#topic+rrs">rrs</a></code> or <code><a href="#topic+lotrrs">lotrrs</a></code> function.</p>
</td></tr>
<tr><td><code id="pval_plot_+3A_alpha">alpha</code></td>
<td>
<p>Numeric. The two-tailed alpha level for significance threshold (default in <code><a href="#topic+rrs">rrs</a></code>, <code><a href="#topic+lotrrs">lotrrs</a></code>, and <code><a href="#topic+gating">gating</a></code> functions is 0.05).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class 'SpatRaster' with categorical values:
</p>

<ul>
<li><p> A value of 1: Significant numerator.
</p>
</li>
<li><p> A value of 2: Insignificant.
</p>
</li>
<li><p> A value of 3: Significant denominator.
</p>
</li></ul>


<hr>
<h2 id='randCyto'>Subset of the 'extdata' data in the 'flowWorkspaceData' package</h2><span id='topic+randCyto'></span>

<h3>Description</h3>

<p>A sample dataset containing information about flow cytometry data with two binary conditions and four markers. The data are a random subset of the 'extdata' data in the 'flowWorkspaceData' package found on Bioconductor <a href="https://bioconductor.org/packages/release/data/experiment/html/flowWorkspaceData.html">https://bioconductor.org/packages/release/data/experiment/html/flowWorkspaceData.html</a> and formatted for 'gateR' input. The selected markers are arcsinh transformed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>randCyto
</code></pre>


<h3>Format</h3>

<p>A data frame with 11763 rows and 7 variables:
</p>

<dl>
<dt>id</dt><dd><p>cell ID number</p>
</dd>
<dt>g1</dt><dd><p>binary condition #1</p>
</dd>
<dt>g2</dt><dd><p>binary condition #2</p>
</dd>
<dt>arcsinh_CD4</dt><dd><p>arcsinh-transformed CD4</p>
</dd>
<dt>arcsinh_CD38</dt><dd><p>arcsinh-transformed CD38</p>
</dd>
<dt>arcsinh_CD8</dt><dd><p>arcsinh-transformed CD8</p>
</dd>
<dt>arcsinh_CD3</dt><dd><p>arcsinh-transformed CD3</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://github.com/lance-waller-lab/gateR/blob/master/README.md">https://github.com/lance-waller-lab/gateR/blob/master/README.md</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>head(randCyto)

</code></pre>

<hr>
<h2 id='rrs'>A single gate for a single condition</h2><span id='topic+rrs'></span>

<h3>Description</h3>

<p>Estimates a relative risk surface and computes the asymptotic p-value surface for a single gate with a single condition, including features for basic visualization. This function is used internally within the <code><a href="#topic+gating">gating</a></code> function to extract the points within the significant areas. This function can also be used as a standalone function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rrs(
  dat,
  bandw = NULL,
  alpha = 0.05,
  p_correct = "none",
  nbc = NULL,
  plot_gate = FALSE,
  save_gate = FALSE,
  name_gate = NULL,
  path_gate = NULL,
  rcols = c("#FF0000", "#CCCCCC", "#0000FF"),
  lower_lrr = NULL,
  upper_lrr = NULL,
  c1n = NULL,
  win = NULL,
  ...,
  doplot = lifecycle::deprecated(),
  verbose = lifecycle::deprecated()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rrs_+3A_dat">dat</code></td>
<td>
<p>Input data frame flow cytometry data with four (4) features (columns): 1) ID, 2) Condition A ID, 3) Marker A as x-coordinate, 4) Marker B as y-coordinate.</p>
</td></tr>
<tr><td><code id="rrs_+3A_bandw">bandw</code></td>
<td>
<p>Optional, numeric. Fixed bandwidth for the kernel density estimation. Default is based on the internal <code>[sparr]{OS}</code> function.</p>
</td></tr>
<tr><td><code id="rrs_+3A_alpha">alpha</code></td>
<td>
<p>Numeric. The two-tailed alpha level for significance threshold (default is 0.05).</p>
</td></tr>
<tr><td><code id="rrs_+3A_p_correct">p_correct</code></td>
<td>
<p>Optional. Character string specifying whether to apply a correction for multiple comparisons including a False Discovery Rate <code>p_correct = "FDR"</code>, a spatially dependent Sidak correction <code>p_correct = "correlated Sidak"</code>, a spatially dependent Bonferroni correction <code>p_correct = "correlated Bonferroni"</code>, an independent Sidak correction <code>p_correct = "uncorrelated Sidak"</code>, an independent Bonferroni correction <code>p_correct = "uncorrelated Bonferroni"</code>, and a correction based on Random Field Theory using an equation by Adler and Hasofer <code>p_correct = "Adler and Hasofer"</code> or an equation by Friston et al. <code>p_correct = "Friston"</code>. If <code>p_correct = "none"</code> (the default), then no correction is applied.</p>
</td></tr>
<tr><td><code id="rrs_+3A_nbc">nbc</code></td>
<td>
<p>Optional. An integer for the number of bins when <code>p_correct = "correlated"</code>. Similar to <code>nbclass</code> argument in <code><a href="SpatialPack.html#topic+modified.ttest">modified.ttest</a></code>. The default is 30.</p>
</td></tr>
<tr><td><code id="rrs_+3A_plot_gate">plot_gate</code></td>
<td>
<p>Logical. If <code>TRUE</code>, the output includes basic data visualization.</p>
</td></tr>
<tr><td><code id="rrs_+3A_save_gate">save_gate</code></td>
<td>
<p>Logical. If <code>TRUE</code>, the output saves the visualization as a separate PNG file.</p>
</td></tr>
<tr><td><code id="rrs_+3A_name_gate">name_gate</code></td>
<td>
<p>Optional, character. The filename of the visualization. The default is &quot;gate&quot;.</p>
</td></tr>
<tr><td><code id="rrs_+3A_path_gate">path_gate</code></td>
<td>
<p>Optional, character. The path of the visualization. The default is the current working directory.</p>
</td></tr>
<tr><td><code id="rrs_+3A_rcols">rcols</code></td>
<td>
<p>Character string of length three (3) specifying the colors for: 1) group A (numerator), 2) neither, and 3) group B (denominator) designations. The defaults are <code>c("#FF0000", "#cccccc", "#0000FF")</code> or <code>c("red", "grey80", "blue")</code>.</p>
</td></tr>
<tr><td><code id="rrs_+3A_lower_lrr">lower_lrr</code></td>
<td>
<p>Optional, numeric. Lower cut-off value for the log relative risk value in the color key (typically a negative value). The default is no limit, and the color key will include the minimum value of the log relative risk surface.</p>
</td></tr>
<tr><td><code id="rrs_+3A_upper_lrr">upper_lrr</code></td>
<td>
<p>Optional, numeric. Upper cut-off value for the log relative risk value in the color key (typically a positive value). The default is no limit, and the color key will include the maximum value of the log relative risk surface.</p>
</td></tr>
<tr><td><code id="rrs_+3A_c1n">c1n</code></td>
<td>
<p>Optional, character. The name of the level for the numerator of condition A. The default is NULL, and the first level is treated as the numerator.</p>
</td></tr>
<tr><td><code id="rrs_+3A_win">win</code></td>
<td>
<p>Optional. Object of class <code>owin</code> for a custom two-dimensional window within which to estimate the surfaces. The default is NULL and calculates a convex hull around the data.</p>
</td></tr>
<tr><td><code id="rrs_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="sparr.html#topic+risk">risk</a></code> to select resolution.</p>
</td></tr>
<tr><td><code id="rrs_+3A_doplot">doplot</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a> <code>doplot</code> is no longer supported and has been renamed <code>plot_gate</code>.</p>
</td></tr>
<tr><td><code id="rrs_+3A_verbose">verbose</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a> <code>verbose</code> is no longer supported; this function will not display verbose output from internal <code><a href="sparr.html#topic+risk">risk</a></code> function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function estimates a relative risk surface and computes the asymptotic p-value surface for a single gate and single condition using the <code><a href="sparr.html#topic+risk">risk</a></code> function. Bandwidth is fixed across both layers (numerator and denominator spatial densities). Basic visualization is available if <code>plot_gate = TRUE</code>.
</p>
<p>Provides functionality for a correction for multiple testing. If <code>p_correct = "FDR"</code>, calculates a False Discovery Rate by Benjamini and Hochberg. If <code>p_correct = "uncorrelated Sidak"</code>, calculates an independent Sidak correction. If <code>p_correct = "uncorrelated Bonferroni"</code>, calculates an independent Bonferroni correction. If <code>p_correct = "correlated Sidak"</code> or if <code>p_correct = "correlated Bonferroni"</code>, then the corrections take into account the into account the spatial correlation of the surface. (NOTE: If <code>p_correct = "correlated Sidak"</code> or if <code>p_correct = "correlated Bonferroni"</code>, it may take a considerable amount of computation resources and time to calculate). If <code>p_correct = "Adler and Hasofer"</code> or if <code>p_correct = "Friston"</code>, then calculates a correction based on Random Field Theory. If <code>p_correct = "none"</code> (the default), then the function does not account for multiple testing and uses the uncorrected <code>alpha</code> level. See the internal <code>pval_correct</code> function documentation for more details.
</p>
<p>The condition variable (Condition A) within <code>dat</code> must be of class 'factor' with two levels. The first level is considered the numerator (i.e., &quot;case&quot;) value, and the second level is considered the denominator (i.e., &quot;control&quot;) value. The level can also be specified using the <code>c1n</code> parameter.
</p>


<h3>Value</h3>

<p>An object of class 'list' where each element is a object of class 'rrs' created by the <code><a href="sparr.html#topic+risk">risk</a></code> function with two additional components:
</p>

<dl>
<dt><code>rr</code></dt><dd><p>An object of class 'im' with the relative risk surface.</p>
</dd>
<dt><code>f</code></dt><dd><p>An object of class 'im' with the spatial density of the numerator.</p>
</dd>
<dt><code>g</code></dt><dd><p>An object of class 'im' with the spatial density of the denominator.</p>
</dd>
<dt><code>P</code></dt><dd><p>An object of class 'im' with the asymptotic p-value surface.</p>
</dd>
<dt><code>lrr</code></dt><dd><p>An object of class 'im' with the log relative risk surface.</p>
</dd>
<dt><code>alpha</code></dt><dd><p>A numeric value for the alpha level used within the gate.</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>test_rrs &lt;- rrs(dat = randCyto)
  
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
