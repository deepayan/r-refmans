<!DOCTYPE html><html><head><title>Help for package DtD</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {DtD}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#BS_call'><p>European Call Option Price and the Inverse</p></a></li>
<li><a href='#BS_fit'><p>Fit Black-Scholes Parameters</p></a></li>
<li><a href='#BS_fit_rolling'><p>Fit Black-Scholes Parameters Over Rolling Window</p></a></li>
<li><a href='#BS_sim'><p>Simulate Stock Price and Price of Underlying Asset</p></a></li>
<li><a href='#merton_ll'><p>Compute Log-Likelihood of Merton Model</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Distance to Default</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.2</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Benjamin Christoffersen &lt;boennecd@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides fast methods to work with Merton's distance to default 
  model introduced in Merton (1974) &lt;<a href="https://doi.org/10.1111%2Fj.1540-6261.1974.tb03058.x">doi:10.1111/j.1540-6261.1974.tb03058.x</a>&gt;. 
  The methods includes simulation and estimation of the parameters.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/boennecd/DtD/issues">https://github.com/boennecd/DtD/issues</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp, checkmate</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat, microbenchmark</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.0.1</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>C++11</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-02-11 08:17:16 UTC; boennecd</td>
</tr>
<tr>
<td>Author:</td>
<td>Benjamin Christoffersen [cre, aut],
  R-core [cph],
  Robert Gentleman [cph],
  Ross Ihaka [cph]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-02-11 08:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='BS_call'>European Call Option Price and the Inverse</h2><span id='topic+BS_call'></span><span id='topic+get_underlying'></span>

<h3>Description</h3>

<p>Computes the European call option and the inverse. All vectors
with length greater than one needs to have the same length.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BS_call(V, D, T., r, vol)

get_underlying(S, D, T., r, vol, tol = 1e-12)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="BS_call_+3A_v">V</code></td>
<td>
<p>numeric vector or scalar with price of the underlying asset.</p>
</td></tr>
<tr><td><code id="BS_call_+3A_d">D</code></td>
<td>
<p>numeric vector or scalar with debt due in <code>T.</code>.</p>
</td></tr>
<tr><td><code id="BS_call_+3A_t.">T.</code></td>
<td>
<p>numeric vector or scalar with time to maturity.</p>
</td></tr>
<tr><td><code id="BS_call_+3A_r">r</code></td>
<td>
<p>numeric vector or scalar with risk free rates.</p>
</td></tr>
<tr><td><code id="BS_call_+3A_vol">vol</code></td>
<td>
<p>numeric vector or scalar with volatilities, <code class="reqn">\sigma</code>s.</p>
</td></tr>
<tr><td><code id="BS_call_+3A_s">S</code></td>
<td>
<p>numeric vector with observed stock prices.</p>
</td></tr>
<tr><td><code id="BS_call_+3A_tol">tol</code></td>
<td>
<p>numeric scalar with tolerance to <code><a href="#topic+get_underlying">get_underlying</a></code>.
The difference is scaled  if the absolute of <code>S</code> is large than <code>tol</code>
as in the <code>tolerance</code> argument to <code><a href="base.html#topic+all.equal.numeric">all.equal.numeric</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric vector or scalar with price of the underlying asset or equity price.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+BS_fit">BS_fit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(DtD)
set.seed(58661382)
sims &lt;- BS_sim(
  vol = .2, mu = .03, dt = .1, V_0 = 100, T. = 1, D = rep(80, 20), r = .01)

stopifnot(with(
  sims, isTRUE(all.equal(V, get_underlying(S, D, T, r, vol)))))
stopifnot(with(
  sims, isTRUE(all.equal(S, BS_call(V, D, T, r, vol)))))

</code></pre>

<hr>
<h2 id='BS_fit'>Fit Black-Scholes Parameters</h2><span id='topic+BS_fit'></span>

<h3>Description</h3>

<p>Function to estimate the volatility, <code class="reqn">\sigma</code>, and drift, <code class="reqn">\mu</code>. See
<code>vignette("Distance-to-default", package = "DtD")</code> for details. All
vectors with length greater than one needs to have the same length. The
Nelder-Mead method from <code><a href="stats.html#topic+optim">optim</a></code> is used when
<code>method = "mle"</code>. Either <code>time</code> or <code>dt</code> should be passed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BS_fit(
  S,
  D,
  T.,
  r,
  time,
  dt,
  vol_start,
  method = c("iterative", "mle"),
  tol = 1e-12,
  eps = 1e-08
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="BS_fit_+3A_s">S</code></td>
<td>
<p>numeric vector with observed stock prices.</p>
</td></tr>
<tr><td><code id="BS_fit_+3A_d">D</code></td>
<td>
<p>numeric vector or scalar with debt due in <code>T.</code>.</p>
</td></tr>
<tr><td><code id="BS_fit_+3A_t.">T.</code></td>
<td>
<p>numeric vector or scalar with time to maturity.</p>
</td></tr>
<tr><td><code id="BS_fit_+3A_r">r</code></td>
<td>
<p>numeric vector or scalar with risk free rates.</p>
</td></tr>
<tr><td><code id="BS_fit_+3A_time">time</code></td>
<td>
<p>numeric vector with the observation times.</p>
</td></tr>
<tr><td><code id="BS_fit_+3A_dt">dt</code></td>
<td>
<p>numeric scalar with time increments between observations.</p>
</td></tr>
<tr><td><code id="BS_fit_+3A_vol_start">vol_start</code></td>
<td>
<p>numeric scalar with starting value for <code class="reqn">\sigma</code>.</p>
</td></tr>
<tr><td><code id="BS_fit_+3A_method">method</code></td>
<td>
<p>string to specify which estimation method to use.</p>
</td></tr>
<tr><td><code id="BS_fit_+3A_tol">tol</code></td>
<td>
<p>numeric scalar with tolerance to <code><a href="#topic+get_underlying">get_underlying</a></code>.
The difference is scaled  if the absolute of <code>S</code> is large than <code>tol</code>
as in the <code>tolerance</code> argument to <code><a href="base.html#topic+all.equal.numeric">all.equal.numeric</a></code>.</p>
</td></tr>
<tr><td><code id="BS_fit_+3A_eps">eps</code></td>
<td>
<p>numeric scalar with convergence threshold.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the following components
</p>
<table>
<tr><td><code>ests</code></td>
<td>
<p>estimates of <code class="reqn">\sigma</code>, and drift, <code class="reqn">\mu</code>.</p>
</td></tr>
<tr><td><code>n_iter</code></td>
<td>
<p>number of iterations when <code>method = "iterative"</code>
and number of log likelihood evaluations when <code>method = "mle"</code>.</p>
</td></tr>
<tr><td><code>success</code></td>
<td>
<p>logical for whether the estimation method converged.</p>
</td></tr>
</table>


<h3>Warning</h3>

<p>Choosing <code>tol &gt;= eps</code> or roughly equal may make the method alternate
between two solutions for some data sets.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(DtD)
set.seed(83486778)
sims &lt;- BS_sim(
  vol = .1, mu = .05, dt = .1, V_0 = 100, T. = 1, D = rep(80, 20), r = .01)

with(sims,
     BS_fit(S = S, D = D, T. = T, r = r, time = time, method = "mle"))

</code></pre>

<hr>
<h2 id='BS_fit_rolling'>Fit Black-Scholes Parameters Over Rolling Window</h2><span id='topic+BS_fit_rolling'></span>

<h3>Description</h3>

<p>Function to estimate the volatility, <code class="reqn">\sigma</code>, and drift, <code class="reqn">\mu</code>. E.g.,
the window can be over a given number of months. See
<code>vignette("Distance-to-default", package = "DtD")</code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BS_fit_rolling(
  S,
  D,
  T.,
  r,
  time,
  dt,
  vol_start,
  method = c("iterative", "mle"),
  tol = 1e-12,
  eps = 1e-08,
  grp,
  width,
  min_obs
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="BS_fit_rolling_+3A_s">S</code></td>
<td>
<p>numeric vector with observed stock prices.</p>
</td></tr>
<tr><td><code id="BS_fit_rolling_+3A_d">D</code></td>
<td>
<p>numeric vector or scalar with debt due in <code>T.</code>.</p>
</td></tr>
<tr><td><code id="BS_fit_rolling_+3A_t.">T.</code></td>
<td>
<p>numeric vector or scalar with time to maturity.</p>
</td></tr>
<tr><td><code id="BS_fit_rolling_+3A_r">r</code></td>
<td>
<p>numeric vector or scalar with risk free rates.</p>
</td></tr>
<tr><td><code id="BS_fit_rolling_+3A_time">time</code></td>
<td>
<p>numeric vector with the observation times.</p>
</td></tr>
<tr><td><code id="BS_fit_rolling_+3A_dt">dt</code></td>
<td>
<p>numeric scalar with time increments between observations.</p>
</td></tr>
<tr><td><code id="BS_fit_rolling_+3A_vol_start">vol_start</code></td>
<td>
<p>numeric scalar with starting value for <code class="reqn">\sigma</code>.</p>
</td></tr>
<tr><td><code id="BS_fit_rolling_+3A_method">method</code></td>
<td>
<p>string to specify which estimation method to use.</p>
</td></tr>
<tr><td><code id="BS_fit_rolling_+3A_tol">tol</code></td>
<td>
<p>numeric scalar with tolerance to <code><a href="#topic+get_underlying">get_underlying</a></code>.
The difference is scaled  if the absolute of <code>S</code> is large than <code>tol</code>
as in the <code>tolerance</code> argument to <code><a href="base.html#topic+all.equal.numeric">all.equal.numeric</a></code>.</p>
</td></tr>
<tr><td><code id="BS_fit_rolling_+3A_eps">eps</code></td>
<td>
<p>numeric scalar with convergence threshold.</p>
</td></tr>
<tr><td><code id="BS_fit_rolling_+3A_grp">grp</code></td>
<td>
<p>integer vector with the group identifier (e.g., units of
months).</p>
</td></tr>
<tr><td><code id="BS_fit_rolling_+3A_width">width</code></td>
<td>
<p>integer scalar with the units of <code>grp</code> to include in the
rolling window.</p>
</td></tr>
<tr><td><code id="BS_fit_rolling_+3A_min_obs">min_obs</code></td>
<td>
<p>integer scalar for the minimum number of observation required
in each window.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Matrix with the <code>grp</code>, number of observation in the window, parameter
estimates, and <code>'n_iter'</code> as in <code><a href="#topic+BS_fit">BS_fit</a></code>, and whether the
estimation method was successful.
</p>
<p>An <code>error</code> attribute is added in case other code than
<code><a href="stats.html#topic+optim">optim</a></code> fails. It is a list of lists with the <code>grp</code> index
where the method failed and the output from <code><a href="base.html#topic+try">try</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+BS_fit">BS_fit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate data
set.seed(55770945)
n &lt;- 21L * 3L * 12L # 21 trading days for 3 years w/ 12 months
sims &lt;- BS_sim(
  vol = .1, mu = .05, dt = .1, V_0 = 100, T. = 1,
  D = runif(n, 80, 90), r = runif(n, 0, .01))
sims$month &lt;- (1:nrow(sims) - 1L) %/% 21L + 1L

# throw out some months
sims &lt;- subset(sims, !month %in% 15:24)

# assign parameters
grp &lt;- sims$month
width &lt;- 12L        # window w/ 12 month width
min_obs &lt;- 21L * 3L # require 3 months of data

# estimate results with R loop which is slightly simpler then the
# implementation
grps &lt;- unique(grp)
out &lt;- matrix(
  NA_real_, nrow = length(grps), ncol = 6,
  dimnames = list(NULL, c("mu", "vol", "n_iter", "success", "n_obs", "grp")))
for(g in grps){
  idx &lt;- which(grps == g)
  keep &lt;- which(grp %in% (g - width + 1L):g)
  out[idx, c("n_obs", "grp")] &lt;- c(length(keep), g)
  if(length(keep) &lt; min_obs)
    next
  res &lt;- with(
    sims[keep, ],
    BS_fit(S = S, D = D, T. = T, r = r, time = time, method = "iterative",
           vol_start = 1))
  out[idx, c("mu", "vol", "n_iter", "success")] &lt;- rep(
    do.call(c, res[c("ests", "n_iter", "success")]), each = length(idx))
}

# we get the same with the R function
out_func &lt;- with(sims, BS_fit_rolling(
  S = S, D = D, T. = T, r = r, time = time, method = "iterative",
  grp = month, width = width, min_obs = min_obs))

all.equal(out[, names(out) != "n_iter"],
          out_func[, names(out_func) != "n_iter"])

</code></pre>

<hr>
<h2 id='BS_sim'>Simulate Stock Price and Price of Underlying Asset</h2><span id='topic+BS_sim'></span>

<h3>Description</h3>

<p>At least one of <code>D</code>, <code>r</code>, or <code>T.</code> needs to have
the desired length of the simulated series. All vectors with length greater
than one needs to have the same length.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BS_sim(vol, mu, dt, V_0, D, r, T.)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="BS_sim_+3A_vol">vol</code></td>
<td>
<p>numeric scalar with <code class="reqn">\sigma</code> value.</p>
</td></tr>
<tr><td><code id="BS_sim_+3A_mu">mu</code></td>
<td>
<p>numeric scalar with <code class="reqn">\mu</code> value.</p>
</td></tr>
<tr><td><code id="BS_sim_+3A_dt">dt</code></td>
<td>
<p>numeric scalar with time increments between observations.</p>
</td></tr>
<tr><td><code id="BS_sim_+3A_v_0">V_0</code></td>
<td>
<p>numeric scalar with starting value of the underlying asset, <code class="reqn">S_{0}</code>.</p>
</td></tr>
<tr><td><code id="BS_sim_+3A_d">D</code></td>
<td>
<p>numeric vector or scalar with debt due in <code>T.</code>.</p>
</td></tr>
<tr><td><code id="BS_sim_+3A_r">r</code></td>
<td>
<p>numeric vector or scalar with risk free rates.</p>
</td></tr>
<tr><td><code id="BS_sim_+3A_t.">T.</code></td>
<td>
<p>numeric vector or scalar with time to maturity.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+BS_fit">BS_fit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(DtD)
set.seed(79156879)
sims &lt;- BS_sim(
  vol = .1, mu = .05, dt = .2, V_0 = 100, T. = 1, D = rep(80, 20), r = .01)

# plot underlying
plot(sims$V)

# plot stock
plot(sims$S)

</code></pre>

<hr>
<h2 id='merton_ll'>Compute Log-Likelihood of Merton Model</h2><span id='topic+merton_ll'></span>

<h3>Description</h3>

<p>Computes the log-likelihood for a given values of <code class="reqn">\mu</code> and
<code class="reqn">\sigma</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>merton_ll(S, D, T., r, time, dt, vol, mu, tol = 1e-12)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="merton_ll_+3A_s">S</code></td>
<td>
<p>numeric vector with observed stock prices.</p>
</td></tr>
<tr><td><code id="merton_ll_+3A_d">D</code></td>
<td>
<p>numeric vector or scalar with debt due in <code>T.</code>.</p>
</td></tr>
<tr><td><code id="merton_ll_+3A_t.">T.</code></td>
<td>
<p>numeric vector or scalar with time to maturity.</p>
</td></tr>
<tr><td><code id="merton_ll_+3A_r">r</code></td>
<td>
<p>numeric vector or scalar with risk free rates.</p>
</td></tr>
<tr><td><code id="merton_ll_+3A_time">time</code></td>
<td>
<p>numeric vector with the observation times.</p>
</td></tr>
<tr><td><code id="merton_ll_+3A_dt">dt</code></td>
<td>
<p>numeric scalar with time increments between observations.</p>
</td></tr>
<tr><td><code id="merton_ll_+3A_vol">vol</code></td>
<td>
<p>numeric scalar with the <code class="reqn">\sigma</code> value.</p>
</td></tr>
<tr><td><code id="merton_ll_+3A_mu">mu</code></td>
<td>
<p>numeric scalar with the <code class="reqn">\mu</code> value.</p>
</td></tr>
<tr><td><code id="merton_ll_+3A_tol">tol</code></td>
<td>
<p>numeric scalar with tolerance to <code><a href="#topic+get_underlying">get_underlying</a></code>.
The difference is scaled  if the absolute of <code>S</code> is large than <code>tol</code>
as in the <code>tolerance</code> argument to <code><a href="base.html#topic+all.equal.numeric">all.equal.numeric</a></code>.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+BS_fit">BS_fit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># we get the same if we call `optim` as follows. The former is faster and is
# recommended
set.seed(4648394)
sims &lt;- BS_sim(
  vol = .1, mu = .05, dt = .1, V_0 = 100, T. = 1, D = rep(80, 20), r = .01)

r1 &lt;- with(
  sims, BS_fit(S = S, D = D, T. = T, r = r, time = time, method = "mle",
               eps = 1e-8, vol_start = .2))

r2 &lt;- optim(c(mu = 0, log_vol = log(.2)), function(par)
  -with(
    sims, merton_ll(S = S, D = D, T. = T, r = r, time = time,
                    mu = par["mu"], vol = exp(par["log_vol"]))))

all.equal(r1$n_iter, unname(r2$counts[1]))
all.equal(r1$ests[1], r2$par[1])
all.equal(r1$ests[2], exp(r2$par[2]), check.attributes = FALSE)

# the log-likelihood integrates to one as it should though likely not the
# most stable way to test this
ll &lt;- integrate(
  function(x) sapply(x, function(S)
    exp(merton_ll(
      S = c(1, S), D = .8, T. = 3, r = .01, dt = 1/250, vol = .2,
      mu = .05))),
  lower = 1e-4, upper = 6)
stopifnot(isTRUE(all.equal(ll$value, 1, tolerance = 1e-5)))

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
