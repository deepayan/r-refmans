<!DOCTYPE html><html><head><title>Help for package unusualprofile</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {unusualprofile}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#unusualprofile-package'><p>unusualprofile: Calculates Conditional Mahalanobis Distances</p></a></li>
<li><a href='#cond_maha'><p>Calculate the conditional Mahalanobis distance for any variables.</p></a></li>
<li><a href='#d_example'><p>An example data.frame</p></a></li>
<li><a href='#is_singular'><p>Test if matrix is singular</p></a></li>
<li><a href='#p2label'><p>Range label associated with probability</p></a></li>
<li><a href='#plot.cond_maha'><p>Plot the variables from the results of the cond_maha function.</p></a></li>
<li><a href='#plot.maha'><p>Plot objects of the maha class (i.e, the results of the cond_maha function</p>
using dependent variables only).</a></li>
<li><a href='#proportion_round'><p>Rounds proportions to significant digits both near 0 and 1</p></a></li>
<li><a href='#proportion2percentile'><p>Rounds proportions to significant digits both near 0 and 1,</p>
then converts to percentiles</a></li>
<li><a href='#R_example'><p>An example correlation matrix</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Calculates Conditional Mahalanobis Distances</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.4</td>
</tr>
<tr>
<td>Description:</td>
<td>Calculates a Mahalanobis distance for every row of a set of
    outcome variables (Mahalanobis, 1936
    &lt;<a href="https://doi.org/10.1007%2Fs13171-019-00164-5">doi:10.1007/s13171-019-00164-5</a>&gt;). The conditional Mahalanobis
    distance is calculated using a conditional covariance matrix (i.e., a
    covariance matrix of the outcome variables after controlling for a set
    of predictors). Plotting the output of the cond_maha() function can
    help identify which elements of a profile are unusual after
    controlling for the predictors.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/wjschne/unusualprofile">https://github.com/wjschne/unusualprofile</a>,
<a href="https://wjschne.github.io/unusualprofile/">https://wjschne.github.io/unusualprofile/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/wjschne/unusualprofile/issues">https://github.com/wjschne/unusualprofile/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, ggnormalviolin, ggplot2, magrittr, purrr, rlang, stats,
tibble, tidyr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>bookdown, covr, extrafont, forcats, glue, kableExtra, knitr,
lavaan, lifecycle, mvtnorm, patchwork, ragg, rmarkdown,
roxygen2, scales, simstandard (&ge; 0.6.3), stringr, sysfonts,
testthat</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>LazyData:</td>
<td>TRUE</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-14 20:09:54 UTC; renee</td>
</tr>
<tr>
<td>Author:</td>
<td>W. Joel Schneider <a href="https://orcid.org/0000-0002-8393-5316"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Feng Ji [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>W. Joel Schneider &lt;w.joel.schneider@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-02-14 23:20:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='unusualprofile-package'>unusualprofile: Calculates Conditional Mahalanobis Distances</h2><span id='topic+unusualprofile'></span><span id='topic+unusualprofile-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Calculates a Mahalanobis distance for every row of a set of outcome variables (Mahalanobis, 1936 <a href="https://doi.org/10.1007/s13171-019-00164-5">doi:10.1007/s13171-019-00164-5</a>). The conditional Mahalanobis distance is calculated using a conditional covariance matrix (i.e., a covariance matrix of the outcome variables after controlling for a set of predictors). Plotting the output of the cond_maha() function can help identify which elements of a profile are unusual after controlling for the predictors.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: W. Joel Schneider <a href="mailto:w.joel.schneider@gmail.com">w.joel.schneider@gmail.com</a> (<a href="https://orcid.org/0000-0002-8393-5316">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Feng Ji <a href="mailto:fengji@berkeley.edu">fengji@berkeley.edu</a>
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/wjschne/unusualprofile">https://github.com/wjschne/unusualprofile</a>
</p>
</li>
<li> <p><a href="https://wjschne.github.io/unusualprofile/">https://wjschne.github.io/unusualprofile/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/wjschne/unusualprofile/issues">https://github.com/wjschne/unusualprofile/issues</a>
</p>
</li></ul>


<hr>
<h2 id='cond_maha'>Calculate the conditional Mahalanobis distance for any variables.</h2><span id='topic+cond_maha'></span>

<h3>Description</h3>

<p>Calculate the conditional Mahalanobis distance for any variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cond_maha(
  data,
  R,
  v_dep,
  v_ind = NULL,
  v_ind_composites = NULL,
  mu = 0,
  sigma = 1,
  use_sample_stats = FALSE,
  label = NA
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cond_maha_+3A_data">data</code></td>
<td>
<p>Data.frame with the independent and dependent variables.
Unless mu and sigma are specified, data are assumed to be z-scores.</p>
</td></tr>
<tr><td><code id="cond_maha_+3A_r">R</code></td>
<td>
<p>Correlation among all variables.</p>
</td></tr>
<tr><td><code id="cond_maha_+3A_v_dep">v_dep</code></td>
<td>
<p>Vector of names of the dependent variables in your profile.</p>
</td></tr>
<tr><td><code id="cond_maha_+3A_v_ind">v_ind</code></td>
<td>
<p>Vector of names of independent variables you would like to
control for.</p>
</td></tr>
<tr><td><code id="cond_maha_+3A_v_ind_composites">v_ind_composites</code></td>
<td>
<p>Vector of names of independent variables that are
composites of dependent variables</p>
</td></tr>
<tr><td><code id="cond_maha_+3A_mu">mu</code></td>
<td>
<p>A vector of means. A single value means that all variables have
the same mean.</p>
</td></tr>
<tr><td><code id="cond_maha_+3A_sigma">sigma</code></td>
<td>
<p>A vector of standard deviations. A single value means that
all variables have the same standard deviation</p>
</td></tr>
<tr><td><code id="cond_maha_+3A_use_sample_stats">use_sample_stats</code></td>
<td>
<p>If TRUE, estimate R, mu, and sigma from data.
Only complete cases are used (i.e., no missing values in v_dep, v_ind,
v_ind_composites).</p>
</td></tr>
<tr><td><code id="cond_maha_+3A_label">label</code></td>
<td>
<p>optional tag for labeling output</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list with the conditional Mahalanobis distance
</p>

<ul>
<li><p><code>dCM</code> = Conditional Mahalanobis distance
</p>
</li>
<li><p><code>dCM_df</code> = Degrees of freedom for the conditional Mahalanobis distance
</p>
</li>
<li><p><code>dCM_p</code> = A proportion that indicates how unusual this profile is
compared to profiles with the same independent variable values. For example,
if <code>dCM_p</code> = 0.88, this profile is more unusual than 88 percent of profiles
after controlling for the independent variables.
</p>
</li>
<li><p><code>dM_dep</code> = Mahalanobis distance of just the dependent variables
</p>
</li>
<li><p><code>dM_dep_df</code> = Degrees of freedom for the Mahalanobis distance of
the dependent variables
</p>
</li>
<li><p><code>dM_dep_p</code> = Proportion associated with the Mahalanobis distance
of the dependent variables
</p>
</li>
<li><p><code>dM_ind</code> = Mahalanobis distance of just the independent variables
</p>
</li>
<li><p><code>dM_ind_df</code> = Degrees of freedom for the Mahalanobis distance of
the independent variables
</p>
</li>
<li><p><code>dM_ind_p</code> = Proportion associated with the Mahalanobis distance
of the independent variables
</p>
</li>
<li><p><code>v_dep</code> = Dependent variable names
</p>
</li>
<li><p><code>v_ind</code> = Independent variable names
</p>
</li>
<li><p><code>v_ind_singular</code> = Independent variables that can be perfectly
predicted from the dependent variables (e.g., composite scores)
</p>
</li>
<li><p><code>v_ind_nonsingular</code> = Independent variables that are not perfectly
predicted from the dependent variables
</p>
</li>
<li><p><code>data</code> = data used in the calculations
</p>
</li>
<li><p><code>d_ind</code> = independent variable data
</p>
</li>
<li><p><code>d_inp_p</code> = Assuming normality, cumulative distribution function
of the independent variables
</p>
</li>
<li><p><code>d_dep</code> = dependent variable data
</p>
</li>
<li><p><code>d_dep_predicted</code> = predicted values of the dependent variables
</p>
</li>
<li><p><code>d_dep_deviations = d_dep - d_dep_predicted</code> (i.e., residuals of
the dependent variables)
</p>
</li>
<li><p><code>d_dep_residuals_z</code> = standardized residuals of the dependent
variables
</p>
</li>
<li><p><code>d_dep_cp</code> = conditional proportions associated with
standardized residuals
</p>
</li>
<li><p><code>d_dep_p</code> = Assuming normality, cumulative distribution function
of the dependent variables
</p>
</li>
<li><p><code>R2</code> = Proportion of variance in each dependent variable explained
by the independent variables
</p>
</li>
<li><p><code>zSEE</code> = Standardized standard error of the estimate
for each dependent variable
</p>
</li>
<li><p><code>SEE</code> = Standard error of the estimate for each dependent variable
</p>
</li>
<li><p><code>ConditionalCovariance</code> = Covariance matrix of the dependent
variables after controlling for the independent variables
</p>
</li>
<li><p><code>distance_reduction = 1 - (dCM / dM_dep)</code> (Degree to which the
independent variables decrease the Mahalanobis distance of the dependent
variables. Negative reductions mean that the profile is more unusual
after controlling for the independent variables. Returns 0
if <code>dM_dep</code> is 0.)
</p>
</li>
<li><p><code>variability_reduction = 1 - sum((X_dep - predicted_dep) ^ 2) / sum((X_dep - mu_dep) ^ 2)</code> (Degree to which the independent variables
decrease the variability the dependent variables (<code>X_dep</code>).
Negative reductions mean that the profile is more variable after
controlling for the independent variables. Returns 0 if <code>X_dep == mu_dep</code>)
</p>
</li>
<li><p><code>mu</code> = Variable means
</p>
</li>
<li><p><code>sigma</code> = Variable standard deviations
</p>
</li>
<li><p><code>d_person</code> = Data frame consisting of Mahalanobis distance data for
each person
</p>
</li>
<li><p><code>d_variable</code> = Data frame consisting of variable characteristics
</p>
</li>
<li><p><code>label</code> = label slot
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(unusualprofile)
library(simstandard)

m &lt;- "
Gc =~ 0.85 * Gc1 + 0.68 * Gc2 + 0.8 * Gc3
Gf =~ 0.8 * Gf1 + 0.9 * Gf2 + 0.8 * Gf3
Gs =~ 0.7 * Gs1 + 0.8 * Gs2 + 0.8 * Gs3
Read =~ 0.66 * Read1 + 0.85 * Read2 + 0.91 * Read3
Math =~ 0.4 * Math1 + 0.9 * Math2 + 0.7 * Math3
Gc ~ 0.6 * Gf + 0.1 * Gs
Gf ~ 0.5 * Gs
Read ~ 0.4 * Gc + 0.1 * Gf
Math ~ 0.2 * Gc + 0.3 * Gf + 0.1 * Gs"
# Generate 10 cases
d_demo &lt;- simstandard::sim_standardized(m = m, n = 10)

# Get model-implied correlation matrix
R_all &lt;- simstandard::sim_standardized_matrices(m)$Correlations$R_all

cond_maha(data = d_demo,
          R = R_all,
          v_dep = c("Math", "Read"),
          v_ind = c("Gf", "Gs", "Gc"))
</code></pre>

<hr>
<h2 id='d_example'>An example data.frame</h2><span id='topic+d_example'></span>

<h3>Description</h3>

<p>A dataset with 1 row of data for a single case.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>d_example
</code></pre>


<h3>Format</h3>

<p>A data frame with 1 row and 8 variables:
</p>

<dl>
<dt>X_1</dt><dd><p>A predictor variable</p>
</dd>
<dt>X_2</dt><dd><p>A predictor variable</p>
</dd>
<dt>X_3</dt><dd><p>A predictor variable</p>
</dd>
<dt>Y_1</dt><dd><p>An outcome variable</p>
</dd>
<dt>Y_2</dt><dd><p>An outcome variable</p>
</dd>
<dt>Y_3</dt><dd><p>An outcome variable</p>
</dd>
<dt>X</dt><dd><p>A latent predictor variable</p>
</dd>
<dt>Y</dt><dd><p>A latent outcome variable</p>
</dd>
</dl>


<hr>
<h2 id='is_singular'>Test if matrix is singular</h2><span id='topic+is_singular'></span>

<h3>Description</h3>

<p>Test if matrix is singular
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_singular(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is_singular_+3A_x">x</code></td>
<td>
<p>matrix</p>
</td></tr>
</table>


<h3>Value</h3>

<p>logical
</p>

<hr>
<h2 id='p2label'>Range label associated with probability</h2><span id='topic+p2label'></span>

<h3>Description</h3>

<p>Range label associated with probability
</p>


<h3>Usage</h3>

<pre><code class='language-R'>p2label(p)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="p2label_+3A_p">p</code></td>
<td>
<p>Probability</p>
</td></tr>
</table>


<h3>Value</h3>

<p>label string
</p>

<hr>
<h2 id='plot.cond_maha'>Plot the variables from the results of the cond_maha function.</h2><span id='topic+plot.cond_maha'></span>

<h3>Description</h3>

<p>Plot the variables from the results of the cond_maha function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'cond_maha'
plot(
  x,
  ...,
  p_tail = 0,
  family = "sans",
  score_digits = ifelse(min(x$sigma) &gt;= 10, 0, 2)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.cond_maha_+3A_x">x</code></td>
<td>
<p>The results of the cond_maha function.</p>
</td></tr>
<tr><td><code id="plot.cond_maha_+3A_...">...</code></td>
<td>
<p>Arguments passed to print function</p>
</td></tr>
<tr><td><code id="plot.cond_maha_+3A_p_tail">p_tail</code></td>
<td>
<p>The proportion of the tail to shade</p>
</td></tr>
<tr><td><code id="plot.cond_maha_+3A_family">family</code></td>
<td>
<p>Font family.</p>
</td></tr>
<tr><td><code id="plot.cond_maha_+3A_score_digits">score_digits</code></td>
<td>
<p>Number of digits to round scores.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot2-object
</p>

<hr>
<h2 id='plot.maha'>Plot objects of the maha class (i.e, the results of the cond_maha function
using dependent variables only).</h2><span id='topic+plot.maha'></span>

<h3>Description</h3>

<p>Plot objects of the maha class (i.e, the results of the cond_maha function
using dependent variables only).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'maha'
plot(
  x,
  ...,
  p_tail = 0,
  family = "sans",
  score_digits = ifelse(min(x$sigma) &gt;= 10, 0, 2)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.maha_+3A_x">x</code></td>
<td>
<p>The results of the cond_maha function.</p>
</td></tr>
<tr><td><code id="plot.maha_+3A_...">...</code></td>
<td>
<p>Arguments passed to print function</p>
</td></tr>
<tr><td><code id="plot.maha_+3A_p_tail">p_tail</code></td>
<td>
<p>Proportion in violin tail (defaults to 0).</p>
</td></tr>
<tr><td><code id="plot.maha_+3A_family">family</code></td>
<td>
<p>Font family.</p>
</td></tr>
<tr><td><code id="plot.maha_+3A_score_digits">score_digits</code></td>
<td>
<p>Number of digits to round scores.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot2-object
</p>

<hr>
<h2 id='proportion_round'>Rounds proportions to significant digits both near 0 and 1</h2><span id='topic+proportion_round'></span>

<h3>Description</h3>

<p>Rounds proportions to significant digits both near 0 and 1
</p>


<h3>Usage</h3>

<pre><code class='language-R'>proportion_round(p, digits = 2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="proportion_round_+3A_p">p</code></td>
<td>
<p>probability</p>
</td></tr>
<tr><td><code id="proportion_round_+3A_digits">digits</code></td>
<td>
<p>rounding digits</p>
</td></tr>
</table>


<h3>Value</h3>

<p>numeric vector
</p>


<h3>Examples</h3>

<pre><code class='language-R'>proportion_round(0.01111)
</code></pre>

<hr>
<h2 id='proportion2percentile'>Rounds proportions to significant digits both near 0 and 1,
then converts to percentiles</h2><span id='topic+proportion2percentile'></span>

<h3>Description</h3>

<p>Rounds proportions to significant digits both near 0 and 1,
then converts to percentiles
</p>


<h3>Usage</h3>

<pre><code class='language-R'>proportion2percentile(
  p,
  digits = 2,
  remove_leading_zero = TRUE,
  add_percent_character = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="proportion2percentile_+3A_p">p</code></td>
<td>
<p>probability</p>
</td></tr>
<tr><td><code id="proportion2percentile_+3A_digits">digits</code></td>
<td>
<p>rounding digits. Defaults to 2</p>
</td></tr>
<tr><td><code id="proportion2percentile_+3A_remove_leading_zero">remove_leading_zero</code></td>
<td>
<p>Remove leading zero for small percentiles,
Defaults to TRUE</p>
</td></tr>
<tr><td><code id="proportion2percentile_+3A_add_percent_character">add_percent_character</code></td>
<td>
<p>Append percent character. Defaults to FALSE</p>
</td></tr>
</table>


<h3>Value</h3>

<p>character vector
</p>


<h3>Examples</h3>

<pre><code class='language-R'>proportion2percentile(0.01111)
</code></pre>

<hr>
<h2 id='R_example'>An example correlation matrix</h2><span id='topic+R_example'></span>

<h3>Description</h3>

<p>A correlation matrix used for demonstration purposes
It is the model-implied correlation matrix for this structural model:
<code>X =~ 0.7 * X_1 + 0.5 * X_2 + 0.8 * X_3</code>
<code>Y =~ 0.8 * Y_1 + 0.7 * Y_2 + 0.9 * Y_3</code>
<code>Y ~ 0.6 * X</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>R_example
</code></pre>


<h3>Format</h3>

<p>A matrix with 8 rows and 8 columns:
</p>

<dl>
<dt>X_1</dt><dd><p>A predictor variable</p>
</dd>
<dt>X_2</dt><dd><p>A predictor variable</p>
</dd>
<dt>X_3</dt><dd><p>A predictor variable</p>
</dd>
<dt>Y_1</dt><dd><p>An outcome variable</p>
</dd>
<dt>Y_2</dt><dd><p>An outcome variable</p>
</dd>
<dt>Y_3</dt><dd><p>An outcome variable</p>
</dd>
<dt>X</dt><dd><p>A latent predictor variable</p>
</dd>
<dt>Y</dt><dd><p>A latent outcome variable</p>
</dd>
</dl>


</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
