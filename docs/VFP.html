<!DOCTYPE html><html><head><title>Help for package VFP</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {VFP}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#addGrid'><p>Add a Grid to an Existing Plot.</p></a></li>
<li><a href='#as.rgb'><p>Convert Color-Name or RGB-Code to Possibly Semi-Transparent RGB-code.</p></a></li>
<li><a href='#B2mIntra_98'><p>Example Data B2mIntra_98.VFP (Beta-2-microglobulin RIA) from the Variance Function Program 12.0 from Sadler</p></a></li>
<li><a href='#bt.coef'><p>Back-Transformation of Estimated Coefficients.</p></a></li>
<li><a href='#coef.VFP'><p>Extract Model-Coefficients from VFP-Objects.</p></a></li>
<li><a href='#conditionHandler'><p>Condition-Handling Without Losing Information.</p></a></li>
<li><a href='#deriveCx'><p>Determine C5 and C95 or any Concentration Cx.</p></a></li>
<li><a href='#fit.EP17'><p>Fit CLSI EP17 Model Using log-transformed X and Y.</p></a></li>
<li><a href='#fit.vfp'><p>Estimate (Im)Precision-Profiles Modeling the Relationship 'Var ~ Mean'.</p></a></li>
<li><a href='#getMat.VCA'><p>Transform list of VCA-object into VFP-matrix required for fitting.</p></a></li>
<li><a href='#Glucose'><p>Example Data Glucose.VFP from the Variance Function Program 12.0 from Sadler</p></a></li>
<li><a href='#legend.rm'><p>Add Legend to Right Margin.</p></a></li>
<li><a href='#MultiLotReproResults'><p>Result of a Real-World Precsion Experiment on 10 Samples</p></a></li>
<li><a href='#plot.VFP'><p>Plot VFP-Ojbects.</p></a></li>
<li><a href='#powfun2simple'><p>Internal Function Model 2.</p></a></li>
<li><a href='#powfun3'><p>Internal Function Model 3.</p></a></li>
<li><a href='#powfun3simple'><p>Internal Function Model 3.</p></a></li>
<li><a href='#powfun4'><p>Internal Function Model 4.</p></a></li>
<li><a href='#powfun4simple'><p>Internal Function Model 4.</p></a></li>
<li><a href='#powfun5'><p>Internal Function Model 5.</p></a></li>
<li><a href='#powfun5simple'><p>Internal Function Model 5.</p></a></li>
<li><a href='#powfun6'><p>Internal Function Model 6.</p></a></li>
<li><a href='#powfun6simple'><p>Internal Function Model 6.</p></a></li>
<li><a href='#powfun7'><p>Internal Function Model 7.</p></a></li>
<li><a href='#powfun7simple'><p>Internal Function Model 7.</p></a></li>
<li><a href='#powfun8'><p>Internal Function Model 8.</p></a></li>
<li><a href='#powfun8simple'><p>Internal Function Model 8.</p></a></li>
<li><a href='#powfun9simple'><p>Internal Function Model 9.</p></a></li>
<li><a href='#precisionPlot'><p>Precision Performance Plot of Qualitative Tests.</p></a></li>
<li><a href='#predict.modelEP17'><p>Predict Method for Objects of Class 'modelEP17'.</p></a></li>
<li><a href='#predict.VFP'><p>Predict Method for Objects of Class 'VFP'.</p></a></li>
<li><a href='#predictMean'><p>Finding X-Value for Given Y-Value Using a Bisection-Approach.</p></a></li>
<li><a href='#print.VFP'><p>Print Objects of Class 'VFP'</p></a></li>
<li><a href='#RealData1'><p>Result of a Real-World Precsion Experiment on 10 Samples</p></a></li>
<li><a href='#ReproData'><p>Serum Work Area Example Data of a Reproducibility Experiment</p></a></li>
<li><a href='#Signif'><p>Adapted Version of Function 'signif'</p></a></li>
<li><a href='#summary.VFP'><p>Summary Objects of Class 'VFP'</p></a></li>
<li><a href='#t.coef'><p>Transformation of Coefficients.</p></a></li>
<li><a href='#T4S9_99'><p>Example Data T4S9_99.VFP (T4 RIA) from the Variance Function Program 12.0 from Sadler</p></a></li>
<li><a href='#VFP-package'><p>(V)ariance (F)unction (P)rogram</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>1.4.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-11-08</td>
</tr>
<tr>
<td>Title:</td>
<td>Variance Function Program</td>
</tr>
<tr>
<td>Author:</td>
<td>Andre Schuetzenmeister [cre, aut],
  Florian Dufey [aut],
  Andrea Geistanger [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Andre Schuetzenmeister &lt;andre.schuetzenmeister@roche.com&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1.0), gnm</td>
</tr>
<tr>
<td>Imports:</td>
<td>VCA, MASS, utils, stats, graphics, grDevices, methods</td>
</tr>
<tr>
<td>Suggests:</td>
<td>RUnit, knitr, rmarkdown, prettydoc</td>
</tr>
<tr>
<td>Description:</td>
<td>
  Variance function estimation for models proposed by W. Sadler in his variance function program 
  ('VFP', <a href="http://www.aacb.asn.au/resources/useful-tools/variance-function-program-v14">http://www.aacb.asn.au/resources/useful-tools/variance-function-program-v14</a>). Here, the idea is
  to fit multiple variance functions to a data set and consequently assess which function reflects
  the relationship 'Var ~ Mean' best. For 'in-vitro diagnostic' ('IVD') assays modeling this relationship
  is of great importance when individual test-results are used for defining follow-up treatment of patients.  </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-11-08 14:21:33 UTC; schueta6</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-11-08 15:10:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='addGrid'>Add a Grid to an Existing Plot.</h2><span id='topic+addGrid'></span>

<h3>Description</h3>

<p>It is possible to use automatically determined grid lines (<code>x=NULL, y=NULL</code>) or specifying the number 
of cells <code>x=3, y=4</code> as done by <code>grid</code>. Additionally, x- and y-locations of grid-lines can be specified,
e.g. <code>x=1:10, y=seq(0,10,2)</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>addGrid(x = NULL, y = NULL, col = "lightgray", lwd = 1L, lty = 3L)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="addGrid_+3A_x">x</code></td>
<td>
<p>(integer, numeric) single integer specifies number of cells, numeric vector specifies vertical grid-lines</p>
</td></tr>
<tr><td><code id="addGrid_+3A_y">y</code></td>
<td>
<p>(integer, numeric) single integer specifies number of cells, numeric vector specifies horizontal grid-lines</p>
</td></tr>
<tr><td><code id="addGrid_+3A_col">col</code></td>
<td>
<p>(character) color of grid-lines</p>
</td></tr>
<tr><td><code id="addGrid_+3A_lwd">lwd</code></td>
<td>
<p>(integer) line width of grid-lines</p>
</td></tr>
<tr><td><code id="addGrid_+3A_lty">lty</code></td>
<td>
<p>(integer) line type of grid-lines</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>
</p>

<hr>
<h2 id='as.rgb'>Convert Color-Name or RGB-Code to Possibly Semi-Transparent RGB-code.</h2><span id='topic+as.rgb'></span>

<h3>Description</h3>

<p>Function takes the name of a color and converts it into the rgb space. Parameter &quot;alpha&quot; allows
to specify the transparency within [0,1], 0 meaning completey transparent and 1 meaning completey
opaque. If an RGB-code is provided and alpha != 1, the RGB-code of the transparency adapted color 
will be returned.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as.rgb(col = "black", alpha = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="as.rgb_+3A_col">col</code></td>
<td>
<p>(character) name of the color to be converted/transformed into RGB-space (code). Only
those colors can be used which are part of the set returned by function colors(). Defaults
to &quot;black&quot;.</p>
</td></tr>
<tr><td><code id="as.rgb_+3A_alpha">alpha</code></td>
<td>
<p>(numeric) value specifying the transparency to be used, 0 = completely transparent, 
1 = opaque.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>RGB-code
</p>


<h3>Author(s)</h3>

<p>Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># convert character string representing a color to RGB-code
# using alpha-channel of .25 (75\% transparent)
as.rgb("red", alpha=.25)

# same thing now using the RGB-code of red (alpha=1, i.e. as.rgb("red"))
as.rgb("#FF0000FF", alpha=.25)
</code></pre>

<hr>
<h2 id='B2mIntra_98'>Example Data B2mIntra_98.VFP (Beta-2-microglobulin RIA) from the Variance Function Program 12.0 from Sadler</h2><span id='topic+B2mIntra_98'></span>

<h3>Description</h3>

<p>Results in this file are all serum/CSF clinical specimen duplicates during 1998 from a low throughput Beta-2-microglobulin RIA.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(B2mIntra_98)</code></pre>


<h3>Format</h3>

<p>data.frame with 554 observations and 2 variables.</p>


<h3>References</h3>

<p>VFP Program Version 12.0\
<a href="http://www.aacb.asn.au/professionaldevelopment/useful-tools">http://www.aacb.asn.au/professionaldevelopment/useful-tools</a>
</p>

<hr>
<h2 id='bt.coef'>Back-Transformation of Estimated Coefficients.</h2><span id='topic+bt.coef'></span>

<h3>Description</h3>

<p>This function performs back-transformation from re-parameterized forms in the 'VFP'-package
into the original form.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bt.coef(object, K = NULL, signJ = NULL, model = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bt.coef_+3A_object">object</code></td>
<td>
<p>(object) of class 'gnm' representing a fitted model in re-parameterized form</p>
</td></tr>
<tr><td><code id="bt.coef_+3A_k">K</code></td>
<td>
<p>(numeric) constant value 'K'</p>
</td></tr>
<tr><td><code id="bt.coef_+3A_signj">signJ</code></td>
<td>
<p>(integer) either 1 or -1</p>
</td></tr>
<tr><td><code id="bt.coef_+3A_model">model</code></td>
<td>
<p>(integer) specifying which model shall be back-transformed</p>
</td></tr>
<tr><td><code id="bt.coef_+3A_...">...</code></td>
<td>
<p>additional parameters</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In the 'VFP' package models are re-parameterized to have better control over the constraint
solution-space, i.e. only models may be fitted generating non-negative fitted values. This 
function is intended to be for internal use only.
</p>


<h3>Value</h3>

<p>(numeric) vector of coefficients in original parameterized form
</p>


<h3>Author(s)</h3>

<p>Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>
Florian Dufey <a href="mailto:florian.dufey@roche.com">florian.dufey@roche.com</a>
</p>

<hr>
<h2 id='coef.VFP'>Extract Model-Coefficients from VFP-Objects.</h2><span id='topic+coef.VFP'></span>

<h3>Description</h3>

<p>Extract Model-Coefficients from VFP-Objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'VFP'
coef(object, model.no = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coef.VFP_+3A_object">object</code></td>
<td>
<p>(object) of class &quot;VFP&quot;</p>
</td></tr>
<tr><td><code id="coef.VFP_+3A_model.no">model.no</code></td>
<td>
<p>(integer) specifying one of models 1:10, must be one of the 
fitted models</p>
</td></tr>
<tr><td><code id="coef.VFP_+3A_...">...</code></td>
<td>
<p>additional parameters passed forward</p>
</td></tr>
</table>


<h3>Value</h3>

<p>(numeric) model coefficients
</p>


<h3>Author(s)</h3>

<p>Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>
Florian Dufey <a href="mailto:florian.dufey@roche.com">florian.dufey@roche.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(VCA)
data(VCAdata1)
lst &lt;- anovaVCA(y~(device+lot)/day/run, VCAdata1, by="sample")
mat &lt;- getMat.VCA(lst)		# automatically selects "total"
res &lt;- fit.vfp(model.no=1:10, Data=mat)
coef(res)

</code></pre>

<hr>
<h2 id='conditionHandler'>Condition-Handling Without Losing Information.</h2><span id='topic+conditionHandler'></span>

<h3>Description</h3>

<p>Function is intented to wrap expressions provided and catching
all potentially useful information generated by the wrapped expression, i.e.
errors, warnings, and messages.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>conditionHandler(expr, file = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="conditionHandler_+3A_expr">expr</code></td>
<td>
<p>(expression) for which exception handling should be provided</p>
</td></tr>
<tr><td><code id="conditionHandler_+3A_file">file</code></td>
<td>
<p>(character) string specifying a file to which all captured output
shall be written</p>
</td></tr>
</table>


<h3>Value</h3>

<p>(list) with element &quot;result&quot;, &quot;status&quot; (0 = no warnings, no errors), 1 = warnings
were caught, 2 = errors were caught no result generated, &quot;warnings&quot;, &quot;errors&quot;, 
&quot;messages&quot;
</p>


<h3>Author(s)</h3>

<p>Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>conditionHandler(warning("This is a warning!"))
f &lt;- function(expr){warning("This a warning!"); eval(expr)}
conditionHandler(f(1/2))
conditionHandler(stop("This is an error!"))
conditionHandler(1/"a")
</code></pre>

<hr>
<h2 id='deriveCx'>Determine C5 and C95 or any Concentration Cx.</h2><span id='topic+deriveCx'></span>

<h3>Description</h3>

<p>This function makes use of a precision profile. The concentration is sought
at which 100 * 'Cx'% of the measurements lie above 'cutoff' theoretically
as each X-value corresponds to a normal distribution with mean=X and SD as
read off the precision profile. In case of e.g. &quot;C5&quot; exactly 5% will be
above cutoff, whereas for &quot;C95&quot; 95% will  be larger than cutoff. This follows
the CLSI EP12 guideline whenever an internal continuous result (ICR) is 
available and measurement imprecision can be assumed to be normally distributed. 
The CLSI EP12 recommends to base derivation of C5 and C95 on the results of 
intermediate precision analyses using multiple samples. This includes between-day 
and between-run as additional variance components besides repeatability.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>deriveCx(
  vfp,
  model.no = NULL,
  start = NULL,
  cutoff = NULL,
  Cx = 0.05,
  tol = 1e-06,
  plot = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="deriveCx_+3A_vfp">vfp</code></td>
<td>
<p>(VFP) object representing a precision profile to be used</p>
</td></tr>
<tr><td><code id="deriveCx_+3A_model.no">model.no</code></td>
<td>
<p>(integer) specifying which model to use, if NULL the &quot;best&quot;
model will be used automatically</p>
</td></tr>
<tr><td><code id="deriveCx_+3A_start">start</code></td>
<td>
<p>(numeric) start concentration, e.g. for C5 smaller than r,
for C95 larger than R</p>
</td></tr>
<tr><td><code id="deriveCx_+3A_cutoff">cutoff</code></td>
<td>
<p>(numeric) the cutoff of to be used</p>
</td></tr>
<tr><td><code id="deriveCx_+3A_cx">Cx</code></td>
<td>
<p>(numeric) the probability, e.g. for C5 use 0.05 and for 
C95 use 0.95</p>
</td></tr>
<tr><td><code id="deriveCx_+3A_tol">tol</code></td>
<td>
<p>(numeric) tolerance value determining when the iterative
bisections search can terminate, i.e. when the difference
becomes smalle enough</p>
</td></tr>
<tr><td><code id="deriveCx_+3A_plot">plot</code></td>
<td>
<p>(logical) TRUE = plot the result</p>
</td></tr>
</table>


<h3>Value</h3>

<p>(numeric) Mean and SD of concentration Cx
</p>


<h3>Author(s)</h3>

<p>Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# perform variance component analysis
library(VCA)
data(VCAdata1)
# perform VCA-anaylsis
lst &lt;- anovaVCA(y~(device+lot)/day/run, VCAdata1, by="sample")
# transform list of VCA-objects into required matrix
mat &lt;- getMat.VCA(lst)		# automatically selects "total"
mat
# fit all models batch-wise
res &lt;- fit.vfp(model.no=1:10, Data=mat)
# now search for the C5 concentration
deriveCx(res, start=15, cutoff=20, Cx=0.05, plot=TRUE)
deriveCx(res, start=25, cutoff=20, Cx=0.95, plot=TRUE)
deriveCx(res, start=25, cutoff=20, Cx=0.25, plot=TRUE)
deriveCx(res, start=25, cutoff=20, Cx=0.75, plot=TRUE)

#
p &lt;- c(seq(.01, .12, .01), seq(.15, .85, .05), seq(.88, .99, .01))
system.time(x &lt;- deriveCx(res, Cx=p, cutoff=20))

## End(Not run)
</code></pre>

<hr>
<h2 id='fit.EP17'>Fit CLSI EP17 Model Using log-transformed X and Y.</h2><span id='topic+fit.EP17'></span>

<h3>Description</h3>

<p>This function fits the model proposed in CLSI EP17 by log-transforming
CV (Y) as well as mean-values (X) und performing a linear regression of these.
More specifically CV = A * Conc^B, where Conc = mean concentration of a sample and CV is
on the percent-scale, is fitted by ordinary least squares (OLS) estimation of
log(CV) = A + B * log(Conc). Fitted values are subsequently back-transformed
using formula cv = exp(a) * C^b, where cv, a and b represent estimates of CV, A and B.
Therefore, this model does not fall within the same class as models 1 to 9, 
although the predictor function is identical to that of model 9. This also has 
the consequence that regression statistics, like AIC or deviance, are not directly
comparable to those of models 1 to 9.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit.EP17(x, y, DF, typeY = c("vc", "sd", "cv"), k = 2, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit.EP17_+3A_x">x</code></td>
<td>
<p>(numeric) mean concentrations of samples</p>
</td></tr>
<tr><td><code id="fit.EP17_+3A_y">y</code></td>
<td>
<p>(numeric) variability at 'x' on VC-, SD-, or CV-scale</p>
</td></tr>
<tr><td><code id="fit.EP17_+3A_df">DF</code></td>
<td>
<p>(numeric) vector of degrees of freedom linked to variabilities 'y'
used in derivation of deviance and AIC</p>
</td></tr>
<tr><td><code id="fit.EP17_+3A_typey">typeY</code></td>
<td>
<p>(character) specifying the scale of 'y'-values</p>
</td></tr>
<tr><td><code id="fit.EP17_+3A_k">k</code></td>
<td>
<p>(numeric) numeric specifying the 'weight' of the equivalent
degrees of freedom (edf) part in the AIC formula.</p>
</td></tr>
<tr><td><code id="fit.EP17_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The AIC is computed following the implementation of <code>extractAIC.lm</code> in the
'stats' package with the adaption of using 'n = sum(df)' instead of 'n' being the number
of residuals. The 'df' come from a precision analysis, thus, there are far more observations
used to fit this model than indicated by the number of residuals.
</p>


<h3>Value</h3>

<p>(list) with items &quot;x&quot; and &quot;y&quot; as provided, and &quot;x.out&quot; and &quot;y.out&quot;
representing X- and Y-coordiantes of fitted values for plotting
</p>


<h3>Author(s)</h3>

<p>Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# data from appendix D of CLSI EP17-A2 (pg. 54)
EP17.dat &lt;- data.frame(
 Lot=c(rep("Lot1", 9), rep("Lot2", 9)),
	Mean=c(	0.04, 0.053, 0.08, 0.111, 0.137, 0.164, 0.19, 0.214, 0.245,
			0.041, 0.047, 0.077, 0.106, 0.136, 0.159, 0.182, 0.205, 0.234),
	CV=c(40.2, 29.6, 19.5, 15.1, 10.0, 7.4, 6.0, 7.5, 5.4,
		 44.1, 28.8, 15.1, 17.8, 11.4, 9.2, 8.4, 7.8, 6.2),
 SD=c(0.016, 0.016, 0.016, 0.017, 0.014, 0.012, 0.011, 0.016, 0.013,
		 0.018, 0.014, 0.012, 0.019, 0.016, 0.015, 0.015, 0.016, 0.014),
 DF=rep(1, 18)
)

EP17.dat$VC &lt;- EP17.dat$SD^2

lot1 &lt;- subset(EP17.dat, Lot=="Lot1")
lot2 &lt;- subset(EP17.dat, Lot=="Lot2")

# function fit.EP17 is not exported, use package namesspace in call
fit.lot1 &lt;- VFP:::fit.EP17(x=lot1$Mean, y=lot1$CV, typeY="cv", DF=lot1$DF)

</code></pre>

<hr>
<h2 id='fit.vfp'>Estimate (Im)Precision-Profiles Modeling the Relationship 'Var ~ Mean'.</h2><span id='topic+fit.vfp'></span>

<h3>Description</h3>

<p>This function fits one out of ten or any subset of ten non-linear functions at once. This is done on 
precision data consisting of information about the variance, concentration at which this variance
was observed and the respective degrees of freedom. Provided data must contain at least three columns with
this information. There are following variance-functions covered: <br />
</p>

<ul>
<li><p>constant variance <code class="reqn">sigma^2</code>
</p>
</li>
<li><p>constant CV<code class="reqn"> sigma^2=beta_1*u^2 </code>
</p>
</li>
<li><p>mixed constant, proportional variance <code class="reqn">sigma^2=beta_1+beta_2*u^2</code>
</p>
</li>
<li><p>constrained power model, constant exponent <code class="reqn">sigma^2=(beta_1+beta_2*u)^K</code>
</p>
</li>
<li><p>alternative constrained power model <code class="reqn">sigma^2=beta_1+beta_2*u^K</code>
</p>
</li>
<li><p>alternative unconstrained power model for VF's with a minimum <code class="reqn">sigma^2=beta_1+beta_2*u+beta_3*u^J</code>
</p>
</li>
<li><p>alternative unconstrained power model <code class="reqn">sigma^2=beta_1+beta_2*u^J</code>
</p>
</li>
<li><p>unconstrained power model (default model of Sadler) <code class="reqn">sigma^2=(beta_1 + beta_2 * u)^J</code>
</p>
</li>
<li><p>CLSI EP17 similar model <code class="reqn">sigma^2=beta_1 * u^J</code>
</p>
</li>
<li><p>Exact CLSI EP17 model (fit by linear regression on logarithmic scale) <code class="reqn">cv=beta_1 * u^J</code>
</p>
</li></ul>

<p>Fitting all ten models is somehow redundant if constant 'C' is chosen to be equal to 2, since models 3 and 5 are
equivalent and these are constrained versions of model 7 where the exponent is also estimated. The latter also applies to model
4 which is a constrained version of model 8. Note that model 10 fits the same predictor function as model 9 using simple linear 
regression on a logarithmic scale. Therefore, regression statistics like AIC, deviance etc. is not directly comparable 
to that of models 1 to 9.  Despite these possible redundancies, as computation time is not critical here for typical
precision-profiles (of in-vitro diagnostics precision experiments) we chose to offer batch-processing as well.
During computation, all models are internally reparameterized so as to guarantee that the variance function is positive in the
range 'u' from 0 to 'u_max'. In models 7 and 8, 'J' is restricted to 0.1&lt;J&lt;10 to avoid the appearance of sharp hooks. 
Occasionally, these restrictions may lead to a failure of convergence. This is then a sign that the model parameters
are on the boundary and that the model fits the data very badly. This should not be taken as reason for concern. 
It occurs frequently for model 6 when the variance function has no minimum, which is normally the case.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit.vfp(
  Data,
  model.no = 7,
  K = 2,
  startvals = NULL,
  quiet = T,
  col.mean = "Mean",
  col.var = "VC",
  col.df = "DF",
  col.sd = NULL,
  col.cv = NULL,
  minVC = NA,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit.vfp_+3A_data">Data</code></td>
<td>
<p>(data.frame, matrix) containing mean-values, estimated variances and degrees of freedom for each sample</p>
</td></tr>
<tr><td><code id="fit.vfp_+3A_model.no">model.no</code></td>
<td>
<p>(integer) in 1:10, may be any combination of these integer-values specifying models 1 to 10 which
are consequently fitted to the data;  defaults to 7</p>
</td></tr>
<tr><td><code id="fit.vfp_+3A_k">K</code></td>
<td>
<p>(numeric) value defining the constant used in models 4 and 5; defaults to 2</p>
</td></tr>
<tr><td><code id="fit.vfp_+3A_startvals">startvals</code></td>
<td>
<p>(numeric) vector of start values for the optimization algorithm, only used if a single model
is specified by the user, otherwise, start values will be sought automatically</p>
</td></tr>
<tr><td><code id="fit.vfp_+3A_quiet">quiet</code></td>
<td>
<p>(logical) TRUE = all output messages (warnings, errors) and regular console output is suppressed and can
be found in elements &quot;stderr&quot; and &quot;stdout&quot; of the returned object</p>
</td></tr>
<tr><td><code id="fit.vfp_+3A_col.mean">col.mean</code></td>
<td>
<p>(character) string specifying a column/variable in 'Data' containing mean-values; defaults to &quot;Mean&quot;</p>
</td></tr>
<tr><td><code id="fit.vfp_+3A_col.var">col.var</code></td>
<td>
<p>(character) string specifying a column/variable in 'Data' containing the variances; Defaults to &quot;VC&quot;</p>
</td></tr>
<tr><td><code id="fit.vfp_+3A_col.df">col.df</code></td>
<td>
<p>(character) string specifying a column/variable in 'Data' containing the degrees of freedom; defaults to &quot;DF&quot;</p>
</td></tr>
<tr><td><code id="fit.vfp_+3A_col.sd">col.sd</code></td>
<td>
<p>(character) string (optional) specifying a column/variable in 'Data' containing the SD-values,
used for model 10 to derive more precise CV-values compared to derivation from 'col.var' in case
'col.cv' is not specified directly. Note that column &quot;col.var&quot; must nevertheless be set and existing</p>
</td></tr>
<tr><td><code id="fit.vfp_+3A_col.cv">col.cv</code></td>
<td>
<p>(character) string (optional) specifying a column/variable in 'Data' containing the CV-values,
if missing, first 'col.sd' is checked, if missing 'col.var' used to derive per-sample CV-values. 
Note that column &quot;col.var&quot; must nevertheless be set and existing</p>
</td></tr>
<tr><td><code id="fit.vfp_+3A_minvc">minVC</code></td>
<td>
<p>(numeric) value assigned to variances being equal to zero, defaults to NA, which results in removing
these observations; could also be set to the smallest possible positive double (<code>.Machine$double.eps</code>)</p>
</td></tr>
<tr><td><code id="fit.vfp_+3A_...">...</code></td>
<td>
<p>additional parameters passed forward, e.g. 'vc' of function <code><a href="#topic+getMat.VCA">getMat.VCA</a></code> for selecting a 
specific variance component in case of 'Data' being a list of 'VCA'-objects (see examples)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Functions <code><a href="#topic+predict.VFP">predict.VFP</a></code> and <code><a href="#topic+predictMean">predictMean</a></code> are useful to make inference based on a fitted model.
It is possible to derive concentrations at which a predefined variability is reached, which is sometimes referred to as
&quot;functional sensitivity&quot; and/or &quot;limit of quantitation&quot; (LoQ). Funtion <code><a href="#topic+predictMean">predictMean</a></code> returns the fitted value
at which a user-defined variance (&quot;vc&quot;), SD or CV is reached with its corresponding 100(1-alpha)% CI derived from the CI of
the fitted model. The plotting method for objects of class 'VFP' can automatically add this information to a plot using 
arguments 'Prediction' and 'Pred.CI' (see <code><a href="#topic+plot.VFP">plot.VFP</a></code> for details. Function <code><a href="#topic+predict.VFP">predict.VFP</a></code> makes 
predictions for specified mean-values based on fitted models.  
</p>
<p>Note, that in cases where a valid solution was found in the re-parameterized space but the final fit with 'gnm' in the
original parameter-space did not converge no variance-covariance matrix can be estimated. Therefore, no confidence-intervals
will be available downstream.
</p>


<h3>Value</h3>

<p>(object) of class 'VFP' with elements:<br />
</p>
<table>
<tr><td><code>Models</code></td>
<td>
<p>objects of class 'gnm' representing the fitted model</p>
</td></tr>
<tr><td><code>RSS</code></td>
<td>
<p>residual sum of squares for each fitted model</p>
</td></tr>
<tr><td><code>AIC</code></td>
<td>
<p>the Akaike information criterion for each fitted model</p>
</td></tr>
<tr><td><code>Deviance</code></td>
<td>
<p>the deviance for each fitted model</p>
</td></tr>
<tr><td><code>Formulas</code></td>
<td>
<p>formula(s) as expression for each fitted model</p>
</td></tr>
<tr><td><code>Mu.Func</code></td>
<td>
<p>function(s) to transform mean value to re-parameterized scale</p>
</td></tr>
<tr><td><code>Mu</code></td>
<td>
<p>list of transformed mean values</p>
</td></tr>
<tr><td><code>Data</code></td>
<td>
<p>the original data set provided to fit model(s)</p>
</td></tr>
<tr><td><code>K</code></td>
<td>
<p>constant as specified by the user</p>
</td></tr>
<tr><td><code>startvals</code></td>
<td>
<p>start values as specified by the user</p>
</td></tr>
<tr><td><code>errors</code></td>
<td>
<p>messages of all errors caught</p>
</td></tr>
<tr><td><code>output</code></td>
<td>
<p>if 'quiet=TRUE' all output that was redirected to a file</p>
</td></tr>
<tr><td><code>warning</code></td>
<td>
<p>messages of all warnings caught</p>
</td></tr>
<tr><td><code>notes</code></td>
<td>
<p>all other notes caught during execution</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Florian Dufey <a href="mailto:florian.dufey@roche.com">florian.dufey@roche.com</a>, 
Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.VFP">plot.VFP</a></code>, <code><a href="#topic+predict.VFP">predict.VFP</a></code>, <code><a href="#topic+predictMean">predictMean</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load VCA-package and data
library(VCA)
data(VCAdata1)
# perform VCA-anaylsis
lst &lt;- anovaVCA(y~(device+lot)/day/run, VCAdata1, by="sample")
# transform list of VCA-objects into required matrix
mat &lt;- getMat.VCA(lst)		# automatically selects "total"
mat

# fit all 9 models batch-wise
res &lt;- fit.vfp(model.no=1:10, Data=mat)

# if 'mat' is not required for later usage, following works
# equally well
res2 &lt;- fit.vfp(lst, 1:10)

# plot best-fitting model
plot(res)
plot(res, type="cv")
plot(res, type="cv", ci.type="lines", ci.col="red",
		Grid=list(col="wheat"), Points=list(pch=2, lwd=2, col="black"))

# now derive concentation at which a specific reproducibility-
# imprecision of 10\% is reached and add this to the plot
pred &lt;- plot(res, type="cv", ci.type="band", 
				ci.col=as.rgb("red", .25), Grid=list(col="orange"), 
				Points=list(pch=2, lwd=2, col="black"),
				Prediction=list(y=10, col="red"), Pred.CI=TRUE)

# (invisibly) returned object contains all relevant information
pred

# same for repeatability
mat.err &lt;- getMat.VCA(lst, "error")
res.err &lt;- fit.vfp(1:10, Data=mat.err)

# without extracting 'mat.err'
res.err2 &lt;- fit.vfp(lst, 1:10, vc="error")

plot(res.err)

#######################################################################
# another example using CA19_9 data from CLSI EP05-A3

data(CA19_9)

# fit reproducibility model to data
fits.CA19_9 &lt;- anovaVCA(result~site/day, CA19_9, by="sample")

# fit within-laboratory-model treating site as fixed effect
fits.ip.CA19_9 &lt;- anovaMM(result~site/(day), CA19_9, by="sample")

# the variability "between-site" is not part of "total"
fits.ip.CA19_9[[1]]
fits.CA19_9[[1]]

# extract repeatability
rep.CA19_9 &lt;- getMat.VCA(fits.CA19_9, "error")

# extract reproducibility
repro.CA19_9 &lt;- getMat.VCA(fits.CA19_9, "total")

# extract intermediate-precision (within-lab)
ip.CA19_9 &lt;- getMat.VCA(fits.ip.CA19_9, "total")

# fit model (a+bX)^C (model 8) to all three matrices

mod8.repro 	&lt;- fit.vfp(repro.CA19_9, 8)
mod8.ip		&lt;- fit.vfp(ip.CA19_9, 8)
mod8.rep		&lt;- fit.vfp(rep.CA19_9, 8)

# plot reproducibility precision profile first
# leave enough space in right margin for a legend
plot(mod8.repro, mar=c(5.1, 7, 4.1, 15), 
		type="cv", ci.type="none", Model=FALSE,
		Line=list(col="blue", lwd=3), 
		Points=list(pch=15, col="blue", cex=1.5),  
		xlim=c(10, 450), ylim=c(0,10),
		Xlabel=list(text="CA19-9, kU/L (LogScale) - 3 Patient Pools, 3 QC Materials",
				cex=1.5), Title=NULL,
		Ylabel=list(text="% CV", cex=1.5),
		Grid=NULL, Crit=NULL, log="x")

# add intermediate precision profile
plot	(mod8.ip, type="cv", add=TRUE, ci.type="none",
		Points=list(pch=16, col="deepskyblue", cex=1.5),
		Line=list(col="deepskyblue", lwd=3), log="x")

# add repeatability precision profile
plot(	mod8.rep, type="cv", add=TRUE, ci.type="none",
		Points=list(pch=17, col="darkorchid3", cex=1.5),
		Line=list(col="darkorchid3", lwd=3), log="x")

# add legend to right margin
legend.rm( x="center", pch=15:17, col=c("blue", "deepskyblue", "darkorchid3"),
		cex=1.5, legend=c("Reproducibility", "Within-Lab Precision", "Repeatability"),
		box.lty=0)
#' 
</code></pre>

<hr>
<h2 id='getMat.VCA'>Transform list of VCA-object into VFP-matrix required for fitting.</h2><span id='topic+getMat.VCA'></span>

<h3>Description</h3>

<p>Transform list of VCA-object into VFP-matrix required for fitting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getMat.VCA(obj, vc = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getMat.VCA_+3A_obj">obj</code></td>
<td>
<p>(list) of VCA-objects</p>
</td></tr>
<tr><td><code id="getMat.VCA_+3A_vc">vc</code></td>
<td>
<p>(integer, character) either an integer specifying a variance component
or the name of a variance component; can also be a vector of integers
specifying a continuous sequence of variance components always including
'error' (repeatability)</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(VCA)
data(VCAdata1)
lst &lt;- anovaVCA(y~(device+lot)/day/run, VCAdata1, by="sample")
getMat.VCA(lst)  # automatically selects 'total'
# pooled version of intermediate precision (error+run+day)
getMat.VCA(lst, 4:6)
# only repeatability ('error')
getMat.VCA(lst, "error")

</code></pre>

<hr>
<h2 id='Glucose'>Example Data Glucose.VFP from the Variance Function Program 12.0 from Sadler</h2><span id='topic+Glucose'></span>

<h3>Description</h3>

<p>Intra-day precision of arterial glucose measurement on the Precision PCx instrument 
(Abbott Laboratories, Abbott Park, Illinois, USA).  
The data were kindly provided by Peter Watkinson, The John Radcliffe Hospital, Oxford, UK.  
They provide an excellent example of a situation where a simple variance function 
should be imposed in preference to accepting the fit of one of the flexible functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(Glucose)</code></pre>


<h3>Format</h3>

<p>data.frame with 206 observations and 2 variables.</p>


<h3>References</h3>

<p>VFP Program Version 12.0\
<a href="http://www.aacb.asn.au/professionaldevelopment/useful-tools">http://www.aacb.asn.au/professionaldevelopment/useful-tools</a>
</p>

<hr>
<h2 id='legend.rm'>Add Legend to Right Margin.</h2><span id='topic+legend.rm'></span>

<h3>Description</h3>

<p>This function accepts all parameters applicable in and forwards them to function <code><a href="graphics.html#topic+legend">legend</a></code>.
There will be only made some modifications to the X-coordinate ensuring that the legend is plotted in
the right margin of the graphic device. Make sure that you have reserved sufficient space in the right
margin, e.g. 'plot.VFP(....., mar=c(4,5,4,10))'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>legend.rm(
  x = c("center", "bottomright", "bottom", "bottomleft", "left", "topleft", "top",
    "topright", "right"),
  y = NULL,
  offset = 0.05,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="legend.rm_+3A_x">x</code></td>
<td>
<p>(character, numeric) either one of the character strings &quot;center&quot;,&quot;bottomright&quot;, &quot;bottom&quot;, &quot;bottomleft&quot;, 
&quot;left&quot;, &quot;topleft&quot;, &quot;top&quot;, &quot;topright&quot;, &quot;right&quot; or a numeric values specifying the X-coordinate in user
coordinates</p>
</td></tr>
<tr><td><code id="legend.rm_+3A_y">y</code></td>
<td>
<p>(numeric) value specifying the Y-coordiante in user coordinates, only used in case 'x' is numeric</p>
</td></tr>
<tr><td><code id="legend.rm_+3A_offset">offset</code></td>
<td>
<p>(numeric) value in [0, 0.5] specifying the offset as fraction in regard to width of the right margin</p>
</td></tr>
<tr><td><code id="legend.rm_+3A_...">...</code></td>
<td>
<p>all parameters applicable in function <code><a href="graphics.html#topic+legend">legend</a></code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(VCA)
data(VCAdata1)
# perform VCA-anaylsis
lst &lt;- anovaVCA(y~(device+lot)/day/run, VCAdata1, by="sample")
# transform list of VCA-objects into required matrix
mat &lt;- getMat.VCA(lst)		# automatically selects "total"
mat

# fit all 9 models batch-wise
res &lt;- fit.vfp(model.no=1:10, Data=mat)

plot(res, mar=c(5.1, 4.1, 4.1,15), Crit=NULL)

legend.rm(cex=1.25, text.font=10,
	 legend=c(
    paste0("AIC:    ", signif(as.numeric(res$AIC["Model_6"]), 4)),
	   paste0("Dev:    ", signif(as.numeric(res$Deviance["Model_6"]), 4)),
    paste0("RSS:    ", signif(as.numeric(res$RSS["Model_6"]),4))))

</code></pre>

<hr>
<h2 id='MultiLotReproResults'>Result of a Real-World Precsion Experiment on 10 Samples</h2><span id='topic+MultiLotReproResults'></span>

<h3>Description</h3>

<p>(data.frame) representing the results of an imprecision experiment.
There are 10 observations and four variables which can be used directly
as input for function 'fit.vfp'. Different samples are indicated by 
rownames.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(MultiLotReproResults)</code></pre>


<h3>Format</h3>

<p>data.frame with 10 observations and 4 variables.</p>

<hr>
<h2 id='plot.VFP'>Plot VFP-Ojbects.</h2><span id='topic+plot.VFP'></span>

<h3>Description</h3>

<p>Function takes an object of class 'VFP' and plots a fitted variance-function
either on the original variance-scale ('type=&quot;vc&quot;') or on the CV-scale (&quot;cv&quot;).
The corresponding 100x(1-alpha)% confidencen interval around the variance-function
can be plotted either as lines ('ci.type=&quot;lines') or as per default as CI-band.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'VFP'
plot(
  x,
  model.no = NULL,
  type = c("vc", "sd", "cv"),
  add = FALSE,
  alpha = 0.05,
  ci.col = "gray90",
  ci.type = c("band", "lines", "none"),
  dispersion = NULL,
  browse = FALSE,
  BG = "white",
  Title = list(),
  Xlabel = list(),
  Ylabel = list(),
  Line = list(),
  Points = list(),
  Grid = list(),
  Crit = list(),
  ylim = NULL,
  xlim = NULL,
  Prediction = NULL,
  Pred.CI = NULL,
  Model = TRUE,
  CI.method = c("chisq", "t", "normal"),
  use.log = FALSE,
  Npred = 200,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.VFP_+3A_x">x</code></td>
<td>
<p>(VFP) object as returned by function 'fit.vfp'</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_model.no">model.no</code></td>
<td>
<p>(integer) specifying which model to plot, must be one of the fitted models</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_type">type</code></td>
<td>
<p>(character) either &quot;vc&quot; to generate a plot on the original
variance-scale or &quot;cv&quot; to plot it on the coefficient of variation
scale, i.e. CV = 100*sqrt(VC)/Mean or &quot;log&quot; to plot after a variance 
stabilizing transformation. The latter will not work if 'Prediction' is specified!.</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_add">add</code></td>
<td>
<p>(logical) TRUE = the current (im)precision profile is added to an existing plot,
FALSE = a new plot will be generated</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_alpha">alpha</code></td>
<td>
<p>(numeric) value specifying the 100x(1-alpha)% confidencen interval
to be plotted around the function</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_ci.col">ci.col</code></td>
<td>
<p>(character) string specifying a color used for the CI-region</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_ci.type">ci.type</code></td>
<td>
<p>(character) either &quot;band&quot; to plto the CI as polygon, or &quot;lines&quot; to
plot the CI-bounds as two separate line using color 'ci.col'</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_dispersion">dispersion</code></td>
<td>
<p>(numeric) NULL = the dispersion parameter will be estimated,
numeric value = the dispersion parameter will be used as specified</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_browse">browse</code></td>
<td>
<p>(logical) TRUE = if multiple models were fitted, all will be displayed one after
the other in increasing order of their respective AIC, mouse-klick on the plot
triggers switch to the next model</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_bg">BG</code></td>
<td>
<p>(character) string specifying a background color</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_title">Title</code></td>
<td>
<p>(list) passed to function <code><a href="graphics.html#topic+mtext">mtext</a></code> controlling content and style of
the main title</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_xlabel">Xlabel</code></td>
<td>
<p>(list) passed to function <code><a href="graphics.html#topic+mtext">mtext</a></code> controlling the labeling
of the X-axis</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_ylabel">Ylabel</code></td>
<td>
<p>(list) passed to function <code><a href="graphics.html#topic+mtext">mtext</a></code> controlling the labeling
of the Y-axis</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_line">Line</code></td>
<td>
<p>(list) passed to function <code><a href="graphics.html#topic+lines">lines</a></code> controlling the visual appearance
of the line representing the fitted variance-function</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_points">Points</code></td>
<td>
<p>(list) passed to function <code><a href="graphics.html#topic+points">points</a></code> controlling how 
data used to fit a variance function shall be plotted</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_grid">Grid</code></td>
<td>
<p>(list) passed to function <code><a href="#topic+addGrid">addGrid</a></code> controlling the appearance
of a grid, set to NULL to omit</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_crit">Crit</code></td>
<td>
<p>(list) passed to function <code><a href="graphics.html#topic+legend">legend</a></code> per default used to present
the optimality criterion for choosing the best fitting model, per default this
is AIC and additionally residual sum of squares (RSS) is shown for the plotted
model in the upper-right corner</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_ylim">ylim</code></td>
<td>
<p>(numeric) vector of length two specifying plot-limits in Y-direction, if NULL
these will be automatically determined</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_xlim">xlim</code></td>
<td>
<p>(numeric) vector of length two specifying plot-limits in X-direction, if NULL
these will be automatically determined</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_prediction">Prediction</code></td>
<td>
<p>(list) with elements 'y' specifying values on VC-, SD- or CV-scale depending on
'type' for which predictions on the X-axis are requested or 'x' specifying mean-values
on the X-axis for which predictions on the Y-axis are requested; furthermore,
all graphical parameters accepted by function <code><a href="graphics.html#topic+lines">lines</a></code> indicating predictions;
NULL to omit (default);
additionally to arguments accepted by function 'lines', one can specify parameters
'x.line' and 'y.line' used to indicated values at the respective axis in margin-lines see
<code><a href="graphics.html#topic+mtext">mtext</a></code> for details; 'cex' and 'font' for specifying how these values are plotted.
The same color as lines is used    per default but can be changed setting 'text.col'.
Can also be (numeric) vector (not a list) which results in using default graphical settings. 
See also parameter Pred.CI.</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_pred.ci">Pred.CI</code></td>
<td>
<p>(list) with all parameters accepted by function <code><a href="graphics.html#topic+rect">rect</a></code>; if not NULL,
the 100x(1-alpha)% CI of predicted values will be added as a semi-transparent rectangle
per default (see examples).</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_model">Model</code></td>
<td>
<p>(logical) TRUE = plots the fitted model as subtitle below the main title, FALSE = omits this</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_ci.method">CI.method</code></td>
<td>
<p>(character) one of &quot;t&quot;, &quot;normal&quot;, &quot;chisq&quot; specifying which CI-method to use for
deriving confidence intervals</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_use.log">use.log</code></td>
<td>
<p>(logical) TRUE = X- and Y-axis will be log-transformed</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_npred">Npred</code></td>
<td>
<p>(integer) specifying the number of data points used to plot the fitted model, the larger the 
smoother (maybe slower if too large)</p>
</td></tr>
<tr><td><code id="plot.VFP_+3A_...">...</code></td>
<td>
<p>additional parameters passed forward</p>
</td></tr>
</table>


<h3>Value</h3>

<p>(matrix) of predictions at user-specified X- or Y-coordinates is invisibly return in case Prediction is not NULL
</p>


<h3>Author(s)</h3>

<p>Andre Schuetzemeister <a href="mailto:andre.schuetzeneister@roche.com">andre.schuetzeneister@roche.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fit.vfp">fit.vfp</a></code>, <code><a href="#topic+predict.VFP">predict.VFP</a></code>, <code><a href="#topic+predictMean">predictMean</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(VCA)
data(VCAdata1)
lst &lt;- anovaVCA(y~(device+lot)/day/run, VCAdata1, by="sample")
mat &lt;- getMat.VCA(lst)		# automatically selects "total"
mat

res &lt;- fit.vfp(model.no=1:10, Data=mat)
plot(res)
plot(res, type="cv")
plot(res, type="cv", ci.type="lines", ci.col="red",
		Grid=list(col="wheat"), Points=list(pch=2, lwd=2, col="black"))

# same for repeatability
mat.err &lt;- getMat.VCA(lst, "error")
res.err &lt;- fit.vfp(1:10, Data=mat.err)
plot(res.err)

# add predictions to plot, e.g. functional sensitivity
plot(res.err, type="cv", xlim=c(0, 4), Prediction=10)

# variability at X-values are of interest
plot(res.err, type="cv", xlim=c(0, 4), Prediction=list(x=0.5))

# one can specify X- and Y-values in the "Prediction" list-argument
plot(res.err, type="cv", xlim=c(0, 4), 
		Prediction=list(x=c(0.25, 0.5), y=15))

#######################################################################
# another example using CA19_9 data from CLSI EP05-A3

data(CA19_9)

# fit reproducibility model to data
fits.CA19_9 &lt;- anovaVCA(result~site/day, CA19_9, by="sample")

# fit within-laboratory-model treating site as fixed effect
fits.ip.CA19_9 &lt;- anovaMM(result~site/(day), CA19_9, by="sample")

# the variability "between-site" is not part of "total"
fits.ip.CA19_9[[1]]
fits.CA19_9[[1]]

# extract repeatability
rep.CA19_9 &lt;- getMat.VCA(fits.CA19_9, "error")

# extract reproducibility
repro.CA19_9 &lt;- getMat.VCA(fits.CA19_9, "total")

# extract intermediate-precision (within-lab)
ip.CA19_9 &lt;- getMat.VCA(fits.ip.CA19_9, "total")

# fit model (a+bX)^C (model 8) to all three matrices

mod8.repro 	&lt;- fit.vfp(repro.CA19_9, 8)
mod8.ip		&lt;- fit.vfp(ip.CA19_9, 8)
mod8.rep		&lt;- fit.vfp(rep.CA19_9, 8)

# plot reproducibility precision profile first
# leave enough space in right margin for a legend
plot(mod8.repro, mar=c(5.1, 7, 4.1, 15), 
		type="cv", ci.type="none", Model=FALSE,
		Line=list(col="blue", lwd=3), 
		Points=list(pch=15, col="blue", cex=1.5),  
		xlim=c(10, 450), ylim=c(0,10),
		Xlabel=list(text="CA19-9, kU/L (LogScale) - 3 Patient Pools, 3 QC Materials",
				cex=1.5), Title=NULL,
		Ylabel=list(text="% CV", cex=1.5),
		Grid=NULL, Crit=NULL, log="x")

# add intermediate precision profile
plot	(mod8.ip, type="cv", add=TRUE, ci.type="none",
		Points=list(pch=16, col="deepskyblue", cex=1.5),
		Line=list(col="deepskyblue", lwd=3), log="x")

# add repeatability precision profile
plot(mod8.rep, type="cv", add=TRUE, ci.type="none",
		Points=list(pch=17, col="darkorchid3", cex=1.5),
		Line=list(col="darkorchid3", lwd=3), log="x")

# add legend to right margin
legend.rm( x="center", pch=15:17, col=c("blue", "deepskyblue", "darkorchid3"),
		cex=1.5, legend=c("Reproducibility", "Within-Lab Precision", "Repeatability"),
		box.lty=0)

# repeatability precision profile with some beautifications
plot(mod8.rep, BG="darkgray", 
		Points=list(pch=17, cex=1.5, col="blue"), Line=list(col="blue"),
		Grid=list(x=seq(0, 400, 50), y=seq(0, 100, 10), col="white"),
		Xlabel=list(cex=1.5, text="CA19-9 [U/mL]", col="blue"),
		Ylabel=list(cex=1.5, text="Repeatability on Variance-Scale", col="blue"),
		Crit=list(text.col="white", text.font=2, cex=1.25))

</code></pre>

<hr>
<h2 id='powfun2simple'>Internal Function Model 2.</h2><span id='topic+powfun2simple'></span>

<h3>Description</h3>

<p>Internal Function Model 2.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>powfun2simple(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="powfun2simple_+3A_x">x</code></td>
<td>
<p>(numeric) parameter</p>
</td></tr>
</table>

<hr>
<h2 id='powfun3'>Internal Function Model 3.</h2><span id='topic+powfun3'></span>

<h3>Description</h3>

<p>Internal Function Model 3.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>powfun3(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="powfun3_+3A_x">x</code></td>
<td>
<p>(numeric) parameter</p>
</td></tr>
</table>

<hr>
<h2 id='powfun3simple'>Internal Function Model 3.</h2><span id='topic+powfun3simple'></span>

<h3>Description</h3>

<p>Internal Function Model 3.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>powfun3simple(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="powfun3simple_+3A_x">x</code></td>
<td>
<p>(numeric) parameter</p>
</td></tr>
</table>

<hr>
<h2 id='powfun4'>Internal Function Model 4.</h2><span id='topic+powfun4'></span>

<h3>Description</h3>

<p>Internal Function Model 4.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>powfun4(x, potenz)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="powfun4_+3A_x">x</code></td>
<td>
<p>(numeric) parameter 1</p>
</td></tr>
<tr><td><code id="powfun4_+3A_potenz">potenz</code></td>
<td>
<p>(numeric) parameter 2</p>
</td></tr>
</table>

<hr>
<h2 id='powfun4simple'>Internal Function Model 4.</h2><span id='topic+powfun4simple'></span>

<h3>Description</h3>

<p>Internal Function Model 4.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>powfun4simple(x, potenz)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="powfun4simple_+3A_x">x</code></td>
<td>
<p>(numeric) parameter 1</p>
</td></tr>
<tr><td><code id="powfun4simple_+3A_potenz">potenz</code></td>
<td>
<p>(numeric) parameter 2</p>
</td></tr>
</table>

<hr>
<h2 id='powfun5'>Internal Function Model 5.</h2><span id='topic+powfun5'></span>

<h3>Description</h3>

<p>Internal Function Model 5.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>powfun5(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="powfun5_+3A_x">x</code></td>
<td>
<p>(numeric) parameter 1</p>
</td></tr>
</table>

<hr>
<h2 id='powfun5simple'>Internal Function Model 5.</h2><span id='topic+powfun5simple'></span>

<h3>Description</h3>

<p>Internal Function Model 5.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>powfun5simple(x, K)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="powfun5simple_+3A_x">x</code></td>
<td>
<p>(numeric) parameter 1</p>
</td></tr>
<tr><td><code id="powfun5simple_+3A_k">K</code></td>
<td>
<p>(numeric) parameter 2</p>
</td></tr>
</table>

<hr>
<h2 id='powfun6'>Internal Function Model 6.</h2><span id='topic+powfun6'></span>

<h3>Description</h3>

<p>Internal Function Model 6.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>powfun6(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="powfun6_+3A_x">x</code></td>
<td>
<p>(numeric) parameter 1</p>
</td></tr>
</table>

<hr>
<h2 id='powfun6simple'>Internal Function Model 6.</h2><span id='topic+powfun6simple'></span>

<h3>Description</h3>

<p>Internal Function Model 6.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>powfun6simple(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="powfun6simple_+3A_x">x</code></td>
<td>
<p>(numeric) parameter 1</p>
</td></tr>
</table>

<hr>
<h2 id='powfun7'>Internal Function Model 7.</h2><span id='topic+powfun7'></span>

<h3>Description</h3>

<p>Internal Function Model 7.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>powfun7(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="powfun7_+3A_x">x</code></td>
<td>
<p>(numeric) parameter 1</p>
</td></tr>
</table>

<hr>
<h2 id='powfun7simple'>Internal Function Model 7.</h2><span id='topic+powfun7simple'></span>

<h3>Description</h3>

<p>Internal Function Model 7.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>powfun7simple(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="powfun7simple_+3A_x">x</code></td>
<td>
<p>(numeric) parameter 1</p>
</td></tr>
</table>

<hr>
<h2 id='powfun8'>Internal Function Model 8.</h2><span id='topic+powfun8'></span>

<h3>Description</h3>

<p>Internal Function Model 8.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>powfun8(x, C, signJ)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="powfun8_+3A_x">x</code></td>
<td>
<p>(numeric) parameter 1</p>
</td></tr>
<tr><td><code id="powfun8_+3A_c">C</code></td>
<td>
<p>(numeric) parameter 2</p>
</td></tr>
<tr><td><code id="powfun8_+3A_signj">signJ</code></td>
<td>
<p>(numeric) parameter 3</p>
</td></tr>
</table>

<hr>
<h2 id='powfun8simple'>Internal Function Model 8.</h2><span id='topic+powfun8simple'></span>

<h3>Description</h3>

<p>Internal Function Model 8.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>powfun8simple(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="powfun8simple_+3A_x">x</code></td>
<td>
<p>(numeric) parameter 1</p>
</td></tr>
</table>

<hr>
<h2 id='powfun9simple'>Internal Function Model 9.</h2><span id='topic+powfun9simple'></span>

<h3>Description</h3>

<p>Internal Function Model 9.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>powfun9simple(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="powfun9simple_+3A_x">x</code></td>
<td>
<p>(numeric) parameter 1</p>
</td></tr>
</table>

<hr>
<h2 id='precisionPlot'>Precision Performance Plot of Qualitative Tests.</h2><span id='topic+precisionPlot'></span>

<h3>Description</h3>

<p>This function visualizes what is described in the CLSI EP12 guideline
for qualitative test with internal continuous response (ICR). The hit rate,
i.e. the number of measurements deemed to have a certain condition. 
The C5 and C95 concentrations will be derived per default by this function
but it can be set to any set of hit rates.
The histograms representing normal distribution of imprecisions at specific
concentrations will be scaled to nicely fit into the plot, i.e. the area under
the plot will not be equal to 1.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>precisionPlot(
  vfp,
  model.no = NULL,
  cutoff,
  prob = c(0.05, 0.5, 0.95),
  col = c("blue", "black", "red"),
  Cutoff = list(),
  Title = list(),
  Xlabel = list(),
  Ylabel = list(),
  HRLine = list(),
  Legend = FALSE,
  nclass = -1,
  BG = "gray90",
  digits = 3,
  alpha = 0.15,
  alpha2 = 0,
  xlim = NULL,
  col.grid = "white",
  Nrand = 1e+06
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="precisionPlot_+3A_vfp">vfp</code></td>
<td>
<p>(VFP) object modeling imprecision over the measuring range</p>
</td></tr>
<tr><td><code id="precisionPlot_+3A_model.no">model.no</code></td>
<td>
<p>(integer) specifying the VFP-model to used</p>
</td></tr>
<tr><td><code id="precisionPlot_+3A_cutoff">cutoff</code></td>
<td>
<p>(numeric) specifying one or two cutoff(s), the latter will 
implicitly define an equivical zone with implications on how
'prob' will be interpreted (see 'prob' for details)</p>
</td></tr>
<tr><td><code id="precisionPlot_+3A_prob">prob</code></td>
<td>
<p>(numeric) values 0 &lt; x &lt; 1 specifying coverage probability of
an respecitive normal distribution at cutoff, in case of two 
cutoffs all elements of 'prob' &lt; 0.5 will be evaluated in 
regard to cutoff 1, and all 'prob' &gt; 0.5 in regard to cutoff 2</p>
</td></tr>
<tr><td><code id="precisionPlot_+3A_col">col</code></td>
<td>
<p>(character) strings specifying colors of the different distributions,
which will be plotted semi-transparent using 'alpha1' for specifying
the level of transparency (1=opaque, 0=fully transparent)</p>
</td></tr>
<tr><td><code id="precisionPlot_+3A_cutoff">Cutoff</code></td>
<td>
<p>(list) specifying all parameters of the <code><a href="graphics.html#topic+abline">abline</a></code> function.
Vertical lines representing one or two cutoffs can be specified, the
color will be re-used for a label in the upper margin. Set to NULL
to omit.</p>
</td></tr>
<tr><td><code id="precisionPlot_+3A_title">Title</code></td>
<td>
<p>(list) specifying all parameters applicable in function
<code><a href="graphics.html#topic+mtext">mtext</a></code> for specifying a main title of the plot</p>
</td></tr>
<tr><td><code id="precisionPlot_+3A_xlabel">Xlabel</code></td>
<td>
<p>(list) specifying all parameters applicable in function
<code><a href="graphics.html#topic+mtext">mtext</a></code> for specifying the X-axis label of the plot</p>
</td></tr>
<tr><td><code id="precisionPlot_+3A_ylabel">Ylabel</code></td>
<td>
<p>(list) specifying all parameters applicable in function
<code><a href="graphics.html#topic+mtext">mtext</a></code> for specifying the Y-axis label of the plot</p>
</td></tr>
<tr><td><code id="precisionPlot_+3A_hrline">HRLine</code></td>
<td>
<p>(list) specifying all parameters applicable in <code><a href="graphics.html#topic+lines">lines</a></code>
of the line representing the hit rate developing from 0% to 100%</p>
</td></tr>
<tr><td><code id="precisionPlot_+3A_legend">Legend</code></td>
<td>
<p>(logical) TRUE = a legend is added to the plot</p>
</td></tr>
<tr><td><code id="precisionPlot_+3A_nclass">nclass</code></td>
<td>
<p>(integer) number of classes in the histograms representing normal
distributions of imprecision at Cx-concentrations, number&lt;10 will lead
to automatically determining appropriate numbers per histogram (default)</p>
</td></tr>
<tr><td><code id="precisionPlot_+3A_bg">BG</code></td>
<td>
<p>(character) string specifying a background color</p>
</td></tr>
<tr><td><code id="precisionPlot_+3A_digits">digits</code></td>
<td>
<p>(integer) number of significant digits used to indicated concentrations Cx</p>
</td></tr>
<tr><td><code id="precisionPlot_+3A_alpha">alpha</code></td>
<td>
<p>(numeric) value 0&lt;=x&lt;=1 specifying the level of transparency of histograms</p>
</td></tr>
<tr><td><code id="precisionPlot_+3A_alpha2">alpha2</code></td>
<td>
<p>(numeric) similar to 'alpha' referring to the coverage probability, i.e. 
setting it to a value &lt; 0 will highlight coverage probabilities in histograms</p>
</td></tr>
<tr><td><code id="precisionPlot_+3A_xlim">xlim</code></td>
<td>
<p>(numeric) plotting limits in X-direction</p>
</td></tr>
<tr><td><code id="precisionPlot_+3A_col.grid">col.grid</code></td>
<td>
<p>(character) string specifying a color name to be used for the grid providing
orientation in X- and Y-direction</p>
</td></tr>
<tr><td><code id="precisionPlot_+3A_nrand">Nrand</code></td>
<td>
<p>(integer) specifying the number of data points simulated to represent a normal
distribution</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# perform variance component analysis
library(VCA)
data(VCAdata1)
# perform VCA-anaylsis
lst &lt;- anovaVCA(y~(device+lot)/day/run, VCAdata1, by="sample")
# transform list of VCA-objects into required matrix
mat &lt;- getMat.VCA(lst)		# automatically selects "total"
mat
# fit all models batch-wise, the best fitting will be used automatically
res &lt;- fit.vfp(model.no=1:10, Data=mat)
# plot hit and visualize imprecision usign default settings
precisionPlot(res, cutoff=20)
# without normal distribution at cutoff do
precisionPlot(res, cutoff=20, prob=c(.05, .95), col=c("blue", "red"))
# highlight the proportion &gt; cutoff (hit rate) more 
precisionPlot(res, cutoff=20, prob=c(.05, .95), col=c("blue", "red"), alpha2=.5)
# plot with legend
precisionPlot(res, cutoff=20, prob=c(.05, .95), col=c("blue", "red"), alpha2=.5, Legend=TRUE)
# use different probabilities and colors
precisionPlot(res, cutoff=20, prob=c(.05, .95), col="black", alpha2=.3)

# now using two cutoffs, i.e. with equivocal zone
precisionPlot(	res, cutoff=c(17, 19), prob=c(.05, .95), col=c("mediumblue", "red3"), 
					alpha2=.5, HRLine=list(col=c("mediumblue", "red3")))

## End(Not run)

</code></pre>

<hr>
<h2 id='predict.modelEP17'>Predict Method for Objects of Class 'modelEP17'.</h2><span id='topic+predict.modelEP17'></span>

<h3>Description</h3>

<p>This is a helper function not intented to be used directly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'modelEP17'
predict(
  object,
  newdata = NULL,
  alpha = 0.05,
  ci.type = c("vc", "sd", "cv"),
  CI.method = c("chisq", "t", "normal"),
  use.log = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.modelEP17_+3A_object">object</code></td>
<td>
<p>(object) of class 'modelEP17'</p>
</td></tr>
<tr><td><code id="predict.modelEP17_+3A_newdata">newdata</code></td>
<td>
<p>(numeric) vector of data points at which prediction shall be made</p>
</td></tr>
<tr><td><code id="predict.modelEP17_+3A_alpha">alpha</code></td>
<td>
<p>(numeric) value defining the 100(1-alpha)% confidence interval for
predictions</p>
</td></tr>
<tr><td><code id="predict.modelEP17_+3A_ci.type">ci.type</code></td>
<td>
<p>(character) string specifying on which scale prediction shall be made</p>
</td></tr>
<tr><td><code id="predict.modelEP17_+3A_ci.method">CI.method</code></td>
<td>
<p>(character) string specifying which type of CI shall be used</p>
</td></tr>
<tr><td><code id="predict.modelEP17_+3A_use.log">use.log</code></td>
<td>
<p>(logical) TRUE X- and Y-values will be returned on log-scale</p>
</td></tr>
<tr><td><code id="predict.modelEP17_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>
</p>

<hr>
<h2 id='predict.VFP'>Predict Method for Objects of Class 'VFP'.</h2><span id='topic+predict.VFP'></span>

<h3>Description</h3>

<p>Predictions are made for the variance (type=&quot;vc&quot;), standard deviation (&quot;sd&quot;) or 
coefficient of variation (&quot;cv&quot;) and their corresponding confidence intervals.
The latter are calculated primarily on the variance scale and then transformed to the
other scales, if required.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'VFP'
predict(
  object,
  model.no = NULL,
  newdata = NULL,
  alpha = 0.05,
  dispersion = NULL,
  type = c("vc", "sd", "cv"),
  CI.method = c("chisq", "t", "normal"),
  use.log = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.VFP_+3A_object">object</code></td>
<td>
<p>(object) of class &quot;VFP&quot;</p>
</td></tr>
<tr><td><code id="predict.VFP_+3A_model.no">model.no</code></td>
<td>
<p>(integer) specifying a fitted model stored in 'object'</p>
</td></tr>
<tr><td><code id="predict.VFP_+3A_newdata">newdata</code></td>
<td>
<p>(numeric) optionally, a vector specifying mean-values for which predictions
on the user-defined scale ('type') are requested. If omitted, fitted values 
will be returned.</p>
</td></tr>
<tr><td><code id="predict.VFP_+3A_alpha">alpha</code></td>
<td>
<p>(numeric) value specifying the 100 x (1-alpha)% confidence interval of predicted
values</p>
</td></tr>
<tr><td><code id="predict.VFP_+3A_dispersion">dispersion</code></td>
<td>
<p>(numeric) NULL = the dispersion will be set =1 (should usually not be changed; 
For the Saddler model, the dispersion is 1.),
numeric value = the dispersion parameter will be used as specified</p>
</td></tr>
<tr><td><code id="predict.VFP_+3A_type">type</code></td>
<td>
<p>(character) specifying on which scale the predicted values shall be returned, 
possible are &quot;vc&quot; = variance, &quot;sd&quot;=standard deviation, &quot;cv&quot;=coefficient of variation</p>
</td></tr>
<tr><td><code id="predict.VFP_+3A_ci.method">CI.method</code></td>
<td>
<p>(character) one of &quot;t&quot;, &quot;normal&quot;, &quot;chisq&quot; specifying which CI-method to use</p>
</td></tr>
<tr><td><code id="predict.VFP_+3A_use.log">use.log</code></td>
<td>
<p>(logical) TRUE = X- and Y-axis will be log-transformed</p>
</td></tr>
<tr><td><code id="predict.VFP_+3A_...">...</code></td>
<td>
<p>additional parameters passed forward to function <code>predict.gnm</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>(data.frame) with numeric variables:<br />
</p>
<table>
<tr><td><code>Mean</code></td>
<td>
<p>value at which predictions were requested</p>
</td></tr>
<tr><td><code>Fitted</code></td>
<td>
<p>prediction at 'Mean'</p>
</td></tr>
<tr><td><code>SE</code></td>
<td>
<p>standard error of prediction</p>
</td></tr>
<tr><td><code>Scale</code></td>
<td>
<p>residual scale</p>
</td></tr>
<tr><td><code>LCL</code></td>
<td>
<p>lower confidence limit of the 100x(1-'alpha')% CI</p>
</td></tr>
<tr><td><code>UCL</code></td>
<td>
<p>upper confidence limit of the 100x(1-'alpha')% CI</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
library(VCA)
data(VCAdata1)
lst &lt;- anovaVCA(y~(device+lot)/day/run, VCAdata1, by="sample")
mat &lt;- getMat.VCA(lst)		# automatically selects "total"
res &lt;- fit.vfp(model.no=1:10, Data=mat)
predict(res)
predict(res, dispersion=0.95)

</code></pre>

<hr>
<h2 id='predictMean'>Finding X-Value for Given Y-Value Using a Bisection-Approach.</h2><span id='topic+predictMean'></span>

<h3>Description</h3>

<p>For given variability-values (Y-axis) on one of three scales (see 'type'), those values on
the X-axis are determined which give fitted values equal to the specification.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predictMean(
  obj,
  type = c("vc", "sd", "cv"),
  model.no = NULL,
  alpha = 0.05,
  newdata = NULL,
  tol = 1e-04,
  ci = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predictMean_+3A_obj">obj</code></td>
<td>
<p>(object) of class 'VFP'</p>
</td></tr>
<tr><td><code id="predictMean_+3A_type">type</code></td>
<td>
<p>(character) &quot;vc&quot; = variance, &quot;sd&quot; = standard deviation = sqrt(variance), 
&quot;cv&quot; = coefficient of variation</p>
</td></tr>
<tr><td><code id="predictMean_+3A_model.no">model.no</code></td>
<td>
<p>(integer) specifying which model to use in case 'obj' represents multiple
fitted models</p>
</td></tr>
<tr><td><code id="predictMean_+3A_alpha">alpha</code></td>
<td>
<p>(numeric) value specifying the 100x(1-alpha)% confidence interval for the 
predicted value(s)</p>
</td></tr>
<tr><td><code id="predictMean_+3A_newdata">newdata</code></td>
<td>
<p>(numeric) values representing variability-values on a specific scale ('type')</p>
</td></tr>
<tr><td><code id="predictMean_+3A_tol">tol</code></td>
<td>
<p>(numeric) tolerance value relative to 'newdata' specifying the stopping criterion
for the bisection algorithm, also used to evaluate equality of lower and upper bounds
in a bisection step for checking whether a boundary can be determined or not</p>
</td></tr>
<tr><td><code id="predictMean_+3A_ci">ci</code></td>
<td>
<p>(logical) indicates whether confidence intervals for predicted concentrations are
required (TRUE) or not (FALSE), if 'newdata' contains many values the overall computation
time can be minimized to 1/3 leaving out runs of the bisection-algorithm for LCL and UCL</p>
</td></tr>
<tr><td><code id="predictMean_+3A_...">...</code></td>
<td>
<p>additional parameter passed forward or used internally</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is achieved using a bisection algorithm which converges according to the specified tolerance 'tol'.
In case of 'type=&quot;cv&quot;', i.e. if specified Y-values are coefficients of variation, these are interpreted
as percentages (15 = 15%).
</p>


<h3>Value</h3>

<p>(data.frame) with variables &quot;Mean&quot; (X-value), &quot;VC&quot;, &quot;SD&quot; or &quot;CV&quot; depending on 'type',
&quot;Diff&quot; the difference to the specified Y-value, &quot;LCL&quot; and &quot;UCL&quot; as limits of the 100x(1-alpha)% CI.
</p>


<h3>Author(s)</h3>

<p>Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fit.vfp">fit.vfp</a></code>, <code><a href="#topic+predict.VFP">predict.VFP</a></code>, <code><a href="#topic+plot.VFP">plot.VFP</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# perform variance component analyses first
library(VCA)
data(CA19_9)
fits.CA19_9 &lt;- anovaVCA(result~site/day, CA19_9, by="sample")

# extract repeatability
mat.CA19_9 &lt;- getMat.VCA(fits.CA19_9, "error")
res.CA19_9 &lt;- fit.vfp(mat.CA19_9, 1:10)
summary(res.CA19_9)
print(res.CA19_9)

# predict CA19_9-concentration with 5\% CV
predictMean(res.CA19_9, newdata=5) 

# this is used in function plot.VFP as well
plot(res.CA19_9, Prediction=list(y=5), type="cv")
plot(res.CA19_9, Prediction=list(y=5), type="cv", 
		xlim=c(0, 80), ylim=c(0, 10))

</code></pre>

<hr>
<h2 id='print.VFP'>Print Objects of Class 'VFP'</h2><span id='topic+print.VFP'></span>

<h3>Description</h3>

<p>Print Objects of Class 'VFP'
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'VFP'
print(x, model.no = NULL, digits = 4, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.VFP_+3A_x">x</code></td>
<td>
<p>(object) of class 'VFP'</p>
</td></tr>
<tr><td><code id="print.VFP_+3A_model.no">model.no</code></td>
<td>
<p>(integer) specifying a fitted model in 'x', if NULL the best fitting
model will be printed, i.e. the one with min(AIC)</p>
</td></tr>
<tr><td><code id="print.VFP_+3A_digits">digits</code></td>
<td>
<p>(integer) number of significant digits</p>
</td></tr>
<tr><td><code id="print.VFP_+3A_...">...</code></td>
<td>
<p>additional parameters passed forward</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(VCA)
data(CA19_9)
fits.CA19_9 &lt;- anovaVCA(result~site/day, CA19_9, by="sample")
# extract repeatability
mat.CA19_9 &lt;- getMat.VCA(fits.CA19_9, "error")
res.CA19_9 &lt;- fit.vfp(mat.CA19_9, 1:10)
res.CA19_9

</code></pre>

<hr>
<h2 id='RealData1'>Result of a Real-World Precsion Experiment on 10 Samples</h2><span id='topic+RealData1'></span>

<h3>Description</h3>

<p>(data.frame) representing the results of an imprecision experiment.
There are 10 observations and six variables which can be used directly
as input for function 'fit.vfp'. Different samples are indicated by variable
&quot;No&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(RealData1)</code></pre>


<h3>Format</h3>

<p>data.frame with 10 observations and 6 variables.</p>

<hr>
<h2 id='ReproData'>Serum Work Area Example Data of a Reproducibility Experiment</h2><span id='topic+ReproData'></span>

<h3>Description</h3>

<p>Multi-site precision experiment using 6 human serum-samples and 2 precision
control samples, which were all measured at each site on 12 days, with 2 runs
per day and 2 replicates per run, i.e. there are 8 (sample) x 3 (sites/labs) x
12 (days) x 2 (runs) x 2 (replicates) = 1152 observations overall.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(ReproData)</code></pre>


<h3>Format</h3>

<p>data.frame with 1152 observations and 5 variables.</p>

<hr>
<h2 id='Signif'>Adapted Version of Function 'signif'</h2><span id='topic+Signif'></span>

<h3>Description</h3>

<p>This function adapts base-function <code><a href="base.html#topic+signif">signif</a></code>
by always returning integer values in case the number of
requested significant digits is less than the the number of
digits in front of the decimal separator.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Signif(x, digits = 4, force = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Signif_+3A_x">x</code></td>
<td>
<p>(numeric) value to be rounded to the desired number
of significant digits</p>
</td></tr>
<tr><td><code id="Signif_+3A_digits">digits</code></td>
<td>
<p>(integer) number of significant digits</p>
</td></tr>
<tr><td><code id="Signif_+3A_force">force</code></td>
<td>
<p>(logical) TRUE = force the return value to have at least 4 significant
digits, i.e. to integers with less digits zeros will be appended after
the decimal separator, otherwise the return value will be casted from
character to numeric</p>
</td></tr>
<tr><td><code id="Signif_+3A_...">...</code></td>
<td>
<p>additional parameters</p>
</td></tr>
</table>


<h3>Value</h3>

<p>number with 'digits' significant digits, if 'force=TRUE' &quot;character&quot; objects will be
returned otherwise objects of mode &quot;numeric&quot;
</p>


<h3>Author(s)</h3>

<p>Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>
</p>

<hr>
<h2 id='summary.VFP'>Summary Objects of Class 'VFP'</h2><span id='topic+summary.VFP'></span>

<h3>Description</h3>

<p>Summary Objects of Class 'VFP'
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'VFP'
summary(
  object,
  model.no = NULL,
  digits = 4,
  type = c("simple", "complex"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.VFP_+3A_object">object</code></td>
<td>
<p>(object) of class 'VFP'</p>
</td></tr>
<tr><td><code id="summary.VFP_+3A_model.no">model.no</code></td>
<td>
<p>(integer) specifying a fitted model in 'x', if NULL the best fitting
model will be printed, i.e. the one with min(RSS)</p>
</td></tr>
<tr><td><code id="summary.VFP_+3A_digits">digits</code></td>
<td>
<p>(integer) number of significant digits</p>
</td></tr>
<tr><td><code id="summary.VFP_+3A_type">type</code></td>
<td>
<p>(character) &quot;simple&quot; = short summary, &quot;complex&quot; = calls the summary-method
for objects of class &quot;gnm&quot;</p>
</td></tr>
<tr><td><code id="summary.VFP_+3A_...">...</code></td>
<td>
<p>additional parameters passed forward</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(VCA)
data(CA19_9)
fits.CA19_9 &lt;- anovaVCA(result~site/day, CA19_9, by="sample")
# extract repeatability
mat.CA19_9 &lt;- getMat.VCA(fits.CA19_9, "error")
res.CA19_9 &lt;- fit.vfp(mat.CA19_9, 1:10)
summary(res.CA19_9)
print(res.CA19_9)

</code></pre>

<hr>
<h2 id='t.coef'>Transformation of Coefficients.</h2><span id='topic+t.coef'></span>

<h3>Description</h3>

<p>This function performs transformation from the original parameterization into the 'VFP'-package
internal re-parameterized form.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'coef'
t(
  coeffs0,
  K = NULL,
  Maxi = NULL,
  model = NULL,
  signJ = NULL,
  eps = sqrt(.Machine$double.eps),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="t.coef_+3A_coeffs0">coeffs0</code></td>
<td>
<p>(numeric) vector of function coefficients to be transformed into the
re-parameterized form</p>
</td></tr>
<tr><td><code id="t.coef_+3A_k">K</code></td>
<td>
<p>(numeric) constant value 'K'</p>
</td></tr>
<tr><td><code id="t.coef_+3A_maxi">Maxi</code></td>
<td>
<p>(numeric) max. value</p>
</td></tr>
<tr><td><code id="t.coef_+3A_model">model</code></td>
<td>
<p>(integer) specifying which model shall be back-transformed</p>
</td></tr>
<tr><td><code id="t.coef_+3A_signj">signJ</code></td>
<td>
<p>(integer) either 1 or -1</p>
</td></tr>
<tr><td><code id="t.coef_+3A_eps">eps</code></td>
<td>
<p>(numeric) constant used instead of zero in case of log-transformation</p>
</td></tr>
<tr><td><code id="t.coef_+3A_...">...</code></td>
<td>
<p>additional parameters</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In the 'VFP' package models are re-parameterized to have better control over the constrained
solution-space, i.e. only models may be fitted generating non-negative fitted values. This 
function is intended to be for internal use only.
</p>


<h3>Value</h3>

<p>(numeric) vector of coefficients in re-parameterized form
</p>


<h3>Author(s)</h3>

<p>Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>
Florian Dufey <a href="mailto:florian.dufey@roche.com">florian.dufey@roche.com</a>
</p>

<hr>
<h2 id='T4S9_99'>Example Data T4S9_99.VFP (T4 RIA) from the Variance Function Program 12.0 from Sadler</h2><span id='topic+T4S9_99'></span>

<h3>Description</h3>

<p>Clinical specimen T4 RIA duplicates produced during 1999 by a staff member.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(T4S9_99)</code></pre>


<h3>Format</h3>

<p>data.frame with 8553 observations and 2 variables.</p>


<h3>References</h3>

<p>VFP Program Version 12.0\
<a href="http://www.aacb.asn.au/professionaldevelopment/useful-tools">http://www.aacb.asn.au/professionaldevelopment/useful-tools</a>
</p>

<hr>
<h2 id='VFP-package'>(V)ariance (F)unction (P)rogram</h2><span id='topic+VFP'></span><span id='topic+VFP-package'></span>

<h3>Description</h3>

<p>The intended use of this package is to implement variance functions proposed in Sadler's VFP stand-alone software 
(see reference below), from which the name was borrowed as well. 
Main function of this package is <code><a href="#topic+fit.vfp">fit.vfp</a></code> for fitting non-linear variance-function
models. Usually, these models are fitted to analysis-results of precision performance data e.g.
frequently generated for in-vitro diagnostics (IVD). R-package VFP is designed to work best on objects 
of class 'VCA' as generated by R-package <code>VCA</code> but it is not restricted to these.
There are several functions operating on S3-objects of class 'VFP', e.g. <code><a href="#topic+plot.VFP">plot.VFP</a></code>,
<code><a href="#topic+print.VFP">print.VFP</a></code>, <code><a href="#topic+summary.VFP">summary.VFP</a></code>, and <code><a href="#topic+predict.VFP">predict.VFP</a></code>. Function <code><a href="#topic+predictMean">predictMean</a></code>
is of special interest when a functional relationship is used to derive limit of quantitation (LoQ) or functional
sensitivity, as the concentration at which the IVD-imprecision expressed as coefficient of variation (CV) undercuts
a specific threshold.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
    Package: </td><td style="text-align: left;"> VFP</td>
</tr>
<tr>
 <td style="text-align: left;">
    Type: </td><td style="text-align: left;"> Package </td>
</tr>
<tr>
 <td style="text-align: left;">
    Version: </td><td style="text-align: left;"> 1.4.1 </td>
</tr>
<tr>
 <td style="text-align: left;">
    Date: </td><td style="text-align: left;"> 2022-11-08</td>
</tr>
<tr>
 <td style="text-align: left;">
    License:  </td><td style="text-align: left;"> GPL (&gt;=3) </td>
</tr>
<tr>
 <td style="text-align: left;">
    LazyLoad: </td><td style="text-align: left;"> yes </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>,
Florian Dufey <a href="mailto:florian.dufey@roche.com">florian.dufey@roche.com</a>,
Andrea Geistanger <a href="mailto:andrea.geistanger@roche.com">andrea.geistanger@roche.com</a>
</p>


<h3>References</h3>

<p>CLSI EP05-A3: Evaluation of Precision of Quantitative Measurement Procedures; Approved Guideline - Third Edition. (2014)
Sadler WA, Smith MH. Use and Abuse of Imprecision Profiles: Some Pitfalls Illustarted by Computing and Plotting Confidence Intervals. Clin Chem 1990; 36/7:1346-1350
</p>
<p>Sadler WA, Smith MH. A reliable method of estimating the variance function in immunoassays. Comput Stat Data Anal 1986; 3:227-239
</p>
<p>Sadler WA, Smith MH. Estimation of imprecision in immunoassays quality assessment programmes. Ann Clin Biochem 1987; 24:98-102
</p>
<p>Sadler WA, <a href="http://www.aacb.asn.au/professionaldevelopment/useful-tools/variance-function-program-version-110">http://www.aacb.asn.au/professionaldevelopment/useful-tools/variance-function-program-version-110</a>. Accessed November 16, 2015
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
