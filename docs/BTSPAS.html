<!DOCTYPE html><html><head><title>Help for package BTSPAS</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {BTSPAS}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#.onAttach'><p>Message to display when package is loaded</p></a></li>
<li><a href='#logit'><p>Logit and anti-logit function.</p></a></li>
<li><a href='#plot_acf'><p>Create an acf plot of a parameter</p></a></li>
<li><a href='#plot_posterior'><p>Create posterior plot of a parameter with credible interval limits shown as vertical lines</p></a></li>
<li><a href='#plot_trace'><p>Creates trace plots of specified parameters showing the multiple chains and</p>
the value of Rhat</a></li>
<li><a href='#PredictivePosteriorPlot.TSPDE'><p>Generate Predictive Posterior Plots (Bayesian p-values) for number of models.</p></a></li>
<li><a href='#RunTime'><p>Compute percentiles of the run timing distribution.</p></a></li>
<li><a href='#SimplePetersen'><p>Simple Petersen Estimator and test if pooling can be done</p></a></li>
<li><a href='#TimeStratPetersenDiagError_fit'><p>Wrapper (*_fit) to call the Time Stratified Petersen Estimator</p>
with Diagonal Entries function.</a></li>
<li><a href='#TimeStratPetersenDiagErrorWHChinook2_fit'><p>Wrapper (*_fit) to fit the Time Stratified Petersen Estimator</p>
with Diagonal Entries and separating Wild from Hatchery Chinook function.</a></li>
<li><a href='#TimeStratPetersenDiagErrorWHSteel_fit'><p>Wrapper (*_fit) and function to call the Time Stratified Petersen Estimator</p>
with Diagonal Entries and separating Wild from Hatchery Steelhead function.</a></li>
<li><a href='#TimeStratPetersenNonDiagError_fit'><p>Wrapper (*_fit) to fit the Time Stratified Petersen Estimator</p>
with NON Diagonal Entries function.</a></li>
<li><a href='#TimeStratPetersenNonDiagErrorNP_fit'><p>Wrapper (*_fit)  to fit the Time Stratified Petersen Estimator</p>
with NON Diagonal Entries function and a non-parametric travel time estimator..</a></li>
<li><a href='#TimeStratPetersenNonDiagErrorNPMarkAvail_fit'><p>Wrapper (*_fit)  to call the function to fit a Time Stratified Petersen Estimator</p>
with NON Diagonal Entries with an non-parametric travel time and fall back</a></li>
<li><a href='#TimeToTargetRunSize'><p>Computes and plots posterior distribution of time to get target run size.</p>
For example, the time to reach a cumulative run of 10,000 fish.</a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>2024.5.9</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-05-09</td>
</tr>
<tr>
<td>Title:</td>
<td>Bayesian Time-Stratified Population Analysis</td>
</tr>
<tr>
<td>Author:</td>
<td>Carl J Schwarz &lt;cschwarz.stat.sfu.ca@gmail.com&gt; and
	Simon J Bonner &lt;sbonner6@uwo.ca&gt;</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Carl J Schwarz &lt;cschwarz.stat.sfu.ca@gmail.com&gt;</td>
</tr>
<tr>
<td>Imports:</td>
<td>actuar, coda, data.table, ggplot2, ggforce, graphics,
grDevices, gridExtra, plyr, reshape2, R2jags, scales, splines,
stats, utils</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>JAGS</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides advanced Bayesian methods to estimate
	     abundance and run-timing from temporally-stratified
	     Petersen mark-recapture experiments. Methods include
	     hierarchical modelling of the capture probabilities
  	     and spline smoothing of the daily run size. Theory
  	     described in Bonner and Schwarz (2011)
         &lt;<a href="https://doi.org/10.1111%2Fj.1541-0420.2011.01599.x">doi:10.1111/j.1541-0420.2011.01599.x</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/cschwarz-stat-sfu-ca/BTSPAS">https://github.com/cschwarz-stat-sfu-ca/BTSPAS</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>R.rsp</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>R.rsp</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-05-10 21:36:22 UTC; cschwarz</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-05-10 22:03:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='.onAttach'>Message to display when package is loaded</h2><span id='topic+.onAttach'></span>

<h3>Description</h3>

<p>Message to display when package is loaded
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.onAttach(libname, pkgname)
</code></pre>

<hr>
<h2 id='logit'>Logit and anti-logit function.</h2><span id='topic+logit'></span><span id='topic+expit'></span>

<h3>Description</h3>

<p>Compute the logit or anti-logit.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>logit(p)

expit(theta)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="logit_+3A_p">p</code></td>
<td>
<p>probability between 0 and 1.</p>
</td></tr>
<tr><td><code id="logit_+3A_theta">theta</code></td>
<td>
<p>logit between -infinity and +infinity</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Computed logit or anti-logit
</p>


<h3>Author(s)</h3>

<p>C.J.Schwarz <a href="mailto:cschwarz@stat.sfu.ca">cschwarz@stat.sfu.ca</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
##---- compute the logit and its inverse
logitp &lt;- logit(.3)
p &lt;- expit(-.84)

</code></pre>

<hr>
<h2 id='plot_acf'>Create an acf plot of a parameter</h2><span id='topic+plot_acf'></span>

<h3>Description</h3>

<p>Create an acf plot of a parameter
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_acf(mcmc.sample, ncol = 2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_acf_+3A_mcmc.sample">mcmc.sample</code></td>
<td>
<p>Data frame with 2 columns. parm, and sample. A separate ACF plot is generated for each parameter using facet_wrap.</p>
</td></tr>
<tr><td><code id="plot_acf_+3A_ncol">ncol</code></td>
<td>
<p>Number of columns in the plot.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>acf plot(s) as an ggplot2 object
</p>

<hr>
<h2 id='plot_posterior'>Create posterior plot of a parameter with credible interval limits shown as vertical lines</h2><span id='topic+plot_posterior'></span>

<h3>Description</h3>

<p>Create posterior plot of a parameter with credible interval limits shown as vertical lines
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_posterior(mcmc.sample, alpha = 0.05, ncol = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_posterior_+3A_mcmc.sample">mcmc.sample</code></td>
<td>
<p>Data frame with 2 columns. parm, and sample. A separate posterior plot is generated for each parameter.</p>
</td></tr>
<tr><td><code id="plot_posterior_+3A_alpha">alpha</code></td>
<td>
<p>Used to determine credible interval.</p>
</td></tr>
<tr><td><code id="plot_posterior_+3A_ncol">ncol</code></td>
<td>
<p>Number of columns in the plot (default=1).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Posterior plot(s) as an ggplot2 object
</p>

<hr>
<h2 id='plot_trace'>Creates trace plots of specified parameters showing the multiple chains and
the value of Rhat</h2><span id='topic+plot_trace'></span>

<h3>Description</h3>

<p>Takes the MCMC object returned from a split and produces trace_plots for the
listed parameters. It shows a separate line on the plot for each chain and
also shows the value of Rhat
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_trace(
  title = " ",
  results = NULL,
  parms_to_plot = NULL,
  nrow = 2,
  ncol = 2
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_trace_+3A_title">title</code></td>
<td>
<p>A character string used for a title on reports and graphs</p>
</td></tr>
<tr><td><code id="plot_trace_+3A_results">results</code></td>
<td>
<p>The MCMC object containing the results from the call to JAGS</p>
</td></tr>
<tr><td><code id="plot_trace_+3A_parms_to_plot">parms_to_plot</code></td>
<td>
<p>A character vector of names of parameters to plot.
These must match exactly to the parameter names used in the simulation.</p>
</td></tr>
<tr><td><code id="plot_trace_+3A_ncol">ncol</code>, <code id="plot_trace_+3A_nrow">nrow</code></td>
<td>
<p>How many plots to put on a page (number of rows and columns)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of ggplot2 objects using facet_wrap_paginate (...., page=...) with each element of the list
corresponding to one page of the plot.
</p>


<h3>Author(s)</h3>

<p>Bonner, S.J. <a href="mailto:sbonner6@uwo.ca">sbonner6@uwo.ca</a> and 
Schwarz, C. J. <a href="mailto:cschwarz.stat.sfu.ca@gmail.com">cschwarz.stat.sfu.ca@gmail.com</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Create trace plots of the logitP parameters
# 
# Trace plots of logitP
varnames &lt;- names(results$sims.array[1,1,])  # extract the names of the variables 
trace.plot &lt;- plot_trace(title=title, 
                         results=results, 
                         parms_to_plot=varnames[grep("^logitP", varnames)])
if(save.output.to.files){
  pdf(file=paste(prefix,"-trace-logitP.pdf",sep=""))
  plyr::l_ply(trace.plot, function(x){plot(x)})
  dev.off()
}

## End(Not run) # end of dontrun

</code></pre>

<hr>
<h2 id='PredictivePosteriorPlot.TSPDE'>Generate Predictive Posterior Plots (Bayesian p-values) for number of models.</h2><span id='topic+PredictivePosteriorPlot.TSPDE'></span><span id='topic+PredictivePosteriorPlot.TSPDE.WHCH2'></span><span id='topic+PredictivePosteriorPlot.TSPDE.WHSteel'></span><span id='topic+PredictivePosteriorPlot.TSPNDE'></span><span id='topic+PredictivePosterior.TSPDE'></span><span id='topic+PredictivePosterior_TSPDE_WHChinook'></span><span id='topic+PredictivePosterior.TSPDE.WHCH2'></span><span id='topic+PredictivePosterior.TSPDE.WHSteel'></span><span id='topic+PredictivePosterior.TSPNDE'></span><span id='topic+PredictivePosterior.TSPNDENP'></span><span id='topic+PredictivePosteriorPlot.TSPDE.WHCH'></span><span id='topic+PredictivePosterior.TSPDE.WHCH'></span><span id='topic+PredictivePosterior.TSPNDENPMarkAvail'></span>

<h3>Description</h3>

<p>This is an internal function, not normally of use to users.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PredictivePosteriorPlot.TSPDE(discrep)

PredictivePosteriorPlot.TSPDE.WHCH2(discrep, ncol = 2, nrow = 2)

PredictivePosteriorPlot.TSPDE.WHSteel(discrep)

PredictivePosteriorPlot.TSPNDE(discrep)

PredictivePosterior.TSPDE(n1, m2, u2, logitP.fixed, p, U)

PredictivePosterior.TSPDE.WHCH(
  time,
  n1,
  m2,
  u2.A,
  u2.N,
  clip.frac.H,
  p,
  U.W,
  U.H,
  hatch.after
)

PredictivePosterior.TSPDE.WHCH2(
  time,
  n1,
  m2,
  u2.A.YoY,
  u2.N.YoY,
  u2.A.1,
  u2.N.1,
  clip.frac.H.YoY,
  clip.frac.H.1,
  p,
  U.W.YoY,
  U.H.YoY,
  U.W.1,
  U.H.1,
  hatch.after.YoY
)

PredictivePosterior.TSPDE.WHSteel(
  time,
  n1,
  m2,
  u2.W.YoY,
  u2.W.1,
  u2.H.1,
  p,
  U.W.YoY,
  U.W.1,
  U.H.1,
  hatch.after
)

PredictivePosterior.TSPNDE(n1, m2, u2, logitP.fixed, p, U, mu, sigma)

PredictivePosterior.TSPNDENP(
  n1,
  m2.expanded,
  u2,
  logitP.fixed,
  p,
  U,
  Theta,
  Delta.max
)

PredictivePosterior.TSPNDENPMarkAvail(
  n1,
  m2.expanded,
  u2,
  logitP.fixed,
  p,
  U,
  Theta,
  ma.p,
  Delta.max
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PredictivePosteriorPlot.TSPDE_+3A_ma.p">ma.p</code></td>
<td>
<p>Proportion of marks available, i.e 1-fallback probability</p>
</td></tr>
</table>

<hr>
<h2 id='RunTime'>Compute percentiles of the run timing distribution.</h2><span id='topic+RunTime'></span>

<h3>Description</h3>

<p>Take the posterior sample of U[1,...nstrata] and compute the percentiles of the run
timing. 
This uses the quantile() function from the &quot;actuar&quot; package which is designed to compute
quantiles of grouped data.
It is assumed that there are no fish in the system prior to the first point
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunTime(time, U, prob = seq(0, 1, 0.1))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="RunTime_+3A_time">time</code></td>
<td>
<p>A numeric vector of time used to label the strata. For example,
this could be julian week for data stratified at a weekly level.</p>
</td></tr>
<tr><td><code id="RunTime_+3A_u">U</code></td>
<td>
<p>matrix of posterior samples. Each row is a sample from the posterior.</p>
</td></tr>
<tr><td><code id="RunTime_+3A_prob">prob</code></td>
<td>
<p>Quantiles of the run timing to estimate.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An MCMC object with samples from the posterior distribution. A
series of graphs and text file are also created in the working directory.
This information is now added to the fit object as well and so it is unlikely
that you will use this function.
</p>


<h3>Author(s)</h3>

<p>Bonner, S.J. <a href="mailto:sbonner6@uwo.ca">sbonner6@uwo.ca</a> and 
Schwarz, C. J. <a href="mailto:cschwarz.stat.sfu.ca@gmail.com">cschwarz.stat.sfu.ca@gmail.com</a>.
</p>


<h3>References</h3>

<p>Bonner, S. J., &amp; Schwarz, C. J. (2011). 
Smoothing population size estimates for Time-Stratified Mark-Recapture experiments Using Bayesian P-Splines. 
Biometrics, 67, 1498-1507. 
<a href="https://doi.org/10.1111/j.1541-0420.2011.01599.x">doi:10.1111/j.1541-0420.2011.01599.x</a>
</p>
<p>Schwarz, C. J., &amp; Dempson, J. B. (1994).
Mark-recapture estimation of a salmon smolt population. 
Biometrics, 50, 98-108.
</p>
<p>Schwarz, C.J., D. Pickard, K. Marine and S.J. Bonner. 2009. Juvenile Salmonid Outmigrant
Monitoring Evaluation, Phase II - December 2009. Final Technical Memorandum for the Trinity River
Restoration Program, Weaverville, CA. 155 pp. + appendices available at
<a href="https://www.trrp.net/library/document/?id=369">https://www.trrp.net/library/document/?id=369</a>
</p>

<hr>
<h2 id='SimplePetersen'>Simple Petersen Estimator and test if pooling can be done</h2><span id='topic+SimplePetersen'></span><span id='topic+TestIfPool'></span>

<h3>Description</h3>

<p>Computes the Petersen estimator (Chapman correction applied) for the number of UNMARKED animals (U)
and total population (N) given n1, m2, and u2.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SimplePetersen(n1, m2, u2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SimplePetersen_+3A_n1">n1</code></td>
<td>
<p>Number of animals tagged and released. Can be a vector in which the estimate is formed for each element of the vector</p>
</td></tr>
<tr><td><code id="SimplePetersen_+3A_m2">m2</code></td>
<td>
<p>Number of animals from n1 that are recaptured.</p>
</td></tr>
<tr><td><code id="SimplePetersen_+3A_u2">u2</code></td>
<td>
<p>Number of unmarked animals in the second sample.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Data frame with variables U.est, U.se, N.est, and N.se.
.
</p>


<h3>Author(s)</h3>

<p>Bonner, S.J. <a href="mailto:sbonner6@uwo.ca">sbonner6@uwo.ca</a> and 
Schwarz, C. J. <a href="mailto:cschwarz.stat.sfu.ca@gmail.com">cschwarz.stat.sfu.ca@gmail.com</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'> 
SimplePetersen( 200, 10, 300) 
SimplePetersen(c(200,400), c(10,20), c(300,600))

</code></pre>

<hr>
<h2 id='TimeStratPetersenDiagError_fit'>Wrapper (*_fit) to call the Time Stratified Petersen Estimator
with Diagonal Entries function.</h2><span id='topic+TimeStratPetersenDiagError_fit'></span>

<h3>Description</h3>

<p>Takes the number of marked fish released, the number of recaptures, and the
number of unmarked fish and uses Bayesian methods to fit a fit a spline
through the population numbers and a hierarchical model for the trap
efficiencies over time.  The output is written to files and an MCMC object
is also created with samples from the posterior.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TimeStratPetersenDiagError_fit(
  title = "TSDPE",
  prefix = "TSPDE-",
  time,
  n1,
  m2,
  u2,
  sampfrac = rep(1, length(u2)),
  jump.after = NULL,
  bad.n1 = c(),
  bad.m2 = c(),
  bad.u2 = c(),
  logitP.cov = as.matrix(rep(1, length(n1))),
  logitP.fixed = NULL,
  logitP.fixed.values = NULL,
  n.chains = 3,
  n.iter = 2e+05,
  n.burnin = 1e+05,
  n.sims = 2000,
  tauU.alpha = 1,
  tauU.beta = 0.05,
  taueU.alpha = 1,
  taueU.beta = 0.05,
  prior.beta.logitP.mean = c(logit(sum(m2, na.rm = TRUE)/sum(n1, na.rm = TRUE)), rep(0,
    ncol(as.matrix(logitP.cov)) - 1)),
  prior.beta.logitP.sd = c(stats::sd(logit((m2 + 0.5)/(n1 + 1)), na.rm = TRUE), rep(10,
    ncol(as.matrix(logitP.cov)) - 1)),
  tauP.alpha = 0.001,
  tauP.beta = 0.001,
  run.prob = seq(0, 1, 0.1),
  debug = FALSE,
  debug2 = FALSE,
  InitialSeed = ceiling(stats::runif(1, min = 0, max = 1e+06)),
  save.output.to.files = TRUE,
  trunc.logitP = 15,
  set.browser = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_title">title</code></td>
<td>
<p>A character string used for a title on reports and graphs</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_prefix">prefix</code></td>
<td>
<p>A character string used as the prefix for created files. All
created graph files are of the form prefix-xxxxx.pdf.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_time">time</code></td>
<td>
<p>A numeric vector of time used to label the strata. For example,
this could be julian week for data stratified at a weekly level.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_n1">n1</code></td>
<td>
<p>A numeric vector of the number of marked fish released in each
time stratum.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_m2">m2</code></td>
<td>
<p>A numeric vector of the number of marked fish from n1 that are
recaptured in each time stratum. All recaptures take place within the
stratum of release.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_u2">u2</code></td>
<td>
<p>A numeric vector of the number of unmarked fish captured in each
stratum. These will be expanded by the capture efficiency to estimate the
population size in each stratum.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_sampfrac">sampfrac</code></td>
<td>
<p><strong>Deprecated</strong> because it really doesn't work as intended.
You must remove all references to sampfrac from your code. Contact <a href="mailto:cschwarz.stat.sfu.ca@gmail.com">cschwarz.stat.sfu.ca@gmail.com</a>
for more information.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_jump.after">jump.after</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.
In some cases, the spline fitting the population numbers should be allowed
to jump.  For example, the population size could take a jump when hatchery
released fish suddenly arrive at the trap.  The jumps occur AFTER the strata
listed in this argument.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_bad.n1">bad.n1</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.  In
some cases, something goes wrong in the stratum, and the number of marked
fish releases should be discarded.  The values of <code>n1</code> and <code>m2</code> will be set to
0 for these strata.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_bad.m2">bad.m2</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.  In
some cases, something goes wrong in the stratum, and the number of recovered
marked fish should be ignored. For example, poor handling is suspected to
induce handling induced mortality in the marked fish and so only very few
are recovered.  The values of <code>n1</code> and <code>m2</code> will be set to 0
for these strata.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_bad.u2">bad.u2</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.  In
some cases, something goes wrong in the stratum, and the number of unmarked
fish captured should be ignored.  The values of <code>u2</code> in the entire row
will be set to NA for these strata. DO NOT SET the value of u2 to 0 because
this indicates that the trap was operating and captured no fish.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_logitp.cov">logitP.cov</code></td>
<td>
<p>A numeric matrix for covariates to fit the
logit(catchability). Default is a single intercept, i.e. all strata have the
same mean logit(catchability).</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_logitp.fixed">logitP.fixed</code></td>
<td>
<p>A numeric vector (could be null) of the time strata
where the logit(P) would be fixed. Typically, this is used when the capture
rates for some strata are 0 and logit(P) is set to -10 for these strata. The
fixed values are given in <code>logitP.fixed.values</code></p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_logitp.fixed.values">logitP.fixed.values</code></td>
<td>
<p>A numerical vector (could be null) of the fixed
values for logit(P) at strata given by logitP.fixed. Typically this is used
when certain strata have a 0 capture rate and the fixed value is set to -10
which on the logit scale gives p[i] essentially 0. Don't specify values such
as -50 because numerical problems could occur in JAGS.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_n.chains">n.chains</code></td>
<td>
<p>Number of parallel MCMC chains to fit.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_n.iter">n.iter</code></td>
<td>
<p>Total number of MCMC iterations in each chain.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_n.burnin">n.burnin</code></td>
<td>
<p>Number of burn-in iterations.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_n.sims">n.sims</code></td>
<td>
<p>Number of simulated values to keeps for posterior
distribution.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_tauu.alpha">tauU.alpha</code></td>
<td>
<p>One of the parameters along with <code>tauU.beta</code> for the
prior for the variance of the random noise for the smoothing spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_tauu.beta">tauU.beta</code></td>
<td>
<p>One of the parameters along with <code>tauU.alpha</code> for the
prior for the variance of the random noise for the smoothing spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_taueu.alpha">taueU.alpha</code></td>
<td>
<p>One of the parameters along with <code>taueU.beta</code> for
the prior for the variance of noise around the spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_taueu.beta">taueU.beta</code></td>
<td>
<p>One of the parameters along with <code>taueU.alpha</code> for
the prior for the variance of noise around the spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_prior.beta.logitp.mean">prior.beta.logitP.mean</code></td>
<td>
<p>Mean of the prior normal distribution for
logit(catchability) across strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_prior.beta.logitp.sd">prior.beta.logitP.sd</code></td>
<td>
<p>SD of the prior normal distribution for
logit(catchability) across strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_taup.alpha">tauP.alpha</code></td>
<td>
<p>One of the parameters for the prior for the variance in
logit(catchability) among strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_taup.beta">tauP.beta</code></td>
<td>
<p>One of the parameters for the prior for the variance in
logit(catchability) among strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_run.prob">run.prob</code></td>
<td>
<p>Numeric vector indicating percentiles of run timing should
be computed.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_debug">debug</code></td>
<td>
<p>Logical flag indicating if a debugging run should be made. In
the debugging run, the number of samples in the posterior is reduced
considerably for a quick turn around.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_debug2">debug2</code></td>
<td>
<p>Logical flag indicated if additional debugging information is
produced. Normally the functions will halt at <code>browser()</code> calls to
allow the user to peek into the internal variables. Not useful except to
package developers.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_initialseed">InitialSeed</code></td>
<td>
<p>Numeric value used to initialize the random numbers used
in the MCMC iterations.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_save.output.to.files">save.output.to.files</code></td>
<td>
<p>Should the plots and text output be save to the files
in addition to being stored in the MCMC object?</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_trunc.logitp">trunc.logitP</code></td>
<td>
<p>Truncate logit(P) between c(=trunc.logitP, trunc.logitP) when plotting the
logitP over time. Actual values of logit(P) are not affected.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagError_fit_+3A_set.browser">set.browser</code></td>
<td>
<p>Should the function enter browser model when called (useful for debugging)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Normally, the wrapper (*_fit) function is called which then calls the
fitting routine.
</p>
<p>Use the <code><a href="#topic+TimeStratPetersenNonDiagError_fit">TimeStratPetersenNonDiagError_fit</a></code> function for cases
where recaptures take place outside the stratum of release.
</p>


<h3>Value</h3>

<p>An MCMC object with samples from the posterior distribution. A
series of graphs and text file are also created in the working directory.
</p>


<h3>Author(s)</h3>

<p>Bonner, S.J. <a href="mailto:sbonner6@uwo.ca">sbonner6@uwo.ca</a> and 
Schwarz, C. J. <a href="mailto:cschwarz.stat.sfu.ca@gmail.com">cschwarz.stat.sfu.ca@gmail.com</a>.
</p>


<h3>References</h3>

<p>Bonner, S. J., &amp; Schwarz, C. J. (2011). 
Smoothing population size estimates for Time-Stratified Mark-Recapture experiments Using Bayesian P-Splines. 
Biometrics, 67, 1498-1507. 
<a href="https://doi.org/10.1111/j.1541-0420.2011.01599.x">doi:10.1111/j.1541-0420.2011.01599.x</a>
</p>
<p>Schwarz, C. J., &amp; Dempson, J. B. (1994).
Mark-recapture estimation of a salmon smolt population. 
Biometrics, 50, 98-108.
</p>
<p>Schwarz, C.J., D. Pickard, K. Marine and S.J. Bonner. 2009. Juvenile Salmonid Outmigrant
Monitoring Evaluation, Phase II - December 2009. Final Technical Memorandum for the Trinity River
Restoration Program, Weaverville, CA. 155 pp. + appendices available at
<a href="https://www.trrp.net/library/document/?id=369">https://www.trrp.net/library/document/?id=369</a>
</p>

<hr>
<h2 id='TimeStratPetersenDiagErrorWHChinook2_fit'>Wrapper (*_fit) to fit the Time Stratified Petersen Estimator
with Diagonal Entries and separating Wild from Hatchery Chinook function.</h2><span id='topic+TimeStratPetersenDiagErrorWHChinook2_fit'></span><span id='topic+TimeStratPetersenDiagErrorWHChinook_fit'></span>

<h3>Description</h3>

<p>Takes the number of marked fish released, the number of recaptures, and the
number of unmarked fish and uses Bayesian methods to fit a fit a spline
through the population numbers and a hierarchical model for the trap
efficiencies over time.  The output is written to files and an MCMC object
is also created with samples from the posterior.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TimeStratPetersenDiagErrorWHChinook2_fit(
  title = "TSPDE-WHChinook2",
  prefix = "TSPDE-WHChinook2-",
  time,
  n1,
  m2,
  u2.A.YoY,
  u2.N.YoY,
  u2.A.1,
  u2.N.1,
  clip.frac.H.YoY,
  clip.frac.H.1,
  sampfrac = rep(1, length(u2.A.YoY)),
  hatch.after.YoY = NULL,
  bad.m2 = c(),
  bad.u2.A.YoY = c(),
  bad.u2.N.YoY = c(),
  bad.u2.A.1 = c(),
  bad.u2.N.1 = c(),
  logitP.cov = as.matrix(rep(1, length(n1))),
  n.chains = 3,
  n.iter = 2e+05,
  n.burnin = 1e+05,
  n.sims = 2000,
  tauU.alpha = 1,
  tauU.beta = 0.05,
  taueU.alpha = 1,
  taueU.beta = 0.05,
  prior.beta.logitP.mean = c(logit(sum(m2, na.rm = TRUE)/sum(n1, na.rm = TRUE)), rep(0,
    ncol(as.matrix(logitP.cov)) - 1)),
  prior.beta.logitP.sd = c(stats::sd(logit((m2 + 0.5)/(n1 + 1)), na.rm = TRUE), rep(10,
    ncol(as.matrix(logitP.cov)) - 1)),
  tauP.alpha = 0.001,
  tauP.beta = 0.001,
  run.prob = seq(0, 1, 0.1),
  debug = FALSE,
  debug2 = FALSE,
  InitialSeed = ceiling(stats::runif(1, min = 0, 1e+06)),
  save.output.to.files = TRUE,
  trunc.logitP = 15
)

TimeStratPetersenDiagErrorWHChinook_fit(
  title = "TSPDE-WHChinook",
  prefix = "TSPDE-WHChinook-",
  time,
  n1,
  m2,
  u2.A,
  u2.N,
  clip.frac.H,
  sampfrac = rep(1, length(u2.A)),
  hatch.after = NULL,
  bad.n1 = c(),
  bad.m2 = c(),
  bad.u2.A = c(),
  bad.u2.N = c(),
  logitP.cov = as.matrix(rep(1, length(n1))),
  n.chains = 3,
  n.iter = 2e+05,
  n.burnin = 1e+05,
  n.sims = 2000,
  tauU.alpha = 1,
  tauU.beta = 0.05,
  taueU.alpha = 1,
  taueU.beta = 0.05,
  prior.beta.logitP.mean = c(logit(sum(m2, na.rm = TRUE)/sum(n1, na.rm = TRUE)), rep(0,
    ncol(as.matrix(logitP.cov)) - 1)),
  prior.beta.logitP.sd = c(stats::sd(logit((m2 + 0.5)/(n1 + 1)), na.rm = TRUE), rep(10,
    ncol(as.matrix(logitP.cov)) - 1)),
  tauP.alpha = 0.001,
  tauP.beta = 0.001,
  run.prob = seq(0, 1, 0.1),
  debug = FALSE,
  debug2 = FALSE,
  InitialSeed = ceiling(stats::runif(1, min = 0, max = 1e+06)),
  save.output.to.files = TRUE,
  trunc.logitP = 15
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_title">title</code></td>
<td>
<p>A character string used for a title on reports and graphs</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_prefix">prefix</code></td>
<td>
<p>A character string used as the prefix for created files. All
created graph files are of the form prefix-xxxxx.pdf.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_time">time</code></td>
<td>
<p>A numeric vector of time used to label the strata. For example,
this could be julian week for data stratified at a weekly level.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_n1">n1</code></td>
<td>
<p>A numeric vector of the number of marked fish released in each
time stratum.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_m2">m2</code></td>
<td>
<p>A numeric vector of the number of marked fish from n1 that are
recaptured in each time stratum. All recaptures take place within the
stratum of release. Use the <code><a href="#topic+TimeStratPetersenNonDiagError_fit">TimeStratPetersenNonDiagError_fit</a></code>
function for cases where recaptures take place outside the stratum of
release.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_u2.a.yoy">u2.A.YoY</code>, <code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_u2.n.yoy">u2.N.YoY</code></td>
<td>
<p>Number of YoY unmarked fish with/without adipose fin clips
All YoY wild fish have NO adipose fin clips; however, hatchery fish are a mixture
of fish with adipose fin clips (a known percentage are marked) and unmarked fish.
So u2.A.YoY MUST be hatchery fish.
u2.N.YoY is a mixture of wild and hatchery fish.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_u2.a.1">u2.A.1</code>, <code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_u2.n.1">u2.N.1</code></td>
<td>
<p>Number of Age1 unmarked fish with/with out adipose fin clips
All Age1 wild fish have NO adipose fin clips; however, hatchery fish are a mixture
of fish with adipose fin clips (a known percentage are marked) and unmarked fish.
So u2.A.1 MUST be hatchery fish.
u2.N.1 is a mixture of wild and hatchery fish.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_clip.frac.h.yoy">clip.frac.H.YoY</code>, <code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_clip.frac.h.1">clip.frac.H.1</code></td>
<td>
<p>Fraction of the YoY hatchery/Age1 (from last year's releases) hatchery fish are clipped?\ (between 0 and 1)</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_sampfrac">sampfrac</code></td>
<td>
<p><strong>Deprecated</strong> because it really doesn't work as intended.
You must remove all references to sampfrac from your code. Contact <a href="mailto:cschwarz.stat.sfu.ca@gmail.com">cschwarz.stat.sfu.ca@gmail.com</a>
for more information.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_hatch.after.yoy">hatch.after.YoY</code></td>
<td>
<p>A numeric vector with elements belonging to
<code>time</code>.  At which point do YoY hatchery fish arrive? They arrive in the
immediate stratum AFTER these entries.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_bad.m2">bad.m2</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.  In
some cases, something goes wrong in the stratum, and the number of recovered
marked fish should be ignored. For example, poor handling is suspected to
induce handling induced mortality in the marked fish and so only very few
are recovered.  The values of <code>n1</code> and <code>m2</code> will be set to 0
for these strata.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_bad.u2.a.yoy">bad.u2.A.YoY</code>, <code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_bad.u2.n.yoy">bad.u2.N.YoY</code></td>
<td>
<p>List of julian weeks where the value of u2.A.YoY/u2.N.YoY is suspect. 
These are set to NA prior to the fit.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_bad.u2.a.1">bad.u2.A.1</code>, <code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_bad.u2.n.1">bad.u2.N.1</code></td>
<td>
<p>List of julian weeks where the value of u2.A.1/u2.N.1 is suspect. 
These are set to NA prior to the fit.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_logitp.cov">logitP.cov</code></td>
<td>
<p>A numeric matrix for covariates to fit the
logit(catchability). Default is a single intercept, i.e. all strata have the
same mean logit(catchability).</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_n.chains">n.chains</code></td>
<td>
<p>Number of parallel MCMC chains to fit.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_n.iter">n.iter</code></td>
<td>
<p>Total number of MCMC iterations in each chain.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_n.burnin">n.burnin</code></td>
<td>
<p>Number of burn-in iterations.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_n.sims">n.sims</code></td>
<td>
<p>Number of simulated values to keeps for posterior
distribution.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_tauu.alpha">tauU.alpha</code></td>
<td>
<p>One of the parameters along with <code>tauU.beta</code> for the
prior for the variance of the random noise for the smoothing spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_tauu.beta">tauU.beta</code></td>
<td>
<p>One of the parameters along with <code>tauU.alpha</code> for the
prior for the variance of the random noise for the smoothing spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_taueu.alpha">taueU.alpha</code></td>
<td>
<p>One of the parameters along with <code>taueU.beta</code> for
the prior for the variance of noise around the spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_taueu.beta">taueU.beta</code></td>
<td>
<p>One of the parameters along with <code>taueU.alpha</code> for
the prior for the variance of noise around the spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_prior.beta.logitp.mean">prior.beta.logitP.mean</code></td>
<td>
<p>Mean of the prior normal distribution for
logit(catchability) across strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_prior.beta.logitp.sd">prior.beta.logitP.sd</code></td>
<td>
<p>SD of the prior normal distribution for
logit(catchability) across strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_taup.alpha">tauP.alpha</code></td>
<td>
<p>One of the parameters for the prior for the variance in
logit(catchability) among strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_taup.beta">tauP.beta</code></td>
<td>
<p>One of the parameters for the prior for the variance in
logit(catchability) among strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_run.prob">run.prob</code></td>
<td>
<p>Numeric vector indicating percentiles of run timing should
be computed.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_debug">debug</code></td>
<td>
<p>Logical flag indicating if a debugging run should be made. In
the debugging run, the number of samples in the posterior is reduced
considerably for a quick turn around.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_debug2">debug2</code></td>
<td>
<p>Logical flag indicated if additional debugging information is
produced. Normally the functions will halt at <code>browser()</code> calls to
allow the user to peek into the internal variables. Not useful except to
package developers.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_initialseed">InitialSeed</code></td>
<td>
<p>Numeric value used to initialize the random numbers used
in the MCMC iterations.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_save.output.to.files">save.output.to.files</code></td>
<td>
<p>Should the plots and text output be save to the files
in addition to being stored in the MCMC object?</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_trunc.logitp">trunc.logitP</code></td>
<td>
<p>Truncate logit(P) between c(=trunc.logitP, trunc.logitP) when plotting the
logitP over time. Actual values of logit(P) are not affected.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_u2.a">u2.A</code></td>
<td>
<p>A numeric vector of the number of unmarked fish with adipose
clips captured in each stratum.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_u2.n">u2.N</code></td>
<td>
<p>A numeric vector of the number of unmarked fish with NO-adipose
clips captured in each stratum.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_clip.frac.h">clip.frac.H</code></td>
<td>
<p>A numeric value for the fraction of the hatchery fish
that have the adipose fin clipped (between 0 and 1).</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_hatch.after">hatch.after</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.
At which point do hatchery fish arrive? They arrive in the immediate stratum
AFTER these entries.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_bad.n1">bad.n1</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.  In
some cases, something goes wrong in the stratum, and the number of marked
fish releases should be discarded.  The values of <code>n1</code> and <code>m2</code> will be set to
0 for these strata.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_bad.u2.a">bad.u2.A</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.  In
some cases, something goes wrong in the stratum, and the number of unmarked
fish with an adipose fin clip should be ignored.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHChinook2_fit_+3A_bad.u2.n">bad.u2.N</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.  In
some cases, something goes wrong in the stratum, and the number of unmarked
fish with NO adipose fin clip should be ignored.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Normally use the *_fit to pass the data to the fitting function.
</p>


<h3>Value</h3>

<p>An MCMC object with samples from the posterior distribution. A
series of graphs and text file are also created in the working directory.
</p>


<h3>Author(s)</h3>

<p>Bonner, S.J. <a href="mailto:sbonner6@uwo.ca">sbonner6@uwo.ca</a> and 
Schwarz, C. J. <a href="mailto:cschwarz.stat.sfu.ca@gmail.com">cschwarz.stat.sfu.ca@gmail.com</a>.
</p>


<h3>References</h3>

<p>Bonner, S. J., &amp; Schwarz, C. J. (2011). 
Smoothing population size estimates for Time-Stratified Mark-Recapture experiments Using Bayesian P-Splines. 
Biometrics, 67, 1498-1507. 
<a href="https://doi.org/10.1111/j.1541-0420.2011.01599.x">doi:10.1111/j.1541-0420.2011.01599.x</a>
</p>
<p>Schwarz, C. J., &amp; Dempson, J. B. (1994).
Mark-recapture estimation of a salmon smolt population. 
Biometrics, 50, 98-108.
</p>
<p>Schwarz, C.J., D. Pickard, K. Marine and S.J. Bonner. 2009. Juvenile Salmonid Outmigrant
Monitoring Evaluation, Phase II - December 2009. Final Technical Memorandum for the Trinity River
Restoration Program, Weaverville, CA. 155 pp. + appendices available at
<a href="https://www.trrp.net/library/document/?id=369">https://www.trrp.net/library/document/?id=369</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> 
##---- See the vignettes for examples on how to run this analysis.

</code></pre>

<hr>
<h2 id='TimeStratPetersenDiagErrorWHSteel_fit'>Wrapper (*_fit) and function to call the Time Stratified Petersen Estimator
with Diagonal Entries and separating Wild from Hatchery Steelhead function.</h2><span id='topic+TimeStratPetersenDiagErrorWHSteel_fit'></span>

<h3>Description</h3>

<p>Takes the number of marked fish released, the number of recaptures, and the
number of unmarked fish and uses Bayesian methods to fit a fit a spline
through the population numbers and a hierarchical model for the trap
efficiencies over time.  The output is written to files and an MCMC object
is also created with samples from the posterior.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TimeStratPetersenDiagErrorWHSteel_fit(
  title = "TSPDE-WHSteel",
  prefix = "TSPDE-WHSteel-",
  time,
  n1,
  m2,
  u2.W.YoY,
  u2.W.1,
  u2.H.1,
  sampfrac = rep(1, length(u2.W.YoY)),
  hatch.after = NULL,
  bad.n1 = c(),
  bad.m2 = c(),
  bad.u2.W.YoY = c(),
  bad.u2.W.1 = c(),
  bad.u2.H.1 = c(),
  logitP.cov = as.matrix(rep(1, length(n1))),
  n.chains = 3,
  n.iter = 2e+05,
  n.burnin = 1e+05,
  n.sims = 2000,
  tauU.alpha = 1,
  tauU.beta = 0.05,
  taueU.alpha = 1,
  taueU.beta = 0.05,
  prior.beta.logitP.mean = c(logit(sum(m2, na.rm = TRUE)/sum(n1, na.rm = TRUE)), rep(0,
    ncol(as.matrix(logitP.cov)) - 1)),
  prior.beta.logitP.sd = c(stats::sd(logit((m2 + 0.5)/(n1 + 1)), na.rm = TRUE), rep(10,
    ncol(as.matrix(logitP.cov)) - 1)),
  tauP.alpha = 0.001,
  tauP.beta = 0.001,
  run.prob = seq(0, 1, 0.1),
  debug = FALSE,
  debug2 = FALSE,
  InitialSeed = ceiling(stats::runif(1, min = 0, 1e+06)),
  save.output.to.files = TRUE,
  trunc.logitP = 15
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_title">title</code></td>
<td>
<p>A character string used for a title on reports and graphs</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_prefix">prefix</code></td>
<td>
<p>A character string used as the prefix for created files. All
created graph files are of the form prefix-xxxxx.pdf.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_time">time</code></td>
<td>
<p>A numeric vector of time used to label the strata. For example,
this could be julian week for data stratified at a weekly level.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_n1">n1</code></td>
<td>
<p>A numeric vector of the number of marked fish released in each
time stratum.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_m2">m2</code></td>
<td>
<p>A numeric vector of the number of marked fish from n1 that are
recaptured in each time stratum. All recaptures take place within the
stratum of release. Use the <code><a href="#topic+TimeStratPetersenNonDiagError_fit">TimeStratPetersenNonDiagError_fit</a></code>
function for cases where recaptures take place outside the stratum of
release.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_u2.w.yoy">u2.W.YoY</code></td>
<td>
<p>A numeric vector of the number of unmarked wild Young-of-Year
fish captured in each stratum.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_u2.w.1">u2.W.1</code></td>
<td>
<p>A numeric vector of the number of unmarked wild age 1+ fish
captured in each stratum.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_u2.h.1">u2.H.1</code></td>
<td>
<p>A numeric vector of the number of unmarked hatchery age 1+ fish
(i.e. adipose fin clipped) captured in each stratum.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_sampfrac">sampfrac</code></td>
<td>
<p><strong>Deprecated</strong> because it really doesn't work as intended.
You must remove all references to sampfrac from your code. Contact <a href="mailto:cschwarz.stat.sfu.ca@gmail.com">cschwarz.stat.sfu.ca@gmail.com</a>
for more information.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_hatch.after">hatch.after</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.
At which point do hatchery fish arrive? They arrive in the immediate stratum
AFTER these entries.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_bad.n1">bad.n1</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.  In
some cases, something goes wrong in the stratum, and the number of marked
fish releases should be discarded.  The values of <code>n1</code> and <code>m2</code> will be set to
0 for these strata.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_bad.m2">bad.m2</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.  In
some cases, something goes wrong in the stratum, and the number of recovered
marked fish should be ignored. For example, poor handling is suspected to
induce handling induced mortality in the marked fish and so only very few
are recovered.  The values of <code>n1</code> and <code>m2</code> will be set to 0
for these strata.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_bad.u2.w.yoy">bad.u2.W.YoY</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.
In some cases, something goes wrong in the stratum, and the number of wild
unmarked Young-of-Year fish should be ignored.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_bad.u2.w.1">bad.u2.W.1</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.
In some cases, something goes wrong in the stratum, and the number of wild
unmarked age 1+ fish should be ignored.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_bad.u2.h.1">bad.u2.H.1</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.
In some cases, something goes wrong in the stratum, and the number of
hatchery unmarked (but adipose fin clipped) age 1+ fish should be ignored.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_logitp.cov">logitP.cov</code></td>
<td>
<p>A numeric matrix for covariates to fit the
logit(catchability). Default is a single intercept, i.e. all strata have the
same mean logit(catchability).</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_n.chains">n.chains</code></td>
<td>
<p>Number of parallel MCMC chains to fit.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_n.iter">n.iter</code></td>
<td>
<p>Total number of MCMC iterations in each chain.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_n.burnin">n.burnin</code></td>
<td>
<p>Number of burn-in iterations.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_n.sims">n.sims</code></td>
<td>
<p>Number of simulated values to keeps for posterior
distribution.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_tauu.alpha">tauU.alpha</code></td>
<td>
<p>One of the parameters along with <code>tauU.beta</code> for the
prior for the variance of the random noise for the smoothing spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_tauu.beta">tauU.beta</code></td>
<td>
<p>One of the parameters along with <code>tauU.alpha</code> for the
prior for the variance of the random noise for the smoothing spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_taueu.alpha">taueU.alpha</code></td>
<td>
<p>One of the parameters along with <code>taueU.beta</code> for
the prior for the variance of noise around the spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_taueu.beta">taueU.beta</code></td>
<td>
<p>One of the parameters along with <code>taueU.alpha</code> for
the prior for the variance of noise around the spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_prior.beta.logitp.mean">prior.beta.logitP.mean</code></td>
<td>
<p>Mean of the prior normal distribution for
logit(catchability) across strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_prior.beta.logitp.sd">prior.beta.logitP.sd</code></td>
<td>
<p>SD of the prior normal distribution for
logit(catchability) across strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_taup.alpha">tauP.alpha</code></td>
<td>
<p>One of the parameters for the prior for the variance in
logit(catchability) among strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_taup.beta">tauP.beta</code></td>
<td>
<p>One of the parameters for the prior for the variance in
logit(catchability) among strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_run.prob">run.prob</code></td>
<td>
<p>Numeric vector indicating percentiles of run timing should
be computed.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_debug">debug</code></td>
<td>
<p>Logical flag indicating if a debugging run should be made. In
the debugging run, the number of samples in the posterior is reduced
considerably for a quick turn around.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_debug2">debug2</code></td>
<td>
<p>Logical flag indicated if additional debugging information is
produced. Normally the functions will halt at <code>browser()</code> calls to
allow the user to peek into the internal variables. Not useful except to
package developers.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_initialseed">InitialSeed</code></td>
<td>
<p>Numeric value used to initialize the random numbers used
in the MCMC iterations.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_save.output.to.files">save.output.to.files</code></td>
<td>
<p>Should the plots and text output be save to the files
in addition to being stored in the MCMC object?</p>
</td></tr>
<tr><td><code id="TimeStratPetersenDiagErrorWHSteel_fit_+3A_trunc.logitp">trunc.logitP</code></td>
<td>
<p>Truncate logit(P) between c(=trunc.logitP, trunc.logitP) when plotting the
logitP over time. Actual values of logit(P) are not affected.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Normally, data is passed to the wrapper which then calls the fitting
function.
</p>


<h3>Value</h3>

<p>An MCMC object with samples from the posterior distribution. A
series of graphs and text file are also created in the working directory.
</p>


<h3>Author(s)</h3>

<p>Bonner, S.J. <a href="mailto:sbonner6@uwo.ca">sbonner6@uwo.ca</a> and 
Schwarz, C. J. <a href="mailto:cschwarz.stat.sfu.ca@gmail.com">cschwarz.stat.sfu.ca@gmail.com</a>.
</p>


<h3>References</h3>

<p>Bonner, S. J., &amp; Schwarz, C. J. (2011). 
Smoothing population size estimates for Time-Stratified Mark-Recapture experiments Using Bayesian P-Splines. 
Biometrics, 67, 1498-1507. 
<a href="https://doi.org/10.1111/j.1541-0420.2011.01599.x">doi:10.1111/j.1541-0420.2011.01599.x</a>
</p>
<p>Schwarz, C. J., &amp; Dempson, J. B. (1994).
Mark-recapture estimation of a salmon smolt population. 
Biometrics, 50, 98-108.
</p>
<p>Schwarz, C.J., D. Pickard, K. Marine and S.J. Bonner. 2009. Juvenile Salmonid Outmigrant
Monitoring Evaluation, Phase II - December 2009. Final Technical Memorandum for the Trinity River
Restoration Program, Weaverville, CA. 155 pp. + appendices available at
<a href="https://www.trrp.net/library/document/?id=369">https://www.trrp.net/library/document/?id=369</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> 
##---- See the vignettes for example on how to use this package.

</code></pre>

<hr>
<h2 id='TimeStratPetersenNonDiagError_fit'>Wrapper (*_fit) to fit the Time Stratified Petersen Estimator
with NON Diagonal Entries function.</h2><span id='topic+TimeStratPetersenNonDiagError_fit'></span>

<h3>Description</h3>

<p>Takes the number of marked fish released, the number of recaptures, and the
number of unmarked fish and uses Bayesian methods to fit a fit a spline
through the population numbers and a hierarchical model for the trap
efficiencies over time.  The output is written to files and an MCMC object
is also created with samples from the posterior.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TimeStratPetersenNonDiagError_fit(
  title = "TSPNDE",
  prefix = "TSPNDE-",
  time,
  n1,
  m2,
  u2,
  sampfrac = rep(1, length(u2)),
  jump.after = NULL,
  bad.n1 = c(),
  bad.m2 = c(),
  bad.u2 = c(),
  logitP.cov = as.matrix(rep(1, length(u2))),
  logitP.fixed = NULL,
  logitP.fixed.values = NULL,
  n.chains = 3,
  n.iter = 2e+05,
  n.burnin = 1e+05,
  n.sims = 2000,
  tauU.alpha = 1,
  tauU.beta = 0.05,
  taueU.alpha = 1,
  taueU.beta = 0.05,
  prior.beta.logitP.mean = c(logit(sum(m2, na.rm = TRUE)/sum(n1, na.rm = TRUE)), rep(0,
    ncol(as.matrix(logitP.cov)) - 1)),
  prior.beta.logitP.sd = c(2, rep(10, ncol(as.matrix(logitP.cov)) - 1)),
  tauP.alpha = 0.001,
  tauP.beta = 0.001,
  run.prob = seq(0, 1, 0.1),
  debug = FALSE,
  debug2 = FALSE,
  InitialSeed = ceiling(stats::runif(1, min = 0, 1e+06)),
  save.output.to.files = TRUE,
  trunc.logitP = 15
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_title">title</code></td>
<td>
<p>A character string used for a title on reports and graphs</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_prefix">prefix</code></td>
<td>
<p>A character string used as the prefix for created files. All
created graph files are of the form prefix-xxxxx.pdf.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_time">time</code></td>
<td>
<p>A numeric vector of time used to label the strata. For example,
this could be julian week for data stratified at a weekly level.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_n1">n1</code></td>
<td>
<p>A numeric vector of the number of marked fish released in each
time stratum.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_m2">m2</code></td>
<td>
<p>A numeric matrix of the number of fish released in stratum [i] and
recovered in [j-1] strata later.  For example m2[3,5] is the number of
marked fish released in stratum 3 and recovered 4 strata later in stratum 7.
The first column is the number of marked fish recovered in the stratum of
release, i.e. 0 strata later.  Use the
<code><a href="#topic+TimeStratPetersenDiagError_fit">TimeStratPetersenDiagError_fit</a></code> function for cases where
recaptures take place ONLY in the stratum of release, i.e. the diagonal
case.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_u2">u2</code></td>
<td>
<p>A numeric vector of the number of unmarked fish captured in each
stratum.  These will be expanded by the capture efficiency to estimate the
population size in each stratum. The length of u2 should be between the length of n1 and length n1 + number of columns in m2 -1</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_sampfrac">sampfrac</code></td>
<td>
<p><strong>Deprecated</strong> because it really doesn't work as intended.
You must remove all references to sampfrac from your code. Contact <a href="mailto:cschwarz.stat.sfu.ca@gmail.com">cschwarz.stat.sfu.ca@gmail.com</a>
for more information.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_jump.after">jump.after</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.
In some cases, the spline fitting the population numbers should be allowed
to jump.  For example, the population size could take a jump when hatchery
released fish suddenly arrive at the trap.  The jumps occur AFTER the strata
listed in this argument.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_bad.n1">bad.n1</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.  In
some cases, something goes wrong in the stratum, and the number of marked
fish releases should be discarded.  The values of <code>n1</code> and <code>m2</code> will be set to
0 for these strata.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_bad.m2">bad.m2</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.  In
some cases, something goes wrong in the stratum, and the number of recovered
marked fish should be ignored. For example, poor handling is suspected to
induce handling induced mortality in the marked fish and so only very few
are recovered.  The values of <code>n1</code> and <code>m2</code> will be set to 0
for these strata.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_bad.u2">bad.u2</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.  In
some cases, something goes wrong in the stratum, and the number of unmarked
fish captured should be ignored.  The values of <code>u2</code> in the entire row
will be set to NA for these strata. DO NOT SET the value of u2 to 0 because
this indicates that the trap was operating and captured no fish.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_logitp.cov">logitP.cov</code></td>
<td>
<p>A numeric matrix for covariates to fit the
logit(catchability). Default is a single intercept, i.e. all strata have the
same mean logit(catchability).</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_logitp.fixed">logitP.fixed</code></td>
<td>
<p>A numeric vector (could be null) of the time strata
where the logit(P) would be fixed. Typically, this is used when the capture
rates for some strata are 0 and logit(P) is set to -10 for these strata. The
fixed values are given in <code>logitP.fixed.values</code></p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_logitp.fixed.values">logitP.fixed.values</code></td>
<td>
<p>A numerical vector (could be null) of the fixed
values for logit(P) at strata given by logitP.fixed. Typically this is used
when certain strata have a 0 capture rate and the fixed value is set to -10
which on the logit scale gives p[i] essentially 0. Don't specify values such
as -50 because numerical problems could occur in JAGS.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_n.chains">n.chains</code></td>
<td>
<p>Number of parallel MCMC chains to fit.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_n.iter">n.iter</code></td>
<td>
<p>Total number of MCMC iterations in each chain.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_n.burnin">n.burnin</code></td>
<td>
<p>Number of burn-in iterations.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_n.sims">n.sims</code></td>
<td>
<p>Number of simulated values to keeps for posterior
distribution.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_tauu.alpha">tauU.alpha</code></td>
<td>
<p>One of the parameters along with <code>tauU.beta</code> for the
prior for the variance of the random noise for the smoothing spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_tauu.beta">tauU.beta</code></td>
<td>
<p>One of the parameters along with <code>tauU.alpha</code> for the
prior for the variance of the random noise for the smoothing spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_taueu.alpha">taueU.alpha</code></td>
<td>
<p>One of the parameters along with <code>taueU.beta</code> for
the prior for the variance of noise around the spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_taueu.beta">taueU.beta</code></td>
<td>
<p>One of the parameters along with <code>taueU.alpha</code> for
the prior for the variance of noise around the spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_prior.beta.logitp.mean">prior.beta.logitP.mean</code></td>
<td>
<p>Mean of the prior normal distribution for
logit(catchability) across strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_prior.beta.logitp.sd">prior.beta.logitP.sd</code></td>
<td>
<p>SD of the prior normal distribution for
logit(catchability) across strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_taup.alpha">tauP.alpha</code></td>
<td>
<p>One of the parameters for the prior for the variance in
logit(catchability) among strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_taup.beta">tauP.beta</code></td>
<td>
<p>One of the parameters for the prior for the variance in
logit(catchability) among strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_run.prob">run.prob</code></td>
<td>
<p>Numeric vector indicating percentiles of run timing should
be computed.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_debug">debug</code></td>
<td>
<p>Logical flag indicating if a debugging run should be made. In
the debugging run, the number of samples in the posterior is reduced
considerably for a quick turn around.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_debug2">debug2</code></td>
<td>
<p>Logical flag indicated if additional debugging information is
produced. Normally the functions will halt at <code>browser()</code> calls to
allow the user to peek into the internal variables. Not useful except to
package developers.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_initialseed">InitialSeed</code></td>
<td>
<p>Numeric value used to initialize the random numbers used
in the MCMC iterations.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_save.output.to.files">save.output.to.files</code></td>
<td>
<p>Should the plots and text output be save to the files
in addition to being stored in the MCMC object?</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagError_fit_+3A_trunc.logitp">trunc.logitP</code></td>
<td>
<p>Truncate logit(P) between c(=trunc.logitP, trunc.logitP) when plotting the
logitP over time. Actual values of logit(P) are not affected.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Normally the user makes a call to the *_fit function which then calls the
fitting function.
</p>
<p>Use the <code><a href="#topic+TimeStratPetersenDiagError_fit">TimeStratPetersenDiagError_fit</a></code> function for cases
where recaptures take place ONLY in the stratum of release, i.e. the
diagonal case.
</p>
<p>The non-diagonal case fits a log-normal distribution for the travel time.
The *NP functions fit a non-parametric distribution for the travel times.
The *MarkAvail functions extend the *NP functions to allow for reductions in
mark availability because of fall back, immediate tagging mortality, etc.
</p>


<h3>Value</h3>

<p>An MCMC object with samples from the posterior distribution. A
series of graphs and text file are also created in the working directory.
</p>


<h3>Author(s)</h3>

<p>Bonner, S.J. <a href="mailto:sbonner6@uwo.ca">sbonner6@uwo.ca</a> and 
Schwarz, C. J. <a href="mailto:cschwarz.stat.sfu.ca@gmail.com">cschwarz.stat.sfu.ca@gmail.com</a>.
</p>


<h3>References</h3>

<p>Bonner, S. J., &amp; Schwarz, C. J. (2011). 
Smoothing population size estimates for Time-Stratified Mark-Recapture experiments Using Bayesian P-Splines. 
Biometrics, 67, 1498-1507. 
<a href="https://doi.org/10.1111/j.1541-0420.2011.01599.x">doi:10.1111/j.1541-0420.2011.01599.x</a>
</p>
<p>Schwarz, C. J., &amp; Dempson, J. B. (1994).
Mark-recapture estimation of a salmon smolt population. 
Biometrics, 50, 98-108.
</p>
<p>Schwarz, C.J., D. Pickard, K. Marine and S.J. Bonner. 2009. Juvenile Salmonid Outmigrant
Monitoring Evaluation, Phase II - December 2009. Final Technical Memorandum for the Trinity River
Restoration Program, Weaverville, CA. 155 pp. + appendices available at
<a href="https://www.trrp.net/library/document/?id=369">https://www.trrp.net/library/document/?id=369</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> 
##---- See the vignettes for examples of how to use this package

</code></pre>

<hr>
<h2 id='TimeStratPetersenNonDiagErrorNP_fit'>Wrapper (*_fit)  to fit the Time Stratified Petersen Estimator
with NON Diagonal Entries function and a non-parametric travel time estimator..</h2><span id='topic+TimeStratPetersenNonDiagErrorNP_fit'></span>

<h3>Description</h3>

<p>Takes the number of marked fish released, the number of recaptures, and the
number of unmarked fish and uses Bayesian methods to fit a fit a spline
through the population numbers and a hierarchical model for the trap
efficiencies over time.  The output is written to files and an MCMC object
is also created with samples from the posterior.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TimeStratPetersenNonDiagErrorNP_fit(
  title = "TSPNDENP",
  prefix = "TSPNDENP-",
  time,
  n1,
  m2,
  u2,
  sampfrac = rep(1, length(u2)),
  jump.after = NULL,
  bad.n1 = c(),
  bad.m2 = c(),
  bad.u2 = c(),
  logitP.cov = rep(1, length(u2)),
  logitP.fixed = NULL,
  logitP.fixed.values = NULL,
  n.chains = 3,
  n.iter = 2e+05,
  n.burnin = 1e+05,
  n.sims = 2000,
  tauU.alpha = 1,
  tauU.beta = 0.05,
  taueU.alpha = 1,
  taueU.beta = 0.05,
  prior.beta.logitP.mean = c(logit(sum(m2, na.rm = TRUE)/sum(n1, na.rm = TRUE)), rep(0,
    ncol(as.matrix(logitP.cov)) - 1)),
  prior.beta.logitP.sd = c(2, rep(10, ncol(as.matrix(logitP.cov)) - 1)),
  tauP.alpha = 0.001,
  tauP.beta = 0.001,
  Delta.max = NULL,
  prior.muTT = NULL,
  tauTT.alpha = 0.1,
  tauTT.beta = 0.1,
  run.prob = seq(0, 1, 0.1),
  debug = FALSE,
  debug2 = FALSE,
  InitialSeed = ceiling(stats::runif(1, min = 0, 1e+06)),
  save.output.to.files = TRUE,
  trunc.logitP = 15
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_title">title</code></td>
<td>
<p>A character string used for a title on reports and graphs</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_prefix">prefix</code></td>
<td>
<p>A character string used as the prefix for created files. All
created graph files are of the form prefix-xxxxx.pdf.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_time">time</code></td>
<td>
<p>A numeric vector of time used to label the strata. For example,
this could be julian week for data stratified at a weekly level.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_n1">n1</code></td>
<td>
<p>A numeric vector of the number of marked fish released in each
time stratum.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_m2">m2</code></td>
<td>
<p>A numeric matrix of the number of fish released in stratum [i] and
recovered in [j-1] strata later.  For example m2[3,5] is the number of
marked fish released in stratum 3 and recovered 4 strata later in stratum 7.
The first column is the number of marked fish recovered in the stratum of
release, i.e. 0 strata later.  Use the
<code><a href="#topic+TimeStratPetersenDiagError_fit">TimeStratPetersenDiagError_fit</a></code> function for cases where
recaptures take place ONLY in the stratum of release, i.e. the diagonal
case.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_u2">u2</code></td>
<td>
<p>A numeric vector of the number of unmarked fish captured in each
stratum.  These will be expanded by the capture efficiency to estimate the
population size in each stratum. The length of u2 should be between the length of n1 and length n1 + number of columns in m2 -1</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_sampfrac">sampfrac</code></td>
<td>
<p><strong>Deprecated</strong> because it really doesn't work as intended.
You must remove all references to sampfrac from your code. Contact <a href="mailto:cschwarz.stat.sfu.ca@gmail.com">cschwarz.stat.sfu.ca@gmail.com</a>
for more information.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_jump.after">jump.after</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.
In some cases, the spline fitting the population numbers should be allowed
to jump.  For example, the population size could take a jump when hatchery
released fish suddenly arrive at the trap.  The jumps occur AFTER the strata
listed in this argument.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_bad.n1">bad.n1</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.  In
some cases, something goes wrong in the stratum, and the number of marked
fish releases should be discarded.  The values of <code>n1</code> and <code>m2</code> will be set to
0 for these strata.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_bad.m2">bad.m2</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.  In
some cases, something goes wrong in the stratum, and the number of recovered
marked fish should be ignored. For example, poor handling is suspected to
induce handling induced mortality in the marked fish and so only very few
are recovered.  The values of <code>n1</code> and <code>m2</code> will be set to 0
for these strata.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_bad.u2">bad.u2</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.  In
some cases, something goes wrong in the stratum, and the number of unmarked
fish captured should be ignored.  The values of <code>u2</code> in the entire row
will be set to NA for these strata. DO NOT SET the value of u2 to 0 because
this indicates that the trap was operating and captured no fish.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_logitp.cov">logitP.cov</code></td>
<td>
<p>A numeric matrix for covariates to fit the
logit(catchability). Default is a single intercept, i.e. all strata have the
same mean logit(catchability).</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_logitp.fixed">logitP.fixed</code></td>
<td>
<p>A numeric vector (could be null) of the time strata
where the logit(P) would be fixed. Typically, this is used when the capture
rates for some strata are 0 and logit(P) is set to -10 for these strata. The
fixed values are given in <code>logitP.fixed.values</code></p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_logitp.fixed.values">logitP.fixed.values</code></td>
<td>
<p>A numerical vector (could be null) of the fixed
values for logit(P) at strata given by logitP.fixed. Typically this is used
when certain strata have a 0 capture rate and the fixed value is set to -10
which on the logit scale gives p[i] essentially 0. Don't specify values such
as -50 because numerical problems could occur in JAGS.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_n.chains">n.chains</code></td>
<td>
<p>Number of parallel MCMC chains to fit.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_n.iter">n.iter</code></td>
<td>
<p>Total number of MCMC iterations in each chain.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_n.burnin">n.burnin</code></td>
<td>
<p>Number of burn-in iterations.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_n.sims">n.sims</code></td>
<td>
<p>Number of simulated values to keeps for posterior
distribution.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_tauu.alpha">tauU.alpha</code></td>
<td>
<p>One of the parameters along with <code>tauU.beta</code> for the
prior for the variance of the random noise for the smoothing spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_tauu.beta">tauU.beta</code></td>
<td>
<p>One of the parameters along with <code>tauU.alpha</code> for the
prior for the variance of the random noise for the smoothing spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_taueu.alpha">taueU.alpha</code></td>
<td>
<p>One of the parameters along with <code>taueU.beta</code> for
the prior for the variance of noise around the spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_taueu.beta">taueU.beta</code></td>
<td>
<p>One of the parameters along with <code>taueU.alpha</code> for
the prior for the variance of noise around the spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_prior.beta.logitp.mean">prior.beta.logitP.mean</code></td>
<td>
<p>Mean of the prior normal distribution for
logit(catchability) across strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_prior.beta.logitp.sd">prior.beta.logitP.sd</code></td>
<td>
<p>SD of the prior normal distribution for
logit(catchability) across strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_taup.alpha">tauP.alpha</code></td>
<td>
<p>One of the parameters for the prior for the variance in
logit(catchability) among strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_taup.beta">tauP.beta</code></td>
<td>
<p>One of the parameters for the prior for the variance in
logit(catchability) among strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_delta.max">Delta.max</code></td>
<td>
<p>Maximum transition time for marked fish, i.e. all fish
assumed to have moved by Delta.max unit of time</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_prior.mutt">prior.muTT</code></td>
<td>
<p>- prior for movement rates.
These are like a Dirchelet type prior
where x are values representing belief in the travel times.
For example, x=c(1,4,3,2) represents a system where the
maximum travel time is 3 strata after release with
1/10=.1 of the animals moving in the stratum of release
4/10=.4 of the animals taking 1 stratum to move etc
So if x=c(10,40,30,20), this represent the same movement pattern
but a strong degree of belief</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_tautt.alpha">tauTT.alpha</code></td>
<td>
<p>One of the parameters along with <code>tauTT.beta</code> for
the prior on 1/var of logit continuation ratio for travel times</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_tautt.beta">tauTT.beta</code></td>
<td>
<p>One of the parameters along with <code>tauTT.alpha</code> for
the prior on 1/var of logit continuation ratio for travel times</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_run.prob">run.prob</code></td>
<td>
<p>Numeric vector indicating percentiles of run timing should
be computed.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_debug">debug</code></td>
<td>
<p>Logical flag indicating if a debugging run should be made. In
the debugging run, the number of samples in the posterior is reduced
considerably for a quick turn around.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_debug2">debug2</code></td>
<td>
<p>Logical flag indicated if additional debugging information is
produced. Normally the functions will halt at <code>browser()</code> calls to
allow the user to peek into the internal variables. Not useful except to
package developers.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_initialseed">InitialSeed</code></td>
<td>
<p>Numeric value used to initialize the random numbers used
in the MCMC iterations.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_save.output.to.files">save.output.to.files</code></td>
<td>
<p>Should the plots and text output be save to the files
in addition to being stored in the MCMC object?</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNP_fit_+3A_trunc.logitp">trunc.logitP</code></td>
<td>
<p>Truncate logit(P) between c(=trunc.logitP, trunc.logitP) when plotting the
logitP over time. Actual values of logit(P) are not affected.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Normally the user makes a call to the *_fit function which then calls the
fitting function.
</p>
<p>Use the <code><a href="#topic+TimeStratPetersenDiagError_fit">TimeStratPetersenDiagError_fit</a></code> function for cases
where recaptures take place ONLY in the stratum of release, i.e. the
diagonal case.
</p>
<p>The *NP functions fit a non-parametric distribution for the travel times.
</p>


<h3>Value</h3>

<p>An MCMC object with samples from the posterior distribution. A
series of graphs and text file are also created in the working directory.
</p>


<h3>Author(s)</h3>

<p>Bonner, S.J. <a href="mailto:sbonner6@uwo.ca">sbonner6@uwo.ca</a> and 
Schwarz, C. J. <a href="mailto:cschwarz.stat.sfu.ca@gmail.com">cschwarz.stat.sfu.ca@gmail.com</a>.
</p>


<h3>References</h3>

<p>Bonner, S. J., &amp; Schwarz, C. J. (2011). 
Smoothing population size estimates for Time-Stratified Mark-Recapture experiments Using Bayesian P-Splines. 
Biometrics, 67, 1498-1507. 
<a href="https://doi.org/10.1111/j.1541-0420.2011.01599.x">doi:10.1111/j.1541-0420.2011.01599.x</a>
</p>
<p>Schwarz, C. J., &amp; Dempson, J. B. (1994).
Mark-recapture estimation of a salmon smolt population. 
Biometrics, 50, 98-108.
</p>
<p>Schwarz, C.J., D. Pickard, K. Marine and S.J. Bonner. 2009. Juvenile Salmonid Outmigrant
Monitoring Evaluation, Phase II - December 2009. Final Technical Memorandum for the Trinity River
Restoration Program, Weaverville, CA. 155 pp. + appendices available at
<a href="https://www.trrp.net/library/document/?id=369">https://www.trrp.net/library/document/?id=369</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> 
##---- See the vignette  for examples of how to use this package
##

</code></pre>

<hr>
<h2 id='TimeStratPetersenNonDiagErrorNPMarkAvail_fit'>Wrapper (*_fit)  to call the function to fit a Time Stratified Petersen Estimator
with NON Diagonal Entries with an non-parametric travel time and fall back</h2><span id='topic+TimeStratPetersenNonDiagErrorNPMarkAvail_fit'></span>

<h3>Description</h3>

<p>Takes the number of marked fish released, the number of recaptures, and the
number of unmarked fish and uses Bayesian methods to fit a fit a spline
through the population numbers and a hierarchical model for the trap
efficiencies over time.  The output is written to files and an MCMC object
is also created with samples from the posterior.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TimeStratPetersenNonDiagErrorNPMarkAvail_fit(
  title = "TSPNDENP-avail",
  prefix = "TSPNDENP-avail-",
  time,
  n1,
  m2,
  u2,
  sampfrac = rep(1, length(u2)),
  jump.after = NULL,
  bad.n1 = c(),
  bad.m2 = c(),
  bad.u2 = c(),
  logitP.cov = rep(1, length(u2)),
  logitP.fixed = NULL,
  logitP.fixed.values = NULL,
  marked_available_n,
  marked_available_x,
  n.chains = 3,
  n.iter = 2e+05,
  n.burnin = 1e+05,
  n.sims = 2000,
  tauU.alpha = 1,
  tauU.beta = 0.05,
  taueU.alpha = 1,
  taueU.beta = 0.05,
  prior.beta.logitP.mean = c(logit(sum(m2, na.rm = TRUE)/sum(n1, na.rm = TRUE)), rep(0,
    ncol(as.matrix(logitP.cov)) - 1)),
  prior.beta.logitP.sd = c(2, rep(10, ncol(as.matrix(logitP.cov)) - 1)),
  tauP.alpha = 0.001,
  tauP.beta = 0.001,
  Delta.max = NULL,
  tauTT.alpha = 0.1,
  tauTT.beta = 0.1,
  run.prob = seq(0, 1, 0.1),
  debug = FALSE,
  debug2 = FALSE,
  InitialSeed = ceiling(stats::runif(1, min = 0, max = 1e+06)),
  save.output.to.files = TRUE,
  trunc.logitP = 15
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_title">title</code></td>
<td>
<p>A character string used for a title on reports and graphs</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_prefix">prefix</code></td>
<td>
<p>A character string used as the prefix for created files. All
created graph files are of the form prefix-xxxxx.pdf.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_time">time</code></td>
<td>
<p>A numeric vector of time used to label the strata. For example,
this could be julian week for data stratified at a weekly level.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_n1">n1</code></td>
<td>
<p>A numeric vector of the number of marked fish released in each
time stratum.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_m2">m2</code></td>
<td>
<p>A numeric matrix of the number of fish released in stratum [i] and
recovered in [j-1] strata later.  For example m2[3,5] is the number of
marked fish released in stratum 3 and recovered 4 strata later in stratum 7.
The first column is the number of marked fish recovered in the stratum of
release, i.e. 0 strata later.  Use the
<code><a href="#topic+TimeStratPetersenDiagError_fit">TimeStratPetersenDiagError_fit</a></code> function for cases where
recaptures take place ONLY in the stratum of release, i.e. the diagonal
case.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_u2">u2</code></td>
<td>
<p>A numeric vector of the number of unmarked fish captured in each
stratum.  These will be expanded by the capture efficiency to estimate the
population size in each stratum. The length of u2 should be between the length of n1 and length n1 + number of columns in m2 -1</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_sampfrac">sampfrac</code></td>
<td>
<p><strong>Deprecated</strong> because it really doesn't work as intended.
You must remove all references to sampfrac from your code. Contact <a href="mailto:cschwarz.stat.sfu.ca@gmail.com">cschwarz.stat.sfu.ca@gmail.com</a>
for more information.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_jump.after">jump.after</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.
In some cases, the spline fitting the population numbers should be allowed
to jump.  For example, the population size could take a jump when hatchery
released fish suddenly arrive at the trap.  The jumps occur AFTER the strata
listed in this argument.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_bad.n1">bad.n1</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.  In
some cases, something goes wrong in the stratum, and the number of marked
fish releases should be discarded.  The values of <code>n1</code> and <code>m2</code> will be set to
0 for these strata.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_bad.m2">bad.m2</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.  In
some cases, something goes wrong in the stratum, and the number of recovered
marked fish should be ignored. For example, poor handling is suspected to
induce handling induced mortality in the marked fish and so only very few
are recovered.  The values of <code>n1</code> and <code>m2</code> will be set to 0
for these strata.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_bad.u2">bad.u2</code></td>
<td>
<p>A numeric vector with elements belonging to <code>time</code>.  In
some cases, something goes wrong in the stratum, and the number of unmarked
fish captured should be ignored.  The values of <code>u2</code> in the entire row
will be set to NA for these strata. DO NOT SET the value of u2 to 0 because
this indicates that the trap was operating and captured no fish.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_logitp.cov">logitP.cov</code></td>
<td>
<p>A numeric matrix for covariates to fit the
logit(catchability). Default is a single intercept, i.e. all strata have the
same mean logit(catchability).</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_logitp.fixed">logitP.fixed</code></td>
<td>
<p>A numeric vector (could be null) of the time strata
where the logit(P) would be fixed. Typically, this is used when the capture
rates for some strata are 0 and logit(P) is set to -10 for these strata. The
fixed values are given in <code>logitP.fixed.values</code></p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_logitp.fixed.values">logitP.fixed.values</code></td>
<td>
<p>A numerical vector (could be null) of the fixed
values for logit(P) at strata given by logitP.fixed. Typically this is used
when certain strata have a 0 capture rate and the fixed value is set to -10
which on the logit scale gives p[i] essentially 0. Don't specify values such
as -50 because numerical problems could occur in JAGS.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_marked_available_n">marked_available_n</code></td>
<td>
<p>Information, usually from prior studies, on the
fraction of marks that will be available. The *_n and *_x are used to create
a &quot;binomial&quot; distribution for information on the marked availability. For
example, if *_n=66 and *_x=40, then you estimate that about 40/66=61% of marks
are available and 39% have dropped out or fallen back.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_marked_available_x">marked_available_x</code></td>
<td>
<p>See marked_available_n</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_n.chains">n.chains</code></td>
<td>
<p>Number of parallel MCMC chains to fit.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_n.iter">n.iter</code></td>
<td>
<p>Total number of MCMC iterations in each chain.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_n.burnin">n.burnin</code></td>
<td>
<p>Number of burn-in iterations.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_n.sims">n.sims</code></td>
<td>
<p>Number of simulated values to keeps for posterior
distribution.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_tauu.alpha">tauU.alpha</code></td>
<td>
<p>One of the parameters along with <code>tauU.beta</code> for the
prior for the variance of the random noise for the smoothing spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_tauu.beta">tauU.beta</code></td>
<td>
<p>One of the parameters along with <code>tauU.alpha</code> for the
prior for the variance of the random noise for the smoothing spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_taueu.alpha">taueU.alpha</code></td>
<td>
<p>One of the parameters along with <code>taueU.beta</code> for
the prior for the variance of noise around the spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_taueu.beta">taueU.beta</code></td>
<td>
<p>One of the parameters along with <code>taueU.alpha</code> for
the prior for the variance of noise around the spline.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_prior.beta.logitp.mean">prior.beta.logitP.mean</code></td>
<td>
<p>Mean of the prior normal distribution for
logit(catchability) across strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_prior.beta.logitp.sd">prior.beta.logitP.sd</code></td>
<td>
<p>SD of the prior normal distribution for
logit(catchability) across strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_taup.alpha">tauP.alpha</code></td>
<td>
<p>One of the parameters for the prior for the variance in
logit(catchability) among strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_taup.beta">tauP.beta</code></td>
<td>
<p>One of the parameters for the prior for the variance in
logit(catchability) among strata</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_delta.max">Delta.max</code></td>
<td>
<p>Maximum transition time for marked fish, i.e. all fish
assumed to have moved by Delta.max unit of time</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_tautt.alpha">tauTT.alpha</code></td>
<td>
<p>One of the parameters along with <code>tauTT.beta</code> for
the prior on 1/var of logit continuation ratio for travel times</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_tautt.beta">tauTT.beta</code></td>
<td>
<p>One of the parameters along with <code>tauTT.alpha</code> for
the prior on 1/var of logit continuation ratio for travel times</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_run.prob">run.prob</code></td>
<td>
<p>Numeric vector indicating percentiles of run timing should
be computed.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_debug">debug</code></td>
<td>
<p>Logical flag indicating if a debugging run should be made. In
the debugging run, the number of samples in the posterior is reduced
considerably for a quick turn around.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_debug2">debug2</code></td>
<td>
<p>Logical flag indicated if additional debugging information is
produced. Normally the functions will halt at <code>browser()</code> calls to
allow the user to peek into the internal variables. Not useful except to
package developers.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_initialseed">InitialSeed</code></td>
<td>
<p>Numeric value used to initialize the random numbers used
in the MCMC iterations.</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_save.output.to.files">save.output.to.files</code></td>
<td>
<p>Should the plots and text output be save to the files
in addition to being stored in the MCMC object?</p>
</td></tr>
<tr><td><code id="TimeStratPetersenNonDiagErrorNPMarkAvail_fit_+3A_trunc.logitp">trunc.logitP</code></td>
<td>
<p>Truncate logit(P) between c(=trunc.logitP, trunc.logitP) when plotting the
logitP over time. Actual values of logit(P) are not affected.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Normally the user makes a call to the *_fit function which then calls the
fitting function.
</p>
<p>Use the <code><a href="#topic+TimeStratPetersenDiagError_fit">TimeStratPetersenDiagError_fit</a></code> function for cases
where recaptures take place ONLY in the stratum of release, i.e. the
diagonal case.
</p>
<p>The non-diagonal case fits a log-normal distribution for the travel time.
The *NP functions fit a non-parametric distribution for the travel times.
The *MarkAvail functions extend the *NP functions to allow for reductions in
mark availability because of fall back, immediate tagging mortality, etc.
</p>


<h3>Value</h3>

<p>An MCMC object with samples from the posterior distribution. A
series of graphs and text file are also created in the working directory.
</p>


<h3>Author(s)</h3>

<p>Bonner, S.J. <a href="mailto:sbonner6@uwo.ca">sbonner6@uwo.ca</a> and 
Schwarz, C. J. <a href="mailto:cschwarz.stat.sfu.ca@gmail.com">cschwarz.stat.sfu.ca@gmail.com</a>.
</p>


<h3>References</h3>

<p>Bonner, S. J., &amp; Schwarz, C. J. (2011). 
Smoothing population size estimates for Time-Stratified Mark-Recapture experiments Using Bayesian P-Splines. 
Biometrics, 67, 1498-1507. 
<a href="https://doi.org/10.1111/j.1541-0420.2011.01599.x">doi:10.1111/j.1541-0420.2011.01599.x</a>
</p>
<p>Schwarz, C. J., &amp; Dempson, J. B. (1994).
Mark-recapture estimation of a salmon smolt population. 
Biometrics, 50, 98-108.
</p>
<p>Schwarz, C.J., D. Pickard, K. Marine and S.J. Bonner. 2009. Juvenile Salmonid Outmigrant
Monitoring Evaluation, Phase II - December 2009. Final Technical Memorandum for the Trinity River
Restoration Program, Weaverville, CA. 155 pp. + appendices available at
<a href="https://www.trrp.net/library/document/?id=369">https://www.trrp.net/library/document/?id=369</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> 
##---- See the vignettes  for examples of how to use this package

</code></pre>

<hr>
<h2 id='TimeToTargetRunSize'>Computes and plots posterior distribution of time to get target run size.
For example, the time to reach a cumulative run of 10,000 fish.</h2><span id='topic+TimeToTargetRunSize'></span>

<h3>Description</h3>

<p>Takes a sim.list object from the MCMC runs, computes the posterior
distribution of the time to the target runsize, plots the posterior
#'
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TimeToTargetRunSize(U, time, targetU, file_prefix, ci_prob = 0.95)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="TimeToTargetRunSize_+3A_u">U</code></td>
<td>
<p>Elements of sim.list from MCMC object for U - the estimate runsize
in each stratum</p>
</td></tr>
<tr><td><code id="TimeToTargetRunSize_+3A_time">time</code></td>
<td>
<p>A numeric vector of time used to label the strata. For example,
this could be julian week for data stratified at a weekly level.</p>
</td></tr>
<tr><td><code id="TimeToTargetRunSize_+3A_targetu">targetU</code></td>
<td>
<p>The targeted cumulative run size. E.g. 10,000</p>
</td></tr>
<tr><td><code id="TimeToTargetRunSize_+3A_file_prefix">file_prefix</code></td>
<td>
<p>Character string giving prefix for plot. A plot will be
produced of the posterior in the filename
paste(file_prefix,&quot;-target.pdf&quot;,sep=&quot;&quot;)).</p>
</td></tr>
<tr><td><code id="TimeToTargetRunSize_+3A_ci_prob">ci_prob</code></td>
<td>
<p>What size of credible interval should be computed?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with a sample of the posterior (index), quantiles
(quantiles), mean (mean), median(median), and standard deviation (sd), and
target value (targetU)
</p>


<h3>Author(s)</h3>

<p>Bonner, S.J. <a href="mailto:sbonner6@uwo.ca">sbonner6@uwo.ca</a> and 
Schwarz, C. J. <a href="mailto:cschwarz.stat.sfu.ca@gmail.com">cschwarz.stat.sfu.ca@gmail.com</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'> 
## Not run: 
# Compute the posterior of time to reach 10,000 fish. Results contains the MCMC object
# 
results$TimeToTargetRunSize &lt;- TimeToTargetRunSize( 
        U=results$sims.list$U,
        time=results$data$time,
        targetU=10000,
        file_prefix = 'Time10000')


## End(Not run) # end of dontrun

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
