<!DOCTYPE html><html lang="en-US"><head><title>Help for package ComBatFamQC</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ComBatFamQC}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#.biweight_midvar'><p>Biweight Midvariance Calculation</p></a></li>
<li><a href='#adni'><p>Harmonization Data</p></a></li>
<li><a href='#age_df'><p>Age Trajectory Data</p></a></li>
<li><a href='#age_list_gen'><p>Age Trend Estimates Generation</p></a></li>
<li><a href='#age_save'><p>Export Brain ROI Age Trends</p></a></li>
<li><a href='#age_shiny'><p>Lifespan Age Trends</p></a></li>
<li><a href='#age_table_gen'><p>Generate Age Trend Summary Table</p></a></li>
<li><a href='#age_trend_plot'><p>Generate Age Trend Plot</p></a></li>
<li><a href='#combat_harm'><p>ComBatFamily Harmonization</p></a></li>
<li><a href='#combat_plot_gen'><p>Generate Diagnostic Plots for Batch Effect Analysis</p></a></li>
<li><a href='#combat_table_gen'><p>Generate Diagnostic Tables for Batch Effect Analysis</p></a></li>
<li><a href='#comfam'><p>ComBat Family Harmonization</p></a></li>
<li><a href='#comfam_shiny'><p>Batch Effect Interactive Visualization</p></a></li>
<li><a href='#covfam'><p>CovBat Family Harmonization</p></a></li>
<li><a href='#cus_result_gen'><p>Generate Customized Predicted Quantiles List</p></a></li>
<li><a href='#customize_percentile'><p>Generate Predicted Quantiles for Age Trends</p></a></li>
<li><a href='#data_prep'><p>Data Preparation</p></a></li>
<li><a href='#diag_save'><p>Export Batch Effect Diagnosis Results</p></a></li>
<li><a href='#eb_check'><p>EB Assumption Check</p></a></li>
<li><a href='#form_gen'><p>ComBatFamily Model Formula Generations</p></a></li>
<li><a href='#getQuantileRefactored'><p>Compute Quantile Functions for a Predictor in a GAMLSS Model</p></a></li>
<li><a href='#interaction_gen'><p>Interaction Term Generation</p></a></li>
<li><a href='#model_gen'><p>Model Generations</p></a></li>
<li><a href='#predict.comfam'><p>Apply Harmonization to New Data</p></a></li>
<li><a href='#residual_gen'><p>Post Harmonization Residual Generation</p></a></li>
<li><a href='#visual_prep'><p>Batch Effect Diagnostic Visualization Preparation</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Comprehensive Batch Effect Diagnostics and Harmonization</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.5</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides a comprehensive framework for batch effect diagnostics, harmonization, and post-harmonization downstream analysis. Features include interactive visualization tools, robust statistical tests, and a range of harmonization techniques. Additionally, 'ComBatFamQC' enables the creation of life-span age trend plots with estimated age-adjusted centiles and facilitates the generation of covariate-corrected residuals for analytical purposes. Methods for harmonization are based on approaches described in Johnson et al., (2007) &lt;<a href="https://doi.org/10.1093%2Fbiostatistics%2Fkxj037">doi:10.1093/biostatistics/kxj037</a>&gt;, Beer et al., (2020) &lt;<a href="https://doi.org/10.1016%2Fj.neuroimage.2020.117129">doi:10.1016/j.neuroimage.2020.117129</a>&gt;, Pomponio et al., (2020) &lt;<a href="https://doi.org/10.1016%2Fj.neuroimage.2019.116450">doi:10.1016/j.neuroimage.2019.116450</a>&gt;, and Chen et al., (2021) &lt;<a href="https://doi.org/10.1002%2Fhbm.25688">doi:10.1002/hbm.25688</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/Zheng206/ComBatFamQC">https://github.com/Zheng206/ComBatFamQC</a>,
<a href="https://zheng206.github.io/ComBatQC-Web/">https://zheng206.github.io/ComBatQC-Web/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/Zheng206/ComBatFamQC/issues">https://github.com/Zheng206/ComBatFamQC/issues</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Imports:</td>
<td>tidyr, dplyr, magrittr, ggplot2, DT, shiny, car, broom,
pbkrtest, parallel, Rtsne, MDMR, gamlss, lme4, mgcv, bslib,
shinydashboard, methods, gamlss.dist, invgamma, openxlsx</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1.0)</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, devtools, testthat (&ge; 3.0.0), remotes,
plotly, quarto, spelling,</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-03-17 03:33:40 UTC; zhengren</td>
</tr>
<tr>
<td>Author:</td>
<td>Zheng Ren <a href="https://orcid.org/0009-0006-2430-4625"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre, cph],
  Andrew Chen <a href="https://orcid.org/0000-0002-5027-6422"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cph],
  Elizabeth Horwath <a href="https://orcid.org/0009-0009-1224-6984"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Zheng Ren &lt;zren1422@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-03-17 07:30:19 UTC</td>
</tr>
</table>
<hr>
<h2 id='.biweight_midvar'>Biweight Midvariance Calculation</h2><span id='topic+.biweight_midvar'></span>

<h3>Description</h3>

<p>Compute a robust estimate of midvariance using the biweight method, which reduces the influence of outliers by applying a weighting function to the data based on their deviation from a central value.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.biweight_midvar(data, center = NULL, norm.unbiased = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id=".biweight_midvar_+3A_data">data</code></td>
<td>
<p>A numeric vector containing the data points for which the biweight midvariance is to be calculated.</p>
</td></tr>
<tr><td><code id=".biweight_midvar_+3A_center">center</code></td>
<td>
<p>An optional parameter specifying the central location of the data. If not provided, the function defaults to using the median of the data.</p>
</td></tr>
<tr><td><code id=".biweight_midvar_+3A_norm.unbiased">norm.unbiased</code></td>
<td>
<p>A logical parameter (default: <code>TRUE</code>) indicating whether to use a normalization constant for unbiased estimation. When <code>TRUE</code>, the constant is adjusted to 9 divided by the quantile function of 0.75 from the standard normal distribution.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value representing the robust biweight midvariance estimate.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data &lt;- c(1, 2, 3, 4, 100)
biweight_var &lt;- .biweight_midvar(data)
print(biweight_var)
</code></pre>

<hr>
<h2 id='adni'>Harmonization Data</h2><span id='topic+adni'></span>

<h3>Description</h3>

<p>This data set is a sample data set from ADNI study.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(adni)
</code></pre>


<h3>Format</h3>

<p><code>"adni"</code> is a data frame with 2515 cases (rows) and 104 variables
(columns). 62 features are included for harmonization purpose.
</p>


<h3>Source</h3>

<p><a href="https://adni.loni.usc.edu/">ADNI</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(adni)
head(adni)
</code></pre>

<hr>
<h2 id='age_df'>Age Trajectory Data</h2><span id='topic+age_df'></span>

<h3>Description</h3>

<p>This data set is used to observe life span age trend of brain structures.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(age_df)
</code></pre>


<h3>Format</h3>

<p><code>"age_df"</code> is a simulated data frame with 712 cases (rows) and 56 variables
(columns). 51 rois are included.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(age_df)
head(age_df)
</code></pre>

<hr>
<h2 id='age_list_gen'>Age Trend Estimates Generation</h2><span id='topic+age_list_gen'></span>

<h3>Description</h3>

<p>A GAMLSS model using a Normal distribution was fitted separately to rois of interest,
to establish normative reference ranges for the volume of a specific ROI as a function of age,
adjusting for sex and intracranial volume.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>age_list_gen(
  sub_df,
  lq = 0.25,
  hq = 0.75,
  mu = "smooth",
  sigma = "smooth",
  nu = "default",
  tau = "default"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="age_list_gen_+3A_sub_df">sub_df</code></td>
<td>
<p>A four-column dataset that contains age, sex, intracranial volume (ICV) and roi volume related information.
The columns for age, sex, and ICV must be strictly named <code>"age"</code>, <code>"sex"</code>, and <code>"icv"</code>.</p>
</td></tr>
<tr><td><code id="age_list_gen_+3A_lq">lq</code></td>
<td>
<p>The lower bound quantile. eg: 0.25, 0.05</p>
</td></tr>
<tr><td><code id="age_list_gen_+3A_hq">hq</code></td>
<td>
<p>The upper bound quantile. eg: 0.75, 0.95</p>
</td></tr>
<tr><td><code id="age_list_gen_+3A_mu">mu</code></td>
<td>
<p>An indicator of whether to smooth age variable, include it as a linear term or only include the intercept in the mu formula.
&quot;smooth&quot;: y ~ pb(age), &quot;linear&quot;: y ~ age, &quot;default&quot;: y ~ 1.</p>
</td></tr>
<tr><td><code id="age_list_gen_+3A_sigma">sigma</code></td>
<td>
<p>An indicator of whether to smooth age variable, include it as a linear term or only include the intercept in the sigma formula.
&quot;smooth&quot;: ~ pb(age), &quot;linear&quot;: ~ age, &quot;default&quot;: ~ 1.</p>
</td></tr>
<tr><td><code id="age_list_gen_+3A_nu">nu</code></td>
<td>
<p>An indicator of whether to smooth age variable, include it as a linear term or only include the intercept in the nu formula.
&quot;smooth&quot;: ~ pb(age), &quot;linear&quot;: ~ age, &quot;default&quot;: ~ 1.</p>
</td></tr>
<tr><td><code id="age_list_gen_+3A_tau">tau</code></td>
<td>
<p>An indicator of whether to smooth age variable, include it as a linear term or only include the intercept in the tau formula.
&quot;smooth&quot;: ~ pb(age), &quot;linear&quot;: ~ age, &quot;default&quot;: ~ 1.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>age_list_gen</code> returns a list containing the following components:
</p>
<table role = "presentation">
<tr><td><code>true_df</code></td>
<td>
<p>a dataframe contains the true age and ROI volume information</p>
</td></tr>
<tr><td><code>predicted_df_sex</code></td>
<td>
<p>a dataframe contains the estimated age trend adjusting sex and icv</p>
</td></tr>
<tr><td><code>model</code></td>
<td>
<p>the fitted GAMLSS model</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>sub_df &lt;- age_df[,c("Volume_1", "age", "sex", "ICV_baseline")] |&gt; na.omit()
colnames(sub_df) &lt;- c("Volume_1", "age", "sex", "icv")
age_list_gen(sub_df = sub_df)
</code></pre>

<hr>
<h2 id='age_save'>Export Brain ROI Age Trends</h2><span id='topic+age_save'></span>

<h3>Description</h3>

<p>Save all brain age trends into a single Excel file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>age_save(path, age_list)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="age_save_+3A_path">path</code></td>
<td>
<p>The path to save the excel file.</p>
</td></tr>
<tr><td><code id="age_save_+3A_age_list">age_list</code></td>
<td>
<p>A list containing all ROIs' true volumes, age trend estimates, and the fitted GAMLSS model.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>This function does not return a value. It saves the data to the specified file.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(interactive()){
sub_df &lt;- age_df[,c("Volume_1", "age", "sex", "ICV_baseline")] |&gt; na.omit()
colnames(sub_df) &lt;- c("Volume_1", "age", "sex", "icv")
age_list &lt;- list("Volume_1" = age_list_gen(sub_df = sub_df))

temp_dir &lt;- tempfile()
dir.create(temp_dir)
age_save(temp_dir, age_list)
message("Age trend table saved to: ", temp_dir)
unlink(temp_dir, recursive = TRUE)
}

</code></pre>

<hr>
<h2 id='age_shiny'>Lifespan Age Trends</h2><span id='topic+age_shiny'></span>

<h3>Description</h3>

<p>Provide estimated lifespan age trends of neuroimaging-derived brain structures through shiny app.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>age_shiny(age_list, features, quantile_type, use_plotly = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="age_shiny_+3A_age_list">age_list</code></td>
<td>
<p>A list containing all ROIs' true volumes, age trend estimates, and the fitted GAMLSS model.</p>
</td></tr>
<tr><td><code id="age_shiny_+3A_features">features</code></td>
<td>
<p>A vector of roi names.</p>
</td></tr>
<tr><td><code id="age_shiny_+3A_quantile_type">quantile_type</code></td>
<td>
<p>A vector of quantile types (e.g., <code>c("quantile_25", "median", "quantile_75")</code>)</p>
</td></tr>
<tr><td><code id="age_shiny_+3A_use_plotly">use_plotly</code></td>
<td>
<p>A boolean variable that indicates whether to display the age plot using the <code>plotly</code> package.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When this function is called, it starts a Shiny application in the
user's default web browser. Execution is blocked until the app is closed.
</p>


<h3>Value</h3>

<p>This function does not return a value. It launches a Shiny app.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sub_df &lt;- age_df[,c("Volume_1", "age", "sex", "ICV_baseline")] |&gt; na.omit()
colnames(sub_df) &lt;- c("Volume_1", "age", "sex", "icv")
age_list &lt;- list("Volume_1" = age_list_gen(sub_df = sub_df))
quantile_type &lt;- c("quantile_25", "median", "quantile_75")
if(interactive()){
  age_shiny(age_list = age_list, features = "Volume_1", quantile_type = quantile_type)
}
</code></pre>

<hr>
<h2 id='age_table_gen'>Generate Age Trend Summary Table</h2><span id='topic+age_table_gen'></span>

<h3>Description</h3>

<p>This function generates a summary table of age trend predictions for a specified quantile and demographic group.
The table includes the predicted volume values, percentage changes between age intervals, and other details
for either females, males, or a comparison between both genders.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>age_table_gen(result, q = "median", s = "F")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="age_table_gen_+3A_result">result</code></td>
<td>
<p>A data object containing prediction results and metadata.</p>
</td></tr>
<tr><td><code id="age_table_gen_+3A_q">q</code></td>
<td>
<p>A string specifying the quantile of interest (e.g., <code>"quantile_50"</code> for the median).</p>
</td></tr>
<tr><td><code id="age_table_gen_+3A_s">s</code></td>
<td>
<p>A string indicating the demographic group for which the summary table is generated:
</p>

<ul>
<li> <p><code>"F"</code> for female
</p>
</li>
<li> <p><code>"M"</code> for male
</p>
</li>
<li> <p><code>"F vs M"</code> for comparison between females and males
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>The function processes the input data to filter predictions based on the specified quantile and demographic group.
It calculates percentage changes in predicted volume values for easier interpretation of trends. For gender comparisons
(<code>"F vs M"</code>), it generates side-by-side columns for females and males.
</p>
<p>The output table is formatted using the <code>DT</code> package with additional features, such as CSV and Excel export options.
</p>


<h3>Value</h3>

<p>A <code>datatable</code> object (from the <code>DT</code> package) containing the age trend summary table with the following columns:
</p>

<ul>
<li> <p><code>Age</code>: The age values at regular intervals (rounded to the nearest 10).
</p>
</li>
<li> <p><code>Percentile.Volume</code>: The predicted volume values for the specified quantile (only for females or males).
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;PercentageChange (%)&#8288;</code>: The percentage change in volume between consecutive age intervals (only for females or males).
</p>
</li>
<li> <p><code>Percentile.Volume_F</code>: The predicted volume values for females (when comparing genders).
</p>
</li>
<li> <p><code>Percentile.Volume_M</code>: The predicted volume values for males (when comparing genders).
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;PercentageChange_F (%)&#8288;</code>: The percentage change for females (when comparing genders).
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;PercentageChange_M (%)&#8288;</code>: The percentage change for males (when comparing genders).
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>sub_df &lt;- age_df[,c("Volume_1", "age", "sex", "ICV_baseline")] |&gt; na.omit()
colnames(sub_df) &lt;- c("Volume_1", "age", "sex", "icv")
age_list &lt;- list("Volume_1" = age_list_gen(sub_df = sub_df))
result &lt;- age_list[[1]]
if(interactive()){
 age_table_gen(result, q = "median", s = "F")
}

</code></pre>

<hr>
<h2 id='age_trend_plot'>Generate Age Trend Plot</h2><span id='topic+age_trend_plot'></span>

<h3>Description</h3>

<p>This function creates an age trend plot for a specified feature and demographic group based on GAMLSS model predictions.
The function supports both static plots using <code>ggplot2</code> and interactive plots using <code>plotly</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>age_trend_plot(
  age_list,
  f,
  s = "none",
  q = "median",
  cus_list = NULL,
  use_plotly = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="age_trend_plot_+3A_age_list">age_list</code></td>
<td>
<p>A list containing all ROIs' true volumes, age trend estimates, and the fitted GAMLSS model.</p>
</td></tr>
<tr><td><code id="age_trend_plot_+3A_f">f</code></td>
<td>
<p>A string specifying the feature of interest within the <code>age_list</code>.</p>
</td></tr>
<tr><td><code id="age_trend_plot_+3A_s">s</code></td>
<td>
<p>A string indicating the demographic group for visualization: <code>"F"</code> for female, <code>"M"</code> for male, <code>"F vs M"</code> for gender comparison, or <code>"none"</code> for base plot (true data) visualization.</p>
</td></tr>
<tr><td><code id="age_trend_plot_+3A_q">q</code></td>
<td>
<p>A string specifying the quantile type (e.g., <code>"quantile_75"</code>, <code>"median"</code>, or <code>"customization"</code>).</p>
</td></tr>
<tr><td><code id="age_trend_plot_+3A_cus_list">cus_list</code></td>
<td>
<p>A list object containing customized quantile predictions generated by the <code>cus_result_gen</code> function.</p>
</td></tr>
<tr><td><code id="age_trend_plot_+3A_use_plotly">use_plotly</code></td>
<td>
<p>A boolean indicating whether to create an interactive plot using <code>plotly</code> (default: <code>TRUE</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function overlays true data points with predicted quantile trends for the specified feature and demographic group.
It supports customization for quantile visualization and uses precomputed results from the <code>cus_result_gen</code> function
for enhanced flexibility.
</p>


<h3>Value</h3>

<p>A plot object:
</p>

<ul>
<li><p> If <code>use_plotly = TRUE</code>, returns a <code>plotly</code> interactive plot.
</p>
</li>
<li><p> If <code>use_plotly = FALSE</code>, returns a <code>ggplot2</code> static plot.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>sub_df &lt;- age_df[,c("Volume_1", "age", "sex", "ICV_baseline")] |&gt; na.omit()
colnames(sub_df) &lt;- c("Volume_1", "age", "sex", "icv")
age_list &lt;- list("Volume_1" = age_list_gen(sub_df = sub_df))
customized_results &lt;- cus_result_gen(age_list, customized_q = 0.75, f = "Volume_1")

if(interactive()){
 age_trend_plot(
   age_list = age_list,
   f = "Volume_1",
   s = "F",
   q = "customization",
   cus_list = customized_results,
   use_plotly = TRUE
 )
}
</code></pre>

<hr>
<h2 id='combat_harm'>ComBatFamily Harmonization</h2><span id='topic+combat_harm'></span>

<h3>Description</h3>

<p>Conduct harmonization using four types of methods: 1) Original ComBat, 2) Longitudinal ComBat, 3) ComBat-GAM, and 4) CovBat.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>combat_harm(
  eb_check = FALSE,
  result = NULL,
  features = NULL,
  batch = NULL,
  covariates = NULL,
  df = NULL,
  type = "lm",
  random = NULL,
  smooth = NULL,
  interaction = NULL,
  smooth_int_type = NULL,
  family = "comfam",
  eb = TRUE,
  ref.batch = NULL,
  predict = FALSE,
  object = NULL,
  reference = NULL,
  out_ref_include = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="combat_harm_+3A_eb_check">eb_check</code></td>
<td>
<p>A boolean variable indicating whether the user wants to run the EB assumption test before harmonization.</p>
</td></tr>
<tr><td><code id="combat_harm_+3A_result">result</code></td>
<td>
<p>A list derived from <code>visual_prep()</code> that contains dataset and batch effect diagnostic information for Shiny visualization. Can be skipped if <code>features</code>, <code>batch</code>, <code>covariates</code> and <code>df</code> are provided.</p>
</td></tr>
<tr><td><code id="combat_harm_+3A_features">features</code></td>
<td>
<p>The name of the features to be harmonized. This can be skipped if <code>result</code> is provided.</p>
</td></tr>
<tr><td><code id="combat_harm_+3A_batch">batch</code></td>
<td>
<p>The name of the batch variable. Can be skipped if <code>result</code> is provided.</p>
</td></tr>
<tr><td><code id="combat_harm_+3A_covariates">covariates</code></td>
<td>
<p>The names of covariates supplied to <code>model</code>. This can be be skipped if <code>result</code> is provided.</p>
</td></tr>
<tr><td><code id="combat_harm_+3A_df">df</code></td>
<td>
<p>Dataset to be harmonized. This can be be skipped if <code>result</code> is provided.</p>
</td></tr>
<tr><td><code id="combat_harm_+3A_type">type</code></td>
<td>
<p>The name of a regression model to be used: <code>"lmer"</code>, <code>"lm"</code>, <code>"gam"</code>.</p>
</td></tr>
<tr><td><code id="combat_harm_+3A_random">random</code></td>
<td>
<p>The variable name of a random effect in linear mixed effect model.</p>
</td></tr>
<tr><td><code id="combat_harm_+3A_smooth">smooth</code></td>
<td>
<p>The name of the covariates that require a smooth function.</p>
</td></tr>
<tr><td><code id="combat_harm_+3A_interaction">interaction</code></td>
<td>
<p>Expression of interaction terms supplied to <code>model</code> (eg: <code>"age,diagnosis"</code>).</p>
</td></tr>
<tr><td><code id="combat_harm_+3A_smooth_int_type">smooth_int_type</code></td>
<td>
<p>A vector that indicates the types of interaction in <code>gam</code> models. By default, <code>smooth_int_type</code> is set to be NULL, <code>"linear"</code> represents linear interaction terms.
<code>"categorical-continuous"</code>, <code>"factor-smooth"</code> both represent categorical-continuous interactions (<code>"factor-smooth"</code> includes categorical variable as part of the smooth),
<code>"tensor"</code> represents interactions with different scales, and &quot;smooth-smooth&quot; represents interaction between smoothed variables.</p>
</td></tr>
<tr><td><code id="combat_harm_+3A_family">family</code></td>
<td>
<p>The type of combat family to use, <code>comfam</code> or <code>covfam</code>.</p>
</td></tr>
<tr><td><code id="combat_harm_+3A_eb">eb</code></td>
<td>
<p>If <code>TRUE</code>, uses ComBat model with empirical Bayes for mean and variance harmonization</p>
</td></tr>
<tr><td><code id="combat_harm_+3A_ref.batch">ref.batch</code></td>
<td>
<p>The name of the reference batch.</p>
</td></tr>
<tr><td><code id="combat_harm_+3A_predict">predict</code></td>
<td>
<p>A boolean variable indicating whether to run ComBat from scratch or apply existing model to new dataset (currently only work for original ComBat and ComBat-GAM).</p>
</td></tr>
<tr><td><code id="combat_harm_+3A_object">object</code></td>
<td>
<p>Existing ComBat model.</p>
</td></tr>
<tr><td><code id="combat_harm_+3A_reference">reference</code></td>
<td>
<p>Dataset to be considered as the reference group.</p>
</td></tr>
<tr><td><code id="combat_harm_+3A_out_ref_include">out_ref_include</code></td>
<td>
<p>A boolean variable indicating whether the reference data should be included in the harmonized data output.</p>
</td></tr>
<tr><td><code id="combat_harm_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code>comfam</code> or <code>covfam</code> models.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If the <code>eb_check</code> is set to be FALSE, then <code>combat_harm</code> returns a list containing the following components:
</p>
<table role = "presentation">
<tr><td><code>com_family</code></td>
<td>
<p>ComBat family to be considered: comfam, covfam</p>
</td></tr>
<tr><td><code>harmonized_df</code></td>
<td>
<p>Harmonized dataset</p>
</td></tr>
<tr><td><code>combat.object</code></td>
<td>
<p>Saved ComBat model and relevant information, such as the batch variable name and whether the EB method is used</p>
</td></tr>
</table>
<p>If <code>eb_check</code>  is set to be TRUE, then <code>combat_harm</code> will return a dataframe with the EB assumption test result.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>combat_harm(features = colnames(adni)[43:53], batch = "manufac",
covariates = c("AGE", "SEX", "DIAGNOSIS"), df = head(adni,100), type = "lm")

</code></pre>

<hr>
<h2 id='combat_plot_gen'>Generate Diagnostic Plots for Batch Effect Analysis</h2><span id='topic+combat_plot_gen'></span>

<h3>Description</h3>

<p>This function generates a variety of diagnostic plots for analyzing batch effects and their relationships with features and covariates.
Depending on the specified plot type, it can create density plots, box plots, residual plots, PCA plots, T-SNE plots, and empirical Bayes diagnostic plots.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>combat_plot_gen(
  result,
  f = NULL,
  batch_control = "No",
  batch_level = NULL,
  plot_name,
  c = NULL,
  smooth_method = "lm",
  alpha = 0.2,
  char_plot_type = "boxplot",
  text_status = "No",
  color = "No",
  label = "No",
  angle = 0,
  PC1 = NULL,
  PC2 = NULL,
  eb = TRUE,
  eb_df = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="combat_plot_gen_+3A_result">result</code></td>
<td>
<p>A list derived from <code>visual_prep()</code> that contains datasets and statistical test results for Shiny visualization.</p>
</td></tr>
<tr><td><code id="combat_plot_gen_+3A_f">f</code></td>
<td>
<p>A string specifying the feature of interest for visualization.</p>
</td></tr>
<tr><td><code id="combat_plot_gen_+3A_batch_control">batch_control</code></td>
<td>
<p>A string indicating whether to include batch-specific controls. Defaults to <code>"No"</code>.</p>
</td></tr>
<tr><td><code id="combat_plot_gen_+3A_batch_level">batch_level</code></td>
<td>
<p>A vector specifying the batch levels to include in the plot. Used only when <code>batch_control</code> is not <code>"No"</code>.</p>
</td></tr>
<tr><td><code id="combat_plot_gen_+3A_plot_name">plot_name</code></td>
<td>
<p>A string specifying the type of plot to generate. Options include <code>"batch_density"</code>, <code>"cov_feature"</code>, <code>"batch_summary"</code>, <code>"cov_distribution"</code>, <code>"resid_add"</code>, <code>"resid_mul"</code>, <code>"pca"</code>, <code>"tsne"</code>, <code>"eb_location"</code>, and <code>"eb_scale"</code>.</p>
</td></tr>
<tr><td><code id="combat_plot_gen_+3A_c">c</code></td>
<td>
<p>A string specifying the covariate of interest for <code>"cov_feature"</code> or <code>"cov_distribution"</code> plots.</p>
</td></tr>
<tr><td><code id="combat_plot_gen_+3A_smooth_method">smooth_method</code></td>
<td>
<p>A string specifying the smoothing method for trend lines. Defaults to <code>"lm"</code> (linear model).</p>
</td></tr>
<tr><td><code id="combat_plot_gen_+3A_alpha">alpha</code></td>
<td>
<p>A numeric value between 0 and 1 controlling the transparency of trend lines. Defaults to <code>0.2</code>.</p>
</td></tr>
<tr><td><code id="combat_plot_gen_+3A_char_plot_type">char_plot_type</code></td>
<td>
<p>A string specifying the type of plot for categorical covariates. Options include <code>"boxplot"</code>, <code>"boxplot with points"</code>, and <code>"density plot"</code>. Defaults to <code>"boxplot"</code>.</p>
</td></tr>
<tr><td><code id="combat_plot_gen_+3A_text_status">text_status</code></td>
<td>
<p>A string indicating whether to display text annotations in the plot. Defaults to <code>"No"</code>.</p>
</td></tr>
<tr><td><code id="combat_plot_gen_+3A_color">color</code></td>
<td>
<p>A string indicating whether to use color coding in plots. Defaults to <code>"No"</code>.</p>
</td></tr>
<tr><td><code id="combat_plot_gen_+3A_label">label</code></td>
<td>
<p>A string indicating whether to include axis labels in the plot. Defaults to <code>"No"</code>.</p>
</td></tr>
<tr><td><code id="combat_plot_gen_+3A_angle">angle</code></td>
<td>
<p>A numeric value specifying the angle of x-axis labels. Defaults to <code>0</code>.</p>
</td></tr>
<tr><td><code id="combat_plot_gen_+3A_pc1">PC1</code></td>
<td>
<p>A string specifying the first principal component for PCA plots.</p>
</td></tr>
<tr><td><code id="combat_plot_gen_+3A_pc2">PC2</code></td>
<td>
<p>A string specifying the second principal component for PCA plots.</p>
</td></tr>
<tr><td><code id="combat_plot_gen_+3A_eb">eb</code></td>
<td>
<p>A logical value indicating whether to include empirical Bayes prior information in the plot. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="combat_plot_gen_+3A_eb_df">eb_df</code></td>
<td>
<p>A data frame containing empirical Bayes information for generating <code>eb_location</code> and <code>eb_scale</code> plots.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function dynamically generates plots based on the <code>plot_name</code> parameter:
</p>

<ul>
<li> <p><code>"batch_density"</code>: Density plots of features by batch levels.
</p>
</li>
<li> <p><code>"cov_feature"</code>: Covariate vs. feature plots with optional batch adjustments.
</p>
</li>
<li> <p><code>"batch_summary"</code>: Bar plots summarizing batch-level distributions.
</p>
</li>
<li> <p><code>"cov_distribution"</code>: Covariate distributions stratified by batch.
</p>
</li>
<li> <p><code>"resid_add"</code>: Additive residual box plots.
</p>
</li>
<li> <p><code>"resid_mul"</code>: Multiplicative residual box plots.
</p>
</li>
<li> <p><code>"pca"</code>: Principal Component Analysis (PCA) plots.
</p>
</li>
<li> <p><code>"tsne"</code>: T-SNE plots for dimensionality reduction.
</p>
</li>
<li> <p><code>"eb_location"</code>: Empirical Bayes location parameter density plots.
</p>
</li>
<li> <p><code>"eb_scale"</code>: Empirical Bayes scale parameter density plots.
</p>
</li></ul>



<h3>Value</h3>

<p>A ggplot object representing the specified diagnostic plot.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(interactive()){
 result &lt;- visual_prep(type = "lm", features = "thickness.left.cuneus",
 batch = "manufac", covariates = "AGE", df = adni[1:100, ], mdmr = FALSE, cores = 1)
 combat_plot_gen(result, f = "thickness.left.cuneus", plot_name = "batch_density")
 combat_plot_gen(result, f = "thickness.left.cuneus", c = "AGE", plot_name = "cov_feature")
}

</code></pre>

<hr>
<h2 id='combat_table_gen'>Generate Diagnostic Tables for Batch Effect Analysis</h2><span id='topic+combat_table_gen'></span>

<h3>Description</h3>

<p>This function generates a variety of tables to summarize data and results from batch effect analyses.
Depending on the specified table name, it can create data overview tables, exploratory analysis summaries,
statistical test results, PCA summaries, and covariate distributions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>combat_table_gen(
  result,
  table_name,
  f = NULL,
  c = NULL,
  PC1 = NULL,
  PC2 = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="combat_table_gen_+3A_result">result</code></td>
<td>
<p>A list derived from <code>visual_prep()</code> that contains datasets and statistical test results for Shiny visualization.</p>
</td></tr>
<tr><td><code id="combat_table_gen_+3A_table_name">table_name</code></td>
<td>
<p>A string specifying the type of table to generate. Options include:
</p>

<ul>
<li> <p><code>"data_overview"</code>: Overview of the dataset, including covariates, features, and batch information.
</p>
</li>
<li> <p><code>"exploratory_analysis"</code>: Summary of the selected feature and covariates.
</p>
</li>
<li> <p><code>"summary_df"</code>: Summary of batch-level distributions, including batch removal status.
</p>
</li>
<li> <p><code>"cov_table"</code>: Covariate summary table, displaying distributions for numeric or categorical covariates.
</p>
</li>
<li> <p><code>"pc_variance"</code>: Variance explained by specified principal components.
</p>
</li>
<li> <p><code>"mdmr"</code>: Results from the Multivariate Distance Matrix Regression (MDMR) analysis.
</p>
</li>
<li> <p><code>"kenward_roger"</code>: Results from Kenward-Roger tests.
</p>
</li>
<li> <p><code>"anova"</code>: Results from ANOVA tests.
</p>
</li>
<li> <p><code>"kruskal_wallis"</code>: Results from Kruskal-Wallis tests.
</p>
</li>
<li> <p><code>"fligner_killeen"</code>: Results from Fligner-Killeen tests.
</p>
</li>
<li> <p><code>"levenes"</code>: Results from Levene's tests.
</p>
</li>
<li> <p><code>"bartletts"</code>: Results from Bartlett's tests.
</p>
</li></ul>
</td></tr>
<tr><td><code id="combat_table_gen_+3A_f">f</code></td>
<td>
<p>A string specifying the feature of interest for tables requiring a specific feature. Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="combat_table_gen_+3A_c">c</code></td>
<td>
<p>A string specifying the covariate of interest for tables requiring a specific covariate. Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="combat_table_gen_+3A_pc1">PC1</code></td>
<td>
<p>A string specifying the first principal component for PCA variance tables. Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="combat_table_gen_+3A_pc2">PC2</code></td>
<td>
<p>A string specifying the second principal component for PCA variance tables. Default is <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function dynamically generates tables based on the <code>table_name</code> parameter.
</p>


<h3>Value</h3>

<p>A <code>DT::datatable</code> object containing the requested table.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(interactive()){
 result &lt;- visual_prep(type = "lm", features = "thickness.left.cuneus",
 batch = "manufac", covariates = "AGE", df = adni[1:100, ], mdmr = FALSE, cores = 1)
 combat_table_gen(result, table_name = "cov_table", c = "AGE")
 combat_table_gen(result, table_name = "pc_variance", PC1 = "PC1", PC2 = "PC2")
 }

</code></pre>

<hr>
<h2 id='comfam'>ComBat Family Harmonization</h2><span id='topic+comfam'></span>

<h3>Description</h3>

<p>Implementation of the ComBat Family of harmonization methods allowing for
flexible covariate modeling and alternative estimators for site effect
adjustment. Support for modeling of both location and scale via GAMLSS and
longitudinal harmonization via mixed effects models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>comfam(
  data,
  bat,
  covar = NULL,
  model = lm,
  formula = NULL,
  eb = TRUE,
  robust.LS = FALSE,
  ref.batch = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="comfam_+3A_data">data</code></td>
<td>
<p><em>n x p</em> data frame or matrix of observations where
<em>p</em> is the number of features and <em>n</em> is the number of subjects.</p>
</td></tr>
<tr><td><code id="comfam_+3A_bat">bat</code></td>
<td>
<p>Factor indicating batch (often equivalent to site or scanner)</p>
</td></tr>
<tr><td><code id="comfam_+3A_covar">covar</code></td>
<td>
<p>Data frame or matrix of covariates supplied to <code>model</code></p>
</td></tr>
<tr><td><code id="comfam_+3A_model">model</code></td>
<td>
<p>Model function. ComBat Family supports any models that take
arguments <code>formula</code> and <code>data</code>, but are limited to models fitting with
identity link (e.g. <code>family = gaussian(link = "identity")</code>). This includes
<a href="stats.html#topic+lm">lm</a>, <a href="mgcv.html#topic+gam">gam</a>, <a href="gamlss.html#topic+gamlss">gamlss</a>,
<a href="quantreg.html#topic+rq">rq</a>, <a href="lme4.html#topic+lmer">lmer</a>, and more</p>
</td></tr>
<tr><td><code id="comfam_+3A_formula">formula</code></td>
<td>
<p>Formula for <code>model</code> starting with <code style="white-space: pre;">&#8288;y ~&#8288;</code> where <code>y</code> represents
each feature</p>
</td></tr>
<tr><td><code id="comfam_+3A_eb">eb</code></td>
<td>
<p>If <code>TRUE</code>, uses ComBat model with empirical Bayes for mean
and variance harmonization</p>
</td></tr>
<tr><td><code id="comfam_+3A_robust.ls">robust.LS</code></td>
<td>
<p>If <code>TRUE</code>, uses robust location and scale estimators
for error variance and site effect parameters. Currently uses median and
biweight midvariance</p>
</td></tr>
<tr><td><code id="comfam_+3A_ref.batch">ref.batch</code></td>
<td>
<p>Reference batch, must take value in <code>levels(bat)</code></p>
</td></tr>
<tr><td><code id="comfam_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code>model</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>comfam</code> returns a list containing the following components:
</p>
<table role = "presentation">
<tr><td><code>dat.combat</code></td>
<td>
<p>Harmonized data as a matrix with same dimensions as <code>data</code></p>
</td></tr>
<tr><td><code>batch.info</code></td>
<td>
<p>Batch information, including reference batch if specified</p>
</td></tr>
<tr><td><code>fits</code></td>
<td>
<p>List of model fits from regression step, outputs of <code>model</code> for each feature</p>
</td></tr>
<tr><td><code>estimates</code></td>
<td>
<p>List of estimates from standardization and batch effect correction</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><a href="#topic+predict.comfam">predict.comfam</a> for applying ComBat parameters for
harmonization of new observations
</p>


<h3>Examples</h3>

<pre><code class='language-R'>comfam(iris[,1:2], iris$Species)
comfam(iris[,1:2], iris$Species, iris[3:4], lm, y ~ Petal.Length + Petal.Width)
</code></pre>

<hr>
<h2 id='comfam_shiny'>Batch Effect Interactive Visualization</h2><span id='topic+comfam_shiny'></span>

<h3>Description</h3>

<p>Provides an interactive visualization of batch or site effects using a Shiny application.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>comfam_shiny(result, after = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="comfam_shiny_+3A_result">result</code></td>
<td>
<p>A list derived from <code>visual_prep()</code> that contains datasets and statistical test results for Shiny visualization.</p>
</td></tr>
<tr><td><code id="comfam_shiny_+3A_after">after</code></td>
<td>
<p>A boolean variable indicating whether the batch effect diagnostic occurs before or after harmonization (default: <code>FALSE</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When this function is called, it starts a Shiny application in the
user's default web browser. Execution is blocked until the app is closed.
</p>


<h3>Value</h3>

<p>This function does not return a value. It launches a Shiny app.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>result_lm &lt;- visual_prep(type = "lm", features = colnames(adni)[43:53],
batch = "manufac", covariates = c("AGE", "SEX", "DIAGNOSIS"),
df = head(adni, 500), cores = 1)
if (interactive()) {
  comfam_shiny(result = result_lm)
}
</code></pre>

<hr>
<h2 id='covfam'>CovBat Family Harmonization</h2><span id='topic+covfam'></span>

<h3>Description</h3>

<p>Implementation of the CovBat Family of harmonization methods allowing for
removal of multivariate batch effects, flexible covariate modeling and
alternative estimators for site effect adjustment. Support for modeling of
both location and scale via GAMLSS. Additional support for modeling of
covariate effects in score location and scale.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>covfam(
  data,
  bat,
  covar = NULL,
  model = lm,
  formula = NULL,
  score.model = NULL,
  score.args = NULL,
  eb = TRUE,
  robust.LS = FALSE,
  ref.batch = NULL,
  percent.var = 0.95,
  n.pc = NULL,
  std.var = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="covfam_+3A_data">data</code></td>
<td>
<p><em>n x p</em> data frame or matrix of observations where
<em>p</em> is the number of features and <em>n</em> is the number of subjects.</p>
</td></tr>
<tr><td><code id="covfam_+3A_bat">bat</code></td>
<td>
<p>Factor indicating batch (often equivalent to site or scanner)</p>
</td></tr>
<tr><td><code id="covfam_+3A_covar">covar</code></td>
<td>
<p>Data frame or matrix of covariates supplied to <code>model</code></p>
</td></tr>
<tr><td><code id="covfam_+3A_model">model</code></td>
<td>
<p>Model function. ComBat Family supports any models that take
arguments <code>formula</code> and <code>data</code>, but are limited to models fitting with
identity link (e.g. <code>family = gaussian(link = "identity")</code>). This includes
<a href="stats.html#topic+lm">lm</a>, <a href="mgcv.html#topic+gam">gam</a>, <a href="gamlss.html#topic+gamlss">gamlss</a>,
<a href="quantreg.html#topic+rq">rq</a>, <a href="lme4.html#topic+lmer">lmer</a>, and more</p>
</td></tr>
<tr><td><code id="covfam_+3A_formula">formula</code></td>
<td>
<p>Formula for <code>model</code> starting with <code style="white-space: pre;">&#8288;y ~&#8288;</code> where <code>y</code> represents
each feature</p>
</td></tr>
<tr><td><code id="covfam_+3A_score.model">score.model</code></td>
<td>
<p>Model for scores, defaults to NULL for fitting basic
location and scale model without covariates on the scores</p>
</td></tr>
<tr><td><code id="covfam_+3A_score.args">score.args</code></td>
<td>
<p>List of arguments for score model</p>
</td></tr>
<tr><td><code id="covfam_+3A_eb">eb</code></td>
<td>
<p>If <code>TRUE</code>, uses ComBat model with empirical Bayes for mean
and variance harmonization.</p>
</td></tr>
<tr><td><code id="covfam_+3A_robust.ls">robust.LS</code></td>
<td>
<p>If <code>TRUE</code>, uses robust location and scale estimators
for error variance and site effect parameters. Uses median and
biweight midvariance</p>
</td></tr>
<tr><td><code id="covfam_+3A_ref.batch">ref.batch</code></td>
<td>
<p>Reference batch, must take value in <code>levels(bat)</code></p>
</td></tr>
<tr><td><code id="covfam_+3A_percent.var">percent.var</code></td>
<td>
<p>Numeric. The number of harmonized principal component
scores is selected to explain this proportion of the variance</p>
</td></tr>
<tr><td><code id="covfam_+3A_n.pc">n.pc</code></td>
<td>
<p>Optional numeric. If specified, this number of principal
component scores is harmonized. Overrides <code>percent.var</code></p>
</td></tr>
<tr><td><code id="covfam_+3A_std.var">std.var</code></td>
<td>
<p>If <code>TRUE</code>, scales variances to be equal to 1 before PCA.</p>
</td></tr>
<tr><td><code id="covfam_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code>model</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>covfam</code> returns a list containing the following components:
</p>
<table role = "presentation">
<tr><td><code>dat.covbat</code></td>
<td>
<p>Harmonized data as a matrix with same dimensions as <code>data</code></p>
</td></tr>
<tr><td><code>batch.info</code></td>
<td>
<p>Batch information, including reference batch if specified</p>
</td></tr>
<tr><td><code>combat.out</code></td>
<td>
<p>List output of <code>comfam</code> from the ComBat step</p>
</td></tr>
<tr><td><code>pc.output</code></td>
<td>
<p>Output of <code>prcomp</code> from PCA step</p>
</td></tr>
<tr><td><code>n.pc</code></td>
<td>
<p>Numeric, number of PCs harmonized</p>
</td></tr>
<tr><td><code>scores.com</code></td>
<td>
<p>List output of <code>comfam</code> from the CovBat step</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>covfam(iris[,1:2], iris$Species)
covfam(iris[,1:2], iris$Species, iris[3:4], lm, y ~ Petal.Length + Petal.Width)
</code></pre>

<hr>
<h2 id='cus_result_gen'>Generate Customized Predicted Quantiles List</h2><span id='topic+cus_result_gen'></span>

<h3>Description</h3>

<p>This function computes customized predicted quantiles for a specified feature across both female and male groups
using a GAMLSS model. The resulting list object is structured for visualization purposes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cus_result_gen(age_list, customized_q = 0.75, f)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cus_result_gen_+3A_age_list">age_list</code></td>
<td>
<p>A list containing all ROIs' true volumes, age trend estimates, and the fitted GAMLSS model.</p>
</td></tr>
<tr><td><code id="cus_result_gen_+3A_customized_q">customized_q</code></td>
<td>
<p>A numeric value between 0 and 1 representing the quantile to predict (e.g., <code>0.75</code> for the 75th percentile).</p>
</td></tr>
<tr><td><code id="cus_result_gen_+3A_f">f</code></td>
<td>
<p>A string specifying the feature of interest within the <code>age_list</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function utilizes the GAMLSS model to compute predictions for the specified quantile across demographic groups.
The results include predictions for both the specified quantile and the median, enabling enhanced visualization.
</p>


<h3>Value</h3>

<p>A list containing the customized quantile value used for predictions and a data frame with columns for age, quantile type, prediction, and sex.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sub_df &lt;- age_df[,c("Volume_1", "age", "sex", "ICV_baseline")] |&gt; na.omit()
colnames(sub_df) &lt;- c("Volume_1", "age", "sex", "icv")
age_list &lt;- list("Volume_1" = age_list_gen(sub_df = sub_df))
cus_result_gen(age_list, customized_q = 0.75, f = "Volume_1")
</code></pre>

<hr>
<h2 id='customize_percentile'>Generate Predicted Quantiles for Age Trends</h2><span id='topic+customize_percentile'></span>

<h3>Description</h3>

<p>This function computes predicted quantiles for a specified feature and demographic group based on a GAMLSS model.
The function interpolates predictions over a range of ages while accounting for fixed covariates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>customize_percentile(age_list, feature, q = 0.75, s = "F")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="customize_percentile_+3A_age_list">age_list</code></td>
<td>
<p>A list containing all ROIs' true volumes, age trend estimates, and the fitted GAMLSS model.</p>
</td></tr>
<tr><td><code id="customize_percentile_+3A_feature">feature</code></td>
<td>
<p>A string specifying the feature of interest within the <code>age_list</code>.</p>
</td></tr>
<tr><td><code id="customize_percentile_+3A_q">q</code></td>
<td>
<p>A numeric value between 0 and 1 representing the quantile to predict (e.g., <code>0.5</code> for the median).</p>
</td></tr>
<tr><td><code id="customize_percentile_+3A_s">s</code></td>
<td>
<p>A string indicating the gender of the group for which the predictions are generated (e.g., <code>"F"</code> for female, <code>"M"</code> for male).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function uses a GAMLSS model to generate predictions for a specified quantile and demographic group.
The predictions are computed over a sequence of ages (<code>age_test</code>) that spans the observed age range in the data.
The function adjusts for fixed covariates such as <code>icv</code> by using their mean values from the input data.
</p>


<h3>Value</h3>

<p>A data frame containing columns for age, quantile type, prediction, and sex.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sub_df &lt;- age_df[,c("Volume_1", "age", "sex", "ICV_baseline")] |&gt; na.omit()
colnames(sub_df) &lt;- c("Volume_1", "age", "sex", "icv")
age_list &lt;- list("Volume_1" = age_list_gen(sub_df = sub_df))
customize_percentile(age_list, feature = "Volume_1", q = 0.5, s = "F")
</code></pre>

<hr>
<h2 id='data_prep'>Data Preparation</h2><span id='topic+data_prep'></span>

<h3>Description</h3>

<p>Prepares the dataset for effective use in batch effect diagnostics, harmonization, and post-harmonization downstream analysis processes within the <code>ComBatFamQC</code> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data_prep(
  stage = "harmonization",
  result = NULL,
  features = NULL,
  batch = NULL,
  covariates = NULL,
  df = NULL,
  type = "lm",
  random = NULL,
  smooth = NULL,
  interaction = NULL,
  smooth_int_type = NULL,
  predict = FALSE,
  object = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="data_prep_+3A_stage">stage</code></td>
<td>
<p>Specifies the stage of analysis for which the data preparation is intended: harmonization or residual.</p>
</td></tr>
<tr><td><code id="data_prep_+3A_result">result</code></td>
<td>
<p>A list derived from <code>visual_prep()</code> that contains dataset and batch effect diagnostic information for Shiny visualization. Can be skipped if <code>features</code>, <code>batch</code>, <code>covariates</code> and <code>df</code> are provided.</p>
</td></tr>
<tr><td><code id="data_prep_+3A_features">features</code></td>
<td>
<p>The name of the features to be harmonized. This can be skipped if <code>result</code> is provided.</p>
</td></tr>
<tr><td><code id="data_prep_+3A_batch">batch</code></td>
<td>
<p>The name of the batch variable. Can be skipped if <code>result</code> is provided.</p>
</td></tr>
<tr><td><code id="data_prep_+3A_covariates">covariates</code></td>
<td>
<p>The names of covariates supplied to <code>model</code>. This can be be skipped if <code>result</code> is provided.</p>
</td></tr>
<tr><td><code id="data_prep_+3A_df">df</code></td>
<td>
<p>The dataset to be harmonized. This can be be skipped if <code>result</code> is provided.</p>
</td></tr>
<tr><td><code id="data_prep_+3A_type">type</code></td>
<td>
<p>The name of a regression model to be used in batch effect diagnostics, harmonization, and the post-harmonization stage: &quot;lmer&quot;, &quot;lm&quot;, &quot;gam&quot;.</p>
</td></tr>
<tr><td><code id="data_prep_+3A_random">random</code></td>
<td>
<p>The variable name of a random effect in linear mixed effect model.</p>
</td></tr>
<tr><td><code id="data_prep_+3A_smooth">smooth</code></td>
<td>
<p>The name of the covariates that require a smooth function.</p>
</td></tr>
<tr><td><code id="data_prep_+3A_interaction">interaction</code></td>
<td>
<p>Expression of interaction terms supplied to <code>model</code> (eg: &quot;age,diagnosis&quot;).</p>
</td></tr>
<tr><td><code id="data_prep_+3A_smooth_int_type">smooth_int_type</code></td>
<td>
<p>A vector that indicates the types of interaction in <code>gam</code> models. By default, smooth_int_type is set to be NULL, &quot;linear&quot; represents linear interaction terms.
&quot;categorical-continuous&quot;, &quot;factor-smooth&quot; both represent categorical-continuous interactions (&quot;factor-smooth&quot; includes categorical variable as part of the smooth),
&quot;tensor&quot; represents interactions with different scales, and &quot;smooth-smooth&quot; represents interaction between smoothed variables.</p>
</td></tr>
<tr><td><code id="data_prep_+3A_predict">predict</code></td>
<td>
<p>A boolean variable indicating whether to run ComBat from scratch or apply existing model to new dataset (currently only work for &quot;original ComBat&quot; and &quot;ComBat-GAM&quot;).</p>
</td></tr>
<tr><td><code id="data_prep_+3A_object">object</code></td>
<td>
<p>Existing ComBat model.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>data_prep</code> returns a list containing the processed data and parameter-related information for batch effect diagnostics, harmonization, and post-harmonization downstream analysis.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data_prep(stage = "harmonization", result = NULL, features = colnames(adni)[43:53],
batch = "manufac", covariates = "AGE", df = head(adni, 100), type = "lm", random = NULL,
smooth = NULL, interaction = NULL, smooth_int_type = NULL, predict = FALSE, object = NULL)

</code></pre>

<hr>
<h2 id='diag_save'>Export Batch Effect Diagnosis Results</h2><span id='topic+diag_save'></span>

<h3>Description</h3>

<p>Save all the batch effect diagnosis results in a single Excel file or a Quarto report.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>diag_save(path, result, use_quarto = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="diag_save_+3A_path">path</code></td>
<td>
<p>The path to save the result.</p>
</td></tr>
<tr><td><code id="diag_save_+3A_result">result</code></td>
<td>
<p>A list derived from <code>visual_prep()</code> that contains datasets and statistical test results.</p>
</td></tr>
<tr><td><code id="diag_save_+3A_use_quarto">use_quarto</code></td>
<td>
<p>A boolean variable indicating whether to generate a Quarto report.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>This function does not return a value. It saves the data to the specified file.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(interactive()){
  result &lt;- visual_prep(type = "lm", features = "thickness.left.cuneus",
  batch = "manufac", covariates = "AGE", df = adni[1:100, ], mdmr = FALSE, cores = 1)
  temp_dir &lt;- tempfile()
  dir.create(temp_dir)
  diag_save(temp_dir, result, quarto = FALSE)
  message("Diagnostics saved to: ", temp_dir)
  unlink(temp_dir, recursive = TRUE)  # Clean up the temporary directory
}

</code></pre>

<hr>
<h2 id='eb_check'>EB Assumption Check</h2><span id='topic+eb_check'></span>

<h3>Description</h3>

<p>Generate the empirical and prior distribution of both the location parameter <code>gamma</code> and the scale parameter <code>delta</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>eb_check(
  data,
  bat,
  covar = NULL,
  model = lm,
  formula = NULL,
  robust.LS = FALSE,
  ref.batch = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="eb_check_+3A_data">data</code></td>
<td>
<p><em>n x p</em> data frame or matrix of observations where
<em>p</em> is the number of features and <em>n</em> is the number of subjects.</p>
</td></tr>
<tr><td><code id="eb_check_+3A_bat">bat</code></td>
<td>
<p>Factor indicating batch (often equivalent to site or scanner).</p>
</td></tr>
<tr><td><code id="eb_check_+3A_covar">covar</code></td>
<td>
<p>Data frame or matrix of covariates supplied to <code>model</code>.</p>
</td></tr>
<tr><td><code id="eb_check_+3A_model">model</code></td>
<td>
<p>The model function that ComBat Family supports: <code>lm</code>, <code>lmer</code>, <code>gam</code>.</p>
</td></tr>
<tr><td><code id="eb_check_+3A_formula">formula</code></td>
<td>
<p>Formula for <code>model</code> starting with <code style="white-space: pre;">&#8288;y ~&#8288;</code> where <code>y</code> represents each feature.</p>
</td></tr>
<tr><td><code id="eb_check_+3A_robust.ls">robust.LS</code></td>
<td>
<p>If <code>TRUE</code>, uses robust location and scale estimators for error variance and site effect parameters. Currently uses median and
biweight midvariance.</p>
</td></tr>
<tr><td><code id="eb_check_+3A_ref.batch">ref.batch</code></td>
<td>
<p>Reference batch, must take value in <code>levels(bat)</code>.</p>
</td></tr>
<tr><td><code id="eb_check_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code>model</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>eb_check</code> returns a dataframe containing the empirical and prior distribution of both the location parameter (gamma) and the scale parameter (delta).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>eb_check(data = adni[1:500,43:53], bat = as.factor(adni$manufac[1:500]),
covar = adni[1:500, c("AGE", "SEX")], model = lm, formula = y ~ AGE + SEX)

</code></pre>

<hr>
<h2 id='form_gen'>ComBatFamily Model Formula Generations</h2><span id='topic+form_gen'></span>

<h3>Description</h3>

<p>Generate appropriate formula for ComBatFamily models
</p>


<h3>Usage</h3>

<pre><code class='language-R'>form_gen(x, c = NULL, i = NULL, random = NULL, smooth = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="form_gen_+3A_x">x</code></td>
<td>
<p>A model function name that is used or to be used in the ComBatFamily Package (eg: &quot;lmer&quot;, &quot;lm&quot;, &quot;gam&quot;).</p>
</td></tr>
<tr><td><code id="form_gen_+3A_c">c</code></td>
<td>
<p>Data frame or matrix of covariates supplied to <code>model</code>.</p>
</td></tr>
<tr><td><code id="form_gen_+3A_i">i</code></td>
<td>
<p>Expression of interaction terms supplied to <code>model</code>. (eg: &quot;age:diagnosis&quot;).</p>
</td></tr>
<tr><td><code id="form_gen_+3A_random">random</code></td>
<td>
<p>Variable name of a random effect in linear mixed effect model.</p>
</td></tr>
<tr><td><code id="form_gen_+3A_smooth">smooth</code></td>
<td>
<p>Variable name that requires a smooth function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A string of formula
</p>


<h3>Examples</h3>

<pre><code class='language-R'>covariates &lt;- adni[, c("AGE", "SEX")]
form_gen(x = "lm", c = covariates)

</code></pre>

<hr>
<h2 id='getQuantileRefactored'>Compute Quantile Functions for a Predictor in a GAMLSS Model</h2><span id='topic+getQuantileRefactored'></span>

<h3>Description</h3>

<p>This function computes quantile functions for a specified predictor in a GAMLSS model, allowing
the evaluation of response quantiles (e.g., 25th, 50th, 75th percentiles) as a function of the predictor.
It is a modified version of the <code>getQuantile</code> function from the <strong>GAMLSS</strong> package, with improvements to
explicitly require the dataset as an argument, avoiding reliance on global or external variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getQuantileRefactored(
  obj,
  term,
  quantile,
  data,
  n.points = 100,
  fixed.at = list()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="getQuantileRefactored_+3A_obj">obj</code></td>
<td>
<p>A fitted GAMLSS model object.</p>
</td></tr>
<tr><td><code id="getQuantileRefactored_+3A_term">term</code></td>
<td>
<p>A character string specifying the name of the predictor variable for which quantiles are computed.</p>
</td></tr>
<tr><td><code id="getQuantileRefactored_+3A_quantile">quantile</code></td>
<td>
<p>A numeric vector of probabilities (e.g., <code>c(0.25, 0.5, 0.75)</code>) at which to compute the quantiles.</p>
</td></tr>
<tr><td><code id="getQuantileRefactored_+3A_data">data</code></td>
<td>
<p>A data frame containing the dataset used in the model. This must include the predictor specified in <code>term</code>.</p>
</td></tr>
<tr><td><code id="getQuantileRefactored_+3A_n.points">n.points</code></td>
<td>
<p>An integer specifying the number of points at which to evaluate the quantile functions (default: 100).</p>
</td></tr>
<tr><td><code id="getQuantileRefactored_+3A_fixed.at">fixed.at</code></td>
<td>
<p>A named list specifying fixed values for other predictors in the dataset. If not provided,
categorical predictors are set to their most frequent levels, and numeric predictors to their median values.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function generates a temporary dataset by varying the specified predictor (<code>term</code>) over a sequence of
values while holding all other predictors constant (using values specified in <code>fixed.at</code>, or derived defaults).
It then computes the distribution parameters for the GAMLSS model and calculates the quantiles using the appropriate
quantile function for the distribution family.
</p>


<h3>Value</h3>

<p>A list of spline functions, one for each quantile specified in <code>quantile</code>. Each spline function can
be evaluated at specific predictor values to obtain the corresponding quantile.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if (requireNamespace("gamlss", quietly = TRUE)) {
  library(gamlss)
  sub_df &lt;- data.frame(
    age = seq(1, 20, length.out = 100),
    height = 50 + 2.5 * seq(1, 20, length.out = 100) + rnorm(100, 0, 5)
  )

  mdl &lt;- gamlss(height ~ pb(age), data = sub_df, family = NO())

  quantile_function &lt;- getQuantileRefactored(
    obj = mdl,
    term = "age",
    quantile = c(0.25, 0.5, 0.75),
    data = sub_df
  )
 }else{
 message("The 'gamlss' package is not installed. Please install it to run this example.")
 }
</code></pre>

<hr>
<h2 id='interaction_gen'>Interaction Term Generation</h2><span id='topic+interaction_gen'></span>

<h3>Description</h3>

<p>Generate appropriate interaction terms for regression models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>interaction_gen(
  type = "lm",
  covariates = NULL,
  smooth = NULL,
  interaction = NULL,
  smooth_int_type = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="interaction_gen_+3A_type">type</code></td>
<td>
<p>The type of model to be used for batch effect evaluation or harmonization (eg: &quot;lmer&quot;, &quot;lm&quot;, &quot;gam&quot;).</p>
</td></tr>
<tr><td><code id="interaction_gen_+3A_covariates">covariates</code></td>
<td>
<p>Name of covariates supplied to <code>model</code>.</p>
</td></tr>
<tr><td><code id="interaction_gen_+3A_smooth">smooth</code></td>
<td>
<p>Variable names that require a smooth function.</p>
</td></tr>
<tr><td><code id="interaction_gen_+3A_interaction">interaction</code></td>
<td>
<p>Expression of interaction terms supplied to <code>model</code> (eg: &quot;age,diagnosis&quot;).</p>
</td></tr>
<tr><td><code id="interaction_gen_+3A_smooth_int_type">smooth_int_type</code></td>
<td>
<p>A vector that indicates the types of interaction in <code>gam</code> models. By default, smooth_int_type is set to be NULL, &quot;linear&quot; represents linear interaction terms.
&quot;categorical-continuous&quot;, &quot;factor-smooth&quot; both represent categorical-continuous interactions (&quot;factor-smooth&quot; includes categorical variable as part of the smooth),
&quot;tensor&quot; represents interactions with different scales, and &quot;smooth-smooth&quot; represents interaction between smoothed variables.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>interaction_gen</code> returns a list containing the following components:
</p>
<table role = "presentation">
<tr><td><code>interaction</code></td>
<td>
<p>A vector of interaction terms to be included</p>
</td></tr>
<tr><td><code>covariates</code></td>
<td>
<p>Modified covariates after expressing interaction terms</p>
</td></tr>
<tr><td><code>smooth</code></td>
<td>
<p>Modified smooth terms after expressing interaction terms</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>interaction_gen(type = "lm", covariates = c("AGE", "SEX", "DIAGNOSIS"),
interaction = "AGE,DIAGNOSIS")

interaction_gen(type = "gam", covariates = c("AGE", "SEX", "DIAGNOSIS"),
smooth = "AGE", smooth_int_type = "linear", interaction = "AGE,DIAGNOSIS")

</code></pre>

<hr>
<h2 id='model_gen'>Model Generations</h2><span id='topic+model_gen'></span>

<h3>Description</h3>

<p>Generate appropriate regression models based on the model type and formula
</p>


<h3>Usage</h3>

<pre><code class='language-R'>model_gen(
  y,
  type = "lm",
  batch = NULL,
  covariates = NULL,
  interaction = NULL,
  random = NULL,
  smooth = NULL,
  df
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="model_gen_+3A_y">y</code></td>
<td>
<p>Dependent variable in the model.</p>
</td></tr>
<tr><td><code id="model_gen_+3A_type">type</code></td>
<td>
<p>A model function name that is used or to be used in the ComBatFamily Package (eg: &quot;lmer&quot;, &quot;lm&quot;, &quot;gam&quot;).</p>
</td></tr>
<tr><td><code id="model_gen_+3A_batch">batch</code></td>
<td>
<p>Name of batch variable (often equivalent to site or scanner).</p>
</td></tr>
<tr><td><code id="model_gen_+3A_covariates">covariates</code></td>
<td>
<p>Name of covariates supplied to <code>model</code>.</p>
</td></tr>
<tr><td><code id="model_gen_+3A_interaction">interaction</code></td>
<td>
<p>Expression of interaction terms supplied to <code>model</code> (eg: &quot;age:diagnosis&quot;).</p>
</td></tr>
<tr><td><code id="model_gen_+3A_random">random</code></td>
<td>
<p>Variable name of a random effect in linear mixed effect model.</p>
</td></tr>
<tr><td><code id="model_gen_+3A_smooth">smooth</code></td>
<td>
<p>Variable name that requires a smooth function.</p>
</td></tr>
<tr><td><code id="model_gen_+3A_df">df</code></td>
<td>
<p>Dataset to be harmonized.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A regression model object to be used for batch effect diagnostics and the post-harmonization stage.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>model_gen(y = "thickness.left.caudal.anterior.cingulate", type = "lm",
batch = "manufac", covariates = c("AGE", "SEX"), df = adni)

</code></pre>

<hr>
<h2 id='predict.comfam'>Apply Harmonization to New Data</h2><span id='topic+predict.comfam'></span>

<h3>Description</h3>

<p>Using parameters estimated via <code>comfam</code>, apply harmonization on new data.
<code>predict.comfam</code> will estimate new batch adjustments if new batches are
specified. For batches with existing estimates, the estimates from <code>object</code>
are used. Harmonization targets are the same as <code>object</code> (e.g. <code>ref.batch</code>
from <code>object</code> if specified).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'comfam'
predict(
  object,
  newdata,
  newbat,
  newcovar = NULL,
  robust.LS = FALSE,
  eb = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.comfam_+3A_object">object</code></td>
<td>
<p>Object of class <code>comfam</code>, typically output of the harmonization
function in this package.</p>
</td></tr>
<tr><td><code id="predict.comfam_+3A_newdata">newdata</code></td>
<td>
<p><em>n x p</em> data frame or matrix of new observations where
<em>p</em> is the number of features and <em>n</em> is the number of subjects.
The features must match the original <code>data</code> used in <code>object</code></p>
</td></tr>
<tr><td><code id="predict.comfam_+3A_newbat">newbat</code></td>
<td>
<p>Factor indicating new batch (often equivalent to site or scanner)</p>
</td></tr>
<tr><td><code id="predict.comfam_+3A_newcovar">newcovar</code></td>
<td>
<p>Data frame or matrix of new covariates supplied to <code>model</code>.
Must contain all variables specified in the original <code>formula</code> used in
<code>object</code>.</p>
</td></tr>
<tr><td><code id="predict.comfam_+3A_robust.ls">robust.LS</code></td>
<td>
<p>If <code>TRUE</code>, uses robust location and scale estimators
for new batch effect estimates Currently uses median and biweight
midvariance</p>
</td></tr>
<tr><td><code id="predict.comfam_+3A_eb">eb</code></td>
<td>
<p>If <code>TRUE</code>, uses ComBat model with empirical Bayes for new batches</p>
</td></tr>
<tr><td><code id="predict.comfam_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code>predict</code> for the class of <code>model</code> (e.g.
<code>predict.lm</code> for ComBat)</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Note:</strong> The function currently does not support models of class <code>lmer</code>
(e.g., from <a href="lme4.html#topic+lmer">lmer</a>).
</p>


<h3>Value</h3>

<p><code>predict.comfam</code> returns a list containing the following components:
</p>
<table role = "presentation">
<tr><td><code>dat.combat</code></td>
<td>
<p>New harmonized data as a matrix with same dimensions as <code>newdata</code></p>
</td></tr>
<tr><td><code>batch.info</code></td>
<td>
<p>New batch information, including reference batch if specified</p>
</td></tr>
<tr><td><code>fits</code></td>
<td>
<p>List of model fits from regression step, forwarded from <code>object</code></p>
</td></tr>
<tr><td><code>estimates</code></td>
<td>
<p>List of estimates from standardization and batch effect correction, including new batches if relevant</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>com_out &lt;- comfam(iris[1:75,1:2], iris$Species[1:75])

# out-of-sample with new batch
out_pred &lt;- predict(com_out, iris[76:150,1:2], iris$Species[76:150])

# in-sample
in_pred &lt;- predict(com_out, iris[1:25,1:2], iris$Species[1:25])
max(in_pred$dat.combat - com_out$dat.combat[1:25,])
</code></pre>

<hr>
<h2 id='residual_gen'>Post Harmonization Residual Generation</h2><span id='topic+residual_gen'></span>

<h3>Description</h3>

<p>Extract residuals after harmonization.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>residual_gen(
  type = "lm",
  features = NULL,
  covariates = NULL,
  interaction = NULL,
  random = NULL,
  smooth = NULL,
  smooth_int_type = NULL,
  df,
  rm = NULL,
  model = FALSE,
  model_path = NULL,
  cores = detectCores()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="residual_gen_+3A_type">type</code></td>
<td>
<p>A model function name that is to be used (eg: <code>"lmer"</code>, <code>"lm"</code>, <code>"gam"</code>).</p>
</td></tr>
<tr><td><code id="residual_gen_+3A_features">features</code></td>
<td>
<p>The names of the features from which to extract residuals.</p>
</td></tr>
<tr><td><code id="residual_gen_+3A_covariates">covariates</code></td>
<td>
<p>Name of covariates supplied to <code>model</code>.</p>
</td></tr>
<tr><td><code id="residual_gen_+3A_interaction">interaction</code></td>
<td>
<p>Expression of interaction terms supplied to <code>model</code> (eg: <code>"age,diagnosis"</code>).</p>
</td></tr>
<tr><td><code id="residual_gen_+3A_random">random</code></td>
<td>
<p>Variable name of a random effect in linear mixed effect model.</p>
</td></tr>
<tr><td><code id="residual_gen_+3A_smooth">smooth</code></td>
<td>
<p>Variable name that requires a smooth function.</p>
</td></tr>
<tr><td><code id="residual_gen_+3A_smooth_int_type">smooth_int_type</code></td>
<td>
<p>Indicates the type of interaction in <code>gam</code> models. By default, <code>smooth_int_type</code> is set to be <code>"linear"</code>, representing linear interaction terms.
<code>"categorical-continuous"</code>, <code>"factor-smooth"</code> both represent categorical-continuous interactions (<code>"factor-smooth"</code> includes categorical variable as part of the smooth),
<code>"tensor"</code> represents interactions with different scales, and <code>"smooth-smooth"</code> represents interaction between smoothed variables.</p>
</td></tr>
<tr><td><code id="residual_gen_+3A_df">df</code></td>
<td>
<p>Harmonized dataset to extract residuals from.</p>
</td></tr>
<tr><td><code id="residual_gen_+3A_rm">rm</code></td>
<td>
<p>variables to remove effects from.</p>
</td></tr>
<tr><td><code id="residual_gen_+3A_model">model</code></td>
<td>
<p>A boolean variable indicating whether an existing model is to be used.</p>
</td></tr>
<tr><td><code id="residual_gen_+3A_model_path">model_path</code></td>
<td>
<p>path to the existing model.</p>
</td></tr>
<tr><td><code id="residual_gen_+3A_cores">cores</code></td>
<td>
<p>number of cores used for parallel computing.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>residual_gen</code> returns a list containing the following components:
</p>
<table role = "presentation">
<tr><td><code>model</code></td>
<td>
<p>a list of regression models for all rois</p>
</td></tr>
<tr><td><code>residual</code></td>
<td>
<p>Residual dataframe</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>features &lt;- colnames(adni)[43:53]
residual_gen(type = "lm", features = features,
covariates = c("AGE", "SEX", "DIAGNOSIS"), df = adni, rm = c("AGE", "SEX"), cores = 1)
</code></pre>

<hr>
<h2 id='visual_prep'>Batch Effect Diagnostic Visualization Preparation</h2><span id='topic+visual_prep'></span>

<h3>Description</h3>

<p>Prepare relevant datasets and statistical test results for batch/site effect diagnostic visualization.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>visual_prep(
  type = "lm",
  features,
  batch,
  covariates = NULL,
  interaction = NULL,
  random = NULL,
  smooth = NULL,
  smooth_int_type = NULL,
  df,
  cores = detectCores(),
  mdmr = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="visual_prep_+3A_type">type</code></td>
<td>
<p>The name of a regression model to be used in batch effect diagnostics stage: <code>"lmer"</code>, <code>"lm"</code>, <code>"gam"</code>.</p>
</td></tr>
<tr><td><code id="visual_prep_+3A_features">features</code></td>
<td>
<p>The name of the features to be evaluated.</p>
</td></tr>
<tr><td><code id="visual_prep_+3A_batch">batch</code></td>
<td>
<p>The name of the batch variable.</p>
</td></tr>
<tr><td><code id="visual_prep_+3A_covariates">covariates</code></td>
<td>
<p>Name of covariates supplied to <code>model</code>.</p>
</td></tr>
<tr><td><code id="visual_prep_+3A_interaction">interaction</code></td>
<td>
<p>Expression of interaction terms supplied to <code>model</code> (eg: <code>"age,diagnosis"</code>).</p>
</td></tr>
<tr><td><code id="visual_prep_+3A_random">random</code></td>
<td>
<p>Variable name of a random effect in linear mixed effect model.</p>
</td></tr>
<tr><td><code id="visual_prep_+3A_smooth">smooth</code></td>
<td>
<p>Variable name that requires a smooth function.</p>
</td></tr>
<tr><td><code id="visual_prep_+3A_smooth_int_type">smooth_int_type</code></td>
<td>
<p>Indicates the type of interaction in <code>gam</code> models. By default, <code>smooth_int_type</code> is set to be <code>"linear"</code>, representing linear interaction terms.
<code>"categorical-continuous"</code>, <code>"factor-smooth"</code> both represent categorical-continuous interactions (<code>"factor-smooth"</code> includes categorical variable as part of the smooth),
<code>"tensor"</code> represents interactions with different scales, and <code>"smooth-smooth"</code> represents interaction between smoothed variables.</p>
</td></tr>
<tr><td><code id="visual_prep_+3A_df">df</code></td>
<td>
<p>Dataset to be evaluated.</p>
</td></tr>
<tr><td><code id="visual_prep_+3A_cores">cores</code></td>
<td>
<p>number of cores used for parallel computing.</p>
</td></tr>
<tr><td><code id="visual_prep_+3A_mdmr">mdmr</code></td>
<td>
<p>A boolean variable indicating whether to run the MDMR test (default: <code>TRUE</code>).</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>visual_prep</code> returns a list containing the following components:
</p>
<table role = "presentation">
<tr><td><code>residual_add_df</code></td>
<td>
<p>Residuals that might contain additive and multiplicative joint batch effects</p>
</td></tr>
<tr><td><code>residual_ml_df</code></td>
<td>
<p>Residuals that might contain multiplicative batch effect</p>
</td></tr>
<tr><td><code>pr.feature</code></td>
<td>
<p>PCA results</p>
</td></tr>
<tr><td><code>pca_summary</code></td>
<td>
<p>A dataframe containing the variance explained by Principal Components (PCs)</p>
</td></tr>
<tr><td><code>pca_df</code></td>
<td>
<p>A dataframe contains features in the form of PCs</p>
</td></tr>
<tr><td><code>tsne_df</code></td>
<td>
<p>A dataframe prepared for T-SNE plots</p>
</td></tr>
<tr><td><code>kr_test_df</code></td>
<td>
<p>A dataframe contains Kenward-Roger(KR) test results</p>
</td></tr>
<tr><td><code>fk_test_df</code></td>
<td>
<p>A dataframe contains Fligner-Killeen(FK) test results</p>
</td></tr>
<tr><td><code>mdmr.summary</code></td>
<td>
<p>A dataframe contains MDMR results</p>
</td></tr>
<tr><td><code>anova_test_df</code></td>
<td>
<p>A dataframe contains ANOVA test results</p>
</td></tr>
<tr><td><code>kw_test_df</code></td>
<td>
<p>A dataframe contains Kruskal-Wallis test results</p>
</td></tr>
<tr><td><code>lv_test_df</code></td>
<td>
<p>A dataframe contains Levene's test results</p>
</td></tr>
<tr><td><code>bl_test_df</code></td>
<td>
<p>A dataframe contains Bartlett's test results</p>
</td></tr>
<tr><td><code>red</code></td>
<td>
<p>A parameter to highlight significant p-values in result table</p>
</td></tr>
<tr><td><code>info</code></td>
<td>
<p>A list contains input information like batch, covariates, df etc</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>visual_prep(type = "lm", features = colnames(adni)[43:53], batch = "manufac",
covariates = c("AGE", "SEX", "DIAGNOSIS"), df = head(adni, 500), cores = 1)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
