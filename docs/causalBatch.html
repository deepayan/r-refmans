<!DOCTYPE html><html lang="en"><head><title>Help for package causalBatch</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {causalBatch}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#cb.align.kway_match'><p>K-Way matching</p></a></li>
<li><a href='#cb.align.vm_trim'><p>Vector Matching</p></a></li>
<li><a href='#cb.correct.aipw_cComBat'><p>Augmented Inverse Probability Weighting Conditional ComBat</p></a></li>
<li><a href='#cb.correct.apply_aipw_cComBat'><p>Fit AIPW ComBat model for batch effect correction</p></a></li>
<li><a href='#cb.correct.apply_cComBat'><p>Adjust for batch effects using an empirical Bayes framework</p></a></li>
<li><a href='#cb.correct.matching_cComBat'><p>Matching Conditional ComBat</p></a></li>
<li><a href='#cb.detect.caus_cdcorr'><p>Causal Conditional Distance Correlation</p></a></li>
<li><a href='#cb.sims.sim_impulse'><p>Impulse Simulation</p></a></li>
<li><a href='#cb.sims.sim_impulse_asycov'><p>Impulse Simulation with Asymmetric Covariates</p></a></li>
<li><a href='#cb.sims.sim_linear'><p>Linear Simulation</p></a></li>
<li><a href='#cb.sims.sim_sigmoid'><p>Sigmoidal Simulation</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Causal Batch Effects</td>
</tr>
<tr>
<td>Version:</td>
<td>1.3.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2025-01-07</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Eric W. Bridgeford &lt;ericwb95@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Software which provides numerous functionalities for detecting and removing group-level effects from high-dimensional scientific data which, when combined with additional assumptions, allow for causal conclusions, as-described in our manuscripts Bridgeford et al. (2024) &lt;<a href="https://doi.org/10.1101%2F2021.09.03.458920">doi:10.1101/2021.09.03.458920</a>&gt; and Bridgeford et al. (2023) &lt;<a href="https://doi.org/10.48550%2FarXiv.2307.13868">doi:10.48550/arXiv.2307.13868</a>&gt;. Also provides a number of useful utilities for generating simulations and balancing covariates across multiple groups/batches of data via matching and propensity trimming for more than two groups.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.2.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>cdcsis, sva, MatchIt, nnet, dplyr, magrittr, genefilter,
BiocParallel, utils</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/neurodata/causal_batch">https://github.com/neurodata/causal_batch</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>tidyr, ggpubr, knitr, rmarkdown, parallel, testthat (&ge;
3.0.0), covr, roxygen2, ks, ggplot2</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.0</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-07 12:22:47 UTC; eric</td>
</tr>
<tr>
<td>Author:</td>
<td>Eric W. Bridgeford [aut, cre],
  Michael Powell [ctb],
  Brian Caffo [ctb],
  Joshua T. Vogelstein [ctb]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-07 12:50:07 UTC</td>
</tr>
</table>
<hr>
<h2 id='cb.align.kway_match'>K-Way matching</h2><span id='topic+cb.align.kway_match'></span>

<h3>Description</h3>

<p>A function for performing k-way matching using the matchIt package. Looks for samples which have corresponding matches across all other treatment levels.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cb.align.kway_match(
  Ts,
  Xs,
  match.form,
  reference = NULL,
  match.args = list(method = "nearest", exact = NULL, replace = FALSE, caliper = 0.1),
  retain.ratio = 0.05
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cb.align.kway_match_+3A_ts">Ts</code></td>
<td>
<p><code>[n]</code> the labels of the samples, with <code>K &lt; n</code> levels, as a factor variable.</p>
</td></tr>
<tr><td><code id="cb.align.kway_match_+3A_xs">Xs</code></td>
<td>
<p><code>[n, r]</code> the <code>r</code> covariates/confounding variables, for each of the <code>n</code> samples, as a data frame with named columns.</p>
</td></tr>
<tr><td><code id="cb.align.kway_match_+3A_match.form">match.form</code></td>
<td>
<p>A formula of columns from <code>Xs</code>, to be passed directly to <code><a href="MatchIt.html#topic+matchit">matchit</a></code> for subsequent matching. See <code>formula</code> argument from <code><a href="MatchIt.html#topic+matchit">matchit</a></code> for details.</p>
</td></tr>
<tr><td><code id="cb.align.kway_match_+3A_reference">reference</code></td>
<td>
<p>the name of the reference/control batch, against which to match. Defaults to <code>NULL</code>, which treats the reference batch as the smallest batch.</p>
</td></tr>
<tr><td><code id="cb.align.kway_match_+3A_match.args">match.args</code></td>
<td>
<p>A named list arguments for the <code><a href="MatchIt.html#topic+matchit">matchit</a></code> function, to be used to specify specific matching strategies, where the list names are arguments and the corresponding values the value to be passed to <code>matchit</code>. Defaults to inexact nearest-neighbor caliper (width 0.1) matching without replacement.</p>
</td></tr>
<tr><td><code id="cb.align.kway_match_+3A_retain.ratio">retain.ratio</code></td>
<td>
<p>If the number of samples retained is less than <code>retain.ratio*n</code>, throws a warning. Defaults to <code>0.05</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list, containing the following:
</p>

<ul>
<li><p><code>Retained.Ids</code> <code>[m]</code> vector consisting of the sample ids of the <code>n</code> original samples that were retained after matching.
</p>
</li>
<li><p><code>Reference</code> the reference batch.
</p>
</li></ul>



<h3>Details</h3>

<p>For more details see the help vignette:
<code>vignette("causal_balancing", package = "causalBatch")</code>
</p>


<h3>Author(s)</h3>

<p>Eric W. Bridgeford
</p>


<h3>References</h3>

<p>Eric W. Bridgeford, et al. &quot;A Causal Perspective for Batch Effects: When is no answer better than a wrong answer?&quot; Biorxiv (2024).
</p>
<p>Daniel E. Ho, et al. &quot;MatchIt: Nonparametric Preprocessing for Parametric Causal Inference&quot; JSS (2011).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(causalBatch)
sim &lt;- cb.sims.sim_linear(a=-1, n=100, err=1/8, unbalancedness=1.5)
cb.align.kway_match(sim$Ts, data.frame(Covar=sim$Xs), "Covar")
</code></pre>

<hr>
<h2 id='cb.align.vm_trim'>Vector Matching</h2><span id='topic+cb.align.vm_trim'></span>

<h3>Description</h3>

<p>A function for implementing the vector matching procedure, a pre-processing step for
causal conditional distance correlation. Uses propensity scores to strategically include/exclude
samples from subsequent inference, based on whether (or not) there are samples with similar propensity scores
across all treatment levels (conceptually, a k-way &quot;propensity trimming&quot;). 
It is imperative that this function is used in conjunction with domain expertise to ensure that the covariates are not colliders, 
and that the system satisfies the strong ignorability condiiton to derive causal conclusions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cb.align.vm_trim(
  Ts,
  Xs,
  prop.form = NULL,
  retain.ratio = 0.05,
  ddx = FALSE,
  reference = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cb.align.vm_trim_+3A_ts">Ts</code></td>
<td>
<p><code>[n]</code> the labels of the samples, with <code>K &lt; n</code> levels, as a factor variable.</p>
</td></tr>
<tr><td><code id="cb.align.vm_trim_+3A_xs">Xs</code></td>
<td>
<p><code>[n, r]</code> the <code>r</code> covariates/confounding variables, for each of the <code>n</code> samples.</p>
</td></tr>
<tr><td><code id="cb.align.vm_trim_+3A_prop.form">prop.form</code></td>
<td>
<p>a formula specifying a propensity scoring model. Defaults o <code>NULL</code>, which uses all of the covariates as exposure predictors.</p>
</td></tr>
<tr><td><code id="cb.align.vm_trim_+3A_retain.ratio">retain.ratio</code></td>
<td>
<p>If the number of samples retained is less than <code>retain.ratio*n</code>, throws a warning. Defaults to <code>0.05</code>.</p>
</td></tr>
<tr><td><code id="cb.align.vm_trim_+3A_ddx">ddx</code></td>
<td>
<p>whether to show additional diagnosis messages. Defaults to <code>FALSE</code>. Can help with debugging if unexpected results are obtained.</p>
</td></tr>
<tr><td><code id="cb.align.vm_trim_+3A_reference">reference</code></td>
<td>
<p>the name of a reference label, against which to align other labels. Defaults to <code>NULL</code>, which identifies a shared region of covariate overlap across all labels..</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>[m]</code> vector containing the indices of samples retained after vector matching.
</p>


<h3>Details</h3>

<p>For more details see the help vignette:
<code>vignette("causal_balancing", package = "causalBatch")</code>
</p>


<h3>Author(s)</h3>

<p>Eric W. Bridgeford
</p>


<h3>References</h3>

<p>Michael J. Lopez, et al. &quot;Estimation of Causal Effects with Multiple Treatments&quot; Statistical Science (2017). 
ran
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(causalBatch)
sim &lt;- cb.sims.sim_linear(a=-1, n=100, err=1/8, unbalancedness=3)
cb.align.vm_trim(sim$Ts, sim$Xs)

</code></pre>

<hr>
<h2 id='cb.correct.aipw_cComBat'>Augmented Inverse Probability Weighting Conditional ComBat</h2><span id='topic+cb.correct.aipw_cComBat'></span>

<h3>Description</h3>

<p>A function for implementing the AIPW conditional ComBat (AIPW cComBat) algorithm.
This algorithm allows users to remove batch effects (in each dimension), while adjusting for known confounding
variables. It is imperative that this function is used in conjunction with domain
expertise (e.g., to ensure that the covariates are not colliders, and that the system could be argued to satisfy the
ignorability condition) to derive causal conclusions. See citation for more details as to the conditions
under which conclusions derived are causal.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cb.correct.aipw_cComBat(
  Ys,
  Ts,
  Xs,
  aipw.form,
  covar.out.form = NULL,
  retain.ratio = 0.05
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cb.correct.aipw_cComBat_+3A_ys">Ys</code></td>
<td>
<p>an <code>[n, d]</code> matrix, for the outcome variables with <code>n</code> samples in <code>d</code> dimensions.</p>
</td></tr>
<tr><td><code id="cb.correct.aipw_cComBat_+3A_ts">Ts</code></td>
<td>
<p><code>[n]</code> the labels of the samples, with at most two unique batches.</p>
</td></tr>
<tr><td><code id="cb.correct.aipw_cComBat_+3A_xs">Xs</code></td>
<td>
<p><code>[n, r]</code> the <code>r</code> covariates/confounding variables, for each of the <code>n</code> samples, as a data frame with named columns.</p>
</td></tr>
<tr><td><code id="cb.correct.aipw_cComBat_+3A_aipw.form">aipw.form</code></td>
<td>
<p>A covariate model, given as a formula. Applies for the estimation of propensities for the AIPW step.</p>
</td></tr>
<tr><td><code id="cb.correct.aipw_cComBat_+3A_covar.out.form">covar.out.form</code></td>
<td>
<p>A covariate model, given as a formula. Applies for the outcome regression step of the <code>ComBat</code> algorithm. Defaults to <code>NULL</code>, which re-uses <code>aipw.form</code> for the covariate/outcome model.</p>
</td></tr>
<tr><td><code id="cb.correct.aipw_cComBat_+3A_retain.ratio">retain.ratio</code></td>
<td>
<p>If the number of samples retained is less than <code>retain.ratio*n</code>, throws a warning. Defaults to <code>0.05</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note: This function is experimental, and has not been tested on real data. It has only been tested with simulated data with binary (0 or 1) exposures.
</p>


<h3>Value</h3>

<p>a list, containing the following:
</p>

<ul>
<li><p><code>Ys.corrected</code> an <code>[m, d]</code> matrix, for the <code>m</code> retained samples in <code>d</code> dimensions, after correction.
</p>
</li>
<li><p><code>Ts</code> <code>[m]</code> the labels of the <code>m</code> retained samples, with <code>K &lt; n</code> levels.
</p>
</li>
<li><p><code>Xs</code> the <code>r</code> covariates/confounding variables for each of the <code>m</code> retained samples.
</p>
</li>
<li><p><code>Model</code> the fit batch effect correction model.
</p>
</li>
<li><p><code>Corrected.Ids</code> the ids to which batch effect correction was applied.
</p>
</li></ul>



<h3>Details</h3>

<p>For more details see the help vignette:
<code>vignette("causal_ccombat", package = "causalBatch")</code>
</p>


<h3>Author(s)</h3>

<p>Eric W. Bridgeford
</p>


<h3>References</h3>

<p>Eric W. Bridgeford, et al. &quot;A Causal Perspective for Batch Effects: When is no answer better than a wrong answer?&quot; Biorxiv (2024).
</p>
<p>W Evan Johnson, et al. &quot;Adjusting batch effects in microarray expression data using empirical Bayes methods&quot; Biostatistics (2007).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(causalBatch)
sim &lt;- cb.sims.sim_linear(a=-1, n=100, err=1/8, unbalancedness=2)
cb.correct.aipw_cComBat(sim$Ys, sim$Ts, data.frame(Covar=sim$Xs), "Covar")

</code></pre>

<hr>
<h2 id='cb.correct.apply_aipw_cComBat'>Fit AIPW ComBat model for batch effect correction</h2><span id='topic+cb.correct.apply_aipw_cComBat'></span>

<h3>Description</h3>

<p>This function applies an Augmented Inverse Probability Weighting (AIPW) ComBat model 
for batch effect correction to new data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cb.correct.apply_aipw_cComBat(Ys, Ts, Xs, Model)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cb.correct.apply_aipw_cComBat_+3A_ys">Ys</code></td>
<td>
<p>an <code>[n, d]</code> matrix, for the outcome variables with <code>n</code> samples in <code>d</code> dimensions.</p>
</td></tr>
<tr><td><code id="cb.correct.apply_aipw_cComBat_+3A_ts">Ts</code></td>
<td>
<p><code>[n]</code> the labels of the samples, with <code>K &lt; n</code> levels, as a factor variable.</p>
</td></tr>
<tr><td><code id="cb.correct.apply_aipw_cComBat_+3A_xs">Xs</code></td>
<td>
<p><code>[n, r]</code> the <code>r</code> covariates/confounding variables, for each of the <code>n</code> samples, as a data frame with named columns.</p>
</td></tr>
<tr><td><code id="cb.correct.apply_aipw_cComBat_+3A_model">Model</code></td>
<td>
<p>a list containing the following parameters:
</p>

<ul>
<li><p><code>Prop_model</code> Fitted propensity model
</p>
</li>
<li><p><code>Putcome_models</code> List of fitted outcome models for each feature and treatment level
</p>
</li>
<li><p><code>Levels</code> Levels of the treatment factor
</p>
</li>
<li><p><code>Treatment_effects</code> Estimated treatment effects
</p>
</li>
<li><p><code>AIPW_est</code> AIPW estimator results
</p>
</li>
<li><p><code>covar.out.form</code> Formula used for the outcome model
</p>
</li></ul>

<p>This model is output after fitting with <code><a href="#topic+cb.correct.aipw_cComBat">cb.correct.aipw_cComBat</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note: This function is experimental, and has not been tested on real data. It has only been tested with simulated data with binary (0 or 1) exposures.
</p>


<h3>Value</h3>

<p>an <code>[n, d]</code> matrix, the batch-effect corrected data.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(causalBatch)
sim &lt;- cb.sims.sim_linear(a=-1, n=200, err=1/8, unbalancedness=3)
# fit batch effect correction for first 100 samples
cb.fit &lt;- cb.correct.matching_cComBat(sim$Ys[1:100,,drop=FALSE], sim$Ts[1:100], 
                                  data.frame(Covar=sim$Xs[1:100,,drop=FALSE]), "Covar")
# apply to all samples
cor.dat &lt;- cb.correct.apply_cComBat(sim$Ys, sim$Ts, data.frame(Covar=sim$Xs), cb.fit$Model)

</code></pre>

<hr>
<h2 id='cb.correct.apply_cComBat'>Adjust for batch effects using an empirical Bayes framework</h2><span id='topic+cb.correct.apply_cComBat'></span>

<h3>Description</h3>

<p>ComBat allows users to adjust for batch effects in datasets where the batch covariate is known, using methodology
described in Johnson et al. 2007. It uses either parametric or non-parametric empirical Bayes frameworks for adjusting data for
batch effects.  Users are returned an expression matrix that has been corrected for batch effects. The input
data are assumed to be cleaned and normalized before batch effect removal.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cb.correct.apply_cComBat(Ys, Ts, Xs, Model)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cb.correct.apply_cComBat_+3A_ys">Ys</code></td>
<td>
<p>an <code>[n, d]</code> matrix, for the outcome variables with <code>n</code> samples in <code>d</code> dimensions.</p>
</td></tr>
<tr><td><code id="cb.correct.apply_cComBat_+3A_ts">Ts</code></td>
<td>
<p><code>[n]</code> the labels of the samples, with <code>K &lt; n</code> levels, as a factor variable.</p>
</td></tr>
<tr><td><code id="cb.correct.apply_cComBat_+3A_xs">Xs</code></td>
<td>
<p><code>[n, r]</code> the <code>r</code> covariates/confounding variables, for each of the <code>n</code> samples, as a data frame with named columns.</p>
</td></tr>
<tr><td><code id="cb.correct.apply_cComBat_+3A_model">Model</code></td>
<td>
<p>a list containing the following parameters:
</p>

<ul>
<li><p><code>Var</code> the pooled variance
</p>
</li>
<li><p><code>Grand.mean</code> the overall mean of the data
</p>
</li>
<li><p><code>B.hat</code> the fit regression coefficients
</p>
</li>
<li><p><code>Gamma</code> additive batch effects
</p>
</li>
<li><p><code>Delta</code> multiplicative batch effects
</p>
</li>
<li><p><code>Levels</code> the order of levels for each batch
</p>
</li>
<li><p><code>Covar.Mod</code> the covariate model for adjustment
</p>
</li></ul>

<p>This model is output after fitting with <code><a href="#topic+cb.correct.matching_cComBat">cb.correct.matching_cComBat</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note: this code is adapted directly from the <code><a href="sva.html#topic+ComBat">ComBat</a></code> algorithm featured in the 'sva' package.
</p>


<h3>Value</h3>

<p>an <code>[n, d]</code> matrix, the batch-effect corrected data.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(causalBatch)
sim &lt;- cb.sims.sim_linear(a=-1, n=200, err=1/8, unbalancedness=3)
# fit batch effect correction for first 100 samples
cb.fit &lt;- cb.correct.matching_cComBat(sim$Ys[1:100,,drop=FALSE], sim$Ts[1:100], 
                                  data.frame(Covar=sim$Xs[1:100,,drop=FALSE]), "Covar")
# apply to all samples
cor.dat &lt;- cb.correct.apply_cComBat(sim$Ys, sim$Ts, data.frame(Covar=sim$Xs), cb.fit$Model)

</code></pre>

<hr>
<h2 id='cb.correct.matching_cComBat'>Matching Conditional ComBat</h2><span id='topic+cb.correct.matching_cComBat'></span>

<h3>Description</h3>

<p>A function for implementing the matching conditional ComBat (matching cComBat) algorithm.
This algorithm allows users to remove batch effects (in each dimension), while adjusting for known confounding
variables. It is imperative that this function is used in conjunction with domain
expertise (e.g., to ensure that the covariates are not colliders, and that the system could be argued to satisfy the
ignorability condition) to derive causal conclusions. See citation for more details as to the conditions
under which conclusions derived are causal.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cb.correct.matching_cComBat(
  Ys,
  Ts,
  Xs,
  match.form,
  covar.out.form = NULL,
  prop.form = NULL,
  reference = NULL,
  match.args = list(method = "nearest", exact = NULL, replace = FALSE, caliper = 0.1),
  retain.ratio = 0.05,
  apply.oos = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cb.correct.matching_cComBat_+3A_ys">Ys</code></td>
<td>
<p>an <code>[n, d]</code> matrix, for the outcome variables with <code>n</code> samples in <code>d</code> dimensions.</p>
</td></tr>
<tr><td><code id="cb.correct.matching_cComBat_+3A_ts">Ts</code></td>
<td>
<p><code>[n]</code> the labels of the samples, with <code>K &lt; n</code> levels, as a factor variable.</p>
</td></tr>
<tr><td><code id="cb.correct.matching_cComBat_+3A_xs">Xs</code></td>
<td>
<p><code>[n, r]</code> the <code>r</code> covariates/confounding variables, for each of the <code>n</code> samples, as a data frame with named columns.</p>
</td></tr>
<tr><td><code id="cb.correct.matching_cComBat_+3A_match.form">match.form</code></td>
<td>
<p>A formula of columns from <code>Xs</code>, to be passed directly to <code><a href="MatchIt.html#topic+matchit">matchit</a></code> for subsequent matching. See <code>formula</code> argument from <code><a href="MatchIt.html#topic+matchit">matchit</a></code> for details.</p>
</td></tr>
<tr><td><code id="cb.correct.matching_cComBat_+3A_covar.out.form">covar.out.form</code></td>
<td>
<p>A covariate model, given as a formula. Applies for the outcome regression step of the <code>ComBat</code> algorithm. Defaults to <code>NULL</code>, which re-uses <code>match.form</code> for the covariate/outcome model.</p>
</td></tr>
<tr><td><code id="cb.correct.matching_cComBat_+3A_prop.form">prop.form</code></td>
<td>
<p>A propensity model, given as a formula. Applies for the estimation of propensities for the propensity trimming step. Defaults to <code>NULL</code>, which re-uses <code>match.form</code> for the covariate/outcome model.</p>
</td></tr>
<tr><td><code id="cb.correct.matching_cComBat_+3A_reference">reference</code></td>
<td>
<p>the name of the reference/control batch, against which to match. Defaults to <code>NULL</code>, which treats the reference batch as the smallest batch.</p>
</td></tr>
<tr><td><code id="cb.correct.matching_cComBat_+3A_match.args">match.args</code></td>
<td>
<p>A named list arguments for the <code><a href="MatchIt.html#topic+matchit">matchit</a></code> function, to be used to specify specific matching strategies, where the list names are arguments and the corresponding values the value to be passed to <code>matchit</code>. Defaults to inexact nearest-neighbor caliper (width 0.1) matching without replacement.</p>
</td></tr>
<tr><td><code id="cb.correct.matching_cComBat_+3A_retain.ratio">retain.ratio</code></td>
<td>
<p>If the number of samples retained is less than <code>retain.ratio*n</code>, throws a warning. Defaults to <code>0.05</code>.</p>
</td></tr>
<tr><td><code id="cb.correct.matching_cComBat_+3A_apply.oos">apply.oos</code></td>
<td>
<p>A boolean that indicates whether or not to apply the learned batch effect correction to non-matched samples that are still within a region of covariate support. Defaults to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list, containing the following:
</p>

<ul>
<li><p><code>Ys.corrected</code> an <code>[m, d]</code> matrix, for the <code>m</code> retained samples in <code>d</code> dimensions, after correction.
</p>
</li>
<li><p><code>Ts</code> <code>[m]</code> the labels of the <code>m</code> retained samples, with <code>K &lt; n</code> levels.
</p>
</li>
<li><p><code>Xs</code> the <code>r</code> covariates/confounding variables for each of the <code>m</code> retained samples.
</p>
</li>
<li><p><code>Model</code> the fit batch effect correction model. See <code><a href="sva.html#topic+ComBat">ComBat</a></code> for details.
</p>
</li>
<li><p><code>InSample.Ids</code> the ids which were used to fit the batch effect correction model.
</p>
</li>
<li><p><code>Corrected.Ids</code> the ids to which batch effect correction was applied. Differs from <code>InSample.Ids</code> if <code>apply.oos</code> is <code>TRUE</code>.
</p>
</li></ul>



<h3>Details</h3>

<p>For more details see the help vignette:
<code>vignette("causal_ccombat", package = "causalBatch")</code>
</p>


<h3>Author(s)</h3>

<p>Eric W. Bridgeford
</p>


<h3>References</h3>

<p>Eric W. Bridgeford, et al. &quot;A Causal Perspective for Batch Effects: When is no answer better than a wrong answer?&quot; Biorxiv (2024).
</p>
<p>Daniel E. Ho, et al. &quot;MatchIt: Nonparametric Preprocessing for Parametric Causal Inference&quot; JSS (2011).
</p>
<p>W Evan Johnson, et al. &quot;Adjusting batch effects in microarray expression data using empirical Bayes methods&quot; Biostatistics (2007).
</p>
<p>Leek JT, Johnson WE, Parker HS, Fertig EJ, Jaffe AE, Zhang Y, Storey JD, Torres LC (2024). sva: Surrogate Variable Analysis. R package version 3.52.0.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(causalBatch)
sim &lt;- cb.sims.sim_linear(a=-1, n=100, err=1/8, unbalancedness=2)
cb.correct.matching_cComBat(sim$Ys, sim$Ts, data.frame(Covar=sim$Xs), "Covar")

</code></pre>

<hr>
<h2 id='cb.detect.caus_cdcorr'>Causal Conditional Distance Correlation</h2><span id='topic+cb.detect.caus_cdcorr'></span>

<h3>Description</h3>

<p>A function for implementing the causal conditional distance correlation (causal cDCorr) algorithm.
This algorithm allows users to identify whether a treatment causes changes in an outcome, given assorted
covariates/confounding variables. It is imperative that this function is used in conjunction with domain
expertise (e.g., to ensure that the covariates are not colliders, and that the system satisfies the strong
ignorability condiiton) to derive causal conclusions. See citation for more details as to the conditions
under which conclusions derived are causal.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cb.detect.caus_cdcorr(
  Ys,
  Ts,
  Xs,
  prop.form = NULL,
  R = 1000,
  dist.method = "euclidean",
  distance = FALSE,
  seed = 1,
  num.threads = 1,
  retain.ratio = 0.05,
  ddx = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cb.detect.caus_cdcorr_+3A_ys">Ys</code></td>
<td>
<p>Either:
</p>

<ul>
<li><p><code>[n, d]</code> matrix the outcome variables with <code>n</code> samples in <code>d</code> dimensions. In this case, <code>distance</code> should be <code>FALSE</code>.
</p>
</li>
<li><p><code>[n, n]</code> <code>dist</code> object a distance object for the <code>n</code> samples. In this case, <code>distance</code> should be <code>TRUE</code>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="cb.detect.caus_cdcorr_+3A_ts">Ts</code></td>
<td>
<p><code>[n]</code> the labels of the samples, with <code>K &lt; n</code> levels, as a factor variable.</p>
</td></tr>
<tr><td><code id="cb.detect.caus_cdcorr_+3A_xs">Xs</code></td>
<td>
<p><code>[n, r]</code> the <code>r</code> covariates/confounding variables, for each of the <code>n</code> samples.</p>
</td></tr>
<tr><td><code id="cb.detect.caus_cdcorr_+3A_prop.form">prop.form</code></td>
<td>
<p>a formula specifying a propensity scoring model. Defaults o <code>NULL</code>, which uses all of the covariates as exposure predictors.</p>
</td></tr>
<tr><td><code id="cb.detect.caus_cdcorr_+3A_r">R</code></td>
<td>
<p>the number of repetitions for permutation testing. Defaults to <code>1000</code>.</p>
</td></tr>
<tr><td><code id="cb.detect.caus_cdcorr_+3A_dist.method">dist.method</code></td>
<td>
<p>the method used for computing distance matrices. Defaults to <code>"euclidean"</code>. Other options
can be identified by seeing the appropriate documention for the <code>method</code> argument for the <code><a href="stats.html#topic+dist">dist</a></code> function.</p>
</td></tr>
<tr><td><code id="cb.detect.caus_cdcorr_+3A_distance">distance</code></td>
<td>
<p>a boolean for whether (or not) <code>Ys</code> are already distance matrices. Defaults to <code>FALSE</code>, which
will use <code>dist.method</code> parameter to compute an <code>[n, n]</code> pairwise distance matrix for <code>Ys</code>.</p>
</td></tr>
<tr><td><code id="cb.detect.caus_cdcorr_+3A_seed">seed</code></td>
<td>
<p>a random seed to set. Defaults to <code>1</code>.</p>
</td></tr>
<tr><td><code id="cb.detect.caus_cdcorr_+3A_num.threads">num.threads</code></td>
<td>
<p>The number of threads for parallel processing (if desired). Defaults to <code>1</code>.</p>
</td></tr>
<tr><td><code id="cb.detect.caus_cdcorr_+3A_retain.ratio">retain.ratio</code></td>
<td>
<p>If the number of samples retained is less than <code>retain.ratio*n</code>, throws a warning. Defaults to <code>0.05</code>.</p>
</td></tr>
<tr><td><code id="cb.detect.caus_cdcorr_+3A_ddx">ddx</code></td>
<td>
<p>whether to show additional diagnosis messages. Defaults to <code>FALSE</code>. Can help with debugging if unexpected results are obtained.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list, containing the following:
</p>

<ul>
<li><p><code>Test</code> The outcome of the statistical test, from <code><a href="cdcsis.html#topic+cdcov.test">cdcov.test</a></code>.
</p>
</li>
<li><p><code>Retained.Ids</code> The sample indices retained after vertex matching, which correspond to the samples for which statistical inference is performed.
</p>
</li></ul>



<h3>Details</h3>

<p>For more details see the help vignette:
<code>vignette("causal_cdcorr", package = "causalBatch")</code>
</p>


<h3>Author(s)</h3>

<p>Eric W. Bridgeford
</p>


<h3>References</h3>

<p>Eric W. Bridgeford, et al. &quot;A Causal Perspective for Batch Effects: When is no answer better than a wrong answer?&quot; Biorxiv (2024).
</p>
<p>Eric W. Bridgeford, et al. &quot;Learning sources of variability from high-dimensional observational studies&quot; arXiv (2023).
</p>
<p>Xueqin Wang, et al. &quot;Conditional Distance Correlation&quot; American Statistical Association (2015).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(causalBatch)
sim &lt;- cb.sims.sim_linear(a=-1, n=100, err=1/8, unbalancedness=3)
cb.detect.caus_cdcorr(sim$Ys, sim$Ts, sim$Xs)

</code></pre>

<hr>
<h2 id='cb.sims.sim_impulse'>Impulse Simulation</h2><span id='topic+cb.sims.sim_impulse'></span>

<h3>Description</h3>

<p>Impulse Simulation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cb.sims.sim_impulse(
  n = 100,
  pi = 0.5,
  eff_sz = 1,
  alpha = 2,
  unbalancedness = 1,
  err = 1/2,
  null = FALSE,
  a = -0.5,
  b = 1/2,
  c = 4,
  nbreaks = 200
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cb.sims.sim_impulse_+3A_n">n</code></td>
<td>
<p>the number of samples. Defaults to <code>100</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_+3A_pi">pi</code></td>
<td>
<p>the balance between the classes, where samples will be from group 1
with probability <code>pi</code>, and group 2 with probability <code>1 - pi</code>. Defaults
to <code>0.5</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_+3A_eff_sz">eff_sz</code></td>
<td>
<p>the treatment effect between the different groups. Defaults to <code>1</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_+3A_alpha">alpha</code></td>
<td>
<p>the alpha for the covariate sampling procedure. Defaults to <code>2</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_+3A_unbalancedness">unbalancedness</code></td>
<td>
<p>the level of covariate dissimilarity between the covariates
for each of the groups. Defaults to <code>1</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_+3A_err">err</code></td>
<td>
<p>the level of noise for the simulation. Defaults to <code>1/2</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_+3A_null">null</code></td>
<td>
<p>whether to generate a null simulation. Defaults to <code>FALSE</code>. Same behavior can be achieved by setting <code>eff_sz = 0</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_+3A_a">a</code></td>
<td>
<p>the first parameter for the covariate/outcome relationship. Defaults to <code>-0.5</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_+3A_b">b</code></td>
<td>
<p>the second parameter for the covariate/outcome relationship. Defaults to <code>1/2</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_+3A_c">c</code></td>
<td>
<p>the third parameter for the covariate/outcome relationship. Defaults to <code>1</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_+3A_nbreaks">nbreaks</code></td>
<td>
<p>the number of breakpoints for computing the expected outcome at a given covariate level
for each batch. Defaults to <code>200</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list, containing the following:
</p>
<table role = "presentation">
<tr><td><code>Ys</code></td>
<td>
<p>an <code>[n, 2]</code> matrix, containing the outcomes for each sample. The first dimension contains the &quot;treatment effect&quot;.</p>
</td></tr>
<tr><td><code>Ts</code></td>
<td>
<p>an <code>[n, 1]</code> matrix, containing the group/batch labels for each sample.</p>
</td></tr>
<tr><td><code>Xs</code></td>
<td>
<p>an <code>[n, 1]</code> matrix, containing the covariate values for each sample.</p>
</td></tr>
<tr><td><code>Eps</code></td>
<td>
<p>an <code>[n, 1]</code> matrix, containing the error for each sample.</p>
</td></tr>
<tr><td><code>x.bounds</code></td>
<td>
<p>the theoretical bounds for the covariate values.</p>
</td></tr>
<tr><td><code>Ytrue</code></td>
<td>
<p>an <code>[nbreaks*2, 2]</code> matrix, containing the expected outcomes at a covariate level indicated by <code>Xtrue</code>.</p>
</td></tr>
<tr><td><code>Ttrue</code></td>
<td>
<p>an <code>[nbreaks*2,1]</code> matrix, indicating the group/batch the expected outcomes and covariate breakpoints correspond to.</p>
</td></tr>
<tr><td><code>Xtrue</code></td>
<td>
<p>an <code>[nbreaks*2, 1]</code> matrix, indicating the values of the covariate breakpoints for the theoretical expected outcome in <code>Ytrue</code>.</p>
</td></tr>
<tr><td><code>Effect</code></td>
<td>
<p>The batch effect magnitude.</p>
</td></tr>
<tr><td><code>Overlap</code></td>
<td>
<p>the theoretical degree of overlap between the covariate distributions for each of the two groups/batches.</p>
</td></tr>
<tr><td><code>oracle_fn</code></td>
<td>
<p>A function for fitting outcomes given covariates.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A sigmoidal relationship between the covariate and the outcome. The first dimension of the outcome is:
</p>
<p style="text-align: center;"><code class="reqn">Y_i = c \times \phi(X_i, \mu = a, \sigma = b) - \text{eff\_sz} \times T_i + \frac{1}{2} \epsilon_i</code>
</p>

<p>where <code class="reqn">\phi(x, \mu, \sigma)</code> is the probability density function for the normal distribution with
mean <code class="reqn">\mu</code> and standard deviation <code class="reqn">\sigma</code>.
</p>
<p>where the batch/group labels are:
</p>
<p style="text-align: center;"><code class="reqn">T_i \overset{iid}{\sim} Bern(\pi)</code>
</p>

<p>The beta coefficient for the covariate sampling is:
</p>
<p style="text-align: center;"><code class="reqn">\beta = \alpha \times \text{unbalancedness}</code>
</p>

<p>The covariate values for the first batch are:
</p>
<p style="text-align: center;"><code class="reqn">X_i | T_i = 0 \overset{ind}{\sim} 2 Beta(\alpha, \beta) - 1</code>
</p>

<p>and the covariate values for the second batch are:
</p>
<p style="text-align: center;"><code class="reqn">X_i | T_i = 1 \overset{ind}{\sim} 2 Beta(\beta, \alpha) - 1</code>
</p>

<p>Note that <code class="reqn">X_i | T_i = 0 \overset{D}{=} - X_i | T_i = 1</code>, or that the covariates are symmetric
about the origin in distribution.
</p>
<p>Finally, the error terms are:
</p>
<p style="text-align: center;"><code class="reqn">\epsilon_i \overset{iid}{\sim} Norm(0, \text{err}^2)</code>
</p>

<p>For more details see the help vignette:
<code>vignette("causal_simulations", package = "causalBatch")</code>
</p>


<h3>Author(s)</h3>

<p>Eric W. Bridgeford
</p>


<h3>References</h3>

<p>Eric W. Bridgeford, et al. &quot;A Causal Perspective for Batch Effects: When is no answer better than a wrong answer?&quot; Biorxiv (2024).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(causalBatch)
sim = cb.sims.sim_impulse()

</code></pre>

<hr>
<h2 id='cb.sims.sim_impulse_asycov'>Impulse Simulation with Asymmetric Covariates</h2><span id='topic+cb.sims.sim_impulse_asycov'></span>

<h3>Description</h3>

<p>Impulse Simulation with Asymmetric Covariates
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cb.sims.sim_impulse_asycov(
  n = 100,
  pi = 0.5,
  eff_sz = 1,
  alpha = 2,
  unbalancedness = 1,
  null = FALSE,
  a = -0.5,
  b = 1/2,
  c = 4,
  err = 1/2,
  nbreaks = 200
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cb.sims.sim_impulse_asycov_+3A_n">n</code></td>
<td>
<p>the number of samples. Defaults to <code>100</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_asycov_+3A_pi">pi</code></td>
<td>
<p>the balance between the classes, where samples will be from group 1
with probability <code>pi</code>, and group 2 with probability <code>1 - pi</code>. Defaults
to <code>0.5</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_asycov_+3A_eff_sz">eff_sz</code></td>
<td>
<p>the treatment effect between the different groups. Defaults to <code>1</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_asycov_+3A_alpha">alpha</code></td>
<td>
<p>the alpha for the covariate sampling procedure. Defaults to <code>2</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_asycov_+3A_unbalancedness">unbalancedness</code></td>
<td>
<p>the level of covariate dissimilarity between the covariates
for each of the groups. Defaults to <code>1</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_asycov_+3A_null">null</code></td>
<td>
<p>whether to generate a null simulation. Defaults to <code>FALSE</code>. Same behavior can be achieved by setting <code>eff_sz = 0</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_asycov_+3A_a">a</code></td>
<td>
<p>the first parameter for the covariate/outcome relationship. Defaults to <code>-0.5</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_asycov_+3A_b">b</code></td>
<td>
<p>the second parameter for the covariate/outcome relationship. Defaults to <code>1/2</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_asycov_+3A_c">c</code></td>
<td>
<p>the third parameter for the covariate/outcome relationship. Defaults to <code>1</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_asycov_+3A_err">err</code></td>
<td>
<p>the level of noise for the simulation. Defaults to <code>1/2</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_impulse_asycov_+3A_nbreaks">nbreaks</code></td>
<td>
<p>the number of breakpoints for computing the expected outcome at a given covariate level
for each batch. Defaults to <code>200</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list, containing the following:
</p>
<table role = "presentation">
<tr><td><code>Ys</code></td>
<td>
<p>an <code>[n, 2]</code> matrix, containing the outcomes for each sample. The first dimension contains the &quot;treatment effect&quot;.</p>
</td></tr>
<tr><td><code>Ts</code></td>
<td>
<p>an <code>[n, 1]</code> matrix, containing the group/batch labels for each sample.</p>
</td></tr>
<tr><td><code>Xs</code></td>
<td>
<p>an <code>[n, 1]</code> matrix, containing the covariate values for each sample.</p>
</td></tr>
<tr><td><code>Eps</code></td>
<td>
<p>an <code>[n, 1]</code> matrix, containing the error for each sample.</p>
</td></tr>
<tr><td><code>x.bounds</code></td>
<td>
<p>the theoretical bounds for the covariate values.</p>
</td></tr>
<tr><td><code>Ytrue</code></td>
<td>
<p>an <code>[nbreaks*2, 2]</code> matrix, containing the expected outcomes at a covariate level indicated by <code>Xtrue</code>.</p>
</td></tr>
<tr><td><code>Ttrue</code></td>
<td>
<p>an <code>[nbreaks*2,1]</code> matrix, indicating the group/batch the expected outcomes and covariate breakpoints correspond to.</p>
</td></tr>
<tr><td><code>Xtrue</code></td>
<td>
<p>an <code>[nbreaks*2, 1]</code> matrix, indicating the values of the covariate breakpoints for the theoretical expected outcome in <code>Ytrue</code>.</p>
</td></tr>
<tr><td><code>Effect</code></td>
<td>
<p>The batch effect magnitude.</p>
</td></tr>
<tr><td><code>Overlap</code></td>
<td>
<p>the theoretical degree of overlap between the covariate distributions for each of the two groups/batches.</p>
</td></tr>
<tr><td><code>oracle_fn</code></td>
<td>
<p>A function for fitting outcomes given covariates.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A sigmoidal relationship between the covariate and the outcome. The first dimension of the outcome is:
</p>
<p style="text-align: center;"><code class="reqn">Y_i = c \times \phi(X_i, \mu = a, \sigma = b) - \text{eff\_sz} \times T_i + \frac{1}{2} \epsilon_i</code>
</p>

<p>where <code class="reqn">\phi(x, \mu, \sigma)</code> is the probability density function for the normal distribution with
mean <code class="reqn">\mu</code> and standard deviation <code class="reqn">\sigma</code>.
</p>
<p>where the batch/group labels are:
</p>
<p style="text-align: center;"><code class="reqn">T_i \overset{iid}{\sim} Bern(\pi)</code>
</p>

<p>The beta coefficient for the covariate sampling is:
</p>
<p style="text-align: center;"><code class="reqn">\beta = \alpha \times \text{unbalancedness}</code>
</p>

<p>The covariate values for the first batch are asymmetric, in that for the first batch:
</p>
<p style="text-align: center;"><code class="reqn">X_i | T_i = 0 \overset{ind}{\sim} 2 Beta(\alpha, \alpha) - 1</code>
</p>

<p>and the covariate values for the second batch are:
</p>
<p style="text-align: center;"><code class="reqn">X_i | T_i = 1 \overset{ind}{\sim} 2 Beta(\beta, \alpha) - 1</code>
</p>

<p>Finally, the error terms are:
</p>
<p style="text-align: center;"><code class="reqn">\epsilon_i \overset{iid}{\sim} Norm(0, \text{err}^2)</code>
</p>

<p>For more details see the help vignette:
<code>vignette("causal_simulations", package = "causalBatch")</code>
</p>


<h3>Author(s)</h3>

<p>Eric W. Bridgeford
</p>


<h3>References</h3>

<p>Eric W. Bridgeford, et al. &quot;A Causal Perspective for Batch Effects: When is no answer better than a wrong answer?&quot; Biorxiv (2024).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(causalBatch)
sim = cb.sims.sim_impulse_asycov()

</code></pre>

<hr>
<h2 id='cb.sims.sim_linear'>Linear Simulation</h2><span id='topic+cb.sims.sim_linear'></span>

<h3>Description</h3>

<p>Linear Simulation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cb.sims.sim_linear(
  n = 100,
  pi = 0.5,
  eff_sz = 1,
  alpha = 2,
  unbalancedness = 1,
  err = 1/2,
  null = FALSE,
  a = -2,
  b = -1,
  nbreaks = 200
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cb.sims.sim_linear_+3A_n">n</code></td>
<td>
<p>the number of samples. Defaults to <code>100</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_linear_+3A_pi">pi</code></td>
<td>
<p>the balance between the classes, where samples will be from group 1
with probability <code>pi</code>, and group 2 with probability <code>1 - pi</code>. Defaults
to <code>0.5</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_linear_+3A_eff_sz">eff_sz</code></td>
<td>
<p>the treatment effect between the different groups. Defaults to <code>1</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_linear_+3A_alpha">alpha</code></td>
<td>
<p>the alpha for the covariate sampling procedure. Defaults to <code>2</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_linear_+3A_unbalancedness">unbalancedness</code></td>
<td>
<p>the level of covariate dissimilarity between the covariates
for each of the groups. Defaults to <code>1</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_linear_+3A_err">err</code></td>
<td>
<p>the level of noise for the simulation. Defaults to <code>1/2</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_linear_+3A_null">null</code></td>
<td>
<p>whether to generate a null simulation. Defaults to <code>FALSE</code>. Same behavior can be achieved by setting <code>eff_sz = 0</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_linear_+3A_a">a</code></td>
<td>
<p>the first parameter for the covariate/outcome relationship. Defaults to <code>-2</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_linear_+3A_b">b</code></td>
<td>
<p>the second parameter for the covariate/outcome relationship. Defaults to <code>-1</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_linear_+3A_nbreaks">nbreaks</code></td>
<td>
<p>the number of breakpoints for computing the expected outcome at a given covariate level
for each batch. Defaults to <code>200</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list, containing the following:
</p>
<table role = "presentation">
<tr><td><code>Ys</code></td>
<td>
<p>an <code>[n, 2]</code> matrix, containing the outcomes for each sample. The first dimension contains the &quot;treatment effect&quot;.</p>
</td></tr>
<tr><td><code>Ts</code></td>
<td>
<p>an <code>[n, 1]</code> matrix, containing the group/batch labels for each sample.</p>
</td></tr>
<tr><td><code>Xs</code></td>
<td>
<p>an <code>[n, 1]</code> matrix, containing the covariate values for each sample.</p>
</td></tr>
<tr><td><code>Eps</code></td>
<td>
<p>an <code>[n, 1]</code> matrix, containing the error for each sample.</p>
</td></tr>
<tr><td><code>x.bounds</code></td>
<td>
<p>the theoretical bounds for the covariate values.</p>
</td></tr>
<tr><td><code>Ytrue</code></td>
<td>
<p>an <code>[nbreaks*2, 2]</code> matrix, containing the expected outcomes at a covariate level indicated by <code>Xtrue</code>.</p>
</td></tr>
<tr><td><code>Ttrue</code></td>
<td>
<p>an <code>[nbreaks*2,1]</code> matrix, indicating the group/batch the expected outcomes and covariate breakpoints correspond to.</p>
</td></tr>
<tr><td><code>Xtrue</code></td>
<td>
<p>an <code>[nbreaks*2, 1]</code> matrix, indicating the values of the covariate breakpoints for the theoretical expected outcome in <code>Ytrue</code>.</p>
</td></tr>
<tr><td><code>Effect</code></td>
<td>
<p>The batch effect magnitude.</p>
</td></tr>
<tr><td><code>Overlap</code></td>
<td>
<p>the theoretical degree of overlap between the covariate distributions for each of the two groups/batches.</p>
</td></tr>
<tr><td><code>oracle_fn</code></td>
<td>
<p>A function for fitting outcomes given covariates.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A linear relationship between the covariate and the outcome. The first dimension of the outcome is:
</p>
<p style="text-align: center;"><code class="reqn">Y_i = a\times (X_i + b) - \text{eff\_sz} \times T_i + \frac{1}{2} \epsilon_i</code>
</p>

<p>where the batch/group labels are:
</p>
<p style="text-align: center;"><code class="reqn">T_i \overset{iid}{\sim} Bern(\pi)</code>
</p>

<p>The beta coefficient for the covariate sampling is:
</p>
<p style="text-align: center;"><code class="reqn">\beta = \alpha \times \text{unbalancedness}</code>
</p>

<p>The covariate values for the first batch are:
</p>
<p style="text-align: center;"><code class="reqn">X_i | T_i = 0 \overset{ind}{\sim} 2 Beta(\alpha, \beta) - 1</code>
</p>

<p>and the covariate values for the second batch are:
</p>
<p style="text-align: center;"><code class="reqn">X_i | T_i = 1 \overset{ind}{\sim} 2 Beta(\beta, \alpha) - 1</code>
</p>

<p>Finally, the error terms are:
</p>
<p style="text-align: center;"><code class="reqn">\epsilon_i \overset{iid}{\sim} Norm(0, \text{err}^2)</code>
</p>

<p>For more details see the help vignette:
<code>vignette("causal_simulations", package = "causalBatch")</code>
</p>


<h3>Author(s)</h3>

<p>Eric W. Bridgeford
</p>


<h3>References</h3>

<p>Eric W. Bridgeford, et al. &quot;A Causal Perspective for Batch Effects: When is no answer better than a wrong answer?&quot; Biorxiv (2024).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(causalBatch)
sim = cb.sims.sim_linear()

</code></pre>

<hr>
<h2 id='cb.sims.sim_sigmoid'>Sigmoidal Simulation</h2><span id='topic+cb.sims.sim_sigmoid'></span>

<h3>Description</h3>

<p>Sigmoidal Simulation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cb.sims.sim_sigmoid(
  n = 100,
  pi = 0.5,
  eff_sz = 1,
  alpha = 2,
  unbalancedness = 1,
  null = FALSE,
  a = -4,
  b = 8,
  err = 1/2,
  nbreaks = 200
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cb.sims.sim_sigmoid_+3A_n">n</code></td>
<td>
<p>the number of samples. Defaults to <code>100</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_sigmoid_+3A_pi">pi</code></td>
<td>
<p>the balance between the classes, where samples will be from group 1
with probability <code>pi</code>, and group 2 with probability <code>1 - pi</code>. Defaults
to <code>0.5</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_sigmoid_+3A_eff_sz">eff_sz</code></td>
<td>
<p>the treatment effect between the different groups. Defaults to <code>1</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_sigmoid_+3A_alpha">alpha</code></td>
<td>
<p>the alpha for the covariate sampling procedure. Defaults to <code>2</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_sigmoid_+3A_unbalancedness">unbalancedness</code></td>
<td>
<p>the level of covariate dissimilarity between the covariates
for each of the groups. Defaults to <code>1</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_sigmoid_+3A_null">null</code></td>
<td>
<p>whether to generate a null simulation. Defaults to <code>FALSE</code>. Same behavior can be achieved by setting <code>eff_sz = 0</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_sigmoid_+3A_a">a</code></td>
<td>
<p>the first parameter for the covariate/outcome relationship. Defaults to <code>-4</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_sigmoid_+3A_b">b</code></td>
<td>
<p>the second parameter for the covariate/outcome relationship. Defaults to <code>8</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_sigmoid_+3A_err">err</code></td>
<td>
<p>the level of noise for the simulation. Defaults to <code>1/2</code>.</p>
</td></tr>
<tr><td><code id="cb.sims.sim_sigmoid_+3A_nbreaks">nbreaks</code></td>
<td>
<p>the number of breakpoints for computing the expected outcome at a given covariate level
for each batch. Defaults to <code>200</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list, containing the following:
</p>
<table role = "presentation">
<tr><td><code>Y</code></td>
<td>
<p>an <code>[n, 2]</code> matrix, containing the outcomes for each sample. The first dimension contains the &quot;treatment effect&quot;.</p>
</td></tr>
<tr><td><code>Ts</code></td>
<td>
<p>an <code>[n, 1]</code> matrix, containing the group/batch labels for each sample.</p>
</td></tr>
<tr><td><code>Xs</code></td>
<td>
<p>an <code>[n, 1]</code> matrix, containing the covariate values for each sample.</p>
</td></tr>
<tr><td><code>Eps</code></td>
<td>
<p>an <code>[n, 1]</code> matrix, containing the error for each sample.</p>
</td></tr>
<tr><td><code>x.bounds</code></td>
<td>
<p>the theoretical bounds for the covariate values.</p>
</td></tr>
<tr><td><code>Ytrue</code></td>
<td>
<p>an <code>[nbreaks*2, 2]</code> matrix, containing the expected outcomes at a covariate level indicated by <code>Xtrue</code>.</p>
</td></tr>
<tr><td><code>Ttrue</code></td>
<td>
<p>an <code>[nbreaks*2,1]</code> matrix, indicating the group/batch the expected outcomes and covariate breakpoints correspond to.</p>
</td></tr>
<tr><td><code>Xtrue</code></td>
<td>
<p>an <code>[nbreaks*2, 1]</code> matrix, indicating the values of the covariate breakpoints for the theoretical expected outcome in <code>Ytrue</code>.</p>
</td></tr>
<tr><td><code>Effect</code></td>
<td>
<p>The batch effect magnitude.</p>
</td></tr>
<tr><td><code>Overlap</code></td>
<td>
<p>the theoretical degree of overlap between the covariate distributions for each of the two groups/batches.</p>
</td></tr>
<tr><td><code>oracle_fn</code></td>
<td>
<p>A function for fitting outcomes given covariates.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A sigmoidal relationship between the covariate and the outcome. The first dimension of the outcome is:
</p>
<p style="text-align: center;"><code class="reqn">Y_i = a\times \text{sigmoid}(b \times X_i) - a - \text{eff\_sz} \times T_i + \frac{1}{2} \epsilon_i</code>
</p>

<p>where the batch/group labels are:
</p>
<p style="text-align: center;"><code class="reqn">T_i \overset{iid}{\sim} Bern(\pi)</code>
</p>

<p>The beta coefficient for the covariate sampling is:
</p>
<p style="text-align: center;"><code class="reqn">\beta = \alpha \times \text{unbalancedness}</code>
</p>

<p>The covariate values for the first batch are:
</p>
<p style="text-align: center;"><code class="reqn">X_i | T_i = 0 \overset{ind}{\sim} 2 Beta(\alpha, \beta) - 1</code>
</p>

<p>and the covariate values for the second batch are:
</p>
<p style="text-align: center;"><code class="reqn">X_i | T_i = 1 \overset{ind}{\sim} 2 Beta(\beta, \alpha) - 1</code>
</p>

<p>Finally, the error terms are:
</p>
<p style="text-align: center;"><code class="reqn">\epsilon_i \overset{iid}{\sim} Norm(0, \text{err}^2)</code>
</p>

<p>For more details see the help vignette:
<code>vignette("causal_simulations", package = "causalBatch")</code>
</p>


<h3>Author(s)</h3>

<p>Eric W. Bridgeford
</p>


<h3>References</h3>

<p>Eric W. Bridgeford, et al. &quot;A Causal Perspective for Batch Effects: When is no answer better than a wrong answer?&quot; Biorxiv (2024).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(causalBatch)
sim = cb.sims.sim_sigmoid()

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
