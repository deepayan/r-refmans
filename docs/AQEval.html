<!DOCTYPE html><html lang="en"><head><title>Help for package AQEval</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {AQEval}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#AQEval-package'><p>Air Quality Evaluation</p></a></li>
<li><a href='#AQEval.data'><p>AQEval Example data</p></a></li>
<li><a href='#aqeval.generics'><p>aqeval.generics</p></a></li>
<li><a href='#calculate.stats'><p>Some functions to calculate statistics</p></a></li>
<li><a href='#find.breaks'><p>find and test break-points</p></a></li>
<li><a href='#find.near'><p>find nearby sites</p></a></li>
<li><a href='#isolate.signal'><p>isolateContribution</p></a></li>
<li><a href='#other.aq.models'><p>Other Air Quality Models</p></a></li>
<li><a href='#quantify.breaks'><p>quantify break-point/segments</p></a></li>
<li><a href='#spectral.analysis'><p>Spectral Analysis</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Air Quality Evaluation</td>
</tr>
<tr>
<td>Version:</td>
<td>0.6.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-12-19</td>
</tr>
<tr>
<td>Description:</td>
<td>Developed for use by those tasked with the routine detection,
         characterisation and quantification of discrete changes in air quality
         time-series, such as identifying the impacts of air quality policy
         interventions. The main functions use signal isolation then
         break-point/segment (BP/S) methods based on 'strucchange' and 'segmented'
         methods to detect and quantify change events (Ropkins &amp; Tate, 2021,
         &lt;<a href="https://doi.org/10.1016%2Fj.scitotenv.2020.142374">doi:10.1016/j.scitotenv.2020.142374</a>&gt;).</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Karl Ropkins &lt;k.ropkins@its.leeds.ac.uk&gt;</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>openair, dplyr, loa, ggplot2, strucchange, segmented, mgcv,
tidyr, lubridate, purrr, ggtext, stats, data.table</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/karlropkins/AQEval">https://github.com/karlropkins/AQEval</a>,
<a href="https://karlropkins.github.io/AQEval/">https://karlropkins.github.io/AQEval/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/karlropkins/AQEval/issues">https://github.com/karlropkins/AQEval/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-09 17:02:30 UTC; trakradmin</td>
</tr>
<tr>
<td>Author:</td>
<td>Karl Ropkins <a href="https://orcid.org/0000-0002-0294-6997"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Anthony Walker <a href="https://orcid.org/0000-0003-3979-0989"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  James Tate [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-09 19:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='AQEval-package'>Air Quality Evaluation</h2><span id='topic+AQEval-package'></span><span id='topic+AQEval'></span><span id='topic++22_PACKAGE+22'></span>

<h3>Description</h3>

<p>R AQEval: R code for the analysis of discrete
change in Air Quality time-series.
</p>


<h3>AQEval</h3>

<p><code>AQEval</code> was developed for use by those tasked with
the routine detection, characterisation and quantification
of discrete changes in air quality time-series.
</p>
<p>The main functions, <code><a href="#topic+quantBreakPoints">quantBreakPoints</a></code>
and <code><a href="#topic+quantBreakSegments">quantBreakSegments</a></code>, use
break-point/segment (BP/S) methods
based on the consecutive use of methods in the
<code>strucchange</code> and <code>segmented</code> <code>R</code> packages
to first detection (as break-points) and then characterise
and quantify (as segments), discrete changes in
air-quality time-series.
</p>
<p><code>AQEval</code> functions adopt an <code>openair</code>-friendly
approach using function and data structures that many
in the air quality research community are already familiar
with.
Most notably, most functions expect supplied data
to be time-series, to be supplied as a single
<code>data.frame</code> (or similar R object), and for
time-series to be identified by column names.
The main functions are typically structured expect
first the <code>data.frame</code>, then the name of the
pollutant to be used, then other arguments:
</p>
<p><code>function(data, "polluant.name", ...)</code>
</p>
<p><code>output &lt;- function(data, "polluant.name", ...)</code>
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p>Ropkins, K. and Tate, J.E., 2021. Early observations on the impact of the
COVID-19 lockdown on air quality trends across the UK. Science of the
Total Environment, 754, p.142374.
https://doi.org/10.1016/j.scitotenv.2020.142374
</p>
<p>Ropkins, K., Tate, J.E., Walker, A. and Clark, T., 2022. Measuring the
impact of air quality related interventions. Environmental Science:
Atmospheres, 2(3), pp.500-516. https://doi.org/10.1039/d1ea00073j
</p>
<p>Ropkins, K., Walker, A., Philips, I., Rushton, C., Clark, T. and
Tate, J., Change Detection of Air Quality Time-Series Using the
R Package AEQval. Available at SSRN 4267722.
https://ssrn.com/abstract=4267722 or http://dx.doi.org/10.2139/ssrn.4267722
Also at: https://karlropkins.github.io/AQEval/articles/AQEval_Intro_Preprint.pdf
</p>


<h3>See Also</h3>

<p>For more about data structure and an example data set,
see <code><a href="#topic+AQEval.data">AQEval.data</a></code>
</p>
<p>For more about the main functions, see
<code><a href="#topic+quantBreakPoints">quantBreakPoints</a></code>
and <code><a href="#topic+quantBreakSegments">quantBreakSegments</a></code>
</p>

<hr>
<h2 id='AQEval.data'>AQEval Example data</h2><span id='topic+AQEval.data'></span><span id='topic+aq.data'></span>

<h3>Description</h3>

<p>Data packaged with AQEval for
use with example code.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>aq.data
</code></pre>


<h3>Format</h3>

<p>(26280x6) 'tbl_df' objects
</p>

<dl>
<dt>date</dt><dd><p>Time-series of POSIX class date and time records.</p>
</dd>
<dt>no2</dt><dd><p>Time-series of
nitrogen dioxide measurements from local site.</p>
</dd>
<dt>bg.no2</dt><dd><p>Time-series of
nitrogen dioxide measurements from nearby
background site.</p>
</dd>
<dt>ws</dt><dd><p>Time-series of
local wind speed measurements.</p>
</dd>
<dt>wd</dt><dd><p>Time-series of
local wind direction measurements.</p>
</dd>
<dt>air_temp</dt><dd><p>Time-series of
local air temperature measurements.</p>
</dd>
</dl>



<h3>Details</h3>

<p>Most of functions in <code>AQEval</code> adopt the
<code>openair</code> convention of assuming supplied data is
a single <code>data.frame</code> or similar.
The data frame was initially adopted for two reasons:
</p>

<ul>
<li><p> Firstly, air quality data collected and archived
in numerous formats and keeping the import requirements
simple minimises the frustrations associated with data
importation.
</p>
</li>
<li><p> Secondly, restricting the user to work with a single
data format greatly simplifies data management for
those less familiar with programming environments.
</p>
</li></ul>

<p>As part of this work several <code>openair</code> coding
conventions were adopted, most importantly that data
sets should include a column named <code>date</code> of
<code>POSIX</code> class data-and-time-stamps
(<code><a href="base.html#topic+DateTimeClasses">DateTimeClasses</a></code>).
This and other conventions, such as the use of
<code>ws</code> and <code>wd</code> for numeric wind speed and
direction data-series, and <code>site</code> and <code>code</code>
for character or factor monitoring site name and
identifier code, are now commonplace for many working
with R in the air quality research community, and many
air quality archives provide data in (or support import
functions that convert their own data structures to)
this <code>openair</code>-friendly structure.
</p>


<h3>Source</h3>

<p>Air quality and meteorological data packaged
for use with AQEval Examples.
</p>
<p>Time-series sources:
</p>

<ul>
<li> <p><strong>date</strong> Date-and-time-stamp of POSIX class
(<code><a href="base.html#topic+DateTimeClasses">DateTimeClasses</a></code>).
</p>
</li>
<li> <p><strong>no2</strong> Nitrogen dioxide downloaded from King's
College London Archive using <code>importKCL</code>
function in <code>openair</code>.
</p>
</li>
<li> <p><strong>bg.no2</strong>  Nitrogen dioxide downloaded from
the Automatic Urban and Rural Network Archive using
<code>importAURN</code> function in <code>openair</code>.
</p>
</li>
<li> <p><strong>ws</strong>, <strong>wd</strong>, <strong>air_temp</strong> Wind
speed, wind direction and air temperature downloaded from
NOAA's Integrated Surface Database using <code>importNOAA</code>
function in <code>worldmet</code>.
</p>
</li></ul>



<h3>References</h3>

<p>Regarding <code>openair</code> and <code>openair</code>-friendly
data structuring, see:
</p>
<p>Carslaw, D. C. and K. Ropkins (2012), openair &mdash; an
R package for air quality data analysis.
Environmental Modelling &amp; Software. Volume 27-28,
52-61,
DOI <a href="https://doi.org/10.1016/j.envsoft.2011.09.008">doi:10.1016/j.envsoft.2011.09.008</a>
</p>
<p>Ropkins, K. and D.C. Carslaw (2012), openair-Data
Analysis Tools for the Air Quality Community. R Journal,
4(1).
URL <a href="https://journal.r-project.org/archive/2012/RJ-2012-003/RJ-2012-003.pdf">https://journal.r-project.org/archive/2012/RJ-2012-003/RJ-2012-003.pdf</a>
</p>
<p>Regarding <code>worldmet</code>, see:
</p>
<p>David Carslaw (2021), worldmet: Import Surface
Meteorological Data from NOAA Integrated Surface
Database (ISD). R package version 0.9.5.
URL <a href="https://CRAN.R-project.org/package=worldmet">https://CRAN.R-project.org/package=worldmet</a>
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+DateTimeClasses">DateTimeClasses</a></code>
</p>
<p><code><a href="openair.html#topic+openair">openair</a></code>: functions <code><a href="openair.html#topic+importAURN">importAURN</a></code> and
<code><a href="openair.html#topic+importKCL">importKCL</a></code>
</p>
<p><code>worldmet</code>: function <code>importNOAA</code> (See References)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#data set used in AQEval Examples
dim(aq.data)
head(aq.data)
with(aq.data, plot(date, no2, type="l"))

</code></pre>

<hr>
<h2 id='aqeval.generics'>aqeval.generics</h2><span id='topic+aqeval.generics'></span><span id='topic+print.aqe'></span><span id='topic+aqe.generics'></span><span id='topic+plot.aqe'></span>

<h3>Description</h3>

<p>Generic functions for use with <code>aqe</code> object class for
<code>AQEval</code> outputs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'aqe'
print(x, ...)

## S3 method for class 'aqe'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="aqeval.generics_+3A_x">x</code></td>
<td>
<p>the <code>aqe</code>
object to be printed, plotted, etc.</p>
</td></tr>
<tr><td><code id="aqeval.generics_+3A_...">...</code></td>
<td>
<p>additional arguments, typically passed on to next method or
ignored.</p>
</td></tr>
</table>

<hr>
<h2 id='calculate.stats'>Some functions to calculate statistics</h2><span id='topic+calculate.stats'></span><span id='topic+calcDateRangeStat'></span><span id='topic+calcRollingDateRangeStat'></span>

<h3>Description</h3>

<p>Calculate data set statistics for
selected time intervals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calcDateRangeStat(
  data,
  from = NULL,
  to = NULL,
  stat = NULL,
  pollutant = NULL,
  ...,
  method = 2
)

calcRollingDateRangeStat(
  data,
  range = "year",
  res = "day",
  stat = NULL,
  pollutant = NULL,
  from = NULL,
  to = NULL,
  ...,
  method = 2
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calculate.stats_+3A_data">data</code></td>
<td>
<p>(data.frame, tibble, etc) Data set containing
data statistic to be calculated for, and <code>date</code>
column of date/time records.</p>
</td></tr>
<tr><td><code id="calculate.stats_+3A_from">from</code></td>
<td>
<p>(various) Start date(s) to subsample from when
calculating statistic, by default end of supplied
<code>data</code> date range.</p>
</td></tr>
<tr><td><code id="calculate.stats_+3A_to">to</code></td>
<td>
<p>(various) End date(s) to subsample to when
calculating statistic, by default end of supplied
<code>data</code> date range.</p>
</td></tr>
<tr><td><code id="calculate.stats_+3A_stat">stat</code></td>
<td>
<p>(function) Statistic to be applied to selected
data, by default <code>mean(pollutant, na.rm=TRUE)</code>. NB:
This should be a function that works on vectors in the form
<code>function(x)</code>.</p>
</td></tr>
<tr><td><code id="calculate.stats_+3A_pollutant">pollutant</code></td>
<td>
<p>(character) The name(s) of data-series to
analyse in <code>data</code>, by default all columns in
supplied data except <code>date</code>.</p>
</td></tr>
<tr><td><code id="calculate.stats_+3A_...">...</code></td>
<td>
<p>extra arguments.</p>
</td></tr>
<tr><td><code id="calculate.stats_+3A_method">method</code></td>
<td>
<p>(numeric) Method to use when calculating
statistic. Currently 1 (using base R), 2 (using dplyr),
3 (using data.table), and 4 (using dplyr and purrr)</p>
</td></tr>
<tr><td><code id="calculate.stats_+3A_range">range</code></td>
<td>
<p>(character) For <code>calcRollingDateRange</code>,
the range the rolling date windows, by default
<code>'year'</code> for annual statistic calculations.</p>
</td></tr>
<tr><td><code id="calculate.stats_+3A_res">res</code></td>
<td>
<p>(character) For <code>calcRollingDateRange</code>,
the resolution to calculate the rolling statistic at, by
default <code>'day'</code> to calculate this once per day.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>These functions return <code>data.frame</code>s of function
outputs.
</p>


<h3>Note</h3>

<p>These functions are in development and likely to change
significantly in future versions, please handle with
care.
</p>

<hr>
<h2 id='find.breaks'>find and test break-points</h2><span id='topic+find.breaks'></span><span id='topic+findBreakPoints'></span><span id='topic+textBreakSegments'></span><span id='topic+testBreakPoints'></span>

<h3>Description</h3>

<p>Finding and testing break-points in
conventionally formatted air quality data sets.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>findBreakPoints(data, pollutant, h = 0.15, ...)

testBreakPoints(data, pollutant, breaks, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="find.breaks_+3A_data">data</code></td>
<td>
<p>Data source, typically a <code>data.frame</code>
or similar, containing data-series to apply function to
and a paired time-stamped data-series, called <code>date</code>.</p>
</td></tr>
<tr><td><code id="find.breaks_+3A_pollutant">pollutant</code></td>
<td>
<p>Name of time-series, assumed to be
a column in <code>date</code>.</p>
</td></tr>
<tr><td><code id="find.breaks_+3A_h">h</code></td>
<td>
<p>(<code>findBreakPoints</code> only) The data/time window
size to use when looking for breaks in a supplied time-series,
expressed as proportion of time-series (0-1), default 0.15.</p>
</td></tr>
<tr><td><code id="find.breaks_+3A_...">...</code></td>
<td>
<p>other parameters</p>
</td></tr>
<tr><td><code id="find.breaks_+3A_breaks">breaks</code></td>
<td>
<p>(<code>testBreakPoints</code> only) <code>data.frame</code>
of The break-points and confidence intervals, typically a
<code>findBreakPoints</code> output.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>findBreakPoints</code> uses methods from
<code>strucchange</code> package (see references) and
modifications as suggested by the main author of
<code>strucchange</code> to handle missing cases to find
potential breaks-points in a supplied time-series.
</p>
<p><code>testBreakPoints</code> tests and identifies most likely
break-points using methods proposed for use with
<code>quantBreakPoints</code> and <code>quantBreakSegments</code>
and conventionally formatted air quality data sets.
</p>


<h3>Value</h3>

<p><code>findBreakPoints</code> returns a <code>data.frame</code>
of found break-points.
</p>
<p><code>testBreakPoints</code> return a likely break-point/segment
report.
</p>


<h3>References</h3>

<p>Regarding <code>strucchange</code> methods see
<code><a href="strucchange.html#topic+breakpoints">breakpoints</a></code>, and:
</p>
<p>Achim Zeileis, Friedrich Leisch, Kurt Hornik and Christian Kleiber
(2002). strucchange: An R Package for Testing for Structural Change
in Linear Regression Models. Journal of Statistical Software, 7(2),
1-38. URL <a href="https://www.jstatsoft.org/v07/i02/">https://www.jstatsoft.org/v07/i02/</a>.
</p>
<p>Achim Zeileis, Christian Kleiber, Walter Kraemer and Kurt Hornik
(2003). Testing and Dating of Structural Changes in Practice.
Computational Statistics &amp; Data Analysis, 44, 109-123.
</p>
<p>Regarding missing data handling, see:
</p>
<p>URL:
<a href="https://stackoverflow.com/questions/43243548/strucchange-not-reporting-breakdates">https://stackoverflow.com/questions/43243548/strucchange-not-reporting-breakdates</a>.
</p>
<p>Regarding <code>testBreakPoints</code>, see:
</p>
<p>Ropkins, K., Walker, A., Philips, I., Rushton, C., Clark, T. and
Tate, J., Change Detection of Air Quality Time-Series Using the
R Package AEQval. Available at SSRN 4267722.
https://ssrn.com/abstract=4267722 or http://dx.doi.org/10.2139/ssrn.4267722
Also at: https://karlropkins.github.io/AQEval/articles/AQEval_Intro_Preprint.pdf
</p>


<h3>See Also</h3>

<p><code><a href="#topic+find.breaks">find.breaks</a></code>.
</p>

<hr>
<h2 id='find.near'>find nearby sites</h2><span id='topic+find.near'></span><span id='topic+findNearLatLon'></span><span id='topic+findNearSites'></span>

<h3>Description</h3>

<p>Function to find nearest locations in a
reference by latitude and longitude.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>findNearLatLon(lat, lon = NULL, nmax = 10, ..., ref = NULL, units = "m")

findNearSites(
  lat,
  lon,
  pollutant = "no2",
  site.type = "rural background",
  nmax = 10,
  ...,
  ref = NULL,
  units = "m"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="find.near_+3A_lat">lat</code>, <code id="find.near_+3A_lon">lon</code></td>
<td>
<p>(numeric) The supplied latitude and
longitude.</p>
</td></tr>
<tr><td><code id="find.near_+3A_nmax">nmax</code></td>
<td>
<p>(numeric) The maximum number of nearest sites
to report, by default 10.</p>
</td></tr>
<tr><td><code id="find.near_+3A_...">...</code></td>
<td>
<p>Other parameters, mostly ignored.</p>
</td></tr>
<tr><td><code id="find.near_+3A_ref">ref</code></td>
<td>
<p>(<code>data.frame</code> or similar) The look-up table to
use when identifying nearby locations, and expected to
contain latitude, longitude and any required location
identifier data-series. By default, <code>findNearSites</code>
uses openair <code>importMeta</code> output if this is not
supplied but this is a required input for
<code>findNearLatLon</code>.</p>
</td></tr>
<tr><td><code id="find.near_+3A_units">units</code></td>
<td>
<p>(character) The units to use when reporting
distances to near locations; current options m.</p>
</td></tr>
<tr><td><code id="find.near_+3A_pollutant">pollutant</code></td>
<td>
<p>(character) For <code>findNearSites</code>
only, the pollutant of interest, by default NO2.</p>
</td></tr>
<tr><td><code id="find.near_+3A_site.type">site.type</code></td>
<td>
<p>(character) For <code>findNearSites</code>
only, the monitoring site type, by default Rural
Background.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If investigating air quality in a particular location,
for example a UK Clean Air Zone
(<a href="https://www.gov.uk/guidance/driving-in-a-clean-air-zone">https://www.gov.uk/guidance/driving-in-a-clean-air-zone</a>),
you may wish to locate an appropriate rural background air quality
monitoring station. <code>findNearSites</code> locates air quality monitoring
sites with openly available data such as that available from the UK AURN
network (<a href="https://uk-air.defra.gov.uk/networks/network-info?view=aurn">https://uk-air.defra.gov.uk/networks/network-info?view=aurn</a>)
</p>


<h3>Value</h3>

<p><code>find.near</code> returns <code>data.frame</code> of near site meta
data.
</p>


<h3>Note</h3>

<p>This function uses haversine formula to account
to the Earth's surface curvature, and uses 6371 km as
the radius of earth.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#find rural background NO2 monitoring sites
#near latitude = 50, longitude = -1

#not run: requires internet
## Not run: 
findNearSites(lat = 50, lon = -1)

## End(Not run)
</code></pre>

<hr>
<h2 id='isolate.signal'>isolateContribution</h2><span id='topic+isolate.signal'></span><span id='topic+isolateContribution'></span>

<h3>Description</h3>

<p>Environmental time-series signal processing:
Contribution isolation based on background subtraction,
deseasonalisation and/or deweathering.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>isolateContribution(
  data,
  pollutant,
  background = NULL,
  deseason = TRUE,
  deweather = TRUE,
  method = 2,
  add.term = NULL,
  formula = NULL,
  output = "mean",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="isolate.signal_+3A_data">data</code></td>
<td>
<p>Data source, typically <code>data.frame</code>
(or similar), containing all time-series to be used when
applying signal processing.</p>
</td></tr>
<tr><td><code id="isolate.signal_+3A_pollutant">pollutant</code></td>
<td>
<p>The column name of the <code>data</code>
time-series to be signal processed.</p>
</td></tr>
<tr><td><code id="isolate.signal_+3A_background">background</code></td>
<td>
<p>(optional) if supplied, the background
time-series to use as a background correction.
See below.</p>
</td></tr>
<tr><td><code id="isolate.signal_+3A_deseason">deseason</code></td>
<td>
<p>logical or character vector, if
<code>TRUE</code> (default), the <code>pollutant</code> is
deseasonalised using <code>day.hour</code> and <code>year.day</code>
frequency terms, all calculate from the <code>data</code>
time stamp, assumed to be <code>date</code> in <code>data</code>.
Other options: <code>FALSE</code> to turn off
deseasonalisation; or a character vector of frequency
terms if user-defining. See below.</p>
</td></tr>
<tr><td><code id="isolate.signal_+3A_deweather">deweather</code></td>
<td>
<p>logical or character vector, if
<code>TRUE</code> (default), the data is deweathered using
wind speed and direction, assumed to be <code>ws</code>
and <code>wd</code> in <code>data</code>). Other options: <code>FALSE</code>
to turn off deweathering; or a character vector of
<code>data</code> column names if user-defining. See below.</p>
</td></tr>
<tr><td><code id="isolate.signal_+3A_method">method</code></td>
<td>
<p>numeric, contribution isolation method
(default 2). See Note.</p>
</td></tr>
<tr><td><code id="isolate.signal_+3A_add.term">add.term</code></td>
<td>
<p>extra terms to add to the contribution
isolation model; ignore for now (in development).</p>
</td></tr>
<tr><td><code id="isolate.signal_+3A_formula">formula</code></td>
<td>
<p>(optional) Signal isolate model formula;
this allows user to set the signal isolation model formula
directly, but means function arguments <code>background</code>,
<code>deseason</code> and <code>deweather</code> will be ignored.</p>
</td></tr>
<tr><td><code id="isolate.signal_+3A_output">output</code></td>
<td>
<p>output options; currently, <code>'mean'</code>, <code>'model'</code>,
and <code>'all'</code>; but please note these are in development and may be
subject to change.</p>
</td></tr>
<tr><td><code id="isolate.signal_+3A_...">...</code></td>
<td>
<p>other arguments; ignore for now (in development)</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>isolateContribution</code> estimates and
subtracts <code>pollutant</code> variance associated with
factors that may hinder break-point/segment analysis:
</p>

<ul>
<li> <p><strong>Background Correction</strong> If applied, this fits
the supplied <code>background</code> time-series as a
spline term: <code>s(background)</code>.
</p>
</li>
<li> <p><strong>Seasonality</strong> If applied, this fits regular
frequency terms, e.g. <code>day.hour</code>, <code>year.day</code>,
as spline terms, default TRUE is equivalent to
<code>s(day.hour)</code> and <code>s(year.day)</code>. All terms are
calculated from <code>date</code> column in <code>data</code>.
</p>
</li>
<li> <p><strong>Weather</strong> If applied, this fits time-series of
identified meteorological measurements, e.g. wind speed
and direction (<code>ws</code> and <code>wd</code> in <code>data</code>).
If both <code>ws</code> and <code>wd</code> are present these are
fitted as a tensor term <code>te(ws, wd)</code>. Other
<code>deweather</code>ing terms, if included, are fitted
as spline term <code>s(term)</code>. The default <code>TRUE</code>
is equivalent to <code>te(ws, wd)</code>.
</p>
</li></ul>

<p>Using the supplied arguments, it builds a signal
(<code><a href="mgcv.html#topic+mgcv">mgcv</a></code>) GAM model, calculates,
and returns the mean-centred residuals as an
estimate of the isolated local contribution.
</p>


<h3>Value</h3>

<p><code>isolateContribution</code> returns a vector of
predictions of the <code>pollutant</code> time-series after
the requested signal isolation.
</p>


<h3>Note</h3>

<p><code>method</code> was included as part of method
development and testing work, and retained for now.
Please ignore for now.
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p>Regarding <code><a href="mgcv.html#topic+mgcv">mgcv</a></code> GAM fitting methods, see
Wood (2017) for general introduction and package
documentation regarding coding (<code><a href="mgcv.html#topic+mgcv">mgcv</a></code>):
</p>
<p>Wood, S.N. (2017) Generalized Additive Models:
an introduction with R (2nd edition), Chapman and Hall/CRC.
</p>
<p>Regarding <code>isolateContribution</code>, see:
</p>
<p>Ropkins, K., Walker, A., Philips, I., Rushton, C., Clark, T. and
Tate, J., Change Detection of Air Quality Time-Series Using the
R Package AEQval. Available at SSRN 4267722.
https://ssrn.com/abstract=4267722 or http://dx.doi.org/10.2139/ssrn.4267722
Also at: https://karlropkins.github.io/AQEval/articles/AQEval_Intro_Preprint.pdf
</p>


<h3>See Also</h3>

<p>Regarding seasonal terms and frequency
analysis, see also <code><a href="stats.html#topic+stl">stl</a></code> and
<code><a href="#topic+spectralFrequency">spectralFrequency</a></code>.
</p>
<p><code><a href="mgcv.html#topic+mgcv">mgcv</a></code>, <code><a href="mgcv.html#topic+gam">gam</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#fitting a simple deseasonalisation, deweathering
#and background correction (dswb) model to no2:

aq.data$dswb.no2 &lt;- isolateContribution(aq.data,
                        "no2", background="bg.no2")

#compare at 14 day resolution:
temp &lt;- openair::timeAverage(aq.data, "14 day")

#without dswb
quantBreakPoints(temp, "no2", test=FALSE, h=0.1)

#with dswb
quantBreakPoints(temp, "dswb.no2", test=FALSE, h=0.1)
</code></pre>

<hr>
<h2 id='other.aq.models'>Other Air Quality Models</h2><span id='topic+other.aq.models'></span><span id='topic+fitNearSiteModel'></span>

<h3>Description</h3>

<p>Other packaged Air Quality Models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fitNearSiteModel(data, pollutant = "no2", y, x = "rest", elements = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="other.aq.models_+3A_data">data</code></td>
<td>
<p><code>data.frame</code> (or similar) containing data-series
to be modelled; this is expected to contain 'date', 'site'
and pollutant of interest data-series.</p>
</td></tr>
<tr><td><code id="other.aq.models_+3A_pollutant">pollutant</code></td>
<td>
<p>The name of the <code>pollutant</code> (in
<code>data</code>) to model, by default 'NO2'.</p>
</td></tr>
<tr><td><code id="other.aq.models_+3A_y">y</code></td>
<td>
<p>The name of the monitor site to be modelled,
assumed to be one several names in the <code>site</code> column of
<code>data</code>.</p>
</td></tr>
<tr><td><code id="other.aq.models_+3A_x">x</code></td>
<td>
<p>The other sites to use when building the model, the
default 'rest' uses all supplied sites except 'y'.</p>
</td></tr>
<tr><td><code id="other.aq.models_+3A_elements">elements</code></td>
<td>
<p>The number of inputs to use in the
site models, can be any number up to length of x or
combination thereof; by default this is set as
<code>length(x):1</code></p>
</td></tr>
<tr><td><code id="other.aq.models_+3A_...">...</code></td>
<td>
<p>extra arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>fitNearSiteModel</code> builds an air quality
model for one location using air quality data from nearby
sites.
</p>


<h3>Value</h3>

<p><code>data</code> with model output added as additional
column.
</p>

<hr>
<h2 id='quantify.breaks'>quantify break-point/segments</h2><span id='topic+quantify.breaks'></span><span id='topic+quantBreakPoints'></span><span id='topic+quantBreakSegments'></span>

<h3>Description</h3>

<p>Quantify either break-points or
break-segment methods for pollutant time-series
</p>


<h3>Usage</h3>

<pre><code class='language-R'>quantBreakPoints(
  data,
  pollutant,
  breaks,
  ylab = NULL,
  xlab = NULL,
  pt.col = c("lightgrey", "darkgrey"),
  line.col = "red",
  break.col = "blue",
  event = NULL,
  show = c("plot", "report"),
  ...
)

quantBreakSegments(
  data,
  pollutant,
  breaks,
  ylab = NULL,
  xlab = NULL,
  pt.col = c("lightgrey", "darkgrey"),
  line.col = "red",
  break.col = "blue",
  event = NULL,
  seg.method = 2,
  seg.seed = 12345,
  show = c("plot", "report"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="quantify.breaks_+3A_data">data</code></td>
<td>
<p>Data source, typically a data.frame or similar,
containing data-series to model and a paired time-stamp
data-series, named date.</p>
</td></tr>
<tr><td><code id="quantify.breaks_+3A_pollutant">pollutant</code></td>
<td>
<p>The name of the data-series to
break-point or break-segment model.</p>
</td></tr>
<tr><td><code id="quantify.breaks_+3A_breaks">breaks</code></td>
<td>
<p>(Optional) The break-points and
confidence intervals to use when building either
break-point or break-segment models. If not supplied
these are build using <code><a href="#topic+findBreakPoints">findBreakPoints</a></code>
and supplied arguments.</p>
</td></tr>
<tr><td><code id="quantify.breaks_+3A_ylab">ylab</code></td>
<td>
<p>Y-label term, by default pollutant.</p>
</td></tr>
<tr><td><code id="quantify.breaks_+3A_xlab">xlab</code></td>
<td>
<p>X-label term, by default date.</p>
</td></tr>
<tr><td><code id="quantify.breaks_+3A_pt.col">pt.col</code></td>
<td>
<p>Point fill and line colours for plot,
defaults lightgrey and darkgrey.</p>
</td></tr>
<tr><td><code id="quantify.breaks_+3A_line.col">line.col</code></td>
<td>
<p>Line colour for plot, default red.</p>
</td></tr>
<tr><td><code id="quantify.breaks_+3A_break.col">break.col</code></td>
<td>
<p>Break-point/segment colour for plot, default
blue.</p>
</td></tr>
<tr><td><code id="quantify.breaks_+3A_event">event</code></td>
<td>
<p>An optional list of plot terms for an event
marker, applied to a vertical line and text label. List
items include: <code>x</code> the event date (YYYY-MM-DD format)
require for both line and label; <code>y</code> by default 0.9 x
y-plot range; <code>label</code> the label text, required for
label; <code>line.size</code> the line width, by default 0.5;
<code>font.size</code> the text size, by default 5; and,
<code>hjust</code> the label left/right justification, 0 left,
0.5 centre, 1 right (default). See also examples below.</p>
</td></tr>
<tr><td><code id="quantify.breaks_+3A_show">show</code></td>
<td>
<p>What to show before returning the break-point
quantification mode, by default plot and report.</p>
</td></tr>
<tr><td><code id="quantify.breaks_+3A_...">...</code></td>
<td>
<p>other parameters</p>
</td></tr>
<tr><td><code id="quantify.breaks_+3A_seg.method">seg.method</code></td>
<td>
<p>(<code>quantBreakSegments</code> only) the
break-segment fitting method to use.</p>
</td></tr>
<tr><td><code id="quantify.breaks_+3A_seg.seed">seg.seed</code></td>
<td>
<p>(<code>quantBreakSegments</code> only) the
seed setting to use when fitting break-segments, default
<code>12345</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>quantBreakPoints</code> and
<code>quantBreakSegments</code> both use
<code>strucchange</code> methods to identify potential
break-points in time-series, and then quantify
these as conventional break-points or break-segments,
respectively:
</p>

<ul>
<li> <p><strong>Finding Break-points</strong> Using the
<code>strucchange</code> methods of Zeileis and colleagues
and independent change detection model, the functions
apply a rolling-window approach, assuming the first
window (or data subset) is without change, building a
statistical model of that, advancing the window,
building a second model and comparing these, and so on,
to identify the most likely points of change in a
larger data-series. See also <code><a href="#topic+findBreakPoints">findBreakPoints</a></code>
</p>
</li>
<li> <p><strong>Quantifying Break-points</strong> Using the
supplied break-points to build a break-point model.
</p>
</li>
<li> <p><strong>Quantifying Break-segments</strong> Using the
confidence regions for the supplied break-points as the
starting points to build a break-segment model.
</p>
</li></ul>



<h3>Value</h3>

<p>Both functions use the <code>show</code> argument
to control which elements of the functions outputs
are shown but also invisible return a <code>list</code>
of all outputs which can caught using, e.g.:
</p>
<p><code>brk.mod &lt;- quantBreakPoints(data, pollutant)</code>
</p>


<h3>Note</h3>

<p><code>AQEval</code> function <code>quantBreakSegments</code>
is currently running <code>segmented v.1.3-4</code> while we
evaluate latest version, <code>v.1.4-0</code>.
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p>Regarding <code>strucchange</code> methods see in-package
documentation, e.g. <code><a href="strucchange.html#topic+breakpoints">breakpoints</a></code>,
and:
</p>
<p>Achim Zeileis, Friedrich Leisch, Kurt Hornik and Christian Kleiber
(2002). strucchange: An R Package for Testing for Structural Change
in Linear Regression Models. Journal of Statistical Software, 7(2),
1-38. URL <a href="https://www.jstatsoft.org/v07/i02/">https://www.jstatsoft.org/v07/i02/</a>.
</p>
<p>Achim Zeileis, Christian Kleiber, Walter Kraemer and Kurt Hornik
(2003). Testing and Dating of Structural Changes in Practice.
Computational Statistics &amp; Data Analysis, 44, 109-123.
DOI <a href="https://doi.org/10.1016/S0167-9473%2803%2900030-6">doi:10.1016/S0167-9473(03)00030-6</a>.
</p>
<p>Regarding <code>segmented</code> methods see in-package
documentation, e.g.
<code><a href="segmented.html#topic+segmented">segmented</a></code>, and:
</p>
<p>Vito M. R. Muggeo (2003). Estimating regression models
with unknown break-points. Statistics in Medicine, 22,
3055-3071. DOI 10.1002/sim.1545.
</p>
<p>Vito M. R. Muggeo (2008). segmented: an R Package to
Fit Regression Models with Broken-Line Relationships.
R News, 8/1, 20-25.
URL <a href="https://cran.r-project.org/doc/Rnews/">https://cran.r-project.org/doc/Rnews/</a>.
</p>
<p>Vito M. R. Muggeo (2016). Testing with a nuisance
parameter present only under the alternative: a
score-based approach with application to segmented
modelling. J of Statistical Computation and Simulation,
86, 3059-3067.
DOI 10.1080/00949655.2016.1149855.
</p>
<p>Vito M. R. Muggeo (2017). Interval estimation for the
breakpoint in segmented regression: a smoothed
score-based approach. Australian &amp; New Zealand Journal
of Statistics, 59, 311-322.
DOI 10.1111/anzs.12200.
</p>
<p>Regarding break-points/segment methods, see:
</p>
<p>Ropkins, K., Walker, A., Philips, I., Rushton, C., Clark, T. and
Tate, J., Change Detection of Air Quality Time-Series Using the
R Package AEQval. Available at SSRN 4267722.
https://ssrn.com/abstract=4267722 or http://dx.doi.org/10.2139/ssrn.4267722
Also at: https://karlropkins.github.io/AQEval/articles/AQEval_Intro_Preprint.pdf
</p>


<h3>See Also</h3>

<p><code><a href="openair.html#topic+timeAverage">timeAverage</a></code> in <code>openair</code>,
<code><a href="strucchange.html#topic+breakpoints">breakpoints</a></code> in <code>strucchange</code>, and
<code><a href="segmented.html#topic+segmented">segmented</a></code> in <code>segmented</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#using openair timeAverage to covert 1-hour data to 1-day averages

temp &lt;- openair::timeAverage(aq.data, "1 day")

#break-points

quantBreakPoints(temp, "no2", h=0.3)

#break-segments

quantBreakSegments(temp, "no2", h=0.3)

#addition examples (not run)
## Not run: 
#in-call plot modification
#removing x axis label
#recolouring break line and
#adding an event marker
quantBreakPoints(temp, "no2", h=0.3,
       xlab="", break.col = "red",
       event=list(label="Event expected here",
                 x="2002-08-01", col="grey"))

## End(Not run)
</code></pre>

<hr>
<h2 id='spectral.analysis'>Spectral Analysis</h2><span id='topic+spectral.analysis'></span><span id='topic+spectralFrequency'></span>

<h3>Description</h3>

<p>Time-series spectral frequency analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spectralFrequency(data, pollutant, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="spectral.analysis_+3A_data">data</code></td>
<td>
<p><code>data.frame</code> holding data to be analysed,
expected to contain a timestamp data-series called
<code>date</code> and a measurement time-series to be analysed
identified using the <code>pollutant</code> argument.</p>
</td></tr>
<tr><td><code id="spectral.analysis_+3A_pollutant">pollutant</code></td>
<td>
<p>The name of the time-series,
typically pollutant measurements, to be analysed.</p>
</td></tr>
<tr><td><code id="spectral.analysis_+3A_...">...</code></td>
<td>
<p>extra arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>spectralFrequency</code> producing a
time frequency analysis of the requested
<code>pollutant</code>.
</p>


<h3>Value</h3>

<p><code>spectralFrequency</code> uses the <code>show</code>
argument to control which elements of the functions outputs
are shown but also invisibly returns a <code>list</code>
of all outputs which can caught using, e.g.:
</p>
<p><code>sfa.mod &lt;- spectralFrequency(data, pollutant)</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>spectralFrequency(aq.data, "no2")
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
