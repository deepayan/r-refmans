<!DOCTYPE html><html lang="en"><head><title>Help for package HGDMr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {HGDMr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#HGDMr-package'><p>The Hysteretic and Gatekeeping Depressions Model (HGDM)</p></a></li>
<li><a href='#area_frac'><p>Determines if area-volume estimation is by equation or rating</p></a></li>
<li><a href='#daily_7120951600'><p>daily basin 7120951600 PHyDAP fluxes</p></a></li>
<li><a href='#HGDM'><p>Applies HGDM to forcings</p></a></li>
<li><a href='#linear_hysteresis_CF'><p>Calculates connected/contributing fraction</p></a></li>
<li><a href='#vol2area_rating'><p>Convert depressional storage volume to area</p></a></li>
<li><a href='#volfrac2areafrac_Clark'><p>Estimates total depressional water area fraction</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Hysteretic and Gatekeeping Depressions Model</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2025-02-19</td>
</tr>
<tr>
<td>Author:</td>
<td>Kevin Shook [cre, aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Kevin Shook &lt;kevin.shook@usask.ca&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Implementation of the Hysteretic and Gatekeeping Depressions Model (HGDM) which calculates variable connected/contributing areas and resulting discharge volumes in prairie basins dominated by depressions ("slough" or "potholes"). The small depressions are combined into a single "meta" depression which explicitly models the hysteresis between the storage of water and the connected/contributing areas of the depressions. The largest (greater than 5% of the total depressional area) depression (if it exists) is represented separately to model its gatekeeping, i.e. the blocking of upstream flows until it is filled. The methodolgy is described in detail in Shook and Pomeroy (2025, &lt;<a href="https://doi.org/10.1016%2Fj.jhydrol.2025.132821">doi:10.1016/j.jhydrol.2025.132821</a>&gt;).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/CentreForHydrology/HGDMr">https://github.com/CentreForHydrology/HGDMr</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>stringr, stats</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, testthat, rmarkdown, readr, ggplot2</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-02-21 13:14:12 UTC; kevin</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-02-21 20:20:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='HGDMr-package'>The Hysteretic and Gatekeeping Depressions Model (HGDM)</h2><span id='topic+HGDMr'></span><span id='topic+HGDMr-package'></span>

<h3>Description</h3>

<p><span class="pkg">HGDMr</span> is an implementation of the Hysteretic and Gatekeeping 
Depressions Model (HGDM) which is a one-dimensional model of the effects of
varying connected/contributing fractions of Canadian Prairie basins.
</p>
<p>Using specified fluxes (rainfall, snowmelt, upland runoff and evaporation), HGDM
computes a) the time-varying connected/contributing fraction of a basin having
depressional storage and b) the depth of discharge in each time interval.
</p>
<p>Note that this model does not route the flows through the basin. This would require
the use of another <span class="rlang"><b>R</b></span> package, such as <span class="pkg">RHMS</span>, which has the function 'reachRouting'.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Kevin Shook <a href="mailto:kevin.shook@usask.ca">kevin.shook@usask.ca</a>
</p>


<h3>References</h3>

<p>Shook, Kevin R., and John W. Pomeroy. “The Hysteretic and Gatekeeping Depressions Model - A New Model for Variable Connected Fractions of Prairie Basins.” Journal of Hydrology 654 (June 1, 2025): 132821. https://doi.org/10.1016/j.jhydrol.2025.132821.
</p>
<p>Shook, Kevin R., Zhihua He, John W. Pomeroy, Chris Spence, and Colin J. Whitfield. “A Practitioner-Oriented Regional Hydrology Data Product for Use in Site-Specific Hydraulic Applications.” Scientific Data 11, no. 1 (October 14, 2024): 1125. https://doi.org/10.1038/s41597-024-03962-1.
</p>
<p>Clark, Martyn P., and Kevin R. Shook. “The Numerical Formulation of Simple Hysteretic Models to Simulate the Large-Scale Hydrological Impacts of Prairie Depressions.” Water Resources Research 58, no. 12 (2022): e2022WR032694. https://doi.org/10.1029/2022WR032694.
</p>
<p>Shook, Kevin, Simon Papalexiou, and John W. Pomeroy. “Quantifying the Effects of Prairie Depressional Storage Complexes on Drainage Basin Connectivity.” Journal of Hydrology 593 (February 1, 2021): 125846. https://doi.org/10.1016/j.jhydrol.2020.125846.
</p>
<p>Shook, Kevin, John W Pomeroy, Christopher Spence, and Lyle Boychuk. “Storage Dynamics Simulations in Prairie Wetland Hydrology Models: Evaluation and Parameterization.” Hydrological Processes 27, no. 13 (June 2013): 1875–89. https://doi.org/10.1002/hyp.9867.
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/CentreForHydrology/HGDMr">https://github.com/CentreForHydrology/HGDMr</a>
</p>
</li></ul>


<hr>
<h2 id='area_frac'>Determines if area-volume estimation is by equation or rating</h2><span id='topic+area_frac'></span>

<h3>Description</h3>

<p>Determines if area-volume estimation is by equation or rating
</p>


<h3>Usage</h3>

<pre><code class='language-R'>area_frac(volume, max_volume, max_area = NULL, rating_parameters)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="area_frac_+3A_volume">volume</code></td>
<td>
<p>Volume of water in depressional storage</p>
</td></tr>
<tr><td><code id="area_frac_+3A_max_volume">max_volume</code></td>
<td>
<p>Volume of depression</p>
</td></tr>
<tr><td><code id="area_frac_+3A_max_area">max_area</code></td>
<td>
<p>Area of depression</p>
</td></tr>
<tr><td><code id="area_frac_+3A_rating_parameters">rating_parameters</code></td>
<td>
<p>Parameters for estimating water area fraction</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns water area fraction
</p>


<h3>Author(s)</h3>

<p>Kevin Shook
</p>


<h3>Examples</h3>

<pre><code class='language-R'>water_area_frac &lt;- area_frac(1000, 2000, NULL, 1.2)
</code></pre>

<hr>
<h2 id='daily_7120951600'>daily basin 7120951600 PHyDAP fluxes</h2><span id='topic+daily_7120951600'></span>

<h3>Description</h3>

<p>A dataframe of daily CRHM fluxes modelled for basin 7120951600. The fluxes were taken from
the PHyDAP project <a href="https://www.frdr-dfdr.ca/repo/dataset/7ce4bd7a-4bcc-4f8c-8129-32a691f46c8e">https://www.frdr-dfdr.ca/repo/dataset/7ce4bd7a-4bcc-4f8c-8129-32a691f46c8e</a> hourly outputs
of CRHM models forced with ERA5 data over the period 1950-2020. The fluxes were then aggregated to daily values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>daily_7120951600
</code></pre>


<h3>Format</h3>

<p>A dateframe with 25932 rows and 5 columns spanning the period 1950-2020.
</p>


<h3>Details</h3>

<p>Variables: 
</p>

<dl>
<dt>date</dt><dd><p>R date</p>
</dd>
<dt>rainfall</dt><dd><p>Daily rainfall on water (mm)</p>
</dd>
<dt>snowmelt</dt><dd><p>Daily snow melt on water (mm)</p>
</dd>
<dt>runoff</dt><dd><p>Daily upland runoff (mm)</p>
</dd>
<dt>evap</dt><dd><p>Daily water evaporation (mm) </p>
</dd>
</dl>



<h3>Source</h3>

<p>PHyDAP
</p>


<h3>References</h3>

<p>Shook, Kevin R., Zhihua He, John W. Pomeroy, Chris Spence, and Colin J. Whitfield. “A Practitioner-Oriented Regional Hydrology Data Product for Use in Site-Specific Hydraulic Applications.” Scientific Data 11, no. 1 (October 14, 2024): 1125. https://doi.org/10.1038/s41597-024-03962-1.
</p>

<hr>
<h2 id='HGDM'>Applies HGDM to forcings</h2><span id='topic+HGDM'></span>

<h3>Description</h3>

<p>Applies the Hysteretic and Gatekeeping Depressions Model to basin-scale fluxes determined
by hydrological modelling to calculate the outflows during a given time interval. Note
than no routing is performed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HGDM(
  upland_area = NULL,
  small_depression_area = NULL,
  large_depression_area = NULL,
  area_units = "km2",
  max_small_depression_storage = 0,
  max_large_depression_storage = 0,
  initial_small_depression_storage = 0,
  initial_large_depression_storage = 0,
  storage_units = "mm",
  small_depressions_initial_connected_fraction = 0,
  upland_fraction_to_small = 0,
  upland_fraction_to_large = 0,
  upland_fraction_to_outlet = 0,
  small_fraction_to_large = 0,
  forcings = NULL,
  small_p = NULL,
  large_rating = 0,
  sub_intervals = 1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="HGDM_+3A_upland_area">upland_area</code></td>
<td>
<p>Required. Area of uplands, which drain to the outlet, 
small depressions or the large depression.</p>
</td></tr>
<tr><td><code id="HGDM_+3A_small_depression_area">small_depression_area</code></td>
<td>
<p>Required. Area of small depressions.</p>
</td></tr>
<tr><td><code id="HGDM_+3A_large_depression_area">large_depression_area</code></td>
<td>
<p>Optional. If <code>0</code> or <code>NULL</code> large depression is not \
modelled.</p>
</td></tr>
<tr><td><code id="HGDM_+3A_area_units">area_units</code></td>
<td>
<p>Units of all areas. Must be one of <span class="option">km2</span> (default), <span class="option">ha</span> or <span class="option">m2</span>.</p>
</td></tr>
<tr><td><code id="HGDM_+3A_max_small_depression_storage">max_small_depression_storage</code></td>
<td>
<p>Maximum depth of storage in small depressions.</p>
</td></tr>
<tr><td><code id="HGDM_+3A_max_large_depression_storage">max_large_depression_storage</code></td>
<td>
<p>Maximum depth of storage in large depressions.</p>
</td></tr>
<tr><td><code id="HGDM_+3A_initial_small_depression_storage">initial_small_depression_storage</code></td>
<td>
<p>Initial depth of storage in small depressions.</p>
</td></tr>
<tr><td><code id="HGDM_+3A_initial_large_depression_storage">initial_large_depression_storage</code></td>
<td>
<p>Initial depth of storage in large depressions.</p>
</td></tr>
<tr><td><code id="HGDM_+3A_storage_units">storage_units</code></td>
<td>
<p>Units of all storage depths. Must be one of <span class="option">mm</span> (default) <span class="option">m</span>,
or <span class="option">m3</span>. If a depth is specified then it will be converted to a volume by multiplying
by the appropriate area.</p>
</td></tr>
<tr><td><code id="HGDM_+3A_small_depressions_initial_connected_fraction">small_depressions_initial_connected_fraction</code></td>
<td>
<p>Initial connected fraction (0-1).</p>
</td></tr>
<tr><td><code id="HGDM_+3A_upland_fraction_to_small">upland_fraction_to_small</code></td>
<td>
<p>Fraction of uplands draining to small depressions. If <code>0</code> then
the small depressions are unlikely to fill.</p>
</td></tr>
<tr><td><code id="HGDM_+3A_upland_fraction_to_large">upland_fraction_to_large</code></td>
<td>
<p>Fraction of uplands draining to large depression. This is
the basin of the large depression.</p>
</td></tr>
<tr><td><code id="HGDM_+3A_upland_fraction_to_outlet">upland_fraction_to_outlet</code></td>
<td>
<p>Fraction of uplands draining directly to outlet. Analogous
to the effective fraction.</p>
</td></tr>
<tr><td><code id="HGDM_+3A_small_fraction_to_large">small_fraction_to_large</code></td>
<td>
<p>Fraction of small depression area draining into large depression.
Governed by location of large depression in the basin.</p>
</td></tr>
<tr><td><code id="HGDM_+3A_forcings">forcings</code></td>
<td>
<p>Required. A data frame of time series of <code>rainfall</code>, <code>snowmelt</code>,
<code>evap</code>, and <code>runoff</code>. The first variable must be either <code>date</code> (an
<span class="pkg">R</span> date) or <code>datetime</code> (a POSIXct date-time).</p>
</td></tr>
<tr><td><code id="HGDM_+3A_small_p">small_p</code></td>
<td>
<p>Parameter for small depression water volume-area relationship.</p>
</td></tr>
<tr><td><code id="HGDM_+3A_large_rating">large_rating</code></td>
<td>
<p>Rating curve parameters for large depression.</p>
</td></tr>
<tr><td><code id="HGDM_+3A_sub_intervals">sub_intervals</code></td>
<td>
<p>Number of sub-intervals for solution of each time step.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a data frame. Depending on whether or not a large depression was
specified, the data frame will have differing variables. Note that regardless of the 
units specified for areas and volumes, all of the variables returned are in SI
dimensions, i.e. 'm' and 'm<code class="reqn">^3</code>/s'
values
</p>
<p>If no large depression is specified, the returned variables are:
</p>

<dl>
<dt>date or datetime</dt><dd><p><span class="rlang"><b>R</b></span> date or POSIXct datetime.</p>
</dd>
<dt>total_contrib_frac</dt><dd><p>The connected/contributing fraction of the basin. Includes both the meta depression and the upland fraction connected to the outlet.</p>
</dd>
<dt>total_outflow_volume</dt><dd><p>The volume of outflow (m <code class="reqn">^3</code>) in the interval.</p>
</dd>
<dt>small_depression_contrib_frac</dt><dd><p>The connected/contributing fraction of the meta depression.</p>
</dd>
<dt>small_depression_water_volume</dt><dd><p>The volume of water (m <code class="reqn">^3</code>) retained in the meta depression.</p>
</dd>
<dt>small_depression_water_depth</dt><dd><p>The depth of water (m) retained in the meta depression.</p>
</dd>
<dt>small_depression_water_area</dt><dd><p>The area of water (m  <code class="reqn">^2</code>) retained in the meta depression.</p>
</dd>
</dl>

<p>If there is a large depression, then 'total_contrib_frac' includes the effect of the large
depression and the additional variables are also returned:
</p>

<dl>
<dt>date or datetime</dt><dd><p><span class="rlang"><b>R</b></span> date or POSIXct datetime.</p>
</dd>
<dt>large_depression_contrib_frac</dt><dd><p>The connected/contributing fraction of the large depression.</p>
</dd>
<dt>large_depression_water_volume</dt><dd><p>The volume of water (m <code class="reqn">^3</code>) retained in the large depression.</p>
</dd>
<dt>large_depression_water_area</dt><dd><p>The area of water (m  <code class="reqn">^2</code>) retained in the large depression.</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>{ 
daily_fluxes &lt;- daily_7120951600  
basin_area &lt;- 100
small_depression_frac &lt;- 0.24
small_depression_area &lt;- small_depression_frac * basin_area
large_depression_area &lt;- 0
upland_area &lt;- basin_area - (small_depression_area + large_depression_area)
area_units &lt;- "km2"
max_small_depression_storage &lt;- 300
max_large_depression_storage &lt;- 0
initial_small_depression_storage &lt;- max_small_depression_storage / 2
initial_large_depression_storage &lt;- max_large_depression_storage / 2
storage_units &lt;- "mm"
small_depressions_initial_connected_fraction &lt;- 0
upland_fraction_to_small &lt;- 0.98
upland_fraction_to_large &lt;- 0
upland_fraction_to_outlet &lt;- 0.02
small_fraction_to_large &lt;- 0
small_p &lt;- 1.2
large_rating &lt;- 1.4
sub_intervals &lt;- 1

results &lt;- HGDM(upland_area, 
small_depression_area, 
large_depression_area = 0, 
area_units = "km2", max_small_depression_storage, 
max_large_depression_storage,
initial_small_depression_storage, 
initial_large_depression_storage,
storage_units,
small_depressions_initial_connected_fraction,
upland_fraction_to_small,
upland_fraction_to_large,
upland_fraction_to_outlet,
small_fraction_to_large,
forcings = daily_fluxes[1:100,],
small_p = small_p,
large_rating = large_rating,
sub_intervals = sub_intervals)
}
</code></pre>

<hr>
<h2 id='linear_hysteresis_CF'>Calculates connected/contributing fraction</h2><span id='topic+linear_hysteresis_CF'></span>

<h3>Description</h3>

<p>Calculates connected/contributing fraction
</p>


<h3>Usage</h3>

<pre><code class='language-R'>linear_hysteresis_CF(
  current_storage = 0,
  delta_storage = 0,
  max_storage = 0,
  current_contrib_frac = 0,
  threshold = -0.01
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="linear_hysteresis_CF_+3A_current_storage">current_storage</code></td>
<td>
<p>Current storage volume</p>
</td></tr>
<tr><td><code id="linear_hysteresis_CF_+3A_delta_storage">delta_storage</code></td>
<td>
<p>Change in volume</p>
</td></tr>
<tr><td><code id="linear_hysteresis_CF_+3A_max_storage">max_storage</code></td>
<td>
<p>Maximum possible storage volume</p>
</td></tr>
<tr><td><code id="linear_hysteresis_CF_+3A_current_contrib_frac">current_contrib_frac</code></td>
<td>
<p>Current contributing fraction (0-1)</p>
</td></tr>
<tr><td><code id="linear_hysteresis_CF_+3A_threshold">threshold</code></td>
<td>
<p>Threshold for change in storage to set connected fraction to zero.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the updated connected/contributing fraction
</p>


<h3>Author(s)</h3>

<p>Kevin Shook
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cf &lt;- linear_hysteresis_CF(current_storage = 50,
delta_storage = 10, max_storage = 100, current_contrib_frac = 0)
</code></pre>

<hr>
<h2 id='vol2area_rating'>Convert depressional storage volume to area</h2><span id='topic+vol2area_rating'></span>

<h3>Description</h3>

<p>Convert depressional storage volume to area
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vol2area_rating(rating_curve, volumes, method = "linear")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vol2area_rating_+3A_rating_curve">rating_curve</code></td>
<td>
<p>Required. Data frame containing the variables <code>area</code> and <code>volume</code>.</p>
</td></tr>
<tr><td><code id="vol2area_rating_+3A_volumes">volumes</code></td>
<td>
<p>A scalar or vector of depression storage volumes.</p>
</td></tr>
<tr><td><code id="vol2area_rating_+3A_method">method</code></td>
<td>
<p>Method for interpolation. Default is <span class="option">linear</span>. Alternatively, 
a spline can be fitted by specifying <code>method = "spline"</code> and any other options used by the function <code>spline</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a scalar or vector of lake stages
</p>


<h3>Author(s)</h3>

<p>Kevin Shook
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{
rating_curve &lt;- data.frame(area=1:10, volume=seq(10, 100, 10))
a &lt;- vol2area_rating(rating_curve, 55)
}
</code></pre>

<hr>
<h2 id='volfrac2areafrac_Clark'>Estimates total depressional water area fraction</h2><span id='topic+volfrac2areafrac_Clark'></span>

<h3>Description</h3>

<p>Estimates total depressional water area fraction
</p>


<h3>Usage</h3>

<pre><code class='language-R'>volfrac2areafrac_Clark(volume_frac, p)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="volfrac2areafrac_Clark_+3A_volume_frac">volume_frac</code></td>
<td>
<p>Fraction of depressional storage</p>
</td></tr>
<tr><td><code id="volfrac2areafrac_Clark_+3A_p">p</code></td>
<td>
<p>Exponent</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the fractional water area
</p>


<h3>Author(s)</h3>

<p>Kevin Shook
</p>


<h3>Examples</h3>

<pre><code class='language-R'>areafrac &lt;- volfrac2areafrac_Clark(0.5, 1.2)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
