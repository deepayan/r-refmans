<!DOCTYPE html><html lang="en"><head><title>Help for package MultiNMix</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {MultiNMix}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#AIC+2CMNM-method'><p>AIC Method for &quot;MNM&quot; Class</p></a></li>
<li><a href='#BIC+2CMNM-method'><p>BIC Method for &quot;MNM&quot; Class</p></a></li>
<li><a href='#birds'><p>Birds Dataset -  Subset of the North American Breeding Bird Survey Dataset</p></a></li>
<li><a href='#birds_ZI'><p>Zero-Inflated Birds Dataset - Subset of the North American Breeding Bird Survey Dataset</p></a></li>
<li><a href='#check_convergence'><p>Convergence Check Generic Function</p></a></li>
<li><a href='#check_convergence+2CMNM-method'><p>Convergence Check for &quot;MNM&quot; Class</p></a></li>
<li><a href='#density+2CMNM-method'><p>Density Plot Method for &quot;MNM&quot; Class</p></a></li>
<li><a href='#distribution_args'><p>List of Valid Nimble Distributions and Their Arguments</p></a></li>
<li><a href='#logLik+2CMNM-method'><p>Log-Likelihood Method for &quot;MNM&quot; Class</p></a></li>
<li><a href='#MNM'><p>Fit a Multi-Species N-Mixture Model (MNM) using Nimble</p></a></li>
<li><a href='#MNM_AR'><p>Fit a Multi-Species N-Mixture Model with AR-1 Using Nimble</p></a></li>
<li><a href='#MNM_control'><p>Generate Nimble Code for Multi-Species N-Mixture (MNM) Models</p></a></li>
<li><a href='#MNM_fit'><p>Fit a Multi-Species N-Mixture (MNM) Model in Nimble</p></a></li>
<li><a href='#MNM_Hurdle'><p>Fit a Multi-Species N-Mixture Model with Hurdle Component using Nimble</p></a></li>
<li><a href='#MNM_Hurdle_AR'><p>Fit a multi-species N-mixture (MNM) Hurdle-AR  model using Nimble</p></a></li>
<li><a href='#MNM-class'><p>Multi-Species N-Mixture (MNM) Model Class</p></a></li>
<li><a href='#predictY'><p>Predict Fitted Values for &quot;MNM&quot; Class</p></a></li>
<li><a href='#simulateData'><p>Simulate Data for Multi-Species N-Mixture Models</p></a></li>
<li><a href='#tracePlot'><p>Trace Plot Generic and Method for &quot;MNM&quot; Class</p></a></li>
<li><a href='#validate_all_priors'><p>Validate User-Specified Priors for Nimble Models</p></a></li>
<li><a href='#validate_prior'><p>Validate User-Specified Prior for a Single Prior</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Multi-Species N-Mixture (MNM) Models with 'nimble'</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Simulating data and fitting multi-species N-mixture models using 'nimble'. Includes features for handling zero-inflation and temporal correlation, Bayesian inference, model diagnostics, parameter estimation, and predictive checks. Designed for ecological studies with zero-altered or time-series data. Mimnagh, N., Parnell, A., Prado, E., &amp; Moral, R. A. (2022) &lt;<a href="https://doi.org/10.1007%2Fs10651-022-00542-7">doi:10.1007/s10651-022-00542-7</a>&gt;. Royle, J. A. (2004) &lt;<a href="https://doi.org/10.1111%2Fj.0006-341X.2004.00142.x">doi:10.1111/j.0006-341X.2004.00142.x</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Imports:</td>
<td>clusterGeneration, mvtnorm, extraDistr, rstan, stats, abind,
methods, coda</td>
</tr>
<tr>
<td>Depends:</td>
<td>nimble, R (&ge; 3.5)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0), knitr, rmarkdown</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/niamhmimnagh/MultiNMix">https://github.com/niamhmimnagh/MultiNMix</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/niamhmimnagh/MultiNMix/issues">https://github.com/niamhmimnagh/MultiNMix/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-03-17 17:21:20 UTC; niamh</td>
</tr>
<tr>
<td>Author:</td>
<td>Niamh Mimnagh [aut, cre],
  Rafael de Andrade Moral [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Niamh Mimnagh &lt;niamhmimnagh@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-03-19 12:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='AIC+2CMNM-method'>AIC Method for &quot;MNM&quot; Class</h2><span id='topic+AIC+2CMNM-method'></span>

<h3>Description</h3>

<p>Computes the Akaike Information Criterion (AIC) for an object of class <code>"MNM"</code>.
AIC is a metric used for model comparison, balancing goodness of fit and model complexity.
</p>
<p>The formula for AIC is:
</p>
<p style="text-align: center;"><code class="reqn">AIC = -2 \cdot \log L + 2 \cdot k</code>
</p>

<p>where:
</p>

<ul>
<li> <p><code class="reqn">\log L</code> is the log-likelihood of the model.
</p>
</li>
<li> <p><code class="reqn">k</code> is the number of parameters in the model.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'MNM'
AIC(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="AIC+2B2CMNM-method_+3A_object">object</code></td>
<td>
<p>An object of class <code>"MNM"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value representing the AIC of the fitted model.
</p>

<hr>
<h2 id='BIC+2CMNM-method'>BIC Method for &quot;MNM&quot; Class</h2><span id='topic+BIC+2CMNM-method'></span>

<h3>Description</h3>

<p>Computes the Bayesian Information Criterion (BIC) for an object of class <code>"MNM"</code>.
BIC is a metric used for model comparison, accounting for goodness of fit and the size of the dataset.
</p>
<p>The formula for BIC is:
</p>
<p style="text-align: center;"><code class="reqn">BIC = -2 \cdot \log L + \log(n) \cdot k</code>
</p>

<p>where:
</p>

<ul>
<li> <p><code class="reqn">\log L</code> is the log-likelihood of the model.
</p>
</li>
<li> <p><code class="reqn">n</code> is the number of observations in the dataset.
</p>
</li>
<li> <p><code class="reqn">k</code> is the number of parameters in the model.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'MNM'
BIC(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="BIC+2B2CMNM-method_+3A_object">object</code></td>
<td>
<p>An object of class <code>"MNM"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value representing the BIC of the fitted model.
</p>

<hr>
<h2 id='birds'>Birds Dataset -  Subset of the North American Breeding Bird Survey Dataset</h2><span id='topic+birds'></span>

<h3>Description</h3>

<p>#' This dataset is a subset of the North American Breeding Bird Survey, containing data collected at 15 routes in Michigan, USA.
Each route has 10 stops, and the dataset includes counts for 10 bird species.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>birds
</code></pre>


<h3>Format</h3>

<p>A data frame with 600 rows and 13 columns:
</p>

<dl>
<dt>Route</dt><dd><p>An identifier for the 15 survey sites.</p>
</dd>
<dt>Year</dt><dd><p>The year of the survey (numeric).</p>
</dd>
<dt>English_Common_Name</dt><dd><p>The English common name of the bird species surveyed (character).</p>
</dd>
<dt>Stop1</dt><dd><p>Count for replicate 1 at the site (numeric).</p>
</dd>
<dt>Stop2</dt><dd><p>Count for replicate 2 at the site (numeric).</p>
</dd>
<dt>Stop3</dt><dd><p>Count for replicate 3 at the site (numeric).</p>
</dd>
<dt>Stop4</dt><dd><p>Count for replicate 4 at the site (numeric).</p>
</dd>
<dt>Stop5</dt><dd><p>Count for replicate 5 at the site (numeric).</p>
</dd>
<dt>Stop6</dt><dd><p>Count for replicate 6 at the site (numeric).</p>
</dd>
<dt>Stop7</dt><dd><p>Count for replicate 7 at the site (numeric).</p>
</dd>
<dt>Stop8</dt><dd><p>Count for replicate 8 at the site (numeric).</p>
</dd>
<dt>Stop9</dt><dd><p>Count for replicate 9 at the site (numeric).</p>
</dd>
<dt>Stop10</dt><dd><p>Count for replicate 10 at the site (numeric).</p>
</dd>
</dl>



<h3>Source</h3>

<p>North American Breeding Bird Survey (<a href="https://www.pwrc.usgs.gov/BBS/">https://www.pwrc.usgs.gov/BBS/</a>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'># MNM Model
#' # Example: Hurdle Model
# Data must first be reformatted to an array of dimension (R,T,S,K)
R &lt;- 15
T &lt;- 10
S &lt;- 10
K &lt;- 4
# Ensure data is ordered consistently
birds &lt;- birds[order(birds$Route, birds$Year, birds$English_Common_Name), ]

# Create a 4D array with proper dimension
Y &lt;- array(NA, dim = c(R, T, S, K))

# Map route, species, and year to indices
route_idx &lt;- as.numeric(factor(birds$Route))
species_idx &lt;- as.numeric(factor(birds$English_Common_Name))
year_idx &lt;- as.numeric(factor(birds$Year))

# Populate the array
stop_data &lt;- as.matrix(birds[, grep("^Stop", colnames(birds))])

for (i in seq_len(nrow(birds))) {
  Y[route_idx[i], , species_idx[i], year_idx[i]] &lt;- stop_data[i, ]
  }

  # Assign dimnames
  dimnames(Y) &lt;- list(
    Route = sort(unique(birds$Route)),
      Stop = paste0("Stop", 1:T),
        Species = sort(unique(birds$English_Common_Name)),
          Year = sort(unique(birds$Year))
          )

# Selecting only 5 bird species and 1 year for analysis:
Y&lt;-Y[,,1:5,1]

model&lt;-MNM_fit(Y=Y, AR=FALSE, Hurdle=FALSE)

</code></pre>

<hr>
<h2 id='birds_ZI'>Zero-Inflated Birds Dataset - Subset of the North American Breeding Bird Survey Dataset</h2><span id='topic+birds_ZI'></span>

<h3>Description</h3>

<p>This dataset is a subset of the North American Breeding Bird Survey, containing data collected at 24 routes in Michigan, USA.
Each route has 10 stops, and the dataset includes counts for 20 bird species.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>birds_ZI
</code></pre>


<h3>Format</h3>

<p>A data frame with 2,880 rows and 13 columns:
</p>

<dl>
<dt>Route</dt><dd><p>An identifier for the 24 survey sites.</p>
</dd>
<dt>Year</dt><dd><p>The year of the survey (numeric).</p>
</dd>
<dt>English_Common_Name</dt><dd><p>The English common name of the bird species surveyed (character).</p>
</dd>
<dt>Stop1</dt><dd><p>Count for replicate 1 at the site (numeric).</p>
</dd>
<dt>Stop2</dt><dd><p>Count for replicate 2 at the site (numeric).</p>
</dd>
<dt>Stop3</dt><dd><p>Count for replicate 3 at the site (numeric).</p>
</dd>
<dt>Stop4</dt><dd><p>Count for replicate 4 at the site (numeric).</p>
</dd>
<dt>Stop5</dt><dd><p>Count for replicate 5 at the site (numeric).</p>
</dd>
<dt>Stop6</dt><dd><p>Count for replicate 6 at the site (numeric).</p>
</dd>
<dt>Stop7</dt><dd><p>Count for replicate 7 at the site (numeric).</p>
</dd>
<dt>Stop8</dt><dd><p>Count for replicate 8 at the site (numeric).</p>
</dd>
<dt>Stop9</dt><dd><p>Count for replicate 9 at the site (numeric).</p>
</dd>
<dt>Stop10</dt><dd><p>Count for replicate 10 at the site (numeric).</p>
</dd>
</dl>



<h3>Details</h3>

<p>This dataset represents a subset of the North American Breeding Bird Survey. Data was collected in Michigan over six years,
with observations for 20 bird species recorded at 24 routes, each surveyed 10 times. The dataset is used
to study avian biodiversity and population trends.
</p>


<h3>Source</h3>

<p>North American Breeding Bird Survey (<a href="https://www.pwrc.usgs.gov/BBS/">https://www.pwrc.usgs.gov/BBS/</a>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(birds_ZI)
head(birds_ZI)

# Example: Hurdle Model
# Data must first be reformatted to an array of dimension (R,T,S,K)
R &lt;- 24
T &lt;- 10
S &lt;- 20
K &lt;- 6
# Ensure data is ordered consistently
birds_ZI &lt;- birds_ZI[order(birds_ZI$Route, birds_ZI$Year, birds_ZI$English_Common_Name), ]

# Create a 4D array with proper dimension
Y &lt;- array(NA, dim = c(R, T, S, K))

# Map route, species, and year to indices
route_idx &lt;- as.numeric(factor(birds_ZI$Route))
species_idx &lt;- as.numeric(factor(birds_ZI$English_Common_Name))
year_idx &lt;- as.numeric(factor(birds_ZI$Year))

# Populate the array
stop_data &lt;- as.matrix(birds_ZI[, grep("^Stop", colnames(birds))])

for (i in seq_len(nrow(birds))) {
  Y[route_idx[i], , species_idx[i], year_idx[i]] &lt;- stop_data[i, ]
  }

  # Assign dimnames
  dimnames(Y) &lt;- list(
    Route = sort(unique(birds_ZI$Route)),
      Stop = paste0("Stop", 1:T),
        Species = sort(unique(birds_ZI$English_Common_Name)),
          Year = sort(unique(birds_ZI$Year))
          )

# Selecting only 5 bird species  for analysis:
Y&lt;-Y[,,1:5,]

model&lt;-MNM_fit(Y=Y, AR=TRUE, Hurdle=TRUE)
</code></pre>

<hr>
<h2 id='check_convergence'>Convergence Check Generic Function</h2><span id='topic+check_convergence'></span>

<h3>Description</h3>

<p>A generic function for checking the convergence of an <code>"MNM"</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_convergence(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_convergence_+3A_object">object</code></td>
<td>
<p>An object of class <code>"MNM"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value indicating the number of parameters that meet the convergence criterion (Rhat &lt; 1.1).
</p>

<hr>
<h2 id='check_convergence+2CMNM-method'>Convergence Check for &quot;MNM&quot; Class</h2><span id='topic+check_convergence+2CMNM-method'></span>

<h3>Description</h3>

<p>Checks the convergence status of an object of class <code>"MNM"</code> based on convergence diagnostics (e.g., Rhat values).
Returns the number of parameters that meet the convergence criterion (Rhat &lt; 1.1).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'MNM'
check_convergence(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_convergence+2B2CMNM-method_+3A_object">object</code></td>
<td>
<p>An object of class <code>"MNM"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value indicating the number of converged parameters.
</p>

<hr>
<h2 id='density+2CMNM-method'>Density Plot Method for &quot;MNM&quot; Class</h2><span id='topic+density+2CMNM-method'></span>

<h3>Description</h3>

<p>Generates the density plot for a specified parameter stored in the MNM object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'MNM'
density(x, param, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="density+2B2CMNM-method_+3A_x">x</code></td>
<td>
<p>An object of class <code>"MNM"</code>.</p>
</td></tr>
<tr><td><code id="density+2B2CMNM-method_+3A_param">param</code></td>
<td>
<p>The name of the parameter to plot (e.g., <code>"N[8, 1]"</code>).</p>
</td></tr>
<tr><td><code id="density+2B2CMNM-method_+3A_...">...</code></td>
<td>
<p>Additional arguments (not used).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value; displays the density plot for the specified parameter.
</p>

<hr>
<h2 id='distribution_args'>List of Valid Nimble Distributions and Their Arguments</h2><span id='topic+distribution_args'></span>

<h3>Description</h3>

<p>A named list where each key is a valid Nimble distribution, and the value is a vector of the required arguments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>distribution_args
</code></pre>


<h3>Format</h3>

<p>A named list of length 19.
</p>


<h3>Details</h3>

<p>This object is used internally to validate user-specified prior distributions and their arguments in Nimble models.
</p>

<hr>
<h2 id='logLik+2CMNM-method'>Log-Likelihood Method for &quot;MNM&quot; Class</h2><span id='topic+logLik+2CMNM-method'></span>

<h3>Description</h3>

<p>Retrieves the log-likelihood value from an object of class <code>"MNM"</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'MNM'
logLik(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="logLik+2B2CMNM-method_+3A_object">object</code></td>
<td>
<p>An object of class <code>"MNM"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value representing the log-likelihood of the fitted model.
</p>

<hr>
<h2 id='MNM'>Fit a Multi-Species N-Mixture Model (MNM) using Nimble</h2><span id='topic+MNM'></span>

<h3>Description</h3>

<p>Fits a multi-species N-mixture (MNM) model to observed count data, leveraging Nimble for Bayesian inference. This model accounts for variation in detection probability and abundance across multiple species and sites.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MNM(
  Y = NULL,
  iterations = 60000,
  burnin = 20000,
  thin = 10,
  Xp = NULL,
  Xn = NULL,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="MNM_+3A_y">Y</code></td>
<td>
<p>An array of observed count data of dimension (R, T, S), where:
</p>

<ul>
<li> <p><code>R</code>: Number of sites
</p>
</li>
<li> <p><code>T</code>: Number of replicates
</p>
</li>
<li> <p><code>S</code>: Number of species
</p>
</li></ul>

<p>This array is typically produced by the <code>simulateData</code> function.</p>
</td></tr>
<tr><td><code id="MNM_+3A_iterations">iterations</code></td>
<td>
<p>Integer. Total number of MCMC iterations to run. Default is 60,000.</p>
</td></tr>
<tr><td><code id="MNM_+3A_burnin">burnin</code></td>
<td>
<p>Integer. Number of initial MCMC iterations to discard as burn-in. Default is 20,000.</p>
</td></tr>
<tr><td><code id="MNM_+3A_thin">thin</code></td>
<td>
<p>Integer. Thinning interval for MCMC samples to reduce autocorrelation. Default is 10.</p>
</td></tr>
<tr><td><code id="MNM_+3A_xp">Xp</code></td>
<td>
<p>An array of covariates affecting detection probability, with dimensions (R, S, P1), where:
</p>

<ul>
<li> <p><code>R</code>: Number of sites
</p>
</li>
<li> <p><code>S</code>: Number of species
</p>
</li>
<li> <p><code>P1</code>: Number of detection-related covariates
</p>
</li></ul>

<p>See examples for implementation details.</p>
</td></tr>
<tr><td><code id="MNM_+3A_xn">Xn</code></td>
<td>
<p>An array of covariates affecting abundance, with dimensions (R, S, P2), where:
</p>

<ul>
<li> <p><code>R</code>: Number of sites
</p>
</li>
<li> <p><code>S</code>: Number of species
</p>
</li>
<li> <p><code>P1</code>: Number of abundance-related covariates
</p>
</li></ul>

<p>See examples for implementation details.</p>
</td></tr>
<tr><td><code id="MNM_+3A_verbose">verbose</code></td>
<td>
<p>Control the level of output displayed during function execution. Default is TRUE.</p>
</td></tr>
<tr><td><code id="MNM_+3A_...">...</code></td>
<td>
<p>Additional arguments passed for prior distribution specification. Supported distributions include dnorm, dexp, dgamma, dbeta, dunif, dlnorm, dbern, dpois, dbinom, dcat, dmnorm, dwish, dchisq, dinvgamma, dt, dweib, ddirch, dmulti, dmvt. Default prior distributions are:
</p>

<ul>
<li><p> prior_detection_probability: prior distribution for the detection probability intercept (<code>gamma</code>). Default is <code>'dnorm(0, 0.001)'</code>.
</p>
</li>
<li><p> prior_precision: prior distribution for the precision matrix for the species-level random effect. Default is <code>'dwish(Omega[1:S,1:S], df)'</code>.
</p>
</li>
<li><p> prior_mean: prior distribution for the mean of the species-level random effect (<code>mu</code>). Default is <code>'dnorm(0,0.001)'</code>.
</p>
</li>
<li><p> prior_hurdle: prior distribution for <code>theta</code>, the probability of structural zero in hurdle models. Default is <code>'dbeta(1,1)'</code>.
</p>
</li>
<li><p> prior_mean_AR: prior distribution for the mean of the autoregressive random effect (<code>phi</code>). Default is <code>'dnorm(0,0.001)'</code>.
</p>
</li>
<li><p> prior_sd_AR: prior distribution for the standard deviation of the autoregressive random effect (<code>phi</code>). Default is <code>'dexp(1)'</code>.
</p>
</li></ul>

<p>See Nimble (r-nimble.org) documentation for distribution details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function takes observed count data and covariates, then fits an MNM model using Nimble. The model estimates species-specific detection probabilities and abundances, allowing for covariate effects. The function also supports posterior predictive checks by comparing observed counts with predicted values.
</p>


<h3>Value</h3>

<p>An MNM object that contains the following components:
</p>

<ul>
<li><p> summary: Nimble model summary (mean, standard deviation, standard error, quantiles, effective sample size and Rhat value for all monitored values)
</p>
</li>
<li><p> n_parameters: Number of parameters in the model (for use in calculating information criteria)
</p>
</li>
<li><p> data: Observed abundances
</p>
</li>
<li><p> fitted_Y: Predicted values for Y. Posterior predictive checks can be performed by comparing fitted_Y with the observed data.
</p>
</li>
<li><p> logLik: Log-likelihood of the observed data (Y) given the model parameters.
</p>
</li>
<li><p> n_converged: Number of parameters with successful convergence (Rhat &lt; 1.1).
</p>
</li>
<li><p> plot: traceplots and density plots for all monitored variables.
</p>
</li></ul>



<h3>Note</h3>

<p>Ensure that the dimensions of <code>Y</code>, <code>Xp</code>, and <code>Xn</code> match the requirements specified above. Mismatched dimensions will result in errors during model fitting.
</p>


<h3>References</h3>


<ul>
<li><p> Royle, J. A. (2004). N-mixture models for estimating population size from spatially replicated counts. Biometrics, 60(1), 108-115.
</p>
</li>
<li><p> Mimnagh, N., Parnell, A., Prado, E., &amp; Moral, R. D. A. (2022). Bayesian multi-species N-mixture models for unmarked animal communities. Environmental and Ecological Statistics, 29(4), 755-778.
</p>
</li></ul>



<h3>See Also</h3>

<p><code>simulateData</code>: For generating example datasets compatible with this function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example 1:
# Covariates must be of dimension (R, S, P1/P2). If covariates of an alternative dimension are used,
#  they must first be coerced into the right format.
# If we have two abundance-covariates, one site-level covariate and one species-level
# covariate, they may be combined as follows:
R &lt;- 10  # Number of sites
S &lt;- 5   # Number of species
T&lt;-5
Y &lt;- array(sample(0:10, 100, replace = TRUE), dim = c(R, T, S))
covariate_1 &lt;- runif(R)  # Site-level covariate
covariate_2 &lt;- runif(S)  # Species-level covariate

# Expand covariate_1 to have S columns
expanded_covariate_1 &lt;- matrix(rep(covariate_1, S), nrow = R, ncol = S)
# Expand covariate_2 to have R rows
expanded_covariate_2 &lt;- t(matrix(rep(covariate_2, R), nrow = S, ncol = R))
# Combine into an array of dimensions (R, S, 2)
Xn &lt;- array(c(expanded_covariate_1, expanded_covariate_2), dim = c(R, S, 2))
dim(Xn) # this is now in the correct format and can be used.
result &lt;- MNM(Y, Xn = Xn)
# nimble creates auxiliary functions that may be removed after model
# run is complete using rm(list = ls(pattern = "^str"))
print(result@summary)
 data(birds)
# Example 2: North American Breeding Bird Data
# Data must first be reformatted to an array of dimension (R,T,S,K)
R &lt;- 15
T &lt;- 10
S &lt;- 10
K &lt;- 4
# Ensure data is ordered consistently
birds &lt;- birds[order(birds$Route, birds$Year, birds$English_Common_Name), ]
# Create a 4D array with proper dimension
Y &lt;- array(NA, dim = c(R, T, S, K))
# Map route, species, and year to indices
route_idx &lt;- as.numeric(factor(birds$Route))
species_idx &lt;- as.numeric(factor(birds$English_Common_Name))
year_idx &lt;- as.numeric(factor(birds$Year))
# Populate the array
stop_data &lt;- as.matrix(birds[, grep("^Stop", colnames(birds))])
for (i in seq_len(nrow(birds))) {
  Y[route_idx[i], , species_idx[i], year_idx[i]] &lt;- stop_data[i, ]
  }
  # Assign dimnames
  dimnames(Y) &lt;- list(
    Route = sort(unique(birds$Route)),
      Stop = paste0("Stop", 1:T),
        Species = sort(unique(birds$English_Common_Name)),
          Year = sort(unique(birds$Year))
          )
# Selecting only 5 bird species and 1 year for analysis:
Y&lt;-Y[,,1:5,1]
model&lt;-MNM_fit(Y=Y, AR=FALSE, Hurdle=FALSE, iterations=5000, burnin=1000)
</code></pre>

<hr>
<h2 id='MNM_AR'>Fit a Multi-Species N-Mixture Model with AR-1 Using Nimble</h2><span id='topic+MNM_AR'></span>

<h3>Description</h3>

<p>Fits a multi-species N-mixture (MNM) model with an autoregressive component (AR-1) using Nimble.
This model is suitable for time-series data collected over long periods and includes covariates for abundance and detection probability.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MNM_AR(
  Y = NULL,
  iterations = 60000,
  burnin = 20000,
  thin = 10,
  Xp = NULL,
  Xn = NULL,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="MNM_AR_+3A_y">Y</code></td>
<td>
<p>Array of observed counts, with dimensions (R, T, S, K), where:
</p>

<ul>
<li><p> R: Number of sites.
</p>
</li>
<li><p> T: Number of repeated counts (replicates).
</p>
</li>
<li><p> S: Number of species.
</p>
</li>
<li><p> K: Number of time points.
</p>
</li></ul>
</td></tr>
<tr><td><code id="MNM_AR_+3A_iterations">iterations</code></td>
<td>
<p>Integer. Number of MCMC iterations to run. Defaults to 60,000.</p>
</td></tr>
<tr><td><code id="MNM_AR_+3A_burnin">burnin</code></td>
<td>
<p>Integer. Number of iterations to discard as burn-in. Defaults to 20,000.</p>
</td></tr>
<tr><td><code id="MNM_AR_+3A_thin">thin</code></td>
<td>
<p>Integer. Thinning interval for saving MCMC samples. Defaults to 10.</p>
</td></tr>
<tr><td><code id="MNM_AR_+3A_xp">Xp</code></td>
<td>
<p>Array of detection covariates with dimensions <code style="white-space: pre;">&#8288;(R, S, P1)&#8288;</code>, where:
</p>

<ul>
<li> <p><code>R</code>: Number of sites.
</p>
</li>
<li> <p><code>S</code>: Number of species.
</p>
</li>
<li> <p><code>P1</code>: Number of detection probability covariates.
</p>
</li></ul>
</td></tr>
<tr><td><code id="MNM_AR_+3A_xn">Xn</code></td>
<td>
<p>Array of abundance covariates with dimensions <code style="white-space: pre;">&#8288;(R, S, K, P2)&#8288;</code>, where:
</p>

<ul>
<li> <p><code>R</code>: Number of sites.
</p>
</li>
<li> <p><code>S</code>: Number of species.
</p>
</li>
<li> <p><code>K</code>: Number of time points.
</p>
</li>
<li> <p><code>P2</code>: Number of abundance covariates.
</p>
</li></ul>
</td></tr>
<tr><td><code id="MNM_AR_+3A_verbose">verbose</code></td>
<td>
<p>Control the level of output displayed during function execution. Default is TRUE.</p>
</td></tr>
<tr><td><code id="MNM_AR_+3A_...">...</code></td>
<td>
<p>Additional arguments passed for prior distribution specification. Supported distributions include dnorm, dexp, dgamma, dbeta, dunif, dlnorm, dbern, dpois, dbinom, dcat, dmnorm, dwish, dchisq, dinvgamma, dt, dweib, ddirch, dmulti, dmvt. Default prior distributions are:
</p>

<ul>
<li><p> prior_detection_probability: prior distribution for the detection probability intercept (<code>gamma</code>). Default is <code>'dnorm(0, 0.001)'</code>.
</p>
</li>
<li><p> prior_precision: prior distribution for the precision matrix for the species-level random effect. Default is <code>'dwish(Omega[1:S,1:S], df)'</code>.
</p>
</li>
<li><p> prior_mean: prior distribution for the mean of the species-level random effect (<code>mu</code>). Default is <code>'dnorm(0,0.001)'</code>.
</p>
</li>
<li><p> prior_hurdle: prior distribution for <code>theta</code>, the probability of structural zero in hurdle models. Default is <code>'dbeta(1,1)'</code>.
</p>
</li>
<li><p> prior_mean_AR: prior distribution for the mean of the autoregressive random effect (<code>phi</code>). Default is <code>'dnorm(0,0.001)'</code>.
</p>
</li>
<li><p> prior_sd_AR: prior distribution for the standard deviation of the autoregressive random effect (<code>phi</code>). Default is <code>'dexp(1)'</code>.
</p>
</li></ul>

<p>See Nimble (r-nimble.org) documentation for distribution details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model incorporates temporal and species-level covariates and accounts for serial correlation in abundance using an AR(1) process.
The input data should be structured as an array with dimensions (R,T,S,K). See parameter descriptions for details.
</p>
<p>Features include:
</p>

<ul>
<li><p> Posterior predictive checks via predicted vs observed abundance.
</p>
</li>
<li><p> Calculation of log-likelihood for model evaluation.
</p>
</li>
<li><p> Automatic monitoring of parameter convergence.
</p>
</li></ul>



<h3>Value</h3>

<p>An MNM object that contains the following components:
</p>

<ul>
<li><p> summary: Nimble model summary (mean, standard deviation, standard error, quantiles, effective sample size and Rhat value for all monitored values).
</p>
</li>
<li><p> n_parameters: Number of parameters in the model (for use in calculating information criteria).
</p>
</li>
<li><p> data: Observed abundances.
</p>
</li>
<li><p> fitted_Y:Predicted values for Y: posterior predictive checks can be performed by comparing fitted_Y with the observed data.
</p>
</li>
<li><p> logLik:Log-likelihood of the observed data (Y) given the model parameters.
</p>
</li>
<li><p> n_converged: Number of parameters with successful convergence (Rhat &lt; 1.1).
</p>
</li>
<li><p> plot: traceplots and density plots for all monitored variables.
</p>
</li></ul>



<h3>Note</h3>

<p>Ensure that the dimensions of <code>Y</code>, <code>Xp</code>, and <code>Xn</code> match the requirements specified above. Mismatched dimensions will result in errors during model fitting.
</p>


<h3>References</h3>


<ul>
<li><p> Royle, J. A. (2004). N-mixture models for estimating population size from spatially replicated counts. Biometrics, 60(1), 108-115.
</p>
</li>
<li><p> Mimnagh, N., Parnell, A., Prado, E., &amp; Moral, R. D. A. (2022). Bayesian multi-species N-mixture models for unmarked animal communities. Environmental and Ecological Statistics, 29(4), 755-778.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code>simulateData</code>: For generating example datasets compatible with this function.
</p>
</li>
<li> <p><code>MNM</code>: For details on creating covariate arrays Xp and Xn.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Example 1:
Y &lt;- array(rpois(1000, lambda = 10), dim = c(10, 10, 5, 2))
Xp &lt;- array(runif(500), dim = c(10, 5, 2, 3))
Xn &lt;- array(runif(1000), dim = c(10, 5, 2, 4))

# Fit the AR-1 model
result &lt;- MNM_AR(Y = Y, Xp = Xp, Xn = Xn)
# nimble creates auxiliary functions that may be removed after model run is complete
# using rm(list = ls(pattern = "^str"))
# Check fitted vs observed abundance
plot(result@data, result@fitted_Y)

data(birds)

# Example 2: North American Breeding Bird Data
# Data must first be reformatted to an array of dimension (R,T,S,K)
R &lt;- 15
T &lt;- 10
S &lt;- 10
K &lt;- 4
# Ensure data is ordered consistently
birds &lt;- birds[order(birds$Route, birds$Year, birds$English_Common_Name), ]

# Create a 4D array with proper dimension
Y &lt;- array(NA, dim = c(R, T, S, K))

# Map route, species, and year to indices
route_idx &lt;- as.numeric(factor(birds$Route))
species_idx &lt;- as.numeric(factor(birds$English_Common_Name))
year_idx &lt;- as.numeric(factor(birds$Year))

# Populate the array
stop_data &lt;- as.matrix(birds[, grep("^Stop", colnames(birds))])

for (i in seq_len(nrow(birds))) {
  Y[route_idx[i], , species_idx[i], year_idx[i]] &lt;- stop_data[i, ]
  }

  # Assign dimnames
  dimnames(Y) &lt;- list(
    Route = sort(unique(birds$Route)),
      Stop = paste0("Stop", 1:T),
        Species = sort(unique(birds$English_Common_Name)),
          Year = sort(unique(birds$Year))
          )

# Selecting only 5 bird species  for analysis:
Y&lt;-Y[,,1:5,]

model&lt;-MNM_fit(Y=Y, AR=TRUE, Hurdle=FALSE, iterations=10000, burnin=2000)

</code></pre>

<hr>
<h2 id='MNM_control'>Generate Nimble Code for Multi-Species N-Mixture (MNM) Models</h2><span id='topic+MNM_control'></span>

<h3>Description</h3>

<p>This function generates Nimble code for fitting various Multi-Species N-Mixture (MNM) models. These models can include standard MNM, hurdle components, autoregressive (AR) components, or both hurdle and AR components.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MNM_control(
  model = "MNM",
  prior_detection_probability = "dnorm(0, 0.001)",
  prior_precision = "dwish(Omega[1:S,1:S], df)",
  prior_mean = "dnorm(0,0.001)",
  prior_mean_AR = "dnorm(0,0.001)",
  prior_sd_AR = "dexp(1)",
  prior_hurdle = "dbeta(1,1)",
  Xp = NULL,
  Xn = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="MNM_control_+3A_model">model</code></td>
<td>
<p>Character. Specifies the type of MNM model to generate. Options are:
</p>

<ul>
<li> <p><code>"MNM"</code>: Standard MNM model (default)
</p>
</li>
<li> <p><code>"Hurdle"</code>: Hurdle MNM model
</p>
</li>
<li> <p><code>"AR"</code>: Autoregressive MNM model
</p>
</li>
<li> <p><code>"HurdleAR"</code>: Hurdle MNM model with autoregression
</p>
</li></ul>
</td></tr>
<tr><td><code id="MNM_control_+3A_prior_detection_probability">prior_detection_probability</code></td>
<td>
<p>Character. Prior distribution for the detection probability intercept (<code>gamma</code>). Default is <code>'dnorm(0, 0.001)'</code>.</p>
</td></tr>
<tr><td><code id="MNM_control_+3A_prior_precision">prior_precision</code></td>
<td>
<p>Character. Prior distribution for the precision matrix for the species-level random effect. Default is <code>'dwish(Omega[1:S,1:S], df)'</code>.</p>
</td></tr>
<tr><td><code id="MNM_control_+3A_prior_mean">prior_mean</code></td>
<td>
<p>Character. Prior distribution for the mean of the species-level random effect (<code>mu</code>). Default is <code>'dnorm(0,0.001)'</code>.</p>
</td></tr>
<tr><td><code id="MNM_control_+3A_prior_mean_ar">prior_mean_AR</code></td>
<td>
<p>Character. Prior distribution for the mean of the autoregressive random effect (<code>phi</code>). Default is <code>'dnorm(0,0.001)'</code>.</p>
</td></tr>
<tr><td><code id="MNM_control_+3A_prior_sd_ar">prior_sd_AR</code></td>
<td>
<p>Character. Prior distribution for the standard deviation of the autoregressive random effect (<code>phi</code>). Default is <code>'dexp(1)'</code>.</p>
</td></tr>
<tr><td><code id="MNM_control_+3A_prior_hurdle">prior_hurdle</code></td>
<td>
<p>Character. Prior distribution for <code>theta</code>, the probability of structural zero in hurdle models. Default is <code>'dbeta(1,1)'</code>.</p>
</td></tr>
<tr><td><code id="MNM_control_+3A_xp">Xp</code></td>
<td>
<p>Array. Covariates influencing detection probability. Dimensions depend on the model:
</p>

<ul>
<li> <p><code class="reqn">R \times S \times P</code> for models without AR
</p>
</li>
<li> <p><code class="reqn">R \times S \times K \times P</code> for AR models
where:
</p>
</li>
<li> <p><code class="reqn">R</code>: Number of sites
</p>
</li>
<li> <p><code class="reqn">S</code>: Number of species
</p>
</li>
<li> <p><code class="reqn">K</code>: Number of time points
</p>
</li>
<li> <p><code class="reqn">P</code>: Number of covariates
</p>
</li></ul>
</td></tr>
<tr><td><code id="MNM_control_+3A_xn">Xn</code></td>
<td>
<p>Array. Covariates influencing abundance. Dimensions depend on the model:
</p>

<ul>
<li> <p><code class="reqn">R \times S \times P</code> for models without AR
</p>
</li>
<li> <p><code class="reqn">R \times S \times K \times P</code> for AR models
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>The generated Nimble code can be used to fit Bayesian hierarchical MNM models. Users can specify prior distributions for key model parameters and provide covariate arrays that influence detection probability and abundance. The function validates prior specifications and adapts model code based on the selected model type. Supported models include:
</p>

<ul>
<li> <p><strong>MNM</strong>: Standard MNM model
</p>
</li>
<li> <p><strong>Hurdle</strong>: MNM model with a hurdle component
</p>
</li>
<li> <p><strong>AR</strong>: MNM model with an autoregressive component
</p>
</li>
<li> <p><strong>HurdleAR</strong>: MNM model with both hurdle and AR components
</p>
</li></ul>

<p>This is an internal function, needed for implementing MNM models using the MNM_fit function. While the MNM_fit function allows the user to define prior distributions and linear covariates on detection probability and abundance, if the user wishes to implement more complex models in Nimble (via unsupported prior distributions or non-linear covariate effects), the Nimble model code may be extracted as in examples below, and modified by the user.
</p>


<h3>Value</h3>

<p>Character. Nimble code for the specified MNM model, which can be used for further analysis or fitting.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example
# In order to implement scenarios involving nonlinear covariate effects or complex
#  interaction terms, the user is invited to extract and modify the MNM Nimble code:
model&lt;-MNM_control(model="MNM")
cat(model)

</code></pre>

<hr>
<h2 id='MNM_fit'>Fit a Multi-Species N-Mixture (MNM) Model in Nimble</h2><span id='topic+MNM_fit'></span>

<h3>Description</h3>

<p>Fits a Multi-Species N-Mixture (MNM) model to observed count data using Nimble, with options to include autocorrelation (AR) and/or hurdle components for advanced ecological modeling.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MNM_fit(
  Y = NULL,
  AR = FALSE,
  Hurdle = FALSE,
  Xp = NULL,
  Xn = NULL,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="MNM_fit_+3A_y">Y</code></td>
<td>
<p>Array of observed count data:
</p>

<ul>
<li><p> Dimensions for standard MNM and hurdle models: <code class="reqn">R \times T \times S</code>
</p>
</li>
<li><p> Dimensions for MNM with AR or both AR and hurdle components: <code class="reqn">R \times T \times S \times K</code>
</p>
</li>
<li> <p><code>R</code>: Number of sites
</p>
</li>
<li> <p><code>T</code>: Number of replicates
</p>
</li>
<li> <p><code>S</code>: Number of species
</p>
</li>
<li> <p><code>K</code>: Number of time periods (required if <code>AR = TRUE</code>)
</p>
</li></ul>
</td></tr>
<tr><td><code id="MNM_fit_+3A_ar">AR</code></td>
<td>
<p>Logical. Indicates whether to include an autocorrelation component in the model. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="MNM_fit_+3A_hurdle">Hurdle</code></td>
<td>
<p>Logical. Indicates whether to include a hurdle component in the model. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="MNM_fit_+3A_xp">Xp</code></td>
<td>
<p>An array of covariates affecting detection probability, with dimensions (R, S, P1), where:
</p>

<ul>
<li> <p><code>R</code>: Number of sites
</p>
</li>
<li> <p><code>S</code>: Number of species
</p>
</li>
<li> <p><code>P1</code>: Number of detection-related covariates
See examples for implementation details.
</p>
</li></ul>
</td></tr>
<tr><td><code id="MNM_fit_+3A_xn">Xn</code></td>
<td>
<p>An array of covariates affecting abundance, with dimensions (R, S, P2), where:
</p>

<ul>
<li> <p><code>R</code>: Number of sites.
</p>
</li>
<li> <p><code>S</code>: Number of species.
</p>
</li>
<li> <p><code>P2</code>: Number of abundance-related covariates.
</p>
</li></ul>
</td></tr>
<tr><td><code id="MNM_fit_+3A_verbose">verbose</code></td>
<td>
<p>Control the level of output displayed during function execution. Default is TRUE.</p>
</td></tr>
<tr><td><code id="MNM_fit_+3A_...">...</code></td>
<td>
<p>Additional arguments for prior distributions. Supported priors include:
</p>

<ul>
<li> <p><code>prior_detection_probability</code>, <code>prior_precision</code>, <code>prior_mean</code>, <code>prior_mean_AR</code>, <code>prior_sd_AR</code>, <code>prior_hurdle</code>.
</p>
</li>
<li><p> Supported distributions include: <code>dnorm</code>, <code>dexp</code>, <code>dgamma</code>, <code>dbeta</code>, <code>dunif</code>, <code>dlnorm</code>, <code>dbern</code>, <code>dpois</code>, <code>dbinom</code>, <code>dcat</code>, <code>dmnorm</code>, <code>dwish</code>, <code>dchisq</code>, <code>dinvgamma</code>, <code>dt</code>, <code>dweib</code>, <code>ddirch</code>, <code>dmulti</code>, <code>dmvt</code>. Refer to the <a href="https://r-nimble.org">Nimble documentation</a> for details.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This function implements the Bayesian MNM model to estimate latent species abundances and inter-species correlations based on observed count data. Extensions include options for incorporating autocorrelation (AR) to account for temporal dependencies and a hurdle model to handle zero inflation in the data. The input data and covariates must conform to specific dimensional requirements as described below.
</p>
<p>The MNM model (Mimnagh et al., 2022) builds upon Royle's (2004) N-mixture model by allowing simultaneous modeling of multiple species, enabling inference about inter-species relationships and correlations.
</p>


<h3>Value</h3>

<p>An MNM object that contains the following components:
</p>

<ul>
<li><p> summary: Nimble model summary (mean, standard deviation, standard error, quantiles, effective sample size and Rhat value for all monitored values)
</p>
</li>
<li><p> n_parameters: Number of parameters in the model (for use in calculating information criteria)
</p>
</li>
<li><p> data: Observed abundances
</p>
</li>
<li><p> fitted_Y: Predicted values for Y. Posterior predictive checks can be performed by comparing fitted_Y with the observed data.
</p>
</li>
<li><p> logLik: Log-likelihood of the observed data (Y) given the model parameters.
</p>
</li>
<li><p> n_converged: Number of parameters with successful convergence (Rhat &lt; 1.1).
</p>
</li></ul>



<h3>Note</h3>

<p>Ensure that the dimensions of <code>Y</code>, <code>Xp</code>, and <code>Xn</code> match the requirements specified above. Mismatched dimensions will result in errors during model fitting.#'
</p>


<h3>References</h3>


<ul>
<li><p> Royle, J. A. (2004). N-mixture models for estimating population size from spatially replicated counts. Biometrics, 60(1), 108-115.
</p>
</li>
<li><p> Mimnagh, N., Parnell, A., Prado, E., &amp; Moral, R. D. A. (2022). Bayesian multi-species N-mixture models for unmarked animal communities. Environmental and Ecological Statistics, 29(4), 755-778.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code>simulateData</code>: For generating example datasets compatible with this function.
</p>
</li>
<li> <p><code>MNM</code>: For details on creation of covariate arrays Xp and Xn.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Example 1: Fit a standard MNM model
Y &lt;- array(data = rpois(60, lambda = 5), dim = c(3, 5, 4))  # Simulated counts
Xp &lt;- array(data = rnorm(60), dim = c(3, 4, 2))  # Detection covariates
Xn &lt;- array(data = rnorm(60), dim = c(3, 4, 2))  # Abundance covariates

model &lt;- MNM_fit(Y = Y, AR = FALSE, Hurdle = FALSE, Xp = Xp, Xn = Xn)
# nimble creates auxiliary functions that may be removed after model
# run is complete using rm(list = ls(pattern = "^str"))

# Example 2: Fit an MNM model with AR-1 component
Y &lt;- array(data = rpois(180, lambda = 5), dim = c(3, 5, 4, 3))  # Simulated counts
Xp &lt;- array(data = rnorm(180), dim = c(3, 4, 3, 2))  # Detection covariates
Xn &lt;- array(data = rnorm(180), dim = c(3, 4, 3, 2))  # Abundance covariates

model &lt;- MNM_fit(Y = Y, AR = TRUE, Hurdle = FALSE, Xp = Xp, Xn = Xn)

# Example 3: Fit an MNM model with user-specified prior distributions
Y &lt;- array(data = rpois(60, lambda = 5), dim = c(3, 5, 4))  # Simulated counts
Xp &lt;- array(data = rnorm(60), dim = c(3, 4, 2))  # Detection covariates
Xn &lt;- array(data = rnorm(60), dim = c(3, 4, 2))  # Abundance covariates

model &lt;- MNM_fit(Y = Y, AR = FALSE, Hurdle = TRUE, Xp = Xp, Xn = Xn,
                          prior_detection_probability="dnorm(0.01,0.01)")
# Access traceplots and density plots
tracePlot(model, "N[3, 1]")
density(model, "N[3, 1]")

</code></pre>

<hr>
<h2 id='MNM_Hurdle'>Fit a Multi-Species N-Mixture Model with Hurdle Component using Nimble</h2><span id='topic+MNM_Hurdle'></span>

<h3>Description</h3>

<p>This function fits a multi-species N-mixture (MNM) model incorporating a Hurdle component to handle zero-inflated data, allowing for robust estimation of abundance and detection probabilities across multiple species and sites.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MNM_Hurdle(
  Y = NULL,
  iterations = 60000,
  burnin = 20000,
  thin = 10,
  Xp = NULL,
  Xn = NULL,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="MNM_Hurdle_+3A_y">Y</code></td>
<td>
<p>Array of observed counts, with dimensions (R, T, S, K), where:
</p>

<ul>
<li><p> R: Number of sites.
</p>
</li>
<li><p> T: Number of repeated counts (replicates).
</p>
</li>
<li><p> S: Number of species.
</p>
</li></ul>
</td></tr>
<tr><td><code id="MNM_Hurdle_+3A_iterations">iterations</code></td>
<td>
<p>Integer. Number of iterations to be used in the JAGS model. Defaults to 60,000.</p>
</td></tr>
<tr><td><code id="MNM_Hurdle_+3A_burnin">burnin</code></td>
<td>
<p>Integer. Number of iterations to be discarded as burn-in. Defaults to 20,000.</p>
</td></tr>
<tr><td><code id="MNM_Hurdle_+3A_thin">thin</code></td>
<td>
<p>Integer. Thinning interval for the MCMC chains. Defaults to 10.</p>
</td></tr>
<tr><td><code id="MNM_Hurdle_+3A_xp">Xp</code></td>
<td>
<p>Array of detection covariates with dimensions <code style="white-space: pre;">&#8288;(R, S, P1)&#8288;</code>, where:
</p>

<ul>
<li> <p><code>R</code>: Number of sites.
</p>
</li>
<li> <p><code>S</code>: Number of species.
</p>
</li>
<li> <p><code>P1</code>: Number of detection probability covariates.
</p>
</li></ul>
</td></tr>
<tr><td><code id="MNM_Hurdle_+3A_xn">Xn</code></td>
<td>
<p>Array of abundance covariates with dimensions <code style="white-space: pre;">&#8288;(R, S, P2)&#8288;</code>, where:
</p>

<ul>
<li> <p><code>R</code>: Number of sites.
</p>
</li>
<li> <p><code>S</code>: Number of species.
</p>
</li>
<li> <p><code>P2</code>: Number of abundance covariates.
</p>
</li></ul>
</td></tr>
<tr><td><code id="MNM_Hurdle_+3A_verbose">verbose</code></td>
<td>
<p>Control the level of output displayed during function execution. Default is TRUE.</p>
</td></tr>
<tr><td><code id="MNM_Hurdle_+3A_...">...</code></td>
<td>
<p>Additional arguments passed for prior distribution specification. Supported distributions include dnorm, dexp, dgamma, dbeta, dunif, dlnorm, dbern, dpois, dbinom, dcat, dmnorm, dwish, dchisq, dinvgamma, dt, dweib, ddirch, dmulti, dmvt. Default prior distributions are:
</p>

<ul>
<li><p> prior_detection_probability: prior distribution for the detection probability intercept (<code>gamma</code>). Default is <code>'dnorm(0, 0.001)'</code>.
</p>
</li>
<li><p> prior_precision: prior distribution for the precision matrix for the species-level random effect. Default is <code>'dwish(Omega[1:S,1:S], df)'</code>.
</p>
</li>
<li><p> prior_mean: prior distribution for the mean of the species-level random effect (<code>mu</code>). Default is <code>'dnorm(0,0.001)'</code>.
</p>
</li>
<li><p> prior_hurdle: prior distribution for <code>theta</code>, the probability of structural zero in hurdle models. Default is <code>'dbeta(1,1)'</code>.
</p>
</li>
<li><p> prior_mean_AR: prior distribution for the mean of the autoregressive random effect (<code>phi</code>). Default is <code>'dnorm(0,0.001)'</code>.
</p>
</li>
<li><p> prior_sd_AR: prior distribution for the standard deviation of the autoregressive random effect (<code>phi</code>). Default is <code>'dexp(1)'</code>.
</p>
</li></ul>

<p>See Nimble (r-nimble.org) documentation for distribution details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function uses the Nimble framework to fit a Hurdle model, which combines a truncated Poisson distribution for non-zero counts with a separate process for modeling zero counts. The model is particularly suitable for ecological data with excess zeros, such as species occurrence data.
</p>
<p>The model supports covariates influencing both abundance and detection probabilities, and outputs posterior distributions for model parameters, derived quantities, and predicted values. Convergence diagnostics and posterior predictive checks can also be performed using the returned results.
</p>


<h3>Value</h3>

<p>An MNM object that contains the following components:
</p>

<ul>
<li><p> summary: Nimble model summary statistics (mean, standard deviation, standard error, quantiles, effective sample size and Rhat value for all monitored values)
</p>
</li>
<li><p> n_parameters: Number of parameters in the model (for use in calculating information criteria).
</p>
</li>
<li><p> data: Observed abundances.
</p>
</li>
<li><p> fitted_Y: Predicted values for Y. Posterior predictive checks can be performed by comparing fitted_Y with the observed data.
</p>
</li>
<li><p> logLik: Log-likelihood of the observed data (Y) given the model parameters.
</p>
</li>
<li><p> n_converged: Number of parameters with successful convergence (Rhat &lt; 1.1).
</p>
</li>
<li><p> plot: traceplots and density plots for all monitored variables.
</p>
</li></ul>



<h3>Note</h3>

<p>Ensure that the dimensions of <code>Y</code>, <code>Xp</code>, and <code>Xn</code> match the requirements specified above. Mismatched dimensions will result in errors during model fitting.
</p>


<h3>References</h3>


<ul>
<li><p> Royle, J. A. (2004). N-mixture models for estimating population size from spatially replicated counts. Biometrics, 60(1), 108-115.
</p>
</li>
<li><p> Mimnagh, N., Parnell, A., Prado, E., &amp; Moral, R. D. A. (2022). Bayesian multi-species N-mixture models for unmarked animal communities. Environmental and Ecological Statistics, 29(4), 755-778.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code>simulateData</code>: For generating example datasets compatible with this function.
</p>
</li>
<li> <p><code>MNM</code>: For details on creating covariate arrays Xp and Xn.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Example 1:
Y &lt;- array(rpois(100, lambda = 5), dim = c(10, 5, 2))
Xp &lt;- array(runif(100), dim = c(10, 2, 5))
Xn &lt;- array(runif(100), dim = c(10, 2, 3))

model &lt;- MNM_Hurdle(Y = Y, Xp = Xp, Xn = Xn)
# nimble creates auxiliary functions that may be removed after model
# run is complete using rm(list=ls(pattern = "^str"))
# Accessing results
print(model@summary)

data(birds)

# Example 2: North American Breeding Bird Data
# Data must first be reformatted to an array of dimension (R,T,S,K)
R &lt;- 15
T &lt;- 10
S &lt;- 10
K &lt;- 4
# Ensure data is ordered consistently
birds &lt;- birds[order(birds$Route, birds$Year, birds$English_Common_Name), ]

# Create a 4D array with proper dimension
Y &lt;- array(NA, dim = c(R, T, S, K))

# Map route, species, and year to indices
route_idx &lt;- as.numeric(factor(birds$Route))
species_idx &lt;- as.numeric(factor(birds$English_Common_Name))
year_idx &lt;- as.numeric(factor(birds$Year))

# Populate the array
stop_data &lt;- as.matrix(birds[, grep("^Stop", colnames(birds))])

for (i in seq_len(nrow(birds))) {
  Y[route_idx[i], , species_idx[i], year_idx[i]] &lt;- stop_data[i, ]
  }

  # Assign dimnames
  dimnames(Y) &lt;- list(
    Route = sort(unique(birds$Route)),
      Stop = paste0("Stop", 1:T),
        Species = sort(unique(birds$English_Common_Name)),
          Year = sort(unique(birds$Year))
          )

# Selecting only 5 bird species and 1 year for analysis:
Y&lt;-Y[,,1:5,1]

model&lt;-MNM_fit(Y=Y, AR=FALSE, Hurdle=TRUE, iterations=5000, burnin=1000)
</code></pre>

<hr>
<h2 id='MNM_Hurdle_AR'>Fit a multi-species N-mixture (MNM) Hurdle-AR  model using Nimble</h2><span id='topic+MNM_Hurdle_AR'></span>

<h3>Description</h3>

<p>Fits a multi-species N-mixture model (MNM) with an autoregressive (AR-1) component and a Hurdle (zero-altered) component using Nimble.
This model is suitable for zero-inflated data and data collected over extended time periods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MNM_Hurdle_AR(
  Y = NULL,
  iterations = 60000,
  burnin = 20000,
  thin = 10,
  Xp = NULL,
  Xn = NULL,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="MNM_Hurdle_AR_+3A_y">Y</code></td>
<td>
<p>Array of observed counts with dimensions <code style="white-space: pre;">&#8288;(R, T, S, K)&#8288;</code>, where:
</p>

<ul>
<li> <p><code>R</code>: Number of sites.
</p>
</li>
<li> <p><code>T</code>: Number of replicates.
</p>
</li>
<li> <p><code>S</code>: Number of species.
</p>
</li>
<li> <p><code>K</code>: Number of time periods.
</p>
</li></ul>
</td></tr>
<tr><td><code id="MNM_Hurdle_AR_+3A_iterations">iterations</code></td>
<td>
<p>Number of MCMC iterations for model fitting. Default is <code style="white-space: pre;">&#8288;60,000&#8288;</code>.</p>
</td></tr>
<tr><td><code id="MNM_Hurdle_AR_+3A_burnin">burnin</code></td>
<td>
<p>Number of initial iterations to discard as burn-in. Default is <code style="white-space: pre;">&#8288;20,000&#8288;</code>.</p>
</td></tr>
<tr><td><code id="MNM_Hurdle_AR_+3A_thin">thin</code></td>
<td>
<p>Thinning interval for the MCMC chains. Default is <code>10</code>.</p>
</td></tr>
<tr><td><code id="MNM_Hurdle_AR_+3A_xp">Xp</code></td>
<td>
<p>Array of detection covariates with dimensions <code style="white-space: pre;">&#8288;(R, S, P1)&#8288;</code>, where:
</p>

<ul>
<li> <p><code>R</code>: Number of sites.
</p>
</li>
<li> <p><code>S</code>: Number of species.
</p>
</li>
<li> <p><code>P1</code>: Number of detection probability covariates.
</p>
</li></ul>
</td></tr>
<tr><td><code id="MNM_Hurdle_AR_+3A_xn">Xn</code></td>
<td>
<p>Array of abundance covariates with dimensions <code style="white-space: pre;">&#8288;(R, S, K, P2)&#8288;</code>, where:
</p>

<ul>
<li> <p><code>R</code>: Number of sites.
</p>
</li>
<li> <p><code>S</code>: Number of species.
</p>
</li>
<li> <p><code>K</code>: Number of time points.
</p>
</li>
<li> <p><code>P2</code>: Number of abundance covariates.
</p>
</li></ul>
</td></tr>
<tr><td><code id="MNM_Hurdle_AR_+3A_verbose">verbose</code></td>
<td>
<p>Control the level of output displayed during function execution. Default is TRUE.</p>
</td></tr>
<tr><td><code id="MNM_Hurdle_AR_+3A_...">...</code></td>
<td>
<p>Additional arguments passed for prior distribution specification. Supported distributions include dnorm, dexp, dgamma, dbeta, dunif, dlnorm, dbern, dpois, dbinom, dcat, dmnorm, dwish, dchisq, dinvgamma, dt, dweib, ddirch, dmulti, dmvt. Default prior distributions are:
</p>

<ul>
<li><p> prior_detection_probability: prior distribution for the detection probability intercept (<code>gamma</code>). Default is <code>'dnorm(0, 0.001)'</code>.
</p>
</li>
<li><p> prior_precision: prior distribution for the precision matrix for the species-level random effect. Default is <code>'dwish(Omega[1:S,1:S], df)'</code>.
</p>
</li>
<li><p> prior_mean: prior distribution for the mean of the species-level random effect (<code>mu</code>). Default is <code>'dnorm(0,0.001)'</code>.
</p>
</li>
<li><p> prior_hurdle: prior distribution for <code>theta</code>, the probability of structural zero in hurdle models. Default is <code>'dbeta(1,1)'</code>.
</p>
</li>
<li><p> prior_mean_AR: prior distribution for the mean of the autoregressive random effect (<code>phi</code>). Default is <code>'dnorm(0,0.001)'</code>.
</p>
</li>
<li><p> prior_sd_AR: prior distribution for the standard deviation of the autoregressive random effect (<code>phi</code>). Default is <code>'dexp(1)'</code>.
</p>
</li></ul>

<p>See Nimble (r-nimble.org) documentation for distribution details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The MNM_Hurdle_AR model extends the standard N-mixture model by incorporating:
</p>

<ul>
<li> <p><strong>Hurdle (zero-altered) component:</strong> Handles zero-inflated data by modelling excess zeros separately.
</p>
</li>
<li> <p><strong>Autoregressive (AR-1) component:</strong> Accounts for temporal dependencies in abundance data.
</p>
</li></ul>

<p>The model is fitted to data formatted as produced by the <code>simulateData</code> function. Covariates affecting detection probability and abundance may also be provided. Results include posterior summaries, model diagnostics, and predictions for posterior predictive checks.
</p>


<h3>Value</h3>

<p>An object of class <code>MNM</code> with the following components:
</p>

<ul>
<li><p> summary: Summary statistics for monitored parameters, including mean, standard deviation, standard error, quantiles, effective sample size, and Rhat values.
</p>
</li>
<li><p> n_parameters: Number of parameters in the model (useful for calculating information criteria).
</p>
</li>
<li><p> data: Observed abundances (<code>Y</code>).
</p>
</li>
<li><p> fitted_Y: Predicted values for <code>Y</code>. Use these for posterior predictive checks by comparing them with observed data.
</p>
</li>
<li><p> logLik: Log-likelihood of the observed data (<code>Y</code>) given the model parameters.
</p>
</li>
<li><p> n_converged: Number of parameters with successful convergence (Rhat &lt; 1.1).
</p>
</li>
<li><p> plot: traceplots and density plots for all monitored variables.
</p>
</li></ul>



<h3>Note</h3>

<p>Ensure that the dimensions of <code>Y</code>, <code>Xp</code>, and <code>Xn</code> match the requirements specified above. Mismatched dimensions will result in errors during model fitting.
</p>


<h3>References</h3>


<ul>
<li><p> Royle, J. A. (2004). N-mixture models for estimating population size from spatially replicated counts. Biometrics, 60(1), 108-115.
</p>
</li>
<li><p> Mimnagh, N., Parnell, A., Prado, E., &amp; Moral, R. D. A. (2022). Bayesian multi-species N-mixture models for unmarked animal communities. Environmental and Ecological Statistics, 29(4), 755-778.
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code>simulateData</code>: For generating example datasets compatible with this function.
</p>
</li>
<li> <p><code>MNM</code>: For details on creating covariate arrays Xp and Xn.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Example 1: Simulate data and fit the model
# Simulating example data
set.seed(42)
R &lt;- 5  # Number of sites
T &lt;- 10  # Number of replicates
S &lt;- 3  # Number of species
K &lt;- 2  # Number of time periods
P1 &lt;- 2  # Number of detection covariates
P2 &lt;- 3  # Number of abundance covariates

x&lt;-simulateData(model="HurdleAR", R=R, T=T, ,S=S, K=K)
Xp &lt;- array(runif(R * S * K * P1), dim = c(R, S, K, P1))
Xn &lt;- array(runif(R * S * K * P2), dim = c(R, S, K, P2))
# Fit the MNM_Hurdle_AR model
result &lt;- MNM_Hurdle_AR(Y = x[["Y"]], Xp = Xp, Xn = Xn)
# nimble creates auxiliary functions that may be removed after model run
# is complete using rm(list = ls(pattern = "^str"))
# Access results
print(result@summary)

data(birds)

# Example 2: North American Breeding Bird Data
# Data must first be reformatted to an array of dimension (R,T,S,K)
R &lt;- 15
T &lt;- 10
S &lt;- 10
K &lt;- 4
# Ensure data is ordered consistently
birds &lt;- birds[order(birds$Route, birds$Year, birds$English_Common_Name), ]

# Create a 4D array with proper dimension
Y &lt;- array(NA, dim = c(R, T, S, K))

# Map route, species, and year to indices
route_idx &lt;- as.numeric(factor(birds$Route))
species_idx &lt;- as.numeric(factor(birds$English_Common_Name))
year_idx &lt;- as.numeric(factor(birds$Year))

# Populate the array
stop_data &lt;- as.matrix(birds[, grep("^Stop", colnames(birds))])

for (i in seq_len(nrow(birds))) {
  Y[route_idx[i], , species_idx[i], year_idx[i]] &lt;- stop_data[i, ]
  }

  # Assign dimnames
  dimnames(Y) &lt;- list(
    Route = sort(unique(birds$Route)),
      Stop = paste0("Stop", 1:T),
        Species = sort(unique(birds$English_Common_Name)),
          Year = sort(unique(birds$Year))
          )

# Selecting only 5 bird species for analysis:
Y&lt;-Y[,,1:5,]

model&lt;-MNM_fit(Y=Y, AR=TRUE, Hurdle=TRUE, iterations=5000, burnin=1000)

</code></pre>

<hr>
<h2 id='MNM-class'>Multi-Species N-Mixture (MNM) Model Class</h2><span id='topic+MNM-class'></span>

<h3>Description</h3>

<p>The <code>"MNM"</code> class represents a multi-species N-mixture model object fitted using Nimble.
It contains key model outputs, including parameter estimates, input data, predictions,
log-likelihood, convergence diagnostics, and model summaries.
</p>


<h3>Slots</h3>


<dl>
<dt><code>summary</code></dt><dd><p>A <code>data.frame</code> summarizing the model output, including posterior means, standard deviations, and convergence diagnostics (e.g., Rhat values).</p>
</dd>
<dt><code>n_parameters</code></dt><dd><p>A numeric value indicating the number of parameters estimated in the model.</p>
</dd>
<dt><code>estimates</code></dt><dd><p>Mean estimates for all monitored parameters.</p>
</dd>
<dt><code>fitted_Y</code></dt><dd><p>An array containing the fitted values (predicted responses) for the model.</p>
</dd>
<dt><code>data</code></dt><dd><p>An array containing the input data used to fit the model.</p>
</dd>
<dt><code>logLik</code></dt><dd><p>A numeric value representing the log-likelihood of the model.</p>
</dd>
<dt><code>n_converged</code></dt><dd><p>A numeric value indicating the number of parameters with Rhat &lt; 1.1, showing convergence.</p>
</dd>
<dt><code>plot</code></dt><dd><p>A list containing traceplots and density plots for all monitored variables.</p>
</dd>
</dl>

<hr>
<h2 id='predictY'>Predict Fitted Values for &quot;MNM&quot; Class</h2><span id='topic+predictY'></span><span id='topic+predictY+2CMNM-method'></span>

<h3>Description</h3>

<p>Returns the predicted (fitted) values, denoted as <code class="reqn">Y</code>, from an object of class <code>"MNM"</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predictY(object)

## S4 method for signature 'MNM'
predictY(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predictY_+3A_object">object</code></td>
<td>
<p>An object of class <code>"MNM"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An array containing the predicted (fitted) values from the model.
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>predictY(MNM)</code>: Predict fitted values for the &quot;MNM&quot; class.
</p>
</li></ul>

<hr>
<h2 id='simulateData'>Simulate Data for Multi-Species N-Mixture Models</h2><span id='topic+simulateData'></span>

<h3>Description</h3>

<p>Simulates multi-species correlated abundance data for various Multi-Species N-Mixture (MNM) model types, including standard MNM, Hurdle, AR (autoregressive), and HurdleAR models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulateData(
  model = "MNM",
  R = 10,
  S = 2,
  T = 5,
  prob = "all",
  abundance = "small",
  K = 4,
  theta = 0.5
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="simulateData_+3A_model">model</code></td>
<td>
<p>Character. Specifies the model type. Options are <code>"MNM"</code>, <code>"Hurdle"</code>, <code>"AR"</code>, <code>"HurdleAR"</code>. Default is <code>"MNM"</code>.</p>
</td></tr>
<tr><td><code id="simulateData_+3A_r">R</code></td>
<td>
<p>Integer. Number of sites. Default is <code>10</code>.</p>
</td></tr>
<tr><td><code id="simulateData_+3A_s">S</code></td>
<td>
<p>Integer. Number of species. Default is <code>2</code>.</p>
</td></tr>
<tr><td><code id="simulateData_+3A_t">T</code></td>
<td>
<p>Integer. Number of replicates. Default is <code>5</code>.</p>
</td></tr>
<tr><td><code id="simulateData_+3A_prob">prob</code></td>
<td>
<p>Character. Specifies the range of detection probabilities:
</p>

<ul>
<li> <p><code>"small"</code>: Detection probabilities &lt; 0.4.
</p>
</li>
<li> <p><code>"large"</code>: Detection probabilities &gt; 0.5.
</p>
</li>
<li> <p><code>"all"</code>: Detection probabilities between 0.01 and 0.99 (default).
</p>
</li></ul>
</td></tr>
<tr><td><code id="simulateData_+3A_abundance">abundance</code></td>
<td>
<p>Character. Specifies the abundance size:
</p>

<ul>
<li> <p><code>"small"</code>: Latent species abundance between 0 and 50.
</p>
</li>
<li> <p><code>"large"</code>: Latent species abundance between 0 and 700.
Default is <code>"small"</code>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="simulateData_+3A_k">K</code></td>
<td>
<p>Integer. Number of time points (used for AR models). Default is <code>4</code>.</p>
</td></tr>
<tr><td><code id="simulateData_+3A_theta">theta</code></td>
<td>
<p>Numeric. Probability of zero-inflation (used for hurdle models). Default is <code>0.5</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function generates abundance data for multi-species N-mixture models under different configurations:
</p>

<ul>
<li> <p><strong>MNM</strong>: Standard multi-species N-mixture model.
</p>
</li>
<li> <p><strong>Hurdle</strong>: Includes a hurdle component to model zero-inflated data.
</p>
</li>
<li> <p><strong>AR</strong>: Includes an autoregressive (AR) component for temporal dependencies.
</p>
</li>
<li> <p><strong>HurdleAR</strong>: Combines hurdle and AR components for zero-inflation and temporal dependencies.
The output includes observed and true abundances, detection probabilities, latent variables, and covariance information for the random effects.
</p>
</li></ul>



<h3>Value</h3>

<p>A list containing:
</p>

<ul>
<li> <p><strong>Y</strong>: Array of observed abundances.
</p>
</li>
<li> <p><strong>N</strong>: Array of true abundances.
</p>
</li>
<li> <p><strong>p</strong>: Array of detection probabilities.
</p>
</li>
<li> <p><strong>Sigma</strong>: Covariance matrix for the multivariate normal variable <code>a</code>.
</p>
</li>
<li> <p><strong>mu</strong>: Mean vector for the multivariate normal variable <code>a</code>.
</p>
</li>
<li> <p><strong>lambda</strong>: Latent abundance rate parameter.
</p>
</li>
<li> <p><strong>correlation</strong>: Correlation matrix derived from <code>Sigma</code>.
</p>
</li>
<li> <p><strong>R, T, S, K</strong>: Number of sites, sampling occasions, species, and time points.
</p>
</li>
<li><p> Additional elements depending on the model type:
</p>

<ul>
<li> <p><strong>phi</strong>: Autoregression parameter (AR and HurdleAR models).
</p>
</li>
<li> <p><strong>muPhi</strong>: Mean of the autoregressive parameter (AR and HurdleAR models).
</p>
</li>
<li> <p><strong>varPhi</strong>: Variance of the autoregressive parameter (AR and HurdleAR models).
</p>
</li>
<li> <p><strong>zeros</strong>: Matrix of zero-indicators for hurdle models.
</p>
</li>
<li> <p><strong>theta</strong>: Zero-inflation parameter for hurdle models.
</p>
</li></ul>

</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><code>simulateData_MNM</code>: Helper function for simulating standard MNM data.
</p>
</li>
<li> <p><code>simulateData_Hurdle</code>: Helper function for simulating hurdle MNM data.
</p>
</li>
<li> <p><code>simulateData_AR</code>: Helper function for simulating AR MNM data.
</p>
</li>
<li> <p><code>simulateData_Hurdle_AR</code>: Helper function for simulating hurdle AR MNM data.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Simulate data for a standard MNM model
data &lt;- simulateData(model = "MNM", R = 10, S = 3, T = 5, prob = "all",
abundance = "small")

# Simulate data for a hurdle model
data &lt;- simulateData(model = "Hurdle", R = 10, S = 3, T = 5, prob = "large",
abundance = "large", theta = 0.3)

# Simulate data for an autoregressive model
data &lt;- simulateData(model = "AR", R = 10, S = 2, T = 5, K = 4, prob = "small",
abundance = "small")

# Simulate data for a hurdle autoregressive model
data &lt;- simulateData(model = "HurdleAR", R = 10, S = 3, T = 5, K = 4, prob = "all",
abundance = "large", theta = 0.5)

</code></pre>

<hr>
<h2 id='tracePlot'>Trace Plot Generic and Method for &quot;MNM&quot; Class</h2><span id='topic+tracePlot'></span><span id='topic+tracePlot+2CMNM-method'></span>

<h3>Description</h3>

<p>The <code>tracePlot</code> function generates trace plots for parameters in objects. This
documentation includes the generic and the method for the <code>"MNM"</code> class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tracePlot(x, param, ...)

## S4 method for signature 'MNM'
tracePlot(x, param, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tracePlot_+3A_x">x</code></td>
<td>
<p>An object of class <code>"MNM"</code>.</p>
</td></tr>
<tr><td><code id="tracePlot_+3A_param">param</code></td>
<td>
<p>The name of the parameter to plot (e.g., <code>"N[8, 1]"</code>).</p>
</td></tr>
<tr><td><code id="tracePlot_+3A_...">...</code></td>
<td>
<p>Additional arguments (not used for <code>"MNM"</code>).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value; displays a trace plot for the specified parameter.
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>tracePlot(MNM)</code>: Method for objects of class <code>"MNM"</code>.
</p>
</li></ul>

<hr>
<h2 id='validate_all_priors'>Validate User-Specified Priors for Nimble Models</h2><span id='topic+validate_all_priors'></span>

<h3>Description</h3>

<p>Validates a set of user-defined priors to ensure that they specify valid distributions supported by Nimble and have the correct parameters for each distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>validate_all_priors(priors)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="validate_all_priors_+3A_priors">priors</code></td>
<td>
<p>A named list of priors specified as strings, where the name is the prior name (e.g., <code>prior_mean</code>) and the value is the prior distribution (e.g., <code>'dnorm(0, 0.001)'</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function checks the following:
</p>

<ul>
<li><p> Whether the specified distribution is supported by Nimble.
</p>
</li>
<li><p> Whether the correct number of parameters is provided for the distribution.
</p>
</li></ul>

<p>If any prior is invalid, the function throws an informative error with details about the issue.
</p>


<h3>Value</h3>

<p>Returns <code>TRUE</code> if all priors are valid. Throws an error if any prior is invalid.
</p>


<h3>References</h3>


<ul>
<li><p> NIMBLE Development Team (2021). NIMBLE: An R Package for Programming with BUGS Models. <a href="https://r-nimble.org/">https://r-nimble.org/</a>
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li><p> Nimble documentation for a full list of supported distributions.
</p>
</li></ul>


<hr>
<h2 id='validate_prior'>Validate User-Specified Prior for a Single Prior</h2><span id='topic+validate_prior'></span>

<h3>Description</h3>

<p>Validates a single user-defined prior to ensure it specifies a valid distribution supported by Nimble and has the correct parameters for the distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>validate_prior(prior_name, prior_string)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="validate_prior_+3A_prior_name">prior_name</code></td>
<td>
<p>A string representing the name of the prior (e.g., <code>prior_mean</code>).</p>
</td></tr>
<tr><td><code id="validate_prior_+3A_prior_string">prior_string</code></td>
<td>
<p>A string specifying the prior distribution (e.g., <code>'dnorm(0, 0.001)'</code>).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns <code>TRUE</code> if the prior is valid. Throws an error if the prior is invalid.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>validate_prior("prior_mean", "dnorm(0, 0.001)")

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
