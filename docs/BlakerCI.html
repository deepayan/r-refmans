<!DOCTYPE html><html><head><title>Help for package BlakerCI</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {BlakerCI}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#binom.blaker.acc'>
<p>Blaker's binomial acceptability function, optionally</p>
unimodalized.</a></li>
<li><a href='#binom.blaker.limits'>
<p>Blaker's binomial confidence limits</p></a></li>
<li><a href='#binom.blaker.VHadj.acc'>
<p>Blaker's binomial acceptability function with Vos-Hudson adjustment.</p>
</a></li>
<li><a href='#binom.blaker.VHadj.limits'>
<p>Vos-Hudson adjustment of Blaker's binomial confidence limits</p></a></li>
<li><a href='#BlakerCI-internal'>
<p>Internal functions, not expected to be called by the user.</p></a></li>
<li><a href='#BlakerCI-package'>
<p>Blaker's binomial and Poisson confidence limits</p></a></li>
<li><a href='#poisson.blaker.acc'>
<p>Blaker's Poisson acceptability function, optionally</p>
unimodalized.</a></li>
<li><a href='#poisson.blaker.limits'>
<p>Blaker's Poisson confidence limits</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Blaker's Binomial and Poisson Confidence Limits</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0-6</td>
</tr>
<tr>
<td>Date:</td>
<td>2019-04-29</td>
</tr>
<tr>
<td>Author:</td>
<td>Jan Klaschka</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jan Klaschka &lt;klaschka@cs.cas.cz&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Fast and accurate calculation of Blaker's binomial and Poisson confidence limits (and some related stuff).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2019-04-29 18:13:58 UTC; klaschka</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2019-04-29 19:00:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='binom.blaker.acc'>
Blaker's binomial acceptability function, optionally
unimodalized.
</h2><span id='topic+binom.blaker.acc'></span>

<h3>Description</h3>

<p>Calculates values of the acceptability function for the binomial
distribution (see function <code>acceptbin</code> in Blaker (2000))
in a sequence of points (for, e.g., plotting purposes).
The acceptability function may optionally be 
&ldquo;unimodalized&rdquo;, i.e. replaced with the smallest
greater or equal unimodal function. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>binom.blaker.acc(x, n, p, type = c("orig", "unimod"),
      acc.tol = 1e-10, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="binom.blaker.acc_+3A_x">x</code></td>
<td>

<p>number of successes.
</p>
</td></tr>
<tr><td><code id="binom.blaker.acc_+3A_n">n</code></td>
<td>

<p>number of trials.
</p>
</td></tr>
<tr><td><code id="binom.blaker.acc_+3A_p">p</code></td>
<td>

<p>vector (length 1 allowed) of hypothesized binomial parameters
(between 0 and 1).
In case of more than one point, an increasing sequence required. 
</p>
</td></tr>
<tr><td><code id="binom.blaker.acc_+3A_type">type</code></td>
<td>

<p>for <code>type = "orig"</code>, original acceptability function
calculated.<br />
For <code>type = "unimod"</code>, smallest unimodal function
greater or equal to the acceptability function calculated
instead. 
</p>
</td></tr>
<tr><td><code id="binom.blaker.acc_+3A_acc.tol">acc.tol</code></td>
<td>

<p>numerical tolerance (relevant only for <code>type = "unimod"</code>).
</p>
</td></tr>
<tr><td><code id="binom.blaker.acc_+3A_...">...</code></td>
<td>

<p>additional arguments to be passed to 
<code><a href="#topic+binom.blaker.acc.single.p">binom.blaker.acc.single.p</a></code>;
in fact, just <code>maxiter</code> (see <code><a href="#topic+BlakerCI-internal">BlakerCI-internal</a></code>). 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For <code>type = "orig"</code>, essentially the same is calculated
as &ndash; for single points &ndash; by <code>acceptbin</code> function
from Blaker (2000).
</p>
<p>Single values of the &ldquo;unimodalized&rdquo; acceptability function 
(for <code>type = "unimod"</code>) are computed by an iterative
numerical algorithm implemented in internal function
<br />
<code>binom.blaker.acc.single.p</code>.
The function cited is called just once in each of the intervals
where the acceptability function is continuous
(namely in the leftmost one of those points of <code>p</code> 
that fall into the interval when dealing with points
below <code>x/n</code>, and the rightmost one when above 
<code>x/n</code>). The rest is done by function
<code>cummax</code>.  
This is considerably faster than calling 
<code>binom.blaker.acc.single.p</code>
for every point of <code>p</code>.
Note that applying <code>cummax</code> directly to
a vector of unmodified acceptability values
is even faster and provides a unimodal output;
it may, nevertheless, lack accuracy (see Examples). 
</p>


<h3>Value</h3>

<p>Vector of acceptability values (with or without unimodalization)
in points of <code>p</code>.
</p>


<h3>Note</h3>


<p>Inspired by M.P. Fay (2010), mentioning
&ldquo;unavoidable inconsistencies&rdquo; between tests with non-unimodal
acceptability functions and confidence intervals derived from them.
When the acceptability functions are unimodalized
and the test modified accordingly (i.e. p-values slightly increased
in some cases), a perfectly matching test-CI pair is obtained. 
</p>


<h3>Author(s)</h3>

<p>Jan Klaschka <a href="mailto:klaschka@cs.cas.cz">klaschka@cs.cas.cz</a>
</p>


<h3>References</h3>

<p>Blaker, H. (2000) Confidence curves and improved exact confidence 
intervals for discrete distributions.
Canadian Journal of Statistics 28: 783-798.<br />
(Corrigenda: Canadian Journal of Statistics 29: 681.)
</p>




<p>Fay, M.P. (2010). Two-sided Exact Tests and Matching Confidence 
Intervals for Discrete Data. 
R Journal 2(1): 53-58.
</p>







<h3>Examples</h3>

<pre><code class='language-R'>p &lt;- seq(0,1,length=1001)
acc &lt;- binom.blaker.acc(3,10,p)
acc1 &lt;- binom.blaker.acc(3,10,p,type="unimod")
## The two functions look the same at first glance.
plot(p,acc,type="l")
lines(p,acc1,col="red")
legend(x=.7,y=.8,c("orig","unimod"),col=c("black","red"),lwd=1)

## There is, nevertheless, a difference.
plot(p,acc1-acc,type="l")

## Focussing on the difference about p=0.4:
p &lt;- seq(.395,.405,length=1001)
acc &lt;- binom.blaker.acc(3,10,p)
acc1 &lt;- binom.blaker.acc(3,10,p,type="unimod")
plot(p,acc,type="l",ylim=c(.749,.7495))
lines(p,acc1,col="red")
legend(x=.402,y=.7494,c("orig","unimod"),col=c("black","red"),lwd=1)

## Difference between type="unimod" and mere applying
## cummax to values obtained via type="orig":
p &lt;- seq(0,1,length=1001)
x &lt;- 59
n &lt;- 355
## Upper confidence limit (at 0.95 level) is slightly above 0.209:
binom.blaker.limits(x,n) ## [1] 0.1300807 0.2090809
## Unmodified acceptability value fall below 0.05 at p = .209
## left to the limit (so that the null hypothesis p = .209
## would be rejected despite the fact that p lies within
## the confidence interval):
acc &lt;- binom.blaker.acc(59,355,p)
rbind(p,acc)[,207:211]
##           [,1]       [,2]       [,3]       [,4]       [,5]
## p   0.20600000 0.20700000 0.20800000 0.20900000 0.21000000
## acc 0.06606867 0.05759836 0.05014189 0.04999082 0.04330283
##
## Modified acceptability is above 0.05 at p = 0.05 (so that
## hypothesis p = 0.05 is not rejected by the modified test):
acc1 &lt;- binom.blaker.acc(59,355,p,type="unimod")
rbind(p,acc1)[,207:211]
##            [,1]       [,2]       [,3]       [,4]       [,5]
## p    0.20600000 0.20700000 0.20800000 0.20900000 0.21000000
## acc1 0.06608755 0.05759836 0.05014189 0.05000009 0.04331409
##
## Applying cummax to unmodified acceptabilities guarantees unimodality 
## but lacks accuracy, leaving the value at p = 0.209 below 0.05:
m &lt;- max(which(p &lt;= 59/355))
acc2 &lt;- acc
acc2[1:m] &lt;- cummax(acc2[1:m])
acc2[1001:(m+1)] &lt;- cummax(acc2[1001:(m+1)])
rbind(p,acc2)[,207:211]
##            [,1]       [,2]       [,3]       [,4]       [,5]
## p    0.20600000 0.20700000 0.20800000 0.20900000 0.21000000
## acc2 0.06606867 0.05759836 0.05014189 0.04999082 0.04330283

</code></pre>

<hr>
<h2 id='binom.blaker.limits'>
Blaker's binomial confidence limits
</h2><span id='topic+binom.blaker.limits'></span>

<h3>Description</h3>

<p>Fast and accurate calculation of Blaker's binomial confidence limits.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>binom.blaker.limits(x, n, level = 0.95, tol = 1e-10, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="binom.blaker.limits_+3A_x">x</code></td>
<td>

<p>number of successes.
</p>
</td></tr>
<tr><td><code id="binom.blaker.limits_+3A_n">n</code></td>
<td>

<p>number of trials.
</p>
</td></tr>
<tr><td><code id="binom.blaker.limits_+3A_level">level</code></td>
<td>

<p>confidence level.
</p>
</td></tr>
<tr><td><code id="binom.blaker.limits_+3A_tol">tol</code></td>
<td>

<p>numerical tolerance.
</p>
</td></tr>
<tr><td><code id="binom.blaker.limits_+3A_...">...</code></td>
<td>

<p>additional arguments to be passed to <code>binom.blaker.lower.limit</code>;
in fact, just <code>maxiter</code> (see <code><a href="#topic+BlakerCI-internal">BlakerCI-internal</a></code>). 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that the Blaker's <code>(1 - alpha)</code> confidence interval 
is the convex hull of the set <code>C</code> of those points 
where the acceptability function (Blaker (2000)) exceeds 
level <code>alpha</code>. The original numerical algorithm from
Blaker (2000) is prone, when <code>C</code> is a union
of disjoint intervals, to skipping a short interval
and finding inaccurate over-liberal confidence limits. 
</p>
<p>Function <code>binom.blaker.limits</code> is, by contrast,
immune from such failures and yields always as 
its result the whole confidence interval (Klaschka (2010)).
</p>


<h3>Value</h3>

<p>Length 2 vector &ndash; the lower and upper confidence limits.
</p>


<h3>Note</h3>


<p>Package <code>exactci</code> by M. P. Fay includes another algorithm
that calculates Blaker's binomial confidence limits
(see user-level function <code>binom.exact</code> and internal function 
<code>exactbinomCI</code>). 
It is more sophisticated than the original Blaker's one,
but considerably slower and sometimes less accurate 
than that of <code>binom.blaker.limits</code>.
</p>
<p>Earlier 2010 versions of the algorithm of <code>binom.blaker.limits</code> 
were designed independently of (though already existing) 
M.P. Fay's packages <code>exact2x2</code> and <code>exactci</code>.
Some later modifications, however, have been inspired
by Fay's programs. 
</p>
<p>Lecoutre &amp; Poitevineau (2014) designed another algorithm 
for the calculation of the Blaker's confidence limits.
Despite more abstract theoretical background and broader 
scope (not confined to the binomial distribution),
it is closely analogous to that of <code>binom.blaker.limits</code>.
</p>


<h3>Author(s)</h3>

<p>Jan Klaschka <a href="mailto:klaschka@cs.cas.cz">klaschka@cs.cas.cz</a>
</p>


<h3>References</h3>


<p>Blaker, H. (2000) Confidence curves and improved exact confidence 
intervals for discrete distributions.
Canadian Journal of Statistics 28: 783-798.<br />
(Corrigenda: Canadian Journal of Statistics 29: 681.)
</p>






<p>Klaschka, J. (2010). BlakerCI: An algorithm and R package
for the Blaker's binomial confidence limits calculation.
Technical report No. 1099, Institute of Computer Science,
Academy of Sciences of the Czech Republic,
<a href="http://hdl.handle.net/11104/0195722">http://hdl.handle.net/11104/0195722</a>.

</p>
<p>Lecoutre, B. &amp; Poitevineau J. (2014). New results for computing
Blaker's exact confidence interval limits for usual
one-parameter discrete distributions.
Communications in Statistics - Simulation and Computation, 
<a href="http://dx.doi.org/10.1080/03610918.2014.911900">http://dx.doi.org/10.1080/03610918.2014.911900</a>.
</p>


<h3>See Also</h3>



<table>
<tr>
 <td style="text-align: left;">
<code>exactci:binom.exact</code> </td><td style="text-align: left;">
      One of the options yields Blaker's
      limits. The algorithm is more 
      sophisti- </td>
</tr>
<tr>
 <td style="text-align: left;"> </td><td style="text-align: left;"> cated than
      the original Blaker's one. </td>
</tr>
<tr>
 <td style="text-align: left;">

<code>propCIs:blakerci</code> </td><td style="text-align: left;">
      Implementation of the original algorithm from
      Blaker (2000). </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>binGroup:binBlaker</code> </td><td style="text-align: left;">
      Another implementation of the same algorithm.
</td>
</tr>

</table>



<h3>Examples</h3>

<pre><code class='language-R'>binom.blaker.limits(3,10) # [1] 0.08726443 0.61941066

## Example of a failure of the original algorithm:
## Requires PropCIs package.
## Tolerance 1e-4 - default in the Blaker's paper.
## Not run: 
blakerci(29,99,conf.level=0.95,tolerance=1e-4) ## [1] 0.2096386 0.3923087
## The correct upper limit should be 0.3929\dots,
## as demonstrated:
## (1) By the same function with a smaller tolerance:
blakerci(29,99,conf.level=0.95,tolerance=1e-7) ## [1] 0.2097022 0.3929079
## (2) By binom.blaker.limits 
##     (default confidence limit 0.95, default tolerance 1e-10):
binom.blaker.limits(29,99) ## [1] 0.2097022 0.3929079
## (3) By exactbinomCI function from package exactci
##     (default confidence level, default tolerance): 
exactbinomCI(29,99,tsmethod="blaker")[1:2] ## [1] 0.2097 0.3929
## The same function, smaller tolerance:
exactbinomCI(29,99,tsmethod="blaker",tol=1e-8)[1:2] 
                                                ## [1] 0.2097022 0.3929079

## Another example of a failure of the original algorithm 
## with even as small tolerance as 1e-6:
blakerci(59,355,conf.level=0.95,tolerance=1e-4) ## [1] 0.1299899 0.2085809
blakerci(59,355,conf.level=0.95,tolerance=1e-5) ## [1] 0.1300799 0.2085409
blakerci(59,355,conf.level=0.95,tolerance=1e-6) ## [1] 0.1300799 0.2085349
## Only for tolerance = 1e-7 the result is satisfactory
## and in agreement with binom.blaker.limits:
blakerci(59,355,conf.level=0.95,tolerance=1e-7) ## [1] 0.1300807 0.2090809
binom.blaker.limits(59,355)                     ## [1] 0.1300807 0.2090809

## End(Not run)



</code></pre>

<hr>
<h2 id='binom.blaker.VHadj.acc'>
Blaker's binomial acceptability function with Vos-Hudson adjustment.

</h2><span id='topic+binom.blaker.VHadj.acc'></span>

<h3>Description</h3>

<p>Calculates  values of the Vos-Hudson adjusted acceptability function
in a sequence of points (for, e.g., plotting purposes).
The adjusted acceptability function may optionally be 
&ldquo;unimodalized&rdquo;, i.e. replaced with the smallest
greater or equal unimodal function. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>binom.blaker.VHadj.acc(x, n, p, type = c("orig", "unimod"),
      acc.tol = 1e-10, nmax=n+1000,int.eps=1e-12, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="binom.blaker.VHadj.acc_+3A_x">x</code></td>
<td>

<p>number of successes.
</p>
</td></tr>
<tr><td><code id="binom.blaker.VHadj.acc_+3A_n">n</code></td>
<td>

<p>number of trials.
</p>
</td></tr>
<tr><td><code id="binom.blaker.VHadj.acc_+3A_p">p</code></td>
<td>

<p>vector (length 1 allowed) of hypothesized binomial parameters
(between 0 and 1).
In case of more than one point, an increasing sequence required. 
</p>
</td></tr>
<tr><td><code id="binom.blaker.VHadj.acc_+3A_type">type</code></td>
<td>

<p>for <code>type = "orig"</code>, Vos-Hudson adjustment applied to 
original acceptability function.
For <code>type = "unimod"</code>, smallest unimodal function
greater or equal to the adjusted acceptability function.
</p>
</td></tr>
<tr><td><code id="binom.blaker.VHadj.acc_+3A_acc.tol">acc.tol</code></td>
<td>

<p>numerical tolerance (relevant only for <code>type = "unimod"</code>).
</p>
</td></tr>
<tr><td><code id="binom.blaker.VHadj.acc_+3A_nmax">nmax</code></td>
<td>

<p>Pairs <code>(y, m)</code> of number of trials and number of successes 
are allowed to contribute to the Vos-Hudson adjustment for only
<code>m</code> up to <code>nmax</code>. Warning is returned when greater
numbers of trials are suspected to have influence.
</p>
</td></tr>
<tr><td><code id="binom.blaker.VHadj.acc_+3A_int.eps">int.eps</code></td>
<td>

<p>Maximum expected error of machine representation of integers
calculated from reals via multiplication and division.
(Used in order to round numbers correctly if they happen
to be integer, e. g.
<code>ceiling(xx - int.eps)</code> is calculated instead of 
<code>ceiling(xx)</code>.)
</p>
</td></tr> 
<tr><td><code id="binom.blaker.VHadj.acc_+3A_...">...</code></td>
<td>

<p>additional arguments to be passed to <code>binom.blaker.acc.single.p</code>;
in fact, just <code>maxiter</code> (see <code>BlakerCI-internal</code>). 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The relationship between the adjusted acceptability function 
and the adjusted confidence intervals 
(see <code><a href="#topic+binom.blaker.VHadj.limits">binom.blaker.VHadj.limits</a></code>)
is the same as between the unadjusted acceptability function
and confidence interval (see <code><a href="#topic+binom.blaker.acc">binom.blaker.acc</a></code>,
<code><a href="#topic+binom.blaker.limits">binom.blaker.limits</a></code>): The confidence interval is the
convex hull of the set of those points where the function
exceeds 1 - confidence level. 
</p>


<h3>Value</h3>

<p>Vector of Vos-Hudson adjusted acceptability values (with or without unimodalization) in points of <code>p</code>.
</p>


<h3>Warning</h3>

<p>(1) Comparing output of the function with that of 
<code><a href="#topic+binom.blaker.acc">binom.blaker.acc</a></code> cannot answer positively the question 
whether the unadjusted and adjusted functions are identical 
on an interval (but, up to the numerical accuracy, in the points 
of <code>p</code> only).
</p>
<p>(2) The Warning section of the <code><a href="#topic+binom.blaker.VHadj.limits">binom.blaker.VHadj.limits</a></code>
documentation is relevant here, as well.
</p>


<h3>Author(s)</h3>

<p>Jan Klaschka <a href="mailto:klaschka@cs.cas.cz">klaschka@cs.cas.cz</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>p &lt;- seq(0,1,length=10001)
acc.adj &lt;- binom.blaker.VHadj.acc(6,13,p)
acc &lt;- binom.blaker.acc(6,13,p)

plot(p,acc.adj,type="l",col="red",ylab="acceptability"
  ,main=paste("Vos-Hudson adjustment of acceptability function"
  ,"for 6 successes in 13 trials"
  , sep="\n")
)
lines(p,acc,type="l")
legend(x=.7,y=.8,c("unadjusted","adjustment"),col=c("black","red"),lwd=1)

## Plot of differences between the unadjusted and adjusted
## acceptability functions reveals some adjustment details
## hardly visible in the previous graph. 

plot(p,acc.adj-acc,type="l",ylab="acceptability difference")

## The narrow peak near 0.215 is close to the 
## Blaker's lower 0.95 confidence limit.
## 
## Focussing on the neighbourhood of 0.215:

p &lt;- seq(0.21,0.22,length=1001)
acc.adj &lt;- binom.blaker.VHadj.acc(6,13,p)
acc &lt;- binom.blaker.acc(6,13,p)

plot(p,acc.adj,type="l",col="red",ylab="acceptability"
  ,main=paste("A detail of Vos-Hudson adjustment of acceptability function"
  ,"for 6 successes in 13 trials"
  ,sep="\n")
  ,ylim=c(0.02,0.09)
)
lines(p,acc,type="l")
legend(x=.210,y=.08,c("unadjusted","adjustment"),col=c("black","red"),lwd=1)

## The above adjustment results from the fact that, though
## 15 &gt; 13 and 7/15 &gt; 6/13, the acceptability function
## for 7 successes in 15 trials is greater that that for 6 successes
## in 13 trials on a short interval:

acc.7.15 &lt;- binom.blaker.acc(7,15,p)
plot(p,acc,type="l",ylab="acceptability"
  ,main=paste("A detail of acceptability functions"
  ,sep="\n")
  ,ylim=c(0.02,0.09)
)
lines(p,acc.7.15,type="l",col="green")
legend(x=.210,y=.08,c("6 / 13","7 / 15"),col=c("black","green")
  ,title="succ / trials",lwd=1)

## The adjustment shifts the point where the 0.05 level is exceeded,
## i. e. the Blaker's lower 0.95 confidence limit, from 0.2158 to 0.2150. 
## (Compare with Examples in binom.blaker.VHadj.limits section.)
</code></pre>

<hr>
<h2 id='binom.blaker.VHadj.limits'>
Vos-Hudson adjustment of Blaker's binomial confidence limits
</h2><span id='topic+binom.blaker.VHadj.limits'></span>

<h3>Description</h3>

<p>Blaker's binomial confidence limits adjusted so that logical
inconsistencies criticized by Vos and Hudson (2008) are avoided.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>binom.blaker.VHadj.limits(x, n, level = 0.95, tol = 1e-10, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="binom.blaker.VHadj.limits_+3A_x">x</code></td>
<td>

<p>number of successes.
</p>
</td></tr>
<tr><td><code id="binom.blaker.VHadj.limits_+3A_n">n</code></td>
<td>

<p>number of trials.
</p>
</td></tr>
<tr><td><code id="binom.blaker.VHadj.limits_+3A_level">level</code></td>
<td>

<p>confidence level.
</p>
</td></tr>
<tr><td><code id="binom.blaker.VHadj.limits_+3A_tol">tol</code></td>
<td>

<p>numerical tolerance.
</p>
</td></tr>
<tr><td><code id="binom.blaker.VHadj.limits_+3A_...">...</code></td>
<td>

<p>additional arguments to be passed to <code>binom.blaker.VHadj.lower.limit</code>:
<code>maxiter</code>, <code>nmax</code>, <code>int.eps</code>
(see <code><a href="#topic+BlakerCI-internal">BlakerCI-internal</a></code>). 
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Length 2 vector &ndash; the lower and upper (adjusted) confidence    limits.
</p>


<h3>Warning</h3>

<p>The stopping rule used is not fully justified: 
</p>
<p>The Clopper-Pearson <code>1 - alpha</code> confidence bounds
for <code>x</code> successes in <code>n</code> trials 
may be expressed as <code>qbeta(alpha/2,x,n-x+1)</code> and
<code>qbeta(1-alpha/2,x+1,n-x)</code>,
and can be generalized this way to real 
(i. e. not only integer) values of <code>x</code>.
</p>
<p>The stopping rule used in <code>binom.blaker.VHadj.limits</code>
relies on the hypothesis that
the generalized lower (upper) Clopper-Pearson confidence bounds 
grow (decrease) whenever the number of trials grows, 
and the proportion of successes grows (decreases) or 
remains unchanged (with obvious exceptions in extremes).
</p>
<p>Though I firmly trust the hypothesis, I can prove it, so far, 
just for integer numbers of successes (i. e. for &ldquo;ordinary&rdquo; 
Clopper-Pearson confidence bounds, not the generalized ones), 
and lack a general proof.
Should the hypothesis be invalid, the stopping rule
implemented in <code>binom.blaker.VHadj.limits</code>
would be incorrect, and the process of modifying
the Blaker's confidence bounds could be incomplete
in some cases. 
</p>


<h3>Note</h3>


<p>Vos &amp; Hudson (2008) gave examples of mutually contradictory
inferences yielded by some binomial tests and confidence
intervals, including the Blaker's confidence interval.
Their objections may be interpreted as follows:
When the number of trials is increased so that the success
proportion increases (decreases) or remains the same,
the lower (upper) confidence limit at the same confidence level
should not decrease (increase).<br />
The adjustment implemented in <code>binom.blaker.VHadj.limits</code>
replaces the lower (upper) Blaker's confidence limit
for <code>x</code> successes in <code>n</code> trials
with the infimum (supremum) of the Blaker's lower (upper)
confidence limits over such pairs <code>y</code>, <code>m</code>
that <code>m</code> is not less that <code>n</code>, and 
<code>y/m</code> is not less (greater) than <code>x/n</code>.
</p>
<p>Note that Lecoutre &amp; Poitevineau (2014), refering to the 
criticism by
Vos &amp; Hudson, proposed a modification of the Blaker's
confidence limits. 
Their adjustment, however, eliminates only a subset of
&ldquo;discrepancies&rdquo; treated by <code>binom.blaker.VHadj.limits</code>,
namely nonmonotonicities of upper (lower) Blaker's confidence
bounds in the number of trials when the number of successes
(failures) remains the same.
</p>


<h3>Author(s)</h3>

<p>Jan Klaschka <a href="mailto:klaschka@cs.cas.cz">klaschka@cs.cas.cz</a>
</p>


<h3>References</h3>


<p>Vos, P. W. &amp; Hudson, S. (2008).
Problems with binomial two-sided tests and the associated
confidence intervals.
Australian &amp; New Zealand Journal of Statistics
50(1): 81-89.
</p>
<p>Lecoutre, B. &amp; Poitevineau, J. (2014). New results for computing
Blaker's exact confidence interval limits for usual
one-parameter discrete distributions.
Communications in Statistics - Simulation and Computation, 
<a href="http://dx.doi.org/10.1080/03610918.2014.911900">http://dx.doi.org/10.1080/03610918.2014.911900</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>binom.blaker.VHadj.limits(6,13) # [1] 0.2150187 0.7395922

## Note that the lower limit differs from the 
## unadjusted version:

binom.blaker.limits(6,13)       # [1] 0.2158050 0.7395922

## The (unadjusted) lower limit was replaced with the
## Blaker's lower limit (both unadjusted and adjusted) 
## assigned to 7 successes in 15 trials:

binom.blaker.limits(7,15)       # [1] 0.2150187 0.7096627
binom.blaker.VHadj.limits(7,15) # [1] 0.2150187 0.7096627

## The adjustment avoids a contradiction between
## inferences corresponding to
## 6 successes in 13 trials, and 7 successess in 15 trials: 
## Though the latter situation means a higher succes proportion
## in a higher number of trials, it is assigned a smaller
## (unadjusted) Blaker's 95% lower confidence limit. 
</code></pre>

<hr>
<h2 id='BlakerCI-internal'>
Internal functions, not expected to be called by the user.
</h2><span id='topic+BlakerCI-internal'></span><span id='topic+binom.blaker.lower.limit'></span><span id='topic+binom.blaker.acc.single.p'></span><span id='topic+binom.blaker.VHadj.lower.limit'></span><span id='topic+poisson.blaker.lower.limit'></span><span id='topic+poisson.blaker.upper.limit'></span><span id='topic+poisson.blaker.acc.single.p'></span>

<h3>Description</h3>

<p>For binomial distribution: 
Calculation of the lower Blaker's confidence limit
as defined by Blaker (<code>binom.blaker.lower.limit</code>),
or with so called Vos-Hudson adjustment (<code>binom.blaker.VHadj.lower.limit</code>);
a single acceptability value, optionally &ldquo;unimodalized&rdquo;
(<code>binom.blaker.acc.single.p</code>).
</p>
<p>For Poisson distribution:
Calculation of the lower and upper Blaker's confidence limits
(<code>poisson.blaker.lower.limit</code>, <code>poisson.blaker.upper.limit</code>);
a single acceptability value, optionally &ldquo;unimodalized&rdquo;
(<code>poisson.blaker.acc.single.p</code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>binom.blaker.lower.limit(x, n, level, tol = 1e-10, maxiter=100)
binom.blaker.VHadj.lower.limit(x,n,level,tol=1e-10,maxiter=100,
      nmax=n+1000,int.eps=1e-10)
binom.blaker.acc.single.p(x, n, p, type = "orig", acc.tol = 1e-10,
      output = "acc", maxiter=100)
poisson.blaker.lower.limit(x, level, tol = 1e-10, maxiter=100)
poisson.blaker.upper.limit(x, level, tol = 1e-10, maxiter=100)
poisson.blaker.acc.single.p(x, p, type = "orig", acc.tol = 1e-10,
      output = "acc", maxiter=100)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="BlakerCI-internal_+3A_x">x</code></td>
<td>

<p>number of successes (binomial case), or events (Poisson case).
</p>
</td></tr>
<tr><td><code id="BlakerCI-internal_+3A_n">n</code></td>
<td>

<p>number of trials.
</p>
</td></tr>
<tr><td><code id="BlakerCI-internal_+3A_level">level</code></td>
<td>

<p>confidence level.
</p>
</td></tr>
<tr><td><code id="BlakerCI-internal_+3A_tol">tol</code></td>
<td>

<p>numerical tolerance (for the confidence limit).
</p>
</td></tr>
<tr><td><code id="BlakerCI-internal_+3A_p">p</code></td>
<td>

<p>point (binomial or Poisson parameter value) where to calculate the acceptability.
</p>
</td></tr>
<tr><td><code id="BlakerCI-internal_+3A_type">type</code></td>
<td>

<p><code>"orig"</code>, or <code>"unimod"</code> &ndash; either unmodified, or unimodalized 
acceptability <br />
(see <code><a href="#topic+binom.blaker.acc">binom.blaker.acc</a></code>, <code><a href="#topic+poisson.blaker.acc">poisson.blaker.acc</a></code>).      
</p>
</td></tr>
<tr><td><code id="BlakerCI-internal_+3A_acc.tol">acc.tol</code></td>
<td>

<p>numerical tolerance (for the acceptability values when <code>type = "unimod"</code>). 
</p>
</td></tr>
<tr><td><code id="BlakerCI-internal_+3A_output">output</code></td>
<td>

<p>the acceptability value output (<code>output = "acc"</code>, the default)
or, instead, an auxiliary integer-valued parameter <code>q1</code>, used
for testing whether points belong to the same continuous segment 
of the acceptability function
(<code>output = "q1"</code>), or both (<code>output = "both"</code>).
</p>
</td></tr>
<tr><td><code id="BlakerCI-internal_+3A_maxiter">maxiter</code></td>
<td>

<p>Maximum number of interval halving iterations during the search
for a confidence limit (<code>binom.blaker.lower.limit</code>, 
<code>poisson.blaker.lower.limit</code>, <code>poisson.blaker.upper.limit</code>), 
or a discontinuity point of the acceptability function 
(<code>binom.blaker.acc.single.p</code>, or <code>poisson.blaker.acc.single.p</code>  
with <code>type = "unimod"</code>). 
When the required accuracy is not reached in <code>maxiter</code> steps &ndash; 
typically when too small <code>tol</code> or <code>acc.tol</code>
exceeds capabilities of machine arithmetic &ndash; last step's result
is returned with warning.
</p>
</td></tr>
<tr><td><code id="BlakerCI-internal_+3A_nmax">nmax</code></td>
<td>

<p>Pairs <code>(y, m)</code> of number of trials and number of successes 
are allowed to contribute to the Vos-Hudson adjustment for only
<code>m</code> up to <code>nmax</code>. Warning is returned when greater
numbers of trials are suspect to have influence.
</p>
</td></tr>
<tr><td><code id="BlakerCI-internal_+3A_int.eps">int.eps</code></td>
<td>

<p>Maximum expected error of machine representation of integers
calculated via multiplication and division from reals.
(Used in order to round numbers correctly if they happen
to be integer, e. g.
<code>ceiling(xx - int.eps)</code> is calculated instead of 
<code>ceiling(xx)</code>.)
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>For <code>binom.blaker.lower.limit</code> and
<code>binom.blaker.VHadj.lower.limit</code>, a single number &ndash; 
the lower confidence limit. <br />
For <code>binom.blaker.acc.single.p</code> &ndash; depending on the
<code>output</code> parameter &ndash; a single acceptability value, or a single
auxiliary integer, or both.
</p>


<h3>Author(s)</h3>

<p>Jan Klaschka <a href="mailto:klaschka@cs.cas.cz">klaschka@cs.cas.cz</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+binom.blaker.limits">binom.blaker.limits</a></code>, <code><a href="#topic+binom.blaker.VHadj.limits">binom.blaker.VHadj.limits</a></code>,<br />
<code><a href="#topic+binom.blaker.acc">binom.blaker.acc</a></code>, <code><a href="#topic+binom.blaker.VHadj.acc">binom.blaker.VHadj.acc</a></code>, 
<code><a href="#topic+poisson.blaker.limits">poisson.blaker.limits</a></code>, <code><a href="#topic+poisson.blaker.acc">poisson.blaker.acc</a></code>.
</p>

<hr>
<h2 id='BlakerCI-package'>
Blaker's binomial and Poisson confidence limits
</h2><span id='topic+BlakerCI-package'></span><span id='topic+BlakerCI'></span>

<h3>Description</h3>

<p>Fast and accurate calculation of Blaker's binomial
and Poisson
confidence limits.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> BlakerCI</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.0-6</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2019-04-29</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL-3</td>
</tr>
<tr>
 <td style="text-align: left;">
LazyLoad: </td><td style="text-align: left;"> yes</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Acknowledgement</h3>

<p>This work was accomplished with institutional support RVO:67985807. 
The same was true for the previous version 1.0-5.
</p>
<p>Versions up to 1.0-2 were supported by grant 205/09/1079 from 
The Czech Science Foundation.



</p>


<h3>Author(s)</h3>

<p>Jan Klaschka <a href="mailto:klaschka@cs.cas.cz">klaschka@cs.cas.cz</a>
</p>
<p>Maintainer: Jan Klaschka <a href="mailto:klaschka@cs.cas.cz">klaschka@cs.cas.cz</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>binom.blaker.limits(3,10) # [1] 0.08726443 0.61941066
poisson.blaker.limits(3)  # [1] 0.8176914 8.5597971
</code></pre>

<hr>
<h2 id='poisson.blaker.acc'>
Blaker's Poisson acceptability function, optionally
unimodalized.
</h2><span id='topic+poisson.blaker.acc'></span>

<h3>Description</h3>

<p>Calculates values of the acceptability function for the Poisson
distribution (see Blaker (2000))
in a sequence of points (for, e.g., plotting purposes).
The acceptability function may optionally be 
&ldquo;unimodalized&rdquo;, i.e. replaced with the smallest
greater or equal unimodal function. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poisson.blaker.acc(x, p, type = c("orig", "unimod"),
      acc.tol = 1e-10, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="poisson.blaker.acc_+3A_x">x</code></td>
<td>

<p>number of events.
</p>
</td></tr>
<tr><td><code id="poisson.blaker.acc_+3A_p">p</code></td>
<td>

<p>vector (length 1 allowed) of hypothesized Poisson parameters.
In case of more than one point, an increasing sequence required. 
</p>
</td></tr>
<tr><td><code id="poisson.blaker.acc_+3A_type">type</code></td>
<td>

<p>for <code>type = "orig"</code>, original acceptability function
calculated.<br />
For <code>type = "unimod"</code>, smallest unimodal function
greater or equal to the acceptability function calculated
instead. 
</p>
</td></tr>
<tr><td><code id="poisson.blaker.acc_+3A_acc.tol">acc.tol</code></td>
<td>

<p>numerical tolerance (relevant only for <code>type = "unimod"</code>).
</p>
</td></tr>
<tr><td><code id="poisson.blaker.acc_+3A_...">...</code></td>
<td>

<p>additional arguments to be passed to 
<code><a href="#topic+poisson.blaker.acc.single.p">poisson.blaker.acc.single.p</a></code>;
in fact, just <code>maxiter</code> (see <code><a href="#topic+BlakerCI-internal">BlakerCI-internal</a></code>). 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Single values of the &ldquo;unimodalized&rdquo; acceptability function 
(for <code>type = "unimod"</code>) are computed by an iterative
numerical algorithm implemented in internal function
<br />
<code>poisson.blaker.acc.single.p</code>.
The function cited is called just once in each of the intervals
where the acceptability function is continuous
(namely in the leftmost one of those points of <code>p</code> 
that fall into the interval when dealing with points
below <code>x</code>, and the rightmost one when above 
<code>x</code>). The rest is done by function
<code>cummax</code>.  
This is considerably faster than calling 
<code>poisson.blaker.acc.single.p</code>
for every point of <code>p</code>.
Note that applying <code>cummax</code> directly to
a vector of unmodified acceptability values
is even faster and provides a unimodal output;
it may, nevertheless, lack accuracy. 
</p>


<h3>Value</h3>

<p>Vector of acceptability values (with or without unimodalization)
in points of <code>p</code>.
</p>


<h3>Note</h3>


<p>Inspired by M.P. Fay (2010), mentioning
&ldquo;unavoidable inconsistencies&rdquo; between tests with non-unimodal
acceptability functions and confidence intervals derived from them.
When the acceptability functions are unimodalized
and the test modified accordingly (i.e. p-values slightly increased
in some cases), a perfectly matching test-CI pair is obtained. 
</p>


<h3>Author(s)</h3>

<p>Jan Klaschka <a href="mailto:klaschka@cs.cas.cz">klaschka@cs.cas.cz</a>
</p>


<h3>References</h3>

<p>Blaker, H. (2000) Confidence curves and improved exact confidence 
intervals for discrete distributions.
Canadian Journal of Statistics 28: 783-798.<br />
(Corrigenda: Canadian Journal of Statistics 29: 681.)
</p>




<p>Fay, M.P. (2010). Two-sided Exact Tests and Matching Confidence 
Intervals for Discrete Data. 
R Journal 2(1): 53-58.
</p>







<h3>Examples</h3>

<pre><code class='language-R'>p &lt;- seq(0,10,length=1001)
acc &lt;- poisson.blaker.acc(3,p)
acc1 &lt;- poisson.blaker.acc(3,p,type="unimod")
plot(p,acc,type="l")
lines(p,acc1,col="red")
legend(x=7,y=.8,c("orig","unimod"),col=c("black","red"),lwd=1)

## The two lines -- the unimodalized and original acceptabilities -- 
## look almost the same but some small differences are slightly 
## visible.

## They can be seen better this way:
plot(p,acc1-acc,type="l")

## Focussing on one of them:
p &lt;- seq(5.05,5.6,length=1001)
acc &lt;- poisson.blaker.acc(3,p)
acc1 &lt;- poisson.blaker.acc(3,p,type="unimod")
plot(p,acc,type="l",ylim=c(.391,.396))
lines(p,acc1,col="red")
legend(x=5.4,y=.395,c("orig","unimod"),col=c("black","red"),lwd=1)

</code></pre>

<hr>
<h2 id='poisson.blaker.limits'>
Blaker's Poisson confidence limits
</h2><span id='topic+poisson.blaker.limits'></span>

<h3>Description</h3>

<p>Fast and accurate calculation of Blaker's Poisson confidence limits.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poisson.blaker.limits(x, level = 0.95, tol = 1e-10, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="poisson.blaker.limits_+3A_x">x</code></td>
<td>

<p>number of events.
</p>
</td></tr>
<tr><td><code id="poisson.blaker.limits_+3A_level">level</code></td>
<td>

<p>confidence level.
</p>
</td></tr>
<tr><td><code id="poisson.blaker.limits_+3A_tol">tol</code></td>
<td>

<p>numerical tolerance.
</p>
</td></tr>
<tr><td><code id="poisson.blaker.limits_+3A_...">...</code></td>
<td>

<p>additional arguments to be passed to <code>poisson.blaker.lower.limit</code>;
in fact, just <code>maxiter</code> (see <code><a href="#topic+BlakerCI-internal">BlakerCI-internal</a></code>). 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that the Blaker's <code>(1 - alpha)</code> confidence interval 
is the convex hull of the set <code>C</code> of those points 
where the acceptability function (Blaker (2000)) exceeds 
level <code>alpha</code>. 
When <code>C</code> is not connected, the algorithm is, analogously to
<code>binom.blaker.limits</code> (see its details),  
immune from leaving out short intervals and making thus
the confidence intervals over-liberal.
</p>


<h3>Value</h3>

<p>Length 2 vector &ndash; the lower and upper confidence limits.
</p>


<h3>Note</h3>


<p>Package <code>exactci</code> by M. P. Fay includes another algorithm
that calculates Blaker's Poisson confidence limits
(see user-level function <code>poisson.exact</code> and internal function 
<code>exactpoissonCI</code>). 
</p>
<p>Lecoutre &amp; Poitevineau (2014) designed another algorithm 
for the calculation of the Blaker's confidence limits.
It is closely analogous to that of <code>poisson.blaker.limits</code>.
</p>


<h3>Author(s)</h3>

<p>Jan Klaschka <a href="mailto:klaschka@cs.cas.cz">klaschka@cs.cas.cz</a>
</p>


<h3>References</h3>


<p>Blaker, H. (2000) Confidence curves and improved exact confidence 
intervals for discrete distributions.
Canadian Journal of Statistics 28: 783-798.<br />
(Corrigenda: Canadian Journal of Statistics 29: 681.)
</p>












<p>Lecoutre, B. &amp; Poitevineau J. (2014). New results for computing
Blaker's exact confidence interval limits for usual
one-parameter discrete distributions.
Communications in Statistics - Simulation and Computation, 
<a href="http://dx.doi.org/10.1080/03610918.2014.911900">http://dx.doi.org/10.1080/03610918.2014.911900</a>.
</p>


<h3>See Also</h3>



<table>
<tr>
 <td style="text-align: left;">
<code>exactci:poisson.exact</code> </td><td style="text-align: left;">
      One of the options yields Blaker's
      limits. 
</td>
</tr>

</table>



<h3>Examples</h3>

<pre><code class='language-R'>poisson.blaker.limits(3) # [1] 0.8176914 8.5597971

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
