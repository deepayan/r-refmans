<!DOCTYPE html><html lang="en"><head><title>Help for package acumos</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {acumos}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#compose'>
<p>Compose a Acumos microservice</p></a></li>
<li><a href='#composeFromSource'><p>Compose a Acumos microservice from its source file</p></a></li>
<li><a href='#push'>
<p>Push a component into the Acumos repository</p></a></li>
<li><a href='#pushFromSource'><p>Push a component into the Acumos repository from its source file</p></a></li>
<li><a href='#run'>
<p>Run-time tools for Acumos</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>'Acumos' R Interface</td>
</tr>
<tr>
<td>Version:</td>
<td>0.4-4</td>
</tr>
<tr>
<td>Description:</td>
<td>Create, upload and run 'Acumos' R models.
  'Acumos' (<a href="https://www.acumos.org">https://www.acumos.org</a>) is a platform and open source framework intended to make it easy to build,
  share, and deploy AI apps. 'Acumos' is part of the 'LF AI Foundation', an umbrella
  organization within 'The Linux Foundation'. With this package, user can create a
  component, and push it to an 'Acumos' platform.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License (== 2.0)</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>httr, jsonlite, RProtoBuf, Rserve, RestRserve, yaml</td>
</tr>
<tr>
<td>Suggests:</td>
<td>randomForest, testthat, callr</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://jira.acumos.org/projects/ACUMOS/issues">https://jira.acumos.org/projects/ACUMOS/issues</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://www.acumos.org">https://www.acumos.org</a> (Acumos project website)
<a href="https://gerrit.acumos.org/r/gitweb?p=acumos-r-client.git">https://gerrit.acumos.org/r/gitweb?p=acumos-r-client.git</a> (code
repository) <a href="https://github.com/acumos/acumos-r-client">https://github.com/acumos/acumos-r-client</a> (mirror
repository)
<a href="https://docs.acumos.org/en/latest/submodules/acumos-r-client/docs">https://docs.acumos.org/en/latest/submodules/acumos-r-client/docs</a>
(docs)</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.0.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-07-02 07:51:39 UTC; XXGB1668</td>
</tr>
<tr>
<td>Author:</td>
<td>Simon Urbanek [aut],
  Alassane Samba [aut, cre],
  AT&amp;T [cph],
  Tech Mahindra [cph],
  Orange [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Alassane Samba &lt;alassane.samba@orange.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-07-02 08:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='compose'>
Compose a Acumos microservice
</h2><span id='topic+compose'></span>

<h3>Description</h3>

<p><code>compose</code> generates everything necessary to create a Acumos microservice.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compose(predict, transform, fit, generate, service, initialize,
        aux = list(), name = "R Component", componentVersion="unknown version",
        file = "component.zip")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compose_+3A_predict">predict</code></td>
<td>
<p>predict function (optional)</p>
</td></tr>
<tr><td><code id="compose_+3A_transform">transform</code></td>
<td>
<p>transform function (optional)</p>
</td></tr>
<tr><td><code id="compose_+3A_fit">fit</code></td>
<td>
<p>fit function (optional)</p>
</td></tr>
<tr><td><code id="compose_+3A_generate">generate</code></td>
<td>
<p>generate function (optional)</p>
</td></tr>
<tr><td><code id="compose_+3A_service">service</code></td>
<td>
<p>function handling additional non-Acumos requests
(optional)</p>
</td></tr>
<tr><td><code id="compose_+3A_initialize">initialize</code></td>
<td>
<p>function for any one-shot initializations of the
environment</p>
</td></tr>
<tr><td><code id="compose_+3A_aux">aux</code></td>
<td>
<p>list of any auxiliary objects that are to be passed to the
global workspace of the component.</p>
</td></tr>
<tr><td><code id="compose_+3A_name">name</code></td>
<td>
<p>string, name of the component</p>
</td></tr>
<tr><td><code id="compose_+3A_componentversion">componentVersion</code></td>
<td>
<p>string, version of the component</p>
</td></tr>
<tr><td><code id="compose_+3A_file">file</code></td>
<td>
<p>string, filename for the resulting component file</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A regular component will have at least one of the three functions
<code>predict</code>, <code>transform</code> or <code>fit</code> set in which case
those functions are exposed via the Acumos API.
</p>
<p>A special component can instead provide the <code>generate</code> function
only in which case the <code>generate</code> function is called upon
instantiation instead of serving the Acumos API. This is useful
when adapting from other inputs than Acumos since the
<code>generate</code> function can use arbitrary input methods and then use
Acumos API to push to other Acumos components. Similarly,
non-Acumos requests can be served using the <code>service</code> call-back
function with the signature
<code>function(path, query, body, headers)</code> where <code>body</code> is
<code>NULL</code> or a raw vector. This interface is experimental and
currently not part of the official API.
</p>
<p>The functions can have two special arguments <code>inputs</code> and
<code>output</code> which are used to define the types of the input and
output data. They have to be named string vectors where the names
will match formats of the functions and the string specifies the
input type (class). At this point only <code>"character"</code>,
<code>"integer"</code>, <code>"numeric"</code> and <code>"raw"</code> are
supported. If those arguments are not present, they default to
<code>c(x="character")</code>. If the result of the function is a list, it
is assumed that the list holds the outputs, otherwise only one
output is used.
</p>
<p>The <code>compose()</code> function is called mainly for its side-effect
of creating the Acumos API component file, at this point it is a (ZIP)
bundle of <code>meta.json</code> (metadata), <code>component.bin</code>
(serialized R functions and code) and <code>component.proto</code> (I/O
definition)
</p>


<h3>Value</h3>

<p>Structure describing the component (parsed content of the JSON
description).
</p>


<h3>Author(s)</h3>

<p>Simon Urbanek
</p>


<h3>See Also</h3>

<p><code><a href="#topic+run">run</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## pass-through component
compose(transform=identity, name="identity")

## simple addition
compose(transform=function(a, b, inputs=c(a="numeric", b="numeric"),
        outputs=c(x="numeric")) a + b, name="Addition")

## silly RF trained on Iris
library(randomForest)
compose(predict=function(..., inputs=lapply(iris[-5], class)){
                    as.character(predict(rf, as.data.frame(list(...))))
                },
        aux = list(rf = randomForest(Species ~ ., data=iris)),
        name="Random Forest")
file.remove("component.zip")
</code></pre>

<hr>
<h2 id='composeFromSource'>Compose a Acumos microservice from its source file</h2><span id='topic+composeFromSource'></span>

<h3>Description</h3>

<p><code>composeFromSource</code> generates everything necessary to create a Acumos microservice directly
from a specifically written R file, representing the component source.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>composeFromSource(
  file = "acumos.R",
  name = "R Component",
  componentVersion = "unknown version",
  outputfile = "component.zip",
  addSource = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="composeFromSource_+3A_file">file</code></td>
<td>
<p>string, name of component source file (an R script)</p>
</td></tr>
<tr><td><code id="composeFromSource_+3A_name">name</code></td>
<td>
<p>string, name of the component</p>
</td></tr>
<tr><td><code id="composeFromSource_+3A_componentversion">componentVersion</code></td>
<td>
<p>string, version of the component</p>
</td></tr>
<tr><td><code id="composeFromSource_+3A_outputfile">outputfile</code></td>
<td>
<p>string, filename for the resulting component file</p>
</td></tr>
<tr><td><code id="composeFromSource_+3A_addsource">addSource</code></td>
<td>
<p>boolean, to add source file to the (ZIP) bundle or not</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Structure describing the component (parsed content of the JSON description).
</p>


<h3>Note</h3>

<p>A regular component source file is an R script in which at least one of the three following
functions are defined: <code>acumos_predict</code>, <code>acumos_transform</code> or <code>acumos_fit</code>.
They respectively correspond to the functions <code>predict</code>, <code>transform</code> and <code>fit</code>
of <code><a href="#topic+compose">compose</a></code>. In that script, if the functions <code>acumos_generate</code>, <code>acumos_service</code>
or <code>acumos_initialize</code> are defined, they will also correspond to the other function
type arguments of <code><a href="#topic+compose">compose</a></code>, namely <code>generate</code>, <code>service</code> and <code>initialize</code>.
</p>
<p>All the R objects defined in that script are included as auxiliary objects that are to be passed to
the global workspace of the component. They will fill the <code>aux</code> argument of <code><a href="#topic+compose">compose</a></code>.
</p>


<h3>Author(s)</h3>

<p>Alassane Samba
</p>


<h3>See Also</h3>

<p><code><a href="#topic+compose">compose</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># see an example source file in:
print(system.file("examples","example_0/", package = "acumos"))
# compose from acumos.R
example_source&lt;-system.file("examples","example_0","acumos.R", package = "acumos")
composeFromSource(
  file=example_source,
  outputfile = "acumos_bundle_example_0.zip"
)
file.remove("acumos_bundle_example_0.zip")

</code></pre>

<hr>
<h2 id='push'>
Push a component into the Acumos repository
</h2><span id='topic+push'></span><span id='topic+auth'></span>

<h3>Description</h3>

<p><code>push</code> pushes a component into the Acumos repository.
</p>
<p><code>auth</code> obtains an authentication token to be used with
<code>push</code> where required.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>push(url, file = "component.zip", token, create=TRUE, deploy=FALSE, license,
     headers, ...)
auth(url, user, password)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="push_+3A_url">url</code></td>
<td>
<p>URL for the POST request</p>
</td></tr>
<tr><td><code id="push_+3A_file">file</code></td>
<td>
<p>component bundle file as created by <code>compose</code></p>
</td></tr>
<tr><td><code id="push_+3A_token">token</code></td>
<td>
<p>token obtained from <code>auth</code> (optional)</p>
</td></tr>
<tr><td><code id="push_+3A_create">create</code></td>
<td>
<p>logical, <code>isCreateMicroservice</code> parameter.
If TRUE the model Docker image is automatically created by the Acumos platform.
See Acumos onboarding documentation.</p>
</td></tr>
<tr><td><code id="push_+3A_deploy">deploy</code></td>
<td>
<p>logical.
If TRUE the model is automatically deployed by the Acumos platform based on an
external jenkins server configuration.
This parameter cannot take the value TRUE, when the parameter
<code>create</code> takes the value FALSE.
See Acumos onboarding documentation.</p>
</td></tr>
<tr><td><code id="push_+3A_license">license</code></td>
<td>
<p>optional string, name of a file to supply as the
license. If not specified <code>push()</code> will also try to locate
a <code>license.json</code> file in the component bundle if present.</p>
</td></tr>
<tr><td><code id="push_+3A_headers">headers</code></td>
<td>
<p>optional, named list or named character vector
of HTTP headers that are to be added to the request. NOTE:
the meaning of optional headers depends on the onboarding server
so consult the documentation of the onboarding server for
supported additional headers and their meaning.</p>
</td></tr>
<tr><td><code id="push_+3A_user">user</code></td>
<td>
<p>user name to use for authentication</p>
</td></tr>
<tr><td><code id="push_+3A_password">password</code></td>
<td>
<p>password to use for authentication</p>
</td></tr>
<tr><td><code id="push_+3A_...">...</code></td>
<td>
<p>any additional form entries to push as body content.
If the entry is to be passed as a file upload, use
<code>upload_file(&lt;file&gt;, &lt;mime-type&gt;)</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>push</code>: invisibly, result of the request (may change in the
future)
</p>
<p><code>auth</code>: authentication token
</p>


<h3>Author(s)</h3>

<p>Simon Urbanek
</p>


<h3>See Also</h3>

<p><code><a href="#topic+compose">compose</a></code>
</p>

<hr>
<h2 id='pushFromSource'>Push a component into the Acumos repository from its source file</h2><span id='topic+pushFromSource'></span>

<h3>Description</h3>

<p>push pushes a component into the Acumos repository using the component source file (R file).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pushFromSource(
  url,
  file,
  name = "R Component",
  addSource = TRUE,
  token,
  create = TRUE,
  deploy = FALSE,
  license,
  headers,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pushFromSource_+3A_url">url</code></td>
<td>
<p>URL for the POST request</p>
</td></tr>
<tr><td><code id="pushFromSource_+3A_file">file</code></td>
<td>
<p>string, name of component source file (an R script)</p>
</td></tr>
<tr><td><code id="pushFromSource_+3A_name">name</code></td>
<td>
<p>string, name of the component</p>
</td></tr>
<tr><td><code id="pushFromSource_+3A_addsource">addSource</code></td>
<td>
<p>boolean, to add source file to the (ZIP) bundle or not</p>
</td></tr>
<tr><td><code id="pushFromSource_+3A_token">token</code></td>
<td>
<p>token obtained from auth (optional)</p>
</td></tr>
<tr><td><code id="pushFromSource_+3A_create">create</code></td>
<td>
<p>logical, <code>isCreateMicroservice</code> parameter. If TRUE the model Docker image 
is automatically created by the Acumos platform.  see Acumos onboarding documentation.
See Acumos onboarding documentation.</p>
</td></tr>
<tr><td><code id="pushFromSource_+3A_deploy">deploy</code></td>
<td>
<p>logical. If TRUE the model is automatically deployed by the Acumos platform. 
This parameter cannot take the value TRUE, when the parameter <code>create</code> takes the value FALSE.
See Acumos onboarding documentation.</p>
</td></tr>
<tr><td><code id="pushFromSource_+3A_license">license</code></td>
<td>
<p>optional string, name of a file to supply as the license. If not specified push()
will also try to locate a license.json file in the component bundle if present.</p>
</td></tr>
<tr><td><code id="pushFromSource_+3A_headers">headers</code></td>
<td>
<p>optional, named list or named character vector of HTTP headers that are to be added
to the request. NOTE: the meaning of optional headers depends on the onboarding server so consult
the documentation of the onboarding server for supported additional headers and their meaning.</p>
</td></tr>
<tr><td><code id="pushFromSource_+3A_...">...</code></td>
<td>
<p>optional, named list or named character vector of HTTP headers that are to be added to 
the request. NOTE: the meaning of optional headers depends on the onboarding server so consult the
documentation of the onboarding server for supported additional headers and their meaning.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>invisibly, result of the request (may change in the future)
</p>


<h3>Note</h3>

<p>A regular component source file is an R script in which at least one of the three following
functions are defined: <code>acumos_predict</code>, <code>acumos_transform</code> or <code>acumos_fit</code>.
They respectively correspond to the functions <code>predict</code>, <code>transform</code> and <code>fit</code>
of <code><a href="#topic+compose">compose</a></code>. In that script, if the functions <code>acumos_generate</code>, <code>acumos_service</code>
or <code>acumos_initialize</code> are defined, they will also correspond to the other function
type arguments of <code><a href="#topic+compose">compose</a></code>, namely <code>generate</code>, <code>service</code> and <code>initialize</code>.
</p>
<p>All the R objects defined in that script are included as auxiliary objects that are to be passed to
the global workspace of the component. They will fill the <code>aux</code> argument of <code><a href="#topic+compose">compose</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+push">push</a></code>
</p>

<hr>
<h2 id='run'>
Run-time tools for Acumos
</h2><span id='topic+run'></span><span id='topic+data2msg'></span><span id='topic+msg2data'></span><span id='topic+send.msg'></span>

<h3>Description</h3>

<p>The following functions are not exported and not intended to be used
by users, but are useful for Acumos developers, testing and used by
the platform itself.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run(where = getwd(), file = "component.zip", runtime = "runtime.json",
    init.only = FALSE)
data2msg(data, output)
msg2data(msg, input)
send.msg(url, payload, response=FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="run_+3A_where">where</code></td>
<td>
<p>directory in which the component will be run</p>
</td></tr>
<tr><td><code id="run_+3A_file">file</code></td>
<td>
<p>path to the model component file (as created by
<code><a href="#topic+compose">compose</a>()</code>) or a directory containing the
unpacked content of the component.</p>
</td></tr>
<tr><td><code id="run_+3A_payload">payload</code></td>
<td>
<p>raw vector, message to send - typically constructed by
<code>data2msg</code></p>
</td></tr>
<tr><td><code id="run_+3A_runtime">runtime</code></td>
<td>
<p>either path to the runtime JSON file or a structure
corresponding to the parsed payload of the file</p>
</td></tr>
<tr><td><code id="run_+3A_init.only">init.only</code></td>
<td>
<p>logical, if <code>TRUE</code> then the runtime is setup but
the actual server/generator is not executed.</p>
</td></tr>
<tr><td><code id="run_+3A_data">data</code></td>
<td>
<p>data to wrap into a message - it is expected to be a list
(hence a data frame qualifies)</p>
</td></tr>
<tr><td><code id="run_+3A_output">output</code></td>
<td>
<p>name of the proto message type to use</p>
</td></tr>
<tr><td><code id="run_+3A_msg">msg</code></td>
<td>
<p>raw vector containing the message</p>
</td></tr>
<tr><td><code id="run_+3A_input">input</code></td>
<td>
<p>name of the proto message type to use</p>
</td></tr>
<tr><td><code id="run_+3A_url">url</code></td>
<td>
<p>string, URL to send the message to</p>
</td></tr>
<tr><td><code id="run_+3A_response">response</code></td>
<td>
<p>logical, if <code>TRUE</code> then the HTTP response object
is returned, otherwise only a logical denoting success or failure.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>run</code> loads and runs the component by providing a service
endpoint on localhost and post specified by the <code>input_port</code>
property in the <code>runtime</code> object.
</p>
<p>The component file is expected to be created by the
<code><a href="#topic+compose">compose</a></code> function. <code>runtime</code>
defines the run-time properties such as input port and
outputs.
</p>
<p><code>data2msg</code> performs the conversion of native types to the binary
message for communication with other Acumos components.
</p>
<p><code>msg2data</code> converts a Acumos message to data according to the
provided schema.
</p>


<h3>Value</h3>

<p>The return value of <code>run</code> is undefined since it is executed for
its side-effect of providing the service and may never return.
</p>
<p><code>data2msg</code> returns a raw vector constituting the message
</p>
<p><code>msg2data</code> returns the data represented by the message
</p>
<p><code>send.msg</code> returns <code>TRUE</code> on success, <code>FALSE</code> otherwise
unless <code>response</code> is <code>TRUE</code> in which case the full response
object is returned.
</p>


<h3>Note</h3>

<p>The <code>.proto</code> file containing the schema definitions must be
loaded before <code>data2msg()</code> and <code>msg2data()</code> are used, e.g.,
by the virtue of being inside the <code>run()</code> function or explicitly
using <code>RProtoBuf::readProtoFiles(proto)</code>.
</p>
<p>The <code>run()</code> function can be used only once in a session, because
protobuf definitions are global and cannot be overridden without a
conflict.
</p>
<p>The internal Acumos communication protocol is subject to change and
all of the above functions are hidden.
</p>
<p>If the <code>runtime</code> list contains an entry <code>data_response=TRUE</code>
then the component also returns the result in the response body (in
addition to any output URL specifications). In all other cases the
response is always <code>"OK"</code> on success and error string on error.
</p>


<h3>Author(s)</h3>

<p>Simon Urbanek
</p>


<h3>See Also</h3>

<p><code><a href="#topic+compose">compose</a></code>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
