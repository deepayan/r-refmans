<!DOCTYPE html><html lang="en"><head><title>Help for package lnmixsurv</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {lnmixsurv}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#lnmixsurv-package'><p>lnmixsurv: Bayesian Mixture Log-Normal Survival Model</p></a></li>
<li><a href='#augment.survival_ln_mixture'><p>Augment data with information from a survival_ln_mixture object</p></a></li>
<li><a href='#augment.survival_ln_mixture_em'><p>Augment data with information from a survival_ln_mixture_em object</p></a></li>
<li><a href='#join_empirical_hazard'><p>Function used to join the empirical hazard to the data</p></a></li>
<li><a href='#nobs.survival_ln_mixture'><p>Extract the number of observations from <code>survival_ln_mixture</code> fit.</p></a></li>
<li><a href='#plot_fit_on_data'><p>Function used to quick visualize the fitted values (survival estimate) on the data used to fit the model (via EM algorithm or Gibbs).</p></a></li>
<li><a href='#plot.survival_ln_mixture_em'><p>Visualizes the path of the EM algorithm</p></a></li>
<li><a href='#predict.survival_ln_mixture'><p>Predict from a Lognormal Mixture Model</p></a></li>
<li><a href='#predict.survival_ln_mixture_em'><p>Predict from a lognormal_em Mixture Model fitted using EM algorithm.</p></a></li>
<li><a href='#reexports'><p>Objects exported from other packages</p></a></li>
<li><a href='#sim_data'><p>Simulated lognormal mixture data.</p></a></li>
<li><a href='#simulate_data'><p>Function to simulate survival data from a mixture of normal distribution.</p></a></li>
<li><a href='#survival_ln_mixture'><p>Lognormal mixture model - Gibbs sampler</p></a></li>
<li><a href='#survival_ln_mixture_em'><p>Lognormal mixture model - Expectation-Maximization Algorithm</p></a></li>
<li><a href='#tidy.survival_ln_mixture'><p>Tidying method for a Lognormal Mixture model.</p></a></li>
<li><a href='#tidy.survival_ln_mixture_em'><p>Tidying method for a Lognormal Mixture model (fitted via Expectation-Maximization algorithm).</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Bayesian Mixture Log-Normal Survival Model</td>
</tr>
<tr>
<td>Version:</td>
<td>3.1.6</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-08-21</td>
</tr>
<tr>
<td>Description:</td>
<td>Bayesian Survival models via the mixture of Log-Normal distribution extends the well-known survival models and accommodates different behaviour over time and considers higher censored survival times. The proposal combines mixture distributions Fruhwirth-Schnatter(2006) &lt;<a href="https://doi.org/10.1007%2Fs11336-009-9121-4">doi:10.1007/s11336-009-9121-4</a>&gt;, and data augmentation techniques Tanner and Wong (1987) &lt;<a href="https://doi.org/10.1080%2F01621459.1987.10478458">doi:10.1080/01621459.1987.10478458</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats, posterior, hardhat (&ge; 1.3.0), rlang, generics, dplyr,
readr, purrr, tidyr, tibble, Rcpp, RcppParallel, tidyselect,
broom</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo, RcppGSL, RcppParallel</td>
</tr>
<tr>
<td>Depends:</td>
<td>parsnip (&ge; 1.1.0), R (&ge; 4.1.0), survival, ggplot2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>ggsurvfit, plotly, bayesplot, censored, knitr, rmarkdown,
tidymodels, testthat (&ge; 3.0.0), covr, withr, pec</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>C++, GNU, GNU make, GSL</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://vivianalobo.github.io/lnmixsurv/">https://vivianalobo.github.io/lnmixsurv/</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-08-29 14:15:49 UTC; victorney</td>
</tr>
<tr>
<td>Author:</td>
<td>Viviana das Graças Ribeiro Lobo [aut],
  Thaís Cristina Oliveira da Fonseca [aut],
  Mariane Branco Alves [aut],
  Vitor Capdeville [aut],
  Victor Hugo Soares Ney [cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Victor Hugo Soares Ney &lt;victor.s.ney@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-09-03 15:20:08 UTC</td>
</tr>
</table>
<hr>
<h2 id='lnmixsurv-package'>lnmixsurv: Bayesian Mixture Log-Normal Survival Model</h2><span id='topic+lnmixsurv'></span><span id='topic+lnmixsurv-package'></span>

<h3>Description</h3>

<p>Bayesian Survival models via the mixture of Log-Normal distribution extends the well-known survival models and accommodates different behaviour over time and considers higher censored survival times. The proposal combines mixture distributions Fruhwirth-Schnatter(2006) <a href="https://doi.org/10.1007/s11336-009-9121-4">doi:10.1007/s11336-009-9121-4</a>, and data augmentation techniques Tanner and Wong (1987) <a href="https://doi.org/10.1080/01621459.1987.10478458">doi:10.1080/01621459.1987.10478458</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Victor Hugo Soares Ney <a href="mailto:victor.s.ney@gmail.com">victor.s.ney@gmail.com</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Viviana das Graças Ribeiro Lobo <a href="mailto:viviana@dme.ufrj.br">viviana@dme.ufrj.br</a>
</p>
</li>
<li><p> Thaís Cristina Oliveira da Fonseca
</p>
</li>
<li><p> Mariane Branco Alves
</p>
</li>
<li><p> Vitor Capdeville
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://vivianalobo.github.io/lnmixsurv/">https://vivianalobo.github.io/lnmixsurv/</a>
</p>
</li></ul>


<hr>
<h2 id='augment.survival_ln_mixture'>Augment data with information from a survival_ln_mixture object</h2><span id='topic+augment.survival_ln_mixture'></span>

<h3>Description</h3>

<p>Include information about hazard and survival distribution for each individual
in a dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'survival_ln_mixture'
augment(x, newdata, eval_time, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="augment.survival_ln_mixture_+3A_x">x</code></td>
<td>
<p>A <code>survival_ln_mixture</code> object.</p>
</td></tr>
<tr><td><code id="augment.survival_ln_mixture_+3A_newdata">newdata</code></td>
<td>
<p>A <code>base::data.frame()</code> or <code>tibble::tiblle()</code> containing all
the original predictors used to create x.</p>
</td></tr>
<tr><td><code id="augment.survival_ln_mixture_+3A_eval_time">eval_time</code></td>
<td>
<p>a vector with the times where the hazard and survival distribuition
will be evaluated.</p>
</td></tr>
<tr><td><code id="augment.survival_ln_mixture_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>tibble::tibble()</code> with the original covariates and ther survvial and hazard
distributions.
</p>

<hr>
<h2 id='augment.survival_ln_mixture_em'>Augment data with information from a survival_ln_mixture_em object</h2><span id='topic+augment.survival_ln_mixture_em'></span>

<h3>Description</h3>

<p>Include information about hazard and survival distribution for each individual
in a dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'survival_ln_mixture_em'
augment(x, newdata, eval_time, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="augment.survival_ln_mixture_em_+3A_x">x</code></td>
<td>
<p>A <code>survival_ln_mixture_em</code> object.</p>
</td></tr>
<tr><td><code id="augment.survival_ln_mixture_em_+3A_newdata">newdata</code></td>
<td>
<p>A <code>base::data.frame()</code> or <code>tibble::tiblle()</code> containing all
the original predictors used to create x.</p>
</td></tr>
<tr><td><code id="augment.survival_ln_mixture_em_+3A_eval_time">eval_time</code></td>
<td>
<p>a vector with the times where the hazard and survival distribuition
will be evaluated.</p>
</td></tr>
<tr><td><code id="augment.survival_ln_mixture_em_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>tibble::tibble()</code> with the original covariates and ther survvial and hazard
distributions.
</p>

<hr>
<h2 id='join_empirical_hazard'>Function used to join the empirical hazard to the data</h2><span id='topic+join_empirical_hazard'></span>

<h3>Description</h3>

<p><code>join_empirical_hazard()</code> takes a Kaplan Meier empirical estimate which includes the survival estimates and joins the hazard estimates to it.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>join_empirical_hazard(km)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="join_empirical_hazard_+3A_km">km</code></td>
<td>
<p>Kaplan-Meier estimates, i.e., object generated after running broom::tidy(survfit_obj), in which survfit_obj is a survfit object. Can also be a survfit object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The same object as inputed, but with the hazard estimates column (hazard_estimate) joined to it.
</p>

<hr>
<h2 id='nobs.survival_ln_mixture'>Extract the number of observations from <code>survival_ln_mixture</code> fit.</h2><span id='topic+nobs.survival_ln_mixture'></span>

<h3>Description</h3>

<p>Extract the number of observations used in a <code>survival_ln_mixture</code> fit.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'survival_ln_mixture'
nobs(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="nobs.survival_ln_mixture_+3A_object">object</code></td>
<td>
<p>A fitted <code>survival_ln_mixture</code> object.</p>
</td></tr>
<tr><td><code id="nobs.survival_ln_mixture_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A single integer.
</p>

<hr>
<h2 id='plot_fit_on_data'>Function used to quick visualize the fitted values (survival estimate) on the data used to fit the model (via EM algorithm or Gibbs).</h2><span id='topic+plot_fit_on_data'></span>

<h3>Description</h3>

<p><code>plot_fit_on_data()</code> estimates survival/hazard for the data the model was fitted on and plots the results.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_fit_on_data(
  model,
  data,
  type = "survival",
  interval = "none",
  level = 0.95
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_fit_on_data_+3A_model">model</code></td>
<td>
<p>A <code>survival_ln_mixture</code> or <code>survival_ln_mixture_em</code> object.</p>
</td></tr>
<tr><td><code id="plot_fit_on_data_+3A_data">data</code></td>
<td>
<p>A <code>data.frame()</code> or <code>tibble()</code> containing the data used to fit the model. For appropriate behavior, should be the same object used to generate survival_ln_mixture/survival_ln_mixture_em objects.</p>
</td></tr>
<tr><td><code id="plot_fit_on_data_+3A_type">type</code></td>
<td>
<p>A character string specifying the type of plot. The default is &quot;survival&quot;, but can be &quot;hazard&quot;.</p>
</td></tr>
<tr><td><code id="plot_fit_on_data_+3A_interval">interval</code></td>
<td>
<p>A character string specifying the type of interval to be plotted. The default is &quot;none&quot;, but can be &quot;credible&quot;. The EM algorithm does not provide confidence intervals and this parameter is only support for the Bayesian version (<code>survival_ln_mixture</code> object).</p>
</td></tr>
<tr><td><code id="plot_fit_on_data_+3A_level">level</code></td>
<td>
<p>A numeric value between 0 and 1 specifying the level of the confidence interval. The default is 0.95.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with two objects, one ggplot (<code style="white-space: pre;">&#8288;$ggplot&#8288;</code>) with the predictions plotted against the empirical data and a tibble with the predictions (<code style="white-space: pre;">&#8288;$preds&#8288;</code>).
</p>

<hr>
<h2 id='plot.survival_ln_mixture_em'>Visualizes the path of the EM algorithm</h2><span id='topic+plot.survival_ln_mixture_em'></span>

<h3>Description</h3>

<p>Visualizes the path of the EM algorithm
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'survival_ln_mixture_em'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.survival_ln_mixture_em_+3A_x">x</code></td>
<td>
<p>A fitted <code>survival_ln_mixture_em</code> object.</p>
</td></tr>
<tr><td><code id="plot.survival_ln_mixture_em_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot</code> object (or <code>plotly</code>, if the package is avaiable) of the EM algorithm iterations.
</p>

<hr>
<h2 id='predict.survival_ln_mixture'>Predict from a Lognormal Mixture Model</h2><span id='topic+predict.survival_ln_mixture'></span>

<h3>Description</h3>

<p>Predict from a Lognormal Mixture Model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'survival_ln_mixture'
predict(
  object,
  new_data,
  type,
  eval_time,
  interval = "none",
  level = 0.95,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.survival_ln_mixture_+3A_object">object</code></td>
<td>
<p>A <code>survival_ln_mixture</code> object.</p>
</td></tr>
<tr><td><code id="predict.survival_ln_mixture_+3A_new_data">new_data</code></td>
<td>
<p>A data frame or matrix of new predictors.</p>
</td></tr>
<tr><td><code id="predict.survival_ln_mixture_+3A_type">type</code></td>
<td>
<p>A single character. The type of predictions to generate.
Valid options are:
</p>

<ul>
<li> <p><code>"time"</code> for the survival time. <strong>not implmeented</strong>
</p>
</li>
<li> <p><code>"survival"</code> for the survival probability.
</p>
</li>
<li> <p><code>"hazard"</code> for the hazard.
</p>
</li></ul>
</td></tr>
<tr><td><code id="predict.survival_ln_mixture_+3A_eval_time">eval_time</code></td>
<td>
<p>For type = &quot;hazard&quot; or type = &quot;survival&quot;, the times for the distribution.</p>
</td></tr>
<tr><td><code id="predict.survival_ln_mixture_+3A_interval">interval</code></td>
<td>
<p>should interval estimates be added? Options are &quot;none&quot; and &quot;credible&quot;.</p>
</td></tr>
<tr><td><code id="predict.survival_ln_mixture_+3A_level">level</code></td>
<td>
<p>the tail area of the intervals. Default value is 0.95.</p>
</td></tr>
<tr><td><code id="predict.survival_ln_mixture_+3A_...">...</code></td>
<td>
<p>Not used, but required for extensibility.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble of predictions. The number of rows in the tibble is guaranteed
to be the same as the number of rows in <code>new_data</code>.
</p>


<h3>Note</h3>

<p>Categorical predictors must be converted to factors before the fit,
otherwise the predictions will fail.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Categorical variables must be converted to factor before the fit.

require(survival)
# Wrong way of doing
set.seed(1)
mod &lt;- survival_ln_mixture(Surv(time, status == 2) ~ factor(sex), lung, intercept = TRUE)

## Not run: 
# this piece of code will throw error
predict(mod, data.frame(sex = 1), type = "survival", eval_time = 100)

## End(Not run)

# Correct way
lung$sex &lt;- factor(lung$sex) # converting to factor before
set.seed(1)
mod2 &lt;- survival_ln_mixture(Surv(time, status == 2) ~ sex, lung, intercept = TRUE)
# Note: the categorical predictors must be a character.
predict(mod2, data.frame(sex = "1"), type = "survival", eval_time = 100)

</code></pre>

<hr>
<h2 id='predict.survival_ln_mixture_em'>Predict from a lognormal_em Mixture Model fitted using EM algorithm.</h2><span id='topic+predict.survival_ln_mixture_em'></span>

<h3>Description</h3>

<p>Predict from a lognormal_em Mixture Model fitted using EM algorithm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'survival_ln_mixture_em'
predict(object, new_data, type, eval_time, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.survival_ln_mixture_em_+3A_object">object</code></td>
<td>
<p>A <code>survival_ln_mixture_em</code> object.</p>
</td></tr>
<tr><td><code id="predict.survival_ln_mixture_em_+3A_new_data">new_data</code></td>
<td>
<p>A data frame or matrix of new predictors.</p>
</td></tr>
<tr><td><code id="predict.survival_ln_mixture_em_+3A_type">type</code></td>
<td>
<p>A single character. The type of predictions to generate.
Valid options are:
</p>

<ul>
<li> <p><code>"survival"</code> for the survival probability.
</p>
</li>
<li> <p><code>"hazard"</code> for the hazard theoretical hazard.
</p>
</li></ul>
</td></tr>
<tr><td><code id="predict.survival_ln_mixture_em_+3A_eval_time">eval_time</code></td>
<td>
<p>For type = &quot;hazard&quot; or type = &quot;survival&quot;, the times for the distribution.</p>
</td></tr>
<tr><td><code id="predict.survival_ln_mixture_em_+3A_...">...</code></td>
<td>
<p>Not used, but required for extensibility.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble of predictions. The number of rows in the tibble is guaranteed
to be the same as the number of rows in <code>new_data</code>.
</p>


<h3>Note</h3>

<p>Categorical predictors must be converted to factors before the fit,
otherwise the predictions will fail.
</p>

<hr>
<h2 id='reexports'>Objects exported from other packages</h2><span id='topic+reexports'></span><span id='topic+tidy'></span><span id='topic+augment'></span><span id='topic+nobs'></span>

<h3>Description</h3>

<p>These objects are imported from other packages. Follow the links
below to see their documentation.
</p>

<dl>
<dt>generics</dt><dd><p><code><a href="generics.html#topic+augment">augment</a></code>, <code><a href="generics.html#topic+tidy">tidy</a></code></p>
</dd>
<dt>stats</dt><dd><p><code><a href="stats.html#topic+nobs">nobs</a></code></p>
</dd>
</dl>

<hr>
<h2 id='sim_data'>Simulated lognormal mixture data.</h2><span id='topic+sim_data'></span>

<h3>Description</h3>

<p>A simulated dataset with 10000 observations from a lognormal mixutre
model with 2 componentes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim_data
</code></pre>


<h3>Format</h3>



<h4><code>sim_data</code></h4>

<p>A list with two componentes:
</p>

<ul>
<li><p> $data: A data frame with 10,000 rows and 3 columns:
</p>

<dl>
<dt>y</dt><dd><p>observed survival time</p>
</dd>
<dt>delta</dt><dd><p>event indicator. 1 == event, 0 == censored.</p>
</dd>
<dt>x</dt><dd><p>binary covariate</p>
</dd>
</dl>

</li>
<li><p> $true_vals: A named vector with the true values used to generate the data.
</p>
</li></ul>



<hr>
<h2 id='simulate_data'>Function to simulate survival data from a mixture of normal distribution.</h2><span id='topic+simulate_data'></span>

<h3>Description</h3>

<p><code>simulate_data()</code> simulates data from a mixture model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate_data(
  n = 4000,
  mixture_components = 2,
  k = 2,
  percentage_censored = 0.4,
  starting_seed = sample(1:2^28, 1)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="simulate_data_+3A_n">n</code></td>
<td>
<p>Number of observations desired.</p>
</td></tr>
<tr><td><code id="simulate_data_+3A_mixture_components">mixture_components</code></td>
<td>
<p>Number of mixtures to include in the generation of the data.</p>
</td></tr>
<tr><td><code id="simulate_data_+3A_k">k</code></td>
<td>
<p>number of covariates generated (the total of covariates will be intercept + (k - 1) covariates).</p>
</td></tr>
<tr><td><code id="simulate_data_+3A_percentage_censored">percentage_censored</code></td>
<td>
<p>Percentage of censored observations (defined as decimal value between 0 and 1). This will generate a delta vector in which 1 is an event that ocurred and 0 is a censored observation.</p>
</td></tr>
<tr><td><code id="simulate_data_+3A_starting_seed">starting_seed</code></td>
<td>
<p>Seed to start the random number generation.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with two elements: <code>data</code> and <code>real_values</code>. The <code>data</code> element is a tibble with the simulated data. The <code>real_values</code> is a tibble with the real values of the parameters used to generate the data.
</p>

<hr>
<h2 id='survival_ln_mixture'>Lognormal mixture model - Gibbs sampler</h2><span id='topic+survival_ln_mixture'></span><span id='topic+survival_ln_mixture.default'></span><span id='topic+survival_ln_mixture.formula'></span>

<h3>Description</h3>

<p><code>survival_ln_mixture()</code> fits a Bayesian lognormal mixture model with Gibbs sampling (optional EM algorithm to find local maximum at the likelihood function), as described in LOBO, Viviana GR; FONSECA, Thaís CO; ALVES, Mariane B. Lapse risk modeling in insurance: a Bayesian mixture approach. Annals of Actuarial Science, v. 18, n. 1, p. 126-151, 2024.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>survival_ln_mixture(
  formula,
  data,
  intercept = TRUE,
  iter = 1000,
  warmup = floor(iter/10),
  thin = 1,
  chains = 1,
  cores = 1,
  mixture_components = 2,
  show_progress = FALSE,
  em_iter = 0,
  starting_seed = sample(1:2^28, 1),
  use_W = FALSE,
  number_em_search = 200,
  iteration_em_search = 1,
  fast_groups = TRUE,
  ...
)

## Default S3 method:
survival_ln_mixture(formula, ...)

## S3 method for class 'formula'
survival_ln_mixture(formula, data, intercept = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="survival_ln_mixture_+3A_formula">formula</code></td>
<td>
<p>A formula specifying the outcome terms on the left-hand side,
and the predictor terms on the right-hand side. The outcome must be a <a href="survival.html#topic+Surv">survival::Surv</a>
object.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_+3A_data">data</code></td>
<td>
<p>A <strong>data frame</strong> containing both the predictors and the outcome.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_+3A_intercept">intercept</code></td>
<td>
<p>A logical. Should an intercept be included in the processed data?</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_+3A_iter">iter</code></td>
<td>
<p>A positive integer specifying the number of iterations for each chain (including warmup).</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_+3A_warmup">warmup</code></td>
<td>
<p>A positive integer specifying the number of warmup (aka burnin) iterations per chain.
The number of warmup iterations should be smaller than iter.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_+3A_thin">thin</code></td>
<td>
<p>A positive integer specifying the period for saving samples.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_+3A_chains">chains</code></td>
<td>
<p>A positive integer specifying the number of Markov chains.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_+3A_cores">cores</code></td>
<td>
<p>A positive integer specifying the maximum number of cores to run the chains. Setting this to a value bigger than 1 will automatically trigger the parallel mode</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_+3A_mixture_components">mixture_components</code></td>
<td>
<p>number of mixture componentes &gt;= 2.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_+3A_show_progress">show_progress</code></td>
<td>
<p>Indicates if the code shows the progress of the EM algorithm and the Gibbs Sampler.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_+3A_em_iter">em_iter</code></td>
<td>
<p>A positive integer specifying the number of iterations for the EM algorithm. The EM algorithm is performed before the Gibbs sampler to find better initial values for the chains. On simulations, values lower than 200 seems to work nice.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_+3A_starting_seed">starting_seed</code></td>
<td>
<p>Starting seed for the sampler. If not specified by the user, uses a random integer between 1 and 2^28 This way we ensure, when the user sets a seed in R, that this is passed into the C++ code.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_+3A_use_w">use_W</code></td>
<td>
<p>Specifies is the W (groups weight's matrix for each observation) should be used from EM. It holds W constant through the code, resulting in a faster Bayesian Inference (close to what Empirical Bayes would do). It may helps generating credible intervals for the survival and hazard curves, using the information from the previous EM iteration. Make sure the EM have converged before setting this parameter to true. In doubt, leave this as FALSE, the default.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_+3A_number_em_search">number_em_search</code></td>
<td>
<p>Number of different EM's to search for maximum likelihoods. Recommended to leave, at least, at 100. This value can be set to 0 to disable the search for maximum likelihood initial values.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_+3A_iteration_em_search">iteration_em_search</code></td>
<td>
<p>Number of iterations for each of the EM's used to find the maximum likelihoods. Recommended to leave at small values, such as from 1 to 5.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_+3A_fast_groups">fast_groups</code></td>
<td>
<p>Use fast computation of groups allocations probabilities, defaults to TRUE. Setting it to FALSE can increase the computation time (a lot) but it's worth trying if the chains are not converging.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_+3A_...">...</code></td>
<td>
<p>Not currently used, but required for extensibility.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>survival_ln_mixture</code> object, which is a list with the following componentes:
</p>
<table role = "presentation">
<tr><td><code>posterior</code></td>
<td>
<p>A <a href="posterior.html#topic+draws_matrix">posterior::draws_matrix</a> with the posterior of the parameters of the model.</p>
</td></tr>
<tr><td><code>nobs</code></td>
<td>
<p>A integer holding the number of observations used to generate the fit.</p>
</td></tr>
<tr><td><code>blueprint</code></td>
<td>
<p>The blueprint component of the output of <a href="hardhat.html#topic+mold">hardhat::mold</a></p>
</td></tr>
</table>


<h3>Note</h3>

<p>Categorical predictors must be converted to factors before the fit,
otherwise the predictions will fail.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Formula interface
library(survival)
set.seed(1)
mod &lt;- survival_ln_mixture(Surv(time, status == 2) ~ NULL, lung, intercept = TRUE)

</code></pre>

<hr>
<h2 id='survival_ln_mixture_em'>Lognormal mixture model - Expectation-Maximization Algorithm</h2><span id='topic+survival_ln_mixture_em'></span><span id='topic+survival_ln_mixture_em.default'></span><span id='topic+survival_ln_mixture_em.formula'></span>

<h3>Description</h3>

<p><code>survival_ln_mixture_em()</code> fits an EM algorithm, as described in LOBO, Viviana GR; FONSECA, Thaís CO; ALVES, Mariane B. Lapse risk modeling in insurance: a Bayesian mixture approach. Annals of Actuarial Science, v. 18, n. 1, p. 126-151, 2024, for modelling mixtures of lognormal distributions applied to survival data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>survival_ln_mixture_em(
  formula,
  data,
  intercept = TRUE,
  iter = 50,
  mixture_components = 2,
  starting_seed = sample(1:2^28, 1),
  number_em_search = 200,
  iteration_em_search = 1,
  show_progress = FALSE,
  ...
)

## Default S3 method:
survival_ln_mixture_em(formula, ...)

## S3 method for class 'formula'
survival_ln_mixture_em(formula, data, intercept = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="survival_ln_mixture_em_+3A_formula">formula</code></td>
<td>
<p>A formula specifying the outcome terms on the left-hand side,
and the predictor terms on the right-hand side. The outcome must be a <a href="survival.html#topic+Surv">survival::Surv</a>
object.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_em_+3A_data">data</code></td>
<td>
<p>A <strong>data frame</strong> containing both the predictors and the outcome.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_em_+3A_intercept">intercept</code></td>
<td>
<p>A logical. Should an intercept be included in the processed data?</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_em_+3A_iter">iter</code></td>
<td>
<p>A positive integer specifying the number of iterations for the EM algorithm.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_em_+3A_mixture_components">mixture_components</code></td>
<td>
<p>number of mixture componentes &gt;= 2.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_em_+3A_starting_seed">starting_seed</code></td>
<td>
<p>Starting seed for the algorithm. If not specified by the user, uses a random integer between 1 and 2^28 This way we ensure, when the user sets a seed in R, that this is passed into the C++ code.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_em_+3A_number_em_search">number_em_search</code></td>
<td>
<p>Number of different EM's to search for maximum likelihoods. Recommended to leave, at least, at 100.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_em_+3A_iteration_em_search">iteration_em_search</code></td>
<td>
<p>Number of iterations for each of the EM's used to find the maximum likelihoods. Recommended to leave at small values, such as from 1 to 5.</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_em_+3A_show_progress">show_progress</code></td>
<td>
<p>A logical. Should the progress of the EM algorithm be shown?</p>
</td></tr>
<tr><td><code id="survival_ln_mixture_em_+3A_...">...</code></td>
<td>
<p>Not currently used, but required for extensibility.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>survival_ln_mixture_em</code> containing the following elements:
</p>

<ul>
<li> <p><code>em_iterations</code>: A data frame containing the EM iterations.
</p>
</li>
<li> <p><code>nobs</code>: The number of observations.
</p>
</li>
<li> <p><code>predictors_name</code>: The names of the predictors.
</p>
</li>
<li> <p><code>logLik</code>: The log-likelihood of the model.
</p>
</li>
<li> <p><code>mixture_groups</code>: The number of mixture groups.
</p>
</li>
<li> <p><code>blueprint</code>: The blueprint used to process the formula
</p>
</li></ul>


<hr>
<h2 id='tidy.survival_ln_mixture'>Tidying method for a Lognormal Mixture model.</h2><span id='topic+tidy.survival_ln_mixture'></span>

<h3>Description</h3>

<p>These method tidy the estimates from <code>survival_ln_mixture</code> fits into a summary.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'survival_ln_mixture'
tidy(
  x,
  effects = "fixed",
  conf.int = FALSE,
  conf.level = 0.9,
  digits = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tidy.survival_ln_mixture_+3A_x">x</code></td>
<td>
<p>Fitted model object (survival_ln_mixture).</p>
</td></tr>
<tr><td><code id="tidy.survival_ln_mixture_+3A_effects">effects</code></td>
<td>
<p>A character vector including one or more of <code>"fixed"</code> and <code style="white-space: pre;">&#8288;"auxiliary&#8288;</code>.</p>
</td></tr>
<tr><td><code id="tidy.survival_ln_mixture_+3A_conf.int">conf.int</code></td>
<td>
<p>If <code>TRUE</code> columns for lower (<code>cred.low</code>) and upper (<code>cred.high</code>) bounds
of the posterior uncertainty intervals are included.</p>
</td></tr>
<tr><td><code id="tidy.survival_ln_mixture_+3A_conf.level">conf.level</code></td>
<td>
<p>A number between 0 and 1 indicating the desired probability mass to include in the
intervals. Only used if <code>conf.int = TRUE</code>.</p>
</td></tr>
<tr><td><code id="tidy.survival_ln_mixture_+3A_digits">digits</code></td>
<td>
<p>How many significant digits should be displayed?</p>
</td></tr>
<tr><td><code id="tidy.survival_ln_mixture_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.frame</code> without rownames. When <code>effects="fixed"</code> (the default), tidy.survival_ln_mixutre
returns one row for each coefficient for each component of the mixture with three columns:
</p>
<table role = "presentation">
<tr><td><code>term</code></td>
<td>
<p>The name of the corresponding term in the model.</p>
</td></tr>
<tr><td><code>estimate</code></td>
<td>
<p>A point estimate of the coefficient (posterior median).</p>
</td></tr>
<tr><td><code>std.error</code></td>
<td>
<p>A standard error for the point estimate based on
<code><a href="stats.html#topic+mad">mad</a></code>. See the <em>Uncertainty estimates</em> section in
<code><a href="rstanarm.html#topic+print.stanreg">print.stanreg</a></code> for more details.</p>
</td></tr>
</table>
<p>Setting <code>effects="auxiliary"</code> will select the precision and proportion of mixture components parameters.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
require(survival)
lung$sex &lt;- factor(lung$sex)
set.seed(1)
mod2 &lt;- survival_ln_mixture(Surv(time, status == 2) ~ sex, lung)
tidy(mod2)
tidy(mod2, conf.int = TRUE)
tidy(mod2, effects = c("fixed", "auxiliary"), conf.int = TRUE)

</code></pre>

<hr>
<h2 id='tidy.survival_ln_mixture_em'>Tidying method for a Lognormal Mixture model (fitted via Expectation-Maximization algorithm).</h2><span id='topic+tidy.survival_ln_mixture_em'></span>

<h3>Description</h3>

<p>These method tidy the estimates from <code>survival_ln_mixture</code> fits into a short summary. It doesn't contain uncertainty estimates since it's a likelihood maximization algorithm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'survival_ln_mixture_em'
tidy(x, effects = "fixed", digits = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tidy.survival_ln_mixture_em_+3A_x">x</code></td>
<td>
<p>Fitted model object (survival_ln_mixture_em).</p>
</td></tr>
<tr><td><code id="tidy.survival_ln_mixture_em_+3A_effects">effects</code></td>
<td>
<p>A character vector including one or more of <code>"fixed"</code> and <code style="white-space: pre;">&#8288;"auxiliary&#8288;</code>.</p>
</td></tr>
<tr><td><code id="tidy.survival_ln_mixture_em_+3A_digits">digits</code></td>
<td>
<p>How many significant digits should be displayed?</p>
</td></tr>
<tr><td><code id="tidy.survival_ln_mixture_em_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.frame</code> without rownames. When <code>effects="fixed"</code> (the default), tidy.survival_ln_mixutre
returns one row for each coefficient for each component of the mixture with two columns:
</p>
<table role = "presentation">
<tr><td><code>term</code></td>
<td>
<p>The name of the corresponding term in the model.</p>
</td></tr>
<tr><td><code>estimate</code></td>
<td>
<p>A point estimate of the coefficient (last iteration value).</p>
</td></tr>
</table>
<p>Setting <code>effects="auxiliary"</code> will select the precision and proportion of mixture components parameters.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
require(survival)
lung$sex &lt;- factor(lung$sex)
set.seed(1)
mod2 &lt;- survival_ln_mixture_em(Surv(time, status == 2) ~ sex, lung)
tidy(mod2)
tidy(mod2, effects = c("fixed", "auxiliary"))

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
