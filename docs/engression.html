<!DOCTYPE html><html lang="en"><head><title>Help for package engression</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {engression}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#dftomat'><p>Convert Data Frame to Numeric Matrix</p></a></li>
<li><a href='#energyloss'><p>Energy Loss Calculation</p></a></li>
<li><a href='#energylossall'><p>Energy Loss Calculation (Extended Output)</p></a></li>
<li><a href='#energylossbeta'><p>Energy Loss Calculation with Beta Scaling</p></a></li>
<li><a href='#engression'><p>Engression Function</p></a></li>
<li><a href='#engressionfit'><p>Engression Fit Function</p></a></li>
<li><a href='#predict.engression'><p>Prediction Function for Engression Models</p></a></li>
<li><a href='#print.engression'><p>Print an Engression Model Object</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Engression Modelling</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.4</td>
</tr>
<tr>
<td>Description:</td>
<td>Fits engression models for nonlinear distributional regression. Predictors and targets can be univariate or multivariate. Functionality includes estimation of conditional mean, estimation of conditional quantiles, or sampling from the fitted distribution. Training is done full-batch on CPU (the python version offers GPU-accelerated stochastic gradient descent). Based on "Engression: Extrapolation for nonlinear regression?" by Xinwei Shen and Nicolai Meinshausen (2023). Also supports classification (experimental). 
 &lt;<a href="https://doi.org/10.48550/arXiv.2307.00835">doi:10.48550/arXiv.2307.00835</a>&gt;.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/xwshen51/engression/">https://github.com/xwshen51/engression/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/xwshen51/engression/issues">https://github.com/xwshen51/engression/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Imports:</td>
<td>torch</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-11-21 11:10:49 UTC; nicolai</td>
</tr>
<tr>
<td>Author:</td>
<td>Xinwei Shen [aut],
  Nicolai Meinshausen [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Nicolai Meinshausen &lt;meinshausen@stat.math.ethz.ch&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-11-22 08:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='dftomat'>Convert Data Frame to Numeric Matrix</h2><span id='topic+dftomat'></span>

<h3>Description</h3>

<p>This function converts a data frame into a numeric matrix. If the data frame
contains factor or character variables, they are first converted to numeric.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dftomat(X)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dftomat_+3A_x">X</code></td>
<td>
<p>A data frame to be converted to a numeric matrix.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric matrix corresponding to the input data frame.
</p>

<hr>
<h2 id='energyloss'>Energy Loss Calculation</h2><span id='topic+energyloss'></span>

<h3>Description</h3>

<p>This function calculates the energy loss for given tensors. The loss is calculated
as the mean of the L2 norms between <code>yt</code> and <code>mxt</code> and between <code>yt</code> and <code>mxpt</code>,
subtracted by half the mean of the L2 norm between <code>mxt</code> and <code>mxpt</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>energyloss(yt, mxt, mxpt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="energyloss_+3A_yt">yt</code></td>
<td>
<p>A tensor representing the target values.</p>
</td></tr>
<tr><td><code id="energyloss_+3A_mxt">mxt</code></td>
<td>
<p>A tensor representing the model's stochastic predictions.</p>
</td></tr>
<tr><td><code id="energyloss_+3A_mxpt">mxpt</code></td>
<td>
<p>A tensor representing another draw of the model's stochastic predictions.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A scalar representing the calculated energy loss.
</p>

<hr>
<h2 id='energylossall'>Energy Loss Calculation (Extended Output)</h2><span id='topic+energylossall'></span>

<h3>Description</h3>

<p>This function calculates the energy loss for given tensors, similar to <code>energyloss()</code>. The loss is calculated
as the mean of the L2 norms between <code>yt</code> and <code>mxt</code> and between <code>yt</code> and <code>mxpt</code>,
subtracted by half the mean of the L2 norm between <code>mxt</code> and <code>mxpt</code>. Unlike <code>energyloss()</code>, this function
also returns the prediction loss s1 = E(|yt-mxt|) and variance loss s2 = E(|mxt-mxpt'|) as part of the output.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>energylossall(yt, mxt, mxpt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="energylossall_+3A_yt">yt</code></td>
<td>
<p>A tensor representing the target values.</p>
</td></tr>
<tr><td><code id="energylossall_+3A_mxt">mxt</code></td>
<td>
<p>A tensor representing the model's stochastic predictions.</p>
</td></tr>
<tr><td><code id="energylossall_+3A_mxpt">mxpt</code></td>
<td>
<p>A tensor representing another draw of the model's stochastic predictions.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector containing the calculated energy loss, <code>s1</code>, and <code>s2</code>.
</p>

<hr>
<h2 id='energylossbeta'>Energy Loss Calculation with Beta Scaling</h2><span id='topic+energylossbeta'></span>

<h3>Description</h3>

<p>This function calculates the energy loss for given tensors. The loss is calculated
as the mean of the L2 norms between <code>yt</code> and <code>mxt</code> and between <code>yt</code> and <code>mxpt</code>,
each raised to the power of <code>beta</code>, subtracted by half the mean of the L2 norm between <code>mxt</code> and <code>mxpt</code>,
also raised to the power of <code>beta</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>energylossbeta(yt, mxt, mxpt, beta)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="energylossbeta_+3A_yt">yt</code></td>
<td>
<p>A tensor representing the target values.</p>
</td></tr>
<tr><td><code id="energylossbeta_+3A_mxt">mxt</code></td>
<td>
<p>A tensor representing the model's stochastic predictions.</p>
</td></tr>
<tr><td><code id="energylossbeta_+3A_mxpt">mxpt</code></td>
<td>
<p>A tensor representing another draw of the model's stochastic predictions.</p>
</td></tr>
<tr><td><code id="energylossbeta_+3A_beta">beta</code></td>
<td>
<p>A numeric value for scaling the energy loss.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A scalar representing the calculated energy loss.
</p>

<hr>
<h2 id='engression'>Engression Function</h2><span id='topic+engression'></span>

<h3>Description</h3>

<p>This function fits an engression model to the data. It allows for
the tuning of several parameters related to model complexity.
Variables are per default internally standardized (predictions are on original scale).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>engression(
  X,
  Y,
  noise_dim = 5,
  hidden_dim = 100,
  num_layer = 3,
  dropout = 0.05,
  batch_norm = TRUE,
  num_epochs = 1000,
  lr = 10^(-3),
  beta = 1,
  silent = FALSE,
  standardize = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="engression_+3A_x">X</code></td>
<td>
<p>A matrix or data frame representing the predictors.</p>
</td></tr>
<tr><td><code id="engression_+3A_y">Y</code></td>
<td>
<p>A matrix or vector representing the target variable(s). If Y is a factor a classification model is fitted (experimental).</p>
</td></tr>
<tr><td><code id="engression_+3A_noise_dim">noise_dim</code></td>
<td>
<p>The dimension of the noise introduced in the model (default: 5).</p>
</td></tr>
<tr><td><code id="engression_+3A_hidden_dim">hidden_dim</code></td>
<td>
<p>The size of the hidden layer in the model (default: 100).</p>
</td></tr>
<tr><td><code id="engression_+3A_num_layer">num_layer</code></td>
<td>
<p>The number of layers in the model (default: 3).</p>
</td></tr>
<tr><td><code id="engression_+3A_dropout">dropout</code></td>
<td>
<p>The dropout rate to be used in the model in case no batch normalization is used. Only active if batch normalization is off. (default: 0.01)</p>
</td></tr>
<tr><td><code id="engression_+3A_batch_norm">batch_norm</code></td>
<td>
<p>A boolean indicating whether to use batch-normalization (default: TRUE).</p>
</td></tr>
<tr><td><code id="engression_+3A_num_epochs">num_epochs</code></td>
<td>
<p>The number of epochs to be used in training (default: 1000).</p>
</td></tr>
<tr><td><code id="engression_+3A_lr">lr</code></td>
<td>
<p>The learning rate to be used in training (default: 10^-3).</p>
</td></tr>
<tr><td><code id="engression_+3A_beta">beta</code></td>
<td>
<p>The beta scaling factor for energy loss (default: 1).</p>
</td></tr>
<tr><td><code id="engression_+3A_silent">silent</code></td>
<td>
<p>A boolean indicating whether to suppress output during model training (default: FALSE).</p>
</td></tr>
<tr><td><code id="engression_+3A_standardize">standardize</code></td>
<td>
<p>A boolean indicating whether to standardize the input data (default: TRUE).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An engression model object with class &quot;engression&quot;.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  n = 1000
  p = 5

  X = matrix(rnorm(n*p),ncol=p)
  Y = (X[,1]+rnorm(n)*0.1)^2 + (X[,2]+rnorm(n)*0.1) + rnorm(n)*0.1
  Xtest = matrix(rnorm(n*p),ncol=p)
  Ytest = (Xtest[,1]+rnorm(n)*0.1)^2 + (Xtest[,2]+rnorm(n)*0.1) + rnorm(n)*0.1

  ## fit engression object
  engr = engression(X,Y)
  print(engr)

  ## prediction on test data
  Yhat = predict(engr,Xtest,type="mean")
  cat("\n correlation between predicted and realized values:  ", signif(cor(Yhat, Ytest),3))
  plot(Yhat, Ytest,xlab="prediction", ylab="observation")

  ## quantile prediction
  Yhatquant = predict(engr,Xtest,type="quantiles")
  ord = order(Yhat)
  matplot(Yhat[ord], Yhatquant[ord,], type="l", col=2,lty=1,xlab="prediction", ylab="observation")
  points(Yhat[ord],Ytest[ord],pch=20,cex=0.5)

  ## sampling from estimated model
  Ysample = predict(engr,Xtest,type="sample",nsample=1)
   
  ## plot of realized values against first variable
  oldpar &lt;- par()
  par(mfrow=c(1,2))
  plot(Xtest[,1], Ytest, xlab="Variable 1", ylab="Observation")
  ## plot of sampled values against first variable
  plot(Xtest[,1], Ysample, xlab="Variable 1", ylab="Sample from engression model")   
  par(oldpar)


</code></pre>

<hr>
<h2 id='engressionfit'>Engression Fit Function</h2><span id='topic+engressionfit'></span>

<h3>Description</h3>

<p>This function fits an Engression model to the provided data. It allows for the tuning of
several parameters related to model complexity and training. The function is not meant to
be exported but can be used within the package or for internal testing purposes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>engressionfit(
  X,
  Y,
  noise_dim = 100,
  hidden_dim = 100,
  num_layer = 3,
  dropout = 0.01,
  batch_norm = TRUE,
  num_epochs = 200,
  lr = 10^(-3),
  beta = 1,
  silent = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="engressionfit_+3A_x">X</code></td>
<td>
<p>A matrix or data frame representing the predictors.</p>
</td></tr>
<tr><td><code id="engressionfit_+3A_y">Y</code></td>
<td>
<p>A matrix representing the target variable(s).</p>
</td></tr>
<tr><td><code id="engressionfit_+3A_noise_dim">noise_dim</code></td>
<td>
<p>The dimension of the noise introduced in the model (default: 100).</p>
</td></tr>
<tr><td><code id="engressionfit_+3A_hidden_dim">hidden_dim</code></td>
<td>
<p>The size of the hidden layer in the model (default: 100).</p>
</td></tr>
<tr><td><code id="engressionfit_+3A_num_layer">num_layer</code></td>
<td>
<p>The number of layers in the model (default: 3).</p>
</td></tr>
<tr><td><code id="engressionfit_+3A_dropout">dropout</code></td>
<td>
<p>The dropout rate to be used in the model in case no batch normalization is used (default: 0.01)</p>
</td></tr>
<tr><td><code id="engressionfit_+3A_batch_norm">batch_norm</code></td>
<td>
<p>A boolean indicating whether to use batch-normalization (default: TRUE).</p>
</td></tr>
<tr><td><code id="engressionfit_+3A_num_epochs">num_epochs</code></td>
<td>
<p>The number of epochs to be used in training (default: 200).</p>
</td></tr>
<tr><td><code id="engressionfit_+3A_lr">lr</code></td>
<td>
<p>The learning rate to be used in training (default: 10^-3).</p>
</td></tr>
<tr><td><code id="engressionfit_+3A_beta">beta</code></td>
<td>
<p>The beta scaling factor for energy loss (default: 1).</p>
</td></tr>
<tr><td><code id="engressionfit_+3A_silent">silent</code></td>
<td>
<p>A boolean indicating whether to suppress output during model training (default: FALSE).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the trained engression model and a vector of loss values.
</p>

<hr>
<h2 id='predict.engression'>Prediction Function for Engression Models</h2><span id='topic+predict.engression'></span>

<h3>Description</h3>

<p>This function computes predictions from a trained engression model. It allows for the generation of point estimates, quantiles,
or samples from the estimated distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'engression'
predict(
  object,
  Xtest,
  type = c("mean", "sample", "quantile")[1],
  trim = 0.05,
  quantiles = 0.1 * (1:9),
  nsample = 200,
  drop = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.engression_+3A_object">object</code></td>
<td>
<p>A trained engression model returned from engression, engressionBagged or engressionfit functions.</p>
</td></tr>
<tr><td><code id="predict.engression_+3A_xtest">Xtest</code></td>
<td>
<p>A matrix or data frame representing the predictors in the test set.</p>
</td></tr>
<tr><td><code id="predict.engression_+3A_type">type</code></td>
<td>
<p>The type of prediction to make. &quot;mean&quot; for point estimates, &quot;sample&quot; for samples from the estimated distribution,
or &quot;quantile&quot; for quantiles of the estimated distribution (default: &quot;mean&quot;).</p>
</td></tr>
<tr><td><code id="predict.engression_+3A_trim">trim</code></td>
<td>
<p>The proportion of extreme values to trim when calculating the mean (default: 0.05).</p>
</td></tr>
<tr><td><code id="predict.engression_+3A_quantiles">quantiles</code></td>
<td>
<p>The quantiles to estimate if type is &quot;quantile&quot; (default: 0.1*(1:9)).</p>
</td></tr>
<tr><td><code id="predict.engression_+3A_nsample">nsample</code></td>
<td>
<p>The number of samples to draw if type is &quot;sample&quot; (default: 200).</p>
</td></tr>
<tr><td><code id="predict.engression_+3A_drop">drop</code></td>
<td>
<p>A boolean indicating whether to drop dimensions of length 1 from the output (default: TRUE).</p>
</td></tr>
<tr><td><code id="predict.engression_+3A_...">...</code></td>
<td>
<p>additional arguments (currently ignored)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix or array of predictions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  n = 1000
  p = 5

  X = matrix(rnorm(n*p),ncol=p)
  Y = (X[,1]+rnorm(n)*0.1)^2 + (X[,2]+rnorm(n)*0.1) + rnorm(n)*0.1
  Xtest = matrix(rnorm(n*p),ncol=p)
  Ytest = (Xtest[,1]+rnorm(n)*0.1)^2 + (Xtest[,2]+rnorm(n)*0.1) + rnorm(n)*0.1

  ## fit engression object
  engr = engression(X,Y)
  print(engr)

  ## prediction on test data
  Yhat = predict(engr,Xtest,type="mean")
  cat("\n correlation between predicted and realized values:  ", signif(cor(Yhat, Ytest),3))
  plot(Yhat, Ytest,xlab="prediction", ylab="observation")

  ## quantile prediction
  Yhatquant = predict(engr,Xtest,type="quantiles")
  ord = order(Yhat)
  matplot(Yhat[ord], Yhatquant[ord,], type="l", col=2,lty=1,xlab="prediction", ylab="observation")
  points(Yhat[ord],Ytest[ord],pch=20,cex=0.5)

  ## sampling from estimated model
  Ysample = predict(engr,Xtest,type="sample",nsample=1)
  



</code></pre>

<hr>
<h2 id='print.engression'>Print an Engression Model Object</h2><span id='topic+print.engression'></span>

<h3>Description</h3>

<p>This function is a utility that displays a summary of a fitted Engression model object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'engression'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.engression_+3A_x">x</code></td>
<td>
<p>A trained engression model returned from the engressionfit function.</p>
</td></tr>
<tr><td><code id="print.engression_+3A_...">...</code></td>
<td>
<p>additional arguments (currently ignored)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>This function does not return anything. It prints a summary of the model,
including information about its architecture and training process, and the loss
values achieved at several epochs during training.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  n = 1000
  p = 5

  X = matrix(rnorm(n*p),ncol=p)
  Y = (X[,1]+rnorm(n)*0.1)^2 + (X[,2]+rnorm(n)*0.1) + rnorm(n)*0.1
  
  ## fit engression object
  engr = engression(X,Y)
  print(engr)


</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
