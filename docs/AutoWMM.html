<!DOCTYPE html><html lang="en"><head><title>Help for package AutoWMM</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {AutoWMM}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#confInts'><p>confInts</p></a></li>
<li><a href='#countTree'><p>countTree</p></a></li>
<li><a href='#drawTree'><p>drawTree</p></a></li>
<li><a href='#estTree'><p>estTree</p></a></li>
<li><a href='#ko.weights'><p>ko.weights</p></a></li>
<li><a href='#logEstimates'><p>logEstimates</p></a></li>
<li><a href='#makeTree'><p>makeTree</p></a></li>
<li><a href='#mmEstimate'><p>mmEstimate</p></a></li>
<li><a href='#Nhats'><p>Nhats</p></a></li>
<li><a href='#root.confInt'><p>root.confInt</p></a></li>
<li><a href='#sampleBeta'><p>sampleBeta</p></a></li>
<li><a href='#ss.confInts'><p>ss.confInts</p></a></li>
<li><a href='#ssEstimate'><p>ssEstimate</p></a></li>
<li><a href='#treeData1'><p>Simple Tree Data</p></a></li>
<li><a href='#treeData2'><p>Larger Tree Data</p></a></li>
<li><a href='#wmmTree'><p>wmmTree</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Perform the Weighted Multiplier Method on Trees</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.1</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Mallory J Flynn &lt;mallory.flynn@stat.ubc.ca&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>When many possible multiplier method estimates of a target population are available, a weighted sum of estimates from each back-calculated path can be achieved with this package.  Variance-minimizing weights are used and with any admissible tree-structured data.  The methodological basis used to create this package can be found in Flynn (2023) <a href="http://hdl.handle.net/2429/86174">http://hdl.handle.net/2429/86174</a>.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/malfly/AutoWMM">https://github.com/malfly/AutoWMM</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.3.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>data.tree, DiagrammeR, dplyr, gtools, MASS, rlang, magrittr,
tidyselect</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-10-22 16:37:36 UTC; mallory</td>
</tr>
<tr>
<td>Author:</td>
<td>Mallory J Flynn [cre, aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-10-24 15:10:10 UTC</td>
</tr>
</table>
<hr>
<h2 id='confInts'>confInts</h2><span id='topic+confInts'></span>

<h3>Description</h3>

<p>Estimation helper function:
Method that takes samples and generates confidence intervals for
nodes other than the root. Assume raw data (not log), with normal distributed
log data for confidence interval construction
</p>


<h3>Usage</h3>

<pre><code class='language-R'>confInts(v)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="confInts_+3A_v">v</code></td>
<td>
<p>A vector</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a confidence interval. For non-root nodes
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data(treeData1)
 tree &lt;- makeTree(treeData1)
 message("note - longer run time example")
 Zhats &lt;- wmmTree(tree, sample_length = 10)
 confInts(Zhats$estimates)

</code></pre>

<hr>
<h2 id='countTree'>countTree</h2><span id='topic+countTree'></span>

<h3>Description</h3>

<p>Visualize post-wmmTree tree with root estimate and marginal counts
Also displays average of probability samples on each branch
</p>


<h3>Usage</h3>

<pre><code class='language-R'>countTree(tree)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="countTree_+3A_tree">tree</code></td>
<td>
<p>A makeTree object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a tree plot
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  message("note - longer run time example")
  data(treeData1)
  tree &lt;- makeTree(treeData1)
  Zhats &lt;- wmmTree(tree, sample_length = 3)
  countTree(tree)
 
</code></pre>

<hr>
<h2 id='drawTree'>drawTree</h2><span id='topic+drawTree'></span>

<h3>Description</h3>

<p>Visualize tree with descriptions and probabilities; can be used
pre-WMM analysis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>drawTree(tree, probs = TRUE, desc = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="drawTree_+3A_tree">tree</code></td>
<td>
<p>A makeTree object</p>
</td></tr>
<tr><td><code id="drawTree_+3A_probs">probs</code></td>
<td>
<p>A logical with default TRUE to specify whether to display
probabilities on branches</p>
</td></tr>
<tr><td><code id="drawTree_+3A_desc">desc</code></td>
<td>
<p>A logical with default TRUE to specify whether to display
node descriptions</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a descriptive tree plot
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(treeData1)
tree &lt;- makeTree(treeData1)
drawTree(tree)
</code></pre>

<hr>
<h2 id='estTree'>estTree</h2><span id='topic+estTree'></span>

<h3>Description</h3>

<p>Visualize post-wmmTree tree with root estimate given by each branch,
and weighted sum at the root (for post-analysis).
Also displays average of probability samples on each branch.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estTree(tree)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estTree_+3A_tree">tree</code></td>
<td>
<p>A makeTree object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a tree plot
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  message("note - longer run time example")
  data(treeData1)
  tree &lt;- makeTree(treeData1)
  Zhats &lt;- wmmTree(tree, sample_length = 3)
  estTree(tree)
 
</code></pre>

<hr>
<h2 id='ko.weights'>ko.weights</h2><span id='topic+ko.weights'></span>

<h3>Description</h3>

<p>Estimation helper function:
Calculating variance minimizing weights.  Only assigns weights to informative paths
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ko.weights(tree)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ko.weights_+3A_tree">tree</code></td>
<td>
<p>A makeTree object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns vector of variance-minimizing weights on informative paths
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data(treeData1)
 tree &lt;- makeTree(treeData1)
 Zhats &lt;- wmmTree(tree, sample_length = 3)
 ko.weights(tree)

</code></pre>

<hr>
<h2 id='logEstimates'>logEstimates</h2><span id='topic+logEstimates'></span>

<h3>Description</h3>

<p>Estimation helper function:
Creates a vector of mean estimate values given by each informative path
</p>


<h3>Usage</h3>

<pre><code class='language-R'>logEstimates(tree)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="logEstimates_+3A_tree">tree</code></td>
<td>
<p>A makeTree object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a vector of mean log estimate values of the root population size
from each informative path
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  message("note - longer run time example")
  data(treeData1)
  tree &lt;- makeTree(treeData1)
  Zhats &lt;- wmmTree(tree, sample_length = 3)
  logEstimates(tree)

</code></pre>

<hr>
<h2 id='makeTree'>makeTree</h2><span id='topic+makeTree'></span>

<h3>Description</h3>

<p>Assuming a specific structure, create a tree with the following columns:
from (node label), to (node label), Estimate (+ integer), Total (+ integer),
and Count (for terminal nodes with marginal counts).
'from' and 'to' describe the edge for that row of data, where 'Estimate'
and 'Total' are assumed to come from surveys of size 'Total' (a sample of
the population at node 'from'), and observe 'Estimate' number of those
individuals at 'Total' which move to the node described by 'to'.
'Estimate' and 'Total' columns are used for branching probabilities only.
'Count' column is NA for rows where 'to' nodes are not leaves; and also
for all leaves without a marginal count.
A Population (logical) column is not needed, but can be added if 'Estimate'
and 'Total' come from population numbers, rather than samples.
A 'Description' column (string) is also possible to include if particulars
are desired on the tree diagram.
'TerminalCount' (binary) will be created for functional purposes, where
marginal counts are included on leaves.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>makeTree(data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="makeTree_+3A_data">data</code></td>
<td>
<p>A dataframe object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a makeTree object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(treeData1)
tree &lt;- makeTree(treeData1)
</code></pre>

<hr>
<h2 id='mmEstimate'>mmEstimate</h2><span id='topic+mmEstimate'></span>

<h3>Description</h3>

<p>Helper function:
Performs the multiplier method from a single terminal node (o) and
returns the root estimate given that path, and the probabilities
of each branch on that path.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mmEstimate(o)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mmEstimate_+3A_o">o</code></td>
<td>
<p>A node from a makeTree object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns node with modified attributes
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data(treeData1)
 tree &lt;- makeTree(treeData1)
 mmEstimate(tree$A)
 mmEstimate(tree$B)
 tree$A$targetEst
 tree$B$targetEst

</code></pre>

<hr>
<h2 id='Nhats'>Nhats</h2><span id='topic+Nhats'></span>

<h3>Description</h3>

<p>Estimation helper function:
Returns Nhat for each sample from the WMM (rather than the aggregate
value given by the average, this calculates weights and applies the
weighted sum to each of the samples)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Nhats(tree)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Nhats_+3A_tree">tree</code></td>
<td>
<p>A makeTree object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a vector of root population size estimates from each sample
run of the wmmTree function
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data(treeData1)
 tree &lt;- makeTree(treeData1)
 Zhats &lt;- wmmTree(tree, sample_length = 3)
 Nhats(tree)

</code></pre>

<hr>
<h2 id='root.confInt'>root.confInt</h2><span id='topic+root.confInt'></span>

<h3>Description</h3>

<p>Estimation helper function:
Method for generating confidence interval for root node. Assumes unlogged
input data and normally distributed logged data.  Completes conversion
internally.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>root.confInt(tree, int.type = "quantiles")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="root.confInt_+3A_tree">tree</code></td>
<td>
<p>A makeTree object</p>
</td></tr>
<tr><td><code id="root.confInt_+3A_int.type">int.type</code></td>
<td>
<p>A string specifying interval type, passed from the wmmTree
function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a confidence interval for the root population size estimate
in un-logged form.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 message("note - longer run time example")
 data(treeData1)
 tree &lt;- makeTree(treeData1)
 Zhats &lt;- wmmTree(tree, sample_length = 3)
 root.confInt(tree)

</code></pre>

<hr>
<h2 id='sampleBeta'>sampleBeta</h2><span id='topic+sampleBeta'></span>

<h3>Description</h3>

<p>Helper function:
Method for sampling from a Beta distribution given the survey estimates
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sampleBeta(x, n, pop, node)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sampleBeta_+3A_x">x</code></td>
<td>
<p>An integer; typical use case is survey numerator</p>
</td></tr>
<tr><td><code id="sampleBeta_+3A_n">n</code></td>
<td>
<p>An integer; typical use case is survey sample size</p>
</td></tr>
<tr><td><code id="sampleBeta_+3A_pop">pop</code></td>
<td>
<p>A logical value which takes TRUE if sample size is population size</p>
</td></tr>
<tr><td><code id="sampleBeta_+3A_node">node</code></td>
<td>
<p>A node from a makeTree object; carried forever from</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns sample from Beta distribution with parameters dependent on x, n
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data(treeData1)
 tree &lt;- makeTree(treeData1)
 Zhats &lt;- wmmTree(tree, sample_length = 3)
 sampleBeta(10, 55, pop = FALSE, tree$A)

</code></pre>

<hr>
<h2 id='ss.confInts'>ss.confInts</h2><span id='topic+ss.confInts'></span>

<h3>Description</h3>

<p>Estimation helper function:
Method that takes samples and generates confidence intervals for
nodes in single source sibling tree (single.source = TRUE)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ss.confInts(o, digits = 3)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ss.confInts_+3A_o">o</code></td>
<td>
<p>A node of a makeTree object</p>
</td></tr>
<tr><td><code id="ss.confInts_+3A_digits">digits</code></td>
<td>
<p>The number of significant digits to report</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A confidence interval for nodes of the tree that only use a single
source of sibling data.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data(treeData1)
 tree &lt;- makeTree(treeData1)
 Zhats &lt;- wmmTree(tree, sample_length = 3)
 ss.confInts(tree$B)

</code></pre>

<hr>
<h2 id='ssEstimate'>ssEstimate</h2><span id='topic+ssEstimate'></span>

<h3>Description</h3>

<p>Helper function:
Performs the closed form calculation of variances and means based on a
&quot;single-source sibling&quot; tree.  Engages when single.source = TRUE
in wmmTree function.  See documentation for further details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ssEstimate(o)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ssEstimate_+3A_o">o</code></td>
<td>
<p>A node from a makeTree object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns node with modified attributes
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data(treeData1)
 tree &lt;- makeTree(treeData1)
 Zhats &lt;- wmmTree(tree, sample_length = 3)
 ssEstimate(tree$B)

</code></pre>

<hr>
<h2 id='treeData1'>Simple Tree Data</h2><span id='topic+treeData1'></span>

<h3>Description</h3>

<p>Small, artificially generated toy data set to demonstrate package functionality
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(treeData1)
</code></pre>


<h3>Format</h3>

<p>An object of class <code>"data.frame"</code>
</p>

<dl>
<dt>from</dt><dd><p>A node label and started point of directed edge (parent node)</p>
</dd>
<dt>to</dt><dd><p>A node label and endpoint of directed edge (child node)</p>
</dd>
<dt>Estimate</dt><dd><p>A numerical value assumed to be survey count belonging to 'to' node (integer)</p>
</dd>
<dt>Total</dt><dd><p>A numerical value assumed to be survey sample size (integer)</p>
</dd>
<dt>Count</dt><dd><p>A numerical value for marginal count if leaf node (integer)</p>
</dd>
<dt>Population</dt><dd><p>A boolean value for if survey size is entire population (logical)</p>
</dd>
<dt>Description</dt><dd><p>A string describing 'to' node (string)</p>
</dd>
</dl>



<h3>References</h3>

<p>This data set was artificially created for the AutoWMM package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(treeData1)
head(treeData1)

</code></pre>

<hr>
<h2 id='treeData2'>Larger Tree Data</h2><span id='topic+treeData2'></span>

<h3>Description</h3>

<p>Larger artificially generated toy data set to demonstrate package functionality
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(treeData2)
</code></pre>


<h3>Format</h3>

<p>An object of class <code>"data.frame"</code>
</p>

<dl>
<dt>from</dt><dd><p>A node label and started point of directed edge (parent node)</p>
</dd>
<dt>to</dt><dd><p>A node label and endpoint of directed edge (child node)</p>
</dd>
<dt>Estimate</dt><dd><p>A numerical value assumed to be survey count belonging to 'to' node (integer)</p>
</dd>
<dt>Total</dt><dd><p>A numerical value assumed to be survey sample size (integer)</p>
</dd>
<dt>Count</dt><dd><p>A numerical value for marginal count if leaf node (integer)</p>
</dd>
</dl>



<h3>References</h3>

<p>This data set was artificially created for the AutoWMM package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(treeData2)
head(treeData2)

</code></pre>

<hr>
<h2 id='wmmTree'>wmmTree</h2><span id='topic+wmmTree'></span>

<h3>Description</h3>

<p>Main function. Generate weighted estimates using the weighted
multiplier method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wmmTree(
  tree,
  sample_length = 10,
  method = "mmEstimate",
  int.type = "quants",
  single.source = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wmmTree_+3A_tree">tree</code></td>
<td>
<p>A makeTree object</p>
</td></tr>
<tr><td><code id="wmmTree_+3A_sample_length">sample_length</code></td>
<td>
<p>An integer for number of samples</p>
</td></tr>
<tr><td><code id="wmmTree_+3A_method">method</code></td>
<td>
<p>Method specifying weighting. Only default compatible with 'mmEstimate'
at this time</p>
</td></tr>
<tr><td><code id="wmmTree_+3A_int.type">int.type</code></td>
<td>
<p>A string specifying interval type. Default &quot;quants&quot; generates
the interval using the quantiles giving the central 95% of the samples.
Alternatively, &quot;var&quot; can be used to generate a variance-weighted confidence
interval, and &quot;cox&quot; generates a Cox interval.</p>
</td></tr>
<tr><td><code id="wmmTree_+3A_single.source">single.source</code></td>
<td>
<p>Set to TRUE if all data comes from single, fully informed
source.  Default is FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a makeTree object with branches and nodes now associated with
estimates and samples generated with the weighted multiplier method
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(treeData1)
  tree &lt;- makeTree(treeData1)
  Zhats &lt;- wmmTree(tree, sample_length = 3)

  message("Another example with a larger tree")
  message("note - longer run time example")
  data(treeData2)
  tree2 &lt;- makeTree(treeData2)
  Zhats &lt;- wmmTree(tree2, sample_length = 3)
  Zhats$estimates # print the estimates of the root node generated by the 15 iterations
  Zhats$weights # prints the weights of each branch
  Zhats$root # prints the final estimate of the root node by WMM
  Zhats$uncertainty # prints the final rounded estimate of the root with conf. int.

  message(paste("show the average root estimate with 95% confidence interval,",
          "as well as average estimates with confidence interval for each parameter"))
  tree2$Get('uncertainty')

  message("show the samples generated from each path which provides root estimates")
  tree2$Get('targetEst_samples')

  message("show the probabilities sampled at each branch leading into the given node")
  tree2$Get('probability_samples')

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
