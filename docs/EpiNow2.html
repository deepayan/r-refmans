<!DOCTYPE html><html><head><title>Help for package EpiNow2</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {EpiNow2}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#EpiNow2-package'><p>EpiNow2: Estimate Real-Time Case Counts and Time-Varying Epidemiological Parameters</p></a></li>
<li><a href='#+2B.dist_spec'><p>Creates a delay distribution as the sum of two other delay distributions</p></a></li>
<li><a href='#add_day_of_week'><p>Adds a day of the week vector</p></a></li>
<li><a href='#adjust_infection_to_report'><p>Adjust from Case Counts by Infection Date to Date of Report</p></a></li>
<li><a href='#allocate_delays'><p>Allocate Delays into Required Stan Format</p></a></li>
<li><a href='#allocate_empty'><p>Allocate Empty Parameters to a List</p></a></li>
<li><a href='#backcalc_opts'><p>Back Calculation Options</p></a></li>
<li><a href='#bootstrapped_dist_fit'><p>Fit a Subsampled Bootstrap to Integer Values and Summarise Distribution</p>
Parameters</a></li>
<li><a href='#c.dist_spec'><p>Combines multiple delay distributions for further processing</p></a></li>
<li><a href='#calc_CrI'><p>Calculate Credible Interval</p></a></li>
<li><a href='#calc_CrIs'><p>Calculate Credible Intervals</p></a></li>
<li><a href='#calc_summary_measures'><p>Calculate All Summary Measures</p></a></li>
<li><a href='#calc_summary_stats'><p>Calculate Summary Statistics</p></a></li>
<li><a href='#clean_nowcasts'><p>Clean Nowcasts for a Supplied Date</p></a></li>
<li><a href='#clean_regions'><p>Clean Regions</p></a></li>
<li><a href='#construct_output'><p>Construct Output</p></a></li>
<li><a href='#convert_to_logmean'><p>Convert mean and sd to log mean for a log normal distribution</p></a></li>
<li><a href='#convert_to_logsd'><p>Convert mean and sd to log standard deviation for a log normal distribution</p></a></li>
<li><a href='#copy_results_to_latest'><p>Copy Results From Dated Folder to Latest</p></a></li>
<li><a href='#create_backcalc_data'><p>Create Back Calculation Data</p></a></li>
<li><a href='#create_clean_reported_cases'><p>Create Clean Reported Cases</p></a></li>
<li><a href='#create_future_rt'><p>Construct the Required Future Rt assumption</p></a></li>
<li><a href='#create_gp_data'><p>Create Gaussian Process Data</p></a></li>
<li><a href='#create_initial_conditions'><p>Create Initial Conditions Generating Function</p></a></li>
<li><a href='#create_obs_model'><p>Create Observation Model Settings</p></a></li>
<li><a href='#create_rt_data'><p>Create Time-varying Reproduction Number Data</p></a></li>
<li><a href='#create_shifted_cases'><p>Create Delay Shifted Cases</p></a></li>
<li><a href='#create_stan_args'><p>Create a List of Stan Arguments</p></a></li>
<li><a href='#create_stan_data'><p>Create Stan Data Required for estimate_infections</p></a></li>
<li><a href='#create_stan_delays'><p>Create delay variables for stan</p></a></li>
<li><a href='#delay_opts'><p>Delay Distribution Options</p></a></li>
<li><a href='#dist_fit'><p>Fit an Integer Adjusted Exponential, Gamma or Lognormal distributions</p></a></li>
<li><a href='#dist_skel'><p>Distribution Skeleton</p></a></li>
<li><a href='#dist_spec'><p>Specify a distribution.</p></a></li>
<li><a href='#dist_spec_plus'><p>Creates a delay distribution as the sum of two other delay distributions</p></a></li>
<li><a href='#epinow'><p>Real-time Rt Estimation, Forecasting and Reporting</p></a></li>
<li><a href='#estimate_delay'><p>Estimate a Delay Distribution</p></a></li>
<li><a href='#estimate_infections'><p>Estimate Infections, the Time-Varying Reproduction Number and the Rate of</p>
Growth</a></li>
<li><a href='#estimate_secondary'><p>Estimate a Secondary Observation from a Primary Observation</p></a></li>
<li><a href='#estimate_truncation'><p>Estimate Truncation of Observed Data</p></a></li>
<li><a href='#estimates_by_report_date'><p>Estimate Cases by Report Date</p></a></li>
<li><a href='#example_confirmed'><p>Example Confirmed Case Data Set</p></a></li>
<li><a href='#expose_stan_fns'><p>Expose internal package stan functions in R</p></a></li>
<li><a href='#extract_CrIs'><p>Extract Credible Intervals Present</p></a></li>
<li><a href='#extract_inits'><p>Generate initial conditions from a Stan fit</p></a></li>
<li><a href='#extract_parameter'><p>Extract Samples for a Parameter from a Stan model</p></a></li>
<li><a href='#extract_parameter_samples'><p>Extract Parameter Samples from a Stan Model</p></a></li>
<li><a href='#extract_stan_param'><p>Extract a Parameter Summary from a Stan Object</p></a></li>
<li><a href='#extract_static_parameter'><p>Extract Samples from a Parameter with a Single Dimension</p></a></li>
<li><a href='#filter_opts'><p>Filter Options for a Target Region</p></a></li>
<li><a href='#fit_model_with_nuts'><p>Fit a Stan Model using the NUTs sampler</p></a></li>
<li><a href='#fit_model_with_vb'><p>Fit a Stan Model using Variational Inference</p></a></li>
<li><a href='#forecast_secondary'><p>Forecast Secondary Observations Given a Fit from estimate_secondary</p></a></li>
<li><a href='#format_fit'><p>Format Posterior Samples</p></a></li>
<li><a href='#gamma_dist_def'><p>Generate a Gamma Distribution Definition Based on Parameter Estimates</p></a></li>
<li><a href='#generation_time_opts'><p>Generation Time Distribution Options</p></a></li>
<li><a href='#generation_times'><p>Literature Estimates of Generation Times</p></a></li>
<li><a href='#get_dist'><p>Get a Literature Distribution</p></a></li>
<li><a href='#get_generation_time'><p>Get a Literature Distribution for the Generation Time</p></a></li>
<li><a href='#get_incubation_period'><p>Get a Literature Distribution for the Incubation Period</p></a></li>
<li><a href='#get_raw_result'><p>Get a Single Raw Result</p></a></li>
<li><a href='#get_regional_results'><p>Get Combined Regional Results</p></a></li>
<li><a href='#get_regions'><p>Get Folders with Results</p></a></li>
<li><a href='#get_regions_with_most_reports'><p>Get Regions with Most Reported Cases</p></a></li>
<li><a href='#get_seeding_time'><p>Estimate seeding time from delays and generation time</p></a></li>
<li><a href='#gp_opts'><p>Approximate Gaussian Process Settings</p></a></li>
<li><a href='#growth_to_R'><p>Convert Growth Rates to Reproduction numbers.</p></a></li>
<li><a href='#incubation_periods'><p>Literature Estimates of Incubation Periods</p></a></li>
<li><a href='#init_cumulative_fit'><p>Generate initial conditions by fitting to cumulative cases</p></a></li>
<li><a href='#lognorm_dist_def'><p>Generate a Log Normal Distribution Definition Based on Parameter Estimates</p></a></li>
<li><a href='#make_conf'><p>Format Credible Intervals</p></a></li>
<li><a href='#map_prob_change'><p>Categorise the Probability of Change for Rt</p></a></li>
<li><a href='#match_output_arguments'><p>Match User Supplied Arguments with Supported Options</p></a></li>
<li><a href='#mean.dist_spec'><p>Returns the mean of one or more delay distribution</p></a></li>
<li><a href='#obs_opts'><p>Observation Model Options</p></a></li>
<li><a href='#opts_list'><p>Return an _opts List per Region</p></a></li>
<li><a href='#plot_CrIs'><p>Plot EpiNow2 Credible Intervals</p></a></li>
<li><a href='#plot_estimates'><p>Plot Estimates</p></a></li>
<li><a href='#plot_summary'><p>Plot a Summary of the Latest Results</p></a></li>
<li><a href='#plot.dist_spec'><p>Plot PMF and CDF for a dist_spec object</p></a></li>
<li><a href='#plot.epinow'><p>Plot method for epinow</p></a></li>
<li><a href='#plot.estimate_infections'><p>Plot method for estimate_infections</p></a></li>
<li><a href='#plot.estimate_secondary'><p>Plot method for estimate_secondary</p></a></li>
<li><a href='#plot.estimate_truncation'><p>Plot method for estimate_truncation</p></a></li>
<li><a href='#print.dist_spec'><p>Prints the parameters of one or more delay distributions</p></a></li>
<li><a href='#process_region'><p>Process regional estimate</p></a></li>
<li><a href='#process_regions'><p>Process all Region Estimates</p></a></li>
<li><a href='#R_to_growth'><p>Convert Reproduction Numbers to Growth Rates</p></a></li>
<li><a href='#regional_epinow'><p>Real-time Rt Estimation, Forecasting and Reporting by Region</p></a></li>
<li><a href='#regional_runtimes'><p>Summarise Regional Runtimes</p></a></li>
<li><a href='#regional_summary'><p>Regional Summary Output</p></a></li>
<li><a href='#report_cases'><p>Report case counts by date of report</p></a></li>
<li><a href='#report_plots'><p>Report plots</p></a></li>
<li><a href='#report_summary'><p>Provide Summary Statistics for Estimated Infections and Rt</p></a></li>
<li><a href='#rstan_opts'><p>Rstan Options</p></a></li>
<li><a href='#rstan_sampling_opts'><p>Rstan Sampling Options</p></a></li>
<li><a href='#rstan_vb_opts'><p>Rstan Variational Bayes Options</p></a></li>
<li><a href='#rt_opts'><p>Time-Varying Reproduction Number Options</p></a></li>
<li><a href='#run_region'><p>Run epinow with Regional Processing Code</p></a></li>
<li><a href='#sample_approx_dist'><p>Approximate Sampling a Distribution using Counts</p></a></li>
<li><a href='#save_estimate_infections'><p>Save Estimated Infections</p></a></li>
<li><a href='#save_input'><p>Save Observed Data</p></a></li>
<li><a href='#secondary_opts'><p>Secondary Reports Options</p></a></li>
<li><a href='#set_dt_single_thread'><p>Set to Single Threading</p></a></li>
<li><a href='#setup_default_logging'><p>Setup Default Logging</p></a></li>
<li><a href='#setup_dt'><p>Convert to Data Table</p></a></li>
<li><a href='#setup_future'><p>Set up Future Backend</p></a></li>
<li><a href='#setup_logging'><p>Setup Logging</p></a></li>
<li><a href='#setup_target_folder'><p>Setup Target Folder for Saving</p></a></li>
<li><a href='#simulate_infections'><p>Simulate infections using a given trajectory of the time-varying</p>
reproduction number</a></li>
<li><a href='#simulate_secondary'><p>Simulate a secondary observation</p></a></li>
<li><a href='#stan_opts'><p>Stan Options</p></a></li>
<li><a href='#summarise_key_measures'><p>Summarise rt and cases</p></a></li>
<li><a href='#summarise_results'><p>Summarise Real-time Results</p></a></li>
<li><a href='#summary.epinow'><p>Summary output from epinow</p></a></li>
<li><a href='#summary.estimate_infections'><p>Summary output from estimate_infections</p></a></li>
<li><a href='#trunc_opts'><p>Truncation Distribution Options</p></a></li>
<li><a href='#tune_inv_gamma'><p>Tune an Inverse Gamma to Achieve the Target Truncation</p></a></li>
<li><a href='#update_horizon'><p>Updates Forecast Horizon Based on Input Data and Target</p></a></li>
<li><a href='#update_list'><p>Update a List</p></a></li>
<li><a href='#update_secondary_args'><p>Update estimate_secondary default priors</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Estimate Real-Time Case Counts and Time-Varying Epidemiological
Parameters</td>
</tr>
<tr>
<td>Version:</td>
<td>1.4.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimates the time-varying reproduction number,
    rate of spread, and doubling time using a range of open-source tools
    (Abbott et al. (2020) &lt;<a href="https://doi.org/10.12688%2Fwellcomeopenres.16006.1">doi:10.12688/wellcomeopenres.16006.1</a>&gt;), and
    current best practices (Gostic et al. (2020)
    &lt;<a href="https://doi.org/10.1101%2F2020.06.18.20134858">doi:10.1101/2020.06.18.20134858</a>&gt;).  It aims to help users avoid some
    of the limitations of naive implementations in a framework that is
    informed by community feedback and is actively supported.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://epiforecasts.io/EpiNow2/">https://epiforecasts.io/EpiNow2/</a>,
<a href="https://epiforecasts.io/EpiNow2/dev/">https://epiforecasts.io/EpiNow2/dev/</a>,
<a href="https://github.com/epiforecasts/EpiNow2">https://github.com/epiforecasts/EpiNow2</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/epiforecasts/EpiNow2/issues">https://github.com/epiforecasts/EpiNow2/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>data.table, futile.logger (&ge; 1.4), future, future.apply,
ggplot2, lifecycle, lubridate, methods, patchwork, progressr,
purrr, R.utils (&ge; 2.0.0), Rcpp (&ge; 0.12.0), rlang (&ge; 0.4.7),
rstan (&ge; 2.26.0), rstantools (&ge; 2.2.0), runner, scales,
stats, truncnorm, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, dplyr, here, kableExtra, knitr, magrittr, precommit,
rmarkdown, spelling, styler, testthat, tidyr, withr</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>BH (&ge; 1.66.0), Rcpp (&ge; 0.12.0), RcppEigen (&ge; 0.3.3.3.0),
RcppParallel (&ge; 5.0.1), rstan (&ge; 2.26.0), StanHeaders (&ge;
2.26.0)</td>
</tr>
<tr>
<td>Biarch:</td>
<td>true</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Language:</td>
<td>en-GB</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>GNU make C++17</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-09-18 08:33:03 UTC; sebfunk</td>
</tr>
<tr>
<td>Author:</td>
<td>Sam Abbott <a href="https://orcid.org/0000-0001-8057-8037"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre],
  Joel Hellewell <a href="https://orcid.org/0000-0003-2683-0849"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Katharine Sherratt [aut],
  Katelyn Gostic [aut],
  Joe Hickson [aut],
  Hamada S. Badr <a href="https://orcid.org/0000-0002-9808-2344"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Michael DeWitt <a href="https://orcid.org/0000-0001-8940-1967"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Robin Thompson [ctb],
  Sophie Meakin [ctb],
  James Munday [ctb],
  Nikos Bosse [ctb],
  Paul Mee [ctb],
  Peter Ellis [ctb],
  Pietro Monticone [ctb],
  Lloyd Chapman [ctb],
  James M. Azam <a href="https://orcid.org/0000-0001-5782-7330"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Andrew Johnson [ctb],
  EpiForecasts [aut],
  Sebastian Funk <a href="https://orcid.org/0000-0002-2842-3406"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Sam Abbott &lt;sam.abbott@lshtm.ac.uk&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-09-26 12:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='EpiNow2-package'>EpiNow2: Estimate Real-Time Case Counts and Time-Varying Epidemiological Parameters</h2><span id='topic+EpiNow2'></span><span id='topic+EpiNow2-package'></span>

<h3>Description</h3>

<p>Estimates the time-varying reproduction number, rate of spread, and doubling time using a range of open-source tools (Abbott et al. (2020) <a href="https://doi.org/10.12688/wellcomeopenres.16006.1">doi:10.12688/wellcomeopenres.16006.1</a>), and current best practices (Gostic et al. (2020) <a href="https://doi.org/10.1101/2020.06.18.20134858">doi:10.1101/2020.06.18.20134858</a>). It aims to help users avoid some of the limitations of naive implementations in a framework that is informed by community feedback and is actively supported.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Sam Abbott <a href="mailto:sam.abbott@lshtm.ac.uk">sam.abbott@lshtm.ac.uk</a> (<a href="https://orcid.org/0000-0001-8057-8037">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Joel Hellewell <a href="mailto:joel.hellewell@lshtm.ac.uk">joel.hellewell@lshtm.ac.uk</a> (<a href="https://orcid.org/0000-0003-2683-0849">ORCID</a>)
</p>
</li>
<li><p> Katharine Sherratt <a href="mailto:katharine.sherratt@lshtm.ac.uk">katharine.sherratt@lshtm.ac.uk</a>
</p>
</li>
<li><p> Katelyn Gostic <a href="mailto:kgostic@uchicago.edu">kgostic@uchicago.edu</a>
</p>
</li>
<li><p> Joe Hickson <a href="mailto:joseph.hickson@metoffice.gov.uk">joseph.hickson@metoffice.gov.uk</a>
</p>
</li>
<li><p> Hamada S. Badr <a href="mailto:badr@jhu.edu">badr@jhu.edu</a> (<a href="https://orcid.org/0000-0002-9808-2344">ORCID</a>)
</p>
</li>
<li><p> Michael DeWitt <a href="mailto:me.dewitt.jr@gmail.com">me.dewitt.jr@gmail.com</a> (<a href="https://orcid.org/0000-0001-8940-1967">ORCID</a>)
</p>
</li>
<li><p> EpiForecasts
</p>
</li>
<li><p> Sebastian Funk <a href="mailto:sebastian.funk@lshtm.ac.uk">sebastian.funk@lshtm.ac.uk</a> (<a href="https://orcid.org/0000-0002-2842-3406">ORCID</a>)
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Robin Thompson <a href="mailto:robin.thompson@lshtm.ac.uk">robin.thompson@lshtm.ac.uk</a> [contributor]
</p>
</li>
<li><p> Sophie Meakin <a href="mailto:sophie.meaking@lshtm.ac.uk">sophie.meaking@lshtm.ac.uk</a> [contributor]
</p>
</li>
<li><p> James Munday <a href="mailto:james.munday@lshtm.ac.uk">james.munday@lshtm.ac.uk</a> [contributor]
</p>
</li>
<li><p> Nikos Bosse [contributor]
</p>
</li>
<li><p> Paul Mee <a href="mailto:paul.mee@lshtm.ac.uk">paul.mee@lshtm.ac.uk</a> [contributor]
</p>
</li>
<li><p> Peter Ellis <a href="mailto:peter.ellis2013nz@gmail.com">peter.ellis2013nz@gmail.com</a> [contributor]
</p>
</li>
<li><p> Pietro Monticone <a href="mailto:pietro.monticone@edu.unito.it">pietro.monticone@edu.unito.it</a> [contributor]
</p>
</li>
<li><p> Lloyd Chapman <a href="mailto:lloyd.chapman1@lshtm.ac.uk">lloyd.chapman1@lshtm.ac.uk</a> [contributor]
</p>
</li>
<li><p> James M. Azam <a href="mailto:james.azam@lshtm.ac.uk">james.azam@lshtm.ac.uk</a> (<a href="https://orcid.org/0000-0001-5782-7330">ORCID</a>) [contributor]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://epiforecasts.io/EpiNow2/">https://epiforecasts.io/EpiNow2/</a>
</p>
</li>
<li> <p><a href="https://epiforecasts.io/EpiNow2/dev/">https://epiforecasts.io/EpiNow2/dev/</a>
</p>
</li>
<li> <p><a href="https://github.com/epiforecasts/EpiNow2">https://github.com/epiforecasts/EpiNow2</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/epiforecasts/EpiNow2/issues">https://github.com/epiforecasts/EpiNow2/issues</a>
</p>
</li></ul>


<hr>
<h2 id='+2B.dist_spec'>Creates a delay distribution as the sum of two other delay distributions</h2><span id='topic++2B.dist_spec'></span>

<h3>Description</h3>

<p>This is done via convolution with <code>stats::convolve()</code>. Nonparametric delays
that can be combined are processed together, and their cumulative
distribution function is truncated at a specified tolerance level, ensuring
numeric stability.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'dist_spec'
e1 + e2
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="+2B2B.dist_spec_+3A_e1">e1</code></td>
<td>
<p>The first delay distribution (from a call to <code><a href="#topic+dist_spec">dist_spec()</a></code>) to
combine.</p>
</td></tr>
<tr><td><code id="+2B2B.dist_spec_+3A_e2">e2</code></td>
<td>
<p>The second delay distribution (from a call to <code><a href="#topic+dist_spec">dist_spec()</a></code>) to
combine.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A delay distribution representing the sum of the two delays
(with class <code><a href="#topic+dist_spec">dist_spec()</a></code>)
</p>


<h3>Author(s)</h3>

<p>Sebastian Funk
</p>


<h3>Examples</h3>

<pre><code class='language-R'># A fixed lognormal distribution with mean 5 and sd 1.
lognormal &lt;- dist_spec(
  mean = 1.6, sd = 1, max = 20, distribution = "lognormal"
)
lognormal + lognormal

# An uncertain gamma distribution with mean 3 and sd 2
gamma &lt;- dist_spec(
  mean = 3, sd = 2, mean_sd = 0.5, sd_sd = 0.5, max = 20,
  distribution = "gamma"
)
lognormal + gamma

# Using tolerance parameter
EpiNow2:::dist_spec_plus(lognormal, lognormal, tolerance = 0.5)
</code></pre>

<hr>
<h2 id='add_day_of_week'>Adds a day of the week vector</h2><span id='topic+add_day_of_week'></span>

<h3>Description</h3>

<p>Adds a day of the week vector
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_day_of_week(dates, week_effect = 7)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="add_day_of_week_+3A_dates">dates</code></td>
<td>
<p>Vector of dates</p>
</td></tr>
<tr><td><code id="add_day_of_week_+3A_week_effect">week_effect</code></td>
<td>
<p>Numeric from 1 to 7 defaults to 7</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector containing the period day of the week index
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dates &lt;- seq(as.Date("2020-03-15"), by = "days", length.out = 15)
# Add date based day of week
add_day_of_week(dates, 7)

# Add shorter week
add_day_of_week(dates, 4)
</code></pre>

<hr>
<h2 id='adjust_infection_to_report'>Adjust from Case Counts by Infection Date to Date of Report</h2><span id='topic+adjust_infection_to_report'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Maps from cases by date of infection to date of report via date of
onset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>adjust_infection_to_report(
  infections,
  delay_defs,
  reporting_model,
  reporting_effect,
  type = "sample",
  truncate_future = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="adjust_infection_to_report_+3A_infections">infections</code></td>
<td>
<p><code>data.table</code> containing a <code>date</code> variable and a numeric
<code>cases</code> variable.</p>
</td></tr>
<tr><td><code id="adjust_infection_to_report_+3A_delay_defs">delay_defs</code></td>
<td>
<p>A list of single row data.tables that each  defines a
delay distribution (model, parameters and maximum delay for each model).
See <code>lognorm_dist_def</code> for an example of the structure.</p>
</td></tr>
<tr><td><code id="adjust_infection_to_report_+3A_reporting_model">reporting_model</code></td>
<td>
<p>A function that takes a single numeric vector as an
argument and returns a single numeric vector. Can be used to apply stochastic
reporting effects. See the examples for details.</p>
</td></tr>
<tr><td><code id="adjust_infection_to_report_+3A_reporting_effect">reporting_effect</code></td>
<td>
<p>A numeric vector of length 7 that allows the scaling
of reported cases by the day on which they report (1 = Monday, 7 = Sunday).
By default no scaling occurs.</p>
</td></tr>
<tr><td><code id="adjust_infection_to_report_+3A_type">type</code></td>
<td>
<p>Character string indicating the method to use to transform
counts. Supports either &quot;sample&quot;  which approximates sampling or &quot;median&quot;
would shift by the median of the distribution.</p>
</td></tr>
<tr><td><code id="adjust_infection_to_report_+3A_truncate_future">truncate_future</code></td>
<td>
<p>Logical, should cases be truncated if they occur
after the first date reported in the data. Defaults to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.table</code> containing a <code>date</code> variable (date of report) and a
<code>cases</code> variable. If <code>return_onset = TRUE</code> there will be a third variable
<code>reference</code> which indicates what the date variable refers to.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# define example cases
cases &lt;- data.table::copy(example_confirmed)[, cases := as.integer(confirm)]

# define a single report delay distribution
delay_def &lt;- lognorm_dist_def(
  mean = 5, mean_sd = 1, sd = 3, sd_sd = 1,
  max_value = 30, samples = 1, to_log = TRUE
)

# define a single incubation period
incubation_def &lt;- lognorm_dist_def(
  mean = incubation_periods[1, ]$mean,
  mean_sd = incubation_periods[1, ]$mean_sd,
  sd = incubation_periods[1, ]$sd,
  sd_sd = incubation_periods[1, ]$sd_sd,
  max_value = 30, samples = 1
)

# simple mapping
report &lt;- adjust_infection_to_report(
 cases, delay_defs = list(incubation_def, delay_def)
)
print(report)

# mapping with a weekly reporting effect
report_weekly &lt;- adjust_infection_to_report(
  cases,
  delay_defs = list(incubation_def, delay_def),
  reporting_effect = c(1.1, rep(1, 4), 0.95, 0.95)
)
print(report_weekly)

# map using a deterministic median shift for both delays
report_median &lt;- adjust_infection_to_report(cases,
  delay_defs = list(incubation_def, delay_def),
  type = "median"
)
print(report_median)

# map with a weekly reporting effect and stochastic reporting model
report_stochastic &lt;- adjust_infection_to_report(
  cases,
  delay_defs = list(incubation_def, delay_def),
  reporting_effect = c(1.1, rep(1, 4), 0.95, 0.95),
  reporting_model = function(n) {
    out &lt;- suppressWarnings(rnbinom(length(n), as.integer(n), 0.5))
    out &lt;- ifelse(is.na(out), 0, out)
  }
)
print(report_stochastic)

</code></pre>

<hr>
<h2 id='allocate_delays'>Allocate Delays into Required Stan Format</h2><span id='topic+allocate_delays'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Allocate delays for stan. Used in <code>delay_opts()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>allocate_delays(delay_var, no_delays)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="allocate_delays_+3A_delay_var">delay_var</code></td>
<td>
<p>List of numeric delays</p>
</td></tr>
<tr><td><code id="allocate_delays_+3A_no_delays">no_delays</code></td>
<td>
<p>Numeric, number of delays</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric array
</p>

<hr>
<h2 id='allocate_empty'>Allocate Empty Parameters to a List</h2><span id='topic+allocate_empty'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Allocate missing parameters to be empty two dimensional arrays. Used
internally by <code>simulate_infections.</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>allocate_empty(data, params, n = 0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="allocate_empty_+3A_data">data</code></td>
<td>
<p>A list of parameters</p>
</td></tr>
<tr><td><code id="allocate_empty_+3A_params">params</code></td>
<td>
<p>A character vector of parameters to allocate to
empty if missing.</p>
</td></tr>
<tr><td><code id="allocate_empty_+3A_n">n</code></td>
<td>
<p>Numeric, number of samples to assign an empty array</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of parameters some allocated to be empty
</p>

<hr>
<h2 id='backcalc_opts'>Back Calculation Options</h2><span id='topic+backcalc_opts'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Defines a list specifying the optional arguments for the back calculation
of cases. Only used if <code>rt = NULL</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>backcalc_opts(prior = "reports", prior_window = 14, rt_window = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="backcalc_opts_+3A_prior">prior</code></td>
<td>
<p>A character string defaulting to &quot;reports&quot;. Defines the prior
to use when deconvolving. Currently implemented options are to use smoothed
mean delay shifted reported cases (&quot;reports&quot;), to use the estimated
infections from the previous time step seeded for the first time step using
mean shifted reported cases (&quot;infections&quot;), or no prior (&quot;none&quot;). Using no
prior will result in poor real time performance. No prior and using
infections are only supported when a Gaussian process is present . If
observed data is not reliable then it a sensible first step is to explore
increasing the <code>prior_window</code> wit a sensible second step being to no longer
use reported cases as a prior (i.e set <code>prior = "none"</code>).</p>
</td></tr>
<tr><td><code id="backcalc_opts_+3A_prior_window">prior_window</code></td>
<td>
<p>Integer, defaults to 14 days. The mean centred smoothing
window to apply to mean shifted reports (used as a prior during back
calculation). 7 days is minimum recommended settings as this smooths day of
the week effects but depending on the quality of the data and the amount of
information users wish to use as a prior (higher values equalling a less
informative prior).</p>
</td></tr>
<tr><td><code id="backcalc_opts_+3A_rt_window">rt_window</code></td>
<td>
<p>Integer, defaults to 1. The size of the centred rolling
average to use when estimating Rt. This must be odd so that the central
estimate is included.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of back calculation settings.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'># default settings
backcalc_opts()
</code></pre>

<hr>
<h2 id='bootstrapped_dist_fit'>Fit a Subsampled Bootstrap to Integer Values and Summarise Distribution
Parameters</h2><span id='topic+bootstrapped_dist_fit'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Fits an integer adjusted distribution to a subsampled bootstrap of data and
then integrates the posterior samples into a single set of summary
statistics. Can be used to generate a robust reporting delay that accounts
for the fact the underlying delay likely varies over time or that the size
of the available reporting delay sample may not be representative of the
current case load.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bootstrapped_dist_fit(
  values,
  dist = "lognormal",
  samples = 2000,
  bootstraps = 10,
  bootstrap_samples = 250,
  max_value,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bootstrapped_dist_fit_+3A_values">values</code></td>
<td>
<p>Integer vector of values.</p>
</td></tr>
<tr><td><code id="bootstrapped_dist_fit_+3A_dist">dist</code></td>
<td>
<p>Character string, which distribution to fit. Defaults to
lognormal (<code>"lognormal"</code>) but gamma (<code>"gamma"</code>) is also supported.</p>
</td></tr>
<tr><td><code id="bootstrapped_dist_fit_+3A_samples">samples</code></td>
<td>
<p>Numeric, number of samples to take overall from the
bootstrapped posteriors.</p>
</td></tr>
<tr><td><code id="bootstrapped_dist_fit_+3A_bootstraps">bootstraps</code></td>
<td>
<p>Numeric, defaults to 1. The number of bootstrap samples
(with replacement) of the delay distribution to take.</p>
</td></tr>
<tr><td><code id="bootstrapped_dist_fit_+3A_bootstrap_samples">bootstrap_samples</code></td>
<td>
<p>Numeric, defaults to 100. The number of samples to
take in each bootstrap. When the sample size of the supplied delay
distribution is less than 100 this is used instead.</p>
</td></tr>
<tr><td><code id="bootstrapped_dist_fit_+3A_max_value">max_value</code></td>
<td>
<p>Numeric, defaults to  the maximum value in the observed
data. Maximum delay to  allow (added to output but does impact fitting).</p>
</td></tr>
<tr><td><code id="bootstrapped_dist_fit_+3A_verbose">verbose</code></td>
<td>
<p>Logical, defaults to <code>FALSE</code>. Should progress messages be
printed.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>dist_spec</code> object summarising the bootstrapped distribution
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# lognormal
delays &lt;- rlnorm(500, log(5), 1)
out &lt;- bootstrapped_dist_fit(delays,
  samples = 1000, bootstraps = 10,
  dist = "lognormal"
)
out

</code></pre>

<hr>
<h2 id='c.dist_spec'>Combines multiple delay distributions for further processing</h2><span id='topic+c.dist_spec'></span>

<h3>Description</h3>

<p>This combines the parameters so that they can be fed as multiple delay
distributions to <code><a href="#topic+epinow">epinow()</a></code> or <code><a href="#topic+estimate_infections">estimate_infections()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'dist_spec'
c(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="c.dist_spec_+3A_...">...</code></td>
<td>
<p>The delay distributions (from calls to <code><a href="#topic+dist_spec">dist_spec()</a></code>) to combine</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Combined delay distributions (with class <code><a href="#topic+dist_spec">dist_spec()</a></code>')
</p>


<h3>Author(s)</h3>

<p>Sebastian Funk
</p>

<hr>
<h2 id='calc_CrI'>Calculate Credible Interval</h2><span id='topic+calc_CrI'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Adds symmetric a credible interval based on quantiles.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calc_CrI(samples, summarise_by = NULL, CrI = 0.9)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calc_CrI_+3A_samples">samples</code></td>
<td>
<p>A data.table containing at least a value variable</p>
</td></tr>
<tr><td><code id="calc_CrI_+3A_summarise_by">summarise_by</code></td>
<td>
<p>A character vector of variables to group by.</p>
</td></tr>
<tr><td><code id="calc_CrI_+3A_cri">CrI</code></td>
<td>
<p>Numeric between 0 and 1. The credible interval for which to
return values. Defaults to 0.9.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.table containing the upper and lower bounds for the specified
credible interval.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>samples &lt;- data.frame(value = 1:10, type = "car")
# add 90% credible interval
calc_CrI(samples)
# add 90% credible interval grouped by type
calc_CrI(samples, summarise_by = "type")
</code></pre>

<hr>
<h2 id='calc_CrIs'>Calculate Credible Intervals</h2><span id='topic+calc_CrIs'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Adds symmetric credible intervals based on quantiles.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calc_CrIs(samples, summarise_by = NULL, CrIs = c(0.2, 0.5, 0.9))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calc_CrIs_+3A_samples">samples</code></td>
<td>
<p>A data.table containing at least a value variable</p>
</td></tr>
<tr><td><code id="calc_CrIs_+3A_summarise_by">summarise_by</code></td>
<td>
<p>A character vector of variables to group by.</p>
</td></tr>
<tr><td><code id="calc_CrIs_+3A_cris">CrIs</code></td>
<td>
<p>Numeric vector of credible intervals to calculate.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.table containing the <code>summarise_by</code> variables and the
specified lower and upper credible intervals.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>samples &lt;- data.frame(value = 1:10, type = "car")
# add credible intervals
calc_CrIs(samples)
# add 90% credible interval grouped by type
calc_CrIs(samples, summarise_by = "type")
</code></pre>

<hr>
<h2 id='calc_summary_measures'>Calculate All Summary Measures</h2><span id='topic+calc_summary_measures'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Calculate summary statistics and credible intervals from a data frame by
group.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calc_summary_measures(
  samples,
  summarise_by = NULL,
  order_by = NULL,
  CrIs = c(0.2, 0.5, 0.9)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calc_summary_measures_+3A_samples">samples</code></td>
<td>
<p>A data.table containing at least a value variable</p>
</td></tr>
<tr><td><code id="calc_summary_measures_+3A_summarise_by">summarise_by</code></td>
<td>
<p>A character vector of variables to group by.</p>
</td></tr>
<tr><td><code id="calc_summary_measures_+3A_order_by">order_by</code></td>
<td>
<p>A character vector of parameters to order by, defaults to
all <code>summarise_by</code> variables.</p>
</td></tr>
<tr><td><code id="calc_summary_measures_+3A_cris">CrIs</code></td>
<td>
<p>Numeric vector of credible intervals to calculate.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.table containing summary statistics by group.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>samples &lt;- data.frame(value = 1:10, type = "car")
# default
calc_summary_measures(samples)
#  by type
calc_summary_measures(samples, summarise_by = "type")
</code></pre>

<hr>
<h2 id='calc_summary_stats'>Calculate Summary Statistics</h2><span id='topic+calc_summary_stats'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Calculate summary statistics from a data frame by group. Currently supports
the mean, median and standard deviation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calc_summary_stats(samples, summarise_by = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calc_summary_stats_+3A_samples">samples</code></td>
<td>
<p>A data.table containing at least a value variable</p>
</td></tr>
<tr><td><code id="calc_summary_stats_+3A_summarise_by">summarise_by</code></td>
<td>
<p>A character vector of variables to group by.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.table containing the upper and lower bounds for the specified
credible interval
</p>


<h3>Examples</h3>

<pre><code class='language-R'>samples &lt;- data.frame(value = 1:10, type = "car")
# default
calc_summary_stats(samples)
#  by type
calc_summary_stats(samples, summarise_by = "type")
</code></pre>

<hr>
<h2 id='clean_nowcasts'>Clean Nowcasts for a Supplied Date</h2><span id='topic+clean_nowcasts'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
This function removes nowcasts in the format produced by <code>EpiNow2</code> from a
target directory for the date supplied.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>clean_nowcasts(date = NULL, nowcast_dir = ".")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="clean_nowcasts_+3A_date">date</code></td>
<td>
<p>Date object. Defaults to today's date</p>
</td></tr>
<tr><td><code id="clean_nowcasts_+3A_nowcast_dir">nowcast_dir</code></td>
<td>
<p>Character string giving the filepath to the nowcast
results directory. Defaults to the current directory.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects
</p>

<hr>
<h2 id='clean_regions'>Clean Regions</h2><span id='topic+clean_regions'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Removes regions with insufficient time points, and provides logging
information on the input.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>clean_regions(reported_cases, non_zero_points)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="clean_regions_+3A_reported_cases">reported_cases</code></td>
<td>
<p>A data frame of confirmed cases (confirm) by date
(date), and region (<code>region</code>).</p>
</td></tr>
<tr><td><code id="clean_regions_+3A_non_zero_points">non_zero_points</code></td>
<td>
<p>Numeric, the minimum number of time points with
non-zero cases in a region required for that region to be evaluated.
Defaults to 7.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A dataframe of cleaned regional data
</p>


<h3>See Also</h3>

<p>regional_epinow
</p>

<hr>
<h2 id='construct_output'>Construct Output</h2><span id='topic+construct_output'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Combines the output produced internally by <code>epinow</code> into a single list.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>construct_output(
  estimates,
  estimated_reported_cases,
  plots = NULL,
  summary = NULL,
  samples = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="construct_output_+3A_estimates">estimates</code></td>
<td>
<p>List of data frames as output by <code>estimate_infections</code></p>
</td></tr>
<tr><td><code id="construct_output_+3A_estimated_reported_cases">estimated_reported_cases</code></td>
<td>
<p>A list of dataframes as produced by
<code>estimates_by_report_date</code>.</p>
</td></tr>
<tr><td><code id="construct_output_+3A_plots">plots</code></td>
<td>
<p>A list of plots as produced by <code>report_plots</code>.</p>
</td></tr>
<tr><td><code id="construct_output_+3A_summary">summary</code></td>
<td>
<p>A list of summary output as produced by <code>report_summary</code>.</p>
</td></tr>
<tr><td><code id="construct_output_+3A_samples">samples</code></td>
<td>
<p>Logical, defaults to TRUE. Should samples be saved</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of output as returned by <code>epinow</code>
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='convert_to_logmean'>Convert mean and sd to log mean for a log normal distribution</h2><span id='topic+convert_to_logmean'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Convert from mean and standard deviation to the log mean of the
lognormal distribution. Useful for defining distributions supported by
<code>estimate_infections</code>, <code>epinow</code>, and <code>regional_epinow</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>convert_to_logmean(mean, sd)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="convert_to_logmean_+3A_mean">mean</code></td>
<td>
<p>Numeric, mean of a distribution</p>
</td></tr>
<tr><td><code id="convert_to_logmean_+3A_sd">sd</code></td>
<td>
<p>Numeric, standard deviation of a distribution</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The log mean of a lognormal distribution
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
convert_to_logmean(2, 1)
</code></pre>

<hr>
<h2 id='convert_to_logsd'>Convert mean and sd to log standard deviation for a log normal distribution</h2><span id='topic+convert_to_logsd'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Convert from mean and standard deviation to the log standard deviation of the
lognormal distribution. Useful for defining distributions supported by
<code>estimate_infections</code>, <code>epinow</code>, and <code>regional_epinow</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>convert_to_logsd(mean, sd)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="convert_to_logsd_+3A_mean">mean</code></td>
<td>
<p>Numeric, mean of a distribution</p>
</td></tr>
<tr><td><code id="convert_to_logsd_+3A_sd">sd</code></td>
<td>
<p>Numeric, standard deviation of a distribution</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The log standard deviation of a lognormal distribution
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
convert_to_logsd(2, 1)
</code></pre>

<hr>
<h2 id='copy_results_to_latest'>Copy Results From Dated Folder to Latest</h2><span id='topic+copy_results_to_latest'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#questioning"><img src="../help/figures/lifecycle-questioning.svg" alt='[Questioning]' /></a>
Copies output from the dated folder to a latest folder. May be undergo
changes in later releases.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>copy_results_to_latest(target_folder = NULL, latest_folder = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="copy_results_to_latest_+3A_target_folder">target_folder</code></td>
<td>
<p>Character string specifying where to save results (will
create if not present).</p>
</td></tr>
<tr><td><code id="copy_results_to_latest_+3A_latest_folder">latest_folder</code></td>
<td>
<p>Character string containing the path to the latest
target folder. As produced by <code>setup_target_folder</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='create_backcalc_data'>Create Back Calculation Data</h2><span id='topic+create_backcalc_data'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Takes the output of <code>backcalc_opts()</code> and converts it into a list understood
by <code>stan</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_backcalc_data(backcalc = backcalc_opts())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_backcalc_data_+3A_backcalc">backcalc</code></td>
<td>
<p>A list of options as generated by <code>backcalc_opts()</code> to
define the back calculation. Defaults to <code>backcalc_opts()</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of settings defining the Gaussian process
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>See Also</h3>

<p>backcalc_opts
</p>


<h3>Examples</h3>

<pre><code class='language-R'>create_backcalc_data(backcalc = backcalc_opts())
</code></pre>

<hr>
<h2 id='create_clean_reported_cases'>Create Clean Reported Cases</h2><span id='topic+create_clean_reported_cases'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Cleans a data frame of reported cases by replacing missing dates with 0
cases and applies an optional threshold at which point 0 cases are replaced
with a moving average of observed cases. See <code>zero_threshold</code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_clean_reported_cases(
  reported_cases,
  horizon,
  filter_leading_zeros = TRUE,
  zero_threshold = Inf
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_clean_reported_cases_+3A_reported_cases">reported_cases</code></td>
<td>
<p>A data frame of confirmed cases (confirm) by date
(date). confirm must be integer and date must be in date format.</p>
</td></tr>
<tr><td><code id="create_clean_reported_cases_+3A_horizon">horizon</code></td>
<td>
<p>Numeric, defaults to 7. Number of days into the future to
forecast.</p>
</td></tr>
<tr><td><code id="create_clean_reported_cases_+3A_filter_leading_zeros">filter_leading_zeros</code></td>
<td>
<p>Logical, defaults to TRUE. Should zeros at the
start of the time series be filtered out.</p>
</td></tr>
<tr><td><code id="create_clean_reported_cases_+3A_zero_threshold">zero_threshold</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a> Numeric defaults
to Inf. Indicates if detected zero cases are meaningful by using a threshold
number of cases based on the 7 day average. If the average is above this
threshold then the zero is replaced with the backwards looking rolling
average. If set to infinity then no changes are made.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A cleaned data frame of reported cases
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>
<p>Lloyd Chapman
</p>

<hr>
<h2 id='create_future_rt'>Construct the Required Future Rt assumption</h2><span id='topic+create_future_rt'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Converts the <code>future</code> argument from <code>rt_opts()</code> into arguments that can be
passed to <code>stan</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_future_rt(future = "latest", delay = 0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_future_rt_+3A_future">future</code></td>
<td>
<p>A character string or integer. This argument indicates how to
set future Rt values. Supported options are to project using the Rt model
(&quot;project&quot;), to use the latest estimate based on partial data (&quot;latest&quot;),
to use the latest estimate based on data that is over 50% complete
(&quot;estimate&quot;). If an integer is supplied then the Rt estimate from this many
days into the future (or past if negative) past will be used forwards in
time.</p>
</td></tr>
<tr><td><code id="create_future_rt_+3A_delay">delay</code></td>
<td>
<p>Numeric mean delay</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing a logical called fixed and an integer called from
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='create_gp_data'>Create Gaussian Process Data</h2><span id='topic+create_gp_data'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Takes the output of <code>gp_opts()</code> and converts it into a list understood by
<code>stan</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_gp_data(gp = gp_opts(), data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_gp_data_+3A_gp">gp</code></td>
<td>
<p>A list of options as generated by <code>gp_opts()</code> to define the
Gaussian process. Defaults to <code>gp_opts()</code>.Set to NULL to disable the
Gaussian process.</p>
</td></tr>
<tr><td><code id="create_gp_data_+3A_data">data</code></td>
<td>
<p>A list containing the following numeric values:
<code>t</code>, <code>seeding_time</code>, <code>horizon</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of settings defining the Gaussian process
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>See Also</h3>

<p>gp_opts
</p>


<h3>Examples</h3>

<pre><code class='language-R'># define input data required
data &lt;- list(
  t = 30,
  seeding_time = 7,
  horizon = 7
)

# default gaussian process data
create_gp_data(data = data)

# settings when no gaussian process is desired
create_gp_data(NULL, data)

# custom lengthscale
create_gp_data(gp_opts(ls_mean = 14), data)
</code></pre>

<hr>
<h2 id='create_initial_conditions'>Create Initial Conditions Generating Function</h2><span id='topic+create_initial_conditions'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Uses the output of <code>create_stan_data</code> to create a function which can be used
to sample from the prior distributions (or as close as possible) for
parameters. Used in order to initialise each <code>stan</code> chain within a range of
plausible values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_initial_conditions(data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_initial_conditions_+3A_data">data</code></td>
<td>
<p>A list of data as produced by <code>create_stan_data.</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>An initial condition generating function
</p>

<hr>
<h2 id='create_obs_model'>Create Observation Model Settings</h2><span id='topic+create_obs_model'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Takes the output of <code>obs_opts()</code> and converts it into a list understood
by <code>stan</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_obs_model(obs = obs_opts(), dates)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_obs_model_+3A_obs">obs</code></td>
<td>
<p>A list of options as generated by <code>obs_opts()</code> defining the
observation model. Defaults to <code>obs_opts()</code>.</p>
</td></tr>
<tr><td><code id="create_obs_model_+3A_dates">dates</code></td>
<td>
<p>A vector of dates used to calculate the day of the week.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of settings ready to be passed to stan defining
the Observation Model
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>See Also</h3>

<p>obs_opts
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dates &lt;- seq(as.Date("2020-03-15"), by = "days", length.out = 15)
# default observation model data
create_obs_model(dates = dates)

# Poisson observation model
create_obs_model(obs_opts(family = "poisson"), dates = dates)

# Applying a observation scaling to the data
create_obs_model(
 obs_opts(scale = list(mean = 0.4, sd = 0.01)), dates = dates
)

# Apply a custom week week length
create_obs_model(obs_opts(week_length = 3), dates = dates)
</code></pre>

<hr>
<h2 id='create_rt_data'>Create Time-varying Reproduction Number Data</h2><span id='topic+create_rt_data'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Takes the output from <code>rt_opts()</code> and converts it into a list understood by
<code>stan</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_rt_data(rt = rt_opts(), breakpoints = NULL, delay = 0, horizon = 0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_rt_data_+3A_rt">rt</code></td>
<td>
<p>A list of options as generated by <code>rt_opts()</code> defining Rt
estimation. Defaults to <code>rt_opts()</code>. Set to <code>NULL</code> to switch to using back
calculation rather than generating infections using Rt.</p>
</td></tr>
<tr><td><code id="create_rt_data_+3A_breakpoints">breakpoints</code></td>
<td>
<p>An integer vector (binary) indicating the location of
breakpoints.</p>
</td></tr>
<tr><td><code id="create_rt_data_+3A_delay">delay</code></td>
<td>
<p>Numeric mean delay</p>
</td></tr>
<tr><td><code id="create_rt_data_+3A_horizon">horizon</code></td>
<td>
<p>Numeric, forecast horizon.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of settings defining the time-varying reproduction number
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>See Also</h3>

<p>rt_settings
</p>


<h3>Examples</h3>

<pre><code class='language-R'># default Rt data
create_rt_data()

# settings when no Rt is desired
create_rt_data(rt = NULL)

# using breakpoints
create_rt_data(rt_opts(use_breakpoints = TRUE), breakpoints = rep(1, 10))
</code></pre>

<hr>
<h2 id='create_shifted_cases'>Create Delay Shifted Cases</h2><span id='topic+create_shifted_cases'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>
<p>This functions creates a data frame of reported cases that has been smoothed
using a centred partial rolling average (with a period set by
<code>smoothing_window</code>) and shifted back in time by some delay. It is used by
<code>estimate_infections</code> to generate the mean shifted prior on which the back
calculation method (see <code>backcalc_opts()</code>) is based.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_shifted_cases(reported_cases, shift, smoothing_window, horizon)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_shifted_cases_+3A_reported_cases">reported_cases</code></td>
<td>
<p>A data frame of confirmed cases (confirm) by date
(date). confirm must be integer and date must be in date format.</p>
</td></tr>
<tr><td><code id="create_shifted_cases_+3A_shift">shift</code></td>
<td>
<p>Numeric, mean delay shift to apply.</p>
</td></tr>
<tr><td><code id="create_shifted_cases_+3A_smoothing_window">smoothing_window</code></td>
<td>
<p>Numeric, the rolling average smoothing window
to apply. Must be odd in order to be defined as a centred average.</p>
</td></tr>
<tr><td><code id="create_shifted_cases_+3A_horizon">horizon</code></td>
<td>
<p>Numeric, defaults to 7. Number of days into the future to
forecast.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame for shifted reported cases
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'>create_shifted_cases(example_confirmed, 7, 14, 7)
</code></pre>

<hr>
<h2 id='create_stan_args'>Create a List of Stan Arguments</h2><span id='topic+create_stan_args'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Generates a list of arguments as required by <code>rstan::sampling</code> or
<code>rstan::vb</code> by combining the required options, with data, and type of
initialisation. Initialisation defaults to random but it is expected that
<code>create_initial_conditions</code> will be used.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_stan_args(
  stan = stan_opts(),
  data = NULL,
  init = "random",
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_stan_args_+3A_stan">stan</code></td>
<td>
<p>A list of stan options as generated by <code>stan_opts()</code>. Defaults
to <code>stan_opts()</code>. Can be used to override <code>data</code>, <code>init</code>, and <code>verbose</code>
settings if desired.</p>
</td></tr>
<tr><td><code id="create_stan_args_+3A_data">data</code></td>
<td>
<p>A list of stan data as created by <code>create_stan_data</code></p>
</td></tr>
<tr><td><code id="create_stan_args_+3A_init">init</code></td>
<td>
<p>Initial conditions passed to <code>rstan</code>. Defaults to &quot;random&quot; but
can also be a function (as supplied by <code>create_intitial_conditions</code>).</p>
</td></tr>
<tr><td><code id="create_stan_args_+3A_verbose">verbose</code></td>
<td>
<p>Logical, defaults to <code>FALSE</code>. Should verbose progress
messages be returned.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of stan arguments
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'># default settings
create_stan_args()

# increasing warmup
create_stan_args(stan = stan_opts(warmup = 1000))
</code></pre>

<hr>
<h2 id='create_stan_data'>Create Stan Data Required for estimate_infections</h2><span id='topic+create_stan_data'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Takes the output of <code>stan_opts()</code> and converts it into a list understood by
<code>stan</code>. Internally calls the other <code>create_</code> family of functions to
construct a single list for input into stan with all data required present.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_stan_data(
  reported_cases,
  seeding_time,
  rt,
  gp,
  obs,
  horizon,
  backcalc,
  shifted_cases
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_stan_data_+3A_reported_cases">reported_cases</code></td>
<td>
<p>A data frame of confirmed cases (confirm) by date
(date). confirm must be integer and date must be in date format.</p>
</td></tr>
<tr><td><code id="create_stan_data_+3A_seeding_time">seeding_time</code></td>
<td>
<p>Integer; seeding time, usually obtained using
<code>get_seeding_time()</code></p>
</td></tr>
<tr><td><code id="create_stan_data_+3A_rt">rt</code></td>
<td>
<p>A list of options as generated by <code>rt_opts()</code> defining Rt
estimation. Defaults to <code>rt_opts()</code>. Set to <code>NULL</code> to switch to using back
calculation rather than generating infections using Rt.</p>
</td></tr>
<tr><td><code id="create_stan_data_+3A_gp">gp</code></td>
<td>
<p>A list of options as generated by <code>gp_opts()</code> to define the
Gaussian process. Defaults to <code>gp_opts()</code>.Set to NULL to disable the
Gaussian process.</p>
</td></tr>
<tr><td><code id="create_stan_data_+3A_obs">obs</code></td>
<td>
<p>A list of options as generated by <code>obs_opts()</code> defining the
observation model. Defaults to <code>obs_opts()</code>.</p>
</td></tr>
<tr><td><code id="create_stan_data_+3A_horizon">horizon</code></td>
<td>
<p>Numeric, forecast horizon.</p>
</td></tr>
<tr><td><code id="create_stan_data_+3A_backcalc">backcalc</code></td>
<td>
<p>A list of options as generated by <code>backcalc_opts()</code> to
define the back calculation. Defaults to <code>backcalc_opts()</code>.</p>
</td></tr>
<tr><td><code id="create_stan_data_+3A_shifted_cases">shifted_cases</code></td>
<td>
<p>A dataframe of delay shifted cases</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of stan data
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>
<p>Sebastian Funk
</p>

<hr>
<h2 id='create_stan_delays'>Create delay variables for stan</h2><span id='topic+create_stan_delays'></span>

<h3>Description</h3>

<p>Create delay variables for stan
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_stan_delays(..., weight = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_stan_delays_+3A_...">...</code></td>
<td>
<p>Named delay distributions specified using <code>dist_spec()</code>.
The names are assigned to IDs</p>
</td></tr>
<tr><td><code id="create_stan_delays_+3A_weight">weight</code></td>
<td>
<p>Numeric, weight associated with delay priors; default: 1</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of variables as expected by the stan model
</p>


<h3>Author(s)</h3>

<p>Sebastian Funk
</p>

<hr>
<h2 id='delay_opts'>Delay Distribution Options</h2><span id='topic+delay_opts'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Returns delay distributions formatted for usage by downstream
functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>delay_opts(dist = dist_spec(), ..., fixed = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="delay_opts_+3A_dist">dist</code></td>
<td>
<p>A delay distribution or series of delay distributions generated
using <code><a href="#topic+dist_spec">dist_spec()</a></code>. Default is an empty call to <code><a href="#topic+dist_spec">dist_spec()</a></code>, i.e. no delay</p>
</td></tr>
<tr><td><code id="delay_opts_+3A_...">...</code></td>
<td>
<p>deprecated; use <code>dist</code> instead</p>
</td></tr>
<tr><td><code id="delay_opts_+3A_fixed">fixed</code></td>
<td>
<p>deprecated; use <code>dist</code> instead</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list summarising the input delay distributions.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>
<p>Sebastian Funk
</p>


<h3>See Also</h3>

<p>convert_to_logmean convert_to_logsd bootstrapped_dist_fit dist_spec
</p>


<h3>Examples</h3>

<pre><code class='language-R'># no delays
delay_opts()

# A single delay that has uncertainty
delay &lt;- dist_spec(mean = 1, mean_sd = 0.2, sd = 0.5, sd_sd = 0.1, max = 15)
delay_opts(delay)

# A single delay without uncertainty
delay &lt;- dist_spec(mean = 1, sd = 0.5, max = 15)
delay_opts(delay)

# Multiple delays (in this case twice the same)
delay_opts(delay + delay)
</code></pre>

<hr>
<h2 id='dist_fit'>Fit an Integer Adjusted Exponential, Gamma or Lognormal distributions</h2><span id='topic+dist_fit'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Fits an integer adjusted exponential, gamma or lognormal distribution using
<code>stan</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dist_fit(
  values = NULL,
  samples = 1000,
  cores = 1,
  chains = 2,
  dist = "exp",
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dist_fit_+3A_values">values</code></td>
<td>
<p>Numeric vector of values</p>
</td></tr>
<tr><td><code id="dist_fit_+3A_samples">samples</code></td>
<td>
<p>Numeric, number of samples to take. Must be &gt;= 1000.
Defaults to 1000.</p>
</td></tr>
<tr><td><code id="dist_fit_+3A_cores">cores</code></td>
<td>
<p>Numeric, defaults to 1. Number of CPU cores to use (no effect
if greater than the number of chains).</p>
</td></tr>
<tr><td><code id="dist_fit_+3A_chains">chains</code></td>
<td>
<p>Numeric, defaults to 2. Number of MCMC chains to use. More is
better with the minimum being two.</p>
</td></tr>
<tr><td><code id="dist_fit_+3A_dist">dist</code></td>
<td>
<p>Character string, which distribution to fit. Defaults to
exponential (<code>"exp"</code>) but gamma (<code>"gamma"</code>) and lognormal (<code>"lognormal"</code>) are
also supported.</p>
</td></tr>
<tr><td><code id="dist_fit_+3A_verbose">verbose</code></td>
<td>
<p>Logical, defaults to FALSE. Should verbose progress messages
be printed.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>stan</code> fit of an interval censored distribution
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# integer adjusted exponential model
dist_fit(rexp(1:100, 2),
  samples = 1000, dist = "exp",
  cores = ifelse(interactive(), 4, 1), verbose = TRUE
)


# integer adjusted gamma model
dist_fit(rgamma(1:100, 5, 5),
  samples = 1000, dist = "gamma",
  cores = ifelse(interactive(), 4, 1), verbose = TRUE
)

# integer adjusted lognormal model
dist_fit(rlnorm(1:100, log(5), 0.2),
  samples = 1000, dist = "lognormal",
  cores = ifelse(interactive(), 4, 1), verbose = TRUE
)

</code></pre>

<hr>
<h2 id='dist_skel'>Distribution Skeleton</h2><span id='topic+dist_skel'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#questioning"><img src="../help/figures/lifecycle-questioning.svg" alt='[Questioning]' /></a>
This function acts as a skeleton for a truncated distribution defined by
model type, maximum value and model parameters. It is designed to be used
with the output from <code>get_dist</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dist_skel(
  n,
  dist = FALSE,
  cum = TRUE,
  model,
  discrete = FALSE,
  params,
  max_value = 120
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dist_skel_+3A_n">n</code></td>
<td>
<p>Numeric vector, number of samples to take (or days for the
probability density).</p>
</td></tr>
<tr><td><code id="dist_skel_+3A_dist">dist</code></td>
<td>
<p>Logical, defaults to <code>FALSE</code>. Should the probability density be
returned rather than a number of samples.</p>
</td></tr>
<tr><td><code id="dist_skel_+3A_cum">cum</code></td>
<td>
<p>Logical, defaults to <code>TRUE</code>. If <code>dist = TRUE</code> should the returned
distribution be cumulative.</p>
</td></tr>
<tr><td><code id="dist_skel_+3A_model">model</code></td>
<td>
<p>Character string, defining the model to be used. Supported
options are exponential (&quot;exp&quot;), gamma (&quot;gamma&quot;), and log normal
(&quot;lognormal&quot;)</p>
</td></tr>
<tr><td><code id="dist_skel_+3A_discrete">discrete</code></td>
<td>
<p>Logical,  defaults to <code>FALSE</code>. Should the probability
distribution be discretised. In this case each entry of the probability
mass function corresponds to the 1-length interval ending at the entry,
i.e. the probability mass function is a vector where the first entry
corresponds to the integral over the (0,1] interval of the continuous
distribution, the second entry corresponds to the (1,2] interval etc.</p>
</td></tr>
<tr><td><code id="dist_skel_+3A_params">params</code></td>
<td>
<p>A list of parameters values (by name) required for each model.
For the exponential model this is a rate parameter and for the gamma model
this is alpha and beta.</p>
</td></tr>
<tr><td><code id="dist_skel_+3A_max_value">max_value</code></td>
<td>
<p>Numeric, the maximum value to allow. Defaults to 120.
Samples outside of this range are resampled.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of samples or a probability distribution.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>
<p>Sebastian Funk
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Exponential model
# sample
dist_skel(10, model = "exp", params = list(rate = 1))

# cumulative prob density
dist_skel(1:10, model = "exp", dist = TRUE, params = list(rate = 1))

# probability density
dist_skel(1:10,
  model = "exp", dist = TRUE,
  cum = FALSE, params = list(rate = 1)
)

## Gamma model
# sample
dist_skel(10, model = "gamma", params = list(shape = 1, scale = 2))

# cumulative prob density
dist_skel(0:10,
  model = "gamma", dist = TRUE,
  params = list(shape = 1, scale = 2)
)

# probability density
dist_skel(0:10,
  model = "gamma", dist = TRUE,
  cum = FALSE, params = list(shape = 2, scale = 2)
)

## Log normal model
# sample
dist_skel(10, model = "lognormal", params = list(mean = log(5), sd = log(2)))

# cumulative prob density
dist_skel(0:10,
  model = "lognormal", dist = TRUE,
  params = list(mean = log(5), sd = log(2))
)

# probability density
dist_skel(0:10,
  model = "lognormal", dist = TRUE, cum = FALSE,
  params = list(mean = log(5), sd = log(2))
)
</code></pre>

<hr>
<h2 id='dist_spec'>Specify a distribution.</h2><span id='topic+dist_spec'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Defines the parameters of a supported distribution for use in onward
modelling. Multiple distribution families are supported - see the
documentation for <code>family</code> for details. Alternatively, a nonparametric
distribution can be specified using the <code>pmf</code> argument.
This function provides distribution
functionality in <code><a href="#topic+delay_opts">delay_opts()</a></code>, <code><a href="#topic+generation_time_opts">generation_time_opts()</a></code>, and
<code><a href="#topic+trunc_opts">trunc_opts()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dist_spec(
  mean,
  sd = 0,
  mean_sd = 0,
  sd_sd = 0,
  distribution = c("lognormal", "gamma"),
  max,
  pmf = numeric(0),
  fixed = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dist_spec_+3A_mean">mean</code></td>
<td>
<p>Numeric. If the only non-zero summary parameter
then this is the fixed interval of the distribution. If the <code>sd</code> is
non-zero then this is the mean of the distribution given by <code>dist</code>.
If this is not given a vector of empty vectors is returned.</p>
</td></tr>
<tr><td><code id="dist_spec_+3A_sd">sd</code></td>
<td>
<p>Numeric, defaults to 0. Sets the standard deviation of the
distribution.</p>
</td></tr>
<tr><td><code id="dist_spec_+3A_mean_sd">mean_sd</code></td>
<td>
<p>Numeric, defaults to 0. Sets the standard deviation of the
uncertainty around the mean of the  distribution assuming a normal
prior.</p>
</td></tr>
<tr><td><code id="dist_spec_+3A_sd_sd">sd_sd</code></td>
<td>
<p>Numeric, defaults to 0. Sets the standard deviation of the
uncertainty around the sd of the  distribution assuming a normal prior.</p>
</td></tr>
<tr><td><code id="dist_spec_+3A_distribution">distribution</code></td>
<td>
<p>Character, defaults to &quot;lognormal&quot;. The (discretised
distribution to be used. If sd == 0 then the distribution  is fixed and a
delta function is used. If sd &gt; 0 then the distribution is discretised and
truncated.
</p>
<p>The following distributions are currently supported:
</p>

<ul>
<li><p> &quot;lognormal&quot; - a lognormal distribution. For this distribution <code>mean</code>
is the mean of the natural logarithm of the delay (on the log scale) and
<code>sd</code> is the standard deviation of the natural logarithm of the delay.
</p>
</li>
<li><p> &quot;gamma&quot; - a gamma distribution. For this distribution <code>mean</code> is the
mean of the delay and <code>sd</code> is the standard deviation of the delay. During
model fitting these are then transformed to the shape and scale of the gamma
distribution.
</p>
</li></ul>

<p>When <code>distribution</code> is the default lognormal distribution the other function
arguments have the following definition:
</p>

<ul>
<li> <p><code>mean</code> is the mean of the natural logarithm of the delay (on the
log scale).
</p>
</li>
<li> <p><code>sd</code> is the standard deviation of the natural logarithm of the delay.
</p>
</li></ul>
</td></tr>
<tr><td><code id="dist_spec_+3A_max">max</code></td>
<td>
<p>Numeric, maximum value of the distribution. The distribution will
be truncated at this value.</p>
</td></tr>
<tr><td><code id="dist_spec_+3A_pmf">pmf</code></td>
<td>
<p>Numeric, a vector of values that represent the (nonparametric)
probability mass function of the delay (starting with 0); defaults to an
empty vector corresponding to a parametric specification of the distribution
(using <code>mean</code>, <code>sd</code> and corresponding uncertainties)</p>
</td></tr>
<tr><td><code id="dist_spec_+3A_fixed">fixed</code></td>
<td>
<p>Logical, defaults to <code>FALSE</code>. Should delays be treated
as coming from fixed (vs uncertain) distributions. Overrides any values
assigned to <code>mean_sd</code> and <code>sd_sd</code> by setting them to zero.
reduces compute requirement but may produce spuriously precise estimates.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of distribution options.
</p>


<h3>Author(s)</h3>

<p>Sebastian Funk
</p>
<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'># A fixed lognormal distribution with mean 5 and sd 1.
dist_spec(mean = 5, sd = 1, max = 20, distribution = "lognormal")

# An uncertain gamma distribution with mean 3 and sd 2
dist_spec(
  mean = 3, sd = 2, mean_sd = 0.5, sd_sd = 0.5, max = 20,
  distribution = "gamma"
)
</code></pre>

<hr>
<h2 id='dist_spec_plus'>Creates a delay distribution as the sum of two other delay distributions</h2><span id='topic+dist_spec_plus'></span>

<h3>Description</h3>

<p>This is done via convolution with <code>stats::convolve()</code>. Nonparametric delays
that can be combined are processed together, and their cumulative
distribution function is truncated at a specified tolerance level, ensuring
numeric stability.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dist_spec_plus(e1, e2, tolerance = 0.001)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dist_spec_plus_+3A_e1">e1</code></td>
<td>
<p>The first delay distribution (from a call to <code><a href="#topic+dist_spec">dist_spec()</a></code>) to
combine.</p>
</td></tr>
<tr><td><code id="dist_spec_plus_+3A_e2">e2</code></td>
<td>
<p>The second delay distribution (from a call to <code><a href="#topic+dist_spec">dist_spec()</a></code>) to
combine.</p>
</td></tr>
<tr><td><code id="dist_spec_plus_+3A_tolerance">tolerance</code></td>
<td>
<p>A numeric value that sets the cumulative probability
to retain when truncating the cumulative distribution function of the
combined nonparametric delays. The default value is 0.001 with this retaining
0.999 of the cumulative probability. Note that using a larger tolerance may
result in a smaller number of points in the combined nonparametric delay but
may also impact the accuracy of the combined delay (i.e., change the mean
and standard deviation).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A delay distribution representing the sum of the two delays
(with class <code><a href="#topic+dist_spec">dist_spec()</a></code>)
</p>


<h3>Author(s)</h3>

<p>Sebastian Funk
</p>
<p>Sam Abbott
</p>

<hr>
<h2 id='epinow'>Real-time Rt Estimation, Forecasting and Reporting</h2><span id='topic+epinow'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
This function wraps the functionality of <code>estimate_infections()</code> and
<code>forecast_infections()</code> in order to estimate Rt and cases by date of
infection, forecast into these infections into the future. It also contains
additional functionality to convert forecasts to date of report and produce
summary output useful for reporting results and interpreting them. See
<a href="https://gist.github.com/seabbs/163d0f195892cde685c70473e1f5e867">here</a> for
an example of using <code>epinow</code> to estimate Rt for Covid-19 in a country from
the ECDC data source.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>epinow(
  reported_cases,
  generation_time = NULL,
  delays = delay_opts(),
  truncation = trunc_opts(),
  rt = rt_opts(),
  backcalc = backcalc_opts(),
  gp = gp_opts(),
  obs = obs_opts(),
  stan = stan_opts(),
  horizon = 7,
  CrIs = c(0.2, 0.5, 0.9),
  filter_leading_zeros = TRUE,
  zero_threshold = Inf,
  return_output = FALSE,
  output = c("samples", "plots", "latest", "fit", "timing"),
  plot_args = list(),
  target_folder = NULL,
  target_date,
  logs = tempdir(),
  id = "epinow",
  verbose = interactive()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="epinow_+3A_reported_cases">reported_cases</code></td>
<td>
<p>A data frame of confirmed cases (confirm) by date
(date). confirm must be integer and date must be in date format.</p>
</td></tr>
<tr><td><code id="epinow_+3A_generation_time">generation_time</code></td>
<td>
<p>A call to <code>generation_time_opts()</code> defining the
generation time distribution used. For backwards compatibility a list of
summary parameters can also be passed.</p>
</td></tr>
<tr><td><code id="epinow_+3A_delays">delays</code></td>
<td>
<p>A call to <code>delay_opts()</code> defining delay distributions and
options. See the documentation of <code>delay_opts()</code> and the examples below for
details.</p>
</td></tr>
<tr><td><code id="epinow_+3A_truncation">truncation</code></td>
<td>
<p>A call to <code>trunc_opts()</code> defining the truncation of
observed data.  Defaults to <code>trunc_opts()</code>. See <code>estimate_truncation()</code> for
an approach to estimating truncation from data.</p>
</td></tr>
<tr><td><code id="epinow_+3A_rt">rt</code></td>
<td>
<p>A list of options as generated by <code>rt_opts()</code> defining Rt
estimation. Defaults to <code>rt_opts()</code>. Set to <code>NULL</code> to switch to using back
calculation rather than generating infections using Rt.</p>
</td></tr>
<tr><td><code id="epinow_+3A_backcalc">backcalc</code></td>
<td>
<p>A list of options as generated by <code>backcalc_opts()</code> to
define the back calculation. Defaults to <code>backcalc_opts()</code>.</p>
</td></tr>
<tr><td><code id="epinow_+3A_gp">gp</code></td>
<td>
<p>A list of options as generated by <code>gp_opts()</code> to define the
Gaussian process. Defaults to <code>gp_opts()</code>.Set to NULL to disable the
Gaussian process.</p>
</td></tr>
<tr><td><code id="epinow_+3A_obs">obs</code></td>
<td>
<p>A list of options as generated by <code>obs_opts()</code> defining the
observation model. Defaults to <code>obs_opts()</code>.</p>
</td></tr>
<tr><td><code id="epinow_+3A_stan">stan</code></td>
<td>
<p>A list of stan options as generated by <code>stan_opts()</code>. Defaults
to <code>stan_opts()</code>. Can be used to override <code>data</code>, <code>init</code>, and <code>verbose</code>
settings if desired.</p>
</td></tr>
<tr><td><code id="epinow_+3A_horizon">horizon</code></td>
<td>
<p>Numeric, defaults to 7. Number of days into the future to
forecast.</p>
</td></tr>
<tr><td><code id="epinow_+3A_cris">CrIs</code></td>
<td>
<p>Numeric vector of credible intervals to calculate.</p>
</td></tr>
<tr><td><code id="epinow_+3A_filter_leading_zeros">filter_leading_zeros</code></td>
<td>
<p>Logical, defaults to TRUE. Should zeros at the
start of the time series be filtered out.</p>
</td></tr>
<tr><td><code id="epinow_+3A_zero_threshold">zero_threshold</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a> Numeric defaults
to Inf. Indicates if detected zero cases are meaningful by using a threshold
number of cases based on the 7 day average. If the average is above this
threshold then the zero is replaced with the backwards looking rolling
average. If set to infinity then no changes are made.</p>
</td></tr>
<tr><td><code id="epinow_+3A_return_output">return_output</code></td>
<td>
<p>Logical, defaults to FALSE. Should output be returned,
this automatically updates to TRUE if no directory for saving is specified.</p>
</td></tr>
<tr><td><code id="epinow_+3A_output">output</code></td>
<td>
<p>A character vector of optional output to return. Supported
options are samples (&quot;samples&quot;), plots (&quot;plots&quot;), the run time (&quot;timing&quot;),
copying the dated folder into a latest folder (if <code>target_folder</code> is not
null, set using &quot;latest&quot;), and the stan fit (&quot;fit&quot;). The default is to
return all options.</p>
</td></tr>
<tr><td><code id="epinow_+3A_plot_args">plot_args</code></td>
<td>
<p>A list of optional arguments passed to <code>plot.epinow()</code>.</p>
</td></tr>
<tr><td><code id="epinow_+3A_target_folder">target_folder</code></td>
<td>
<p>Character string specifying where to save results (will
create if not present).</p>
</td></tr>
<tr><td><code id="epinow_+3A_target_date">target_date</code></td>
<td>
<p>Date, defaults to maximum found in the data if not
specified.</p>
</td></tr>
<tr><td><code id="epinow_+3A_logs">logs</code></td>
<td>
<p>Character path indicating the target folder in which to store log
information. Defaults to the temporary directory if not specified. Default
logging can be disabled if <code>logs</code> is set to NULL. If specifying a custom
logging setup then the code for <code>setup_default_logging</code> and the
<code>setup_logging</code> function are a sensible place to start.</p>
</td></tr>
<tr><td><code id="epinow_+3A_id">id</code></td>
<td>
<p>A character string used to assign logging information on error.
Used by <code>regional_epinow</code> to assign errors to regions. Alter the default to
run with error catching.</p>
</td></tr>
<tr><td><code id="epinow_+3A_verbose">verbose</code></td>
<td>
<p>Logical, defaults to <code>TRUE</code> when used interactively and
otherwise <code>FALSE</code>. Should verbose debug progress messages be printed.
Corresponds to the &quot;DEBUG&quot; level from <code>futile.logger</code>. See <code>setup_logging</code>
for more detailed logging options.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of output from estimate_infections, forecast_infections,
report_cases, and report_summary.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>See Also</h3>

<p>estimate_infections simulate_infections forecast_infections
</p>
<p>regional_epinow
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# set number of cores to use
old_opts &lt;- options()
options(mc.cores = ifelse(interactive(), 4, 1))
# construct example distributions
generation_time &lt;- get_generation_time(
 disease = "SARS-CoV-2", source = "ganyani"
)
incubation_period &lt;- get_incubation_period(
 disease = "SARS-CoV-2", source = "lauer"
)
reporting_delay &lt;- dist_spec(
  mean = convert_to_logmean(2, 1),
  mean_sd = 0.1,
  sd = convert_to_logsd(2, 1),
  sd_sd = 0.1,
  max = 10
)

# example case data
reported_cases &lt;- example_confirmed[1:40]

# estimate Rt and nowcast/forecast cases by date of infection
out &lt;- epinow(
  reported_cases = reported_cases,
  generation_time = generation_time_opts(generation_time),
  rt = rt_opts(prior = list(mean = 2, sd = 0.1)),
  delays = delay_opts(incubation_period + reporting_delay)
)
# summary of the latest estimates
summary(out)
# plot estimates
plot(out)

# summary of R estimates
summary(out, type = "parameters", params = "R")

options(old_opts)

</code></pre>

<hr>
<h2 id='estimate_delay'>Estimate a Delay Distribution</h2><span id='topic+estimate_delay'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
Estimate a log normal delay distribution from a vector of integer delays.
Currently this function is a simple wrapper for <code>bootstrapped_dist_fit</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_delay(delays, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimate_delay_+3A_delays">delays</code></td>
<td>
<p>Integer vector of delays</p>
</td></tr>
<tr><td><code id="estimate_delay_+3A_...">...</code></td>
<td>
<p>Arguments to pass to internal methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>dist_spec</code> summarising the bootstrapped distribution
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>See Also</h3>

<p>bootstrapped_dist_fit
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
delays &lt;- rlnorm(500, log(5), 1)
estimate_delay(delays, samples = 1000, bootstraps = 10)

</code></pre>

<hr>
<h2 id='estimate_infections'>Estimate Infections, the Time-Varying Reproduction Number and the Rate of
Growth</h2><span id='topic+estimate_infections'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
Uses a non-parametric approach to reconstruct cases by date of infection
from reported cases. It uses either a generative Rt model or non-parametric
back calculation to estimate underlying latent infections and then maps
these infections to observed cases via uncertain reporting delays and a
flexible observation model. See the examples and function arguments for the
details of all options. The default settings may not be sufficient for your
use case so the number of warmup samples (<code>stan_args = list(warmup)</code>) may
need to be increased as may the overall number of samples. Follow the links
provided by any warnings messages to diagnose issues with the MCMC fit. It
is recommended to explore several of the Rt estimation approaches supported
as not all of them may be suited to users own use cases. See
<a href="https://gist.github.com/seabbs/163d0f195892cde685c70473e1f5e867">here</a>
for an example of using <code>estimate_infections</code> within the <code>epinow</code> wrapper to
estimate Rt for Covid-19 in a country from the ECDC data source.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_infections(
  reported_cases,
  generation_time = generation_time_opts(),
  delays = delay_opts(),
  truncation = trunc_opts(),
  rt = rt_opts(),
  backcalc = backcalc_opts(),
  gp = gp_opts(),
  obs = obs_opts(),
  stan = stan_opts(),
  horizon = 7,
  CrIs = c(0.2, 0.5, 0.9),
  filter_leading_zeros = TRUE,
  zero_threshold = Inf,
  weigh_delay_priors = TRUE,
  id = "estimate_infections",
  verbose = interactive()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimate_infections_+3A_reported_cases">reported_cases</code></td>
<td>
<p>A data frame of confirmed cases (confirm) by date
(date). confirm must be integer and date must be in date format.</p>
</td></tr>
<tr><td><code id="estimate_infections_+3A_generation_time">generation_time</code></td>
<td>
<p>A call to <code>generation_time_opts()</code> defining the
generation time distribution used. For backwards compatibility a list of
summary parameters can also be passed.</p>
</td></tr>
<tr><td><code id="estimate_infections_+3A_delays">delays</code></td>
<td>
<p>A call to <code>delay_opts()</code> defining delay distributions and
options. See the documentation of <code>delay_opts()</code> and the examples below for
details.</p>
</td></tr>
<tr><td><code id="estimate_infections_+3A_truncation">truncation</code></td>
<td>
<p>A call to <code>trunc_opts()</code> defining the truncation of
observed data.  Defaults to <code>trunc_opts()</code>. See <code>estimate_truncation()</code> for
an approach to estimating truncation from data.</p>
</td></tr>
<tr><td><code id="estimate_infections_+3A_rt">rt</code></td>
<td>
<p>A list of options as generated by <code>rt_opts()</code> defining Rt
estimation. Defaults to <code>rt_opts()</code>. Set to <code>NULL</code> to switch to using back
calculation rather than generating infections using Rt.</p>
</td></tr>
<tr><td><code id="estimate_infections_+3A_backcalc">backcalc</code></td>
<td>
<p>A list of options as generated by <code>backcalc_opts()</code> to
define the back calculation. Defaults to <code>backcalc_opts()</code>.</p>
</td></tr>
<tr><td><code id="estimate_infections_+3A_gp">gp</code></td>
<td>
<p>A list of options as generated by <code>gp_opts()</code> to define the
Gaussian process. Defaults to <code>gp_opts()</code>.Set to NULL to disable the
Gaussian process.</p>
</td></tr>
<tr><td><code id="estimate_infections_+3A_obs">obs</code></td>
<td>
<p>A list of options as generated by <code>obs_opts()</code> defining the
observation model. Defaults to <code>obs_opts()</code>.</p>
</td></tr>
<tr><td><code id="estimate_infections_+3A_stan">stan</code></td>
<td>
<p>A list of stan options as generated by <code>stan_opts()</code>. Defaults
to <code>stan_opts()</code>. Can be used to override <code>data</code>, <code>init</code>, and <code>verbose</code>
settings if desired.</p>
</td></tr>
<tr><td><code id="estimate_infections_+3A_horizon">horizon</code></td>
<td>
<p>Numeric, defaults to 7. Number of days into the future to
forecast.</p>
</td></tr>
<tr><td><code id="estimate_infections_+3A_cris">CrIs</code></td>
<td>
<p>Numeric vector of credible intervals to calculate.</p>
</td></tr>
<tr><td><code id="estimate_infections_+3A_filter_leading_zeros">filter_leading_zeros</code></td>
<td>
<p>Logical, defaults to TRUE. Should zeros at the
start of the time series be filtered out.</p>
</td></tr>
<tr><td><code id="estimate_infections_+3A_zero_threshold">zero_threshold</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a> Numeric defaults
to Inf. Indicates if detected zero cases are meaningful by using a threshold
number of cases based on the 7 day average. If the average is above this
threshold then the zero is replaced with the backwards looking rolling
average. If set to infinity then no changes are made.</p>
</td></tr>
<tr><td><code id="estimate_infections_+3A_weigh_delay_priors">weigh_delay_priors</code></td>
<td>
<p>Logical. If TRUE (default), all delay distribution
priors will be weighted by the number of observation data points, in doing so
approximately placing an independent prior at each time step and usually
preventing the posteriors from shifting. If FALSE, no weight will be applied,
i.e. delay distributions will be treated as a single parameters.</p>
</td></tr>
<tr><td><code id="estimate_infections_+3A_id">id</code></td>
<td>
<p>A character string used to assign logging information on error.
Used by <code>regional_epinow</code> to assign errors to regions. Alter the default to
run with error catching.</p>
</td></tr>
<tr><td><code id="estimate_infections_+3A_verbose">verbose</code></td>
<td>
<p>Logical, defaults to <code>TRUE</code> when used interactively and
otherwise <code>FALSE</code>. Should verbose debug progress messages be printed.
Corresponds to the &quot;DEBUG&quot; level from <code>futile.logger</code>. See <code>setup_logging</code>
for more detailed logging options.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of output including: posterior samples, summarised posterior
samples, data used to fit the model, and the fit object itself.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>See Also</h3>

<p>epinow regional_epinow forecast_infections simulate_infections
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# set number of cores to use
old_opts &lt;- options()
options(mc.cores = ifelse(interactive(), 4, 1))

# get example case counts
reported_cases &lt;- example_confirmed[1:60]

# set up example generation time
generation_time &lt;- get_generation_time(
  disease = "SARS-CoV-2", source = "ganyani", fixed = TRUE
)
# set delays between infection and case report
incubation_period &lt;- get_incubation_period(
  disease = "SARS-CoV-2", source = "lauer", fixed = TRUE
)
# delays between infection and case report, with uncertainty
incubation_period_uncertain &lt;- get_incubation_period(
  disease = "SARS-CoV-2", source = "lauer"
)
reporting_delay &lt;- dist_spec(
  mean = convert_to_logmean(2, 1), mean_sd = 0,
  sd = convert_to_logsd(2, 1), sd_sd = 0, max = 10
)

# default settings but assuming that delays are fixed rather than uncertain
def &lt;- estimate_infections(reported_cases,
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period + reporting_delay),
  rt = rt_opts(prior = list(mean = 2, sd = 0.1)),
  stan = stan_opts(control = list(adapt_delta = 0.95))
)
# real time estimates
summary(def)
# summary plot
plot(def)

# decreasing the accuracy of the approximate Gaussian to speed up
#computation.
# These settings are an area of active research. See ?gp_opts for details.
agp &lt;- estimate_infections(reported_cases,
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period + reporting_delay),
  rt = rt_opts(prior = list(mean = 2, sd = 0.1)),
  gp = gp_opts(ls_min = 10, basis_prop = 0.1),
  stan = stan_opts(control = list(adapt_delta = 0.95))
)
summary(agp)
plot(agp)

# Adjusting for future susceptible depletion
dep &lt;- estimate_infections(reported_cases,
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period + reporting_delay),
  rt = rt_opts(
    prior = list(mean = 2, sd = 0.1),
    pop = 1000000, future = "latest"
  ),
  gp = gp_opts(ls_min = 10, basis_prop = 0.1), horizon = 21,
  stan = stan_opts(control = list(adapt_delta = 0.95))
)
plot(dep)

# Adjusting for truncation of the most recent data
# See estimate_truncation for an approach to estimating this from data
trunc_dist &lt;- dist_spec(
  mean = convert_to_logmean(0.5, 0.5), mean_sd = 0.1,
  sd = convert_to_logsd(0.5, 0.5), sd_sd = 0.1,
  max = 3
)
trunc &lt;- estimate_infections(reported_cases,
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period + reporting_delay),
  truncation = trunc_opts(trunc_dist),
  rt = rt_opts(prior = list(mean = 2, sd = 0.1)),
  gp = gp_opts(ls_min = 10, basis_prop = 0.1),
  stan = stan_opts(control = list(adapt_delta = 0.95))
)
plot(trunc)

# using back calculation (combined here with under reporting)
# this model is in the order of 10 ~ 100 faster than the gaussian process
# method
# it is likely robust for retrospective Rt but less reliable for real time
# estimates
# the width of the prior window controls the reliance on observed data and
# can be optionally switched off using backcalc_opts(prior = "none"),
# see ?backcalc_opts for other options
backcalc &lt;- estimate_infections(reported_cases,
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period + reporting_delay),
  rt = NULL, backcalc = backcalc_opts(),
  obs = obs_opts(scale = list(mean = 0.4, sd = 0.05)),
  horizon = 0
)
plot(backcalc)

# Rt projected into the future using the Gaussian process
project_rt &lt;- estimate_infections(reported_cases,
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period + reporting_delay),
  rt = rt_opts(
    prior = list(mean = 2, sd = 0.1),
    future = "project"
  )
)
plot(project_rt)

# default settings on a later snapshot of data
snapshot_cases &lt;- example_confirmed[80:130]
snapshot &lt;- estimate_infections(snapshot_cases,
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period + reporting_delay),
  rt = rt_opts(prior = list(mean = 1, sd = 0.1))
)
plot(snapshot)

# stationary Rt assumption (likely to provide biased real-time estimates)
# with uncertain reporting delays
stat &lt;- estimate_infections(reported_cases,
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period_uncertain + reporting_delay),
  rt = rt_opts(prior = list(mean = 2, sd = 0.1), gp_on = "R0")
)
plot(stat)

# no gaussian process (i.e fixed Rt assuming no breakpoints)
# with uncertain reporting delays
fixed &lt;- estimate_infections(reported_cases,
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period_uncertain + reporting_delay),
  gp = NULL
)
plot(fixed)

# no delays
no_delay &lt;- estimate_infections(
  reported_cases,
  generation_time = generation_time_opts(generation_time)
)
plot(no_delay)

# break point but otherwise static Rt
# with uncertain reporting delays
bp_cases &lt;- data.table::copy(reported_cases)
bp_cases &lt;- bp_cases[,
 breakpoint := ifelse(date == as.Date("2020-03-16"), 1, 0)
]
bkp &lt;- estimate_infections(bp_cases,
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period_uncertain + reporting_delay),
  rt = rt_opts(prior = list(mean = 2, sd = 0.1)),
  gp = NULL
)
# break point effect
summary(bkp, type = "parameters", params = "breakpoints")
plot(bkp)

# weekly random walk
# with uncertain reporting delays
rw &lt;- estimate_infections(reported_cases,
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period_uncertain + reporting_delay),
  rt = rt_opts(prior = list(mean = 2, sd = 0.1), rw = 7),
  gp = NULL
)

# random walk effects
summary(rw, type = "parameters", params = "breakpoints")
plot(rw)

options(old_opts)

</code></pre>

<hr>
<h2 id='estimate_secondary'>Estimate a Secondary Observation from a Primary Observation</h2><span id='topic+estimate_secondary'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Estimates the relationship between a primary and secondary observation, for
example hospital admissions and deaths or hospital admissions and bed
occupancy. See <code>secondary_opts()</code> for model structure options. See parameter
documentation for model defaults and options. See the examples for case
studies using synthetic data and
<a href="https://gist.github.com/seabbs/4f09d7609df298db7a86c31612ff9d17">here</a>
for an example of forecasting Covid-19 deaths from Covid-19 cases. See
<a href="https://gist.github.com/seabbs/4dad3958ca8d83daca8f02b143d152e6">here</a> for
a prototype function that may be used to estimate and forecast a secondary
observation from a primary across multiple regions and
<a href="https://github.com/epiforecasts/covid.german.forecasts/blob/master/rt-forecast/death-from-cases.R">here</a> # nolint
for an application forecasting Covid-19 deaths in Germany and Poland.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_secondary(
  reports,
  secondary = secondary_opts(),
  delays = delay_opts(dist_spec(mean = 2.5, mean_sd = 0.5, sd = 0.47, sd_sd = 0.25, max =
    30)),
  truncation = trunc_opts(),
  obs = obs_opts(),
  burn_in = 14,
  CrIs = c(0.2, 0.5, 0.9),
  priors = NULL,
  model = NULL,
  weigh_delay_priors = FALSE,
  verbose = interactive(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimate_secondary_+3A_reports">reports</code></td>
<td>
<p>A data frame containing the <code>date</code> of report and both
<code>primary</code> and <code>secondary</code> reports.</p>
</td></tr>
<tr><td><code id="estimate_secondary_+3A_secondary">secondary</code></td>
<td>
<p>A call to <code>secondary_opts()</code> or a list containing the
following  binary variables: cumulative, historic, primary_hist_additive,
current, primary_current_additive. These parameters control the structure of
the secondary model, see <code>secondary_opts()</code> for details.</p>
</td></tr>
<tr><td><code id="estimate_secondary_+3A_delays">delays</code></td>
<td>
<p>A call to <code><a href="#topic+delay_opts">delay_opts()</a></code> defining delay distributions between
primary and secondary observations See the documentation of <code>delay_opts()</code>
for details. By default a diffuse prior  is assumed with a mean of 14 days
and standard deviation of 7 days (with a standard deviation of 0.5 and 0.25
respectively on the log scale).</p>
</td></tr>
<tr><td><code id="estimate_secondary_+3A_truncation">truncation</code></td>
<td>
<p>A call to <code>trunc_opts()</code> defining the truncation of
observed data.  Defaults to <code>trunc_opts()</code>. See <code>estimate_truncation()</code> for
an approach to estimating truncation from data.</p>
</td></tr>
<tr><td><code id="estimate_secondary_+3A_obs">obs</code></td>
<td>
<p>A list of options as generated by <code>obs_opts()</code> defining the
observation model. Defaults to <code>obs_opts()</code>.</p>
</td></tr>
<tr><td><code id="estimate_secondary_+3A_burn_in">burn_in</code></td>
<td>
<p>Integer, defaults to 14 days. The number of data points to
use for estimation but not to fit to at the beginning of the time series.
This must be less than the number of observations.</p>
</td></tr>
<tr><td><code id="estimate_secondary_+3A_cris">CrIs</code></td>
<td>
<p>Numeric vector of credible intervals to calculate.</p>
</td></tr>
<tr><td><code id="estimate_secondary_+3A_priors">priors</code></td>
<td>
<p>A <code>data.frame</code> of named priors to be used in model fitting
rather than the defaults supplied from other arguments. This is typically
useful if wanting to inform an estimate from the posterior of another model
fit.</p>
</td></tr>
<tr><td><code id="estimate_secondary_+3A_model">model</code></td>
<td>
<p>A compiled stan model to override the default model. May be
useful for package developers or those developing extensions.</p>
</td></tr>
<tr><td><code id="estimate_secondary_+3A_weigh_delay_priors">weigh_delay_priors</code></td>
<td>
<p>Logical. If TRUE, all delay distribution priors
will be weighted by the number of observation data points, in doing so
approximately placing an independent prior at each time step and usually
preventing the posteriors from shifting. If FALSE (default), no weight will
be applied, i.e. delay distributions will be treated as a single
parameters.</p>
</td></tr>
<tr><td><code id="estimate_secondary_+3A_verbose">verbose</code></td>
<td>
<p>Logical, should model fitting progress be returned. Defaults
to <code>interactive()</code>.</p>
</td></tr>
<tr><td><code id="estimate_secondary_+3A_...">...</code></td>
<td>
<p>Additional parameters to pass to <code>rstan::sampling</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing: <code>predictions</code> (a data frame ordered by date with
the primary, and secondary observations, and a summary of the model
estimated secondary observations), <code>posterior</code> which contains a summary of
the entire model posterior, <code>data</code> (a list of data used to fit the
model), and <code>fit</code> (the <code>stanfit</code> object).
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# set number of cores to use
old_opts &lt;- options()
options(mc.cores = ifelse(interactive(), 4, 1))

# load data.table for manipulation
library(data.table)

#### Incidence data example ####

# make some example secondary incidence data
cases &lt;- example_confirmed
cases &lt;- as.data.table(cases)[, primary := confirm]
# Assume that only 40 percent of cases are reported
cases[, scaling := 0.4]
# Parameters of the assumed log normal delay distribution
cases[, meanlog := 1.8][, sdlog := 0.5]

# Simulate secondary cases
cases &lt;- simulate_secondary(cases, type = "incidence")
#
# fit model to example data specifying a weak prior for fraction reported
# with a secondary case
inc &lt;- estimate_secondary(cases[1:60],
  obs = obs_opts(scale = list(mean = 0.2, sd = 0.2), week_effect = FALSE)
)
plot(inc, primary = TRUE)

# forecast future secondary cases from primary
inc_preds &lt;- forecast_secondary(
  inc, cases[seq(61, .N)][, value := primary]
)
plot(inc_preds, new_obs = cases, from = "2020-05-01")

#### Prevalence data example ####

# make some example prevalence data
cases &lt;- example_confirmed
cases &lt;- as.data.table(cases)[, primary := confirm]
# Assume that only 30 percent of cases are reported
cases[, scaling := 0.3]
# Parameters of the assumed log normal delay distribution
cases[, meanlog := 1.6][, sdlog := 0.8]

# Simulate secondary cases
cases &lt;- simulate_secondary(cases, type = "prevalence")

# fit model to example prevalence data
prev &lt;- estimate_secondary(cases[1:100],
  secondary = secondary_opts(type = "prevalence"),
  obs = obs_opts(
    week_effect = FALSE,
    scale = list(mean = 0.4, sd = 0.1)
  )
)
plot(prev, primary = TRUE)

# forecast future secondary cases from primary
prev_preds &lt;- forecast_secondary(
 prev, cases[seq(101, .N)][, value := primary]
)
plot(prev_preds, new_obs = cases, from = "2020-06-01")

options(old_opts)

</code></pre>

<hr>
<h2 id='estimate_truncation'>Estimate Truncation of Observed Data</h2><span id='topic+estimate_truncation'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Estimates a truncation distribution from multiple snapshots of the same
data source over time. This distribution can then be used in
<code>regional_epinow</code>, <code>epinow</code>, and <code>estimate_infections</code> to adjust for
truncated data. See
<a href="https://gist.github.com/seabbs/176b0c7f83eab1a7192a25b28bbd116a">here</a>
for an example of using this approach on Covid-19 data in England. The
functionality offered by this function is now available in a more principled
manner in the <a href="https://package.epinowcast.org/"><code>epinowcast</code> R package</a>.
</p>
<p>The model of truncation is as follows:
</p>

<ol>
<li><p> The truncation distribution is assumed to be discretised log normal wit
a mean and standard deviation that is informed by the data.
</p>
</li>
<li><p> The data set with the latest observations is adjusted for truncation using
the truncation distribution.
</p>
</li>
<li><p> Earlier data sets are recreated by applying the truncation distribution to
the adjusted latest observations in the time period of the earlier data set.
These data sets are then compared to the earlier observations assuming a
negative binomial observation model with an additive noise term to deal with
zero observations.
</p>
</li></ol>

<p>This model is then fit using <code>stan</code> with standard normal, or half normal,
prior for the mean, standard deviation, 1 over the square root of the
overdispersion and additive noise term.
</p>
<p>This approach assumes that:
</p>

<ul>
<li><p> Current truncation is related to past truncation.
</p>
</li>
<li><p> Truncation is a multiplicative scaling of underlying reported cases.
</p>
</li>
<li><p> Truncation is log normally distributed.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>estimate_truncation(
  obs,
  max_truncation,
  trunc_max = 10,
  trunc_dist = "lognormal",
  truncation = dist_spec(mean = 0, sd = 0, mean_sd = 1, sd_sd = 1, max = 10),
  model = NULL,
  CrIs = c(0.2, 0.5, 0.9),
  weigh_delay_priors = FALSE,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimate_truncation_+3A_obs">obs</code></td>
<td>
<p>A list of data frames each containing a date variable
and a confirm (integer) variable. Each data set should be a snapshot
of the reported data over time. All data sets must contain a complete vector
of dates.</p>
</td></tr>
<tr><td><code id="estimate_truncation_+3A_max_truncation">max_truncation</code></td>
<td>
<p>Deprecated; use <code>truncation</code> instead.</p>
</td></tr>
<tr><td><code id="estimate_truncation_+3A_trunc_max">trunc_max</code></td>
<td>
<p>Deprecated; use <code>truncation</code> instead.</p>
</td></tr>
<tr><td><code id="estimate_truncation_+3A_trunc_dist">trunc_dist</code></td>
<td>
<p>Deprecated; use <code>truncation</code> instead.</p>
</td></tr>
<tr><td><code id="estimate_truncation_+3A_truncation">truncation</code></td>
<td>
<p>A call to <code>trunc_opts()</code> defining the truncation of
observed data.  Defaults to <code>trunc_opts()</code>. See <code>estimate_truncation()</code> for
an approach to estimating truncation from data.</p>
</td></tr>
<tr><td><code id="estimate_truncation_+3A_model">model</code></td>
<td>
<p>A compiled stan model to override the default model. May be
useful for package developers or those developing extensions.</p>
</td></tr>
<tr><td><code id="estimate_truncation_+3A_cris">CrIs</code></td>
<td>
<p>Numeric vector of credible intervals to calculate.</p>
</td></tr>
<tr><td><code id="estimate_truncation_+3A_weigh_delay_priors">weigh_delay_priors</code></td>
<td>
<p>Logical. If TRUE, all delay distribution priors
will be weighted by the number of observation data points, in doing so
approximately placing an independent prior at each time step and usually
preventing the posteriors from shifting. If FALSE (default), no weight will
be applied, i.e. delay distributions will be treated as a single
parameters.</p>
</td></tr>
<tr><td><code id="estimate_truncation_+3A_verbose">verbose</code></td>
<td>
<p>Logical, should model fitting progress be returned.</p>
</td></tr>
<tr><td><code id="estimate_truncation_+3A_...">...</code></td>
<td>
<p>Additional parameters to pass to <code>rstan::sampling</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing: the summary parameters of the truncation
distribution (<code>dist</code>), the estimated CMF of the truncation distribution
(<code>cmf</code>, can be used to adjusted new data), a data frame containing the
observed truncated data, latest observed data and the adjusted for
truncation observations (<code>obs</code>), a data frame containing the last
observed data (<code>last_obs</code>, useful for plotting and validation), the data
used for fitting (<code>data</code>) and the fit object (<code>fit</code>).
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>
<p>Sebastian Funk
</p>


<h3>Examples</h3>

<pre><code class='language-R'># set number of cores to use
old_opts &lt;- options()
options(mc.cores = ifelse(interactive(), 4, 1))

# get example case counts
reported_cases &lt;- example_confirmed[1:60]

# define example truncation distribution (note not integer adjusted)
trunc &lt;- dist_spec(
  mean = convert_to_logmean(3, 2),
  mean_sd = 0.1,
  sd = convert_to_logsd(3, 2),
  sd_sd = 0.1,
  max = 10
)

# apply truncation to example data
construct_truncation &lt;- function(index, cases, dist) {
  set.seed(index)
  if (dist$dist == 0) {
    dfunc &lt;- dlnorm
  } else {
    dfunc &lt;- dgamma
  }
  cmf &lt;- cumsum(
    dfunc(
      1:(dist$max + 1),
      rnorm(1, dist$mean_mean, dist$mean_sd),
      rnorm(1, dist$sd_mean, dist$sd_sd)
    )
  )
  cmf &lt;- cmf / cmf[dist$max + 1]
  cmf &lt;- rev(cmf)[-1]
  trunc_cases &lt;- data.table::copy(cases)[1:(.N - index)]
  trunc_cases[
    (.N - length(cmf) + 1):.N, confirm := as.integer(confirm * cmf)
  ]
  return(trunc_cases)
}
example_data &lt;- purrr::map(c(20, 15, 10, 0),
  construct_truncation,
  cases = reported_cases,
  dist = trunc
)

# fit model to example data
est &lt;- estimate_truncation(example_data,
  verbose = interactive(),
  chains = 2, iter = 2000
)

# summary of the distribution
est$dist
# summary of the estimated truncation cmf (can be applied to new data)
print(est$cmf)
# observations linked to truncation adjusted estimates
print(est$obs)
# validation plot of observations vs estimates
plot(est)

options(old_opts)
</code></pre>

<hr>
<h2 id='estimates_by_report_date'>Estimate Cases by Report Date</h2><span id='topic+estimates_by_report_date'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#questioning"><img src="../help/figures/lifecycle-questioning.svg" alt='[Questioning]' /></a>
Either extracts or converts reported cases from an input data table. For
output from <code>estimate_infections</code> this is a simple filtering step.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimates_by_report_date(
  estimates,
  CrIs = c(0.2, 0.5, 0.9),
  target_folder = NULL,
  samples = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimates_by_report_date_+3A_estimates">estimates</code></td>
<td>
<p>List of data frames as output by <code>estimate_infections</code></p>
</td></tr>
<tr><td><code id="estimates_by_report_date_+3A_cris">CrIs</code></td>
<td>
<p>Numeric vector of credible intervals to calculate.</p>
</td></tr>
<tr><td><code id="estimates_by_report_date_+3A_target_folder">target_folder</code></td>
<td>
<p>Character string specifying where to save results (will
create if not present).</p>
</td></tr>
<tr><td><code id="estimates_by_report_date_+3A_samples">samples</code></td>
<td>
<p>Logical, defaults to TRUE. Should samples be saved</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of samples and summarised estimates of estimated cases by
date of report.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='example_confirmed'>Example Confirmed Case Data Set</h2><span id='topic+example_confirmed'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
An example data frame of observed cases
</p>


<h3>Usage</h3>

<pre><code class='language-R'>example_confirmed
</code></pre>


<h3>Format</h3>

<p>A data frame containing cases reported on each date.
</p>

<hr>
<h2 id='expose_stan_fns'>Expose internal package stan functions in R</h2><span id='topic+expose_stan_fns'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
his function exposes internal stan functions in R from a user
supplied list of target files. Allows for testing of stan functions in R and
potentially user use in R code.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expose_stan_fns(files, target_dir, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expose_stan_fns_+3A_files">files</code></td>
<td>
<p>A character vector indicating the target files.</p>
</td></tr>
<tr><td><code id="expose_stan_fns_+3A_target_dir">target_dir</code></td>
<td>
<p>A character string indicating the target directory for the
file.</p>
</td></tr>
<tr><td><code id="expose_stan_fns_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code>rstan::expose_stan_functions</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects
</p>

<hr>
<h2 id='extract_CrIs'>Extract Credible Intervals Present</h2><span id='topic+extract_CrIs'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Helper function to extract the credible intervals present in a data frame.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_CrIs(summarised)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_CrIs_+3A_summarised">summarised</code></td>
<td>
<p>A data frame as processed by <code>calc_CrIs</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector of credible intervals detected in the data frame.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>samples &lt;- data.frame(value = 1:10, type = "car")
summarised &lt;- calc_CrIs(samples,
  summarise_by = "type",
  CrIs = c(seq(0.05, 0.95, 0.05))
)
extract_CrIs(summarised)
</code></pre>

<hr>
<h2 id='extract_inits'>Generate initial conditions from a Stan fit</h2><span id='topic+extract_inits'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
Extracts posterior samples to use to initialise a full model fit. This may
be useful for certain data sets where the sampler gets stuck or cannot
easily be initialised. In <code>estimate_infections()</code>, <code>epinow()</code> and\
<code>regional_epinow()</code> this option can be engaged by setting
<code style="white-space: pre;">&#8288;stan_opts(init_fit = &lt;stanfit&gt;)&#8288;</code>.
</p>
<p>This implementation is based on the approach taken in
<a href="https://github.com/ImperialCollegeLondon/epidemia/">epidemia</a> authored by
James Scott.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_inits(fit, current_inits, exclude_list = NULL, samples = 50)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_inits_+3A_fit">fit</code></td>
<td>
<p>A stanfit object.</p>
</td></tr>
<tr><td><code id="extract_inits_+3A_current_inits">current_inits</code></td>
<td>
<p>A function that returns a list of initial conditions
(such as <code>create_initial_conditions()</code>). Only used in <code>exclude_list</code> is
specified.</p>
</td></tr>
<tr><td><code id="extract_inits_+3A_exclude_list">exclude_list</code></td>
<td>
<p>A character vector of parameters to not initialise from
the fit object, defaulting to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="extract_inits_+3A_samples">samples</code></td>
<td>
<p>Numeric, defaults to 50. Number of posterior samples.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A function that when called returns a set of initial conditions as a
named list.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='extract_parameter'>Extract Samples for a Parameter from a Stan model</h2><span id='topic+extract_parameter'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Extracts a single from a list of <code>stan</code> output and returns it as a
<code>data.table</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_parameter(param, samples, dates)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_parameter_+3A_param">param</code></td>
<td>
<p>Character string indicating the parameter to extract</p>
</td></tr>
<tr><td><code id="extract_parameter_+3A_samples">samples</code></td>
<td>
<p>Extracted stan model (using <code>rstan::extract</code>)</p>
</td></tr>
<tr><td><code id="extract_parameter_+3A_dates">dates</code></td>
<td>
<p>A vector identifying the dimensionality of the parameter to
extract. Generally this will be a date.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame containing the parameter name, date, sample id and
sample value.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='extract_parameter_samples'>Extract Parameter Samples from a Stan Model</h2><span id='topic+extract_parameter_samples'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Extracts a custom set of parameters from a stan object and adds
stratification and dates where appropriate.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_parameter_samples(
  stan_fit,
  data,
  reported_dates,
  reported_inf_dates,
  drop_length_1 = FALSE,
  merge = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_parameter_samples_+3A_stan_fit">stan_fit</code></td>
<td>
<p>A fit Stan model as returned by <code>rstan:sampling</code>.</p>
</td></tr>
<tr><td><code id="extract_parameter_samples_+3A_data">data</code></td>
<td>
<p>A list of the data supplied to the <code>rstan::sampling</code> call.</p>
</td></tr>
<tr><td><code id="extract_parameter_samples_+3A_reported_dates">reported_dates</code></td>
<td>
<p>A vector of dates to report estimates for.</p>
</td></tr>
<tr><td><code id="extract_parameter_samples_+3A_reported_inf_dates">reported_inf_dates</code></td>
<td>
<p>A vector of dates to report infection estimates
for.</p>
</td></tr>
<tr><td><code id="extract_parameter_samples_+3A_drop_length_1">drop_length_1</code></td>
<td>
<p>Logical; whether the first dimension should be dropped
if it is off length 1; this is necessary when processing simulation results.</p>
</td></tr>
<tr><td><code id="extract_parameter_samples_+3A_merge">merge</code></td>
<td>
<p>if TRUE, merge samples and data so that parameters can be
extracted from data.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of dataframes each containing the posterior of a parameter
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='extract_stan_param'>Extract a Parameter Summary from a Stan Object</h2><span id='topic+extract_stan_param'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Extracts summarised parameter posteriors from a <code>stanfit</code> object using
<code>rstan::summary</code> in a format consistent with other summary functions in
<code>EpiNow2</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_stan_param(
  fit,
  params = NULL,
  CrIs = c(0.2, 0.5, 0.9),
  var_names = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_stan_param_+3A_fit">fit</code></td>
<td>
<p>A <code>stanfit</code> objec.</p>
</td></tr>
<tr><td><code id="extract_stan_param_+3A_params">params</code></td>
<td>
<p>A character vector of parameters to extract. Defaults to all
parameters.</p>
</td></tr>
<tr><td><code id="extract_stan_param_+3A_cris">CrIs</code></td>
<td>
<p>Numeric vector of credible intervals to calculate.</p>
</td></tr>
<tr><td><code id="extract_stan_param_+3A_var_names">var_names</code></td>
<td>
<p>Logical defaults to <code>FALSE</code>. Should variables be named.
Automatically set to TRUE if multiple parameters are to be extracted.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.table</code> summarising parameter posteriors. Contains a
following variables: <code>variable</code>, <code>mean</code>, <code>mean_se</code>, <code>sd</code>, <code>median</code>, and
<code>lower_</code>, <code>upper_</code> followed by credible interval labels indicating the
credible intervals present.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='extract_static_parameter'>Extract Samples from a Parameter with a Single Dimension</h2><span id='topic+extract_static_parameter'></span>

<h3>Description</h3>

<p>Extract Samples from a Parameter with a Single Dimension
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_static_parameter(param, samples)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_static_parameter_+3A_param">param</code></td>
<td>
<p>Character string indicating the parameter to extract</p>
</td></tr>
<tr><td><code id="extract_static_parameter_+3A_samples">samples</code></td>
<td>
<p>Extracted stan model (using <code>rstan::extract</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame containing the parameter name, sample id and sample
value
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='filter_opts'>Filter Options for a Target Region</h2><span id='topic+filter_opts'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
A helper function that allows the selection of region specific settings if
present and otherwise applies the overarching settings.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>filter_opts(opts, region)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="filter_opts_+3A_opts">opts</code></td>
<td>
<p>Either a list of calls to an <code style="white-space: pre;">&#8288;_opts()&#8288;</code> function or a single
call to an <code style="white-space: pre;">&#8288;_opts()&#8288;</code> function.</p>
</td></tr>
<tr><td><code id="filter_opts_+3A_region">region</code></td>
<td>
<p>A character string indicating a region of interest.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of options
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='fit_model_with_nuts'>Fit a Stan Model using the NUTs sampler</h2><span id='topic+fit_model_with_nuts'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
Fits a stan model using <code>rstan::sampling</code>. Provides the optional ability to
run chains using <code>future</code> with error catching, timeouts and merging of
completed chains.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_model_with_nuts(
  args,
  future = FALSE,
  max_execution_time = Inf,
  id = "stan"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit_model_with_nuts_+3A_args">args</code></td>
<td>
<p>List of stan arguments.</p>
</td></tr>
<tr><td><code id="fit_model_with_nuts_+3A_future">future</code></td>
<td>
<p>Logical, defaults to <code>FALSE</code>. Should <code>future</code> be used to run
stan chains in parallel.</p>
</td></tr>
<tr><td><code id="fit_model_with_nuts_+3A_max_execution_time">max_execution_time</code></td>
<td>
<p>Numeric, defaults to Inf. What is the maximum
execution time per chain in seconds. Results will still be returned as long
as at least 2 chains complete successfully within the timelimit.</p>
</td></tr>
<tr><td><code id="fit_model_with_nuts_+3A_id">id</code></td>
<td>
<p>A character string used to assign logging information on error.
Used by <code>regional_epinow</code> to assign errors to regions. Alter the default to
run with error catching.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A stan model object
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='fit_model_with_vb'>Fit a Stan Model using Variational Inference</h2><span id='topic+fit_model_with_vb'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
Fits a stan model using variational inference.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_model_with_vb(args, future = FALSE, id = "stan")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit_model_with_vb_+3A_args">args</code></td>
<td>
<p>List of stan arguments.</p>
</td></tr>
<tr><td><code id="fit_model_with_vb_+3A_future">future</code></td>
<td>
<p>Logical, defaults to <code>FALSE</code>. Should <code>future</code> be used to run
stan chains in parallel.</p>
</td></tr>
<tr><td><code id="fit_model_with_vb_+3A_id">id</code></td>
<td>
<p>A character string used to assign logging information on error.
Used by <code>regional_epinow</code> to assign errors to regions. Alter the default to
run with error catching.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A stan model object
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='forecast_secondary'>Forecast Secondary Observations Given a Fit from estimate_secondary</h2><span id='topic+forecast_secondary'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
This function forecasts secondary observations using the output of
<code>estimate_secondary()</code> and either observed primary data or a forecast of
primary observations. See the examples of <code>estimate_secondary()</code>
for one use case. It can also be combined with <code>estimate_infections()</code> t
produce a forecast for a secondary observation from a forecast of a primary
observation. See the examples of <code>estimate_secondary()</code> for
example use cases on synthetic data. See
<a href="https://gist.github.com/seabbs/4f09d7609df298db7a86c31612ff9d17">here</a>
for an example of forecasting Covid-19 deaths from Covid-19 cases.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>forecast_secondary(
  estimate,
  primary,
  primary_variable = "reported_cases",
  model = NULL,
  samples = NULL,
  all_dates = FALSE,
  CrIs = c(0.2, 0.5, 0.9)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="forecast_secondary_+3A_estimate">estimate</code></td>
<td>
<p>An object of class &quot;estimate_secondary&quot; as produced by
<code>estimate_secondary()</code>.</p>
</td></tr>
<tr><td><code id="forecast_secondary_+3A_primary">primary</code></td>
<td>
<p>A data.frame containing at least <code>date</code> and <code>value</code> (integer)
variables and optionally <code>sample</code>. Used as the primary observation used to
forecast the secondary observations. Alternatively, this may be an object of
class &quot;estimate_infections&quot; as produced by <code>estimate_infections()</code>. If
<code>primary</code> is of class &quot;estimate_infections&quot; then the internal samples will
be filtered to have a minimum date ahead of those observed in the <code>estimate</code>
object.</p>
</td></tr>
<tr><td><code id="forecast_secondary_+3A_primary_variable">primary_variable</code></td>
<td>
<p>A character string indicating the primary variable,
defaulting to &quot;reported_cases&quot;. Only used when primary is of class
&quot;estimate_infections&quot;.</p>
</td></tr>
<tr><td><code id="forecast_secondary_+3A_model">model</code></td>
<td>
<p>A compiled stan model as returned by <code>rstan::stan_model</code>.</p>
</td></tr>
<tr><td><code id="forecast_secondary_+3A_samples">samples</code></td>
<td>
<p>Numeric, number of posterior samples to simulate from. The
default is to use all samples in the <code>primary</code> input when present. If not
present the default is to use 1000 samples.</p>
</td></tr>
<tr><td><code id="forecast_secondary_+3A_all_dates">all_dates</code></td>
<td>
<p>Logical, defaults to FALSE. Should a forecast for all dates
and not just those in the forecast horizon be returned.</p>
</td></tr>
<tr><td><code id="forecast_secondary_+3A_cris">CrIs</code></td>
<td>
<p>Numeric vector of credible intervals to calculate.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing: <code>predictions</code> (a data frame ordered by date with
the primary, and secondary observations, and a summary of the forecast
secondary observations. For primary observations in the forecast horizon
when uncertainty is present the median is used), <code>samples</code> a data frame of
forecast secondary observation posterior samples, and <code>forecast</code> a summary
of the forecast secondary observation posterior.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>See Also</h3>

<p>estimate_secondary
</p>

<hr>
<h2 id='format_fit'>Format Posterior Samples</h2><span id='topic+format_fit'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Summaries posterior samples and adds additional custom variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>format_fit(posterior_samples, horizon, shift, burn_in, start_date, CrIs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="format_fit_+3A_posterior_samples">posterior_samples</code></td>
<td>
<p>A list of posterior samples as returned by
<code>extract_parameter_samples</code>.</p>
</td></tr>
<tr><td><code id="format_fit_+3A_horizon">horizon</code></td>
<td>
<p>Numeric, forecast horizon.</p>
</td></tr>
<tr><td><code id="format_fit_+3A_shift">shift</code></td>
<td>
<p>Numeric, the shift to apply to estimates.</p>
</td></tr>
<tr><td><code id="format_fit_+3A_burn_in">burn_in</code></td>
<td>
<p>Numeric, number of days to discard estimates for.</p>
</td></tr>
<tr><td><code id="format_fit_+3A_start_date">start_date</code></td>
<td>
<p>Date, earliest date with data.</p>
</td></tr>
<tr><td><code id="format_fit_+3A_cris">CrIs</code></td>
<td>
<p>Numeric vector of credible intervals to calculate.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of samples and summarised posterior parameter estimates.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='gamma_dist_def'>Generate a Gamma Distribution Definition Based on Parameter Estimates</h2><span id='topic+gamma_dist_def'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#soft-deprecated"><img src="../help/figures/lifecycle-soft-deprecated.svg" alt='[Soft-deprecated]' /></a>
Generates a distribution definition when only parameter estimates
are available for gamma distributed parameters. See <code>rgamma</code> for
distribution information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gamma_dist_def(
  shape,
  shape_sd,
  scale,
  scale_sd,
  mean,
  mean_sd,
  sd,
  sd_sd,
  max_value,
  samples
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gamma_dist_def_+3A_shape">shape</code></td>
<td>
<p>Numeric, shape parameter of the gamma distribution.</p>
</td></tr>
<tr><td><code id="gamma_dist_def_+3A_shape_sd">shape_sd</code></td>
<td>
<p>Numeric, standard deviation of the shape parameter.</p>
</td></tr>
<tr><td><code id="gamma_dist_def_+3A_scale">scale</code></td>
<td>
<p>Numeric, scale parameter of the gamma distribution.</p>
</td></tr>
<tr><td><code id="gamma_dist_def_+3A_scale_sd">scale_sd</code></td>
<td>
<p>Numeric, standard deviation of the scale parameter.</p>
</td></tr>
<tr><td><code id="gamma_dist_def_+3A_mean">mean</code></td>
<td>
<p>Numeric, log mean parameter of the gamma distribution.</p>
</td></tr>
<tr><td><code id="gamma_dist_def_+3A_mean_sd">mean_sd</code></td>
<td>
<p>Numeric, standard deviation of the log mean parameter.</p>
</td></tr>
<tr><td><code id="gamma_dist_def_+3A_sd">sd</code></td>
<td>
<p>Numeric, log sd parameter of the gamma distribution.</p>
</td></tr>
<tr><td><code id="gamma_dist_def_+3A_sd_sd">sd_sd</code></td>
<td>
<p>Numeric, standard deviation of the log sd parameter.</p>
</td></tr>
<tr><td><code id="gamma_dist_def_+3A_max_value">max_value</code></td>
<td>
<p>Numeric, the maximum value to allow. Defaults to 120.
Samples outside of this range are resampled.</p>
</td></tr>
<tr><td><code id="gamma_dist_def_+3A_samples">samples</code></td>
<td>
<p>Numeric, number of sample distributions to generate.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.table defining the distribution as used by <code>dist_skel</code>
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'># using estimated shape and scale
def &lt;- gamma_dist_def(
  shape = 5.807, shape_sd = 0.2,
  scale = 0.9, scale_sd = 0.05,
  max_value = 20, samples = 10
)
print(def)
def$params[[1]]

# using mean and sd
def &lt;- gamma_dist_def(
  mean = 3, mean_sd = 0.5,
  sd = 3, sd_sd = 0.1,
  max_value = 20, samples = 10
)
print(def)
def$params[[1]]
</code></pre>

<hr>
<h2 id='generation_time_opts'>Generation Time Distribution Options</h2><span id='topic+generation_time_opts'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Returns generation time parameters in a format for lower level model use. The
generation time can either be given as a <code>disease</code> and <code>source</code> to
be passed to <a href="#topic+get_generation_time">get_generation_time</a>, or as parameters of a distribution to be
passed to <a href="#topic+dist_spec">dist_spec</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>generation_time_opts(
  dist = dist_spec(mean = 1),
  ...,
  disease,
  source,
  max = 15L,
  fixed = FALSE,
  prior_weight
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="generation_time_opts_+3A_dist">dist</code></td>
<td>
<p>A delay distribution or series of delay distributions generated
using <code><a href="#topic+dist_spec">dist_spec()</a></code> or <code><a href="#topic+get_generation_time">get_generation_time()</a></code>. If no distribution is given
a fixed generation time of 1 will be assumed.</p>
</td></tr>
<tr><td><code id="generation_time_opts_+3A_...">...</code></td>
<td>
<p>deprecated; use <code>dist</code> instead</p>
</td></tr>
<tr><td><code id="generation_time_opts_+3A_disease">disease</code></td>
<td>
<p>deprecated; use <code>dist</code> instead</p>
</td></tr>
<tr><td><code id="generation_time_opts_+3A_source">source</code></td>
<td>
<p>deprecated; use <code>dist</code> instead</p>
</td></tr>
<tr><td><code id="generation_time_opts_+3A_max">max</code></td>
<td>
<p>deprecated; use <code>dist</code> instead</p>
</td></tr>
<tr><td><code id="generation_time_opts_+3A_fixed">fixed</code></td>
<td>
<p>deprecated; use <code>dist</code> instead</p>
</td></tr>
<tr><td><code id="generation_time_opts_+3A_prior_weight">prior_weight</code></td>
<td>
<p>deprecated; prior weights are now specified as a
model option. Use the <code>weigh_delay_priors</code> argument of <code>estimate_infections</code>
instead.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list summarising the input delay distributions.
</p>


<h3>Author(s)</h3>

<p>Sebastian Funk
</p>
<p>Sam Abbott
</p>


<h3>See Also</h3>

<p>convert_to_logmean convert_to_logsd bootstrapped_dist_fit dist_spec
</p>


<h3>Examples</h3>

<pre><code class='language-R'># default settings with a fixed generation time of 1
generation_time_opts()

# A fixed gamma distributed generation time
generation_time_opts(dist_spec(mean = 3, sd = 2, max = 15))

# An uncertain gamma distributed generation time
generation_time_opts(
 dist_spec(mean = 3, sd = 2, mean_sd = 1, sd_sd = 0.5, max = 15)
)

# A generation time sourced from the literature
dist &lt;- get_generation_time(disease = "SARS-CoV-2", source = "ganyani")
generation_time_opts(dist)
</code></pre>

<hr>
<h2 id='generation_times'>Literature Estimates of Generation Times</h2><span id='topic+generation_times'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Generation time estimates. See here for details:
https://github.com/epiforecasts/EpiNow2/blob/main/data-raw/generation-time.R
</p>


<h3>Usage</h3>

<pre><code class='language-R'>generation_times
</code></pre>


<h3>Format</h3>

<p>A <code>data.table</code> of summarising the distribution
</p>

<hr>
<h2 id='get_dist'>Get a Literature Distribution</h2><span id='topic+get_dist'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Search a data frame for a distribution and return it in the format expected
by <code>delay_opts()</code> and the <code>generation_time</code> argument of <code>epinow</code> and
<code>estimate_infections</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_dist(data, disease, source, max_value = 15, fixed = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_dist_+3A_data">data</code></td>
<td>
<p>A <code>data.table</code> in the format of <code>generation_times</code>.</p>
</td></tr>
<tr><td><code id="get_dist_+3A_disease">disease</code></td>
<td>
<p>A character string indicating the disease of interest.</p>
</td></tr>
<tr><td><code id="get_dist_+3A_source">source</code></td>
<td>
<p>A character string indicating the source of interest.</p>
</td></tr>
<tr><td><code id="get_dist_+3A_max_value">max_value</code></td>
<td>
<p>Numeric, the maximum value to allow. Defaults to 15 days.</p>
</td></tr>
<tr><td><code id="get_dist_+3A_fixed">fixed</code></td>
<td>
<p>Logical, defaults to <code>FALSE</code>. Should distributions be supplied
as fixed values (vs with uncertainty)?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list defining a distribution
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'>get_dist(
 EpiNow2::generation_times, disease = "SARS-CoV-2", source = "ganyani"
)
</code></pre>

<hr>
<h2 id='get_generation_time'>Get a Literature Distribution for the Generation Time</h2><span id='topic+get_generation_time'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Extracts a literature distribution from <code>generation_times</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_generation_time(disease, source, max_value = 15, fixed = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_generation_time_+3A_disease">disease</code></td>
<td>
<p>A character string indicating the disease of interest.</p>
</td></tr>
<tr><td><code id="get_generation_time_+3A_source">source</code></td>
<td>
<p>A character string indicating the source of interest.</p>
</td></tr>
<tr><td><code id="get_generation_time_+3A_max_value">max_value</code></td>
<td>
<p>Numeric, the maximum value to allow. Defaults to 15 days.</p>
</td></tr>
<tr><td><code id="get_generation_time_+3A_fixed">fixed</code></td>
<td>
<p>Logical, defaults to <code>FALSE</code>. Should distributions be supplied
as fixed values (vs with uncertainty)?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list defining a distribution
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'>get_generation_time(disease = "SARS-CoV-2", source = "ganyani")
</code></pre>

<hr>
<h2 id='get_incubation_period'>Get a Literature Distribution for the Incubation Period</h2><span id='topic+get_incubation_period'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Extracts a literature distribution from <code>incubation_periods</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_incubation_period(disease, source, max_value = 15, fixed = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_incubation_period_+3A_disease">disease</code></td>
<td>
<p>A character string indicating the disease of interest.</p>
</td></tr>
<tr><td><code id="get_incubation_period_+3A_source">source</code></td>
<td>
<p>A character string indicating the source of interest.</p>
</td></tr>
<tr><td><code id="get_incubation_period_+3A_max_value">max_value</code></td>
<td>
<p>Numeric, the maximum value to allow. Defaults to 15 days.</p>
</td></tr>
<tr><td><code id="get_incubation_period_+3A_fixed">fixed</code></td>
<td>
<p>Logical, defaults to <code>FALSE</code>. Should distributions be supplied
as fixed values (vs with uncertainty)?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list defining a distribution
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'>get_incubation_period(disease = "SARS-CoV-2", source = "lauer")
</code></pre>

<hr>
<h2 id='get_raw_result'>Get a Single Raw Result</h2><span id='topic+get_raw_result'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_raw_result(file, region, date, result_dir)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_raw_result_+3A_file">file</code></td>
<td>
<p>Character string giving the result files name.</p>
</td></tr>
<tr><td><code id="get_raw_result_+3A_region">region</code></td>
<td>
<p>Character string giving the region of interest.</p>
</td></tr>
<tr><td><code id="get_raw_result_+3A_date">date</code></td>
<td>
<p>Target date (in the format <code style="white-space: pre;">&#8288;"yyyy-mm-dd&#8288;</code>).</p>
</td></tr>
<tr><td><code id="get_raw_result_+3A_result_dir">result_dir</code></td>
<td>
<p>Character string giving the location of the target
directory.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An R object read in from the targeted .rds file
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='get_regional_results'>Get Combined Regional Results</h2><span id='topic+get_regional_results'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Summarises results across regions either from input or from disk. See the
examples for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_regional_results(
  regional_output,
  results_dir,
  date,
  samples = TRUE,
  forecast = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_regional_results_+3A_regional_output">regional_output</code></td>
<td>
<p>A list of output as produced by <code>regional_epinow</code> and
stored in the <code>regional</code> list.</p>
</td></tr>
<tr><td><code id="get_regional_results_+3A_results_dir">results_dir</code></td>
<td>
<p>A character string indicating the folder containing the
<code>EpiNow2</code> results to extract.</p>
</td></tr>
<tr><td><code id="get_regional_results_+3A_date">date</code></td>
<td>
<p>A Character string (in the format &quot;yyyy-mm-dd&quot;) indicating the
date to extract data for. Defaults to &quot;latest&quot; which finds the latest
results available.</p>
</td></tr>
<tr><td><code id="get_regional_results_+3A_samples">samples</code></td>
<td>
<p>Logical, defaults to <code>TRUE</code>. Should samples be returned.</p>
</td></tr>
<tr><td><code id="get_regional_results_+3A_forecast">forecast</code></td>
<td>
<p>Logical, defaults to <code>FALSE</code>. Should forecast results be
returned.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of estimates, forecasts and estimated cases by date of report.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# construct example distributions
generation_time &lt;- get_generation_time(
 disease = "SARS-CoV-2", source = "ganyani"
)
incubation_period &lt;- get_incubation_period(
 disease = "SARS-CoV-2", source = "lauer"
)
reporting_delay &lt;- estimate_delay(rlnorm(100, log(6), 1), max_value = 10)

# example case vector
cases &lt;- example_confirmed[1:30]
cases &lt;- data.table::rbindlist(list(
  data.table::copy(cases)[, region := "testland"],
  cases[, region := "realland"]
))

# save results to tmp folder
dir &lt;- file.path(tempdir(check = TRUE), "results")
# run multiregion estimates
regional_out &lt;- regional_epinow(
  reported_cases = cases,
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period + reporting_delay),
  rt = rt_opts(rw = 7), gp = NULL,
  output = c("regions", "latest"),
  target_folder = dir,
  return_output = TRUE
)
# from output
results &lt;- get_regional_results(regional_out$regional, samples = FALSE)
names(results)

# from a folder
folder_results &lt;- get_regional_results(results_dir = dir, samples = FALSE)
names(folder_results)

</code></pre>

<hr>
<h2 id='get_regions'>Get Folders with Results</h2><span id='topic+get_regions'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_regions(results_dir)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_regions_+3A_results_dir">results_dir</code></td>
<td>
<p>A character string giving the directory in which results
are stored (as produced by <code>regional_rt_pipeline</code>).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A named character vector containing the results to plot.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='get_regions_with_most_reports'>Get Regions with Most Reported Cases</h2><span id='topic+get_regions_with_most_reports'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Extract a vector of regions with the most reported cases in a set time
window.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_regions_with_most_reports(reported_cases, time_window = 7, no_regions = 6)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_regions_with_most_reports_+3A_reported_cases">reported_cases</code></td>
<td>
<p>A data frame of confirmed cases (confirm) by date
(date), and region (<code>region</code>).</p>
</td></tr>
<tr><td><code id="get_regions_with_most_reports_+3A_time_window">time_window</code></td>
<td>
<p>Numeric, number of days to include from latest date in
data. Defaults to 7 days.</p>
</td></tr>
<tr><td><code id="get_regions_with_most_reports_+3A_no_regions">no_regions</code></td>
<td>
<p>Numeric, number of regions to return. Defaults to 6.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character vector of regions with the highest reported cases
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='get_seeding_time'>Estimate seeding time from delays and generation time</h2><span id='topic+get_seeding_time'></span>

<h3>Description</h3>

<p>The seeding time is set to the mean of the specified delays, constrained
to be at least the maximum generation time
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_seeding_time(delays, generation_time)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_seeding_time_+3A_delays">delays</code></td>
<td>
<p>Delays as specified using <code>dist_spec</code></p>
</td></tr>
<tr><td><code id="get_seeding_time_+3A_generation_time">generation_time</code></td>
<td>
<p>Generation time as specified using <code>dist_spec</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>An integer seeding time
</p>


<h3>Author(s)</h3>

<p>Sebastian Funk
</p>

<hr>
<h2 id='gp_opts'>Approximate Gaussian Process Settings</h2><span id='topic+gp_opts'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Defines a list specifying the structure of the approximate Gaussian
process. Custom settings can be supplied which override the defaults.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gp_opts(
  basis_prop = 0.2,
  boundary_scale = 1.5,
  ls_mean = 21,
  ls_sd = 7,
  ls_min = 0,
  ls_max = 60,
  alpha_sd = 0.05,
  kernel = "matern",
  matern_type = 3/2
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gp_opts_+3A_basis_prop">basis_prop</code></td>
<td>
<p>Numeric, proportion of time points to use as basis
functions. Defaults to 0.2. Decreasing this value results in a decrease in
accuracy but a faster compute time (with increasing it having the first
effect). In general smaller posterior length scales require a higher
proportion of basis functions. See (Riutort-Mayol et al. 2020
<a href="https://arxiv.org/abs/2004.11408">https://arxiv.org/abs/2004.11408</a>) for advice on updating this default.</p>
</td></tr>
<tr><td><code id="gp_opts_+3A_boundary_scale">boundary_scale</code></td>
<td>
<p>Numeric, defaults to 1.5. Boundary scale of the
approximate Gaussian process. See (Riutort-Mayol et al. 2020
<a href="https://arxiv.org/abs/2004.11408">https://arxiv.org/abs/2004.11408</a>) for advice on updating this default.</p>
</td></tr>
<tr><td><code id="gp_opts_+3A_ls_mean">ls_mean</code></td>
<td>
<p>Numeric, defaults to 21 days. The mean of the lognormal
length scale.</p>
</td></tr>
<tr><td><code id="gp_opts_+3A_ls_sd">ls_sd</code></td>
<td>
<p>Numeric, defaults to 7 days. The standard deviation of the log
normal length scale. If <code>ls_sd = 0</code>, inverse-gamma prior on Gaussian
process length scale will be used with recommended parameters
<code>inv_gamma(1.499007, 0.057277 * ls_max)</code>.</p>
</td></tr>
<tr><td><code id="gp_opts_+3A_ls_min">ls_min</code></td>
<td>
<p>Numeric, defaults to 0. The minimum value of the length scale.</p>
</td></tr>
<tr><td><code id="gp_opts_+3A_ls_max">ls_max</code></td>
<td>
<p>Numeric, defaults to 60. The maximum value of the length
scale. Updated in <code>create_gp_data</code> to be the length of the input data if this
is smaller.</p>
</td></tr>
<tr><td><code id="gp_opts_+3A_alpha_sd">alpha_sd</code></td>
<td>
<p>Numeric, defaults to 0.05. The standard deviation of the
magnitude parameter o  the Gaussian process kernel. Should be approximately
the expected standard deviation of the logged Rt.</p>
</td></tr>
<tr><td><code id="gp_opts_+3A_kernel">kernel</code></td>
<td>
<p>Character string, the type of kernel required. Currently
supporting the squared exponential kernel (&quot;se&quot;) and the 3 over 2 Matern
kernel (&quot;matern&quot;, with <code>matern_type = 3/2</code>). Defaulting to the Matern 3 over
2 kernel as discontinuities are expected  in Rt and infections.</p>
</td></tr>
<tr><td><code id="gp_opts_+3A_matern_type">matern_type</code></td>
<td>
<p>Numeric, defaults to 3/2. Type of Matern Kernel to use.
Currently only the Matern 3/2 kernel is supported.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of settings defining the Gaussian process
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'># default settings
gp_opts()

# add a custom length scale
gp_opts(ls_mean = 4)
</code></pre>

<hr>
<h2 id='growth_to_R'>Convert Growth Rates to Reproduction numbers.</h2><span id='topic+growth_to_R'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#questioning"><img src="../help/figures/lifecycle-questioning.svg" alt='[Questioning]' /></a>
See <a href="https://www.medrxiv.org/content/10.1101/2020.01.30.20019877v3.full.pdf">here</a> # nolint
for justification. Now handled internally by stan so may be removed in
future updates if no user demand.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>growth_to_R(r, gamma_mean, gamma_sd)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="growth_to_R_+3A_r">r</code></td>
<td>
<p>Numeric, rate of growth estimates.</p>
</td></tr>
<tr><td><code id="growth_to_R_+3A_gamma_mean">gamma_mean</code></td>
<td>
<p>Numeric, mean of the gamma distribution</p>
</td></tr>
<tr><td><code id="growth_to_R_+3A_gamma_sd">gamma_sd</code></td>
<td>
<p>Numeric, standard deviation of the gamma distribution
.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric vector of reproduction number estimates
</p>


<h3>Examples</h3>

<pre><code class='language-R'>growth_to_R(0.2, 4, 1)
</code></pre>

<hr>
<h2 id='incubation_periods'>Literature Estimates of Incubation Periods</h2><span id='topic+incubation_periods'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Incubation period estimates. See here for details:
https://github.com/epiforecasts/EpiNow2/blob/main/data-raw/incubation-period.R # nolint
</p>


<h3>Usage</h3>

<pre><code class='language-R'>incubation_periods
</code></pre>


<h3>Format</h3>

<p>A <code>data.table</code> of summarising the distribution
</p>

<hr>
<h2 id='init_cumulative_fit'>Generate initial conditions by fitting to cumulative cases</h2><span id='topic+init_cumulative_fit'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
Fits a model to cumulative cases. This may be a useful approach to
initialising a full model fit for certain data sets where the sampler gets
stuck or cannot easily be initialised as fitting to cumulative cases changes
the shape of the posterior distribution. In <code>estimate_infections()</code>,
<code>epinow()</code> and <code>regional_epinow()</code> this option can be engaged by setting
<code>stan_opts(init_fit = "cumulative")</code>.
</p>
<p>This implementation is based on the approach taken in
<a href="https://github.com/ImperialCollegeLondon/epidemia/">epidemia</a> authored by
James Scott.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>init_cumulative_fit(
  args,
  samples = 50,
  warmup = 50,
  id = "init",
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="init_cumulative_fit_+3A_args">args</code></td>
<td>
<p>List of stan arguments.</p>
</td></tr>
<tr><td><code id="init_cumulative_fit_+3A_samples">samples</code></td>
<td>
<p>Numeric, defaults to 50. Number of posterior samples.</p>
</td></tr>
<tr><td><code id="init_cumulative_fit_+3A_warmup">warmup</code></td>
<td>
<p>Numeric, defaults to 50. Number of warmup samples.</p>
</td></tr>
<tr><td><code id="init_cumulative_fit_+3A_id">id</code></td>
<td>
<p>A character string used to assign logging information on error.
Used by <code>regional_epinow</code> to assign errors to regions. Alter the default to
run with error catching.</p>
</td></tr>
<tr><td><code id="init_cumulative_fit_+3A_verbose">verbose</code></td>
<td>
<p>Logical, should fitting progress be returned. Defaults to
<code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A stanfit object
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='lognorm_dist_def'>Generate a Log Normal Distribution Definition Based on Parameter Estimates</h2><span id='topic+lognorm_dist_def'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#soft-deprecated"><img src="../help/figures/lifecycle-soft-deprecated.svg" alt='[Soft-deprecated]' /></a>
Generates a distribution definition when only parameter estimates
are available for log normal distributed parameters. See <code>rlnorm</code> for
distribution information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lognorm_dist_def(mean, mean_sd, sd, sd_sd, max_value, samples, to_log = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lognorm_dist_def_+3A_mean">mean</code></td>
<td>
<p>Numeric, log mean parameter of the gamma distribution.</p>
</td></tr>
<tr><td><code id="lognorm_dist_def_+3A_mean_sd">mean_sd</code></td>
<td>
<p>Numeric, standard deviation of the log mean parameter.</p>
</td></tr>
<tr><td><code id="lognorm_dist_def_+3A_sd">sd</code></td>
<td>
<p>Numeric, log sd parameter of the gamma distribution.</p>
</td></tr>
<tr><td><code id="lognorm_dist_def_+3A_sd_sd">sd_sd</code></td>
<td>
<p>Numeric, standard deviation of the log sd parameter.</p>
</td></tr>
<tr><td><code id="lognorm_dist_def_+3A_max_value">max_value</code></td>
<td>
<p>Numeric, the maximum value to allow. Defaults to 120.
Samples outside of this range are resampled.</p>
</td></tr>
<tr><td><code id="lognorm_dist_def_+3A_samples">samples</code></td>
<td>
<p>Numeric, number of sample distributions to generate.</p>
</td></tr>
<tr><td><code id="lognorm_dist_def_+3A_to_log">to_log</code></td>
<td>
<p>Logical, should parameters be logged before use.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.table defining the distribution as used by <code>dist_skel</code>
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'>def &lt;- lognorm_dist_def(
  mean = 1.621, mean_sd = 0.0640,
  sd = 0.418, sd_sd = 0.0691,
  max_value = 20, samples = 10
)
print(def)
def$params[[1]]

def &lt;- lognorm_dist_def(
  mean = 5, mean_sd = 1,
  sd = 3, sd_sd = 1,
  max_value = 20, samples = 10,
  to_log = TRUE
)
print(def)
def$params[[1]]
</code></pre>

<hr>
<h2 id='make_conf'>Format Credible Intervals</h2><span id='topic+make_conf'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Combines a list of values into formatted credible intervals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_conf(value, CrI = 90, reverse = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="make_conf_+3A_value">value</code></td>
<td>
<p>List of value to map into a string. Requires,
<code>point</code>, <code>lower</code>, and <code>upper.</code></p>
</td></tr>
<tr><td><code id="make_conf_+3A_cri">CrI</code></td>
<td>
<p>Numeric, credible interval to report. Defaults to 90.</p>
</td></tr>
<tr><td><code id="make_conf_+3A_reverse">reverse</code></td>
<td>
<p>Logical, defaults to FALSE. Should the reported
credible interval be switched.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character vector formatted for reporting
</p>


<h3>Examples</h3>

<pre><code class='language-R'>value &lt;- list(median = 2, lower_90 = 1, upper_90 = 3)
make_conf(value)
</code></pre>

<hr>
<h2 id='map_prob_change'>Categorise the Probability of Change for Rt</h2><span id='topic+map_prob_change'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Categorises a numeric variable into &quot;Increasing&quot; (&lt; 0.05),
&quot;Likely increasing&quot; (&lt;0.4), &quot;Stable&quot; (&lt; 0.6),
&quot;Likely decreasing&quot; (&lt; 0.95), &quot;Decreasing&quot; (&lt;= 1)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>map_prob_change(var)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="map_prob_change_+3A_var">var</code></td>
<td>
<p>Numeric variable to be categorised</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character variable.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>var &lt;- seq(0.01, 1, 0.01)
var

map_prob_change(var)
</code></pre>

<hr>
<h2 id='match_output_arguments'>Match User Supplied Arguments with Supported Options</h2><span id='topic+match_output_arguments'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Match user supplied arguments with supported options and return a logical
list for internal usage.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>match_output_arguments(
  input_args = NULL,
  supported_args = NULL,
  logger = NULL,
  level = "info"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="match_output_arguments_+3A_input_args">input_args</code></td>
<td>
<p>A character vector of input arguments (can be partial).</p>
</td></tr>
<tr><td><code id="match_output_arguments_+3A_supported_args">supported_args</code></td>
<td>
<p>A character vector of supported output arguments.</p>
</td></tr>
<tr><td><code id="match_output_arguments_+3A_logger">logger</code></td>
<td>
<p>A character vector indicating the logger to target messages
at. Defaults to no logging.</p>
</td></tr>
<tr><td><code id="match_output_arguments_+3A_level">level</code></td>
<td>
<p>Character string defaulting to &quot;info&quot;. Logging level see
documentation of futile.logger for details. Supported options are &quot;info&quot; and
&quot;debug&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A logical vector of named output arguments
</p>

<hr>
<h2 id='mean.dist_spec'>Returns the mean of one or more delay distribution</h2><span id='topic+mean.dist_spec'></span>

<h3>Description</h3>

<p>This works out the mean of all the (parametric / nonparametric) delay
distributions combined in the passed <code><a href="#topic+dist_spec">dist_spec()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'dist_spec'
mean(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mean.dist_spec_+3A_x">x</code></td>
<td>
<p>The <code><a href="#topic+dist_spec">dist_spec()</a></code> to use</p>
</td></tr>
<tr><td><code id="mean.dist_spec_+3A_...">...</code></td>
<td>
<p>Not used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of means.
</p>


<h3>Author(s)</h3>

<p>Sebastian Funk
</p>


<h3>Examples</h3>

<pre><code class='language-R'># A fixed lognormal distribution with mean 5 and sd 1.
lognormal &lt;- dist_spec(
 mean = 5, sd = 1, max = 20, distribution = "lognormal"
)
mean(lognormal)

# An uncertain gamma distribution with mean 3 and sd 2
gamma &lt;- dist_spec(
 mean = 3, sd = 2, mean_sd = 0.5, sd_sd = 0.5, max = 20,
 distribution = "gamma"
)
mean(gamma)

# The mean of the sum of two distributions
mean(lognormal + gamma)
</code></pre>

<hr>
<h2 id='obs_opts'>Observation Model Options</h2><span id='topic+obs_opts'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Defines a list specifying the structure of the observation
model. Custom settings can be supplied which override the defaults.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>obs_opts(
  family = "negbin",
  phi = c(0, 1),
  weight = 1,
  week_effect = TRUE,
  week_length = 7,
  scale = list(),
  likelihood = TRUE,
  return_likelihood = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="obs_opts_+3A_family">family</code></td>
<td>
<p>Character string defining the observation model. Options are
Negative binomial (&quot;negbin&quot;), the default, and Poisson.</p>
</td></tr>
<tr><td><code id="obs_opts_+3A_phi">phi</code></td>
<td>
<p>A numeric vector of length 2, defaults to 0, 1. Indicates the
mean and standard deviation of the normal prior used for the observation
process.</p>
</td></tr>
<tr><td><code id="obs_opts_+3A_weight">weight</code></td>
<td>
<p>Numeric, defaults to 1. Weight to give the observed data in
the log density.</p>
</td></tr>
<tr><td><code id="obs_opts_+3A_week_effect">week_effect</code></td>
<td>
<p>Logical defaulting to <code>TRUE</code>. Should a day of the week
effect be used in the observation model.</p>
</td></tr>
<tr><td><code id="obs_opts_+3A_week_length">week_length</code></td>
<td>
<p>Numeric assumed length of the week in days, defaulting to
7 days. This can be modified if data aggregated over a period other than a
week or if data has a non-weekly periodicity.</p>
</td></tr>
<tr><td><code id="obs_opts_+3A_scale">scale</code></td>
<td>
<p>List, defaulting to an empty list. Should an scaling factor be
applied to map latent infections (convolved to date of report). If none
empty a mean (<code>mean</code>) and standard deviation (<code>sd</code>) needs to be supplied
defining the normally distributed scaling factor.</p>
</td></tr>
<tr><td><code id="obs_opts_+3A_likelihood">likelihood</code></td>
<td>
<p>Logical, defaults to <code>TRUE</code>. Should the likelihood be
included in the model.</p>
</td></tr>
<tr><td><code id="obs_opts_+3A_return_likelihood">return_likelihood</code></td>
<td>
<p>Logical, defaults to <code>FALSE</code>. Should the likelihood
be returned by the model.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of observation model settings.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'># default settings
obs_opts()

# Turn off day of the week effect
obs_opts(week_effect = TRUE)

# Scale reported data
obs_opts(scale = list(mean = 0.2, sd = 0.02))
</code></pre>

<hr>
<h2 id='opts_list'>Return an _opts List per Region</h2><span id='topic+opts_list'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
Define a list of <code style="white-space: pre;">&#8288;_opts()&#8288;</code> to pass to <code>regional_epinow</code> <code style="white-space: pre;">&#8288;_opts()&#8288;</code> accepting
arguments. This is useful when different settings are needed between regions
within a single <code>regional_epinow</code> call. Using <code>opts_list</code> the defaults can
be applied to all regions present with an override passed to regions as
necessary (either within <code>opts_list</code> or externally).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>opts_list(opts, reported_cases, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="opts_list_+3A_opts">opts</code></td>
<td>
<p>An <code style="white-space: pre;">&#8288;_opts()&#8288;</code> function call such as <code>rt_opts()</code>.</p>
</td></tr>
<tr><td><code id="opts_list_+3A_reported_cases">reported_cases</code></td>
<td>
<p>A data frame containing a <code>region</code> variable
indicating the target regions.</p>
</td></tr>
<tr><td><code id="opts_list_+3A_...">...</code></td>
<td>
<p>Optional override for region defaults. See the examples
for use case.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A named list of options per region which can be passed to the <code style="white-space: pre;">&#8288;_opt&#8288;</code>
accepting arguments of <code>regional_epinow</code>.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>See Also</h3>

<p>regional_epinow rt_opts
</p>


<h3>Examples</h3>

<pre><code class='language-R'># uses example case vector
cases &lt;- example_confirmed[1:40]
cases &lt;- data.table::rbindlist(list(
  data.table::copy(cases)[, region := "testland"],
  cases[, region := "realland"]
))

# default settings
opts_list(rt_opts(), cases)

# add a weekly random walk in realland
opts_list(rt_opts(), cases, realland = rt_opts(rw = 7))

# add a weekly random walk externally
rt &lt;- opts_list(rt_opts(), cases)
rt$realland$rw &lt;- 7
rt
</code></pre>

<hr>
<h2 id='plot_CrIs'>Plot EpiNow2 Credible Intervals</h2><span id='topic+plot_CrIs'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Adds lineranges for user specified credible intervals
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_CrIs(plot, CrIs, alpha, linewidth)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_CrIs_+3A_plot">plot</code></td>
<td>
<p>A <code>ggplot2</code> plot</p>
</td></tr>
<tr><td><code id="plot_CrIs_+3A_cris">CrIs</code></td>
<td>
<p>Numeric list of credible intervals present in the data. As
produced by <code>extract_CrIs</code></p>
</td></tr>
<tr><td><code id="plot_CrIs_+3A_alpha">alpha</code></td>
<td>
<p>Numeric, overall alpha of the target line range</p>
</td></tr>
<tr><td><code id="plot_CrIs_+3A_linewidth">linewidth</code></td>
<td>
<p>Numeric, line width of the default line range.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot2</code> plot.
</p>

<hr>
<h2 id='plot_estimates'>Plot Estimates</h2><span id='topic+plot_estimates'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#questioning"><img src="../help/figures/lifecycle-questioning.svg" alt='[Questioning]' /></a>
Allows users to plot the output from <code>estimate_infections</code> easily. In future
releases it  may be depreciated in favour of increasing the functionality of
the S3 plot methods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_estimates(
  estimate,
  reported,
  ylab = "Cases",
  hline,
  obs_as_col = TRUE,
  max_plot = 10,
  estimate_type = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_estimates_+3A_estimate">estimate</code></td>
<td>
<p>A data.table of estimates containing the following
variables: date, type (must contain &quot;estimate&quot;, &quot;estimate based on partial
data&quot; and optionally &quot;forecast&quot;).</p>
</td></tr>
<tr><td><code id="plot_estimates_+3A_reported">reported</code></td>
<td>
<p>A data.table of reported cases with the following variables:
date, confirm.</p>
</td></tr>
<tr><td><code id="plot_estimates_+3A_ylab">ylab</code></td>
<td>
<p>Character string, defaulting to &quot;Cases&quot;. Title for the plot y
axis.</p>
</td></tr>
<tr><td><code id="plot_estimates_+3A_hline">hline</code></td>
<td>
<p>Numeric, if supplied gives the horizontal intercept for a
indicator line.</p>
</td></tr>
<tr><td><code id="plot_estimates_+3A_obs_as_col">obs_as_col</code></td>
<td>
<p>Logical, defaults to <code>TRUE</code>. Should observed data, if
supplied, be plotted using columns or as points (linked using a line).</p>
</td></tr>
<tr><td><code id="plot_estimates_+3A_max_plot">max_plot</code></td>
<td>
<p>Numeric, defaults to 10. A multiplicative upper bound on the\
number of cases shown on the plot. Based on the maximum number of reported
cases.</p>
</td></tr>
<tr><td><code id="plot_estimates_+3A_estimate_type">estimate_type</code></td>
<td>
<p>Character vector indicating the type of data to plot.
Default to all types with supported options being: &quot;Estimate&quot;, &quot;Estimate
based on partial data&quot;, and &quot;Forecast&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot2</code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# define example cases
cases &lt;- example_confirmed[1:40]

# set up example delays
generation_time &lt;- get_generation_time(
 disease = "SARS-CoV-2", source = "ganyani"
)
incubation_period &lt;- get_incubation_period(
 disease = "SARS-CoV-2", source = "lauer"
)
reporting_delay &lt;- estimate_delay(rlnorm(100, log(6), 1), max_value = 10)

# run model
out &lt;- estimate_infections(cases,
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period + reporting_delay)
)
# plot infections
plot_estimates(
  estimate = out$summarised[variable == "infections"],
  reported = cases,
  ylab = "Cases", max_plot = 2
) + ggplot2::facet_wrap(~type, scales = "free_y")

# plot reported cases estimated via Rt
plot_estimates(
  estimate = out$summarised[variable == "reported_cases"],
  reported = cases,
  ylab = "Cases"
)

# plot Rt estimates
plot_estimates(
  estimate = out$summarised[variable == "R"],
  ylab = "Effective Reproduction No.",
  hline = 1
)

#' # plot Rt estimates without forecasts
plot_estimates(
  estimate = out$summarised[variable == "R"],
  ylab = "Effective Reproduction No.",
  hline = 1, estimate_type = "Estimate"
)

</code></pre>

<hr>
<h2 id='plot_summary'>Plot a Summary of the Latest Results</h2><span id='topic+plot_summary'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#questioning"><img src="../help/figures/lifecycle-questioning.svg" alt='[Questioning]' /></a>
Used to return a summary plot across regions (using results generated by
<code>summarise_results</code>).
</p>
<p>May be depreciated in later releases in favour of enhanced S3 methods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_summary(summary_results, x_lab = "Region", log_cases = FALSE, max_cases)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_summary_+3A_summary_results">summary_results</code></td>
<td>
<p>A data.table as returned by <code>summarise_results</code> (the
<code>data</code> object).</p>
</td></tr>
<tr><td><code id="plot_summary_+3A_x_lab">x_lab</code></td>
<td>
<p>A character string giving the label for the x axis, defaults to
region.</p>
</td></tr>
<tr><td><code id="plot_summary_+3A_log_cases">log_cases</code></td>
<td>
<p>Logical, should cases be shown on a logged scale. Defaults
to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="plot_summary_+3A_max_cases">max_cases</code></td>
<td>
<p>Numeric, no default. The maximum number of cases to plot.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot2</code> object
</p>

<hr>
<h2 id='plot.dist_spec'>Plot PMF and CDF for a dist_spec object</h2><span id='topic+plot.dist_spec'></span>

<h3>Description</h3>

<p>This function takes a <a href="#topic+dist_spec">dist_spec</a> object and plots its probability mass
function (PMF) and cumulative distribution function (CDF) using <a href="ggplot2.html#topic+ggplot2">ggplot2</a>.
Note that currently uncertainty in distributions is not plot.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'dist_spec'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.dist_spec_+3A_x">x</code></td>
<td>
<p>A <a href="#topic+dist_spec">dist_spec</a> object</p>
</td></tr>
<tr><td><code id="plot.dist_spec_+3A_...">...</code></td>
<td>
<p>Additional arguments to pass to <code>ggplot</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#' # A fixed lognormal distribution with mean 5 and sd 1.
lognormal &lt;- dist_spec(
  mean = 1.6, sd = 0.5, max = 20, distribution = "lognormal"
)
plot(lognormal)

# An uncertain gamma distribution with mean 3 and sd 2
gamma &lt;- dist_spec(
  mean = 3, sd = 2, mean_sd = 0.5, sd_sd = 0.5, max = 20,
  distribution = "gamma"
)
plot(gamma)

# Multiple distributions
plot(lognormal + gamma + lognormal)

# A combination of the two fixed distributions
plot(lognormal + lognormal)
</code></pre>

<hr>
<h2 id='plot.epinow'>Plot method for epinow</h2><span id='topic+plot.epinow'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
<code>plot</code> method for class &quot;epinow&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'epinow'
plot(x, type = "summary", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.epinow_+3A_x">x</code></td>
<td>
<p>A list of output as produced by <code>epinow</code></p>
</td></tr>
<tr><td><code id="plot.epinow_+3A_type">type</code></td>
<td>
<p>A character vector indicating the name of plots to return.
Defaults to  &quot;summary&quot; with supported options being &quot;infections&quot;, &quot;reports&quot;,
&quot;R&quot;, &quot;growth_rate&quot;, &quot;summary&quot;, &quot;all&quot;.</p>
</td></tr>
<tr><td><code id="plot.epinow_+3A_...">...</code></td>
<td>
<p>Pass additional arguments to report_plots</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of plots as produced by <code>report_plots</code>
</p>


<h3>See Also</h3>

<p>plot plot.estimate_infections report_plots estimate_infections
</p>

<hr>
<h2 id='plot.estimate_infections'>Plot method for estimate_infections</h2><span id='topic+plot.estimate_infections'></span><span id='topic+plot'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
<code>plot</code> method for class &quot;estimate_infections&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'estimate_infections'
plot(x, type = "summary", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.estimate_infections_+3A_x">x</code></td>
<td>
<p>A list of output as produced by <code>estimate_infections</code></p>
</td></tr>
<tr><td><code id="plot.estimate_infections_+3A_type">type</code></td>
<td>
<p>A character vector indicating the name of plots to return.
Defaults to  &quot;summary&quot; with supported options being &quot;infections&quot;, &quot;reports&quot;,
&quot;R&quot;, &quot;growth_rate&quot;, &quot;summary&quot;, &quot;all&quot;.</p>
</td></tr>
<tr><td><code id="plot.estimate_infections_+3A_...">...</code></td>
<td>
<p>Pass additional arguments to report_plots</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of plots as produced by <code>report_plots</code>
</p>


<h3>See Also</h3>

<p>plot report_plots estimate_infections
</p>

<hr>
<h2 id='plot.estimate_secondary'>Plot method for estimate_secondary</h2><span id='topic+plot.estimate_secondary'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
<code>plot</code> method for class &quot;estimate_secondary&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'estimate_secondary'
plot(x, primary = FALSE, from = NULL, to = NULL, new_obs = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.estimate_secondary_+3A_x">x</code></td>
<td>
<p>A list of output as produced by <code>estimate_secondary</code></p>
</td></tr>
<tr><td><code id="plot.estimate_secondary_+3A_primary">primary</code></td>
<td>
<p>Logical, defaults to <code>FALSE</code>. Should <code>primary</code> reports also
be plot?</p>
</td></tr>
<tr><td><code id="plot.estimate_secondary_+3A_from">from</code></td>
<td>
<p>Date object indicating when to plot from.</p>
</td></tr>
<tr><td><code id="plot.estimate_secondary_+3A_to">to</code></td>
<td>
<p>Date object indicating when to plot up to.</p>
</td></tr>
<tr><td><code id="plot.estimate_secondary_+3A_new_obs">new_obs</code></td>
<td>
<p>A data.frame containing the columns <code>date</code> and <code>secondary</code>
which replace the secondary observations stored in the <code>estimate_secondary</code>
output.</p>
</td></tr>
<tr><td><code id="plot.estimate_secondary_+3A_...">...</code></td>
<td>
<p>Pass additional arguments to plot function. Not currently in use.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot</code> object.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>See Also</h3>

<p>plot estimate_secondary
</p>

<hr>
<h2 id='plot.estimate_truncation'>Plot method for estimate_truncation</h2><span id='topic+plot.estimate_truncation'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
<code>plot</code> method for class &quot;estimate_truncation&quot;. Returns
a plot faceted over each dataset used in fitting with the latest
observations as columns, the data observed at the time (and so truncated)
as dots and the truncation adjusted estimates as a ribbon.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'estimate_truncation'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.estimate_truncation_+3A_x">x</code></td>
<td>
<p>A list of output as produced by <code>estimate_truncation</code></p>
</td></tr>
<tr><td><code id="plot.estimate_truncation_+3A_...">...</code></td>
<td>
<p>Pass additional arguments to plot function. Not currently in use.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>ggplot2</code> object
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>See Also</h3>

<p>plot estimate_truncation
</p>

<hr>
<h2 id='print.dist_spec'>Prints the parameters of one or more delay distributions</h2><span id='topic+print.dist_spec'></span>

<h3>Description</h3>

<p>This displays the parameters of the uncertain and probability mass
functions of fixed delay distributions combined in the passed <code><a href="#topic+dist_spec">dist_spec()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'dist_spec'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.dist_spec_+3A_x">x</code></td>
<td>
<p>The <code><a href="#topic+dist_spec">dist_spec()</a></code> to use</p>
</td></tr>
<tr><td><code id="print.dist_spec_+3A_...">...</code></td>
<td>
<p>Not used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>invisible
</p>


<h3>Author(s)</h3>

<p>Sebastian Funk
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#' # A fixed lognormal distribution with mean 5 and sd 1.
lognormal &lt;- dist_spec(
  mean = 1.5, sd = 0.5, max = 20, distribution = "lognormal"
)
print(lognormal)

# An uncertain gamma distribution with mean 3 and sd 2
gamma &lt;- dist_spec(
  mean = 3, sd = 2, mean_sd = 0.5, sd_sd = 0.5, max = 20,
  distribution = "gamma"
)
print(gamma)
</code></pre>

<hr>
<h2 id='process_region'>Process regional estimate</h2><span id='topic+process_region'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
Internal function that removes output that is not required, and returns
logging information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>process_region(
  out,
  target_region,
  timing,
  return_output = TRUE,
  return_timing = TRUE,
  complete_logger = "EpiNow2.epinow"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="process_region_+3A_out">out</code></td>
<td>
<p>List of output returned by <code>epinow</code></p>
</td></tr>
<tr><td><code id="process_region_+3A_target_region">target_region</code></td>
<td>
<p>Character string indicating the region being evaluated</p>
</td></tr>
<tr><td><code id="process_region_+3A_timing">timing</code></td>
<td>
<p>Output from <code>Sys.time</code></p>
</td></tr>
<tr><td><code id="process_region_+3A_return_output">return_output</code></td>
<td>
<p>Logical, defaults to FALSE. Should output be returned,
this automatically updates to TRUE if no directory for saving is specified.</p>
</td></tr>
<tr><td><code id="process_region_+3A_return_timing">return_timing</code></td>
<td>
<p>Logical, should runtime be returned</p>
</td></tr>
<tr><td><code id="process_region_+3A_complete_logger">complete_logger</code></td>
<td>
<p>Character string indicating the logger to output
the completion of estimation to.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of processed output
</p>


<h3>See Also</h3>

<p>regional_epinow
</p>

<hr>
<h2 id='process_regions'>Process all Region Estimates</h2><span id='topic+process_regions'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Internal function that processes the output from multiple <code>epinow</code> runs, adds
summary logging information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>process_regions(regional_out, regions)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="process_regions_+3A_regional_out">regional_out</code></td>
<td>
<p>A list of output from multiple runs of <code>regional_epinow</code></p>
</td></tr>
<tr><td><code id="process_regions_+3A_regions">regions</code></td>
<td>
<p>A character vector identifying the regions that have been run</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of all regional estimates and successful regional estimates
</p>


<h3>See Also</h3>

<p>regional_epinow epinow
</p>

<hr>
<h2 id='R_to_growth'>Convert Reproduction Numbers to Growth Rates</h2><span id='topic+R_to_growth'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#questioning"><img src="../help/figures/lifecycle-questioning.svg" alt='[Questioning]' /></a>
See <a href="https://www.medrxiv.org/content/10.1101/2020.01.30.20019877v3.full.pdf">here</a> # nolint
for justification. Now handled internally by stan so may be removed in
future updates if no user demand.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>R_to_growth(R, gamma_mean, gamma_sd)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="R_to_growth_+3A_r">R</code></td>
<td>
<p>Numeric, Reproduction number estimates</p>
</td></tr>
<tr><td><code id="R_to_growth_+3A_gamma_mean">gamma_mean</code></td>
<td>
<p>Numeric, mean of the gamma distribution</p>
</td></tr>
<tr><td><code id="R_to_growth_+3A_gamma_sd">gamma_sd</code></td>
<td>
<p>Numeric, standard deviation of the gamma distribution
.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric vector of reproduction number estimates
</p>


<h3>Examples</h3>

<pre><code class='language-R'>R_to_growth(2.18, 4, 1)
</code></pre>

<hr>
<h2 id='regional_epinow'>Real-time Rt Estimation, Forecasting and Reporting by Region</h2><span id='topic+regional_epinow'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
Efficiently runs <code>epinow()</code> across multiple regions in an efficient manner
and conducts basic data checks and cleaning such as removing regions with
fewer than <code>non_zero_points</code> as these are unlikely to produce reasonable
results whilst consuming significant resources. See the documentation for
<code>epinow</code> for further information.
</p>
<p>By default all arguments supporting input from <code style="white-space: pre;">&#8288;_opts()&#8288;</code> functions are
shared across regions (including delays, truncation, Rt settings, stan
settings, and gaussian process settings). Region specific settings are
supported by passing a named list of <code style="white-space: pre;">&#8288;_opts()&#8288;</code> calls (with an entry per
region) to the relevant argument. A helper function (<code>opts_list</code>) is
available to facilitate building this list.
</p>
<p>Regions can be estimated in parallel using the <code>{future}</code> package (see
<code>setup_future</code>). The progress of producing estimates across multiple regions
is tracked using the <code>progressr</code> package. Modify this behaviour using
progressr::handlers and enable it in batch by setting
<code>R_PROGRESSR_ENABLE=TRUE</code> as an environment variable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>regional_epinow(
  reported_cases,
  generation_time,
  delays = delay_opts(),
  truncation = trunc_opts(),
  rt = rt_opts(),
  backcalc = backcalc_opts(),
  gp = gp_opts(),
  obs = obs_opts(),
  stan = stan_opts(),
  horizon = 7,
  CrIs = c(0.2, 0.5, 0.9),
  target_folder = NULL,
  target_date,
  non_zero_points = 2,
  output = c("regions", "summary", "samples", "plots", "latest"),
  return_output = FALSE,
  summary_args = list(),
  verbose = FALSE,
  logs = tempdir(check = TRUE),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="regional_epinow_+3A_reported_cases">reported_cases</code></td>
<td>
<p>A data frame of confirmed cases (confirm) by date
(date), and region (<code>region</code>).</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_generation_time">generation_time</code></td>
<td>
<p>A call to <code>generation_time_opts()</code> defining the
generation time distribution used. For backwards compatibility a list of
summary parameters can also be passed.</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_delays">delays</code></td>
<td>
<p>A call to <code>delay_opts()</code> defining delay distributions and
options. See the documentation of <code>delay_opts()</code> and the examples below for
details.</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_truncation">truncation</code></td>
<td>
<p>A call to <code>trunc_opts()</code> defining the truncation of
observed data.  Defaults to <code>trunc_opts()</code>. See <code>estimate_truncation()</code> for
an approach to estimating truncation from data.</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_rt">rt</code></td>
<td>
<p>A list of options as generated by <code>rt_opts()</code> defining Rt
estimation. Defaults to <code>rt_opts()</code>. Set to <code>NULL</code> to switch to using back
calculation rather than generating infections using Rt.</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_backcalc">backcalc</code></td>
<td>
<p>A list of options as generated by <code>backcalc_opts()</code> to
define the back calculation. Defaults to <code>backcalc_opts()</code>.</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_gp">gp</code></td>
<td>
<p>A list of options as generated by <code>gp_opts()</code> to define the
Gaussian process. Defaults to <code>gp_opts()</code>.Set to NULL to disable the
Gaussian process.</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_obs">obs</code></td>
<td>
<p>A list of options as generated by <code>obs_opts()</code> defining the
observation model. Defaults to <code>obs_opts()</code>.</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_stan">stan</code></td>
<td>
<p>A list of stan options as generated by <code>stan_opts()</code>. Defaults
to <code>stan_opts()</code>. Can be used to override <code>data</code>, <code>init</code>, and <code>verbose</code>
settings if desired.</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_horizon">horizon</code></td>
<td>
<p>Numeric, defaults to 7. Number of days into the future to
forecast.</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_cris">CrIs</code></td>
<td>
<p>Numeric vector of credible intervals to calculate.</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_target_folder">target_folder</code></td>
<td>
<p>Character string specifying where to save results (will
create if not present).</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_target_date">target_date</code></td>
<td>
<p>Date, defaults to maximum found in the data if not
specified.</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_non_zero_points">non_zero_points</code></td>
<td>
<p>Numeric, the minimum number of time points with
non-zero cases in a region required for that region to be evaluated.
Defaults to 7.</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_output">output</code></td>
<td>
<p>A character vector of optional output to return. Supported
options are the individual regional estimates (&quot;regions&quot;),  samples
(&quot;samples&quot;), plots (&quot;plots&quot;), copying the individual region dated folder into
a latest folder (if <code>target_folder</code> is not null, set using &quot;latest&quot;), the
stan fit of the underlying model (&quot;fit&quot;), and an overall summary across
regions (&quot;summary&quot;). The default is to return samples and plots alongside
summarised estimates and summary statistics. If <code>target_folder</code> is not NULL
then the default is also to copy all results into a latest folder.</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_return_output">return_output</code></td>
<td>
<p>Logical, defaults to FALSE. Should output be returned,
this automatically updates to TRUE if no directory for saving is specified.</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_summary_args">summary_args</code></td>
<td>
<p>A list of arguments passed to <code>regional_summary</code>. See
the <code>regional_summary</code> documentation for details.</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_verbose">verbose</code></td>
<td>
<p>Logical defaults to FALSE. Outputs verbose progress messages
to the console from <code>epinow</code>.</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_logs">logs</code></td>
<td>
<p>Character path indicating the target folder in which to store log
information. Defaults to the temporary directory if not specified. Default
logging can be disabled if <code>logs</code> is set to NULL. If specifying a custom
logging setup then the code for <code>setup_default_logging</code> and the
<code>setup_logging</code> function are a sensible place to start.</p>
</td></tr>
<tr><td><code id="regional_epinow_+3A_...">...</code></td>
<td>
<p>Pass additional arguments to <code>epinow</code>. See the documentation for
<code>epinow</code> for details.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of output stratified at the top level into regional output
and across region output summary output
</p>


<h3>See Also</h3>

<p>epinow estimate_infections forecast_infections
</p>
<p>setup_future regional_summary
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# set number of cores to use
old_opts &lt;- options()
options(mc.cores = ifelse(interactive(), 4, 1))

# construct example distributions
generation_time &lt;- get_generation_time(
 disease = "SARS-CoV-2", source = "ganyani"
)
incubation_period &lt;- get_incubation_period(
 disease = "SARS-CoV-2", source = "lauer"
)
reporting_delay &lt;- dist_spec(
  mean = convert_to_logmean(2, 1),
  mean_sd = 0.1,
  sd = convert_to_logsd(2, 1),
  sd_sd = 0.1, max = 15
)

# uses example case vector
cases &lt;- example_confirmed[1:60]
cases &lt;- data.table::rbindlist(list(
  data.table::copy(cases)[, region := "testland"],
  cases[, region := "realland"]
))

# run epinow across multiple regions and generate summaries
# samples and warmup have been reduced for this example
def &lt;- regional_epinow(
  reported_cases = cases,
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period + reporting_delay),
  rt = rt_opts(prior = list(mean = 2, sd = 0.2)),
  stan = stan_opts(
    samples = 100, warmup = 200,
    control = list(adapt_delta = 0.95)
  ),
  verbose = interactive()
)

# apply a different rt method per region
# (here a gaussian process and a weekly random walk)
gp &lt;- opts_list(gp_opts(), cases)
gp &lt;- update_list(gp, list(realland = NULL))
rt &lt;- opts_list(rt_opts(), cases, realland = rt_opts(rw = 7))
region_rt &lt;- regional_epinow(
  reported_cases = cases,
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period + reporting_delay),
  rt = rt, gp = gp,
  stan = stan_opts(
    samples = 100, warmup = 200,
    control = list(adapt_delta = 0.95)
  ),
  verbose = interactive()
)

options(old_opts)

</code></pre>

<hr>
<h2 id='regional_runtimes'>Summarise Regional Runtimes</h2><span id='topic+regional_runtimes'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
Used internally by <code>regional_epinow</code> to summarise region run times.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>regional_runtimes(
  regional_output = NULL,
  target_folder = NULL,
  target_date = NULL,
  return_output = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="regional_runtimes_+3A_regional_output">regional_output</code></td>
<td>
<p>A list of output as produced by <code>regional_epinow</code> and
stored in the <code>regional</code> list.</p>
</td></tr>
<tr><td><code id="regional_runtimes_+3A_target_folder">target_folder</code></td>
<td>
<p>Character string specifying where to save results (will
create if not present).</p>
</td></tr>
<tr><td><code id="regional_runtimes_+3A_target_date">target_date</code></td>
<td>
<p>A character string giving the target date for which to
extract results
(in the format &quot;yyyy-mm-dd&quot;). Defaults to latest available estimates.</p>
</td></tr>
<tr><td><code id="regional_runtimes_+3A_return_output">return_output</code></td>
<td>
<p>Logical, defaults to FALSE. Should output be returned,
this automatically updates to TRUE if no directory for saving is specified.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.table of region run times
</p>


<h3>See Also</h3>

<p>regional_summary regional_epinow
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# example delays
generation_time &lt;- get_generation_time(
 disease = "SARS-CoV-2", source = "ganyani"
)
incubation_period &lt;- get_incubation_period(
 disease = "SARS-CoV-2", source = "lauer"
)
reporting_delay &lt;- estimate_delay(rlnorm(100, log(6), 1), max_value = 15)

cases &lt;- example_confirmed[1:30]
cases &lt;- data.table::rbindlist(list(
  data.table::copy(cases)[, region := "testland"],
  cases[, region := "realland"]
))

# run basic nowcasting pipeline
regional_out &lt;- regional_epinow(
  reported_cases = cases,
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period + reporting_delay),
  stan = stan_opts(samples = 100, warmup = 100),
  output = c("region", "timing")
)

regional_runtimes(regional_output = regional_out$regional)

</code></pre>

<hr>
<h2 id='regional_summary'>Regional Summary Output</h2><span id='topic+regional_summary'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
Used to produce summary output either internally in <code>regional_epinow</code> or
externally.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>regional_summary(
  regional_output = NULL,
  reported_cases,
  results_dir = NULL,
  summary_dir = NULL,
  target_date = NULL,
  region_scale = "Region",
  all_regions = TRUE,
  return_output = FALSE,
  plot = TRUE,
  max_plot = 10,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="regional_summary_+3A_regional_output">regional_output</code></td>
<td>
<p>A list of output as produced by <code>regional_epinow</code> and
stored in the <code>regional</code> list.</p>
</td></tr>
<tr><td><code id="regional_summary_+3A_reported_cases">reported_cases</code></td>
<td>
<p>A data frame of confirmed cases (confirm) by date
(date), and region (<code>region</code>).</p>
</td></tr>
<tr><td><code id="regional_summary_+3A_results_dir">results_dir</code></td>
<td>
<p>An optional character string indicating the location of
the results directory to extract results from.</p>
</td></tr>
<tr><td><code id="regional_summary_+3A_summary_dir">summary_dir</code></td>
<td>
<p>A character string giving the directory
in which to store summary of results.</p>
</td></tr>
<tr><td><code id="regional_summary_+3A_target_date">target_date</code></td>
<td>
<p>A character string giving the target date for which to
extract results
(in the format &quot;yyyy-mm-dd&quot;). Defaults to latest available estimates.</p>
</td></tr>
<tr><td><code id="regional_summary_+3A_region_scale">region_scale</code></td>
<td>
<p>A character string indicating the name to give the
regions being summarised.</p>
</td></tr>
<tr><td><code id="regional_summary_+3A_all_regions">all_regions</code></td>
<td>
<p>Logical, defaults to <code>TRUE</code>. Should summary plots for all
regions be returned rather than just regions of interest.</p>
</td></tr>
<tr><td><code id="regional_summary_+3A_return_output">return_output</code></td>
<td>
<p>Logical, defaults to FALSE. Should output be returned,
this automatically updates to TRUE if no directory for saving is specified.</p>
</td></tr>
<tr><td><code id="regional_summary_+3A_plot">plot</code></td>
<td>
<p>Logical, defaults to <code>TRUE</code>. Should regional summary plots be
produced.</p>
</td></tr>
<tr><td><code id="regional_summary_+3A_max_plot">max_plot</code></td>
<td>
<p>Numeric, defaults to 10. A multiplicative upper bound on the\
number of cases shown on the plot. Based on the maximum number of reported
cases.</p>
</td></tr>
<tr><td><code id="regional_summary_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code>report_plots</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of summary measures and plots
</p>


<h3>See Also</h3>

<p>regional_epinow
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# example delays
generation_time &lt;- get_generation_time(
 disease = "SARS-CoV-2", source = "ganyani"
)
incubation_period &lt;- get_incubation_period(
 disease = "SARS-CoV-2", source = "lauer"
)
reporting_delay &lt;- estimate_delay(rlnorm(100, log(6), 1), max_value = 30)

# example case vector from EpiSoon
cases &lt;- example_confirmed[1:30]
cases &lt;- data.table::rbindlist(list(
  data.table::copy(cases)[, region := "testland"],
  cases[, region := "realland"]
))

# run basic nowcasting pipeline
out &lt;- regional_epinow(
  reported_cases = cases,
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period + reporting_delay),
  output = "region",
  rt = NULL
)

regional_summary(
  regional_output = out$regional,
  reported_cases = cases
)

</code></pre>

<hr>
<h2 id='report_cases'>Report case counts by date of report</h2><span id='topic+report_cases'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#soft-deprecated"><img src="../help/figures/lifecycle-soft-deprecated.svg" alt='[Soft-deprecated]' /></a>
Convolves latent infections to reported cases via an observation model.
Likely to be removed/replaced in later releases by functionality drawing on
the <code>stan</code> implementation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>report_cases(
  case_estimates,
  case_forecast = NULL,
  delays,
  type = "sample",
  reporting_effect,
  CrIs = c(0.2, 0.5, 0.9)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="report_cases_+3A_case_estimates">case_estimates</code></td>
<td>
<p>A data.table of case estimates with the following
variables: date, sample, cases</p>
</td></tr>
<tr><td><code id="report_cases_+3A_case_forecast">case_forecast</code></td>
<td>
<p>A data.table of case forecasts with the following
variables: date, sample, cases. If not supplied the default is not to
incorporate forecasts.</p>
</td></tr>
<tr><td><code id="report_cases_+3A_delays">delays</code></td>
<td>
<p>A call to <code>delay_opts()</code> defining delay distributions and
options. See the documentation of <code>delay_opts()</code> and the examples below for
details.</p>
</td></tr>
<tr><td><code id="report_cases_+3A_type">type</code></td>
<td>
<p>Character string indicating the method to use to transform
counts. Supports either &quot;sample&quot;  which approximates sampling or &quot;median&quot;
would shift by the median of the distribution.</p>
</td></tr>
<tr><td><code id="report_cases_+3A_reporting_effect">reporting_effect</code></td>
<td>
<p>A <code>data.table</code> giving the weekly reporting effect
with the following variables: <code>sample</code> (must be the same as in <code>nowcast</code>),
<code>effect</code> (numeric scaling factor for each weekday),<code>day</code> (numeric 1 - 7
(1 = Monday and 7 = Sunday)). If not supplied then no weekly reporting
effect is assumed.</p>
</td></tr>
<tr><td><code id="report_cases_+3A_cris">CrIs</code></td>
<td>
<p>Numeric vector of credible intervals to calculate.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of <code>data.table</code>s. The first entry contains the following
variables <code>sample</code>, <code>date</code> and <code>cases</code> with the second being summarised
across samples.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# define example cases
cases &lt;- example_confirmed[1:40]

# set up example delays
generation_time &lt;- get_generation_time(
 disease = "SARS-CoV-2", source = "ganyani"
)
incubation_period &lt;- get_incubation_period(
 disease = "SARS-CoV-2", source = "lauer"
)
reporting_delay &lt;- dist_spec(
  mean = convert_to_logmean(2, 1), mean_sd = 0.1,
  sd = convert_to_logsd(2, 1), sd_sd = 0.1, max = 10
)

# Instead of running them model we use example
# data for speed in this example.
cases &lt;- cases[, cases := as.integer(confirm)]
cases &lt;- cases[, confirm := NULL][, sample := 1]

reported_cases &lt;- report_cases(
  case_estimates = cases,
  delays = delay_opts(incubation_period + reporting_delay),
  type = "sample"
)
print(reported_cases)

</code></pre>

<hr>
<h2 id='report_plots'>Report plots</h2><span id='topic+report_plots'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#questioning"><img src="../help/figures/lifecycle-questioning.svg" alt='[Questioning]' /></a>
Returns key summary plots for estimates. May be depreciated in later
releases as current S3 methods are enhanced.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>report_plots(summarised_estimates, reported, target_folder = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="report_plots_+3A_summarised_estimates">summarised_estimates</code></td>
<td>
<p>A data.table of summarised estimates containing
the following variables: variable, median, bottom, and top.
</p>
<p>It should also contain the following estimates: R, infections,
reported_cases_rt, and r (rate of growth).</p>
</td></tr>
<tr><td><code id="report_plots_+3A_reported">reported</code></td>
<td>
<p>A data.table of reported cases with the following variables:
date, confirm.</p>
</td></tr>
<tr><td><code id="report_plots_+3A_target_folder">target_folder</code></td>
<td>
<p>Character string specifying where to save results (will
create if not present).</p>
</td></tr>
<tr><td><code id="report_plots_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code>plot_estimates()</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A named list of <code>ggplot2</code> objects, <code>list(infections, reports, R, growth_rate, summary)</code>, which correspond to a summary combination (last
item) and for the leading items.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot_estimates">plot_estimates()</a></code> of
<code>summarised_estimates[variable == "infections"]</code>,
<code>summarised_estimates[variable == "reported_cases"]</code>,
<code>summarised_estimates[variable == "R"]</code>, and
<code>summarised_estimates[variable == "growth_rate"]</code>, respectively.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# define example cases
cases &lt;- example_confirmed[1:40]

# set up example delays
generation_time &lt;- get_generation_time(
 disease = "SARS-CoV-2", source = "ganyani"
)
incubation_period &lt;- get_incubation_period(
 disease = "SARS-CoV-2", source = "lauer"
)
reporting_delay &lt;- bootstrapped_dist_fit(
 rlnorm(100, log(6), 1), max_value = 30
)

# run model
out &lt;- estimate_infections(cases,
  stan = stan_opts(samples = 500),
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period + reporting_delay),
  rt = NULL
)

# plot infections
plots &lt;- report_plots(
  summarised_estimates = out$summarised,
  reported = cases
)
plots

</code></pre>

<hr>
<h2 id='report_summary'>Provide Summary Statistics for Estimated Infections and Rt</h2><span id='topic+report_summary'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#questioning"><img src="../help/figures/lifecycle-questioning.svg" alt='[Questioning]' /></a>
Creates a snapshot summary of estimates. May be removed in later releases as
S3 methods are enhanced.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>report_summary(
  summarised_estimates,
  rt_samples,
  target_folder = NULL,
  return_numeric = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="report_summary_+3A_summarised_estimates">summarised_estimates</code></td>
<td>
<p>A data.table of summarised estimates containing
the following variables: variable, median, bottom, and top. It should
contain the following estimates: R, infections, and r (rate of growth).</p>
</td></tr>
<tr><td><code id="report_summary_+3A_rt_samples">rt_samples</code></td>
<td>
<p>A data.table containing Rt samples with the following
variables: sample and value.</p>
</td></tr>
<tr><td><code id="report_summary_+3A_target_folder">target_folder</code></td>
<td>
<p>Character string specifying where to save results (will
create if not present).</p>
</td></tr>
<tr><td><code id="report_summary_+3A_return_numeric">return_numeric</code></td>
<td>
<p>Should numeric summary information be returned.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.table containing formatted and numeric summary measures
</p>

<hr>
<h2 id='rstan_opts'>Rstan Options</h2><span id='topic+rstan_opts'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Defines a list specifying the arguments passed to underlying <code>rstan</code>
functions via <code>rstan_sampling_opts()</code> and <code>rstan_vb_opts()</code>.Custom settings
can be supplied which override the defaults.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rstan_opts(object = NULL, samples = 2000, method = "sampling", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rstan_opts_+3A_object">object</code></td>
<td>
<p>Stan model object. By default uses the compiled package
default.</p>
</td></tr>
<tr><td><code id="rstan_opts_+3A_samples">samples</code></td>
<td>
<p>Numeric, default 2000. Overall number of posterior samples.
When using multiple chains iterations per chain is samples / chains.</p>
</td></tr>
<tr><td><code id="rstan_opts_+3A_method">method</code></td>
<td>
<p>A character string, defaulting to sampling. Currently supports
<code>rstan::sampling</code> (&quot;sampling&quot;) or <code>rstan:vb</code> (&quot;vb&quot;).</p>
</td></tr>
<tr><td><code id="rstan_opts_+3A_...">...</code></td>
<td>
<p>Additional parameters to pass  underlying option functions.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of arguments to pass to the appropriate rstan functions.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>See Also</h3>

<p>rstan_sampling_opts rstan_vb_opts
</p>


<h3>Examples</h3>

<pre><code class='language-R'>rstan_opts(samples = 1000)

# using vb
rstan_opts(method = "vb")
</code></pre>

<hr>
<h2 id='rstan_sampling_opts'>Rstan Sampling Options</h2><span id='topic+rstan_sampling_opts'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Defines a list specifying the arguments passed to
<code>rstan::sampling</code>. Custom settings can be supplied which override the
defaults.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rstan_sampling_opts(
  cores = getOption("mc.cores", 1L),
  warmup = 250,
  samples = 2000,
  chains = 4,
  control = list(),
  save_warmup = FALSE,
  seed = as.integer(runif(1, 1, 1e+08)),
  future = FALSE,
  max_execution_time = Inf,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rstan_sampling_opts_+3A_cores">cores</code></td>
<td>
<p>Number of cores to use when executing the chains in parallel,
which defaults to 1 but it is recommended to set the mc.cores option to be
as many processors as the hardware and RAM allow (up to the number of
chains).</p>
</td></tr>
<tr><td><code id="rstan_sampling_opts_+3A_warmup">warmup</code></td>
<td>
<p>Numeric, defaults to 250. Number of warmup samples per chain.</p>
</td></tr>
<tr><td><code id="rstan_sampling_opts_+3A_samples">samples</code></td>
<td>
<p>Numeric, default 2000. Overall number of posterior samples.
When using multiple chains iterations per chain is samples / chains.</p>
</td></tr>
<tr><td><code id="rstan_sampling_opts_+3A_chains">chains</code></td>
<td>
<p>Numeric, defaults to 4. Number of MCMC chains to use.</p>
</td></tr>
<tr><td><code id="rstan_sampling_opts_+3A_control">control</code></td>
<td>
<p>List, defaults to empty. control parameters to pass to
underlying <code>rstan</code> function. By default <code>adapt_delta = 0.95</code> and
<code>max_treedepth = 15</code> though these settings can be overwritten.</p>
</td></tr>
<tr><td><code id="rstan_sampling_opts_+3A_save_warmup">save_warmup</code></td>
<td>
<p>Logical, defaults to FALSE. Should warmup progress be
saved.</p>
</td></tr>
<tr><td><code id="rstan_sampling_opts_+3A_seed">seed</code></td>
<td>
<p>Numeric, defaults uniform random number between 1 and 1e8. Seed
of sampling process.</p>
</td></tr>
<tr><td><code id="rstan_sampling_opts_+3A_future">future</code></td>
<td>
<p>Logical, defaults to <code>FALSE</code>. Should stan chains be run in
parallel using <code>future</code>. This allows users to have chains fail gracefully
(i.e when combined with <code>max_execution_time</code>). Should be combined with a
call to <code>future::plan</code>.</p>
</td></tr>
<tr><td><code id="rstan_sampling_opts_+3A_max_execution_time">max_execution_time</code></td>
<td>
<p>Numeric, defaults to Inf (seconds). If set wil
kill off processing of each chain if not finished within the specified
timeout. When more than 2 chains finish successfully estimates will still be
returned. If less than 2 chains return within the allowed time then
estimation will fail with an informative error.</p>
</td></tr>
<tr><td><code id="rstan_sampling_opts_+3A_...">...</code></td>
<td>
<p>Additional parameters to pass to <code>rstan::sampling</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of arguments to pass to <code>rstan::sampling</code>.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'>rstan_sampling_opts(samples = 2000)
</code></pre>

<hr>
<h2 id='rstan_vb_opts'>Rstan Variational Bayes Options</h2><span id='topic+rstan_vb_opts'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Defines a list specifying the arguments passed to
<code>rstan::vb</code>. Custom settings can be supplied which override the defaults.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rstan_vb_opts(samples = 2000, trials = 10, iter = 10000, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rstan_vb_opts_+3A_samples">samples</code></td>
<td>
<p>Numeric, default 2000. Overall number of approximate posterior
samples.</p>
</td></tr>
<tr><td><code id="rstan_vb_opts_+3A_trials">trials</code></td>
<td>
<p>Numeric, defaults to 10. Number of attempts to use <code>rstan::vb</code>
before failing.</p>
</td></tr>
<tr><td><code id="rstan_vb_opts_+3A_iter">iter</code></td>
<td>
<p>Numeric, defaulting to 10000. Number of iterations to use in
<code>rtan::vb</code>.</p>
</td></tr>
<tr><td><code id="rstan_vb_opts_+3A_...">...</code></td>
<td>
<p>Additional parameters to pass to <code>rstan::vb</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of arguments to pass to <code>rstan::vb</code>.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'>rstan_vb_opts(samples = 1000)
</code></pre>

<hr>
<h2 id='rt_opts'>Time-Varying Reproduction Number Options</h2><span id='topic+rt_opts'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Defines a list specifying the optional arguments for the time-varying
reproduction number. Custom settings can be supplied which override the
defaults.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rt_opts(
  prior = list(mean = 1, sd = 1),
  use_rt = TRUE,
  rw = 0,
  use_breakpoints = TRUE,
  future = "latest",
  gp_on = "R_t-1",
  pop = 0
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rt_opts_+3A_prior">prior</code></td>
<td>
<p>List containing named numeric elements &quot;mean&quot; and &quot;sd&quot;. The
mean and standard deviation of the log normal Rt prior. Defaults to mean of
1 and standard deviation of 1.</p>
</td></tr>
<tr><td><code id="rt_opts_+3A_use_rt">use_rt</code></td>
<td>
<p>Logical, defaults to <code>TRUE</code>. Should Rt be used to generate
infections and hence reported cases.</p>
</td></tr>
<tr><td><code id="rt_opts_+3A_rw">rw</code></td>
<td>
<p>Numeric step size of the random walk, defaults to 0. To specify a
weekly random walk set <code>rw = 7</code>. For more custom break point settings
consider passing in a <code>breakpoints</code> variable as outlined in the next section.</p>
</td></tr>
<tr><td><code id="rt_opts_+3A_use_breakpoints">use_breakpoints</code></td>
<td>
<p>Logical, defaults to <code>TRUE</code>. Should break points be
used if present as a <code>breakpoint</code> variable in the input data. Break points
should be defined as 1 if present and otherwise 0. By default breakpoints
are fit jointly with a global non-parametric effect and so represent a
conservative estimate of break point changes (alter this by setting
<code>gp = NULL</code>).</p>
</td></tr>
<tr><td><code id="rt_opts_+3A_future">future</code></td>
<td>
<p>A character string or integer. This argument indicates how to
set future Rt values. Supported options are to project using the Rt model
(&quot;project&quot;), to use the latest estimate based on partial data (&quot;latest&quot;),
to use the latest estimate based on data that is over 50% complete
(&quot;estimate&quot;). If an integer is supplied then the Rt estimate from this many
days into the future (or past if negative) past will be used forwards in
time.</p>
</td></tr>
<tr><td><code id="rt_opts_+3A_gp_on">gp_on</code></td>
<td>
<p>Character string, defaulting to  &quot;R_t-1&quot;. Indicates how the
Gaussian process, if in use, should be applied to Rt. Currently supported
options are applying the Gaussian process to the last estimated Rt (i.e
Rt = Rt-1 * GP), and applying the Gaussian process to a global mean (i.e Rt
= R0 * GP). Both should produced comparable results when data is not sparse
but the method relying on a global mean will revert to this for real time
estimates, which may not be desirable.</p>
</td></tr>
<tr><td><code id="rt_opts_+3A_pop">pop</code></td>
<td>
<p>Integer, defaults to 0. Susceptible population initially present.
Used to adjust Rt estimates when otherwise fixed based on the proportion of
the population that is susceptible. When set to 0 no population adjustment
is done.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of settings defining the time-varying reproduction number.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'># default settings
rt_opts()

# add a custom length scale
rt_opts(prior = list(mean = 2, sd = 1))

# add a weekly random walk
rt_opts(rw = 7)
</code></pre>

<hr>
<h2 id='run_region'>Run epinow with Regional Processing Code</h2><span id='topic+run_region'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
Internal function that handles calling <code>epinow</code>. Future work will extend this
function to better handle <code>stan</code> logs and allow the user to modify settings
between regions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_region(
  target_region,
  generation_time,
  delays,
  truncation,
  rt,
  backcalc,
  gp,
  obs,
  stan,
  horizon,
  CrIs,
  reported_cases,
  target_folder,
  target_date,
  return_output,
  output,
  complete_logger,
  verbose,
  progress_fn,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="run_region_+3A_target_region">target_region</code></td>
<td>
<p>Character string indicating the region being evaluated</p>
</td></tr>
<tr><td><code id="run_region_+3A_generation_time">generation_time</code></td>
<td>
<p>A call to <code>generation_time_opts()</code> defining the
generation time distribution used. For backwards compatibility a list of
summary parameters can also be passed.</p>
</td></tr>
<tr><td><code id="run_region_+3A_delays">delays</code></td>
<td>
<p>A call to <code>delay_opts()</code> defining delay distributions and
options. See the documentation of <code>delay_opts()</code> and the examples below for
details.</p>
</td></tr>
<tr><td><code id="run_region_+3A_truncation">truncation</code></td>
<td>
<p>A call to <code>trunc_opts()</code> defining the truncation of
observed data.  Defaults to <code>trunc_opts()</code>. See <code>estimate_truncation()</code> for
an approach to estimating truncation from data.</p>
</td></tr>
<tr><td><code id="run_region_+3A_rt">rt</code></td>
<td>
<p>A list of options as generated by <code>rt_opts()</code> defining Rt
estimation. Defaults to <code>rt_opts()</code>. Set to <code>NULL</code> to switch to using back
calculation rather than generating infections using Rt.</p>
</td></tr>
<tr><td><code id="run_region_+3A_backcalc">backcalc</code></td>
<td>
<p>A list of options as generated by <code>backcalc_opts()</code> to
define the back calculation. Defaults to <code>backcalc_opts()</code>.</p>
</td></tr>
<tr><td><code id="run_region_+3A_gp">gp</code></td>
<td>
<p>A list of options as generated by <code>gp_opts()</code> to define the
Gaussian process. Defaults to <code>gp_opts()</code>.Set to NULL to disable the
Gaussian process.</p>
</td></tr>
<tr><td><code id="run_region_+3A_obs">obs</code></td>
<td>
<p>A list of options as generated by <code>obs_opts()</code> defining the
observation model. Defaults to <code>obs_opts()</code>.</p>
</td></tr>
<tr><td><code id="run_region_+3A_stan">stan</code></td>
<td>
<p>A list of stan options as generated by <code>stan_opts()</code>. Defaults
to <code>stan_opts()</code>. Can be used to override <code>data</code>, <code>init</code>, and <code>verbose</code>
settings if desired.</p>
</td></tr>
<tr><td><code id="run_region_+3A_horizon">horizon</code></td>
<td>
<p>Numeric, defaults to 7. Number of days into the future to
forecast.</p>
</td></tr>
<tr><td><code id="run_region_+3A_cris">CrIs</code></td>
<td>
<p>Numeric vector of credible intervals to calculate.</p>
</td></tr>
<tr><td><code id="run_region_+3A_reported_cases">reported_cases</code></td>
<td>
<p>A data frame of confirmed cases (confirm) by date
(date), and region (<code>region</code>).</p>
</td></tr>
<tr><td><code id="run_region_+3A_target_folder">target_folder</code></td>
<td>
<p>Character string specifying where to save results (will
create if not present).</p>
</td></tr>
<tr><td><code id="run_region_+3A_target_date">target_date</code></td>
<td>
<p>Date, defaults to maximum found in the data if not
specified.</p>
</td></tr>
<tr><td><code id="run_region_+3A_return_output">return_output</code></td>
<td>
<p>Logical, defaults to FALSE. Should output be returned,
this automatically updates to TRUE if no directory for saving is specified.</p>
</td></tr>
<tr><td><code id="run_region_+3A_output">output</code></td>
<td>
<p>A character vector of optional output to return. Supported
options are the individual regional estimates (&quot;regions&quot;),  samples
(&quot;samples&quot;), plots (&quot;plots&quot;), copying the individual region dated folder into
a latest folder (if <code>target_folder</code> is not null, set using &quot;latest&quot;), the
stan fit of the underlying model (&quot;fit&quot;), and an overall summary across
regions (&quot;summary&quot;). The default is to return samples and plots alongside
summarised estimates and summary statistics. If <code>target_folder</code> is not NULL
then the default is also to copy all results into a latest folder.</p>
</td></tr>
<tr><td><code id="run_region_+3A_complete_logger">complete_logger</code></td>
<td>
<p>Character string indicating the logger to output
the completion of estimation to.</p>
</td></tr>
<tr><td><code id="run_region_+3A_verbose">verbose</code></td>
<td>
<p>Logical defaults to FALSE. Outputs verbose progress messages
to the console from <code>epinow</code>.</p>
</td></tr>
<tr><td><code id="run_region_+3A_progress_fn">progress_fn</code></td>
<td>
<p>Function as returned by <code>progressr::progressor</code>. Allows
the use of a  progress bar.</p>
</td></tr>
<tr><td><code id="run_region_+3A_...">...</code></td>
<td>
<p>Pass additional arguments to <code>epinow</code>. See the documentation for
<code>epinow</code> for details.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of processed output as produced by <code>process_region</code>
</p>


<h3>See Also</h3>

<p>regional_epinow
</p>

<hr>
<h2 id='sample_approx_dist'>Approximate Sampling a Distribution using Counts</h2><span id='topic+sample_approx_dist'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#soft-deprecated"><img src="../help/figures/lifecycle-soft-deprecated.svg" alt='[Soft-deprecated]' /></a>
Convolves cases by a PMF function. This function will soon be removed or
replaced with a more robust <code>stan</code> implementation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sample_approx_dist(
  cases = NULL,
  dist_fn = NULL,
  max_value = 120,
  earliest_allowed_mapped = NULL,
  direction = "backwards",
  type = "sample",
  truncate_future = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sample_approx_dist_+3A_cases">cases</code></td>
<td>
<p>A dataframe of cases (in date order) with the following
variables: <code>date</code> and <code>cases</code>.</p>
</td></tr>
<tr><td><code id="sample_approx_dist_+3A_dist_fn">dist_fn</code></td>
<td>
<p>Function that takes two arguments with the first being
numeric and the second being logical (and defined as <code>dist</code>). Should return
the probability density or a sample from the defined distribution. See
the examples for more.</p>
</td></tr>
<tr><td><code id="sample_approx_dist_+3A_max_value">max_value</code></td>
<td>
<p>Numeric, maximum value to allow. Defaults to 120 days</p>
</td></tr>
<tr><td><code id="sample_approx_dist_+3A_earliest_allowed_mapped">earliest_allowed_mapped</code></td>
<td>
<p>A character string representing a date
(&quot;2020-01-01&quot;). Indicates the earliest allowed mapped value.</p>
</td></tr>
<tr><td><code id="sample_approx_dist_+3A_direction">direction</code></td>
<td>
<p>Character string, defato &quot;backwards&quot;. Direction in which to
map cases. Supports either &quot;backwards&quot; or &quot;forwards&quot;.</p>
</td></tr>
<tr><td><code id="sample_approx_dist_+3A_type">type</code></td>
<td>
<p>Character string indicating the method to use to transform
counts. Supports either &quot;sample&quot;  which approximates sampling or &quot;median&quot;
would shift by the median of the distribution.</p>
</td></tr>
<tr><td><code id="sample_approx_dist_+3A_truncate_future">truncate_future</code></td>
<td>
<p>Logical, should cases be truncated if they occur
after the first date reported in the data. Defaults to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.table</code> of cases by date of onset
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cases &lt;- example_confirmed
cases &lt;- cases[, cases := as.integer(confirm)]
print(cases)

# total cases
sum(cases$cases)

delay_fn &lt;- function(n, dist, cum) {
  if (dist) {
    pgamma(n + 0.9999, 2, 1) - pgamma(n - 1e-5, 2, 1)
  } else {
    as.integer(rgamma(n, 2, 1))
  }
}

onsets &lt;- sample_approx_dist(
  cases = cases,
  dist_fn = delay_fn
)

# estimated onset distribution
print(onsets)

# check that sum is equal to reported cases
total_onsets &lt;- median(
  purrr::map_dbl(
    1:10,
    ~ sum(sample_approx_dist(
      cases = cases,
      dist_fn = delay_fn
    )$cases)
  )
)
total_onsets


# map from onset cases to reported
reports &lt;- sample_approx_dist(
  cases = cases,
  dist_fn = delay_fn,
  direction = "forwards"
)


# map from onset cases to reported using a mean shift
reports &lt;- sample_approx_dist(
  cases = cases,
  dist_fn = delay_fn,
  direction = "forwards",
  type = "median"
)

</code></pre>

<hr>
<h2 id='save_estimate_infections'>Save Estimated Infections</h2><span id='topic+save_estimate_infections'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Saves output from <code>estimate_infections</code> to a target directory.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>save_estimate_infections(
  estimates,
  target_folder = NULL,
  samples = TRUE,
  return_fit = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="save_estimate_infections_+3A_estimates">estimates</code></td>
<td>
<p>List of data frames as output by <code>estimate_infections</code></p>
</td></tr>
<tr><td><code id="save_estimate_infections_+3A_target_folder">target_folder</code></td>
<td>
<p>Character string specifying where to save results (will
create if not present).</p>
</td></tr>
<tr><td><code id="save_estimate_infections_+3A_samples">samples</code></td>
<td>
<p>Logical, defaults to TRUE. Should samples be saved</p>
</td></tr>
<tr><td><code id="save_estimate_infections_+3A_return_fit">return_fit</code></td>
<td>
<p>Logical, defaults to TRUE. Should the fit stan object
be returned.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>See Also</h3>

<p>estimate_infections
</p>

<hr>
<h2 id='save_input'>Save Observed Data</h2><span id='topic+save_input'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Saves observed data to a target location if given.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>save_input(reported_cases, target_folder)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="save_input_+3A_reported_cases">reported_cases</code></td>
<td>
<p>A data frame of confirmed cases (confirm) by date
(date). confirm must be integer and date must be in date format.</p>
</td></tr>
<tr><td><code id="save_input_+3A_target_folder">target_folder</code></td>
<td>
<p>Character string specifying where to save results (will
create if not present).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='secondary_opts'>Secondary Reports Options</h2><span id='topic+secondary_opts'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Returns a list of options defining the secondary model used in
<code>estimate_secondary()</code>. This model is a combination of a convolution of
previously observed primary reports combined with current primary reports
(either additive or subtractive). It can optionally be cumulative. See the
documentation of <code>type</code> for sensible options to cover most use cases and the
returned values of <code><a href="#topic+secondary_opts">secondary_opts()</a></code> for all currently supported options.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>secondary_opts(type = "incidence", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="secondary_opts_+3A_type">type</code></td>
<td>
<p>A character string indicating the type of observation the
secondary reports are. Options include:
</p>

<ul>
<li><p> &quot;incidence&quot;: Assumes that secondary reports equal a convolution of
previously observed primary reported cases. An example application is deaths
from an infectious disease predicted by reported cases of that disease (or
estimated infections).
</p>
</li>
<li><p> &quot;prevalence&quot;: Assumes that secondary reports are cumulative and are
defined by currently observed primary reports minus a convolution of
secondary reports. An example application is hospital bed usage predicted by
hospital admissions.
</p>
</li></ul>
</td></tr>
<tr><td><code id="secondary_opts_+3A_...">...</code></td>
<td>
<p>Overwrite options defined by type. See the returned values for all
options that can be passed.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of binary options summarising secondary model used in
<code>estimate_secondary()</code>. Options returned are <code>cumulative</code> (should the
secondary report be cumulative), <code>historic</code> (should a convolution of primary
reported cases be used to predict secondary reported cases),
<code>primary_hist_additive</code> (should the historic convolution of primary reported
cases be additive or subtractive), <code>current</code> (should currently observed
primary reported cases contribute to current secondary reported cases),
<code>primary_current_additive</code> (should current primary reported cases be
additive or subtractive).
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>See Also</h3>

<p>estimate_secondary
</p>


<h3>Examples</h3>

<pre><code class='language-R'># incidence model
secondary_opts("incidence")

# prevalence model
secondary_opts("prevalence")
</code></pre>

<hr>
<h2 id='set_dt_single_thread'>Set to Single Threading</h2><span id='topic+set_dt_single_thread'></span>

<h3>Description</h3>

<p>This function sets the threads used by data.table to 1 in the parent function
and then restores the initial data.table threads when the function exits.
This is primarily used as an internal function inside of other functions
and will generally not be used on its own.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_dt_single_thread()
</code></pre>


<h3>Value</h3>

<p>an environment in the parent frame named &quot;dt_settings&quot;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data.table::setDTthreads(2)
test_function &lt;- function() {
  set_dt_single_thread()

  print(data.table::getDTthreads())
}
test_function()
data.table::getDTthreads()

</code></pre>

<hr>
<h2 id='setup_default_logging'>Setup Default Logging</h2><span id='topic+setup_default_logging'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#questioning"><img src="../help/figures/lifecycle-questioning.svg" alt='[Questioning]' /></a>
Sets up default logging. Usage of logging is currently being explored as the
current setup cannot log stan errors or progress.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>setup_default_logging(
  logs = tempdir(check = TRUE),
  mirror_epinow = FALSE,
  target_date = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="setup_default_logging_+3A_logs">logs</code></td>
<td>
<p>Character path indicating the target folder in which to store log
information. Defaults to the temporary directory if not specified. Default
logging can be disabled if <code>logs</code> is set to NULL. If specifying a custom
logging setup then the code for <code>setup_default_logging</code> and the
<code>setup_logging</code> function are a sensible place to start.</p>
</td></tr>
<tr><td><code id="setup_default_logging_+3A_mirror_epinow">mirror_epinow</code></td>
<td>
<p>Logical, defaults to FALSE. Should internal logging be
returned from <code>epinow</code> to the console.</p>
</td></tr>
<tr><td><code id="setup_default_logging_+3A_target_date">target_date</code></td>
<td>
<p>Date, defaults to maximum found in the data if not
specified.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects
</p>


<h3>Examples</h3>

<pre><code class='language-R'>setup_default_logging()
</code></pre>

<hr>
<h2 id='setup_dt'>Convert to Data Table</h2><span id='topic+setup_dt'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Convenience function that sets the number of <code>data.table</code> cores to 1 and
maps input to be a <code>data.table</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>setup_dt(reported_cases)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="setup_dt_+3A_reported_cases">reported_cases</code></td>
<td>
<p>A data frame of confirmed cases (confirm) by date
(date). confirm must be integer and date must be in date format.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data table
</p>

<hr>
<h2 id='setup_future'>Set up Future Backend</h2><span id='topic+setup_future'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
A utility function that aims to streamline the set up
of the required future backend with sensible defaults for most users of
<code>regional_epinow</code>. More advanced users are recommended to setup their own
<code>future</code> backend based on their available resources.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>setup_future(
  reported_cases,
  strategies = c("multisession", "multisession"),
  min_cores_per_worker = 4
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="setup_future_+3A_reported_cases">reported_cases</code></td>
<td>
<p>A data frame of confirmed cases (confirm) by date
(date), and region (<code>region</code>).</p>
</td></tr>
<tr><td><code id="setup_future_+3A_strategies">strategies</code></td>
<td>
<p>A vector length 1 to 2 of strategies to pass to
<code>future::plan</code>. Nesting of parallelisation is from the top level down.
The default is to set up nesting parallelisation with both using
<code>future::multisession</code> (<code>future::multicore</code> will likely be a faster option on
supported platforms). For single level parallelisation use a single strategy
or <code>future::plan</code> directly. See <code>?future::plan</code> for options.</p>
</td></tr>
<tr><td><code id="setup_future_+3A_min_cores_per_worker">min_cores_per_worker</code></td>
<td>
<p>Numeric, the minimum number of cores per worker.
Defaults to 4 which assumes 4 MCMC chains are in use per region.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric number of cores to use per worker. If greater than 1 pass to
<code>stan_args = list(cores = "output from setup future")</code> or use
<code>future = TRUE</code>. If only a single strategy is used then nothing is returned.
</p>

<hr>
<h2 id='setup_logging'>Setup Logging</h2><span id='topic+setup_logging'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#questioning"><img src="../help/figures/lifecycle-questioning.svg" alt='[Questioning]' /></a>
Sets up <code>futile.logger</code> logging, which is integrated into <code>EpiNow2</code>. See the
documentation for <code>futile.logger</code> for full details. By default <code>EpiNow2</code>
prints all logs at the &quot;INFO&quot; level and returns them to the console. Usage
of logging is currently being explored as the current setup cannot log stan
errors or progress.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>setup_logging(
  threshold = "INFO",
  file = NULL,
  mirror_to_console = FALSE,
  name = "EpiNow2"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="setup_logging_+3A_threshold">threshold</code></td>
<td>
<p>Character string indicating the logging level see
(?futile.logger for details of the available options). Defaults to &quot;INFO&quot;.</p>
</td></tr>
<tr><td><code id="setup_logging_+3A_file">file</code></td>
<td>
<p>Character string indicating the path to save logs to. By default
logs will be written to the console.</p>
</td></tr>
<tr><td><code id="setup_logging_+3A_mirror_to_console">mirror_to_console</code></td>
<td>
<p>Logical, defaults to <code>FALSE</code>. If saving logs to a
file should they also be duplicated in the console.</p>
</td></tr>
<tr><td><code id="setup_logging_+3A_name">name</code></td>
<td>
<p>Character string defaulting to EpiNow2. This indicates the name
of the logger to setup. The default logger for EpiNow2 is called EpiNow2.
Nested options include: Epinow2.epinow which controls all logging for
<code>epinow</code> and nested functions, EpiNow2.epinow.estimate_infections (logging in
<code>estimate_infections</code>), and EpiNow2.epinow.estimate_infections.fit (logging
in fitting functions).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing
</p>

<hr>
<h2 id='setup_target_folder'>Setup Target Folder for Saving</h2><span id='topic+setup_target_folder'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Sets up a folders for saving results
</p>


<h3>Usage</h3>

<pre><code class='language-R'>setup_target_folder(target_folder = NULL, target_date)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="setup_target_folder_+3A_target_folder">target_folder</code></td>
<td>
<p>Character string specifying where to save results (will
create if not present).</p>
</td></tr>
<tr><td><code id="setup_target_folder_+3A_target_date">target_date</code></td>
<td>
<p>Date, defaults to maximum found in the data if not
specified.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the path to the dated folder and the latest folder
</p>

<hr>
<h2 id='simulate_infections'>Simulate infections using a given trajectory of the time-varying
reproduction number</h2><span id='topic+simulate_infections'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
This function simulates infections using an existing fit to observed cases
but with a modified time-varying reproduction number. This can be used to
explore forecast models or past counterfactuals. Simulations can be run in
parallel using <code>future::plan</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate_infections(
  estimates,
  R = NULL,
  model = NULL,
  samples = NULL,
  batch_size = 10,
  verbose = interactive()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simulate_infections_+3A_estimates">estimates</code></td>
<td>
<p>The <code>estimates</code> element of an <code>epinow</code> run that
has been done with output = &quot;fit&quot;, or the result of
<code>estimate_infections</code> with <code>return_fit</code> set to TRUE.</p>
</td></tr>
<tr><td><code id="simulate_infections_+3A_r">R</code></td>
<td>
<p>A numeric vector of reproduction numbers; these will overwrite the
reproduction numbers contained in <code>estimates</code>, except elements set to
NA. Alternatively accepts a data.frame containing at least <code>date</code> and <code>value</code>
(integer) variables and optionally <code>sample</code>. More (or fewer) days than in
the original fit can be simulated.</p>
</td></tr>
<tr><td><code id="simulate_infections_+3A_model">model</code></td>
<td>
<p>A compiled stan model as returned by <code>rstan::stan_model</code>.</p>
</td></tr>
<tr><td><code id="simulate_infections_+3A_samples">samples</code></td>
<td>
<p>Numeric, number of posterior samples to simulate from. The
default is to use all samples in the <code>estimates</code> input.</p>
</td></tr>
<tr><td><code id="simulate_infections_+3A_batch_size">batch_size</code></td>
<td>
<p>Numeric, defaults to 10. Size of batches in which to
simulate. May decrease run times due to reduced IO costs but this is still
being evaluated. If set to NULL then al simulations are done at once.</p>
</td></tr>
<tr><td><code id="simulate_infections_+3A_verbose">verbose</code></td>
<td>
<p>Logical defaults to <code>interactive()</code>. Should a progress bar
(from <code>progressr</code>) be shown.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of output as returned by <code><a href="#topic+estimate_infections">estimate_infections()</a></code> but based on
results from the specified scenario rather than fitting.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# set number of cores to use
old_opts &lt;- options()
options(mc.cores = ifelse(interactive(), 4, 1))

# get example case counts
reported_cases &lt;- example_confirmed[1:50]

# set up example generation time
generation_time &lt;- get_generation_time(
 disease = "SARS-CoV-2", source = "ganyani"
)
# set delays between infection and case report
incubation_period &lt;- get_incubation_period(
 disease = "SARS-CoV-2", source = "lauer"
)
reporting_delay &lt;- dist_spec(
  mean = convert_to_logmean(2, 1), mean_sd = 0.1,
  sd = convert_to_logsd(2, 1), sd_sd = 0.1, max = 15
)

# fit model to data to recover Rt estimates
est &lt;- estimate_infections(reported_cases,
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period + reporting_delay),
  rt = rt_opts(prior = list(mean = 2, sd = 0.1), rw = 7),
  stan = stan_opts(control = list(adapt_delta = 0.9)),
  obs = obs_opts(scale = list(mean = 0.1, sd = 0.01)),
  gp = NULL, horizon = 0
)

# update Rt trajectory and simulate new infections using it
R &lt;- c(rep(NA_real_, 26), rep(0.5, 10), rep(0.8, 7))
sims &lt;- simulate_infections(est, R)
plot(sims)

# with a data.frame input of samples
R_dt &lt;- data.frame(
  date = seq(
    min(summary(est, type = "parameters", param = "R")$date),
    by = "day", length.out = length(R)
  ),
  value = R
)
sims &lt;- simulate_infections(est, R_dt)
plot(sims)

#' # with a data.frame input of samples
R_samples &lt;- summary(est, type = "samples", param = "R")
R_samples &lt;- R_samples[,
 .(date, sample, value)][sample &lt;= 1000][date &lt;= "2020-04-10"
]
R_samples &lt;- R_samples[date &gt;= "2020-04-01", value := 1.1]
sims &lt;- simulate_infections(est, R_samples)
plot(sims)

options(old_opts)

</code></pre>

<hr>
<h2 id='simulate_secondary'>Simulate a secondary observation</h2><span id='topic+simulate_secondary'></span>

<h3>Description</h3>

<p>Simulate a secondary observation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate_secondary(
  data,
  type = "incidence",
  family = "poisson",
  delay_max = 30,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simulate_secondary_+3A_data">data</code></td>
<td>
<p>A data frame containing the <code>date</code> of report and <code>primary</code>
cases as a numeric vector.</p>
</td></tr>
<tr><td><code id="simulate_secondary_+3A_type">type</code></td>
<td>
<p>A character string indicating the type of observation the
secondary reports are. Options include:
</p>

<ul>
<li><p> &quot;incidence&quot;: Assumes that secondary reports equal a convolution of
previously observed primary reported cases. An example application is deaths
from an infectious disease predicted by reported cases of that disease (or
estimated infections).
</p>
</li>
<li><p> &quot;prevalence&quot;: Assumes that secondary reports are cumulative and are
defined by currently observed primary reports minus a convolution of
secondary reports. An example application is hospital bed usage predicted by
hospital admissions.
</p>
</li></ul>
</td></tr>
<tr><td><code id="simulate_secondary_+3A_family">family</code></td>
<td>
<p>Character string defining the observation model. Options are
Negative binomial (&quot;negbin&quot;), the default, Poisson (&quot;poisson&quot;), and &quot;none&quot;
meaning the expectation is returned.</p>
</td></tr>
<tr><td><code id="simulate_secondary_+3A_delay_max">delay_max</code></td>
<td>
<p>Integer, defaulting to 30 days. The maximum delay used in
the convolution model.</p>
</td></tr>
<tr><td><code id="simulate_secondary_+3A_...">...</code></td>
<td>
<p>Additional parameters to pass to the observation model (i.e
<code>rnbinom</code> or <code>rpois</code>).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame containing simulated data in the format required by
<code><a href="#topic+estimate_secondary">estimate_secondary()</a></code>.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>
<p>Sebastian Funk
</p>


<h3>See Also</h3>

<p>estimate_secondary
</p>


<h3>Examples</h3>

<pre><code class='language-R'># load data.table for manipulation
library(data.table)

#### Incidence data example ####

# make some example secondary incidence data
cases &lt;- example_confirmed
cases &lt;- as.data.table(cases)[, primary := confirm]

# Assume that only 40 percent of cases are reported
cases[, scaling := 0.4]

# Parameters of the assumed log normal delay distribution
cases[, meanlog := 1.8][, sdlog := 0.5]

# Simulate secondary cases
cases &lt;- simulate_secondary(cases, type = "incidence")
cases
#### Prevalence data example ####

# make some example prevalence data
cases &lt;- example_confirmed
cases &lt;- as.data.table(cases)[, primary := confirm]

# Assume that only 30 percent of cases are reported
cases[, scaling := 0.3]

# Parameters of the assumed log normal delay distribution
cases[, meanlog := 1.6][, sdlog := 0.8]

# Simulate secondary cases
cases &lt;- simulate_secondary(cases, type = "prevalence")
cases
</code></pre>

<hr>
<h2 id='stan_opts'>Stan Options</h2><span id='topic+stan_opts'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Defines a list specifying the arguments passed to underlying stan
backend functions via <code>rstan_sampling_opts()</code> and <code>rstan_vb_opts()</code>. Custom
settings can be supplied which override the defaults.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stan_opts(
  samples = 2000,
  backend = "rstan",
  init_fit = NULL,
  return_fit = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stan_opts_+3A_samples">samples</code></td>
<td>
<p>Numeric, default 2000. Overall number of posterior samples.
When using multiple chains iterations per chain is samples / chains.</p>
</td></tr>
<tr><td><code id="stan_opts_+3A_backend">backend</code></td>
<td>
<p>Character string indicating the backend to use for fitting
stan models. Currently only &quot;rstan&quot; is supported.</p>
</td></tr>
<tr><td><code id="stan_opts_+3A_init_fit">init_fit</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
Character string or <code>stanfit</code> object, defaults to NULL. Should an initial
fit be used to initialise the full fit. An example scenario would be using a
national level fit to parametrise regional level fits. Optionally a
character string can be passed with the currently supported option being
&quot;cumulative&quot;. This fits the model to cumulative cases and may be useful for
certain data sets where the sampler gets stuck or struggles to initialise.
See <code>init_cumulative_fit()</code> for details.
</p>
<p>This implementation is based on the approach taken in
<a href="https://github.com/ImperialCollegeLondon/epidemia/">epidemia</a> authored by
James Scott.</p>
</td></tr>
<tr><td><code id="stan_opts_+3A_return_fit">return_fit</code></td>
<td>
<p>Logical, defaults to TRUE. Should the fit stan model be
returned.</p>
</td></tr>
<tr><td><code id="stan_opts_+3A_...">...</code></td>
<td>
<p>Additional parameters to pass  underlying option functions.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of arguments to pass to the appropriate rstan functions.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>See Also</h3>

<p>rstan_opts
</p>


<h3>Examples</h3>

<pre><code class='language-R'># using default of rstan::sampling
stan_opts(samples = 1000)

# using vb
stan_opts(method = "vb")
</code></pre>

<hr>
<h2 id='summarise_key_measures'>Summarise rt and cases</h2><span id='topic+summarise_key_measures'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt='[Maturing]' /></a>
Produces summarised data frames of output across regions. Used internally by
<code>regional_summary</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>summarise_key_measures(
  regional_results = NULL,
  results_dir = NULL,
  summary_dir = NULL,
  type = "region",
  date = "latest"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summarise_key_measures_+3A_regional_results">regional_results</code></td>
<td>
<p>A list of dataframes as produced by
<code>get_regional_results</code></p>
</td></tr>
<tr><td><code id="summarise_key_measures_+3A_results_dir">results_dir</code></td>
<td>
<p>Character string indicating the directory from which to
extract results.</p>
</td></tr>
<tr><td><code id="summarise_key_measures_+3A_summary_dir">summary_dir</code></td>
<td>
<p>Character string the directory into which to save results
as a csv.</p>
</td></tr>
<tr><td><code id="summarise_key_measures_+3A_type">type</code></td>
<td>
<p>Character string, the region identifier to apply (defaults to
region).</p>
</td></tr>
<tr><td><code id="summarise_key_measures_+3A_date">date</code></td>
<td>
<p>A Character string (in the format &quot;yyyy-mm-dd&quot;) indicating the
date to extract data for. Defaults to &quot;latest&quot; which finds the latest
results available.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of summarised Rt, cases by date of infection and cases by
date of report
</p>


<h3>See Also</h3>

<p>regional_summary
</p>

<hr>
<h2 id='summarise_results'>Summarise Real-time Results</h2><span id='topic+summarise_results'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#questioning"><img src="../help/figures/lifecycle-questioning.svg" alt='[Questioning]' /></a>
Used internally by <code>regional_summary</code> to produce a summary table of results.
May be streamlined in later releases.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>summarise_results(
  regions,
  summaries = NULL,
  results_dir = NULL,
  target_date = NULL,
  region_scale = "Region"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summarise_results_+3A_regions">regions</code></td>
<td>
<p>An character string containing the list of regions to extract
results for (must all have results for the same target date).</p>
</td></tr>
<tr><td><code id="summarise_results_+3A_summaries">summaries</code></td>
<td>
<p>A list of summary data frames as output by <code>epinow</code></p>
</td></tr>
<tr><td><code id="summarise_results_+3A_results_dir">results_dir</code></td>
<td>
<p>An optional character string indicating the location of
the results directory to extract results from.</p>
</td></tr>
<tr><td><code id="summarise_results_+3A_target_date">target_date</code></td>
<td>
<p>A character string indicating the target date to extract
results for. All regions must have results
for this date.</p>
</td></tr>
<tr><td><code id="summarise_results_+3A_region_scale">region_scale</code></td>
<td>
<p>A character string indicating the name to give the
regions being summarised.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of summary data
</p>

<hr>
<h2 id='summary.epinow'>Summary output from epinow</h2><span id='topic+summary.epinow'></span><span id='topic+summary'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
<code>summary</code> method for class &quot;epinow&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'epinow'
summary(object, output = "estimates", date = NULL, params = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.epinow_+3A_object">object</code></td>
<td>
<p>A list of output as produced by &quot;epinow&quot;.</p>
</td></tr>
<tr><td><code id="summary.epinow_+3A_output">output</code></td>
<td>
<p>A character string of output to summarise. Defaults to
&quot;estimates&quot; but also supports &quot;forecast&quot;, and &quot;estimated_reported_cases&quot;.</p>
</td></tr>
<tr><td><code id="summary.epinow_+3A_date">date</code></td>
<td>
<p>A date in the form &quot;yyyy-mm-dd&quot; to inspect estimates for.</p>
</td></tr>
<tr><td><code id="summary.epinow_+3A_params">params</code></td>
<td>
<p>A character vector of parameters to filter for.</p>
</td></tr>
<tr><td><code id="summary.epinow_+3A_...">...</code></td>
<td>
<p>Pass additional summary arguments to lower level methods</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a data frame of summary output
</p>


<h3>See Also</h3>

<p>summary.estimate_infections epinow
</p>

<hr>
<h2 id='summary.estimate_infections'>Summary output from estimate_infections</h2><span id='topic+summary.estimate_infections'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
<code>summary</code> method for class &quot;estimate_infections&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'estimate_infections'
summary(object, type = "snapshot", date = NULL, params = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.estimate_infections_+3A_object">object</code></td>
<td>
<p>A list of output as produced by &quot;estimate_infections&quot;.</p>
</td></tr>
<tr><td><code id="summary.estimate_infections_+3A_type">type</code></td>
<td>
<p>A character vector of data types to return. Defaults to
&quot;snapshot&quot; but also supports &quot;parameters&quot;, and &quot;samples&quot;. &quot;snapshot&quot; return
a summary at a given date (by default the latest date informed by data).
&quot;parameters&quot; returns summarised parameter estimates that can be further
filtered using <code>params</code> to show just the parameters of interest and date.
&quot;samples&quot; similarly returns posterior
samples.</p>
</td></tr>
<tr><td><code id="summary.estimate_infections_+3A_date">date</code></td>
<td>
<p>A date in the form &quot;yyyy-mm-dd&quot; to inspect estimates for.</p>
</td></tr>
<tr><td><code id="summary.estimate_infections_+3A_params">params</code></td>
<td>
<p>A character vector of parameters to filter for.</p>
</td></tr>
<tr><td><code id="summary.estimate_infections_+3A_...">...</code></td>
<td>
<p>Pass additional arguments to <code>report_summary</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a data frame of summary output
</p>


<h3>See Also</h3>

<p>summary estimate_infections report_summary
</p>

<hr>
<h2 id='trunc_opts'>Truncation Distribution Options</h2><span id='topic+trunc_opts'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Returns a truncation distribution formatted for usage by
downstream functions. See <code>estimate_truncation()</code> for an approach to
estimate these distributions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trunc_opts(dist = dist_spec())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trunc_opts_+3A_dist">dist</code></td>
<td>
<p>A delay distribution or series of delay distributions reflecting
the truncation generated using <code><a href="#topic+dist_spec">dist_spec()</a></code> or <code><a href="#topic+estimate_truncation">estimate_truncation()</a></code>.
Default is an empty call to <code><a href="#topic+dist_spec">dist_spec()</a></code>, i.e. no truncation</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list summarising the input truncation distribution.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>
<p>Sebastian Funk
</p>


<h3>See Also</h3>

<p>convert_to_logmean convert_to_logsd bootstrapped_dist_fit dist_spec
</p>


<h3>Examples</h3>

<pre><code class='language-R'># no truncation
trunc_opts()

# truncation dist
trunc_opts(dist = dist_spec(mean = 3, sd = 2, max = 10))
</code></pre>

<hr>
<h2 id='tune_inv_gamma'>Tune an Inverse Gamma to Achieve the Target Truncation</h2><span id='topic+tune_inv_gamma'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
Allows an inverse gamma distribution to be. tuned so that less than 0.01 of
its probability mass function falls outside of the specified bounds. This is
required when using an inverse gamma prior, for example for a Gaussian
process. As no inverse gamma priors are currently in use and this function
has some stability issues it has been deprecated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tune_inv_gamma(lower = 2, upper = 21)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tune_inv_gamma_+3A_lower">lower</code></td>
<td>
<p>Numeric, defaults to 2. Lower truncation bound.</p>
</td></tr>
<tr><td><code id="tune_inv_gamma_+3A_upper">upper</code></td>
<td>
<p>Numeric, defaults to 21. Upper truncation bound.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of alpha and beta values that describe a inverse gamma
distribution that achieves the target truncation.
</p>

<hr>
<h2 id='update_horizon'>Updates Forecast Horizon Based on Input Data and Target</h2><span id='topic+update_horizon'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Makes sure that a forecast is returned for the user specified time period
beyond the target date.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>update_horizon(horizon, target_date, reported_cases)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="update_horizon_+3A_horizon">horizon</code></td>
<td>
<p>Numeric, defaults to 7. Number of days into the future to
forecast.</p>
</td></tr>
<tr><td><code id="update_horizon_+3A_target_date">target_date</code></td>
<td>
<p>Date, defaults to maximum found in the data if not
specified.</p>
</td></tr>
<tr><td><code id="update_horizon_+3A_reported_cases">reported_cases</code></td>
<td>
<p>A data frame of confirmed cases (confirm) by date
(date). confirm must be integer and date must be in date format.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric forecast horizon adjusted for the users intention
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>

<hr>
<h2 id='update_list'>Update a List</h2><span id='topic+update_list'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
Used to handle updating settings in a list. For example when making
changes to <code>opts_list</code> output.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>update_list(defaults = list(), optional = list())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="update_list_+3A_defaults">defaults</code></td>
<td>
<p>A list of default settings</p>
</td></tr>
<tr><td><code id="update_list_+3A_optional">optional</code></td>
<td>
<p>A list of optional settings to override defaults</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list
</p>

<hr>
<h2 id='update_secondary_args'>Update estimate_secondary default priors</h2><span id='topic+update_secondary_args'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
This functions allows the user to more easily specify data driven or model
based priors for <code>estimate_secondary()</code> from example from previous model fits
using a <code>data.frame</code> to overwrite other default settings. Note that default
settings are still required.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>update_secondary_args(data, priors, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="update_secondary_args_+3A_data">data</code></td>
<td>
<p>A list of data and arguments as returned by <code>create_stan_data()</code>.</p>
</td></tr>
<tr><td><code id="update_secondary_args_+3A_priors">priors</code></td>
<td>
<p>A <code>data.frame</code> of named priors to be used in model fitting
rather than the defaults supplied from other arguments. This is typically
useful if wanting to inform a estimate from the posterior of another model
fit. Priors that are currently use to update the defaults are the scaling
fraction (&quot;frac_obs&quot;), the mean delay (&quot;delay_mean&quot;), and standard deviation
of the delay (&quot;delay_sd&quot;). The <code>data.frame</code> should have the following
variables: <code>variable</code>, <code>mean</code>, and <code>sd</code>.</p>
</td></tr>
<tr><td><code id="update_secondary_args_+3A_verbose">verbose</code></td>
<td>
<p>Logical, defaults to <code>FALSE</code>. Should verbose progress
messages be returned.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list as produced by <code>create_stan_data()</code>.
</p>


<h3>Author(s)</h3>

<p>Sam Abbott
</p>


<h3>Examples</h3>

<pre><code class='language-R'>priors &lt;- data.frame(variable = "frac_obs", mean = 3, sd = 1)
data &lt;- list(obs_scale_mean = 4, obs_scale_sd = 3)
update_secondary_args(data, priors)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
