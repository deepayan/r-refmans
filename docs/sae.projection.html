<!DOCTYPE html><html lang="en"><head><title>Help for package sae.projection</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {sae.projection}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#df_susenas_mar2020'><p>df_susenas_mar2020: Maret 2020 National Socio-Economic Survey (Susenas) Dataset for DKI Jakarta, Indonesia</p></a></li>
<li><a href='#df_susenas_sep2020'><p>df_susenas_sep2020: September 2020 National Socio-Economic Survey (Susenas) Dataset for DKI Jakarta, Indonesia</p></a></li>
<li><a href='#df_svy22'><p>df_svy22: August 2022 National Labor Force Survey Dataset for East Java, Indonesia.</p></a></li>
<li><a href='#df_svy23'><p>df_svy23: August 2023 National Labor Force Survey Dataset for East Java, Indonesia.</p></a></li>
<li><a href='#proj_random_forest'><p>proj_random_forest</p></a></li>
<li><a href='#projection'><p>Projection Estimator</p></a></li>
<li><a href='#projection_rf'><p>projection_rf Function</p></a></li>
<li><a href='#projection_rf_CorrectedBias'><p>projection_rf_CorrectedBias</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Small Area Estimation Using Model-Assisted Projection Method</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.2</td>
</tr>
<tr>
<td>Description:</td>
<td>Combines information from two independent surveys using a model-assisted projection method. Designed for survey sampling scenarios where a large sample collects only auxiliary information (Survey 1) and a smaller sample provides data on both variables of interest and auxiliary variables (Survey 2). Implements a working model to generate synthetic values of the variable of interest by fitting the model to Survey 2 data and predicting values for Survey 1 based on its auxiliary variables (Kim &amp; Rao, 2012) &lt;<a href="https://doi.org/10.1093%2Fbiomet%2Fasr063">doi:10.1093/biomet/asr063</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/Alfrzlp/sae.projection">https://github.com/Alfrzlp/sae.projection</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/Alfrzlp/sae.projection/issues">https://github.com/Alfrzlp/sae.projection/issues</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>cli, doParallel, dplyr, methods, parsnip, recipes, rlang,
rsample, stats, survey, tune, workflows, yardstick, bonsai,
ranger, lightgbm, caret, randomForest, themis</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.3.0), tidymodels</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-02-17 15:39:25 UTC; Administrator</td>
</tr>
<tr>
<td>Author:</td>
<td>Ridson Al Farizal P
    <a href="https://orcid.org/0000-0003-0617-0214"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre,
    cph],
  Azka Ubaidillah <a href="https://orcid.org/0000-0002-3597-0459"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Silvi Ajeng Larasati [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Ridson Al Farizal P &lt;ridsonalfarizal15@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-02-18 08:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='df_susenas_mar2020'>df_susenas_mar2020: Maret 2020 National Socio-Economic Survey (Susenas) Dataset for DKI Jakarta, Indonesia</h2><span id='topic+df_susenas_mar2020'></span>

<h3>Description</h3>

<p>A dataset from the March 2020 National Socio-Economic Survey (Susenas) KOR Module, conducted in DKI Jakarta, Indonesia, which is held annually, presented at the regency level.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>df_susenas_mar2020
</code></pre>


<h3>Format</h3>

<p>A data frame with 18842 rows and 38 variables with 6 domains.
</p>

<dl>
<dt>year</dt><dd><p>Year the survey was conducted</p>
</dd>
<dt>psu</dt><dd><p>Primary Sampling Unit (PSU)</p>
</dd>
<dt>ssu</dt><dd><p>Secondary Sampling Unit (SSU)</p>
</dd>
<dt>strata</dt><dd><p>Strata used for sampling</p>
</dd>
<dt>ID</dt><dd><p>Unique identifier for each respondent</p>
</dd>
<dt>no_sample</dt><dd><p>Sample number</p>
</dd>
<dt>no_household</dt><dd><p>Household number</p>
</dd>
<dt>no_member</dt><dd><p>Household member number</p>
</dd>
<dt>weight</dt><dd><p>Weight from survey</p>
</dd>
<dt>province</dt><dd><p>Province code</p>
</dd>
<dt>regency</dt><dd><p>Regency or municipality code</p>
</dd>
<dt>urban_rural</dt><dd><p>Urban or rural classification (1: Urban, 2: Rural)</p>
</dd>
<dt>marital_status</dt><dd><p>Marital status (1: Married, 0: Other)</p>
</dd>
<dt>sex</dt><dd><p>Sex (1: Male, 2: Female)</p>
</dd>
<dt>age</dt><dd><p>Age of the respondent</p>
</dd>
<dt>attending_school</dt><dd><p>Currently attending school (0: No, 1: Yes)</p>
</dd>
<dt>highest_edu</dt><dd><p>Highest education completed (0: Did not complete elementary school, 1: Elementary school, 2: Junior high school, 3: Senior high school, 4: University/College)</p>
</dd>
<dt>job_status</dt><dd><p>Employment status (1: Employed, 0: Not employed)</p>
</dd>
<dt>sector_type</dt><dd><p>Type of employment sector (1: Agriculture, 0: Non-agriculture)</p>
</dd>
<dt>job_position</dt><dd><p>Job position or role</p>
</dd>
<dt>building_ownership</dt><dd><p>Ownership status of residence (1: Owned, 0: Other)</p>
</dd>
<dt>floor_area</dt><dd><p>Floor area of residence (in square meters)</p>
</dd>
<dt>pension_ins</dt><dd><p>Has pension insurance (0: No, 1: Yes)</p>
</dd>
<dt>old_age_ins</dt><dd><p>Has old-age insurance (0: No, 1: Yes)</p>
</dd>
<dt>work_ins</dt><dd><p>Has work insurance (0: No, 1: Yes)</p>
</dd>
<dt>life_ins</dt><dd><p>Has life insurance (0: No, 1: Yes)</p>
</dd>
<dt>severance_pay</dt><dd><p>Receives severance pay (0: No, 1: Yes)</p>
</dd>
<dt>kks_card</dt><dd><p>Has a KKS (Kartu Keluarga Sejahtera) card (0: No, 1: Yes)</p>
</dd>
<dt>pkh_recipient</dt><dd><p>Is the respondent a recipient of PKH (Program Keluarga Harapan) assistance? (0: No, 1: Yes)</p>
</dd>
<dt>pkh_disbursement</dt><dd><p>Location where PKH funds are disbursed</p>
</dd>
<dt>pkh_food</dt><dd><p>PKH funds used for food assistance (0: No, 1: Yes)</p>
</dd>
<dt>pkh_housing</dt><dd><p>PKH funds used for housing assistance (0: No, 1: Yes)</p>
</dd>
<dt>pkh_healthcare</dt><dd><p>PKH funds used for healthcare assistance (0: No, 1: Yes)</p>
</dd>
<dt>pkh_maternity</dt><dd><p>PKH funds used for maternity assistance (0: No, 1: Yes)</p>
</dd>
<dt>pkh_school</dt><dd><p>PKH funds used for school assistance (0: No, 1: Yes)</p>
</dd>
<dt>pkh_other</dt><dd><p>PKH funds used for other types of assistance (0: No, 1: Yes)</p>
</dd>
<dt>bpnt_program</dt><dd><p>Receives BPNT (Bantuan Pangan Non-Tunai) program assistance (0: No, 1: Yes)</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://www.bps.go.id">https://www.bps.go.id</a>
</p>

<hr>
<h2 id='df_susenas_sep2020'>df_susenas_sep2020: September 2020 National Socio-Economic Survey (Susenas) Dataset for DKI Jakarta, Indonesia</h2><span id='topic+df_susenas_sep2020'></span>

<h3>Description</h3>

<p>A dataset from the September 2020 National Socio-Economic Survey (Susenas) Social Resilience Module, conducted in DKI Jakarta, Indonesia, which is held every three years, presented at the provincial level.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>df_susenas_sep2020
</code></pre>


<h3>Format</h3>

<p>A data frame with 3655 rows and 33 variables with 6 domains.
</p>

<dl>
<dt>ID</dt><dd><p>Unique identifier for each respondent</p>
</dd>
<dt>no_sample</dt><dd><p>Sample number</p>
</dd>
<dt>no_household</dt><dd><p>Household number</p>
</dd>
<dt>no_member</dt><dd><p>Household member number</p>
</dd>
<dt>weight</dt><dd><p>Weight from survey</p>
</dd>
<dt>province</dt><dd><p>Province code</p>
</dd>
<dt>urban_rural</dt><dd><p>Urban or rural classification (1: Urban, 2: Rural)</p>
</dd>
<dt>marital_status</dt><dd><p>Marital status (1: Married, 0: Other)</p>
</dd>
<dt>sex</dt><dd><p>Sex (1: Male, 2: Female)</p>
</dd>
<dt>age</dt><dd><p>Age of the respondent</p>
</dd>
<dt>attending_school</dt><dd><p>Currently attending school (0: No, 1: Yes)</p>
</dd>
<dt>highest_edu</dt><dd><p>Highest education completed (0: Did not complete elementary school, 1: Elementary school, 2: Junior high school, 3: Senior high school, 4: University/College)</p>
</dd>
<dt>job_status</dt><dd><p>Employment status (1: Employed, 0: Not employed)</p>
</dd>
<dt>sector_type</dt><dd><p>Type of employment sector (1: Agriculture, 0: Non-agriculture)</p>
</dd>
<dt>job_position</dt><dd><p>Job position or role</p>
</dd>
<dt>building_ownership</dt><dd><p>Ownership status of residence (1: Owned, 0: Other)</p>
</dd>
<dt>floor_area</dt><dd><p>Floor area of residence (in square meters)</p>
</dd>
<dt>pension_ins</dt><dd><p>Has pension insurance (0: No, 1: Yes)</p>
</dd>
<dt>old_age_ins</dt><dd><p>Has old-age insurance (0: No, 1: Yes)</p>
</dd>
<dt>work_ins</dt><dd><p>Has work insurance (0: No, 1: Yes)</p>
</dd>
<dt>life_ins</dt><dd><p>Has life insurance (0: No, 1: Yes)</p>
</dd>
<dt>severance_pay</dt><dd><p>Receives severance pay (0: No, 1: Yes)</p>
</dd>
<dt>kks_card</dt><dd><p>Has a KKS (Kartu Keluarga Sejahtera) card (0: No, 1: Yes)</p>
</dd>
<dt>pkh_recipient</dt><dd><p>Is the respondent a recipient of PKH (Program Keluarga Harapan) assistance? (0: No, 1: Yes)</p>
</dd>
<dt>pkh_disbursement</dt><dd><p>Location where PKH funds are disbursed</p>
</dd>
<dt>pkh_food</dt><dd><p>PKH funds used for food assistance (0: No, 1: Yes)</p>
</dd>
<dt>pkh_housing</dt><dd><p>PKH funds used for housing assistance (0: No, 1: Yes)</p>
</dd>
<dt>pkh_healthcare</dt><dd><p>PKH funds used for healthcare assistance (0: No, 1: Yes)</p>
</dd>
<dt>pkh_maternity</dt><dd><p>PKH funds used for maternity assistance (0: No, 1: Yes)</p>
</dd>
<dt>pkh_school</dt><dd><p>PKH funds used for school assistance (0: No, 1: Yes)</p>
</dd>
<dt>pkh_other</dt><dd><p>PKH funds used for other types of assistance (0: No, 1: Yes)</p>
</dd>
<dt>bpnt_program</dt><dd><p>Receives BPNT (Bantuan Pangan Non-Tunai) program assistance (0: No, 1: Yes)</p>
</dd>
<dt>uses_public_transport</dt><dd><p>Using public transportation (0: No, 1: Yes), which includes motorized vehicles with specific routes</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://www.bps.go.id">https://www.bps.go.id</a>
</p>

<hr>
<h2 id='df_svy22'>df_svy22: August 2022 National Labor Force Survey Dataset for East Java, Indonesia.</h2><span id='topic+df_svy22'></span>

<h3>Description</h3>

<p>A dataset from the August 2022 National Labor Force Survey (Sakernas) conducted in East Java, Indonesia.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>df_svy22
</code></pre>


<h3>Format</h3>

<p>A data frame with 74.070 rows and 11 variables with 38 domains.
</p>

<dl>
<dt>PSU</dt><dd><p>Primary Sampling Unit</p>
</dd>
<dt>WEIGHT</dt><dd><p>Weight from survey</p>
</dd>
<dt>PROV</dt><dd><p>province code</p>
</dd>
<dt>REGENCY</dt><dd><p>regency/municipality code</p>
</dd>
<dt>STRATA</dt><dd><p>Strata</p>
</dd>
<dt>income</dt><dd><p>Income</p>
</dd>
<dt>neet</dt><dd><p>Not in education employment or training status</p>
</dd>
<dt>sex</dt><dd><p>sex (1: male, 2: female)</p>
</dd>
<dt>age</dt><dd><p>age</p>
</dd>
<dt>disability</dt><dd><p>disability status (0: False, 1: True)</p>
</dd>
<dt>edu</dt><dd><p>last completed education</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://www.bps.go.id">https://www.bps.go.id</a>
</p>

<hr>
<h2 id='df_svy23'>df_svy23: August 2023 National Labor Force Survey Dataset for East Java, Indonesia.</h2><span id='topic+df_svy23'></span>

<h3>Description</h3>

<p>A dataset from the August 2023 National Labor Force Survey (Sakernas) conducted in East Java, Indonesia.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>df_svy23
</code></pre>


<h3>Format</h3>

<p>A data frame with 66.245 rows and 11 variables with 38 domains.
</p>

<dl>
<dt>PSU</dt><dd><p>Primary Sampling Unit</p>
</dd>
<dt>WEIGHT</dt><dd><p>Weight from survey</p>
</dd>
<dt>PROV</dt><dd><p>province code</p>
</dd>
<dt>REGENCY</dt><dd><p>regency/municipality code</p>
</dd>
<dt>STRATA</dt><dd><p>Strata</p>
</dd>
<dt>income</dt><dd><p>Income</p>
</dd>
<dt>neet</dt><dd><p>Not in education employment or training status</p>
</dd>
<dt>sex</dt><dd><p>sex (1: male, 2: female)</p>
</dd>
<dt>age</dt><dd><p>age</p>
</dd>
<dt>disability</dt><dd><p>disability status (0: False, 1: True)</p>
</dd>
<dt>edu</dt><dd><p>last completed education</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://www.bps.go.id">https://www.bps.go.id</a>
</p>

<hr>
<h2 id='proj_random_forest'>proj_random_forest</h2><span id='topic+proj_random_forest'></span>

<h3>Description</h3>

<p><strong>Kim and Rao (2012)</strong>, the synthetic data obtained through the model-assisted projection method can provide a useful tool for
efficient domain estimation when the size of the sample in survey 2 is much larger than the size of sample in survey 1.
</p>
<p>This function projects estimated values from a small survey onto an independent large survey using the random forest algorithm.
The two surveys are statistically independent, but the projection relies on shared auxiliary variables.
The process includes data preprocessing, feature selection, model training, and domain-specific estimation based on survey design principles.
The function automatically selects standard estimation or bias-corrected estimation based on the parameter <code>bias_correction</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>proj_random_forest(
  data_model,
  target_column,
  predictor_cols,
  data_proj,
  domain1,
  domain2,
  psu,
  ssu,
  strata,
  weights,
  split_ratio = 0.8,
  metric = "Accuracy",
  bias_correction = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="proj_random_forest_+3A_data_model">data_model</code></td>
<td>
<p>The training dataset, consisting of auxiliary variables and the target variable.</p>
</td></tr>
<tr><td><code id="proj_random_forest_+3A_target_column">target_column</code></td>
<td>
<p>The name of the target column in the <code>data_model</code>.</p>
</td></tr>
<tr><td><code id="proj_random_forest_+3A_predictor_cols">predictor_cols</code></td>
<td>
<p>A vector of predictor column names.</p>
</td></tr>
<tr><td><code id="proj_random_forest_+3A_data_proj">data_proj</code></td>
<td>
<p>The data for projection (prediction), which needs to be projected using the trained model. It must contain the same auxiliary variables as the <code>data_model</code></p>
</td></tr>
<tr><td><code id="proj_random_forest_+3A_domain1">domain1</code></td>
<td>
<p>Domain variables for survey estimation (e.g., &quot;province&quot;)</p>
</td></tr>
<tr><td><code id="proj_random_forest_+3A_domain2">domain2</code></td>
<td>
<p>Domain variables for survey estimation (e.g., &quot;regency&quot;)</p>
</td></tr>
<tr><td><code id="proj_random_forest_+3A_psu">psu</code></td>
<td>
<p>Primary sampling units, representing the structure of the sampling frame.</p>
</td></tr>
<tr><td><code id="proj_random_forest_+3A_ssu">ssu</code></td>
<td>
<p>Secondary sampling units, representing the structure of the sampling frame.</p>
</td></tr>
<tr><td><code id="proj_random_forest_+3A_strata">strata</code></td>
<td>
<p>Stratification variable, ensuring that specific subgroups are represented.</p>
</td></tr>
<tr><td><code id="proj_random_forest_+3A_weights">weights</code></td>
<td>
<p>Weights used in the for direct estimation from <code>data_model</code> and indirect estimation from <code>data_proj</code>.</p>
</td></tr>
<tr><td><code id="proj_random_forest_+3A_split_ratio">split_ratio</code></td>
<td>
<p>Proportion of data used for training (default is 0.8, meaning 80 percent for training and 20 percent for validation).</p>
</td></tr>
<tr><td><code id="proj_random_forest_+3A_metric">metric</code></td>
<td>
<p>The metric used for model evaluation (default is Accuracy, other options include &quot;AUC&quot;, &quot;F1&quot;, etc.).</p>
</td></tr>
<tr><td><code id="proj_random_forest_+3A_bias_correction">bias_correction</code></td>
<td>
<p>Logical; if <code>TRUE</code>, applies bias correction using <code>projection_rf_CorrectedBias</code>. Default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The output of either <code>projection_rf</code> or <code>projection_rf_CorrectedBias</code>, depending on <code>bias_correction</code>.
</p>


<h3>References</h3>


<ol>
<li><p> Kim, J. K., &amp; Rao, J. N. (2012). Combining data from two independent surveys: a model-assisted approach. Biometrika, 99(1), 85-100.
</p>
</li></ol>



<h3>Examples</h3>

<pre><code class='language-R'>
library(survey)
library(caret)
library(dplyr)

df_susenas_sep2020 &lt;- df_susenas_sep2020 %&gt;%
left_join(df_susenas_mar2020 %&gt;% select(psu, ssu, strata, no_sample, no_household),
          by = c('no_sample', 'no_household'),
          multiple = 'any'
)

df_sep20 &lt;- df_susenas_sep2020
df_mar20 &lt;- df_susenas_mar2020
x_predictors &lt;- df_sep20 %&gt;% select(7:32) %&gt;% names()

# Run projection_random_forest without bias correction
result_standard &lt;- proj_random_forest(
                          data_model = df_sep20,
                          target_column = "uses_public_transport",
                          predictor_cols = x_predictors,
                          data_proj = df_mar20,
                          domain1 = "province",
                          domain2 = "regency",
                          psu = "psu",
                          ssu = "ssu",
                          strata = "strata",
                          weights = "weight",
                          metric = "Accuracy",
                          bias_correction = FALSE)
print(result_standard)

# Run projection_random_forest with bias correction
result_bias_corrected &lt;- proj_random_forest(
                          data_model = df_sep20,
                          target_column = "uses_public_transport",
                          predictor_cols = x_predictors,
                          data_proj = df_mar20,
                          domain1 = "province",
                          domain2 = "regency",
                          psu = "psu",
                          ssu = "ssu",
                          strata = "strata",
                          weights = "weight",
                          metric = "Accuracy",
                          bias_correction = TRUE)
print(result_bias_corrected)

</code></pre>

<hr>
<h2 id='projection'>Projection Estimator</h2><span id='topic+projection'></span>

<h3>Description</h3>

<p>The function addresses the problem of combining information from two or more independent surveys, a common challenge in survey sampling. It focuses on cases where: <br />
</p>

<ul>
<li> <p><strong>Survey 1:</strong> A large sample collects only auxiliary information.
</p>
</li>
<li> <p><strong>Survey 2:</strong> A much smaller sample collects both the variables of interest and the auxiliary variables.
</p>
</li></ul>

<p>The function implements a model-assisted projection estimation method based on a working model. The working models that can be used include several machine learning models that can be seen in the details section
</p>


<h3>Usage</h3>

<pre><code class='language-R'>projection(
  formula,
  id,
  weight,
  strata = NULL,
  domain,
  fun = "mean",
  model,
  data_model,
  data_proj,
  model_metric,
  kfold = 3,
  grid = 10,
  parallel_over = "resamples",
  seed = 1,
  est_y = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="projection_+3A_formula">formula</code></td>
<td>
<p>An object of class formula that contains a description of the model to be fitted. The variables included in the formula must be contained in the <code>data_model</code> dan <code>data_proj</code>.</p>
</td></tr>
<tr><td><code id="projection_+3A_id">id</code></td>
<td>
<p>Column name specifying cluster ids from the largest level to the smallest level, where ~0 or ~1 represents a formula indicating the absence of clusters.</p>
</td></tr>
<tr><td><code id="projection_+3A_weight">weight</code></td>
<td>
<p>Column name in data_proj representing the survey weight.</p>
</td></tr>
<tr><td><code id="projection_+3A_strata">strata</code></td>
<td>
<p>Column name specifying strata, use NULL for no strata</p>
</td></tr>
<tr><td><code id="projection_+3A_domain">domain</code></td>
<td>
<p>Column names in data_model and data_proj representing specific domains for which disaggregated data needs to be produced.</p>
</td></tr>
<tr><td><code id="projection_+3A_fun">fun</code></td>
<td>
<p>A function taking a formula and survey design object as its first two arguments (default = &quot;mean&quot;, &quot;total&quot;, &quot;varians&quot;).</p>
</td></tr>
<tr><td><code id="projection_+3A_model">model</code></td>
<td>
<p>The working model to be used in the projection estimator. Refer to the details for the available working models.</p>
</td></tr>
<tr><td><code id="projection_+3A_data_model">data_model</code></td>
<td>
<p>A data frame or a data frame extension (e.g., a tibble) representing the second survey, characterized by a much smaller sample, provides information on both the variable of interest and the auxiliary variables.</p>
</td></tr>
<tr><td><code id="projection_+3A_data_proj">data_proj</code></td>
<td>
<p>A data frame or a data frame extension (e.g., a tibble) representing the first survey, characterized by a large sample that collects only auxiliary information or general-purpose variables.</p>
</td></tr>
<tr><td><code id="projection_+3A_model_metric">model_metric</code></td>
<td>
<p>A yardstick::metric_set(), or NULL to compute a standard set of metrics (rmse for regression and f1-score for classification).</p>
</td></tr>
<tr><td><code id="projection_+3A_kfold">kfold</code></td>
<td>
<p>The number of partitions of the data set (k-fold cross validation).</p>
</td></tr>
<tr><td><code id="projection_+3A_grid">grid</code></td>
<td>
<p>A data frame of tuning combinations or a positive integer. The data frame should have columns for each parameter being tuned and rows for tuning parameter candidates. An integer denotes the number of candidate parameter sets to be created automatically.</p>
</td></tr>
<tr><td><code id="projection_+3A_parallel_over">parallel_over</code></td>
<td>
<p>A single string containing either &quot;resamples&quot; or &quot;everything&quot; describing how to use parallel processing. Alternatively, NULL is allowed, which chooses between &quot;resamples&quot; and &quot;everything&quot; automatically.
If &quot;resamples&quot;, then tuning will be performed in parallel over resamples alone. Within each resample, the preprocessor (i.e. recipe or formula) is processed once, and is then reused across all models that need to be fit.
If &quot;everything&quot;, then tuning will be performed in parallel at two levels. An outer parallel loop will iterate over resamples. Additionally, an inner parallel loop will iterate over all unique combinations of preprocessor and model tuning parameters for that specific resample. This will result in the preprocessor being re-processed multiple times, but can be faster if that processing is extremely fast.</p>
</td></tr>
<tr><td><code id="projection_+3A_seed">seed</code></td>
<td>
<p>A single value, interpreted as an integer</p>
</td></tr>
<tr><td><code id="projection_+3A_est_y">est_y</code></td>
<td>
<p>A logical value indicating whether to return the estimation of <code>y</code> in <code>data_model</code>. If <code>TRUE</code>, the estimation is returned; otherwise, it is not.</p>
</td></tr>
<tr><td><code id="projection_+3A_...">...</code></td>
<td>
<p>Further argument to the <code><a href="survey.html#topic+svydesign">svydesign</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The available working models include:
</p>

<ul>
<li><p> Linear Regression <code>linear_reg()</code>
</p>
</li>
<li><p> Logistic Regression <code>logistic_reg()</code>
</p>
</li>
<li><p> Poisson Regression <code>poisson_reg()</code>
</p>
</li>
<li><p> Decision Tree <code>decision_tree()</code>
</p>
</li>
<li><p> KNN <code>nearest_neighbor()</code>
</p>
</li>
<li><p> Naive Bayes <code>naive_bayes()</code>
</p>
</li>
<li><p> Multi Layer Perceptron <code>mlp()</code>
</p>
</li>
<li><p> Random Forest <code>rand_forest()</code>
</p>
</li>
<li><p> Accelerated Oblique Random Forests (Jaeger et al. 2022, Jaeger et al. 2024) <code>rand_forest(engine = 'aorsf')</code>
</p>
</li>
<li><p> XGBoost <code>boost_tree(engine = 'xgboost')</code>
</p>
</li>
<li><p> LightGBM <code>boost_tree(engine = 'lightgbm')</code>
</p>
</li></ul>

<p>A complete list of models can be seen at the following link <a href="https://www.tmwr.org/pre-proc-table">Tidy Modeling With R</a>
</p>


<h3>Value</h3>

<p>The function returns a list with the following objects (<code>model</code>, <code>prediction</code> and <code>df_result</code>):
<code>model</code> The working model used in the projection.
<code>prediction</code> A vector containing the prediction results from the working model.
<code>df_result</code> A data frame with the following columns:
</p>

<ul>
<li> <p><code>domain</code> The name of the domain.
</p>
</li>
<li> <p><code>ypr</code> The estimation results of the projection for each domain.
</p>
</li>
<li> <p><code>var_ypr</code> The sample variance of the projection estimator for each domain.
</p>
</li>
<li> <p><code>rse_ypr</code> The Relative Standard Error (RSE) in percentage (%).
</p>
</li></ul>



<h3>References</h3>


<ol>
<li><p> Kim, J. K., &amp; Rao, J. N. (2012). Combining data from two independent surveys: a model-assisted approach. Biometrika, 99(1), 85-100.
</p>
</li></ol>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(sae.projection)
library(dplyr)
library(bonsai)

df_svy22_income &lt;- df_svy22 %&gt;% filter(!is.na(income))
df_svy23_income &lt;- df_svy23 %&gt;% filter(!is.na(income))

# Linear regression
lm_proj &lt;- projection(
  income ~ age + sex + edu + disability,
  id = "PSU", weight = "WEIGHT", strata = "STRATA",
  domain = c("PROV", "REGENCY"),
  model = linear_reg(),
  data_model = df_svy22_income,
  data_proj = df_svy23_income,
  nest = TRUE
)

# Random forest regression with hyperparameter tunning
rf_proj &lt;- projection(
  income ~ age + sex + edu + disability,
  id = "PSU", weight = "WEIGHT", strata = "STRATA",
  domain = c("PROV", "REGENCY"),
  model = rand_forest(mtry = tune(), trees = tune(), min_n = tune()),
  data_model = df_svy22_income,
  data_proj = df_svy23_income,
  kfold = 3,
  grid = 10,
  nest = TRUE
)

df_svy22_neet &lt;- df_svy22 %&gt;% filter(between(age, 15, 24))
df_svy23_neet &lt;- df_svy23 %&gt;% filter(between(age, 15, 24))

# Logistic regression
lr_proj &lt;- projection(
  formula = neet ~ sex + edu + disability,
  id = ~ PSU,
  weight = ~ WEIGHT,
  strata = ~ STRATA,
  domain = ~ PROV + REGENCY,
  model = logistic_reg(),
  data_model = df_svy22_neet,
  data_proj = df_svy23_neet,
  nest = TRUE
)

# LightGBM regression with hyperparameter tunning
show_engines("boost_tree")
lgbm_model &lt;- boost_tree(
  mtry = tune(), trees = tune(), min_n = tune(),
  tree_depth = tune(), learn_rate = tune(),
  engine = "lightgbm"
)

lgbm_proj &lt;- projection(
  formula = neet ~ sex + edu + disability,
  id = "PSU",
  weight = "WEIGHT",
  strata = "STRATA",
  domain = c("PROV", "REGENCY"),
  model = lgbm_model,
  data_model = df_svy22_neet,
  data_proj = df_svy23_neet,
  kfold = 3,
  grid = 10,
  nest = TRUE
)

## End(Not run)
</code></pre>

<hr>
<h2 id='projection_rf'>projection_rf Function</h2><span id='topic+projection_rf'></span>

<h3>Description</h3>

<p>This function trains a random forest model and performs domain-level estimation **without bias correction**.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>projection_rf(
  data_model,
  target_column,
  predictor_cols,
  data_proj,
  domain1,
  domain2,
  psu,
  ssu,
  strata,
  weights,
  split_ratio = 0.8,
  metric = "Accuracy"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="projection_rf_+3A_data_model">data_model</code></td>
<td>
<p>The training dataset, consisting of auxiliary variables and the target variable.</p>
</td></tr>
<tr><td><code id="projection_rf_+3A_target_column">target_column</code></td>
<td>
<p>The name of the target column in the <code>data_model</code>.</p>
</td></tr>
<tr><td><code id="projection_rf_+3A_predictor_cols">predictor_cols</code></td>
<td>
<p>A vector of predictor column names.</p>
</td></tr>
<tr><td><code id="projection_rf_+3A_data_proj">data_proj</code></td>
<td>
<p>The data for projection (prediction), which needs to be projected using the trained model. It must contain the same auxiliary variables as the <code>data_model</code></p>
</td></tr>
<tr><td><code id="projection_rf_+3A_domain1">domain1</code></td>
<td>
<p>Domain variables for survey estimation (e.g., &quot;province&quot;)</p>
</td></tr>
<tr><td><code id="projection_rf_+3A_domain2">domain2</code></td>
<td>
<p>Domain variables for survey estimation (e.g., &quot;regency&quot;)</p>
</td></tr>
<tr><td><code id="projection_rf_+3A_psu">psu</code></td>
<td>
<p>Primary sampling units, representing the structure of the sampling frame.</p>
</td></tr>
<tr><td><code id="projection_rf_+3A_ssu">ssu</code></td>
<td>
<p>Secondary sampling units, representing the structure of the sampling frame.</p>
</td></tr>
<tr><td><code id="projection_rf_+3A_strata">strata</code></td>
<td>
<p>Stratification variable, ensuring that specific subgroups are represented.</p>
</td></tr>
<tr><td><code id="projection_rf_+3A_weights">weights</code></td>
<td>
<p>Weights used in the for direct estimation from <code>data_model</code> and indirect estimation from <code>data_proj</code>.</p>
</td></tr>
<tr><td><code id="projection_rf_+3A_split_ratio">split_ratio</code></td>
<td>
<p>Proportion of data used for training (default is 0.8, meaning 80 percent for training and 20 percent for validation).</p>
</td></tr>
<tr><td><code id="projection_rf_+3A_metric">metric</code></td>
<td>
<p>The metric used for model evaluation (default is Accuracy, other options include &quot;AUC&quot;, &quot;F1&quot;, etc.).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following elements:
</p>

<ul>
<li> <p><code>model</code> The trained Random Forest model.
</p>
</li>
<li> <p><code>importance</code> Feature importance showing which features contributed most to the model’s predictions.
</p>
</li>
<li> <p><code>train_accuracy</code> Accuracy of the model on the training set.
</p>
</li>
<li> <p><code>validation_accuracy</code> Accuracy of the model on the validation set.
</p>
</li>
<li> <p><code>validation_performance</code> Confusion matrix for the validation set, showing performance metrics like accuracy, precision, recall, etc.
</p>
</li>
<li> <p><code>data_proj</code> The projection data with predicted values.
</p>
</li>
<li> <p><code>Domain1</code> Estimations for Domain 1, including estimated values, variance, and relative standard error.
</p>
</li>
<li> <p><code>Domain2</code> Estimations for Domain 2, including estimated values, variance, and relative standard error.
</p>
</li></ul>


<hr>
<h2 id='projection_rf_CorrectedBias'>projection_rf_CorrectedBias</h2><span id='topic+projection_rf_CorrectedBias'></span>

<h3>Description</h3>

<p>This function extends <code>projection_rf</code> by incorporating **bias correction** for better domain-level estimation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>projection_rf_CorrectedBias(
  data_model,
  target_column,
  predictor_cols,
  data_proj,
  domain1,
  domain2,
  psu,
  ssu,
  strata,
  weights,
  split_ratio = 0.8,
  metric = "Accuracy"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="projection_rf_CorrectedBias_+3A_data_model">data_model</code></td>
<td>
<p>The training dataset, consisting of auxiliary variables and the target variable.</p>
</td></tr>
<tr><td><code id="projection_rf_CorrectedBias_+3A_target_column">target_column</code></td>
<td>
<p>The name of the target column in the <code>data_model</code>.</p>
</td></tr>
<tr><td><code id="projection_rf_CorrectedBias_+3A_predictor_cols">predictor_cols</code></td>
<td>
<p>A vector of predictor column names.</p>
</td></tr>
<tr><td><code id="projection_rf_CorrectedBias_+3A_data_proj">data_proj</code></td>
<td>
<p>The data for projection (prediction), which needs to be projected using the trained model. It must contain the same auxiliary variables as the <code>data_model</code></p>
</td></tr>
<tr><td><code id="projection_rf_CorrectedBias_+3A_domain1">domain1</code></td>
<td>
<p>Domain variables for survey estimation (e.g., &quot;province&quot;)</p>
</td></tr>
<tr><td><code id="projection_rf_CorrectedBias_+3A_domain2">domain2</code></td>
<td>
<p>Domain variables for survey estimation (e.g., &quot;regency&quot;)</p>
</td></tr>
<tr><td><code id="projection_rf_CorrectedBias_+3A_psu">psu</code></td>
<td>
<p>Primary sampling units, representing the structure of the sampling frame.</p>
</td></tr>
<tr><td><code id="projection_rf_CorrectedBias_+3A_ssu">ssu</code></td>
<td>
<p>Secondary sampling units, representing the structure of the sampling frame.</p>
</td></tr>
<tr><td><code id="projection_rf_CorrectedBias_+3A_strata">strata</code></td>
<td>
<p>Stratification variable, ensuring that specific subgroups are represented.</p>
</td></tr>
<tr><td><code id="projection_rf_CorrectedBias_+3A_weights">weights</code></td>
<td>
<p>Weights used in the for direct estimation from <code>data_model</code> and indirect estimation from <code>data_proj</code>.</p>
</td></tr>
<tr><td><code id="projection_rf_CorrectedBias_+3A_split_ratio">split_ratio</code></td>
<td>
<p>Proportion of data used for training (default is 0.8, meaning 80 percent for training and 20 percent for validation).</p>
</td></tr>
<tr><td><code id="projection_rf_CorrectedBias_+3A_metric">metric</code></td>
<td>
<p>The metric used for model evaluation (default is Accuracy, other options include &quot;AUC&quot;, &quot;F1&quot;, etc.).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following elements:
</p>

<ul>
<li> <p><code>model</code> The trained Random Forest model.
</p>
</li>
<li> <p><code>importance</code> Feature importance showing which features contributed most to the model’s predictions.
</p>
</li>
<li> <p><code>train_accuracy</code> Accuracy of the model on the training set.
</p>
</li>
<li> <p><code>validation_accuracy</code> Accuracy of the model on the validation set.
</p>
</li>
<li> <p><code>validation_performance</code> Confusion matrix for the validation set, showing performance metrics like accuracy, precision, recall, etc.
</p>
</li>
<li> <p><code>data_proj</code> The projection data with predicted values.
</p>
</li>
<li> <p><code>Direct</code> Direct estimations for Domain 1, including estimated values, variance, and relative standard error.
</p>
</li>
<li> <p><code>Domain1_corrected_bias</code> Bias-corrected estimations for Domain 1, including estimated values, variance, and relative standard error.
</p>
</li>
<li> <p><code>Domain2_corrected_bias</code> Bias-corrected estimations for Domain 2, including estimated values, variance, and relative standard error.
</p>
</li></ul>


</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
