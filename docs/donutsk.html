<!DOCTYPE html><html><head><title>Help for package donutsk</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {donutsk}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#donutsk-package'><p>donutsk: Construct Advanced Donut Charts</p></a></li>
<li><a href='#donut_geom'><p>Create pie or donut chart</p></a></li>
<li><a href='#donut_label'><p>Create pie or donut label and text annotations</p></a></li>
<li><a href='#GDP'><p>The World Bank GDP, PPP (current international $)</p></a></li>
<li><a href='#layouts'><p>The set of layout functions is designed to effectively display text and labels</p></a></li>
<li><a href='#packing'><p>Arrange data to distribute small values</p></a></li>
<li><a href='#pins'><p>Connecting labels with donut segments</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Construct Advanced Donut Charts</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Build donut/pie charts with 'ggplot2' layer by layer, exploiting the advantages of polar symmetry. Leverage layouts to distribute labels effectively. Connect labels to donut segments using pins. Streamline annotation and highlighting.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/dkibalnikov/donutsk">https://github.com/dkibalnikov/donutsk</a>,
<a href="https://dkibalnikov.github.io/donutsk/">https://dkibalnikov.github.io/donutsk/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/dkibalnikov/donutsk/issues">https://github.com/dkibalnikov/donutsk/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>ggplot2 (&ge; 3.5.0), R (&ge; 4.2.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr (&ge; 1.1.2), glue (&ge; 1.6.2), rlang (&ge; 1.1.1)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, scales (&ge; 1.3.0), stringr (&ge; 1.5.0),
testthat (&ge; 3.0.0), tidyr (&ge; 1.3.0)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-04-21 10:42:22 UTC; Dmitrii_Kibalnikov</td>
</tr>
<tr>
<td>Author:</td>
<td>Dmitry Kibalnikov [aut, cre, cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Dmitry Kibalnikov &lt;d.kibalnikov@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-04-22 18:50:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='donutsk-package'>donutsk: Construct Advanced Donut Charts</h2><span id='topic+donutsk'></span><span id='topic+donutsk-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Build donut/pie charts with 'ggplot2' layer by layer, exploiting the advantages of polar symmetry. Leverage layouts to distribute labels effectively. Connect labels to donut segments using pins. Streamline annotation and highlighting.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Dmitry Kibalnikov <a href="mailto:d.kibalnikov@gmail.com">d.kibalnikov@gmail.com</a> [copyright holder]
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/dkibalnikov/donutsk">https://github.com/dkibalnikov/donutsk</a>
</p>
</li>
<li> <p><a href="https://dkibalnikov.github.io/donutsk/">https://dkibalnikov.github.io/donutsk/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/dkibalnikov/donutsk/issues">https://github.com/dkibalnikov/donutsk/issues</a>
</p>
</li></ul>


<hr>
<h2 id='donut_geom'>Create pie or donut chart</h2><span id='topic+donut_geom'></span><span id='topic+StatDonutInt'></span><span id='topic+geom_donut_int0'></span><span id='topic+StatDonutIntHl'></span><span id='topic+geom_donut_int_hl'></span><span id='topic+geom_donut_int'></span><span id='topic+StatDonutExt'></span><span id='topic+geom_donut_ext0'></span><span id='topic+StatDonutExtHl'></span><span id='topic+geom_donut_ext_hl'></span><span id='topic+geom_donut_ext'></span>

<h3>Description</h3>

<p>Create pie or donut charts while retaining ggplot flexibility, such as leveraging faceting and palettes, and fine-tuning appearance
</p>

<ul>
<li><p> The function <code>geom_donut_int()</code> creates visually <strong>internal</strong> donut layer as aggregation of passed values
</p>
</li>
<li><p> The function <code>geom_donut_ext()</code> creates visually <strong>external</strong> donut layer of passed values
</p>
</li>
<li> <p><code>geom_donut_int0()</code> and <code>geom_donut_ext()</code> are generic geoms not supporting highlight feature
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>geom_donut_int0(
  mapping = NULL,
  data = NULL,
  stat = "donut_int",
  position = "identity",
  na.rm = FALSE,
  show.legend = NA,
  inherit.aes = TRUE,
  r_int = 0,
  r_ext = 1,
  hl_shift = 0.1,
  ...
)

geom_donut_int(..., hl_col = "firebrick")

geom_donut_ext0(
  mapping = NULL,
  data = NULL,
  stat = "donut_ext",
  position = "identity",
  na.rm = FALSE,
  show.legend = NA,
  inherit.aes = TRUE,
  r_int = 1.5,
  r_ext = 2,
  hl_shift = 0.1,
  ...
)

geom_donut_ext(..., hl_col = "firebrick")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="donut_geom_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code>. If specified and
<code>inherit.aes = TRUE</code> (the default), it is combined with the default mapping
at the top level of the plot. You must supply <code>mapping</code> if there is no plot
mapping.</p>
</td></tr>
<tr><td><code id="donut_geom_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame</code>, and
will be used as the layer data. A <code>function</code> can be created
from a <code>formula</code> (e.g. <code>~ head(.x, 10)</code>).</p>
</td></tr>
<tr><td><code id="donut_geom_+3A_stat">stat</code></td>
<td>
<p>The statistical transformation to use on the data for this
layer, either as a <code>ggproto</code> <code>Geom</code> subclass or as a string naming the
stat stripped of the <code>stat_</code> prefix (e.g. <code>"count"</code> rather than
<code>"stat_count"</code>)</p>
</td></tr>
<tr><td><code id="donut_geom_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string naming the adjustment
(e.g. <code>"jitter"</code> to use <code>position_jitter</code>), or the result of a call to a
position adjustment function. Use the latter if you need to change the
settings of the adjustment.</p>
</td></tr>
<tr><td><code id="donut_geom_+3A_na.rm">na.rm</code></td>
<td>
<p>If <code>FALSE</code>, the default, missing values are removed with
a warning. If <code>TRUE</code>, missing values are silently removed.</p>
</td></tr>
<tr><td><code id="donut_geom_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="donut_geom_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</td></tr>
<tr><td><code id="donut_geom_+3A_r_int">r_int</code></td>
<td>
<p>Internal donut radius</p>
</td></tr>
<tr><td><code id="donut_geom_+3A_r_ext">r_ext</code></td>
<td>
<p>External pie or donut radius</p>
</td></tr>
<tr><td><code id="donut_geom_+3A_hl_shift">hl_shift</code></td>
<td>
<p>Sets the spacing to show highlighted segments</p>
</td></tr>
<tr><td><code id="donut_geom_+3A_...">...</code></td>
<td>
<p>Other arguments passed on to <code><a href="ggplot2.html#topic+layer">layer()</a></code>. These are
often aesthetics, used to set an aesthetic to a fixed value, like
<code>colour = "red"</code> or <code>size = 3</code>. They may also be parameters
to the paired geom/stat.</p>
</td></tr>
<tr><td><code id="donut_geom_+3A_hl_col">hl_col</code></td>
<td>
<p>Sets the color for highlighted segments. It's possible to use both simultaneously <code>hl_col</code> and generic <code>colour</code></p>
</td></tr>
</table>


<h3>Format</h3>

<p>An object of class <code>StatDonutInt</code> (inherits from <code>Stat</code>, <code>ggproto</code>, <code>gg</code>) of length 4.
</p>
<p>An object of class <code>StatDonutIntHl</code> (inherits from <code>Stat</code>, <code>ggproto</code>, <code>gg</code>) of length 4.
</p>
<p>An object of class <code>StatDonutExt</code> (inherits from <code>Stat</code>, <code>ggproto</code>, <code>gg</code>) of length 4.
</p>
<p>An object of class <code>StatDonutExtHl</code> (inherits from <code>Stat</code>, <code>ggproto</code>, <code>gg</code>) of length 4.
</p>


<h3>Details</h3>

<p>There are two additional aesthetics possible to use:
</p>

<ul>
<li> <p><code>highlight</code> - optional aesthetic which expects logical (TRUE/FALSE) variable in order to highlight particular donut segments
</p>
</li>
<li> <p><code>opacity</code> - operates pretty much the same as <code>alpha</code> but ensure more contrast colors and removes legend. Once <code>alpha</code> is set <code>opacity</code> does not affect a chart
</p>
</li></ul>



<h3>Value</h3>

<p>None
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Create an example
set.seed(1605)
n &lt;- 20
df &lt;- dplyr::tibble(
  lvl1 = sample(LETTERS[1:5], n, TRUE),
  lvl2 = sample(LETTERS[6:24], n, TRUE),
  value = sample(1:20, n, TRUE),
  highlight_ext = sample(c(FALSE,TRUE), n, TRUE, c(.7, .3))) |&gt;
  dplyr::mutate(highlight_int = ifelse(lvl1 == "A", TRUE, FALSE))

# Create a simple pie chart
ggplot(df, aes(value = value, fill=lvl1)) +
  geom_donut_int(alpha=.6) +
  coord_polar(theta = "y")

# Create a simple donut chart that can handle more granular data
# and highlight specific segments
ggplot(df, aes(value = value, fill=lvl2, highlight=highlight_ext)) +
  geom_donut_int(r_int=.5, alpha=.6, linewidth=.2) +
  coord_polar(theta = "y") +
  xlim(0, 1.5)

# Perform data preparation tasks with `packing()`
# and apply specific color
packing(df, value) |&gt;
  ggplot(aes(value = value, fill=lvl2, highlight=highlight_ext)) +
  geom_donut_int(r_int=.5, alpha=.6, linewidth=.2, col = "gray20") +
  coord_polar(theta = "y") +
  xlim(0, 1.5)

# Built combined donut chart with interanl and external layers
dplyr::bind_rows(
# arrange by value
`arrange()` = dplyr::arrange(df, lvl1, lvl2, value),
# pack values for better space management
`packing()` = packing(df, value, lvl1),
.id = "prep_type") |&gt;
 ggplot(aes(value = value, fill=lvl1)) +
 geom_donut_int(aes(highlight=highlight_int), alpha=.6) +
 geom_donut_ext(aes(opacity=lvl2, highlight=highlight_int)) +
 # apply facets
 facet_grid(~prep_type) +
 # style chart with palette and theme
 scale_fill_viridis_d(option = "inferno", begin = .1, end = .7) +
 theme_void() +
 coord_polar(theta = "y") +
 xlim(0, 2.5)

</code></pre>

<hr>
<h2 id='donut_label'>Create pie or donut label and text annotations</h2><span id='topic+donut_label'></span><span id='topic+StatLabelInt'></span><span id='topic+geom_label_int'></span><span id='topic+StatTextInt'></span><span id='topic+geom_text_int'></span><span id='topic+StatLabelExt'></span><span id='topic+geom_label_ext'></span><span id='topic+StatTextExt'></span><span id='topic+geom_text_ext'></span>

<h3>Description</h3>

<p>The set of annotation functions utilizes layout functions to effectively distribute labels within the available space
Annotations are streamlined by leveraging pre-calculated special variables such as <code>.sum</code>, <code>.mean</code>, and <code>.n</code> (see Details).
</p>

<ul>
<li><p> The function <code>geom_label_int()</code> creates <code>geom_label</code>-like <strong>internal</strong> donut layer as aggregation of passed values
</p>
</li>
<li><p> The function <code>geom_text_int()</code> creates <code>geom_text</code>-like <strong>internal</strong> donut layer as aggregation of passed values
</p>
</li>
<li><p> The function <code>geom_label_ext()</code> creates <code>geom_label</code>-like <strong>external</strong> donut layer of passed values
</p>
</li>
<li><p> The function <code>geom_text_ext()</code> creates <code>geom_text</code>-like <strong>external</strong> donut layer of passed values
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>geom_label_int(
  mapping = NULL,
  data = NULL,
  stat = "label_int",
  position = "identity",
  na.rm = FALSE,
  show.legend = NA,
  inherit.aes = TRUE,
  r = 1,
  ...
)

geom_text_int(
  mapping = NULL,
  data = NULL,
  stat = "text_int",
  position = "identity",
  na.rm = FALSE,
  show.legend = NA,
  inherit.aes = TRUE,
  r = 1,
  ...
)

geom_label_ext(
  mapping = NULL,
  data = NULL,
  stat = "label_ext",
  position = "identity",
  na.rm = FALSE,
  show.legend = NA,
  inherit.aes = TRUE,
  layout = circle(),
  ...
)

geom_text_ext(
  mapping = NULL,
  data = NULL,
  stat = "text_ext",
  position = "identity",
  na.rm = FALSE,
  show.legend = NA,
  inherit.aes = TRUE,
  layout = circle(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="donut_label_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code>. If specified and
<code>inherit.aes = TRUE</code> (the default), it is combined with the default mapping
at the top level of the plot. You must supply <code>mapping</code> if there is no plot
mapping.</p>
</td></tr>
<tr><td><code id="donut_label_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame</code>, and
will be used as the layer data. A <code>function</code> can be created
from a <code>formula</code> (e.g. <code>~ head(.x, 10)</code>).</p>
</td></tr>
<tr><td><code id="donut_label_+3A_stat">stat</code></td>
<td>
<p>The statistical transformation to use on the data for this
layer, either as a <code>ggproto</code> <code>Geom</code> subclass or as a string naming the
stat stripped of the <code>stat_</code> prefix (e.g. <code>"count"</code> rather than
<code>"stat_count"</code>)</p>
</td></tr>
<tr><td><code id="donut_label_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string, or the result of
a call to a position adjustment function. Cannot be jointly specified with
<code>nudge_x</code> or <code>nudge_y</code>.</p>
</td></tr>
<tr><td><code id="donut_label_+3A_na.rm">na.rm</code></td>
<td>
<p>If <code>FALSE</code>, the default, missing values are removed with
a warning. If <code>TRUE</code>, missing values are silently removed.</p>
</td></tr>
<tr><td><code id="donut_label_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="donut_label_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</td></tr>
<tr><td><code id="donut_label_+3A_r">r</code></td>
<td>
<p>Sets the radius to place label or text for internal donut</p>
</td></tr>
<tr><td><code id="donut_label_+3A_...">...</code></td>
<td>
<p>Other arguments passed on to <code><a href="ggplot2.html#topic+layer">layer()</a></code>. These are
often aesthetics, used to set an aesthetic to a fixed value, like
<code>colour = "red"</code> or <code>size = 3</code>. They may also be parameters
to the paired geom/stat.</p>
</td></tr>
<tr><td><code id="donut_label_+3A_layout">layout</code></td>
<td>
<p>The layout function to effectively display text and labels</p>
</td></tr>
</table>


<h3>Format</h3>

<p>An object of class <code>StatLabelInt</code> (inherits from <code>Stat</code>, <code>ggproto</code>, <code>gg</code>) of length 3.
</p>
<p>An object of class <code>StatTextInt</code> (inherits from <code>Stat</code>, <code>ggproto</code>, <code>gg</code>) of length 3.
</p>
<p>An object of class <code>StatLabelExt</code> (inherits from <code>Stat</code>, <code>ggproto</code>, <code>gg</code>) of length 3.
</p>
<p>An object of class <code>StatTextExt</code> (inherits from <code>Stat</code>, <code>ggproto</code>, <code>gg</code>) of length 3.
</p>


<h3>Details</h3>

<p>The label functions supports <code>glue::glue()</code> for convenient label construction like <code>Total: {.sum}</code>,
where <code>.sum</code> is pre-calculated variable. You can still use <code>glue::glue()</code> or <code>paste()</code>
functions to pass data.frame fields for label construction.
</p>
<p>In addition to generic aesthetics like <code>color</code>, <code>fill</code>, <code>alpha</code>, etc., the following list of pre-calculated variables
is available for <code>geom_label_int()</code> and <code>geom_text_int()</code>:
</p>

<ul>
<li> <p><code>.sum</code>: Summation of the value field
</p>
</li>
<li> <p><code>.mean</code>: Mean of the value field
</p>
</li>
<li> <p><code>.median</code>: Median of the value field
</p>
</li>
<li> <p><code>.n</code>: Observation count of the value field
</p>
</li>
<li> <p><code>.prc</code>: Percentage of the value field
</p>
</li></ul>

<p>For <code>geom_label_ext()</code> and <code>geom_text_ext()</code>, which are suitable for external donut labels, the following list of
pre-calculated variables is available:
</p>

<ul>
<li> <p><code>.prc</code>: Percentage of the value field for the entire multiplicity
</p>
</li>
<li> <p><code>.prc_grp</code>: Percentage of the value field for the group defined by <code>fill</code>
</p>
</li></ul>



<h3>Value</h3>

<p>None
</p>


<h3>See Also</h3>

<p><a href="#topic+layouts">layouts</a>, <a href="#topic+pins">pins</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Create an example data set
n &lt;- 30
set.seed(2021)
df &lt;- dplyr::tibble(
  lvl1 = sample(LETTERS[1:5], n, TRUE),
  lvl2 = sample(LETTERS[6:24], n, TRUE),
  value = sample(1:20, n, TRUE),
  highlight_ext = sample(c(FALSE,TRUE), n, TRUE, c(.9, .1))) |&gt;
 dplyr::mutate(highlight_int = dplyr::if_else(lvl1 == "A", TRUE, FALSE))

# Starting plot with doubled donuts and annotations for internal one
p &lt;- dplyr::group_by(df, lvl1, lvl2, highlight_ext, highlight_int) |&gt;
 dplyr::summarise(value = sum(value), .groups = "drop") |&gt;
 packing(value, lvl1) |&gt;
 ggplot(aes(value = value, fill = lvl1)) +
 geom_donut_int(aes(highlight = highlight_int), alpha=.5, r_int=.25) +
 geom_text_int(lineheight = .8, r=1.2, show.legend = FALSE,
  aes(label = "Sum {fill}:\n{.sum}-{scales::percent(.prc)}", col=lvl1)) +
 geom_donut_ext(aes(opacity = lvl2, highlight = highlight_ext)) +
 scale_fill_viridis_d(option = "inferno", begin = .1, end = .7) +
 scale_color_viridis_d(option = "inferno", begin = .1, end = .7) +
 guides(alpha=guide_legend(ncol = 2), fill=guide_legend(ncol = 2)) +
 theme_void() +
 theme(legend.position = "inside", legend.position.inside = c(0.1, 0.9))

p + coord_radial(theta = "y", expand = FALSE, rotate_angle = FALSE)

# Add labels to external donut as percent inside group
p + coord_radial(theta = "y", expand = FALSE, rotate_angle = FALSE) +
 geom_label_ext(aes(label=paste0(lvl2, ": {scales::percent(.prc_grp)}")),
                show.legend = FALSE, size=3, col="white")

# Leverage ggplot2 feature for labels
p + coord_radial(theta = "y", expand = FALSE, rotate_angle = TRUE) +
 geom_label_ext(aes(label=paste0(lvl2, ": {scales::percent(.prc)}")),
                show.legend = FALSE, size=3, col="white", angle=90,
                layout = circle())

# Leverage another layout
p + coord_radial(theta = "y", expand = FALSE, rotate_angle = FALSE) +
 geom_label_ext(aes(label=paste0(lvl2, ": {scales::percent(.prc_grp)}")),
                show.legend = FALSE, size=3, col="white",
                layout = tv(thinner = TRUE, thinner_gap = 0.15))

</code></pre>

<hr>
<h2 id='GDP'>The World Bank GDP, PPP (current international $)</h2><span id='topic+GDP'></span>

<h3>Description</h3>


<ul>
<li><p> A pre-processed subset of GDP data from the World Bank
</p>
</li>
<li><p> GDP, PPP means gross domestic product based on purchasing power parity
</p>
</li>
<li> <p><em>current international $</em> means actual (not adjusted to inflation) US dollars
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>GDP
</code></pre>


<h3>Format</h3>



<h4><code>GDP</code></h4>

<p>A data frame with 6,004 rows and 5 columns:
</p>

<dl>
<dt>date</dt><dd><p>Year</p>
</dd>
<dt>country</dt><dd><p>Country name</p>
</dd>
<dt>region</dt><dd><p>Region hierarchy</p>
</dd>
<dt>region_ISO</dt><dd><p>3 letter ISO region codes</p>
</dd>
<dt>GDP</dt><dd><p>GDP, PPP (current international $)</p>
</dd>
</dl>
<p>...

</p>



<h3>Source</h3>

<p><a href="https://data.worldbank.org/indicator/NY.GDP.MKTP.PP.CD">https://data.worldbank.org/indicator/NY.GDP.MKTP.PP.CD</a>
</p>

<hr>
<h2 id='layouts'>The set of layout functions is designed to effectively display text and labels</h2><span id='topic+layouts'></span><span id='topic+tv'></span><span id='topic+petal'></span><span id='topic+circle'></span><span id='topic+eye'></span>

<h3>Description</h3>

<p>The layout functions help to streamline displaying text and labels <em>geoms</em> without overlapping effectively leveraging space available for pie and donut charts
</p>

<ul>
<li> <p><code>tv()</code> - The function builds layout resembled an old-fashioned TV screen
</p>
</li>
<li> <p><code>petal()</code> - The function builds layout resembled flower with petals
</p>
</li>
<li> <p><code>circle()</code> - The function builds circle layout
</p>
</li>
<li> <p><code>eye()</code> - The function builds two-sided layout
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>tv(
  scale_x = 1.5,
  scale_y = 1.5,
  bend_x = 1,
  bend_y = 1,
  thinner = FALSE,
  thinner_gap = 0.1
)

petal(
  rotate = 0,
  n = 4,
  scale = 2.5,
  bend = 0.3,
  thinner = FALSE,
  thinner_gap = 0.1
)

circle(r = 2.5, thinner = FALSE, thinner_gap = 0.1)

eye(scale_x = 2, bend_x = 1, alpha = 90, clove = 0.5)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="layouts_+3A_scale_x">scale_x</code></td>
<td>
<p>Scales the layout in horizontal perspective</p>
</td></tr>
<tr><td><code id="layouts_+3A_scale_y">scale_y</code></td>
<td>
<p>Scales the layout in vertical perspective</p>
</td></tr>
<tr><td><code id="layouts_+3A_bend_x">bend_x</code></td>
<td>
<p>Adjusts the bend level in horizontal perspective</p>
</td></tr>
<tr><td><code id="layouts_+3A_bend_y">bend_y</code></td>
<td>
<p>Adjusts the bend level in vertical perspective</p>
</td></tr>
<tr><td><code id="layouts_+3A_thinner">thinner</code></td>
<td>
<p>Distributes text or label elements across two different levels</p>
</td></tr>
<tr><td><code id="layouts_+3A_thinner_gap">thinner_gap</code></td>
<td>
<p>Sets the spacing between thinner levels</p>
</td></tr>
<tr><td><code id="layouts_+3A_rotate">rotate</code></td>
<td>
<p>Rotates the layout clockwise</p>
</td></tr>
<tr><td><code id="layouts_+3A_n">n</code></td>
<td>
<p>Sets the number of petals in the layout</p>
</td></tr>
<tr><td><code id="layouts_+3A_scale">scale</code></td>
<td>
<p>Scales the layout</p>
</td></tr>
<tr><td><code id="layouts_+3A_bend">bend</code></td>
<td>
<p>Manages the bending level</p>
</td></tr>
<tr><td><code id="layouts_+3A_r">r</code></td>
<td>
<p>Sets the radius of the layout circle</p>
</td></tr>
<tr><td><code id="layouts_+3A_alpha">alpha</code></td>
<td>
<p>Defines the angle of distribution in horizontal perspective.
Pick up value from degree interval (0, 180)</p>
</td></tr>
<tr><td><code id="layouts_+3A_clove">clove</code></td>
<td>
<p>Determines the distribution proportion between the left and right-hand parts.
Default value is 0.5. There should be numeric value from interval (0, 1)
e.g. 0.4 denotes 40% cases on the right hand and 60% cases on the left hand</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Layout functions return layout function i.e. a function that takes a vector of angles and returns a numeric
radius vector giving a position for each input value.
</p>
<p>Layout functions are designed to be used with the layout argument of donutsk functions.
</p>


<h3>See Also</h3>

<p>Utilized in the following functions: <a href="#topic+geom_label_ext">geom_label_ext</a>, <a href="#topic+geom_text_ext">geom_text_ext</a>, <a href="#topic+geom_pin">geom_pin</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Render multiple layouts simultaneously
list(petal_2n = petal(n = 2),
     petal_3n = petal(n = 3, rotate = 180),
     petal_4n = petal(n = 4),
     tv_base = tv(),
     tv_ext = tv(bend_x = 0, bend_y = 0, thinner = TRUE)) |&gt;
  lapply(function(x){
    rlang::exec(x, 1:300/300) |&gt;
      dplyr::tibble(r = _) |&gt;
      dplyr::mutate(theta = 1:300/300)
  }) |&gt;
  dplyr::bind_rows(.id = "layouts") |&gt;
  ggplot(aes(x=r, y=theta, col = layouts)) +
  geom_point(alpha = .3) +
  coord_polar(theta = "y") +
  xlim(0, 3.5)

# The eye() layout generates table as an output
n &lt;- 20
theta &lt;- 1:n/n

dplyr::tibble(
  theta = theta,
  lbl = paste0("sample: ", sample(LETTERS, n, TRUE))
  ) |&gt;
 dplyr::bind_cols(lt = eye()(theta)) |&gt;
 ggplot(aes(x=x, y=y)) +
 geom_point(aes(x=1, y=theta)) +
 geom_point() +
 geom_segment(aes(x=1, xend=x, y=theta, yend=y), linewidth=.2) +
 geom_label(aes(label=lbl, hjust=dplyr::if_else(theta &gt; 0.5, 1, 0)),
  nudge_x =.2) +
 coord_polar(theta = "y") +
 xlim(0, 5) +
 ylim(0, 1)

</code></pre>

<hr>
<h2 id='packing'>Arrange data to distribute small values</h2><span id='topic+packing'></span>

<h3>Description</h3>

<p>Arrange data to distribute small values further apart from each other
</p>


<h3>Usage</h3>

<pre><code class='language-R'>packing(.data, value, level = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="packing_+3A_.data">.data</code></td>
<td>
<p>A data frame, data frame extension (e.g. a tibble), or a lazy data frame (e.g. from dbplyr or dtplyr).</p>
</td></tr>
<tr><td><code id="packing_+3A_value">value</code></td>
<td>
<p>A .data field which contains values to distribute</p>
</td></tr>
<tr><td><code id="packing_+3A_level">level</code></td>
<td>
<p>A .data grouping field for distribution</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of the same type as .data.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Create an example
n &lt;- 20
df &lt;- dplyr::tibble(
 lvl1 = sample(LETTERS[1:5], n, TRUE),
 lvl2 = sample(LETTERS[6:24], n, TRUE),
 value = sample(1:20, n, TRUE)
 )

# Arrange all values
packing(df, value)

# Arrange values within values
packing(df, value, lvl1)
</code></pre>

<hr>
<h2 id='pins'>Connecting labels with donut segments</h2><span id='topic+pins'></span><span id='topic+StatPinLine'></span><span id='topic+geom_pin_line'></span><span id='topic+StatPinHead'></span><span id='topic+geom_pin_head'></span><span id='topic+geom_pin'></span>

<h3>Description</h3>

<p>The set of functions served to connect text or labels with donut segments
</p>

<ul>
<li> <p><code>geom_pin_line()</code> - builds curved line to linl label with donut segment
</p>
</li>
<li> <p><code>geom_pin_head()</code> - builds stylish point heads for pins
</p>
</li>
<li> <p><code>geom_pin()</code> - handy wrapper for <code>geom_pin_line()</code> and <code>geom_pin_head()</code>
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>geom_pin_line(
  mapping = NULL,
  data = NULL,
  stat = "pin",
  position = "identity",
  na.rm = FALSE,
  show.legend = NA,
  inherit.aes = TRUE,
  r = 1.5,
  cut = 0.1,
  layout = circle(),
  ...
)

geom_pin_head(
  mapping = NULL,
  data = NULL,
  stat = "point",
  position = "identity",
  na.rm = FALSE,
  show.legend = NA,
  inherit.aes = TRUE,
  r = 1.5,
  cut = 0.1,
  layout = circle(),
  ...
)

geom_pin(..., head = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pins_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code>. If specified and
<code>inherit.aes = TRUE</code> (the default), it is combined with the default mapping
at the top level of the plot. You must supply <code>mapping</code> if there is no plot
mapping.</p>
</td></tr>
<tr><td><code id="pins_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame</code>, and
will be used as the layer data. A <code>function</code> can be created
from a <code>formula</code> (e.g. <code>~ head(.x, 10)</code>).</p>
</td></tr>
<tr><td><code id="pins_+3A_stat">stat</code></td>
<td>
<p>The statistical transformation to use on the data for this
layer, either as a <code>ggproto</code> <code>Geom</code> subclass or as a string naming the
stat stripped of the <code>stat_</code> prefix (e.g. <code>"count"</code> rather than
<code>"stat_count"</code>)</p>
</td></tr>
<tr><td><code id="pins_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string naming the adjustment
(e.g. <code>"jitter"</code> to use <code>position_jitter</code>), or the result of a call to a
position adjustment function. Use the latter if you need to change the
settings of the adjustment.</p>
</td></tr>
<tr><td><code id="pins_+3A_na.rm">na.rm</code></td>
<td>
<p>If <code>FALSE</code>, the default, missing values are removed with
a warning. If <code>TRUE</code>, missing values are silently removed.</p>
</td></tr>
<tr><td><code id="pins_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="pins_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</td></tr>
<tr><td><code id="pins_+3A_r">r</code></td>
<td>
<p>The radius where donut is placed</p>
</td></tr>
<tr><td><code id="pins_+3A_cut">cut</code></td>
<td>
<p>Sets additional two-sided gap for pins</p>
</td></tr>
<tr><td><code id="pins_+3A_layout">layout</code></td>
<td>
<p>The layout function to effectively display text and labels.
Obviously it's better to have the same as for <code>geom_label_ext</code> or <code>geom_text_ext</code></p>
</td></tr>
<tr><td><code id="pins_+3A_...">...</code></td>
<td>
<p>Parameters to be passed to <code>geom_pin_line()</code> and <code>geom_pin_head()</code></p>
</td></tr>
<tr><td><code id="pins_+3A_head">head</code></td>
<td>
<p>Boolean - defines whether to add pin head</p>
</td></tr>
</table>


<h3>Format</h3>

<p>An object of class <code>StatPinLine</code> (inherits from <code>Stat</code>, <code>ggproto</code>, <code>gg</code>) of length 3.
</p>
<p>An object of class <code>StatPinHead</code> (inherits from <code>Stat</code>, <code>ggproto</code>, <code>gg</code>) of length 3.
</p>


<h3>Value</h3>

<p>None
</p>


<h3>See Also</h3>

<p><a href="#topic+layouts">layouts</a>, <a href="#topic+donut_label">donut_label</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>n &lt;- 30
set.seed(2021)
df &lt;- dplyr::tibble(
  lvl1 = sample(LETTERS[1:5], n, TRUE),
  lvl2 = sample(LETTERS[6:24], n, TRUE),
  value = sample(1:20, n, TRUE),
  highlight_ext = sample(c(FALSE,TRUE), n, TRUE, c(.9, .1))) |&gt;
  dplyr::mutate(highlight_int = dplyr::if_else(lvl1 == "A", TRUE, FALSE))

# Starting plot with doubled donuts and annotations for internal one
p &lt;- dplyr::group_by(df, lvl1, lvl2, highlight_ext, highlight_int) |&gt;
  dplyr::summarise(value = sum(value), .groups = "drop") |&gt;
  packing(value, lvl1) |&gt;
  ggplot(aes(value = value, fill = lvl1)) +
  geom_donut_int(aes(highlight = highlight_int), alpha=.5, r_int = .25) +
  geom_label_int(aes(label = "Sum {fill}:\n{.sum}-{scales::percent(.prc)}"),
                 alpha = .6, col = "white", size = 3, r=1.2) +
  geom_donut_ext(aes(opacity = lvl2, highlight = highlight_ext)) +
  scale_fill_viridis_d(option = "inferno", begin = .1, end = .7) +
  guides(alpha = guide_legend(ncol = 2), fill = guide_legend(ncol = 2)) +
  theme_void() +
  theme(legend.position = "none")

p + coord_radial(theta = "y", expand = FALSE, rotate_angle = FALSE)

# Add labels to external donut as percent inside group
p + coord_radial(theta = "y", expand = FALSE, rotate_angle = FALSE) +
  geom_label_ext(aes(label = paste0(lvl2, ": {scales::percent(.prc_grp)}")),
                 show.legend = FALSE, size=3, col="white") +
  geom_pin(size = .5, linewidth=.1, show.legend = FALSE, cut = .2)

# Leverage tv() layout
p + coord_radial(theta = "y", expand = FALSE, rotate_angle = FALSE) +
  geom_label_ext(aes(label = paste0(lvl2, ":{scales::percent(.prc_grp)}")),
                 show.legend = FALSE, size=3, col="white",
                 layout = tv(thinner = TRUE, thinner_gap = .15)) +
  geom_pin(size = .5, linewidth=.1, show.legend = FALSE, cut = .2,
           layout = tv(thinner = TRUE, thinner_gap = .15))

# Leverage another layout
p + coord_radial(theta = "y", expand = FALSE, rotate_angle = FALSE) +
  geom_label_ext(aes(label = paste0(lvl2, ": {scales::percent(.prc_grp)}")),
                 show.legend = FALSE, size=3, col="white", layout = eye()) +
  geom_pin(size = .5, linewidth=.1, show.legend = FALSE, layout = eye())

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
