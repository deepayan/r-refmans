<!DOCTYPE html><html><head><title>Help for package seqDesign</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {seqDesign}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#censTrial'><p>Generation of Pre-Unblinded Follow-Up Data-Sets by Applying the Monitoring Outcomes</p></a></li>
<li><a href='#getBlockSize'><p>Determine block size for use in blocked randomization</p></a></li>
<li><a href='#monitorTrial'><p>Group Sequential Monitoring of Simulated Efficacy Trials for the Event of Potential Harm, Non-Efficacy, and High Efficacy</p></a></li>
<li><a href='#rankTrial'><p>Ranking and Selection, and Head-to-Head Comparison of Individual and Pooled Treatment Arms</p></a></li>
<li><a href='#simTrial'><p>Simulation of Multi-Arm Randomized Phase IIb/III  Efficacy Trials with Time-to-Event Endpoints</p></a></li>
<li><a href='#VEpowerPP'><p>Unconditional Power to Detect Positive Treatment Efficacy in a Per-Protocol Cohort</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>1.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2019-05-14</td>
</tr>
<tr>
<td>Title:</td>
<td>Simulation and Group Sequential Monitoring of Randomized
Two-Stage Treatment Efficacy Trials with Time-to-Event
Endpoints</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/mjuraska/seqDesign">https://github.com/mjuraska/seqDesign</a></td>
</tr>
<tr>
<td>Description:</td>
<td>A modification of the preventive vaccine efficacy trial design of Gilbert, Grove et al. (2011, Statistical Communications in Infectious Diseases) is implemented, with application generally to individual-randomized clinical trials with multiple active treatment groups and a shared control group, and a study endpoint that is a time-to-event endpoint subject to right-censoring. The design accounts for the issues that the efficacy of the treatment/vaccine groups may take time to accrue while the multiple treatment administrations/vaccinations are given; there is interest in assessing the durability of treatment efficacy over time; and group sequential monitoring of each treatment group for potential harm, non-efficacy/efficacy futility, and high efficacy is warranted. The design divides the trial into two stages of time periods, where each treatment is first evaluated for efficacy in the first stage of follow-up, and, if and only if it shows significant treatment efficacy in stage one, it is evaluated for longer-term durability of efficacy in stage two. The package produces plots and tables describing operating characteristics of a specified design including an unconditional power for intention-to-treat and per-protocol/as-treated analyses; trial duration; probabilities of the different possible trial monitoring outcomes (e.g., stopping early for non-efficacy); unconditional power for comparing treatment efficacies; and distributions of numbers of endpoint events occurring after the treatments/vaccinations are given, useful as input parameters for the design of studies of the association of biomarkers with a clinical outcome (surrogate endpoint problem). The code can be used for a single active treatment versus control design and for a single-stage design.</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/mjuraska/seqDesign/issues">https://github.com/mjuraska/seqDesign/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.16), survival</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr, R.rsp</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, R.rsp</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.1.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2019-05-22 00:26:06 UTC; mjuraska</td>
</tr>
<tr>
<td>Author:</td>
<td>Michal Juraska [aut, cre],
  Doug Grove [aut],
  Xuesong Yu [ctb],
  Peter Gilbert [ctb],
  Stephanie Wu [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Michal Juraska &lt;mjuraska@fredhutch.org&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2019-05-22 22:10:35 UTC</td>
</tr>
</table>
<hr>
<h2 id='censTrial'>Generation of Pre-Unblinded Follow-Up Data-Sets by Applying the Monitoring Outcomes</h2><span id='topic+censTrial'></span>

<h3>Description</h3>

<p><code>censTrial</code> &lsquo;correctly censors&rsquo; treatment arms in data-sets generated by <code>simTrial</code> by including pre-unblinded follow-up data only according to the monitoring conclusions as reported by <code>monitorTrial</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>censTrial(dataFile, monitorFile, stage1, stage2, saveFile = NULL,
  saveDir = NULL, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="censTrial_+3A_datafile">dataFile</code></td>
<td>
<p>if <code>saveDir = NULL</code>, a list returned by <code>simTrial</code>; otherwise a name (character string) of an <code>.RData</code> file created by <code>simTrial</code></p>
</td></tr>
<tr><td><code id="censTrial_+3A_monitorfile">monitorFile</code></td>
<td>
<p>if <code>saveDir = NULL</code>, a list returned by <code>monitorTrial</code>; otherwise a name (character string) of an <code>.RData</code> file created by <code>monitorTrial</code></p>
</td></tr>
<tr><td><code id="censTrial_+3A_stage1">stage1</code></td>
<td>
<p>the final week of stage 1 in a two-stage trial</p>
</td></tr>
<tr><td><code id="censTrial_+3A_stage2">stage2</code></td>
<td>
<p>the final week of stage 2 in a two-stage trial, i.e., the maximum follow-up time</p>
</td></tr>
<tr><td><code id="censTrial_+3A_savefile">saveFile</code></td>
<td>
<p>a character string specifying the name of the output <code>.RData</code> file. If <code>NULL</code> (default), a default file name will be used.</p>
</td></tr>
<tr><td><code id="censTrial_+3A_savedir">saveDir</code></td>
<td>
<p>a character string specifying a path for both <code>dataFile</code> and <code>monitorFile</code>. If supplied, the output is also saved as an <code>.RData</code> file in this directory; otherwise the output is returned as a list.</p>
</td></tr>
<tr><td><code id="censTrial_+3A_verbose">verbose</code></td>
<td>
<p>a logical value indicating whether information on the output directory and file name should be printed out (default is <code>TRUE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>All time variables use week as the unit of time. Month is defined as 52/12 weeks.
</p>
<p>The following censoring rules are applied to each data-set generated by <code>simTrial</code>:
</p>

<ul>
<li><p> If no vaccine arm registers efficacy or high efficacy in Stage 1, the placebo arm is censored on the date when the last vaccine arm hits the harm or non-efficacy boundary.
</p>
</li>
<li><p> If a vaccine arm hits the harm boundary, censor the arm immediately.
</p>
</li>
<li><p> If a vaccine arm hits the non-efficacy boundary, censor the arm on the earliest date of the two events: (1) the last vaccine arm hits the harm or non-efficacy boundary (if applicable); and (2) all subjects in the vaccine arm have completed the final <code>stage1</code> visit.
</p>
</li></ul>



<h3>Value</h3>

<p>If <code>saveDir</code> is specified, the output list (named <code>trialListCensor</code>) is saved as an <code>.RData</code> file in <code>saveDir</code> (the path to <code>saveDir</code> is printed); otherwise it is returned. 
The output object is a list of length equal to the number of simulated trials, each of which is a <code>data.frame</code> with at least the variables <code>trt</code>, <code>entry</code>, <code>exit</code>, and <code>event</code> 
storing the treatment assignments, enrollment times, correctly censored study exit times, and event indicators, respectively. If available, indicators belonging to the per-protocol cohort 
(named <code>pp1</code>, <code>pp2</code>, etc.) are copied from the uncensored data-sets.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+simTrial">simTrial</a></code>, <code><a href="#topic+monitorTrial">monitorTrial</a></code>, and <code><a href="#topic+rankTrial">rankTrial</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>simData &lt;- simTrial(N=c(1000, rep(700, 2)), aveVE=seq(0, 0.4, by=0.2), 
                    VEmodel="half", vePeriods=c(1, 27, 79), enrollPeriod=78, 
                    enrollPartial=13, enrollPartialRelRate=0.5, dropoutRate=0.05, 
                    infecRate=0.04, fuTime=156, 
                    visitSchedule=c(0, (13/3)*(1:4), seq(13*6/3, 156, by=13*2/3)),
                    missVaccProb=c(0,0.05,0.1,0.15), VEcutoffWeek=26, nTrials=5, 
                    stage1=78, randomSeed=300)

monitorData &lt;- monitorTrial(dataFile=simData, stage1=78, stage2=156, 
                            harmMonitorRange=c(10,100), alphaPerTest=NULL, 
                            nonEffStartMethod="FKG", nonEffInterval=20, 
                            lowerVEnoneff=0, upperVEnoneff=0.4, highVE=0.7, 
                            stage1VE=0, lowerVEuncPower=0, alphaNoneff=0.05, 
                            alphaHigh=0.05, alphaStage1=0.05, 
                            alphaUncPower=0.05, estimand="cuminc", lagTime=26)

censData &lt;- censTrial(dataFile=simData, monitorFile=monitorData, stage1=78, stage2=156)

### alternatively, to save the .RData output file (no '&lt;-' needed):
###
### simTrial(N=c(1400, rep(1000, 2)), aveVE=seq(0, 0.4, by=0.2), VEmodel="half", 
###          vePeriods=c(1, 27, 79), enrollPeriod=78, enrollPartial=13, 
###          enrollPartialRelRate=0.5, dropoutRate=0.05, infecRate=0.04, fuTime=156, 
###          visitSchedule=c(0, (13/3)*(1:4), seq(13*6/3, 156, by=13*2/3)), 
###          missVaccProb=c(0,0.05,0.1,0.15), VEcutoffWeek=26, nTrials=30, 
###          stage1=78, saveDir="./", randomSeed=300)
###
### monitorTrial(dataFile=
###              "simTrial_nPlac=1400_nVacc=1000_1000_aveVE=0.2_0.4_infRate=0.04.RData", 
###              stage1=78, stage2=156, harmMonitorRange=c(10,100), alphaPerTest=NULL, 
###              nonEffStartMethod="FKG", nonEffInterval=20, lowerVEnoneff=0, 
###              upperVEnoneff=0.4, highVE=0.7, stage1VE=0, lowerVEuncPower=0, 
###              alphaNoneff=0.05, alphaHigh=0.05, alphaStage1=0.05, alphaUncPower=0.05, 
###              estimand="cuminc", lagTime=26, saveDir="./")
###
### censTrial(dataFile=
###          "simTrial_nPlac=1400_nVacc=1000_1000_aveVE=0.2_0.4_infRate=0.04.RData",
###          monitorFile=
###          "monitorTrial_nPlac=1400_nVacc=1000_1000_aveVE=0.2_0.4_infRate=0.04_cuminc.RData",
###          stage1=78, stage2=156, saveDir="./")
 
</code></pre>

<hr>
<h2 id='getBlockSize'>Determine block size for use in blocked randomization</h2><span id='topic+getBlockSize'></span>

<h3>Description</h3>

<p><code>getBlockSize</code> returns the minimum block size (possibly within a specified range) that is compatible with a trial's overall treatment assignment totals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getBlockSize(nvec, range = c(0, Inf))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getBlockSize_+3A_nvec">nvec</code></td>
<td>
<p>vector specifying the number of participants to be assigned to each treatment group.  The vector should have one component per group, so that its length equals number of groups. The sum of <code>nvec</code> should equal the total enrollment for the trial.</p>
</td></tr>
<tr><td><code id="getBlockSize_+3A_range">range</code></td>
<td>
<p>(Optional) vector of length two giving the lower and upper bounds (respectively) on block sizes that the user wishes to consider.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The ordering of the components of <code>nvec</code> is not important, so using <code>nvec = c(x,y,z)</code> will produce the same results as using <code>nvec = c(z,x,y)</code>.
</p>
<p>In block randomization one does not necessarily want the smallest block size, which is the reason for the existance of the <code>range</code> argument.  For example, a trial with a 1:1 randomization allocation between two groups would have a minimum block size of 2, which most people would consider to be too small.  So a typical usage of <code>getBlockSize</code> would be to use <code>range</code> to set a minimum acceptable block size, through use of vector of form <code>c(lowerBound, Inf)</code>.  A large trial should probably have a block size on the order of 10-20 or larger, depending on factors including the total trial size and speed of enrollment, so setting a minimum is a good idea.
</p>


<h3>Value</h3>

<p>An integer or NA.  If the user does not specify <code>range</code>, then the function will always return an integer, which is the smallest block size compatible with the specified vector of treatment group sizes.  If the user <em>has</em> specified the <code>range</code>, then the function adds the further constraint that the block size must lie in the closed interval given by <code>range</code> (i.e., the block size must be greater-than-or-equal-to <code>range[1]</code> and less-than-or-equal-to <code>range[2]</code>).  If there are no compatible block sizes that lie in the given interval, then an NA is returned.
</p>
<p>Note that the value returned is the <strong>minimum</strong> block size that is compatible, not necessarily the only one. Any other compatible block sizes (if any exist) will be integer multiples of the minimum size.  You can check the feasibility of various integer multiples by seeing if they divide evenly into the total trial size (i.e., into the sum of <code>nvec</code>).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
getBlockSize(nvec = c(375, 375) ) 
## specify a minimum block size of 10 (no maximum)
getBlockSize(nvec = c(375, 375), range = c(10, Inf) ) 

getBlockSize( nvec = c(30, 510, 390) )
## require a minimum block size of 10 and maximum of 30 
## (not possible with this nvec, so function returns NA)
getBlockSize( nvec = c(30, 510, 390), range = c(10, 30) )

</code></pre>

<hr>
<h2 id='monitorTrial'>Group Sequential Monitoring of Simulated Efficacy Trials for the Event of Potential Harm, Non-Efficacy, and High Efficacy</h2><span id='topic+monitorTrial'></span>

<h3>Description</h3>

<p><code>monitorTrial</code> applies a group sequential monitoring procedure to data-sets generated by <code>simTrial</code>, which may result in modification or termination of each simulated trial.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>monitorTrial(dataFile, stage1, stage2, harmMonitorRange,
  harmMonitorAlpha = 0.05, alphaPerTest = NULL,
  nonEffStartMethod = c("FKG", "fixed", "?", "old"),
  nonEffStartParams = NULL, nonEffInterval,
  nonEffIntervalUnit = c("counts", "time"), lowerVEnoneff = NULL,
  upperVEnoneff, highVE, stage1VE, lowerVEuncPower = NULL, alphaNoneff,
  alphaHigh, alphaStage1, alphaUncPower = NULL,
  estimand = c("combined", "cox", "cuminc"), laggedMonitoring = FALSE,
  lagTime, saveFile = NULL, saveDir = NULL, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="monitorTrial_+3A_datafile">dataFile</code></td>
<td>
<p>if <code>saveDir = NULL</code>, a list returned by <code>simTrial</code>; otherwise a name (character string) of an <code>.RData</code> file created by <code>simTrial</code></p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_stage1">stage1</code></td>
<td>
<p>the final week of stage 1 in a two-stage trial</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_stage2">stage2</code></td>
<td>
<p>the final week of stage 2 in a two-stage trial, i.e., the maximum follow-up time</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_harmmonitorrange">harmMonitorRange</code></td>
<td>
<p>a 2-component numeric vector specifying the range of the pooled number of infections (pooled over the placebo and vaccine arm accruing infections the fastest) over which the type I error rate, specified in <code>harmMonitorAlpha</code>, will be spent (per vaccine arm). Note that <code>harmMonitorRange</code> does not specify a range for which potential-harm stopping boundaries will be computed; instead, it specifies when potential-harm monitoring will start, and the range over which <code>harmMonitorAlpha</code> will be spent.</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_harmmonitoralpha">harmMonitorAlpha</code></td>
<td>
<p>a numeric value (0.05 by default) specifying the overall type I error rate for potential-harm monitoring (per vaccine arm). To turn off potential-harm monitoring, set <code>harmMonitorAlpha</code> equal to 0.00001.</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_alphapertest">alphaPerTest</code></td>
<td>
<p>a per-test nominal/unadjusted alpha level for potential-harm monitoring. If <code>NULL</code>, a per-test alpha level is calculated that yields a cumulative alpha of <code>harmMonitorAlpha</code> at the end of <code>harmMonitorRange</code>.</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_noneffstartmethod">nonEffStartMethod</code></td>
<td>
<p>a character string specifying the method used for determining when non-efficacy monitoring is to start. The default method of Freidlin, Korn, and Gray (2010) (&quot;<code>FKG</code>&quot;) calculates the minimal pooled infection count (pooled over the placebo and vaccine arm accruing infections the fastest) such that a hazard-ratio-based VE point estimate of 0% would result in declaring non-efficacy, i.e., the upper bound of the two-sided (1-<code>alphaNoneff</code>) x 100% confidence interval for VE based on the asymptotic variance of the log-rank statistic is (barely) below the non-efficacy threshold specified as component <code>upperVEnonEff</code> in the list <code>nonEffStartParams</code>. If this list component is left unspecified, the argument <code>upperVEnonEff</code> is used as the non-efficacy threshold. The alternative method (&quot;<code>fixed</code>&quot;) starts non-efficacy monitoring at a fixed pooled infection count (pooled over the placebo and vaccine arm accruing infections the fastest) specified by component <code>N1</code> in the list <code>nonEffStartParams</code>.</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_noneffstartparams">nonEffStartParams</code></td>
<td>
<p>a list with named components specifying parameters required by <code>nonEffStartMethod</code> (<code>NULL</code> by default)</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_noneffinterval">nonEffInterval</code></td>
<td>
<p>a numeric value (a number of infections or a number of weeks) specifying the interval between two adjacent non-efficacy interim analyses</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_noneffintervalunit">nonEffIntervalUnit</code></td>
<td>
<p>a character string specifying whether intervals between two adjacent non-efficacy interim analyses should be event-driven (default option &quot;<code>counts</code>&quot;) or calendar time-driven (option &quot;<code>time</code>&quot;)</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_lowervenoneff">lowerVEnoneff</code></td>
<td>
<p>specifies criterion 1 for declaring non-efficacy: the lower bound of the two-sided (1-<code>alphaNoneff</code>) x 100% confidence interval(s) for the VE estimand(s) lie(s) below <code>lowerVEnoneff</code> (typically set equal to 0). If <code>NULL</code> (default), this criterion is ignored.</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_uppervenoneff">upperVEnoneff</code></td>
<td>
<p>specifies criterion 2 for declaring non-efficacy: the upper bound of the two-sided (1-<code>alphaNoneff</code>) x 100% confidence interval(s) for the VE estimand(s) lie(s) below <code>upperVEnoneff</code> (typically a number in the 0&ndash;0.5 range)</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_highve">highVE</code></td>
<td>
<p>specifies a criterion for declaring high-efficacy: the lower bound of the two-sided (1-<code>alphaHigh</code>) x 100% confidence interval for the VE estimand lies above <code>highVE</code> (typically a number in the 0.5&ndash;1 range). To turn off high efficacy monitoring, set <code>highVE</code> equal to 1.</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_stage1ve">stage1VE</code></td>
<td>
<p>specifies a criterion for advancement of a treatment's evaluation into Stage 2: the lower bound of the two-sided (1-<code>alphaStage1</code>) x 100% confidence interval for the VE estimand lies above <code>stage1VE</code> (typically set equal to 0)</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_lowerveuncpower">lowerVEuncPower</code></td>
<td>
<p>a numeric vector with each component specifying a one-sided null hypothesis H0: VE(0&ndash;<code>stage1</code>) <code class="reqn">\le</code> <code>lowerVEuncPower</code> x 100%. Unconditional power (i.e., accounting for sequential monitoring) to reject each H0 is calculated, where the rejection region is defined by the lower bound of the two-sided (1-<code>alphaUncPower</code>) x 100% confidence interval for the VE estimand being above the respective component of <code>lowerVEuncPower</code> (typically values in the 0&ndash;0.5 range).</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_alphanoneff">alphaNoneff</code></td>
<td>
<p>one minus the nominal confidence level of the two-sided confidence interval used for non-efficacy monitoring</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_alphahigh">alphaHigh</code></td>
<td>
<p>one minus the nominal confidence level of the two-sided confidence interval used for high efficacy monitoring</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_alphastage1">alphaStage1</code></td>
<td>
<p>one minus the nominal confidence level of the two-sided confidence interval used for determining whether a treatment's evaluation advances into Stage 2</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_alphauncpower">alphaUncPower</code></td>
<td>
<p>one minus the nominal confidence level of the two-sided confidence interval used to test one-sided null hypotheses H0: VE(0-<code>stage1</code>) <code class="reqn">\le</code> <code>lowerVEuncPower</code> x 100% against alternative hypotheses H1: VE(0&ndash;<code>stage1</code>) <code class="reqn">&gt;</code> <code>lowerVEuncPower</code> x 100%. The same nominal confidence level is applied for each component of <code>lowerVEuncPower</code>.</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_estimand">estimand</code></td>
<td>
<p>a character string specifying the choice of VE estimand(s) used in non- and high efficacy monitoring, advancement rule for Stage 2, and unconditional power calculations. Three options are implemented: (1) the &lsquo;pure&rsquo; Cox approach (<code>"cox"</code>), where VE is defined as 1-hazard ratio (treatment/control) and estimated by the maximum partial likelihood estimator in the Cox model; (2) the &lsquo;pure&rsquo; cumulative incidence-based approach (<code>"cuminc"</code>), where VE is defined as 1-cumulative incidence ratio (treatment/control) and estimated by the transformation of the Nelson-Aalen estimator for the cumulative hazard function; and (3) the combined approach (<code>"combined"</code>), where both aforementioned VE estimands are used for non-efficacy monitoring while the cumulative VE estimand is used for all other purposes. Only the first three characters are necessary.</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_laggedmonitoring">laggedMonitoring</code></td>
<td>
<p>a logical value (<code>FALSE</code> by default) indicating whether &quot;per-protocol&quot; non-efficacy monitoring should additionally be conducted for events occurring after <code>lagTime</code> weeks as a more conservative non-efficacy monitoring approach. If <code>TRUE</code> and <code>estimand = "combined"</code>, the cumulative VE estimand is considered only for non-efficacy monitoring.</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_lagtime">lagTime</code></td>
<td>
<p>a time point (in weeks) defining the per-protocol VE estimand, i.e., VE(<code>lagTime</code>&ndash;<code>stage1</code>). This VE estimand is also used in &quot;per-protocol&quot; non-efficacy monitoring if <code>laggedMonitoring</code> equals <code>TRUE</code>. It is typically chosen as the date of the last immunization or the date of the visit following the last immunization.</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_savefile">saveFile</code></td>
<td>
<p>a character string specifying the name of the output <code>.RData</code> file. If <code>NULL</code> (default), a default file name will be used.</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_savedir">saveDir</code></td>
<td>
<p>a character string specifying a path for <code>dataFile</code>. If supplied, the output is also saved as an <code>.RData</code> file in this directory; otherwise the output is returned as a list.</p>
</td></tr>
<tr><td><code id="monitorTrial_+3A_verbose">verbose</code></td>
<td>
<p>a logical value indicating whether information on the output directory, file name, and monitoring outcomes should be printed out (default is <code>TRUE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>All time variables use week as the unit of time. Month is defined as 52/12 weeks.
</p>
<p>Potential harm monitoring starts at the <code>harmMonitorRange[1]</code>-th infection pooled over the placebo group and the vaccine regimen that accrues infections the fastest. The potential harm analyses continue at each additional infection until the first interim analysis for non-efficacy. The monitoring is implemented with exact one-sided binomial tests of H0: <code class="reqn">p \le p0</code> versus H1: <code class="reqn">p &gt; p0</code>, where <code class="reqn">p</code> is the probability that an infected participant was assigned to the vaccine group, and <code class="reqn">p0</code> is a fixed constant that represents the null hypothesis that an infection is equally likely to be assigned vaccine or placebo. Each test is performed at the same prespecified nominal/unadjusted alpha-level (<code>alphaPerTest</code>), chosen based on simulations such that, for each vaccine regimen, the overall type I error rate by the <code>harmMonitorRange[2]</code>-th arm-pooled infection (i.e., the probability that the potential harm boundary is reached when the vaccine is actually safe, <code class="reqn">p = p0</code>) equals <code>harmMonitorAlpha</code>.
</p>
<p>Non-efficacy is defined as evidence that it is highly unlikely that the vaccine has a beneficial effect measured as VE(0&ndash;<code>stage1</code>) of <code>upperVEnoneff</code> x 100% or more. The non-efficacy analyses for each vaccine regimen will start at the first infection (pooled over the vaccine and placebo arm) determined by <code>nonEffStartMethod</code>. Stopping for non-efficacy will lead to a reported two-sided (1-<code>alphaNoneff</code>) x 100% CI for VE(0&ndash;<code>stage1</code>) with, optionally, the lower confidence bound below <code>lowerVEnoneff</code> and the upper confidence bound below <code>upperVEnoneff</code>, where <code>estimand</code> determines the choice of the VE(0&ndash;<code>stage1</code>) estimand. This approach is similar to the inefficacy monitoring approach of Freidlin, Korn, and Gray (2010). If <code>estimand = "combined"</code>, stopping for non-efficacy will lead to reported (1-<code>alphaNoneff</code>) x 100% CIs for both VE parameters with, optionally, lower confidence bounds below <code>lowerVEnoneff</code> and upper confidence bounds below <code>upperVEnoneff</code>. If <code>laggedMonitoring = TRUE</code>, stopping for non-efficacy will lead to reported (1-<code>alphaNoneff</code>) x 100% CIs for both VE(0&ndash;<code>stage1</code>) and VE(<code>lagTime</code>&ndash;<code>stage1</code>) with, optionally, lower confidence bounds below <code>lowerVEnoneff</code> and upper confidence bounds below <code>upperVEnoneff</code>.
</p>
<p>High efficacy monitoring allows early detection of a highly protective vaccine if there is evidence that VE(0&ndash;<code>stage2</code>) <code class="reqn">&gt;</code> <code>highVE</code> x 100%. It is synchronized with non-efficacy monitoring during Stage 1, and a single high-efficacy interim analysis during Stage 2 is conducted halfway between the end of Stage 1 and the end of the trial. While monitoring for potential harm and non-efficacy restricts to <code>stage1</code> infections, monitoring for high efficacy counts all infections during <code>stage1</code> or <code>stage2</code>, given that early stopping for high efficacy would only be warranted under evidence for durability of the efficacy.
</p>
<p>The following principles and rules are applied in the monitoring procedure:
</p>

<ul>
<li><p> Exclude all follow-up data from the analysis post-unblinding (and include all data pre-unblinding).
</p>
</li>
<li><p> The monitoring is based on modified ITT analysis, i.e., all subjects documented to be free of the study endpoint at baseline are included and analyzed according to the treatment assigned by randomization, ignoring how many vaccinations they received (only pre-unblinding follow-up included).
</p>
</li>
<li><p> If a vaccine hits the harm boundary, immediately discontinue vaccinations and accrual into this vaccine arm, and unblind this vaccine arm (continue post-unblinded follow-up until the end of Stage 1 for this vaccine arm).  
</p>
</li>
<li><p> If a vaccine hits the non-efficacy boundary, immediately discontinue vaccinations and accrual into this vaccine arm, keep blinded and continue follow-up until the end of Stage 1 for this vaccine arm. 
</p>
</li>
<li><p> If and when the last vaccine arm hits the non-efficacy (or harm) boundary, discontinue vaccinations and accrual into this vaccine arm, and unblind (the trial is over, completed in Stage 1).
</p>
</li>
<li><p> Stage 1 for the whole trial is over on the earliest date of the two events: (1) all vaccine arms have hit the harm or non-efficacy boundary; and (2) the last enrolled subject in the trial reaches the final <code>stage1</code> visit.
</p>
</li>
<li><p> Continue blinded follow-up until the end of Stage 2 for each vaccine arm that reaches the end of <code>stage1</code> with a positive efficacy (as defined by <code>stage1VE</code>) or high efficacy (as defined by <code>highVE</code>) result.
</p>
</li>
<li><p> If at least one vaccine arm reaches the end of <code>stage1</code> with a positive efficacy or high efficacy result, continue blinded follow-up in the placebo arm until the end of Stage 2.
</p>
</li>
<li><p> Stage 2 for the whole trial is over on the earliest date of the two events: (1) all subjects in the placebo arm and each vaccine arm that registered efficacy or high efficacy in <code>stage1</code> have failed or been censored; and (2) all subjects in the placebo arm and each vaccine arm that registered efficacy or high efficacy in <code>stage1</code> have completed the final <code>stage2</code> visit.
</p>
</li></ul>

<p>The above rules have the following implications:
</p>

<ul>
<li><p> If a vaccine hits the non-efficacy boundary but Stage 1 for the whole trial is not over, then one includes in the analysis all follow-up through the final <code>stage1</code> visit for that vaccine regimen, including all individuals accrued up through the date of hitting the non-efficacy boundary (which will be the total number accrued to this vaccine arm).
</p>
</li>
<li><p> If a vaccine hits the harm boundary, all follow-up information through the date of hitting the harm boundary is included for this vaccine; no follow-up data are included after this date.
</p>
</li>
<li><p> If and when the last vaccine arm hits the non-efficacy (or harm) boundary, all follow-up information through the date of hitting the non-efficacy (or harm) boundary is included for this vaccine; no follow-up data are included after this date.
</p>
</li></ul>



<h3>Value</h3>

<p>If <code>saveDir</code> (and, optionally <code>saveFile</code>) is specified, the output list (named <code>out</code>) is saved as an <code>.RData</code> file in <code>saveDir</code> (the path to <code>saveDir</code> is printed); otherwise it is returned. The output object is a list of length equal to the number of simulated trials, each of which is a list of length equal to the number of treatment arms, each of which is a list with (at least) the following components:
</p>

<ul>
<li> <p><code>boundHit</code>: a character string stating the monitoring outcome in this treatment arm, i.e., one of <code>"Harm"</code>, <code>"NonEffInterim"</code>, <code>"NonEffFinal"</code>, <code>"Eff"</code>, or <code>"HighEff"</code>. The first four outcomes can occur in Stage 1, whereas the last outcome can combine data over Stage 1 and Stage 2.
</p>
</li>
<li> <p><code>stopTime</code>: the time of hitting a stopping boundary since the first subject enrolled in the trial
</p>
</li>
<li> <p><code>stopInfectCnt</code>: the pooled number of infections at <code>stopTime</code>
</p>
</li>
<li> <p><code>summObj</code>: a <code>data.frame</code> containing summary information from each non-/high efficacy interim analysis
</p>
</li>
<li> <p><code>finalHRci</code>: the final CI for the hazard ratio, available if <code>estimand!="cuminc"</code> and there is at least 1 infection in each arm
</p>
</li>
<li> <p><code>firstNonEffCnt</code>: the number of infections that triggered non-efficacy monitoring (if available)
</p>
</li>
<li> <p><code>totInfecCnt</code>: the total number of <code>stage1</code> (<code>stage2</code> if <code>boundHit = "HighEff"</code>) infections
</p>
</li>
<li> <p><code>totInfecSplit</code>: a table with the numbers of <code>stage1</code> (<code>stage2</code> if <code>boundHit = "HighEff"</code>) infections in the treatment and control arm
</p>
</li>
<li> <p><code>lastExitTime</code>: the time between the first subject's enrollment and the last subject's exiting from the trial
</p>
</li></ul>



<h3>References</h3>

<p>Freidlin B., Korn E. L., and Gray R. (2010), A general inefficacy interim monitoring rule for randomized clinical trials. <em>Clinical Trials</em> 7(3):197-208.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+simTrial">simTrial</a></code>, <code><a href="#topic+censTrial">censTrial</a></code>, and <code><a href="#topic+rankTrial">rankTrial</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>simData &lt;- simTrial(N=c(1000, rep(700, 2)), aveVE=seq(0, 0.4, by=0.2), 
                    VEmodel="half", vePeriods=c(1, 27, 79), enrollPeriod=78, 
                    enrollPartial=13, enrollPartialRelRate=0.5, dropoutRate=0.05, 
                    infecRate=0.04, fuTime=156, 
                    visitSchedule=c(0, (13/3)*(1:4), seq(13*6/3, 156, by=13*2/3)),
                    missVaccProb=c(0,0.05,0.1,0.15), VEcutoffWeek=26, nTrials=5, 
                    stage1=78, randomSeed=300)
   
monitorData &lt;- monitorTrial(dataFile=simData, stage1=78, stage2=156, 
                            harmMonitorRange=c(10,100), alphaPerTest=NULL, 
                            nonEffStartMethod="FKG", nonEffInterval=20, 
                            lowerVEnoneff=0, upperVEnoneff=0.4, highVE=0.7, 
                            stage1VE=0, lowerVEuncPower=0, alphaNoneff=0.05,
                            alphaHigh=0.05, alphaStage1=0.05, alphaUncPower=0.05,
                            estimand="cuminc", lagTime=26)
   
### alternatively, to save the .RData output file (no '&lt;-' needed):
###
### simTrial(N=c(1400, rep(1000, 2)), aveVE=seq(0, 0.4, by=0.2), VEmodel="half", 
###          vePeriods=c(1, 27, 79), enrollPeriod=78, enrollPartial=13, 
###          enrollPartialRelRate=0.5, dropoutRate=0.05, infecRate=0.04, fuTime=156, 
###          visitSchedule=c(0, (13/3)*(1:4), seq(13*6/3, 156, by=13*2/3)), 
###          missVaccProb=c(0,0.05,0.1,0.15), VEcutoffWeek=26, nTrials=30, 
###          stage1=78, saveDir="./", randomSeed=300)
###
### monitorTrial(dataFile=
###              "simTrial_nPlac=1400_nVacc=1000_1000_aveVE=0.2_0.4_infRate=0.04.RData", 
###              stage1=78, stage2=156, harmMonitorRange=c(10,100), alphaPerTest=NULL, 
###              nonEffStartMethod="FKG", nonEffInterval=20, lowerVEnoneff=0, 
###              upperVEnoneff=0.4, highVE=0.7, stage1VE=0, lowerVEuncPower=0, 
###              alphaNoneff=0.05, alphaHigh=0.05, alphaStage1=0.05, alphaUncPower=0.05, 
###              estimand="cuminc", lagTime=26, saveDir="./")

</code></pre>

<hr>
<h2 id='rankTrial'>Ranking and Selection, and Head-to-Head Comparison of Individual and Pooled Treatment Arms</h2><span id='topic+rankTrial'></span>

<h3>Description</h3>

<p><code>rankTrial</code> assesses the probability of correctly selecting the winning most efficacious (individual and/or pooled) treatment arm, and assesses power to detect relative treatment efficacy in head-to-head comparisons of (individual and/or pooled) treatment arms.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rankTrial(censFile, idxHighestVE, headHead = NULL, poolHead = NULL,
  lowerVE, stage1, stage2, alpha, saveDir = NULL, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rankTrial_+3A_censfile">censFile</code></td>
<td>
<p>if <code>saveDir = NULL</code>, a list returned by <code>censTrial</code>; otherwise a name (character string) of an <code>.RData</code> file created by <code>censTrial</code></p>
</td></tr>
<tr><td><code id="rankTrial_+3A_idxhighestve">idxHighestVE</code></td>
<td>
<p>an integer value identifying the treatment (vaccine) arm with the true highest VE(0&ndash;<code>stage2</code>)</p>
</td></tr>
<tr><td><code id="rankTrial_+3A_headhead">headHead</code></td>
<td>
<p>a matrix (<code>ncol = 2</code>) of treatment arm indices for head-to-head comparisons, where the treatment with higher efficacy is listed first in each row</p>
</td></tr>
<tr><td><code id="rankTrial_+3A_poolhead">poolHead</code></td>
<td>
<p>a matrix (<code>ncol</code> equals 3 or 4) of treatment arm indices for pooled-arm comparisons, where the pooled treatment with higher efficacy pooled over the first two columns is compared with the (pooled) treatment defined by columns 3 and onward. Ranking and selection of pooled arms is performed separately for each row of <code>poolHead</code>.</p>
</td></tr>
<tr><td><code id="rankTrial_+3A_lowerve">lowerVE</code></td>
<td>
<p>a numeric value defining a &lsquo;winning&rsquo; treatment arm as one with sufficient evidence for rejecting the null hypothesis H0: VE(0&ndash;<code>stage1</code>) <code class="reqn">\le</code> <code>lowerVE</code> x 100% (typically set equal to 0)</p>
</td></tr>
<tr><td><code id="rankTrial_+3A_stage1">stage1</code></td>
<td>
<p>the final week of stage 1 in a two-stage trial</p>
</td></tr>
<tr><td><code id="rankTrial_+3A_stage2">stage2</code></td>
<td>
<p>the final week of stage 2 in a two-stage trial, i.e., the maximum follow-up time</p>
</td></tr>
<tr><td><code id="rankTrial_+3A_alpha">alpha</code></td>
<td>
<p>one minus the nominal confidence level of the two-sided confidence interval used for testing a null hypothesis H0: VE(0&ndash;<code>stage1</code>) <code class="reqn">\le</code> <code class="reqn">b</code> x 100% against an alternative hypothesis H1: VE(0&ndash;<code>stage1</code>) <code class="reqn">&gt;</code> <code class="reqn">b</code> x 100%</p>
</td></tr>
<tr><td><code id="rankTrial_+3A_savedir">saveDir</code></td>
<td>
<p>a character string specifying a path for <code>censFile</code>. If supplied, the output is also saved as an <code>.RData</code> file in this directory; otherwise the output is returned as a list.</p>
</td></tr>
<tr><td><code id="rankTrial_+3A_verbose">verbose</code></td>
<td>
<p>a logical value indicating whether information on the output directory and file name should be printed out (default is <code>TRUE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>All time variables use week as the unit of time. Month is defined as 52/12 weeks.
</p>
<p>The probability of correct treatment selection is defined as the probability that the treatment arm with the highest estimated VE(0&ndash;<code>stage2</code>) is the one with the true highest VE(0&ndash;<code>stage2</code>) and, for this treatment arm, the null hypothesis H0: VE(0&ndash;<code>stage1</code>) <code class="reqn">\le</code> <code>lowerVE</code> x 100% is rejected. If <code>poolHead</code> is specified, the probability of correct pooled treatment selection is assessed for each set of two pooled treatment arms.
</p>
<p>VE(0&ndash;<code class="reqn">t</code>) is estimated as one minus the ratio of Nelson-Aalen-based cumulative incidence functions. The null hypothesis H0: VE(0&ndash;<code class="reqn">t</code>) <code class="reqn">\le</code> <code class="reqn">b</code> x 100% is rejected if the lower bound of the two-sided (1-<code>alpha</code>) x 100% confidence interval for VE(0&ndash;<code class="reqn">t</code>) lies above <code class="reqn">b</code>.
</p>
<p>For head-to-head individual and pooled treatment comparisons, powers to reject the null hypotheses that relative VE(0&ndash;<code>stage1</code>) <code class="reqn">\le</code> 0% and relative VE(0&ndash;<code>stage2</code>) <code class="reqn">\le</code> 0% are assessed using the aforementioned testing rule.
</p>


<h3>Value</h3>

<p>If <code>saveDir</code> is specified, the output list (named <code>out</code>) is saved as an <code>.RData</code> file in <code>saveDir</code> (the path to <code>saveDir</code> is printed); otherwise it is returned. The output object is a list with the following components:
</p>

<ul>
<li> <p><code>rankSelectPw</code>: the probability of correct selection of the winning most efficacious individual treatment
</p>
</li>
<li> <p><code>headHeadPw</code>: if <code>headHead</code> is specified, a matrix of powers to detect relative VE(0&ndash;<code>stage1</code>) (column 1) and relative VE(0&ndash;<code>stage2</code>) (column 2) in head-to-head comparisons of individual treatment arms
</p>
</li>
<li> <p><code>poolRankSelectPw</code>: if <code>poolHead</code> is specified, a numeric vector of the probabilities of correct selection of the winning most efficacious pooled treatment for each set of pooled treatments
</p>
</li>
<li> <p><code>poolHeadPw</code>: if <code>poolHead</code> is specified, a matrix of powers to detect relative VE(0&ndash;<code>stage1</code>) (column 1) and relative VE(0&ndash;<code>stage2</code>) (column 2) in head-to-head comparisons of pooled treatment arms
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+simTrial">simTrial</a></code>, <code><a href="#topic+monitorTrial">monitorTrial</a></code>, and <code><a href="#topic+censTrial">censTrial</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
simData &lt;- simTrial(N=c(1000, rep(700, 2)), aveVE=seq(0, 0.4, by=0.2), 
                    VEmodel="half", vePeriods=c(1, 27, 79), enrollPeriod=78, 
                    enrollPartial=13, enrollPartialRelRate=0.5, dropoutRate=0.05, 
                    infecRate=0.04, fuTime=156, 
                    visitSchedule=c(0, (13/3)*(1:4), seq(13*6/3, 156, by=13*2/3)),
                    missVaccProb=c(0,0.05,0.1,0.15), VEcutoffWeek=26, nTrials=5, 
                    stage1=78, randomSeed=300)

monitorData &lt;- monitorTrial(dataFile=simData, stage1=78, stage2=156, 
                            harmMonitorRange=c(10,100), alphaPerTest=NULL, 
                            nonEffStartMethod="FKG", nonEffInterval=20, 
                            lowerVEnoneff=0, upperVEnoneff=0.4, 
                            highVE=0.7, stage1VE=0, lowerVEuncPower=0, 
                            alphaNoneff=0.05, alphaHigh=0.05, alphaStage1=0.05, 
                            alphaUncPower=0.05, estimand="cuminc", lagTime=26)

censData &lt;- censTrial(dataFile=simData, monitorFile=monitorData, stage1=78, stage2=156)
                       
rankData &lt;- rankTrial(censFile=censData, idxHighestVE=2, 
                      headHead=matrix(2:1, nrow=1, ncol=2), lowerVE=0, stage1=78, 
                      stage2=156, alpha=0.05)

### alternatively, to save the .RData output file (no '&lt;-' needed):
###
### simTrial(N=c(1400, rep(1000, 2)), aveVE=seq(0, 0.4, by=0.2), VEmodel="half", 
###          vePeriods=c(1, 27, 79), enrollPeriod=78, enrollPartial=13, 
###          enrollPartialRelRate=0.5, dropoutRate=0.05, infecRate=0.04, fuTime=156, 
###          visitSchedule=c(0, (13/3)*(1:4), seq(13*6/3, 156, by=13*2/3)), 
###          missVaccProb=c(0,0.05,0.1,0.15), VEcutoffWeek=26, nTrials=30, 
###          stage1=78, saveDir="./", randomSeed=300)
###
### monitorTrial(dataFile=
###          "simTrial_nPlac=1400_nVacc=1000_1000_aveVE=0.2_0.4_infRate=0.04.RData", 
###          stage1=78, stage2=156, harmMonitorRange=c(10,100), alphaPerTest=NULL, 
###          nonEffStartMethod="FKG", nonEffInterval=20, 
###          lowerVEnoneff=0, upperVEnoneff=0.4, highVE=0.7, stage1VE=0, 
###          lowerVEuncPower=0, alphaNoneff=0.05, alphaHigh=0.05, alphaStage1=0.05, 
###          alphaUncPower=0.05, estimand="cuminc", lagTime=26, saveDir="./")
###
### censTrial(dataFile=
###  "simTrial_nPlac=1400_nVacc=1000_1000_aveVE=0.2_0.4_infRate=0.04.RData",
###  monitorFile=
###  "monitorTrial_nPlac=1400_nVacc=1000_1000_aveVE=0.2_0.4_infRate=0.04_cuminc.RData",
###  stage1=78, stage2=156, saveDir="./")
###
### rankTrial(censFile=
###  "trialDataCens_nPlac=1400_nVacc=1000_1000_aveVE=0.2_0.4_infRate=0.04_cuminc.RData",
###  idxHighestVE=2, headHead=matrix(2:1, nrow=1, ncol=2), lowerVE=0, stage1=78, 
###  stage2=156, alpha=0.05, saveDir="./")

</code></pre>

<hr>
<h2 id='simTrial'>Simulation of Multi-Arm Randomized Phase IIb/III  Efficacy Trials with Time-to-Event Endpoints</h2><span id='topic+simTrial'></span>

<h3>Description</h3>

<p><code>simTrial</code> generates independent time-to-event data-sets according to a user-specified trial design. The user makes assumptions about the enrollment, dropout, and infection processes in each treatment arm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simTrial(N, aveVE, VEmodel = c("half", "constant"), vePeriods,
  enrollPeriod, enrollPartial, enrollPartialRelRate, dropoutRate,
  infecRate, fuTime, visitSchedule, missVaccProb = NULL, VEcutoffWeek,
  nTrials, blockSize = NULL, stage1, saveFile = NULL, saveDir = NULL,
  verbose = TRUE, randomSeed = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simTrial_+3A_n">N</code></td>
<td>
<p>a numeric vector specifying the numbers of enrolled trial participants per treatment arm. The length of <code>N</code> equals the total number of treatment arms, and the first component of <code>N</code> represents the control arm.</p>
</td></tr>
<tr><td><code id="simTrial_+3A_aveve">aveVE</code></td>
<td>
<p>a numeric vector containing, for each treatment arm in <code>N</code>, a time-averaged vaccine efficacy (VE), defined as the weighted average of VEs in the time intervals specified by <code>vePeriods</code>. If <code>VEmodel = "half"</code>, VE is halved in the initial interval, the full VE is applied in the second interval, and <code>aveVE</code> is applied thereafter. The components of <code>N</code> and <code>aveVE</code> correspond to each other.</p>
</td></tr>
<tr><td><code id="simTrial_+3A_vemodel">VEmodel</code></td>
<td>
<p>a character string specifying whether VE is assumed constant over time (option &quot;<code>constant</code>&quot;) or halved in the initial time interval as defined in <code>vePeriods</code> (option &quot;<code>half</code>&quot;). Only the first character is necessary.</p>
</td></tr>
<tr><td><code id="simTrial_+3A_veperiods">vePeriods</code></td>
<td>
<p>a numeric vector defining start times (in weeks) of time intervals with (potentially) distinct VE levels depending on the choice of the <code>VEmodel</code></p>
</td></tr>
<tr><td><code id="simTrial_+3A_enrollperiod">enrollPeriod</code></td>
<td>
<p>the final week of the enrollment period</p>
</td></tr>
<tr><td><code id="simTrial_+3A_enrollpartial">enrollPartial</code></td>
<td>
<p>the final week of the portion of the enrollment period with a reduced enrollment rate defined by <code>enrollPartialRelRate</code></p>
</td></tr>
<tr><td><code id="simTrial_+3A_enrollpartialrelrate">enrollPartialRelRate</code></td>
<td>
<p>a non-negative value characterizing the fraction of the weekly enrollment rate governing enrollment from week 1 until week <code>enrollPartial</code></p>
</td></tr>
<tr><td><code id="simTrial_+3A_dropoutrate">dropoutRate</code></td>
<td>
<p>a (prior) annual dropout rate</p>
</td></tr>
<tr><td><code id="simTrial_+3A_infecrate">infecRate</code></td>
<td>
<p>a (prior) annual infection rate in the control arm</p>
</td></tr>
<tr><td><code id="simTrial_+3A_futime">fuTime</code></td>
<td>
<p>a follow-up time (in weeks) of each participant</p>
</td></tr>
<tr><td><code id="simTrial_+3A_visitschedule">visitSchedule</code></td>
<td>
<p>a numeric vector listing the visit weeks at which testing for the endpoint is conducted</p>
</td></tr>
<tr><td><code id="simTrial_+3A_missvaccprob">missVaccProb</code></td>
<td>
<p>a numeric vector with conditional probabilities of having missed a vaccination given the follow-up time exceeds <code>VEcutoffWeek</code> weeks. For each component, a separate per-protocol indicator is generated. Each per-protocol cohort includes subjects with (i) a non-missing vaccination, and (ii) follow-up time exceeding <code>VEcutoffWeek</code> weeks. If <code>NULL</code>, no per-protocol indicators are included.</p>
</td></tr>
<tr><td><code id="simTrial_+3A_vecutoffweek">VEcutoffWeek</code></td>
<td>
<p>a time cut-off (in weeks); the follow-up time exceeding <code>VEcutoffWeek</code> weeks is required for inclusion in the per-protocol cohort</p>
</td></tr>
<tr><td><code id="simTrial_+3A_ntrials">nTrials</code></td>
<td>
<p>the number of trials to be simulated</p>
</td></tr>
<tr><td><code id="simTrial_+3A_blocksize">blockSize</code></td>
<td>
<p>a constant block size to be used in permuted-block randomization. The choice of <code>blockSize</code> requires caution to achieve the desired balance of treatment assignments within a block.</p>
</td></tr>
<tr><td><code id="simTrial_+3A_stage1">stage1</code></td>
<td>
<p>the final week of stage 1 in a two-stage trial</p>
</td></tr>
<tr><td><code id="simTrial_+3A_savefile">saveFile</code></td>
<td>
<p>a character string specifying the name of the output <code>.RData</code> file. If <code>NULL</code> (default), a default file name will be used.</p>
</td></tr>
<tr><td><code id="simTrial_+3A_savedir">saveDir</code></td>
<td>
<p>a character string specifying a path for the output directory. If supplied, the output is saved as an <code>.RData</code> file in the directory; otherwise the output is returned as a list.</p>
</td></tr>
<tr><td><code id="simTrial_+3A_verbose">verbose</code></td>
<td>
<p>a logical value indicating whether information on the output directory and file name should be printed out (default is <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="simTrial_+3A_randomseed">randomSeed</code></td>
<td>
<p>sets seed of the random number generator for simulation reproducibility</p>
</td></tr>
</table>


<h3>Details</h3>

<p>All time variables use week as the unit of time. Month is defined as 52/12 weeks.
</p>
<p>The prior weekly enrollment rate is calculated based on the duration of the enrollment periods with reduced/full enrollment rates and the total number of subjects to be enrolled.
</p>
<p>The weekly enrollment, dropout and infection rates used for generating trial data are sampled from specified prior distributions (the prior annual dropout and infection probabilities are specified by the user). The default choice considers non-random point-mass distributions, i.e., the prior rates directly govern the accumulation of trial data.
</p>
<p>Subjects' enrollment is assumed to follow a Poisson process with a time-varying rate (the argument <code>enrollPartialRelRate</code> characterizes a reduced enrollment rate applied to weeks 1 through <code>enrollPartial</code>, i.e., full enrollment starts at week <code>enrollPartial</code>+1). The number of enrolled subjects is determined by the vector <code>N</code>.
</p>
<p>Dropout times are assumed to follow an exponential distribution where the probability of a dropout within 1 week is equal to <code>dropoutRate</code>/52.
</p>
<p>Permuted-block randomization is used for assigning treatment labels. If left unspecified by the user, an appropriate block size, no smaller than 10, will computed and used.  The function <code>getBlockSize</code> can be used to determine appropriate block sizes (see help(getBlockSize)).
</p>
<p>Infection times are generated following the VE schedule characterized by <code>aveVE</code>, <code>VEmodel</code> and <code>vePeriods</code>. Independent exponential times are generated within each time period of constant VE, and their minimum specifies the right-censored infection time. Exponential rates are chosen that satisfy the user-specified requirements on the treatment- and time-period-specific probabilities of an infection within 1 week (in the control arm, the infection probability within 1 week uniformly equals <code>infecRate</code>/52).
</p>
<p>Infection diagnosis times are calculated according to the <code>visitSchedule</code>. The observed follow-up time is defined as the minumum of the infection diagnosis time, dropout time, and <code>fuTime</code>.


</p>


<h3>Value</h3>

<p>If <code>saveDir</code> is specified, the output list (named <code>trialObj</code>) is saved as an <code>.RData</code> file (the output directory path is printed); otherwise it is returned. The output object is a list with the following components:
</p>

<ul>
<li> <p><code>trialData</code>: a list with <code>nTrials</code> components each of which is a <code>data.frame</code> with at least the variables <code>trt</code>, <code>entry</code>, <code>exit</code>, and <code>event</code> storing the treatment assignments, enrollment times, study exit times, and event indicators, respectively. The observed follow-up times can be recovered as <code>exit</code> - <code>entry</code>. Indicators of belonging to the per-protocol cohort (named <code>pp1</code>, <code>pp2</code>, etc.) are included if <code>missVaccProb</code> is specified.
</p>
</li>
<li> <p><code>NinfStage1</code>: a list whose components are numeric vectors with the numbers of <code>stage1</code> infections by treatment (<code>[1]</code> = control arm) for each simulated trial
</p>
</li>
<li> <p><code>nTrials</code>: the number of simulated trials
</p>
</li>
<li> <p><code>N</code>: the total number of enrolled trial participants
</p>
</li>
<li> <p><code>nArms</code>: the number of treatment arms
</p>
</li>
<li> <p><code>trtAssgnProbs</code>: a numeric vector containing the treatment assignment probabilities
</p>
</li>
<li> <p><code>blockSize</code>: the block size used for treatment assignment
</p>
</li>
<li> <p><code>fuTime</code>: the follow-up time (in weeks) of each participant
</p>
</li>
<li> <p><code>rates</code>: a list with three components: the prior weekly enrollment rate (<code>enrollment</code>), the prior probability of dropout within 1 week (<code>dropout</code>), and the prior probability of infection within 1 week (<code>infection</code>)
</p>
</li>
<li> <p><code>enrollSchedule</code>: a <code>data.frame</code> summarizing information on enrollment periods and corresponding relative enrollment rates (relative to the weekly &quot;base&quot; enrollment rate). The column names are <code>start</code>, <code>end</code>, and <code>relativeRates</code>.
</p>
</li>
<li> <p><code>VEs</code>: a list with components being numeric vectors containing VE levels assumed within time periods defined by <code>vePeriods</code> for each active treatment arm
</p>
</li>
<li> <p><code>infecRates</code>: a <code>data.frame</code> summarizing information on time periods of distinct VE across all treatment arms. The variables <code>trt</code>, <code>start</code>, <code>end</code>, and <code>relRate</code> carry treatment assignment labels, first and last week of a time interval, and the pertaining assumed hazard ratio in the given interval.
</p>
</li>
<li> <p><code>randomSeed</code>: the set seed of the random number generator for simulation reproducibility
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+monitorTrial">monitorTrial</a></code>, <code><a href="#topic+censTrial">censTrial</a></code>, and <code><a href="#topic+rankTrial">rankTrial</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
simData &lt;- simTrial(N=c(1000, rep(700, 2)), aveVE=seq(0, 0.4, by=0.2), 
                    VEmodel="half", vePeriods=c(1, 27, 79), enrollPeriod=78, 
                    enrollPartial=13, enrollPartialRelRate=0.5, dropoutRate=0.05, 
                    infecRate=0.04, fuTime=156, 
                    visitSchedule=c(0, (13/3)*(1:4), seq(13*6/3, 156, by=13*2/3)),
                    missVaccProb=c(0,0.05,0.1,0.15), VEcutoffWeek=26, nTrials=5, 
                    blockSize=30, stage1=78, randomSeed=300)

### alternatively, to save the .RData output file (no '&lt;-' needed):
###
### simTrial(N=c(1400, rep(1000, 2)), aveVE=seq(0, 0.4, by=0.2), VEmodel="half", 
###          vePeriods=c(1, 27, 79), enrollPeriod=78, enrollPartial=13, 
###          enrollPartialRelRate=0.5, dropoutRate=0.05, infecRate=0.04, fuTime=156, 
###          visitSchedule=c(0, (13/3)*(1:4), seq(13*6/3, 156, by=13*2/3)), 
###          missVaccProb=c(0,0.05,0.1,0.15), VEcutoffWeek=26, nTrials=5, 
###          blockSize=30, stage1=78, saveDir="./", randomSeed=300)

</code></pre>

<hr>
<h2 id='VEpowerPP'>Unconditional Power to Detect Positive Treatment Efficacy in a Per-Protocol Cohort</h2><span id='topic+VEpowerPP'></span>

<h3>Description</h3>

<p><code>VEpowerPP</code> computes unconditional power to detect positive treatment (vaccine) efficacy in per-protocol cohorts identified in <code>simTrial</code>-generated data-sets.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>VEpowerPP(dataList, lowerVEuncPower, alphaUncPower, VEcutoffWeek, stage1,
  outName = NULL, saveDir = NULL, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="VEpowerPP_+3A_datalist">dataList</code></td>
<td>
<p>if <code>saveDir = NULL</code>, a list of objects (lists) returned by <code>censTrial</code>; otherwise a list of <code>.RData</code> file names (character strings) generated by <code>censTrial</code></p>
</td></tr>
<tr><td><code id="VEpowerPP_+3A_lowerveuncpower">lowerVEuncPower</code></td>
<td>
<p>a numeric value specifying a one-sided null hypothesis H0: VE(<code>VEcutoffWeek</code>&ndash;<code>stage1</code>) <code class="reqn">\le</code> <code>lowerVEuncPower</code> x 100%. Unconditional power (i.e., accounting for sequential monitoring) to reject H0 in the per-protocol cohort is calculated, where the rejection region is defined by the lower bound of the two-sided (1-<code>alphaUncPower</code>) x 100% confidence interval for VE(<code>VEcutoffWeek</code>&ndash;<code>stage1</code>) being above <code>lowerVEuncPower</code> (typically a number in the 0&ndash;0.5 range).</p>
</td></tr>
<tr><td><code id="VEpowerPP_+3A_alphauncpower">alphaUncPower</code></td>
<td>
<p>one minus the nominal confidence level of the two-sided confidence interval used to test the one-sided null hypothesis H0: VE(<code>VEcutoffWeek</code>&ndash;<code>stage1</code>) <code class="reqn">\le</code> <code>lowerVEuncPower</code> x 100% against the alternative hypothesis H1: VE(<code>VEcutoffWeek</code>&ndash;<code>stage1</code>) <code class="reqn">&gt;</code> <code>lowerVEuncPower</code> x 100%.</p>
</td></tr>
<tr><td><code id="VEpowerPP_+3A_vecutoffweek">VEcutoffWeek</code></td>
<td>
<p>a cut-off time (in weeks). Only subjects with the follow-up time exceeding <code>VEcutoffWeek</code> are included in the per-protocol cohort.</p>
</td></tr>
<tr><td><code id="VEpowerPP_+3A_stage1">stage1</code></td>
<td>
<p>the final week of stage 1 in a two-stage trial</p>
</td></tr>
<tr><td><code id="VEpowerPP_+3A_outname">outName</code></td>
<td>
<p>a character string specifying the output <code>.RData</code> file name. If <code>outName = NULL</code> but <code>saveDir</code> is specified, the output file is named <code>VEpwPP.RData</code>.</p>
</td></tr>
<tr><td><code id="VEpowerPP_+3A_savedir">saveDir</code></td>
<td>
<p>a character string specifying a path for the output directory. If supplied, the output is saved as an <code>.RData</code> file named <code>outName</code> in the directory; otherwise the output is returned as a list.</p>
</td></tr>
<tr><td><code id="VEpowerPP_+3A_verbose">verbose</code></td>
<td>
<p>a logical value indicating whether information on the output directory and file name should be printed out (default is <code>TRUE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>All time variables use week as the unit of time. Month is defined as 52/12 weeks.
</p>
<p>A per-protocol cohort indicator is assumed to be included in the <code>simTrial</code>-generated data-sets, which is ensured by specifying the <code>missVaccProb</code> argument in <code>simTrial</code>.
</p>
<p>VE(<code>VEcutoffWeek</code>&ndash;<code>stage1</code>) is estimated as one minus the ratio of Nelson-Aalen-based cumulative incidence functions. <code>VEpowerPP</code> computes power to reject the null hypothesis H0: VE(<code>VEcutoffWeek</code>&ndash;<code>stage1</code>) <code class="reqn">\le</code> <code>lowerVEuncPower</code> x 100%. H0 is rejected if the lower bound of the two-sided (1-<code>alphaUncPower</code>) x 100% confidence interval for VE(<code>VEcutoffWeek</code>&ndash;<code>stage1</code>) lies above <code>lowerVEuncPower</code>.
</p>


<h3>Value</h3>

<p>If <code>saveDir</code> is specified, the output list (named <code>pwList</code>) is saved as an <code>.RData</code> file named <code>outName</code> (or <code>VEpwPP.RData</code> if left unspecified); otherwise the output list is returned. The output object is a list (of equal length as <code>dataList</code>) of lists with the following components:
</p>

<ul>
<li> <p><code>VE</code>: a numeric vector of VE(<code>VEcutoffWeek</code>&ndash;<code>stage1</code>) estimates for each missing vaccination probability in <code>missVaccProb</code> of <code>simTrial</code>
</p>
</li>
<li> <p><code>VEpwPP</code>: a numeric vector of powers to reject the null hypothesis H0: VE(<code>VEcutoffWeek</code>&ndash;<code>stage1</code>) <code class="reqn">\le</code> <code>lowerVEuncPower</code> x 100% for each missing vaccination probability in <code>missVaccProb</code> of <code>simTrial</code>
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+simTrial">simTrial</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>simData &lt;- simTrial(N=rep(1000, 2), aveVE=c(0, 0.4), VEmodel="half", 
                    vePeriods=c(1, 27, 79), enrollPeriod=78, 
                    enrollPartial=13, enrollPartialRelRate=0.5, dropoutRate=0.05, 
                    infecRate=0.04, fuTime=156, 
                    visitSchedule=c(0, (13/3)*(1:4), seq(13*6/3, 156, by=13*2/3)),
                    missVaccProb=c(0,0.05,0.1,0.15), VEcutoffWeek=26, nTrials=5, 
                    stage1=78, randomSeed=300)

monitorData &lt;- monitorTrial(dataFile=simData, stage1=78, stage2=156, 
                            harmMonitorRange=c(10,100), alphaPerTest=NULL, 
                            nonEffStartMethod="FKG", nonEffInterval=20, 
                            lowerVEnoneff=0, upperVEnoneff=0.4, 
                            highVE=0.7, stage1VE=0, lowerVEuncPower=0, 
                            alphaNoneff=0.05, alphaHigh=0.05, alphaStage1=0.05, 
                            alphaUncPower=0.05, estimand="cuminc", lagTime=26)

censData &lt;- censTrial(dataFile=simData, monitorFile=monitorData, stage1=78, stage2=156)

VEpwPP &lt;- VEpowerPP(dataList=list(censData), lowerVEuncPower=0, alphaUncPower=0.05,
                    VEcutoffWeek=26, stage1=78)

### alternatively, to save the .RData output file (no '&lt;-' needed):
###
### simTrial(N=rep(1000, 2), aveVE=c(0, 0.4), VEmodel="half", 
###          vePeriods=c(1, 27, 79), enrollPeriod=78, enrollPartial=13, 
###          enrollPartialRelRate=0.5, dropoutRate=0.05, infecRate=0.04, fuTime=156, 
###          visitSchedule=c(0, (13/3)*(1:4), seq(13*6/3, 156, by=13*2/3)), 
###          missVaccProb=c(0,0.05,0.1,0.15), VEcutoffWeek=26, nTrials=5, 
###          stage1=78, saveDir="./", randomSeed=300)
###
### monitorTrial(dataFile=
###          "simTrial_nPlac=1000_nVacc=1000_aveVE=0.4_infRate=0.04.RData", 
###          stage1=78, stage2=156, harmMonitorRange=c(10,100), alphaPerTest=NULL, 
###          nonEffStartMethod="FKG", nonEffInterval=20, 
###          lowerVEnoneff=0, upperVEnoneff=0.4, highVE=0.7, stage1VE=0, 
###          lowerVEuncPower=0, alphaNoneff=0.05, alphaHigh=0.05, alphaStage1=0.05, 
###          alphaUncPower=0.05, estimand="cuminc", lagTime=26, saveDir="./")
###
### censTrial(dataFile=
###  "simTrial_nPlac=1000_nVacc=1000_aveVE=0.4_infRate=0.04.RData",
###  monitorFile=
###  "monitorTrial_nPlac=1000_nVacc=1000_aveVE=0.4_infRate=0.04_cuminc.RData",
###  stage1=78, stage2=156, saveDir="./")
###
### VEpowerPP(dataList=
###  list("trialDataCens_nPlac=1000_nVacc=1000_aveVE=0.4_infRate=0.04_cuminc.RData"),
###  lowerVEuncPower=0, alphaUncPower=0.05, VEcutoffWeek=26, stage1=78, saveDir="./")

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
