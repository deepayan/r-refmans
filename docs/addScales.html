<!DOCTYPE html><html><head><title>Help for package addScales</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {addScales}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#addScales-package'>
<p>Adds Labeled Center Line and Scale Lines/Regions to Trellis Plots</p></a></li>
<li><a href='#addScales'>
<p>Add Scaling Information to Panels in Multi-Panel Trellis Plots</p></a></li>
<li><a href='#CHITemps'>
<p>Daily Chicago High and Low Temperatures in °F</p></a></li>
<li><a href='#NYCTemps'>
<p>Daily New York City High and Low Temperatures in °F</p></a></li>
<li><a href='#panel.addScales'>
<p>Default panelFUN For addScales.trellis</p></a></li>
<li><a href='#prepanel.trim'>
<p>Lattice Prepanel Function to Trim Panel Limits</p></a></li>
<li><a href='#revert'>
<p>Revert A Scaled Trellis Plot To Its Previous Unscaled Form</p></a></li>
<li><a href='#scaleline'>
<p>Extract scaleline list from <code>scaledTrellis</code> object</p></a></li>
<li><a href='#SFTemps'>
<p>Daily San Francisco High and Low Temperatures in °F</p></a></li>
<li><a href='#update.scaledTrellis'>
<p>Update Method for scaledTrellis Objects</p></a></li>
<li><a href='#USAcrime'>
<p>USA Property and Violent Crime Data, 1960 - 2014</p></a></li>
<li><a href='#Utilities'>
<p>Utility Functions for the <span class="pkg">addScales</span> package</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Adds Labeled Center Line and Scale Lines/Regions to Trellis
Plots</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0-1</td>
</tr>
<tr>
<td>Author:</td>
<td>Bert Gunter</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Bert Gunter&lt;bgunter.4567@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Modifies trellis objects by adding horizontal and/or vertical
 reference lines or shaded regions that provide visual scaling information. 
 This is mostly useful in multi-panel plots that use the relation = 'free'
 option in their 'scales' argument list.</td>
</tr>
<tr>
<td>Depends:</td>
<td>lattice (&ge; 0.20-38), R(&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>grid, stats, grDevices</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-06-10 00:06:48 UTC; bgunter</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-06-11 04:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='addScales-package'>
Adds Labeled Center Line and Scale Lines/Regions to Trellis Plots
</h2><span id='topic+addScales-package'></span>

<h3>Description</h3>

<p>Modifies trellis objects by adding horizontal and/or vertical
 reference lines or shaded regions that provide visual scaling information. 
 This is mostly useful in multi-panel plots that use the relation = 'free'
 option in their 'scales' argument list.
</p>


<h3>Details</h3>

<p>The DESCRIPTION file:
</p>

<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> addScales</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Title: </td><td style="text-align: left;"> Adds Labeled Center Line and Scale Lines/Regions to Trellis Plots</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.0-1</td>
</tr>
<tr>
 <td style="text-align: left;">
Author: </td><td style="text-align: left;"> Bert Gunter</td>
</tr>
<tr>
 <td style="text-align: left;">
Maintainer: </td><td style="text-align: left;"> Bert Gunter&lt;bgunter.4567@gmail.com&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
Description: </td><td style="text-align: left;"> Modifies trellis objects by adding horizontal and/or vertical
 reference lines or shaded regions that provide visual scaling information. 
 This is mostly useful in multi-panel plots that use the relation = 'free'
 option in their 'scales' argument list.</td>
</tr>
<tr>
 <td style="text-align: left;">
Depends: </td><td style="text-align: left;"> lattice (&gt;= 0.20-38), R(&gt;= 3.5.0)</td>
</tr>
<tr>
 <td style="text-align: left;">
Imports: </td><td style="text-align: left;"> grid, stats, grDevices</td>
</tr>
<tr>
 <td style="text-align: left;">
Suggests: </td><td style="text-align: left;"> knitr, rmarkdown</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> MIT + file LICENSE</td>
</tr>
<tr>
 <td style="text-align: left;">
Encoding: </td><td style="text-align: left;"> UTF-8</td>
</tr>
<tr>
 <td style="text-align: left;">
LazyData: </td><td style="text-align: left;"> true</td>
</tr>
<tr>
 <td style="text-align: left;">
VignetteBuilder: </td><td style="text-align: left;"> knitr</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>


<p>Index of help topics:
</p>
<pre>
CHITemps                Daily Chicago High and Low Temperatures in °F
NYCTemps                Daily New York City High and Low Temperatures
                        in °F
SFTemps                 Daily San Francisco High and Low Temperatures
                        in °F
USAcrime                USA Property and Violent Crime Data, 1960 -
                        2014
addScales               Add Scaling Information to Panels in
                        Multi-Panel Trellis Plots
addScales-package       Adds Labeled Center Line and Scale
                        Lines/Regions to Trellis Plots
panel.addScales         Default panelFUN For addScales.trellis
prepanel.trim           Lattice Prepanel Function to Trim Panel Limits
revert                  Revert A Scaled Trellis Plot To Its Previous
                        Unscaled Form
scaleline               Extract scaleline list from 'scaledTrellis'
                        object
update.scaledTrellis    Update Method for scaledTrellis Objects
</pre>

<p>Further information is available in the following vignettes:<br /><br />
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>addScales</code> </td><td style="text-align: left;"> The addScales Package (source)</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>Trellised displays are powerful tools for exploring and comparing data. However, one challenge is how to handle plots in which the data in different panels have different locations and, more importantly, different scales/variability. Different locations can be dealt with via the <code>relation = "sliced"</code> option in lattice functions' <code>scales</code> argument. But different scaling sometimes causes plot details in panels with relatively little variability to
be obscured because the data are &ldquo;squashed&rdquo; to accommodate the limits needed to show more variable data in others.
</p>
<p>The <code>addScales</code> function unsquashes such data by varying the panel limits
so that each panel fits just its data. This can easily be done by
using the <code>relation = "free"</code> option in the <code>scales</code> argument. Unfortunately, with more then just a few panels, the separate axis scales for the different panels takes up too much display space and are difficult to read.
</p>
<p><code>addScales</code> addresses this problem by layering minimal location/scale information directly onto the panels. The intent is to save axis space without obscuring the panel data, but still allow the viewer to decode the information to compare the panels.
</p>
<p>A simple API facilitates this task. In addition to the main <code>addScales</code> functions, a generic with an <code>addScales.trellis</code> method, there is an <code>update</code> method to allow the user to easily experiment with and customize the display. A few other functions provide some additional flexibility. Users
desiring other capabilities should contact the author/maintainer with their requests.
</p>


<h3>Author(s)</h3>

<p>Bert Gunter
</p>
<p>Maintainer: Bert Gunter&lt;bgunter.4567@gmail.com&gt;
</p>

<hr>
<h2 id='addScales'>
Add Scaling Information to Panels in Multi-Panel Trellis Plots
</h2><span id='topic+addScales'></span><span id='topic+addScales.trellis'></span>

<h3>Description</h3>

<p>Adds a midline and upper and lower horizontal and/or vertical scale lines
or shaded regions to all panels. Mostly useful when the
<code>relation = "free"</code> option is used in the
<code>scales</code> list to avoid loss of detail in plots from data that vary in
location and scale from panel to panel.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>   addScales(obj, ...)

## S3 method for class 'trellis'
addScales(obj,
         scaleline = list(h = TRUE, v = FALSE),
         legend = list(h = TRUE, v = TRUE),
         ndig.legend = c(h = 2, v = 2),
         legend.aes = list(),
         legend.loc = c("top","bottom","right","left"),
         panelFUN = panel.addScales,
         ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="addScales_+3A_obj">obj</code></td>
<td>

<p>Object on which method dispatch is carried out. Currently only a <code>trellis</code>
method exists.
</p>
</td></tr>
<tr><td><code id="addScales_+3A_scaleline">scaleline</code></td>
<td>

<p>A two component list with component names &quot;h&quot; and &quot;v&quot;. The
&quot;h&quot; component is for (h)orizontal scale lines/regions and &quot;v&quot; is
for(v)ertical. Each of these must be a single logical or numeric value
(and can be mixed in the list, of course). <code>TRUE</code> means: use a
calculated default; <code>FALSE</code> means: don't plot scale lines for
this component; and a numeric value means: use this value. The calculated
or user-supplied value is the distance between the midline and scale lines
= 1/2 the height/width of the shaded region.
A numeric value of 0 is interpreted as <code>FALSE</code> &ndash; don't draw.
However, see the <strong>Details</strong> section below for abbreviated versions that
are also accepted.
</p>
<p><b>Note:</b> Scale lines/regions are only meaningful for <code>"numeric"</code> data as defined
by <code>isTRUE(is.numeric())</code>. The corresponding <code>scaleline</code> component &ndash;
&quot;h&quot; for y-axis data and &quot;v&quot; for x-axis data &ndash; is silently set to <code>FALSE</code> for
anything else.
</p>
</td></tr>
<tr><td><code id="addScales_+3A_legend">legend</code></td>
<td>

<p>A two component list as in <code>scaleline</code> for logical values; or
non-logical values that must either be quoted UTF-8 character strings (which can
include special characters such as ±, which is unicode U + 00B1,
or °, unicode U + 00B0, math symbols, non-ascii language characters,
etc.); or R <code>language</code> objects. See the <strong>Legend Details</strong> section for
further details.
</p>
</td></tr>
<tr><td><code id="addScales_+3A_ndig.legend">ndig.legend</code></td>
<td>

<p>Named or unnamed pair of integer arguments, or a single integer that will be
replicated. The names must be (and are assumed to be if unnamed) &quot;h&quot; and
&quot;v&quot; <em>in that order</em> and give the number of <em>significant</em>
digits to show in the default legend for the corresponding scale lines/region.
Non-integer values are rounded to integer, and values outside the range
of 0 to 15 digits are converted to 2.
</p>
</td></tr>
<tr><td><code id="addScales_+3A_legend.aes">legend.aes</code></td>
<td>

<p>List of <em>aesthetics</em> of the legend text: <code>cex, font,
      fontface, col, etc.</code>. See <code><a href="lattice.html#topic+panel.text">panel.text</a></code> for details.
</p>
</td></tr>
<tr><td><code id="addScales_+3A_legend.loc">legend.loc</code></td>
<td>

<p>One of <code>"top", "bottom", "left",</code> or <code>"right"</code> specifying where the
legend will be placed <em>outside</em> the the trellised panels on the page.
See the <code>legend</code> section of the <code><a href="lattice.html#topic+xyplot">xyplot</a></code> man page for
details, but note that <code>addScales</code> will turn the legend argument into a
list of the required form, so that part of the specification on the man page
can be ignored.
</p>
</td></tr>
<tr><td><code id="addScales_+3A_panelfun">panelFUN</code></td>
<td>

<p>The function used to add scaling details to the panels. Should use
standard trellis/grid functionality.
</p>
</td></tr>
<tr><td><code id="addScales_+3A_...">...</code></td>
<td>

<p>Further arguments, controlling <em>aesthetics</em> of the lines, labels, and/or
fill regions such as color, line width, color palette, line type, etc., passed down to the
<code>panelFUN</code> function. See <code><a href="#topic+panel.addScales">panel.addScales</a></code> for details for the
default panel function.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>As a convenience, abbreviated versions of <code>scaleline</code> and
<code>legend</code> logical arguments can be used instead of the full versions
described above.The abbreviated versions will be translated into the full
versions for use by other functions such as <code>scaleline</code> and
<code>update.scaledTrellis</code>.
</p>
<p>Specifically, a single value of <code>TRUE</code> or <code>FALSE</code> is replicated to
both components of the argument. Thus <code>scaleline = FALSE</code> aborts the
function, since it says not to add scales in either direction. <code>
   legend = FALSE</code> is fine, because it specifies only that legends be omitted.
See the <b>Legend Specification Details</b> section below for why this might be useful.
</p>
<p>If an unnamed list with two components (of the correct form) are given, they are
assumed to be in the order <code>c("h","v")</code>. If a single named component with
name &quot;h&quot; or &quot;v&quot; is given, the missing component is assumed
to be <code>FALSE</code>. Thus, <code>list(v = TRUE), list(FALSE, TRUE)</code>, and
<code>list(h = FALSE, v = TRUE)</code> are all equivalent. A list with a single
unnamed component raises an error.
</p>
<p>The default <code>scaleline</code> calculation assures that all lines/regions fall within the
axis limits of all panels. A (typically user-supplied) <code>scaleline</code>
that fails this criterion will raise a warning and result in some
panels with missing scale lines when <code>scaleType = "line"</code>.
</p>


<h3>Value</h3>

<p>An object of class <code>c("scaledTrellis","trellis")</code> if successful.
Because it inherits from class <code>"trellis"</code>, it can be saved
and/or (automatically) plotted as usual.<br />
</p>
<p><code>NULL</code> invisibly if an error occurs.
</p>
<p>The <code>scaledTrellis</code> object is the original <code>trellis</code> object list
with its <code>panel</code> and <code>legend</code> components modified to add the
scaling information. A new <code>addScales</code> component is also added
that is itself a list with (at least) two components named &quot;orig&quot; and &quot;args&quot;.
The first of these contains the original
<code>panel</code> and <code>legend</code> components of <code>obj</code>. The second
contains either the names and values of the arguments in the call or the computed
values of those arguments. The most important of these is the <code>scaleline</code>
value, which can be extracted using the <code><a href="#topic+scaleline">scaleline</a></code> function by users
who wish to construct their own scale line legends.The remaining values are used
by the update method for <code>scaledTrellis</code> objects.
</p>


<h3>Legend Specification Details</h3>

<p>The default legend is meant to be simple but serviceable. If there are scale lines
in both directions, it will space them horizontally for <code>"top"</code> and <code>
   "bottom"</code> locations and vertically for <code>"right"</code> and <code>"left"</code> to
minimize the space they occupy.
</p>
<p>A user-supplied legend component can be given in two forms: either as a (quoted)
UTF-8 character string, like this: &quot;Scale lines are at ±10° &quot;;
or as a so-called <code>language</code> object. The latter allows the legend to use the
(shortened to the <code>ndig.legend</code> number of digits) <code>scaleline</code> value.
The former does not.
</p>
<p>A detailed discussion of <code>language</code> objects is beyond the scope of this Help
page, but a simple example provides a template that should usually suffice. Suppose,
instead of the default, the desired legend is:
</p>
<p><code style="white-space: pre;">&#8288;     Scale lines are at&#8288;</code> ± <code style="white-space: pre;">&#8288;xxx&#8288;</code>°,
</p>
<p>where the <code style="white-space: pre;">&#8288;scaleline&#8288;</code> value computed by <code>addScales</code> is to be substituted
for the xxx. If xxx were available in the environment of the call
(the <code style="white-space: pre;">&#8288;addScales&#8288;</code> invocation), then one could use something like
(as in the previous paragraph):
</p>
<p><code style="white-space: pre;">&#8288;     paste0("Scale lines are at&#8288;</code> ±
<code style="white-space: pre;">&#8288;",xxx,"&#8288;</code> ° &quot;<code style="white-space: pre;">&#8288;)&#8288;</code>
</p>
<p>as the <code>legend</code> argument. But xxx is not known, because <code>addScales</code>
hasn't calculated it yet. So instead, wrap the paste0 call by the
<code><a href="base.html#topic+quote">quote</a></code> function like this:
</p>
<p><code style="white-space: pre;">&#8288;     quote(paste0("Scale lines are at&#8288;</code> ±
<code style="white-space: pre;">&#8288;",sl,"&#8288;</code> ° &quot;<code style="white-space: pre;">&#8288;))&#8288;</code>
</p>
<p>&lsquo;sl&rsquo; (unquoted) <em>must</em> be used to replace the not-yet-known <code>
   scaleline</code> value. The <code>quote</code> function will pass the whole unevaluated
<code>paste0</code> expression into <code>addScales</code>
where the <code>scaleline</code> value will be calculated and substituted for
<code>sl</code> and the whole expression then evaluated.
Of course, any R expression instead of <code>paste0...</code> can
be used as long as <code>sl</code> is substituted wherever the actual <code>scaleline</code>
value is wanted.
</p>
<p>Another, perhaps slightly clumsier, way to do this &ndash; but which generalizes to
arbitrary <code>scaleline</code> displays as text or graphical objects (so-called
<em>grobs</em>) of any kind &ndash; is simply to run
<code>addScales</code> with <code>legend = FALSE</code> and extract the
<code>scaleline</code> value(s) from the resulting object with the <code>scaleline()</code>
function. The value(s) can then be used in any construction the user wishes to create.
</p>


<h3>Author(s)</h3>

<p>Bert Gunter <a href="mailto:bgunter.4567@gmail.com">bgunter.4567@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="lattice.html#topic+xyplot">xyplot</a></code>,
<code><a href="lattice.html#topic+panel.refline">panel.refline</a></code>,
<code><a href="lattice.html#topic+panel.text">panel.text</a></code>,
<code><a href="#topic+scaleline">scaleline</a></code>,
<code><a href="#topic+panel.addScales">panel.addScales</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>###### Artificial example to show why addScales() might be useful and
###### how it works
##

###### Create a data set whose panels have different
###### centers and scales for y
x &lt;- rep(0:10, 4)

scaling &lt;- rep(c(1, 2, 5, 10), e = 11)

y &lt;- sin(pi*x/10)*scaling + scaling ## add some structure

f &lt;- factor(rep(LETTERS[1:4], e = 11))

## Now add noise proportional to data mean (= constant CV)
set.seed(91834)

y &lt;- y + rnorm(44,sd = scaling/3)

## Plot this with the default "same" scaling and a loess curve

xyplot(y ~ x| f, layout = c(4,1), col = "darkblue",
        scales = list(alternating = 1, tck = c(1,0)),
        panel = function(...){
           panel.points(...)
           panel.loess(..., span = .6, col.line = "blue")
        })

##
## Because of the different scaling, it's somewhat difficult to
## see the common panel data behavior. With relation = "free", it
## becomes clearer:
##
trellis.par.set(plot.symbol = list(col = "darkblue"),
               plot.line = list(col = "darkblue"))

xyplot(y ~ x| f, layout = c(4,1),
       scales = list(alternating = 1, tck = c(1,0),
                     y = list(relation = "free")),
       panel = function(...){
          panel.points(...)
          panel.loess(..., span = .6, col.line = "blue")
       })

##
##  Unfortunately, the y-scales take up a lot of space and are
##  difficult to read. With more panels, they would completely
##  mess things up. To avoid this, don't draw them and use addScales
##  to layer visual scaling onto the panels.
##
freeplot &lt;- xyplot(y ~ x| f, layout = c(4,1),
          scales = list(alternating = 1, tck = c(1,0),
                        y = list(relation = "free", draw = FALSE)),
          panel = function(...){
             panel.points(...)
             panel.loess(..., span = .6, col.line = "blue")
          })

addScales(freeplot) ## using defaults

##
## The labeled midline allows location comparison among the panels.
## The fixed distance from the dashed scale lines to the midline are given
## by the legend at top. This allows scaling among the panels to be
## compared, because the more y varies within a panel, the closer together
## these fixed scale lines become.
##
## NOTE:
## The addScales object inherits from class "trellis", so can be
## saved and plotted in the same way as 'freeplot' was. That is, the
## following also works:
##
 enhanced &lt;- addScales(freeplot)
 enhanced

## Further panel options, which we use the update() method to change,
## allow for color coded scale regions and midlines:
##
#### Warning: Nothing may display if your graphics device does not support
## alpha transparency

 update(enhanced, scaleType = "region", colCode = "r")

##
## cleanup
rm(scaling, x, y, f, freeplot, enhanced)
##
########  Some real examples   #############
############################################

## Historical daily temperatures for Chicago, New York, and San Francisco.
data(CHITemps, NYCTemps, SFTemps)

preprocess.temps &lt;- function(d){
      meanTemp &lt;- with(d, (TMAX + TMIN)/2)
      Month &lt;- months(as.Date(d$DATE))
      z&lt;- aggregate(meanTemp, list(
         Month = factor(Month, levels = unique(Month)),
         Year = as.numeric(substring(d$DATE,1,4))
      ), FUN = mean)
      names(z)[3] &lt;- "meanTemp"
      z
}

## Create a list containing the preprocessed data for all 3 cities
plotdat &lt;- lapply(
   list(CHI = CHITemps, NYC = NYCTemps, SF = SFTemps),
   preprocess.temps)

## Consider NYC. Because of monthly temperature variation, monthly temperature
## histories are mostly whitespace with the default relation = "same".
## Note also the use of the prepanel.trim function with defaults to remove
## extreme y values.
##
## Consider New York City
nyctemps &lt;-
   xyplot(meanTemp ~ Year|Month, type = "l", layout = c(3,4),
          data = plotdat[[2]],
          as.table = TRUE,
          between = list(x=1, y=0),
          ## reduce strip size
          par.strip.text = list(lines = .8, cex = .7),
          ## remove blank space for top axis
          par.settings = list(layout.heights = list(axis.top = 0)),
          prepanel = prepanel.trim, ## to remove possible extreme values
          panel = function(...){
             panel.grid(v = -1, h = 0, col = "gray70")
             panel.xyplot(...)
             panel.loess(..., span = .5, col = "darkred",
             lwd = 1.5)
          },
          scales = list(axs = "i", alternating = 1, tck = c(1,0)),
          xlab = "Year",
          ylab = "Average Temperature (\u00B0F)",
          main = "Mean Monthly Historical Temperatures in NYC"
   )

nyctemps

## Now try it with y-scale = "free' and addScales
##
nyctemps &lt;- update(nyctemps,
   scales = list(axs = "i", alternating = 1,
   tck = c(1,0),y = list(relation = "free", draw = FALSE)))

addScales(nyctemps)

## The historical temperature trend as the city
## built up and modernized (more concrete and asphalt,people,
## heat sources, etc.) is clearer and quantified by the
## legend and scale lines; and the scale lines also show
## that winter temperatures are clearly more variable than summer.
## This was almost undetectable in the previous plot.

## The same plot using region shading instead of scale lines.
## Warning: May not display if your graphics device does not support
## alpha transparency

addScales(nyctemps, scaleType = "region")

## ... and using color coding for midlines and regions to better visually
## distinguish their values...
##
addScales(nyctemps, scaleType = "region", colCode = "r")

## You can repeat the exercise with the other two cities if you like.
## cleanup
rm(nyctemps, preprocess.temps, plotdat)

#######  Historical Crime Data #####

data(USAcrime)

## We explore the relationship beween property and violent crime over time.
## Point transparency via the 'alpha' setting is used to code year
## and the violent vs. property crime relationship is trellised by state
## for a selection of states.
##
## First with scales = "same", the default..

state.smpl &lt;- c("CA","TX","GA","CO","VA","FL","NY","OH","MO","UT","MA","TN")

wh &lt;- USAcrime$State %in% state.smpl

pcols &lt;- hcl.colors(55, rev = TRUE)

crm &lt;-xyplot(allViolent ~ allProperty|State, data = USAcrime[wh,],
             subscripts = TRUE, as.table = TRUE,
             layout = c(4,3), type = c("p", "g"),
             cex= .75,  pch = 19,
             col = pcols[USAcrime[wh,'Year'] -1959],
             par.strip.text = list(lines = .8, cex = .7),
             between = list(x = 1),
             scales = list(axs="i",alternating =1, tck = c(1,0)),
             xlab = "Property Crime Rate (incidents/100,000 population)",
             ylab = "Violent Crime Rate (incidents/100,000 population)",
             main = paste0("Violent vs. Property Crime Rates from 1960-2014 For 12 States"),
             sub = "Point Darkness Codes Years: Darker = Later Years",
             panel = function(subscripts,col,...)
                panel.xyplot(col = col[subscripts],...)
)
crm
## remove the grid and update with
## "free" scales and no axes for both x and y
crm2 &lt;- update(crm, type = "p",
            scales = list(axs="i", relation = "free", draw = FALSE))

## Add scales for both x and y and color code midlines
addScales(crm2, scaleline = TRUE, colCode = "m")

## Some features to note:
##  1. As one might expect, violent and property crime rates are
##   correlated.
##
##  2. Crime rates first increased, peaked, and then decreased over time.
##
##  3. For most states there appears to be a kind of 'hysteresis':
##  the trajectory of the crime decrease is shifted up (higher violent
##  crime rate for the same property rate) from when it increased.
##  This could have been due to a change in reporting procedures,
##  over time, for example.
##
##  4. The midline colors and labels show that NY has the highest
##  violent crime rate, but a modest property crime rate: Tennessee
##  has a middling violent crime rate but the lowest (with VA) property
##  crime rate.
##
##  cleanup
   rm( state.smpl, wh, pcols, crm, crm2)
</code></pre>

<hr>
<h2 id='CHITemps'>
Daily Chicago High and Low Temperatures in °F
</h2><span id='topic+CHITemps'></span>

<h3>Description</h3>

<p>Chicago Midway Airport daily high and low temperatures from 1 March 1928 to 31 December 2019. There are some missing values, and the data are listed in chronological order.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CHITemps</code></pre>


<h3>Format</h3>

<p>A data frame with 32152 observations on the following 3 variables.
</p>

<dl>
<dt><code>DATE</code></dt><dd><p>character vector of form &quot;YYYY-MM-DD&quot;</p>
</dd>
<dt><code>TMAX</code></dt><dd><p>numeric, daily high temperature</p>
</dd>
<dt><code>TMIN</code></dt><dd><p>numeric, daily low temperature</p>
</dd>
</dl>



<h3>Source</h3>

<p>NOAA National Centers for Environmental Information:
Climate Data Online
</p>
<p><a href="https://www.ncdc.noaa.gov/cdo-web/">https://www.ncdc.noaa.gov/cdo-web/</a>
</p>

<hr>
<h2 id='NYCTemps'>
Daily New York City High and Low Temperatures in °F
</h2><span id='topic+NYCTemps'></span>

<h3>Description</h3>

<p>New York City Central Park daily high and low temperatures from 1 January 1870 to 12 December 2019. There are no missing values, and the data are listed in chronological order.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NYCTemps</code></pre>


<h3>Format</h3>

<p>A data frame with 54786 observations on the following 3 variables.
</p>

<dl>
<dt><code>DATE</code></dt><dd><p>character vector of form &quot;YYYY-MM-DD&quot;</p>
</dd>
<dt><code>TMAX</code></dt><dd><p>numeric, daily high temperature</p>
</dd>
<dt><code>TMIN</code></dt><dd><p>numeric, daily low temperature</p>
</dd>
</dl>



<h3>Source</h3>

<p>NOAA National Centers for Environmental Information:
Climate Data Online
</p>
<p><a href="https://www.ncdc.noaa.gov/cdo-web/">https://www.ncdc.noaa.gov/cdo-web/</a>
</p>

<hr>
<h2 id='panel.addScales'>
Default panelFUN For addScales.trellis
</h2><span id='topic+panel.addScales'></span>

<h3>Description</h3>

<p>Adds Labeled Midline and (Unlabeled) Lines or Shaded Regions Showing
Plot Scaling to Trellis Panels.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>   panel.addScales(
   scaleline = c(0,0),
   scaleType = c("line", "region"),
   ndig.midline = c(h = 2, v = 2),
   col.midline = "red",
   adj.midline = c(-0.1, -0.25),
   midline.aes = list(lwd = if(colCode == "n") 1.5 else 3),
   midline.label.aes =list(
      col = if(colCode == "n")col.midline else "black",
      fontface = "bold",
      cex = .8),
   scaleline.aes = list(lty = "dashed", col = "purple"),
   region.aes = list(fill = "tan", alpha = .20),
   colCode = c("n", "m", "r"),
   palette =  hcl.colors(n = 100, "Viridis"),
   ...
   )
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="panel.addScales_+3A_scaleline">scaleline</code></td>
<td>

<p>A numeric vector of length 1 or 2 giving the distance from the scalelines
to the midline(s); or equivalently, the half width(s) of the shaded scale regions.
Signs are ignored. If two values are given, the first is the
(vertical) distance to the horizontal midline and the second is the (horizontal)
distance to the vertical midline. If a single value is given,it is assumed to be the
first and the second is 0. 0 or NA mean: don't add that scaleline/region and midline.
</p>
</td></tr>
<tr><td><code id="panel.addScales_+3A_scaletype">scaleType</code></td>
<td>

<p>Whether the scale distance from the midline is shown by scale lines or as a
shaded region. Note: Use of shaded regions requires that the graphics device
support alpha transparency. Regions will not be shown properly &ndash; or at all &ndash;
if it does not.
</p>
</td></tr>
<tr><td><code id="panel.addScales_+3A_ndig.midline">ndig.midline</code></td>
<td>

<p>Named or unnamed pair of integer arguments, or a single integer that will be replicated.
The names must be (and are assumed to be if unnamed) &quot;h&quot; and &quot;v&quot; <em>in that order</em> and
give the number of <em>significant</em> digits to show in the midline labels for the
corresponding midlines. Non-integer values are rounded to integer, and values outside the
range of 0 to 15digits are converted to 2. However, see the <b>Details</b> section below
for a caveat.
</p>
</td></tr>
<tr><td><code id="panel.addScales_+3A_col.midline">col.midline</code></td>
<td>

<p>Midline color. Can be given in any form suitable for the base <code>col</code>
parameter of <code>par</code>.
</p>
</td></tr>
<tr><td><code id="panel.addScales_+3A_adj.midline">adj.midline</code></td>
<td>

<p><code>numeric</code>: The <code>adj</code> vector of length two that will be fed to <code>panel.text</code>
to position the midline label with respect to the midline. <code>c(.5,.5)</code> centers
the label on the midline and lower limit of the relevant axis
(x-axis for a horizontal midline, so left-center; and y-axis for a vertical
midline, so bottom-center). See the base <code><a href="graphics.html#topic+text">text</a></code> function for details.
</p>
</td></tr>
<tr><td><code id="panel.addScales_+3A_midline.aes">midline.aes</code></td>
<td>

<p>List of <em>aesthetics</em> of midline: <code>lwd, lty, alpha</code>, but
<b>not</b> <code>col</code>, as this is already specified in the
<code>col.midline</code> argument.
</p>
</td></tr>
<tr><td><code id="panel.addScales_+3A_midline.label.aes">midline.label.aes</code></td>
<td>

<p>List of <em>aesthetics</em> of the midline label: <code>col, cex, font,
      fontface, etc.</code>, but not <code>adj</code>, as this is handled by
<code>adj.midline</code>. See <code><a href="lattice.html#topic+panel.text">panel.text</a></code> for argument details.
</p>
</td></tr>
<tr><td><code id="panel.addScales_+3A_scaleline.aes">scaleline.aes</code></td>
<td>

<p>List of <em>aesthetics</em> of the scale lines. Same as for
<code>midline.aes</code> except that <code>col</code> can be specified.
</p>
</td></tr>
<tr><td><code id="panel.addScales_+3A_region.aes">region.aes</code></td>
<td>

<p><code>fill</code> and <code>alpha</code> parameters for shaded scale region.
</p>
</td></tr>
<tr><td><code id="panel.addScales_+3A_colcode">colCode</code></td>
<td>
<p><code>character</code>: Should the midlines and possibly also the scale
regions be color coded by the midline value in the range of all midline values?
Doing this in addition to labeling their values can improve visual comparison
of midline levels among the panels. &quot;m&quot; means color code just the midlines; &quot;r&quot; means
color code both midlines and scale regions; &quot;n&quot;, the default, means do not color code.
</p>
</td></tr>
<tr><td><code id="panel.addScales_+3A_palette">palette</code></td>
<td>
<p>A vector of colors to use for color coding from low to high values.
See <code><a href="grDevices.html#topic+heat.colors">heat.colors</a></code> for how to conveniently specify color palettes.
</p>
</td></tr>
<tr><td><code id="panel.addScales_+3A_...">...</code></td>
<td>

<p>Additional arguments passed down to the panel function, mostly ignored here. But
see the note below for an exception.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Midline values with significant digits that change precision by
&ldquo;small&rdquo; amounts relative to the <code>scaleline</code> values are
<em>zapped</em> by the <code>zapsmall()</code> function to remove extra
digits in the display to improve readability. For example,
a <code>midline</code> value of 1.23 would be shown as 1 when
<code>ndig.midline = 2</code> and <code>scaleline</code> = 100.
</p>


<h3>Value</h3>

<p>No value is returned. This panel function is added to the existing panel
function component of the <code>trellis</code> object on which <code>addScales</code>
dispatches. It adds midline(s) and scale lines or regions to the panels
when they are plotted.
</p>


<h3>Note</h3>

<p>A list, <code>all.panel.limits = list(h = obj$y.limits, v = obj$x.limits)</code>
with these components of the trellis object list is always passed to the
panel function (as part of the ... list). This makes available <em>all</em>
panel limits to the panel function, not just those of its own panel.
This list is used for color coding midlines and/or scale regions,
but is ignored otherwise here. Alternative panel functions may choose to use
this information in other ways.
</p>


<h3>Note</h3>

<p>For the <code>xxx.aes</code> arguments, when the user explicitly specifies the list, any component not specified will default to its formal <code style="white-space: pre;">&#8288;panel.addScales&#8288;</code> argument value if that exists, or to the relevant panel function default if not, i.e. <code>panel.refline</code> for the lines and <code>panel.text</code> for the labels.
</p>


<h3>Author(s)</h3>

<p>Bert Gunter <a href="mailto:bgunter.4567@gmail.com">bgunter.4567@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="grDevices.html#topic+colors">colors</a></code>, <code><a href="graphics.html#topic+par">par</a></code>, <code><a href="lattice.html#topic+panel.refline">panel.refline</a></code>,
<code><a href="lattice.html#topic+panel.text">panel.text</a></code>, <code><a href="graphics.html#topic+text">text</a></code>
</p>

<hr>
<h2 id='prepanel.trim'>
Lattice Prepanel Function to Trim Panel Limits
</h2><span id='topic+prepanel.trim'></span>

<h3>Description</h3>

<p>Trims numeric x and or y limits to specified quantiles. May be useful when unusual extreme values distort the scales and obscure informative features of the data. Scales for factors are not affected.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prepanel.trim(x, y, trim.x = 0, trim.y = 0.05, min.trim = 20, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="prepanel.trim_+3A_x">x</code>, <code id="prepanel.trim_+3A_y">y</code></td>
<td>

<p>x and y values, numeric or factor.
</p>
</td></tr>
<tr><td><code id="prepanel.trim_+3A_trim.x">trim.x</code>, <code id="prepanel.trim_+3A_trim.y">trim.y</code></td>
<td>

<p>Numeric trimming proportions, p, with 0 &lt;= p &lt; .5 .<br />
<code>trim.x</code> and <code>trim.y</code> can be different.
</p>
</td></tr>
<tr><td><code id="prepanel.trim_+3A_min.trim">min.trim</code></td>
<td>

<p>The minimum number of data values needed before trimming
<em>after removing</em> &lsquo;<span class="samp">&#8288;NAs&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;Infs&#8288;</span>&rsquo;. Otherwise the
range of the data is returned (min and max of all the remaining finite
values).
</p>
</td></tr>
<tr><td><code id="prepanel.trim_+3A_...">...</code></td>
<td>

<p>Other arguments, usually ignored
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the trimming proportion is p, the limits returned are essentially
<code>quantile(p, 1-p, type = 8)</code>. See <code><a href="stats.html#topic+quantile">quantile</a></code> for details.
So, for example if p = .1, roughly 10% of the lowest and 10% of the highest values are removed, and the range of the middle 80% of the data are returned. More precisely (quoting from <code><a href="lattice.html#topic+xyplot">xyplot</a></code>), &ldquo;... the actual limits of the panels are guaranteed to include the limits returned by the prepanel function&rdquo; &ndash; i.e., these quantiles.
</p>


<h3>Value</h3>

<p>For numeric data, a numeric vector of length 2, as would be returned by
<code>range</code>. For a factor, a list with components <code>yat</code> and <code>ylim</code>,
as described in the <code>prepanel</code> section of <code><a href="lattice.html#topic+xyplot">xyplot</a></code>
</p>


<h3>Note</h3>

<p>No banking calculations are done.
</p>


<h3>Author(s)</h3>

<p>Bert Gunter <a href="mailto:bgunter.4567@gmail.com">bgunter.4567@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="lattice.html#topic+xyplot">xyplot</a></code>, <code><a href="lattice.html#topic+prepanel.default.xyplot">prepanel.default.xyplot</a></code>,
<code><a href="stats.html#topic+quantile">quantile</a></code>
</p>

<hr>
<h2 id='revert'>
Revert A Scaled Trellis Plot To Its Previous Unscaled Form
</h2><span id='topic+revert.scaledTrellis'></span><span id='topic+revert'></span>

<h3>Description</h3>

<p>S3 generic and scaledTrellis method to remove all scaling information from a <code>scaledTrellis</code> object, returning the prior unscaled trellis object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>revert(obj,...)
## S3 method for class 'scaledTrellis'
revert(obj, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="revert_+3A_obj">obj</code></td>
<td>

<p>An object inheriting from class <code>scaledTrellis</code>.
</p>
</td></tr>
<tr><td><code id="revert_+3A_...">...</code></td>
<td>

<p>Currently ignored   </p>
</td></tr>
</table>


<h3>Details</h3>

<p>Returns the last version of the <code>trellis</code> object with all <code>addScales</code> scales and legends removed. Note that this is <em>not</em> the original <code>trellis</code> object if that was subsequently modified by <code>update</code> calls. See the examples.
</p>


<h3>Value</h3>

<p>A <code>trellis</code> object that can be printed/plotted as usual.
</p>


<h3>Author(s)</h3>

<p>Bert Gunter <a href="mailto:bgunter.4567@gmail.com">bgunter.4567@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+update.scaledTrellis">update.scaledTrellis</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Using simple artificial data
set.seed (2233)
x &lt;- rep(1:10,4)
y &lt;- rnorm(40, mean = rep(seq(10, 25, by = 5), each = 10),
           sd = rep(1:4, each = 10))
f &lt;- rep(c("AA","BB","CC","DD"), each = 10)
##
## trellis plot the data with "free" y axis sxaling
orig &lt;- xyplot(y ~ x|f, type = c("l","p"), col.line = "black",
       scales = list(alternating =1,
                     y = list(relation = "free")),
       as.table = TRUE,
       layout = c(2,2),
       main = "revert() Example"
)
## Plot it
orig

## Remove the y axis scales and add horizontal scalelines
orig &lt;- update(orig, scales = list(alternating =1,
            y = list(relation = "free", draw = FALSE)))
upd1 &lt;- addScales(orig)
## Plot it
upd1
class(upd1)

## revert
upd2 &lt;- revert(upd1)
## Plot it
upd2
class(upd2)

## clean up
rm(x, y, f, orig, upd1, upd2)
</code></pre>

<hr>
<h2 id='scaleline'>
Extract scaleline list from <code>scaledTrellis</code> object
</h2><span id='topic+scaleline'></span><span id='topic+scaleline.scaledTrellis'></span>

<h3>Description</h3>

<p>Extracts the scaleline list from an object inheriting from class  <code>scaledTrellis</code>. This is useful if the user wants to create their own legend rather than using that generated by <code>addScales</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>scaleline(obj, ...)
## S3 method for class 'scaledTrellis'
scaleline(obj, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="scaleline_+3A_obj">obj</code></td>
<td>

<p><code>scaledTrellis</code> object
</p>
</td></tr>
<tr><td><code id="scaleline_+3A_...">...</code></td>
<td>

<p>Possible further arguments for future methods. Ignored at present.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Extracts the <code>scaleline</code> list from a <code>scaledTrellis</code> object. Note that the actual calculated values are returned, not the rounded/formatted values that would be shown in the legend.
</p>


<h3>Value</h3>

<p>A list with components:
</p>

<dl>
<dt>h</dt><dd><p>numeric: distance between horizontal scalelines and midline</p>
</dd>
<dt>v</dt><dd><p>numeric: distance between vertical scalelines and midline</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Bert Gunter <a href="mailto:bgunter.4567@gmail.com">bgunter.4567@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+addScales">addScales</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(8763)
simp &lt;- xyplot(rnorm(10) ~ runif(10))
## Plot it
simp

## Add horizontal and vertical scale lines
ad &lt;-addScales(simp,
 scaleline = TRUE,,
 ndig.midline = 1  ## only 1 digit will be shown
)
## Plot it
ad

## But here are the actual values
## (shown to default number of digits given
## by "digits" argument of print.default)
scaleline(ad)

## cleanup
rm(simp, ad)
</code></pre>

<hr>
<h2 id='SFTemps'>
Daily San Francisco High and Low Temperatures in °F
</h2><span id='topic+SFTemps'></span>

<h3>Description</h3>

<p>San Francisco daily high and low temperatures from 1 March 1949 to 28 February 2020. There are some missing values, and the data are listed in chronological order.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SFTemps</code></pre>


<h3>Format</h3>

<p>A data frame with 22406 observations on the following 3 variables.
</p>

<dl>
<dt><code>DATE</code></dt><dd><p>character vector of form &quot;YYYY-MM-DD&quot;</p>
</dd>
<dt><code>TMAX</code></dt><dd><p>numeric, daily high temperature</p>
</dd>
<dt><code>TMIN</code></dt><dd><p>numeric, daily low temperature</p>
</dd>
</dl>



<h3>Source</h3>

<p>NOAA National Centers for Environmental Information:
Climate Data Online
</p>
<p><a href="https://www.ncdc.noaa.gov/cdo-web/">https://www.ncdc.noaa.gov/cdo-web/</a>
</p>

<hr>
<h2 id='update.scaledTrellis'>
Update Method for scaledTrellis Objects
</h2><span id='topic+update.scaledTrellis'></span>

<h3>Description</h3>

<p>Updates both <code>addScale</code> parameters, including those passed to the <code>panelFUN</code>,
and components of the original <code>trellis</code> object. Note that this may produce
undesirable results if the axis limits are changed via updating trellis
parameters without updating scaleline limits. See the examples.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>   ## S3 method for class 'scaledTrellis'
update(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="update.scaledTrellis_+3A_object">object</code></td>
<td>

<p><code>scaledTrellis</code> object: The object on which method dispatch is carried out.
</p>
</td></tr>
<tr><td><code id="update.scaledTrellis_+3A_...">...</code></td>
<td>

<p>Any number of name = value pairs giving arguments that will be used to update <code>object</code>
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Arguments to <code>addScales</code> and those to (the most recent version of) the original
<code>trellis</code> object are separated and <code>update.trellis</code> is first called on the latter.
This means that any <code>trellis</code> argument changes must satisfy the restrictions
on what <code>update.trellis</code> can change, basically, anything but
the data used for plotting. <em>All</em> <code>addScales</code> and <code>panelFUN</code>
parameters can be changed as long as such changes are possible
(e.g. no scale lines can be added for factors.
</p>


<h3>Value</h3>

<p>The updated object of class <code>c("scaledTrellis","trellis")</code> if successful.<br />
The unmodified object if an error occurs.
</p>


<h3>Author(s)</h3>

<p>Bert Gunter <a href="mailto:bgunter.4567@gmail.com">bgunter.4567@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="lattice.html#topic+update.trellis">update.trellis</a></code>, <code><a href="#topic+addScales">addScales</a></code>,
<code><a href="#topic+panel.addScales">panel.addScales</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Replicate the USAcrimes example in ?addScales
##
data(USAcrime)
state.smpl &lt;- c("CA","TX","GA","CO","VA","FL","NY","OH","MO","UT","MA","TN")
wh &lt;- USAcrime$State %in% state.smpl
pcols &lt;- hcl.colors(n = 55, rev = TRUE)
crm &lt;-xyplot(allViolent ~ allProperty|State, data = USAcrime[wh,],
             subscripts = TRUE,
             as.table = TRUE,
             layout = c(4,3), type = c("p", "g"),
             cex= .75,  pch = 19,
             col = pcols[USAcrime[wh,'Year'] -1959],
             par.strip.text = list(lines = .7, cex = .7),
             between = list(x = 1),
             scales = list(axs="i",relation = "free", draw = FALSE),
             xlab = "Property Crime Rate (incidents/100,000 population)",
             ylab = "Violent Crime Rate (incidents/100,000 population)",
             main = paste0("Violent vs. Property Crime Rates from 1960-2014 For 12 States"),
             sub = "Point Darkness Codes Years: Darker = Later Years",
             panel = function(subscripts,col,...)
                panel.xyplot(col = col[subscripts],...)
   )
crm
ads.1 &lt;- addScales(crm, scaleline = TRUE)
ads.1 ## plot it

## Change the plotting symbol, add a fitted line to the panel,
## remove the grid, change the layout,
## color code the midline and use shaded scale regions instead
## of lines, and put the legend on the right.
##
## Note that the arguments can be given in any order.
## (automatically plotted since no return value)
update(ads.1, pch = 19,layout = c(3,4), type = "p",
       colCode = "m", scaleType = "reg", legend.loc = "right",
       panel = function(x, y,  ...){
          panel.xyplot(x, y,...)
          panel.abline(reg = lm(y ~ x), col = "darkred", lwd = 2)
       }
)

## example of problems that can occur when updating trellis scales without
## updating addScales.
##
## Example from addScales() help:
x &lt;- rep(0:10, 4)
scaling &lt;- rep(c(1, 2, 5, 10), e = 11)
y &lt;- sin(pi*x/10)*scaling + scaling ## add some structure
f &lt;- factor(rep(LETTERS[1:4], e = 11))

## Now add noise proportional to data mean (= constant CV)
set.seed(91834)
y &lt;- y + rnorm(44,sd = scaling/3)

## Plot this with the default "same" scaling and a loess curve

samescale &lt;- xyplot(y ~ x| f, layout = c(4,1), col = "darkblue",
                    scales = list(alternating = 1, tck = c(1,0)),
                    panel = function(...){
                        panel.points(...)
                        panel.loess(..., span = .6, col.line = "blue")
                    })
samescale

## Call addScales and then update scale. This uses update.scaledTrellis:

update(addScales(samescale, scaleType = "region"),
       scales =  list(y = list(relation = "free", draw = FALSE)))

## This will generate a warning message, shown after the examples complete,
## and useless scaleline regions.
##
## Repeat, but now update the scaleline argument of addScales() also:

update(addScales(samescale, scaleType = "region"),
       scaleline = list(h = TRUE, v = FALSE),
       scales =  list(y = list(relation = "free", draw = FALSE))
)

## The updated scale regions are now appropriate.
## This could also have been done by first updating the trellis object
## (which would use the update.trellis method) and **then** calling
## addScales() on that, i.e.

addScales(update(samescale, scales =
                     list(y = list(relation = "free", draw = FALSE))),
          scaleType = "region")
## cleanup
rm(ads.1, crm, pcols, wh, state.smpl, samescale,
   scaling, x, y, f)

</code></pre>

<hr>
<h2 id='USAcrime'>
USA Property and Violent Crime Data, 1960 - 2014
</h2><span id='topic+USAcrime'></span>

<h3>Description</h3>

<p>USA crime rates as incidents/100,000 population by state for several categories of property and violent crimes from 1960 - 2014 (except for New York, which starts in 1965).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("USAcrime")</code></pre>


<h3>Format</h3>

<p>A data frame with 2745 observations on the following 12 variables.
</p>

<dl>
<dt><code>Year</code></dt><dd><p>numeric</p>
</dd>
<dt><code>State</code></dt><dd><p>a factor with <code>state.abb</code> as its levels</p>
</dd>
<dt><code>Population</code></dt><dd><p>estimated population, numeric</p>
</dd>
<dt><code>allViolent</code></dt><dd><p>overall estimated violent crime rate, numeric</p>
</dd>
<dt><code>Homicide</code></dt><dd><p>numeric</p>
</dd>
<dt><code>Rape</code></dt><dd><p>numeric</p>
</dd>
<dt><code>Robbery</code></dt><dd><p>numeric</p>
</dd>
<dt><code>Assault</code></dt><dd><p>numeric</p>
</dd>
<dt><code>allProperty</code></dt><dd><p>overall estimated property crime rate, numeric</p>
</dd>
<dt><code>Burglary</code></dt><dd><p>numeric</p>
</dd>
<dt><code>Larceny</code></dt><dd><p>numeric</p>
</dd>
<dt><code>vehicleTheft</code></dt><dd><p>numeric</p>
</dd>
</dl>



<h3>Details</h3>

<p>Note that these are estimates, and there are various caveats and inconsistencies in definitions and reporting methods among states and over time. Consult the source for details.
</p>


<h3>Note</h3>

<p>The data are ordered by state and year within state. The levels of the (unordered) State factor are <code>state.abb</code> but in the full state name order of <code>state.name</code>. Hence, for example, AL will procede AK and AZ will precede AR in the default ordering of the levels, because Alabama precedes Alaska and Arizona precedes Arkansas in lexicographic order.
</p>


<h3>Source</h3>

<p>FBI Uniform Crime Reporting Statistics
<a href="https://www.ucrdatatool.gov/Search/Crime/State/StatebyState.cfm">https://www.ucrdatatool.gov/Search/Crime/State/StatebyState.cfm</a>
</p>

<hr>
<h2 id='Utilities'>
Utility Functions for the <span class="pkg">addScales</span> package
</h2><span id='topic+parseInputs'></span><span id='topic+buildLegend'></span>

<h3>Description</h3>

<p>Non-exported functions meant for package internal use.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>parseInputs(val)

buildLegend(legend,
   lloc = c("top","bottom","right","left"),
   spacing = 1.3)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Utilities_+3A_val">val</code></td>
<td>

<p><code>scaleline</code> or <code>legend</code> argument of the <code>addScales</code> call to be parsed
</p>
</td></tr>
<tr><td><code id="Utilities_+3A_legend">legend</code></td>
<td>

<p><code>legend</code> list after being parsed: a list of 2 textGrobs with names <code>c("h","v")</code>
</p>
</td></tr>
<tr><td><code id="Utilities_+3A_lloc">lloc</code></td>
<td>

<p>one of &quot;top&quot;,&quot;bottom&quot;,&quot;left&quot;, or &quot;right&quot; where the legend will be placed
</p>
</td></tr>
<tr><td><code id="Utilities_+3A_spacing">spacing</code></td>
<td>

<p>horizontal/vertical spacing between the <code>"h"</code> and
and <code>"v"</code> components of the legend (which depends on
<code>lloc</code>)
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>For <code>parseInputs</code>, properly parsed 2-component lists with component names
&quot;h&quot; and &quot;v&quot; in that order.
</p>
<p>For <code>buildLegend</code>, a  <span class="pkg">grid</span> <code>frameGrob</code> for use as the
<code>fun</code> component for a <code>legend</code> of a <code>trellis</code> object.
</p>


<h3>Author(s)</h3>

<p>Bert Gunter <a href="mailto:bgunter.4567@gmail.com">bgunter.4567@gmail.com</a>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
