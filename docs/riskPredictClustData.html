<!DOCTYPE html><html><head><title>Help for package riskPredictClustData</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {riskPredictClustData}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#genSimDataGLMEM'>
<p>Generate simulated data from logistic mixed effects model based on the AMD data</p></a></li>
<li><a href='#getScore'>
<p>Get data frame for the function riskPredict</p></a></li>
<li><a href='#powerCal'>
<p>Calculate the power for testing <code class="reqn">\delta=0</code></p></a></li>
<li><a href='#powerCalData'>
<p>Calculate the power for testing <code class="reqn">\delta=0</code> based on a dataset</p></a></li>
<li><a href='#riskPredict'>
<p>Assessing risk prediction performance for clustered data</p></a></li>
<li><a href='#riskPredictDiff'>
<p>Difference of two risk prediction rules for clustered data</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Assessing Risk Predictions for Clustered Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.6</td>
</tr>
<tr>
<td>Date:</td>
<td>2018-11-18</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Weiliang Qiu &lt;Weiliang.Qiu@gmail.com&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.4.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>MASS, stats, gee, Hmisc, mvtnorm, utils</td>
</tr>
<tr>
<td>Description:</td>
<td>Assessing and comparing risk prediction rules for clustered data. The method is based on the paper: Rosner B, Qiu W, and Lee MLT.(2013) &lt;<a href="https://doi.org/10.1007%2Fs10985-012-9240-6">doi:10.1007/s10985-012-9240-6</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2018-11-18 15:10:36 UTC; ICSA</td>
</tr>
<tr>
<td>Author:</td>
<td>Bernard Rosner [aut, ctb],
  Weiliang Qiu [aut, cre],
  Meiling T. Lee [aut, ctb]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2018-11-28 08:50:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='genSimDataGLMEM'>
Generate simulated data from logistic mixed effects model based on the AMD data
</h2><span id='topic+genSimDataGLMEM'></span>

<h3>Description</h3>

<p>Generate simulated data from logistic mixed effects model based on the AMD data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>genSimDataGLMEM(
  nSubj = 131, 
  beta0 = -6, 
  sd.beta0i = 1.58, 
  beta1 = 1.58, 
  beta2 = -3.95, 
  beta3 = 3.15, 
  beta4 = 2.06, 
  beta5 = 0.51, 
  beta6 = 1.47, 
  beta7 = 3.11, 
  p.smkcur = 0.08, 
  p.inieye31 = 0.44, 
  p.inieye32 = 0.42, 
  p.inieye41 = 0.12, 
  p.inieye42 = 0.11, 
  sd.lncalorc = 0.33)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="genSimDataGLMEM_+3A_nsubj">nSubj</code></td>
<td>

<p>integer. Number of subjects. Each subject would have data for 2 eyes.
</p>
</td></tr>
<tr><td><code id="genSimDataGLMEM_+3A_beta0">beta0</code></td>
<td>

<p>mean of intercept <code class="reqn">\beta_{0i}</code>, 
which is assumed random and follows normal distribution
<code class="reqn">N(\beta_0, \sigma^2_{\beta})</code>
</p>
</td></tr>
<tr><td><code id="genSimDataGLMEM_+3A_sd.beta0i">sd.beta0i</code></td>
<td>

<p>standard deviation <code class="reqn">\sigma^2_{\beta}</code> of the random intercept 
<code class="reqn">\beta_{0i}</code>.
</p>
</td></tr>
<tr><td><code id="genSimDataGLMEM_+3A_beta1">beta1</code></td>
<td>

<p>slope for the binary covariate <code class="reqn">cursmk</code> (current smoking status).
<code class="reqn">cursmk=1</code> indicates current smokers.
<code class="reqn">cursmk=0</code> indicates past smokers or never smokers.
</p>
</td></tr>
<tr><td><code id="genSimDataGLMEM_+3A_beta2">beta2</code></td>
<td>

<p>slope for the continuous mean-centered covariate <code class="reqn">lncalor_c</code>.
</p>
</td></tr>
<tr><td><code id="genSimDataGLMEM_+3A_beta3">beta3</code></td>
<td>

<p>slope for the binary covariate <code class="reqn">inieye3</code> indicating if an eye of a subject has initial grade equal to 3.
<code class="reqn">inieye3=1</code> indicates the eye has initial grade equal to 3.
</p>
</td></tr>
<tr><td><code id="genSimDataGLMEM_+3A_beta4">beta4</code></td>
<td>

<p>slope for the binary covariate <code class="reqn">inieye4</code> indicating if an eye of a subject has initial grade equal to 4.
<code class="reqn">inieye4=1</code> indicates the eye has initial grade equal to 4.
</p>
</td></tr>
<tr><td><code id="genSimDataGLMEM_+3A_beta5">beta5</code></td>
<td>

<p>slope for the binary covariate <code class="reqn">rtotfat_1</code> indicating if the subject's
total fat intake is in the 2nd quartile of total fat intake.
<code class="reqn">rtotfat_1=1</code> indicates the subject is in the 2nd quartile.
</p>
</td></tr>
<tr><td><code id="genSimDataGLMEM_+3A_beta6">beta6</code></td>
<td>

<p>slope for the binary covariate <code class="reqn">rtotfat_2</code> indicating if the subject's
total fat intake is in the 3rd quartile of total fat intake.
<code class="reqn">rtotfat_2=1</code> indicates the subject is in the 3rd quartile.
</p>
</td></tr>
<tr><td><code id="genSimDataGLMEM_+3A_beta7">beta7</code></td>
<td>

<p>slope for the binary covariate <code class="reqn">rtotfat_3</code> indicating if the subject's
total fat intake is in the 4th quartile of total fat intake.
<code class="reqn">rtotfat_3=1</code> indicates the subject is in the 4th quartile.
</p>
</td></tr>
<tr><td><code id="genSimDataGLMEM_+3A_p.smkcur">p.smkcur</code></td>
<td>

<p>proportion of current smokers.
</p>
</td></tr>
<tr><td><code id="genSimDataGLMEM_+3A_p.inieye31">p.inieye31</code></td>
<td>

<p>proportion of left eye having inital grade equal to 3. 
</p>
</td></tr>
<tr><td><code id="genSimDataGLMEM_+3A_p.inieye32">p.inieye32</code></td>
<td>

<p>proportion of right eye having inital grade equal to 3. 
</p>
</td></tr>
<tr><td><code id="genSimDataGLMEM_+3A_p.inieye41">p.inieye41</code></td>
<td>

<p>proportion of left eye having inital grade equal to 4. 
</p>
</td></tr>
<tr><td><code id="genSimDataGLMEM_+3A_p.inieye42">p.inieye42</code></td>
<td>

<p>proportion of right eye having inital grade equal to 4. 
</p>
</td></tr>
<tr><td><code id="genSimDataGLMEM_+3A_sd.lncalorc">sd.lncalorc</code></td>
<td>

<p>standard deviation for <code class="reqn">lncalor_c</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We generate simulated data set from the following generalized linear mixed effects model:
</p>
<p style="text-align: center;"><code class="reqn">\log\left(\frac{p_{ij}}{(1-p_{ij})}\right)=\beta_{0i}+\beta_1 smkcur_i+
\beta_2 lncalor_{ci} + \beta_3 inieye3_{ij} + \beta_4 inieye4_{ij} 
+\beta_5 rtotfat_{1i} +\beta_6 rtotfat_{2i} + \beta_7 rtotfat_{3i},</code>
</p>

<p><code class="reqn">i=1,\ldots, N, j=1, 2</code>,
<code class="reqn">\beta_{0i}\sim N\left(\beta_0, \sigma^2_{\beta}\right).</code>
</p>


<h3>Value</h3>

<p>A data frame with 8 columns: cid, subuid, prog, smkcur, lncalorc, inieye3, inieye4, and rtotfat,
where cid is the subject id, subuid is the unit id, and prog is the progression status.
<code class="reqn">prog=1</code> indicates the eye is progressed.
<code class="reqn">prog=0</code> indicates the eye is not progressed.
There are <code>nSubj*2</code> rows. The first <code>nSubj</code> rows
are for the left eyes and the second <code>nSubj</code> rows are for the right eyes.
</p>


<h3>Author(s)</h3>

<p>Bernard Rosner &lt;stbar@channing.harvard.edu&gt;, 
Weiliang Qiu &lt;Weiliang.Qiu@gmail.com&gt;, 
Meiling Ting Lee &lt;MLTLEE@umd.edu&gt;
</p>


<h3>References</h3>

<p>Rosner B, Qiu W, and Lee MLT.
Assessing Discrimination of Risk Prediction Rules in a Clustered Data Setting.
Lifetime Data Anal. 2013 Apr; 19(2): 242-256.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(1234567)
datFrame = genSimDataGLMEM(nSubj = 30, beta0 = -6, sd.beta0i = 1.58, 
                          beta1 = 1.58, beta2 = -3.95, beta3 = 3.15, beta4 = 2.06,
                          beta5 = 0.51, beta6 = 1.47, beta7 = 3.11, 
                          p.smkcur = 0.08, p.inieye31 = 0.44, p.inieye32 = 0.42,
                          p.inieye41 = 0.12, p.inieye42 = 0.11, sd.lncalorc = 0.33)
print(dim(datFrame))
print(datFrame[1:2,])
</code></pre>

<hr>
<h2 id='getScore'>
Get data frame for the function riskPredict
</h2><span id='topic+getScore'></span>

<h3>Description</h3>

<p>Get data frame for the function riskPredict.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getScore(fmla, cidVar, subuidVar, statusVar, datFrame, mycorstr = "exchangeable",
  verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getScore_+3A_fmla">fmla</code></td>
<td>
<p>A formula object for the function <code>gee</code></p>
</td></tr>
<tr><td><code id="getScore_+3A_cidvar">cidVar</code></td>
<td>
<p>character. Phenotype variable name for cluster id</p>
</td></tr>
<tr><td><code id="getScore_+3A_subuidvar">subuidVar</code></td>
<td>
<p>character. Phenotype variable name for unit id</p>
</td></tr>
<tr><td><code id="getScore_+3A_statusvar">statusVar</code></td>
<td>
<p>character. Phenotype variable name for progression status</p>
</td></tr>
<tr><td><code id="getScore_+3A_datframe">datFrame</code></td>
<td>

<p>A data frame with at least 3 columns corresponding to <code>cid</code> (indicated by <code>cidVar</code>), 
<code>subuid</code> (indicated by <code>subuidVar</code>), 
<code>status</code> (indicated by <code>statusID</code>).
<code>cid</code> indicates cluster id; <code>subuid</code> indicates unit ID within a cluster;
<code>status=1</code> indicates an eye is progressed;
<code>status=0</code> indicates an eye is not progressed.
</p>
</td></tr>
<tr><td><code id="getScore_+3A_mycorstr">mycorstr</code></td>
<td>
<p>character. indicates correlation structure. see the manual for the function <code>gee</code> in the R library <code>gee</code></p>
</td></tr>
<tr><td><code id="getScore_+3A_verbose">verbose</code></td>
<td>

<p>logical. indicating if summary of gee results should be printed out.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with two elements: <code>frame</code> and <code>gee.obj</code>.
<code>frame</code> is a data frame with at least 4 columns: cid, subuid, status, and score.
<code>cid</code> indicates cluster id; <code>subuid</code> indicates unit ID within a cluster;
<code>status=1</code> indicates an eye is progressed;
<code>status=0</code> indicates an eye is not progressed;
<code>score</code> represents the risk score.
</p>
<p><code>gee.obj</code> is the object returned by <code>gee</code> function.
</p>


<h3>Author(s)</h3>

<p>Bernard Rosner &lt;stbar@channing.harvard.edu&gt;, 
Weiliang Qiu &lt;Weiliang.Qiu@gmail.com&gt;, 
Meiling Ting Lee &lt;MLTLEE@umd.edu&gt;
</p>


<h3>References</h3>

<p>Rosner B, Qiu W, and Lee MLT.
Assessing Discrimination of Risk Prediction Rules in a Clustered Data Setting.
Lifetime Data Anal. 2013 Apr; 19(2): 242-256.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(1234567)
datFrame = genSimDataGLMEM(nSubj = 30, beta0 = -6, sd.beta0i = 1.58, 
                          beta1 = 1.58, beta2 = -3.95, beta3 = 3.15, beta4 = 2.06,
                          beta5 = 0.51, beta6 = 1.47, beta7 = 3.11, 
                          p.smkcur = 0.08, p.inieye31 = 0.44, p.inieye32 = 0.42,
                          p.inieye41 = 0.12, p.inieye42 = 0.11, sd.lncalorc = 0.33)

print(dim(datFrame))
print(datFrame[1:2,])

tt1 = getScore(fmla = prog~smkcur+lncalorc+inieye3+inieye4+factor(rtotfat), 
  cidVar = "cid", subuidVar = "subuid", statusVar = "prog", 
  datFrame = datFrame, mycorstr = "exchangeable",
  verbose = FALSE)
myframe1=tt1$frame

gee.obj=tt1$gee.obj
print(summary(gee.obj))

print(dim(myframe1))
print(myframe1[1:3,])

</code></pre>

<hr>
<h2 id='powerCal'>
Calculate the power for testing <code class="reqn">\delta=0</code>
</h2><span id='topic+powerCal'></span>

<h3>Description</h3>

<p>Calculate the power for testing <code class="reqn">\delta=0</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>powerCal(
  nSubj, 
  mu1, 
  triangle, 
  rho, 
  rho11, 
  rho22, 
  rho12, 
  p11, 
  p10, 
  p01, 
  alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="powerCal_+3A_nsubj">nSubj</code></td>
<td>

<p>integer. number of subjects to be generated. Assume each subject has two observations.
</p>
</td></tr>
<tr><td><code id="powerCal_+3A_mu1">mu1</code></td>
<td>

<p><code class="reqn">\mu_1=H(Y)-H(Y_c)</code> is the difference between probit transformation 
<code class="reqn">H(Y)</code> and probit-shift alternative <code class="reqn">H(Y_c)</code>,
where <code class="reqn">Y</code> is the prediction score of a randomly selected progressing
subunit, and <code class="reqn">Y_c</code> is the counterfactual random variable
obtained if each subunit that had progressed actually had not progressed.
</p>
</td></tr>
<tr><td><code id="powerCal_+3A_triangle">triangle</code></td>
<td>

<p>the difference of the expected value the the extended Mann-Whitney U statistics
between two prediction rules, i.e., <code class="reqn">\triangle = \eta^{(1)}_c - \eta^{(2)}_c</code>
</p>
</td></tr>
<tr><td><code id="powerCal_+3A_rho">rho</code></td>
<td>

<p><code class="reqn">\rho=corr\left(H\left(Z_{ij}\right), H\left(Z_{k\ell}\right)\right)</code>, where <code class="reqn">H=\Phi^{-1}</code> is the probit transformation.
</p>
</td></tr>
<tr><td><code id="powerCal_+3A_rho11">rho11</code></td>
<td>

<p><code class="reqn">\rho_{11}=corr\left(H_{ij}^{(1)}, H_{i\ell}^{(1)}\right)</code>, where <code class="reqn">H=\Phi^{-1}</code> is the probit transformation.
</p>
</td></tr>
<tr><td><code id="powerCal_+3A_rho22">rho22</code></td>
<td>

<p><code class="reqn">\rho_{22}=corr\left(H_{ij}^{(2)}, H_{i\ell}^{(2)}\right)</code>, where <code class="reqn">H=\Phi^{-1}</code> is the probit transformation.
</p>
</td></tr>
<tr><td><code id="powerCal_+3A_rho12">rho12</code></td>
<td>

<p><code class="reqn">\rho_{12}=corr\left(H_{ij}^{(1)}, H_{i\ell}^{(2)}\right)</code>, where <code class="reqn">H=\Phi^{-1}</code> is the probit transformation.
</p>
</td></tr>
<tr><td><code id="powerCal_+3A_p11">p11</code></td>
<td>

<p><code class="reqn">p_{11}=Pr(\delta_{i1}=1 \&amp; \delta_{i2}=1)</code>, where <code class="reqn">\delta_{ij}=1</code> if the <code class="reqn">j</code>-th subunit of the 
<code class="reqn">i</code>-th cluster has progressed.
</p>
</td></tr>
<tr><td><code id="powerCal_+3A_p10">p10</code></td>
<td>

<p><code class="reqn">p_{10}=Pr(\delta_{i1}=1 \&amp; \delta_{i2}=0)</code>, where <code class="reqn">\delta_{ij}=1</code> if the <code class="reqn">j</code>-th subunit of the 
<code class="reqn">i</code>-th cluster has progressed.
</p>
</td></tr>
<tr><td><code id="powerCal_+3A_p01">p01</code></td>
<td>

<p><code class="reqn">p_{01}=Pr(\delta_{i1}=0 \&amp; \delta_{i2}=1)</code>, where <code class="reqn">\delta_{ij}=1</code> if the <code class="reqn">j</code>-th subunit of the 
<code class="reqn">i</code>-th cluster has progressed.
</p>
</td></tr>
<tr><td><code id="powerCal_+3A_alpha">alpha</code></td>
<td>

<p>type I error rate
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the power
</p>


<h3>Author(s)</h3>

<p>Bernard Rosner &lt;stbar@channing.harvard.edu&gt;, 
Weiliang Qiu &lt;Weiliang.Qiu@gmail.com&gt;, 
Meiling Ting Lee &lt;MLTLEE@umd.edu&gt;
</p>


<h3>References</h3>

<p>Rosner B, Qiu W, and Lee MLT.
Assessing Discrimination of Risk Prediction Rules in a Clustered Data Setting.
Lifetime Data Anal. 2013 Apr; 19(2): 242-256.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 

set.seed(1234567)
mu1 = 0.8

power = powerCal(nSubj = 30, mu1 = mu1, 
  triangle = 0.05, rho = 0.93, rho11 = 0.59, rho22 = 0.56, rho12 = 0.52,
  p11 = 0.115, p10 = 0.142, p01 = 0.130, alpha = 0.05)

print(power)



</code></pre>

<hr>
<h2 id='powerCalData'>
Calculate the power for testing <code class="reqn">\delta=0</code> based on a dataset
</h2><span id='topic+powerCalData'></span>

<h3>Description</h3>

<p>Calculate the power for testing <code class="reqn">\delta=0</code> based on a dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>powerCalData(
  nSubj, 
  triangle, 
  frame,
  alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="powerCalData_+3A_nsubj">nSubj</code></td>
<td>

<p>integer. number of subjects to be generated. Assume each subject has two observations.
</p>
</td></tr>
<tr><td><code id="powerCalData_+3A_triangle">triangle</code></td>
<td>

<p>the difference of the expected value the the extended Mann-Whitney U statistics
between two prediction rules, i.e., <code class="reqn">\triangle = \eta^{(1)}_c - \eta^{(2)}_c</code>
</p>
</td></tr>
<tr><td><code id="powerCalData_+3A_frame">frame</code></td>
<td>

<p>A data frame with 5 columns: cid, subuid, status, score1, and score2.
<code>cid</code> indicates cluster id; <code>subuid</code> indicates unit ID within a cluster;
<code>status=1</code> indicates an eye is progressed;
<code>status=0</code> indicates an eye is not progressed;
<code>score1</code> represents the score based on prediction rule 1.
<code>score2</code> represents the score based on prediction rule 2.
</p>
</td></tr>
<tr><td><code id="powerCalData_+3A_alpha">alpha</code></td>
<td>

<p>type I error rate
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with 11 elements. 
</p>
<table>
<tr><td><code>power</code></td>
<td>
<p>the esstimated power</p>
</td></tr>
<tr><td><code>rho</code></td>
<td>

<p><code class="reqn">\rho=corr\left(H\left(Z_{ij}\right), H\left(Z_{k\ell}\right)\right)</code>, where <code class="reqn">H=\Phi^{-1}</code> is the probit transformation.
</p>
</td></tr>
<tr><td><code>rho11</code></td>
<td>

<p><code class="reqn">\rho_{11}=corr\left(H_{ij}^{(1)}, H_{i\ell}^{(1)}\right)</code>, where <code class="reqn">H=\Phi^{-1}</code> is the probit transformation.
</p>
</td></tr>
<tr><td><code>rho22</code></td>
<td>

<p><code class="reqn">\rho_{22}=corr\left(H_{ij}^{(2)}, H_{i\ell}^{(2)}\right)</code>, where <code class="reqn">H=\Phi^{-1}</code> is the probit transformation.
</p>
</td></tr>
<tr><td><code>rho12</code></td>
<td>

<p><code class="reqn">\rho_{12}=corr\left(H_{ij}^{(1)}, H_{i\ell}^{(2)}\right)</code>, where <code class="reqn">H=\Phi^{-1}</code> is the probit transformation.
</p>
</td></tr>
<tr><td><code>p11</code></td>
<td>

<p><code class="reqn">p_{11}=Pr(\delta_{i1}=1 \&amp; \delta_{i2}=1)</code>, where <code class="reqn">\delta_{ij}=1</code> if the <code class="reqn">j</code>-th subunit of the 
<code class="reqn">i</code>-th cluster has progressed.
</p>
</td></tr>
<tr><td><code>p10</code></td>
<td>

<p><code class="reqn">p_{10}=Pr(\delta_{i1}=1 \&amp; \delta_{i2}=0)</code>, where <code class="reqn">\delta_{ij}=1</code> if the <code class="reqn">j</code>-th subunit of the 
<code class="reqn">i</code>-th cluster has progressed.
</p>
</td></tr>
<tr><td><code>p01</code></td>
<td>

<p><code class="reqn">p_{01}=Pr(\delta_{i1}=0 \&amp; \delta_{i2}=1)</code>, where <code class="reqn">\delta_{ij}=1</code> if the <code class="reqn">j</code>-th subunit of the 
<code class="reqn">i</code>-th cluster has progressed.
</p>
</td></tr>
<tr><td><code>p00</code></td>
<td>

<p><code class="reqn">p_{00}=Pr(\delta_{i1}=0 \&amp; \delta_{i2}=0)</code>, where <code class="reqn">\delta_{ij}=1</code> if the <code class="reqn">j</code>-th subunit of the 
<code class="reqn">i</code>-th cluster has progressed.
</p>
</td></tr>
<tr><td><code>mu1</code></td>
<td>

<p><code class="reqn">\mu_1=H(Y)-H(Y_c)</code> is the difference between probit transformation 
<code class="reqn">H(Y)</code> and probit-shift alternative <code class="reqn">H(Y_c)</code> for the first prediction score,
where <code class="reqn">Y</code> is the prediction score of a randomly selected progressing
subunit, and <code class="reqn">Y_c</code> is the counterfactual random variable
obtained if each subunit that had progressed actually had not progressed.
</p>
</td></tr>
<tr><td><code>mu2</code></td>
<td>

<p><code class="reqn">\mu_2=H(Y)-H(Y_c)</code> is the difference between probit transformation 
<code class="reqn">H(Y)</code> and probit-shift alternative <code class="reqn">H(Y_c)</code> for the second prediction score,
where <code class="reqn">Y</code> is the prediction score of a randomly selected progressing
subunit, and <code class="reqn">Y_c</code> is the counterfactual random variable
obtained if each subunit that had progressed actually had not progressed.
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Bernard Rosner &lt;stbar@channing.harvard.edu&gt;, 
Weiliang Qiu &lt;Weiliang.Qiu@gmail.com&gt;, 
Meiling Ting Lee &lt;MLTLEE@umd.edu&gt;
</p>


<h3>References</h3>

<p>Rosner B, Qiu W, and Lee MLT.
Assessing Discrimination of Risk Prediction Rules in a Clustered Data Setting.
Lifetime Data Anal. 2013 Apr; 19(2): 242-256.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

set.seed(1234567)

datFrame = genSimDataGLMEM(nSubj = 30, beta0 = -6, sd.beta0i = 1.58, 
                          beta1 = 1.58, beta2 = -3.95, beta3 = 3.15, beta4 = 2.06,
                          beta5 = 0.51, beta6 = 1.47, beta7 = 3.11, 
                          p.smkcur = 0.08, p.inieye31 = 0.44, p.inieye32 = 0.42,
                          p.inieye41 = 0.12, p.inieye42 = 0.11, sd.lncalorc = 0.33)

print(dim(datFrame))
print(datFrame[1:2,])

# prediction rule 1
tt1 = getScore(fmla = prog~smkcur+lncalorc+inieye3+inieye4+factor(rtotfat), 
  cidVar = "cid", subuidVar = "subuid", statusVar = "prog", 
  datFrame = datFrame, mycorstr = "exchangeable",
  verbose = FALSE)
myframe1=tt1$frame

print(dim(myframe1))
print(myframe1[1:3,])

####
# prediction rule 2
tt2 = getScore(fmla = prog~smkcur+lncalorc+inieye3+inieye4, 
  cidVar = "cid", subuidVar = "subuid", statusVar = "prog", 
  datFrame = datFrame, mycorstr = "exchangeable",
  verbose = FALSE)
myframe2=tt2$frame

print(dim(myframe2))
print(myframe2[1:3,])

# combine scores from two prediction rules
myframe12=myframe1[, c("cid", "subuid", "status")]
myframe12$score1=myframe1$score
myframe12$score2=myframe2$score
print(dim(myframe12))
print(myframe12[1:3,])


res = powerCalData(nSubj = 30, triangle = 0.05, frame=myframe12, alpha = 0.05)

print(res)


</code></pre>

<hr>
<h2 id='riskPredict'>
Assessing risk prediction performance for clustered data
</h2><span id='topic+riskPredict'></span>

<h3>Description</h3>

<p>Assessing risk prediction performance for clustered data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>riskPredict(frame, alpha=0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="riskPredict_+3A_frame">frame</code></td>
<td>

<p>A data frame with 4 columns: cid, subuid, status, and score.
<code>cid</code> indicates cluster id; <code>subuid</code> indicates unit ID within a cluster;
<code>status=1</code> indicates an eye is progressed;
<code>status=0</code> indicates an eye is not progressed;
<code>score</code> represents the risk score.
</p>
</td></tr>
<tr><td><code id="riskPredict_+3A_alpha">alpha</code></td>
<td>

<p>numeric. confidence level for <code class="reqn">eta_c</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To obtain 95% confidence interval of <code class="reqn">\eta_c</code>,
we first obtain 95% confidence interval <code class="reqn">[c_1, c_2]</code>
for 
<code class="reqn">\Phi^{-1}(\eta_c)</code>, then
transform back:
<code class="reqn">[\Phi(c_1), \Phi(c_2)]</code>.
</p>


<h3>Value</h3>

<p>A list of 6 elements:
</p>
<table>
<tr><td><code>stat</code></td>
<td>
<p>the test statistics 
<code class="reqn">\hat{\eta}_c^{(1)}</code>
hateta_c^(1) based on the prediction rule.</p>
</td></tr>
<tr><td><code>se.stat</code></td>
<td>
<p>standard error of the test statistic under the 
null hypothesis.</p>
</td></tr>
<tr><td><code>z</code></td>
<td>
<p>z score <code>z=(stat - 0.5)/se.stat</code></p>
</td></tr>
<tr><td><code>pval</code></td>
<td>
<p>p-value of the test</p>
</td></tr>
<tr><td><code>rho</code></td>
<td>

<p>correlation between <code class="reqn">H(Z_{ij}) and H(Z_{i \ell})</code>
</p>
</td></tr>
<tr><td><code>mu.hat</code></td>
<td>

<p>estimated <code class="reqn">\mu</code>.
</p>
</td></tr>
<tr><td><code>theta.hat</code></td>
<td>

<p>estimated <code class="reqn">\theta</code>.
</p>
</td></tr>
<tr><td><code>theta.c.hat</code></td>
<td>

<p>estimated <code class="reqn">\theta_c</code>.
</p>
</td></tr>
<tr><td><code>E.stat.Ha</code></td>
<td>

<p>expectation of <code class="reqn">\hat{\eta}_c</code> under
the alternative hypothesis.
</p>
</td></tr>
<tr><td><code>se.stat.Ha</code></td>
<td>

<p>standard error for <code class="reqn">\hat{\eta}_c</code> under
the alternative hypothesis.
</p>
</td></tr>
<tr><td><code>CIlow</code></td>
<td>

<p>lower confidence limit  for <code class="reqn">\eta_c</code>.
</p>
</td></tr>
<tr><td><code>CIupp</code></td>
<td>

<p>upper confidence limit  for <code class="reqn">\eta_c</code>.
</p>
</td></tr>
<tr><td><code>datHk</code></td>
<td>

<p>A nSubj by 2 matrix of probit transformed risk scores by using only
the first 2 observations of each subject.
</p>
</td></tr>
<tr><td><code>ci</code></td>
<td>

<p>the vector of <code class="reqn">c_i</code>, the number of progressing subunits for the <code class="reqn">i</code>-th subject.
</p>
</td></tr>
<tr><td><code>di</code></td>
<td>

<p>the vector of <code class="reqn">d_i</code>, the number of non-progressing subunits for the <code class="reqn">i</code>-th subject.
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Bernard Rosner &lt;stbar@channing.harvard.edu&gt;, 
Weiliang Qiu &lt;Weiliang.Qiu@gmail.com&gt;, 
Meiling Ting Lee &lt;MLTLEE@umd.edu&gt;
</p>


<h3>References</h3>

<p>Rosner B, Qiu W, and Lee MLT.
Assessing Discrimination of Risk Prediction Rules in a Clustered Data Setting.
Lifetime Data Anal. 2013 Apr; 19(2): 242-256.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


set.seed(1234567)
datFrame = genSimDataGLMEM(nSubj = 30, beta0 = -6, sd.beta0i = 1.58, 
                          beta1 = 1.58, beta2 = -3.95, beta3 = 3.15, beta4 = 2.06,
                          beta5 = 0.51, beta6 = 1.47, beta7 = 3.11, 
                          p.smkcur = 0.08, p.inieye31 = 0.44, p.inieye32 = 0.42,
                          p.inieye41 = 0.12, p.inieye42 = 0.11, sd.lncalorc = 0.33)

print(dim(datFrame))
print(datFrame[1:2,])

tt1 = getScore(fmla = prog~smkcur+lncalorc+inieye3+inieye4+factor(rtotfat), 
  cidVar = "cid", subuidVar = "subuid", statusVar = "prog", 
  datFrame = datFrame, mycorstr = "exchangeable",
  verbose = FALSE)
myframe1=tt1$frame

print(dim(myframe1))
print(myframe1[1:3,])

res1 = riskPredict(myframe1)
print(names(res1))
print(res1)


</code></pre>

<hr>
<h2 id='riskPredictDiff'>
Difference of two risk prediction rules for clustered data
</h2><span id='topic+riskPredictDiff'></span>

<h3>Description</h3>

<p>Difference of two risk prediction rules for clustered data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>riskPredictDiff(frame, alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="riskPredictDiff_+3A_frame">frame</code></td>
<td>

<p>A data frame with 5 columns: cid, subuid, status, score1, and score2.
<code>cid</code> indicates cluster id; <code>subuid</code> indicates unit ID within a cluster;
<code>status=1</code> indicates an eye is progressed;
<code>status=0</code> indicates an eye is not progressed;
<code>score1</code> represents the score based on prediction rule 1.
<code>score2</code> represents the score based on prediction rule 2.
</p>
</td></tr>
<tr><td><code id="riskPredictDiff_+3A_alpha">alpha</code></td>
<td>

<p>numeric. The confidence level.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of 7 elements:
</p>
<table>
<tr><td><code>diff</code></td>
<td>
<p>the difference of test statistics 
<code class="reqn">\hat{\eta}_c^{(1)}-\hat{\eta}_c^{(2)}</code>
hateta_c^(1)-hateta_c^(2) based on the 2 prediction rules.</p>
</td></tr>
<tr><td><code>se.diff</code></td>
<td>
<p>standard error of the difference under the null hypothesis.</p>
</td></tr>
<tr><td><code>z</code></td>
<td>
<p>z score <code>z=diff/se.diff</code></p>
</td></tr>
<tr><td><code>pval</code></td>
<td>
<p>p-value of the test</p>
</td></tr>
<tr><td><code>res1</code></td>
<td>

<p>output object of the function <code>riskPredict</code> for prediction rule 1.
</p>
</td></tr>
<tr><td><code>res2</code></td>
<td>

<p>output object of the function <code>riskPredict</code> for prediction rule 2.
</p>
</td></tr>
<tr><td><code>rhoVec</code></td>
<td>

<p>A vector of 4 correlations:
<code class="reqn">\rho=cov(H_{ij}^{(1)}, H_{ij}^{(2)})</code>,
<code class="reqn">\rho_{11}=cov(H_{ij}^{(1)}, H_{it}^{(1)})</code>,
<code class="reqn">\rho_{22}=cov(H_{ij}^{(2)}, H_{it}^{(2)})</code>,
and <code class="reqn">\rho_{12}=cov(H_{ij}^{(1)}, H_{it}^{(2)})</code>
</p>
</td></tr>
<tr><td><code>E.diff.Ha</code></td>
<td>

<p>expectation of the difference under the alternative hypothesis.
</p>
</td></tr>
<tr><td><code>se.diff.Ha</code></td>
<td>

<p>standard error of the difference under the alternative hypothesis.
</p>
</td></tr>
<tr><td><code>CIlow.diff</code></td>
<td>

<p>Lower confidence limit.
</p>
</td></tr>
<tr><td><code>CIup.diff</code></td>
<td>

<p>Upper confidence limit.
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Bernard Rosner &lt;stbar@channing.harvard.edu&gt;, 
Weiliang Qiu &lt;Weiliang.Qiu@gmail.com&gt;,
Meiling Ting Lee &lt;MLTLEE@umd.edu&gt;
</p>


<h3>References</h3>

<p>Rosner B, Qiu W, and Lee MLT.
Assessing Discrimination of Risk Prediction Rules in a Clustered Data Setting.
Lifetime Data Anal. 2013 Apr; 19(2): 242-256.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


set.seed(1234567)
datFrame = genSimDataGLMEM(nSubj = 30, beta0 = -6, sd.beta0i = 1.58, 
                          beta1 = 1.58, beta2 = -3.95, beta3 = 3.15, beta4 = 2.06,
                          beta5 = 0.51, beta6 = 1.47, beta7 = 3.11, 
                          p.smkcur = 0.08, p.inieye31 = 0.44, p.inieye32 = 0.42,
                          p.inieye41 = 0.12, p.inieye42 = 0.11, sd.lncalorc = 0.33)

print(dim(datFrame))
print(datFrame[1:2,])

# prediction rule 1
tt1 = getScore(fmla = prog~smkcur+lncalorc+inieye3+inieye4+factor(rtotfat), 
  cidVar = "cid", subuidVar = "subuid", statusVar = "prog", 
  datFrame = datFrame, mycorstr = "exchangeable",
  verbose = FALSE)
myframe1=tt1$frame

print(dim(myframe1))
print(myframe1[1:3,])

####
# prediction rule 2
tt2 = getScore(fmla = prog~smkcur+lncalorc+inieye3+inieye4, 
  cidVar = "cid", subuidVar = "subuid", statusVar = "prog", 
  datFrame = datFrame, mycorstr = "exchangeable",
  verbose = FALSE)
myframe2=tt2$frame

print(dim(myframe2))
print(myframe2[1:3,])

# combine scores from two prediction rules
myframe12=myframe1[, c("cid", "subuid", "status")]
myframe12$score1=myframe1$score
myframe12$score2=myframe2$score
print(dim(myframe12))
print(myframe12[1:3,])

####
resDiff = riskPredictDiff(frame=myframe12)
print(names(resDiff))
print(resDiff)



</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
