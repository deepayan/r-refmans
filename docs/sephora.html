<!DOCTYPE html><html lang="en"><head><title>Help for package sephora</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {sephora}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#sephora-package'><p>Statistical Estimation of Phenological Parameters</p></a></li>
<li><a href='#datesToDoY'><p>Mapping phenodates to days of year (DoY)</p></a></li>
<li><a href='#deciduous_polygon'><p>128 NDVI pixels from a MOD13Q1 time series</p></a></li>
<li><a href='#fill_initialgap_MOD13Q1'><p>Fill gaps of first three dates of MOD13Q1</p></a></li>
<li><a href='#get_metadata_years'><p>Returns metadata to construct x-axis and legend of <code>plot.sephora</code></p></a></li>
<li><a href='#getDist_phenoParam'><p>Utility function</p></a></li>
<li><a href='#getSpiralPlot'><p>Spiral plot of phenological parameters</p></a></li>
<li><a href='#global_min_max'><p>Global minimum and maximum of a real-valued continuous function over a closed interval</p></a></li>
<li><a href='#local_min_max'><p>Local minimum and maximum of a real-valued continuous function over an open interval</p></a></li>
<li><a href='#ndvi_derivatives'><p>Calculates derivatives of idealized NDVI</p></a></li>
<li><a href='#phenopar'><p>Phenological parameters estimation</p></a></li>
<li><a href='#phenopar_polygon'><p>Phenological parameters estimation in mass</p></a></li>
<li><a href='#plot.sephora'><p>Plot methods for <code>sephora</code></p></a></li>
<li><a href='#sephora-class'><p>class sephora</p></a></li>
<li><a href='#vecFromData'><p>Get numeric vector from RData file</p></a></li>
<li><a href='#vecToMatrix'><p>Mapping numeric vector to a matrix</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Version:</td>
<td>0.1.31</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-01-16</td>
</tr>
<tr>
<td>Title:</td>
<td>Statistical Estimation of Phenological Parameters</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides functions and methods for estimating phenological dates (green up, 
  start of a season, maturity, senescence, end of a season and dormancy) from (nearly) 
  periodic Earth Observation time series. These dates are critical points of some 
  derivatives of an idealized curve which, in turn, is obtained through a functional principal 
  component analysis-based regression model. Some of the methods implemented here are 
  based on T. Krivobokova, P. Serra and F. Rosales (2022) <a href="https://www.sciencedirect.com/science/article/pii/S0167947322000998">https://www.sciencedirect.com/science/article/pii/S0167947322000998</a>. 
  Methods for handling and plotting Earth observation time series are also provided.</td>
</tr>
<tr>
<td>LazyData:</td>
<td>yes</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0), ggplot2 (&ge; 3.3.6), methods, geoTS (&ge; 0.1.7),
eBsc (&ge; 4.15), rootSolve (&ge; 1.8.2.3)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dtwclust (&ge; 5.5.10), foreach (&ge; 1.4.4), parallel (&ge; 3.6.1),
doParallel (&ge; 1.0.14), dplyr (&ge; 1.0.9), nlme (&ge; 3.1-157),
MASS (&ge; 7.3-57), ggnewscale (&ge; 0.4.7), spiralize (&ge; 1.0.6)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>TSclust (&ge; 1.3.1), bigmemory (&ge; 4.6.1), vcd (&ge; 1.4-11)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Collate:</td>
<td>'auxFUN.R' 'data.R' 'datesToDoY.R' 'fill_initialgap_MOD13Q1.R'
'getDist_phenoParam.R' 'getSpiralPlot.R' 'get_metadata_years.R'
'global_min_max.R' 'local_min_max.R' 'ndvi_derivatives.R'
'phenopar.R' 'phenopar_polygon.R' 'plot.R' 'sephora-class.R'
'sephora-methods.R' 'sephora-package.R' 'vecFromData.R'
'vecToMatrix.R'</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-16 18:19:13 UTC; itecuapetla</td>
</tr>
<tr>
<td>Author:</td>
<td>Inder Tecuapetla-Gómez [cre, aut] (ORDIC: 0000-0001-6251-972X),
  Fanny Galicia-Gómez [ctb],
  Francisco Rosales-Marticorena [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Inder Tecuapetla-Gómez &lt;itecuapetla@conabio.gob.mx&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-17 18:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='sephora-package'>Statistical Estimation of Phenological Parameters</h2><span id='topic+sephora-package'></span>

<h3>Description</h3>

<p>Estimates phenological dates of satellite imagery time series. Originally
conceived to handle <a href="https://modis.gsfc.nasa.gov/">MODIS</a> time series (especifically
<a href="https://lpdaac.usgs.gov/products/mod13q1v006/">MOD13Q1</a>), this package can handle 
Earth Observation time series from any satellite mission.
</p>


<h3>Details</h3>

<p>The main function of this package, <code><a href="#topic+phenopar">phenopar</a></code>, allows a <code>numeric</code> 
vector containing satellite-based measurements (preferably, vegetation indices for better results). 
These observations can be construed as realizations of an underlying periodic stochastic process that has been recorded 
from the first day of the year (DoY) of <code>startYear</code> to the last DoY of <code>endYear</code>. 
Thus, each numeric vector can be assembled as a matrix whose number of rows and columns equal
to <code>length(startYear:endYear)</code> and <code>frequency</code>, respectively, see <code><a href="#topic+get_metadata_years">get_metadata_years</a></code>. Moreover,
each row of this matrix can be thought as the realization of the periodic stochastic
process throughout a season. Thus, having multiple measurements of such a process, functional 
principal component methods are employed to extract an underlying idealized (vegetation index) curve. 
</p>
<p>The phenological dates that can be estimated with sephora are:
</p>

<ul>
<li> <p><b>Green Up (GU)</b>.
</p>
</li>
<li> <p><b>Start of Season (SoS)</b>.
</p>
</li>
<li> <p><b>Maturity (Mat)</b>.
</p>
</li>
<li> <p><b>Senescence (Sen)</b>.
</p>
</li>
<li> <p><b>End of Season (EoS)</b>.
</p>
</li>
<li> <p><b>Dormancy (Dor)</b>.
</p>
</li></ul>



<h3>Data handling</h3>

<p>The following functions allow to access numeric vectors of time series satellite 
imagery, in particular, MOD13Q1 time series starting at February 18, 2000. 
</p>

<table>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+fill_initialgap_MOD13Q1">fill_initialgap_MOD13Q1</a></code></td><td style="text-align: left;"> Fill first 3 MOD13Q1 observations </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+vecFromData">vecFromData</a></code></td><td style="text-align: left;"> Get numeric vector from an RData file </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+vecToMatrix">vecToMatrix</a></code></td><td style="text-align: left;"> Set numeric vector as a matrix </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+get_metadata_years">get_metadata_years</a></code></td><td style="text-align: left;"> Get metadata useful in certain visualizations </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Modeling</h3>

<p>The following functions allow to smooth out and fit a regression model based on 
Functional Principal Components. Applications of these functions allow to estimate 
phenological parameters of numeric vectors of Earth Observation time series:
</p>

<table>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+ndvi_derivatives">ndvi_derivatives</a></code></td><td style="text-align: left;"> Derivatives of idealized NDVI curve </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+phenopar">phenopar</a></code></td><td style="text-align: left;"> Estimate phenological dates </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+phenopar_polygon">phenopar_polygon</a></code></td><td style="text-align: left;"> Estimate phenological dates (parallel processing) </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Plotting</h3>

<p>Plot methods for numeric and <code>sephora</code> objects:
</p>

<table>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+getSpiralPlot">getSpiralPlot</a></code></td><td style="text-align: left;"> Spiral plot of polygon-based phenological date estimates </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+plot.sephora">plot.sephora</a></code></td><td style="text-align: left;"> Plot methods for <code><a href="#topic+sephora-class">sephora-class</a></code> object </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Miscellaneous</h3>


<table>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+datesToDoY">datesToDoY</a></code></td><td style="text-align: left;"> Maps estimated phenological dates to days of a year </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+getDist_phenoParam">getDist_phenoParam</a></code></td><td style="text-align: left;"> Access to vectors of phenological date estimates from a list </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+global_min_max">global_min_max</a></code></td><td style="text-align: left;"> Global critical points of a curve on a closed interval </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+local_min_max">local_min_max</a></code></td><td style="text-align: left;"> Local critical points of a curve on a union of open intervals </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Tecuapetla-Gómez, I. <a href="mailto:itecuapetla@conabio.gob.mx">itecuapetla@conabio.gob.mx</a>
</p>

<hr>
<h2 id='datesToDoY'>Mapping phenodates to days of year (DoY)</h2><span id='topic+datesToDoY'></span>

<h3>Description</h3>

<p>This function maps estimated phenological dates to days of a year.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>datesToDoY(
  start = 1,
  end = 12,
  phenodates,
  totalDoY = c(0, cumsum(c(31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31)))
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="datesToDoY_+3A_start">start</code></td>
<td>
<p>numeric, first month in mapping range. Default is 1.</p>
</td></tr>
<tr><td><code id="datesToDoY_+3A_end">end</code></td>
<td>
<p>numeric, last month in mapping range. Default is 12.</p>
</td></tr>
<tr><td><code id="datesToDoY_+3A_phenodates">phenodates</code></td>
<td>
<p>numeric vector of length 6 containing estimates of phenological
dates (green up, start of season, maturity, senescence, end of season and
dormancy)</p>
</td></tr>
<tr><td><code id="datesToDoY_+3A_totaldoy">totalDoY</code></td>
<td>
<p>numeric vector, each entry (except for the first) gives a month's
total number of days</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Length of <code>start:end</code> must be equal to <code>length(totalDoY)-1</code>.
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> with variables <code>month</code> and <code>day</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- c(102,140,177,301,339,242)
names(x) &lt;- c("GU", "SoS", "Mat", "Sen", "EoS", "Dor")
datesToDoY(phenodates = x)

</code></pre>

<hr>
<h2 id='deciduous_polygon'>128 NDVI pixels from a MOD13Q1 time series</h2><span id='topic+deciduous_polygon'></span>

<h3>Description</h3>

<p>Small spatial subset of a MOD13Q1 time series from 2000 to 2021.
The MOD13Q1 provides measurements of the Normalized Difference Vegetation 
Index (NDVI), a variable that is suitable to conduct mid-term vegetation studies remotely.
The pixels provided by this dataset were recorded from a deciduous forest zone.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(deciduous_polygon)
</code></pre>


<h3>Format</h3>

<p>An object of class <code>matrix</code>.
</p>


<h3>Details</h3>

<p>The dataset is distributed through an <code>RData</code> file containing a 
<code>matrix</code> object with 128 rows and 506 columns.
</p>

<hr>
<h2 id='fill_initialgap_MOD13Q1'>Fill gaps of first three dates of MOD13Q1</h2><span id='topic+fill_initialgap_MOD13Q1'></span>

<h3>Description</h3>

<p>Since MOD13Q1 was released on 18-02-2000 and its temporal resolution
is 16 days, there are no measurements available for the first three acquisition dates of 2000. 
This function allows to fill these three dates using historic data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fill_initialgap_MOD13Q1(m, fun = stats::median)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fill_initialgap_MOD13Q1_+3A_m">m</code></td>
<td>
<p>matrix with <code>nrow</code> equal to the number of periods (seasons or years) 
studied, and <code>ncol</code> equal to the number of observations per period.</p>
</td></tr>
<tr><td><code id="fill_initialgap_MOD13Q1_+3A_fun">fun</code></td>
<td>
<p>a function employed to impute missing values. Default, <code>stats::median</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The missing values of <code>m</code> are <code>m[1,1]</code>, <code>m[1,2]</code> and <code>m[1,3]</code>. For instance,
to fill <code>m[1,1]</code> the values of <code>m[2:nrow(m),1]</code> are used, and consequently, it 
is expected that the larger the numeric vector, the smaller the variability of the imputed
value for <code>m[1,1]</code>.
</p>


<h3>Value</h3>

<p>A numeric vector of length 3
</p>


<h3>Note</h3>

<p>It is recommended to use <code><a href="#topic+vecToMatrix">vecToMatrix</a></code> to transfer
the values of a numeric vector of MOD13Q1 measurements into a matrix.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vecToMatrix">vecToMatrix</a></code>, <code><a href="#topic+vecFromData">vecFromData</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("deciduous_polygon")
str(deciduous_polygon, vec.len = 1)
x &lt;- deciduous_polygon[1,] # check x[1:3]
x_asMatrix &lt;- vecToMatrix(x, lenPeriod = 23) # check str(x_asMatrix)
x_asMat_complete &lt;- fill_initialgap_MOD13Q1(m=x_asMatrix)

#filled first three values of x
x[1:3] &lt;- x_asMat_complete

</code></pre>

<hr>
<h2 id='get_metadata_years'>Returns metadata to construct x-axis and legend of <code><a href="#topic+plot.sephora">plot.sephora</a></code></h2><span id='topic+get_metadata_years'></span>

<h3>Description</h3>

<p>Metadata either from a numeric vector or a <code><a href="#topic+sephora-class">sephora-class</a></code> object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_metadata_years(x, startYear = 2000, endYear = 2021, frequency = 23)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_metadata_years_+3A_x">x</code></td>
<td>
<p>numeric vector or <code><a href="#topic+sephora-class">sephora-class</a></code> object</p>
</td></tr>
<tr><td><code id="get_metadata_years_+3A_startyear">startYear</code></td>
<td>
<p>integer, <code>x</code> initial year</p>
</td></tr>
<tr><td><code id="get_metadata_years_+3A_endyear">endYear</code></td>
<td>
<p>integer, <code>x</code> final year</p>
</td></tr>
<tr><td><code id="get_metadata_years_+3A_frequency">frequency</code></td>
<td>
<p>integer giving number of observations per season. 
Default is 23.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of 2 components: 
</p>
<table role = "presentation">
<tr><td><code>xDates</code></td>
<td>
<p>date vector containing DoY (acquisition date) using format yyyy-mm-dd</p>
</td></tr>
<tr><td><code>xLabels</code></td>
<td>
<p>character vector containing period of study years using format &quot;'YY&quot;</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- deciduous_polygon[1,]
y &lt;- get_metadata_years(x=x)
str(y)

</code></pre>

<hr>
<h2 id='getDist_phenoParam'>Utility function</h2><span id='topic+getDist_phenoParam'></span>

<h3>Description</h3>

<p>Extracts an estimated phenological parameter from a <code>list</code>. Useful when 
<code>phenopar_polygon</code> was applied to estimate phenological dates over a polygon.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getDist_phenoParam(
  LIST,
  phenoParam = c("GU", "SoS", "Mat", "Sen", "EoS", "Dor")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="getDist_phenoParam_+3A_list">LIST</code></td>
<td>
<p>list, containing 6 estimated phenological parameters</p>
</td></tr>
<tr><td><code id="getDist_phenoParam_+3A_phenoparam">phenoParam</code></td>
<td>
<p>character. What phenological parameter should be extracted?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector
</p>


<h3>See Also</h3>

<p><code><a href="#topic+getSpiralPlot">getSpiralPlot</a></code>, <code><a href="#topic+phenopar_polygon">phenopar_polygon</a></code>
</p>

<hr>
<h2 id='getSpiralPlot'>Spiral plot of phenological parameters</h2><span id='topic+getSpiralPlot'></span>

<h3>Description</h3>

<p>This utility function yields a spiral plot based on
phenological dates estimated from a polygon.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getSpiralPlot(LIST, MAT = NULL, height = 0.2, LABELS, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="getSpiralPlot_+3A_list">LIST</code></td>
<td>
<p>list, containing 6 estimated phenological parameters.</p>
</td></tr>
<tr><td><code id="getSpiralPlot_+3A_mat">MAT</code></td>
<td>
<p>matrix, containing 6 estimated phenological parameters. Default, <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="getSpiralPlot_+3A_height">height</code></td>
<td>
<p>numeric, height parameter of <code><a href="spiralize.html#topic+spiral_track">spiral_track</a></code> (used internally)</p>
</td></tr>
<tr><td><code id="getSpiralPlot_+3A_labels">LABELS</code></td>
<td>
<p>character, labels parameter of <code><a href="spiralize.html#topic+spiral_axis">spiral_axis</a></code> (used internally)</p>
</td></tr>
<tr><td><code id="getSpiralPlot_+3A_...">...</code></td>
<td>
<p>additional parameters to <code><a href="spiralize.html#topic+spiral_initialize">spiral_initialize</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>No value is returned
</p>


<h3>See Also</h3>

<p><code><a href="#topic+getSpiralPlot">getSpiralPlot</a></code>, <code><a href="#topic+phenopar_polygon">phenopar_polygon</a></code>, <code><a href="spiralize.html#topic+spiral_track">spiral_track</a></code>, 
<code><a href="spiralize.html#topic+spiral_axis">spiral_axis</a></code>, <code><a href="spiralize.html#topic+spiral_initialize">spiral_initialize</a></code>
</p>

<hr>
<h2 id='global_min_max'>Global minimum and maximum of a real-valued continuous function over a closed interval</h2><span id='topic+global_min_max'></span>

<h3>Description</h3>

<p>Gets global minimum and maximum of a given function expression
on an interval using basic calculus criteria
</p>


<h3>Usage</h3>

<pre><code class='language-R'>global_min_max(f, f1der, f2der, D)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="global_min_max_+3A_f">f</code></td>
<td>
<p>function expression</p>
</td></tr>
<tr><td><code id="global_min_max_+3A_f1der">f1der</code></td>
<td>
<p>function expression of first derivative of <code>f</code></p>
</td></tr>
<tr><td><code id="global_min_max_+3A_f2der">f2der</code></td>
<td>
<p>function expression of second derivative of <code>f</code></p>
</td></tr>
<tr><td><code id="global_min_max_+3A_d">D</code></td>
<td>
<p>numeric vector specifying the interval over which <code>f</code>
is optimized</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function uses <code><a href="rootSolve.html#topic+uniroot.all">uniroot.all</a></code>
to get all roots of <code>f1der</code> over <code>D</code>, additionally,
the second derivative criterion is used to determine the global minimum and
maximum.
</p>


<h3>Value</h3>

<p>A list containing:
</p>
<table role = "presentation">
<tr><td><code>min</code></td>
<td>
<p>numeric giving critical point where global minimum is achieved</p>
</td></tr>
<tr><td><code>max</code></td>
<td>
<p>numeric giving critical point where global maximum is achieved</p>
</td></tr>
<tr><td><code>mins</code></td>
<td>
<p>numeric vector giving all critical points satisfying second 
derivative criterion for minimum</p>
</td></tr>
<tr><td><code>maxs</code></td>
<td>
<p>numeric vector giving all critical points satisfying second 
derivative criterion for maximum</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+phenopar">phenopar</a></code>, <code><a href="rootSolve.html#topic+uniroot.all">uniroot.all</a></code>
</p>

<hr>
<h2 id='local_min_max'>Local minimum and maximum of a real-valued continuous function over an open interval</h2><span id='topic+local_min_max'></span>

<h3>Description</h3>

<p>Gets local minimum and maximum of a given function expression
on an interval using basic calculus criteria
</p>


<h3>Usage</h3>

<pre><code class='language-R'>local_min_max(f, f1der, f2der, what = c("min", "max"), x0, D)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="local_min_max_+3A_f">f</code></td>
<td>
<p>function expression</p>
</td></tr>
<tr><td><code id="local_min_max_+3A_f1der">f1der</code></td>
<td>
<p>function expression of first derivative of <code>f</code></p>
</td></tr>
<tr><td><code id="local_min_max_+3A_f2der">f2der</code></td>
<td>
<p>function expression of second derivative of <code>f</code></p>
</td></tr>
<tr><td><code id="local_min_max_+3A_what">what</code></td>
<td>
<p>character. What to look for? A local <code>min</code> or a <code>max</code>?</p>
</td></tr>
<tr><td><code id="local_min_max_+3A_x0">x0</code></td>
<td>
<p>numeric givin global minimum or maximum of <code>f</code> over the
the interval <code>D</code>.</p>
</td></tr>
<tr><td><code id="local_min_max_+3A_d">D</code></td>
<td>
<p>numeric vector specifying the interval over which <code>f</code>
is optimized</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function looks for critical values
over the interval <code>[D[1],x0-1)</code> <code class="reqn">\cup</code> <code>(x0+1, D[length(D)]]</code>.
</p>


<h3>Value</h3>

<p>A list containing:
</p>

<ul>
<li> <p><code>x_opt</code> numeric giving the critical point where the local min or max
is achieved. When local min or max cannot be determined, this function returns <code>NA</code>.
</p>
</li>
<li> <p><code>locals</code> numeric vector giving all critical points satisfying second derivative criteria.
</p>
</li>
<li> <p><code>crtPts</code> a list with 2 entries:
</p>

<ul>
<li> <p><code>x_d1</code> numeric vector with local critical points over <code>[D[1],x-1)</code>
</p>
</li>
<li> <p><code>x_d2</code> numeric vector with local critical points over <code>(x0+1,D[length(D)]]</code>
</p>
</li></ul>

</li>
<li> <p><code>type</code> character, what was found? A <code>min</code> or a <code>max</code>?
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+global_min_max">global_min_max</a></code>, <code><a href="#topic+phenopar">phenopar</a></code>
</p>

<hr>
<h2 id='ndvi_derivatives'>Calculates derivatives of idealized NDVI</h2><span id='topic+ndvi_derivatives'></span>

<h3>Description</h3>

<p>Provides function expression of derivatives of an idealized NDVI curve
fitted through a harmonic regression model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ndvi_derivatives(amp, pha, degree, L)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ndvi_derivatives_+3A_amp">amp</code></td>
<td>
<p>numeric vector specifying amplitude parameter</p>
</td></tr>
<tr><td><code id="ndvi_derivatives_+3A_pha">pha</code></td>
<td>
<p>numeric vector specifying phase angle parameter</p>
</td></tr>
<tr><td><code id="ndvi_derivatives_+3A_degree">degree</code></td>
<td>
<p>integer. What derivative's degree should be calculated? 
<code>degree=0</code> corresponds to harmonic regression fit</p>
</td></tr>
<tr><td><code id="ndvi_derivatives_+3A_l">L</code></td>
<td>
<p>integer giving the number of observations per period</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function returns the derivatives of <code class="reqn">f(t)</code>, with respect
to <code class="reqn">t</code>, when <code class="reqn">f</code> has the representation:
</p>
<p><code class="reqn">f(t) = \sum_{k=1}^{p} a[i] cos( (2  \pi k t)/L - \phi[i] )</code>,
</p>
<p>where <code class="reqn">a</code> and <code class="reqn">\phi</code> are substituted by the vectors <code>amp</code>
and <code>phase</code>, respectively. The degree of the derivative is given by the
argument <code>degree</code>.
</p>


<h3>Value</h3>

<p>A function expression
</p>


<h3>Note</h3>

<p>For historic reasons, we ended up using the name <code>ndvi_derivatives</code>
for this function, but it can be used to calculate derivatives of any function
expression defined through <code>amp</code>, <code>pha</code>, <code>degree</code> and <code>L</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+phenopar">phenopar</a></code>, <code><a href="#topic+phenopar_polygon">phenopar_polygon</a></code>, <code><a href="geoTS.html#topic+haRmonics">haRmonics</a></code>
</p>

<hr>
<h2 id='phenopar'>Phenological parameters estimation</h2><span id='topic+phenopar'></span>

<h3>Description</h3>

<p>Estimation of 6 phenological parameters from a numeric vector. The estimated parameters are: <b>green up</b>,
<b>start of season</b>, <b>maturity</b>, <b>senescence</b>, <b>end of season</b> and <b>dormancy</b>. These parameters
are critical points of some derivatives of an idealized curve which, in turn, is obtained 
through a functional principal component analysis (FPCA)-based regression model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phenopar(
  x,
  startYear,
  endYear,
  frequency = 23,
  method = c("OLS", "WLS"),
  sigma = NULL,
  numFreq,
  delta = 0,
  distance,
  samples,
  basis,
  corr = NULL,
  k,
  trace = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phenopar_+3A_x">x</code></td>
<td>
<p>a numeric vector.</p>
</td></tr>
<tr><td><code id="phenopar_+3A_startyear">startYear</code></td>
<td>
<p>integer, time series initial year</p>
</td></tr>
<tr><td><code id="phenopar_+3A_endyear">endYear</code></td>
<td>
<p>integer, time series final year</p>
</td></tr>
<tr><td><code id="phenopar_+3A_frequency">frequency</code></td>
<td>
<p>integer giving number of observations per season. Default, 23.</p>
</td></tr>
<tr><td><code id="phenopar_+3A_method">method</code></td>
<td>
<p>character. Should <code>OLS</code> or <code>WLS</code> be used for smoothing <code>x</code>
through a harmonic regression model. See <b>Details</b>.</p>
</td></tr>
<tr><td><code id="phenopar_+3A_sigma">sigma</code></td>
<td>
<p>numeric vector of length equal to <code>frequency</code>. Each entry gives the 
standard deviation of observations acquired at same day of the year.
Pertinent when <code>method=WLS</code> only.</p>
</td></tr>
<tr><td><code id="phenopar_+3A_numfreq">numFreq</code></td>
<td>
<p>integer specifying number of frequencies used in harmonic regression
model.</p>
</td></tr>
<tr><td><code id="phenopar_+3A_delta">delta</code></td>
<td>
<p>numeric. Default, 0. When harmonic regression problem is ill-posed, this 
parameter allows a simple regularization. See <b>Details</b>.</p>
</td></tr>
<tr><td><code id="phenopar_+3A_distance">distance</code></td>
<td>
<p>character indicating what distance to use in hierarchical clustering.
All distances in <code><a href="dtwclust.html#topic+tsclust">tsclust</a></code> are allowed. See 
<b>Details</b>.</p>
</td></tr>
<tr><td><code id="phenopar_+3A_samples">samples</code></td>
<td>
<p>integer with number of samples to draw from smoothed version of <code>x</code>. Used
exclusively in Functional Principal Components Analysis (FPCA)-based
regression. See <b>Details</b>.</p>
</td></tr>
<tr><td><code id="phenopar_+3A_basis">basis</code></td>
<td>
<p>list giving numeric basis used in FPCA-based regression. See <b>Details</b>.</p>
</td></tr>
<tr><td><code id="phenopar_+3A_corr">corr</code></td>
<td>
<p>Default <code>NULL</code>. Object defining correlation structure, can be 
numeric vector, matrix or function.</p>
</td></tr>
<tr><td><code id="phenopar_+3A_k">k</code></td>
<td>
<p>integer, number of principal components used in FPCA-based regression.</p>
</td></tr>
<tr><td><code id="phenopar_+3A_trace">trace</code></td>
<td>
<p>logical. If <code>TRUE</code>, progress on the hierarchical clustering
is printed on console. Default, <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In order to estimate the phenological parameters, first <code>x</code> is assembled 
as a matrix. This matrix has as many rows as years (<code>length(startYear:endYear)</code>) in the studied period and as many columns
as observations (<code>frequency</code>) per year. Then, each vector row is smoothed through 
the harmonic regression model <code><a href="geoTS.html#topic+haRmonics">haRmonics</a></code>. This function allows 
for homogeneous (<code>OLS</code>) and heterogeneous (<code>WLS</code>) errors in the model. When
<code>method=WLS</code>, <code>sigma</code> must be provided, <code><a href="geoTS.html#topic+hetervar">hetervar</a></code> is recommended for such a purpose.
Additional parameters for <code><a href="geoTS.html#topic+haRmonics">haRmonics</a></code> are <code>numFreq</code> and
<code>delta</code>.
</p>
<p>Next, equally spaced <code>samples</code> are drawn from each harmonic regression fit, 
the resulting observations are stored in the matrix <code>m_aug_smooth</code>. 
<code><a href="dtwclust.html#topic+tsclust">tsclust</a></code> 
is applied to <code>m_aug_smooth</code> in order to obtain clusters of years sharing 
similar characteristics; 2 clusters are produced. The next step is applied
to the dominating cluster (the one with the majority of years, &gt;=10), or to the 
whole of columns of <code>m_aug_smooth</code> when no dominating cluster can be determined.
</p>
<p>Based on the observations produced in the hierarchical clustering step, a regression 
model with the following representation is applied:
</p>
<p><code class="reqn">f_i(t) = \tau(t) + \sum_{j=1}^{k} \varepsilon_j(t) \nu_{ij} + \epsilon_i</code>,
</p>
<p>where <code class="reqn">f_i(t)</code> is substituted by the vector of sample observations of the <code class="reqn">i</code>-th 
year; <code class="reqn">\varepsilon_j(t)</code> is the <code class="reqn">j</code>-th functional principal component (FPC); 
<code class="reqn">\nu_{ij}</code> is the score associated with the <code class="reqn">j</code>-th FPC and the <code class="reqn">i</code>-th vector
of sampled observations; and <code class="reqn">\epsilon_i</code> is a normally distributed random variable
with variance <code class="reqn">\sigma^2</code>, see <cite>Krivobokova et al. (2022)</cite> for further details. 
From this step, an estimate of <code class="reqn">\tau</code> is produced -<code>fpca</code>- 
this is an idealized version of the original observations contained in <code>x</code>.
</p>
<p>Parameter <code>basis</code> can be supplied through a call to <code><a href="eBsc.html#topic+drbasis">drbasis</a></code>
with parameters <code>nn=samples</code> and <code>qq=2</code>. Parameter <code>corr</code> indicates
whether correlation between annual curves must be considered; the current implementation
does not incorporate correlation. The number of principal components is controlled
by <code>k</code>. 
</p>
<p>Next, a harmonic regression is fitted to <code>fpca</code> (a numeric vector of length 
equal to <code>samples</code>) with the parameters provided above (<code>method</code>, <code>sigma</code>, 
<code>numFreq</code>, <code>delta</code>). Based on the estimated parameters of this fit 
(<code>fpca_harmfit_params</code>) a R function is calculated along with its first, 
second, third and fourth derivatives. These derivatives are used in establishing 
the phenological parameters (<code>phenoparams</code>) utilizing basic calculus
criteria similar to what <cite>Baumann et al. (2017)</cite> have proposed.
</p>
<p>Finally, when 6 <code>phenoparams</code> are found <code>status=Success</code>, otherwise 
<code>status=Partial</code>.
</p>


<h3>Value</h3>

<p>A <code><a href="#topic+sephora-class">sephora-class</a></code> object containing 14 elements
</p>
<table role = "presentation">
<tr><td><code>x</code></td>
<td>
<p>numeric vector</p>
</td></tr>
<tr><td><code>startYear</code></td>
<td>
<p>integer, time series initial year</p>
</td></tr>
<tr><td><code>endYear</code></td>
<td>
<p>integer, time series final year</p>
</td></tr>
<tr><td><code>freq</code></td>
<td>
<p>numeric giving number of observations per season. Default is 23.</p>
</td></tr> 
<tr><td><code>sigma</code></td>
<td>
<p>when <code>method="OLS"</code>, numeric of length one (standard deviation); 
when <code>method="WLS"</code>, numeric vector of length equal to <code>freq</code></p>
</td></tr>
<tr><td><code>m_aug_smooth</code></td>
<td>
<p>matrix with <code>nrow=samples</code> and <code>ncol=(length(x)/freq)</code> 
containing sampled observations</p>
</td></tr>
<tr><td><code>clustering</code></td>
<td>
<p>Formal class <code>HierarchicalTSClusters</code> with 20 slots. Output from a call 
to <code><a href="dtwclust.html#topic+tsclust">tsclust</a></code> with parameters <code>series=m_aug_smooth</code>,
<code>type='h'</code>, <code>distance=distance</code></p>
</td></tr>
<tr><td><code>fpca</code></td>
<td>
<p>numeric vector of length equal to <code>samples</code></p>
</td></tr>
<tr><td><code>fpca_harmfit_params</code></td>
<td>
<p>list of 4: <code>a.coef</code>, <code>b.coef</code>, <code>amplitude</code> 
and <code>phase</code> as in <code><a href="geoTS.html#topic+haRmonics">haRmonics</a></code> output.</p>
</td></tr>
<tr><td><code>fpca_fun_0der</code></td>
<td>
<p>function, harmonic fit for <code>x</code></p>
</td></tr>
<tr><td><code>fpca_fun_1der</code></td>
<td>
<p>function, first derivative of harmonic fit for <code>x</code></p>
</td></tr>
<tr><td><code>fpca_fun_2der</code></td>
<td>
<p>function, second derivative of harmonic fit for <code>x</code></p>
</td></tr>
<tr><td><code>fpca_fun_3der</code></td>
<td>
<p>function, third derivative of harmonic fit for <code>x</code></p>
</td></tr>
<tr><td><code>fpca_fun_4der</code></td>
<td>
<p>function, fourth derivative of harmonic fit for <code>x</code></p>
</td></tr>
<tr><td><code>phenoparams</code></td>
<td>
<p>named numeric vector of length 6</p>
</td></tr>
<tr><td><code>status</code></td>
<td>
<p>character, specifying whether FPCA model was inverted successfully 
(<code>Success</code>) or partially (&quot;Partial&quot;). In other words, <code>Success</code> and 
<code>Partial</code> mean that 6 or less than 6 parameters were estimated, respectively.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Krivobokova, T. and Serra, P. and Rosales, F. and Klockmann, K. (2022).
<em>Joint non-parametric estimation of mean and auto-covariances for Gaussian processes</em>. 
Computational Statistics &amp; Data Analysis, <b>173</b>, 107519.
</p>
<p>Baumann, M. and Ozdogan, M. and Richardson, A. and Radeloff, V. (2017).
<em>Phenology from Landsat when data is scarce: Using MODIS and Dynamic Time-Warping to combine 
multi-year Landsat imagery to derive annual phenology curves</em>. International Journal of Applied Earth Observation and Geoinformation,
<b>54</b>, 72&ndash;83
</p>


<h3>See Also</h3>

<p><code><a href="geoTS.html#topic+haRmonics">haRmonics</a></code>, <code><a href="geoTS.html#topic+hetervar">hetervar</a></code>, 
<code><a href="dtwclust.html#topic+tsclust">tsclust</a></code>, <code><a href="eBsc.html#topic+drbasis">drbasis</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># --- Load dataset for testing
data("deciduous_polygon")

# --- Extracting first pixel of deciduous_polygon
pixel_deciduous &lt;- vecFromData(data=deciduous_polygon, numRow=3)

# --- Following objects are used in this example
# --- for CRAN testing purposes only. In real life examples
# --- there is no need to shorten time series length

EndYear &lt;- 2010
number_observations &lt;- 23*11

# --- needed parameter
BASIS &lt;- drbasis(n=50, q=2) 

# --- testing phenopar
sephora_deciduous &lt;- phenopar(x=pixel_deciduous$vec[1:number_observations],
                              startYear=2000, endYear=EndYear,
                              numFreq=3, distance="dtw2",
                              samples=50, basis=BASIS, k=3)
                              
# --- testing ndvi_derivatives
f &lt;- ndvi_derivatives(amp = sephora_deciduous$fpca_harmfit_params$amplitude,
                      pha = sephora_deciduous$fpca_harmfit_params$phase,
                      degree = 0, L = 365)
fprime &lt;- ndvi_derivatives(amp = sephora_deciduous$fpca_harmfit_params$amplitude,
                           pha = sephora_deciduous$fpca_harmfit_params$phase,
                           degree = 1, L = 365)
fbiprime &lt;- ndvi_derivatives(amp = sephora_deciduous$fpca_harmfit_params$amplitude,
                             pha = sephora_deciduous$fpca_harmfit_params$phase,
                             degree = 2, L = 365)
f3prime &lt;- ndvi_derivatives(amp = sephora_deciduous$fpca_harmfit_params$amplitude,
                            pha = sephora_deciduous$fpca_harmfit_params$phase,
                            degree = 3, L = 365)
f4prime &lt;- ndvi_derivatives(amp = sephora_deciduous$fpca_harmfit_params$amplitude,
                            pha = sephora_deciduous$fpca_harmfit_params$phase,
                            degree = 4, L = 365)
                            
# --- testing global_min_max and local_min_max
intervalo &lt;- seq(1,365, length=365)
GU_Mat &lt;- global_min_max(f=fbiprime, f1der=f3prime, f2der=f4prime, D=intervalo)
Sen &lt;- local_min_max(f=fbiprime, f1der=f3prime, f2der=f4prime, 
                     what="min", x0=GU_Mat$min, D=intervalo)
SoS_EoS &lt;- global_min_max(f=fprime, f1der=fbiprime, f2der=f3prime, D=intervalo)
Dor &lt;- local_min_max(f=fbiprime, f1der=f3prime, f2der=f4prime, 
                     what="max", x0=GU_Mat$max, D=intervalo)
                      
# --- phenological dates (rough estimates)
c(GU=GU_Mat$max, SoS=SoS_EoS$max, Mat=GU_Mat$min,
  Sen=Sen$x_opt, EoS=SoS_EoS$min, Dor=Dor$x_opt)
# --- phenological dates provided by sephora
sephora_deciduous$phenoparams

# --- testing plotting methods
plot(x=sephora_deciduous, yLab="NDVI (no rescaled)")
plot(x=sephora_deciduous, type="profiles", 
     xLab="DoY", yLab="NDVI (no rescaled)")
     
# --- 2015 forms Cluster 2
plot(x=sephora_deciduous, type="ms")      

# --- graphical definition of phenological dates
plot(x=sephora_deciduous, type="derivatives")

# --- Overlapping FPCA fit to original time series
gg &lt;- plot(x=sephora_deciduous, type="profiles", 
           xLab="DoY", yLab="NDVI (no rescaled)")
x_axis &lt;- get_metadata_years(x=pixel_deciduous$vec, 
                             startYear=2000, endYear=EndYear, frequency=23)  
DoY &lt;- seq(1,365, by=16)
fpca_DoY &lt;- sephora_deciduous$fpca_fun_0der(t=DoY)
COLORS &lt;- unique( ggplot_build(gg)$data[1][[1]]$colour )
df &lt;- data.frame(values=c(sephora_deciduous$x, fpca_DoY),
                 years=as.factor(rep(c(x_axis$xLabels,"FPCA"), each=23)),
                 DoY=factor(DoY, levels=DoY), class=c(rep(1,number_observations), rep(2,23))) 
gg_fpca &lt;- ggplot(data=df, 
                  aes(x=DoY, y=values, group=years, colour=years)) +
ggplot2::geom_line(linewidth = c(rep(1,number_observations), rep(4,23))) + 
ggplot2::labs(y="NDVI", x="DoY", color="years+FPCA") + 
ggplot2::scale_color_manual(values = c(COLORS, "#FF4500")) +
ggplot2::theme(legend.position = "right")
gg_fpca

</code></pre>

<hr>
<h2 id='phenopar_polygon'>Phenological parameters estimation in mass</h2><span id='topic+phenopar_polygon'></span>

<h3>Description</h3>

<p>Estimation of phenological parameters from a set of numeric vectors stored in a RData file. 
Output is saved as a RData file at the destination specified by <code>dirToSave</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phenopar_polygon(
  path = NULL,
  product = c("MOD13Q1", "independent"),
  data,
  frequency = 23,
  method = c("OLS", "WLS"),
  sigma = NULL,
  numFreq,
  delta = 0,
  distance,
  samples,
  basis,
  corr = NULL,
  k,
  trace = FALSE,
  numCores = 20,
  dirToSave,
  reportFileBaseName = "phenopar_progress",
  outputFileBaseName = "polygon"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phenopar_polygon_+3A_path">path</code></td>
<td>
<p>character with full path of RData file containing numeric vectors to analyze.</p>
</td></tr>
<tr><td><code id="phenopar_polygon_+3A_product">product</code></td>
<td>
<p>character specifying whether dataset is the <code>MOD13Q1</code> product (default) or 
a different one (<code>independent</code>).</p>
</td></tr>
<tr><td><code id="phenopar_polygon_+3A_data">data</code></td>
<td>
<p>matrix with dataset to analyze. Pertinent when <code>product="independent"</code> only.</p>
</td></tr>
<tr><td><code id="phenopar_polygon_+3A_frequency">frequency</code></td>
<td>
<p>integer giving number of observations per season. Default, 23.</p>
</td></tr>
<tr><td><code id="phenopar_polygon_+3A_method">method</code></td>
<td>
<p>character. Should <code>OLS</code> or <code>WLS</code> be used for smoothing each
numeric vector in RData file specified in <code>path</code>?</p>
</td></tr>
<tr><td><code id="phenopar_polygon_+3A_sigma">sigma</code></td>
<td>
<p>numeric vector of length equal to <code>frequency</code>. Each entry gives the 
standard deviation of observations acquired at same day of the year. 
Pertinent when <code>method=WLS</code>.</p>
</td></tr>
<tr><td><code id="phenopar_polygon_+3A_numfreq">numFreq</code></td>
<td>
<p>integer specifying number of frequencies to use in harmonic regression
model.</p>
</td></tr>
<tr><td><code id="phenopar_polygon_+3A_delta">delta</code></td>
<td>
<p>numeric. Default, 0. When regression problem is ill-posed, this
parameter allows a simple regularization.</p>
</td></tr>
<tr><td><code id="phenopar_polygon_+3A_distance">distance</code></td>
<td>
<p>character indicating what distance to use in hierarchical clustering.
All distances in <code><a href="dtwclust.html#topic+tsclust">tsclust</a></code> are allowed.</p>
</td></tr>
<tr><td><code id="phenopar_polygon_+3A_samples">samples</code></td>
<td>
<p>integer with number of samples to draw from smoothed version of numeric
vector to analyze. Used exclusively in Functional Principal Components Analysis (FPCA)-based
regression.</p>
</td></tr>
<tr><td><code id="phenopar_polygon_+3A_basis">basis</code></td>
<td>
<p>list giving numeric basis used in FPCA-based regression. See details.</p>
</td></tr>
<tr><td><code id="phenopar_polygon_+3A_corr">corr</code></td>
<td>
<p>Default <code>NULL</code>. Object defining correlation structure, can be
numeric vector, matrix or function.</p>
</td></tr>
<tr><td><code id="phenopar_polygon_+3A_k">k</code></td>
<td>
<p>integer, number of principal components used in FPCA-based regression.</p>
</td></tr>
<tr><td><code id="phenopar_polygon_+3A_trace">trace</code></td>
<td>
<p>logical. If <code>TRUE</code>, progress on the hierarchical clustering
is printed on console. Default, <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="phenopar_polygon_+3A_numcores">numCores</code></td>
<td>
<p>integer. How many processing cores can be used?</p>
</td></tr>
<tr><td><code id="phenopar_polygon_+3A_dirtosave">dirToSave</code></td>
<td>
<p>character. In which directory to save analysis results?</p>
</td></tr>
<tr><td><code id="phenopar_polygon_+3A_reportfilebasename">reportFileBaseName</code></td>
<td>
<p>character. What base name should be given to a progress report file? 
Default, <code>phenopar_progress</code>.</p>
</td></tr>
<tr><td><code id="phenopar_polygon_+3A_outputfilebasename">outputFileBaseName</code></td>
<td>
<p>character. What base name should be given to the output file? 
Default, <code>polygon</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>At the location specified by <code>dirToSave</code>, a file containing a matrix
with <code>nrow</code> equal to the number of numeric vectors analyzed and 6 columns, is saved. 
The name of this file is:
</p>
<p><code>paste0(tools::file_path_sans_ext(basename(path)), "_phenoparams.RData")</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+phenopar">phenopar</a></code>, <code><a href="#topic+getSpiralPlot">getSpiralPlot</a></code>, 
<code><a href="dtwclust.html#topic+tsclust">tsclust</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
dirOUTPUT &lt;- system.file("data", package = "sephora")
BASIS &lt;- drbasis(n=100, q=2)

polygon_deciduous &lt;- deciduous_polygon
for(i in 1:nrow(polygon_deciduous)){
  polygon_deciduous[i,] &lt;- vecFromData(data=deciduous_polygon, numRow=i)$vec
}

# --- In the following example 'numCores=2' for CRAN
# --- testing purposes only. In a real life example
# --- users are encouraged to set 'numCores' to a number
# --- that reflects the size of their data set as well
# --- as the number of available cores

phenopar_polygon(data=polygon_deciduous,
                 product="independent",
                 numFreq = 3, distance = "dtw2",
                 samples=100, basis=BASIS,
                 k=3, numCores=2,
                 dirToSave=dirOUTPUT,
                 outputFileBaseName = "deciduous")
                 
# --- Auxiliary function to read phenopar_polygon output,
# --- used below to define deciduous_params object                   
LoadToEnvironment &lt;- function(RData, env = new.env()){
                              load(RData, env)
                              return(env)}
                 
# --- colors used in spiralPlot below
cgu &lt;- rgb(173/255,221/255,142/255)
csos &lt;- rgb(120/255,198/255,121/255)
cmat &lt;- rgb(49/255, 163/255,84/255)
csen &lt;- rgb(217/255, 95/255, 14/255)
ceos &lt;- rgb(254/255, 153/255, 41/255)
cdor &lt;- rgb(208/255, 209/255, 230/255)

colores &lt;- c(cgu,csos,cmat,csen,ceos,cdor)

# --- how to get a SpiralPlot
listRDatas &lt;- list.files(path=dirOUTPUT,
                         pattern=".RData",
                         full.names=TRUE)
                         
deciduous_params &lt;- LoadToEnvironment(listRDatas[1])

getSpiralPlot(MAT=deciduous_params$output, 
              LABELS=month.name,
              vp_param=list(width=0.5, height=0.7))
vcd::grid_legend(x=1.215, y=0.125, pch=18, col=colores,
                frame=FALSE,
                labels=c("GU","SoS","Mat","Sen","EoS","Dor"),
                title="Params")
            
# --- cleaning up after work
unlink(paste0(dirOUTPUT, "/deciduous_phenoParams.RData"))
unlink(paste0(dirOUTPUT, "/phenopar_progress.txt"))

</code></pre>

<hr>
<h2 id='plot.sephora'>Plot methods for <code>sephora</code></h2><span id='topic+plot.sephora'></span><span id='topic+sephora-methods'></span>

<h3>Description</h3>

<p>Methods associated with <code><a href="#topic+sephora-class">sephora-class</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'sephora'
plot(
  x,
  y,
  startYear,
  endYear,
  frequency,
  type = NULL,
  sizeLine = 1,
  sizePoint = 2,
  position_legend = "none",
  title_legend = NULL,
  xLab = "Time",
  yLab = "Index",
  xLim,
  msTitle = "Cluster",
  pointShape = 16,
  pointSize = 2,
  pointStroke = 3,
  textFontface = 2,
  textSize = 5,
  text_hjust = 0.5,
  text_vjust = -0.5,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.sephora_+3A_x">x</code></td>
<td>
<p>a numeric vector or a <code>sephora</code> object.</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_y">y</code></td>
<td>
<p>ignored.</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_startyear">startYear</code></td>
<td>
<p>integer, time series initial year.</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_endyear">endYear</code></td>
<td>
<p>integer, time series final year.</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_frequency">frequency</code></td>
<td>
<p>integer giving number of observations per season.</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_type">type</code></td>
<td>
<p>character specifying type of plot. By default, <code>NULL</code>;
&quot;profiles&quot;, &quot;ms&quot; and &quot;derivatives&quot; are also allowed.
See <b>Details.</b></p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_sizeline">sizeLine</code></td>
<td>
<p>integer giving line size</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_sizepoint">sizePoint</code></td>
<td>
<p>integer giving point size</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_position_legend">position_legend</code></td>
<td>
<p>character. Should a legend be added? Where? See
<code><a href="ggplot2.html#topic+theme">theme</a></code>.</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_title_legend">title_legend</code></td>
<td>
<p>character. Should a legend be added? What would it be? See
<code><a href="ggplot2.html#topic+theme">theme</a></code> and <b>Details</b>.</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_xlab">xLab</code></td>
<td>
<p>character, label to display in x-axis.</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_ylab">yLab</code></td>
<td>
<p>character, label to display in y-axis. See <b>Details</b>.</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_xlim">xLim</code></td>
<td>
<p>date vector of length 2 indicating limits of x-axis. When no
supplied, <code>x</code> will be displayed in the period
of time defined by <code>startYear</code>, <code>endYear</code> and
<code>frequency</code>.</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_mstitle">msTitle</code></td>
<td>
<p>character. Default &quot;Cluster&quot;. See <b>Details</b>.</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_pointshape">pointShape</code></td>
<td>
<p><code>shape</code> parameter used in <code><a href="ggplot2.html#topic+geom_point">geom_point</a></code>. Default 16.
See <b>Details</b>.</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_pointsize">pointSize</code></td>
<td>
<p><code>size</code> parameter used in <code><a href="ggplot2.html#topic+geom_point">geom_point</a></code>. Default 2.
See <b>Details</b>.</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_pointstroke">pointStroke</code></td>
<td>
<p><code>stroke</code> parameter used in <code><a href="ggplot2.html#topic+geom_point">geom_point</a></code>. Default 3.
See <b>Details</b>.</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_textfontface">textFontface</code></td>
<td>
<p><code>fontface</code> parameter used in <code><a href="ggplot2.html#topic+geom_text">geom_text</a></code>. Default 2.
See <b>Details</b>.</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_textsize">textSize</code></td>
<td>
<p><code>size</code> parameters used in <code><a href="ggplot2.html#topic+geom_text">geom_text</a></code>. Default 5.
See <b>Details</b>.</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_text_hjust">text_hjust</code></td>
<td>
<p><code>hjust</code> parameter used in <code><a href="ggplot2.html#topic+geom_text">geom_text</a></code>. Default 0.5.
See <b>Details</b>.</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_text_vjust">text_vjust</code></td>
<td>
<p><code>vjust</code> parameter used in <code><a href="ggplot2.html#topic+geom_text">geom_text</a></code>. Default -0.5.
See <b>Details</b>.</p>
</td></tr>
<tr><td><code id="plot.sephora_+3A_...">...</code></td>
<td>
<p>additional <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> parameters.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>By default, <code>type=NULL</code> and this option allows for plotting <code>numeric</code>
vectors and <code>sephora</code> objects; argument <code>title_legend</code> is only pertinent in this case.
Other allowed options for <code>type</code> are &quot;profiles&quot;, &quot;ms&quot; and &quot;derivatives&quot;. When 
<code>type="profiles"</code> all the arguments used in the default case are allowed except for
<code>title_legend</code>. When <code>type="ms"</code>, arguments <code>msTitle</code>, <code>pointShape</code>,
<code>pointSize</code>, <code>pointStroke</code>, <code>textFontface</code>, <code>textSize</code>, <code>text_hjust</code>
and <code>text_vjust</code> are pertinent. When <code>type="derivatives"</code>, the default value of
argument <code>yLab</code> will be used.
</p>


<h3>Value</h3>

<p>A <code>gg</code> object (or <code>NULL</code> (invisible) when <code>type="derivatives"</code>).
</p>


<h3>Plotting</h3>

<p>This function draws either a graphic based on a <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> or a <code><a href="base.html#topic+plot">plot</a></code> object. 
</p>
<p>The default is intended for <code>numeric</code> vectors and <code><a href="#topic+sephora-class">sephora-class</a></code> objects.
This method employs the <code>ggplot2</code> system and returns a sort of time series plot.
</p>
<p>The method <em>profiles</em>, selected when <code>type="profiles"</code>, is also intended for <code>numeric</code> 
vectors and <code><a href="#topic+sephora-class">sephora-class</a></code> objects. This method is based on the <code>ggplot2</code> system
and draws <code class="reqn">p</code> curves, one for each period (<code>p=length(startYear:endYear)</code>), on 
the same time scale (days of the year). 
</p>
<p>The method <em>ms</em>, selected when <code>type="ms"</code>, is intended for <code><a href="#topic+sephora-class">sephora-class</a></code> objects
only. Using the <code>ggplot2</code> system this method draws the result of a multidimensional
scaling analysis performed on the smoothed version of the <code class="reqn">p</code> curves described above.
</p>
<p>The method <em>derivative</em>, selected when <code>type="derivatives"</code>, is intended for
<code><a href="#topic+sephora-class">sephora-class</a></code> objects only. A 5-panel plot is drawn showing (from top 
to bottom):
</p>

<ul>
<li><p> FPCA estimate: the <code>fpca</code> entry of <code><a href="#topic+sephora-class">sephora-class</a></code> object. See <code><a href="#topic+phenopar">phenopar</a></code>.
</p>
</li>
<li><p> First, second, third and fourht derivative of FPCA estimate: curve obtained by applying <code><a href="#topic+ndvi_derivatives">ndvi_derivatives</a></code>
to FPCA estimate.
</p>
</li></ul>


<hr>
<h2 id='sephora-class'>class sephora</h2><span id='topic+sephora-class'></span>

<h3>Description</h3>

<p>Definition of the <code>sephora</code> class
</p>


<h3>Slots</h3>


<dl>
<dt><code>x</code></dt><dd><p>Original time series (as a numeric vector)</p>
</dd>
<dt><code>startYear</code></dt><dd><p>Beginning of time series</p>
</dd>
<dt><code>endYear</code></dt><dd><p>End of time series</p>
</dd>
<dt><code>freq</code></dt><dd><p>Number of observations per season</p>
</dd>
<dt><code>sigma</code></dt><dd><p>Variability estimate</p>
</dd>
<dt><code>m_aug_smooth</code></dt><dd><p>Samples of smoothed version of <code>x</code>, in matricial form</p>
</dd>
<dt><code>clustering</code></dt><dd><p>An object of class <code><a href="dtwclust.html#topic+HierarchicalTSClusters">HierarchicalTSClusters</a></code></p>
</dd>
<dt><code>fpca</code></dt><dd><p>Numeric, FPCA-based regression fit</p>
</dd>
<dt><code>fpca_harmfit_params</code></dt><dd><p>a list, harmonic fit</p>
</dd>
<dt><code>fpca_fun_0der</code></dt><dd><p>Function fpca fit</p>
</dd>
<dt><code>fpca_fun_1der</code></dt><dd><p>Function fpca fit first derivative</p>
</dd>
<dt><code>fpca_fun_2der</code></dt><dd><p>Function fpca fit second derivative</p>
</dd>
<dt><code>fpca_fun_3der</code></dt><dd><p>Function fpca fit third derivative</p>
</dd>
<dt><code>fpca_fun_4der</code></dt><dd><p>Function fpca fit fourth derivative</p>
</dd>
<dt><code>phenoparams</code></dt><dd><p>Phenological dates estimate</p>
</dd>
<dt><code>status</code></dt><dd><p>Character, was phenopar estimation successful?</p>
</dd>
</dl>


<h3>See Also</h3>

<p><code><a href="#topic+sephora-methods">sephora-methods</a></code>
</p>

<hr>
<h2 id='vecFromData'>Get numeric vector from RData file</h2><span id='topic+vecFromData'></span>

<h3>Description</h3>

<p>Extract a numeric vector from an RData file
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vecFromData(
  product = c("MOD13Q1", "independent"),
  data,
  numRow,
  lenPeriod = 23
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vecFromData_+3A_product">product</code></td>
<td>
<p>character indicating whether <code>data</code> comes from a <code>MOD13Q1</code> (default) time series satellite
imagery or from an <code>independent</code> product.</p>
</td></tr>
<tr><td><code id="vecFromData_+3A_data">data</code></td>
<td>
<p>a matrix containing measurements of subsets (polygons) of a time series of satellite images. 
<code>nrow</code> is equal to the number of pixels in the polygon and <code>ncol</code> is equal 
to the number of images in the time series.</p>
</td></tr>
<tr><td><code id="vecFromData_+3A_numrow">numRow</code></td>
<td>
<p>numeric, number of row to extract from <code>data</code>.</p>
</td></tr>
<tr><td><code id="vecFromData_+3A_lenperiod">lenPeriod</code></td>
<td>
<p>numeric, number of observations per period. Default, 23.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Although the first available MOD13Q1 product dates back to 18-02-2000, 
when <code>product="MOD13Q1"</code> this function assumes that <code>data</code> contains observations from
01-01-2000 and <code><a href="#topic+fill_initialgap_MOD13Q1">fill_initialgap_MOD13Q1</a></code> is used to impute
the first three missing values of 2000.
</p>


<h3>Value</h3>

<p>A list with two components:
</p>
<table role = "presentation">
<tr><td><code>mat</code></td>
<td>
<p>extracted vector in matricial form</p>
</td></tr>
<tr><td><code>vec</code></td>
<td>
<p>extracted vector</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+fill_initialgap_MOD13Q1">fill_initialgap_MOD13Q1</a></code>, <code><a href="#topic+phenopar">phenopar</a></code>, 
<code><a href="geoTS.html#topic+raster_intersect_sp">raster_intersect_sp</a></code>, <code><a href="#topic+vecToMatrix">vecToMatrix</a></code>.
</p>

<hr>
<h2 id='vecToMatrix'>Mapping numeric vector to a matrix</h2><span id='topic+vecToMatrix'></span>

<h3>Description</h3>

<p>Maps a vector (pixel of a satellite time series) to a matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vecToMatrix(x, lenPeriod = 23)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vecToMatrix_+3A_x">x</code></td>
<td>
<p>a numeric vector whose length must be a multiple of <code>lenPeriod</code></p>
</td></tr>
<tr><td><code id="vecToMatrix_+3A_lenperiod">lenPeriod</code></td>
<td>
<p>a numeric, number of observations per period</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix with <code>nrow</code> equal to <code>length(x)/lenPeriod</code> and
<code>ncol</code> equal to <code>lenPeriod</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fill_initialgap_MOD13Q1">fill_initialgap_MOD13Q1</a></code>, <code><a href="#topic+phenopar">phenopar</a></code>, 
<code><a href="#topic+vecFromData">vecFromData</a></code>.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
