<!DOCTYPE html><html lang="en"><head><title>Help for package LocalControl</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {LocalControl}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#cardSim'><p>Simulated cardiac medication data for survival analysis</p></a></li>
<li><a href='#framingham'><p>Framingham heart study data extract on smoking and hypertension.</p></a></li>
<li><a href='#lindner'><p>Lindner Center for Research and Education study on Abciximab cost-effectiveness and survival</p></a></li>
<li><a href='#LocalControl'><p>Local Control</p></a></li>
<li><a href='#LocalControl-deprecated'><p>Deprecated LocalControl functions</p></a></li>
<li><a href='#LocalControlClassic'><p>Local Control Classic</p></a></li>
<li><a href='#LocalControlCompetingRisksConfidence'><p>Calculate confidence intervals around the cumulative incidence functions (CIFs) generated by LocalControl when outcomeType = &quot;survival&quot;.</p></a></li>
<li><a href='#LocalControlNearestNeighborsConfidence'><p>Provides a bootstrapped confidence interval estimate for LocalControl LTDs.</p></a></li>
<li><a href='#plot.LocalControlCR'><p>Plot cumulative incidence functions (CIFs) from Local Control.</p></a></li>
<li><a href='#plot.LocalControlCS'><p>Plots the local treatment difference as a function of radius for LocalControl.</p></a></li>
<li><a href='#SPSbalan'><p>Test for Within-Bin X-covariate Balance in Supervised Propensiy Scoring</p></a></li>
<li><a href='#SPSloess'><p>LOESS Smoothing of Outcome by Treatment in Supervised Propensiy Scoring</p></a></li>
<li><a href='#SPSlogit'><p>Propensity Score prediction of Treatment Selection from Patient Baseline X-covariates</p></a></li>
<li><a href='#SPSnbins'><p>Change the Number of Bins in Supervised Propensiy Scoring</p></a></li>
<li><a href='#SPSoutco'><p>Examine Treatment Differences on an Outcome Measure in Supervised Propensiy Scoring</p></a></li>
<li><a href='#UPSaccum'><p>Prepare for Accumulation of (Outcome,Treatment) Results in Unsupervised Propensity Scoring</p></a></li>
<li><a href='#UPSaltdd'><p>Artificial Distribution of LTDs from Random Clusters</p></a></li>
<li><a href='#UPSboxplot'><p>Returns a series of boxplots comparing LTD distributions given different numbers of clusters.</p></a></li>
<li><a href='#UPSgraph'><p>Display Sensitivity Analysis Graphic in Unsupervised Propensiy Scoring</p></a></li>
<li><a href='#UPShclus'><p>Hierarchical Clustering of Patients on X-covariates for Unsupervised Propensiy Scoring</p></a></li>
<li><a href='#UPSivadj'><p>Instrumental Variable LATE Linear Fitting in Unsupervised Propensiy Scoring</p></a></li>
<li><a href='#UPSLTDdist'><p>Plot the LTD distribution as a function of the number of clusters.</p></a></li>
<li><a href='#UPSnnltd'><p>Nearest Neighbor Distribution of LTDs in Unsupervised Propensiy Scoring</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Nonparametric Methods for Generating High Quality Comparative
Effectiveness Evidence</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.4</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-09-04</td>
</tr>
<tr>
<td>Description:</td>
<td>Implements novel nonparametric approaches to address
    biases and confounding when comparing treatments or exposures in
    observational studies of outcomes. While designed and appropriate for use
    in studies involving medicine and the life sciences, the package can be
    used in other situations involving outcomes with multiple confounders.
    The package implements a family of methods for non-parametric bias correction
    when comparing treatments in observational studies, including survival
    analysis settings, where competing risks and/or censoring may be present.
    The approach extends to bias-corrected personalized predictions of treatment
    outcome differences, and analysis of heterogeneity of treatment effect-sizes
    across patient subgroups. For further details, please see: 
    Lauve NR, Nelson SJ, Young SS, Obenchain RL, Lambert CG. LocalControl:
    An R Package for Comparative Safety and Effectiveness Research.
    Journal of Statistical Software. 2020. p. 1â€“32. Available from &lt;<a href="https://doi.org/10.18637%2Fjss.v096.i04">doi:10.18637/jss.v096.i04</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a> | file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/OHDSI/LocalControl">https://github.com/OHDSI/LocalControl</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/OHDSI/LocalControl/issues">https://github.com/OHDSI/LocalControl/issues</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>TRUE</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp, gss, cluster, lattice, stats, graphics</td>
</tr>
<tr>
<td>Suggests:</td>
<td>colorspace, RColorBrewer, data.table, ggplot2, gridExtra,
rpart, rpart.plot, xtable, knitr</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Christophe G. Lambert &lt;cglambert@salud.unm.edu&gt;</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-09-04 16:30:21 UTC; lambert</td>
</tr>
<tr>
<td>Author:</td>
<td>Nicolas R. Lauve <a href="https://orcid.org/0000-0002-9348-0319"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Stuart J. Nelson <a href="https://orcid.org/0000-0002-8756-0179"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  S. Stanley Young <a href="https://orcid.org/0000-0001-9449-5478"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Robert L. Obenchain
    <a href="https://orcid.org/0000-0002-8395-1666"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Melania Pintilie [ctb],
  Martin Kutz [ctb],
  Christophe G. Lambert
    <a href="https://orcid.org/0000-0003-1994-2893"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre]</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-09-04 22:30:18 UTC</td>
</tr>
</table>
<hr>
<h2 id='cardSim'>Simulated cardiac medication data for survival analysis</h2><span id='topic+cardSim'></span>

<h3>Description</h3>

<p>This dataset was created to demonstrate the effects of Local Control on correcting bias within a set of data.
</p>


<h3>Format</h3>

<p>A data frame with 1000 rows and 6 columns:
</p>

<dl>
<dt>id</dt><dd><p>Unique identifier for each row.</p>
</dd>
<dt>time</dt><dd><p>Time in years to the outcome specified by status.</p>
</dd>
<dt>status</dt><dd><p>1 if the patient experienced cardiac arrest. 0 if censored before that.</p>
</dd>
<dt>drug</dt><dd><p>Medication the patient received for cardiac health (drug 1 or drug 0).</p>
</dd>
<dt>age</dt><dd><p>Age of the patient, ranges from 18 to 65 years.</p>
</dd>
<dt>bmi</dt><dd><p>Patient body mass index. Majority of observations fall between 22 and 30.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Lauve NR, Lambert CG
</p>

<hr>
<h2 id='framingham'>Framingham heart study data extract on smoking and hypertension.</h2><span id='topic+framingham'></span>

<h3>Description</h3>

<p>Data collected over a 24 year study suitable for competing
risks survival analysis of hypertension and death as a function of smoking.
</p>


<h3>Format</h3>

<p>A data frame with 2316 rows and 11 columns:
</p>

<dl>
<dt>female</dt><dd><p>Sex of the patient. 1=female, 0=male.</p>
</dd>
<dt>totchol</dt><dd><p>Total cholesterol of patient at study entry.</p>
</dd>
<dt>age</dt><dd><p>Age of the patient at study entry.</p>
</dd>
<dt>bmi</dt><dd><p>Patient body mass index.</p>
</dd>
<dt>BPVar</dt><dd><p>Average units of systolic and diastolic blood pressure above normal: ((SystolicBP-120)/2) + (DiasystolicBP-80)</p>
</dd>
<dt>heartrte</dt><dd><p>Patient heartrate taken at study entry.</p>
</dd>
<dt>glucose</dt><dd><p>Patient blood glucose level.</p>
</dd>
<dt>cursmoke</dt><dd><p>Whether or not the patient was a smoker at the time of study entry.</p>
</dd>
<dt>outcome</dt><dd><p>Did the patient die, experience hypertension, or leave the study without experiencing either event.</p>
</dd>
<dt>time_outcome</dt><dd><p>The time at which the patient experienced outcome.</p>
</dd>
<dt>cigpday</dt><dd><p>Number of cigarettes smoked per day at time of study entry.</p>
</dd>
</dl>



<h3>References</h3>


<ul>
<li><p> Dawber TR, Meadors GF, Moore FE Jr. Epidemiological approaches to heart disease: the Framingham Study. Am J Public Health Nations Health. 1951;41(3):279-281.
</p>
</li>
<li><p> Teaching Datasets - Public Use Datasets. <a href="https://biolincc.nhlbi.nih.gov/teaching/">https://biolincc.nhlbi.nih.gov/teaching/</a>.
</p>
</li></ul>


<hr>
<h2 id='lindner'>Lindner Center for Research and Education study on Abciximab cost-effectiveness and survival</h2><span id='topic+lindner'></span>

<h3>Description</h3>

<p>The effects of Abciximab use on both survival and cardiac billing.
</p>


<h3>Format</h3>

<p>A data frame with 996 rows and 10 columns:
</p>

<dl>
<dt>lifepres</dt><dd><p>Life years preserved post treatment: 0 (died) vs. 11.6 (survived).</p>
</dd>
<dt>cardbill</dt><dd><p>Cardiac related billing in dollars within 12 months.</p>
</dd>
<dt>abcix</dt><dd><p>Indicates whether the patient received Abciximab treatment: 1=yes 0=no.</p>
</dd>
<dt>stent</dt><dd><p>Was a stent depolyed? 1=yes, 0=no.</p>
</dd>
<dt>height</dt><dd><p>Patient height in centimeters.</p>
</dd>
<dt>female</dt><dd><p>Patient sex: 1=female, 0=male.</p>
</dd>
<dt>diabetic</dt><dd><p>Was the patient diabetic? 1=yes, 0=no.</p>
</dd>
<dt>acutemi</dt><dd><p>Had the patient suffered an acute myocardial infarction witih the last seven days? 1=yes, 0=no.</p>
</dd>
<dt>ejecfrac</dt><dd><p>Left ventricular ejection fraction.</p>
</dd>
<dt>ves1proc</dt><dd><p>Number of vessels involved in the first PCI procedure.</p>
</dd>
</dl>



<h3>References</h3>

<p>Kereiakes DJ, Obenchain RL, Barber BL, Smith A, McDonald M, Broderick TM, Runyon JP, Shimshak TM, Schneider JF, Hattemer CR, Roth EM, Whang DD, Cocks D, Abbottsmith CW. Abciximab provides cost-effective survival advantage in high-volume interventional practice. Am Heart J. 2000;140(4):603-610.
</p>

<hr>
<h2 id='LocalControl'>Local Control</h2><span id='topic+LocalControl'></span>

<h3>Description</h3>

<p>Implements a non-parametric methodology for correcting biases when comparing the outcomes of two treatments in a
cross-sectional or case control observational study. This implementation of Local Control uses nearest neighbors to each point within
a given radius to compare treatment outcomes. Local Control matches along a continuum of similarity (radii), clustering the near neighbors
to a given observation by variables thought to be sources of bias and confounding. This is analogous to combining a host of smaller studies
that are each homogeneous within themselves, but represent the spectrum of variability of observations across diverse subpopulations. As the
clusters get smaller, some of them can become noninformative, whereby all cluster members contain only one treatment, and there is no basis
for comparison. Each observation has a unique set of near-neighbors, and the approach becomes more akin to a non-parametric
density estimate using similar observations within a covariate hypersphere of a given radius. The global treatment difference is
taken as the average of the treatment differences of the neighborhood around each observation.
</p>
<p>While <code><a href="#topic+LocalControlClassic">LocalControlClassic</a></code> uses the number of clusters as a varying parameter to visualize treatment differences
as a function of similarity of observations, this function instead uses a varying radius. The maximum radius enclosing all observations
corresponds to the biased estimate which compares the outcome of all those with treatment A versus all those with treatment B.
An easily interpretable graph can be created to illustrate the change in estimated outcome difference between two treatments, on average, across
all clusters, as a function of using smaller and more homogenous clusters. The <code><a href="#topic+LocalControlNearestNeighborsConfidence">LocalControlNearestNeighborsConfidence</a></code> procedure
statistically resamples this Local Control process to generate confidence estimates.
It is also helpful to plot a box-plot of the local treatment difference at a radius of zero, requiring that every observation has at
least one perfect match on the other treatment. When perfect matches exist, one can estimate the treatment difference without making
assumptions about the relative importance of the clustering variables. The <code><a href="#topic+plot.LocalControlCS">plot.LocalControlCS</a></code> function will plot both
visualizations in a single graph.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LocalControl(
  data,
  modelForm = NULL,
  outcomeType = "default",
  treatmentColName,
  outcomeColName,
  cenCode = 0,
  clusterVars,
  timeColName = "",
  treatmentCode,
  labelColName = "",
  radStepType = "exp",
  radDecayRate = 0.8,
  radMinFract = 0.01,
  radiusLevels = numeric(),
  normalize = TRUE,
  verbose = FALSE,
  numThreads = 1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="LocalControl_+3A_data">data</code></td>
<td>
<p>DataFrame containing all variables which will be used for the analysis.</p>
</td></tr>
<tr><td><code id="LocalControl_+3A_modelform">modelForm</code></td>
<td>
<p>A formula containing the necessary variables for Local Control analysis. This can be used as an alternative
to the primary interface for cross-sectional studies. The formula should be in the following format:
&quot;outcome ~ treatment | clusterVar1 ... clusterVarN&quot;.</p>
</td></tr>
<tr><td><code id="LocalControl_+3A_outcometype">outcomeType</code></td>
<td>
<p>Specifys the outcome type for the analysis.</p>
</td></tr>
<tr><td><code id="LocalControl_+3A_treatmentcolname">treatmentColName</code></td>
<td>
<p>A string containing the name of a column in data.
The column contains the treatment variable specifying the treatment groups.</p>
</td></tr>
<tr><td><code id="LocalControl_+3A_outcomecolname">outcomeColName</code></td>
<td>
<p>A string containing the name of a column in data.
The column contains the outcome variable to be compared between the treatment groups.</p>
</td></tr>
<tr><td><code id="LocalControl_+3A_cencode">cenCode</code></td>
<td>
<p>A value specifying which of the outcome values corresponds to a censored observation.</p>
</td></tr>
<tr><td><code id="LocalControl_+3A_clustervars">clusterVars</code></td>
<td>
<p>A character vector containing column names in data.
Each column contains an X-variable, or covariate which will be used to form patient clusters.</p>
</td></tr>
<tr><td><code id="LocalControl_+3A_timecolname">timeColName</code></td>
<td>
<p>A string containing the name of a column in data.
The column contains the time to outcome for each of the observations in data.</p>
</td></tr>
<tr><td><code id="LocalControl_+3A_treatmentcode">treatmentCode</code></td>
<td>
<p>(optional) A string containing one of the factor levels from the treatment column.
If provided, the corresponding treatment will be considered &quot;Treatment 1&quot;.
Otherwise, the first &quot;level&quot; of the column will be considered the primary treatment.</p>
</td></tr>
<tr><td><code id="LocalControl_+3A_labelcolname">labelColName</code></td>
<td>
<p>(optional) A string containing the name of a column from data.
The column contains labels for each of the observations in data, defaults to the row indices.</p>
</td></tr>
<tr><td><code id="LocalControl_+3A_radsteptype">radStepType</code></td>
<td>
<p>(optional) Used in the generation of correction radii.
The step type used to generate each correction radius after the maximum.
Currently accepts &quot;unif&quot; and &quot;exp&quot; (default).
&quot;unif&quot; for uniform decay ex: (radDecayRate = 0.1) (1, 0.9, 0.8, 0.7, ..., ~minRadFract, 0)
&quot;exp&quot; for exponential decay ex: (radDecayRate = 0.9) (1, 0.9, 0.81, 0.729, ..., ~minRadFract, 0)</p>
</td></tr>
<tr><td><code id="LocalControl_+3A_raddecayrate">radDecayRate</code></td>
<td>
<p>(optional) Used in the generation of correction radii.
The size of the &quot;step&quot; between each of the generated correction radii.
If radStepType == &quot;exp&quot;, radDecayRate must be a value between (0,1).
This value defaults to 0.8.</p>
</td></tr>
<tr><td><code id="LocalControl_+3A_radminfract">radMinFract</code></td>
<td>
<p>(optional) Used in the generation of correction radii.
A floating point number representing the smallest fraction of the maximum radius to use as a correction radius.</p>
</td></tr>
<tr><td><code id="LocalControl_+3A_radiuslevels">radiusLevels</code></td>
<td>
<p>(optional) By default, Local Control builds a set of radii to fit data.
The radiusLevels parameter allows users to override the construction by explicitly providing a set of radii.</p>
</td></tr>
<tr><td><code id="LocalControl_+3A_normalize">normalize</code></td>
<td>
<p>(optional) Logical value. Tells local control if it should or should not normalize the covariates. Default is TRUE.</p>
</td></tr>
<tr><td><code id="LocalControl_+3A_verbose">verbose</code></td>
<td>
<p>(optional) Logical value. Display or suppress the console output during the call to Local Control. Default is FALSE.</p>
</td></tr>
<tr><td><code id="LocalControl_+3A_numthreads">numThreads</code></td>
<td>
<p>(optional) An integer value specifying the number of threads which will be assigned to the analysis.
The maximum number of threads varies depending on the system hardware. Defaults to 1 thread.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the results from the call to LocalControl.
</p>

<dl>
<dt>outcomes</dt><dd><p>List containing two dataframes for the average T1 and T0 outcomes within each cluster at each radius.</p>
</dd>
<dt>counts</dt><dd><p>List containing two dataframes which hold the number of T1 and T0 patients within each cluster at each radius.</p>
</dd>
<dt>ltds</dt><dd><p>Dataframe containing the average LTD within each cluster at each radius.</p>
</dd>
<dt>summary</dt><dd><p>Dataframe containing summary statistics about the analysis for each radius.</p>
</dd>
<dt>params</dt><dd><p>List containing the parameters used to call LocalControl.</p>
</dd>
</dl>



<h3>References</h3>


<ul>
<li><p> Lauve NR, Nelson SJ, Young SS, Obenchain RL, Lambert CG. LocalControl: An R Package for Comparative Safety and Effectiveness Research. Journal of Statistical Software. 2020. p. 1-32. Available from: http://dx.doi.org/10.18637/jss.v096.i04
</p>
</li>
<li><p> Fischer K, Gartner B, Kutz M. Fast Smallest-Enclosing-Ball Computation in High Dimensions. In: Algorithms - ESA 2003. Springer, Berlin, Heidelberg; 2003:630-641.
</p>
</li>
<li><p> Martin Kutz, Kaspar Fischer, Bernd Gartner. miniball-1.0.3. <a href="https://github.com/hbf/miniball">https://github.com/hbf/miniball</a>.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'> # cross-sectional

 data(lindner)
 linVars &lt;- c("stent", "height", "female", "diabetic", "acutemi",
              "ejecfrac", "ves1proc")
 csresults = LocalControl(data = lindner,
                          clusterVars = linVars,
                          treatmentColName = "abcix",
                          outcomeColName = "cardbill",
                          treatmentCode = 1)
 plot(csresults)


 # survival / competing risks example

 data(cardSim)
 crresults = LocalControl(data = cardSim, outcomeType = "survival",
                          outcomeColName = "status",
                          timeColName = "time",
                          treatmentColName = "drug",
                          treatmentCode = 1,
                          clusterVars = c("age", "bmi"))
 plot(crresults)
</code></pre>

<hr>
<h2 id='LocalControl-deprecated'>Deprecated LocalControl functions</h2><span id='topic+LocalControl-deprecated'></span><span id='topic+localControlNearestNeighbors'></span><span id='topic+localControlCompetingRisks'></span><span id='topic+plotLocalControlCIF'></span><span id='topic+plotLocalControlLTD'></span>

<h3>Description</h3>

<p>These functions are provided for compatibility with previous versions of LocalControl.
They may eventually be completely removed.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: right;">
  <code>localControlNearestNeighbors</code> </td><td style="text-align: left;"> Now called using <code><a href="#topic+LocalControl">LocalControl</a></code> with the outcomeType = "cross-sectional". </td>
</tr>
<tr>
 <td style="text-align: right;">
  <code>localControlCompetingRisks</code>   </td><td style="text-align: left;"> Now called using <code><a href="#topic+LocalControl">LocalControl</a></code> with the outcomeType = "survival". </td>
</tr>
<tr>
 <td style="text-align: right;">
  <code>plotLocalControlCIF</code>   </td><td style="text-align: left;"> Now called using <code><a href="#topic+plot.LocalControlCR">plot.LocalControlCR</a></code>. </td>
</tr>
<tr>
 <td style="text-align: right;">
  <code>plotLocalControlLTD</code>   </td><td style="text-align: left;"> Now called using <code><a href="#topic+plot.LocalControlCS">plot.LocalControlCS</a></code>. </td>
</tr>
<tr>
 <td style="text-align: right;">
</td>
</tr>

</table>


<hr>
<h2 id='LocalControlClassic'>Local Control Classic</h2><span id='topic+LocalControlClassic'></span>

<h3>Description</h3>

<p>LocalControlClassic was originally contained in the deprecated
CRAN package USPS, this function is a combination
of three of the original USPS functions, UPShclus, UPSaccum, and UPSnnltd.
This replicates the original implementation of the Local Control functionality in
Robert Obenchain's USPS package. Some of the features have been
removed due to deprecation of R packages distributed through CRAN.
For a given number of patient clusters in baseline X-covariate space, LocalControlClassic()
characterizes the distribution of Nearest Neighbor &quot;Local Treatement Differences&quot; (LTDs) on
a specified Y-outcome variable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LocalControlClassic(
  data,
  clusterVars,
  treatmentColName,
  outcomeColName,
  faclev = 3,
  scedas = "homo",
  clusterMethod = "ward",
  clusterDist = "euclidean",
  clusterCounts = c(50, 100, 200)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="LocalControlClassic_+3A_data">data</code></td>
<td>
<p>The data frame containing all baseline X covariates.</p>
</td></tr>
<tr><td><code id="LocalControlClassic_+3A_clustervars">clusterVars</code></td>
<td>
<p>List of names of X variable(s).</p>
</td></tr>
<tr><td><code id="LocalControlClassic_+3A_treatmentcolname">treatmentColName</code></td>
<td>
<p>Name of treatment factor variable.</p>
</td></tr>
<tr><td><code id="LocalControlClassic_+3A_outcomecolname">outcomeColName</code></td>
<td>
<p>Name of outcome Y variable.</p>
</td></tr>
<tr><td><code id="LocalControlClassic_+3A_faclev">faclev</code></td>
<td>
<p>Maximum number of different numerical values an outcome variable can assume
without automatically being converted into a &quot;factor&quot; variable; faclev=1 causes a binary
indicator to be treated as a continuous variable determining an average or proportion.</p>
</td></tr>
<tr><td><code id="LocalControlClassic_+3A_scedas">scedas</code></td>
<td>
<p>Scedasticity assumption: &quot;homo&quot; or &quot;hete&quot;.</p>
</td></tr>
<tr><td><code id="LocalControlClassic_+3A_clustermethod">clusterMethod</code></td>
<td>
<p>Type of clustering method, defaults to &quot;complete&quot;. Currently implemented methods:  &quot;ward&quot;, &quot;single&quot;, &quot;complete&quot; or &quot;average&quot;.</p>
</td></tr>
<tr><td><code id="LocalControlClassic_+3A_clusterdist">clusterDist</code></td>
<td>
<p>Distance type to use, defaults to &quot;euclidean&quot;. Currently implemented: &quot;euclidiean&quot;, &quot;manhattan&quot;, &quot;maximum&quot;, or &quot;minkowski&quot;.</p>
</td></tr>
<tr><td><code id="LocalControlClassic_+3A_clustercounts">clusterCounts</code></td>
<td>
<p>A vector containing different number of clusters in baseline X-covariate space which Local Control will iterate over.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a list containing several elements.
</p>
<table role = "presentation">
<tr><td><code>hiclus</code></td>
<td>
<p>Name of clustering object created by UPShclus().</p>
</td></tr>
<tr><td><code>dframe</code></td>
<td>
<p>Name of data.frame containing X, t &amp; Y variables.</p>
</td></tr>
<tr><td><code>trtm</code></td>
<td>
<p>Name of treatment factor variable.</p>
</td></tr>
<tr><td><code>yvar</code></td>
<td>
<p>Name of outcome Y variable.</p>
</td></tr>
<tr><td><code>numclust</code></td>
<td>
<p>Number of clusters requested.</p>
</td></tr>
<tr><td><code>actclust</code></td>
<td>
<p>Number of clusters actually produced.</p>
</td></tr>
<tr><td><code>scedas</code></td>
<td>
<p>Scedasticity assumption: &quot;homo&quot; or &quot;hete&quot;</p>
</td></tr>
<tr><td><code>PStdif</code></td>
<td>
<p>Character string describing the treatment difference.</p>
</td></tr>
<tr><td><code>nnhbindf</code></td>
<td>
<p>Vector containing cluster number for each patient. </p>
</td></tr>
<tr><td><code>rawmean</code></td>
<td>
<p>Unadjusted outcome mean by treatment group.</p>
</td></tr>
<tr><td><code>rawvars</code></td>
<td>
<p>Unadjusted outcome variance by treatment group.</p>
</td></tr>
<tr><td><code>rawfreq</code></td>
<td>
<p>Number of patients by treatment group.</p>
</td></tr>
<tr><td><code>ratdif</code></td>
<td>
<p>Unadjusted mean outcome difference between treatments.</p>
</td></tr>
<tr><td><code>ratsde</code></td>
<td>
<p>Standard error of unadjusted mean treatment difference.</p>
</td></tr>
<tr><td><code>binmean</code></td>
<td>
<p>Unadjusted mean outcome by cluster and treatment.</p>
</td></tr>
<tr><td><code>binvars</code></td>
<td>
<p>Unadjusted variance by cluster and treatment.</p>
</td></tr>
<tr><td><code>binfreq</code></td>
<td>
<p>Number of patients by bin and treatment.</p>
</td></tr>
<tr><td><code>awbdif</code></td>
<td>
<p>Across cluster average difference with cluster size weights.</p>
</td></tr>
<tr><td><code>awbsde</code></td>
<td>
<p>Standard error of awbdif.</p>
</td></tr>
<tr><td><code>wwbdif</code></td>
<td>
<p>Across cluster average difference, inverse variance weights.</p>
</td></tr>
<tr><td><code>wwbsde</code></td>
<td>
<p>Standard error of wwbdif.</p>
</td></tr>
<tr><td><code>faclev</code></td>
<td>
<p>Maximum number of different numerical values an outcome variable can assume without
automatically being converted into a &quot;factor&quot; variable; faclev=1 causes a binary indicator to be
treated as a continuous variable determining an average or proportion.</p>
</td></tr>
<tr><td><code>youtype</code></td>
<td>
<p>&quot;continuous&quot; =&gt; only next eight outputs; &quot;factor&quot; =&gt; only last three outputs.</p>
</td></tr>
<tr><td><code>aovdiff</code></td>
<td>
<p>ANOVA summary for treatment main effect only.</p>
</td></tr>
<tr><td><code>form2</code></td>
<td>
<p>Formula for outcome differences due to bins and to treatment nested within bins.</p>
</td></tr>
<tr><td><code>bindiff</code></td>
<td>
<p>ANOVA summary for treatment nested within cluster.</p>
</td></tr>
<tr><td><code>sig2</code></td>
<td>
<p>Estimate of error mean square in nested model.</p>
</td></tr>
<tr><td><code>pbindif</code></td>
<td>
<p>Unadjusted treatment difference by cluster.</p>
</td></tr>
<tr><td><code>pbinsde</code></td>
<td>
<p>Standard error of the unadjusted difference by cluster.</p>
</td></tr>
<tr><td><code>pbinsiz</code></td>
<td>
<p>Cluster radii measure: square root of total number of patients.</p>
</td></tr>
<tr><td><code>symsiz</code></td>
<td>
<p>Symbol size of largest possible Snowball in a UPSnnltd() plot with 1 cluster.</p>
</td></tr>
<tr><td><code>factab</code></td>
<td>
<p>Marginal table of counts by Y-factor level and treatment.</p>
</td></tr>
<tr><td><code>cumchi</code></td>
<td>
<p>Cumulative Chi-Square statistic for interaction in the three-way, nested table.</p>
</td></tr>
<tr><td><code>cumdf</code></td>
<td>
<p>Degrees of-Freedom for the Cumulative Chi-Squared.</p>
</td></tr>
</table>


<h3>References</h3>


<ul>
<li><p> Obenchain, RL. <em>USPS package: Unsupervised and Supervised Propensity Scoring in R.</em> <a href="https://cran.r-project.org/src/contrib/Archive/USPS/">https://cran.r-project.org/src/contrib/Archive/USPS/</a> 2005.
</p>
</li>
<li><p> Obenchain, RL. <em>The &rdquo;Local Control&rdquo; Approach to Adjustment for Treatment Selection Bias and Confounding (illustrated with JMP Scripts)</em>. Observational Studies. Cary, NC: SAS Press. 2009.
</p>
</li>
<li><p> Obenchain RL. The local control approach using JMP. In: Faries D, Leon AC, Haro JM, Obenchain RL, eds. Analysis of Observational Health Care Data Using SAS. Cary, NC: SAS Institute; 2010:151-194.
</p>
</li>
<li><p> Obenchain RL, Young SS. Advancing statistical thinking in observational health care research. J Stat Theory Pract. 2013;7(2):456-506.
</p>
</li>
<li><p> Faries DE, Chen Y, Lipkovich I, Zagar A, Liu X, Obenchain RL. Local control for identifying subgroups of interest in observational research: persistence of treatment for major depressive disorder. Int J Methods Psychiatr Res. 2013;22(3):185-194.
</p>
</li>
<li><p> Lopiano KK, Obenchain RL, Young SS. Fair treatment comparisons in observational research. Stat Anal Data Min. 2014;7(5):376-384.
</p>
</li>
<li><p> Young SS, Obenchain RL, Lambert CG (2016) A problem of bias and response heterogeneity. In: Alan Moghissi A, Ross G (eds) Standing with giants: A collection of public health essays in memoriam to Dr. Elizabeth M. Whelan. American Council on Science and Health, New York, NY, pp 153-169.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'> data(lindner)

 cvars &lt;- c("stent","height","female","diabetic","acutemi",
            "ejecfrac","ves1proc")
 numClusters &lt;- c(1, 2, 10, 15, 20, 25, 30, 35, 40, 45, 50)
 results &lt;- LocalControlClassic( data = lindner,
                                clusterVars = cvars,
                                treatmentColName = "abcix",
                                outcomeColName = "cardbill",
                                clusterCounts = numClusters)
 UPSLTDdist(results,ylim=c(-15000,15000))

</code></pre>

<hr>
<h2 id='LocalControlCompetingRisksConfidence'>Calculate confidence intervals around the cumulative incidence functions (CIFs) generated by LocalControl when outcomeType = &quot;survival&quot;.</h2><span id='topic+LocalControlCompetingRisksConfidence'></span>

<h3>Description</h3>

<p>Given the output of <code><a href="#topic+LocalControl">LocalControl</a></code>, this function produces pointwise standard error estimates
for the cumulative incidence functions (CIFs) using a modified version of Choudhury's approach (2002). This function currently supports
the creation of 90%, 95%, 98%, and 99% confidence intervals with linear, log(-log), and arcsine transformations of the estimates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LocalControlCompetingRisksConfidence(
  LCCompRisk,
  confLevel = "95%",
  confTransform = "asin"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="LocalControlCompetingRisksConfidence_+3A_lccomprisk">LCCompRisk</code></td>
<td>
<p>Output from a successful call to LocalControl with outcomeType = &quot;survival&quot;.</p>
</td></tr>
<tr><td><code id="LocalControlCompetingRisksConfidence_+3A_conflevel">confLevel</code></td>
<td>
<p>Level of confidence with which the confidence intervals will be formed. Choices are: &quot;90%&quot;, &quot;95%&quot;, &quot;98%&quot;, &quot;99%&quot;.</p>
</td></tr>
<tr><td><code id="LocalControlCompetingRisksConfidence_+3A_conftransform">confTransform</code></td>
<td>
<p>Transformation of the confidence intervals, defaults to arcsin (&quot;asin&quot;).
&quot;log&quot; and &quot;linear&quot; are also implemented.</p>
</td></tr>
</table>


<h3>References</h3>


<ul>
<li><p> Lauve NR, Nelson SJ, Young SS, Obenchain RL, Lambert CG. LocalControl: An R Package for Comparative Safety and Effectiveness Research. Journal of Statistical Software. 2020. p. 1-32. Available from: http://dx.doi.org/10.18637/jss.v096.i04
</p>
</li>
<li><p> Choudhury JB (2002) Non-parametric confidence interval estimation for competing risks analysis: application to contraceptive data. Stat Med 21:1129-1144. doi: 10.1002/sim.1070
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'> data(cardSim)
 results = LocalControl(data = cardSim,
                        outcomeType = "survival",
                        outcomeColName = "status",
                        timeColName = "time",
                        treatmentColName = "drug",
                        treatmentCode = 1,
                        clusterVars = c("age", "bmi"))

 conf = LocalControlCompetingRisksConfidence(results)

</code></pre>

<hr>
<h2 id='LocalControlNearestNeighborsConfidence'>Provides a bootstrapped confidence interval estimate for LocalControl LTDs.</h2><span id='topic+LocalControlNearestNeighborsConfidence'></span>

<h3>Description</h3>

<p>Given a number of bootstrap iterations and the params used to call
<code><a href="#topic+LocalControl">LocalControl</a></code> with outcomeType = &quot;default&quot;, this function calls LocalControl nBootstrap times.
The 50% and 95% quantiles are drawn from the distribution of results to produce the LTD confidence intervals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LocalControlNearestNeighborsConfidence(
  data,
  nBootstrap,
  randSeed,
  treatmentColName,
  treatmentCode = "",
  outcomeColName,
  clusterVars,
  labelColName = "",
  numThreads = 1,
  radiusLevels = numeric(),
  radStepType = "exp",
  radDecayRate = 0.8,
  radMinFract = 0.01,
  normalize = TRUE,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="LocalControlNearestNeighborsConfidence_+3A_data">data</code></td>
<td>
<p>DataFrame containing all variables which will be used for the analysis.</p>
</td></tr>
<tr><td><code id="LocalControlNearestNeighborsConfidence_+3A_nbootstrap">nBootstrap</code></td>
<td>
<p>The number of times to resample and run LocalControl for the confidence intervals.</p>
</td></tr>
<tr><td><code id="LocalControlNearestNeighborsConfidence_+3A_randseed">randSeed</code></td>
<td>
<p>The seed used to set random number generator state prior to resampling. No default value, provide one for reproducible results.</p>
</td></tr>
<tr><td><code id="LocalControlNearestNeighborsConfidence_+3A_treatmentcolname">treatmentColName</code></td>
<td>
<p>A string containing the name of a column in data.
The column contains the treatment variable specifying the treatment groups.</p>
</td></tr>
<tr><td><code id="LocalControlNearestNeighborsConfidence_+3A_treatmentcode">treatmentCode</code></td>
<td>
<p>(optional) A string containing one of the factor levels from the treatment column.
If provided, the corresponding treatment will be considered &quot;Treatment 1&quot;.
Otherwise, the first &quot;level&quot; of the column will be considered the primary treatment.</p>
</td></tr>
<tr><td><code id="LocalControlNearestNeighborsConfidence_+3A_outcomecolname">outcomeColName</code></td>
<td>
<p>A string containing the name of a column in data.
The column contains the outcome variable to be compared between the treatment groups.
If outcomeType = &quot;survival&quot;, the outcome column holds the failure/censor assignments.</p>
</td></tr>
<tr><td><code id="LocalControlNearestNeighborsConfidence_+3A_clustervars">clusterVars</code></td>
<td>
<p>A character vector containing column names in data.
Each column contains an X-variable, or covariate which will be used to form patient clusters.</p>
</td></tr>
<tr><td><code id="LocalControlNearestNeighborsConfidence_+3A_labelcolname">labelColName</code></td>
<td>
<p>(optional) A string containing the name of a column from data.
The column contains labels for each of the observations in data, defaults to the row indices.</p>
</td></tr>
<tr><td><code id="LocalControlNearestNeighborsConfidence_+3A_numthreads">numThreads</code></td>
<td>
<p>(optional) An integer value specifying the number of threads which will be assigned to the analysis.
The maximum number of threads varies depending on the system hardware. Defaults to 1 thread.</p>
</td></tr>
<tr><td><code id="LocalControlNearestNeighborsConfidence_+3A_radiuslevels">radiusLevels</code></td>
<td>
<p>(optional) By default, Local Control builds a set of radii to fit data.
The radiusLevels parameter allows users to override the construction by explicitly providing a set of radii.</p>
</td></tr>
<tr><td><code id="LocalControlNearestNeighborsConfidence_+3A_radsteptype">radStepType</code></td>
<td>
<p>(optional) Used in the generation of correction radii.
The step type used to generate each correction radius after the maximum.
Currently accepts &quot;unif&quot; and &quot;exp&quot; (default).
&quot;unif&quot; for uniform decay ex: (radDecayRate = 0.1) (1, 0.9, 0.8, 0.7, ..., ~minRadFract, 0)
&quot;exp&quot; for exponential decay ex: (radDecayRate = 0.9) (1, 0.9, 0.81, 0.729, ..., ~minRadFract, 0)</p>
</td></tr>
<tr><td><code id="LocalControlNearestNeighborsConfidence_+3A_raddecayrate">radDecayRate</code></td>
<td>
<p>(optional) Used in the generation of correction radii.
The size of the &quot;step&quot; between each of the generated correction radii.
If radStepType == &quot;exp&quot;, radDecayRate must be a value between (0,1).
This value defaults to 0.8.</p>
</td></tr>
<tr><td><code id="LocalControlNearestNeighborsConfidence_+3A_radminfract">radMinFract</code></td>
<td>
<p>(optional) Used in the generation of correction radii.
A floating point number representing the smallest fraction of the maximum radius to use as a correction radius.</p>
</td></tr>
<tr><td><code id="LocalControlNearestNeighborsConfidence_+3A_normalize">normalize</code></td>
<td>
<p>(optional) Logical value. Tells local control if it should or should not normalize the covariates. Default is TRUE.</p>
</td></tr>
<tr><td><code id="LocalControlNearestNeighborsConfidence_+3A_verbose">verbose</code></td>
<td>
<p>(optional) Logical value. Display or suppress the console output during the call to Local Control. Default is FALSE.</p>
</td></tr>
</table>


<h3>References</h3>


<ul>
<li><p> Lauve NR, Nelson SJ, Young SS, Obenchain RL, Lambert CG. LocalControl: An R Package for Comparative Safety and Effectiveness Research. Journal of Statistical Software. 2020. p. 1-32. Available from: http://dx.doi.org/10.18637/jss.v096.i04
</p>
</li>
<li><p> Kereiakes DJ, Obenchain RL, Barber BL, Smith A, McDonald M, Broderick TM, Runyon JP, Shimshak TM, Schneider JF, Hattemer CR, Roth EM, Whang DD, Cocks D, Abbottsmith CW. Abciximab provides cost-effective survival advantage in high-volume interventional practice. Am Heart J. 2000 Oct;140(4):603-610. PMID: 11011333
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
#input the abciximab study data of Kereiakes et al. (2000).
data(lindner)

linVars &lt;- c("stent", "height", "female", "diabetic", "acutemi",
             "ejecfrac", "ves1proc")
results &lt;- LocalControl(data = lindner,
                        clusterVars = linVars,
                        treatmentColName = "abcix",
                        outcomeColName = "cardbill",
                        treatmentCode = 1)

#Calculate the confidence intervals via resampling.
confResults = LocalControlNearestNeighborsConfidence(
                                        data = lindner,
                                        clusterVars = linVars,
                                        treatmentColName = "abcix",
                                        outcomeColName = "cardbill",
                                        treatmentCode = 1, nBootstrap = 20)

# Plot the local treatment difference with confidence intervals.
plot(results, confResults)

## End(Not run)

</code></pre>

<hr>
<h2 id='plot.LocalControlCR'>Plot cumulative incidence functions (CIFs) from Local Control.</h2><span id='topic+plot.LocalControlCR'></span>

<h3>Description</h3>

<p>Given the results from LocalControl with outcomeType = &quot;survival&quot;,
plot a corrected and uncorrected cumulative incidence function (CIF) for both groups.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'LocalControlCR'
plot(
  x,
  ...,
  rad2plot,
  xlim,
  ylim = c(0, 1),
  col1 = "blue",
  col0 = "red",
  xlab = "Time",
  ylab = "Cumulative incidence",
  legendLocation = "topleft",
  main = "",
  group1 = "Treatment 1",
  group0 = "Treatment 0"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.LocalControlCR_+3A_x">x</code></td>
<td>
<p>Return object from LocalControl with outcomeType = &quot;survival&quot;.</p>
</td></tr>
<tr><td><code id="plot.LocalControlCR_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="graphics.html#topic+plot.default">graphics::plot.default</a></code>
</p>

<dl>
<dt><code>type</code></dt><dd><p>1-character string giving the type of plot desired.  The
following values are possible, for details, see <code><a href="graphics.html#topic+plot">plot</a></code>:
<code>"p"</code> for points, <code>"l"</code> for lines,
<code>"b"</code> for both points and lines,
<code>"c"</code> for empty points joined by lines,
<code>"o"</code> for overplotted points and lines,
<code>"s"</code> and <code>"S"</code> for stair steps and
<code>"h"</code> for histogram-like vertical lines.  Finally,
<code>"n"</code> does not produce any points or lines.</p>
</dd>
<dt><code>log</code></dt><dd><p>a character string which contains <code>"x"</code> if the x axis
is to be logarithmic, <code>"y"</code> if the y axis is to be logarithmic
and <code>"xy"</code> or <code>"yx"</code> if both axes are to be logarithmic.</p>
</dd>
<dt><code>sub</code></dt><dd><p>a subtitle for the plot.</p>
</dd>
<dt><code>ann</code></dt><dd><p>a logical value indicating whether the default annotation
(title and x and y axis labels) should appear on the plot.</p>
</dd>
<dt><code>axes</code></dt><dd><p>a logical value indicating whether both axes should be drawn on
the plot.  Use <a href="graphics.html#topic+graphical+20parameter">graphical parameter</a> <code>"xaxt"</code> or <code>"yaxt"</code>
to suppress just one of the axes.</p>
</dd>
<dt><code>frame.plot</code></dt><dd><p>a logical indicating whether a box should be drawn
around the plot.</p>
</dd>
<dt><code>panel.first</code></dt><dd><p>an &lsquo;expression&rsquo; to be evaluated after the
plot axes are set up but before any plotting takes place.  This can
be useful for drawing background grids or scatterplot smooths.  Note
that this works by lazy evaluation: passing this argument from other
<code>plot</code> methods may well not work since it may be evaluated too
early.</p>
</dd>
<dt><code>panel.last</code></dt><dd><p>an expression to be evaluated after plotting has
taken place but before the axes, title and box are added.  See the
comments about <code>panel.first</code>.</p>
</dd>
<dt><code>asp</code></dt><dd><p>the <code class="reqn">y/x</code> aspect ratio, see <code><a href="graphics.html#topic+plot.window">plot.window</a></code>.</p>
</dd>
<dt><code>xgap.axis,ygap.axis</code></dt><dd><p>the <code class="reqn">x/y</code> axis gap factors, passed as
<code>gap.axis</code> to the two <code><a href="graphics.html#topic+axis">axis</a>()</code> calls (when
<code>axes</code> is true, as per default).</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="plot.LocalControlCR_+3A_rad2plot">rad2plot</code></td>
<td>
<p>The index or name (&quot;rad_#&quot;) of the radius to plot. By default, the radius with pct_informative closest to
0.8 will be selected.</p>
</td></tr>
<tr><td><code id="plot.LocalControlCR_+3A_xlim">xlim</code></td>
<td>
<p>The x axis bounds. Defaults to c(0, max(lccrResults$Failtimes)).</p>
</td></tr>
<tr><td><code id="plot.LocalControlCR_+3A_ylim">ylim</code></td>
<td>
<p>The y axis bounds. Defaults to c(0,1).</p>
</td></tr>
<tr><td><code id="plot.LocalControlCR_+3A_col1">col1</code></td>
<td>
<p>The plot color for group 1.</p>
</td></tr>
<tr><td><code id="plot.LocalControlCR_+3A_col0">col0</code></td>
<td>
<p>The plot color for group 0.</p>
</td></tr>
<tr><td><code id="plot.LocalControlCR_+3A_xlab">xlab</code></td>
<td>
<p>The x axis label. Defaults to &quot;Time&quot;.</p>
</td></tr>
<tr><td><code id="plot.LocalControlCR_+3A_ylab">ylab</code></td>
<td>
<p>The y axis label. Defaults to &quot;Cumulative incidence&quot;.</p>
</td></tr>
<tr><td><code id="plot.LocalControlCR_+3A_legendlocation">legendLocation</code></td>
<td>
<p>The location to place the legend. Default &quot;topleft&quot;.</p>
</td></tr>
<tr><td><code id="plot.LocalControlCR_+3A_main">main</code></td>
<td>
<p>The main plot title. Default is empty.</p>
</td></tr>
<tr><td><code id="plot.LocalControlCR_+3A_group1">group1</code></td>
<td>
<p>The name of the primary group (Treatment 1).</p>
</td></tr>
<tr><td><code id="plot.LocalControlCR_+3A_group0">group0</code></td>
<td>
<p>The name of the secondary group (Treatment 0).</p>
</td></tr>
</table>


<h3>References</h3>


<ul>
<li><p> Lauve NR, Nelson SJ, Young SS, Obenchain RL, Lambert CG. LocalControl: An R Package for Comparative Safety and Effectiveness Research. Journal of Statistical Software. 2020. p. 1-32. Available from: http://dx.doi.org/10.18637/jss.v096.i04
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>data("cardSim")
results = LocalControl(data = cardSim,
                       outcomeType = "survival",
                       outcomeColName = "status",
                       timeColName = "time",
                       treatmentColName = "drug",
                       treatmentCode = 1,
                       clusterVars = c("age", "bmi"))
plot(results)

</code></pre>

<hr>
<h2 id='plot.LocalControlCS'>Plots the local treatment difference as a function of radius for LocalControl.</h2><span id='topic+plot.LocalControlCS'></span>

<h3>Description</h3>

<p>Creates a plot where the y axis represents the local treatment difference,
while the x axis represents the percentage of the maximum radius. If the confidence summary (nnConfidence)
is provided, the 50% and 95% confidence estimates are also plotted.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'LocalControlCS'
plot(
  x,
  ...,
  nnConfidence,
  ylim,
  legendLocation = "bottomleft",
  ylab = "LTD",
  xlab = "Fraction of maximum radius",
  main = ""
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.LocalControlCS_+3A_x">x</code></td>
<td>
<p>Return object from LocalControl with &quot;default&quot; outcomeType.</p>
</td></tr>
<tr><td><code id="plot.LocalControlCS_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="graphics.html#topic+plot.default">graphics::plot.default</a></code>
</p>

<dl>
<dt><code>type</code></dt><dd><p>1-character string giving the type of plot desired.  The
following values are possible, for details, see <code><a href="graphics.html#topic+plot">plot</a></code>:
<code>"p"</code> for points, <code>"l"</code> for lines,
<code>"b"</code> for both points and lines,
<code>"c"</code> for empty points joined by lines,
<code>"o"</code> for overplotted points and lines,
<code>"s"</code> and <code>"S"</code> for stair steps and
<code>"h"</code> for histogram-like vertical lines.  Finally,
<code>"n"</code> does not produce any points or lines.</p>
</dd>
<dt><code>xlim</code></dt><dd><p>the x limits (x1, x2) of the plot.  Note that <code>x1 &gt; x2</code>
is allowed and leads to a &lsquo;reversed axis&rsquo;.
</p>
<p>The default value, <code>NULL</code>, indicates that the range of the
<a href="base.html#topic+finite">finite</a> values to be plotted should be used.</p>
</dd>
<dt><code>log</code></dt><dd><p>a character string which contains <code>"x"</code> if the x axis
is to be logarithmic, <code>"y"</code> if the y axis is to be logarithmic
and <code>"xy"</code> or <code>"yx"</code> if both axes are to be logarithmic.</p>
</dd>
<dt><code>sub</code></dt><dd><p>a subtitle for the plot.</p>
</dd>
<dt><code>ann</code></dt><dd><p>a logical value indicating whether the default annotation
(title and x and y axis labels) should appear on the plot.</p>
</dd>
<dt><code>axes</code></dt><dd><p>a logical value indicating whether both axes should be drawn on
the plot.  Use <a href="graphics.html#topic+graphical+20parameter">graphical parameter</a> <code>"xaxt"</code> or <code>"yaxt"</code>
to suppress just one of the axes.</p>
</dd>
<dt><code>frame.plot</code></dt><dd><p>a logical indicating whether a box should be drawn
around the plot.</p>
</dd>
<dt><code>panel.first</code></dt><dd><p>an &lsquo;expression&rsquo; to be evaluated after the
plot axes are set up but before any plotting takes place.  This can
be useful for drawing background grids or scatterplot smooths.  Note
that this works by lazy evaluation: passing this argument from other
<code>plot</code> methods may well not work since it may be evaluated too
early.</p>
</dd>
<dt><code>panel.last</code></dt><dd><p>an expression to be evaluated after plotting has
taken place but before the axes, title and box are added.  See the
comments about <code>panel.first</code>.</p>
</dd>
<dt><code>asp</code></dt><dd><p>the <code class="reqn">y/x</code> aspect ratio, see <code><a href="graphics.html#topic+plot.window">plot.window</a></code>.</p>
</dd>
<dt><code>xgap.axis,ygap.axis</code></dt><dd><p>the <code class="reqn">x/y</code> axis gap factors, passed as
<code>gap.axis</code> to the two <code><a href="graphics.html#topic+axis">axis</a>()</code> calls (when
<code>axes</code> is true, as per default).</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="plot.LocalControlCS_+3A_nnconfidence">nnConfidence</code></td>
<td>
<p>Return object from LocalControlNearestNeighborsConfidence</p>
</td></tr>
<tr><td><code id="plot.LocalControlCS_+3A_ylim">ylim</code></td>
<td>
<p>The y axis bounds. Defaults to c(0,1).</p>
</td></tr>
<tr><td><code id="plot.LocalControlCS_+3A_legendlocation">legendLocation</code></td>
<td>
<p>The location to place the legend. Default &quot;topleft&quot;.</p>
</td></tr>
<tr><td><code id="plot.LocalControlCS_+3A_ylab">ylab</code></td>
<td>
<p>The y axis label. Defaults to &quot;LTD&quot;.</p>
</td></tr>
<tr><td><code id="plot.LocalControlCS_+3A_xlab">xlab</code></td>
<td>
<p>The x axis label. Defaults to &quot;Fraction of maximum radius&quot;.</p>
</td></tr>
<tr><td><code id="plot.LocalControlCS_+3A_main">main</code></td>
<td>
<p>The main plot title. Default is empty.</p>
</td></tr>
</table>


<h3>References</h3>


<ul>
<li><p> Lauve NR, Nelson SJ, Young SS, Obenchain RL, Lambert CG. LocalControl: An R Package for Comparative Safety and Effectiveness Research. Journal of Statistical Software. 2020. p. 1-32. Available from: http://dx.doi.org/10.18637/jss.v096.i04
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>data(lindner)
# Specify clustering variables.
linVars &lt;- c("stent", "height", "female", "diabetic",
             "acutemi", "ejecfrac", "ves1proc")

# Call Local Control once.
linRes &lt;- LocalControl(data = lindner,
                       clusterVars = linVars,
                       treatmentColName = "abcix",
                       outcomeColName = "cardbill",
                       treatmentCode = 1)

# Plot the local treatment differences from Local Control without
# confidence intervals.
plot(linRes, ylim =  c(-6000, 3600))

#If the confidence intervals are calculated:
#linConfidence = LocalControlNearestNeighborsConfidence(
#                                      data = lindner,
#                                      clusterVars = linVars,
#                                      treatmentColName = "abcix",
#                                      outcomeColName = "cardbill",
#                                      treatmentCode = 1, nBootstrap = 100)

# Plot the local treatment difference with confidence intervals.
#plot(linRes, linConfidence)

</code></pre>

<hr>
<h2 id='SPSbalan'>Test for Within-Bin X-covariate Balance in Supervised Propensiy Scoring</h2><span id='topic+SPSbalan'></span>

<h3>Description</h3>

<p>Test for Conditional Independence of X-covariate Distributions from Treatment
Selection within Given, Adjacent PS Bins. The second step in Supervised Propensity Scoring analyses is to verify that baseline
X-covariates have the same distribution, regardless of treatment, within each fitted PS bin.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SPSbalan(envir, dframe, trtm, yvar, qbin, xvar, faclev = 3)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="SPSbalan_+3A_envir">envir</code></td>
<td>
<p>The local control environment</p>
</td></tr>
<tr><td><code id="SPSbalan_+3A_dframe">dframe</code></td>
<td>
<p>Name of augmented data.frame written to the appn=&quot;&quot; argument of SPSlogit().</p>
</td></tr>
<tr><td><code id="SPSbalan_+3A_trtm">trtm</code></td>
<td>
<p>Name of the two-level treatment factor variable.</p>
</td></tr>
<tr><td><code id="SPSbalan_+3A_yvar">yvar</code></td>
<td>
<p>The outcome variable.</p>
</td></tr>
<tr><td><code id="SPSbalan_+3A_qbin">qbin</code></td>
<td>
<p>Name of variable containing bin numbers.</p>
</td></tr>
<tr><td><code id="SPSbalan_+3A_xvar">xvar</code></td>
<td>
<p>Name of one baseline covariate X variable used in the SPSlogit() PS model.</p>
</td></tr>
<tr><td><code id="SPSbalan_+3A_faclev">faclev</code></td>
<td>
<p>Maximum number of different numerical values an X-covariate can assume without
automatically being converted into a &quot;factor&quot; variable; faclev=1 causes a binary indicator
to be treated as a continuous variable determining a proportion.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An output list object of class SPSbalan. The first four are returned with a continuous x-variable. The next 4 are used if it is a factor variable.
</p>

<dl>
<dt>aovdiff</dt><dd><p>ANOVA output for marginal test.</p>
</dd>
<dt>form2</dt><dd><p>Formula for differences in X due to bins and to treatment nested within bins.</p>
</dd>
<dt>bindiff</dt><dd><p>ANOVA output for the nested within bin model.</p>
</dd>
<dt>df3</dt><dd><p>Output data.frame containing 3 variables: X-covariate, treatment and bin.</p>
</dd>
<dt>factab</dt><dd><p>Marginal table of counts by X-factor level and treatment.</p>
</dd>
<dt>tab</dt><dd><p>Three-way table of counts by X-factor level, treatment and bin.</p>
</dd>
<dt>cumchi</dt><dd><p>Cumulative Chi-Square statistic for interaction in the three-way, nested table.</p>
</dd>
<dt>cumdf</dt><dd><p>Degrees of-Freedom for the Cumulative Chi-Squared.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Bob Obenchain &lt;wizbob@att.net&gt;
</p>


<h3>References</h3>


<ul>
<li><p> Cochran WG. (1968) The effectiveness of adjustment by subclassification
in removing bias in observational studies. <em>Biometrics</em> <b>24</b>:
205-213.
</p>
</li>
<li><p> Obenchain RL. (2011) <b>USPSinR.pdf</b>  USPS R-package vignette, 40 pages.
</p>
</li>
<li><p> Rosenbaum PR, Rubin RB. (1983) The Central Role of the Propensity Score
in Observational Studies for Causal Effects. <em>Biometrika</em> <b>70</b>:
41-55.
</p>
</li>
<li><p> Rosenbaum PR, Rubin DB. (1984) Reducing Bias in Observational Studies
Using Subclassification on a Propensity Score. <em>J Amer Stat Assoc</em>
<b>79</b>: 516-524.
</p>
</li></ul>


<hr>
<h2 id='SPSloess'>LOESS Smoothing of Outcome by Treatment in Supervised Propensiy Scoring</h2><span id='topic+SPSloess'></span>

<h3>Description</h3>

<p>Express Expected Outcome by Treatment as LOESS Smooths of Fitted Propensity Scores.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SPSloess(
  envir,
  dframe,
  trtm,
  pscr,
  yvar,
  faclev = 3,
  deg = 2,
  span = 0.75,
  fam = "symmetric"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="SPSloess_+3A_envir">envir</code></td>
<td>
<p>Local control classic environment.</p>
</td></tr>
<tr><td><code id="SPSloess_+3A_dframe">dframe</code></td>
<td>
<p>data.frame of the form returned by SPSlogit().</p>
</td></tr>
<tr><td><code id="SPSloess_+3A_trtm">trtm</code></td>
<td>
<p>the two-level factor on the left-hand-side in the formula argument to SPSlogit().</p>
</td></tr>
<tr><td><code id="SPSloess_+3A_pscr">pscr</code></td>
<td>
<p>fitted propensity scores of the form returned by SPSlogit().</p>
</td></tr>
<tr><td><code id="SPSloess_+3A_yvar">yvar</code></td>
<td>
<p>continuous outcome measure or result unknown at the time patient was assigned
(possibly non-randomly) to treatment; &quot;NA&quot;s are allowed in yvar.</p>
</td></tr>
<tr><td><code id="SPSloess_+3A_faclev">faclev</code></td>
<td>
<p>optional; maximum number of distinct numerical values a variable can assume
and yet still be converted into a factor variable; faclev=1 causes a binary indicator to be
treated as a continuous variable determining a proportion.</p>
</td></tr>
<tr><td><code id="SPSloess_+3A_deg">deg</code></td>
<td>
<p>optional; degree (1=linear or 2=quadratic) of the local fit.</p>
</td></tr>
<tr><td><code id="SPSloess_+3A_span">span</code></td>
<td>
<p>optional; span (0 to 2) argument for the loess() function.</p>
</td></tr>
<tr><td><code id="SPSloess_+3A_fam">fam</code></td>
<td>
<p>optional; &quot;gaussian&quot; or &quot;symmetric&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>SPSloess
</p>
<p>Once one has fitted a somewhat smooth curve through scatters of observed outcomes, Y,
versus the fitted propensity scores, X, for the patients in each of the two treatment groups,
one can consider the question: &quot;Over the range where both smooth curves are defined (i.e. their
common support), what is the (weighted) average signed difference between these two curves?&quot;
</p>
<p>If the distribution of patients (either treated or untreated) were UNIFORM over this range, the
(unweighted) average signed difference (treated minus untreated) would be an appropriate
estimate of the overall difference in outcome due to choice of treatment.
</p>
<p>Histogram patient counts within 100 cells of width 0.01 provide a naive &quot;non-parametric density
estimate&quot; for the distribution of total patients (treated or untreated) along the propensity
score axis.  The weighted average difference (and standard error) displayed by SPSsmoot() are
based on an R density() smooth of these counts.
</p>
<p>In situations where the propensity scoring distribution for all patients in a therapeutic class
is known to differ from that of the patients within the current study, that population weighted
average would also be of interest.  Thus the SPSloess() output object contains two data frames,
logrid and lofit, useful in further computations.
</p>

<dl>
<dt>logrid</dt><dd><p>loess grid data.frame containing 11 variables and 100 observations. The PS
variable contains propensity score &quot;cell means&quot; of 0.005 to 0.995 in steps of 0.010.
Variables F0, S0 and C0 for treatment 0 and variables F1, S1 and C1 for treatment 1 contain
fitted smooth spline values, standard error estimates and patient counts, respectively.  The
DIF variable is simply (F1-F0), the SED variable is sqrt(S1*S1+S0*S0), the HST variable is
proportional to (C0+C1), and the DEN variable is the estimated probability density of patients
along the PS axis.  Observations with &quot;NA&quot; for variables F0, S0, F1 or S1 represent &quot;extremes&quot;
where the lowess fits could not be extrapolated because no observed outcomes were available.</p>
</dd>
<dt>losub0, losub1</dt><dd><p>loess fit data.frame contains 4 variables for each distinct PS value in lofit.
These 4 variables are named PS, YAVG, TRT==0 and 1, respectively, and FIT = spline prediction for
the specified degrees-of-freedom (default df=1.)</p>
</dd>
<dt>span</dt><dd><p>loess span setting.</p>
</dd>
<dt>lotdif</dt><dd><p>outcome treatment difference mean.</p>
</dd>
<dt>lotsde</dt><dd><p>outcome treatment difference standard deviation.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Bob Obenchain &lt;wizbob@att.net&gt;
</p>


<h3>References</h3>


<ul>
<li><p> Cleveland WS, Devlin SJ. (1988) Locally-weighted regression: an
approach to regression analysis by local fitting. <em>J Amer Stat Assoc</em>
<b>83</b>: 596-610.
</p>
</li>
<li><p> Cleveland WS, Grosse E, Shyu WM. (1992) Local regression models. Chapter 8 of
<b>Statistical Models in S</b> eds Chambers JM and Hastie TJ. <em>Wadsworth &amp; Brooks/Cole</em>.
</p>
</li>
<li><p> Obenchain RL. (2011) <b>USPSinR.pdf</b>  USPS R-package vignette, 40 pages.
</p>
</li>
<li><p> Ripley BD, loess() based on the 'cloess' package of Cleveland, Grosse and Shyu.
</p>
</li></ul>


<hr>
<h2 id='SPSlogit'>Propensity Score prediction of Treatment Selection from Patient Baseline X-covariates</h2><span id='topic+SPSlogit'></span>

<h3>Description</h3>

<p>Use a logistic regression model to predict Treatment Selection from Patient
Baseline X-covariates in Supervised Propensity Scoring.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SPSlogit(envir, dframe, form, pfit, prnk, qbin, bins = 5, appn = "")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="SPSlogit_+3A_envir">envir</code></td>
<td>
<p>name of the working local control classic environment.</p>
</td></tr>
<tr><td><code id="SPSlogit_+3A_dframe">dframe</code></td>
<td>
<p>data.frame containing X, t and Y variables.</p>
</td></tr>
<tr><td><code id="SPSlogit_+3A_form">form</code></td>
<td>
<p>Valid formula for glm()with family = binomial(), with the two-level treatment
factor variable as the left-hand-side of the formula.</p>
</td></tr>
<tr><td><code id="SPSlogit_+3A_pfit">pfit</code></td>
<td>
<p>Name of variable to store PS predictions.</p>
</td></tr>
<tr><td><code id="SPSlogit_+3A_prnk">prnk</code></td>
<td>
<p>Name of variable to store tied-ranks of PS predictions.</p>
</td></tr>
<tr><td><code id="SPSlogit_+3A_qbin">qbin</code></td>
<td>
<p>Name of variable to store the assigned bin number for each patient.</p>
</td></tr>
<tr><td><code id="SPSlogit_+3A_bins">bins</code></td>
<td>
<p>optional; number of adjacent PS bins desired; default to 5.</p>
</td></tr>
<tr><td><code id="SPSlogit_+3A_appn">appn</code></td>
<td>
<p>optional; append the pfit, prank and qbin variables to the input dfname when
appn==&quot;&quot;, else save augmented data.frame to name specified within a non-blank appn string.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The first phase of Supervised Propensity Scoring is to develop a logit (or probit) model
predicting treatment choice from patient baseline X characteristics.  SPSlogit uses a call to
glm()with family = binomial() to fit a logistic regression.
</p>


<h3>Value</h3>

<p>An output list object of class SPSlogit:
</p>

<dl>
<dt>dframe</dt><dd><p>Name of input data.frame containing X, t &amp; Y variables.</p>
</dd>
<dt>dfoutnam</dt><dd><p>Name of output data.frame augmented by pfit, prank and qbin variables.</p>
</dd>
<dt>trtm</dt><dd><p>Name of two-level treatment factor variable.</p>
</dd>
<dt>form</dt><dd><p>glm() formula for logistic regression.</p>
</dd>
<dt>pfit</dt><dd><p>Name of predicted PS variable.</p>
</dd>
<dt>prank</dt><dd><p>Name of variable containing PS tied-ranks.</p>
</dd>
<dt>qbin</dt><dd><p>Name of variable containing assigned PS bin number for each patient.</p>
</dd>
<dt>bins</dt><dd><p>Number of adjacent PS bins desired.</p>
</dd>
<dt>glmobj</dt><dd><p>Output object from invocation of glm() with family = binomial().</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Bob Obenchain &lt;wizbob@att.net&gt;
</p>


<h3>References</h3>


<ul>
<li><p> Cochran WG. (1968) The effectiveness of adjustment by subclassification
in removing bias in observational studies. <em>Biometrics</em> <b>24</b>:
205-213.
</p>
</li>
<li><p> Kereiakes DJ, Obenchain RL, Barber BL, et al. (2000) Abciximab provides
cost effective survival advantage in high volume interventional practice.
<em>Am Heart J</em> <b>140</b>: 603-610.
</p>
</li>
<li><p> Obenchain RL. (2011) <b>USPSinR.pdf</b>  USPS R-package vignette, 40 pages.
</p>
</li>
<li><p> Rosenbaum PR, Rubin RB. (1983) The Central Role of the Propensity Score
in Observational Studies for Causal Effects. <em>Biometrika</em> <b>70</b>:
41-55.
</p>
</li>
<li><p> Rosenbaum PR, Rubin DB. (1984) Reducing Bias in Observational Studies
Using Subclassification on a Propensity Score. <em>J Amer Stat Assoc</em>
<b>79</b>: 516-524.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+SPSbalan">SPSbalan</a></code>, <code><a href="#topic+SPSnbins">SPSnbins</a></code> and <code><a href="#topic+SPSoutco">SPSoutco</a></code>.
</p>

<hr>
<h2 id='SPSnbins'>Change the Number of Bins in Supervised Propensiy Scoring</h2><span id='topic+SPSnbins'></span>

<h3>Description</h3>

<p>Change the Number of Bins in Supervised Propensiy Scoring
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SPSnbins(envir, dframe, prnk, qbin, bins = 8)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="SPSnbins_+3A_envir">envir</code></td>
<td>
<p>name of the working local control classic environment.</p>
</td></tr>
<tr><td><code id="SPSnbins_+3A_dframe">dframe</code></td>
<td>
<p>Name of data.frame of the form output by SPSlogit().</p>
</td></tr>
<tr><td><code id="SPSnbins_+3A_prnk">prnk</code></td>
<td>
<p>Name of PS tied-rank variable from previous call to SPSlogit().</p>
</td></tr>
<tr><td><code id="SPSnbins_+3A_qbin">qbin</code></td>
<td>
<p>Name of variable to contain the re-assigned bin number for each patient.</p>
</td></tr>
<tr><td><code id="SPSnbins_+3A_bins">bins</code></td>
<td>
<p>Number of PS bins desired.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Part or all of the first phase of Supervised Propensity Scoring will need to be redone
if SPSbalan() detects dependence of within-bin X-covariate distributions upon treatment choice.
Use SPSnbins() to change (increase) the number of adjacent PS bins.  If this does not achieve
balance, invoke SPSlogit() again to modify the form of your PS logistic model, typically by
adding interaction and/or curvature terms in continuous X-covariates.
</p>


<h3>Value</h3>

<p>An output data.frame with new variables inserted:
</p>

<dl>
<dt>dframe2</dt><dd><p>Modified version of the data.frame specified as the first argument to SPSnbins().</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Bob Obenchain &lt;wizbob@att.net&gt;
</p>


<h3>References</h3>


<ul>
<li><p> Cochran WG. (1968) The effectiveness of adjustment by subclassification
in removing bias in observational studies. <em>Biometrics</em> <b>24</b>:
205-213.
</p>
</li>
<li><p> Obenchain RL. (2011) <b>USPSinR.pdf</b>  USPS R-package vignette, 40 pages.
</p>
</li>
<li><p> Rosenbaum PR, Rubin DB. (1984) Reducing Bias in Observational Studies
Using Subclassification on a Propensity Score. <em>J Amer Stat Assoc</em>
<b>79</b>: 516-524.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+SPSlogit">SPSlogit</a></code>, <code><a href="#topic+SPSbalan">SPSbalan</a></code> and <code><a href="#topic+SPSoutco">SPSoutco</a></code>.
</p>

<hr>
<h2 id='SPSoutco'>Examine Treatment Differences on an Outcome Measure in Supervised Propensiy Scoring</h2><span id='topic+SPSoutco'></span>

<h3>Description</h3>

<p>Examine Within-Bin Treatment Differences on an Outcome Measure and Average these
Differences across Bins.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SPSoutco(envir, dframe, trtm, qbin, yvar, faclev = 3)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="SPSoutco_+3A_envir">envir</code></td>
<td>
<p>name of the working local control classic environment.</p>
</td></tr>
<tr><td><code id="SPSoutco_+3A_dframe">dframe</code></td>
<td>
<p>Name of augmented data.frame written to the appn=&quot;&quot; argument of SPSlogit().</p>
</td></tr>
<tr><td><code id="SPSoutco_+3A_trtm">trtm</code></td>
<td>
<p>Name of treatment factor variable.</p>
</td></tr>
<tr><td><code id="SPSoutco_+3A_qbin">qbin</code></td>
<td>
<p>Name of variable containing the PS bin number for each patient.</p>
</td></tr>
<tr><td><code id="SPSoutco_+3A_yvar">yvar</code></td>
<td>
<p>Name of an outcome Y variable.</p>
</td></tr>
<tr><td><code id="SPSoutco_+3A_faclev">faclev</code></td>
<td>
<p>Maximum number of different numerical values an X-covariate can assume without
automatically being converted into a &quot;factor&quot; variable; faclev=1 causes a binary indicator to
be treated as a continuous variable determining an average or proportion.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Once the second phase of Supervised Propensity Scoring confirms, using SPSbalan(), that
X-covariate Distributions have been Balanced Within-Bins, the third phase can start: Examining
Within-Bin Outcome Difference due to Treatment and Averaging these Differences across Bins.
Graphical displays of SPSoutco() results feature R barplot() invocations.
</p>


<h3>Value</h3>

<p>An output list object of class SPSoutco:
</p>

<dl>
<dt>dframe</dt><dd><p>Name of augmented data.frame written to the appn=&quot;&quot; argument of SPSlogit().</p>
</dd>
<dt>trtm</dt><dd><p>Name of the two-level treatment factor variable.</p>
</dd>
<dt>yvar</dt><dd><p>Name of an outcome Y variable.</p>
</dd>
<dt>bins</dt><dd><p>Number of variable containing bin numbers.</p>
</dd>
<dt>PStdif</dt><dd><p>Character string describing the treatment difference.</p>
</dd>
<dt>rawmean</dt><dd><p>Unadjusted outcome mean by treatment group.</p>
</dd>
<dt>rawvars</dt><dd><p>Unadjusted outcome variance by treatment group.</p>
</dd>
<dt>rawfreq</dt><dd><p>Number of patients by treatment group.</p>
</dd>
<dt>ratdif</dt><dd><p>Unadjusted mean outcome difference between treatments.</p>
</dd>
<dt>ratsde</dt><dd><p>Standard error of unadjusted mean treatment difference.</p>
</dd>
<dt>binmean</dt><dd><p>Unadjusted mean outcome by cluster and treatment.</p>
</dd>
<dt>binvars</dt><dd><p>Unadjusted variance by cluster and treatment.</p>
</dd>
<dt>binfreq</dt><dd><p>Number of patients by bin and treatment.</p>
</dd>
<dt>awbdif</dt><dd><p>Across cluster average difference with cluster size weights.</p>
</dd>
<dt>awbsde</dt><dd><p>Standard error of awbdif.</p>
</dd>
<dt>wwbdif</dt><dd><p>Across cluster average difference, inverse variance weights.</p>
</dd>
<dt>wwbsde</dt><dd><p>Standard error of wwbdif.</p>
</dd>
<dt>form</dt><dd><p>Formula for overall, marginal treatment difference on X-covariate.</p>
</dd>
<dt>faclev</dt><dd><p>Maximum number of different numerical values an X-covariate can assume without
automatically being converted into a &quot;factor&quot; variable; faclev=1 causes a binary indicator to be
treated as a continuous variable determining an average or proportion.</p>
</dd>
<dt>youtype</dt><dd><p>&quot;contin&quot;uous =&gt; only next six outputs; &quot;factor&quot; =&gt; only last four outputs.</p>
</dd>
<dt>aovdiff</dt><dd><p>ANOVA output for marginal test.</p>
</dd>
<dt>form2</dt><dd><p>Formula for differences in X due to bins and to treatment nested within bins.</p>
</dd>
<dt>bindiff</dt><dd><p>ANOVA summary for treatment nested within bin.</p>
</dd>
<dt>pbindif</dt><dd><p>Unadjusted treatment difference by cluster.</p>
</dd>
<dt>pbinsde</dt><dd><p>Standard error of the unadjusted difference by cluster.</p>
</dd>
<dt>pbinsiz</dt><dd><p>Cluster radii measure: square root of total number of patients.</p>
</dd>
<dt>factab</dt><dd><p>Marginal table of counts by Y-factor level and treatment.</p>
</dd>
<dt>tab</dt><dd><p>Three-way table of counts by Y-factor level, treatment and bin.</p>
</dd>
<dt>cumchi</dt><dd><p>Cumulative Chi-Square statistic for interaction in the three-way, nested table.</p>
</dd>
<dt>cumdf</dt><dd><p>Degrees of-Freedom for the Cumulative Chi-Squared.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Bob Obenchain &lt;wizbob@att.net&gt;
</p>


<h3>References</h3>


<ul>
<li><p> Cochran WG. (1968) The effectiveness of adjustment by subclassification
in removing bias in observational studies. <em>Biometrics</em> <b>24</b>:
205-213.
</p>
</li>
<li><p> Obenchain RL. (2011) <b>USPSinR.pdf</b>  USPS R-package vignette, 40 pages.
</p>
</li>
<li><p> Rosenbaum PR, Rubin RB. (1983) The Central Role of the Propensity Score
in Observational Studies for Causal Effects. <em>Biometrika</em> <b>70</b>:
41-55.
</p>
</li>
<li><p> Rosenbaum PR, Rubin DB. (1984) Reducing Bias in Observational Studies
Using Subclassification on a Propensity Score. <em>J Amer Stat Assoc</em>
<b>79</b>: 516-524.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+SPSlogit">SPSlogit</a></code>, <code><a href="#topic+SPSbalan">SPSbalan</a></code> and <code><a href="#topic+SPSnbins">SPSnbins</a></code>.
</p>

<hr>
<h2 id='UPSaccum'>Prepare for Accumulation of (Outcome,Treatment) Results in Unsupervised Propensity Scoring</h2><span id='topic+UPSaccum'></span>

<h3>Description</h3>

<p>Specify key result accumulation parameters: Treatment t-Factor, Outcome
Y-variable, faclev setting, scedasticity assumption, and name of the UPSgraph() data
accumulation object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>UPSaccum(envir, dframe, trtm, yvar, faclev = 3, scedas = "homo")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="UPSaccum_+3A_envir">envir</code></td>
<td>
<p>name of the working local control classic environment.</p>
</td></tr>
<tr><td><code id="UPSaccum_+3A_dframe">dframe</code></td>
<td>
<p>Name of data.frame containing the X, t &amp; Y variables.</p>
</td></tr>
<tr><td><code id="UPSaccum_+3A_trtm">trtm</code></td>
<td>
<p>Name of treatment factor variable.</p>
</td></tr>
<tr><td><code id="UPSaccum_+3A_yvar">yvar</code></td>
<td>
<p>Name of outcome Y variable.</p>
</td></tr>
<tr><td><code id="UPSaccum_+3A_faclev">faclev</code></td>
<td>
<p>Maximum number of different numerical values an outcome variable can assume
without automatically being converted into a &quot;factor&quot; variable; faclev=1 causes a binary
indicator to be treated as a continuous variable determining an average or proportion.</p>
</td></tr>
<tr><td><code id="UPSaccum_+3A_scedas">scedas</code></td>
<td>
<p>Scedasticity assumption: &quot;homo&quot; or &quot;hete&quot;</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The second phase in an Unsupervised Propensity Scoring analysis is to prepare to
accumulate results over a wide range of values for &quot;Number of Clusters.&quot;  As the number of
such clusters increases, individual clusters will tend to become smaller and smaller and,
thus, more and more compact in covariate X-space.
</p>


<h3>Value</h3>


<dl>
<dt>hiclus</dt><dd><p>Name of a diana, agnes or hclust object created by UPShclus().</p>
</dd>
<dt>dframe</dt><dd><p>Name of data.frame containing the X, t &amp; Y variables.</p>
</dd>
<dt>trtm</dt><dd><p>Name of treatment factor variable.</p>
</dd>
<dt>yvar</dt><dd><p>Name of outcome Y variable.</p>
</dd>
<dt>faclev</dt><dd><p>Maximum number of different numerical values an outcome variable can assume
without automatically being converted into a &quot;factor&quot; variable; faclev=1 causes a binary
indicator to be treated as a continuous variable determining a proportion.</p>
</dd>
<dt>scedas</dt><dd><p>Scedasticity assumption: &quot;homo&quot; or &quot;hete&quot;</p>
</dd>
<dt>accobj</dt><dd><p>Name of the object for accumulation of I-plots to be ultimately displayed
using UPSgraph().</p>
</dd>
<dt>nnymax</dt><dd><p>Maximum NN LTD Standard Error observed; Upper NN plot limit;
initialized to zero.</p>
</dd>
<dt>nnxmin</dt><dd><p>Minimum NN LTD observed; Left NN plot limit; initialized to zero.</p>
</dd>
<dt>nnxmax</dt><dd><p>Maximum NN LTD observed; Right NN plot limit; initialized to zero.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Bob Obenchain &lt;wizbob@att.net&gt;
</p>


<h3>References</h3>


<ul>
<li><p> Obenchain RL. (2004) Unsupervised Propensity Scoring: NN and IV Plots.
<em>Proceedings of the American Statistical Association (on CD)</em> 8 pages.
</p>
</li>
<li><p> Obenchain RL. (2011) <b>USPSinR.pdf</b>  USPS R-package vignette, 40 pages.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+UPSnnltd">UPSnnltd</a></code>, <code><a href="#topic+UPSivadj">UPSivadj</a></code> and <code><a href="#topic+UPShclus">UPShclus</a></code>.
</p>

<hr>
<h2 id='UPSaltdd'>Artificial Distribution of LTDs from Random Clusters</h2><span id='topic+UPSaltdd'></span>

<h3>Description</h3>

<p>For a given number of clusters, UPSaltdd() characterizes the potentially biased
distribution of &quot;Local Treatment Differences&quot; (LTDs) in a continuous outcome y-variable between
two treatment groups due to Random Clusterings.  When the NNobj argument is not NA and specifies
an existing UPSnnltd() object, UPSaltdd() also computes a smoothed CDF for the NN/LTD
distribution for direct comparison with the Artificial LTD distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>UPSaltdd(
  envir,
  dframe,
  trtm,
  yvar,
  faclev = 3,
  scedas = "homo",
  NNobj = NA,
  clus = 50,
  reps = 10,
  seed = 12345
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="UPSaltdd_+3A_envir">envir</code></td>
<td>
<p>name of the working local control classic environment.</p>
</td></tr>
<tr><td><code id="UPSaltdd_+3A_dframe">dframe</code></td>
<td>
<p>Name of data.frame containing a treatment-factor and the outcome y-variable.</p>
</td></tr>
<tr><td><code id="UPSaltdd_+3A_trtm">trtm</code></td>
<td>
<p>Name of treatment factor variable with two levels.</p>
</td></tr>
<tr><td><code id="UPSaltdd_+3A_yvar">yvar</code></td>
<td>
<p>Name of continuous outcome variable.</p>
</td></tr>
<tr><td><code id="UPSaltdd_+3A_faclev">faclev</code></td>
<td>
<p>Maximum number of different numerical values an outcome variable can assume
without automatically being converted into a &quot;factor&quot; variable; faclev=1 causes a binary
indicator to be treated as a continuous variable determining an average or proportion.</p>
</td></tr>
<tr><td><code id="UPSaltdd_+3A_scedas">scedas</code></td>
<td>
<p>Scedasticity assumption: &quot;homo&quot; or &quot;hete&quot;</p>
</td></tr>
<tr><td><code id="UPSaltdd_+3A_nnobj">NNobj</code></td>
<td>
<p>Name of an existing UPSnnltd object or NA.</p>
</td></tr>
<tr><td><code id="UPSaltdd_+3A_clus">clus</code></td>
<td>
<p>Number of Random Clusters requested per Replication; ignored when NNobj is not NA.</p>
</td></tr>
<tr><td><code id="UPSaltdd_+3A_reps">reps</code></td>
<td>
<p>Number of overall Replications, each with the same number of requested clusters.</p>
</td></tr>
<tr><td><code id="UPSaltdd_+3A_seed">seed</code></td>
<td>
<p>Seed for Monte Carlo random number generator.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Multiple calls to UPSaltdd() for different UPSnnltd objects or different numbers of
clusters are typically made after first invoking UPSgraph().
</p>


<h3>Value</h3>


<dl>
<dt>dframe</dt><dd><p>Name of data.frame containing X, t &amp; Y variables.</p>
</dd>
<dt>trtm</dt><dd><p>Name of treatment factor variable.</p>
</dd>
<dt>yvar</dt><dd><p>Name of outcome Y variable.</p>
</dd>
<dt>faclev</dt><dd><p>Maximum number of different numerical values an outcome variable can assume without
automatically being converted into a &quot;factor&quot; variable; faclev=1 causes a binary indicator to be
treated as a continuous variable determining an average or proportion.</p>
</dd>
<dt>scedas</dt><dd><p>Scedasticity assumption: &quot;homo&quot; or &quot;hete&quot;</p>
</dd>
<dt>NNobj</dt><dd><p>Name of an existing UPSnnltd object or NA.</p>
</dd>
<dt>clus</dt><dd><p>Number of Random Clusters requested per Replication.</p>
</dd>
<dt>reps</dt><dd><p>Number of overall Replications, each with the same number of requested clusters.</p>
</dd>
<dt>pats</dt><dd><p>Number of patients with no NAs in their yvar outcome and trtm factor.</p>
</dd>
<dt>seed</dt><dd><p>Seed for Monte Carlo random number generator.</p>
</dd>
<dt>altdd</dt><dd><p>Matrix of LTDs and relative weights from artificial clusters.</p>
</dd>
<dt>alxmin</dt><dd><p>Minimum artificial LTD value.</p>
</dd>
<dt>alxmax</dt><dd><p>Maximum artificial LTD value.</p>
</dd>
<dt>alymax</dt><dd><p>Maximum weight among artificial LTDs.</p>
</dd>
<dt>altdcdf</dt><dd><p>Vector of artificial LTD x-coordinates for smoothed CDF.</p>
</dd>
<dt>qq</dt><dd><p>Vector of equally spaced CDF values from 0.0 to 1.0.</p>
</dd>
<dt>nnltdd</dt><dd><p>Optional matrix of relevant NN/LTDs and relative weights.</p>
</dd>
<dt>nnlxmin</dt><dd><p>Optional minimum NN/LTD value.</p>
</dd>
<dt>nnlxmax</dt><dd><p>Optional maximum NN/LTD value.</p>
</dd>
<dt>nnlymax</dt><dd><p>Optional maximum weight among NN/LTDs.</p>
</dd>
<dt>nnltdcdf</dt><dd><p>Optional vector of NN/LTD x-coordinates for smoothed CDF.</p>
</dd>
<dt>nq</dt><dd><p>Optional vector of equally spaced CDF values from 0.0 to 1.0.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Bob Obenchain &lt;wizbob@att.net&gt;
</p>


<h3>References</h3>


<ul>
<li><p> Obenchain RL. (2004) Unsupervised Propensity Scoring: NN and IV Plots.
<em>Proceedings of the American Statistical Association (on CD)</em> 8 pages.
</p>
</li>
<li><p> Obenchain RL. (2011) <b>USPSinR.pdf</b>  USPS R-package vignette, 40 pages.
</p>
</li>
<li><p> Rosenbaum PR, Rubin RB. (1983) The Central Role of the Propensity Score
in Observational Studies for Causal Effects. <em>Biometrika</em> <b>70</b>:
41-55.
</p>
</li>
<li><p> Rubin DB. (1980) Bias reduction using Mahalanobis metric matching.
<em>Biometrics</em> <b>36</b>: 293-298.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+UPSnnltd">UPSnnltd</a></code>, <code><a href="#topic+UPSaccum">UPSaccum</a></code> and <code><a href="#topic+UPSgraph">UPSgraph</a></code>.
</p>

<hr>
<h2 id='UPSboxplot'>Returns a series of boxplots comparing LTD distributions given different numbers of clusters.</h2><span id='topic+UPSboxplot'></span>

<h3>Description</h3>

<p>Given the output of <code><a href="#topic+LocalControlClassic">LocalControlClassic</a></code>, this function uses all or some of the
UPSnnltd objects contained to create a series of boxplots of the local treatment difference at each of the
different numbers of requested clusters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>UPSboxplot(envir, clusterSubset = c())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="UPSboxplot_+3A_envir">envir</code></td>
<td>
<p>A LocalControlClassic environment containing UPSnnltd objects.</p>
</td></tr>
<tr><td><code id="UPSboxplot_+3A_clustersubset">clusterSubset</code></td>
<td>
<p>(optional) A vector containing requested cluster counts.
If provided, the boxplot is created using only the UPSnnltd objects corresponding to the requested cluster counts.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the call to boxplot with the formula: &quot;ltd ~ numclst&quot;.
</p>
<p>Adds the &quot;ltdds&quot; object to the Local Control environment.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(lindner)
cvars &lt;- c("stent","height","female","diabetic","acutemi",
           "ejecfrac","ves1proc")
numClusters &lt;- c(1, 5, 10, 20, 40, 50)

results &lt;- LocalControlClassic(data = lindner,
                               clusterVars = cvars,
                               treatmentColName = "abcix",
                               outcomeColName = "cardbill",
                               clusterCounts = numClusters)

bxp &lt;- UPSboxplot(results)

</code></pre>

<hr>
<h2 id='UPSgraph'>Display Sensitivity Analysis Graphic in Unsupervised Propensiy Scoring</h2><span id='topic+UPSgraph'></span>

<h3>Description</h3>

<p>Plot summary of results from multiple calls to UPSnnltd() and/or UPSivadj() after an
initial setup call to UPSaccum().  The UPSgraph() plot displays any sensitivity of the LTD and
LOA Distributions to choice of Number of Clusters in X-space.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>UPSgraph(envir, nncol = "red", nwcol = "green3", ivcol = "blue", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="UPSgraph_+3A_envir">envir</code></td>
<td>
<p>name of the working local control classic environment.</p>
</td></tr>
<tr><td><code id="UPSgraph_+3A_nncol">nncol</code></td>
<td>
<p>optional; string specifying color for display of the Mean of the LTD
distribution when weighted by cluster size from any calls to UPSnnltd().</p>
</td></tr>
<tr><td><code id="UPSgraph_+3A_nwcol">nwcol</code></td>
<td>
<p>optional; string specifying color for display of the Mean of the LTD
distribution when weighted inversely proportional to variance from any calls to UPSnnltd().</p>
</td></tr>
<tr><td><code id="UPSgraph_+3A_ivcol">ivcol</code></td>
<td>
<p>optional; string specifying color for display of the Difference in LOA
predictions, at PS = 100% minus that at PS = 0%, from any calls to UPSivadj().</p>
</td></tr>
<tr><td><code id="UPSgraph_+3A_...">...</code></td>
<td>
<p>Additional arguments to pass to the plotting function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The third phase of Unsupervised Propensity Scoring is a graphical Sensitivity
Analysis that depicts how the Overall Means of the LTD and LOA distributions change with
the number of clusters.
</p>


<h3>Author(s)</h3>

<p>Bob Obenchain &lt;wizbob@att.net&gt;
</p>


<h3>References</h3>


<ul>
<li><p> Kaufman L, Rousseeuw PJ. (1990) <b>Finding Groups in Data.  An Introduction to
Cluster Analysis</b>.  <em>New York: John Wiley and Sons</em>.
</p>
</li>
<li><p> Obenchain RL. (2004) Unsupervised Propensity Scoring: NN and IV Plots.
<em>Proceedings of the American Statistical Association (on CD)</em> 8 pages.
</p>
</li>
<li><p> Obenchain RL. (2011) <b>USPSinR.pdf</b>  USPS R-package vignette, 40 pages.
</p>
</li>
<li><p> Rubin DB. (1980) Bias reduction using Mahalanobis metric matching.
<em>Biometrics</em> <b>36</b>: 293-298.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+UPSnnltd">UPSnnltd</a></code>, <code><a href="#topic+UPSivadj">UPSivadj</a></code> and <code><a href="#topic+UPSaccum">UPSaccum</a></code>.
</p>

<hr>
<h2 id='UPShclus'>Hierarchical Clustering of Patients on X-covariates for Unsupervised Propensiy Scoring</h2><span id='topic+UPShclus'></span>

<h3>Description</h3>

<p>Derive a full, hierarchical clustering tree (dendrogram) for all patients (regardless
of treatment received) using Mahalonobis between-patient distances computed from specified
baseline X-covariate characteristics.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>UPShclus(envir, dframe, xvars, method, metric)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="UPShclus_+3A_envir">envir</code></td>
<td>
<p>name of the working local control classic environment.</p>
</td></tr>
<tr><td><code id="UPShclus_+3A_dframe">dframe</code></td>
<td>
<p>Name of data.frame containing baseline X covariates.</p>
</td></tr>
<tr><td><code id="UPShclus_+3A_xvars">xvars</code></td>
<td>
<p>List of names of X variable(s).</p>
</td></tr>
<tr><td><code id="UPShclus_+3A_method">method</code></td>
<td>
<p>Hierarchical Clustering Method: &quot;diana&quot;, &quot;agnes&quot; or &quot;hclus&quot;.</p>
</td></tr>
<tr><td><code id="UPShclus_+3A_metric">metric</code></td>
<td>
<p>A valid distance metric for clustering.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The first step in an Unsupervised Propensity Scoring alalysis is always
to hierarchically cluster patients in baseline X-covariate space.  UPShclus uses
a Mahalabobis metric and clustering methods from the R &quot;cluster&quot; library for this
key initial step.
</p>


<h3>Value</h3>

<p>An output list object of class UPShclus:
</p>

<dl>
<dt>dframe</dt><dd><p>Name of data.frame containing baseline X covariates.</p>
</dd>
<dt>xvars</dt><dd><p>List of names of X variable(s).</p>
</dd>
<dt>method</dt><dd><p>Hierarchical Clustering Method: &quot;diana&quot;, &quot;agnes&quot; or &quot;hclus&quot;.</p>
</dd>
<dt>upshcl</dt><dd><p>Hierarchical clustering object created by choice between three possible methods.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Bob Obenchain &lt;wizbob@att.net&gt;
</p>


<h3>References</h3>


<ul>
<li><p> Kaufman L, Rousseeuw PJ.  (1990) <b>Finding Groups in Data.  An Introduction to
Cluster Analysis</b>.  New York: John Wiley and Sons.
</p>
</li>
<li><p> Kereiakes DJ, Obenchain RL, Barber BL, et al. (2000) Abciximab provides
cost effective survival advantage in high volume interventional practice.
<em>Am Heart J</em> <b>140</b>: 603-610.
</p>
</li>
<li><p> Obenchain RL. (2004) Unsupervised Propensity Scoring: NN and IV Plots.
<em>Proceedings of the American Statistical Association (on CD)</em> 8 pages.
</p>
</li>
<li><p> Obenchain RL. (2011) <b>USPSinR.pdf</b>  USPS R-package vignette, 40 pages.
</p>
</li>
<li><p> Rubin DB. (1980) Bias reduction using Mahalanobis metric matching.
<em>Biometrics</em> <b>36</b>: 293-298.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+UPSaccum">UPSaccum</a></code>, <code><a href="#topic+UPSnnltd">UPSnnltd</a></code> and <code><a href="#topic+UPSgraph">UPSgraph</a></code>.
</p>

<hr>
<h2 id='UPSivadj'>Instrumental Variable LATE Linear Fitting in Unsupervised Propensiy Scoring</h2><span id='topic+UPSivadj'></span>

<h3>Description</h3>

<p>For a given number of patient clusters in baseline X-covariate space and a
specified Y-outcome variable, linearly smooth the distribution of Local Average
Treatment Effects (LATEs) plotted versus Within-Cluster Treatment Selection (PS)
Percentages.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>UPSivadj(envir, numclust)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="UPSivadj_+3A_envir">envir</code></td>
<td>
<p>name of the working local control classic environment.</p>
</td></tr>
<tr><td><code id="UPSivadj_+3A_numclust">numclust</code></td>
<td>
<p>Number of clusters in baseline X-covariate space.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Multiple calls to UPSivadj(n) for varying numbers of clusters n are made after first
invoking UPShclus() to hierarchically cluster patients in X-space and then invoking UPSaccum()
to specify a Y outcome variable and a two-level treatment factor t.  UPSivadj(n) linearly
smoothes the LATE distribution when plotted versus within cluster propensity score percentages.
</p>


<h3>Value</h3>

<p>An output list object of class UPSivadj:
</p>

<dl>
<dt>hiclus</dt><dd><p>Name of clustering object created by UPShclus().</p>
</dd>
<dt>dframe</dt><dd><p>Name of data.frame containing X, t &amp; Y variables.</p>
</dd>
<dt>trtm</dt><dd><p>Name of treatment factor variable.</p>
</dd>
<dt>yvar</dt><dd><p>Name of outcome Y variable.</p>
</dd>
<dt>numclust</dt><dd><p>Number of clusters requested.</p>
</dd>
<dt>actclust</dt><dd><p>Number of clusters actually produced.</p>
</dd>
<dt>scedas</dt><dd><p>Scedasticity assumption: &quot;homo&quot; or &quot;hete&quot;</p>
</dd>
<dt>PStdif</dt><dd><p>Character string describing the treatment difference.</p>
</dd>
<dt>ivhbindf</dt><dd><p>Vector containing cluster number for each patient. </p>
</dd>
<dt>rawmean</dt><dd><p>Unadjusted outcome mean by treatment group.</p>
</dd>
<dt>rawvars</dt><dd><p>Unadjusted outcome variance by treatment group.</p>
</dd>
<dt>rawfreq</dt><dd><p>Number of patients by treatment group.</p>
</dd>
<dt>ratdif</dt><dd><p>Unadjusted mean outcome difference between treatments.</p>
</dd>
<dt>ratsde</dt><dd><p>Standard error of unadjusted mean treatment difference.</p>
</dd>
<dt>binmean</dt><dd><p>Unadjusted mean outcome by cluster and treatment.</p>
</dd>
<dt>binfreq</dt><dd><p>Number of patients by bin and treatment.</p>
</dd>
<dt>faclev</dt><dd><p>Maximum number of different numerical values an outcome variable can assume without
automatically being converted into a &quot;factor&quot; variable; faclev=1 causes a binary indicator to be
treated as a continuous variable determining an average or proportion.</p>
</dd>
<dt>youtype</dt><dd><p>&quot;contin&quot;uous =&gt; next eleven outputs; &quot;factor&quot; =&gt; no additional output items.</p>
</dd>
<dt>pbinout</dt><dd><p>LATE regardless of treatment by cluster.</p>
</dd>
<dt>pbinpsp</dt><dd><p>Within-Cluster Treatment Percentage = non-parametric Propensity Score.</p>
</dd>
<dt>pbinsiz</dt><dd><p>Cluster radii measure: square root of total number of patients.</p>
</dd>
<dt>symsiz</dt><dd><p>Symbol size of largest possible Snowball in a UPSivadj() plot with 1 cluster.</p>
</dd>
<dt>ivfit</dt><dd><p>lm() output for linear smooth across clusters.</p>
</dd>
<dt>ivtzero</dt><dd><p>Predicted outcome at PS percentage zero.</p>
</dd>
<dt>ivtxsde</dt><dd><p>Standard deviation of outcome prediction at PS percentage zero.</p>
</dd>
<dt>ivtdiff</dt><dd><p>Predicted outcome difference for PS percentage 100 minus that at zero.</p>
</dd>
<dt>ivtdsde</dt><dd><p>Standard deviation of outcome difference.</p>
</dd>
<dt>ivt100p</dt><dd><p>Predicted outcome at PS percentage 100.</p>
</dd>
<dt>ivt1pse</dt><dd><p>Standard deviation of outcome prediction at PS percentage 100.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Bob Obenchain &lt;wizbob@att.net&gt;
</p>


<h3>References</h3>


<ul>
<li><p> Imbens GW, Angrist JD. (1994) Identification and Estimation  of
Local Average Treatment Effects (LATEs). <em>Econometrica</em> <b>62</b>: 467-475.
</p>
</li>
<li><p> Obenchain RL. (2004) Unsupervised Propensity Scoring: NN and IV Plots.
<em>Proceedings of the American Statistical Association (on CD)</em> 8 pages.
</p>
</li>
<li><p> Obenchain RL. (2011) <b>USPSinR.pdf</b>  USPS R-package vignette, 40 pages.-
</p>
</li>
<li><p> McClellan M, McNeil BJ, Newhouse JP. (1994) Does More Intensive Treatment of
Myocardial Infarction in the Elderly Reduce Mortality?: Analysis Using Instrumental
Variables. <em>JAMA</em> <b>272</b>: 859-866.
</p>
</li>
<li><p> Rosenbaum PR, Rubin RB. (1983) The Central Role of the Propensity Score
in Observational Studies for Causal Effects. <em>Biometrika</em> <b>70</b>: 41-55.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+UPSnnltd">UPSnnltd</a></code>, <code><a href="#topic+UPSaccum">UPSaccum</a></code> and <code><a href="#topic+UPSgraph">UPSgraph</a></code>.
</p>

<hr>
<h2 id='UPSLTDdist'>Plot the LTD distribution as a function of the number of clusters.</h2><span id='topic+UPSLTDdist'></span>

<h3>Description</h3>

<p>This function creates a plot displaying the distribution of
Local Treatment Differences (LTDs) as a function of the number of clusters
created for all UPSnnltd objects in the provided environment. The hinges and
whiskers are generated using <code><a href="grDevices.html#topic+boxplot.stats">boxplot.stats</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>UPSLTDdist(envir, legloc = "bottomleft", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="UPSLTDdist_+3A_envir">envir</code></td>
<td>
<p>A LocalControlClassic environment containing UPSnnltd objects.</p>
</td></tr>
<tr><td><code id="UPSLTDdist_+3A_legloc">legloc</code></td>
<td>
<p>Where to place the legend in the returned plot. Defaults to &quot;bottomleft&quot;.</p>
</td></tr>
<tr><td><code id="UPSLTDdist_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="graphics.html#topic+plot.default">graphics::plot.default</a></code>
</p>

<dl>
<dt><code>type</code></dt><dd><p>1-character string giving the type of plot desired.  The
following values are possible, for details, see <code><a href="graphics.html#topic+plot">plot</a></code>:
<code>"p"</code> for points, <code>"l"</code> for lines,
<code>"b"</code> for both points and lines,
<code>"c"</code> for empty points joined by lines,
<code>"o"</code> for overplotted points and lines,
<code>"s"</code> and <code>"S"</code> for stair steps and
<code>"h"</code> for histogram-like vertical lines.  Finally,
<code>"n"</code> does not produce any points or lines.</p>
</dd>
<dt><code>xlim</code></dt><dd><p>the x limits (x1, x2) of the plot.  Note that <code>x1 &gt; x2</code>
is allowed and leads to a &lsquo;reversed axis&rsquo;.
</p>
<p>The default value, <code>NULL</code>, indicates that the range of the
<a href="base.html#topic+finite">finite</a> values to be plotted should be used.</p>
</dd>
<dt><code>ylim</code></dt><dd><p>the y limits of the plot.</p>
</dd>
<dt><code>log</code></dt><dd><p>a character string which contains <code>"x"</code> if the x axis
is to be logarithmic, <code>"y"</code> if the y axis is to be logarithmic
and <code>"xy"</code> or <code>"yx"</code> if both axes are to be logarithmic.</p>
</dd>
<dt><code>main</code></dt><dd><p>a main title for the plot, see also <code><a href="graphics.html#topic+title">title</a></code>.</p>
</dd>
<dt><code>sub</code></dt><dd><p>a subtitle for the plot.</p>
</dd>
<dt><code>xlab</code></dt><dd><p>a label for the x axis, defaults to a description of <code>x</code>.</p>
</dd>
<dt><code>ylab</code></dt><dd><p>a label for the y axis, defaults to a description of <code>y</code>.</p>
</dd>
<dt><code>ann</code></dt><dd><p>a logical value indicating whether the default annotation
(title and x and y axis labels) should appear on the plot.</p>
</dd>
<dt><code>axes</code></dt><dd><p>a logical value indicating whether both axes should be drawn on
the plot.  Use <a href="graphics.html#topic+graphical+20parameter">graphical parameter</a> <code>"xaxt"</code> or <code>"yaxt"</code>
to suppress just one of the axes.</p>
</dd>
<dt><code>frame.plot</code></dt><dd><p>a logical indicating whether a box should be drawn
around the plot.</p>
</dd>
<dt><code>panel.first</code></dt><dd><p>an &lsquo;expression&rsquo; to be evaluated after the
plot axes are set up but before any plotting takes place.  This can
be useful for drawing background grids or scatterplot smooths.  Note
that this works by lazy evaluation: passing this argument from other
<code>plot</code> methods may well not work since it may be evaluated too
early.</p>
</dd>
<dt><code>panel.last</code></dt><dd><p>an expression to be evaluated after plotting has
taken place but before the axes, title and box are added.  See the
comments about <code>panel.first</code>.</p>
</dd>
<dt><code>asp</code></dt><dd><p>the <code class="reqn">y/x</code> aspect ratio, see <code><a href="graphics.html#topic+plot.window">plot.window</a></code>.</p>
</dd>
<dt><code>xgap.axis,ygap.axis</code></dt><dd><p>the <code class="reqn">x/y</code> axis gap factors, passed as
<code>gap.axis</code> to the two <code><a href="graphics.html#topic+axis">axis</a>()</code> calls (when
<code>axes</code> is true, as per default).</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the LTD distribution plot.
</p>
<p>Adds the &quot;ltdds&quot; object to envir.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data(lindner)
 cvars &lt;- c("stent","height","female","diabetic","acutemi",
            "ejecfrac","ves1proc")
 numClusters &lt;- c(1, 2, 10, 15, 20, 25, 30, 35, 40, 45, 50)
 results &lt;- LocalControlClassic(data = lindner,
                                clusterVars = cvars,
                                treatmentColName = "abcix",
                                outcomeColName = "cardbill",
                                clusterCounts = numClusters)
 UPSLTDdist(results,ylim=c(-15000,15000))

</code></pre>

<hr>
<h2 id='UPSnnltd'>Nearest Neighbor Distribution of LTDs in Unsupervised Propensiy Scoring</h2><span id='topic+UPSnnltd'></span>

<h3>Description</h3>

<p>For a given number of patient clusters in baseline X-covariate space, UPSnnltd()
characterizes the distribution of Nearest Neighbor &quot;Local Treatemnt Differences&quot; (LTDs) on
a specified Y-outcome variable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>UPSnnltd(envir, numclust)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="UPSnnltd_+3A_envir">envir</code></td>
<td>
<p>name of the working local control classic environment.</p>
</td></tr>
<tr><td><code id="UPSnnltd_+3A_numclust">numclust</code></td>
<td>
<p>Number of clusters in baseline X-covariate space.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Multiple calls to UPSnnltd(n) for varying numbers of clusters, n, are typically made
after first invoking UPShclus() to hierarchically cluster patients in X-space and then
invoking UPSaccum() to specify a Y outcome variable and a two-level treatment factor t.
UPSnnltd(n) then determines the LTD Distribution corresponding to n clusters and,
optionally, displays this distribution in a &quot;Snowball&quot; plot.
</p>


<h3>Value</h3>

<p>An output list object of class UPSnnltd:
</p>

<dl>
<dt>hiclus</dt><dd><p>Name of clustering object created by UPShclus().</p>
</dd>
<dt>dframe</dt><dd><p>Name of data.frame containing X, t &amp; Y variables.</p>
</dd>
<dt>trtm</dt><dd><p>Name of treatment factor variable.</p>
</dd>
<dt>yvar</dt><dd><p>Name of outcome Y variable.</p>
</dd>
<dt>numclust</dt><dd><p>Number of clusters requested.</p>
</dd>
<dt>actclust</dt><dd><p>Number of clusters actually produced.</p>
</dd>
<dt>scedas</dt><dd><p>Scedasticity assumption: &quot;homo&quot; or &quot;hete&quot;</p>
</dd>
<dt>PStdif</dt><dd><p>Character string describing the treatment difference.</p>
</dd>
<dt>nnhbindf</dt><dd><p>Vector containing cluster number for each patient. </p>
</dd>
<dt>rawmean</dt><dd><p>Unadjusted outcome mean by treatment group.</p>
</dd>
<dt>rawvars</dt><dd><p>Unadjusted outcome variance by treatment group.</p>
</dd>
<dt>rawfreq</dt><dd><p>Number of patients by treatment group.</p>
</dd>
<dt>ratdif</dt><dd><p>Unadjusted mean outcome difference between treatments.</p>
</dd>
<dt>ratsde</dt><dd><p>Standard error of unadjusted mean treatment difference.</p>
</dd>
<dt>binmean</dt><dd><p>Unadjusted mean outcome by cluster and treatment.</p>
</dd>
<dt>binvars</dt><dd><p>Unadjusted variance by cluster and treatment.</p>
</dd>
<dt>binfreq</dt><dd><p>Number of patients by bin and treatment.</p>
</dd>
<dt>awbdif</dt><dd><p>Across cluster average difference with cluster size weights.</p>
</dd>
<dt>awbsde</dt><dd><p>Standard error of awbdif.</p>
</dd>
<dt>wwbdif</dt><dd><p>Across cluster average difference, inverse variance weights.</p>
</dd>
<dt>wwbsde</dt><dd><p>Standard error of wwbdif.</p>
</dd>
<dt>faclev</dt><dd><p>Maximum number of different numerical values an outcome variable can assume without
automatically being converted into a &quot;factor&quot; variable; faclev=1 causes a binary indicator to be
treated as a continuous variable determining an average or proportion.</p>
</dd>
<dt>youtype</dt><dd><p>&quot;contin&quot;uous =&gt; only next eight outputs; &quot;factor&quot; =&gt; only last three outputs.</p>
</dd>
<dt>aovdiff</dt><dd><p>ANOVA summary for treatment main effect only.</p>
</dd>
<dt>form2</dt><dd><p>Formula for outcome differences due to bins and to treatment nested within bins.</p>
</dd>
<dt>bindiff</dt><dd><p>ANOVA summary for treatment nested within cluster.</p>
</dd>
<dt>sig2</dt><dd><p>Estimate of error mean square in nested model.</p>
</dd>
<dt>pbindif</dt><dd><p>Unadjusted treatment difference by cluster.</p>
</dd>
<dt>pbinsde</dt><dd><p>Standard error of the unadjusted difference by cluster.</p>
</dd>
<dt>pbinsiz</dt><dd><p>Cluster radii measure: square root of total number of patients.</p>
</dd>
<dt>symsiz</dt><dd><p>Symbol size of largest possible Snowball in a UPSnnltd() plot with 1 cluster.</p>
</dd>
<dt>factab</dt><dd><p>Marginal table of counts by Y-factor level and treatment.</p>
</dd>
<dt>cumchi</dt><dd><p>Cumulative Chi-Square statistic for interaction in the three-way, nested table.</p>
</dd>
<dt>cumdf</dt><dd><p>Degrees of-Freedom for the Cumulative Chi-Squared.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Bob Obenchain &lt;wizbob@att.net&gt;
</p>


<h3>References</h3>


<ul>
<li><p> Obenchain RL. (2004) Unsupervised Propensity Scoring: NN and IV Plots.
<em>Proceedings of the American Statistical Association (on CD)</em> 8 pages.
</p>
</li>
<li><p> Obenchain RL. (2011) <b>USPSinR.pdf</b>  USPS R-package vignette, 40 pages.
</p>
</li>
<li><p> Rosenbaum PR, Rubin RB. (1983) The Central Role of the Propensity Score
in Observational Studies for Causal Effects. <em>Biometrika</em> <b>70</b>:
41&ndash;55.
</p>
</li>
<li><p> Rubin DB. (1980) Bias reduction using Mahalanobis metric matching.
<em>Biometrics</em> <b>36</b>: 293-298.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+UPSivadj">UPSivadj</a></code>, <code><a href="#topic+UPSaccum">UPSaccum</a></code> and <code><a href="#topic+UPSgraph">UPSgraph</a></code>.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
