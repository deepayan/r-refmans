<!DOCTYPE html><html lang="en"><head><title>Help for package preference</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {preference}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#preference-package'><p>Design and Analysis of Two-stage Randomized Clinical Trials</p></a></li>
<li><a href='#effects_from_means'><p>Calculate Effect Sizes from Means</p></a></li>
<li><a href='#fit_preference'><p>Fit the Preference Data Collected from a Two-stage Clinical Trial</p></a></li>
<li><a href='#fit_preference_summary'><p>Fit Preference Model from Summary Data</p></a></li>
<li><a href='#imap_stratified_summary'><p>Data from the IMAP study</p></a></li>
<li><a href='#optimal_proportion'><p>Unstratified Optimized Theta</p></a></li>
<li><a href='#overall_power'><p>Power Calculation from Sample Size</p></a></li>
<li><a href='#overall_power_binom'><p>Power Calculation from Sample Size</p></a></li>
<li><a href='#overall_sample_size'><p>Overall Sample Size</p></a></li>
<li><a href='#overall_sample_size_bin'><p>Overall Sample Size Binomial</p></a></li>
<li><a href='#overall_sample_size_pois'><p>Overall Sample Size Poisson Distribution</p></a></li>
<li><a href='#plot.preference.trial'><p>Plot the effect sizes of a preference trial</p></a></li>
<li><a href='#preference'><p>Fit Preference Data Collected from a Two-stage Clinical Trial</p></a></li>
<li><a href='#preference.trial'><p>Create a Preference Trial</p></a></li>
<li><a href='#pt_from_power'><p>Design Preference Trials with Power Constraint(s)</p></a></li>
<li><a href='#pt_from_ss'><p>Design Preference Trials with Sample Size Constraint(s)</p></a></li>
<li><a href='#pwr_overall_pois'><p>Power Calculation from Sample Size</p></a></li>
<li><a href='#sample_size'><p>Preference trial parameter accessors</p></a></li>
<li><a href='#treatment_effect_size'><p>Treatment Effect Back Calculation</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>2-Stage Preference Trial Design and Analysis</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.6</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/kaneplusplus/preference">https://github.com/kaneplusplus/preference</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/kaneplusplus/preference/issues">https://github.com/kaneplusplus/preference/issues</a></td>
</tr>
<tr>
<td>Description:</td>
<td>Design and analyze two-stage randomized trials with a continuous
    outcome measure. The package contains functions to compute the required 
    sample size needed to detect a given preference, treatment, and selection 
    effect; alternatively, the package contains functions that can report the 
    study power given a fixed sample size. Finally, analysis functions are 
    provided to test each effect using either summary data (i.e. means, 
    variances) or raw study data &lt;<a href="https://doi.org/10.18637%2Fjss.v094.c02">doi:10.18637/jss.v094.c02</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/LGPL-2">LGPL-2</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2, tidyr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-09-08 19:22:57 UTC; mike</td>
</tr>
<tr>
<td>Author:</td>
<td>Briana Cameron [aut, cph],
  Denise Esserman [ctb],
  Michael Kane <a href="https://orcid.org/0000-0003-1899-6662"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [cre, ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Michael Kane &lt;michael.kane@yale.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-09-09 06:20:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='preference-package'>Design and Analysis of Two-stage Randomized Clinical Trials</h2><span id='topic+preference-package'></span>

<h3>Description</h3>

<p>The <span class="pkg">preference</span> package is used for the design and 
analysis of two-stage randomized trials with a continuous outcome 
measure. In this study, patients are first randomized to either a 
random or choice arm. Patients 
initially randomized to the choice arm are allowed to select their preferred
treatment from the available treatment options; patients initially randomized
to the random arm undergo a second randomization procedure to one of the 
available treatment options. The design has also been extended to include
important stratification variables; the functions provided in this package
can accommodate both the unstratified and stratified designs.
</p>
<p>In this study, there are three effects that may be of interest. The treatment
effect captures the difference in outcome between patients randomized to 
treatment A and treatment B (similar to a traditional RCT). The selection 
effect captures the difference in outcome between patients that prefer 
treatment A and patients that prefer treatment B, regardless of the 
treatment that is actually received. Finally, the preference effect compares
the outcomes of patients who receive their preferred treatment (either 
treatment A or treatment B) and patients who do not receive their preferred
treatment. 
</p>
<p>To aid in the design of these two-stage randomized studies, sample size 
functions are provided to determine the necessary sample size to 
detect a particular selection, preference, and/or treatment effect. If the 
sample size is fixed prior to the start of the study, functions are provided
to calculate the study power to detect each effect. Finally, the 
<code>optimal_proportion</code> function can be used to determine the optimal 
proportion of patients randomized to the choice arm in the initial 
randomization. 
</p>
<p>To analyze the data from the two-stage randomized trial, two analysis
functions are provided. The function <code>preference</code> computes the 
test statistic and p-value for each effect given provided raw study data. 
The function <code>fit_preference_summary</code> uses provided summary data (mean, 
variance, and sample size) of each study group to compute the test statistic
and p-value of each effect. The test statistics can be accessed from
the models using the <code>summary()</code> function.
</p>
<p>Preference Trial Function Calls:
</p>

<ul>
<li><p>preference.trial: construct a <code>preferene.trial</code> based
on effect and sample sizes.
</p>
</li>
<li><p>pt_from_power: construct a <code>preference.trial</code> based on
power and  effect size.
</p>
</li>
<li><p>pt_from_ss: construct a <code>preference.trial</code> based on
sample size
</p>
</li></ul>

<p>Analysis Function Calls
</p>

<ul>
<li><p>preference and fit_preference: computes test statistic and 
p-value for observed #' selection, preference, and treatment effects 
using provided raw data
</p>
</li>
<li><p>fit_preference_summary: computes test statistic and p-value for 
observed selection, preference, and treatment effects using provided 
summary data (mean, variance, sample size)
</p>
</li></ul>

<p>Other Function Calls
</p>

<ul>
<li><p>treatment_effect_size: computes the treatment effect that can be 
detected given a specified sample size and power
</p>
</li>
<li><p>optimal_proportion: computes the optimal proportion randomized to 
choice arm (defined for unstratified design only)
</p>
</li>
<li><p>effects_from_means: computes the treatment, selection, and 
preference effect sizes provided the study means in each treatment arm
</p>
</li></ul>

<p>Data Sets
</p>

<ul>
<li><p>imap: summary SF36 outcome data for the two-stage randomized IMAP 
study
</p>
</li>
<li><p>imap_strat: summary SF36 outcome data for the two-stage randomized 
IMAP study stratified by high vs. low STAI score
</p>
</li></ul>

<p>Acknowledgments: This work was partially supported through a 
Patient-Centered Outcomes Research Institute (PCORI) Award (ME-1511-32832) 
and Yale's CTSA Award (Ul1TR001863).  We would also like to thank the IMAP 
team for sharing their data to demonstrate this package.
</p>
<p>Disclaimer: All statements in this report, including its findings and 
conclusions, are solely those of the authors and do not necessarily 
represent the views of the Patient-Centered Outcomes Research Institute 
(PCORI), its Board of Governors or Methodology Committee.
</p>


<h3>References</h3>

<p>Rucker G (1989). &quot;A two-stage trial design for testing treatment,
self-selection and treatment preference effects.&quot; <em>Stat Med</em>, 
<strong>8</strong>(4):477-485. 
(<a href="https://pubmed.ncbi.nlm.nih.gov/2727471">PubMed</a>)
</p>
<p>McCaffery et al. (2010) &quot;Psychosocial outcomes of three triage 
methods for the management of borderline abnormal cervical smears: an open 
randomised trial.&quot; <em>BMJ</em>, <strong>340</strong>:b4491.
(<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2827716/">PubMed</a>)
</p>
<p>Walter et. al. (2011). &quot;Optimal allocation of participants for
the estimation of selection, preference and treatment effects in the 
two-stage randomised trial design.&quot; <em>Stat Med</em>, 
<strong>31</strong>(13):1307-1322.
(<a href="https://pubmed.ncbi.nlm.nih.gov/22362374/">PubMed</a>)
</p>
<p>McCaffery et al. (2011) &quot;Determining the Impact of Informed 
Choice: Separating Treatment Effects from the Effects of Choice and Selection
in Randomized Trials.&quot; <em>Med Decis Making</em>, <strong>31</strong>(2):229-236.
(<a href="https://pubmed.ncbi.nlm.nih.gov/21041538/">PubMed</a>)
</p>
<p>Turner RM, et al. (2014). &quot;Sample Size and Power When Designing
a Randomized Trial for the Estimation of Treatment, Selection, and 
Preference Effects.&quot; <em>Medical Decision Making</em>, <strong>34</strong>:711-719.
(<a href="https://pubmed.ncbi.nlm.nih.gov/24695962">PubMed</a>)
</p>
<p>Cameron B, Esserman D (2016). &quot;Sample Size and Power for a 
Stratified Doubly Randomized Preference Design.&quot; 
<em>Stat Methods Med Res</em>.  
(<a href="https://pubmed.ncbi.nlm.nih.gov/27872194">PubMed</a>)
</p>

<hr>
<h2 id='effects_from_means'>Calculate Effect Sizes from Means</h2><span id='topic+effects_from_means'></span>

<h3>Description</h3>

<p>Calculates the preference, selection and treatment effects given the means
of each treatment group in the choice and random arms for the 2-stage 
randomized study.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>effects_from_means(mu1, mu2, mu11, mu22, phi, nstrata = 1, xi = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="effects_from_means_+3A_mu1">mu1</code></td>
<td>
<p>mean response of the patients receiving treatment 1 in the 
random arm. For unstratified design, should be numeric value.
For the stratified design, should be vector of length equal to
number of strata with each entry corresponding to stratum-
specific mean.</p>
</td></tr>
<tr><td><code id="effects_from_means_+3A_mu2">mu2</code></td>
<td>
<p>mean response of the patients receiving treatment 2 in the 
random arm. For unstratified design, should be numeric value.
For the stratified design, should be vector of length equal to
number of strata with each entry corresponding to stratum-
specific mean.</p>
</td></tr>
<tr><td><code id="effects_from_means_+3A_mu11">mu11</code></td>
<td>
<p>mean response of the patients choosing treatment 1 in the choice
arm. For unstratified design, should be numeric value.
For the stratified design, should be vector of length equal to
number of strata with each entry corresponding to stratum-
specific mean.</p>
</td></tr>
<tr><td><code id="effects_from_means_+3A_mu22">mu22</code></td>
<td>
<p>mean response of the patients choosing treatment 2 in the choice
arm. For unstratified design, should be numeric value.
For the stratified design, should be vector of length equal to
number of strata with each entry corresponding to stratum-
specific mean.</p>
</td></tr>
<tr><td><code id="effects_from_means_+3A_phi">phi</code></td>
<td>
<p>proportion of patients preferring treatment 1. For unstratified 
design, should be numeric value. For the stratified design, 
should be vector of length equal to number of strata with each 
entry corresponding to stratum-specific preference rate. All 
elements should be numeric values between 0 and 1.</p>
</td></tr>
<tr><td><code id="effects_from_means_+3A_nstrata">nstrata</code></td>
<td>
<p>number of strata. Default is 1 (unstratified design).</p>
</td></tr>
<tr><td><code id="effects_from_means_+3A_xi">xi</code></td>
<td>
<p>a numeric vector of the proportion of patients in each stratum. 
Length of vector should equal the number of strata in the study and 
sum of vector should be 1. Should only be specified for stratified
design.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Rucker G (1989). &quot;A two-stage trial design for testing treatment, 
self-selection and treatment preference effects.&quot; <em>Stat Med</em>, 
<strong>8</strong>(4):477-485. 
(<a href="https://pubmed.ncbi.nlm.nih.gov/2727471">PubMed</a>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>effects_from_means(mu1=1, mu2=2, mu11=1.5, mu22=2.5, phi=0.5)
</code></pre>

<hr>
<h2 id='fit_preference'>Fit the Preference Data Collected from a Two-stage Clinical Trial</h2><span id='topic+fit_preference'></span>

<h3>Description</h3>

<p>Computes the test statistics and p-values for the preference, 
selection, and treatment effects for the two-stage randomized trial using 
collected outcome, random, treatment, and strata values for specified
significance level.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_preference(outcome, arm, treatment, strata, alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fit_preference_+3A_outcome">outcome</code></td>
<td>
<p>(numeric) individual trial outcomes.</p>
</td></tr>
<tr><td><code id="fit_preference_+3A_arm">arm</code></td>
<td>
<p>(character or factor) a vector of &quot;choice&quot; and &quot;random&quot; character
or factor values indicating the arm of the sample?</p>
</td></tr>
<tr><td><code id="fit_preference_+3A_treatment">treatment</code></td>
<td>
<p>(character, factor, or integer) which treatment an 
individual received</p>
</td></tr>
<tr><td><code id="fit_preference_+3A_strata">strata</code></td>
<td>
<p>(optional integer) which strata the individual belongs to.</p>
</td></tr>
<tr><td><code id="fit_preference_+3A_alpha">alpha</code></td>
<td>
<p>(optional numeric) Level of significance (default=0.05)</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'># Unstratified
outcome &lt;- c(10, 8, 6, 10, 5, 8, 7, 6, 10, 12, 11, 6, 8, 10, 5, 7, 9, 
             12, 6, 8, 9, 10, 7, 8,11)
arm &lt;- c(rep("choice", 13), rep("random", 12))
treatment &lt;- c(rep(1, 5), rep(2, 8), rep(1, 6), rep(2, 6))
fit_preference(outcome, arm, treatment)

# Stratified
# Same data plus strata information.
strata &lt;- c(1,1,2,2,2,1,1,1,1,2,2,2,2,1,1,1,2,2,2,1,1,1,2,2,2)
fit_preference(outcome, arm, treatment, strata, alpha=0.1)
</code></pre>

<hr>
<h2 id='fit_preference_summary'>Fit Preference Model from Summary Data</h2><span id='topic+fit_preference_summary'></span>

<h3>Description</h3>

<p>Computes the test statistics and p-values for the preference, 
selection, and treatment effects in a two-stage randomized trial using 
summary data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_preference_summary(
  x1mean,
  x1var,
  m1,
  x2mean,
  x2var,
  m2,
  y1mean,
  y1var,
  n1,
  y2mean,
  y2var,
  n2,
  xi = 1,
  nstrata = 1,
  alpha = 0.05
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fit_preference_summary_+3A_x1mean">x1mean</code></td>
<td>
<p>mean of responses for patients choosing treatment 1. If study
is stratified, should be vector with length equal to the
number of strata.</p>
</td></tr>
<tr><td><code id="fit_preference_summary_+3A_x1var">x1var</code></td>
<td>
<p>variance of responses for patients choosing treatment 1. If 
study is stratified, should be vector with length equal to the
number of strata.</p>
</td></tr>
<tr><td><code id="fit_preference_summary_+3A_m1">m1</code></td>
<td>
<p>number of patients choosing treatment 1. If study
is stratified, should be vector with length equal to the
number of strata.</p>
</td></tr>
<tr><td><code id="fit_preference_summary_+3A_x2mean">x2mean</code></td>
<td>
<p>mean of responses for patients choosing treatment 2. If study
is stratified, should be vector with length equal to the
number of strata.</p>
</td></tr>
<tr><td><code id="fit_preference_summary_+3A_x2var">x2var</code></td>
<td>
<p>variance of responses for patients choosing treatment 2. If 
study is stratified, should be vector with length equal to the
number of strata.</p>
</td></tr>
<tr><td><code id="fit_preference_summary_+3A_m2">m2</code></td>
<td>
<p>number of patients choosing treatment 2. If study
is stratified, should be vector with length equal to the
number of strata.</p>
</td></tr>
<tr><td><code id="fit_preference_summary_+3A_y1mean">y1mean</code></td>
<td>
<p>mean of responses for patients randomized to treatment 1. If 
study is stratified, should be vector with length equal to the
number of strata.</p>
</td></tr>
<tr><td><code id="fit_preference_summary_+3A_y1var">y1var</code></td>
<td>
<p>variance of responses for patients randomized to treatment 1. 
If study is stratified, should be vector with length equal to the
number of strata.</p>
</td></tr>
<tr><td><code id="fit_preference_summary_+3A_n1">n1</code></td>
<td>
<p>number of patients randomized to treatment 1. If study is 
stratified, should be vector with length equal to the number of 
strata.</p>
</td></tr>
<tr><td><code id="fit_preference_summary_+3A_y2mean">y2mean</code></td>
<td>
<p>mean of responses for patients randomized to treatment 2. If 
study is stratified, should be vector with length equal to the
number of strata.</p>
</td></tr>
<tr><td><code id="fit_preference_summary_+3A_y2var">y2var</code></td>
<td>
<p>variance of responses for patients randomized to treatment 2. 
If study is stratified, should be vector with length equal to the
number of strata.</p>
</td></tr>
<tr><td><code id="fit_preference_summary_+3A_n2">n2</code></td>
<td>
<p>number of patients randomized to treatment 2. If study is 
stratified, should be vector with length equal to the number of 
strata.</p>
</td></tr>
<tr><td><code id="fit_preference_summary_+3A_xi">xi</code></td>
<td>
<p>a numeric vector of the proportion of patients in each stratum. 
Length of vector should equal the number of strata in the study and 
sum of vector should be 1. All vector elements should be numeric 
values between 0 and 1. Default is 1 (i.e. unstratified design).</p>
</td></tr>
<tr><td><code id="fit_preference_summary_+3A_nstrata">nstrata</code></td>
<td>
<p>number of strata. Default is 1 (i.e. unstratified design).</p>
</td></tr>
<tr><td><code id="fit_preference_summary_+3A_alpha">alpha</code></td>
<td>
<p>Type I error rate, used to determine confidence interval level 
for the effect estimates. Default is 0.05 (i.e. 95% confidence interval)</p>
</td></tr>
</table>


<h3>References</h3>

<p>Rucker G (1989). &quot;A two-stage trial design for testing treatment,
self-selection and treatment preference effects.&quot; <em>Stat Med</em>, 
<strong>8</strong>(4):477-485. 
(<a href="https://pubmed.ncbi.nlm.nih.gov/2727471">PubMed</a>)
</p>
<p>Cameron B, Esserman D (2016). &quot;Sample Size and Power for a 
Stratified Doubly Randomized Preference Design.&quot; 
<em>Stat Methods Med Res</em>. 
(<a href="https://pubmed.ncbi.nlm.nih.gov/27872194">PubMed</a>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Unstratified

x1mean &lt;- 5
x1var &lt;- 1
m1 &lt;- 15
x2mean &lt;- 7
x2var &lt;- 1.1
m2 &lt;- 35
y1mean &lt;- 6
y1var &lt;- 1
n1 &lt;- 25
y2mean &lt;- 8
y2var &lt;- 1.2
n2 &lt;- 25
fit_preference_summary(x1mean, x2var, m1, x2mean, x2var, m2, y1mean, y1var,
               n1, y2mean, y2var, n2)

# Stratified

x1mean &lt;- c(5, 3)
x1var &lt;- c(1, 1)
m1 &lt;- c(15, 30)
x2mean &lt;- c(7, 7)
x2var &lt;- c(1.1, 3.1)
m2 &lt;- c(35, 40)
y1mean &lt;- c(6, 4)
y1var &lt;- c(1, 2)
n1 &lt;- c(25, 35)
y2mean &lt;- c(8, 12)
y2var &lt;- c(1.2, 1)
n2 &lt;- c(25, 20)
fit_preference_summary(x1mean, x2var, m1, x2mean, x2var, m2, y1mean, y1var,
                       n1, y2mean, y2var, n2, alpha=0.1)
</code></pre>

<hr>
<h2 id='imap_stratified_summary'>Data from the IMAP study</h2><span id='topic+imap_stratified_summary'></span><span id='topic+imap_summary'></span><span id='topic+imap'></span>

<h3>Description</h3>

<p>The &ldquo;Improving Management of Abnormal Pap Smears&rdquo; study used a 
two-stage randomized preference trial design to evaluate psychosocial
outcomes in women found to have atypical cells in a Pap Smear.
Two systems for managing the atypical cells were tested (repeated Pap smears 
or HCV triage) and a doubly randomized design was used to evaluate the role 
of patient preference. The data set provides mean, standard deviation and 
sample sizes of the SF36 outcome for each treatment in both the choice and 
random arms.
</p>
<p>Three data sets are provided with the preference package based on the
IMAP study. The first, <code>imap_summary</code> provides summary statistics
of the entire trial. The second <code>imap_summary_stratified</code>, summary
statistics of the study per strata. The third <code>imap</code> is a resampled
version of the individual level data including stratification. Each
of these data sets are compatible with the analysis functions 
<code>fit_preference_summary</code>, <code>fit_preference</code>, and 
<code>preference</code>, provided in this package. The examples sections
in the documentation illustrate their use.
</p>


<h3>References</h3>

<p>McCaffery et al. (2010) &quot;Psychosocial outcomes of three triage 
methods for the management of borderline abnormal cervical smears: an open 
randomised trial.&quot; <em>BMJ</em>, <strong>340</strong>:b4491.
(<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2827716/">PubMed</a>)
</p>
<p>McCaffery et al. (2011) &quot;Determining the Impact of Informed 
Choice: Separating Treatment Effects from the Effects of Choice and Selection
in Randomized Trials.&quot; <em>Med Decis Making</em>, <strong>31</strong>(2):229-236.
(<a href="https://pubmed.ncbi.nlm.nih.gov/21041538">PubMed</a>)
</p>

<hr>
<h2 id='optimal_proportion'>Unstratified Optimized Theta</h2><span id='topic+optimal_proportion'></span>

<h3>Description</h3>

<p>Calculates the optimal proportion of patients assigned to the choice arm
in an unstratified two-stage randomized trial
</p>


<h3>Usage</h3>

<pre><code class='language-R'>optimal_proportion(w_sel, w_pref, w_treat, sigma2, phi, delta_pi, delta_nu)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="optimal_proportion_+3A_w_sel">w_sel</code></td>
<td>
<p>weight assigned to the estimation of the selection effect. Each 
weight should be a numeric value between 0 and 1 and sum of 
three weights should be 1.</p>
</td></tr>
<tr><td><code id="optimal_proportion_+3A_w_pref">w_pref</code></td>
<td>
<p>weight assigned to the estimation of the preference effect. 
Each weight should be a numeric value between 0 and 1 and 
sum of three weights should be 1.</p>
</td></tr>
<tr><td><code id="optimal_proportion_+3A_w_treat">w_treat</code></td>
<td>
<p>weight assigned to estimation of the treatment effect. Each 
weight should be a numeric value between 0 and 1 and sum of 
three weights should be 1.</p>
</td></tr>
<tr><td><code id="optimal_proportion_+3A_sigma2">sigma2</code></td>
<td>
<p>variance estimate. Should be a positive numeric value.</p>
</td></tr>
<tr><td><code id="optimal_proportion_+3A_phi">phi</code></td>
<td>
<p>proportion of patients preferring treatment 1. Should be numeric
value between 0 and 1.</p>
</td></tr>
<tr><td><code id="optimal_proportion_+3A_delta_pi">delta_pi</code></td>
<td>
<p>overall study preference effect.</p>
</td></tr>
<tr><td><code id="optimal_proportion_+3A_delta_nu">delta_nu</code></td>
<td>
<p>overall study selection effect.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Walter et. al. (2011). &quot;Optimal allocation of participants for
the estimation of selection, preference and treatment effects in the 
two-stage randomised trial design.&quot; <em>Stat Med</em>, 
<strong>31</strong>(13):1307-1322.
(<a href="https://pubmed.ncbi.nlm.nih.gov/22362374">PubMed</a>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>optimal_proportion(w_sel=0.2, w_pref=0.4, w_treat=0.4, sigma2=1, phi=0.5,
                   delta_pi=1, delta_nu=0.5)
</code></pre>

<hr>
<h2 id='overall_power'>Power Calculation from Sample Size</h2><span id='topic+overall_power'></span>

<h3>Description</h3>

<p>Calculates the study power to detect a set of effects given a particular 
sample size in a two-stage randomized clinical trial
</p>


<h3>Usage</h3>

<pre><code class='language-R'>overall_power(
  N,
  phi,
  sigma2,
  delta_pi,
  delta_nu,
  delta_tau,
  alpha = 0.05,
  theta = 0.5,
  xi = 1,
  nstrata = 1,
  k = 1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="overall_power_+3A_n">N</code></td>
<td>
<p>overall study sample size.</p>
</td></tr>
<tr><td><code id="overall_power_+3A_phi">phi</code></td>
<td>
<p>the proportion of patients preferring treatment 1. Should be
numeric value between 0 and 1. If study is stratified, should be
vector with length equal to the number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_power_+3A_sigma2">sigma2</code></td>
<td>
<p>variance estimate. Should be positive numeric values. If study
is stratified, should be vector of within-stratum variances 
with length equal to the number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_power_+3A_delta_pi">delta_pi</code></td>
<td>
<p>overall study preference effect.</p>
</td></tr>
<tr><td><code id="overall_power_+3A_delta_nu">delta_nu</code></td>
<td>
<p>overall study selection effect.</p>
</td></tr>
<tr><td><code id="overall_power_+3A_delta_tau">delta_tau</code></td>
<td>
<p>overall study treatment effect.</p>
</td></tr>
<tr><td><code id="overall_power_+3A_alpha">alpha</code></td>
<td>
<p>desired type I error rate.</p>
</td></tr>
<tr><td><code id="overall_power_+3A_theta">theta</code></td>
<td>
<p>proportion of patients assigned to choice arm in the initial
randomization. Should be numeric value between
0 and 1 (default=0.5).</p>
</td></tr>
<tr><td><code id="overall_power_+3A_xi">xi</code></td>
<td>
<p>a numeric vector of the proportion of patients in each stratum. 
Length of vector should equal the number of strata in the study and 
sum of vector should be 1. All vector elements should be numeric 
values between 0 and 1. Default is 1 (i.e. unstratified design).</p>
</td></tr>
<tr><td><code id="overall_power_+3A_nstrata">nstrata</code></td>
<td>
<p>number of strata. Default is 1 (i.e. unstratified design).</p>
</td></tr>
<tr><td><code id="overall_power_+3A_k">k</code></td>
<td>
<p>the ratio of treatment A to treatment B in the random arm
(default 1).</p>
</td></tr>
</table>


<h3>References</h3>

<p>Turner RM, et al. (2014). &quot;Sample Size and Power When Designing
a Randomized Trial for the Estimation of Treatment, Selection, and 
Preference Effects.&quot; <em>Medical Decision Making</em>, <strong>34</strong>:711-719.
(<a href="https://pubmed.ncbi.nlm.nih.gov/24695962">PubMed</a>)
</p>
<p>Cameron B, Esserman D (2016). &quot;Sample Size and Power for a 
Stratified Doubly Randomized Preference Design.&quot; <em>Stat Methods Med Res</em>.
(<a href="https://pubmed.ncbi.nlm.nih.gov/27872194">PubMed</a>)
</p>

<hr>
<h2 id='overall_power_binom'>Power Calculation from Sample Size</h2><span id='topic+overall_power_binom'></span>

<h3>Description</h3>

<p>Calculates the study power to detect the preference effect given a particular 
sample size in a two-stage randomized clinical trial with a binary outcome measure
</p>


<h3>Usage</h3>

<pre><code class='language-R'>overall_power_binom(
  N,
  phi,
  p11,
  p22,
  p1,
  p2,
  alpha = 0.05,
  theta = 0.5,
  xi = 1,
  nstrata = 1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="overall_power_binom_+3A_n">N</code></td>
<td>
<p>overall study sample size.</p>
</td></tr>
<tr><td><code id="overall_power_binom_+3A_phi">phi</code></td>
<td>
<p>the proportion of patients preferring treatment 1. Should be
numeric value between 0 and 1. If study is stratified, should be
vector with length equal to the number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_power_binom_+3A_p11">p11</code></td>
<td>
<p>response proportion of patients choosing to receive treatment 1 
in the choice arm. Should be numeric value between 0 and 1. If
study is stratified, should be vector with length equal to the 
number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_power_binom_+3A_p22">p22</code></td>
<td>
<p>response proportion of patients choosing to receive treatment 2 
in the choice arm. Should be numeric value between 0 and 1. If
study is stratified, should be vector with length equal to the 
number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_power_binom_+3A_p1">p1</code></td>
<td>
<p>response proportion of patients randomized to receive treatment 1 
in the random arm. Should be numeric value between 0 and 1. If
study is stratified, should be vector with length equal to the 
number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_power_binom_+3A_p2">p2</code></td>
<td>
<p>response proportion of patients randomized to receive treatment 2 
in the random arm. Should be numeric value between 0 and 1. If
study is stratified, should be vector with length equal to the 
number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_power_binom_+3A_alpha">alpha</code></td>
<td>
<p>desired type I error rate.</p>
</td></tr>
<tr><td><code id="overall_power_binom_+3A_theta">theta</code></td>
<td>
<p>proportion of patients assigned to choice arm in the initial
randomization. Should be numeric value between
0 and 1 (default=0.5).</p>
</td></tr>
<tr><td><code id="overall_power_binom_+3A_xi">xi</code></td>
<td>
<p>a numeric vector of the proportion of patients in each stratum. 
Length of vector should equal the number of strata in the study and 
sum of vector should be 1. All vector elements should be numeric 
values between 0 and 1. Default is 1 (i.e. unstratified design).</p>
</td></tr>
<tr><td><code id="overall_power_binom_+3A_nstrata">nstrata</code></td>
<td>
<p>number of strata. Default is 1 (i.e. unstratified design).</p>
</td></tr>
</table>

<hr>
<h2 id='overall_sample_size'>Overall Sample Size</h2><span id='topic+overall_sample_size'></span>

<h3>Description</h3>

<p>Calculates the sample size required to detect a given set of effects 
in a two-stage randomized clinical trial. Returns the largest
of the required sample sizes for a given set of treatment, selection, and 
preference effects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>overall_sample_size(
  power,
  phi,
  delta_pi,
  delta_nu,
  delta_tau,
  sigma2,
  alpha = 0.05,
  theta = 0.5,
  xi = 1,
  nstrata = 1,
  k = 1,
  dist = "norm"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="overall_sample_size_+3A_power">power</code></td>
<td>
<p>desired study power. Should be numeric value between 0 and 1.</p>
</td></tr>
<tr><td><code id="overall_sample_size_+3A_phi">phi</code></td>
<td>
<p>the proportion of patients preferring treatment 1. Should be
numeric value between 0 and 1. If study is stratified, should be
vector with length equal to the number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_sample_size_+3A_delta_pi">delta_pi</code></td>
<td>
<p>overall study preference effect.</p>
</td></tr>
<tr><td><code id="overall_sample_size_+3A_delta_nu">delta_nu</code></td>
<td>
<p>overall study selection effect.</p>
</td></tr>
<tr><td><code id="overall_sample_size_+3A_delta_tau">delta_tau</code></td>
<td>
<p>overall study treatment effect.</p>
</td></tr>
<tr><td><code id="overall_sample_size_+3A_sigma2">sigma2</code></td>
<td>
<p>variance estimate. Should be positive numeric values. If study
is stratified, should be vector of within-stratum variances 
with length equal to the number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_sample_size_+3A_alpha">alpha</code></td>
<td>
<p>desired type I error rate.</p>
</td></tr>
<tr><td><code id="overall_sample_size_+3A_theta">theta</code></td>
<td>
<p>proportion of patients assigned to choice arm in the initial
randomization. Should be numeric value between
0 and 1 (default=0.5).</p>
</td></tr>
<tr><td><code id="overall_sample_size_+3A_xi">xi</code></td>
<td>
<p>a numeric vector of the proportion of patients in each stratum. 
Length of vector should equal the number of strata in the study and 
sum of vector should be 1. All vector elements should be numeric 
values between 0 and 1. Default is 1 (i.e. unstratified design).</p>
</td></tr>
<tr><td><code id="overall_sample_size_+3A_nstrata">nstrata</code></td>
<td>
<p>number of strata. Default is 1 (i.e. unstratified design).</p>
</td></tr>
<tr><td><code id="overall_sample_size_+3A_k">k</code></td>
<td>
<p>the ratio of treatment A to treatment B in the random arm. 
(default 1, i.e. equal distribution to the two treatments in the 
random arm)</p>
</td></tr>
</table>


<h3>References</h3>

<p>Turner RM, et al. (2014). &quot;Sample Size and Power When Designing
a Randomized Trial for the Estimation of Treatment, Selection, and 
Preference Effects.&quot; <em>Medical Decision Making</em>, <strong>34</strong>:711-719.
(<a href="https://pubmed.ncbi.nlm.nih.gov/24695962">PubMed</a>)
</p>
<p>Cameron B, Esserman D (2016). &quot;Sample Size and Power for a 
Stratified Doubly Randomized Preference Design.&quot; 
<em>Stat Methods Med Res</em>. 
(<a href="https://pubmed.ncbi.nlm.nih.gov/27872194">PubMed</a>)
</p>

<hr>
<h2 id='overall_sample_size_bin'>Overall Sample Size Binomial</h2><span id='topic+overall_sample_size_bin'></span>

<h3>Description</h3>

<p>Calculates the sample size required to detect a given set of effects
in a two-stage randomize clinical trial with a binary outcome. 
Returns the sample size for each of the three effects: preference,
selection and treatment
</p>


<h3>Usage</h3>

<pre><code class='language-R'>overall_sample_size_bin(
  power,
  phi,
  p11,
  p22,
  p1,
  p2,
  alpha = 0.05,
  theta = 0.5,
  xi = 1,
  nstrata = 1,
  k = 1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="overall_sample_size_bin_+3A_power">power</code></td>
<td>
<p>desired study power. Should be numeric value between 0 and 1.</p>
</td></tr>
<tr><td><code id="overall_sample_size_bin_+3A_phi">phi</code></td>
<td>
<p>the proportion of patients preferring treatment 1. Should be
numeric value between 0 and 1. If study is stratified, should be
vector with length equal to the number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_sample_size_bin_+3A_p11">p11</code></td>
<td>
<p>response proportion of patients choosing to receive treatment 1 
in the choice arm. Should be numeric value between 0 and 1. If
study is stratified, should be vector with length equal to the 
number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_sample_size_bin_+3A_p22">p22</code></td>
<td>
<p>response proportion of patients choosing to receive treatment 2 
in the choice arm. Should be numeric value between 0 and 1. If
study is stratified, should be vector with length equal to the 
number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_sample_size_bin_+3A_p1">p1</code></td>
<td>
<p>response proportion of patients randomized to receive treatment 1 
in the random arm. Should be numeric value between 0 and 1. If
study is stratified, should be vector with length equal to the 
number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_sample_size_bin_+3A_p2">p2</code></td>
<td>
<p>response proportion of patients randomized to receive treatment 2 
in the random arm. Should be numeric value between 0 and 1. If
study is stratified, should be vector with length equal to the 
number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_sample_size_bin_+3A_alpha">alpha</code></td>
<td>
<p>desired type I error rate.</p>
</td></tr>
<tr><td><code id="overall_sample_size_bin_+3A_theta">theta</code></td>
<td>
<p>proportion of patients assigned to choice arm in the initial
randomization. Should be numeric value between
0 and 1 (default=0.5).</p>
</td></tr>
<tr><td><code id="overall_sample_size_bin_+3A_xi">xi</code></td>
<td>
<p>a numeric vector of the proportion of patients in each stratum. 
Length of vector should equal the number of strata in the study 
and sum of vector should be 1. All vector elements should be
numeric values between 0 and 1. Default is 1 (i.e. unstratified 
design).</p>
</td></tr>
<tr><td><code id="overall_sample_size_bin_+3A_nstrata">nstrata</code></td>
<td>
<p>number of strata. Default is 1 (i.e. unstratified design).</p>
</td></tr>
<tr><td><code id="overall_sample_size_bin_+3A_k">k</code></td>
<td>
<p>the ratio of treatment A to treatment B in the random arm. 
(default 1, i.e. equal distribution to the two treatments in the 
random arm)</p>
</td></tr>
</table>

<hr>
<h2 id='overall_sample_size_pois'>Overall Sample Size Poisson Distribution</h2><span id='topic+overall_sample_size_pois'></span>

<h3>Description</h3>

<p>Calculates the sample size required to detect a given set of effects 
in a two-stage randomized clinical trial. Returns the largest
of the required sample sizes for a given set of treatment, selection, and 
preference effects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>overall_sample_size_pois(
  power,
  phi,
  lambda11,
  lambda22,
  lambda1,
  lambda2,
  alpha = 0.05,
  theta = 0.5,
  xi = 1,
  nstrata = 1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="overall_sample_size_pois_+3A_power">power</code></td>
<td>
<p>desired study power. Should be numeric value between 0 and 1.</p>
</td></tr>
<tr><td><code id="overall_sample_size_pois_+3A_phi">phi</code></td>
<td>
<p>the proportion of patients preferring treatment 1. Should be
numeric value between 0 and 1. If study is stratified, should be
vector with length equal to the number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_sample_size_pois_+3A_lambda11">lambda11</code></td>
<td>
<p>response mean of patients choosing to receive treatment 1 
in the choice arm. Should be numeric value larger than 0. If
study is stratified, should be vector with length equal to the 
number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_sample_size_pois_+3A_lambda22">lambda22</code></td>
<td>
<p>response mean of patients choosing to receive treatment 2 
in the choice arm. Should be numeric value larger than 0. If
study is stratified, should be vector with length equal to the 
number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_sample_size_pois_+3A_lambda1">lambda1</code></td>
<td>
<p>response mean of patients randomized to receive treatment 1 
in the random arm. Should be numeric value larger than 0. If
study is stratified, should be vector with length equal to the 
number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_sample_size_pois_+3A_lambda2">lambda2</code></td>
<td>
<p>response mean of patients randomized to receive treatment 2 
in the random arm. Should be numeric value larger than 0. If
study is stratified, should be vector with length equal to the 
number of strata in the study.</p>
</td></tr>
<tr><td><code id="overall_sample_size_pois_+3A_alpha">alpha</code></td>
<td>
<p>desired type I error rate.</p>
</td></tr>
<tr><td><code id="overall_sample_size_pois_+3A_theta">theta</code></td>
<td>
<p>proportion of patients assigned to choice arm in the initial
randomization. Should be numeric value between
0 and 1 (default=0.5).</p>
</td></tr>
<tr><td><code id="overall_sample_size_pois_+3A_xi">xi</code></td>
<td>
<p>a numeric vector of the proportion of patients in each stratum. 
Length of vector should equal the number of strata in the study and 
sum of vector should be 1. All vector elements should be numeric 
values between 0 and 1. Default is 1 (i.e. unstratified design).</p>
</td></tr>
<tr><td><code id="overall_sample_size_pois_+3A_nstrata">nstrata</code></td>
<td>
<p>number of strata. Default is 1 (i.e. unstratified design).</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'># Unstratified
overall_sample_size_pois(power = 0.8, phi = 0.6, lambda11 = 0.6, 
                         lambda22 = 0.7, lambda1 = 0.4, lambda2 = 0.6)
# Stratified
overall_sample_size_pois(power = 0.8, phi = c(0.6, 0.5), 
                         lambda11 = c(0.6, 0.7), lambda22 = c(0.7,0.7), 
                         lambda1 = c(0.4, 0.6), lambda2 = c(0.6, 0.6), 
                         xi = c(0.5, 0.5), nstrata = 2)
</code></pre>

<hr>
<h2 id='plot.preference.trial'>Plot the effect sizes of a preference trial</h2><span id='topic+plot.preference.trial'></span>

<h3>Description</h3>

<p>The plot() function visualizes the change in the
preference effect, the selection effect, or both as a function of the
total sample size of the trial. If the preference effect varies but the
selection effect does not, then it plots the preference effect by the
total sample size. Similarly if the selection effect varies but not the
preference effect then selection effect vs total sample size is shown.
When both preference and selection effect vary then the selection effect
is shown conditioned on the given preference effects.
</p>
<p>It is assumed that the set of trial provided as a parameter are related
and are comparable. For example, the function does not check to if
the strata are the same for all trials. If some other visualization is
required then the user is reminded that a preference.trial object is
a data frame and can be visualized in the usual way.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'preference.trial'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.preference.trial_+3A_x">x</code></td>
<td>
<p>an object of class preference.trial.</p>
</td></tr>
<tr><td><code id="plot.preference.trial_+3A_...">...</code></td>
<td>
<p>any other parameters (this is currently not used).</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
# Plot trials with fixed power and varying preference effect.
trials &lt;- pt_from_power(power = 0.8, pref_effect = seq(0.5, 2, by = 0.1), 
                        selection_effect = 1, treatment_effect = 1, 
                        sigma2 = 1, pref_prop = 0.6)
plot(trials)
 
# Plot trials with fixed power and varying selection effect.
trials &lt;- pt_from_power(power = 0.8, pref_effect = 1,
                        selection_effect = seq(0.5, 2, by = 0.1), 
                        treatment_effect = 1, sigma2 = 1, pref_prop = 0.6)
plot(trials)

# Plot trials with fixed power and varying preference and 
# selection effects.

# the selection effects of interest
selection_effects &lt;- rep(seq(0.5, 2, by = 0.1), 4)

# the preference effects to condition on
pref_effects &lt;- rep(seq(0.4, 1, by = 0.2), 
                    each = length(selection_effects)/4)

trials &lt;- pt_from_power(power = 0.8, pref_effect = pref_effects,
                        selection_effect = selection_effects,
                        treatment_effect = 1, sigma2 = 1, pref_prop = 0.6)
plot(trials)
 

</code></pre>

<hr>
<h2 id='preference'>Fit Preference Data Collected from a Two-stage Clinical Trial</h2><span id='topic+preference'></span>

<h3>Description</h3>

<p>The variables in the formula should reference columns in the
data parameter and should have the following characteristics.
</p>

<ul>
<li><p>outcome: Numeric values giving the outcome of interest.
</p>
</li>
<li><p>treatment: Character, categorical, or integer values denoting the 
treatment received by an individual.
</p>
</li>
<li><p>random: Logical value indicating whether the sample was from the
random arm (TRUE) or choice (FALSE).
</p>
</li>
<li><p>strata: An optional integer value denoting which strata 
individuals belong to.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>preference(form, data, alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="preference_+3A_form">form</code></td>
<td>
<p>a formula of the form outcome ~ treatment:arm {| strata}.</p>
</td></tr>
<tr><td><code id="preference_+3A_data">data</code></td>
<td>
<p>a data.frame containing variables specified in the formula. It 
should be noted that the arm values must be either &quot;choice&quot; or &quot;random&quot;.</p>
</td></tr>
<tr><td><code id="preference_+3A_alpha">alpha</code></td>
<td>
<p>(optional numeric) Level of significance (default 0.05)</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
# Unstratified

outcome &lt;- c(10, 8, 6, 10, 5, 8, 7, 6, 10, 12, 11, 6, 8, 10, 5, 7, 9, 
             12, 6, 8, 9, 10, 7, 8, 11)
arm &lt;- c(rep("choice", 13), rep("random", 12))
treatment &lt;- c(rep(1, 5), rep(2, 8), rep(1, 6), rep(2, 6))
d &lt;- data.frame(outcome=outcome, treatment=treatment, arm=arm)
preference(outcome ~ treatment:arm, d)

# Stratified
random &lt;- c(rep(FALSE, 13), rep(TRUE, 12))
treatment &lt;- c(rep(1, 5), rep(2, 8), rep(1, 6), rep(2, 6))
strata &lt;- c(1,1,2,2,2,1,1,1,1,2,2,2,2,1,1,1,2,2,2,1,1,1,2,2,2)
d &lt;- data.frame(outcome=outcome, treatment=treatment, arm=arm, 
                strata=strata)
preference(outcome ~ treatment:arm|strata, d, alpha=0.1)

</code></pre>

<hr>
<h2 id='preference.trial'>Create a Preference Trial</h2><span id='topic+preference.trial'></span>

<h3>Description</h3>

<p>Create a Preference Trial
</p>


<h3>Usage</h3>

<pre><code class='language-R'>preference.trial(
  pref_ss,
  pref_effect,
  selection_ss,
  selection_effect,
  treatment_ss,
  treatment_effect,
  sigma2,
  pref_prop,
  choice_prop = 0.5,
  stratum_prop = 1,
  alpha = 0.05,
  k = 1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="preference.trial_+3A_pref_ss">pref_ss</code></td>
<td>
<p>the sample size of the preference arm.</p>
</td></tr>
<tr><td><code id="preference.trial_+3A_pref_effect">pref_effect</code></td>
<td>
<p>the effect size of the preference arm (delta_pi).</p>
</td></tr>
<tr><td><code id="preference.trial_+3A_selection_ss">selection_ss</code></td>
<td>
<p>the sample size of the selection arm.</p>
</td></tr>
<tr><td><code id="preference.trial_+3A_selection_effect">selection_effect</code></td>
<td>
<p>the effect size of selection arm (delta_nu).</p>
</td></tr>
<tr><td><code id="preference.trial_+3A_treatment_ss">treatment_ss</code></td>
<td>
<p>the sample size of the treatment arm .</p>
</td></tr>
<tr><td><code id="preference.trial_+3A_treatment_effect">treatment_effect</code></td>
<td>
<p>the sample size of the treatment arm (delta_tau)</p>
</td></tr>
<tr><td><code id="preference.trial_+3A_sigma2">sigma2</code></td>
<td>
<p>the variance estimate of the outcome of interest. This 
value should be positive numeric values. If study is stratified, should 
be vector of within-stratum variances with length equal to the number of 
strata in the study.</p>
</td></tr>
<tr><td><code id="preference.trial_+3A_pref_prop">pref_prop</code></td>
<td>
<p>the proportion of patients preferring treatment 1. This
value should be between 0 and 1 (phi).</p>
</td></tr>
<tr><td><code id="preference.trial_+3A_choice_prop">choice_prop</code></td>
<td>
<p>the proportion of patients assigned to choice arm in 
the initial randomization. Should be numeric value between
0 and 1 (default=0.5) (theta).</p>
</td></tr>
<tr><td><code id="preference.trial_+3A_stratum_prop">stratum_prop</code></td>
<td>
<p>xi a numeric vector of the proportion of patients in 
each stratum. Length of vector should equal the number of strata in the 
study and sum of vector should be 1. All vector elements should be numeric
values between 0 and 1. Default is 1 (i.e. unstratified design) (xi).</p>
</td></tr>
<tr><td><code id="preference.trial_+3A_alpha">alpha</code></td>
<td>
<p>the desired type I error rate (default 0.05).</p>
</td></tr>
<tr><td><code id="preference.trial_+3A_k">k</code></td>
<td>
<p>the ratio of treatment A to treatment B in the random arm
(default 1)..</p>
</td></tr>
</table>


<h3>References</h3>

<p>Turner RM, et al. (2014). &quot;Sample Size and Power When Designing
a Randomized Trial for the Estimation of Treatment, Selection, and
Preference Effects.&quot; <em>Medical Decision Making</em>, <strong>34</strong>:711-719.
(<a href="https://pubmed.ncbi.nlm.nih.gov/24695962/">PubMed</a>)
</p>
<p>Cameron B, Esserman D (2016). &quot;Sample Size and Power for a
Stratified Doubly Randomized Preference Design.&quot; <em>Stat Methods Med Res</em>.
(<a href="https://pubmed.ncbi.nlm.nih.gov/27872194">PubMed</a>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Unstratified single trial.
preference.trial(pref_ss=100, pref_effect=1, selection_ss=100, 
  selection_effect=1, treatment_ss=100, treatment_effect=1,
  sigma2=1, pref_prop=0.6)

# Stratified single trial.
preference.trial(pref_ss=100, pref_effect=1, selection_ss=100,
  selection_effect=1, treatment_ss=100, treatment_effect=1,
  sigma2=list(c(1, 0.8)), pref_prop=list(c(0.6, 0.3)),
  choice_prop=0.5, stratum_prop=list(c(0.3, 0.7)))

# Multiple trials unstratified.
preference.trial(pref_ss=100, pref_effect=seq(0.1, 2, by=0.5), 
  selection_ss=100, selection_effect=1, treatment_ss=100, 
  treatment_effect=1, sigma2=1, pref_prop=0.6)

# Multiple, stratified trials.
preference.trial(pref_ss=100, pref_effect=seq(0.1, 2, by=0.5), 
  selection_ss=100, selection_effect=1, treatment_ss=100, 
  treatment_effect=1, sigma2=list(c(1, 0.8)), pref_prop=list(c(0.6, 0.3)), 
  choice_prop=0.5, stratum_prop=list(c(0.3, 0.7)))

</code></pre>

<hr>
<h2 id='pt_from_power'>Design Preference Trials with Power Constraint(s)</h2><span id='topic+pt_from_power'></span>

<h3>Description</h3>

<p>Create a set of preference trials with specified power.
The power parameter guarantees that the power will be at least what is
specified for each of the three arms.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pt_from_power(
  power,
  pref_effect,
  selection_effect,
  treatment_effect,
  sigma2,
  pref_prop,
  choice_prop = 0.5,
  stratum_prop = 1,
  alpha = 0.05,
  k = 1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pt_from_power_+3A_power">power</code></td>
<td>
<p>the desired power(s) for the trial(s)</p>
</td></tr>
<tr><td><code id="pt_from_power_+3A_pref_effect">pref_effect</code></td>
<td>
<p>the effect size of the preference arm (delta_pi).</p>
</td></tr>
<tr><td><code id="pt_from_power_+3A_selection_effect">selection_effect</code></td>
<td>
<p>the effect size of selection arm (delta_nu).</p>
</td></tr>
<tr><td><code id="pt_from_power_+3A_treatment_effect">treatment_effect</code></td>
<td>
<p>the sample size of the treatment arm (delta_tau)</p>
</td></tr>
<tr><td><code id="pt_from_power_+3A_sigma2">sigma2</code></td>
<td>
<p>the variance estimate of the outcome of interest. This 
value should be positive numeric values. If study is stratified, should 
be vector of within-stratum variances with length equal to the number of 
strata in the study.</p>
</td></tr>
<tr><td><code id="pt_from_power_+3A_pref_prop">pref_prop</code></td>
<td>
<p>the proportion of patients preferring treatment 1. This
value should be between 0 and 1 (phi).</p>
</td></tr>
<tr><td><code id="pt_from_power_+3A_choice_prop">choice_prop</code></td>
<td>
<p>the proportion of patients assigned to choice arm in 
the initial randomization. Should be numeric value between
0 and 1 (default=0.5) (theta).</p>
</td></tr>
<tr><td><code id="pt_from_power_+3A_stratum_prop">stratum_prop</code></td>
<td>
<p>xi a numeric vector of the proportion of patients in 
each stratum. Length of vector should equal the number of strata in the 
study and sum of vector should be 1. All vector elements should be numeric
values between 0 and 1. Default is 1 (i.e. unstratified design) (xi).</p>
</td></tr>
<tr><td><code id="pt_from_power_+3A_alpha">alpha</code></td>
<td>
<p>the desired type I error rate (default 0.05).</p>
</td></tr>
<tr><td><code id="pt_from_power_+3A_k">k</code></td>
<td>
<p>the ratio of treatment A to treatment B in the random arm
(default 1)..</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
# Unstratified trials with power constraints.
pt_from_power(power=seq(.1, 0.8, by=0.1), pref_effect=1, selection_effect=1, 
  treatment_effect=1, sigma2=1, pref_prop=0.6)

# Stratified trials with power constraints. Note that the proportion
# of patients in the choice arm (choice prop) is fixed for all strata.
pt_from_power(power=seq(0.1, 0.8, by=0.1), pref_effect=1, 
  selection_effect=1, treatment_effect=1,
  sigma2=list(c(1, 0.8)), pref_prop=list(c(0.6, 0.3)),
  choice_prop=0.5, stratum_prop=list(c(0.3, 0.7)))

# or...

pt_from_power(power=seq(0.1, 0.8, by=0.1), pref_effect=1, 
  selection_effect=1, treatment_effect=1,
  sigma2=c(1, 0.8), pref_prop=c(0.6, 0.3),
  choice_prop=0.5, stratum_prop=c(0.3, 0.7))

</code></pre>

<hr>
<h2 id='pt_from_ss'>Design Preference Trials with Sample Size Constraint(s)</h2><span id='topic+pt_from_ss'></span>

<h3>Description</h3>

<p>Create a set of preference trials where the maximum 
sample size for an arm is specified.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pt_from_ss(
  ss,
  pref_effect,
  selection_effect,
  treatment_effect,
  sigma2,
  pref_prop,
  choice_prop = 0.5,
  stratum_prop = 1,
  alpha = 0.05,
  k = 1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pt_from_ss_+3A_ss">ss</code></td>
<td>
<p>the maximum size of any of the three arms.</p>
</td></tr>
<tr><td><code id="pt_from_ss_+3A_pref_effect">pref_effect</code></td>
<td>
<p>the effect size of the preference arm (delta_pi).</p>
</td></tr>
<tr><td><code id="pt_from_ss_+3A_selection_effect">selection_effect</code></td>
<td>
<p>the effect size of selection arm (delta_nu).</p>
</td></tr>
<tr><td><code id="pt_from_ss_+3A_treatment_effect">treatment_effect</code></td>
<td>
<p>the sample size of the treatment arm (delta_tau)</p>
</td></tr>
<tr><td><code id="pt_from_ss_+3A_sigma2">sigma2</code></td>
<td>
<p>the variance estimate of the outcome of interest. This 
value should be positive numeric values. If study is stratified, should 
be vector of within-stratum variances with length equal to the number of 
strata in the study.</p>
</td></tr>
<tr><td><code id="pt_from_ss_+3A_pref_prop">pref_prop</code></td>
<td>
<p>the proportion of patients preferring treatment 1. This
value should be between 0 and 1 (phi).</p>
</td></tr>
<tr><td><code id="pt_from_ss_+3A_choice_prop">choice_prop</code></td>
<td>
<p>the proportion of patients assigned to choice arm in 
the initial randomization. Should be numeric value between
0 and 1 (default=0.5) (theta).</p>
</td></tr>
<tr><td><code id="pt_from_ss_+3A_stratum_prop">stratum_prop</code></td>
<td>
<p>xi a numeric vector of the proportion of patients in 
each stratum. Length of vector should equal the number of strata in the 
study and sum of vector should be 1. All vector elements should be numeric
values between 0 and 1. Default is 1 (i.e. unstratified design) (xi).</p>
</td></tr>
<tr><td><code id="pt_from_ss_+3A_alpha">alpha</code></td>
<td>
<p>the desired type I error rate (default 0.05)..</p>
</td></tr>
<tr><td><code id="pt_from_ss_+3A_k">k</code></td>
<td>
<p>the ratio of treatment A to treatment B in the random arm
(default 1).</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
# Unstratified trials with power constraints.
pt_from_ss(ss=seq(100, 1000, by=100), pref_effect=1, 
  selection_effect=1, treatment_effect=1, sigma2=1, pref_prop=0.6)

# Stratified trials with power constraints. Note that the proportion
# of patients in the choice arm (choice prop) is fixed for all strata.
pt_from_ss(ss=seq(100, 1000, by=100), pref_effect=1, 
  selection_effect=1, treatment_effect=1,
  sigma2=list(c(1, 0.8)), pref_prop=list(c(0.6, 0.3)),
  choice_prop=0.5, stratum_prop=list(c(0.3, 0.7)))

# or...

pt_from_ss(ss=seq(100, 1000, by=100), pref_effect=1, 
  selection_effect=1, treatment_effect=1,
  sigma2=c(1, 0.8), pref_prop=c(0.6, 0.3),
  choice_prop=0.5, stratum_prop=c(0.3, 0.7))

</code></pre>

<hr>
<h2 id='pwr_overall_pois'>Power Calculation from Sample Size</h2><span id='topic+pwr_overall_pois'></span>

<h3>Description</h3>

<p>Calculates the study power to detect a set of effects given a particular 
sample size in a two-stage randomized clinical trial
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pwr_overall_pois(
  N,
  phi,
  lambda11,
  lambda22,
  lambda1,
  lambda2,
  alpha = 0.05,
  theta = 0.5,
  xi = 1,
  nstrata = 1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pwr_overall_pois_+3A_n">N</code></td>
<td>
<p>overall study sample size.</p>
</td></tr>
<tr><td><code id="pwr_overall_pois_+3A_phi">phi</code></td>
<td>
<p>the proportion of patients preferring treatment 1. Should be
numeric value between 0 and 1. If study is stratified, should be
vector with length equal to the number of strata in the study.</p>
</td></tr>
<tr><td><code id="pwr_overall_pois_+3A_lambda11">lambda11</code></td>
<td>
<p>response mean of patients choosing to receive treatment 1 
in the choice arm. Should be numeric value larger than 0. If
study is stratified, should be vector with length equal to the 
number of strata in the study.</p>
</td></tr>
<tr><td><code id="pwr_overall_pois_+3A_lambda22">lambda22</code></td>
<td>
<p>response mean of patients choosing to receive treatment 2 
in the choice arm. Should be numeric value larger than 0. If
study is stratified, should be vector with length equal to the 
number of strata in the study.</p>
</td></tr>
<tr><td><code id="pwr_overall_pois_+3A_lambda1">lambda1</code></td>
<td>
<p>response mean of patients randomized to receive treatment 1 
in the random arm. Should be numeric value larger than 0. If
study is stratified, should be vector with length equal to the 
number of strata in the study.</p>
</td></tr>
<tr><td><code id="pwr_overall_pois_+3A_lambda2">lambda2</code></td>
<td>
<p>response mean of patients randomized to receive treatment 2 
in the random arm. Should be numeric value larger than 0. If
study is stratified, should be vector with length equal to the 
number of strata in the study.</p>
</td></tr>
<tr><td><code id="pwr_overall_pois_+3A_alpha">alpha</code></td>
<td>
<p>desired type I error rate.</p>
</td></tr>
<tr><td><code id="pwr_overall_pois_+3A_theta">theta</code></td>
<td>
<p>proportion of patients assigned to choice arm in the initial
randomization. Should be numeric value between
0 and 1 (default=0.5).</p>
</td></tr>
<tr><td><code id="pwr_overall_pois_+3A_xi">xi</code></td>
<td>
<p>a numeric vector of the proportion of patients in each stratum. 
Length of vector should equal the number of strata in the study and 
sum of vector should be 1. All vector elements should be numeric 
values between 0 and 1. Default is 1 (i.e. unstratified design).</p>
</td></tr>
<tr><td><code id="pwr_overall_pois_+3A_nstrata">nstrata</code></td>
<td>
<p>number of strata. Default is 1 (i.e. unstratified design).</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'># Unstratified
pwr_overall_pois(N=400, phi=0.5, lambda11=0.8, lambda22=0.5, lambda1=0.5, lambda2=0.4)
# Stratified
pwr_overall_pois(N=400, phi=c(0.5,0.5), lambda11=c(0.7,0.8), lambda22=c(0.4,0.4), 
lambda1=c(0.5,0.4), lambda2=c(0.2,0.3), xi=c(0.3,0.7), nstrata=2)
</code></pre>

<hr>
<h2 id='sample_size'>Preference trial parameter accessors</h2><span id='topic+sample_size'></span><span id='topic+sample_size.preference.trial'></span><span id='topic+power'></span><span id='topic+power.preference.trial'></span><span id='topic+effect_size'></span><span id='topic+effect_size.preference.trial'></span><span id='topic+proportion'></span><span id='topic+proportion.preference.trial'></span><span id='topic+significance'></span><span id='topic+significance.preference.trial'></span><span id='topic+sigma2'></span><span id='topic+sigma2.preference.trial'></span>

<h3>Description</h3>

<p>Accessor function have been created to get the sample size 
(sample_size), power (power), effect size (effect_size), arm proportion
(proportion), significance (significance), and trial variance estimates
(sigma2) for a set of preference trials.
</p>
<p>Note that these methods are preferred over accessing the underlying
data frame directly since the structure is slightly non-standard (some
columns are lists) and some values, like power, are not stored directly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sample_size(x)

## S3 method for class 'preference.trial'
sample_size(x)

power(x)

## S3 method for class 'preference.trial'
power(x)

effect_size(x)

## S3 method for class 'preference.trial'
effect_size(x)

proportion(x)

## S3 method for class 'preference.trial'
proportion(x)

significance(x)

## S3 method for class 'preference.trial'
significance(x)

sigma2(x)

## S3 method for class 'preference.trial'
sigma2(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sample_size_+3A_x">x</code></td>
<td>
<p>the set of preference trials.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'># Create a set of trials with a sequence of preference effects.
trials &lt;- preference.trial(pref_ss=100, pref_effect=seq(0.1, 2, by=0.5), 
                           selection_ss=100, selection_effect=1, 
                           treatment_ss=100, treatment_effect=1, sigma2=1, 
                           pref_prop=0.6)

# the sample sizes
sample_size(trials)

# the powers
power(trials)

# the effect sizes
effect_size(trials)

# the arm proportions
proportion(trials)

# the significance
significance(trials)

# the variance estimates
sigma2(trials)

</code></pre>

<hr>
<h2 id='treatment_effect_size'>Treatment Effect Back Calculation</h2><span id='topic+treatment_effect_size'></span>

<h3>Description</h3>

<p>Calculates the treatment effect that can be detected given a desired study 
power and overall study sample size for the two-stage randomized design
</p>


<h3>Usage</h3>

<pre><code class='language-R'>treatment_effect_size(
  N,
  power,
  sigma2,
  alpha = 0.05,
  theta = 0.5,
  xi = 1,
  nstrata = 1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="treatment_effect_size_+3A_n">N</code></td>
<td>
<p>overall study sample size.</p>
</td></tr>
<tr><td><code id="treatment_effect_size_+3A_power">power</code></td>
<td>
<p>desired study power. Should be numeric value between 0 and 1.</p>
</td></tr>
<tr><td><code id="treatment_effect_size_+3A_sigma2">sigma2</code></td>
<td>
<p>variance estimate. Should be positive numeric values. If study
is stratified, should be vector of within-stratum variances 
with length equal to the number of strata in the study.</p>
</td></tr>
<tr><td><code id="treatment_effect_size_+3A_alpha">alpha</code></td>
<td>
<p>desired type I error rate.</p>
</td></tr>
<tr><td><code id="treatment_effect_size_+3A_theta">theta</code></td>
<td>
<p>proportion of patients assigned to choice arm in the initial
randomization. Should be numeric value between
0 and 1 (default=0.5).</p>
</td></tr>
<tr><td><code id="treatment_effect_size_+3A_xi">xi</code></td>
<td>
<p>a numeric vector of the proportion of patients in each stratum. 
Length of vector should equal the number of strata in the study and 
sum of vector should be 1. All vector elements should be numeric 
values between 0 and 1. Default is 1 (i.e. unstratified design).</p>
</td></tr>
<tr><td><code id="treatment_effect_size_+3A_nstrata">nstrata</code></td>
<td>
<p>number of strata. Default is 1 (i.e. unstratified design).</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>treatment_effect_size(N=300, power=0.9, sigma2=c(1,0.8), xi=c(0.3,0.7), 
                      nstrata=2)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
