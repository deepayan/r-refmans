<!DOCTYPE html><html lang="en"><head><title>Help for package semicmprskcoxmsm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {semicmprskcoxmsm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#bayesian_boot_irrd'>
<p>Obtaining Bayesian Bootstrap Sample for Individual Risk Difference and Risk Ratio.</p></a></li>
<li><a href='#cif_est_usual'>
<p>Estimating Three Cumulative Incidence Functions Using the Usual Markov Model</p></a></li>
<li><a href='#conditional_cif_b'>
<p>Estimating Three Conditional Cumulative Incidence Functions Using the General Markov Model Conditional on Random Effect</p></a></li>
<li><a href='#doPS'>
<p>Generate the Inverse Probability Treatment Weights</p></a></li>
<li><a href='#em_illness_death_phmm_weight'>
<p>Using EM Type Algorithm for MSM Illness-death General Markov Model</p></a></li>
<li><a href='#get_hazard'>
<p>Compute the (Cumulative) Baseline Hazard from Cox Model</p></a></li>
<li><a href='#get_hazard_offset_weights'>
<p>Compute the (Cumulative) Baseline Hazard from Cox Model with Offsets</p></a></li>
<li><a href='#individual_RR_RD'>
<p>Estimating Three Individual Risk Difference and Risk Ratio Using the General Markov Model Conditional on Predicted Random Effect</p></a></li>
<li><a href='#initial_fit_em_weights'>
<p>Fit the MSM Cox Model with IP Weights</p></a></li>
<li><a href='#initial_lambda_em'>
<p>Compute the Initial (Cumulative) Baseline Hazard From the MSM Illness-death Model</p></a></li>
<li><a href='#OUT_em_weights'>
<p>Initial Value For Fitting the General Markov Model</p></a></li>
<li><a href='#plot.PS'>
<p>Plotting Histogram of Propensity Score and Balancing Plot for Covariates in the Propensity Score Model</p></a></li>
<li><a href='#sim_cox_msm_semicmrsk'>
<p>Simulating Semi-competing Risks with Right-censored Survival Data under Marginal Structural Illness-death Cox Model</p></a></li>
<li><a href='#usual_illness_death_weight'>
<p>Fit MSM Illness-death Usual Markov Model For Semi-competing Risks Data</p></a></li>
<li><a href='#var_em_illness_death_phmm'>
<p>Variance of parameters in MSM Illness-death General Markov Model</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Use Inverse Probability Weighting to Estimate Treatment Effect
for Semi Competing Risks Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.0</td>
</tr>
<tr>
<td>Author:</td>
<td>Yiran Zhang</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Yiran Zhang &lt;yiz038@health.ucsd.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Use inverse probability weighting methods to estimate treatment effect under marginal structure model (MSM) for the transition hazard of semi competing risk data, i.e. illness death model. We implement two specific such models, the usual Markov illness death structural model and the general Markov illness death structural model. We also provide the predicted three risks functions from the marginal structure models. Zhang, Y. and Xu, R. (2022) &lt;<a href="https://doi.org/10.48550/arXiv.2204.10426">doi:10.48550/arXiv.2204.10426</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2, survival, stats, twang, graphics, fastGHQuad, Rcpp</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-04-29 23:26:09 UTC; yiran</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-04-29 23:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='bayesian_boot_irrd'>
Obtaining Bayesian Bootstrap Sample for Individual Risk Difference and Risk Ratio.
</h2><span id='topic+bayesian_boot_irrd'></span>

<h3>Description</h3>

<p><code>bayesian_boot_irrd</code> provides the bootstrap sample for individual risk difference and risk ratio, it can be used for further inferences.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bayesian_boot_irrd(dat2,B,sigma_2_0, EM_initial, varlist, t1_star,t)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bayesian_boot_irrd_+3A_dat2">dat2</code></td>
<td>

<p>The dataset, includes non-terminal events, terminal events as well as event indicator.
</p>
</td></tr>
<tr><td><code id="bayesian_boot_irrd_+3A_b">B</code></td>
<td>

<p>Number of bootstraps that the user want to run, typically we use B = 500.
</p>
</td></tr>
<tr><td><code id="bayesian_boot_irrd_+3A_sigma_2_0">sigma_2_0</code></td>
<td>

<p>Initial value for sigma_2 for the general Markov model
</p>
</td></tr>
<tr><td><code id="bayesian_boot_irrd_+3A_em_initial">EM_initial</code></td>
<td>

<p>Initial value for the EM algorithm, the output of <code>OUT_em_weights</code>.
</p>
</td></tr>
<tr><td><code id="bayesian_boot_irrd_+3A_varlist">varlist</code></td>
<td>

<p>Confounder list for the propensity score model.
</p>
</td></tr>
<tr><td><code id="bayesian_boot_irrd_+3A_t1_star">t1_star</code></td>
<td>

<p>Fixed non-terminal event time for estimating risk difference/ratio for terminal event following the non-terminal event.
</p>
</td></tr>
<tr><td><code id="bayesian_boot_irrd_+3A_t">t</code></td>
<td>

<p>Fixed time point of interest to compare the individual risk difference / ratio.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For each  bootstrap sample:
</p>
<p>1. Generate <code class="reqn">n</code> standard exponential (mean and variance 1) random variates : <code class="reqn">u_1, u_2,..., u_n</code>;
</p>
<p>2. The weights for the Bayesian bootstrap are: <code class="reqn">w_{i}^{boot} = u_i / \bar{u}</code>, where <code class="reqn">\bar{u} = n^{-1}\sum_{i=1}^{n} u_i</code>;
</p>
<p>3. Calculate the propensity score and IP weights <code class="reqn">w_{i}^{IPW}</code> based on Bayesian bootstrap weighted data, and assigned the weights for fitting the MSM general Markov model as <code class="reqn">w_i = w_{i}^{boot} * w_{i}^{IPW}</code>.
</p>
<p>4. After obtaining <code class="reqn">\hat{\theta}</code> and <code class="reqn">\hat{b}_i</code>, for each individual i, calculate the IRR and IRD by plugging <code class="reqn">\hat{\theta}, \hat{b}_i</code> and a=0, a=1 separately at time t.
</p>
<p>The 95% prediction intervals (PI) cam be obtained by the normal approximation using bootstrap standard error.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>RD1_boot</code></td>
<td>

<p>A n times B matrix as the Bayesian bootstrap sample for each data point. The sample is for individual risk difference for time to non-terminal event at time t.
</p>
</td></tr>
<tr><td><code>RD2_boot</code></td>
<td>

<p>A n times B matrix as the Bayesian bootstrap sample for each data point. The sample is for individual risk difference for time to terminal event without non-terminal event at time t.
</p>
</td></tr>
<tr><td><code>RD3_boot</code></td>
<td>

<p>A n times B matrix as the Bayesian bootstrap sample for each data point. The sample is for individual risk difference for time to terminal event following non-terminal event by t1_start at time t.
</p>
</td></tr>
<tr><td><code>RR1_boot</code></td>
<td>

<p>A n times B matrix as the Bayesian bootstrap sample for each data point. The sample is for individual risk ratio for time to non-terminal event at time t.
</p>
</td></tr>
<tr><td><code>RR2_boot</code></td>
<td>

<p>A n times B matrix as the Bayesian bootstrap sample for each data point. The sample is for individual risk ratio for time to terminal event without non-terminal event at time t.
</p>
</td></tr>
<tr><td><code>RR3_boot</code></td>
<td>

<p>A n times B matrix as the Bayesian bootstrap sample for each data point. The sample is for individual risk ratio for time to terminal event following non-terminal event by t1_start at time t.
</p>
</td></tr>
</table>

<hr>
<h2 id='cif_est_usual'>
Estimating Three Cumulative Incidence Functions Using the Usual Markov Model
</h2><span id='topic+cif_est_usual'></span>

<h3>Description</h3>

<p><code>cif_est_usual</code> estimates the cumulative incidence function (CIF, i.e.risk) based on the MSM illness-death usual Markov model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cif_est_usual(data,X1,X2,event1,event2,w,Trt,
              t1_star = t1_star)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cif_est_usual_+3A_data">data</code></td>
<td>

<p>The dataset, includes non-terminal events, terminal events as well as event indicator.
</p>
</td></tr>
<tr><td><code id="cif_est_usual_+3A_x1">X1</code></td>
<td>

<p>Time to non-terminal event, could be censored by terminal event or lost to follow up.
</p>
</td></tr>
<tr><td><code id="cif_est_usual_+3A_x2">X2</code></td>
<td>

<p>Time to terminal event, could be censored by lost to follow up.
</p>
</td></tr>
<tr><td><code id="cif_est_usual_+3A_event1">event1</code></td>
<td>

<p>Event indicator for non-terminal event.
</p>
</td></tr>
<tr><td><code id="cif_est_usual_+3A_event2">event2</code></td>
<td>

<p>Event indicator for terminal event.
</p>
</td></tr>
<tr><td><code id="cif_est_usual_+3A_w">w</code></td>
<td>

<p>IP weights.
</p>
</td></tr>
<tr><td><code id="cif_est_usual_+3A_trt">Trt</code></td>
<td>

<p>Treatment variable.
</p>
</td></tr>
<tr><td><code id="cif_est_usual_+3A_t1_star">t1_star</code></td>
<td>

<p>Fixed non-terminal event time for estimating CIF function for terminal event following the non-terminal event.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>After estimating the parameters in the illness-death model <code class="reqn">\lambda_{j}^a</code> using IPW, we could estimate the corresponding CIF:
</p>
<p style="text-align: center;"><code class="reqn">
    \hat{P}(T_1^a&lt;t,\delta_1^a=1) = \int_{0}^{t} \hat{S}^a(u) d\hat{\Lambda}_{1}^a(u),
</code>
</p>

<p style="text-align: center;"><code class="reqn">
    \hat{P}(T_2^a&lt;t,\delta_1^a=0,\delta_2^a=1) = \int_{0}^{t} \hat{S}^a(u) d\hat{\Lambda}_{2}^a(u),
</code>
</p>

<p>and
</p>
<p style="text-align: center;"><code class="reqn">
    \hat{P}(T_2^a&lt;t_2 \mid T_1^a&lt;t_1, T_2^a&gt;t_1) = 1- e^{- \int_{t_1}^{t_2} d \hat{\Lambda}_{12}^a(u) },
</code>
</p>

<p>where <code class="reqn">\hat{S}^a</code> is the estimated overall survial function for joint <code class="reqn">T_1^a, T_2^a</code>, <code class="reqn"> \hat{S}^a(u) = e^{-\hat{\Lambda}_{1}^a(u)} - \hat{\Lambda}_{2}^a(u) </code>. We obtain three hazards by fitting the MSM illness-death model <code class="reqn"> \hat\Lambda_{j}^a(u) = \hat\Lambda_{0j}(u)e^{\hat\beta_j*a} </code>, <code class="reqn"> \hat\Lambda_{12}^a(u) = \hat\Lambda_{03}(u)e^{\hat\beta_3*a} </code>, and <code class="reqn"> \hat\Lambda_{0j}(u) </code> is a Breslow-type estimator of the baseline cumulative hazard.
</p>


<h3>Value</h3>

<p>Returns a table containing the estimated CIF for the event of interest for control and treated group.
</p>


<h3>References</h3>

<p>Meira-Machado, Luis and Sestelo, Marta (2019). &ldquo;Estimation in the progressive illness-death model: A nonexhaustive review,&rdquo;
<em>Biometrical Journal</em> 61(2), 245&ndash;263.
</p>

<hr>
<h2 id='conditional_cif_b'>
Estimating Three Conditional Cumulative Incidence Functions Using the General Markov Model Conditional on Random Effect
</h2><span id='topic+conditional_cif_b'></span>

<h3>Description</h3>

<p><code>conditional_cif_b</code> estimates the cumulative incidence function based on the MSM illness-death general Markov model conditional on the fixed random effect b.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>conditional_cif_b(res1,
                  t1_star,
                  b)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="conditional_cif_b_+3A_res1">res1</code></td>
<td>

<p>The output from <code>em_illness_death_phmm_weight</code>, the general Markov model result.
</p>
</td></tr>
<tr><td><code id="conditional_cif_b_+3A_t1_star">t1_star</code></td>
<td>

<p>Fixed non-terminal event time for estimating CIF function for terminal event following the non-terminal event.
</p>
</td></tr>
<tr><td><code id="conditional_cif_b_+3A_b">b</code></td>
<td>

<p>Fixed random effect value.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Similar as <code>cif_est_usual</code>, after estimating the parameters in the illness-death model <code class="reqn">\lambda_{j}^a</code> using IPW, we could estimate the corresponding conditional CIF under fixed b:
</p>
<p style="text-align: center;"><code class="reqn">
    \hat{P}(T_1^a&lt;t,\delta_1^a=1 \mid b) = \int_{0}^{t} \hat{S}^a(u \mid b) d\hat{\Lambda}_{1}^a(u \mid b ),
</code>
</p>

<p style="text-align: center;"><code class="reqn">
    \hat{P}(T_2^a&lt;t,\delta_1^a=0,\delta_2^a=1 \mid b) = \int_{0}^{t} \hat{S}^a(u \mid b) d\hat{\Lambda}_{2}^a(u \mid b),
</code>
</p>

<p>and
</p>
<p style="text-align: center;"><code class="reqn">
    \hat{P}(T_2^a&lt;t_2 \mid T_1^a&lt;t_1, T_2^a&gt;t_1 \mid b) = 1- e^{- \int_{t_1}^{t_2} d \hat{\Lambda}_{12}^a(u \mid b) },
</code>
</p>

<p>where <code class="reqn">\hat{S}^a</code> is the estimated overall survial function for joint <code class="reqn">T_1^a, T_2^a</code>, <code class="reqn"> \hat{S}^a(u) = e^{-\hat{\Lambda}_{1}^a(u)} - \hat{\Lambda}_{2}^a(u) </code>. We obtain three hazards by fitting the MSM illness-death model <code class="reqn"> \hat\Lambda_{j}^a(u) = \hat\Lambda_{0j}(u)e^{\hat\beta_j*a} </code>, <code class="reqn"> \hat\Lambda_{12}^a(u) = \hat\Lambda_{03}(u)e^{\hat\beta_3*a} </code>, and <code class="reqn"> \hat\Lambda_{0j}(u) </code> is a Breslow-type estimator of the baseline cumulative hazard.
</p>
<p>where <code class="reqn"> S(t \mid b;a) = \exp[- \int_0^{t} \{ \lambda_{01} (u)e^{\beta_1a + b} + \lambda_{02} (u )e^{\beta_2a + b} \} d u ] = \exp \{- e^{\beta_1a + b} \Lambda_{01}(t) - e^{\beta_2a + b}  \Lambda_{02} (t ) \} </code>
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>a1</code></td>
<td>

<p>The step function for estimated CIF conditional on b for time to non-terminal event for control group.
</p>
</td></tr>
<tr><td><code>b1</code></td>
<td>

<p>The step function for estimated CIF conditional on b for time to non-terminal event for treated group.
</p>
</td></tr>
<tr><td><code>a2</code></td>
<td>

<p>The step function for estimated CIF conditional on b for time to terminal event without non-terminal event for control group.
</p>
</td></tr>
<tr><td><code>b2</code></td>
<td>

<p>The step function for estimated CIF conditional on b for time to terminal event without non-terminal event for treated group.
</p>
</td></tr>
<tr><td><code>a3</code></td>
<td>

<p>The step function for estimated CIF conditional on b for time to terminal event following non-terminal event by t1_start for control group.
</p>
</td></tr>
<tr><td><code>b3</code></td>
<td>

<p>The step function for estimated CIF conditional on b for time to terminal event without non-terminal event by t1_start for treated group.
</p>
</td></tr>
<tr><td><code>cif.1</code></td>
<td>

<p>A data frame with time and estimated CIF conditional on b if is treated or controlled for time to non-terminal event.
</p>
</td></tr>
<tr><td><code>cif.2</code></td>
<td>

<p>A data frame with time and estimated CIF conditional on b if is treated or controlled for time to terminal event without non-terminal event.
</p>
</td></tr>
<tr><td><code>cif.3</code></td>
<td>

<p>A data frame with time and estimated CIF conditional on b if is treated or controlled for time to terminal event without non-terminal event by t1_start.
</p>
</td></tr>
</table>


<h3>See Also</h3>

 <p><code>cif_est_usual</code> </p>

<hr>
<h2 id='doPS'>
Generate the Inverse Probability Treatment Weights
</h2><span id='topic+doPS'></span>

<h3>Description</h3>

<p><code>doPS</code> calculates the unstabilized and stabilized inverse probability treatment weights (IPW) for average treatment effect using propensity score. The propensity score is calculated by <code>twang</code> package using the boosted logistic regression.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>doPS(data,Trt,Trt.name,VARS.,logistic = FALSE,w=NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="doPS_+3A_data">data</code></td>
<td>

<p>The dataset, includes treatment assignment as well as covariates.
</p>
</td></tr>
<tr><td><code id="doPS_+3A_trt">Trt</code></td>
<td>

<p>The name of the treatment variable in the dataset.
</p>
</td></tr>
<tr><td><code id="doPS_+3A_trt.name">Trt.name</code></td>
<td>

<p>The treated group name of the treatment variable in the dataset.
</p>
</td></tr>
<tr><td><code id="doPS_+3A_vars.">VARS.</code></td>
<td>

<p>The vector of the name of potential confounding variables in the dataset.
</p>
</td></tr>
<tr><td><code id="doPS_+3A_logistic">logistic</code></td>
<td>

<p>A logical value indicating whether use logistic regression (TRUE) or non-parametric boosted tree (FALSE).
</p>
</td></tr>
<tr><td><code id="doPS_+3A_w">w</code></td>
<td>

<p>Optional sampling weights.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The treatment variable should only contain 2 levels of treatment, and one should be viewed as treated group and another is control group.
</p>
<p>For stabilized weights:
</p>
<p>For the treated individuals, we assign the IPW: w = Pr(T=1)/Pr(T=1|X=x), for control individuals, the stabilized weight is: w = (1-Pr(T=1))/(1-Pr(T=1|X=x)).
</p>


<h3>Value</h3>

<p>doPS returns an object of class &quot;PS&quot;.
An object of class &quot;PS&quot; is a list containing the following components:
</p>
<table role = "presentation">
<tr><td><code>Data</code></td>
<td>
<p>A new dataset which excludes all the missing value on the potential confounders from input data, add the propensity score and IPW into the new dataset.
</p>

<dl>
<dt>ps_ate</dt><dd><p>The estimated propensity scores with estimand of interest as ATE.</p>
</dd>
<dt>ipw_ate_unstab</dt><dd><p>Unstabilized ipw calculated from ps_ate.</p>
</dd>
<dt>ipw_ate_stab</dt><dd><p>Stabilized ipw calculated from ps_ate.</p>
</dd>
</dl>
</td></tr>
<tr><td><code>ps</code></td>
<td>
<p>an object of class <code>ps</code>, See the help for <a href="twang.html#topic+ps">ps</a> for details of the ps class.
</p>
</td></tr>
</table>


<h3>See Also</h3>

 <p><code><a href="twang.html#topic+ps">ps</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>n &lt;- 500
set.seed(1234)
Cens = runif(n,0.7,0.9)
set.seed(1234)
OUT1 &lt;- sim_cox_msm_semicmrsk(beta1 = 1,beta2 = 1,beta3 = 0.5,
                              sigma_2 = 1,
                              alpha0 = 0.5, alpha1 = 0.1, alpha2 = -0.1, alpha3 = -0.2,
                              n=n, Cens = Cens)
data_test &lt;- OUT1$data0

## Get the PS weights
vars &lt;- c("Z1","Z2","Z3")
ps1 &lt;- doPS(data = data_test,
            Trt = "A",
            Trt.name = 1,
            VARS. = vars,
            logistic = TRUE,w=NULL)
w &lt;- ps1$Data$ipw_ate_stab
</code></pre>

<hr>
<h2 id='em_illness_death_phmm_weight'>
Using EM Type Algorithm for MSM Illness-death General Markov Model
</h2><span id='topic+em_illness_death_phmm_weight'></span>

<h3>Description</h3>

<p>Under the general Markov illness-death model, with normal frailty term which is a latent variable. We use the EM type algorithm to estimate the coefficient in the MSM illness-death general Markov model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>em_illness_death_phmm_weight(data,X1,X2,event1,event2,w,Trt,
                            EM_initial,sigma_2_0)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="em_illness_death_phmm_weight_+3A_data">data</code></td>
<td>

<p>The dataset, includes non-terminal events, terminal events as well as event indicator.
</p>
</td></tr>
<tr><td><code id="em_illness_death_phmm_weight_+3A_x1">X1</code></td>
<td>

<p>Time to non-terminal event, could be censored by terminal event or lost to follow up.
</p>
</td></tr>
<tr><td><code id="em_illness_death_phmm_weight_+3A_x2">X2</code></td>
<td>

<p>Time to terminal event, could be censored by lost to follow up.
</p>
</td></tr>
<tr><td><code id="em_illness_death_phmm_weight_+3A_event1">event1</code></td>
<td>

<p>Event indicator for non-terminal event.
</p>
</td></tr>
<tr><td><code id="em_illness_death_phmm_weight_+3A_event2">event2</code></td>
<td>

<p>Event indicator for terminal event.
</p>
</td></tr>
<tr><td><code id="em_illness_death_phmm_weight_+3A_w">w</code></td>
<td>

<p>IP weights.
</p>
</td></tr>
<tr><td><code id="em_illness_death_phmm_weight_+3A_trt">Trt</code></td>
<td>

<p>Treatment variable.
</p>
</td></tr>
<tr><td><code id="em_illness_death_phmm_weight_+3A_em_initial">EM_initial</code></td>
<td>

<p>Initial value for the EM algorithm, the output of <code>OUT_em_weights</code>.
</p>
</td></tr>
<tr><td><code id="em_illness_death_phmm_weight_+3A_sigma_2_0">sigma_2_0</code></td>
<td>

<p>Initial value for <code class="reqn">\sigma^2</code>, the variance of zero-mean normal frailty, usually starts with 1.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Similar as the usual Markov model. We postulate the semi-parametric Cox models with a frailty term for three transition rates in marginal structural illness-death model:
</p>
<p style="text-align: center;"><code class="reqn">
    \lambda_{1}(t_1 ; a) = \lambda_{01}(t)e^{\beta_1 a + b}, t_1 &gt; 0 ;
</code>
</p>

<p style="text-align: center;"><code class="reqn">
    \lambda_{2}(t_2 ; a) = \lambda_{02}(t)e^{\beta_2 a + b}, t_2 &gt; 0 ;
</code>
</p>

<p>and
</p>
<p style="text-align: center;"><code class="reqn">
    \lambda_{12}(t_2 \mid t_1 ; a) = \lambda_{03}(t_2)e^{\beta_3 a + b}, 0 &lt; t_1 &lt;  t_2 ,
</code>
</p>

<p>where <code class="reqn">b \sim N(0,1)</code>. Since b is not observed in the data, we use the IP weighted EM type algorithm to estimate all the parameters in the MSM illness-death general Markov model.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>beta1</code></td>
<td>

<p>The EM sequence for estimating <code class="reqn">\beta_1</code> at each iteration.
</p>
</td></tr>
<tr><td><code>beta2</code></td>
<td>

<p>The EM sequence for estimating <code class="reqn">\beta_2</code> at each iteration.
</p>
</td></tr>
<tr><td><code>beta3</code></td>
<td>

<p>The EM sequence for estimating <code class="reqn">\beta_3</code> at each iteration.
</p>
</td></tr>
<tr><td><code>Lambda01</code></td>
<td>

<p>List of two dataframes for estimated <code class="reqn"> \Lambda_{01} </code> and <code class="reqn"> \lambda_{01} </code> when EM converges.
</p>
</td></tr>
<tr><td><code>Lambda02</code></td>
<td>

<p>List of two dataframes for estimated <code class="reqn"> \Lambda_{02} </code> and <code class="reqn"> \lambda_{02} </code> when EM converges.
</p>
</td></tr>
<tr><td><code>Lambda03</code></td>
<td>

<p>List of two dataframes for estimated <code class="reqn"> \Lambda_{03} </code> and <code class="reqn"> \lambda_{03} </code> when EM converges.
</p>
</td></tr>
<tr><td><code>sigma_2</code></td>
<td>

<p>The EM sequence for estimating <code class="reqn">\sigma^2</code> at each iteration.
</p>
</td></tr>
<tr><td><code>loglik</code></td>
<td>

<p>The EM sequence for log-likelihood at each iteration.
</p>
</td></tr>
<tr><td><code>em.n</code></td>
<td>

<p>Number of EM steps to converge.
</p>
</td></tr>
<tr><td><code>data</code></td>
<td>

<p>Data after running the EM.
</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>n &lt;- 500
set.seed(1234)
Cens = runif(n,0.7,0.9)
set.seed(1234)
OUT1 &lt;- sim_cox_msm_semicmrsk(beta1 = 1,beta2 = 1,beta3 = 0.5,
                              sigma_2 = 1,
                              alpha0 = 0.5, alpha1 = 0.1, alpha2 = -0.1, alpha3 = -0.2,
                              n=n, Cens = Cens)
data_test &lt;- OUT1$data0

## Get the PS weights
vars &lt;- c("Z1","Z2","Z3")
ps1 &lt;- doPS(data = data_test,
            Trt = "A",
            Trt.name = 1,
            VARS. = vars,
            logistic = TRUE,w=NULL)
w &lt;- ps1$Data$ipw_ate_stab

### Fit the General Markov model
EM_initial &lt;- OUT_em_weights(data = data_test,
                             X1 = "X1",
                             X2 = "X2",
                             event1 = "delta1",
                             event2 = "delta2",
                             w = w,
                             Trt = "A")

res1 &lt;- em_illness_death_phmm_weight(data = data_test,
                                     X1 = "X1",
                                     X2 = "X2",
                                     event1 = "delta1",
                                     event2 = "delta2",
                                     w = w,
                                     Trt = "A",
                                     EM_initial = EM_initial,
                                     sigma_2_0 = 2)

print(paste("The estimated value for beta1 is:", round(res1$beta1[res1$em.n],5) ) )

</code></pre>

<hr>
<h2 id='get_hazard'>
Compute the (Cumulative) Baseline Hazard from Cox Model
</h2><span id='topic+get_hazard'></span>

<h3>Description</h3>

<p>Compute the Breslow type baseline hazard and cumulative baseline hazard at each event time from a Cox model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_hazard(fit)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_hazard_+3A_fit">fit</code></td>
<td>

<p>The results of a <code>coxph</code> fit.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See also <code>basehaz</code>, we only extract the estimated baseline hazard and baseline cumulative hazard from the results of a <code>coxph</code> fit.
</p>


<h3>Value</h3>

<p>A list contains two dataframes.
</p>
<table role = "presentation">
<tr><td><code>Lambda</code></td>
<td>

<p>See also <code>basehaz</code>, returns the Breslow type cumulative baseline hazard.
</p>
</td></tr>
<tr><td><code>lambda</code></td>
<td>

<p>Returns the Breslow type baseline hazard.
</p>
</td></tr>
</table>


<h3>See Also</h3>

 <p><code>basehaz</code> </p>

<hr>
<h2 id='get_hazard_offset_weights'>
Compute the (Cumulative) Baseline Hazard from Cox Model with Offsets
</h2><span id='topic+get_hazard_offset_weights'></span>

<h3>Description</h3>

<p>Compute the Breslow type baseline hazard and cumulative baseline hazard at each event time from a weighted Cox model with offsets.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_hazard_offset_weights(fit,data,time1= NULL,time2,w)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_hazard_offset_weights_+3A_fit">fit</code></td>
<td>

<p>The results of a weighted <code>coxph</code> fit.
</p>
</td></tr>
<tr><td><code id="get_hazard_offset_weights_+3A_data">data</code></td>
<td>

<p>The original data for fitting the weighted Cox model.
</p>
</td></tr>
<tr><td><code id="get_hazard_offset_weights_+3A_time1">time1</code></td>
<td>

<p>The default is <code>NULL</code>. For left truncation data, which refers to transition rate for terminal event following non-terminal events, this argument is the time to non-terminal event.
</p>
</td></tr>
<tr><td><code id="get_hazard_offset_weights_+3A_time2">time2</code></td>
<td>

<p>For right censored data, this is the event time or censoring time. For left truncation data, the argument is the time to terminal event or the censoring time.
</p>
</td></tr>
<tr><td><code id="get_hazard_offset_weights_+3A_w">w</code></td>
<td>

<p>IP weights.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See also <code>get_hazard</code>, handles the offset term in <code>coxph</code> for predicting the baseline hazard.
</p>


<h3>Value</h3>

<p>A list contains two dataframes.
</p>
<table role = "presentation">
<tr><td><code>Lambda</code></td>
<td>

<p>See also <code>get_hazard</code>, returns a step function for cumulative baseline hazard.
</p>
</td></tr>
<tr><td><code>lambda</code></td>
<td>

<p>Returns a dataframe for baseline hazard.
</p>
</td></tr>
<tr><td><code>cum_base_haz</code></td>
<td>

<p>Returns a dataframe for cumulative baseline hazard.
</p>
</td></tr>
</table>


<h3>See Also</h3>

 <p><code>get_hazard</code>, <code>basehaz</code> </p>

<hr>
<h2 id='individual_RR_RD'>
Estimating Three Individual Risk Difference and Risk Ratio Using the General Markov Model Conditional on Predicted Random Effect
</h2><span id='topic+individual_RR_RD'></span>

<h3>Description</h3>

<p><code>individual_RR_RD</code> estimates the individual risk difference and risk ratio based on the MSM illness-death general Markov model conditional on predicted random effect for each data point at a fixed time point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>individual_RR_RD(dat1,res1,t1_star ,t)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="individual_RR_RD_+3A_dat1">dat1</code></td>
<td>

<p>The dataset, includes non-terminal events, terminal events as well as event indicator.
</p>
</td></tr>
<tr><td><code id="individual_RR_RD_+3A_res1">res1</code></td>
<td>

<p>The output from <code>em_illness_death_phmm_weight</code>, the general Markov model result, the result data includes the predicted random effect.
</p>
</td></tr>
<tr><td><code id="individual_RR_RD_+3A_t1_star">t1_star</code></td>
<td>

<p>Fixed non-terminal event time for estimating risk difference/ratio for terminal event following the non-terminal event.
</p>
</td></tr>
<tr><td><code id="individual_RR_RD_+3A_t">t</code></td>
<td>

<p>Fixed time point of interest to compare the individual risk difference / ratio.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Similar as <code>cif_est_usual</code>, after estimating the parameters in the illness-death model <code class="reqn">\lambda_{j}^a</code> using IPW, we could estimate the corresponding conditional CIF under the predicted b:
</p>
<p style="text-align: center;"><code class="reqn">
    \hat{P}(T_1^a&lt;t,\delta_1^a=1 \mid b) = \int_{0}^{t} \hat{S}^a(u \mid b) d\hat{\Lambda}_{1}^a(u \mid b ),
</code>
</p>

<p style="text-align: center;"><code class="reqn">
    \hat{P}(T_2^a&lt;t,\delta_1^a=0,\delta_2^a=1 \mid b) = \int_{0}^{t} \hat{S}^a(u \mid b) d\hat{\Lambda}_{2}^a(u \mid b),
</code>
</p>

<p>and
</p>
<p style="text-align: center;"><code class="reqn">
    \hat{P}(T_2^a&lt;t_2 \mid T_1^a&lt;t_1, T_2^a&gt;t_1 \mid b) = 1- e^{- \int_{t_1}^{t_2} d \hat{\Lambda}_{12}^a(u \mid b) },
</code>
</p>

<p>The frailty term, or equivalently, the random effect b represents the unobserved heterogeneity among the individuals. As such, the above conditional risk represents individual risk, and the risk contrasts the individual risk contrasts. We therefore have the individual risk difference (IRD) and the individual risk ratio (IRR).
</p>
<p>Under the random effects model, for <code class="reqn">i = 1,2,...,n</code>, the predicted random effect is <code class="reqn">\hat{b}_i = E(b_i \mid O_i, \hat{\theta})</code>. We then obtain the predicted IRD and the predicted IRR.
</p>


<h3>Value</h3>

<p>Returns a data frame that includes the individual risk difference / ratio for three type of events.
</p>

<hr>
<h2 id='initial_fit_em_weights'>
Fit the MSM Cox Model with IP Weights
</h2><span id='topic+initial_fit_em_weights'></span>

<h3>Description</h3>

<p>Fit the MSM cox model with IPW as the initial value for EM algorithm to fit the illness-death general Markov model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>initial_fit_em_weights(data,X1,X2,event1,event2,w,Trt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="initial_fit_em_weights_+3A_data">data</code></td>
<td>

<p>The dataset, includes non-terminal events, terminal events as well as event indicator.
</p>
</td></tr>
<tr><td><code id="initial_fit_em_weights_+3A_x1">X1</code></td>
<td>

<p>Time to non-terminal event, could be censored by terminal event or lost to follow up.
</p>
</td></tr>
<tr><td><code id="initial_fit_em_weights_+3A_x2">X2</code></td>
<td>

<p>Time to terminal event, could be censored by lost to follow up.
</p>
</td></tr>
<tr><td><code id="initial_fit_em_weights_+3A_event1">event1</code></td>
<td>

<p>Event indicator for non-terminal event.
</p>
</td></tr>
<tr><td><code id="initial_fit_em_weights_+3A_event2">event2</code></td>
<td>

<p>Event indicator for terminal event.
</p>
</td></tr>
<tr><td><code id="initial_fit_em_weights_+3A_w">w</code></td>
<td>

<p>IP weights.
</p>
</td></tr>
<tr><td><code id="initial_fit_em_weights_+3A_trt">Trt</code></td>
<td>

<p>Treatment variable.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>As initial values we use for <code class="reqn">\beta_j</code>, <code class="reqn">j=1, 2, 3</code>, the estimates from IP weighted Cox regression without the offsets, i.e. from the usual Markov model.
</p>


<h3>Value</h3>

<p>A list of objects from <code>survival</code> package:
</p>
<table role = "presentation">
<tr><td><code>event1</code></td>
<td>

<p>An object of class <code>Surv</code> for non-terminal event.
</p>
</td></tr>
<tr><td><code>event2</code></td>
<td>

<p>An object of class <code>Surv</code> for terminal event without non-terminal event.
</p>
</td></tr>
<tr><td><code>event3</code></td>
<td>

<p>An object of class <code>Surv</code> for terminal event following non-terminal event.
</p>
</td></tr>
<tr><td><code>fit1</code></td>
<td>

<p>An object of class <code>coxph</code> representing the fit for time to non-terminal event. See <code>coxph.object</code> for details.
</p>
</td></tr>
<tr><td><code>fit2</code></td>
<td>

<p>An object of class <code>coxph</code> representing the fit for time to terminal event without non-terminal event.
</p>
</td></tr>
<tr><td><code>fit3</code></td>
<td>

<p>An object of class <code>coxph</code> representing the fit for time to terminal event following non-terminal event.
</p>
</td></tr>
</table>


<h3>See Also</h3>

 <p><code>Surv</code>, <code>coxph</code> </p>

<hr>
<h2 id='initial_lambda_em'>
Compute the Initial (Cumulative) Baseline Hazard From the MSM Illness-death Model
</h2><span id='topic+initial_lambda_em'></span>

<h3>Description</h3>

<p>Compute the Breslow type baseline hazard and cumulative baseline hazard at each event time from the MSM illness-death model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>initial_lambda_em (OUT)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="initial_lambda_em_+3A_out">OUT</code></td>
<td>

<p>The results of a <code>initial_fit_em_weights</code> fit.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See also <code>get_hazard</code>
</p>


<h3>Value</h3>

<p>A list contains six dataframes: including baseline hazard and cumulative baseline hazard for non-terminal event, terminal event without non-terminal event, and terminal event following non-terminal event.
</p>


<h3>See Also</h3>

 <p><code>get_hazard</code> </p>

<hr>
<h2 id='OUT_em_weights'>
Initial Value For Fitting the General Markov Model
</h2><span id='topic+OUT_em_weights'></span>

<h3>Description</h3>

<p>Compute the initial value for fitting the MSM illness-death general Markov model using EM type algorithm
</p>


<h3>Usage</h3>

<pre><code class='language-R'>OUT_em_weights(data,X1,X2,event1,event2,w,Trt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="OUT_em_weights_+3A_data">data</code></td>
<td>

<p>The dataset, includes non-terminal events, terminal events as well as event indicator.
</p>
</td></tr>
<tr><td><code id="OUT_em_weights_+3A_x1">X1</code></td>
<td>

<p>Time to non-terminal event, could be censored by terminal event or lost to follow up.
</p>
</td></tr>
<tr><td><code id="OUT_em_weights_+3A_x2">X2</code></td>
<td>

<p>Time to terminal event, could be censored by lost to follow up.
</p>
</td></tr>
<tr><td><code id="OUT_em_weights_+3A_event1">event1</code></td>
<td>

<p>Event indicator for non-terminal event.
</p>
</td></tr>
<tr><td><code id="OUT_em_weights_+3A_event2">event2</code></td>
<td>

<p>Event indicator for terminal event.
</p>
</td></tr>
<tr><td><code id="OUT_em_weights_+3A_w">w</code></td>
<td>

<p>IP weights.
</p>
</td></tr>
<tr><td><code id="OUT_em_weights_+3A_trt">Trt</code></td>
<td>

<p>Treatment variable.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code>usual_illness_death_weight</code>
</p>


<h3>Value</h3>

<p>A list of vectors and dataframes:
</p>
<table role = "presentation">
<tr><td><code>beta1</code></td>
<td>

<p>Initial value for <code class="reqn">\beta_1</code>, the coefficient for the non-terminal event model.
</p>
</td></tr>
<tr><td><code>beta2</code></td>
<td>

<p>Initial value for <code class="reqn">\beta_2</code>, the coefficient for the terminal event without non-terminal event model.
</p>
</td></tr>
<tr><td><code>beta3</code></td>
<td>

<p>Initial value for <code class="reqn">\beta_3</code>, the coefficient for the terminal event following non-terminal event model.
</p>
</td></tr>
<tr><td><code>lambda1</code></td>
<td>

<p>Initial value for <code class="reqn"> \lambda_{01} </code>, the estimated baseline hazard for the non-terminal event model.
</p>
</td></tr>
<tr><td><code>lambda2</code></td>
<td>

<p>Initial value for <code class="reqn"> \lambda_{02} </code>, the estimated baseline hazard for the terminal event without non-terminal event model.
</p>
</td></tr>
<tr><td><code>lambda3</code></td>
<td>

<p>Initial value for <code class="reqn"> \lambda_{03} </code>, the estimated baseline hazard for the terminal event following non-terminal event model.
</p>
</td></tr>
<tr><td><code>Lambda1</code></td>
<td>

<p>Initial value for <code class="reqn"> \Lambda_{01} </code>, the estimated cumulative baseline hazard for the non-terminal event model.
</p>
</td></tr>
<tr><td><code>Lambda2</code></td>
<td>

<p>Initial value for <code class="reqn"> \Lambda_{02} </code>, the estimated cumulative baseline hazard for the terminal event without non-terminal event model.
</p>
</td></tr>
<tr><td><code>Lambda3</code></td>
<td>

<p>Initial value for <code class="reqn"> \Lambda_{03} </code>, the estimated cumulative baseline hazard for the terminal event following non-terminal event model.
</p>
</td></tr>
<tr><td><code>event1</code></td>
<td>

<p>An object of class <code>Surv</code> for non-terminal event.
</p>
</td></tr>
<tr><td><code>event2</code></td>
<td>

<p>An object of class <code>Surv</code> for terminal event without non-terminal event.
</p>
</td></tr>
<tr><td><code>event3</code></td>
<td>

<p>An object of class <code>Surv</code> for terminal event following non-terminal event.
</p>
</td></tr>
</table>


<h3>See Also</h3>

 <p><code>usual_illness_death_weight</code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>n &lt;- 500
set.seed(1234)
Cens = runif(n,0.7,0.9)
set.seed(1234)
OUT1 &lt;- sim_cox_msm_semicmrsk(beta1 = 1,beta2 = 1,beta3 = 0.5,
                              sigma_2 = 1,
                              alpha0 = 0.5, alpha1 = 0.1, alpha2 = -0.1, alpha3 = -0.2,
                              n=n, Cens = Cens)
data_test &lt;- OUT1$data0

## Get the PS weights
vars &lt;- c("Z1","Z2","Z3")
ps1 &lt;- doPS(data = data_test,
            Trt = "A",
            Trt.name = 1,
            VARS. = vars,
            logistic = TRUE,w= NULL)
w &lt;- ps1$Data$ipw_ate_stab

### Get the initial value
EM_initial &lt;- OUT_em_weights(data = data_test,
                             X1 = "X1",
                             X2 = "X2",
                             event1 = "delta1",
                             event2 = "delta2",
                             w = w,
                             Trt = "A")
</code></pre>

<hr>
<h2 id='plot.PS'>
Plotting Histogram of Propensity Score and Balancing Plot for Covariates in the Propensity Score Model
</h2><span id='topic+plot.PS'></span>

<h3>Description</h3>

<p>Displays a the histogram plots for the propensity score, stratified by treated and control group and a graph of standardized mean difference of potential confounders before and after weigthing.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'PS'
plot(x,...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.PS_+3A_x">x</code></td>
<td>
<p>The results of <code>doPS</code> function.</p>
</td></tr>
<tr><td><code id="plot.PS_+3A_...">...</code></td>
<td>
<p>the other arguments you want to put in the built-in plot function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Only available when logistic = FALSE in doPS. The standardized mean difference (SMD), defined as the (weighted) treatment group mean minus the (weighted) control group mean divided by the (weighted) pooled sample (treatment and control) standard deviation. SMD between -0.1 and 0.1 typically indicates good balance.
</p>


<h3>Value</h3>

<p>Histogram of propensity score and balancing plot for covariates in the propensity score model corresponding to the output from <code>doPS</code>.
</p>


<h3>See Also</h3>

 <p><code><a href="twang.html#topic+bal.table">bal.table</a></code> </p>

<hr>
<h2 id='sim_cox_msm_semicmrsk'>
Simulating Semi-competing Risks with Right-censored Survival Data under Marginal Structural Illness-death Cox Model
</h2><span id='topic+sim_cox_msm_semicmrsk'></span>

<h3>Description</h3>

<p>The function to simulate semi-competing risk with right-censored survival data under marginal structural illness-death Cox model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim_cox_msm_semicmrsk(beta1,beta2,beta3,sigma_2,
        alpha0,alpha1,alpha2,alpha3,
        n,Cens)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sim_cox_msm_semicmrsk_+3A_beta1">beta1</code></td>
<td>

<p>True value of <code class="reqn">\beta_1</code>  in the illness-death model.
</p>
</td></tr>
<tr><td><code id="sim_cox_msm_semicmrsk_+3A_beta2">beta2</code></td>
<td>

<p>True value of <code class="reqn">\beta_2</code>  in the illness-death model.
</p>
</td></tr>
<tr><td><code id="sim_cox_msm_semicmrsk_+3A_beta3">beta3</code></td>
<td>

<p>True value of <code class="reqn">\beta_3</code> in the illness-death model.
</p>
</td></tr>
<tr><td><code id="sim_cox_msm_semicmrsk_+3A_sigma_2">sigma_2</code></td>
<td>

<p>True value of variance of normal frailty <code class="reqn">\sigma^2</code> in the illness-death model, if <code class="reqn">\sigma^2</code> = 0, then there is no frailty term.
</p>
</td></tr>
<tr><td><code id="sim_cox_msm_semicmrsk_+3A_alpha0">alpha0</code></td>
<td>

<p>True value of <code class="reqn">\alpha_0</code>  in the propensity score model.
</p>
</td></tr>
<tr><td><code id="sim_cox_msm_semicmrsk_+3A_alpha1">alpha1</code></td>
<td>

<p>True value of <code class="reqn">\alpha_1</code>  in the propensity score model.
</p>
</td></tr>
<tr><td><code id="sim_cox_msm_semicmrsk_+3A_alpha2">alpha2</code></td>
<td>

<p>True value of <code class="reqn">\alpha_2</code>  in the propensity score model.
</p>
</td></tr>
<tr><td><code id="sim_cox_msm_semicmrsk_+3A_alpha3">alpha3</code></td>
<td>

<p>True value of <code class="reqn">\alpha_3</code>  in the propensity score model.
</p>
</td></tr>
<tr><td><code id="sim_cox_msm_semicmrsk_+3A_n">n</code></td>
<td>

<p>Sample size.
</p>
</td></tr>
<tr><td><code id="sim_cox_msm_semicmrsk_+3A_cens">Cens</code></td>
<td>

<p>Censoring distribution.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We simulate data followed by Xu(2010) to generate semi-competing risk data under illness-death model, where we have baseline hazard <code class="reqn">\lambda_{01}(t) = \lambda_{02}(t) = 2exp(-t)I(0 \le t \le 3) + 2exp(-3)I(t \ge 3)</code>, and <code class="reqn">\lambda_{03}(t) = 2\lambda_{01}(t)</code>.
</p>
<p>We also have the propensity score model to generate treatment assignment <code class="reqn">P_A = logit^{-1}(\alpha_0 + \alpha_1 Z_1 + \alpha_2 Z_2 + \alpha_3 Z3)</code>.
</p>


<h3>Value</h3>

<p>Returns a data frame that contains time to non-terminal event, T1, terminal event, T2 and censoring time C with their event indicator, delta1 and delta2. Three covariates Z1, Z2, Z3, and treatment assignment A are also included.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>n &lt;- 500
set.seed(1234)
Cens = runif(n,0.7,0.9)
set.seed(1234)
OUT1 &lt;- sim_cox_msm_semicmrsk(beta1 = 1,beta2 = 1,beta3 = 0.5,
                              sigma_2 = 1,
                              alpha0 = 0.5, alpha1 = 0.1, alpha2 = -0.1, alpha3 = -0.2,
                              n=n, Cens = Cens)
data_test &lt;- OUT1$data0
</code></pre>

<hr>
<h2 id='usual_illness_death_weight'>
Fit MSM Illness-death Usual Markov Model For Semi-competing Risks Data
</h2><span id='topic+usual_illness_death_weight'></span>

<h3>Description</h3>

<p>Fit the marginal structural three-state illness-death model with Cox representation and IP weights for semi-competing risks data. Inference under this model can be carried out using estimating equations with IP weights.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>usual_illness_death_weight(data,X1,X2,event1,event2,w,Trt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="usual_illness_death_weight_+3A_data">data</code></td>
<td>

<p>The dataset, includes non-terminal events, terminal events as well as event indicator.
</p>
</td></tr>
<tr><td><code id="usual_illness_death_weight_+3A_x1">X1</code></td>
<td>

<p>Time to non-terminal event, could be censored by terminal event or lost to follow up.
</p>
</td></tr>
<tr><td><code id="usual_illness_death_weight_+3A_x2">X2</code></td>
<td>

<p>Time to terminal event, could be censored by lost to follow up.
</p>
</td></tr>
<tr><td><code id="usual_illness_death_weight_+3A_event1">event1</code></td>
<td>

<p>Event indicator for non-terminal event.
</p>
</td></tr>
<tr><td><code id="usual_illness_death_weight_+3A_event2">event2</code></td>
<td>

<p>Event indicator for terminal event.
</p>
</td></tr>
<tr><td><code id="usual_illness_death_weight_+3A_w">w</code></td>
<td>

<p>IP weights.
</p>
</td></tr>
<tr><td><code id="usual_illness_death_weight_+3A_trt">Trt</code></td>
<td>

<p>Treatment variable.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let <code class="reqn">T_1</code>, <code class="reqn">T_2</code> be the time to non-terminal event and terminal event, A be the treatment assignment. We postulate the semi-parametric Cox models for three transition rates in marginal structural illness-death model:
</p>
<p style="text-align: center;"><code class="reqn">
    \lambda_{1}(t_1 ; a) = \lambda_{01}(t)e^{\beta_1 a}, t_1 &gt; 0 ;
</code>
</p>

<p style="text-align: center;"><code class="reqn">
    \lambda_{2}(t_2 ; a) = \lambda_{02}(t)e^{\beta_2 a}, t_2 &gt; 0 ;
</code>
</p>

<p>and
</p>
<p style="text-align: center;"><code class="reqn">
    \lambda_{12}(t_2 \mid t_1 ; a) = \lambda_{03}(t_2)e^{\beta_3 a}, 0 &lt; t_1 &lt;  t_2 .
</code>
</p>

<p>The coefficients as well as Breslow type baseline hazards can be estimated by fitting the IP weights Cox proportional hazards models. Meanwhile, if we assume the estimated weights as known, then the robust sandwich variance estimator can be used to obtain the estimated variance.
</p>
<p>The usual Markov model is also the same as the initial value for the general Markov model.
</p>


<h3>Value</h3>

<p>A list of values and dataframes:
</p>
<table role = "presentation">
<tr><td><code>beta1</code></td>
<td>

<p>Estimated <code class="reqn">\beta_1</code>, the coefficient for the non-terminal event model.
</p>
</td></tr>
<tr><td><code>beta2</code></td>
<td>

<p>Estimated <code class="reqn">\beta_2</code>, the coefficient for the terminal event without non-terminal event model.
</p>
</td></tr>
<tr><td><code>beta3</code></td>
<td>

<p>Estimated <code class="reqn">\beta_3</code>, the coefficient for the terminal event following non-terminal event model.
</p>
</td></tr>
<tr><td><code>sd_beta1</code></td>
<td>

<p>Model based standard error for <code class="reqn">\beta_1</code>.
</p>
</td></tr>
<tr><td><code>sd_beta2</code></td>
<td>

<p>Model based standard error for  <code class="reqn">\beta_2</code>.
</p>
</td></tr>
<tr><td><code>sd_beta3</code></td>
<td>

<p>Model based standard error for  <code class="reqn">\beta_3</code>.
</p>
</td></tr>
<tr><td><code>Lambda01</code></td>
<td>

<p>See also <code>get_hazard</code>. List of two dataframes for estimated <code class="reqn"> \Lambda_{01} </code> and <code class="reqn"> \lambda_{01} </code>, the estimated (cumulative) baseline hazard for the non-terminal event model.
</p>
</td></tr>
<tr><td><code>Lambda02</code></td>
<td>

<p>List of two dataframes for estimated <code class="reqn"> \Lambda_{02} </code> and <code class="reqn"> \lambda_{02} </code>, the estimated (cumulative) baseline hazard for the terminal event without non-terminal event model.
</p>
</td></tr>
<tr><td><code>Lambda03</code></td>
<td>

<p>List of two dataframes for estimated <code class="reqn"> \Lambda_{03} </code> and <code class="reqn"> \lambda_{03} </code>, the estimated (cumulative) baseline hazard for the terminal event following non-terminal event model.
</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>n &lt;- 500
set.seed(1234)
Cens = runif(n,0.7,0.9)
set.seed(1234)
OUT1 &lt;- sim_cox_msm_semicmrsk(beta1 = 1,beta2 = 1,beta3 = 0.5,
                              sigma_2 = 1,
                              alpha0 = 0.5, alpha1 = 0.1, alpha2 = -0.1, alpha3 = -0.2,
                              n=n, Cens = Cens)
data_test &lt;- OUT1$data0

## Get the PS weights
vars &lt;- c("Z1","Z2","Z3")
ps1 &lt;- doPS(data = data_test,
            Trt = "A",
            Trt.name = 1,
            VARS. = vars,
            logistic = TRUE,w=NULL)
w &lt;- ps1$Data$ipw_ate_stab

### Fit the Usual Markov model
res1 &lt;- usual_illness_death_weight(data = data_test,
                                   X1 = "X1",
                                   X2 = "X2",
                                   event1 = "delta1",
                                   event2 = "delta2",
                                   w = w,
                                   Trt = "A")
print(paste("The estimated value for beta1 is:", round(res1$beta1,5) ) )

</code></pre>

<hr>
<h2 id='var_em_illness_death_phmm'>
Variance of parameters in MSM Illness-death General Markov Model
</h2><span id='topic+var_em_illness_death_phmm'></span>

<h3>Description</h3>

<p>Use bootstrap to obtain the variance estimator for parameters in MSM illness-death general markov model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>var_em_illness_death_phmm(data,sigma_2_0,VARS.)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="var_em_illness_death_phmm_+3A_data">data</code></td>
<td>

<p>The output dataset from <code>em_illness_death_phmm_weight</code>.
</p>
</td></tr>
<tr><td><code id="var_em_illness_death_phmm_+3A_sigma_2_0">sigma_2_0</code></td>
<td>

<p>Initial value for <code class="reqn">\sigma^2</code>, the variance of zero-mean normal frailty, usually starts with 1.
</p>
</td></tr>
<tr><td><code id="var_em_illness_death_phmm_+3A_vars.">VARS.</code></td>
<td>

<p>Confounder sets.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code>em_illness_death_phmm_weight</code>. In each bootstrap, the propensity score model needs to be re-fitted, and fit the MSM illness-death general markov model with new IP weights.
</p>


<h3>Value</h3>

<p>List of bootstrap SE for all the parameters in the general Markov model
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
