<!DOCTYPE html><html lang="en"><head><title>Help for package M3</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {M3}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#M3-package'><p>Functions to read in and manipulate air quality model output from</p>
files in Models3 format</a></li>
<li><a href='#combine.date.and.time'><p>Combine date and time to obtain date-time in POSIX format</p></a></li>
<li><a href='#decipher.M3.date'><p>Decipher Models3 date format (YYYYDDD) into R's Date class.</p></a></li>
<li><a href='#decipher.M3.time'><p>Decipher Models3 time format (HHMMSS) into hours, minutes,</p>
and seconds.</a></li>
<li><a href='#get.canusamex.bds'><p>Obtain map boundaries for Canada, USA, and Mexico</p></a></li>
<li><a href='#get.coord.for.dimension'><p>Get the grid coordinates for the grid rows or columns.</p></a></li>
<li><a href='#get.datetime.seq'><p>Read in a sequence of date-time steps from a</p>
Models3-formatted file.</a></li>
<li><a href='#get.grid.info.M3'><p>Get information about the grid used by the air quality model</p></a></li>
<li><a href='#get.M3.var'><p>Read in variable values from Models3-formatted files</p></a></li>
<li><a href='#get.map.lines.M3.proj'><p>Get map lines in the model projection units</p></a></li>
<li><a href='#get.matrix.all.grid.cell.ctrs'><p>Obtain a matrix giving the locations of the grid cell centers</p></a></li>
<li><a href='#get.proj.info.M3'><p>Obtain information about the projection used in the Models3 file</p></a></li>
<li><a href='#project.lonlat.to.M3'><p>Project coordinates from longitude/latitude to model units.</p></a></li>
<li><a href='#project.M3.1.to.M3.2'><p> Project coordinates based on projection in the first file to</p>
the projection given in the second</a></li>
<li><a href='#project.M3.to.lonlat'><p>Project coordinates from model units to longitude/latitude</p></a></li>
<li><a href='#var.subset'><p>Subset the array resulting from a call to <code>get.M3.var</code>.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Reading M3 Files</td>
</tr>
<tr>
<td>Version:</td>
<td>0.4</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-06-12</td>
</tr>
<tr>
<td>Author:</td>
<td>Jenise Swall &lt;jswall@vcu.edu&gt;</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jenise Swall &lt;jswall@vcu.edu&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10), ncdf4, sf, maps, mapdata</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides functions to read in and manipulate air quality model output from Models3-formatted files.  This format is used by the Community Multiscale Air Quality (CMAQ) model. </td>
</tr>
<tr>
<td>License:</td>
<td>Unlimited</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-06-13 15:29:00 UTC; jenise</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-06-14 10:00:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='M3-package'>Functions to read in and manipulate air quality model output from
files in Models3 format
</h2><span id='topic+M3-package'></span><span id='topic+M3'></span>

<h3>Description</h3>

<p>Provides functions to read in and manipulate
air quality model output from Models3-formatted files.  This format is
used by the Community Multiscale Air Quaility (CMAQ) model. 
</p>


<h3>Note</h3>

<p>The original version of this software program was reviewed in accordance with
U.S. Environmental Protection Agency policy and approved for publication. 
Subsequent releases have not been reviewed by U.S. EPA, since author is no
longer employed there.  Mention of trade names or commercial products does
not constitute endorsement or recommendation for use.
</p>


<h3>References</h3>

<p>For detailed information about the format and conventions of
the Models3 format, see <br />
<a href="https://www.cmascenter.org/ioapi/documentation/all_versions/html/AA.html">https://www.cmascenter.org/ioapi/documentation/all_versions/html/AA.html</a>.
</p>

<hr>
<h2 id='combine.date.and.time'>Combine date and time to obtain date-time in POSIX format
</h2><span id='topic+combine.date.and.time'></span>

<h3>Description</h3>

<p>Combine date and time to obtain date-time in POSIX format
</p>


<h3>Usage</h3>

<pre><code class='language-R'>combine.date.and.time(date, time)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="combine.date.and.time_+3A_date">date</code></td>
<td>
<p>Date in Date format or as character string in format
&ldquo;YYYY-MM-DD&rdquo;.
</p>
</td></tr>
<tr><td><code id="combine.date.and.time_+3A_time">time</code></td>
<td>
<p>Time as list with hours (<code>hrs</code>), minutes
(<code>mins</code>), and seconds (<code>secs</code>) components or as
character string in format HH:MM:SS (with hours ranging
from 00-23).
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A date-time in R's POSIX class.
</p>


<h3>Note</h3>

<p>This function is called by <code><a href="#topic+get.datetime.seq">get.datetime.seq</a></code>, <code><a href="#topic+get.M3.var">get.M3.var</a></code>, and <code><a href="#topic+var.subset">var.subset</a></code>, but it will probably not be called by most users.
</p>


<h3>Author(s)</h3>

<p>Jenise Swall</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+DateTimeClasses">DateTimeClasses</a></code>, <code><a href="base.html#topic+strptime">strptime</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## This function can accept dates as a character string:
combine.date.and.time(date="2011-05-03", time="16:15:30")

## Or, the dates can be in R's Date format.
combine.date.and.time(date=as.Date("2011-05-03"), time="16:15:30")

## The time can also be given as a list:
combine.date.and.time(date="2011-05-03", time=list(hrs=16, mins=15, secs=30))
</code></pre>

<hr>
<h2 id='decipher.M3.date'>Decipher Models3 date format (YYYYDDD) into R's Date class.
</h2><span id='topic+decipher.M3.date'></span>

<h3>Description</h3>

<p>Decipher Models3 date format (YYYYDDD) into R's Date class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>decipher.M3.date(M3.date)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="decipher.M3.date_+3A_m3.date">M3.date</code></td>
<td>
<p>Date (numeric) in the format YYYYDDD,
where DDD is a Julian day (since the beginning of year YYYY).  
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Date specified by YYYYDDD in R's Date class.
</p>


<h3>Note</h3>

<p>For more information about M3 date-time conventions,
see <br />
<a href="https://www.cmascenter.org/ioapi/documentation/all_versions/html/DATETIME.html">https://www.cmascenter.org/ioapi/documentation/all_versions/html/DATETIME.html</a>. <br />
This function is called by function <code><a href="#topic+get.datetime.seq">get.datetime.seq</a></code>,
but it will probably not be called by most users.
</p>


<h3>Author(s)</h3>

<p>Jenise Swall</p>


<h3>References</h3>

<p><a href="https://www.cmascenter.org/ioapi/documentation/all_versions/html/DATETIME.html">https://www.cmascenter.org/ioapi/documentation/all_versions/html/DATETIME.html</a>
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+DateTimeClasses">DateTimeClasses</a></code>, <br />
<code><a href="#topic+get.datetime.seq">get.datetime.seq</a></code>, <br />
<code><a href="#topic+decipher.M3.time">decipher.M3.time</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Returns 2011-03-10, which is the 69th day of 2011.
decipher.M3.date(2011069)  

## Returns 2012-02-29.  This leap day is the 60th day of 2012.
decipher.M3.date(2012060)  
</code></pre>

<hr>
<h2 id='decipher.M3.time'>Decipher Models3 time format (HHMMSS) into hours, minutes,
and seconds.
</h2><span id='topic+decipher.M3.time'></span>

<h3>Description</h3>

<p>Decipher Models3 time format (HHMMSS) into hours, minutes,
and seconds.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>decipher.M3.time(M3.time)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="decipher.M3.time_+3A_m3.time">M3.time</code></td>
<td>
<p>Time (numeric) in the format HHMMSS (hours, minutes, seconds).
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with the following components
</p>
<table role = "presentation">
<tr><td><code>hrs</code></td>
<td>
<p>hours</p>
</td></tr>
<tr><td><code>mins</code></td>
<td>
<p>minutes</p>
</td></tr>
<tr><td><code>secs</code></td>
<td>
<p>seconds</p>
</td></tr>
</table>


<h3>Note</h3>

<p>For more information about Models3 date-time conventions,
see <br />
<a href="https://www.cmascenter.org/ioapi/documentation/all_versions/html/DATETIME.html">https://www.cmascenter.org/ioapi/documentation/all_versions/html/DATETIME.html</a>. <br />
This function is called by function <code><a href="#topic+get.datetime.seq">get.datetime.seq</a></code>,
but it will probably not be called by most users.
</p>


<h3>Author(s)</h3>

<p>Jenise Swall</p>


<h3>References</h3>

<p><a href="https://www.cmascenter.org/ioapi/documentation/all_versions/html/DATETIME.html">https://www.cmascenter.org/ioapi/documentation/all_versions/html/DATETIME.html</a>
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+DateTimeClasses">DateTimeClasses</a></code>, <br />
<code><a href="#topic+get.datetime.seq">get.datetime.seq</a></code>, <br />
<code><a href="#topic+decipher.M3.date">decipher.M3.date</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Note that the function breaks up the (numeric) input,
## where hours are designated by 00-23, minutes by 00-59, 
## seconds by 00-59.  
decipher.M3.time(030105)
</code></pre>

<hr>
<h2 id='get.canusamex.bds'>Obtain map boundaries for Canada, USA, and Mexico</h2><span id='topic+get.canusamex.bds'></span>

<h3>Description</h3>

<p>Obtain map boundaries of Canada, USA, and Mexico, including
state boundaries, in longitude and latitude coordinates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.canusamex.bds()
</code></pre>


<h3>Details</h3>

<p>Retrieves a data frame containing the coordinates (longitude and
latitude) for drawing the boundaries of Canada, USA (including states), and
Mexico.  This function is intended to be called by the function
<code><a href="#topic+get.map.lines.M3.proj">get.map.lines.M3.proj</a></code>; in practice, it should rarely be called
directly by the user.
</p>


<h3>Value</h3>

<p>Data frame specifying the polylines needed to plot the national
(Canada, USA, Mexico) and state outlines. This matrix has two columns,
with longitude in the first column and latitude in the second.  </p>


<h3>Author(s)</h3>

<p>Jenise Swall</p>


<h3>See Also</h3>

<p><code><a href="maps.html#topic+map">map</a></code>, <code><a href="#topic+get.map.lines.M3.proj">get.map.lines.M3.proj</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Set up a plotting region (in longitude/latitude) that includes an
## eastern portion of the Canada/USA border.
plot(c(-82,-67), c(39,49), type="n", xlab="Longitude", ylab="Latitude")
## Superimpose national boundaries from "world" database, which is
## fairly low-resolution (since it includes worldwide national boundaries).
map("world", regions="canada", add=TRUE)
## Now, if we try to superimpose the the USA state boundaries from the
## higher resolution "state" database, we have a conflict.  (See
## particularly the Maine border.)
map("state", add=TRUE, col="blue")
## The high-resolution national boundaries in database "worldHires" (in
## mapdata) also don't match up with the state lines.
map("worldHires", add=TRUE, col="magenta")

## Instead, we get the national boundaries (Canada, USA, Mexico) at
## high-resolution from database "worldHires" and the state boundaries
## (without the coastlines and national boundaries) from the "state"
## database.
dev.new()
plot(c(-82,-67), c(39,49), type="n", xlab="Longitude", ylab="Latitude")
lines(get.canusamex.bds())
</code></pre>

<hr>
<h2 id='get.coord.for.dimension'>Get the grid coordinates for the grid rows or columns.</h2><span id='topic+get.coord.for.dimension'></span>

<h3>Description</h3>

<p>For either the rows or the columns, return the coordinates
of the centers or the edges of the grid cells.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.coord.for.dimension(file, dimension, position = "ctr", units)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get.coord.for.dimension_+3A_file">file</code></td>
<td>
<p>Name of Models3-formatted file of interest.
</p>
</td></tr>
<tr><td><code id="get.coord.for.dimension_+3A_dimension">dimension</code></td>
<td>
<p>If &ldquo;column&rdquo;/&ldquo;col&rdquo;, will obtain
coordinates for columns; if &ldquo;row&rdquo; will obtain coordinates
for rows.
</p>
</td></tr>
<tr><td><code id="get.coord.for.dimension_+3A_position">position</code></td>
<td>
<p>Choose whether to obtain coordinates of cell edges or
centers for either grid rows or columns.  If &ldquo;ctr&rdquo; (default),
get the cell center.  If &ldquo;lower&rdquo;, get bottom or left cell
edge.  If &ldquo;upper&rdquo;, get top or right cell edge.
</p>
</td></tr>
<tr><td><code id="get.coord.for.dimension_+3A_units">units</code></td>
<td>
<p>Units for coordinates of grid rows or columns.  Must be
one of &ldquo;m&rdquo;, &ldquo;km&rdquo;, or &ldquo;deg&rdquo;.  If
unspecified, the default is &ldquo;deg&rdquo; if the file has a
longitude/latitude grid, and &ldquo;km&rdquo; otherwise.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing two elements, <code>coords</code> and
<code>units</code>.  If <code>dimension</code> is &ldquo;row&rdquo;, return as element
<code>coords</code> a vector containing the y-coordinates of the centers
(&ldquo;ctr&rdquo;), left (&ldquo;lower&rdquo;), or right (&ldquo;upper&rdquo;) edges
of each row, depending on the value of argument <code>position</code>.  If
<code>dimension</code> is &ldquo;column&rdquo; or &ldquo;col&rdquo;, return as element
<code>coords</code> a vector containing the x-coordinates of the centers
(&ldquo;ctr&rdquo;), left (&ldquo;lower&rdquo;), or right (&ldquo;upper&rdquo;) edges
of each row, depending on the value of argument <code>position</code>.  In
both cases, return as element <code>units</code> the units of the
coordinates (can be &ldquo;km&rdquo;, &ldquo;m&rdquo;, or &ldquo;deg&rdquo;).
</p>


<h3>Note</h3>

<p>Usually, the user will not call this function directly; instead,
it will be called by other functions such as
<code><a href="#topic+get.matrix.all.grid.cell.ctrs">get.matrix.all.grid.cell.ctrs</a></code> and
<code><a href="#topic+get.M3.var">get.M3.var</a></code>.
</p>


<h3>Author(s)</h3>

<p>Jenise Swall</p>


<h3>See Also</h3>

<p><code><a href="#topic+get.matrix.all.grid.cell.ctrs">get.matrix.all.grid.cell.ctrs</a></code>, <code><a href="#topic+get.M3.var">get.M3.var</a></code>, <code><a href="#topic+get.grid.info.M3">get.grid.info.M3</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## As mentioned in notes above, user will not typically call
## this function directly.

## Find the path to a demo file with lambert conic conformal projection.
lcc.file &lt;- system.file("extdata/ozone_lcc.ncf", package="M3")

## Get a list of the x-coordinates of the centers of the cells.
x.ctrs &lt;- get.coord.for.dimension(lcc.file, dimension="col", units="km")
</code></pre>

<hr>
<h2 id='get.datetime.seq'>Read in a sequence of date-time steps from a
Models3-formatted file.
</h2><span id='topic+get.datetime.seq'></span>

<h3>Description</h3>

<p>Read the date-time steps in the Models3-formatted file.
Put these into R's datetime format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.datetime.seq(file)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get.datetime.seq_+3A_file">file</code></td>
<td>
<p>File name of Models3-formatted file which contains
the date-time information of interest.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function relies on the R package <span class="pkg">ncdf4</span> to read
information from Models3-formatted files, since the Models3 format
is built on netCDF <br />
(<a href="https://www.unidata.ucar.edu/software/netcdf/">https://www.unidata.ucar.edu/software/netcdf/</a>).
</p>


<h3>Value</h3>

<p>Vector of sequence of datetimes included in the Models3-formatted
file, in <code><a href="base.html#topic+DateTimeClasses">POSIXct</a></code> format.
</p>


<h3>Warning</h3>

<p>This code assumes that the time step is not negative.  For
instance, the Models3 I/OAPI does allow for negative time steps,
but these negative time steps will NOT be handled properly by this
function.  For more information about Models3 date-time
conventions, see <br />
<a href="https://www.cmascenter.org/ioapi/documentation/all_versions/html/DATETIME.html">https://www.cmascenter.org/ioapi/documentation/all_versions/html/DATETIME.html</a>.
</p>


<h3>Note</h3>

<p> This function is called by function <code><a href="#topic+get.M3.var">get.M3.var</a></code>,
but it will probably not be called by most users.
</p>


<h3>Author(s)</h3>

<p>Jenise Swall</p>


<h3>References</h3>

<p>Information about the Models3 date-time conventions is
available at <br />
<a href="https://www.cmascenter.org/ioapi/documentation/all_versions/html/DATETIME.html">https://www.cmascenter.org/ioapi/documentation/all_versions/html/DATETIME.html</a>.
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+DateTimeClasses">DateTimeClasses</a></code>, <code><a href="base.html#topic+seq.POSIXt">seq.POSIXt</a></code>, <code><a href="#topic+get.M3.var">get.M3.var</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## As mentioned in notes above, user will not typically call
## this function directly.

## Find the path to a demo file with lambert conic conformal projection.
lcc.file &lt;- system.file("extdata/ozone_lcc.ncf", package="M3")

## Get vector containing date-times available in this file.
datetime.seq &lt;- get.datetime.seq(lcc.file)
</code></pre>

<hr>
<h2 id='get.grid.info.M3'>Get information about the grid used by the air quality model</h2><span id='topic+get.grid.info.M3'></span>

<h3>Description</h3>

<p>Pull information about the grid used from the
Models3-formatted file.  This includes information such as the origin
of the grid (lower left corner coordinates in grid units), cell
spacing, etc.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.grid.info.M3(file)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get.grid.info.M3_+3A_file">file</code></td>
<td>
<p>File name of Models3-formatted file which contains
information about the projection.  Currently, this function can only
handle files with Lambert conic conformal, polar stereographic, and
longitude/latitude projections.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function assumes that the projection is either Lambert
conic conformal or polar stereographic projection.  Information about
grid cell size, extent of grid, etc. is stored in the global
attributes of the Models3-formatted file, which this function reads.
</p>


<h3>Value</h3>

<p>List with the following components:
</p>
<table role = "presentation">
<tr><td><code>x.orig</code></td>
<td>
<p>X-coordinate of the origin point of the grid (lower
left corner, coordinates in model projection units)</p>
</td></tr>
<tr><td><code>y.orig</code></td>
<td>
<p>Y-coordinate of the origin point of the grid (lower
left corner, coordinates in model projection units)</p>
</td></tr>
<tr><td><code>x.cell.width</code></td>
<td>
<p>Width of grid cells in x-direction (in model
projection units)</p>
</td></tr>
<tr><td><code>y.cell.width</code></td>
<td>
<p>Width of grid cells in y-direction (in model
projection units)</p>
</td></tr>
<tr><td><code>hz.units</code></td>
<td>
<p>Units of the projection (&ldquo;m&rdquo;, &ldquo;km&rdquo;,
or &ldquo;deg&rdquo;)</p>
</td></tr>
<tr><td><code>ncols</code></td>
<td>
<p>Number of columns of grid cells</p>
</td></tr>
<tr><td><code>nrows</code></td>
<td>
<p>Number of rows of grid cells</p>
</td></tr>
<tr><td><code>nlays</code></td>
<td>
<p>Number of vertical layers</p>
</td></tr>
</table>


<h3>Warning</h3>

<p>Currently, this function can only handle files with
Lambert conic conformal, polar stereographic, and longitude/latitude
projections.
</p>


<h3>Note</h3>

<p>This function relies on the R package <span class="pkg">ncdf4</span> to read
information from Models3-formatted files, since the Models3 format
is built on netCDF <br />
(<a href="https://www.unidata.ucar.edu/software/netcdf/">https://www.unidata.ucar.edu/software/netcdf/</a>). <br />
Usually, the user will not call this function directly; instead, it
will be called by the function <code><a href="#topic+get.coord.for.dimension">get.coord.for.dimension</a></code>.
</p>


<h3>Author(s)</h3>

<p>Jenise Swall</p>


<h3>See Also</h3>

<p><code><a href="#topic+get.proj.info.M3">get.proj.info.M3</a></code>, <code><a href="#topic+get.coord.for.dimension">get.coord.for.dimension</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## As mentioned in notes above, user will not typically call
## this function directly.

## Find the path to a demo file with lambert conic conformal projection.
lcc.file &lt;- system.file("extdata/ozone_lcc.ncf", package="M3")
## Get a list containing information about the grid in this file.
grid.info &lt;- get.grid.info.M3(lcc.file)


## Find the path to a demo file with polar stereographic projection.
polar.file &lt;- system.file("extdata/surfinfo_polar.ncf", package="M3")
## Get a list containing information about the grid in this file.
grid.info &lt;- get.grid.info.M3(polar.file)
</code></pre>

<hr>
<h2 id='get.M3.var'>Read in variable values from Models3-formatted files
</h2><span id='topic+get.M3.var'></span>

<h3>Description</h3>

<p>Read in variable values from Models3-formatted files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.M3.var(file, var, lcol, ucol, lrow, urow, llay, ulay,
                ldatetime, udatetime, hz.units)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get.M3.var_+3A_file">file</code></td>
<td>
<p>Name of Models3-formatted file to be read.
</p>
</td></tr>
<tr><td><code id="get.M3.var_+3A_var">var</code></td>
<td>
<p>Name (character string) or number (positive integer) of
variable whose values are to be read.
</p>
</td></tr>
<tr><td><code id="get.M3.var_+3A_lcol">lcol</code></td>
<td>
<p>Lower column bound (positive integer) to be read.  The
default is to read all columns.
</p>
</td></tr>
<tr><td><code id="get.M3.var_+3A_ucol">ucol</code></td>
<td>
<p>Upper column bound (positive integer) to be read.  The
default is to read all columns.
</p>
</td></tr>
<tr><td><code id="get.M3.var_+3A_lrow">lrow</code></td>
<td>
<p>Lower row bound (positive integer) to be read.  The
default is to read all rows.
</p>
</td></tr>
<tr><td><code id="get.M3.var_+3A_urow">urow</code></td>
<td>
<p>Upper row bound (positive integer) to be read.  The
default is to read all rows.
</p>
</td></tr>
<tr><td><code id="get.M3.var_+3A_llay">llay</code></td>
<td>
<p>Lower layer bound (positive integer) to be read.  The
default is to read the first layer only.
</p>
</td></tr>
<tr><td><code id="get.M3.var_+3A_ulay">ulay</code></td>
<td>
<p>Upper layer bound (positive integer) to be read.  The
default is to read the first layer only.
</p>
</td></tr>
<tr><td><code id="get.M3.var_+3A_ldatetime">ldatetime</code></td>
<td>
<p>Starting date-time (Date or POSIX class) in GMT.
</p>
</td></tr>
<tr><td><code id="get.M3.var_+3A_udatetime">udatetime</code></td>
<td>
<p>Starting date-time (Date or POSIX class) in GMT.
</p>
</td></tr>
</table>
<p>The default is to read all date-times.  If the file is
time-independent, the one available time step will be read and user
input for ldatetime and udatetime will be disregarded.
</p>
<table role = "presentation">
<tr><td><code id="get.M3.var_+3A_hz.units">hz.units</code></td>
<td>
<p>Units associated with grid cell horizontal
dimensions.  Default is degrees (&quot;deg&quot;) if the data is indexed
according to longitude/latitude and kilometers (&quot;km&quot;) otherwise.
If the file is not indexed according to longitude/latitude, the
user could choose meters (&quot;m&quot;).
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function assumes that the projection is either Lambert
conic conformal or polar stereographic projection.  It also assumes
that the Models3-formatted file is either time-independent or
time-stepped; it cannot be of type circular-buffer.
</p>


<h3>Value</h3>

<p>List with the following components:
</p>
<table role = "presentation">
<tr><td><code>data</code></td>
<td>
<p>Array holding the specified variable values.  Array is
four-dimensional, unless the Models3-formatted file is
time-independent (which we assume if TSTEP attribute is 0), in which
case it is three-dimensional.  Dimensions are columns, rows, layers,
date-time steps.
</p>
</td></tr>
<tr><td><code>data.units</code></td>
<td>
<p>Contains the units associated with <code>data</code>.
</p>
</td></tr>
<tr><td><code>x.cell.ctr</code></td>
<td>
<p>X-coordinates of grid cell centers, in units given
by <code>hz.units</code>.
</p>
</td></tr>
<tr><td><code>y.cell.ctr</code></td>
<td>
<p>Y-coordinates of grid cell centers, in units given
by <code>hz.units</code>.
</p>
</td></tr>
<tr><td><code>hz.units</code></td>
<td>
<p>Contains the units associated with the horizontal
dimensions of the grid cells (km, m, or deg).  These are the units
in which <code>x.cell.ctr</code> and <code>y.cell.ctr</code> are given.
</p>
</td></tr>
<tr><td><code>rows</code></td>
<td>
<p>Row numbers extracted.
</p>
</td></tr>
<tr><td><code>cols</code></td>
<td>
<p>Column numbers extracted.
</p>
</td></tr>
<tr><td><code>layers</code></td>
<td>
<p>Layer numbers extracted.
</p>
</td></tr>
<tr><td><code>datetime</code></td>
<td>
<p>Date-time steps (in POSIX format) associated with the
variable, if the file is not time-independent.  For time-independent
files, element datetime is set to NULL.
</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This function relies on the R package <span class="pkg">ncdf4</span> to read
information from Models3-formatted files, since the Models3 format
is built on netCDF <br />
(<a href="https://www.unidata.ucar.edu/software/netcdf/">https://www.unidata.ucar.edu/software/netcdf/</a>).
</p>


<h3>Author(s)</h3>

<p>Jenise Swall</p>


<h3>References</h3>

<p><a href="https://www.cmascenter.org/ioapi/documentation/all_versions/html/VBLE.html">https://www.cmascenter.org/ioapi/documentation/all_versions/html/VBLE.html</a>, <br />
<a href="https://www.cmascenter.org/ioapi/documentation/all_versions/html/DATETIME.html">https://www.cmascenter.org/ioapi/documentation/all_versions/html/DATETIME.html</a>
</p>


<h3>See Also</h3>

<p><code><a href="ncdf4.html#topic+ncvar_get">ncvar_get</a></code>, <code><a href="ncdf4.html#topic+ncatt_get">ncatt_get</a></code>, <code><a href="#topic+get.coord.for.dimension">get.coord.for.dimension</a></code>, <br />
<code><a href="#topic+get.datetime.seq">get.datetime.seq</a></code>, <code><a href="#topic+combine.date.and.time">combine.date.and.time</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Find the path to the first demo file (with polar
## stereographic projection).
polar.file &lt;- system.file("extdata/surfinfo_polar.ncf", package="M3")

## Read in the terrain elevation variable.
elev &lt;- get.M3.var(file=polar.file, var="HT")
## Make a plot.
image(elev$x.cell.ctr, elev$y.cell.ctr, elev$data[,,1],
      xlab="Projection x-coord (km)", ylab="Projection y-coord (km)",
      zlim=range(elev$data[,,1]), col=topo.colors(20))
## Find national boundaries on this projection, superimpose them on
## the plot.
world.bds &lt;- get.map.lines.M3.proj(file=polar.file, database="world")$coords
lines(world.bds)

## Subset to a smaller geographic area in southwestern U.S.
subset.elev &lt;- var.subset(elev, llx=-2100, urx=0, lly=-6500, ury=-4000)
## Make a plot of this subset.
image(subset.elev$x.cell.ctr, subset.elev$y.cell.ctr,
      subset.elev$data[,,1], xlab="Projection x-coord (km)",
      ylab="Projection y-coord (km)", zlim=range(subset.elev$data[,,1]),
      col=topo.colors(20))
## Find state boundaries on this projection, superimpose them on the plot.
state.bds &lt;- get.map.lines.M3.proj(file=polar.file)$coords
lines(state.bds)



## Find the path to second demo file (with Lambert conic
## conformal projection).
lcc.file &lt;- system.file("extdata/ozone_lcc.ncf", package="M3")

## Read in the ozone for July 4 for eastern U.S.
oz &lt;- get.M3.var(file=lcc.file, var="O3", lcol=80, urow=95,
                      ldatetime=as.Date("2001-07-04"),
                      udatetime=as.Date("2001-07-04"))
## Make a plot.
image(oz$x.cell.ctr, oz$y.cell.ctr, oz$data[,,1,1],
      xlab="Projection x-coord (km)", ylab="Projection y-coord (km)",
      zlim=range(oz$data), col=heat.colors(15))

## Find map lines on this projection, superimpose them on the plot.
state.bds &lt;- get.map.lines.M3.proj(file=lcc.file)$coords
lines(state.bds)
</code></pre>

<hr>
<h2 id='get.map.lines.M3.proj'>Get map lines in the model projection units</h2><span id='topic+get.map.lines.M3.proj'></span>

<h3>Description</h3>

<p>Get map lines in the model projection units.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.map.lines.M3.proj(file, database = "state", units, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get.map.lines.M3.proj_+3A_file">file</code></td>
<td>
<p>File name of Models3-formatted file providing the model
projection.
</p>
</td></tr>
<tr><td><code id="get.map.lines.M3.proj_+3A_database">database</code></td>
<td>
<p>Geographical database to use.  Choices include
&ldquo;state&rdquo; (default), &ldquo;world&rdquo;, &ldquo;worldHires&rdquo;,
&ldquo;canusamex&rdquo;, etc.  Use &ldquo;canusamex&rdquo; to get the national
boundaries of the Canada, the USA, and Mexico, along with the
boundaries of the states.  The other choices (&ldquo;state&rdquo;,
&ldquo;world&rdquo;, etc.) are the names of databases included with the
<span class="pkg">maps</span> and <span class="pkg">mapdata</span> packages. (See the
<code><a href="maps.html#topic+map">map</a></code> function.)  Default is &ldquo;state&rdquo;.
</p>
</td></tr>
<tr><td><code id="get.map.lines.M3.proj_+3A_units">units</code></td>
<td>
<p>Units for coordinates of grid rows or columns.  Must be
one of &ldquo;m&rdquo;, &ldquo;km&rdquo;, or &ldquo;deg&rdquo;.  If
unspecified, the default is &ldquo;deg&rdquo; if the file has a
longitude/latitude grid, and &ldquo;km&rdquo; otherwise.
</p>
</td></tr>
<tr><td><code id="get.map.lines.M3.proj_+3A_...">...</code></td>
<td>
<p>Other arguments to pass to <code>get.proj.info.M3</code>
function.  In this case, the only relevant argument would be the
earth radius to use for the projection in <code>file</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function depends on the <span class="pkg">maps</span> and <span class="pkg">mapdata</span>
packages to get the appropriate map boundary lines (for states,
countries, etc.), <span class="pkg">ncdf4</span> to read the projection information from
the Models3-formatted file (using a call to function
<code>get.proj.info.M3</code>), and <span class="pkg">sf</span> to project the boundary lines to the
specified projection.
</p>


<h3>Value</h3>

<p>Map lines for the projection described in <code>file</code> in either
kilometers or meters (depending on value of units.km).  This is a
matrix, with x-coordinates in the first column and y-coordinates in
the second column.
</p>


<h3>Warning</h3>

<p>This function will only work with Lambert conic
conformal or polar stereographic projections.
</p>


<h3>Author(s)</h3>

<p>Jenise Swall</p>


<h3>See Also</h3>

<p><code><a href="#topic+get.proj.info.M3">get.proj.info.M3</a></code>, <code><a href="maps.html#topic+map">map</a></code>,
<code><a href="sf.html#topic+sf_project">sf_project</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Find the path to the demo file.
polar.file &lt;- system.file("extdata/surfinfo_polar.ncf", package="M3")

## Read in the terrain elevation variable.
elev &lt;- get.M3.var(file=polar.file, var="HT")
## Make a plot.
image(elev$x.cell.ctr, elev$y.cell.ctr, elev$data[,,1],
      xlab="Projection x-coord (km)", ylab="Projection y-coord (km)",
      zlim=range(elev$data[,,1]), col=heat.colors(15))

## Superimpose national boundaries on the plot
nat.bds &lt;- get.map.lines.M3.proj(file=polar.file, database="world")$coords
lines(nat.bds)


## Subset to a smaller geographic area in southwestern U.S.
subset.elev &lt;- var.subset(elev, llx=-2000, urx=0, lly=-6500, ury=-4000)
## Make a plot of this subset.
image(subset.elev$x.cell.ctr, subset.elev$y.cell.ctr,
      subset.elev$data[,,1], xlab="Projection x-coord (km)",
      ylab="Projection y-coord (km)", zlim=range(subset.elev$data[,,1]),
      col=heat.colors(15))

## Superimpose Mexico, US, and Candadian national borders on the plot,
## along with state borders.
canusamex.borders &lt;- get.map.lines.M3.proj(file=polar.file, "canusamex")$coords
lines(canusamex.borders)
</code></pre>

<hr>
<h2 id='get.matrix.all.grid.cell.ctrs'>Obtain a matrix giving the locations of the grid cell centers</h2><span id='topic+get.matrix.all.grid.cell.ctrs'></span>

<h3>Description</h3>

<p>Obtain a two-column matrix giving the locations of the grid
cell centers in grid units.</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.matrix.all.grid.cell.ctrs(file, units)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get.matrix.all.grid.cell.ctrs_+3A_file">file</code></td>
<td>
<p>File name of Models3-formatted file which contains
information about the projection.  Currently, this function can only
handle files with a Lambert conic conformal or polar stereographic
projection.
</p>
</td></tr>
<tr><td><code id="get.matrix.all.grid.cell.ctrs_+3A_units">units</code></td>
<td>
<p>Units for coordinates of grid rows and columns.  Must be
one of &ldquo;m&rdquo;, &ldquo;km&rdquo;, or &ldquo;deg&rdquo;.  If
unspecified, the default is &ldquo;deg&rdquo; if the file has a
longitude/latitude grid, and &ldquo;km&rdquo; otherwise.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Matrix with number of rows equal to the number of grid cells and
two columns.  The first column contains the x-coordinate of the grid
cell centers; the second column contains the y-coordinate of the grid
cell centers.  The rows are listed in order such that all cell
centers with same y-coordinate are grouped together, with groups
ordered by the y-coordinate, and ordered within these groups by the
x-coordinate).
</p>


<h3>Warning</h3>

<p>Currently, this function can only handle files with
Lambert conic conformal, polar stereographic, and longitude/latitude
projections.
</p>


<h3>Note</h3>

<p>This function relies on calls <code>get.coord.for.dimensions</code>.</p>


<h3>Author(s)</h3>

<p>Jenise Swall</p>


<h3>See Also</h3>

<p><code><a href="#topic+get.coord.for.dimension">get.coord.for.dimension</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## As mentioned in notes above, user will not typically call
## this function directly.

## Find the path to a demo file on lambert conic conformal projection.
lcc.file &lt;- system.file("extdata/ozone_lcc.ncf", package="M3")
## Get a list of the x- and y-coordinates of the centers of all
## grid cells.
ctrs &lt;- get.matrix.all.grid.cell.ctrs(lcc.file, units="km")
</code></pre>

<hr>
<h2 id='get.proj.info.M3'>Obtain information about the projection used in the Models3 file</h2><span id='topic+get.proj.info.M3'></span>

<h3>Description</h3>

<p>Obtain information about the projection used by in the
Models3-formatted file.  Build a string describing the projection
which can be used by the R package sf.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.proj.info.M3(file, earth.radius=6370000)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get.proj.info.M3_+3A_file">file</code></td>
<td>
<p>File name of Models3-formatted file which contains
information about the projection.  Currently, this function can only
handle files with a Lambert conic conformal, polar stereographic,
and longitude/latitude projections.</p>
</td></tr>
<tr><td><code id="get.proj.info.M3_+3A_earth.radius">earth.radius</code></td>
<td>
<p>Radius of the earth (in meters), which is assumed
to be spherical by the Models3 I/O API.  Default value is
6 370 000 m.  Note that the radius in some previous version of the
Models3 I/O API was 6 370 997 m, which may be appropriate for some
users.  For instance, this latter value was used in previous
packages supplied by Battelle.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function assumes that the file uses the Lambert
conic conformal projection, polar stereographic projection, or
longitude/latitude.<br />
The Models3 I/O API assumes a spherical earth.  The default value for
<code>earth.radius</code> is 6 370 000 m (sometimes referred to as
&ldquo;sphere 20&rdquo;), which is the current value used in the Models3
I/O API. Note that the radius in some previous versions of the Models3
I/O API was 6 370 997 m, and this value was also used in previous
packages for reading Models3-formatted files, which were developed for
EPA by Battelle.
</p>


<h3>Value</h3>

<p>String describing model projection, which can be utilized by
the <span class="pkg">sf</span> package (for projections to and from
longitude/latitude, for example).
</p>


<h3>Warning</h3>

<p>Currently, this function can only handle files with
Lambert conic conformal, polar stereographic, and longitude/latitude
projections.
</p>


<h3>Note</h3>

<p>This function relies on the R package <span class="pkg">ncdf4</span> to read
information from Models3-formatted files, since the Models3 format
is built on netCDF <br />
(<a href="https://www.unidata.ucar.edu/software/netcdf/">https://www.unidata.ucar.edu/software/netcdf/</a>). <br />
The string that is returned by this function is appropriate for
use with package <span class="pkg">sf</span>.  Usually, the user will not call this function
directly; instead, it will be called by other functions in this package.
</p>


<h3>Author(s)</h3>

<p>Jenise Swall</p>


<h3>References</h3>

<p>See information about the meaning of Models3 I/O API
projection arguments at <br />
<a href="https://www.cmascenter.org/ioapi/documentation/all_versions/html/GRIDS.html">https://www.cmascenter.org/ioapi/documentation/all_versions/html/GRIDS.html</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+project.lonlat.to.M3">project.lonlat.to.M3</a></code>,
<code><a href="#topic+project.M3.to.lonlat">project.M3.to.lonlat</a></code>, <br />
<code><a href="#topic+project.M3.1.to.M3.2">project.M3.1.to.M3.2</a></code>,
<code><a href="#topic+get.map.lines.M3.proj">get.map.lines.M3.proj</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Find the path to a demo file on lambert conic conformal projection.
lcc.file &lt;- system.file("extdata/ozone_lcc.ncf", package="M3")
## Get string with projection information, using previous value for
## the earth's radius.
get.proj.info.M3(lcc.file, earth.radius=6370997)

## Find the path to a demo file on polar stereographic projection.
polar.file &lt;- system.file("extdata/surfinfo_polar.ncf", package="M3")
## Get string with projection information.
get.proj.info.M3(polar.file)
</code></pre>

<hr>
<h2 id='project.lonlat.to.M3'>Project coordinates from longitude/latitude to model units.</h2><span id='topic+project.lonlat.to.M3'></span>

<h3>Description</h3>

<p>Project coordinates from longitude/latitude to model
units as specified according to the projection given by a
user-designated Models3-formatted file.</p>


<h3>Usage</h3>

<pre><code class='language-R'>project.lonlat.to.M3(longitude, latitude, file, units, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="project.lonlat.to.M3_+3A_longitude">longitude</code></td>
<td>
<p>Vector of longitudes for the points to be
projected.
</p>
</td></tr>
<tr><td><code id="project.lonlat.to.M3_+3A_latitude">latitude</code></td>
<td>
<p>Vector of latitudes for the points to be projected.
</p>
</td></tr>
<tr><td><code id="project.lonlat.to.M3_+3A_file">file</code></td>
<td>
<p>File name of Models3-formatted file which contains
information about the projection to which you want <code>x</code> and
<code>y</code> to be projected.
</p>
</td></tr>
<tr><td><code id="project.lonlat.to.M3_+3A_units">units</code></td>
<td>
<p>Units in which to return <code>x</code> and <code>y</code>.  Options
are &quot;km&quot; or &quot;m&quot;, with &quot;km&quot; as the default.
</p>
</td></tr>
<tr><td><code id="project.lonlat.to.M3_+3A_...">...</code></td>
<td>
<p>Other arguments to pass to <code>get.proj.info.M3</code>
function.  In this case, the only relevant argument would be the
earth radius to use for the projection in <code>file</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function uses the function <code><a href="sf.html#topic+sf_project">sf_project</a></code>
from the package <span class="pkg">sf</span> to project from longitude/latitude to
the projection defined by the Models3-formatted file.
</p>


<h3>Value</h3>

<p>A list containing the elements <code>coords</code> and <code>units</code>.
The element <code>coords</code> contains a matrix of coordinates using the
projection in <code>file</code>.  The element <code>units</code> contains the
units of the coordinates, as specifed by <code>units</code> or &quot;km&quot; by
default.
</p>


<h3>Author(s)</h3>

<p>Jenise Swall</p>


<h3>See Also</h3>

<p><code><a href="#topic+project.M3.to.lonlat">project.M3.to.lonlat</a></code>, <code><a href="#topic+project.M3.1.to.M3.2">project.M3.1.to.M3.2</a></code>, <code><a href="#topic+get.proj.info.M3">get.proj.info.M3</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## List of state capital longitudes/latitudes
## (from http://www.xfront.com/us_states).
capitals &lt;- data.frame(x=c(-84.39,-86.28,-81.04,-86.78,-78.64,-84.86),
                       y=c(33.76,32.36,34.00,36.17,35.77,38.20),
                       name=c("Atlanta", "Montgomery", "Columbia",
                                 "Nashville", "Raleigh", "Frankfort")
                        )
## Plot these on a map, with state lines.
plot(capitals$x, capitals$y)
map("state", add=TRUE)

## Now, put these on the same Lambert conic conformal projection used
## in the demo file below.
lcc.file &lt;- system.file("extdata/ozone_lcc.ncf", package="M3")
lcc.capitals &lt;- project.lonlat.to.M3(capitals$x, capitals$y, lcc.file)

## Put these on a new plot.
dev.new()
plot(lcc.capitals$coords)
## Project state lines to this projection.
lcc.map &lt;- get.map.lines.M3.proj(lcc.file)
lines(lcc.map$coords)
</code></pre>

<hr>
<h2 id='project.M3.1.to.M3.2'> Project coordinates based on projection in the first file to
the projection given in the second
</h2><span id='topic+project.M3.1.to.M3.2'></span>

<h3>Description</h3>

<p>Project coordinates based on projection in the first
Models3-formatted file to the projection given in the second
Models3-formatted file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>project.M3.1.to.M3.2(x, y, from.file, to.file, units, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="project.M3.1.to.M3.2_+3A_x">x</code></td>
<td>
<p>x-coordinates in model units from projection in first file
</p>
</td></tr>
<tr><td><code id="project.M3.1.to.M3.2_+3A_y">y</code></td>
<td>
<p>y-coordinates in model units from projection in first file
</p>
</td></tr>
<tr><td><code id="project.M3.1.to.M3.2_+3A_from.file">from.file</code></td>
<td>
<p>Name of Models3-formatted file with the same
model projection as <code>x</code> and <code>y</code>.  These coordinates will
be re-projected to the projection given in file2.
</p>
</td></tr>
<tr><td><code id="project.M3.1.to.M3.2_+3A_to.file">to.file</code></td>
<td>
<p>Name of Models3-formatted file with the model
projection to which you want <code>x</code> and <code>y</code> to be projected.
</p>
</td></tr>
<tr><td><code id="project.M3.1.to.M3.2_+3A_units">units</code></td>
<td>
<p>Units of <code>x</code> and <code>y</code>.  The coordinates returned
will also be in these units.
</p>
</td></tr>
<tr><td><code id="project.M3.1.to.M3.2_+3A_...">...</code></td>
<td>
<p>Other arguments to pass to <code>get.proj.info.M3</code>
function.  In this case, the only relevant argument would be the
earth radius to use when doing the projections.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function calls <code>get.proj.info.M3</code> which reads
the projection information (using the package <span class="pkg">ncdf4</span>) and
transforms it to strings that are understood by functions in
<span class="pkg">sf</span>.
</p>


<h3>Value</h3>

<p> A list containing the elements <code>coords</code> and <code>units</code>.
The element <code>coords</code> contains a matrix of coordinates using
projection in <code>to.file</code>.  The element <code>units</code> contains
the units of the coordinates, which are the same as those specified
for input <code>x</code> and <code>y</code>.
</p>


<h3>Warning</h3>

<p>This function assumes the projections in
<code>from.file</code> and <code>to.file</code> are Lambert conic conformal or
polar stereographic.
</p>


<h3>Author(s)</h3>

<p>Jenise Swall</p>


<h3>See Also</h3>

<p><code><a href="#topic+project.lonlat.to.M3">project.lonlat.to.M3</a></code>, <code><a href="#topic+project.M3.to.lonlat">project.M3.to.lonlat</a></code>, <code><a href="#topic+get.proj.info.M3">get.proj.info.M3</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Find the path to a demo file with lambert conic conformal projection.
lcc.file &lt;- system.file("extdata/ozone_lcc.ncf", package="M3")

## Read in the ozone for July 4 for eastern U.S.
lcc.oz &lt;- get.M3.var(file=lcc.file, var="O3",
                      lcol=90, ucol=130, lrow=30, urow=80,
                      ldatetime=as.Date("2001-07-04"),
                      udatetime=as.Date("2001-07-04"))

## Get the cell centers for this subset.
east.ctrs &lt;- expand.grid(lcc.oz$x.cell.ctr, lcc.oz$y.cell.ctr)
plot(east.ctrs, cex=0.3, xlab="x", ylab="y")

## Find map lines on this projection, superplot.
lcc.state.bds &lt;- get.map.lines.M3.proj(file=lcc.file)$coords
lines(lcc.state.bds, col="darkblue")


## Find the path to a demo file with polar stereographic projection.
polar.file &lt;- system.file("extdata/surfinfo_polar.ncf", package="M3")

## Put the cell centers from the subsetted ozone data on this polar
## stereographic projection.
polar.oz &lt;- project.M3.1.to.M3.2(east.ctrs[,1], east.ctrs[,2],
                                 from.file=lcc.file,
                                 to.file=polar.file,
                                 units=lcc.oz$hz.units)

## Plot the cells centers and boundary lines on the polar
## stereographic projection.
dev.new()
plot(polar.oz$coords)
polar.state.bds &lt;- get.map.lines.M3.proj(file=polar.file)$coords
lines(polar.state.bds, col="darkblue")
</code></pre>

<hr>
<h2 id='project.M3.to.lonlat'>Project coordinates from model units to longitude/latitude</h2><span id='topic+project.M3.to.lonlat'></span>

<h3>Description</h3>

<p>Project coordinates from model units (as specified
according to the projection given by a user-designated
Models3-formatted file) to longitude/latitude.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>project.M3.to.lonlat(x, y, file, units, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="project.M3.to.lonlat_+3A_x">x</code></td>
<td>
<p>x-coordinates of points in model units (meters or kilometers,
depeding on the value of <code>units</code>
</p>
</td></tr>
<tr><td><code id="project.M3.to.lonlat_+3A_y">y</code></td>
<td>
<p>y-coordinates of points in model units  (meters or kilometers,
depeding on the value of <code>units</code>
</p>
</td></tr>
<tr><td><code id="project.M3.to.lonlat_+3A_file">file</code></td>
<td>
<p>Name of Models3-formatted file with the same projection as
<code>x</code> and <code>y</code>.
</p>
</td></tr>
<tr><td><code id="project.M3.to.lonlat_+3A_units">units</code></td>
<td>
<p>Units of <code>x</code> and <code>y</code>.
</p>
</td></tr>
<tr><td><code id="project.M3.to.lonlat_+3A_...">...</code></td>
<td>
<p>Other arguments to pass to <code>get.proj.info.M3</code>
function.  In this case, the only relevant argument would be the
earth radius to use for the projection in <code>file</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function uses the function <code><a href="sf.html#topic+sf_project">sf_project</a></code>
from the package <span class="pkg">sf</span> to project to longitude/latitude given
the projection defined by the Models3-formatted file.
</p>


<h3>Value</h3>

<p>A list containing the elements <code>coords</code> and <code>units</code>.
The element <code>coords</code> contains a matrix of coordinates in
longitude/latitude.  The element <code>units</code> contains the string
&quot;deg&quot; to designate that <code>coords</code> is in degrees of
longitude/latitude.
</p>


<h3>Author(s)</h3>

<p>Jenise Swall</p>


<h3>See Also</h3>

<p><code><a href="#topic+project.lonlat.to.M3">project.lonlat.to.M3</a></code>,
<code><a href="#topic+project.M3.1.to.M3.2">project.M3.1.to.M3.2</a></code>, <code><a href="#topic+get.proj.info.M3">get.proj.info.M3</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## List of state capital longitudes/latitudes
## (from http://www.xfront.com/us_states).
capitals &lt;- data.frame(x=c(-84.39,-86.28,-81.04,-86.78,-78.64,-84.86),
                       y=c(33.76,32.36,34.00,36.17,35.77,38.20),
                       name=c("Atlanta", "Montgomery", "Columbia",
                                 "Nashville", "Raleigh", "Frankfort")
                        )
## Plot these on a map, with state lines.
plot(capitals$x, capitals$y)
map("state", add=TRUE)

## Now, put these on the same Lambert conic conformal projection used
## in the demo file below.
lcc.file &lt;- system.file("extdata/ozone_lcc.ncf", package="M3")
lcc.capitals &lt;- project.lonlat.to.M3(capitals$x, capitals$y, lcc.file)

## Now, project them back to longitude/latitude, make sure we get the
## same thing we started with.
chk.capitals &lt;- project.M3.to.lonlat(lcc.capitals$coords[,"x"],
                                     lcc.capitals$coords[,"y"],
                                     lcc.file,
                                     units=lcc.capitals$units)
## These differences should be 0 or something very tiny.
summary(capitals[,c("x", "y")] - chk.capitals$coords)
</code></pre>

<hr>
<h2 id='var.subset'>Subset the array resulting from a call to <code>get.M3.var</code>.
</h2><span id='topic+var.subset'></span>

<h3>Description</h3>

<p>Subset the array resulting from a call to
<code>get.M3.var</code> using projection units and/or human-readable
dates and times.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>var.subset(var.info, llx, urx, lly, ury, ldatetime, udatetime,
           hz.strict=TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="var.subset_+3A_var.info">var.info</code></td>
<td>
<p>Variable list given by function <code>get.M3.var</code>.
</p>
</td></tr>
<tr><td><code id="var.subset_+3A_llx">llx</code></td>
<td>
<p>Lower x-coordinate bound for the subsetted grid
using the same units given in element <code>hz.units</code> of
<code>var.info</code>.  Default is the left boundary of the grid.
</p>
</td></tr>
<tr><td><code id="var.subset_+3A_urx">urx</code></td>
<td>
<p>Upper x-coordinate bound for the subsetted grid
using the same units given in element <code>hz.units</code> of
<code>var.info</code>.  Default is the right boundary of the grid.
</p>
</td></tr>
<tr><td><code id="var.subset_+3A_lly">lly</code></td>
<td>
<p>Lower y-coordinate bound for the subsetted grid
using the same units given in element <code>hz.units</code> of
<code>var.info</code>.  Default is the lower boundary of the grid.
</p>
</td></tr>
<tr><td><code id="var.subset_+3A_ury">ury</code></td>
<td>
<p>Upper y-coordinate bound for the subsetted grid
using the same units given in element <code>hz.units</code> of
<code>var.info</code>.  Default is the upper boundary of the grid.
</p>
</td></tr>
<tr><td><code id="var.subset_+3A_ldatetime">ldatetime</code></td>
<td>
<p>Beginning date-time (either Date or POSIX
class) bound for the subset.  Default is earliest date-time.
</p>
</td></tr>
<tr><td><code id="var.subset_+3A_udatetime">udatetime</code></td>
<td>
<p>Ending date-time (either Date or POSIX
class) bound for the subset.  Default is latest date-time.
</p>
</td></tr>
<tr><td><code id="var.subset_+3A_hz.strict">hz.strict</code></td>
<td>
<p>If TRUE (default), to be allowed in the
subset, the whole grid cell must fit within the bounds given by
llx, urx, lly, and ury.  If FALSE, grid cells will be included
in the subset if any portion of the grid cell's area falls
within the given bounds.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the user wants to subset the variable by row, column, layer,
or time step number, this can be accomplished easily using standard R
methods for subsetting the array of variable values.  This function
was written to help the user who does not know the row, column, or
time step numbers, but who wants to subset according to human-readable
dates and times or according to projection units.
</p>


<h3>Value</h3>

<p>Subsetted array of variable values.  (The array's format is
preserved.)
</p>


<h3>Author(s)</h3>

<p>Jenise Swall</p>


<h3>References</h3>

<p><a href="https://www.cmascenter.org/ioapi/documentation/all_versions/html/VBLE.html">https://www.cmascenter.org/ioapi/documentation/all_versions/html/VBLE.html</a>, <br />
<a href="https://www.cmascenter.org/ioapi/documentation/all_versions/html/DATETIME.html">https://www.cmascenter.org/ioapi/documentation/all_versions/html/DATETIME.html</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get.M3.var">get.M3.var</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Find the path to the demo file.
polar.file &lt;- system.file("extdata/surfinfo_polar.ncf", package="M3")

## Read in the terrain elevation variable.
elev &lt;- get.M3.var(file=polar.file, var="HT")
## Make a plot.
image(elev$x.cell.ctr, elev$y.cell.ctr, elev$data[,,1],
      xlab="Projection x-coord (km)", ylab="Projection y-coord (km)",
      zlim=range(elev$data[,,1]), col=heat.colors(15))

## Subset to a smaller geographic area in southwestern U.S.
subset.elev &lt;- var.subset(elev, llx=-2000, urx=0, lly=-6500, ury=-4000)
## Make a plot of this subset.
image(subset.elev$x.cell.ctr, subset.elev$y.cell.ctr,
      subset.elev$data[,,1], xlab="Projection x-coord (km)",
      ylab="Projection y-coord (km)", zlim=range(subset.elev$data[,,1]),
      col=heat.colors(15))

## Superimpose U.S. state boundaries on the plot.
state.bds &lt;- get.map.lines.M3.proj(file=polar.file)$coords
lines(state.bds)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
