<!DOCTYPE html><html><head><title>Help for package traitstrap</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {traitstrap}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#autoplot.filled_trait'><p>Coverage plot of filled Traits</p></a></li>
<li><a href='#community'><p>Community data</p></a></li>
<li><a href='#cor_to_df'><p>Correlation to dataframe</p></a></li>
<li><a href='#distribution_handler'><p>Get different distributions</p></a></li>
<li><a href='#fortify_filled_trait'><p>Fortify filled Traits</p></a></li>
<li><a href='#get_ci'><p>Get confidence intervals</p></a></li>
<li><a href='#get_dist_parms'><p>Get distribution parameters</p></a></li>
<li><a href='#quiet'><p>Do something quietly</p></a></li>
<li><a href='#trait'><p>Trait data</p></a></li>
<li><a href='#trait_fill'><p>fill traits</p></a></li>
<li><a href='#trait_fit_distributions'><p>Fit trait distributions</p></a></li>
<li><a href='#trait_missing'><p>Which taxa lack traits</p></a></li>
<li><a href='#trait_multivariate_bootstrap'><p>Bootstrap traits</p></a></li>
<li><a href='#trait_np_bootstrap'><p>Bootstrap traits</p></a></li>
<li><a href='#trait_parametric_bootstrap'><p>Bootstrap traits parametrically</p></a></li>
<li><a href='#trait_summarise_boot_moments'><p>Summarise Bootstrap traits</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Bootstrap Trait Values to Calculate Moments</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Calculates trait moments from trait and community data using the 
  methods developed in Maitner et al (2021) &lt;<a href="https://doi.org/10.22541%2Fau.162196147.76797968%2Fv1">doi:10.22541/au.162196147.76797968/v1</a>&gt;.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/Plant-Functional-Trait-Course/traitstrap/">https://github.com/Plant-Functional-Trait-Course/traitstrap/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/Plant-Functional-Trait-Course/traitstrap/issues">https://github.com/Plant-Functional-Trait-Course/traitstrap/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.2.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr (&ge; 1.0.0), purrr, rlang, e1071, glue, ggplot2, tibble,
stringr, fitdistrplus, tidyr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, knitr, rmarkdown, FD, TPD</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-05-11 11:10:37 UTC; gbsrt</td>
</tr>
<tr>
<td>Author:</td>
<td>Richard J. Telford
    <a href="https://orcid.org/0000-0001-9826-3076"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre],
  Aud H. Halbritter <a href="https://orcid.org/0000-0003-2597-6328"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Brian S. Maitner <a href="https://orcid.org/0000-0002-2118-9880"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Richard J. Telford &lt;richard.telford@uib.no&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-05-12 14:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='autoplot.filled_trait'>Coverage plot of filled Traits</h2><span id='topic+autoplot.filled_trait'></span>

<h3>Description</h3>

<p>Function calculates the trait coverage of the community
for each level of the sampling hierarchy and makes a barplot.
</p>
<p>Shows at which level the data are coming from in each plot.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'filled_trait'
autoplot(object, other_col_how, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="autoplot.filled_trait_+3A_object">object</code></td>
<td>
<p>output from <code>trait_fill()</code>.</p>
</td></tr>
<tr><td><code id="autoplot.filled_trait_+3A_other_col_how">other_col_how</code></td>
<td>
<p>what to do with the other columns in other data.
Options are to <code>filter</code> by one of the columns, add them to the x-<code>axis</code>,
<code>facet</code> by them, or to <code>ignore</code>.</p>
</td></tr>
<tr><td><code id="autoplot.filled_trait_+3A_...">...</code></td>
<td>
<p>optional filters for use with <code>other_col_how = "filter"</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a ggplot2 plot
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require("ggplot2")
data(community)
data(trait)
filled_traits &lt;- trait_fill(
  comm = community, traits = trait,
  scale_hierarchy = c("Site", "PlotID"),
  taxon_col = "Taxon", value_col = "Value",
  trait_col = "Trait", abundance_col = "Cover"
)
autoplot(filled_traits)
</code></pre>

<hr>
<h2 id='community'>Community data</h2><span id='topic+community'></span>

<h3>Description</h3>

<p>A dataset containing plant cover in control plots on Svalbard from PFCT4
TraitTrain course.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>community
</code></pre>


<h3>Format</h3>

<p>A data frame with 110 rows and 4 variables:
</p>

<dl>
<dt>Taxon</dt><dd><p>species name</p>
</dd>
<dt>Cover</dt><dd><p>cover, in percent</p>
</dd>
<dt>Site</dt><dd><p>site name</p>
</dd>
<dt>PlotID</dt><dd><p>plot name</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://www.uib.no/en/rg/EECRG/114808/plant-functional-traits-course-4">https://www.uib.no/en/rg/EECRG/114808/plant-functional-traits-course-4</a>
</p>

<hr>
<h2 id='cor_to_df'>Correlation to dataframe</h2><span id='topic+cor_to_df'></span>

<h3>Description</h3>

<p>Helper function for bootstrap_traits_multivariate that
extracts results from a correlation matrix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cor_to_df(corr)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cor_to_df_+3A_corr">corr</code></td>
<td>
<p>correlation matrix</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame of correlations
</p>


<h3>References</h3>

<p>Modified from https://stackoverflow.com/a/23476844/2055765
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- matrix(ncol = 5, rnorm(20))
colnames(x) &lt;- letters[1:5]
cor(x) |&gt; cor_to_df()

</code></pre>

<hr>
<h2 id='distribution_handler'>Get different distributions</h2><span id='topic+distribution_handler'></span>

<h3>Description</h3>

<p>Internal helper function for drawing traits
</p>


<h3>Usage</h3>

<pre><code class='language-R'>distribution_handler(parm1, parm2, n = 1, type)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="distribution_handler_+3A_parm1">parm1</code></td>
<td>
<p>the first parameter in a fitted distribution</p>
</td></tr>
<tr><td><code id="distribution_handler_+3A_parm2">parm2</code></td>
<td>
<p>the second parameter in a fitted distribution</p>
</td></tr>
<tr><td><code id="distribution_handler_+3A_n">n</code></td>
<td>
<p>Number of draws.  Defaults to 1</p>
</td></tr>
<tr><td><code id="distribution_handler_+3A_type">type</code></td>
<td>
<p>Distribution type to fit.
One of &quot;normal&quot;, &quot;lognormal&quot;, or &quot;beta&quot;</p>
</td></tr>
</table>


<h3>Value</h3>

<p>numeric vector of length <code>n</code> from required distribution.
</p>

<hr>
<h2 id='fortify_filled_trait'>Fortify filled Traits</h2><span id='topic+fortify_filled_trait'></span>

<h3>Description</h3>

<p>Calculates at which level the data are coming from in each plot.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fortify_filled_trait(object, other_col_how, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fortify_filled_trait_+3A_object">object</code></td>
<td>
<p>filled traits from <code>trait_fill()</code>.</p>
</td></tr>
<tr><td><code id="fortify_filled_trait_+3A_other_col_how">other_col_how</code></td>
<td>
<p>what to do with the other columns in other data.
Options are to <code>filter</code> by one of the columns, add them to the x-<code>axis</code>,
<code>facet</code> by them, or to <code>ignore</code>.</p>
</td></tr>
<tr><td><code id="fortify_filled_trait_+3A_...">...</code></td>
<td>
<p>optional filters for use with <code>other_col_how = "filter"</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a tibble
</p>

<hr>
<h2 id='get_ci'>Get confidence intervals</h2><span id='topic+get_ci'></span>

<h3>Description</h3>

<p>Internal helper function for generating CIs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_ci(data, sd_mult = 1, ci = 0.95, which, parametric = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_ci_+3A_data">data</code></td>
<td>
<p>Numeric vector</p>
</td></tr>
<tr><td><code id="get_ci_+3A_sd_mult">sd_mult</code></td>
<td>
<p>SD multiplier.  defaults to 1</p>
</td></tr>
<tr><td><code id="get_ci_+3A_ci">ci</code></td>
<td>
<p>0 to 1</p>
</td></tr>
<tr><td><code id="get_ci_+3A_which">which</code></td>
<td>
<p>&quot;high&quot; or &quot;low&quot;</p>
</td></tr>
<tr><td><code id="get_ci_+3A_parametric">parametric</code></td>
<td>
<p>if TRUE, sd used, if FALSE, quantile</p>
</td></tr>
</table>


<h3>Value</h3>

<p>numeric vector length 1
</p>

<hr>
<h2 id='get_dist_parms'>Get distribution parameters</h2><span id='topic+get_dist_parms'></span>

<h3>Description</h3>

<p>Internal helper function for
calculating parametric distribution parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_dist_parms(data, distribution_type)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_dist_parms_+3A_data">data</code></td>
<td>
<p>Numeric vector</p>
</td></tr>
<tr><td><code id="get_dist_parms_+3A_distribution_type">distribution_type</code></td>
<td>
<p>Character.
One of either &quot;normal&quot;, &quot;lognormal&quot;, or &quot;beta&quot;</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This function will first try fitting using mme, then mle
</p>

<hr>
<h2 id='quiet'>Do something quietly</h2><span id='topic+quiet'></span>

<h3>Description</h3>

<p>Internal helper function
used to prevent printed messages
</p>


<h3>Usage</h3>

<pre><code class='language-R'>quiet(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="quiet_+3A_x">x</code></td>
<td>
<p>Code to be executed quietly</p>
</td></tr>
</table>

<hr>
<h2 id='trait'>Trait data</h2><span id='topic+trait'></span>

<h3>Description</h3>

<p>A dataset containing plant traits in control plots on Svalbard from PFCT4
TraitTrain course.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trait
</code></pre>


<h3>Format</h3>

<p>A data frame with 705 rows and 6 variables:
</p>

<dl>
<dt>Site</dt><dd><p>site name</p>
</dd>
<dt>PlotID</dt><dd><p>plot name</p>
</dd>
<dt>Taxon</dt><dd><p>species name</p>
</dd>
<dt>ID</dt><dd><p>Unique leaf ID</p>
</dd>
<dt>Trait</dt><dd><p>trait name with unit</p>
</dd>
<dt>Value</dt><dd><p>trait value</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://www.uib.no/en/rg/EECRG/114808/plant-functional-traits-course-4">https://www.uib.no/en/rg/EECRG/114808/plant-functional-traits-course-4</a>
</p>

<hr>
<h2 id='trait_fill'>fill traits</h2><span id='topic+trait_fill'></span>

<h3>Description</h3>

<p>A function for trait filling using a hierarchical sampling
design, which allows to account for incomplete trait collections,
traits from different spatial or temporal levels
(i.e. local traits vs. databases) and experimental designs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trait_fill(
  comm,
  traits,
  scale_hierarchy = c("Country", "Site", "BlockID", "PlotID"),
  global = TRUE,
  taxon_col = "taxon",
  trait_col = "trait",
  value_col = "Value",
  abundance_col = "Cover",
  treatment_col = NULL,
  treatment_level = NULL,
  other_col = character(0),
  keep_all = FALSE,
  min_n_in_sample = 5,
  complete_only = FALSE,
  leaf_id
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trait_fill_+3A_comm">comm</code></td>
<td>
<p>a dataframe in long format with community data</p>
</td></tr>
<tr><td><code id="trait_fill_+3A_traits">traits</code></td>
<td>
<p>a dataframe in long format with trait data</p>
</td></tr>
<tr><td><code id="trait_fill_+3A_scale_hierarchy">scale_hierarchy</code></td>
<td>
<p>character vector of the sampling hierarchy from large
to small (e.g. site/block/plot)</p>
</td></tr>
<tr><td><code id="trait_fill_+3A_global">global</code></td>
<td>
<p>logical; calculate traits at global scale.
Must not be a column called global in the traits data.</p>
</td></tr>
<tr><td><code id="trait_fill_+3A_taxon_col">taxon_col</code></td>
<td>
<p>character; name of taxon column in comm and traits.
Can be a vector (e.g. &quot;species&quot;, &quot;genus&quot;), in which case if traits cannot be
filled for the first taxon column, subsequent columns will be used in order.</p>
</td></tr>
<tr><td><code id="trait_fill_+3A_trait_col">trait_col</code></td>
<td>
<p>character; name of trait name column in traits</p>
</td></tr>
<tr><td><code id="trait_fill_+3A_value_col">value_col</code></td>
<td>
<p>character; name of trait value column in traits</p>
</td></tr>
<tr><td><code id="trait_fill_+3A_abundance_col">abundance_col</code></td>
<td>
<p>character; name of species abundance column in comm</p>
</td></tr>
<tr><td><code id="trait_fill_+3A_treatment_col">treatment_col</code></td>
<td>
<p>character; optional name of treatment_col in comm and
traits. Must refer to a factor where first level is control.</p>
</td></tr>
<tr><td><code id="trait_fill_+3A_treatment_level">treatment_level</code></td>
<td>
<p>character; optional name of scale_hierarchy at which
treatment should be filtered</p>
</td></tr>
<tr><td><code id="trait_fill_+3A_other_col">other_col</code></td>
<td>
<p>name of other grouping columns in comm</p>
</td></tr>
<tr><td><code id="trait_fill_+3A_keep_all">keep_all</code></td>
<td>
<p>logical; keep trait data at all available levels
or just finest scale available</p>
</td></tr>
<tr><td><code id="trait_fill_+3A_min_n_in_sample">min_n_in_sample</code></td>
<td>
<p>numeric; minimum number in sample with traits to
accept before searching for traits higher up the hierarchy. The default is 5.</p>
</td></tr>
<tr><td><code id="trait_fill_+3A_complete_only">complete_only</code></td>
<td>
<p>logical; use only leaves with a full set of traits.
Set to TRUE when imputing for <code>trait_multivariate_bootstrap</code></p>
</td></tr>
<tr><td><code id="trait_fill_+3A_leaf_id">leaf_id</code></td>
<td>
<p>character; unique leaf identifiers.
Only needed when <code>complete_only</code> is TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function uses a hierarchical sampling design, which allows it to
account for incomplete trait collections, traits from different spatial or
temporal levels (i.e. local traits vs. databases) and/or
experimental designs.
</p>
<p>With scale_hierarchy you can define the levels at which the traits have been
collected and their order starting with the highest level
(e.g. global database, region, site, block, plot).
</p>
<p><code>trait_fill()</code> will choose if available a trait value from the lowest
level, i.e. species X from plot A and if no trait is available from that
level, it will move up the hierarchy and choose a trait from species X from
plot B at the same site.
If there is no trait available from species X in the same site, it
will choose a trait value from another site.
</p>
<p>The argument <code>min_n_in_samples</code> allows users to define the minimum number in
sample at each level for the trait filling.
If the minimum number is not reached,
trait values from the next level will also be selected, to avoid sampling the
same individual several times, which will result in unrealistic variances.
The default value is 5.
</p>
<p>In the <code>other_col</code> argument other grouping variables in the community dataset
can be defined and will be kept after the trait filling step.
</p>
<p>Traitstrap also allows to include taxonomy and experimental design in the
trait filling step.
</p>
<p>With taxon_col a hierarchy for the taxonomy can be defined.
If traits for a specific
species are not available, traits from next level,
e.g. the genus will be selected.
For this a list of the taxonomic hierarchy has to be defined (e.g. &quot;taxon&quot;,
&quot;genus&quot;, &quot;family&quot;).
</p>
<p>The argument treatment_col allows to incorporate an experimental design where
traits are selected from the same experimental treatment or the first factor
level, which is assumed to be the control.
Therefore, it is important to order
the levels of a treatment in the right order, i.e. the first level has to be
the control.
If you have two or more treatments and you want filling to be done only
within a treatment, and not from a treatment and the control, then
make the first level of the factor a level that is not in the data.
The filling step can be defined at certain level using the
treatment_level argument. Depending on the experimental design trait filling
should occur a certain level, e.g. block or site.
</p>


<h3>Value</h3>

<p>a tibble with extra class <code>filled_trait</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(community)
data(trait)
filled_traits &lt;- trait_fill(
  comm = community, traits = trait,
  scale_hierarchy = c("Site", "PlotID"),
  taxon_col = "Taxon", value_col = "Value",
  trait_col = "Trait", abundance_col = "Cover"
)
</code></pre>

<hr>
<h2 id='trait_fit_distributions'>Fit trait distributions</h2><span id='topic+trait_fit_distributions'></span>

<h3>Description</h3>

<p>Function to fit parametric distributions for each
species-by-trait combination at the finest scale of the
user-supplied hierarchy.
This function returns a tibble containing the fitted parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trait_fit_distributions(filled_traits, distribution_type = "normal")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trait_fit_distributions_+3A_filled_traits">filled_traits</code></td>
<td>
<p>output from the trait_fill function.</p>
</td></tr>
<tr><td><code id="trait_fit_distributions_+3A_distribution_type">distribution_type</code></td>
<td>
<p>the type of statistical distribution to use.
Character or named list. Currently accepts &quot;normal&quot;,&quot;lognormal&quot;, and &quot;beta&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The distributions can either be a single distribution type which is
used for all traits, or traits can be assigned specific distributions types
by supplying the function with a named vector of traits, e.g.
<code style="white-space: pre;">&#8288;c(height = "normal", mass = "lognormal"))&#8288;</code>.
</p>


<h3>Value</h3>

<p>a tibble containing fitted distribution parameters for each trait in each species for each plot.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
data(community)
data(trait)

filled_traits &lt;- trait_fill(
  comm = community |&gt;
    filter(PlotID %in% c("A", "B")),
  traits = trait,
  scale_hierarchy = c("Site", "PlotID"),
  taxon_col = "Taxon", value_col = "Value",
  trait_col = "Trait", abundance_col = "Cover"
)

fitted_distributions &lt;- trait_fit_distributions(
  filled_traits = filled_traits,
  distribution_type = "normal"
)
</code></pre>

<hr>
<h2 id='trait_missing'>Which taxa lack traits</h2><span id='topic+trait_missing'></span>

<h3>Description</h3>

<p>Function gives overview of which taxa are missing traits.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trait_missing(filled_trait, comm)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trait_missing_+3A_filled_trait">filled_trait</code></td>
<td>
<p>output of trait_fill function.</p>
</td></tr>
<tr><td><code id="trait_missing_+3A_comm">comm</code></td>
<td>
<p>community data</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>tibble</code> with columns
#' </p>

<ul>
<li><p>Taxon Species names (actual name depends on <code>taxon_col</code>
argument to <code>trait_fill()</code>)
</p>
</li>
<li><p>max_abun Maximum abundance of that taxa.
Be more concerned about taxa missing traits with high abundances.
</p>
</li>
<li><p>n Number of occurrences of the taxon.
Be more concerned about taxa missing traits with many occurrences.
</p>
</li>
<li><p>n_traits Number of traits for each species.
Ideally all should equal the number of traits you have measured.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>data(community)
data(trait)
filled_traits &lt;- trait_fill(
  comm = community, traits = trait,
  scale_hierarchy = c("Site", "PlotID"),
  taxon_col = "Taxon", value_col = "Value",
  trait_col = "Trait", abundance_col = "Cover"
)
trait_missing(filled_traits, community)
</code></pre>

<hr>
<h2 id='trait_multivariate_bootstrap'>Bootstrap traits</h2><span id='topic+trait_multivariate_bootstrap'></span>

<h3>Description</h3>

<p>Function for nonparametric bootstrap resampling to
calculate community
weighted trait correlations, other bivariate or multivariate statistics
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trait_multivariate_bootstrap(
  filled_traits,
  nrep = 100,
  sample_size = 200,
  raw = FALSE,
  id = "ID",
  fun
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trait_multivariate_bootstrap_+3A_filled_traits">filled_traits</code></td>
<td>
<p>output from the trait_fill function.</p>
</td></tr>
<tr><td><code id="trait_multivariate_bootstrap_+3A_nrep">nrep</code></td>
<td>
<p>number of bootstrap replicates</p>
</td></tr>
<tr><td><code id="trait_multivariate_bootstrap_+3A_sample_size">sample_size</code></td>
<td>
<p>bootstrap size</p>
</td></tr>
<tr><td><code id="trait_multivariate_bootstrap_+3A_raw">raw</code></td>
<td>
<p>logical; argument to extract the raw data of the trait
distributions.
The default is <code>raw = FALSE</code>.
If <code>raw = TRUE</code>, <code>nrep</code> is restricted to 1 to avoid memory issues.</p>
</td></tr>
<tr><td><code id="trait_multivariate_bootstrap_+3A_id">id</code></td>
<td>
<p>column name of unique identifiers of each leaf</p>
</td></tr>
<tr><td><code id="trait_multivariate_bootstrap_+3A_fun">fun</code></td>
<td>
<p>bivariate or multivariate function to apply</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The observed and filled leaves are re-sampled in proportion to
their weights, e.g. the abundance of a species or the biomass.
Values across all individuals in a community are
resampled <code>sample_size</code> times to incorporate the full
spectrum of trait variation, generating <code>nrep</code> trait distributions.
The function <code>fun</code> is applied to the trait distribution at the finest level
of the filled trait hierarchy.
</p>
<p>Note that due to the flexibility of this function,
the output CAN NOT be summarized using
<code>trait_summarise_boot_moments</code>.
</p>


<h3>Value</h3>

<p>a tibble with columns for the elements of the scale_hierarchy,
and a list column result which includes the output of <code>fun</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require(dplyr)
require(tidyr)
require(ggplot2)
require(purrr)

data(community)
data(trait)

filled_traits &lt;- trait_fill(
  comm = community |&gt;
    filter(
      PlotID %in% c("A", "B"),
      Site == 1
    ),
  traits = trait,
  scale_hierarchy = c("Site", "PlotID"),
  taxon_col = "Taxon", value_col = "Value",
  trait_col = "Trait", abundance_col = "Cover",
  complete_only = TRUE, leaf_id = "ID"
)

# Note that more replicates and a greater sample size are advisable
# Here we set them low to make the example run quickly
boot_traits &lt;- trait_multivariate_bootstrap(filled_traits,
  fun = cor,
  nrep = 10,
  sample_size = 100
)

boot_traits_long &lt;- boot_traits |&gt;
  mutate(correlations = map(result, ~ cor_to_df(.x))) |&gt;
  select(-result) |&gt;
  unnest(correlations)

boot_traits_long |&gt;
  ggplot(aes(x = paste(row, "v", col), y = value)) +
  geom_violin() +
  facet_grid(Site ~ PlotID) +
  coord_flip() +
  labs(y = "Correlation", x = "")
</code></pre>

<hr>
<h2 id='trait_np_bootstrap'>Bootstrap traits</h2><span id='topic+trait_np_bootstrap'></span>

<h3>Description</h3>

<p>Function for nonparametric bootstrap resampling to
calculate community weighted trait mean and higher moments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trait_np_bootstrap(filled_traits, nrep = 100, sample_size = 200, raw = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trait_np_bootstrap_+3A_filled_traits">filled_traits</code></td>
<td>
<p>output from the trait_fill function.</p>
</td></tr>
<tr><td><code id="trait_np_bootstrap_+3A_nrep">nrep</code></td>
<td>
<p>number of bootstrap replicates</p>
</td></tr>
<tr><td><code id="trait_np_bootstrap_+3A_sample_size">sample_size</code></td>
<td>
<p>bootstrap size</p>
</td></tr>
<tr><td><code id="trait_np_bootstrap_+3A_raw">raw</code></td>
<td>
<p>logical; argument to extract the raw data of the trait
distributions.
The default is <code>raw = FALSE</code>. If <code>raw = TRUE</code>, <code>nrep</code> is restricted to 1 to
avoid memory issues.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The observed traits are re-sampled in proportion to their weights,
e.g. the abundance of a species or the biomass.
Values across all individuals
in a community are resampled <code>sample_size</code> times to incorporate the full
spectrum of trait variation, generating <code>nrep</code> trait distributions.
From these distributions the function estimates the mean and the higher
moments including variance, skewness and kurtosis.
</p>
<p>#' The output of <code>trait_np_bootstrap()</code> can be summarized using
<code>trait_summarize_boot_moments()</code>.
</p>


<h3>Value</h3>

<p>a tibble with columns for each grouping variable of <code>filled_traits</code>
(usually the elements of scale_hierarchy and the traits column),
and the moments mean, variance, skewness, and kurtosis.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
data(community)
data(trait)

# Filter community data to make example faster
community &lt;- community |&gt;
  filter(
    PlotID %in% c("A", "B"),
    Site == 1
  )
filled_traits &lt;- trait_fill(
  comm = community,
  traits = trait,
  scale_hierarchy = c("Site", "PlotID"),
  taxon_col = "Taxon", value_col = "Value",
  trait_col = "Trait", abundance_col = "Cover"
)

boot_traits &lt;- trait_np_bootstrap(filled_traits,
  nrep = 20,
  sample_size = 200
)
</code></pre>

<hr>
<h2 id='trait_parametric_bootstrap'>Bootstrap traits parametrically</h2><span id='topic+trait_parametric_bootstrap'></span>

<h3>Description</h3>

<p>Function for parametric bootstrap resampling to calculate
community weighted trait mean and higher moments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trait_parametric_bootstrap(
  fitted_distributions,
  nrep = 100,
  sample_size = 200,
  raw = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trait_parametric_bootstrap_+3A_fitted_distributions">fitted_distributions</code></td>
<td>
<p>Fitted distribution object returned by trait_fit_distributions</p>
</td></tr>
<tr><td><code id="trait_parametric_bootstrap_+3A_nrep">nrep</code></td>
<td>
<p>number of bootstrap replicates</p>
</td></tr>
<tr><td><code id="trait_parametric_bootstrap_+3A_sample_size">sample_size</code></td>
<td>
<p>bootstrap size</p>
</td></tr>
<tr><td><code id="trait_parametric_bootstrap_+3A_raw">raw</code></td>
<td>
<p>logical; argument to extract the raw data of the
trait distributions.
The default is <code>raw = FALSE</code>.
If <code>raw = TRUE</code>, <code>nrep</code> is restricted to 1 to avoid
memory issues.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>trait_parametric_bootstrap()</code> is a parametric analogue of the
<code>trait_np_bootstrap()</code>.
It randomly samples from among the fitted distributions
proportionally to species abundance.
The number of samples per replicated are drawn
specified with the parameter sample_size,
and the number of replicates is specified
by the parameter<code> nrep</code>.
From these distributions the function estimates the mean
and the higher moments including variance, skewness and kurtosis.
</p>
<p>The output of <code>trait_parametric_bootstrap()</code> can be summarized using
<code>trait_summarize_boot_moments()</code>.
</p>


<h3>Value</h3>

<p>a tibble
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
data(community)
data(trait)

# Filter trait and community data to make example faster

community &lt;- community |&gt;
  filter(
    PlotID %in% c("A", "B"),
    Site == 1
  )

trait &lt;- trait |&gt;
  filter(Trait %in% c("Plant_Height_cm"))

filled_traits &lt;- trait_fill(
  comm = community,
  traits = trait,
  scale_hierarchy = c("Site", "PlotID"),
  taxon_col = "Taxon", value_col = "Value",
  trait_col = "Trait", abundance_col = "Cover"
)

fitted_distributions &lt;- trait_fit_distributions(
  filled_traits = filled_traits,
  distribution_type = "normal"
)

# Note that more replicates and a greater sample size are advisable
# Here we set them low to make the example run quickly
parametric_distributions &lt;- trait_parametric_bootstrap(
  fitted_distributions = fitted_distributions,
  nrep = 5,
  sample_size = 100
)

moment_summary &lt;- trait_summarise_boot_moments(
  bootstrap_moments = parametric_distributions,
  parametric = FALSE
)
</code></pre>

<hr>
<h2 id='trait_summarise_boot_moments'>Summarise Bootstrap traits</h2><span id='topic+trait_summarise_boot_moments'></span>

<h3>Description</h3>

<p>Summarizes the mean and confidence interval for each
trait moment.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trait_summarise_boot_moments(
  bootstrap_moments,
  parametric = TRUE,
  sd_mult = 1,
  ci = 0.95
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trait_summarise_boot_moments_+3A_bootstrap_moments">bootstrap_moments</code></td>
<td>
<p>trait moments from trait_np_bootstrap or
trait_parametric_bootstrap</p>
</td></tr>
<tr><td><code id="trait_summarise_boot_moments_+3A_parametric">parametric</code></td>
<td>
<p>logical; default is TRUE.
Should Confidence Intervals be calculated parametrically
(using the mean and SD) or nonparametrically (using quantiles).</p>
</td></tr>
<tr><td><code id="trait_summarise_boot_moments_+3A_sd_mult">sd_mult</code></td>
<td>
<p>Number of standard deviations around each moment,
defaults to one</p>
</td></tr>
<tr><td><code id="trait_summarise_boot_moments_+3A_ci">ci</code></td>
<td>
<p>Desired confidence level for use when parametric is false.
Defaults to 0.95.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>tibble with the grouping variables and the mean of each moment
(+/- sd_mult * SD)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
data(community)
data(trait)

# Filter community data to make example faster
community &lt;- community |&gt;
  filter(PlotID %in% c("A", "B"))

filled_traits &lt;- trait_fill(
  comm = community,
  traits = trait,
  scale_hierarchy = c("Site", "PlotID"),
  taxon_col = "Taxon", value_col = "Value",
  trait_col = "Trait", abundance_col = "Cover"
)

# Note that more replicates and a greater sample size are advisable
# Here we set them low to make the example run quickly
boot_traits &lt;- trait_np_bootstrap(filled_traits,
  nrep = 20,
  sample_size = 100
)

trait_summarise_boot_moments(boot_traits)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
