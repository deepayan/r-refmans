<!DOCTYPE html><html lang="en"><head><title>Help for package murphydiagram</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {murphydiagram}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#Data+20sets'>
<p>Data sets with forecasts and realizations</p></a></li>
<li><a href='#Fluctuation+20Test'><p>Fluctuation test</p></a></li>
<li><a href='#Murphy+20Diagrams'><p>Murphy diagrams to visualize forecast comparisons</p></a></li>
<li><a href='#Scoring+20functions'><p>Scoring functions</p></a></li>
<li><a href='#Synthetic+20Example'><p>Analytical Expressions from the Synthetic Example in Section 3.3 and Appendix B</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Murphy Diagrams for Forecast Comparisons</td>
</tr>
<tr>
<td>Version:</td>
<td>0.12.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2019-12-06</td>
</tr>
<tr>
<td>Author:</td>
<td>Alexander Jordan, Fabian Krueger</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Fabian Krueger &lt;Fabian.Krueger83@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Data and code for the paper by Ehm, Gneiting, Jordan and
    Krueger ('Of Quantiles and Expectiles: Consistent Scoring Functions, Choquet
    Representations, and Forecast Rankings', JRSS-B, 2016 &lt;<a href="https://doi.org/10.1111%2Frssb.12154">doi:10.1111/rssb.12154</a>&gt;).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://sites.google.com/site/fk83research/code">https://sites.google.com/site/fk83research/code</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.0.0</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2019-12-06 14:20:58 UTC; fabian</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2019-12-06 15:30:08 UTC</td>
</tr>
</table>
<hr>
<h2 id='Data+20sets'>
Data sets with forecasts and realizations
</h2><span id='topic+inflation_mean'></span><span id='topic+recession_probability'></span>

<h3>Description</h3>

<p>Data sets with forecasts and corresponding realizations, as used in the paper by Ehm et al (2016). In the <a href="#topic+inflation_mean">inflation_mean</a> data, the outcome variable is continuous; in the <a href="#topic+recession_probability">recession_probability</a>
data, the outcome is binary.</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(inflation_mean)
data(recession_probability)
</code></pre>


<h3>Format</h3>

<p>Both data sets are data frames, with the following layout: First column contains the quarterly date, in string format (e.g. &quot;1998Q4&quot; for the fourth quarter of 1998). The second and third columns contain forecasts by two alternative methods. The fourth column contains realizations.</p>


<h3>Source</h3>

<p>Forecasts are generated as described in Section 4 of Ehm et al (2016).
</p>
<p>Data sources: Inflation - &ldquo;spf&rdquo; forecasts and realizations based on data from the Federal Reserve Bank of Philadelphia, <a href="http://www.phil.frb.org/research-and-data/real-time-center/">http://www.phil.frb.org/research-and-data/real-time-center/</a> 
(individual-level CPI forecasts, and real-time data for CPI realizations). &ldquo;michigan&rdquo; forecasts based on data from the Michigan Survey of Consumers, <a href="https://data.sca.isr.umich.edu/tables.php">https://data.sca.isr.umich.edu/tables.php</a>, Table 32. Recessions - &ldquo;spf&rdquo; forecasts and realizations based on data from the 
Federal Reserve Bank of Philadelphia, <a href="http://www.phil.frb.org/research-and-data/real-time-center/">http://www.phil.frb.org/research-and-data/real-time-center/</a> (&ldquo;anxious index&rdquo; and real-time data for real GDP growth). The Probit forecasts uses the same real-time data on GDP growth, as
well as interest rate data from the Federal Reserve Bank of St. Louis, <a href="http://research.stlouisfed.org/fred2/">http://research.stlouisfed.org/fred2/</a> (series TB3MS and GS10).
</p>
<p><em>Disclaimer: The providers of the raw data take no responsibility for the accuracy of the forecast and realization data sets posted here. Furthermore, the raw data may be revised over time, and the websites linked above 
should be consulted for the official, most recent versions.</em>
</p>
<p>Code and raw data to construct the two data sets can be found at <a href="https://sites.google.com/site/fk83research/code">https://sites.google.com/site/fk83research/code</a>.
</p>


<h3>References</h3>

<p>Ehm, W., Gneiting, T., Jordan, A. and Krueger, F. (2016): Of Quantiles and Expectiles: Consistent Scoring Functions, Choquet Representations, and Forecast Rankings. <em>Journal of the Royal Statistical Society (Series B)</em> 78, 1-29. doi: <a href="https://doi.org/10.1111/rssb.12154">10.1111/rssb.12154</a> (open access).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

# Load inflation forecasts
data(inflation_mean)

# Make numeric time axis
tm &lt;- as.numeric(substr(inflation_mean$dt, 1, 4)) + 
      0.25*(as.numeric(substr(inflation_mean$dt, 6, 6))-1)

# Plot
matplot(x = tm, y = inflation_mean[,2:4], type = "l", bty = "n",
        xlab = "Time", ylab= "Inflation (percent)", col = 3:1)
legend("topright", legend = c("SPF", "Michigan", "Actual"), fill = 3:1, bty = "n")


## End(Not run)

</code></pre>

<hr>
<h2 id='Fluctuation+20Test'>Fluctuation test</h2><span id='topic+fluctuation_test'></span>

<h3>Description</h3>

<p>Test to analyze whether the ranking of two forecasts is stable over time. The variant implemented here has been proposed in Proposition 1 of Giacomini and Rossi (2010); the critical values are tabulated in their Table 1. The null hypothesis of the test is that both forecasting methods perform equally well (same expected score) at all time points. The alternative is that their performance differs in at least one time point. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fluctuation_test(loss1, loss2, mu = 0.5, dmv_fullsample = TRUE,
                 lag_truncate = 0, time_labels = NULL,
                 conf_level = 0.05)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Fluctuation+2B20Test_+3A_loss1">loss1</code>, <code id="Fluctuation+2B20Test_+3A_loss2">loss2</code></td>
<td>
<p>Vectors of losses corresponding to two forecast methods (smaller losses correspond to better forecasts).</p>
</td></tr>
<tr><td><code id="Fluctuation+2B20Test_+3A_mu">mu</code></td>
<td>
<p>Size of the rolling window (relative to evaluation sample). Must be in 0.1, 0.2, ..., 0.9.</p>
</td></tr>
<tr><td><code id="Fluctuation+2B20Test_+3A_dmv_fullsample">dmv_fullsample</code></td>
<td>
<p>Logical; if <code>TRUE</code> (the default), the full sample is used to estimate the variance of the Diebold-Mariano type
statistic employed in the test. See page 14/footnote 16 in the working paper version of Rossi (2013).</p>
</td></tr>
<tr><td><code id="Fluctuation+2B20Test_+3A_lag_truncate">lag_truncate</code></td>
<td>
<p>Truncation lag used when estimating the variance of the Diebold-Mariano type test statistic.</p>
</td></tr>
<tr><td><code id="Fluctuation+2B20Test_+3A_time_labels">time_labels</code></td>
<td>
<p>Vector of labels to be used for the time axis. If <code>NULL</code> (the default), integer labels are used.</p>
</td></tr>
<tr><td><code id="Fluctuation+2B20Test_+3A_conf_level">conf_level</code></td>
<td>
<p>Confidence level, either <code>0.05</code> or <code>0.1</code> (two-sided test).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with two elements: 1) Data frame containing the time path of the test statistic, and 2) the relevant critical values. In addition, the function draws a plot which illustrates the test.
</p>


<h3>Author(s)</h3>

<p>Fabian Krueger
</p>


<h3>References</h3>

<p>Giacomini, R. and Rossi, B. (2010): Forecast Comparisons in Unstable Environments. Journal of Applied Econometrics 25, 595-620. doi: <a href="https://doi.org/10.1002/jae.1177">10.1002/jae.1177</a>
</p>
<p>Rossi, B. (2013): Advances in Forecasting under Model Instability. In: Handbook of Economic Forecasting, vol. 2, Graham Elliott and Alan Timmermann (eds), pp. 1203-1324. doi: <a href="https://doi.org/10.1016/b978-0-444-62731-5.00021-x">10.1016/b978-0-444-62731-5.00021-x</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Comparison of Inflation Forecasts: 
# Survey of  Professional Forecasters (SPF) 
# versus Michigan Survey of Consumers

data(inflation_mean)

# Compute extremal scores of SPF/Michigan (theta = 3)
score_spf &lt;- extremal_score(x = inflation_mean$spf, 
                            y = inflation_mean$rlz, theta = 3)
score_michigan &lt;- extremal_score(x = inflation_mean$michigan, 
                                 y = inflation_mean$rlz, theta = 3)

# Make simplified label for time axis
tml &lt;- as.numeric(substr(inflation_mean$dt, 1, 4))

# Fluctuation test
fluct_test &lt;- fluctuation_test(score_spf, score_michigan, 
                               time_labels = tml, lag_truncate = 4)

</code></pre>

<hr>
<h2 id='Murphy+20Diagrams'>Murphy diagrams to visualize forecast comparisons</h2><span id='topic+murphydiagram'></span><span id='topic+murphydiagram_diff'></span>

<h3>Description</h3>

<p>Visual comparisons of two forecasting methods, allowing to study whether the ranking is robust across the class of elementary or extremal
scoring functions. See Ehm et al (2016, esp. Sections 3 and 4) for details. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>murphydiagram(f1, f2, y, functional = "expectile", alpha = 0.5, 
labels = c("Method 1", "Method 2"), colors =  NULL, 
equally_spaced = FALSE)

murphydiagram_diff(f1, f2, y, functional = "expectile", 
alpha = 0.5, equally_spaced = FALSE, lag_truncate = 0, 
conf_level = 0.95)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Murphy+2B20Diagrams_+3A_f1">f1</code>, <code id="Murphy+2B20Diagrams_+3A_f2">f2</code></td>
<td>
<p>Vectors of point forecasts</p>
</td></tr>
<tr><td><code id="Murphy+2B20Diagrams_+3A_y">y</code></td>
<td>
<p>Vector of realizing observations.</p>
</td></tr>
<tr><td><code id="Murphy+2B20Diagrams_+3A_functional">functional</code></td>
<td>
<p>Either &quot;expectile&quot; (the default) or &quot;quantile&quot;. Note that the probability of a binary event is an expectile at level <code>alpha</code> = 0.5 (see below).</p>
</td></tr>
<tr><td><code id="Murphy+2B20Diagrams_+3A_alpha">alpha</code></td>
<td>
<p>Level of the expectile or quantile, must be between 0 and 1. Defaults to 0.5, which is the mean (if functional is set to &quot;expecile&quot;) or median (if functional is set to &quot;quantile&quot;). </p>
</td></tr>
<tr><td><code id="Murphy+2B20Diagrams_+3A_labels">labels</code></td>
<td>
<p>Method labels for <a href="#topic+murphydiagram">murphydiagram</a> to be used in plot legend. Character vector of length two, or <code>NULL</code> (in order to omit labels).</p>
</td></tr>
<tr><td><code id="Murphy+2B20Diagrams_+3A_colors">colors</code></td>
<td>
<p>Colors used. Defaults to NULL, such that the colors are as in Ehm et al (2016). Alternative colors can be specified as a character vector of length two.</p>
</td></tr>
<tr><td><code id="Murphy+2B20Diagrams_+3A_equally_spaced">equally_spaced</code></td>
<td>
<p>Method for choosing the grid of values on the horizontal axis. If set to FALSE (the default), the set of points that is relevant for dominance (c.f. Section 3.4 of the paper) is chosen. This can be somewhat time consuming for large data sets. If set to TRUE, an auxiliary grid of equally spaced points is used.</p>
</td></tr>
<tr><td><code id="Murphy+2B20Diagrams_+3A_lag_truncate">lag_truncate</code></td>
<td>
<p>Largest order of autocorrelation that is accounted for in the variance estimator for <a href="#topic+murphydiagram_diff">murphydiagram_diff</a> (defaults to zero).</p>
</td></tr>
<tr><td><code id="Murphy+2B20Diagrams_+3A_conf_level">conf_level</code></td>
<td>
<p>Level of the confidence bands plotted in <a href="#topic+murphydiagram_diff">murphydiagram_diff</a>, defaults to 0.95.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>None, used for the effect of creating a plot. <code>murphydiagram</code> plots the extremal scores of two forecasting methods. <code>murphydiagram_diff</code> plots the difference in the extremal scores of two forecasting methods, together with a confidence interval. 
</p>


<h3>Author(s)</h3>

<p>Fabian Krueger
</p>


<h3>References</h3>

<p>Ehm, W., Gneiting, T., Jordan, A. and Krueger, F. (2016): Of Quantiles and Expectiles: Consistent Scoring Functions, Choquet Representations, and Forecast Rankings. <em>Journal of the Royal Statistical Society (Series B)</em> 78, 1-29. doi: <a href="https://doi.org/10.1111/rssb.12154">10.1111/rssb.12154</a> (open access).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Comparison of Inflation Forecasts: Survey of Professional Forecasters (SPF) 
# versus Michigan Survey of Consumers

data(inflation_mean)
murphydiagram(inflation_mean$spf, inflation_mean$michigan, 
inflation_mean$rlz, labels = c("SPF", "Michigan"))
murphydiagram_diff(inflation_mean$spf, inflation_mean$michigan, 
inflation_mean$rlz, lag_truncate = 4)

</code></pre>

<hr>
<h2 id='Scoring+20functions'>Scoring functions</h2><span id='topic+extremal_score'></span><span id='topic+apl_score'></span><span id='topic+ase_score'></span>

<h3>Description</h3>

<p>Implementations of some scoring functions discussed in the paper.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extremal_score(x, y, theta, functional = "expectile", alpha = 0.5)

apl_score(x, y, alpha = 0.5)
ase_score(x, y, alpha = 0.5)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Scoring+2B20functions_+3A_x">x</code></td>
<td>
<p>Numeric vector of forecasts</p>
</td></tr>
<tr><td><code id="Scoring+2B20functions_+3A_y">y</code></td>
<td>
<p>Numeric vector of realizations (same length as <code>x</code>)</p>
</td></tr>
<tr><td><code id="Scoring+2B20functions_+3A_theta">theta</code></td>
<td>
<p>Threshold parameter for extremal score (must be a numeric scalar)</p>
</td></tr>
<tr><td><code id="Scoring+2B20functions_+3A_functional">functional</code></td>
<td>
<p>String, either &quot;expectile&quot; or &quot;quantile&quot;</p>
</td></tr>
<tr><td><code id="Scoring+2B20functions_+3A_alpha">alpha</code></td>
<td>
<p>Level of the quantile or expectile, must be a numeric scalar in the (0,1) interval</p>
</td></tr>
</table>


<h3>Value</h3>

<p>All functions return a vector of scores (same length as <code>x</code> and <code>y</code>). Smaller scores correspond to better forecasts. 
</p>
<p><code>extremal_score</code> is the scoring function defined in Equations (10) and (12) of Ehm et al (2016). <code>apl_score</code> is the asymmetric piecewise scoring function for quantiles, see Equation (6) in Ehm et al (2016). <code>ase_score</code> is the asymmetric squared error for expectiles, see Equation (8) in Ehm et al (2016).
</p>


<h3>Author(s)</h3>

<p>Fabian Krueger
</p>


<h3>References</h3>

<p>Ehm, W., Gneiting, T., Jordan, A. and Krueger, F. (2016): Of Quantiles and Expectiles: Consistent Scoring Functions, Choquet Representations, and Forecast Rankings. <em>Journal of the Royal Statistical Society (Series B)</em> 78, 1-29. doi: <a href="https://doi.org/10.1111/rssb.12154">10.1111/rssb.12154</a> (open access).
</p>

<hr>
<h2 id='Synthetic+20Example'>Analytical Expressions from the Synthetic Example in Section 3.3 and Appendix B</h2><span id='topic+expected_score_mean'></span><span id='topic+expected_score_quantile'></span>

<h3>Description</h3>

<p>Functions to compute the analytical expressions in Table 3 of the paper by Ehm et al (2016). These expressions yield the expected score of various forecasters, given the synthetic setup 
studied in Section 3.3 and Appendix B of the paper. The expressions can be used to replicate Figure 2 in the paper.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expected_score_mean(theta, forecaster = "P")
expected_score_quantile(theta, alpha, forecaster = "P")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Synthetic+2B20Example_+3A_theta">theta</code></td>
<td>
<p>Value of the parameter $theta$, indexing the extremal score</p>
</td></tr>
<tr><td><code id="Synthetic+2B20Example_+3A_alpha">alpha</code></td>
<td>
<p>Quantile level, between zero and one</p>
</td></tr>
<tr><td><code id="Synthetic+2B20Example_+3A_forecaster">forecaster</code></td>
<td>
<p>ID of the forecaster, string of length one. Either &quot;P&quot; (perfect forecaster), &quot;C&quot; (climatological forecaster), &quot;U&quot; (unfocused forecaster), or &quot;SR&quot; (sign-reversed forecaster).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Expected value of the extremal score, given the synthetic setup described in Section 3.3 of Ehm et al (2016).
</p>


<h3>Author(s)</h3>

<p>Alexander Jordan, Fabian Krueger
</p>


<h3>References</h3>

<p>Ehm, W., Gneiting, T., Jordan, A. and Krueger, F. (2016): Of Quantiles and Expectiles: Consistent Scoring Functions, Choquet Representations, and Forecast Rankings. <em>Journal of the Royal Statistical Society (Series B)</em> 78, 1-29. doi: <a href="https://doi.org/10.1111/rssb.12154">10.1111/rssb.12154</a> (open access).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
# Color palette, obtained from http://www.cookbook-r.com/Graphs/Colors_
cbbPalette &lt;- c("#000000", "#E69F00", "#56B4E9", "#009E73")
cbbPalette &lt;- cbbPalette[c(1, 4, 2, 3)]

# Labeling stuff
forecasters &lt;- c("P", "C", "U", "SR")
names &lt;- c("Perfect", "Climatological", "Unfocused", "Sign-Reversed")
x_label &lt;- expression(paste("Parameter ", theta))

# Figure 2, top left

# Grid for theta
theta_grid1 &lt;- seq(-3, 3, 0.01)
# Expected scores for all forecasters
scores1 &lt;- sapply(forecasters, expected_score_mean, theta = theta_grid1)
# Plot
matplot(x = theta_grid1, y = scores1[, 4:1], type = "l", lty = 1, col = cbbPalette[4:1], 
        lwd = 2, bty = "n", xlab = x_label, ylab = expression("Expected Score"))
legend("topright", names, col = cbbPalette, lwd = 2, bty = "n")

## End(Not run)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
