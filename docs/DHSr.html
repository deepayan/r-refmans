<!DOCTYPE html><html lang="en"><head><title>Help for package DHSr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {DHSr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#cluster_map'><p>Create Cluster Map Based on Local Moran's I</p></a></li>
<li><a href='#listw'><p>Create Spatial Weights List</p></a></li>
<li><a href='#Repglmre2'><p>Loop through all locations and run GLMM for each</p></a></li>
<li><a href='#Replm2'><p>Run Regression Analysis for All Locations</p></a></li>
<li><a href='#Replmre2'><p>Mixed-Effects Regression Analysis for All Locations</p></a></li>
<li><a href='#single_glmre2'><p>Mixed-Effects Logistic Regression Analysis for a Specified Location</p></a></li>
<li><a href='#single_lm2'><p>Linear Regression Analysis for Specified Location</p></a></li>
<li><a href='#single_lmre2'><p>Mixed-Effects Regression Analysis for Specified Location</p></a></li>
<li><a href='#Spdeplisa'><p>Calculate Local Moran's I and Sign Combination Variables</p></a></li>
<li><a href='#stein_beta'><p>Calculate Stein's Beta for Each Cluster</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Create Large Scale Repeated Regression Summary Statistics
Dataset and Visualization Seamlessly</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Arnab Samanta &lt;arnob.shamanta62@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Mapping, spatial analysis, and statistical modeling of microdata from sources such as the Demographic and Health Surveys <a href="https://www.dhsprogram.com/">https://www.dhsprogram.com/</a> and Integrated Public Use Microdata Series <a href="https://www.ipums.org/">https://www.ipums.org/</a>. It can also be extended to other datasets. The package supports spatial correlation index construction and visualization, along with empirical Bayes approximation of regression coefficients in a multistage setup.  The main functionality is repeated regression â€” for example, if we have to run regression for n groups, the group ID should be vertically composed into the variable for the parameter 'location_var'. It can perform various kinds of regression, such as Generalized Regression Models, logit, probit, and more. Additionally, it can incorporate interaction effects. The key benefit of the package is its ability to store the regression results performed repeatedly on a dataset by the group ID, along with respective p-values and map those estimates. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, ggplot2, rlang, sf, spdep, viridis, nlme, MuMIn, tidyr,
stats</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, spData, rmarkdown, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-09 17:34:14 UTC; 91911</td>
</tr>
<tr>
<td>Author:</td>
<td>Arnab Samanta [aut, cre] (&lt;arnob.shamanta62@gmail.com&gt;)</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-10 15:00:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='cluster_map'>Create Cluster Map Based on Local Moran's I</h2><span id='topic+cluster_map'></span>

<h3>Description</h3>

<p>This function creates a map of clusters based on Local Moran's I values. It identifies
clusters using Queen contiguity and visualizes them on a map.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cluster_map(
  dataset,
  lisa_value,
  lisa_label,
  label,
  lisa_cutoff,
  location_var,
  location_name,
  level2 = NULL,
  id_start = 0,
  comparison = "&gt;",
  min_area = 0,
  min_ = 5,
  title = "Clusters Based on Queen Contiguity",
  subtitle = "",
  footnote = "",
  legend_position = "bottom",
  color_scheme = "C"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cluster_map_+3A_dataset">dataset</code></td>
<td>
<p>A spatial dataset of class 'sf'.</p>
</td></tr>
<tr><td><code id="cluster_map_+3A_lisa_value">lisa_value</code></td>
<td>
<p>The name of the variable in the dataset containing Local Moran's I values.</p>
</td></tr>
<tr><td><code id="cluster_map_+3A_lisa_label">lisa_label</code></td>
<td>
<p>The name of the variable in the dataset containing the LISA label.</p>
</td></tr>
<tr><td><code id="cluster_map_+3A_label">label</code></td>
<td>
<p>The specific label to filter clusters.</p>
</td></tr>
<tr><td><code id="cluster_map_+3A_lisa_cutoff">lisa_cutoff</code></td>
<td>
<p>A numeric value specifying the cutoff for LISA values.</p>
</td></tr>
<tr><td><code id="cluster_map_+3A_location_var">location_var</code></td>
<td>
<p>The variable name indicating the primary location in the dataset.</p>
</td></tr>
<tr><td><code id="cluster_map_+3A_location_name">location_name</code></td>
<td>
<p>The name of the variable for the location names.</p>
</td></tr>
<tr><td><code id="cluster_map_+3A_level2">level2</code></td>
<td>
<p>An optional second level of location hierarchy. Default is 'NULL'.</p>
</td></tr>
<tr><td><code id="cluster_map_+3A_id_start">id_start</code></td>
<td>
<p>The starting value for cluster IDs. Default is '0'.</p>
</td></tr>
<tr><td><code id="cluster_map_+3A_comparison">comparison</code></td>
<td>
<p>The comparison operator for filtering ('&gt;', '&lt;', '&gt;=', etc.). Default is '&gt;'.</p>
</td></tr>
<tr><td><code id="cluster_map_+3A_min_area">min_area</code></td>
<td>
<p>Minimum area required for a cluster to be considered valid. Default is '0'.</p>
</td></tr>
<tr><td><code id="cluster_map_+3A_min_">min_</code></td>
<td>
<p>Minimum number of districts required for a cluster to be valid. Default is '5'.</p>
</td></tr>
<tr><td><code id="cluster_map_+3A_title">title</code></td>
<td>
<p>The title of the map. Default is '&quot;Clusters Based on Queen Contiguity&quot;'.</p>
</td></tr>
<tr><td><code id="cluster_map_+3A_subtitle">subtitle</code></td>
<td>
<p>A subtitle for the map. Default is '&quot;&quot;'.</p>
</td></tr>
<tr><td><code id="cluster_map_+3A_footnote">footnote</code></td>
<td>
<p>A footnote for the map. Default is '&quot;&quot;'.</p>
</td></tr>
<tr><td><code id="cluster_map_+3A_legend_position">legend_position</code></td>
<td>
<p>The position of the legend on the map. Default is '&quot;bottom&quot;'.</p>
</td></tr>
<tr><td><code id="cluster_map_+3A_color_scheme">color_scheme</code></td>
<td>
<p>The color scheme for the map. Default is '&quot;C&quot;'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the following components:
</p>
<table role = "presentation">
<tr><td><code>dataset_with_clusters</code></td>
<td>
<p>An 'sf' object containing the dataset with assigned cluster IDs.</p>
</td></tr>
<tr><td><code>summary_clusters</code></td>
<td>
<p>A data frame summarizing cluster information, including regions, area, and the number of locations.</p>
</td></tr>
<tr><td><code>plot</code></td>
<td>
<p>A 'ggplot' object for visualizing the clusters.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>if (requireNamespace("spData", quietly = TRUE)) {
  library(sf)
  library(dplyr)
  library(spdep)
  library(spData)
  library(ggplot2)

  # Load US states data from spData
  us_states &lt;- spData::us_states

  # Simplify for demonstration: Select a subset of columns
  us_states_data &lt;- us_states %&gt;%
    select(GEOID, NAME) %&gt;%
    mutate(mean_wealth = rnorm(nrow(us_states), 50, 10))  # Add mock data

  # Define a shapefile path
  shapefile_path &lt;- tempfile(fileext = ".shp")
  sf::st_write(us_states, shapefile_path, quiet = TRUE)

  # Corrected listw function call using your package
  us_states_listw &lt;- DHSr::listw(
    shapefile_path = shapefile_path,
    data = us_states_data %&gt;% sf::st_drop_geometry(),  # Drop geometry for compatibility
    loc_shape = "GEOID",
    loc_data = "GEOID",
    weight_function = function(d) exp(-d / 0.2)
  )

  # Apply Spdeplisa function
  lisa_result &lt;- DHSr::Spdeplisa(
    data = us_states_data,
    variable_name = "mean_wealth",
    listw = us_states_listw
  )

  # Add LISA labels
  lisa_result &lt;- lisa_result %&gt;%
    mutate(lisa_label = case_when(
      lisa_I &gt; 0 ~ "High-High",
      lisa_I &lt; 0 ~ "Low-Low",
      TRUE ~ "Others"
    ))

  # Apply cluster_map function
  cluster_map_result &lt;- DHSr::cluster_map(
    dataset = lisa_result,
    lisa_value = "lisa_I",
    lisa_label = "lisa_label",
    label = "High-High",
    lisa_cutoff = 0.5,
    location_var = "GEOID",
    location_name = "NAME",
    id_start = 1,
    comparison = "&gt;",
    min_area = 0,
    min_ = 3,  # Reduced for smaller demonstration
    title = "Clusters Based on Queen Contiguity",
    subtitle = "High-High Clusters",
    footnote = "Generated using DHSr package",
    legend_position = "bottom",
    color_scheme = "C"
  )

  # View the resulting dataset with clusters
  head(cluster_map_result$dataset_with_clusters)

  # View the cluster summary
  print(cluster_map_result$summary_clusters)

  # Plot the clusters
  print(cluster_map_result$plot)
}
</code></pre>

<hr>
<h2 id='listw'>Create Spatial Weights List</h2><span id='topic+listw'></span>

<h3>Description</h3>

<p>This function creates a spatial weights list using a shapefile and a dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>listw(
  shapefile_path,
  data,
  loc_shape,
  loc_data,
  weight_function = function(d) exp(-d/0.2)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="listw_+3A_shapefile_path">shapefile_path</code></td>
<td>
<p>A string specifying the file path to the shapefile.</p>
</td></tr>
<tr><td><code id="listw_+3A_data">data</code></td>
<td>
<p>A dataframe containing the variables to be analyzed.</p>
</td></tr>
<tr><td><code id="listw_+3A_loc_shape">loc_shape</code></td>
<td>
<p>A string specifying the column name in the shapefile used for merging.</p>
</td></tr>
<tr><td><code id="listw_+3A_loc_data">loc_data</code></td>
<td>
<p>A string specifying the column name in the dataset that corresponds to the location variable.</p>
</td></tr>
<tr><td><code id="listw_+3A_weight_function">weight_function</code></td>
<td>
<p>A function to calculate weights from distances. Defaults to 'function(d) exp(-d / 0.2)'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A spatial weights list object of class 'listw'.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if (requireNamespace("spData", quietly = TRUE)) {
    library(dplyr)
    library(sf)

    # Load US states data
    us_states &lt;- spData::us_states

    # Simplify for demonstration: Select a subset of columns
    us_states_data &lt;- us_states %&gt;%
        select(GEOID, NAME) %&gt;%
        mutate(mean_wealth = rnorm(nrow(us_states), 50, 10))  # Add mock data

    # Define a temporary shapefile path
    shapefile_path &lt;- tempfile(fileext = ".shp")
    sf::st_write(us_states, shapefile_path, quiet = TRUE)

    # Use the listw function from the package
    us_states_listw &lt;- DHSr::listw(
        shapefile_path = shapefile_path,
        data = us_states_data %&gt;% sf::st_drop_geometry(),  # Drop geometry for compatibility
        loc_shape = "GEOID",
        loc_data = "GEOID",
        weight_function = function(d) exp(-d / 0.2)
    )

    # Verify the spatial weights list
    print(us_states_listw)
}
</code></pre>

<hr>
<h2 id='Repglmre2'>Loop through all locations and run GLMM for each</h2><span id='topic+Repglmre2'></span>

<h3>Description</h3>

<p>This function runs a mixed-effects generalized linear model (GLMM) for each location within a dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Repglmre2(data, formula, location_var, random_effect_var, family)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Repglmre2_+3A_data">data</code></td>
<td>
<p>The dataset to be analyzed.</p>
</td></tr>
<tr><td><code id="Repglmre2_+3A_formula">formula</code></td>
<td>
<p>The formula for the regression model.</p>
</td></tr>
<tr><td><code id="Repglmre2_+3A_location_var">location_var</code></td>
<td>
<p>The variable indicating different locations (e.g., 'REGCODE').</p>
</td></tr>
<tr><td><code id="Repglmre2_+3A_random_effect_var">random_effect_var</code></td>
<td>
<p>The variable to be used as a random effect (e.g., 'hhid').</p>
</td></tr>
<tr><td><code id="Repglmre2_+3A_family">family</code></td>
<td>
<p>The family to be used for GLM (e.g., 'binomial' for logistic regression, 'poisson' for Poisson regression).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A dataframe containing the results
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(123)

# Create dummy data
  library(dplyr)
dummy_data &lt;- data.frame(
  years_education = rnorm(100, 12, 3),    # Represents years of education
  gender_female = rbinom(100, 1, 0.5),    # 1 = Female, 0 = Male
  household_wealth = sample(1:5, 100, replace = TRUE),  # Wealth index from 1 to 5
  district_code = sample(1:10, 100, replace = TRUE)     # Represents district codes
) %&gt;% arrange(district_code)

# Create HHid (Household ID), grouping every 3-4 records, and convert to character
dummy_data$HHid &lt;- as.character(rep(1:20, each = 5, length.out = nrow(dummy_data)))

# Create a binary outcome variable for years of education
dummy_data$education_binary &lt;- ifelse(dummy_data$years_education &gt; 11, 1, 0)

# Define a logistic regression formula
formula &lt;- education_binary ~ gender_female + household_wealth:gender_female

location_var &lt;- "district_code"
random_effect_var &lt;- "HHid"

# Run the logistic mixed-effects model across all locations (districts)
results &lt;- DHSr::Repglmre2(data = dummy_data, formula = formula,
                           location_var = location_var, random_effect_var = random_effect_var,
                           family = binomial())

# Print the results
print(head(results))
</code></pre>

<hr>
<h2 id='Replm2'>Run Regression Analysis for All Locations</h2><span id='topic+Replm2'></span>

<h3>Description</h3>

<p>This function runs a regression model for all unique locations within a dataset and combines the results.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Replm2(
  data,
  formula,
  location_var,
  response_distribution = "normal",
  family = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Replm2_+3A_data">data</code></td>
<td>
<p>The dataset to be analyzed.</p>
</td></tr>
<tr><td><code id="Replm2_+3A_formula">formula</code></td>
<td>
<p>The formula for the regression model.</p>
</td></tr>
<tr><td><code id="Replm2_+3A_location_var">location_var</code></td>
<td>
<p>The variable indicating different locations (e.g., 'REGCODE').</p>
</td></tr>
<tr><td><code id="Replm2_+3A_response_distribution">response_distribution</code></td>
<td>
<p>The distribution of the response variable (&quot;normal&quot; for normal distribution, &quot;other&quot; for other distributions).</p>
</td></tr>
<tr><td><code id="Replm2_+3A_family">family</code></td>
<td>
<p>The family to be used for GLM if response_distribution is &quot;other&quot; (e.g., 'binomial' for logistic regression).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A dataframe containing the combined results for all locations.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(123)
library(dplyr)
dummy_data &lt;- data.frame(
  years_education = rnorm(100, 12, 3),    # Represents years of education
  gender_female = rbinom(100, 1, 0.5),    # 1 = Female, 0 = Male
  household_wealth = sample(1:5, 100, replace = TRUE),  # Wealth index from 1 to 5
  district_code = sample(1:10, 100, replace = TRUE) # Represents district codes
) %&gt;% arrange(district_code)

# Define a simple regression formula
formula &lt;- years_education ~ gender_female + household_wealth + household_wealth:gender_female

# Run the regression across all locations (districts)
results1 &lt;- Replm2(dummy_data, formula, "district_code", "normal")
print(results1)
</code></pre>

<hr>
<h2 id='Replmre2'>Mixed-Effects Regression Analysis for All Locations</h2><span id='topic+Replmre2'></span>

<h3>Description</h3>

<p>This function runs a mixed-effects regression model for all locations within a dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Replmre2(data, formula, location_var, random_effect_var)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Replmre2_+3A_data">data</code></td>
<td>
<p>The dataset to be analyzed.</p>
</td></tr>
<tr><td><code id="Replmre2_+3A_formula">formula</code></td>
<td>
<p>The formula for the regression model.</p>
</td></tr>
<tr><td><code id="Replmre2_+3A_location_var">location_var</code></td>
<td>
<p>The variable indicating different locations (e.g., 'REGCODE').</p>
</td></tr>
<tr><td><code id="Replmre2_+3A_random_effect_var">random_effect_var</code></td>
<td>
<p>The variable to be used as a random effect (e.g., 'hhid').</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A dataframe containing the results
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(123)
library(dplyr)
# Create dummy data
dummy_data &lt;- data.frame(
  years_education = rnorm(100, 12, 3),    # Represents years of education
  gender_female = rbinom(100, 1, 0.5),    # 1 = Female, 0 = Male
  household_wealth = sample(1:5, 100, replace = TRUE),  # Wealth index from 1 to 5
  district_code = sample(1:10, 100, replace = TRUE)     # Represents district codes
) %&gt;% arrange(district_code)

# Create HHid (Household ID), grouping every 3-4 records, and convert to character
dummy_data$HHid &lt;- as.character(rep(1:20, each = 5, length.out = nrow(dummy_data)))

# Define a simple regression formula
formula &lt;- years_education ~ gender_female + household_wealth:gender_female
location_var &lt;- "district_code"
random_effect_var &lt;- "HHid"

# Run mixed-effects regression for all districts
results &lt;- DHSr::Replmre2(dummy_data, formula, location_var, random_effect_var)
print(head(results))
</code></pre>

<hr>
<h2 id='single_glmre2'>Mixed-Effects Logistic Regression Analysis for a Specified Location</h2><span id='topic+single_glmre2'></span>

<h3>Description</h3>

<p>This function runs a mixed-effects logistic regression model for a specified location within a dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>single_glmre2(
  data,
  formula,
  location_var,
  random_effect_var,
  location_index,
  family = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="single_glmre2_+3A_data">data</code></td>
<td>
<p>The dataset to be analyzed.</p>
</td></tr>
<tr><td><code id="single_glmre2_+3A_formula">formula</code></td>
<td>
<p>The formula for the regression model.</p>
</td></tr>
<tr><td><code id="single_glmre2_+3A_location_var">location_var</code></td>
<td>
<p>The variable indicating different locations (e.g., 'REGCODE').</p>
</td></tr>
<tr><td><code id="single_glmre2_+3A_random_effect_var">random_effect_var</code></td>
<td>
<p>The variable to be used as a random effect (e.g., 'hhid').</p>
</td></tr>
<tr><td><code id="single_glmre2_+3A_location_index">location_index</code></td>
<td>
<p>The specific location index or number for which the model should be run.</p>
</td></tr>
<tr><td><code id="single_glmre2_+3A_family">family</code></td>
<td>
<p>The family to be used for GLM (e.g., 'binomial' for logistic regression).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The results for sigle location to test
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(123)
  library(dplyr)
# Create dummy data
dummy_data &lt;- data.frame(
  years_education = rnorm(100, 12, 3),    # Represents years of education
  gender_female = rbinom(100, 1, 0.5),    # 1 = Female, 0 = Male
  household_wealth = sample(1:5, 100, replace = TRUE),  # Wealth index from 1 to 5
  district_code = sample(1:10, 100, replace = TRUE)     # Represents district codes
) %&gt;% arrange(district_code)

# Create HHid (Household ID), grouping every 3-4 records, and convert to character
dummy_data$HHid &lt;- as.character(rep(1:20, each = 5, length.out = nrow(dummy_data)))

# Create a binary outcome variable for years of education
dummy_data$education_binary &lt;- ifelse(dummy_data$years_education &gt; 11, 1, 0)

# Define a logistic regression formula
formula &lt;- education_binary ~ gender_female + household_wealth:gender_female

# Set the location and random effect variables
location_var &lt;- "district_code"
random_effect_var &lt;- "HHid"

# Run the mixed-effects logistic regression for a specific location (e.g., district 1)
result_single_glmre &lt;- single_glmre2(dummy_data, formula, location_var, random_effect_var,
 location_index = 1, family = binomial())

# View the result
print(result_single_glmre)
</code></pre>

<hr>
<h2 id='single_lm2'>Linear Regression Analysis for Specified Location</h2><span id='topic+single_lm2'></span>

<h3>Description</h3>

<p>This function runs a linear regression model for a specified location within a dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>single_lm2(
  data,
  formula,
  location_var,
  response_distribution = "normal",
  family = NULL,
  location_index
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="single_lm2_+3A_data">data</code></td>
<td>
<p>The dataset to be analyzed.</p>
</td></tr>
<tr><td><code id="single_lm2_+3A_formula">formula</code></td>
<td>
<p>The formula for the regression model.</p>
</td></tr>
<tr><td><code id="single_lm2_+3A_location_var">location_var</code></td>
<td>
<p>The variable indicating different locations (e.g., 'REGCODE').</p>
</td></tr>
<tr><td><code id="single_lm2_+3A_response_distribution">response_distribution</code></td>
<td>
<p>The distribution of the response variable (&quot;normal&quot; for normal distribution, &quot;other&quot; for other distributions).</p>
</td></tr>
<tr><td><code id="single_lm2_+3A_family">family</code></td>
<td>
<p>The family to be used for GLM if response_distribution is &quot;other&quot; (e.g., 'binomial' for logistic regression).</p>
</td></tr>
<tr><td><code id="single_lm2_+3A_location_index">location_index</code></td>
<td>
<p>The specific location index or number for which the model should be run.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A dataframe containing the results for the specified location.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(123)
if (requireNamespace("dplyr", quietly = TRUE)) {
  library(dplyr)
# Create dummy data
dummy_data &lt;- data.frame(
  years_education = rnorm(100, 12, 3),    # Represents years of education
  gender_female = rbinom(100, 1, 0.5),    # 1 = Female, 0 = Male
  household_wealth = sample(1:5, 100, replace = TRUE),  # Wealth index from 1 to 5
  district_code = sample(1:10, 100, replace = TRUE)     # Represents district codes
) %&gt;% arrange(district_code)

# Define a simple regression formula
formula &lt;- years_education ~ gender_female + household_wealth + household_wealth:gender_female

# Run the regression for a specific location (e.g., district 1)
result_single_lm &lt;- single_lm2(dummy_data, formula, "district_code",
 response_distribution = "normal", location_index = 1)

# View the result
print(result_single_lm)
}
</code></pre>

<hr>
<h2 id='single_lmre2'>Mixed-Effects Regression Analysis for Specified Location</h2><span id='topic+single_lmre2'></span>

<h3>Description</h3>

<p>This function runs a mixed-effects regression model for a specified location within a dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>single_lmre2(data, formula, location_var, random_effect_var, location_index)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="single_lmre2_+3A_data">data</code></td>
<td>
<p>The dataset to be analyzed.</p>
</td></tr>
<tr><td><code id="single_lmre2_+3A_formula">formula</code></td>
<td>
<p>The formula for the regression model.</p>
</td></tr>
<tr><td><code id="single_lmre2_+3A_location_var">location_var</code></td>
<td>
<p>The variable indicating different locations (e.g., 'REGCODE').</p>
</td></tr>
<tr><td><code id="single_lmre2_+3A_random_effect_var">random_effect_var</code></td>
<td>
<p>The variable to be used as a random effect (e.g., 'hhid').</p>
</td></tr>
<tr><td><code id="single_lmre2_+3A_location_index">location_index</code></td>
<td>
<p>The specific location index or number for which the model should be run.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the results for the specified location to test
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(123)
library(dplyr)
# Create dummy data
dummy_data &lt;- data.frame(
  years_education = rnorm(100, 12, 3),    # Represents years of education
  gender_female = rbinom(100, 1, 0.5),    # 1 = Female, 0 = Male
  household_wealth = sample(1:5, 100, replace = TRUE),  # Wealth index from 1 to 5
  district_code = sample(1:10, 100, replace = TRUE)     # Represents district codes
) %&gt;% arrange(district_code)

# Create HHid (Household ID), grouping every 3-4 records, and convert to character
dummy_data$HHid &lt;- as.character(rep(1:20, each = 5, length.out = nrow(dummy_data)))

# Define a simple regression formula
formula &lt;- years_education ~ gender_female + household_wealth:gender_female

# Set the location and random effect variables
location_var &lt;- "district_code"
random_effect_var &lt;- "HHid"

# Run the mixed-effects regression for a specific location (e.g., district 1)
result_single_lmre &lt;- single_lmre2(dummy_data, formula, location_var,
random_effect_var, location_index = 1)

# View the result
print(result_single_lmre)
</code></pre>

<hr>
<h2 id='Spdeplisa'>Calculate Local Moran's I and Sign Combination Variables</h2><span id='topic+Spdeplisa'></span>

<h3>Description</h3>

<p>This function calculates Local Moran's I for a specified variable in a dataset
and creates sign combination variables based on the standardized variable
and the local Moran's I values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Spdeplisa(data, variable_name, listw)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Spdeplisa_+3A_data">data</code></td>
<td>
<p>A dataframe containing the spatial data.</p>
</td></tr>
<tr><td><code id="Spdeplisa_+3A_variable_name">variable_name</code></td>
<td>
<p>A string representing the name of the variable to be analyzed.</p>
</td></tr>
<tr><td><code id="Spdeplisa_+3A_listw">listw</code></td>
<td>
<p>A listw object containing spatial weights for the dataset.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame containing the original data with additional columns:
</p>
<table role = "presentation">
<tr><td><code>lisa_I</code></td>
<td>
<p>Local Moran's I values for the specified variable.</p>
</td></tr>
<tr><td><code>lisa_p</code></td>
<td>
<p>P-values corresponding to the Local Moran's I values.</p>
</td></tr>
<tr><td><code>z_i</code></td>
<td>
<p>Standardized values of the input variable.</p>
</td></tr>
<tr><td><code>sign_combination2</code></td>
<td>
<p>Categories based on the sign of z_i and lisa_I (e.g., &quot;positive-negative&quot;).</p>
</td></tr>
<tr><td><code>sign_combination3</code></td>
<td>
<p>Categories based on the sign of z_i and lisa_I (e.g., &quot;High-High&quot;).</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'># Load necessary libraries
if (requireNamespace("spData", quietly = TRUE)) {
  library(spData)
  library(sf)
  library(dplyr)

  # Use US states data as a substitute for a shapefile
  us_states &lt;- spData::us_states

  # Simplify for demonstration: Select a subset of columns
  us_states_data &lt;- us_states %&gt;%
    select(GEOID, NAME) %&gt;%
    mutate(mean_wealth = rnorm(nrow(us_states), 50, 10))  # Add mock data

  # Define a temporary shapefile path
  shapefile_path &lt;- tempfile(fileext = ".shp")
  sf::st_write(us_states, shapefile_path, quiet = TRUE)

  # Create spatial weights using the listw function from the package
  us_states_listw &lt;- DHSr::listw(
    shapefile_path = shapefile_path,
    data = us_states_data %&gt;% sf::st_drop_geometry(),  # Drop geometry for compatibility
    loc_shape = "GEOID",
    loc_data = "GEOID",
    weight_function = function(d) exp(-d / 0.2)
  )

  # Apply the Spdeplisa function
  lisa_result &lt;- DHSr::Spdeplisa(
    data = us_states_data,
    variable_name = "mean_wealth",
    listw = us_states_listw
  )

  # View the result
  head(lisa_result)
}
</code></pre>

<hr>
<h2 id='stein_beta'>Calculate Stein's Beta for Each Cluster</h2><span id='topic+stein_beta'></span>

<h3>Description</h3>

<p>This function calculates Stein's Beta for each cluster within the dataset.
It applies Stein's shrinkage estimator to the specified beta estimates within each cluster.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stein_beta(data, cluster_id, beta)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="stein_beta_+3A_data">data</code></td>
<td>
<p>A dataframe containing the data.</p>
</td></tr>
<tr><td><code id="stein_beta_+3A_cluster_id">cluster_id</code></td>
<td>
<p>The name of the column representing the cluster IDs.</p>
</td></tr>
<tr><td><code id="stein_beta_+3A_beta">beta</code></td>
<td>
<p>The name of the column representing the beta estimates.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame containing the input data with additional columns:
</p>
<table role = "presentation">
<tr><td><code>stein_beta</code></td>
<td>
<p>The Stein-shrinkage adjusted beta values.</p>
</td></tr>
<tr><td><code>lambda_d</code></td>
<td>
<p>Shrinkage factors for each cluster.</p>
</td></tr>
<tr><td><code>mu_beta_m</code></td>
<td>
<p>Mean beta values for each cluster.</p>
</td></tr>
<tr><td><code>sigma_hat_sq</code></td>
<td>
<p>Estimated variance of the beta values within clusters.</p>
</td></tr>
<tr><td><code>sum_of_squares</code></td>
<td>
<p>Sum of squared deviations of beta values from their mean.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'># Create dummy data
library(dplyr)
set.seed(123)
dummy_data &lt;- data.frame(
  years_education = rnorm(100, 12, 3),    # Represents years of education
  gender_female = rbinom(100, 1, 0.5),    # 1 = Female, 0 = Male
  household_wealth = sample(1:5, 100, replace = TRUE),  # Wealth index from 1 to 5
  district_code = sample(1:10, 100, replace = TRUE)     # Represents district codes
) %&gt;% arrange(district_code)

# Define a regression formula
formula &lt;- years_education ~ gender_female + household_wealth + household_wealth:gender_female

# Run the regression for all districts
results1 &lt;- DHSr::Replm2(dummy_data, formula, "district_code", "normal")

# Assign random clusters for demonstration
clusters &lt;- data.frame(
  district_code = unique(dummy_data$district_code),
  cluster_id = sample(1:3, length(unique(dummy_data$district_code)), replace = TRUE)
)

# Merge clusters with regression results
cluster_beta &lt;- merge(clusters, results1, by.x = "district_code", by.y = "location")

# Apply Stein Beta shrinkage
results_with_stein_beta &lt;- DHSr::stein_beta(
  data = cluster_beta,
  cluster_id = "cluster_id",                # Column for cluster IDs
  beta = "estimate_gender_female"          # Column for beta estimates
)

# View results
print(head(results_with_stein_beta))
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
