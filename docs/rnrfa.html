<!DOCTYPE html><html><head><title>Help for package rnrfa</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {rnrfa}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#catalogue'><p>List of stations from UK NRFA</p></a></li>
<li><a href='#cmr'><p>This function retrieves Catchment Mean Rainfall (cmr).</p></a></li>
<li><a href='#convert_flow'><p>Convert flow from cumecs to mm/d</p></a></li>
<li><a href='#gdf'><p>This function retrieves Gauged Daily Flow (gdf).</p></a></li>
<li><a href='#get_ts'><p>This function retrieves time series data.</p></a></li>
<li><a href='#osg_parse'><p>Converts OS Grid Reference to BNG/WGS coordinates.</p></a></li>
<li><a href='#plot_rain_flow'><p>Plot rainfall and flow for a given station</p></a></li>
<li><a href='#plot_trend'><p>Plot trend</p></a></li>
<li><a href='#rnrfa-package'><p>UK National River Flow Archive data from R</p></a></li>
<li><a href='#seasonal_averages'><p>Calculate seasonal averages</p></a></li>
<li><a href='#station_ids'><p>List of stations identification numbers from UK NRFA</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>UK National River Flow Archive Data from R</td>
</tr>
<tr>
<td>Version:</td>
<td>2.1.0.5</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://ilapros.github.io/rnrfa/">https://ilapros.github.io/rnrfa/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ilapros/rnrfa/issues">https://github.com/ilapros/rnrfa/issues</a></td>
</tr>
<tr>
<td>Description:</td>
<td>Utility functions to retrieve data from the UK National River Flow Archive (<a href="https://nrfa.ceh.ac.uk/">https://nrfa.ceh.ac.uk/</a>, terms and conditions: <a href="https://nrfa.ceh.ac.uk/costs-terms-and-conditions">https://nrfa.ceh.ac.uk/costs-terms-and-conditions</a>). The package contains R wrappers to the UK NRFA data temporary-API. There are functions to retrieve stations falling in a bounding box, to generate a map and extracting time series and general information. The package is fully  described in Vitolo et al (2016) "rnrfa: An R package to Retrieve, Filter and Visualize Data from the UK National River Flow Archive" <a href="https://journal.r-project.org/archive/2016/RJ-2016-036/RJ-2016-036.pdf">https://journal.r-project.org/archive/2016/RJ-2016-036/RJ-2016-036.pdf</a>.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5)</td>
</tr>
<tr>
<td>Imports:</td>
<td>curl, jsonlite, lubridate, graphics, stats, httr, zoo, ggmap
(&ge; 4.0.0), ggplot2, sf, parallel, tibble</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, knitr, covr, lintr, rmarkdown, DT, leaflet,
devtools, dygraphs, V8</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-14 21:06:54 UTC; ilari</td>
</tr>
<tr>
<td>Author:</td>
<td>Ilaria Prosdocimi <a href="https://orcid.org/0000-0001-8565-094X"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb, cre],
  Claudia Vitolo <a href="https://orcid.org/0000-0002-4252-1176"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut] (Claudia is the original creator of the package),
  Matthew Fry [ctb] (Matthew supervised the unofficial API integration.),
  Wouter Buytaert [ctb] (This package is part of Claudia Vitolo's PhD
    work and Wouter is the supervisor.),
  Michael Spencer [ctb] (Michael updated the function osg_parse to work
    with grid references of different lengths.),
  Tobias Gauster [ctb] (Tobias improved the function osg_parse
    introducing vectorisation)</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Ilaria Prosdocimi &lt;prosdocimi.ilaria@gmail.com&gt;</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-02-15 01:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='catalogue'>List of stations from UK NRFA</h2><span id='topic+catalogue'></span>

<h3>Description</h3>

<p>This function pulls the list of stations (and related metadata),
falling within a given bounding box, from the CEH National River Flow Archive
website.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>catalogue(
  bbox = NULL,
  column_name = NULL,
  column_value = NULL,
  min_rec = NULL,
  all = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="catalogue_+3A_bbox">bbox</code></td>
<td>
<p>this is a geographical bounding box (e.g. list(lon_min = -3.82,
lon_max = -3.63, lat_min = 52.43, lat_max = 52.52))</p>
</td></tr>
<tr><td><code id="catalogue_+3A_column_name">column_name</code></td>
<td>
<p>name of column to filter</p>
</td></tr>
<tr><td><code id="catalogue_+3A_column_value">column_value</code></td>
<td>
<p>string to search in column_name</p>
</td></tr>
<tr><td><code id="catalogue_+3A_min_rec">min_rec</code></td>
<td>
<p>minimum number of recording years</p>
</td></tr>
<tr><td><code id="catalogue_+3A_all">all</code></td>
<td>
<p>if TRUE it returns all the available metadata. If FALSE, it
returns only the following columns: id, name, river, hydrometricArea,
catchmentArea, lat, lon, selected feh catchment descriptors.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>coordinates of bounding box are required in WGS84 (EPSG: 4326).
If BB coordinates are missing, the function returns the list corresponding to
the maximum extent of the network.
</p>


<h3>Value</h3>

<p>tibble table containing the list of stations and related metadata
</p>


<h3>Author(s)</h3>

<p>Claudia Vitolo
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  # Retrieve all the stations in the network
  x &lt;- catalogue()

  # Define a bounding box:
  bbox &lt;- list(lon_min=-3.82, lon_max=-3.63, lat_min=52.43, lat_max=52.52)
  # Get stations within the bounding box
  x &lt;- catalogue(bbox)

  # Get stations based on minimum catchment area
  x &lt;- catalogue(column_name = "catchment-area", column_value = 2000)

  # Get stations based on minimum number of recording years
  x &lt;- catalogue(min_rec=30)

## End(Not run)

</code></pre>

<hr>
<h2 id='cmr'>This function retrieves Catchment Mean Rainfall (cmr).</h2><span id='topic+cmr'></span>

<h3>Description</h3>

<p>Given the station ID number(s), this function retrieves data
(time series in zoo format with accompanying metadata) from the WaterML2
service on the NRFA database. Catchment Mean Rainfall is measured in
mm/month.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cmr(id, metadata = FALSE, cl = NULL, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cmr_+3A_id">id</code></td>
<td>
<p>station ID number(s), each number should be in the range
[3002,236051].</p>
</td></tr>
<tr><td><code id="cmr_+3A_metadata">metadata</code></td>
<td>
<p>Logical, FALSE by default. If metadata = TRUE means that the
result for a single station is a list with two elements:
data (the time series) and meta (metadata).</p>
</td></tr>
<tr><td><code id="cmr_+3A_cl">cl</code></td>
<td>
<p>(optional) This is a cluster object, created by the parallel
package. This is set to NULL by default, which sends sequential calls to the
server.</p>
</td></tr>
<tr><td><code id="cmr_+3A_verbose">verbose</code></td>
<td>
<p>(FALSE by default). If set to TRUE prints GET request on the
console.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list composed of as many objects as in the list of station ID
numbers. Each object can be accessed using their names or index
(e.g. x[[1]], x[[2]], and so forth). Each object contains a zoo time series.
</p>


<h3>Author(s)</h3>

<p>Claudia Vitolo
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  cmr(18019)
  cmr(c(54022,54090,54091))

## End(Not run)
</code></pre>

<hr>
<h2 id='convert_flow'>Convert flow from cumecs to mm/d</h2><span id='topic+convert_flow'></span>

<h3>Description</h3>

<p>This function converts flow time series from cumecs (m3/s) to
mm/d by dividing the flow by the catchment area and converting it to mm/day.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>convert_flow(flow_cumecs, catchment_area)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="convert_flow_+3A_flow_cumecs">flow_cumecs</code></td>
<td>
<p>This is the flow time series in cumecs (m3/s)</p>
</td></tr>
<tr><td><code id="convert_flow_+3A_catchment_area">catchment_area</code></td>
<td>
<p>This is the catchment are in Km2.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Flow time series in mm/d
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  convert_flow(30, 2)

## End(Not run)

</code></pre>

<hr>
<h2 id='gdf'>This function retrieves Gauged Daily Flow (gdf).</h2><span id='topic+gdf'></span>

<h3>Description</h3>

<p>Given the station ID number(s), this function retrieves data
(time series in zoo format with accompanying metadata) from the WaterML2
service on the NRFA database. Gauged Daily Flow is measured in <code class="reqn">m^3</code>/s.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gdf(id, metadata = FALSE, cl = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gdf_+3A_id">id</code></td>
<td>
<p>station ID number(s), each number should be in the range
[3002,236051].</p>
</td></tr>
<tr><td><code id="gdf_+3A_metadata">metadata</code></td>
<td>
<p>Logical, FALSE by default. If metadata = TRUE means that the
result for a single station is a list with two elements:
data (the time series) and meta (metadata).</p>
</td></tr>
<tr><td><code id="gdf_+3A_cl">cl</code></td>
<td>
<p>(optional) This is a cluster object, created by the parallel
package. This is set to NULL by default, which sends sequential calls to the
server.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list composed of as many objects as in the list of station ID
numbers. Each object can be accessed using their names or index
(e.g. x[[1]], x[[2]], and so forth). Each object contains a zoo time series.
</p>


<h3>Author(s)</h3>

<p>Claudia Vitolo
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  gdf(18019)
  gdf(c(54022,54090,54091))

## End(Not run)

</code></pre>

<hr>
<h2 id='get_ts'>This function retrieves time series data.</h2><span id='topic+get_ts'></span>

<h3>Description</h3>

<p>Given the station identification number(s), this function
retrieves data (time series in zoo format with accompanying metadata) from
the WaterML2 service on the NRFA database. The time series can be of two
types: <code>cmr</code> (catchment mean rainfall, monthly) or <code>gdf</code>
(gauged daily flows, daily).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_ts(id, type, metadata = FALSE, cl = NULL, full_info = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_ts_+3A_id">id</code></td>
<td>
<p>station identification number(s), each number should be in the
range [3002,236051].</p>
</td></tr>
<tr><td><code id="get_ts_+3A_type">type</code></td>
<td>
<p>The following data-types are available:
</p>

<ul>
<li><p> gdf = Gauged daily flows
</p>
</li>
<li><p> gmf = Gauged monthly flows
</p>
</li>
<li><p> ndf = Naturalised daily flows
</p>
</li>
<li><p> nmf = Naturalised monthly flows
</p>
</li>
<li><p> cdr = Catchment daily rainfall
</p>
</li>
<li><p> cdr-d = Catchment daily rainfall distance to rain gauge
</p>
</li>
<li><p> cmr = Catchment monthly rainfall
</p>
</li>
<li><p> pot-stage = Peaks over threshold stage
</p>
</li>
<li><p> pot-flow = Peaks over threshold flow
</p>
</li>
<li><p> gauging-stage = Gauging stage
</p>
</li>
<li><p> gauging-flow = Gauging flow
</p>
</li>
<li><p> amax-stage = Annual maxima stage
</p>
</li>
<li><p> amax-flow = Annual maxima flow
</p>
</li></ul>
</td></tr>
<tr><td><code id="get_ts_+3A_metadata">metadata</code></td>
<td>
<p>Logical, FALSE by default. When metadata = TRUE the
result for a single station is a list with two elements: data (the time
series) and meta (metadata).</p>
</td></tr>
<tr><td><code id="get_ts_+3A_cl">cl</code></td>
<td>
<p>(optional) This is a cluster object, created by the parallel
package. This is set to NULL by default, which sends sequential calls to the
server.</p>
</td></tr>
<tr><td><code id="get_ts_+3A_full_info">full_info</code></td>
<td>
<p>Logical, FALSE by default. If full_info = TRUE, the function
will retrieve information on rejected periods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list composed of as many objects as in the list of station
identification numbers. Each object can be accessed using their names or
indexes (e.g. x[[1]], x[[2]], and so forth). Each object contains a time
series of class <code>zoo/xts</code>.
</p>


<h3>Author(s)</h3>

<p>Claudia Vitolo
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  get_ts(18019, type = "cmr")
  get_ts(c(54022,54090,54091), type = "cmr")
  get_ts(18019, type = "gdf")
  get_ts(c(54022,54090,54091), type = "gdf")
  plot(get_ts(id = 23001, type = "ndf"))
  plot(get_ts(id = 23001, type = "nmf"))

## End(Not run)

</code></pre>

<hr>
<h2 id='osg_parse'>Converts OS Grid Reference to BNG/WGS coordinates.</h2><span id='topic+osg_parse'></span>

<h3>Description</h3>

<p>This function converts an Ordnance Survey (OS) grid reference to
easting/northing or latitude/longitude coordinates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>osg_parse(grid_refs, coord_system = c("BNG", "WGS84"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="osg_parse_+3A_grid_refs">grid_refs</code></td>
<td>
<p>This is a string (or a character vector) that contains the
OS grid Reference.</p>
</td></tr>
<tr><td><code id="osg_parse_+3A_coord_system">coord_system</code></td>
<td>
<p>By default, this is &quot;BNG&quot; which stands for British
National Grids. The other option is to set coord_system = &quot;WGS84&quot;, which
returns latitude/longitude coordinates (more info can be found here
https://www.epsg-registry.org/).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector made of two elements: the easting and northing (by default) or
latitude and longitude coordinates.
</p>


<h3>Author(s)</h3>

<p>Claudia Vitolo (Ilaria Prosdocimi ported to sf)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  # single entry
  osg_parse(grid_refs = "TQ722213")

  # multiple entries
  osg_parse(grid_refs = c("SN831869","SN829838"))

  # multiple entries with missing values, NA will be returned
  osg_parse(grid_refs = c("SN831869",NA, "SN829838", NA))

## End(Not run)

</code></pre>

<hr>
<h2 id='plot_rain_flow'>Plot rainfall and flow for a given station</h2><span id='topic+plot_rain_flow'></span>

<h3>Description</h3>

<p>This function retrieves rainfall and flow time series for a
given catchment, divides the flow by the catchment area and converts it to
mm/day to that it can be comparable with the rainfall (mm/month). Finally it
generates a plots combining rainfall and flow information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_rain_flow(id = NULL, rain = NULL, flow = NULL, area = NULL, title = "")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_rain_flow_+3A_id">id</code></td>
<td>
<p>Station identification number</p>
</td></tr>
<tr><td><code id="plot_rain_flow_+3A_rain">rain</code></td>
<td>
<p>Rainfall time series, measured in mm/month</p>
</td></tr>
<tr><td><code id="plot_rain_flow_+3A_flow">flow</code></td>
<td>
<p>Flow time series, measured in m3/s</p>
</td></tr>
<tr><td><code id="plot_rain_flow_+3A_area">area</code></td>
<td>
<p>Catchment area in Km2</p>
</td></tr>
<tr><td><code id="plot_rain_flow_+3A_title">title</code></td>
<td>
<p>(optional) Plot title</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Plot rainfall and flow for a given station
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  plot_rain_flow(id = 54090)

## End(Not run)
</code></pre>

<hr>
<h2 id='plot_trend'>Plot trend</h2><span id='topic+plot_trend'></span>

<h3>Description</h3>

<p>This function plots a previously calculated trend.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_trend(df, column_name, maptype = "stamen_toner_lite", showmap = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_trend_+3A_df">df</code></td>
<td>
<p>Data frame containing at least 4 column:
lat (latitude), lon (longitude), slope and an additional user-defined column
<code>column_name</code>.</p>
</td></tr>
<tr><td><code id="plot_trend_+3A_column_name">column_name</code></td>
<td>
<p>name of the column to use for grouping the results.</p>
</td></tr>
<tr><td><code id="plot_trend_+3A_maptype">maptype</code></td>
<td>
<p>maptype, was need to choose the stamenmap type, now useless since
stamenmap are no longer reachable</p>
</td></tr>
<tr><td><code id="plot_trend_+3A_showmap">showmap</code></td>
<td>
<p>set to FALSE to avoid plotting the map when running the function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function relies on the 'ggmap' package for the map, and this package has 
in time gone through many changes due to changes in API of map providers. 
Currently to be able to create the map one needs to register to the stadiamaps
serice. More information at ?ggmap::register_stadiamaps().
</p>


<h3>Value</h3>

<p>Two plots, the first showing the distribution of the
trend over a map, based on the slope of the linear model that describes the
trend. The second plot shows a boxplot of the slope grouped based on the
column <code>column_name</code> and slope can be user-defined 
(notice that in the plot the very extreme slope values are not 
displayed to avoid skewed visualisations).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  # some fake data around London 
  df &lt;- data.frame(lat = 51.5+runif(40,-0.3,0.3), 
                   lon = 0+runif(40, -0.3,0.3),
                   slope = rnorm(40, c(rep(-0.4,20),rep(0.4,20))), 
                   g = factor(c(rep("a",20), rep("b",20))))
  theplots &lt;- plot_trend(df, "g", maptype = "terrain-background")
  theplots$A # map
  theplots$B + labs(subtitle = "Use ggplot usual commands to modify the plots") # boxplots
  

## End(Not run)
</code></pre>

<hr>
<h2 id='rnrfa-package'>UK National River Flow Archive data from R</h2><span id='topic+rnrfa-package'></span>

<h3>Description</h3>

<p>rnrfa: UK National River Flow Archive Data from R.
</p>


<h3>Details</h3>

<p>Utility functions to retrieve data from the UK National River Flow Archive
(http://nrfa.ceh.ac.uk/). The package contains R wrappers to the UK NRFA data
temporary-API. There are functions to retrieve stations falling in a bounding
box, to generate a map and extracting time series and general information.
</p>

<hr>
<h2 id='seasonal_averages'>Calculate seasonal averages</h2><span id='topic+seasonal_averages'></span>

<h3>Description</h3>

<p>This calculates the seasonal averages from a time series.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>seasonal_averages(timeseries, season = "Spring")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="seasonal_averages_+3A_timeseries">timeseries</code></td>
<td>
<p>Time series (zoo class).</p>
</td></tr>
<tr><td><code id="seasonal_averages_+3A_season">season</code></td>
<td>
<p>Name of the season, which corresponds to a quarter:
Winter (Q1), Spring (Q2), Summer (Q3), Autumn (Q4)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector containing the seasonal average and significance level
(p-value) for each time series.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  seasonal_averages(timeseries = cmr(18019), season = "Spring")
  seasonal_averages(list(cmr(18019), cmr(18019)), season = "Spring")

## End(Not run)

</code></pre>

<hr>
<h2 id='station_ids'>List of stations identification numbers from UK NRFA</h2><span id='topic+station_ids'></span>

<h3>Description</h3>

<p>This function pulls the list of station identification numbers.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>station_ids()
</code></pre>


<h3>Value</h3>

<p>vector integer identification numbers (one for each station)
</p>


<h3>Author(s)</h3>

<p>Claudia Vitolo
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  # Retrieve all the stations ids
  x &lt;- station_ids()

## End(Not run)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
